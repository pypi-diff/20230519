# Comparing `tmp/gdsfactory-6.94.1.tar.gz` & `tmp/gdsfactory-6.95.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "gdsfactory-6.94.1.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
+gzip compressed data, was "gdsfactory-6.95.0.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
```

## Comparing `gdsfactory-6.94.1.tar` & `gdsfactory-6.95.0.tar`

### file list

```diff
@@ -1,693 +1,693 @@
--rw-r--r--   0        0        0     1072 2023-05-17 21:21:27.772474 gdsfactory-6.94.1/LICENSE
--rw-r--r--   0        0        0    14319 2023-05-17 21:21:27.772474 gdsfactory-6.94.1/README.md
--rw-r--r--   0        0        0     3451 2023-05-17 21:21:27.776474 gdsfactory-6.94.1/gdsfactory/__init__.py
--rw-r--r--   0        0        0     2104 2023-05-17 21:21:27.776474 gdsfactory-6.94.1/gdsfactory/add_keepout.py
--rw-r--r--   0        0        0    12629 2023-05-17 21:21:27.776474 gdsfactory-6.94.1/gdsfactory/add_labels.py
--rw-r--r--   0        0        0     3711 2023-05-17 21:21:27.776474 gdsfactory-6.94.1/gdsfactory/add_loopback.py
--rw-r--r--   0        0        0     5054 2023-05-17 21:21:27.776474 gdsfactory-6.94.1/gdsfactory/add_padding.py
--rw-r--r--   0        0        0    15639 2023-05-17 21:21:27.776474 gdsfactory-6.94.1/gdsfactory/add_pins.py
--rw-r--r--   0        0        0    14700 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/add_ports.py
--rw-r--r--   0        0        0     2884 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/add_tapers.py
--rw-r--r--   0        0        0     2257 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/add_tapers_cross_section.py
--rw-r--r--   0        0        0     1831 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/add_termination.py
--rw-r--r--   0        0        0     1856 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/asserts.py
--rw-r--r--   0        0        0    12017 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/cell.py
--rw-r--r--   0        0        0    16040 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/circuitviz.py
--rw-r--r--   0        0        0     5718 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/cli.py
--rw-r--r--   0        0        0   100853 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/component.py
--rw-r--r--   0        0        0    23424 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/component_layout.py
--rw-r--r--   0        0        0    29787 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/component_reference.py
--rw-r--r--   0        0        0     1205 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/C.py
--rw-r--r--   0        0        0     1144 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/L.py
--rw-r--r--   0        0        0    20964 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/__init__.py
--rw-r--r--   0        0        0     2621 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/add_fiducials.py
--rw-r--r--   0        0        0    14087 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/add_grating_couplers.py
--rw-r--r--   0        0        0     2014 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/add_trenches.py
--rw-r--r--   0        0        0     3207 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/align.py
--rw-r--r--   0        0        0     2622 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/array_component.py
--rw-r--r--   0        0        0     4705 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/array_with_fanout.py
--rw-r--r--   0        0        0     4322 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/array_with_via.py
--rw-r--r--   0        0        0     4042 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/awg.py
--rw-r--r--   0        0        0     1269 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/bbox.py
--rw-r--r--   0        0        0     2851 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/bend_circular.py
--rw-r--r--   0        0        0     2649 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/bend_circular_heater.py
--rw-r--r--   0        0        0     7903 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/bend_euler.py
--rw-r--r--   0        0        0     2682 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/bend_port.py
--rw-r--r--   0        0        0     3664 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/bend_s.py
--rw-r--r--   0        0        0     5373 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/bezier.py
--rw-r--r--   0        0        0     1605 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/cavity.py
--rw-r--r--   0        0        0     5766 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/cdc.py
--rw-r--r--   0        0        0     2929 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/cdsem_all.py
--rw-r--r--   0        0        0     1788 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/cdsem_bend180.py
--rw-r--r--   0        0        0     1631 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/cdsem_coupler.py
--rw-r--r--   0        0        0     1412 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/cdsem_straight.py
--rw-r--r--   0        0        0     1565 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/cdsem_straight_density.py
--rw-r--r--   0        0        0      793 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/circle.py
--rw-r--r--   0        0        0     5722 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coh_rx_dual_pol.py
--rw-r--r--   0        0        0     8922 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coh_rx_single_pol.py
--rw-r--r--   0        0        0     5043 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coh_tx_dual_pol.py
--rw-r--r--   0        0        0     6118 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coh_tx_single_pol.py
--rw-r--r--   0        0        0     2548 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/compass.py
--rw-r--r--   0        0        0     9876 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/component_lattice.py
--rw-r--r--   0        0        0     7174 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/component_sequence.py
--rw-r--r--   0        0        0      812 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/copy_layers.py
--rw-r--r--   0        0        0     3460 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler.py
--rw-r--r--   0        0        0     2113 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler90.py
--rw-r--r--   0        0        0     1802 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler90bend.py
--rw-r--r--   0        0        0     4666 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler_adiabatic.py
--rw-r--r--   0        0        0     1909 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler_asymmetric.py
--rw-r--r--   0        0        0     3970 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler_full.py
--rw-r--r--   0        0        0     3414 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler_ring.py
--rw-r--r--   0        0        0     1060 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler_straight.py
--rw-r--r--   0        0        0     1164 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler_straight_asymmetric.py
--rw-r--r--   0        0        0     2192 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/coupler_symmetric.py
--rw-r--r--   0        0        0     1848 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/cross.py
--rw-r--r--   0        0        0    12873 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/crossing_waveguide.py
--rw-r--r--   0        0        0      500 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
--rw-r--r--   0        0        0     1014 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
--rw-r--r--   0        0        0    19749 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
--rw-r--r--   0        0        0    19751 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
--rw-r--r--   0        0        0    19749 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
--rw-r--r--   0        0        0    19751 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
--rw-r--r--   0        0        0    19775 2023-05-17 21:21:27.780474 gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
--rw-r--r--   0        0        0     3143 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
--rw-r--r--   0        0        0     5272 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/cutback_2x2.py
--rw-r--r--   0        0        0     6450 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/cutback_bend.py
--rw-r--r--   0        0        0     3765 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/cutback_component.py
--rw-r--r--   0        0        0     2721 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/cutback_splitter.py
--rw-r--r--   0        0        0     2971 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/dbr.py
--rw-r--r--   0        0        0     4288 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/dbr_tapered.py
--rw-r--r--   0        0        0     2486 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/delay_snake.py
--rw-r--r--   0        0        0     3177 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/delay_snake2.py
--rw-r--r--   0        0        0     3245 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/delay_snake3.py
--rw-r--r--   0        0        0     4319 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/delay_snake_sbend.py
--rw-r--r--   0        0        0     1226 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/dicing_lane.py
--rw-r--r--   0        0        0     3471 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/die.py
--rw-r--r--   0        0        0     2975 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/die_bbox.py
--rw-r--r--   0        0        0     2863 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/die_bbox_frame.py
--rw-r--r--   0        0        0     8015 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/disk.py
--rw-r--r--   0        0        0     4112 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/edge_coupler_array.py
--rw-r--r--   0        0        0     1214 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ellipse.py
--rw-r--r--   0        0        0     1800 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/extend_ports_list.py
--rw-r--r--   0        0        0     7988 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/extension.py
--rw-r--r--   0        0        0      981 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/fiber.py
--rw-r--r--   0        0        0     1432 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/fiber_array.py
--rw-r--r--   0        0        0      722 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/fiducial_squares.py
--rw-r--r--   0        0        0     3290 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ge_detector_straight_si_contacts.py
--rw-r--r--   0        0        0     1063 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_array.py
--rw-r--r--   0        0        0     4682 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_dual_pol.py
--rw-r--r--   0        0        0     7110 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_elliptical.py
--rw-r--r--   0        0        0     7221 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
--rw-r--r--   0        0        0     4960 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_elliptical_lumerical.py
--rw-r--r--   0        0        0     4592 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_elliptical_trenches.py
--rw-r--r--   0        0        0     1773 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_functions.py
--rw-r--r--   0        0        0     9058 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_loss.py
--rw-r--r--   0        0        0     1786 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_loss_fiber_single.py
--rw-r--r--   0        0        0     4142 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_rectangular.py
--rw-r--r--   0        0        0     4685 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
--rw-r--r--   0        0        0     3887 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
--rw-r--r--   0        0        0     1578 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/grating_coupler_tree.py
--rw-r--r--   0        0        0     8811 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/greek_cross.py
--rw-r--r--   0        0        0     1019 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/hline.py
--rw-r--r--   0        0        0     3687 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/interdigital_capacitor.py
--rw-r--r--   0        0        0     1825 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/litho_calipers.py
--rw-r--r--   0        0        0     1244 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/litho_ruler.py
--rw-r--r--   0        0        0     1304 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/litho_steps.py
--rw-r--r--   0        0        0      650 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/logo.py
--rw-r--r--   0        0        0     1679 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/loop_mirror.py
--rw-r--r--   0        0        0     3873 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mmi1x2.py
--rw-r--r--   0        0        0     2814 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mmi1x2_with_sbend.py
--rw-r--r--   0        0        0     3858 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mmi2x2.py
--rw-r--r--   0        0        0     3299 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mmi2x2_with_sbend.py
--rw-r--r--   0        0        0     4947 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mmi_90degree_hybrid.py
--rw-r--r--   0        0        0     3265 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mode_converter.py
--rw-r--r--   0        0        0     7409 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzi.py
--rw-r--r--   0        0        0     2499 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzi_arm.py
--rw-r--r--   0        0        0     5835 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzi_arms.py
--rw-r--r--   0        0        0    12214 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzi_lattice.py
--rw-r--r--   0        0        0     4025 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzi_pads_center.py
--rw-r--r--   0        0        0     1064 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzi_phase_shifter.py
--rw-r--r--   0        0        0     6342 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzit.py
--rw-r--r--   0        0        0     3502 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzit_lattice.py
--rw-r--r--   0        0        0     6047 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/mzm.py
--rw-r--r--   0        0        0     3518 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/nxn.py
--rw-r--r--   0        0        0     1940 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/optimal_90deg.py
--rw-r--r--   0        0        0     3876 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/optimal_hairpin.py
--rw-r--r--   0        0        0     6131 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/optimal_step.py
--rw-r--r--   0        0        0     6327 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/pack_doe.py
--rw-r--r--   0        0        0     3860 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/pad.py
--rw-r--r--   0        0        0     1890 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/pad_gsg.py
--rw-r--r--   0        0        0     1157 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/pads_shorted.py
--rw-r--r--   0        0        0     3833 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/polarization_splitter_rotator.py
--rw-r--r--   0        0        0     1147 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ramp.py
--rw-r--r--   0        0        0     1508 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/rectangle.py
--rw-r--r--   0        0        0     2972 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/rectangle_with_slits.py
--rw-r--r--   0        0        0     1508 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/regular_polygon.py
--rw-r--r--   0        0        0     3302 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/resistance_meander.py
--rw-r--r--   0        0        0     2642 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/resistance_sheet.py
--rw-r--r--   0        0        0     1273 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring.py
--rw-r--r--   0        0        0     4143 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_crow.py
--rw-r--r--   0        0        0     3272 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_crow_couplers.py
--rw-r--r--   0        0        0     2267 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_double.py
--rw-r--r--   0        0        0     2846 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_double_bend_coupler.py
--rw-r--r--   0        0        0     3846 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_double_heater.py
--rw-r--r--   0        0        0     7757 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_double_pn.py
--rw-r--r--   0        0        0    12137 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_section_based.py
--rw-r--r--   0        0        0     2740 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_single.py
--rw-r--r--   0        0        0     1968 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_single_array.py
--rw-r--r--   0        0        0     6868 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_single_bend_coupler.py
--rw-r--r--   0        0        0     2714 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_single_dut.py
--rw-r--r--   0        0        0     4018 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_single_heater.py
--rw-r--r--   0        0        0     5267 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/ring_single_pn.py
--rw-r--r--   0        0        0     2282 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/seal_ring.py
--rw-r--r--   0        0        0     3758 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/snspd.py
--rw-r--r--   0        0        0     2059 2023-05-17 21:21:27.784474 gdsfactory-6.94.1/gdsfactory/components/spiral_double.py
--rw-r--r--   0        0        0     5871 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/spiral_external_io.py
--rw-r--r--   0        0        0    16692 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/spiral_heater.py
--rw-r--r--   0        0        0     9181 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/spiral_inner_io.py
--rw-r--r--   0        0        0     1733 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/splitter_chain.py
--rw-r--r--   0        0        0     5327 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/splitter_tree.py
--rw-r--r--   0        0        0     2526 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight.py
--rw-r--r--   0        0        0     1033 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_array.py
--rw-r--r--   0        0        0     7914 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_heater_doped_rib.py
--rw-r--r--   0        0        0     1922 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_heater_doped_strip.py
--rw-r--r--   0        0        0     7891 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_heater_meander.py
--rw-r--r--   0        0        0     8090 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_heater_meander_doped.py
--rw-r--r--   0        0        0     5686 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_heater_metal.py
--rw-r--r--   0        0        0     2809 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_pin.py
--rw-r--r--   0        0        0     3974 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_pin_slot.py
--rw-r--r--   0        0        0      655 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/straight_rib.py
--rw-r--r--   0        0        0      820 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/switch_tree.py
--rw-r--r--   0        0        0     7730 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/taper.py
--rw-r--r--   0        0        0     3530 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/taper_adiabatic.py
--rw-r--r--   0        0        0     2457 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/taper_cross_section.py
--rw-r--r--   0        0        0     2363 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/taper_from_csv.py
--rw-r--r--   0        0        0     1215 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/taper_parabolic.py
--rw-r--r--   0        0        0     1635 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/terminator.py
--rw-r--r--   0        0        0     2913 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/text.py
--rw-r--r--   0        0        0     3821 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/text_freetype.py
--rw-r--r--   0        0        0     3160 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/text_rectangular.py
--rw-r--r--   0        0        0     3943 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/text_rectangular_font.py
--rw-r--r--   0        0        0     2536 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/triangles.py
--rw-r--r--   0        0        0      715 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/verniers.py
--rw-r--r--   0        0        0     2468 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/version_stamp.py
--rw-r--r--   0        0        0     2436 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/via.py
--rw-r--r--   0        0        0     3060 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/via_corner.py
--rw-r--r--   0        0        0     5342 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/via_cutback.py
--rw-r--r--   0        0        0    15612 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/via_stack.py
--rw-r--r--   0        0        0     4430 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/via_stack_slot.py
--rw-r--r--   0        0        0     4944 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/via_stack_with_offset.py
--rw-r--r--   0        0        0     1088 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/wafer.py
--rw-r--r--   0        0        0     2542 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/wire.py
--rw-r--r--   0        0        0      978 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/components/wire_sbend.py
--rw-r--r--   0        0        0     8105 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/config.py
--rw-r--r--   0        0        0      481 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/conftest.py
--rw-r--r--   0        0        0    38409 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/constants.py
--rw-r--r--   0        0        0     1476 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/containers.py
--rw-r--r--   0        0        0    82893 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/cross_section.py
--rw-r--r--   0        0        0     2982 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/decorators.py
--rw-r--r--   0        0        0     7312 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/difftest.py
--rw-r--r--   0        0        0     1020 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/events.py
--rw-r--r--   0        0        0      204 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/export/__init__.py
--rw-r--r--   0        0        0     3353 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/export/to_3d.py
--rw-r--r--   0        0        0     1940 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/export/to_np.py
--rw-r--r--   0        0        0     3058 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/export/to_stl.py
--rw-r--r--   0        0        0     7445 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/export/write_gerbers.py
--rw-r--r--   0        0        0     2976 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/filestorage.py
--rw-r--r--   0        0        0    11890 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/fill.py
--rw-r--r--   0        0        0     7799 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/font.py
--rw-r--r--   0        0        0     8073 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/functions.py
--rw-r--r--   0        0        0       20 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/gdsdiff/.gitattributes
--rw-r--r--   0        0        0       83 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/gdsdiff/.gitconfig
--rw-r--r--   0        0        0       72 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/gdsdiff/__init__.py
--rw-r--r--   0        0        0     1069 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/gdsdiff/gds_diff_git.py
--rw-r--r--   0        0        0     2935 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/gdsdiff/gdsdiff.py
--rw-r--r--   0        0        0      708 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/gdsdiff/install.py
--rw-r--r--   0        0        0      271 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/gdsdiff/sample.py
--rw-r--r--   0        0        0     1059 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/gdsdiff/test_xor.py
--rw-r--r--   0        0        0     1100 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/README.md
--rw-r--r--   0        0        0     1722 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/__init__.py
--rw-r--r--   0        0        0      169 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/generic_tech.sh
--rw-r--r--   0        0        0     8142 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/get_klayout_pyxs.py
--rw-r--r--   0        0        0      161 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/README.md
--rw-r--r--   0        0        0      104 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/drc/Makefile
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/drc/__init__.py
--rw-r--r--   0        0        0     2842 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/drc/errors.py
--rw-r--r--   0        0        0     6193 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/grain.xml
--rw-r--r--   0        0        0    10140 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/icon_128x128.png
--rw-r--r--   0        0        0     4248 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/icon_64x64.png
--rw-r--r--   0        0        0       27 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/.gitignore
--rw-r--r--   0        0        0      494 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/Makefile
--rw-r--r--   0        0        0     4062 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/README.md
--rw-r--r--   0        0        0     2419 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
--rw-r--r--   0        0        0     9696 2023-05-17 21:21:27.788474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
--rw-r--r--   0        0        0    12379 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
--rw-r--r--   0        0        0     7235 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
--rw-r--r--   0        0        0     3446 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
--rw-r--r--   0        0        0      479 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
--rw-r--r--   0        0        0      582 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
--rw-r--r--   0        0        0      108 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
--rw-r--r--   0        0        0      186 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
--rw-r--r--   0        0        0      398 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
--rw-r--r--   0        0        0      574 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
--rw-r--r--   0        0        0     6034 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
--rw-r--r--   0        0        0    10704 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
--rw-r--r--   0        0        0      477 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
--rw-r--r--   0        0        0     4337 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
--rw-r--r--   0        0        0      926 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
--rw-r--r--   0        0        0    10945 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
--rw-r--r--   0        0        0      710 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
--rw-r--r--   0        0        0      538 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/python/__init__.py
--rw-r--r--   0        0        0      114 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
--rw-r--r--   0        0        0     4311 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
--rw-r--r--   0        0        0      269 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/Makefile
--rw-r--r--   0        0        0     1854 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25
--rw-r--r--   0        0        0     1519 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/generic.layerstack
--rw-r--r--   0        0        0    41073 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
--rw-r--r--   0        0        0    40616 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/layers.lyp
--rw-r--r--   0        0        0     5977 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/tech.lyt
--rw-r--r--   0        0        0     4258 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
--rw-r--r--   0        0        0     4537 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
--rw-r--r--   0        0        0     4690 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
--rw-r--r--   0        0        0     5508 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
--rw-r--r--   0        0        0     1883 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/layer_map.py
--rw-r--r--   0        0        0     6511 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/layer_stack.py
--rw-r--r--   0        0        0    10780 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/layer_views.yaml
--rw-r--r--   0        0        0      158 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/generic_tech/simulation_settings.py
--rw-r--r--   0        0        0     1431 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/__init__.py
--rw-r--r--   0        0        0     4917 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/boolean.py
--rw-r--r--   0        0        0     3814 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/boolean_klayout.py
--rw-r--r--   0        0        0     1904 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/boolean_polygons.py
--rw-r--r--   0        0        0      598 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/check_duplicated_cells.py
--rw-r--r--   0        0        0     2719 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/check_exclusion.py
--rw-r--r--   0        0        0     2829 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/check_inclusion.py
--rw-r--r--   0        0        0     3566 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/check_space.py
--rw-r--r--   0        0        0     1904 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/check_width.py
--rw-r--r--   0        0        0     5015 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/fill_klayout.py
--rw-r--r--   0        0        0     7084 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/fill_tiled.py
--rw-r--r--   0        0        0     1697 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/fillet.py
--rw-r--r--   0        0        0     6664 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/functions.py
--rw-r--r--   0        0        0     2167 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/invert.py
--rw-r--r--   0        0        0     3685 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/layer_priority.py
--rw-r--r--   0        0        0     3054 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/manhattanize.py
--rw-r--r--   0        0        0     4192 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/maskprep.py
--rw-r--r--   0        0        0     4812 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/maskprep_flat.py
--rw-r--r--   0        0        0     3250 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/offset.py
--rw-r--r--   0        0        0     3842 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/outline.py
--rw-r--r--   0        0        0     2510 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/trim.py
--rw-r--r--   0        0        0     2948 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/union.py
--rw-r--r--   0        0        0     1898 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/write_connectivity.py
--rw-r--r--   0        0        0    10532 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/write_drc.py
--rw-r--r--   0        0        0     1783 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/geometry/xor_diff.py
--rw-r--r--   0        0        0     1158 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/get_factories.py
--rw-r--r--   0        0        0    23569 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/get_netlist.py
--rw-r--r--   0        0        0    14446 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/get_netlist_flat.py
--rw-r--r--   0        0        0      682 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/get_netlist_klayout.py
--rw-r--r--   0        0        0     9745 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/grid.py
--rw-r--r--   0        0        0     4393 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/install.py
--rw-r--r--   0        0        0     1970 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/klive.py
--rw-r--r--   0        0        0      585 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/labels/__init__.py
--rw-r--r--   0        0        0     3563 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/labels/add_label_yaml.py
--rw-r--r--   0        0        0     3847 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/labels/ehva.py
--rw-r--r--   0        0        0     3810 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/labels/merge_test_metadata.py
--rw-r--r--   0        0        0     4668 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/labels/siepic.py
--rw-r--r--   0        0        0     4847 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/labels/write_labels.py
--rw-r--r--   0        0        0     1149 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/materials.py
--rw-r--r--   0        0        0     5247 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/name.py
--rw-r--r--   0        0        0    11586 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/pack.py
--rw-r--r--   0        0        0    50895 2023-05-17 21:21:27.792474 gdsfactory-6.94.1/gdsfactory/path.py
--rw-r--r--   0        0        0    25857 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/pdk.py
--rw-r--r--   0        0        0     6220 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/picmodel.py
--rw-r--r--   0        0        0     5068 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/pixelate.py
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/dagster/__init__.py
--rw-r--r--   0        0        0      976 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/dagster/workflow.py
--rw-r--r--   0        0        0      566 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/database/README.md
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/database/__init__.py
--rw-r--r--   0        0        0     6216 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/database/db_upload.py
--rw-r--r--   0        0        0    16143 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/database/models.py
--rw-r--r--   0        0        0       32 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/web/Makefile
--rw-r--r--   0        0        0       23 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/web/__init__.py
--rw-r--r--   0        0        0     4080 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/web/main.py
--rwxr-xr-x   0        0        0     7511 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/web/server.py
--rwxr-xr-x   0        0        0      594 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/web/server_jupyter.py
--rw-r--r--   0        0        0     1299 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/plugins/web/static/client.css
--rw-r--r--   0        0        0    32235 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/port.py
--rw-r--r--   0        0        0    37817 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/quickplotter.py
--rw-r--r--   0        0        0      696 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/__init__.py
--rw-r--r--   0        0        0     1639 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/from_dphox.py
--rw-r--r--   0        0        0     1285 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/from_gdspaths.py
--rw-r--r--   0        0        0     1953 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/from_np.py
--rw-r--r--   0        0        0     2813 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/from_phidl.py
--rw-r--r--   0        0        0    38082 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/from_yaml.py
--rw-r--r--   0        0        0     5897 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/from_yaml_template.py
--rw-r--r--   0        0        0     5688 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/import_gds.py
--rw-r--r--   0        0        0     3407 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/read/labels.py
--rw-r--r--   0        0        0     3769 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/__init__.py
--rw-r--r--   0        0        0     2920 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/add_electrical_pads_shortest.py
--rw-r--r--   0        0        0     3015 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/add_electrical_pads_top.py
--rw-r--r--   0        0        0     3035 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/add_electrical_pads_top_dc.py
--rw-r--r--   0        0        0     8715 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/add_fiber_array.py
--rw-r--r--   0        0        0    10624 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/add_fiber_single.py
--rw-r--r--   0        0        0     8967 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/add_pads.py
--rw-r--r--   0        0        0    38948 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/all_angle.py
--rw-r--r--   0        0        0     3916 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/auto_taper.py
--rw-r--r--   0        0        0      982 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/factories.py
--rw-r--r--   0        0        0     4415 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/fanout.py
--rw-r--r--   0        0        0     2800 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/fanout2x2.py
--rw-r--r--   0        0        0    24342 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_bundle.py
--rw-r--r--   0        0        0     8652 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_bundle_corner.py
--rw-r--r--   0        0        0     6910 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_bundle_from_steps.py
--rw-r--r--   0        0        0    12949 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_bundle_from_waypoints.py
--rw-r--r--   0        0        0     5284 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_bundle_path_length_match.py
--rw-r--r--   0        0        0     1937 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_bundle_sbend.py
--rw-r--r--   0        0        0    17064 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_bundle_u.py
--rw-r--r--   0        0        0     1510 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_input_labels.py
--rw-r--r--   0        0        0     9233 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_route.py
--rw-r--r--   0        0        0    10872 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_route_astar.py
--rw-r--r--   0        0        0     6119 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_route_from_steps.py
--rw-r--r--   0        0        0     2766 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_route_sbend.py
--rw-r--r--   0        0        0     3311 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_routes_bend180.py
--rw-r--r--   0        0        0     1854 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/get_routes_straight.py
--rw-r--r--   0        0        0    34394 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/manhattan.py
--rw-r--r--   0        0        0    10081 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/path_length_matching.py
--rw-r--r--   0        0        0    22568 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/route_fiber_array.py
--rw-r--r--   0        0        0     8679 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/route_fiber_single.py
--rw-r--r--   0        0        0    18132 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/route_ports_to_side.py
--rw-r--r--   0        0        0     4379 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/route_quad.py
--rw-r--r--   0        0        0    14370 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/route_sharp.py
--rw-r--r--   0        0        0    10167 2023-05-17 21:21:27.796474 gdsfactory-6.94.1/gdsfactory/routing/route_south.py
--rw-r--r--   0        0        0     5072 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/routing/sort_ports.py
--rw-r--r--   0        0        0     2477 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/routing/utils.py
--rw-r--r--   0        0        0     2897 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/01_component_pcell.py
--rw-r--r--   0        0        0      646 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
--rw-r--r--   0        0        0     1109 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/01_component_pcell_with_pins.py
--rw-r--r--   0        0        0      664 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
--rw-r--r--   0        0        0      347 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/02_component_autoname.py
--rw-r--r--   0        0        0      887 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/03_move.py
--rw-r--r--   0        0        0      881 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/04_connect.py
--rw-r--r--   0        0        0      710 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/05_remove_layers.py
--rw-r--r--   0        0        0      931 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/06_remapping_layers.py
--rw-r--r--   0        0        0     1082 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/07_flattening_device.py
--rw-r--r--   0        0        0      475 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/08_group.py
--rw-r--r--   0        0        0     1631 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/11_component_layout.py
--rw-r--r--   0        0        0     2245 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/12_component_refs.py
--rw-r--r--   0        0        0      955 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/13_component_netlist.py
--rw-r--r--   0        0        0     2592 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/14_component_connectivity.py
--rw-r--r--   0        0        0     1636 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/15_component_sequence1.py
--rw-r--r--   0        0        0     1680 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/16_component_sequence2.py
--rw-r--r--   0        0        0      965 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/17_ports.py
--rw-r--r--   0        0        0      489 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/18_port_markers.py
--rw-r--r--   0        0        0      361 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/19_references.py
--rw-r--r--   0        0        0      533 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/20_components.py
--rw-r--r--   0        0        0      507 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/21_add_fiber_array.py
--rw-r--r--   0        0        0      493 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/22_add_fiber_single.py
--rw-r--r--   0        0        0      569 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/22_add_pads.py
--rw-r--r--   0        0        0      848 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/23_reticle.py
--rw-r--r--   0        0        0     1588 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/23_reticle_passives.py
--rw-r--r--   0        0        0      457 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/24_doe.py
--rw-r--r--   0        0        0      687 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/24_doe_2.py
--rw-r--r--   0        0        0      692 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/24_doe_3.py
--rw-r--r--   0        0        0      306 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/25_slot_cross_section.py
--rw-r--r--   0        0        0     1363 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/30_lidar.py
--rw-r--r--   0        0        0     1412 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/30_lidar_pcell.py
--rw-r--r--   0        0        0     1943 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/30_lidar_with_pads.py
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/__init__.py
--rw-r--r--   0        0        0     1307 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing.py
--rw-r--r--   0        0        0      558 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
--rw-r--r--   0        0        0     6062 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
--rw-r--r--   0        0        0      444 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
--rw-r--r--   0        0        0      463 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
--rw-r--r--   0        0        0     1552 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
--rw-r--r--   0        0        0     1315 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
--rw-r--r--   0        0        0      602 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
--rw-r--r--   0        0        0     3317 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
--rw-r--r--   0        0        0     1484 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
--rw-r--r--   0        0        0     3045 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
--rw-r--r--   0        0        0     3782 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
--rw-r--r--   0        0        0     1988 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/big_device.py
--rw-r--r--   0        0        0       19 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/Makefile
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/__init__.py
--rw-r--r--   0        0        0     1129 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/benchmark/fill_demo.py
--rw-r--r--   0        0        0      343 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
--rw-r--r--   0        0        0      637 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/circuits/mask.pic.yml
--rw-r--r--   0        0        0      622 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
--rw-r--r--   0        0        0      569 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
--rw-r--r--   0        0        0      453 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/circuits/pads.pic.yml
--rw-r--r--   0        0        0      287 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/circuits/rectangles.pic.yml
--rw-r--r--   0        0        0     2260 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/drc_errors.py
--rw-r--r--   0        0        0     1014 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/drc_write.py
--rw-r--r--   0        0        0     4530 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/layers.py
--rw-r--r--   0        0        0      158 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/layers_sky130.py
--rw-r--r--   0        0        0      364 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/layers_xsection.py
--rw-r--r--   0        0        0     1062 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/lvs.py
--rw-r--r--   0        0        0      574 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/demo/pcell.py
--rw-r--r--   0        0        0     4174 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/netlists/mzi.yml
--rw-r--r--   0        0        0     5840 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/netlists/mzi_full.yml
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/__init__.py
--rw-r--r--   0        0        0     4235 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/fab_c.py
--rw-r--r--   0        0        0      475 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/fab_d/__init__.py
--rw-r--r--   0        0        0     1880 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/fab_d/phase_shifters.py
--rw-r--r--   0        0        0     1715 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c.py
--rw-r--r--   0        0        0       50 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
--rw-r--r--   0        0        0       93 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
--rw-r--r--   0        0        0       85 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
--rw-r--r--   0        0        0      139 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
--rw-r--r--   0        0        0       90 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
--rw-r--r--   0        0        0      126 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
--rw-r--r--   0        0        0       48 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
--rw-r--r--   0        0        0     1023 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
--rw-r--r--   0        0        0     2100 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
--rw-r--r--   0        0        0     1839 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
--rw-r--r--   0        0        0     1283 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
--rw-r--r--   0        0        0     1592 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
--rw-r--r--   0        0        0     1061 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
--rw-r--r--   0        0        0     1054 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
--rw-r--r--   0        0        0     1577 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
--rw-r--r--   0        0        0     4313 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
--rw-r--r--   0        0        0     3625 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
--rw-r--r--   0        0        0     3603 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
--rw-r--r--   0        0        0     4271 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
--rw-r--r--   0        0        0      840 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
--rw-r--r--   0        0        0     2171 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
--rw-r--r--   0        0        0      316 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/schematic.py
--rw-r--r--   0        0        0    17862 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/schematic_editor.py
--rw-r--r--   0        0        0     4194 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/serialization.py
--rw-r--r--   0        0        0     1612 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/show.py
--rw-r--r--   0        0        0      724 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/__init__.py
--rw-r--r--   0        0        0     4369 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/add_simulation_markers.py
--rw-r--r--   0        0        0     2476 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/convert_sparameters.py
--rw-r--r--   0        0        0      547 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/devsim/__init__.py
--rw-r--r--   0        0        0     2559 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/devsim/doping.py
--rw-r--r--   0        0        0    11977 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/devsim/get_simulation.py
--rw-r--r--   0        0        0    23687 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/devsim/get_simulation_xsection.py
--rw-r--r--   0        0        0    19756 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/devsim/get_solver.py
--rw-r--r--   0        0        0     1644 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/devsim/test_devsim.py
--rw-r--r--   0        0        0      189 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/disable_print.py
--rw-r--r--   0        0        0       79 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/eme/__init__.py
--rw-r--r--   0        0        0    14784 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/eme/meow_eme.py
--rw-r--r--   0        0        0     1787 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/eme/test_meow_simulation.py
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/fem/__init__.py
--rw-r--r--   0        0        0     8968 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/fem/mode_solver.py
--rw-r--r--   0        0        0     2221 2023-05-17 21:21:27.800474 gdsfactory-6.94.1/gdsfactory/simulation/fem/test_mode_solver.py
--rw-r--r--   0        0        0     3455 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/get_effective_indices.py
--rw-r--r--   0        0        0     3109 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/get_modes_path.py
--rw-r--r--   0        0        0     3888 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/get_sparameters_path.py
--rw-r--r--   0        0        0     2003 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/__init__.py
--rw-r--r--   0        0        0     3194 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_material.py
--rw-r--r--   0        0        0     6137 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_meep_geometry.py
--rw-r--r--   0        0        0     6054 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_port_eigenmode.py
--rw-r--r--   0        0        0    11014 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_simulation.py
--rw-r--r--   0        0        0    15915 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py
--rw-r--r--   0        0        0    18182 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py
--rw-r--r--   0        0        0    12312 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py
--rw-r--r--   0        0        0    11914 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_eigenmode.py
--rw-r--r--   0        0        0      832 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_materials.py
--rw-r--r--   0        0        0    10128 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv
--rw-r--r--   0        0        0    10128 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv
--rw-r--r--   0        0        0     6642 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py
--rw-r--r--   0        0        0    10128 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv
--rw-r--r--   0        0        0    10128 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv
--rw-r--r--   0        0        0    10093 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv
--rw-r--r--   0        0        0    10085 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv
--rw-r--r--   0        0        0    10085 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv
--rw-r--r--   0        0        0    34701 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv
--rw-r--r--   0        0        0    10123 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv
--rw-r--r--   0        0        0     9966 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv
--rw-r--r--   0        0        0     9966 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv
--rw-r--r--   0        0        0    10085 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv
--rw-r--r--   0        0        0    10129 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv
--rw-r--r--   0        0        0    14053 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/write_sparameters_grating.py
--rw-r--r--   0        0        0    21281 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/write_sparameters_meep.py
--rw-r--r--   0        0        0     8143 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py
--rw-r--r--   0        0        0     9577 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py
--rw-r--r--   0        0        0     1246 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/__init__.py
--rw-r--r--   0        0        0     6653 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/break_geometry.py
--rw-r--r--   0        0        0    11250 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/mesh.py
--rw-r--r--   0        0        0    11824 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/meshtracker.py
--rw-r--r--   0        0        0     7752 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/parse_component.py
--rw-r--r--   0        0        0     3644 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/parse_gds.py
--rw-r--r--   0        0        0     3605 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/parse_layerstack.py
--rw-r--r--   0        0        0     2990 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/refine.py
--rw-r--r--   0        0        0    10851 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/scratch/mesh3D.py
--rw-r--r--   0        0        0     2513 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/tests/test_meshing.py
--rw-r--r--   0        0        0    14168 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/uz_xsection_mesh.py
--rw-r--r--   0        0        0     7441 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/xy_xsection_mesh.py
--rw-r--r--   0        0        0    16334 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gmsh/xyz_mesh.py
--rw-r--r--   0        0        0     1624 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/__init__.py
--rw-r--r--   0        0        0     4368 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/get_results.py
--rw-r--r--   0        0        0    20009 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/get_simulation.py
--rw-r--r--   0        0        0    21071 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py
--rw-r--r--   0        0        0     2821 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/materials.py
--rw-r--r--   0        0        0    26438 2023-05-17 21:21:27.804474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/modes.py
--rw-r--r--   0        0        0     8941 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/sim_run.yaml
--rw-r--r--   0        0        0     8114 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml
--rw-r--r--   0        0        0     8114 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml
--rw-r--r--   0        0        0      744 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_modes.py
--rw-r--r--   0        0        0      262 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_modes/test_sweep_width.csv
--rw-r--r--   0        0        0      879 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_results.py
--rw-r--r--   0        0        0     1505 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_simulation.py
--rw-r--r--   0        0        0     1270 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py
--rw-r--r--   0        0        0     9297 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv
--rw-r--r--   0        0        0     1732 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py
--rw-r--r--   0        0        0     1224 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/utils.py
--rw-r--r--   0        0        0    10515 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/write_sparameters.py
--rw-r--r--   0        0        0     7695 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py
--rw-r--r--   0        0        0      588 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/lumerical/__init__.py
--rw-r--r--   0        0        0    16091 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/lumerical/interconnect.py
--rw-r--r--   0        0        0     4286 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/lumerical/read.py
--rw-r--r--   0        0        0     3569 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/lumerical/settings.py
--rw-r--r--   0        0        0     2348 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/lumerical/test_read_sparameters.py
--rw-r--r--   0        0        0    19865 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py
--rw-r--r--   0        0        0     1504 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py
--rw-r--r--   0        0        0      932 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/__init__.py
--rw-r--r--   0        0        0     1618 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/coupler.py
--rw-r--r--   0        0        0     4166 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/find_coupling_vs_gap.py
--rw-r--r--   0        0        0     2773 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/find_mode_dispersion.py
--rw-r--r--   0        0        0     8924 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/find_modes.py
--rwxr-xr-x   0        0        0     7032 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/find_modes_cross_section.py
--rw-r--r--   0        0        0     4458 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py
--rw-r--r--   0        0        0     2728 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/find_neff_vs_width.py
--rw-r--r--   0        0        0     7148 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/get_mode_solver_coupler.py
--rwxr-xr-x   0        0        0     4462 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/get_mode_solver_cross_section.py
--rw-r--r--   0        0        0     5411 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/get_mode_solver_rib.py
--rw-r--r--   0        0        0     1110 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv
--rw-r--r--   0        0        0     1102 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv
--rw-r--r--   0        0        0     1110 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv
--rw-r--r--   0        0        0     8023 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/neff_convergence_test.py
--rw-r--r--   0        0        0      267 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/neff_vs_width.csv
--rw-r--r--   0        0        0     2469 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/overlap.py
--rw-r--r--   0        0        0      418 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_dw_dh.py
--rw-r--r--   0        0        0       83 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh.csv
--rw-r--r--   0        0        0      548 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv
--rw-r--r--   0        0        0     1137 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_find_modes.py
--rw-r--r--   0        0        0      649 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py
--rw-r--r--   0        0        0      354 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_neff_vs_width.py
--rw-r--r--   0        0        0      113 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_neff_vs_width/test_neff_vs_width.csv
--rw-r--r--   0        0        0    15492 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/types.py
--rw-r--r--   0        0        0     1169 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/modes/waveguide.py
--rw-r--r--   0        0        0     2013 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/__init__.py
--rw-r--r--   0        0        0      597 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/coupler.py
--rw-r--r--   0        0        0      377 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/fsr.py
--rw-r--r--   0        0        0      418 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/heater.py
--rw-r--r--   0        0        0     3069 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/mzi.py
--rw-r--r--   0        0        0     2616 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/ring.py
--rw-r--r--   0        0        0     7332 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/plot.py
--rw-r--r--   0        0        0     2480 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/plot_csv.py
--rw-r--r--   0        0        0      703 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/port_symmetries.py
--rw-r--r--   0        0        0     4685 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/process/diffusion.py
--rw-r--r--   0        0        0     5317 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/process/implant_tables.py
--rw-r--r--   0        0        0     6800 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/process/pysrim.py
--rw-r--r--   0        0        0     2182 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/process/silicon.py
--rw-r--r--   0        0        0     1861 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/process/skew/antimony_si_skew.csv
--rw-r--r--   0        0        0     1050 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/process/skew/arsenic_si_skew.csv
--rw-r--r--   0        0        0     1468 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/process/skew/boron_si_skew.csv
--rw-r--r--   0        0        0     1118 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv
--rw-r--r--   0        0        0      191 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/__init__.py
--rw-r--r--   0        0        0    14848 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/build_model.py
--rw-r--r--   0        0        0     7449 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/femwell_waveguide_model.py
--rw-r--r--   0        0        0     1571 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/interpolators.py
--rw-r--r--   0        0        0     6755 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/meep_FDTD_model.py
--rw-r--r--   0        0        0     4528 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/meow_eme_model.py
--rw-r--r--   0        0        0     5613 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/mlp.py
--rw-r--r--   0        0        0     7358 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/models.py
--rw-r--r--   0        0        0    13894 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/parameter.py
--rwxr-xr-x   0        0        0     2225 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/plot_model.py
--rw-r--r--   0        0        0     6805 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/read.py
--rw-r--r--   0        0        0     1350 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/tests/test_mzi.py
--rw-r--r--   0        0        0     2220 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/tests/test_mzi_lattice.py
--rw-r--r--   0        0        0     1405 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/sax/tests/test_parameters.py
--rw-r--r--   0        0        0     1357 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/__init__.py
--rw-r--r--   0        0        0     1573 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/add_gc.py
--rw-r--r--   0        0        0     3383 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/circuit.py
--rw-r--r--   0        0        0      891 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/__init__.py
--rw-r--r--   0        0        0     1295 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/bend_circular.py
--rw-r--r--   0        0        0     1388 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/bend_euler.py
--rw-r--r--   0        0        0     2560 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler.py
--rw-r--r--   0        0        0     1046 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler_fdtd.py
--rw-r--r--   0        0        0     1848 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler_ring.py
--rw-r--r--   0        0        0     1329 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py
--rw-r--r--   0        0        0      589 2023-05-17 21:21:27.808474 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py
--rw-r--r--   0        0        0      913 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/gc.py
--rw-r--r--   0        0        0     2032 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mmi1x2.py
--rw-r--r--   0        0        0     1910 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mmi2x2.py
--rw-r--r--   0        0        0     2618 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mzi.py
--rw-r--r--   0        0        0     1759 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mzi_siepic.py
--rw-r--r--   0        0        0      487 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mzi_thermal.py
--rw-r--r--   0        0        0     2597 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/ring_double.py
--rw-r--r--   0        0        0     1665 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/ring_double_siepic.py
--rw-r--r--   0        0        0     1782 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/ring_single.py
--rw-r--r--   0        0        0     1416 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/ring_single_siepic.py
--rw-r--r--   0        0        0     1099 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/straight.py
--rw-r--r--   0        0        0      800 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/get_transmission.py
--rw-r--r--   0        0        0     2516 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/model_from_gdsfactory.py
--rw-r--r--   0        0        0     3841 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/model_from_sparameters.py
--rw-r--r--   0        0        0     2438 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/plot_circuit.py
--rw-r--r--   0        0        0     1798 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py
--rw-r--r--   0        0        0     2773 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/plot_model.py
--rw-r--r--   0        0        0     1261 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_circuit.py
--rw-r--r--   0        0        0       90 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_circuit/test_circuit_transmission.yml
--rw-r--r--   0        0        0     1109 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components.py
--rw-r--r--   0        0        0       66 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_circuits_mzi_.yml
--rw-r--r--   0        0        0       69 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_double_.yml
--rw-r--r--   0        0        0       69 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_single_.yml
--rw-r--r--   0        0        0       92 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_circular_.yml
--rw-r--r--   0        0        0       92 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_euler_.yml
--rw-r--r--   0        0        0      412 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_.yml
--rw-r--r--   0        0        0      412 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_ring_.yml
--rw-r--r--   0        0        0      114 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_gc1550te_.yml
--rw-r--r--   0        0        0      256 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi1x2_.yml
--rw-r--r--   0        0        0      460 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi2x2_.yml
--rw-r--r--   0        0        0      104 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components/test_elements_straight_.yml
--rw-r--r--   0        0        0      166 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/simphony/types.py
--rw-r--r--   0        0        0      471 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/sipann/__init__.py
--rw-r--r--   0        0        0     1376 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/sipann/bend_circular.py
--rw-r--r--   0        0        0     1465 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/sipann/bend_euler.py
--rw-r--r--   0        0        0     2508 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/sipann/coupler.py
--rw-r--r--   0        0        0     1892 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/sipann/coupler_ring.py
--rw-r--r--   0        0        0      736 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/sipann/straight.py
--rw-r--r--   0        0        0      100 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/thermal/__init__.py
--rw-r--r--   0        0        0     7789 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/simulation/thermal/heater.py
--rw-r--r--   0        0        0     1744 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/snap.py
--rw-r--r--   0        0        0     4245 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/symbols.py
--rw-r--r--   0        0        0      524 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/technology/__init__.py
--rw-r--r--   0        0        0     7607 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/technology/klayout_tech.py
--rw-r--r--   0        0        0     1078 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/technology/layer_map.py
--rw-r--r--   0        0        0    16139 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/technology/layer_stack.py
--rw-r--r--   0        0        0    42133 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/technology/layer_views.py
--rw-r--r--   0        0        0     1984 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/technology/simulation_settings.py
--rw-r--r--   0        0        0     1635 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/types.py
--rw-r--r--   0        0        0    10008 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/typings.py
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/utils/__init__.py
--rw-r--r--   0        0        0     1342 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/utils/async_utils.py
--rw-r--r--   0        0        0      376 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/utils/color_utils.py
--rw-r--r--   0        0        0      558 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/utils/file_utils.py
--rw-r--r--   0        0        0      185 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/utils/function_utils.py
--rw-r--r--   0        0        0      684 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/utils/xml_utils.py
--rw-r--r--   0        0        0     1453 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/utils/yaml_utils.py
--rw-r--r--   0        0        0     4865 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/watch.py
--rw-r--r--   0        0        0        0 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/widgets/__init__.py
--rw-r--r--   0        0        0     7969 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/widgets/layout_viewer.py
--rw-r--r--   0        0        0     7480 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/gdsfactory/write_cells.py
--rw-r--r--   0        0        0     5545 2023-05-17 21:21:27.812475 gdsfactory-6.94.1/pyproject.toml
--rw-r--r--   0        0        0    18772 1970-01-01 00:00:00.000000 gdsfactory-6.94.1/PKG-INFO
+-rw-r--r--   0        0        0     1072 2023-05-18 23:12:36.028450 gdsfactory-6.95.0/LICENSE
+-rw-r--r--   0        0        0    14319 2023-05-18 23:12:36.028450 gdsfactory-6.95.0/README.md
+-rw-r--r--   0        0        0     3566 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/__init__.py
+-rw-r--r--   0        0        0     2104 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_keepout.py
+-rw-r--r--   0        0        0    12629 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_labels.py
+-rw-r--r--   0        0        0     3711 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_loopback.py
+-rw-r--r--   0        0        0     5054 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_padding.py
+-rw-r--r--   0        0        0    15639 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_pins.py
+-rw-r--r--   0        0        0    14700 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_ports.py
+-rw-r--r--   0        0        0     2884 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_tapers.py
+-rw-r--r--   0        0        0     2257 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_tapers_cross_section.py
+-rw-r--r--   0        0        0     1831 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/add_termination.py
+-rw-r--r--   0        0        0     1856 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/asserts.py
+-rw-r--r--   0        0        0    12272 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/cell.py
+-rw-r--r--   0        0        0    16040 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/circuitviz.py
+-rw-r--r--   0        0        0     5718 2023-05-18 23:12:36.036450 gdsfactory-6.95.0/gdsfactory/cli.py
+-rw-r--r--   0        0        0   102023 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/component.py
+-rw-r--r--   0        0        0    23424 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/component_layout.py
+-rw-r--r--   0        0        0    29879 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/component_reference.py
+-rw-r--r--   0        0        0     1205 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/C.py
+-rw-r--r--   0        0        0     1144 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/L.py
+-rw-r--r--   0        0        0    20964 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/__init__.py
+-rw-r--r--   0        0        0     2621 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/add_fiducials.py
+-rw-r--r--   0        0        0    14087 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/add_grating_couplers.py
+-rw-r--r--   0        0        0     2014 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/add_trenches.py
+-rw-r--r--   0        0        0     3207 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/align.py
+-rw-r--r--   0        0        0     2622 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/array_component.py
+-rw-r--r--   0        0        0     4705 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/array_with_fanout.py
+-rw-r--r--   0        0        0     4322 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/array_with_via.py
+-rw-r--r--   0        0        0     4042 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/awg.py
+-rw-r--r--   0        0        0     1269 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/bbox.py
+-rw-r--r--   0        0        0     2851 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/bend_circular.py
+-rw-r--r--   0        0        0     2649 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/bend_circular_heater.py
+-rw-r--r--   0        0        0     7903 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/bend_euler.py
+-rw-r--r--   0        0        0     2682 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/bend_port.py
+-rw-r--r--   0        0        0     3664 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/bend_s.py
+-rw-r--r--   0        0        0     5373 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/bezier.py
+-rw-r--r--   0        0        0     1605 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cavity.py
+-rw-r--r--   0        0        0     5766 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cdc.py
+-rw-r--r--   0        0        0     2929 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cdsem_all.py
+-rw-r--r--   0        0        0     1788 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cdsem_bend180.py
+-rw-r--r--   0        0        0     1631 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cdsem_coupler.py
+-rw-r--r--   0        0        0     1412 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cdsem_straight.py
+-rw-r--r--   0        0        0     1565 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cdsem_straight_density.py
+-rw-r--r--   0        0        0      793 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/circle.py
+-rw-r--r--   0        0        0     5722 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coh_rx_dual_pol.py
+-rw-r--r--   0        0        0     8922 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coh_rx_single_pol.py
+-rw-r--r--   0        0        0     5043 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coh_tx_dual_pol.py
+-rw-r--r--   0        0        0     6118 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coh_tx_single_pol.py
+-rw-r--r--   0        0        0     2548 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/compass.py
+-rw-r--r--   0        0        0     9876 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/component_lattice.py
+-rw-r--r--   0        0        0     7174 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/component_sequence.py
+-rw-r--r--   0        0        0      812 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/copy_layers.py
+-rw-r--r--   0        0        0     3460 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler.py
+-rw-r--r--   0        0        0     2113 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler90.py
+-rw-r--r--   0        0        0     1802 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler90bend.py
+-rw-r--r--   0        0        0     4666 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler_adiabatic.py
+-rw-r--r--   0        0        0     1909 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler_asymmetric.py
+-rw-r--r--   0        0        0     3970 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler_full.py
+-rw-r--r--   0        0        0     3414 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler_ring.py
+-rw-r--r--   0        0        0     1060 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler_straight.py
+-rw-r--r--   0        0        0     1164 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler_straight_asymmetric.py
+-rw-r--r--   0        0        0     2192 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/coupler_symmetric.py
+-rw-r--r--   0        0        0     1848 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cross.py
+-rw-r--r--   0        0        0    12873 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/crossing_waveguide.py
+-rw-r--r--   0        0        0      500 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
+-rw-r--r--   0        0        0     1014 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
+-rw-r--r--   0        0        0    19749 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
+-rw-r--r--   0        0        0    19751 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
+-rw-r--r--   0        0        0    19749 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
+-rw-r--r--   0        0        0    19751 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
+-rw-r--r--   0        0        0    19775 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
+-rw-r--r--   0        0        0     3143 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
+-rw-r--r--   0        0        0     5272 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cutback_2x2.py
+-rw-r--r--   0        0        0     6450 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cutback_bend.py
+-rw-r--r--   0        0        0     3765 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cutback_component.py
+-rw-r--r--   0        0        0     2721 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/cutback_splitter.py
+-rw-r--r--   0        0        0     2971 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/dbr.py
+-rw-r--r--   0        0        0     4288 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/dbr_tapered.py
+-rw-r--r--   0        0        0     2486 2023-05-18 23:12:36.040450 gdsfactory-6.95.0/gdsfactory/components/delay_snake.py
+-rw-r--r--   0        0        0     3177 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/delay_snake2.py
+-rw-r--r--   0        0        0     3245 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/delay_snake3.py
+-rw-r--r--   0        0        0     4319 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/delay_snake_sbend.py
+-rw-r--r--   0        0        0     1226 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/dicing_lane.py
+-rw-r--r--   0        0        0     3471 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/die.py
+-rw-r--r--   0        0        0     2975 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/die_bbox.py
+-rw-r--r--   0        0        0     2863 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/die_bbox_frame.py
+-rw-r--r--   0        0        0     8015 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/disk.py
+-rw-r--r--   0        0        0     4112 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/edge_coupler_array.py
+-rw-r--r--   0        0        0     1214 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ellipse.py
+-rw-r--r--   0        0        0     1800 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/extend_ports_list.py
+-rw-r--r--   0        0        0     7988 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/extension.py
+-rw-r--r--   0        0        0      981 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/fiber.py
+-rw-r--r--   0        0        0     1432 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/fiber_array.py
+-rw-r--r--   0        0        0      722 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/fiducial_squares.py
+-rw-r--r--   0        0        0     3290 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ge_detector_straight_si_contacts.py
+-rw-r--r--   0        0        0     1063 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_array.py
+-rw-r--r--   0        0        0     4682 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_dual_pol.py
+-rw-r--r--   0        0        0     7110 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_elliptical.py
+-rw-r--r--   0        0        0     7221 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
+-rw-r--r--   0        0        0     4960 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py
+-rw-r--r--   0        0        0     4592 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_elliptical_trenches.py
+-rw-r--r--   0        0        0     1773 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_functions.py
+-rw-r--r--   0        0        0     9058 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_loss.py
+-rw-r--r--   0        0        0     1786 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_loss_fiber_single.py
+-rw-r--r--   0        0        0     4142 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_rectangular.py
+-rw-r--r--   0        0        0     4685 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
+-rw-r--r--   0        0        0     3887 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
+-rw-r--r--   0        0        0     1578 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/grating_coupler_tree.py
+-rw-r--r--   0        0        0     8811 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/greek_cross.py
+-rw-r--r--   0        0        0     1019 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/hline.py
+-rw-r--r--   0        0        0     3687 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/interdigital_capacitor.py
+-rw-r--r--   0        0        0     1825 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/litho_calipers.py
+-rw-r--r--   0        0        0     1244 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/litho_ruler.py
+-rw-r--r--   0        0        0     1304 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/litho_steps.py
+-rw-r--r--   0        0        0      650 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/logo.py
+-rw-r--r--   0        0        0     1679 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/loop_mirror.py
+-rw-r--r--   0        0        0     3873 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mmi1x2.py
+-rw-r--r--   0        0        0     2814 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mmi1x2_with_sbend.py
+-rw-r--r--   0        0        0     3858 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mmi2x2.py
+-rw-r--r--   0        0        0     3299 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mmi2x2_with_sbend.py
+-rw-r--r--   0        0        0     4947 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mmi_90degree_hybrid.py
+-rw-r--r--   0        0        0     3265 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mode_converter.py
+-rw-r--r--   0        0        0     7501 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzi.py
+-rw-r--r--   0        0        0     2499 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzi_arm.py
+-rw-r--r--   0        0        0     5835 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzi_arms.py
+-rw-r--r--   0        0        0    12214 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzi_lattice.py
+-rw-r--r--   0        0        0     4025 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzi_pads_center.py
+-rw-r--r--   0        0        0     1064 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzi_phase_shifter.py
+-rw-r--r--   0        0        0     6342 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzit.py
+-rw-r--r--   0        0        0     3502 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzit_lattice.py
+-rw-r--r--   0        0        0     6047 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/mzm.py
+-rw-r--r--   0        0        0     3518 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/nxn.py
+-rw-r--r--   0        0        0     1940 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/optimal_90deg.py
+-rw-r--r--   0        0        0     3876 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/optimal_hairpin.py
+-rw-r--r--   0        0        0     6131 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/optimal_step.py
+-rw-r--r--   0        0        0     6327 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/pack_doe.py
+-rw-r--r--   0        0        0     3860 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/pad.py
+-rw-r--r--   0        0        0     1890 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/pad_gsg.py
+-rw-r--r--   0        0        0     1157 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/pads_shorted.py
+-rw-r--r--   0        0        0     3833 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/polarization_splitter_rotator.py
+-rw-r--r--   0        0        0     1147 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ramp.py
+-rw-r--r--   0        0        0     1508 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/rectangle.py
+-rw-r--r--   0        0        0     2972 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/rectangle_with_slits.py
+-rw-r--r--   0        0        0     1508 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/regular_polygon.py
+-rw-r--r--   0        0        0     3302 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/resistance_meander.py
+-rw-r--r--   0        0        0     2642 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/resistance_sheet.py
+-rw-r--r--   0        0        0     1273 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring.py
+-rw-r--r--   0        0        0     4143 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_crow.py
+-rw-r--r--   0        0        0     3272 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_crow_couplers.py
+-rw-r--r--   0        0        0     2267 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_double.py
+-rw-r--r--   0        0        0     2846 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_double_bend_coupler.py
+-rw-r--r--   0        0        0     3846 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_double_heater.py
+-rw-r--r--   0        0        0     7757 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_double_pn.py
+-rw-r--r--   0        0        0    12137 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_section_based.py
+-rw-r--r--   0        0        0     2740 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_single.py
+-rw-r--r--   0        0        0     1968 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_single_array.py
+-rw-r--r--   0        0        0     6868 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_single_bend_coupler.py
+-rw-r--r--   0        0        0     2714 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_single_dut.py
+-rw-r--r--   0        0        0     4018 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_single_heater.py
+-rw-r--r--   0        0        0     5267 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/ring_single_pn.py
+-rw-r--r--   0        0        0     2282 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/seal_ring.py
+-rw-r--r--   0        0        0     3758 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/snspd.py
+-rw-r--r--   0        0        0     2059 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/spiral_double.py
+-rw-r--r--   0        0        0     5871 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/spiral_external_io.py
+-rw-r--r--   0        0        0    16692 2023-05-18 23:12:36.044450 gdsfactory-6.95.0/gdsfactory/components/spiral_heater.py
+-rw-r--r--   0        0        0     9181 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/spiral_inner_io.py
+-rw-r--r--   0        0        0     1733 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/splitter_chain.py
+-rw-r--r--   0        0        0     5327 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/splitter_tree.py
+-rw-r--r--   0        0        0     2526 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight.py
+-rw-r--r--   0        0        0     1033 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_array.py
+-rw-r--r--   0        0        0     7914 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_heater_doped_rib.py
+-rw-r--r--   0        0        0     1922 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_heater_doped_strip.py
+-rw-r--r--   0        0        0     7891 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_heater_meander.py
+-rw-r--r--   0        0        0     8090 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_heater_meander_doped.py
+-rw-r--r--   0        0        0     5686 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_heater_metal.py
+-rw-r--r--   0        0        0     2809 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_pin.py
+-rw-r--r--   0        0        0     3974 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_pin_slot.py
+-rw-r--r--   0        0        0      655 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/straight_rib.py
+-rw-r--r--   0        0        0      820 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/switch_tree.py
+-rw-r--r--   0        0        0     7730 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/taper.py
+-rw-r--r--   0        0        0     3530 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/taper_adiabatic.py
+-rw-r--r--   0        0        0     2457 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/taper_cross_section.py
+-rw-r--r--   0        0        0     2363 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/taper_from_csv.py
+-rw-r--r--   0        0        0     1215 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/taper_parabolic.py
+-rw-r--r--   0        0        0     1635 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/terminator.py
+-rw-r--r--   0        0        0     2913 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/text.py
+-rw-r--r--   0        0        0     3821 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/text_freetype.py
+-rw-r--r--   0        0        0     3160 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/text_rectangular.py
+-rw-r--r--   0        0        0     3943 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/text_rectangular_font.py
+-rw-r--r--   0        0        0     2536 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/triangles.py
+-rw-r--r--   0        0        0      715 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/verniers.py
+-rw-r--r--   0        0        0     2468 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/version_stamp.py
+-rw-r--r--   0        0        0     2436 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/via.py
+-rw-r--r--   0        0        0     3060 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/via_corner.py
+-rw-r--r--   0        0        0     5342 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/via_cutback.py
+-rw-r--r--   0        0        0    15612 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/via_stack.py
+-rw-r--r--   0        0        0     4430 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/via_stack_slot.py
+-rw-r--r--   0        0        0     4944 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/via_stack_with_offset.py
+-rw-r--r--   0        0        0     1088 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/wafer.py
+-rw-r--r--   0        0        0     2542 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/wire.py
+-rw-r--r--   0        0        0      978 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/components/wire_sbend.py
+-rw-r--r--   0        0        0     8145 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/config.py
+-rw-r--r--   0        0        0      481 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/conftest.py
+-rw-r--r--   0        0        0    38409 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/constants.py
+-rw-r--r--   0        0        0     1476 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/containers.py
+-rw-r--r--   0        0        0    82893 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/cross_section.py
+-rw-r--r--   0        0        0     2982 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/decorators.py
+-rw-r--r--   0        0        0     7312 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/difftest.py
+-rw-r--r--   0        0        0     1020 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/events.py
+-rw-r--r--   0        0        0      204 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/export/__init__.py
+-rw-r--r--   0        0        0     3353 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/export/to_3d.py
+-rw-r--r--   0        0        0     1940 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/export/to_np.py
+-rw-r--r--   0        0        0     3058 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/export/to_stl.py
+-rw-r--r--   0        0        0     7445 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/export/write_gerbers.py
+-rw-r--r--   0        0        0     2976 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/filestorage.py
+-rw-r--r--   0        0        0    11890 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/fill.py
+-rw-r--r--   0        0        0     7799 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/font.py
+-rw-r--r--   0        0        0     8073 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/functions.py
+-rw-r--r--   0        0        0       20 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/gdsdiff/.gitattributes
+-rw-r--r--   0        0        0       83 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/gdsdiff/.gitconfig
+-rw-r--r--   0        0        0       72 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/gdsdiff/__init__.py
+-rw-r--r--   0        0        0     1069 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/gdsdiff/gds_diff_git.py
+-rw-r--r--   0        0        0     2935 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/gdsdiff/gdsdiff.py
+-rw-r--r--   0        0        0      708 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/gdsdiff/install.py
+-rw-r--r--   0        0        0      271 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/gdsdiff/sample.py
+-rw-r--r--   0        0        0     1059 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/gdsdiff/test_xor.py
+-rw-r--r--   0        0        0     1100 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/README.md
+-rw-r--r--   0        0        0     1722 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/__init__.py
+-rw-r--r--   0        0        0      169 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/generic_tech.sh
+-rw-r--r--   0        0        0     8142 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/get_klayout_pyxs.py
+-rw-r--r--   0        0        0      161 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/README.md
+-rw-r--r--   0        0        0      104 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/drc/Makefile
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/drc/__init__.py
+-rw-r--r--   0        0        0     2842 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/drc/errors.py
+-rw-r--r--   0        0        0     6193 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/grain.xml
+-rw-r--r--   0        0        0    10140 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/icon_128x128.png
+-rw-r--r--   0        0        0     4248 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/icon_64x64.png
+-rw-r--r--   0        0        0       27 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/.gitignore
+-rw-r--r--   0        0        0      494 2023-05-18 23:12:36.048451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/Makefile
+-rw-r--r--   0        0        0     4062 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/README.md
+-rw-r--r--   0        0        0     2419 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
+-rw-r--r--   0        0        0     9696 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
+-rw-r--r--   0        0        0    12379 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
+-rw-r--r--   0        0        0     7235 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
+-rw-r--r--   0        0        0     3446 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
+-rw-r--r--   0        0        0      479 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
+-rw-r--r--   0        0        0      582 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
+-rw-r--r--   0        0        0      108 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
+-rw-r--r--   0        0        0      186 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
+-rw-r--r--   0        0        0      398 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
+-rw-r--r--   0        0        0      574 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
+-rw-r--r--   0        0        0     6034 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
+-rw-r--r--   0        0        0    10704 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
+-rw-r--r--   0        0        0      477 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
+-rw-r--r--   0        0        0     4337 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
+-rw-r--r--   0        0        0      926 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
+-rw-r--r--   0        0        0    10945 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
+-rw-r--r--   0        0        0      710 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
+-rw-r--r--   0        0        0      538 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/python/__init__.py
+-rw-r--r--   0        0        0      114 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
+-rw-r--r--   0        0        0     4311 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
+-rw-r--r--   0        0        0      269 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/Makefile
+-rw-r--r--   0        0        0     1854 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25
+-rw-r--r--   0        0        0     1519 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack
+-rw-r--r--   0        0        0    41073 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
+-rw-r--r--   0        0        0    40616 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/layers.lyp
+-rw-r--r--   0        0        0     5977 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/tech.lyt
+-rw-r--r--   0        0        0     4258 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
+-rw-r--r--   0        0        0     4537 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
+-rw-r--r--   0        0        0     4690 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
+-rw-r--r--   0        0        0     5508 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
+-rw-r--r--   0        0        0     1883 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/layer_map.py
+-rw-r--r--   0        0        0     6511 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/layer_stack.py
+-rw-r--r--   0        0        0    10780 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/layer_views.yaml
+-rw-r--r--   0        0        0      158 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/generic_tech/simulation_settings.py
+-rw-r--r--   0        0        0     1431 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/__init__.py
+-rw-r--r--   0        0        0     4917 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/boolean.py
+-rw-r--r--   0        0        0     3814 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/boolean_klayout.py
+-rw-r--r--   0        0        0     1904 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/boolean_polygons.py
+-rw-r--r--   0        0        0      598 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/check_duplicated_cells.py
+-rw-r--r--   0        0        0     2719 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/check_exclusion.py
+-rw-r--r--   0        0        0     2829 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/check_inclusion.py
+-rw-r--r--   0        0        0     3566 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/check_space.py
+-rw-r--r--   0        0        0     1904 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/check_width.py
+-rw-r--r--   0        0        0     5015 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/fill_klayout.py
+-rw-r--r--   0        0        0     7084 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/fill_tiled.py
+-rw-r--r--   0        0        0     1697 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/fillet.py
+-rw-r--r--   0        0        0     6664 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/functions.py
+-rw-r--r--   0        0        0     2167 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/invert.py
+-rw-r--r--   0        0        0     3685 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/layer_priority.py
+-rw-r--r--   0        0        0     3054 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/manhattanize.py
+-rw-r--r--   0        0        0     4192 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/maskprep.py
+-rw-r--r--   0        0        0     4812 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/maskprep_flat.py
+-rw-r--r--   0        0        0     3250 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/offset.py
+-rw-r--r--   0        0        0     3842 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/outline.py
+-rw-r--r--   0        0        0     2510 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/trim.py
+-rw-r--r--   0        0        0     2948 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/union.py
+-rw-r--r--   0        0        0     1898 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/write_connectivity.py
+-rw-r--r--   0        0        0    10532 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/write_drc.py
+-rw-r--r--   0        0        0     1783 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/geometry/xor_diff.py
+-rw-r--r--   0        0        0     1158 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/get_factories.py
+-rw-r--r--   0        0        0    23569 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/get_netlist.py
+-rw-r--r--   0        0        0    14446 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/get_netlist_flat.py
+-rw-r--r--   0        0        0      682 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/get_netlist_klayout.py
+-rw-r--r--   0        0        0     9745 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/grid.py
+-rw-r--r--   0        0        0     4393 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/install.py
+-rw-r--r--   0        0        0     1970 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/klive.py
+-rw-r--r--   0        0        0      585 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/labels/__init__.py
+-rw-r--r--   0        0        0     3563 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/labels/add_label_yaml.py
+-rw-r--r--   0        0        0     3847 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/labels/ehva.py
+-rw-r--r--   0        0        0     3810 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/labels/merge_test_metadata.py
+-rw-r--r--   0        0        0     4668 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/labels/siepic.py
+-rw-r--r--   0        0        0     4847 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/labels/write_labels.py
+-rw-r--r--   0        0        0     1149 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/materials.py
+-rw-r--r--   0        0        0     5247 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/name.py
+-rw-r--r--   0        0        0    11586 2023-05-18 23:12:36.052451 gdsfactory-6.95.0/gdsfactory/pack.py
+-rw-r--r--   0        0        0    50930 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/path.py
+-rw-r--r--   0        0        0    27295 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/pdk.py
+-rw-r--r--   0        0        0     6220 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/picmodel.py
+-rw-r--r--   0        0        0     5068 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/pixelate.py
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/dagster/__init__.py
+-rw-r--r--   0        0        0      976 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/dagster/workflow.py
+-rw-r--r--   0        0        0      566 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/database/README.md
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/database/__init__.py
+-rw-r--r--   0        0        0     6216 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/database/db_upload.py
+-rw-r--r--   0        0        0    16143 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/database/models.py
+-rw-r--r--   0        0        0       32 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/web/Makefile
+-rw-r--r--   0        0        0       23 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/web/__init__.py
+-rw-r--r--   0        0        0     4080 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/web/main.py
+-rwxr-xr-x   0        0        0     7511 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/web/server.py
+-rwxr-xr-x   0        0        0      594 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/web/server_jupyter.py
+-rw-r--r--   0        0        0     1299 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/plugins/web/static/client.css
+-rw-r--r--   0        0        0    32235 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/port.py
+-rw-r--r--   0        0        0    37817 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/quickplotter.py
+-rw-r--r--   0        0        0      696 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/__init__.py
+-rw-r--r--   0        0        0     1639 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/from_dphox.py
+-rw-r--r--   0        0        0     1285 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/from_gdspaths.py
+-rw-r--r--   0        0        0     1953 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/from_np.py
+-rw-r--r--   0        0        0     2813 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/from_phidl.py
+-rw-r--r--   0        0        0    38082 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/from_yaml.py
+-rw-r--r--   0        0        0     5897 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/from_yaml_template.py
+-rw-r--r--   0        0        0     5688 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/import_gds.py
+-rw-r--r--   0        0        0     3407 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/read/labels.py
+-rw-r--r--   0        0        0     3769 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/__init__.py
+-rw-r--r--   0        0        0     2920 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/add_electrical_pads_shortest.py
+-rw-r--r--   0        0        0     3015 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/add_electrical_pads_top.py
+-rw-r--r--   0        0        0     3035 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/add_electrical_pads_top_dc.py
+-rw-r--r--   0        0        0     8715 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/add_fiber_array.py
+-rw-r--r--   0        0        0    10624 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/add_fiber_single.py
+-rw-r--r--   0        0        0     8967 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/add_pads.py
+-rw-r--r--   0        0        0    38948 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/all_angle.py
+-rw-r--r--   0        0        0     3916 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/auto_taper.py
+-rw-r--r--   0        0        0      982 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/factories.py
+-rw-r--r--   0        0        0     4415 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/fanout.py
+-rw-r--r--   0        0        0     2800 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/fanout2x2.py
+-rw-r--r--   0        0        0    24342 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_bundle.py
+-rw-r--r--   0        0        0     8652 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_bundle_corner.py
+-rw-r--r--   0        0        0     6910 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_bundle_from_steps.py
+-rw-r--r--   0        0        0    12949 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_bundle_from_waypoints.py
+-rw-r--r--   0        0        0     5284 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_bundle_path_length_match.py
+-rw-r--r--   0        0        0     1937 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_bundle_sbend.py
+-rw-r--r--   0        0        0    17064 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_bundle_u.py
+-rw-r--r--   0        0        0     1510 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_input_labels.py
+-rw-r--r--   0        0        0     9233 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_route.py
+-rw-r--r--   0        0        0    10872 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_route_astar.py
+-rw-r--r--   0        0        0     6119 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_route_from_steps.py
+-rw-r--r--   0        0        0     2766 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_route_sbend.py
+-rw-r--r--   0        0        0     3311 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_routes_bend180.py
+-rw-r--r--   0        0        0     1854 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/get_routes_straight.py
+-rw-r--r--   0        0        0    34394 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/manhattan.py
+-rw-r--r--   0        0        0    10081 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/path_length_matching.py
+-rw-r--r--   0        0        0    22568 2023-05-18 23:12:36.056451 gdsfactory-6.95.0/gdsfactory/routing/route_fiber_array.py
+-rw-r--r--   0        0        0     8679 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/routing/route_fiber_single.py
+-rw-r--r--   0        0        0    18132 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/routing/route_ports_to_side.py
+-rw-r--r--   0        0        0     4379 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/routing/route_quad.py
+-rw-r--r--   0        0        0    14370 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/routing/route_sharp.py
+-rw-r--r--   0        0        0    10167 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/routing/route_south.py
+-rw-r--r--   0        0        0     5072 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/routing/sort_ports.py
+-rw-r--r--   0        0        0     2477 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/routing/utils.py
+-rw-r--r--   0        0        0     2897 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/01_component_pcell.py
+-rw-r--r--   0        0        0      646 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
+-rw-r--r--   0        0        0     1109 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/01_component_pcell_with_pins.py
+-rw-r--r--   0        0        0      664 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
+-rw-r--r--   0        0        0      347 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/02_component_autoname.py
+-rw-r--r--   0        0        0      887 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/03_move.py
+-rw-r--r--   0        0        0      881 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/04_connect.py
+-rw-r--r--   0        0        0      710 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/05_remove_layers.py
+-rw-r--r--   0        0        0      931 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/06_remapping_layers.py
+-rw-r--r--   0        0        0     1082 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/07_flattening_device.py
+-rw-r--r--   0        0        0      475 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/08_group.py
+-rw-r--r--   0        0        0     1631 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/11_component_layout.py
+-rw-r--r--   0        0        0     2245 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/12_component_refs.py
+-rw-r--r--   0        0        0      955 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/13_component_netlist.py
+-rw-r--r--   0        0        0     2592 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/14_component_connectivity.py
+-rw-r--r--   0        0        0     1636 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/15_component_sequence1.py
+-rw-r--r--   0        0        0     1680 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/16_component_sequence2.py
+-rw-r--r--   0        0        0      965 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/17_ports.py
+-rw-r--r--   0        0        0      489 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/18_port_markers.py
+-rw-r--r--   0        0        0      361 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/19_references.py
+-rw-r--r--   0        0        0      533 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/20_components.py
+-rw-r--r--   0        0        0      507 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/21_add_fiber_array.py
+-rw-r--r--   0        0        0      493 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/22_add_fiber_single.py
+-rw-r--r--   0        0        0      569 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/22_add_pads.py
+-rw-r--r--   0        0        0      848 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/23_reticle.py
+-rw-r--r--   0        0        0     1588 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/23_reticle_passives.py
+-rw-r--r--   0        0        0      457 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/24_doe.py
+-rw-r--r--   0        0        0      687 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/24_doe_2.py
+-rw-r--r--   0        0        0      692 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/24_doe_3.py
+-rw-r--r--   0        0        0      306 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/25_slot_cross_section.py
+-rw-r--r--   0        0        0     1363 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/30_lidar.py
+-rw-r--r--   0        0        0     1412 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/30_lidar_pcell.py
+-rw-r--r--   0        0        0     1943 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/30_lidar_with_pads.py
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/__init__.py
+-rw-r--r--   0        0        0     1307 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing.py
+-rw-r--r--   0        0        0      558 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
+-rw-r--r--   0        0        0     6062 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
+-rw-r--r--   0        0        0      444 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
+-rw-r--r--   0        0        0      463 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
+-rw-r--r--   0        0        0     1552 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
+-rw-r--r--   0        0        0     1315 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
+-rw-r--r--   0        0        0      602 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
+-rw-r--r--   0        0        0     3317 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
+-rw-r--r--   0        0        0     1484 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
+-rw-r--r--   0        0        0     3045 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
+-rw-r--r--   0        0        0     3782 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
+-rw-r--r--   0        0        0     1988 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/big_device.py
+-rw-r--r--   0        0        0       19 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/Makefile
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/__init__.py
+-rw-r--r--   0        0        0     1129 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/benchmark/fill_demo.py
+-rw-r--r--   0        0        0      343 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
+-rw-r--r--   0        0        0      637 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/circuits/mask.pic.yml
+-rw-r--r--   0        0        0      622 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
+-rw-r--r--   0        0        0      569 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
+-rw-r--r--   0        0        0      453 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/circuits/pads.pic.yml
+-rw-r--r--   0        0        0      287 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/circuits/rectangles.pic.yml
+-rw-r--r--   0        0        0     2260 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/drc_errors.py
+-rw-r--r--   0        0        0     1014 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/drc_write.py
+-rw-r--r--   0        0        0     4530 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/layers.py
+-rw-r--r--   0        0        0      158 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/layers_sky130.py
+-rw-r--r--   0        0        0      364 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/layers_xsection.py
+-rw-r--r--   0        0        0     1062 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/lvs.py
+-rw-r--r--   0        0        0      574 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/demo/pcell.py
+-rw-r--r--   0        0        0     4174 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/netlists/mzi.yml
+-rw-r--r--   0        0        0     5840 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/netlists/mzi_full.yml
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/__init__.py
+-rw-r--r--   0        0        0     4235 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/fab_c.py
+-rw-r--r--   0        0        0      475 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/fab_d/__init__.py
+-rw-r--r--   0        0        0     1880 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py
+-rw-r--r--   0        0        0     1715 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c.py
+-rw-r--r--   0        0        0       50 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
+-rw-r--r--   0        0        0       93 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
+-rw-r--r--   0        0        0       85 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
+-rw-r--r--   0        0        0      139 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
+-rw-r--r--   0        0        0       90 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
+-rw-r--r--   0        0        0      126 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
+-rw-r--r--   0        0        0       48 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
+-rw-r--r--   0        0        0     1023 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
+-rw-r--r--   0        0        0     2100 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
+-rw-r--r--   0        0        0     1839 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
+-rw-r--r--   0        0        0     1283 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
+-rw-r--r--   0        0        0     1592 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
+-rw-r--r--   0        0        0     1061 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
+-rw-r--r--   0        0        0     1054 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
+-rw-r--r--   0        0        0     1577 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
+-rw-r--r--   0        0        0     4313 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
+-rw-r--r--   0        0        0     3625 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
+-rw-r--r--   0        0        0     3603 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
+-rw-r--r--   0        0        0     4271 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
+-rw-r--r--   0        0        0      840 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
+-rw-r--r--   0        0        0     2171 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
+-rw-r--r--   0        0        0      316 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/schematic.py
+-rw-r--r--   0        0        0    17862 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/schematic_editor.py
+-rw-r--r--   0        0        0     4194 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/serialization.py
+-rw-r--r--   0        0        0     1612 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/show.py
+-rw-r--r--   0        0        0      724 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/simulation/__init__.py
+-rw-r--r--   0        0        0     4369 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/simulation/add_simulation_markers.py
+-rw-r--r--   0        0        0     2476 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/simulation/convert_sparameters.py
+-rw-r--r--   0        0        0      547 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/simulation/devsim/__init__.py
+-rw-r--r--   0        0        0     2559 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/simulation/devsim/doping.py
+-rw-r--r--   0        0        0    11977 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/simulation/devsim/get_simulation.py
+-rw-r--r--   0        0        0    23687 2023-05-18 23:12:36.060451 gdsfactory-6.95.0/gdsfactory/simulation/devsim/get_simulation_xsection.py
+-rw-r--r--   0        0        0    19756 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/devsim/get_solver.py
+-rw-r--r--   0        0        0     1644 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/devsim/test_devsim.py
+-rw-r--r--   0        0        0      189 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/disable_print.py
+-rw-r--r--   0        0        0       79 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/eme/__init__.py
+-rw-r--r--   0        0        0    14784 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/eme/meow_eme.py
+-rw-r--r--   0        0        0     1787 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/eme/test_meow_simulation.py
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/fem/__init__.py
+-rw-r--r--   0        0        0     8968 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/fem/mode_solver.py
+-rw-r--r--   0        0        0     2221 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/fem/test_mode_solver.py
+-rw-r--r--   0        0        0     3455 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/get_effective_indices.py
+-rw-r--r--   0        0        0     3109 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/get_modes_path.py
+-rw-r--r--   0        0        0     3888 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/get_sparameters_path.py
+-rw-r--r--   0        0        0     2003 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/__init__.py
+-rw-r--r--   0        0        0     3194 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_material.py
+-rw-r--r--   0        0        0     6137 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_meep_geometry.py
+-rw-r--r--   0        0        0     6054 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_port_eigenmode.py
+-rw-r--r--   0        0        0    11014 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_simulation.py
+-rw-r--r--   0        0        0    15915 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py
+-rw-r--r--   0        0        0    18182 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py
+-rw-r--r--   0        0        0    12312 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py
+-rw-r--r--   0        0        0    11914 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_eigenmode.py
+-rw-r--r--   0        0        0      832 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_materials.py
+-rw-r--r--   0        0        0    10128 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv
+-rw-r--r--   0        0        0    10128 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv
+-rw-r--r--   0        0        0     6642 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py
+-rw-r--r--   0        0        0    10128 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv
+-rw-r--r--   0        0        0    10128 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv
+-rw-r--r--   0        0        0    10093 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv
+-rw-r--r--   0        0        0    10085 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv
+-rw-r--r--   0        0        0    10085 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv
+-rw-r--r--   0        0        0    34701 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv
+-rw-r--r--   0        0        0    10123 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv
+-rw-r--r--   0        0        0     9966 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv
+-rw-r--r--   0        0        0     9966 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv
+-rw-r--r--   0        0        0    10085 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv
+-rw-r--r--   0        0        0    10129 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv
+-rw-r--r--   0        0        0    14053 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/write_sparameters_grating.py
+-rw-r--r--   0        0        0    21281 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/write_sparameters_meep.py
+-rw-r--r--   0        0        0     8143 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py
+-rw-r--r--   0        0        0     9577 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py
+-rw-r--r--   0        0        0     1246 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/__init__.py
+-rw-r--r--   0        0        0     6653 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/break_geometry.py
+-rw-r--r--   0        0        0    11250 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/mesh.py
+-rw-r--r--   0        0        0    11824 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/meshtracker.py
+-rw-r--r--   0        0        0     7752 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/parse_component.py
+-rw-r--r--   0        0        0     3644 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/parse_gds.py
+-rw-r--r--   0        0        0     3605 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/parse_layerstack.py
+-rw-r--r--   0        0        0     2990 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/refine.py
+-rw-r--r--   0        0        0    10851 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/scratch/mesh3D.py
+-rw-r--r--   0        0        0     2513 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/tests/test_meshing.py
+-rw-r--r--   0        0        0    14168 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/uz_xsection_mesh.py
+-rw-r--r--   0        0        0     7441 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/xy_xsection_mesh.py
+-rw-r--r--   0        0        0    16334 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gmsh/xyz_mesh.py
+-rw-r--r--   0        0        0     1624 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/__init__.py
+-rw-r--r--   0        0        0     4368 2023-05-18 23:12:36.064451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/get_results.py
+-rw-r--r--   0        0        0    20009 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/get_simulation.py
+-rw-r--r--   0        0        0    21071 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py
+-rw-r--r--   0        0        0     2821 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/materials.py
+-rw-r--r--   0        0        0    27469 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/modes.py
+-rw-r--r--   0        0        0     8941 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/sim_run.yaml
+-rw-r--r--   0        0        0     8114 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml
+-rw-r--r--   0        0        0     8114 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml
+-rw-r--r--   0        0        0      744 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_modes.py
+-rw-r--r--   0        0        0      262 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_modes/test_sweep_width.csv
+-rw-r--r--   0        0        0      879 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_results.py
+-rw-r--r--   0        0        0     1505 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_simulation.py
+-rw-r--r--   0        0        0     1270 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py
+-rw-r--r--   0        0        0     9297 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv
+-rw-r--r--   0        0        0     1732 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py
+-rw-r--r--   0        0        0     1224 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/utils.py
+-rw-r--r--   0        0        0    10515 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/write_sparameters.py
+-rw-r--r--   0        0        0     7695 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py
+-rw-r--r--   0        0        0      588 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/lumerical/__init__.py
+-rw-r--r--   0        0        0    16091 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/lumerical/interconnect.py
+-rw-r--r--   0        0        0     4286 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/lumerical/read.py
+-rw-r--r--   0        0        0     3569 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/lumerical/settings.py
+-rw-r--r--   0        0        0     2368 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/lumerical/test_read_sparameters.py
+-rw-r--r--   0        0        0    19865 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py
+-rw-r--r--   0        0        0     1504 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py
+-rw-r--r--   0        0        0      932 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/__init__.py
+-rw-r--r--   0        0        0     1618 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/coupler.py
+-rw-r--r--   0        0        0     4166 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/find_coupling_vs_gap.py
+-rw-r--r--   0        0        0     2773 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/find_mode_dispersion.py
+-rw-r--r--   0        0        0     8924 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/find_modes.py
+-rwxr-xr-x   0        0        0     7032 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/find_modes_cross_section.py
+-rw-r--r--   0        0        0     4458 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py
+-rw-r--r--   0        0        0     2728 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/find_neff_vs_width.py
+-rw-r--r--   0        0        0     7148 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/get_mode_solver_coupler.py
+-rwxr-xr-x   0        0        0     4462 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/get_mode_solver_cross_section.py
+-rw-r--r--   0        0        0     5411 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/get_mode_solver_rib.py
+-rw-r--r--   0        0        0     1110 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv
+-rw-r--r--   0        0        0     1102 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv
+-rw-r--r--   0        0        0     1110 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv
+-rw-r--r--   0        0        0     8023 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/neff_convergence_test.py
+-rw-r--r--   0        0        0      267 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/neff_vs_width.csv
+-rw-r--r--   0        0        0     2469 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/overlap.py
+-rw-r--r--   0        0        0      418 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_dw_dh.py
+-rw-r--r--   0        0        0       83 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh.csv
+-rw-r--r--   0        0        0      548 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv
+-rw-r--r--   0        0        0     1137 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_find_modes.py
+-rw-r--r--   0        0        0      649 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py
+-rw-r--r--   0        0        0      354 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_neff_vs_width.py
+-rw-r--r--   0        0        0      113 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_neff_vs_width/test_neff_vs_width.csv
+-rw-r--r--   0        0        0    15492 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/types.py
+-rw-r--r--   0        0        0     1169 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/modes/waveguide.py
+-rw-r--r--   0        0        0     2013 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/__init__.py
+-rw-r--r--   0        0        0      597 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/coupler.py
+-rw-r--r--   0        0        0      377 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/fsr.py
+-rw-r--r--   0        0        0      418 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/heater.py
+-rw-r--r--   0        0        0     3069 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/mzi.py
+-rw-r--r--   0        0        0     2616 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/ring.py
+-rw-r--r--   0        0        0     7332 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/plot.py
+-rw-r--r--   0        0        0     2480 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/plot_csv.py
+-rw-r--r--   0        0        0      703 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/port_symmetries.py
+-rw-r--r--   0        0        0     4685 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/process/diffusion.py
+-rw-r--r--   0        0        0     5317 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/process/implant_tables.py
+-rw-r--r--   0        0        0     6800 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/process/pysrim.py
+-rw-r--r--   0        0        0     2182 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/process/silicon.py
+-rw-r--r--   0        0        0     1861 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/process/skew/antimony_si_skew.csv
+-rw-r--r--   0        0        0     1050 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/process/skew/arsenic_si_skew.csv
+-rw-r--r--   0        0        0     1468 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/process/skew/boron_si_skew.csv
+-rw-r--r--   0        0        0     1118 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv
+-rw-r--r--   0        0        0      191 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/__init__.py
+-rw-r--r--   0        0        0    14848 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/build_model.py
+-rw-r--r--   0        0        0     7449 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/femwell_waveguide_model.py
+-rw-r--r--   0        0        0     1571 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/interpolators.py
+-rw-r--r--   0        0        0     6755 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/meep_FDTD_model.py
+-rw-r--r--   0        0        0     4528 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/meow_eme_model.py
+-rw-r--r--   0        0        0     5613 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/mlp.py
+-rw-r--r--   0        0        0     7358 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/models.py
+-rw-r--r--   0        0        0    13894 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/parameter.py
+-rwxr-xr-x   0        0        0     2225 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/plot_model.py
+-rw-r--r--   0        0        0     6805 2023-05-18 23:12:36.068451 gdsfactory-6.95.0/gdsfactory/simulation/sax/read.py
+-rw-r--r--   0        0        0     1350 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sax/tests/test_mzi.py
+-rw-r--r--   0        0        0     2220 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sax/tests/test_mzi_lattice.py
+-rw-r--r--   0        0        0     1405 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sax/tests/test_parameters.py
+-rw-r--r--   0        0        0     1357 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/__init__.py
+-rw-r--r--   0        0        0     1573 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/add_gc.py
+-rw-r--r--   0        0        0     3383 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/circuit.py
+-rw-r--r--   0        0        0      891 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/__init__.py
+-rw-r--r--   0        0        0     1295 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/bend_circular.py
+-rw-r--r--   0        0        0     1388 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/bend_euler.py
+-rw-r--r--   0        0        0     2560 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler.py
+-rw-r--r--   0        0        0     1046 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler_fdtd.py
+-rw-r--r--   0        0        0     1848 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler_ring.py
+-rw-r--r--   0        0        0     1329 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py
+-rw-r--r--   0        0        0      589 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py
+-rw-r--r--   0        0        0      913 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/gc.py
+-rw-r--r--   0        0        0     2032 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mmi1x2.py
+-rw-r--r--   0        0        0     1910 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mmi2x2.py
+-rw-r--r--   0        0        0     2618 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mzi.py
+-rw-r--r--   0        0        0     1759 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mzi_siepic.py
+-rw-r--r--   0        0        0      487 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mzi_thermal.py
+-rw-r--r--   0        0        0     2597 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/ring_double.py
+-rw-r--r--   0        0        0     1665 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/ring_double_siepic.py
+-rw-r--r--   0        0        0     1782 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/ring_single.py
+-rw-r--r--   0        0        0     1416 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/ring_single_siepic.py
+-rw-r--r--   0        0        0     1099 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/straight.py
+-rw-r--r--   0        0        0      800 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/get_transmission.py
+-rw-r--r--   0        0        0     2516 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/model_from_gdsfactory.py
+-rw-r--r--   0        0        0     3841 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/model_from_sparameters.py
+-rw-r--r--   0        0        0     2438 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/plot_circuit.py
+-rw-r--r--   0        0        0     1798 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py
+-rw-r--r--   0        0        0     2773 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/plot_model.py
+-rw-r--r--   0        0        0     1261 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_circuit.py
+-rw-r--r--   0        0        0       90 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_circuit/test_circuit_transmission.yml
+-rw-r--r--   0        0        0     1109 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components.py
+-rw-r--r--   0        0        0       66 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_mzi_.yml
+-rw-r--r--   0        0        0       69 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_double_.yml
+-rw-r--r--   0        0        0       69 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_single_.yml
+-rw-r--r--   0        0        0       92 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_circular_.yml
+-rw-r--r--   0        0        0       92 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_euler_.yml
+-rw-r--r--   0        0        0      412 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_.yml
+-rw-r--r--   0        0        0      412 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_ring_.yml
+-rw-r--r--   0        0        0      114 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_gc1550te_.yml
+-rw-r--r--   0        0        0      256 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi1x2_.yml
+-rw-r--r--   0        0        0      460 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi2x2_.yml
+-rw-r--r--   0        0        0      104 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_straight_.yml
+-rw-r--r--   0        0        0      166 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/simphony/types.py
+-rw-r--r--   0        0        0      471 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sipann/__init__.py
+-rw-r--r--   0        0        0     1376 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sipann/bend_circular.py
+-rw-r--r--   0        0        0     1465 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sipann/bend_euler.py
+-rw-r--r--   0        0        0     2508 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sipann/coupler.py
+-rw-r--r--   0        0        0     1892 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sipann/coupler_ring.py
+-rw-r--r--   0        0        0      736 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/sipann/straight.py
+-rw-r--r--   0        0        0      100 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/thermal/__init__.py
+-rw-r--r--   0        0        0     7789 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/simulation/thermal/heater.py
+-rw-r--r--   0        0        0     1744 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/snap.py
+-rw-r--r--   0        0        0     4245 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/symbols.py
+-rw-r--r--   0        0        0      524 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/technology/__init__.py
+-rw-r--r--   0        0        0     7607 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/technology/klayout_tech.py
+-rw-r--r--   0        0        0     1078 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/technology/layer_map.py
+-rw-r--r--   0        0        0    16139 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/technology/layer_stack.py
+-rw-r--r--   0        0        0    42133 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/technology/layer_views.py
+-rw-r--r--   0        0        0     1984 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/technology/simulation_settings.py
+-rw-r--r--   0        0        0     1635 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/types.py
+-rw-r--r--   0        0        0    10008 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/typings.py
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/utils/__init__.py
+-rw-r--r--   0        0        0     1342 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/utils/async_utils.py
+-rw-r--r--   0        0        0      376 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/utils/color_utils.py
+-rw-r--r--   0        0        0      558 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/utils/file_utils.py
+-rw-r--r--   0        0        0      185 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/utils/function_utils.py
+-rw-r--r--   0        0        0      684 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/utils/xml_utils.py
+-rw-r--r--   0        0        0     1453 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/utils/yaml_utils.py
+-rw-r--r--   0        0        0     4865 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/watch.py
+-rw-r--r--   0        0        0        0 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/widgets/__init__.py
+-rw-r--r--   0        0        0     7969 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/widgets/layout_viewer.py
+-rw-r--r--   0        0        0     7480 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/gdsfactory/write_cells.py
+-rw-r--r--   0        0        0     5687 2023-05-18 23:12:36.072451 gdsfactory-6.95.0/pyproject.toml
+-rw-r--r--   0        0        0    18772 1970-01-01 00:00:00.000000 gdsfactory-6.95.0/PKG-INFO
```

### Comparing `gdsfactory-6.94.1/LICENSE` & `gdsfactory-6.95.0/LICENSE`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/README.md` & `gdsfactory-6.95.0/README.md`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# gdsfactory 6.94.1
+# gdsfactory 6.95.0
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![issues](https://img.shields.io/github/issues/gdsfactory/gdsfactory)](https://github.com/gdsfactory/gdsfactory/issues)
```

### Comparing `gdsfactory-6.94.1/gdsfactory/__init__.py` & `gdsfactory-6.95.0/gdsfactory/__init__.py`

 * *Files 9% similar despite different names*

```diff
@@ -13,23 +13,23 @@
 
     - c: components
     - routing
 
 isort:skip_file
 """
 from __future__ import annotations
-from warnings import warn
+import warnings
 from functools import partial
 from toolz import compose
 from gdsfactory.component_layout import Group
 from gdsfactory.path import Path
 
 
 # NOTE: import order matters. Only change the order if you know what you are doing
-from gdsfactory.component import Component, ComponentReference
+from gdsfactory.component import Component, ComponentReference, declarative_component
 from gdsfactory.config import CONF, call_if_func, PATH, logger
 from gdsfactory.port import Port
 from gdsfactory.cell import cell
 from gdsfactory.cell import cell_without_validator
 from gdsfactory.cell import clear_cache
 from gdsfactory.show import show
 from gdsfactory.read.import_gds import import_gds
@@ -77,22 +77,26 @@
 from gdsfactory.cross_section import get_cross_section_factories
 
 c = components
 
 
 def __getattr__(name):
     if name == "types":
-        warn("gdsfactory.types has been renamed to gdsfactory.typings", stacklevel=3)
+        warnings.warn(
+            "gdsfactory.types has been renamed to gdsfactory.typings and will be deprecated soon.",
+            stacklevel=3,
+        )
         return typings
     raise AttributeError(f"No module named {name}")
 
 
 __all__ = (
     "CONF",
     "Component",
+    "declarative_component",
     "ComponentReference",
     "CrossSection",
     "Group",
     "LAYER",
     "LAYER_STACK",
     "Label",
     "Path",
@@ -143,8 +147,8 @@
     "snap",
     "typings",
     "technology",
     "write_cells",
     "xsection",
     "PATH",
 )
-__version__ = "6.94.1"
+__version__ = "6.95.0"
```

### Comparing `gdsfactory-6.94.1/gdsfactory/add_keepout.py` & `gdsfactory-6.95.0/gdsfactory/add_keepout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/add_labels.py` & `gdsfactory-6.95.0/gdsfactory/add_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/add_loopback.py` & `gdsfactory-6.95.0/gdsfactory/add_loopback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/add_padding.py` & `gdsfactory-6.95.0/gdsfactory/add_padding.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/add_pins.py` & `gdsfactory-6.95.0/gdsfactory/add_pins.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/add_ports.py` & `gdsfactory-6.95.0/gdsfactory/add_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/add_tapers.py` & `gdsfactory-6.95.0/gdsfactory/add_tapers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/add_tapers_cross_section.py` & `gdsfactory-6.95.0/gdsfactory/add_tapers_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/add_termination.py` & `gdsfactory-6.95.0/gdsfactory/add_termination.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/asserts.py` & `gdsfactory-6.95.0/gdsfactory/asserts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/cell.py` & `gdsfactory-6.95.0/gdsfactory/cell.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,29 +1,27 @@
 """Cell decorator for functions that return a Component."""
 from __future__ import annotations
 
 import functools
 import hashlib
 import inspect
-from typing import Any, Callable, Dict, Optional, Tuple
-from typing_extensions import ParamSpec
+from typing import Any, Callable, Dict, Optional, Tuple, TypeVar
 
 import toolz
 from pydantic import BaseModel, validate_arguments
 
 from gdsfactory.component import Component
-from gdsfactory.name import MAX_NAME_LENGTH, clean_name, get_name_short
+from gdsfactory.name import clean_name, get_name_short
 from gdsfactory.serialization import clean_dict, clean_value_name
 
 CACHE: Dict[str, Component] = {}
 
 INFO_VERSION = 2
 
-CellSettings = ParamSpec("CellSettings")
-_F = Callable[CellSettings, Component]
+_F = TypeVar("_F", bound=Callable)
 
 
 class CellReturnTypeError(ValueError):
     pass
 
 
 def clear_cache() -> None:
@@ -60,34 +58,44 @@
     full: Dict[str, Any]
     changed: Dict[str, Any]
     default: Dict[str, Any]
 
     child: Optional[Dict[str, Any]] = None
 
 
-def cell_without_validator(func) -> Callable[CellSettings, Component]:
+def cell_without_validator(func: _F) -> _F:
     """Decorator for Component functions.
 
     Similar to cell decorator but does not enforce argument types.
 
     I recommend using @cell instead.
     """
 
     @functools.wraps(func)
     def _cell(*args, **kwargs):
-        from gdsfactory.pdk import _ACTIVE_PDK
+        from gdsfactory.pdk import get_active_pdk
 
-        with_hash = kwargs.pop("with_hash", False)
-        autoname = kwargs.pop("autoname", True)
-        name = kwargs.pop("name", None)
-        cache = kwargs.pop("cache", True)
-        flatten = kwargs.pop("flatten", False)
-        info = kwargs.pop("info", {})
-        prefix = kwargs.pop("prefix", func.__name__)
-        max_name_length = kwargs.pop("max_name_length", MAX_NAME_LENGTH)
+        active_pdk = get_active_pdk()
+        cell_decorator_settings = active_pdk.cell_decorator_settings
+
+        with_hash = kwargs.pop("with_hash", cell_decorator_settings.with_hash)
+        autoname = kwargs.pop("autoname", cell_decorator_settings.autoname)
+        name = kwargs.pop("name", cell_decorator_settings.name)
+        cache = kwargs.pop("cache", cell_decorator_settings.cache)
+        flatten = kwargs.pop("flatten", cell_decorator_settings.flatten)
+        info = kwargs.pop("info", cell_decorator_settings.info)
+        prefix = kwargs.pop(
+            "prefix",
+            func.__name__
+            if cell_decorator_settings.prefix is None
+            else cell_decorator_settings.prefix,
+        )
+        max_name_length = kwargs.pop(
+            "max_name_length", cell_decorator_settings.max_name_length
+        )
 
         sig = inspect.signature(func)
         args_as_kwargs = dict(zip(sig.parameters.keys(), args))
         args_as_kwargs.update(kwargs)
 
         default = {
             p.name: p.default
@@ -131,18 +139,15 @@
             name_signature = clean_name(f"{prefix}_{named_args_string}")
         else:
             name_signature = prefix
 
         # filter the changed dictionary to only keep entries which have truly changed
         changed_arg_names = [carg.split("=")[0] for carg in changed_arg_list]
         changed = {k: changed[k] for k in changed_arg_names}
-
-        pdk = _ACTIVE_PDK
-        default_decorator = pdk.default_decorator if pdk else None
-
+        default_decorator = active_pdk.default_decorator if active_pdk else None
         name = name or name_signature
         decorator = kwargs.pop("decorator", default_decorator)
         name = get_name_short(name, max_name_length=max_name_length)
 
         if (
             "args" not in sig.parameters
             and "kwargs" not in sig.parameters
@@ -224,15 +229,15 @@
         component.lock()
         CACHE[name] = component
         return component
 
     return _cell
 
 
-def cell(func: Callable[CellSettings, Component]) -> Callable[CellSettings, Component]:
+def cell(func: _F) -> _F:
     """Decorator for Component functions.
 
     Wraps cell_without_validator
     Validates type annotations with pydantic.
 
     Implements a cache so that if a component has already been build
     it will return the component from the cache directly.
```

### Comparing `gdsfactory-6.94.1/gdsfactory/circuitviz.py` & `gdsfactory-6.95.0/gdsfactory/circuitviz.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/cli.py` & `gdsfactory-6.95.0/gdsfactory/cli.py`

 * *Files 1% similar despite different names*

```diff
@@ -19,15 +19,15 @@
 from gdsfactory.write_cells import write_cells as write_cells_to_separate_gds
 
 try:
     import rich_click as click
 except ImportError:
     import click
 
-VERSION = "6.94.1"
+VERSION = "6.95.0"
 LAYER_LABEL = LAYER.LABEL
 
 
 def print_version(ctx: Context, param: Option, value: bool) -> None:
     """Prints the version."""
     if not value or ctx.resilient_parsing:
         return
```

### Comparing `gdsfactory-6.94.1/gdsfactory/component.py` & `gdsfactory-6.95.0/gdsfactory/component.py`

 * *Files 0% similar despite different names*

```diff
@@ -10,6295 +10,6368 @@
 00000090: 6174 696f 6e73 0a0a 696d 706f 7274 2064  ations..import d
 000000a0: 6174 6574 696d 650a 696d 706f 7274 2068  atetime.import h
 000000b0: 6173 686c 6962 0a69 6d70 6f72 7420 6974  ashlib.import it
 000000c0: 6572 746f 6f6c 730a 696d 706f 7274 206d  ertools.import m
 000000d0: 6174 680a 696d 706f 7274 2070 6174 686c  ath.import pathl
 000000e0: 6962 0a69 6d70 6f72 7420 7575 6964 0a69  ib.import uuid.i
 000000f0: 6d70 6f72 7420 7761 726e 696e 6773 0a66  mport warnings.f
-00000100: 726f 6d20 636f 6c6c 6563 7469 6f6e 7320  rom collections 
-00000110: 696d 706f 7274 2043 6f75 6e74 6572 0a66  import Counter.f
-00000120: 726f 6d20 636f 6c6c 6563 7469 6f6e 732e  rom collections.
-00000130: 6162 6320 696d 706f 7274 2049 7465 7261  abc import Itera
-00000140: 626c 650a 6672 6f6d 2070 6174 686c 6962  ble.from pathlib
-00000150: 2069 6d70 6f72 7420 5061 7468 0a66 726f   import Path.fro
-00000160: 6d20 7479 7069 6e67 2069 6d70 6f72 7420  m typing import 
-00000170: 416e 792c 2044 6963 742c 204c 6973 742c  Any, Dict, List,
-00000180: 204f 7074 696f 6e61 6c2c 2053 6574 2c20   Optional, Set, 
-00000190: 5475 706c 652c 2055 6e69 6f6e 0a0a 696d  Tuple, Union..im
-000001a0: 706f 7274 2067 6473 746b 0a69 6d70 6f72  port gdstk.impor
-000001b0: 7420 6e75 6d70 7920 6173 206e 700a 696d  t numpy as np.im
-000001c0: 706f 7274 2079 616d 6c0a 6672 6f6d 206f  port yaml.from o
-000001d0: 6d65 6761 636f 6e66 2069 6d70 6f72 7420  megaconf import 
-000001e0: 4469 6374 436f 6e66 6967 2c20 4f6d 6567  DictConfig, Omeg
-000001f0: 6143 6f6e 660a 6672 6f6d 2074 7970 696e  aConf.from typin
-00000200: 675f 6578 7465 6e73 696f 6e73 2069 6d70  g_extensions imp
-00000210: 6f72 7420 4c69 7465 7261 6c0a 0a66 726f  ort Literal..fro
-00000220: 6d20 6764 7366 6163 746f 7279 2e63 6f6d  m gdsfactory.com
-00000230: 706f 6e65 6e74 5f6c 6179 6f75 7420 696d  ponent_layout im
-00000240: 706f 7274 2028 0a20 2020 204c 6162 656c  port (.    Label
-00000250: 2c0a 2020 2020 506f 6c79 676f 6e2c 0a20  ,.    Polygon,. 
-00000260: 2020 205f 616c 6967 6e2c 0a20 2020 205f     _align,.    _
-00000270: 6469 7374 7269 6275 7465 2c0a 2020 2020  distribute,.    
-00000280: 5f47 656f 6d65 7472 7948 656c 7065 722c  _GeometryHelper,
-00000290: 0a20 2020 205f 7061 7273 655f 6c61 7965  .    _parse_laye
-000002a0: 722c 0a20 2020 2067 6574 5f70 6f6c 7967  r,.    get_polyg
-000002b0: 6f6e 732c 0a29 0a66 726f 6d20 6764 7366  ons,.).from gdsf
-000002c0: 6163 746f 7279 2e63 6f6d 706f 6e65 6e74  actory.component
-000002d0: 5f72 6566 6572 656e 6365 2069 6d70 6f72  _reference impor
-000002e0: 7420 436f 6d70 6f6e 656e 7452 6566 6572  t ComponentRefer
-000002f0: 656e 6365 2c20 436f 6f72 6469 6e61 7465  ence, Coordinate
-00000300: 2c20 5369 7a65 496e 666f 0a66 726f 6d20  , SizeInfo.from 
-00000310: 6764 7366 6163 746f 7279 2e63 6f6e 6669  gdsfactory.confi
-00000320: 6720 696d 706f 7274 2043 4f4e 462c 206c  g import CONF, l
-00000330: 6f67 6765 722c 2047 4453 4449 525f 5445  ogger, GDSDIR_TE
-00000340: 4d50 0a66 726f 6d20 6764 7366 6163 746f  MP.from gdsfacto
-00000350: 7279 2e63 726f 7373 5f73 6563 7469 6f6e  ry.cross_section
-00000360: 2069 6d70 6f72 7420 4372 6f73 7353 6563   import CrossSec
-00000370: 7469 6f6e 0a66 726f 6d20 6764 7366 6163  tion.from gdsfac
-00000380: 746f 7279 2e70 6f72 7420 696d 706f 7274  tory.port import
-00000390: 2028 0a20 2020 2050 6f72 742c 0a20 2020   (.    Port,.   
-000003a0: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
-000003b0: 7473 2c0a 2020 2020 6175 746f 5f72 656e  ts,.    auto_ren
-000003c0: 616d 655f 706f 7274 735f 636f 756e 7465  ame_ports_counte
-000003d0: 725f 636c 6f63 6b77 6973 652c 0a20 2020  r_clockwise,.   
-000003e0: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
-000003f0: 7473 5f6c 6179 6572 5f6f 7269 656e 7461  ts_layer_orienta
-00000400: 7469 6f6e 2c0a 2020 2020 6175 746f 5f72  tion,.    auto_r
-00000410: 656e 616d 655f 706f 7274 735f 6f72 6965  ename_ports_orie
-00000420: 6e74 6174 696f 6e2c 0a20 2020 206d 6170  ntation,.    map
-00000430: 5f70 6f72 7473 5f6c 6179 6572 5f74 6f5f  _ports_layer_to_
-00000440: 6f72 6965 6e74 6174 696f 6e2c 0a20 2020  orientation,.   
-00000450: 206d 6170 5f70 6f72 7473 5f74 6f5f 6f72   map_ports_to_or
-00000460: 6965 6e74 6174 696f 6e5f 6363 772c 0a20  ientation_ccw,. 
-00000470: 2020 206d 6170 5f70 6f72 7473 5f74 6f5f     map_ports_to_
-00000480: 6f72 6965 6e74 6174 696f 6e5f 6377 2c0a  orientation_cw,.
-00000490: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
-000004a0: 2c0a 290a 6672 6f6d 2067 6473 6661 6374  ,.).from gdsfact
-000004b0: 6f72 792e 7365 7269 616c 697a 6174 696f  ory.serializatio
-000004c0: 6e20 696d 706f 7274 2063 6c65 616e 5f64  n import clean_d
-000004d0: 6963 740a 6672 6f6d 2067 6473 6661 6374  ict.from gdsfact
-000004e0: 6f72 792e 736e 6170 2069 6d70 6f72 7420  ory.snap import 
-000004f0: 736e 6170 5f74 6f5f 6772 6964 0a66 726f  snap_to_grid.fro
-00000500: 6d20 6764 7366 6163 746f 7279 2e74 6563  m gdsfactory.tec
-00000510: 686e 6f6c 6f67 7920 696d 706f 7274 204c  hnology import L
-00000520: 6179 6572 5669 6577 2c20 4c61 7965 7256  ayerView, LayerV
-00000530: 6965 7773 2c20 4c61 7965 7253 7461 636b  iews, LayerStack
-00000540: 0a66 726f 6d20 6764 7366 6163 746f 7279  .from gdsfactory
-00000550: 2e67 656e 6572 6963 5f74 6563 6820 696d  .generic_tech im
-00000560: 706f 7274 204c 4159 4552 0a0a 506c 6f74  port LAYER..Plot
-00000570: 7465 7220 3d20 4c69 7465 7261 6c5b 2268  ter = Literal["h
-00000580: 6f6c 6f76 6965 7773 222c 2022 6d61 7470  oloviews", "matp
-00000590: 6c6f 746c 6962 222c 2022 7174 222c 2022  lotlib", "qt", "
-000005a0: 6b6c 6179 6f75 7422 5d0a 4178 6973 203d  klayout"].Axis =
-000005b0: 204c 6974 6572 616c 5b22 7822 2c20 2279   Literal["x", "y
-000005c0: 225d 0a0a 0a63 6c61 7373 2055 6e63 6163  "]...class Uncac
-000005d0: 6865 6443 6f6d 706f 6e65 6e74 5761 726e  hedComponentWarn
-000005e0: 696e 6728 5573 6572 5761 726e 696e 6729  ing(UserWarning)
-000005f0: 3a0a 2020 2020 7061 7373 0a0a 0a63 6c61  :.    pass...cla
-00000600: 7373 2055 6e63 6163 6865 6443 6f6d 706f  ss UncachedCompo
-00000610: 6e65 6e74 4572 726f 7228 5661 6c75 6545  nentError(ValueE
-00000620: 7272 6f72 293a 0a20 2020 2070 6173 730a  rror):.    pass.
-00000630: 0a0a 636c 6173 7320 4d75 7461 6269 6c69  ..class Mutabili
-00000640: 7479 4572 726f 7228 5661 6c75 6545 7272  tyError(ValueErr
-00000650: 6f72 293a 0a20 2020 2070 6173 730a 0a0a  or):.    pass...
-00000660: 6465 6620 5f67 6574 5f64 6570 656e 6465  def _get_depende
-00000670: 6e63 6965 7328 636f 6d70 6f6e 656e 742c  ncies(component,
-00000680: 2072 6566 6572 656e 6365 735f 7365 7429   references_set)
-00000690: 202d 3e20 4e6f 6e65 3a0a 2020 2020 666f   -> None:.    fo
-000006a0: 7220 7265 6620 696e 2063 6f6d 706f 6e65  r ref in compone
-000006b0: 6e74 2e72 6566 6572 656e 6365 733a 0a20  nt.references:. 
-000006c0: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-000006d0: 735f 7365 742e 6164 6428 7265 662e 7265  s_set.add(ref.re
-000006e0: 665f 6365 6c6c 290a 2020 2020 2020 2020  f_cell).        
-000006f0: 5f67 6574 5f64 6570 656e 6465 6e63 6965  _get_dependencie
-00000700: 7328 7265 662e 7265 665f 6365 6c6c 2c20  s(ref.ref_cell, 
-00000710: 7265 6665 7265 6e63 6573 5f73 6574 290a  references_set).
-00000720: 0a0a 6d75 7461 6269 6c69 7479 5f65 7272  ..mutability_err
-00000730: 6f72 5f6d 6573 7361 6765 203d 2022 2222  or_message = """
-00000740: 0a59 6f75 2063 616e 6e6f 7420 6d6f 6469  .You cannot modi
-00000750: 6679 2061 2043 6f6d 706f 6e65 6e74 2061  fy a Component a
-00000760: 6674 6572 2063 7265 6174 696f 6e20 6173  fter creation as
-00000770: 2069 7420 7769 6c6c 2061 6666 6563 7420   it will affect 
-00000780: 616c 6c20 6f66 2069 7473 2069 6e73 7461  all of its insta
-00000790: 6e63 6573 2e0a 0a43 7265 6174 6520 6120  nces...Create a 
-000007a0: 6e65 7720 436f 6d70 6f6e 656e 7420 616e  new Component an
-000007b0: 6420 6164 6420 6120 7265 6665 7265 6e63  d add a referenc
-000007c0: 6520 746f 2069 742e 0a0a 466f 7220 6578  e to it...For ex
-000007d0: 616d 706c 653a 0a0a 2320 4241 440a 6320  ample:..# BAD.c 
-000007e0: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
-000007f0: 6265 6e64 5f65 756c 6572 2829 0a63 2e61  bend_euler().c.a
-00000800: 6464 5f72 6566 2867 662e 636f 6d70 6f6e  dd_ref(gf.compon
-00000810: 656e 7473 2e6d 7a69 2829 290a 0a23 2047  ents.mzi())..# G
-00000820: 4f4f 440a 6320 3d20 6766 2e43 6f6d 706f  OOD.c = gf.Compo
-00000830: 6e65 6e74 2829 0a63 2e61 6464 5f72 6566  nent().c.add_ref
-00000840: 2867 662e 636f 6d70 6f6e 656e 7473 2e62  (gf.components.b
-00000850: 656e 645f 6575 6c65 7228 2929 0a63 2e61  end_euler()).c.a
-00000860: 6464 5f72 6566 2867 662e 636f 6d70 6f6e  dd_ref(gf.compon
-00000870: 656e 7473 2e6d 7a69 2829 290a 2222 220a  ents.mzi()).""".
-00000880: 0a6d 6f76 655f 6572 726f 725f 6d65 7373  .move_error_mess
-00000890: 6167 6520 3d20 2222 220a 596f 7520 6361  age = """.You ca
-000008a0: 6e6e 6f74 206d 6f76 6520 6120 436f 6d70  nnot move a Comp
-000008b0: 6f6e 656e 742e 2059 6f75 2063 616e 2063  onent. You can c
-000008c0: 7265 6174 6520 6120 6e65 7720 436f 6d70  reate a new Comp
-000008d0: 6f6e 656e 742c 2061 6464 2061 2072 6566  onent, add a ref
-000008e0: 6572 656e 6365 2074 6f20 7468 6520 6f74  erence to the ot
-000008f0: 6865 7220 436f 6d70 6f6e 656e 7420 616e  her Component an
-00000900: 6420 7468 656e 206d 6f76 6520 7468 6520  d then move the 
-00000910: 7265 6665 7265 6e63 652e 0a0a 466f 7220  reference...For 
-00000920: 6578 616d 706c 653a 0a0a 2320 4241 440a  example:..# BAD.
-00000930: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
-00000940: 732e 7374 7261 6967 6874 2829 0a63 2e78  s.straight().c.x
-00000950: 6d69 6e20 3d20 3130 0a0a 2320 474f 4f44  min = 10..# GOOD
-00000960: 0a63 203d 2067 662e 436f 6d70 6f6e 656e  .c = gf.Componen
-00000970: 7428 290a 7265 6620 3d20 632e 6164 645f  t().ref = c.add_
-00000980: 7265 6628 6766 2e63 6f6d 706f 6e65 6e74  ref(gf.component
-00000990: 732e 7374 7261 6967 6874 2829 2920 2320  s.straight()) # 
-000009a0: 6f72 2072 6566 203d 2063 203c 3c20 6766  or ref = c << gf
-000009b0: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
-000009c0: 6967 6874 2829 0a72 6566 2e78 6d69 6e20  ight().ref.xmin 
-000009d0: 3d20 3130 0a22 2222 0a0a 5061 7468 5479  = 10."""..PathTy
-000009e0: 7065 203d 2055 6e69 6f6e 5b73 7472 2c20  pe = Union[str, 
-000009f0: 5061 7468 5d0a 466c 6f61 7432 203d 2054  Path].Float2 = T
-00000a00: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
-00000a10: 745d 0a4c 6179 6572 203d 2054 7570 6c65  t].Layer = Tuple
-00000a20: 5b69 6e74 2c20 696e 745d 0a4c 6179 6572  [int, int].Layer
-00000a30: 7320 3d20 5475 706c 655b 4c61 7965 722c  s = Tuple[Layer,
-00000a40: 202e 2e2e 5d0a 4c61 7965 7253 7065 6320   ...].LayerSpec 
-00000a50: 3d20 556e 696f 6e5b 7374 722c 2069 6e74  = Union[str, int
-00000a60: 2c20 4c61 7965 722c 204e 6f6e 655d 0a0a  , Layer, None]..
-00000a70: 5f74 696d 6573 7461 6d70 3230 3139 203d  _timestamp2019 =
-00000a80: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-00000a90: 6d65 2e66 726f 6d74 696d 6573 7461 6d70  me.fromtimestamp
-00000aa0: 2831 3537 3230 3134 3139 322e 3832 3733  (1572014192.8273
-00000ab0: 290a 4d41 585f 4e41 4d45 5f4c 454e 4754  ).MAX_NAME_LENGT
-00000ac0: 4820 3d20 3332 0a0a 0a64 6566 205f 726e  H = 32...def _rn
-00000ad0: 6428 6172 722c 2070 7265 6369 7369 6f6e  d(arr, precision
-00000ae0: 3d31 652d 3429 3a0a 2020 2020 6172 7220  =1e-4):.    arr 
-00000af0: 3d20 6e70 2e61 7363 6f6e 7469 6775 6f75  = np.ascontiguou
-00000b00: 7361 7272 6179 2861 7272 290a 2020 2020  sarray(arr).    
-00000b10: 6e64 6967 6974 7320 3d20 726f 756e 6428  ndigits = round(
-00000b20: 2d6d 6174 682e 6c6f 6731 3028 7072 6563  -math.log10(prec
-00000b30: 6973 696f 6e29 290a 2020 2020 7265 7475  ision)).    retu
-00000b40: 726e 206e 702e 6173 636f 6e74 6967 756f  rn np.ascontiguo
-00000b50: 7573 6172 7261 7928 6172 722e 726f 756e  usarray(arr.roun
-00000b60: 6428 6e64 6967 6974 7329 202f 2070 7265  d(ndigits) / pre
-00000b70: 6369 7369 6f6e 2c20 6474 7970 653d 6e70  cision, dtype=np
-00000b80: 2e69 6e74 3634 290a 0a0a 636c 6173 7320  .int64)...class 
-00000b90: 436f 6d70 6f6e 656e 7428 5f47 656f 6d65  Component(_Geome
-00000ba0: 7472 7948 656c 7065 7229 3a0a 2020 2020  tryHelper):.    
-00000bb0: 2222 2241 2043 6f6d 706f 6e65 6e74 2069  """A Component i
-00000bc0: 7320 616e 2065 6d70 7479 2063 616e 7661  s an empty canva
-00000bd0: 7320 7768 6572 6520 796f 7520 6164 6420  s where you add 
-00000be0: 706f 6c79 676f 6e73 2c20 7265 6665 7265  polygons, refere
-00000bf0: 6e63 6573 2061 6e64 2070 6f72 7473 205c  nces and ports \
-00000c00: 0a20 2020 2020 2020 2020 2020 2028 746f  .            (to
-00000c10: 2063 6f6e 6e65 6374 2074 6f20 6f74 6865   connect to othe
-00000c20: 7220 636f 6d70 6f6e 656e 7473 292e 0a0a  r components)...
-00000c30: 2020 2020 2d20 7374 6f72 6573 2073 6574      - stores set
-00000c40: 7469 6e67 7320 7468 6174 2079 6f75 2075  tings that you u
-00000c50: 7365 2074 6f20 6275 696c 6420 7468 6520  se to build the 
-00000c60: 636f 6d70 6f6e 656e 740a 2020 2020 2d20  component.    - 
-00000c70: 7374 6f72 6573 2069 6e66 6f20 7468 6174  stores info that
-00000c80: 2079 6f75 2077 616e 7420 746f 2075 7365   you want to use
-00000c90: 0a20 2020 202d 2063 616e 2072 6574 7572  .    - can retur
-00000ca0: 6e20 706f 7274 7320 6279 2074 7970 6520  n ports by type 
-00000cb0: 286f 7074 6963 616c 2c20 656c 6563 7472  (optical, electr
-00000cc0: 6963 616c 202e 2e2e 290a 2020 2020 2d20  ical ...).    - 
-00000cd0: 6361 6e20 7265 7475 726e 206e 6574 6c69  can return netli
-00000ce0: 7374 2066 6f72 2063 6972 6375 6974 2073  st for circuit s
-00000cf0: 696d 756c 6174 696f 6e0a 2020 2020 2d20  imulation.    - 
-00000d00: 6361 6e20 7772 6974 6520 746f 2047 4453  can write to GDS
-00000d10: 2c20 4f41 5349 530a 2020 2020 2d20 6361  , OASIS.    - ca
-00000d20: 6e20 7368 6f77 2069 6e20 4b4c 6179 6f75  n show in KLayou
-00000d30: 742c 206d 6174 706c 6f74 6c69 622c 2033  t, matplotlib, 3
-00000d40: 442c 2051 5420 7669 6577 6572 2c20 686f  D, QT viewer, ho
-00000d50: 6c6f 7669 6577 730a 2020 2020 2d20 6361  loviews.    - ca
-00000d60: 6e20 7265 7475 726e 2063 6f70 792c 206d  n return copy, m
-00000d70: 6972 726f 722c 2066 6c61 7474 656e 6564  irror, flattened
-00000d80: 2028 6e6f 2072 6566 6572 656e 6365 7329   (no references)
-00000d90: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
-00000da0: 2020 2020 6e61 6d65 3a20 636f 6d70 6f6e      name: compon
-00000db0: 656e 745f 6e61 6d65 2e20 5573 6520 4063  ent_name. Use @c
-00000dc0: 656c 6c20 6465 636f 7261 746f 7220 666f  ell decorator fo
-00000dd0: 7220 6175 746f 2d6e 616d 696e 672e 0a20  r auto-naming.. 
-00000de0: 2020 2020 2020 2077 6974 685f 7575 6964         with_uuid
-00000df0: 3a20 6164 6473 2075 6e69 7175 6520 6964  : adds unique id
-00000e00: 656e 7469 6669 6572 2e0a 0a20 2020 2050  entifier...    P
-00000e10: 726f 7065 7274 6965 733a 0a20 2020 2020  roperties:.     
-00000e20: 2020 2069 6e66 6f3a 2064 6963 7469 6f6e     info: diction
-00000e30: 6172 7920 7468 6174 2069 6e63 6c75 6465  ary that include
-00000e40: 730a 2020 2020 2020 2020 2020 2020 2d20  s.            - 
-00000e50: 6465 7269 7665 6420 7072 6f70 6572 7469  derived properti
-00000e60: 6573 0a20 2020 2020 2020 2020 2020 202d  es.            -
-00000e70: 2065 7874 6572 6e61 6c20 6d65 7461 6461   external metada
-00000e80: 7461 2028 7465 7374 5f70 726f 746f 636f  ta (test_protoco
-00000e90: 6c2c 2064 6f63 732c 202e 2e2e 290a 2020  l, docs, ...).  
-00000ea0: 2020 2020 2020 2020 2020 2d20 7369 6d75            - simu
-00000eb0: 6c61 7469 6f6e 5f73 6574 7469 6e67 730a  lation_settings.
-00000ec0: 2020 2020 2020 2020 2020 2020 2d20 6675              - fu
-00000ed0: 6e63 7469 6f6e 5f6e 616d 650a 2020 2020  nction_name.    
-00000ee0: 2020 2020 2020 2020 2d20 6e61 6d65 3a20          - name: 
-00000ef0: 666f 7220 7468 6520 636f 6d70 6f6e 656e  for the componen
-00000f00: 740a 0a20 2020 2020 2020 2073 6574 7469  t..        setti
-00000f10: 6e67 733a 0a20 2020 2020 2020 2020 2020  ngs:.           
-00000f20: 2066 756c 6c3a 2066 756c 6c20 7365 7474   full: full sett
-00000f30: 696e 6773 2070 6173 7365 6420 746f 2074  ings passed to t
-00000f40: 6865 2066 756e 6374 696f 6e20 746f 2063  he function to c
-00000f50: 7265 6174 6520 636f 6d70 6f6e 656e 742e  reate component.
-00000f60: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
-00000f70: 6e67 6564 3a20 6368 616e 6765 6420 7365  nged: changed se
-00000f80: 7474 696e 6773 2e0a 2020 2020 2020 2020  ttings..        
-00000f90: 2020 2020 6465 6661 756c 743a 2064 6566      default: def
-00000fa0: 6175 6c74 2063 6f6d 706f 6e65 6e74 2073  ault component s
-00000fb0: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
-00000fc0: 2020 2020 2063 6869 6c64 3a20 6469 6374       child: dict
-00000fd0: 2069 6e66 6f20 6672 6f6d 2074 6865 2063   info from the c
-00000fe0: 6869 6c64 7265 6e2c 2069 6620 616e 792e  hildren, if any.
-00000ff0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-00001000: 6620 5f5f 696e 6974 5f5f 280a 2020 2020  f __init__(.    
-00001010: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00001020: 2020 6e61 6d65 3a20 7374 7220 3d20 2255    name: str = "U
-00001030: 6e6e 616d 6564 222c 0a20 2020 2020 2020  nnamed",.       
-00001040: 2077 6974 685f 7575 6964 3a20 626f 6f6c   with_uuid: bool
-00001050: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
-00001060: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00001070: 2022 2222 496e 6974 6961 6c69 7a65 2074   """Initialize t
-00001080: 6865 2043 6f6d 706f 6e65 6e74 206f 626a  he Component obj
-00001090: 6563 742e 2222 220a 2020 2020 2020 2020  ect.""".        
-000010a0: 7365 6c66 2e75 6964 203d 2073 7472 2875  self.uid = str(u
-000010b0: 7569 642e 7575 6964 3428 2929 5b3a 385d  uid.uuid4())[:8]
-000010c0: 0a20 2020 2020 2020 2069 6620 7769 7468  .        if with
-000010d0: 5f75 7569 6420 6f72 206e 616d 6520 3d3d  _uuid or name ==
-000010e0: 2022 556e 6e61 6d65 6422 3a0a 2020 2020   "Unnamed":.    
-000010f0: 2020 2020 2020 2020 6e61 6d65 202b 3d20          name += 
-00001100: 6622 5f7b 7365 6c66 2e75 6964 7d22 0a0a  f"_{self.uid}"..
-00001110: 2020 2020 2020 2020 7365 6c66 2e5f 6365          self._ce
-00001120: 6c6c 203d 2067 6473 746b 2e43 656c 6c28  ll = gdstk.Cell(
-00001130: 6e61 6d65 3d6e 616d 6529 0a20 2020 2020  name=name).     
-00001140: 2020 2073 656c 662e 6e61 6d65 203d 206e     self.name = n
-00001150: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
-00001160: 2e69 6e66 6f3a 2044 6963 745b 7374 722c  .info: Dict[str,
-00001170: 2041 6e79 5d20 3d20 7b7d 0a0a 2020 2020   Any] = {}..    
-00001180: 2020 2020 7365 6c66 2e73 6574 7469 6e67      self.setting
-00001190: 733a 2044 6963 745b 7374 722c 2041 6e79  s: Dict[str, Any
-000011a0: 5d20 3d20 7b7d 0a20 2020 2020 2020 2073  ] = {}.        s
-000011b0: 656c 662e 5f6c 6f63 6b65 6420 3d20 4661  elf._locked = Fa
-000011c0: 6c73 650a 2020 2020 2020 2020 7365 6c66  lse.        self
-000011d0: 2e67 6574 5f63 6869 6c64 5f6e 616d 6520  .get_child_name 
-000011e0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-000011f0: 7365 6c66 2e5f 7265 6665 7265 6e63 655f  self._reference_
-00001200: 6e61 6d65 735f 636f 756e 7465 7220 3d20  names_counter = 
-00001210: 436f 756e 7465 7228 290a 2020 2020 2020  Counter().      
-00001220: 2020 7365 6c66 2e5f 7265 6665 7265 6e63    self._referenc
-00001230: 655f 6e61 6d65 735f 7573 6564 203d 2073  e_names_used = s
-00001240: 6574 2829 0a20 2020 2020 2020 2073 656c  et().        sel
-00001250: 662e 5f6e 616d 6564 5f72 6566 6572 656e  f._named_referen
-00001260: 6365 7320 3d20 7b7d 0a20 2020 2020 2020  ces = {}.       
-00001270: 2073 656c 662e 5f72 6566 6572 656e 6365   self._reference
-00001280: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
-00001290: 7365 6c66 2e70 6f72 7473 203d 207b 7d0a  self.ports = {}.
-000012a0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-000012b0: 2020 2064 6566 2072 6566 6572 656e 6365     def reference
-000012c0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-000012d0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-000012e0: 6665 7265 6e63 6573 0a0a 2020 2020 4070  ferences..    @p
-000012f0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00001300: 706f 6c79 676f 6e73 2873 656c 6629 202d  polygons(self) -
-00001310: 3e20 4c69 7374 5b50 6f6c 7967 6f6e 5d3a  > List[Polygon]:
-00001320: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00001330: 7365 6c66 2e5f 6365 6c6c 2e70 6f6c 7967  self._cell.polyg
-00001340: 6f6e 730a 0a20 2020 2040 7072 6f70 6572  ons..    @proper
-00001350: 7479 0a20 2020 2064 6566 2061 7265 6128  ty.    def area(
-00001360: 7365 6c66 2920 2d3e 2066 6c6f 6174 3a0a  self) -> float:.
-00001370: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00001380: 656c 662e 5f63 656c 6c2e 6172 6561 0a0a  elf._cell.area..
-00001390: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-000013a0: 2020 6465 6620 6c61 6265 6c73 2873 656c    def labels(sel
-000013b0: 6629 202d 3e20 4c69 7374 5b4c 6162 656c  f) -> List[Label
-000013c0: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
-000013d0: 6e20 7365 6c66 2e5f 6365 6c6c 2e6c 6162  n self._cell.lab
-000013e0: 656c 730a 0a20 2020 2040 7072 6f70 6572  els..    @proper
-000013f0: 7479 0a20 2020 2064 6566 2070 6174 6873  ty.    def paths
-00001400: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00001410: 7265 7475 726e 2073 656c 662e 5f63 656c  return self._cel
-00001420: 6c2e 7061 7468 730a 0a20 2020 2040 7072  l.paths..    @pr
-00001430: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
-00001440: 616d 6528 7365 6c66 2920 2d3e 2073 7472  ame(self) -> str
-00001450: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00001460: 2073 656c 662e 5f63 656c 6c2e 6e61 6d65   self._cell.name
-00001470: 0a0a 2020 2020 406e 616d 652e 7365 7474  ..    @name.sett
-00001480: 6572 0a20 2020 2064 6566 206e 616d 6528  er.    def name(
-00001490: 7365 6c66 2c20 7661 6c75 6529 202d 3e20  self, value) -> 
-000014a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7365  None:.        se
-000014b0: 6c66 2e5f 6365 6c6c 2e6e 616d 6520 3d20  lf._cell.name = 
-000014c0: 7661 6c75 650a 0a20 2020 2064 6566 205f  value..    def _
-000014d0: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
-000014e0: 2020 2020 2020 2022 2222 596f 7520 6361         """You ca
-000014f0: 6e20 6974 6572 6174 6520 6f76 6572 2070  n iterate over p
-00001500: 6f6c 7967 6f6e 732c 2070 6174 6873 2c20  olygons, paths, 
-00001510: 6c61 6265 6c73 2061 6e64 2072 6566 6572  labels and refer
-00001520: 656e 6365 732e 2222 220a 2020 2020 2020  ences.""".      
-00001530: 2020 7265 7475 726e 2069 7465 7274 6f6f    return itertoo
-00001540: 6c73 2e63 6861 696e 2873 656c 662e 706f  ls.chain(self.po
-00001550: 6c79 676f 6e73 2c20 7365 6c66 2e70 6174  lygons, self.pat
-00001560: 6873 2c20 7365 6c66 2e6c 6162 656c 732c  hs, self.labels,
-00001570: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
-00001580: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
-00001590: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
-000015a0: 2073 656c 662c 0a20 2020 2020 2020 2062   self,.        b
-000015b0: 795f 7370 6563 3a20 556e 696f 6e5b 626f  y_spec: Union[bo
-000015c0: 6f6c 2c20 5475 706c 655b 696e 742c 2069  ol, Tuple[int, i
-000015d0: 6e74 5d5d 203d 2046 616c 7365 2c0a 2020  nt]] = False,.  
-000015e0: 2020 2020 2020 6465 7074 683a 204f 7074        depth: Opt
-000015f0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-00001600: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
-00001610: 6465 5f70 6174 6873 3a20 626f 6f6c 203d  de_paths: bool =
-00001620: 2054 7275 652c 0a20 2020 2020 2020 2061   True,.        a
-00001630: 735f 6172 7261 793a 2062 6f6f 6c20 3d20  s_array: bool = 
-00001640: 5472 7565 2c0a 2020 2020 2920 2d3e 2055  True,.    ) -> U
-00001650: 6e69 6f6e 5b4c 6973 745b 506f 6c79 676f  nion[List[Polygo
-00001660: 6e5d 2c20 4469 6374 5b54 7570 6c65 5b69  n], Dict[Tuple[i
-00001670: 6e74 2c20 696e 745d 2c20 4c69 7374 5b50  nt, int], List[P
-00001680: 6f6c 7967 6f6e 5d5d 5d3a 0a20 2020 2020  olygon]]]:.     
-00001690: 2020 2022 2222 5265 7475 726e 2061 206c     """Return a l
-000016a0: 6973 7420 6f66 2070 6f6c 7967 6f6e 7320  ist of polygons 
-000016b0: 696e 2074 6869 7320 6365 6c6c 2e0a 0a20  in this cell... 
-000016c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000016d0: 2020 2020 2020 2020 2062 795f 7370 6563           by_spec
-000016e0: 3a20 626f 6f6c 206f 7220 6c61 7965 720a  : bool or layer.
-000016f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001700: 4966 2054 7275 652c 2074 6865 2072 6574  If True, the ret
-00001710: 7572 6e20 7661 6c75 6520 6973 2061 2064  urn value is a d
-00001720: 6963 7469 6f6e 6172 7920 7769 7468 2074  ictionary with t
-00001730: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-00001740: 2020 2070 6f6c 7967 6f6e 7320 6f66 2065     polygons of e
-00001750: 6163 6820 696e 6469 7669 6475 616c 2070  ach individual p
-00001760: 6169 7220 286c 6179 6572 2c20 6461 7461  air (layer, data
-00001770: 7479 7065 292c 2077 6869 6368 0a20 2020  type), which.   
-00001780: 2020 2020 2020 2020 2020 2020 2061 7265               are
-00001790: 2075 7365 6420 6173 206b 6579 732e 2020   used as keys.  
-000017a0: 4966 2073 6574 2074 6f20 6120 7475 706c  If set to a tupl
-000017b0: 6520 6f66 2028 6c61 7965 722c 2064 6174  e of (layer, dat
-000017c0: 6174 7970 6529 2c0a 2020 2020 2020 2020  atype),.        
-000017d0: 2020 2020 2020 2020 6f6e 6c79 2070 6f6c          only pol
-000017e0: 7967 6f6e 7320 7769 7468 2074 6861 7420  ygons with that 
-000017f0: 7370 6563 6966 6963 6174 696f 6e20 6172  specification ar
-00001800: 6520 7265 7475 726e 6564 2e0a 2020 2020  e returned..    
-00001810: 2020 2020 2020 2020 6465 7074 683a 2069          depth: i
-00001820: 6e74 6567 6572 206f 7220 4e6f 6e65 0a20  nteger or None. 
-00001830: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-00001840: 6620 6e6f 7420 4e6f 6e65 2c20 6465 6669  f not None, defi
-00001850: 6e65 7320 6672 6f6d 2068 6f77 206d 616e  nes from how man
-00001860: 7920 7265 6665 7265 6e63 6520 6c65 7665  y reference leve
-00001870: 6c73 2074 6f0a 2020 2020 2020 2020 2020  ls to.          
-00001880: 2020 2020 2020 7265 7472 6965 7665 2070        retrieve p
-00001890: 6f6c 7967 6f6e 732e 2020 5265 6665 7265  olygons.  Refere
-000018a0: 6e63 6573 2062 656c 6f77 2074 6869 7320  nces below this 
-000018b0: 6c65 7665 6c20 7769 6c6c 2072 6573 756c  level will resul
-000018c0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000018d0: 2020 696e 2061 2062 6f75 6e64 696e 6720    in a bounding 
-000018e0: 626f 782e 2020 4966 2060 6279 5f73 7065  box.  If `by_spe
-000018f0: 6360 2069 7320 5472 7565 2074 6865 206b  c` is True the k
-00001900: 6579 2077 696c 6c20 6265 2074 6865 0a20  ey will be the. 
-00001910: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00001920: 616d 6520 6f66 2074 6869 7320 6365 6c6c  ame of this cell
-00001930: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-00001940: 636c 7564 655f 7061 7468 733a 2049 6620  clude_paths: If 
-00001950: 5472 7565 2c20 706f 6c79 676f 6e61 6c20  True, polygonal 
-00001960: 7265 7072 6573 656e 7461 7469 6f6e 206f  representation o
-00001970: 6620 7061 7468 7320 6172 6520 616c 736f  f paths are also
-00001980: 2069 6e63 6c75 6465 6420 696e 2074 6865   included in the
-00001990: 2072 6573 756c 742e 0a20 2020 2020 2020   result..       
-000019a0: 2020 2020 2061 735f 6172 7261 793a 2077       as_array: w
-000019b0: 6865 6e20 6173 5f61 7272 6179 3d66 616c  hen as_array=fal
-000019c0: 7365 2c20 7265 7475 726e 2074 6865 2050  se, return the P
-000019d0: 6f6c 7967 6f6e 206f 626a 6563 7473 2069  olygon objects i
-000019e0: 6e73 7465 6164 2e0a 2020 2020 2020 2020  nstead..        
-000019f0: 2020 2020 2020 2020 706f 6c79 676f 6e20          polygon 
-00001a00: 6f62 6a65 6374 7320 6861 7665 206d 6f72  objects have mor
-00001a10: 6520 696e 666f 726d 6174 696f 6e20 2865  e information (e
-00001a20: 7370 6563 6961 6c6c 7920 7768 656e 2062  specially when b
-00001a30: 795f 7370 6563 3d46 616c 7365 2920 616e  y_spec=False) an
-00001a40: 6420 6172 6520 6661 7374 6572 2074 6f20  d are faster to 
-00001a50: 7265 7472 6965 7665 2e0a 0a20 2020 2020  retrieve...     
-00001a60: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00001a70: 2020 2020 2020 206f 7574 3a20 6c69 7374         out: list
-00001a80: 206f 6620 6172 7261 792d 6c69 6b65 5b4e   of array-like[N
-00001a90: 5d5b 325d 206f 7220 6469 6374 696f 6e61  ][2] or dictiona
-00001aa0: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
-00001ab0: 2020 204c 6973 7420 636f 6e74 6169 6e69     List containi
-00001ac0: 6e67 2074 6865 2063 6f6f 7264 696e 6174  ng the coordinat
-00001ad0: 6573 206f 6620 7468 6520 7665 7274 6963  es of the vertic
-00001ae0: 6573 206f 6620 6561 6368 0a20 2020 2020  es of each.     
-00001af0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00001b00: 6f6e 2c20 6f72 2064 6963 7469 6f6e 6172  on, or dictionar
-00001b10: 7920 7769 7468 2077 6974 6820 7468 6520  y with with the 
-00001b20: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
-00001b30: 2028 6966 0a20 2020 2020 2020 2020 2020   (if.           
-00001b40: 2020 2020 2060 6279 5f73 7065 6360 2069       `by_spec` i
-00001b50: 7320 5472 7565 292e 0a0a 2020 2020 2020  s True)...      
-00001b60: 2020 4e6f 7465 3a0a 2020 2020 2020 2020    Note:.        
-00001b70: 2020 2020 496e 7374 616e 6365 7320 6f66      Instances of
-00001b80: 2060 466c 6578 5061 7468 6020 616e 6420   `FlexPath` and 
-00001b90: 6052 6f62 7573 7450 6174 6860 2061 7265  `RobustPath` are
-00001ba0: 2061 6c73 6f20 696e 636c 7564 6564 2069   also included i
-00001bb0: 6e0a 2020 2020 2020 2020 2020 2020 7468  n.            th
-00001bc0: 6520 7265 7375 6c74 2062 7920 636f 6d70  e result by comp
-00001bd0: 7574 696e 6720 7468 6569 7220 706f 6c79  uting their poly
-00001be0: 676f 6e61 6c20 626f 756e 6461 7279 2e0a  gonal boundary..
-00001bf0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00001c00: 2020 2020 7265 7475 726e 2067 6574 5f70      return get_p
-00001c10: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
-00001c20: 2020 2020 2069 6e73 7461 6e63 653d 7365       instance=se
-00001c30: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00001c40: 6279 5f73 7065 633d 6279 5f73 7065 632c  by_spec=by_spec,
-00001c50: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-00001c60: 7468 3d64 6570 7468 2c0a 2020 2020 2020  th=depth,.      
-00001c70: 2020 2020 2020 696e 636c 7564 655f 7061        include_pa
-00001c80: 7468 733d 696e 636c 7564 655f 7061 7468  ths=include_path
-00001c90: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
-00001ca0: 735f 6172 7261 793d 6173 5f61 7272 6179  s_array=as_array
-00001cb0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00001cc0: 2064 6566 2067 6574 5f64 6570 656e 6465   def get_depende
-00001cd0: 6e63 6965 7328 7365 6c66 2c20 7265 6375  ncies(self, recu
-00001ce0: 7273 6976 653a 2062 6f6f 6c20 3d20 4661  rsive: bool = Fa
-00001cf0: 6c73 6529 202d 3e20 4c69 7374 5b43 6f6d  lse) -> List[Com
-00001d00: 706f 6e65 6e74 5d3a 0a20 2020 2020 2020  ponent]:.       
-00001d10: 2022 2222 5265 7475 726e 2061 2073 6574   """Return a set
-00001d20: 206f 6620 7468 6520 6365 6c6c 7320 696e   of the cells in
-00001d30: 636c 7564 6564 2069 6e20 7468 6973 2063  cluded in this c
-00001d40: 656c 6c20 6173 2072 6566 6572 656e 6365  ell as reference
-00001d50: 732e 0a0a 2020 2020 2020 2020 4172 6773  s...        Args
-00001d60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00001d70: 6375 7273 6976 653a 2049 6620 5472 7565  cursive: If True
-00001d80: 2072 6574 7572 6e73 2064 6570 656e 6465   returns depende
-00001d90: 6e63 6965 7320 7265 6375 7273 6976 656c  ncies recursivel
-00001da0: 792e 0a0a 2020 2020 2020 2020 5265 7475  y...        Retu
-00001db0: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
-00001dc0: 206f 7574 3a20 6c69 7374 206f 6620 436f   out: list of Co
-00001dd0: 6d70 6f6e 656e 7473 2072 6566 6572 656e  mponents referen
-00001de0: 6365 6420 6279 2074 6869 7320 436f 6d70  ced by this Comp
-00001df0: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
-00001e00: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-00001e10: 7420 7265 6375 7273 6976 653a 0a20 2020  t recursive:.   
-00001e20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00001e30: 6c69 7374 287b 7265 662e 7061 7265 6e74  list({ref.parent
-00001e40: 2066 6f72 2072 6566 2069 6e20 7365 6c66   for ref in self
-00001e50: 2e72 6566 6572 656e 6365 737d 290a 0a20  .references}).. 
-00001e60: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00001e70: 735f 7365 7420 3d20 7365 7428 290a 2020  s_set = set().  
-00001e80: 2020 2020 2020 5f67 6574 5f64 6570 656e        _get_depen
-00001e90: 6465 6e63 6965 7328 7365 6c66 2c20 7265  dencies(self, re
-00001ea0: 6665 7265 6e63 6573 5f73 6574 3d72 6566  ferences_set=ref
-00001eb0: 6572 656e 6365 735f 7365 7429 0a20 2020  erences_set).   
-00001ec0: 2020 2020 2072 6574 7572 6e20 6c69 7374       return list
-00001ed0: 2872 6566 6572 656e 6365 735f 7365 7429  (references_set)
-00001ee0: 0a0a 2020 2020 6465 6620 6765 745f 636f  ..    def get_co
-00001ef0: 6d70 6f6e 656e 745f 7370 6563 2873 656c  mponent_spec(sel
-00001f00: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00001f10: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-00001f20: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00001f30: 2020 2022 636f 6d70 6f6e 656e 7422 3a20     "component": 
-00001f40: 7365 6c66 2e73 6574 7469 6e67 732e 6675  self.settings.fu
-00001f50: 6e63 7469 6f6e 5f6e 616d 652c 0a20 2020  nction_name,.   
-00001f60: 2020 2020 2020 2020 2020 2020 2022 7365               "se
-00001f70: 7474 696e 6773 223a 2073 656c 662e 7365  ttings": self.se
-00001f80: 7474 696e 6773 2e63 6861 6e67 6564 2c0a  ttings.changed,.
-00001f90: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00001fa0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00001fb0: 662e 7365 7474 696e 6773 0a20 2020 2020  f.settings.     
-00001fc0: 2020 2020 2020 2065 6c73 6520 7b22 636f         else {"co
-00001fd0: 6d70 6f6e 656e 7422 3a20 7365 6c66 2e6e  mponent": self.n
-00001fe0: 616d 652c 2022 7365 7474 696e 6773 223a  ame, "settings":
-00001ff0: 207b 7d7d 0a20 2020 2020 2020 2029 0a0a   {}}.        )..
-00002000: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
-00002010: 6d5f 5f28 7365 6c66 2c20 6b65 7929 3a0a  m__(self, key):.
-00002020: 2020 2020 2020 2020 2222 2241 6363 6573          """Acces
-00002030: 7320 7265 6665 7265 6e63 6520 706f 7274  s reference port
-00002040: 732e 2222 220a 2020 2020 2020 2020 6966  s.""".        if
-00002050: 206b 6579 206e 6f74 2069 6e20 7365 6c66   key not in self
-00002060: 2e70 6f72 7473 3a0a 2020 2020 2020 2020  .ports:.        
-00002070: 2020 2020 706f 7274 7320 3d20 6c69 7374      ports = list
-00002080: 2873 656c 662e 706f 7274 732e 6b65 7973  (self.ports.keys
-00002090: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-000020a0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000020b0: 2866 227b 6b65 7921 727d 206e 6f74 2069  (f"{key!r} not i
-000020c0: 6e20 7b70 6f72 7473 7d22 290a 0a20 2020  n {ports}")..   
-000020d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000020e0: 2e70 6f72 7473 5b6b 6579 5d0a 0a20 2020  .ports[key]..   
-000020f0: 2064 6566 205f 5f6c 7368 6966 745f 5f28   def __lshift__(
-00002100: 7365 6c66 2c20 656c 656d 656e 7429 3a0a  self, element):.
-00002110: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
-00002120: 6e69 656e 6365 206f 7065 7261 746f 7220  nience operator 
-00002130: 6571 7569 7661 6c65 6e74 2074 6f20 6164  equivalent to ad
-00002140: 645f 7265 6628 292e 2222 220a 2020 2020  d_ref().""".    
-00002150: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00002160: 6164 645f 7265 6628 656c 656d 656e 7429  add_ref(element)
-00002170: 0a0a 2020 2020 6465 6620 756e 6c6f 636b  ..    def unlock
-00002180: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00002190: 2020 2020 2020 2020 2222 224f 6e6c 7920          """Only 
-000021a0: 646f 2074 6869 7320 6966 2079 6f75 206b  do this if you k
-000021b0: 6e6f 7720 7768 6174 2079 6f75 2061 7265  now what you are
-000021c0: 2064 6f69 6e67 2e22 2222 0a20 2020 2020   doing.""".     
-000021d0: 2020 2073 656c 662e 5f6c 6f63 6b65 6420     self._locked 
-000021e0: 3d20 4661 6c73 650a 0a20 2020 2064 6566  = False..    def
-000021f0: 206c 6f63 6b28 7365 6c66 2920 2d3e 204e   lock(self) -> N
-00002200: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00002210: 4d61 6b65 7320 7375 7265 2063 6f6d 706f  Makes sure compo
-00002220: 6e65 6e74 7320 6361 6e27 7420 6164 6420  nents can't add 
-00002230: 6e65 7720 656c 656d 656e 7473 206f 7220  new elements or 
-00002240: 6d6f 7665 2065 7869 7374 696e 6720 6f6e  move existing on
-00002250: 6573 2e0a 0a20 2020 2020 2020 2043 6f6d  es...        Com
-00002260: 706f 6e65 6e74 7320 6c6f 636b 2061 7574  ponents lock aut
-00002270: 6f6d 6174 6963 616c 6c79 2077 6865 6e20  omatically when 
-00002280: 676f 696e 6720 696e 746f 2074 6865 2043  going into the C
-00002290: 4143 4845 2074 6f0a 2020 2020 2020 2020  ACHE to.        
-000022a0: 656e 7375 7265 206f 6e65 2063 6f6d 706f  ensure one compo
-000022b0: 6e65 6e74 2064 6f65 7320 6e6f 7420 6368  nent does not ch
-000022c0: 616e 6765 206f 7468 6572 730a 2020 2020  ange others.    
-000022d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000022e0: 7365 6c66 2e5f 6c6f 636b 6564 203d 2054  self._locked = T
-000022f0: 7275 650a 0a20 2020 2064 6566 205f 5f73  rue..    def __s
-00002300: 6574 6974 656d 5f5f 2873 656c 662c 206b  etitem__(self, k
-00002310: 6579 2c20 656c 656d 656e 7429 3a0a 2020  ey, element):.  
-00002320: 2020 2020 2020 2222 2241 6c6c 6f77 2061        """Allow a
-00002330: 6464 696e 6720 706f 6c79 676f 6e73 2061  dding polygons a
-00002340: 6e64 2063 656c 6c20 7265 6665 7265 6e63  nd cell referenc
-00002350: 6573 2e0a 0a20 2020 2020 2020 206c 696b  es...        lik
-00002360: 6520 445b 2761 7263 3327 5d20 3d20 7067  e D['arc3'] = pg
-00002370: 2e61 7263 2829 0a0a 2020 2020 2020 2020  .arc()..        
-00002380: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00002390: 2020 6b65 793a 2041 6c69 6173 206e 616d    key: Alias nam
-000023a0: 652e 0a20 2020 2020 2020 2020 2020 2065  e..            e
-000023b0: 6c65 6d65 6e74 3a20 4f62 6a65 6374 2074  lement: Object t
-000023c0: 6861 7420 7769 6c6c 2062 6520 6163 6365  hat will be acce
-000023d0: 7373 6962 6c65 2062 7920 616c 6961 7320  ssible by alias 
-000023e0: 6e61 6d65 2e0a 0a20 2020 2020 2020 2022  name...        "
-000023f0: 2222 0a20 2020 2020 2020 2069 6620 6973  "".        if is
-00002400: 696e 7374 616e 6365 2865 6c65 6d65 6e74  instance(element
-00002410: 2c20 2843 6f6d 706f 6e65 6e74 5265 6665  , (ComponentRefe
-00002420: 7265 6e63 652c 2050 6f6c 7967 6f6e 2929  rence, Polygon))
-00002430: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00002440: 6c66 2e6e 616d 6564 5f72 6566 6572 656e  lf.named_referen
-00002450: 6365 735b 6b65 795d 203d 2065 6c65 6d65  ces[key] = eleme
-00002460: 6e74 0a20 2020 2020 2020 2065 6c73 653a  nt.        else:
-00002470: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00002480: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00002490: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000024a0: 2254 7269 6564 2074 6f20 6173 7369 676e  "Tried to assign
-000024b0: 2061 6c69 6173 207b 6b65 7921 727d 2069   alias {key!r} i
-000024c0: 6e20 436f 6d70 6f6e 656e 7420 7b73 656c  n Component {sel
-000024d0: 662e 6e61 6d65 2172 7d2c 220a 2020 2020  f.name!r},".    
-000024e0: 2020 2020 2020 2020 2020 2020 2262 7574              "but
-000024f0: 2066 6169 6c65 6420 6265 6361 7573 6520   failed because 
-00002500: 7468 6520 6974 656d 2077 6173 206e 6f74  the item was not
-00002510: 2061 2043 6f6d 706f 6e65 6e74 5265 6665   a ComponentRefe
-00002520: 7265 6e63 6522 0a20 2020 2020 2020 2020  rence".         
-00002530: 2020 2029 0a0a 2020 2020 4063 6c61 7373     )..    @class
-00002540: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-00002550: 5f67 6574 5f76 616c 6964 6174 6f72 735f  _get_validators_
-00002560: 5f28 636c 7329 3a0a 2020 2020 2020 2020  _(cls):.        
-00002570: 2222 2247 6574 2076 616c 6964 6174 6f72  """Get validator
-00002580: 7320 666f 7220 7468 6520 436f 6d70 6f6e  s for the Compon
-00002590: 656e 7420 6f62 6a65 6374 2e22 2222 0a20  ent object.""". 
-000025a0: 2020 2020 2020 2079 6965 6c64 2063 6c73         yield cls
-000025b0: 2e76 616c 6964 6174 650a 0a20 2020 2040  .validate..    @
-000025c0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000025d0: 6465 6620 7661 6c69 6461 7465 2863 6c73  def validate(cls
-000025e0: 2c20 7629 3a0a 2020 2020 2020 2020 2222  , v):.        ""
-000025f0: 2250 7964 616e 7469 6320 6173 7375 6d65  "Pydantic assume
-00002600: 7320 636f 6d70 6f6e 656e 7420 6973 2076  s component is v
-00002610: 616c 6964 2069 6620 7468 6520 666f 6c6c  alid if the foll
-00002620: 6f77 696e 6720 6172 6520 7472 7565 2e0a  owing are true..
-00002630: 0a20 2020 2020 2020 202d 206e 616d 6520  .        - name 
-00002640: 6368 6172 6163 7465 7273 203c 204d 4158  characters < MAX
-00002650: 5f4e 414d 455f 4c45 4e47 5448 0a20 2020  _NAME_LENGTH.   
-00002660: 2020 2020 202d 2069 7320 6e6f 7420 656d       - is not em
-00002670: 7074 7920 2868 6173 2072 6566 6572 656e  pty (has referen
-00002680: 6365 7320 6f72 2070 6f6c 7967 6f6e 7329  ces or polygons)
-00002690: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000026a0: 2020 2020 204d 4158 5f4e 414d 455f 4c45       MAX_NAME_LE
-000026b0: 4e47 5448 203d 2039 390a 2020 2020 2020  NGTH = 99.      
-000026c0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-000026d0: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
-000026e0: 2076 2c20 436f 6d70 6f6e 656e 740a 2020   v, Component.  
-000026f0: 2020 2020 2020 292c 2066 2254 7970 6545        ), f"TypeE
-00002700: 7272 6f72 2c20 476f 7420 7b74 7970 6528  rror, Got {type(
-00002710: 7629 7d2c 2065 7870 6563 7469 6e67 2043  v)}, expecting C
-00002720: 6f6d 706f 6e65 6e74 220a 2020 2020 2020  omponent".      
-00002730: 2020 6173 7365 7274 2028 0a20 2020 2020    assert (.     
-00002740: 2020 2020 2020 206c 656e 2876 2e6e 616d         len(v.nam
-00002750: 6529 203c 3d20 4d41 585f 4e41 4d45 5f4c  e) <= MAX_NAME_L
-00002760: 454e 4754 480a 2020 2020 2020 2020 292c  ENGTH.        ),
-00002770: 2066 226e 616d 6520 607b 762e 6e61 6d65   f"name `{v.name
-00002780: 7d60 207b 6c65 6e28 762e 6e61 6d65 297d  }` {len(v.name)}
-00002790: 203e 207b 4d41 585f 4e41 4d45 5f4c 454e   > {MAX_NAME_LEN
-000027a0: 4754 487d 2022 0a20 2020 2020 2020 2072  GTH} ".        r
-000027b0: 6574 7572 6e20 760a 0a20 2020 2040 7072  eturn v..    @pr
-000027c0: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
-000027d0: 616d 6564 5f72 6566 6572 656e 6365 7328  amed_references(
-000027e0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-000027f0: 6574 7572 6e20 7365 6c66 2e5f 6e61 6d65  eturn self._name
-00002800: 645f 7265 6665 7265 6e63 6573 0a0a 2020  d_references..  
-00002810: 2020 6465 6620 6164 645f 6c61 6265 6c28    def add_label(
-00002820: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00002830: 2020 2020 2020 2074 6578 743a 2073 7472         text: str
-00002840: 203d 2022 6865 6c6c 6f22 2c0a 2020 2020   = "hello",.    
-00002850: 2020 2020 706f 7369 7469 6f6e 3a20 5475      position: Tu
-00002860: 706c 655b 666c 6f61 742c 2066 6c6f 6174  ple[float, float
-00002870: 5d20 3d20 2830 2e30 2c20 302e 3029 2c0a  ] = (0.0, 0.0),.
-00002880: 2020 2020 2020 2020 6d61 676e 6966 6963          magnific
-00002890: 6174 696f 6e3a 2066 6c6f 6174 203d 2031  ation: float = 1
-000028a0: 2e30 2c0a 2020 2020 2020 2020 726f 7461  .0,.        rota
-000028b0: 7469 6f6e 3a20 666c 6f61 7420 3d20 302c  tion: float = 0,
-000028c0: 0a20 2020 2020 2020 2061 6e63 686f 723a  .        anchor:
-000028d0: 2073 7472 203d 2022 6f22 2c0a 2020 2020   str = "o",.    
-000028e0: 2020 2020 6c61 7965 723d 2254 4558 5422      layer="TEXT"
-000028f0: 2c0a 2020 2020 2020 2020 785f 7265 666c  ,.        x_refl
-00002900: 6563 7469 6f6e 3d46 616c 7365 2c0a 2020  ection=False,.  
-00002910: 2020 2920 2d3e 204c 6162 656c 3a0a 2020    ) -> Label:.  
-00002920: 2020 2020 2020 2222 2241 6464 7320 4c61        """Adds La
-00002930: 6265 6c20 746f 2074 6865 2043 6f6d 706f  bel to the Compo
-00002940: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
-00002950: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00002960: 2074 6578 743a 204c 6162 656c 2074 6578   text: Label tex
-00002970: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
-00002980: 6f73 6974 696f 6e3a 2078 2d2c 2079 2d63  osition: x-, y-c
-00002990: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
-000029a0: 6520 4c61 6265 6c20 6c6f 6361 7469 6f6e  e Label location
-000029b0: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
-000029c0: 676e 6966 6963 6174 696f 6e3a 204d 6167  gnification: Mag
-000029d0: 6e69 6669 6361 7469 6f6e 2066 6163 746f  nification facto
-000029e0: 7220 666f 7220 7468 6520 4c61 6265 6c20  r for the Label 
-000029f0: 7465 7874 2e0a 2020 2020 2020 2020 2020  text..          
-00002a00: 2020 726f 7461 7469 6f6e 3a20 416e 676c    rotation: Angl
-00002a10: 6520 726f 7461 7469 6f6e 206f 6620 7468  e rotation of th
-00002a20: 6520 4c61 6265 6c20 7465 7874 2e0a 2020  e Label text..  
-00002a30: 2020 2020 2020 2020 2020 616e 6368 6f72            anchor
-00002a40: 3a20 7b27 6e27 2c20 2765 272c 2027 7327  : {'n', 'e', 's'
-00002a50: 2c20 2777 272c 2027 6f27 2c20 276e 6527  , 'w', 'o', 'ne'
-00002a60: 2c20 276e 7727 2c20 2e2e 2e7d 0a20 2020  , 'nw', ...}.   
-00002a70: 2020 2020 2020 2020 2020 2020 2050 6f73               Pos
-00002a80: 6974 696f 6e20 6f66 2074 6865 2061 6e63  ition of the anc
-00002a90: 686f 7220 7265 6c61 7469 7665 2074 6f20  hor relative to 
-00002aa0: 7468 6520 7465 7874 2e0a 2020 2020 2020  the text..      
-00002ab0: 2020 2020 2020 6c61 7965 723a 2053 7065        layer: Spe
-00002ac0: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
-00002ad0: 6f20 7075 7420 4c61 6265 6c20 6f6e 2e0a  o put Label on..
-00002ae0: 2020 2020 2020 2020 2020 2020 785f 7265              x_re
-00002af0: 666c 6563 7469 6f6e 3a20 5472 7565 2072  flection: True r
-00002b00: 6566 6c65 6374 7320 6163 726f 7373 2074  eflects across t
-00002b10: 6865 2068 6f72 697a 6f6e 7461 6c20 6178  he horizontal ax
-00002b20: 6973 2062 6566 6f72 6520 726f 7461 7469  is before rotati
-00002b30: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
-00002b40: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00002b50: 6661 6374 6f72 792e 7064 6b20 696d 706f  factory.pdk impo
-00002b60: 7274 2067 6574 5f6c 6179 6572 0a0a 2020  rt get_layer..  
-00002b70: 2020 2020 2020 6c61 7965 7220 3d20 6765        layer = ge
-00002b80: 745f 6c61 7965 7228 6c61 7965 7229 0a0a  t_layer(layer)..
-00002b90: 2020 2020 2020 2020 6764 735f 6c61 7965          gds_laye
-00002ba0: 722c 2067 6473 5f64 6174 6174 7970 6520  r, gds_datatype 
-00002bb0: 3d20 6c61 7965 720a 0a20 2020 2020 2020  = layer..       
-00002bc0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00002bd0: 6365 2874 6578 742c 2073 7472 293a 0a20  ce(text, str):. 
-00002be0: 2020 2020 2020 2020 2020 2074 6578 7420             text 
-00002bf0: 3d20 7465 7874 0a20 2020 2020 2020 206c  = text.        l
-00002c00: 6162 656c 203d 204c 6162 656c 280a 2020  abel = Label(.  
-00002c10: 2020 2020 2020 2020 2020 7465 7874 3d74            text=t
-00002c20: 6578 742c 0a20 2020 2020 2020 2020 2020  ext,.           
-00002c30: 206f 7269 6769 6e3d 706f 7369 7469 6f6e   origin=position
-00002c40: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
-00002c50: 6368 6f72 3d61 6e63 686f 722c 0a20 2020  chor=anchor,.   
-00002c60: 2020 2020 2020 2020 206d 6167 6e69 6669           magnifi
-00002c70: 6361 7469 6f6e 3d6d 6167 6e69 6669 6361  cation=magnifica
-00002c80: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00002c90: 2020 726f 7461 7469 6f6e 3d72 6f74 6174    rotation=rotat
-00002ca0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-00002cb0: 206c 6179 6572 3d67 6473 5f6c 6179 6572   layer=gds_layer
-00002cc0: 2c0a 2020 2020 2020 2020 2020 2020 7465  ,.            te
-00002cd0: 7874 7479 7065 3d67 6473 5f64 6174 6174  xttype=gds_datat
-00002ce0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-00002cf0: 2078 5f72 6566 6c65 6374 696f 6e3d 785f   x_reflection=x_
-00002d00: 7265 666c 6563 7469 6f6e 2c0a 2020 2020  reflection,.    
-00002d10: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
-00002d20: 6c66 2e61 6464 286c 6162 656c 290a 2020  lf.add(label).  
-00002d30: 2020 2020 2020 7265 7475 726e 206c 6162        return lab
-00002d40: 656c 0a0a 2020 2020 4070 726f 7065 7274  el..    @propert
-00002d50: 790a 2020 2020 6465 6620 6262 6f78 2873  y.    def bbox(s
-00002d60: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00002d70: 2252 6574 7572 6e73 2074 6865 2062 6f75  "Returns the bou
-00002d80: 6e64 696e 6720 626f 7820 6f66 2074 6865  nding box of the
-00002d90: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
-00002da0: 6e63 652e 0a0a 2020 2020 2020 2020 6974  nce...        it
-00002db0: 2073 6e61 7073 2074 6f20 3320 6465 6369   snaps to 3 deci
-00002dc0: 6d61 6c73 2069 6e20 756d 2028 302e 3030  mals in um (0.00
-00002dd0: 3175 6d20 3d20 316e 6d20 7072 6563 6973  1um = 1nm precis
-00002de0: 696f 6e29 0a20 2020 2020 2020 2022 2222  ion).        """
-00002df0: 0a20 2020 2020 2020 2062 626f 7820 3d20  .        bbox = 
-00002e00: 7365 6c66 2e5f 6365 6c6c 2e62 6f75 6e64  self._cell.bound
-00002e10: 696e 675f 626f 7828 290a 2020 2020 2020  ing_box().      
-00002e20: 2020 6966 2062 626f 7820 6973 204e 6f6e    if bbox is Non
-00002e30: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
-00002e40: 626f 7820 3d20 2828 302c 2030 292c 2028  box = ((0, 0), (
-00002e50: 302c 2030 2929 0a20 2020 2020 2020 2072  0, 0)).        r
-00002e60: 6574 7572 6e20 6e70 2e72 6f75 6e64 2862  eturn np.round(b
-00002e70: 626f 782c 2033 290a 0a20 2020 2040 7072  box, 3)..    @pr
-00002e80: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
-00002e90: 6f72 7473 5f6c 6179 6572 2873 656c 6629  orts_layer(self)
-00002ea0: 202d 3e20 4469 6374 5b73 7472 2c20 7374   -> Dict[str, st
-00002eb0: 725d 3a0a 2020 2020 2020 2020 2222 2252  r]:.        """R
-00002ec0: 6574 7572 6e73 2061 206d 6170 7069 6e67  eturns a mapping
-00002ed0: 2066 726f 6d20 6c61 7965 7230 5f6c 6179   from layer0_lay
-00002ee0: 6572 315f 4530 3a20 706f 7274 4e61 6d65  er1_E0: portName
-00002ef0: 2e22 2222 0a20 2020 2020 2020 2072 6574  .""".        ret
-00002f00: 7572 6e20 6d61 705f 706f 7274 735f 6c61  urn map_ports_la
-00002f10: 7965 725f 746f 5f6f 7269 656e 7461 7469  yer_to_orientati
-00002f20: 6f6e 2873 656c 662e 706f 7274 7329 0a0a  on(self.ports)..
-00002f30: 2020 2020 6465 6620 706f 7274 5f62 795f      def port_by_
-00002f40: 6f72 6965 6e74 6174 696f 6e5f 6377 2873  orientation_cw(s
-00002f50: 656c 662c 206b 6579 3a20 7374 722c 202a  elf, key: str, *
-00002f60: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00002f70: 2020 2222 2252 6574 7572 6e73 2070 6f72    """Returns por
-00002f80: 7420 6279 2069 6e64 6578 696e 6720 7468  t by indexing th
-00002f90: 656d 2063 6c6f 636b 7769 7365 2e22 2222  em clockwise."""
-00002fa0: 0a20 2020 2020 2020 206d 203d 206d 6170  .        m = map
-00002fb0: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
-00002fc0: 6174 696f 6e5f 6377 2873 656c 662e 706f  ation_cw(self.po
-00002fd0: 7274 732c 202a 2a6b 7761 7267 7329 0a20  rts, **kwargs). 
-00002fe0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-00002ff0: 7420 696e 206d 3a0a 2020 2020 2020 2020  t in m:.        
-00003000: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
-00003010: 6f72 2866 227b 6b65 797d 206e 6f74 2069  or(f"{key} not i
-00003020: 6e20 7b6c 6973 7428 6d2e 6b65 7973 2829  n {list(m.keys()
-00003030: 297d 2229 0a20 2020 2020 2020 206b 6579  )}").        key
-00003040: 3220 3d20 6d5b 6b65 795d 0a20 2020 2020  2 = m[key].     
-00003050: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
-00003060: 6f72 7473 5b6b 6579 325d 0a0a 2020 2020  orts[key2]..    
-00003070: 6465 6620 706f 7274 5f62 795f 6f72 6965  def port_by_orie
-00003080: 6e74 6174 696f 6e5f 6363 7728 7365 6c66  ntation_ccw(self
-00003090: 2c20 6b65 793a 2073 7472 2c20 2a2a 6b77  , key: str, **kw
-000030a0: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-000030b0: 2222 5265 7475 726e 7320 706f 7274 2062  ""Returns port b
-000030c0: 7920 696e 6465 7869 6e67 2074 6865 6d20  y indexing them 
-000030d0: 636c 6f63 6b77 6973 652e 2222 220a 2020  clockwise.""".  
-000030e0: 2020 2020 2020 6d20 3d20 6d61 705f 706f        m = map_po
-000030f0: 7274 735f 746f 5f6f 7269 656e 7461 7469  rts_to_orientati
-00003100: 6f6e 5f63 6377 2873 656c 662e 706f 7274  on_ccw(self.port
-00003110: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
-00003120: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
-00003130: 696e 206d 3a0a 2020 2020 2020 2020 2020  in m:.          
-00003140: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
-00003150: 2866 227b 6b65 797d 206e 6f74 2069 6e20  (f"{key} not in 
-00003160: 7b6c 6973 7428 6d2e 6b65 7973 2829 297d  {list(m.keys())}
-00003170: 2229 0a20 2020 2020 2020 206b 6579 3220  ").        key2 
-00003180: 3d20 6d5b 6b65 795d 0a20 2020 2020 2020  = m[key].       
-00003190: 2072 6574 7572 6e20 7365 6c66 2e70 6f72   return self.por
-000031a0: 7473 5b6b 6579 325d 0a0a 2020 2020 6465  ts[key2]..    de
-000031b0: 6620 6765 745f 706f 7274 735f 7873 697a  f get_ports_xsiz
-000031c0: 6528 7365 6c66 2c20 2a2a 6b77 6172 6773  e(self, **kwargs
-000031d0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
-000031e0: 2020 2020 2222 2252 6574 7572 6e73 2078      """Returns x
-000031f0: 6469 7374 616e 6365 2066 726f 6d20 6561  distance from ea
-00003200: 7374 2074 6f20 7765 7374 2070 6f72 7473  st to west ports
-00003210: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
-00003220: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
-00003230: 2020 2020 206c 6179 6572 3a20 706f 7274       layer: port
-00003240: 2047 4453 206c 6179 6572 2e0a 2020 2020   GDS layer..    
-00003250: 2020 2020 2020 2020 7072 6566 6978 3a20          prefix: 
-00003260: 7769 7468 2069 6e20 706f 7274 206e 616d  with in port nam
-00003270: 652e 0a20 2020 2020 2020 2020 2020 206f  e..            o
-00003280: 7269 656e 7461 7469 6f6e 3a20 696e 2064  rientation: in d
-00003290: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
-000032a0: 2020 2020 7769 6474 683a 2070 6f72 7420      width: port 
-000032b0: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
-000032c0: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
-000032d0: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
-000032e0: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
-000032f0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
-00003300: 7479 7065 3a20 6f70 7469 6361 6c2c 2065  type: optical, e
-00003310: 6c65 6374 7269 6361 6c2c 202e 2e2e 0a20  lectrical, .... 
-00003320: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00003330: 2020 2070 6f72 7473 5f63 7720 3d20 7365     ports_cw = se
-00003340: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
-00003350: 7428 636c 6f63 6b77 6973 653d 5472 7565  t(clockwise=True
-00003360: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-00003370: 2020 2020 706f 7274 735f 6363 7720 3d20      ports_ccw = 
-00003380: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
-00003390: 6973 7428 636c 6f63 6b77 6973 653d 4661  ist(clockwise=Fa
-000033a0: 6c73 652c 202a 2a6b 7761 7267 7329 0a20  lse, **kwargs). 
-000033b0: 2020 2020 2020 2072 6574 7572 6e20 736e         return sn
-000033c0: 6170 5f74 6f5f 6772 6964 2870 6f72 7473  ap_to_grid(ports
-000033d0: 5f63 6377 5b30 5d2e 7820 2d20 706f 7274  _ccw[0].x - port
-000033e0: 735f 6377 5b30 5d2e 7829 0a0a 2020 2020  s_cw[0].x)..    
-000033f0: 6465 6620 6765 745f 706f 7274 735f 7973  def get_ports_ys
-00003400: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
-00003410: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
-00003420: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00003430: 2079 6469 7374 616e 6365 2066 726f 6d20   ydistance from 
-00003440: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
-00003450: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
-00003460: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
-00003470: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
-00003480: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
-00003490: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-000034a0: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
-000034b0: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-000034c0: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
-000034d0: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
-000034e0: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
-000034f0: 7420 7769 6474 6820 2875 6d29 2e0a 2020  t width (um)..  
-00003500: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
-00003510: 5f65 7863 6c75 6465 643a 204c 6973 7420  _excluded: List 
-00003520: 6f66 206c 6179 6572 7320 746f 2065 7863  of layers to exc
-00003530: 6c75 6465 2e0a 2020 2020 2020 2020 2020  lude..          
-00003540: 2020 706f 7274 5f74 7970 653a 206f 7074    port_type: opt
-00003550: 6963 616c 2c20 656c 6563 7472 6963 616c  ical, electrical
-00003560: 2c20 2e2e 2e0a 2020 2020 2020 2020 2222  , ....        ""
-00003570: 220a 2020 2020 2020 2020 706f 7274 735f  ".        ports_
-00003580: 6377 203d 2073 656c 662e 6765 745f 706f  cw = self.get_po
-00003590: 7274 735f 6c69 7374 2863 6c6f 636b 7769  rts_list(clockwi
-000035a0: 7365 3d54 7275 652c 202a 2a6b 7761 7267  se=True, **kwarg
-000035b0: 7329 0a20 2020 2020 2020 2070 6f72 7473  s).        ports
-000035c0: 5f63 6377 203d 2073 656c 662e 6765 745f  _ccw = self.get_
-000035d0: 706f 7274 735f 6c69 7374 2863 6c6f 636b  ports_list(clock
-000035e0: 7769 7365 3d46 616c 7365 2c20 2a2a 6b77  wise=False, **kw
-000035f0: 6172 6773 290a 2020 2020 2020 2020 7265  args).        re
-00003600: 7475 726e 2073 6e61 705f 746f 5f67 7269  turn snap_to_gri
-00003610: 6428 706f 7274 735f 6363 775b 305d 2e79  d(ports_ccw[0].y
-00003620: 202d 2070 6f72 7473 5f63 775b 305d 2e79   - ports_cw[0].y
-00003630: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
-00003640: 6e65 746c 6973 7428 0a20 2020 2020 2020  netlist(.       
-00003650: 2073 656c 662c 2077 6974 685f 6c61 6265   self, with_labe
-00003660: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
-00003670: 2066 6f6e 745f 7765 6967 6874 3a20 7374   font_weight: st
-00003680: 7220 3d20 226e 6f72 6d61 6c22 2c20 2a2a  r = "normal", **
-00003690: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
-000036a0: 2020 2020 2020 2222 2250 6c6f 7473 2061        """Plots a
-000036b0: 206e 6574 6c69 7374 2067 7261 7068 2077   netlist graph w
-000036c0: 6974 6820 6e65 7477 6f72 6b78 2e0a 0a20  ith networkx... 
-000036d0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000036e0: 2020 2020 2020 2020 2077 6974 685f 6c61           with_la
-000036f0: 6265 6c73 3a20 6164 6420 6c61 6265 6c20  bels: add label 
-00003700: 746f 2065 6163 6820 6e6f 6465 2e0a 2020  to each node..  
-00003710: 2020 2020 2020 2020 2020 666f 6e74 5f77            font_w
-00003720: 6569 6768 743a 206e 6f72 6d61 6c2c 2062  eight: normal, b
-00003730: 6f6c 642e 0a20 2020 2020 2020 2020 2020  old..           
-00003740: 202a 2a6b 7761 7267 733a 206b 6579 776f   **kwargs: keywo
-00003750: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
-00003760: 2074 6865 2067 6574 5f6e 6574 6c69 7374   the get_netlist
-00003770: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-00003780: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-00003790: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
-000037a0: 7079 706c 6f74 2061 7320 706c 740a 2020  pyplot as plt.  
-000037b0: 2020 2020 2020 696d 706f 7274 206e 6574        import net
-000037c0: 776f 726b 7820 6173 206e 780a 0a20 2020  workx as nx..   
-000037d0: 2020 2020 2070 6c74 2e66 6967 7572 6528       plt.figure(
-000037e0: 290a 2020 2020 2020 2020 6e65 746c 6973  ).        netlis
-000037f0: 7420 3d20 7365 6c66 2e67 6574 5f6e 6574  t = self.get_net
-00003800: 6c69 7374 282a 2a6b 7761 7267 7329 0a20  list(**kwargs). 
-00003810: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
-00003820: 6e73 203d 206e 6574 6c69 7374 5b22 636f  ns = netlist["co
-00003830: 6e6e 6563 7469 6f6e 7322 5d0a 2020 2020  nnections"].    
-00003840: 2020 2020 706c 6163 656d 656e 7473 203d      placements =
-00003850: 206e 6574 6c69 7374 5b22 706c 6163 656d   netlist["placem
-00003860: 656e 7473 225d 0a20 2020 2020 2020 2047  ents"].        G
-00003870: 203d 206e 782e 4772 6170 6828 290a 2020   = nx.Graph().  
-00003880: 2020 2020 2020 472e 6164 645f 6564 6765        G.add_edge
-00003890: 735f 6672 6f6d 280a 2020 2020 2020 2020  s_from(.        
-000038a0: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
-000038b0: 2020 2020 2020 2822 2c22 2e6a 6f69 6e28        (",".join(
-000038c0: 6b2e 7370 6c69 7428 222c 2229 5b3a 2d31  k.split(",")[:-1
-000038d0: 5d29 2c20 222c 222e 6a6f 696e 2876 2e73  ]), ",".join(v.s
-000038e0: 706c 6974 2822 2c22 295b 3a2d 315d 2929  plit(",")[:-1]))
-000038f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003900: 2066 6f72 206b 2c20 7620 696e 2063 6f6e   for k, v in con
-00003910: 6e65 6374 696f 6e73 2e69 7465 6d73 2829  nections.items()
-00003920: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
-00003930: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00003940: 2070 6f73 203d 207b 6b3a 2028 765b 2278   pos = {k: (v["x
-00003950: 225d 2c20 765b 2279 225d 2920 666f 7220  "], v["y"]) for 
-00003960: 6b2c 2076 2069 6e20 706c 6163 656d 656e  k, v in placemen
-00003970: 7473 2e69 7465 6d73 2829 7d0a 2020 2020  ts.items()}.    
-00003980: 2020 2020 6c61 6265 6c73 203d 207b 6b3a      labels = {k:
-00003990: 2022 2c22 2e6a 6f69 6e28 6b2e 7370 6c69   ",".join(k.spli
-000039a0: 7428 222c 2229 5b3a 315d 2920 666f 7220  t(",")[:1]) for 
-000039b0: 6b20 696e 2070 6c61 6365 6d65 6e74 732e  k in placements.
-000039c0: 6b65 7973 2829 7d0a 2020 2020 2020 2020  keys()}.        
-000039d0: 6e78 2e64 7261 7728 0a20 2020 2020 2020  nx.draw(.       
-000039e0: 2020 2020 2047 2c0a 2020 2020 2020 2020       G,.        
-000039f0: 2020 2020 7769 7468 5f6c 6162 656c 733d      with_labels=
-00003a00: 7769 7468 5f6c 6162 656c 732c 0a20 2020  with_labels,.   
-00003a10: 2020 2020 2020 2020 2066 6f6e 745f 7765           font_we
-00003a20: 6967 6874 3d66 6f6e 745f 7765 6967 6874  ight=font_weight
-00003a30: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-00003a40: 6265 6c73 3d6c 6162 656c 732c 0a20 2020  bels=labels,.   
-00003a50: 2020 2020 2020 2020 2070 6f73 3d70 6f73           pos=pos
-00003a60: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00003a70: 2020 2020 7265 7475 726e 2047 0a0a 2020      return G..  
-00003a80: 2020 6465 6620 706c 6f74 5f6e 6574 6c69    def plot_netli
-00003a90: 7374 5f66 6c61 7428 0a20 2020 2020 2020  st_flat(.       
-00003aa0: 2073 656c 662c 2077 6974 685f 6c61 6265   self, with_labe
-00003ab0: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
-00003ac0: 2066 6f6e 745f 7765 6967 6874 3a20 7374   font_weight: st
-00003ad0: 7220 3d20 226e 6f72 6d61 6c22 2c20 2a2a  r = "normal", **
-00003ae0: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
-00003af0: 2020 2020 2020 2222 2250 6c6f 7473 2061        """Plots a
-00003b00: 206e 6574 6c69 7374 2067 7261 7068 2077   netlist graph w
-00003b10: 6974 6820 6e65 7477 6f72 6b78 2e0a 0a20  ith networkx... 
-00003b20: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00003b30: 2020 2020 2020 2020 2066 6c61 743a 2069           flat: i
-00003b40: 6620 7472 7565 2c20 7769 6c6c 2070 6c6f  f true, will plo
-00003b50: 7420 7468 6520 666c 6174 206e 6574 6c69  t the flat netli
-00003b60: 7374 0a20 2020 2020 2020 2020 2020 2077  st.            w
-00003b70: 6974 685f 6c61 6265 6c73 3a20 6164 6420  ith_labels: add 
-00003b80: 6c61 6265 6c20 746f 2065 6163 6820 6e6f  label to each no
-00003b90: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
-00003ba0: 666f 6e74 5f77 6569 6768 743a 206e 6f72  font_weight: nor
-00003bb0: 6d61 6c2c 2062 6f6c 642e 0a20 2020 2020  mal, bold..     
-00003bc0: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
-00003bd0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00003be0: 7473 2066 6f72 2074 6865 2067 6574 5f6e  ts for the get_n
-00003bf0: 6574 6c69 7374 2066 756e 6374 696f 6e0a  etlist function.
-00003c00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003c10: 2020 2020 696d 706f 7274 206d 6174 706c      import matpl
-00003c20: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
-00003c30: 706c 740a 2020 2020 2020 2020 696d 706f  plt.        impo
-00003c40: 7274 206e 6574 776f 726b 7820 6173 206e  rt networkx as n
-00003c50: 780a 0a20 2020 2020 2020 2070 6c74 2e66  x..        plt.f
-00003c60: 6967 7572 6528 290a 2020 2020 2020 2020  igure().        
-00003c70: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
-00003c80: 6574 5f6e 6574 6c69 7374 5f66 6c61 7428  et_netlist_flat(
-00003c90: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-00003ca0: 2020 636f 6e6e 6563 7469 6f6e 7320 3d20    connections = 
-00003cb0: 6e65 746c 6973 745b 2263 6f6e 6e65 6374  netlist["connect
-00003cc0: 696f 6e73 225d 0a20 2020 2020 2020 2070  ions"].        p
-00003cd0: 6c61 6365 6d65 6e74 7320 3d20 6e65 746c  lacements = netl
-00003ce0: 6973 745b 2270 6c61 6365 6d65 6e74 7322  ist["placements"
-00003cf0: 5d0a 2020 2020 2020 2020 636f 6e6e 6563  ].        connec
-00003d00: 7469 6f6e 735f 6c69 7374 203d 205b 5d0a  tions_list = [].
-00003d10: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-00003d20: 5f6c 6973 7420 696e 2063 6f6e 6e65 6374  _list in connect
-00003d30: 696f 6e73 2e69 7465 6d73 2829 3a0a 2020  ions.items():.  
-00003d40: 2020 2020 2020 2020 2020 636f 6e6e 6563            connec
-00003d50: 7469 6f6e 735f 6c69 7374 2e65 7874 656e  tions_list.exten
-00003d60: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-00003d70: 2020 2028 222c 222e 6a6f 696e 286b 2e73     (",".join(k.s
-00003d80: 706c 6974 2822 2c22 295b 3a2d 315d 292c  plit(",")[:-1]),
-00003d90: 2022 2c22 2e6a 6f69 6e28 762e 7370 6c69   ",".join(v.spli
-00003da0: 7428 222c 2229 5b3a 2d31 5d29 290a 2020  t(",")[:-1])).  
-00003db0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00003dc0: 7220 7620 696e 2076 5f6c 6973 740a 2020  r v in v_list.  
-00003dd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00003de0: 2020 2020 4720 3d20 6e78 2e47 7261 7068      G = nx.Graph
-00003df0: 2829 0a20 2020 2020 2020 2047 2e61 6464  ().        G.add
-00003e00: 5f65 6467 6573 5f66 726f 6d28 636f 6e6e  _edges_from(conn
-00003e10: 6563 7469 6f6e 735f 6c69 7374 290a 2020  ections_list).  
-00003e20: 2020 2020 2020 706f 7320 3d20 7b6b 3a20        pos = {k: 
-00003e30: 2876 5b22 7822 5d2c 2076 5b22 7922 5d29  (v["x"], v["y"])
-00003e40: 2066 6f72 206b 2c20 7620 696e 2070 6c61   for k, v in pla
-00003e50: 6365 6d65 6e74 732e 6974 656d 7328 297d  cements.items()}
-00003e60: 0a20 2020 2020 2020 206c 6162 656c 7320  .        labels 
-00003e70: 3d20 7b6b 3a20 222c 222e 6a6f 696e 286b  = {k: ",".join(k
-00003e80: 2e73 706c 6974 2822 2c22 295b 3a31 5d29  .split(",")[:1])
-00003e90: 2066 6f72 206b 2069 6e20 706c 6163 656d   for k in placem
-00003ea0: 656e 7473 2e6b 6579 7328 297d 0a20 2020  ents.keys()}.   
-00003eb0: 2020 2020 206e 782e 6472 6177 280a 2020       nx.draw(.  
-00003ec0: 2020 2020 2020 2020 2020 472c 0a20 2020            G,.   
-00003ed0: 2020 2020 2020 2020 2077 6974 685f 6c61           with_la
-00003ee0: 6265 6c73 3d77 6974 685f 6c61 6265 6c73  bels=with_labels
-00003ef0: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
-00003f00: 6e74 5f77 6569 6768 743d 666f 6e74 5f77  nt_weight=font_w
-00003f10: 6569 6768 742c 0a20 2020 2020 2020 2020  eight,.         
-00003f20: 2020 206c 6162 656c 733d 6c61 6265 6c73     labels=labels
-00003f30: 2c0a 2020 2020 2020 2020 2020 2020 706f  ,.            po
-00003f40: 733d 706f 732c 0a20 2020 2020 2020 2029  s=pos,.        )
-00003f50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00003f60: 470a 0a20 2020 2064 6566 2067 6574 5f6e  G..    def get_n
-00003f70: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
-00003f80: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2044  , **kwargs) -> D
-00003f90: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
-00003fa0: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-00003fb0: 6163 746f 7279 2e67 6574 5f6e 6574 6c69  actory.get_netli
-00003fc0: 7374 2069 6d70 6f72 7420 6765 745f 6e65  st import get_ne
-00003fd0: 746c 6973 745f 7961 6d6c 0a0a 2020 2020  tlist_yaml..    
-00003fe0: 2020 2020 7265 7475 726e 2067 6574 5f6e      return get_n
-00003ff0: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
-00004000: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-00004010: 2064 6566 2077 7269 7465 5f6e 6574 6c69   def write_netli
-00004020: 7374 2873 656c 662c 2066 696c 6570 6174  st(self, filepat
-00004030: 683a 2073 7472 2920 2d3e 204e 6f6e 653a  h: str) -> None:
-00004040: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
-00004050: 6520 6e65 746c 6973 7420 696e 2059 414d  e netlist in YAM
-00004060: 4c2e 2222 220a 2020 2020 2020 2020 6e65  L.""".        ne
-00004070: 746c 6973 7420 3d20 7365 6c66 2e67 6574  tlist = self.get
-00004080: 5f6e 6574 6c69 7374 2829 0a20 2020 2020  _netlist().     
-00004090: 2020 204f 6d65 6761 436f 6e66 2e73 6176     OmegaConf.sav
-000040a0: 6528 6e65 746c 6973 742c 2066 696c 6570  e(netlist, filep
-000040b0: 6174 6829 0a0a 2020 2020 6465 6620 7772  ath)..    def wr
-000040c0: 6974 655f 6e65 746c 6973 745f 646f 7428  ite_netlist_dot(
-000040d0: 7365 6c66 2c20 6669 6c65 7061 7468 3a20  self, filepath: 
-000040e0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-000040f0: 4e6f 6e65 2920 2d3e 204e 6f6e 653a 0a20  None) -> None:. 
-00004100: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
-00004110: 6e65 746c 6973 7420 6772 6170 6820 696e  netlist graph in
-00004120: 2044 4f54 2066 6f72 6d61 742e 2222 220a   DOT format.""".
-00004130: 2020 2020 2020 2020 6672 6f6d 206e 6574          from net
-00004140: 776f 726b 782e 6472 6177 696e 672e 6e78  workx.drawing.nx
-00004150: 5f61 6772 6170 6820 696d 706f 7274 2077  _agraph import w
-00004160: 7269 7465 5f64 6f74 0a0a 2020 2020 2020  rite_dot..      
-00004170: 2020 6669 6c65 7061 7468 203d 2066 696c    filepath = fil
-00004180: 6570 6174 6820 6f72 2066 227b 7365 6c66  epath or f"{self
-00004190: 2e6e 616d 657d 2e64 6f74 220a 0a20 2020  .name}.dot"..   
-000041a0: 2020 2020 2047 203d 2073 656c 662e 706c       G = self.pl
-000041b0: 6f74 5f6e 6574 6c69 7374 2829 0a20 2020  ot_netlist().   
-000041c0: 2020 2020 2077 7269 7465 5f64 6f74 2847       write_dot(G
-000041d0: 2c20 6669 6c65 7061 7468 290a 0a20 2020  , filepath)..   
-000041e0: 2064 6566 2067 6574 5f6e 6574 6c69 7374   def get_netlist
-000041f0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-00004200: 202d 3e20 4469 6374 5b73 7472 2c20 416e   -> Dict[str, An
-00004210: 795d 3a0a 2020 2020 2020 2020 2222 2246  y]:.        """F
-00004220: 726f 6d20 436f 6d70 6f6e 656e 7420 7265  rom Component re
-00004230: 7475 726e 7320 696e 7374 616e 6365 732c  turns instances,
-00004240: 2063 6f6e 6e65 6374 696f 6e73 2061 6e64   connections and
-00004250: 2070 6c61 6365 6d65 6e74 7320 6469 6374   placements dict
-00004260: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
-00004270: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
-00004280: 2020 2020 2063 6f6d 706f 6e65 6e74 3a20       component: 
-00004290: 746f 2065 7874 7261 6374 206e 6574 6c69  to extract netli
-000042a0: 7374 2e0a 2020 2020 2020 2020 2020 2020  st..            
-000042b0: 6675 6c6c 5f73 6574 7469 6e67 733a 2054  full_settings: T
-000042c0: 7275 6520 7265 7475 726e 7320 616c 6c2c  rue returns all,
-000042d0: 2066 616c 7365 2063 6861 6e67 6564 2073   false changed s
-000042e0: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
-000042f0: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
-00004300: 746f 6c65 7261 6e63 6520 696e 206e 6d20  tolerance in nm 
-00004310: 746f 2063 6f6e 7369 6465 7220 7477 6f20  to consider two 
-00004320: 706f 7274 7320 636f 6e6e 6563 7465 642e  ports connected.
-00004330: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00004340: 6c75 6465 5f70 6f72 745f 7479 7065 733a  lude_port_types:
-00004350: 206f 7074 696f 6e61 6c20 6c69 7374 206f   optional list o
-00004360: 6620 706f 7274 2074 7970 6573 2074 6f20  f port types to 
-00004370: 6578 636c 7564 6520 6672 6f6d 206e 6574  exclude from net
-00004380: 6c69 7374 696e 672e 0a20 2020 2020 2020  listing..       
-00004390: 2020 2020 2067 6574 5f69 6e73 7461 6e63       get_instanc
-000043a0: 655f 6e61 6d65 3a20 6675 6e63 7469 6f6e  e_name: function
-000043b0: 2074 6f20 6765 7420 696e 7374 616e 6365   to get instance
-000043c0: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-000043d0: 2020 2061 6c6c 6f77 5f6d 756c 7469 706c     allow_multipl
-000043e0: 653a 2046 616c 7365 2074 6f20 7261 6973  e: False to rais
-000043f0: 6520 616e 2065 7272 6f72 2069 6620 6d6f  e an error if mo
-00004400: 7265 2074 6861 6e20 7477 6f20 706f 7274  re than two port
-00004410: 7320 7368 6172 6520 7468 6520 7361 6d65  s share the same
-00004420: 2063 6f6e 6e65 6374 696f 6e2e 0a20 2020   connection..   
-00004430: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00004440: 5472 7565 2c20 7769 6c6c 2072 6574 7572  True, will retur
-00004450: 6e20 6b65 793a 205b 7661 6c75 655d 2070  n key: [value] p
-00004460: 6169 7273 2077 6974 6820 5b76 616c 7565  airs with [value
-00004470: 5d20 6120 6c69 7374 206f 6620 616c 6c20  ] a list of all 
-00004480: 636f 6e6e 6563 7465 6420 696e 7374 616e  connected instan
-00004490: 6365 732e 0a0a 2020 2020 2020 2020 5265  ces...        Re
-000044a0: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-000044b0: 2020 204e 6574 6c69 7374 2064 6963 7420     Netlist dict 
-000044c0: 2869 6e73 7461 6e63 6573 2c20 636f 6e6e  (instances, conn
-000044d0: 6563 7469 6f6e 732c 2070 6c61 6365 6d65  ections, placeme
-000044e0: 6e74 732c 2070 6f72 7473 290a 2020 2020  nts, ports).    
-000044f0: 2020 2020 2020 2020 2020 2020 696e 7374              inst
-00004500: 616e 6365 733a 2044 6963 7420 6f66 2069  ances: Dict of i
-00004510: 6e73 7461 6e63 6520 6e61 6d65 2061 6e64  nstance name and
-00004520: 2073 6574 7469 6e67 732e 0a20 2020 2020   settings..     
-00004530: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
-00004540: 6374 696f 6e73 3a20 4469 6374 206f 6620  ctions: Dict of 
-00004550: 496e 7374 616e 6365 314e 616d 652c 706f  Instance1Name,po
-00004560: 7274 4e61 6d65 3a20 496e 7374 616e 6365  rtName: Instance
-00004570: 324e 616d 652c 706f 7274 4e61 6d65 2e0a  2Name,portName..
-00004580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004590: 706c 6163 656d 656e 7473 3a20 4469 6374  placements: Dict
-000045a0: 206f 6620 696e 7374 616e 6365 206e 616d   of instance nam
-000045b0: 6573 2061 6e64 2070 6c61 6365 6d65 6e74  es and placement
-000045c0: 7320 2878 2c20 792c 2072 6f74 6174 696f  s (x, y, rotatio
-000045d0: 6e29 2e0a 2020 2020 2020 2020 2020 2020  n)..            
-000045e0: 2020 2020 706f 7274 733a 2044 6963 7420      ports: Dict 
-000045f0: 706f 7274 4e61 6d65 3a20 436f 6d70 6f6e  portName: Compon
-00004600: 656e 744e 616d 652c 706f 7274 2e0a 2020  entName,port..  
-00004610: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00004620: 6d65 3a20 6e61 6d65 206f 6620 636f 6d70  me: name of comp
-00004630: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
-00004640: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00004650: 6764 7366 6163 746f 7279 2e67 6574 5f6e  gdsfactory.get_n
-00004660: 6574 6c69 7374 2069 6d70 6f72 7420 6765  etlist import ge
-00004670: 745f 6e65 746c 6973 740a 0a20 2020 2020  t_netlist..     
-00004680: 2020 2072 6574 7572 6e20 6765 745f 6e65     return get_ne
-00004690: 746c 6973 7428 636f 6d70 6f6e 656e 743d  tlist(component=
-000046a0: 7365 6c66 2c20 2a2a 6b77 6172 6773 290a  self, **kwargs).
-000046b0: 0a20 2020 2064 6566 2067 6574 5f6e 6574  .    def get_net
-000046c0: 6c69 7374 5f72 6563 7572 7369 7665 2873  list_recursive(s
-000046d0: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
-000046e0: 3e20 4469 6374 5b73 7472 2c20 4469 6374  > Dict[str, Dict
-000046f0: 436f 6e66 6967 5d3a 0a20 2020 2020 2020  Config]:.       
-00004700: 2022 2222 5265 7475 726e 7320 7265 6375   """Returns recu
-00004710: 7273 6976 6520 6e65 746c 6973 7420 666f  rsive netlist fo
-00004720: 7220 6120 636f 6d70 6f6e 656e 7420 616e  r a component an
-00004730: 6420 7375 6263 6f6d 706f 6e65 6e74 732e  d subcomponents.
-00004740: 0a0a 2020 2020 2020 2020 4b65 7977 6f72  ..        Keywor
-00004750: 6420 4172 6773 3a0a 2020 2020 2020 2020  d Args:.        
-00004760: 2020 2020 636f 6d70 6f6e 656e 743a 2074      component: t
-00004770: 6f20 6578 7472 6163 7420 6e65 746c 6973  o extract netlis
-00004780: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
-00004790: 6f6d 706f 6e65 6e74 5f73 7566 6669 783a  omponent_suffix:
-000047a0: 2073 7566 6669 7820 746f 2061 7070 656e   suffix to appen
-000047b0: 6420 746f 2065 6163 6820 636f 6d70 6f6e  d to each compon
-000047c0: 656e 7420 6e61 6d65 2e0a 2020 2020 2020  ent name..      
-000047d0: 2020 2020 2020 2020 2020 7573 6566 756c            useful
-000047e0: 2069 6620 746f 2073 6176 6520 616e 6420   if to save and 
-000047f0: 7265 6c6f 6164 2061 2062 6163 6b2d 616e  reload a back-an
-00004800: 6e6f 7461 7465 6420 6e65 746c 6973 742e  notated netlist.
-00004810: 0a20 2020 2020 2020 2020 2020 2067 6574  .            get
-00004820: 5f6e 6574 6c69 7374 5f66 756e 633a 2066  _netlist_func: f
-00004830: 756e 6374 696f 6e20 746f 2065 7874 7261  unction to extra
-00004840: 6374 2069 6e64 6976 6964 7561 6c20 6e65  ct individual ne
-00004850: 746c 6973 7473 2e0a 2020 2020 2020 2020  tlists..        
-00004860: 2020 2020 6675 6c6c 5f73 6574 7469 6e67      full_setting
-00004870: 733a 2054 7275 6520 7265 7475 726e 7320  s: True returns 
-00004880: 616c 6c2c 2066 616c 7365 2063 6861 6e67  all, false chang
-00004890: 6564 2073 6574 7469 6e67 732e 0a20 2020  ed settings..   
-000048a0: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
-000048b0: 6365 3a20 746f 6c65 7261 6e63 6520 696e  ce: tolerance in
-000048c0: 206e 6d20 746f 2063 6f6e 7369 6465 7220   nm to consider 
-000048d0: 7477 6f20 706f 7274 7320 636f 6e6e 6563  two ports connec
-000048e0: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
-000048f0: 2065 7863 6c75 6465 5f70 6f72 745f 7479   exclude_port_ty
-00004900: 7065 733a 206f 7074 696f 6e61 6c20 6c69  pes: optional li
-00004910: 7374 206f 6620 706f 7274 2074 7970 6573  st of port types
-00004920: 2074 6f20 6578 636c 7564 6520 6672 6f6d   to exclude from
-00004930: 206e 6574 6c69 7374 696e 672e 0a20 2020   netlisting..   
-00004940: 2020 2020 2020 2020 2067 6574 5f69 6e73           get_ins
-00004950: 7461 6e63 655f 6e61 6d65 3a20 6675 6e63  tance_name: func
-00004960: 7469 6f6e 2074 6f20 6765 7420 696e 7374  tion to get inst
-00004970: 616e 6365 206e 616d 652e 0a20 2020 2020  ance name..     
-00004980: 2020 2020 2020 2061 6c6c 6f77 5f6d 756c         allow_mul
-00004990: 7469 706c 653a 2046 616c 7365 2074 6f20  tiple: False to 
-000049a0: 7261 6973 6520 616e 2065 7272 6f72 2069  raise an error i
-000049b0: 6620 6d6f 7265 2074 6861 6e20 7477 6f20  f more than two 
-000049c0: 706f 7274 7320 7368 6172 6520 7468 6520  ports share the 
-000049d0: 7361 6d65 2063 6f6e 6e65 6374 696f 6e2e  same connection.
-000049e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000049f0: 2069 6620 5472 7565 2c20 7769 6c6c 2072   if True, will r
-00004a00: 6574 7572 6e20 6b65 793a 205b 7661 6c75  eturn key: [valu
-00004a10: 655d 2070 6169 7273 2077 6974 6820 5b76  e] pairs with [v
-00004a20: 616c 7565 5d20 6120 6c69 7374 206f 6620  alue] a list of 
-00004a30: 616c 6c20 636f 6e6e 6563 7465 6420 696e  all connected in
-00004a40: 7374 616e 6365 732e 0a0a 2020 2020 2020  stances...      
-00004a50: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-00004a60: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
-00004a70: 7920 6f66 206e 6574 6c69 7374 732c 206b  y of netlists, k
-00004a80: 6579 6564 2062 7920 7468 6520 6e61 6d65  eyed by the name
-00004a90: 206f 6620 6561 6368 2063 6f6d 706f 6e65   of each compone
-00004aa0: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
-00004ab0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00004ac0: 6661 6374 6f72 792e 6765 745f 6e65 746c  factory.get_netl
-00004ad0: 6973 7420 696d 706f 7274 2067 6574 5f6e  ist import get_n
-00004ae0: 6574 6c69 7374 5f72 6563 7572 7369 7665  etlist_recursive
-00004af0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00004b00: 2067 6574 5f6e 6574 6c69 7374 5f72 6563   get_netlist_rec
-00004b10: 7572 7369 7665 2863 6f6d 706f 6e65 6e74  ursive(component
-00004b20: 3d73 656c 662c 202a 2a6b 7761 7267 7329  =self, **kwargs)
-00004b30: 0a0a 2020 2020 6465 6620 6765 745f 6e65  ..    def get_ne
-00004b40: 746c 6973 745f 666c 6174 2873 656c 662c  tlist_flat(self,
-00004b50: 202a 2a6b 7761 7267 7329 202d 3e20 4469   **kwargs) -> Di
-00004b60: 6374 5b73 7472 2c20 4469 6374 436f 6e66  ct[str, DictConf
-00004b70: 6967 5d3a 0a20 2020 2020 2020 2022 2222  ig]:.        """
-00004b80: 5265 7475 726e 7320 6120 6e65 746c 6973  Returns a netlis
-00004b90: 7420 7768 6572 6520 616c 6c20 7375 6269  t where all subi
-00004ba0: 6e73 7461 6e63 6573 2061 7265 2065 7870  nstances are exp
-00004bb0: 6f73 6564 2061 6e64 2069 6e64 6570 656e  osed and indepen
-00004bc0: 6465 6e74 6c79 206e 616d 6564 2e0a 0a20  dently named... 
-00004bd0: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
-00004be0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00004bf0: 2063 6f6d 706f 6e65 6e74 3a20 746f 2065   component: to e
-00004c00: 7874 7261 6374 206e 6574 6c69 7374 2e0a  xtract netlist..
-00004c10: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00004c20: 6f6e 656e 745f 7375 6666 6978 3a20 7375  onent_suffix: su
-00004c30: 6666 6978 2074 6f20 6170 7065 6e64 2074  ffix to append t
-00004c40: 6f20 6561 6368 2063 6f6d 706f 6e65 6e74  o each component
-00004c50: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-00004c60: 2020 2020 2020 2075 7365 6675 6c20 6966         useful if
-00004c70: 2074 6f20 7361 7665 2061 6e64 2072 656c   to save and rel
-00004c80: 6f61 6420 6120 6261 636b 2d61 6e6e 6f74  oad a back-annot
-00004c90: 6174 6564 206e 6574 6c69 7374 2e0a 2020  ated netlist..  
-00004ca0: 2020 2020 2020 2020 2020 6765 745f 6e65            get_ne
-00004cb0: 746c 6973 745f 6675 6e63 3a20 6675 6e63  tlist_func: func
-00004cc0: 7469 6f6e 2074 6f20 6578 7472 6163 7420  tion to extract 
-00004cd0: 696e 6469 7669 6475 616c 206e 6574 6c69  individual netli
-00004ce0: 7374 732e 0a20 2020 2020 2020 2020 2020  sts..           
-00004cf0: 2066 756c 6c5f 7365 7474 696e 6773 3a20   full_settings: 
-00004d00: 5472 7565 2072 6574 7572 6e73 2061 6c6c  True returns all
-00004d10: 2c20 6661 6c73 6520 6368 616e 6765 6420  , false changed 
-00004d20: 7365 7474 696e 6773 2e0a 2020 2020 2020  settings..      
-00004d30: 2020 2020 2020 746f 6c65 7261 6e63 653a        tolerance:
-00004d40: 2074 6f6c 6572 616e 6365 2069 6e20 6e6d   tolerance in nm
-00004d50: 2074 6f20 636f 6e73 6964 6572 2074 776f   to consider two
-00004d60: 2070 6f72 7473 2063 6f6e 6e65 6374 6564   ports connected
-00004d70: 2e0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00004d80: 636c 7564 655f 706f 7274 5f74 7970 6573  clude_port_types
-00004d90: 3a20 6f70 7469 6f6e 616c 206c 6973 7420  : optional list 
-00004da0: 6f66 2070 6f72 7420 7479 7065 7320 746f  of port types to
-00004db0: 2065 7863 6c75 6465 2066 726f 6d20 6e65   exclude from ne
-00004dc0: 746c 6973 7469 6e67 2e0a 2020 2020 2020  tlisting..      
-00004dd0: 2020 2020 2020 6765 745f 696e 7374 616e        get_instan
-00004de0: 6365 5f6e 616d 653a 2066 756e 6374 696f  ce_name: functio
-00004df0: 6e20 746f 2067 6574 2069 6e73 7461 6e63  n to get instanc
-00004e00: 6520 6e61 6d65 2e0a 2020 2020 2020 2020  e name..        
-00004e10: 2020 2020 616c 6c6f 775f 6d75 6c74 6970      allow_multip
-00004e20: 6c65 3a20 4661 6c73 6520 746f 2072 6169  le: False to rai
-00004e30: 7365 2061 6e20 6572 726f 7220 6966 206d  se an error if m
-00004e40: 6f72 6520 7468 616e 2074 776f 2070 6f72  ore than two por
-00004e50: 7473 2073 6861 7265 2074 6865 2073 616d  ts share the sam
-00004e60: 6520 636f 6e6e 6563 7469 6f6e 2e0a 2020  e connection..  
-00004e70: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004e80: 2054 7275 652c 2077 696c 6c20 7265 7475   True, will retu
-00004e90: 726e 206b 6579 3a20 5b76 616c 7565 5d20  rn key: [value] 
-00004ea0: 7061 6972 7320 7769 7468 205b 7661 6c75  pairs with [valu
-00004eb0: 655d 2061 206c 6973 7420 6f66 2061 6c6c  e] a list of all
-00004ec0: 2063 6f6e 6e65 6374 6564 2069 6e73 7461   connected insta
-00004ed0: 6e63 6573 2e0a 0a20 2020 2020 2020 2052  nces...        R
-00004ee0: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00004ef0: 2020 2020 4469 6374 696f 6e61 7279 206f      Dictionary o
-00004f00: 6620 6e65 746c 6973 7473 2c20 6b65 7965  f netlists, keye
-00004f10: 6420 6279 2074 6865 206e 616d 6520 6f66  d by the name of
-00004f20: 2065 6163 6820 636f 6d70 6f6e 656e 742e   each component.
-00004f30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004f40: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00004f50: 746f 7279 2e67 6574 5f6e 6574 6c69 7374  tory.get_netlist
-00004f60: 5f66 6c61 7420 696d 706f 7274 2067 6574  _flat import get
-00004f70: 5f6e 6574 6c69 7374 5f66 6c61 740a 0a20  _netlist_flat.. 
-00004f80: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
-00004f90: 745f 6e65 746c 6973 745f 666c 6174 2863  t_netlist_flat(c
-00004fa0: 6f6d 706f 6e65 6e74 3d73 656c 662c 202a  omponent=self, *
-00004fb0: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
-00004fc0: 6620 6173 7365 7274 5f70 6f72 7473 5f6f  f assert_ports_o
-00004fd0: 6e5f 6772 6964 2873 656c 662c 206e 6d3a  n_grid(self, nm:
-00004fe0: 2069 6e74 203d 2031 2920 2d3e 204e 6f6e   int = 1) -> Non
-00004ff0: 653a 0a20 2020 2020 2020 2022 2222 4173  e:.        """As
-00005000: 7365 7274 7320 7468 6174 2061 6c6c 2070  serts that all p
-00005010: 6f72 7473 2061 7265 206f 6e20 6772 6964  orts are on grid
-00005020: 2e22 2222 0a20 2020 2020 2020 2066 6f72  .""".        for
-00005030: 2070 6f72 7420 696e 2073 656c 662e 706f   port in self.po
-00005040: 7274 732e 7661 6c75 6573 2829 3a0a 2020  rts.values():.  
-00005050: 2020 2020 2020 2020 2020 706f 7274 2e61            port.a
-00005060: 7373 6572 745f 6f6e 5f67 7269 6428 6e6d  ssert_on_grid(nm
-00005070: 3d6e 6d29 0a0a 2020 2020 6465 6620 6765  =nm)..    def ge
-00005080: 745f 706f 7274 7328 7365 6c66 2c20 6465  t_ports(self, de
-00005090: 7074 683d 4e6f 6e65 293a 0a20 2020 2020  pth=None):.     
-000050a0: 2020 2022 2222 5265 7475 726e 7320 636f     """Returns co
-000050b0: 7069 6573 206f 6620 616c 6c20 7468 6520  pies of all the 
-000050c0: 706f 7274 7320 6f66 2074 6865 2043 6f6d  ports of the Com
-000050d0: 706f 6e65 6e74 2c20 726f 7461 7465 6420  ponent, rotated 
-000050e0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
-000050f0: 2020 2020 2020 7472 616e 736c 6174 6564        translated
-00005100: 2073 6f20 7468 6174 2074 6865 7927 7265   so that they're
-00005110: 2069 6e20 7468 6569 7220 746f 702d 6c65   in their top-le
-00005120: 7665 6c20 706f 7369 7469 6f6e 2e0a 0a20  vel position... 
-00005130: 2020 2020 2020 2054 6865 2050 6f72 7473         The Ports
-00005140: 2072 6574 7572 6e65 6420 6172 6520 636f   returned are co
-00005150: 7069 6573 206f 6620 7468 6520 6f72 6967  pies of the orig
-00005160: 696e 616c 732c 2062 7574 2065 6163 6820  inals, but each 
-00005170: 636f 7079 2068 6173 2074 6865 2073 616d  copy has the sam
-00005180: 650a 2020 2020 2020 2020 6060 7569 6460  e.        ``uid`
-00005190: 6020 6173 2074 6865 206f 7269 6769 6e61  ` as the origina
-000051a0: 6c20 736f 2074 6861 7420 7468 6579 2063  l so that they c
-000051b0: 616e 2062 6520 7472 6163 6564 2062 6163  an be traced bac
-000051c0: 6b20 746f 2074 6865 206f 7269 6769 6e61  k to the origina
-000051d0: 6c20 6966 206e 6565 6465 642e 0a0a 2020  l if needed...  
-000051e0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-000051f0: 2020 2020 2020 2020 6465 7074 6820 3a20          depth : 
-00005200: 696e 7420 6f72 204e 6f6e 650a 2020 2020  int or None.    
-00005210: 2020 2020 2020 2020 2020 2020 4966 206e              If n
-00005220: 6f74 204e 6f6e 652c 2064 6566 696e 6573  ot None, defines
-00005230: 2066 726f 6d20 686f 7720 6d61 6e79 2072   from how many r
-00005240: 6566 6572 656e 6365 206c 6576 656c 7320  eference levels 
-00005250: 746f 0a20 2020 2020 2020 2020 2020 2020  to.             
-00005260: 2020 2072 6574 7269 6576 6520 506f 7274     retrieve Port
-00005270: 7320 6672 6f6d 2e0a 0a20 2020 2020 2020  s from...       
-00005280: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
-00005290: 2020 2020 2020 706f 7274 5f6c 6973 7420        port_list 
-000052a0: 3a20 6c69 7374 206f 6620 506f 7274 204c  : list of Port L
-000052b0: 6973 7420 6f66 2061 6c6c 2050 6f72 7473  ist of all Ports
-000052c0: 2069 6e20 7468 6520 436f 6d70 6f6e 656e   in the Componen
-000052d0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
-000052e0: 2020 2020 2020 2070 6f72 745f 6c69 7374         port_list
-000052f0: 203d 205b 702e 5f63 6f70 7928 2920 666f   = [p._copy() fo
-00005300: 7220 7020 696e 2073 656c 662e 706f 7274  r p in self.port
-00005310: 732e 7661 6c75 6573 2829 5d0a 0a20 2020  s.values()]..   
-00005320: 2020 2020 2069 6620 6465 7074 6820 6973       if depth is
-00005330: 204e 6f6e 6520 6f72 2064 6570 7468 203e   None or depth >
-00005340: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00005350: 666f 7220 7220 696e 2073 656c 662e 7265  for r in self.re
-00005360: 6665 7265 6e63 6573 3a0a 2020 2020 2020  ferences:.      
-00005370: 2020 2020 2020 2020 2020 6e65 775f 6465            new_de
-00005380: 7074 6820 3d20 4e6f 6e65 2069 6620 6465  pth = None if de
-00005390: 7074 6820 6973 204e 6f6e 6520 656c 7365  pth is None else
-000053a0: 2064 6570 7468 202d 2031 0a20 2020 2020   depth - 1.     
-000053b0: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
-000053c0: 6f72 7473 203d 2072 2e70 6172 656e 742e  orts = r.parent.
-000053d0: 6765 745f 706f 7274 7328 6465 7074 683d  get_ports(depth=
-000053e0: 6e65 775f 6465 7074 6829 0a0a 2020 2020  new_depth)..    
-000053f0: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
-00005400: 616e 7366 6f72 6d20 706f 7274 7320 7468  ansform ports th
-00005410: 6174 2063 616d 6520 6672 6f6d 2061 2072  at came from a r
-00005420: 6566 6572 656e 6365 0a20 2020 2020 2020  eference.       
-00005430: 2020 2020 2020 2020 2072 6566 5f70 6f72           ref_por
-00005440: 7473 5f74 7261 6e73 666f 726d 6564 203d  ts_transformed =
-00005450: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00005460: 2020 2020 666f 7220 7270 2069 6e20 7265      for rp in re
-00005470: 665f 706f 7274 733a 0a20 2020 2020 2020  f_ports:.       
-00005480: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00005490: 5f70 6f72 7420 3d20 7270 2e5f 636f 7079  _port = rp._copy
-000054a0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-000054b0: 2020 2020 2020 206e 6577 5f63 656e 7465         new_cente
-000054c0: 722c 206e 6577 5f6f 7269 656e 7461 7469  r, new_orientati
-000054d0: 6f6e 203d 2072 2e5f 7472 616e 7366 6f72  on = r._transfor
-000054e0: 6d5f 706f 7274 280a 2020 2020 2020 2020  m_port(.        
-000054f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005500: 7270 2e63 656e 7465 722c 0a20 2020 2020  rp.center,.     
-00005510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005520: 2020 2072 702e 6f72 6965 6e74 6174 696f     rp.orientatio
-00005530: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00005540: 2020 2020 2020 2020 2020 2072 2e6f 7269             r.ori
-00005550: 6769 6e2c 0a20 2020 2020 2020 2020 2020  gin,.           
-00005560: 2020 2020 2020 2020 2020 2020 2072 2e72               r.r
-00005570: 6f74 6174 696f 6e2c 0a20 2020 2020 2020  otation,.       
-00005580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005590: 2072 2e78 5f72 6566 6c65 6374 696f 6e2c   r.x_reflection,
-000055a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000055b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000055c0: 2020 2020 2020 2020 2020 206e 6577 5f70             new_p
-000055d0: 6f72 742e 6365 6e74 6572 203d 206e 6577  ort.center = new
-000055e0: 5f63 656e 7465 720a 2020 2020 2020 2020  _center.        
-000055f0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00005600: 706f 7274 2e6e 6577 5f6f 7269 656e 7461  port.new_orienta
-00005610: 7469 6f6e 203d 206e 6577 5f6f 7269 656e  tion = new_orien
-00005620: 7461 7469 6f6e 0a20 2020 2020 2020 2020  tation.         
-00005630: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
-00005640: 6f72 7473 5f74 7261 6e73 666f 726d 6564  orts_transformed
-00005650: 2e61 7070 656e 6428 6e65 775f 706f 7274  .append(new_port
-00005660: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005670: 2020 706f 7274 5f6c 6973 7420 2b3d 2072    port_list += r
-00005680: 6566 5f70 6f72 7473 5f74 7261 6e73 666f  ef_ports_transfo
-00005690: 726d 6564 0a0a 2020 2020 2020 2020 7265  rmed..        re
-000056a0: 7475 726e 2070 6f72 745f 6c69 7374 0a0a  turn port_list..
-000056b0: 2020 2020 6465 6620 6765 745f 706f 7274      def get_port
-000056c0: 735f 6469 6374 2873 656c 662c 202a 2a6b  s_dict(self, **k
-000056d0: 7761 7267 7329 202d 3e20 4469 6374 5b73  wargs) -> Dict[s
-000056e0: 7472 2c20 506f 7274 5d3a 0a20 2020 2020  tr, Port]:.     
-000056f0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-00005700: 6469 6374 206f 6620 706f 7274 732e 0a0a  dict of ports...
-00005710: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-00005720: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00005730: 2020 6c61 7965 723a 2070 6f72 7420 4744    layer: port GD
-00005740: 5320 6c61 7965 722e 0a20 2020 2020 2020  S layer..       
-00005750: 2020 2020 2070 7265 6669 783a 2073 656c       prefix: sel
-00005760: 6563 7420 706f 7274 7320 7769 7468 2070  ect ports with p
-00005770: 7265 6669 7820 696e 2070 6f72 7420 6e61  refix in port na
-00005780: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
-00005790: 7375 6666 6978 3a20 7365 6c65 6374 2070  suffix: select p
-000057a0: 6f72 7473 2077 6974 6820 706f 7274 206e  orts with port n
-000057b0: 616d 6520 7375 6666 6978 2e0a 2020 2020  ame suffix..    
-000057c0: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
-000057d0: 696f 6e3a 2073 656c 6563 7420 706f 7274  ion: select port
-000057e0: 7320 7769 7468 206f 7269 656e 7461 7469  s with orientati
-000057f0: 6f6e 2069 6e20 6465 6772 6565 732e 0a20  on in degrees.. 
-00005800: 2020 2020 2020 2020 2020 2077 6964 7468             width
-00005810: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
-00005820: 6974 6820 706f 7274 2077 6964 7468 2e0a  ith port width..
-00005830: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00005840: 7273 5f65 7863 6c75 6465 643a 204c 6973  rs_excluded: Lis
-00005850: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
-00005860: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
-00005870: 2020 2020 706f 7274 5f74 7970 653a 2073      port_type: s
-00005880: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
-00005890: 2070 6f72 745f 7479 7065 2028 6f70 7469   port_type (opti
-000058a0: 6361 6c2c 2065 6c65 6374 7269 6361 6c2c  cal, electrical,
-000058b0: 2076 6572 7469 6361 6c5f 7465 292e 0a20   vertical_te).. 
-000058c0: 2020 2020 2020 2020 2020 2063 6c6f 636b             clock
-000058d0: 7769 7365 3a20 6966 2054 7275 652c 2073  wise: if True, s
-000058e0: 6f72 7420 706f 7274 7320 636c 6f63 6b77  ort ports clockw
-000058f0: 6973 652c 2046 616c 7365 3a20 636f 756e  ise, False: coun
-00005900: 7465 722d 636c 6f63 6b77 6973 652e 0a20  ter-clockwise.. 
-00005910: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00005920: 2020 2072 6574 7572 6e20 7365 6c65 6374     return select
-00005930: 5f70 6f72 7473 2873 656c 662e 706f 7274  _ports(self.port
-00005940: 732c 202a 2a6b 7761 7267 7329 0a0a 2020  s, **kwargs)..  
-00005950: 2020 6465 6620 6765 745f 706f 7274 735f    def get_ports_
-00005960: 6c69 7374 2873 656c 662c 202a 2a6b 7761  list(self, **kwa
-00005970: 7267 7329 202d 3e20 4c69 7374 5b50 6f72  rgs) -> List[Por
-00005980: 745d 3a0a 2020 2020 2020 2020 2222 2252  t]:.        """R
-00005990: 6574 7572 6e73 206c 6973 7420 6f66 2070  eturns list of p
-000059a0: 6f72 7473 2e0a 0a20 2020 2020 2020 204b  orts...        K
-000059b0: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
-000059c0: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
-000059d0: 7365 6c65 6374 2070 6f72 7473 2077 6974  select ports wit
-000059e0: 6820 4744 5320 6c61 7965 722e 0a20 2020  h GDS layer..   
-000059f0: 2020 2020 2020 2020 2070 7265 6669 783a           prefix:
-00005a00: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
-00005a10: 7468 2070 7265 6669 7820 696e 2070 6f72  th prefix in por
-00005a20: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
-00005a30: 2020 2020 7375 6666 6978 3a20 7365 6c65      suffix: sele
-00005a40: 6374 2070 6f72 7473 2077 6974 6820 706f  ct ports with po
-00005a50: 7274 206e 616d 6520 7375 6666 6978 2e0a  rt name suffix..
-00005a60: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
-00005a70: 6e74 6174 696f 6e3a 2073 656c 6563 7420  ntation: select 
-00005a80: 706f 7274 7320 7769 7468 206f 7269 656e  ports with orien
-00005a90: 7461 7469 6f6e 2069 6e20 6465 6772 6565  tation in degree
-00005aa0: 732e 0a20 2020 2020 2020 2020 2020 206f  s..            o
-00005ab0: 7269 656e 7461 7469 6f6e 3a20 7365 6c65  rientation: sele
-00005ac0: 6374 2070 6f72 7473 2077 6974 6820 6f72  ct ports with or
-00005ad0: 6965 6e74 6174 696f 6e20 696e 2064 6567  ientation in deg
-00005ae0: 7265 6573 2e0a 2020 2020 2020 2020 2020  rees..          
-00005af0: 2020 7769 6474 683a 2073 656c 6563 7420    width: select 
-00005b00: 706f 7274 7320 7769 7468 2070 6f72 7420  ports with port 
-00005b10: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
-00005b20: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
-00005b30: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
-00005b40: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
-00005b50: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
-00005b60: 7479 7065 3a20 7365 6c65 6374 2070 6f72  type: select por
-00005b70: 7473 2077 6974 6820 706f 7274 5f74 7970  ts with port_typ
-00005b80: 6520 286f 7074 6963 616c 2c20 656c 6563  e (optical, elec
-00005b90: 7472 6963 616c 2c20 7665 7274 6963 616c  trical, vertical
-00005ba0: 5f74 6529 2e0a 2020 2020 2020 2020 2020  _te)..          
-00005bb0: 2020 636c 6f63 6b77 6973 653a 2069 6620    clockwise: if 
-00005bc0: 5472 7565 2c20 736f 7274 2070 6f72 7473  True, sort ports
-00005bd0: 2063 6c6f 636b 7769 7365 2c20 4661 6c73   clockwise, Fals
-00005be0: 653a 2063 6f75 6e74 6572 2d63 6c6f 636b  e: counter-clock
-00005bf0: 7769 7365 2e0a 2020 2020 2020 2020 2222  wise..        ""
-00005c00: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00005c10: 206c 6973 7428 7365 6c65 6374 5f70 6f72   list(select_por
-00005c20: 7473 2873 656c 662e 706f 7274 732c 202a  ts(self.ports, *
-00005c30: 2a6b 7761 7267 7329 2e76 616c 7565 7328  *kwargs).values(
-00005c40: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
-00005c50: 706f 7274 735f 7061 6e64 6173 2873 656c  ports_pandas(sel
-00005c60: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
-00005c70: 7274 2070 616e 6461 7320 6173 2070 640a  rt pandas as pd.
-00005c80: 0a20 2020 2020 2020 2063 6f6c 5f73 7065  .        col_spe
-00005c90: 6320 3d20 5b0a 2020 2020 2020 2020 2020  c = [.          
-00005ca0: 2020 226e 616d 6522 2c0a 2020 2020 2020    "name",.      
-00005cb0: 2020 2020 2020 2277 6964 7468 222c 0a20        "width",. 
-00005cc0: 2020 2020 2020 2020 2020 2022 6365 6e74             "cent
-00005cd0: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
-00005ce0: 2022 6f72 6965 6e74 6174 696f 6e22 2c0a   "orientation",.
-00005cf0: 2020 2020 2020 2020 2020 2020 226c 6179              "lay
-00005d00: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
-00005d10: 2022 706f 7274 5f74 7970 6522 2c0a 2020   "port_type",.  
-00005d20: 2020 2020 2020 2020 2020 2273 6865 6172            "shear
-00005d30: 5f61 6e67 6c65 222c 0a20 2020 2020 2020  _angle",.       
-00005d40: 205d 0a0a 2020 2020 2020 2020 7265 7475   ]..        retu
-00005d50: 726e 2070 642e 4461 7461 4672 616d 6528  rn pd.DataFrame(
-00005d60: 0a20 2020 2020 2020 2020 2020 205b 706f  .            [po
-00005d70: 7274 2e74 6f5f 6469 6374 2829 2066 6f72  rt.to_dict() for
-00005d80: 2070 6f72 7420 696e 2073 656c 662e 6765   port in self.ge
-00005d90: 745f 706f 7274 735f 6c69 7374 2829 5d2c  t_ports_list()],
-00005da0: 2063 6f6c 756d 6e73 3d63 6f6c 5f73 7065   columns=col_spe
-00005db0: 630a 2020 2020 2020 2020 290a 0a20 2020  c.        )..   
-00005dc0: 2064 6566 2067 6574 5f70 6f72 7473 5f70   def get_ports_p
-00005dd0: 6f6c 6172 7328 7365 6c66 293a 0a20 2020  olars(self):.   
-00005de0: 2020 2020 2069 6d70 6f72 7420 706f 6c61       import pola
-00005df0: 7273 2061 7320 706c 0a0a 2020 2020 2020  rs as pl..      
-00005e00: 2020 636f 6c5f 7370 6563 203d 207b 0a20    col_spec = {. 
-00005e10: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
-00005e20: 223a 2070 6c2e 5574 6638 2c0a 2020 2020  ": pl.Utf8,.    
-00005e30: 2020 2020 2020 2020 2277 6964 7468 223a          "width":
-00005e40: 2070 6c2e 466c 6f61 7436 342c 0a20 2020   pl.Float64,.   
-00005e50: 2020 2020 2020 2020 2022 6365 6e74 6572           "center
-00005e60: 223a 2070 6c2e 4c69 7374 2870 6c2e 466c  ": pl.List(pl.Fl
-00005e70: 6f61 7436 3429 2c0a 2020 2020 2020 2020  oat64),.        
-00005e80: 2020 2020 226f 7269 656e 7461 7469 6f6e      "orientation
-00005e90: 223a 2070 6c2e 466c 6f61 7436 342c 0a20  ": pl.Float64,. 
-00005ea0: 2020 2020 2020 2020 2020 2022 6c61 7965             "laye
-00005eb0: 7222 3a20 706c 2e4c 6973 7428 706c 2e55  r": pl.List(pl.U
-00005ec0: 496e 7431 3629 2c0a 2020 2020 2020 2020  Int16),.        
-00005ed0: 2020 2020 2270 6f72 745f 7479 7065 223a      "port_type":
-00005ee0: 2070 6c2e 5574 6638 2c0a 2020 2020 2020   pl.Utf8,.      
-00005ef0: 2020 2020 2020 2273 6865 6172 5f61 6e67        "shear_ang
-00005f00: 6c65 223a 2070 6c2e 466c 6f61 7436 342c  le": pl.Float64,
-00005f10: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-00005f20: 2020 2020 7265 7475 726e 2070 6c2e 4461      return pl.Da
-00005f30: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
-00005f40: 2020 2020 205b 706f 7274 2e74 6f5f 6469       [port.to_di
-00005f50: 6374 2829 2066 6f72 2070 6f72 7420 696e  ct() for port in
-00005f60: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
-00005f70: 6c69 7374 2829 5d2c 2073 6368 656d 613d  list()], schema=
-00005f80: 636f 6c5f 7370 6563 0a20 2020 2020 2020  col_spec.       
-00005f90: 2029 0a0a 2020 2020 6465 6620 7265 6628   )..    def ref(
-00005fa0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00005fb0: 2020 2020 2020 2070 6f73 6974 696f 6e3a         position:
-00005fc0: 2043 6f6f 7264 696e 6174 6520 3d20 2830   Coordinate = (0
-00005fd0: 2c20 3029 2c0a 2020 2020 2020 2020 706f  , 0),.        po
-00005fe0: 7274 5f69 643a 204f 7074 696f 6e61 6c5b  rt_id: Optional[
-00005ff0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00006000: 2020 2020 2072 6f74 6174 696f 6e3a 2066       rotation: f
-00006010: 6c6f 6174 203d 2030 2c0a 2020 2020 2020  loat = 0,.      
-00006020: 2020 685f 6d69 7272 6f72 3a20 626f 6f6c    h_mirror: bool
-00006030: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-00006040: 2020 765f 6d69 7272 6f72 3a20 626f 6f6c    v_mirror: bool
-00006050: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
-00006060: 2d3e 2043 6f6d 706f 6e65 6e74 5265 6665  -> ComponentRefe
-00006070: 7265 6e63 653a 0a20 2020 2020 2020 2022  rence:.        "
-00006080: 2222 5265 7475 726e 7320 436f 6d70 6f6e  ""Returns Compon
-00006090: 656e 7420 7265 6665 7265 6e63 652e 0a0a  ent reference...
-000060a0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-000060b0: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-000060c0: 6f6e 3a20 782c 2079 2070 6f73 6974 696f  on: x, y positio
-000060d0: 6e2e 0a20 2020 2020 2020 2020 2020 2070  n..            p
-000060e0: 6f72 745f 6964 3a20 6e61 6d65 206f 6620  ort_id: name of 
-000060f0: 7468 6520 706f 7274 2e0a 2020 2020 2020  the port..      
-00006100: 2020 2020 2020 726f 7461 7469 6f6e 3a20        rotation: 
-00006110: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
-00006120: 2020 2020 2020 2020 685f 6d69 7272 6f72          h_mirror
-00006130: 3a20 686f 7269 7a6f 6e74 616c 206d 6972  : horizontal mir
-00006140: 726f 7220 7573 696e 6720 7920 6178 6973  ror using y axis
-00006150: 2028 782c 2031 2920 2831 2c20 3029 2e0a   (x, 1) (1, 0)..
-00006160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006170: 5468 6973 2069 7320 7468 6520 6d6f 7374  This is the most
-00006180: 2063 6f6d 6d6f 6e20 6d69 7272 6f72 2e0a   common mirror..
-00006190: 2020 2020 2020 2020 2020 2020 765f 6d69              v_mi
-000061a0: 7272 6f72 3a20 7665 7274 6963 616c 206d  rror: vertical m
-000061b0: 6972 726f 7220 7573 696e 6720 7820 6178  irror using x ax
-000061c0: 6973 2028 312c 2079 2920 2830 2c20 7929  is (1, y) (0, y)
-000061d0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000061e0: 2020 2020 2020 5f72 6566 203d 2043 6f6d        _ref = Com
-000061f0: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
-00006200: 7365 6c66 290a 0a20 2020 2020 2020 2069  self)..        i
-00006210: 6620 706f 7274 5f69 6420 616e 6420 706f  f port_id and po
-00006220: 7274 5f69 6420 6e6f 7420 696e 2073 656c  rt_id not in sel
-00006230: 662e 706f 7274 733a 0a20 2020 2020 2020  f.ports:.       
-00006240: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00006250: 4572 726f 7228 6622 706f 7274 207b 706f  Error(f"port {po
-00006260: 7274 5f69 647d 206e 6f74 2069 6e20 7b73  rt_id} not in {s
-00006270: 656c 662e 706f 7274 732e 6b65 7973 2829  elf.ports.keys()
-00006280: 7d22 290a 0a20 2020 2020 2020 206f 7269  }")..        ori
-00006290: 6769 6e20 3d20 7365 6c66 2e70 6f72 7473  gin = self.ports
-000062a0: 5b70 6f72 745f 6964 5d2e 6365 6e74 6572  [port_id].center
-000062b0: 2069 6620 706f 7274 5f69 6420 656c 7365   if port_id else
-000062c0: 2028 302c 2030 290a 2020 2020 2020 2020   (0, 0).        
-000062d0: 6966 2068 5f6d 6972 726f 723a 0a20 2020  if h_mirror:.   
-000062e0: 2020 2020 2020 2020 205f 7265 662e 6d69           _ref.mi
-000062f0: 7272 6f72 5f78 2870 6f72 745f 6964 290a  rror_x(port_id).
-00006300: 0a20 2020 2020 2020 2069 6620 765f 6d69  .        if v_mi
-00006310: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00006320: 2020 5f72 6566 2e6d 6972 726f 725f 7928    _ref.mirror_y(
-00006330: 706f 7274 5f69 6429 0a0a 2020 2020 2020  port_id)..      
-00006340: 2020 6966 2072 6f74 6174 696f 6e20 213d    if rotation !=
-00006350: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00006360: 5f72 6566 2e72 6f74 6174 6528 726f 7461  _ref.rotate(rota
-00006370: 7469 6f6e 2c20 6f72 6967 696e 290a 2020  tion, origin).  
-00006380: 2020 2020 2020 5f72 6566 2e6d 6f76 6528        _ref.move(
-00006390: 6f72 6967 696e 2c20 706f 7369 7469 6f6e  origin, position
-000063a0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000063b0: 6e20 5f72 6566 0a0a 2020 2020 6465 6620  n _ref..    def 
-000063c0: 7265 665f 6365 6e74 6572 2873 656c 662c  ref_center(self,
-000063d0: 2070 6f73 6974 696f 6e3d 2830 2c20 3029   position=(0, 0)
-000063e0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-000063f0: 7475 726e 7320 6120 7265 6665 7265 6e63  turns a referenc
-00006400: 6520 6f66 2074 6865 2063 6f6d 706f 6e65  e of the compone
-00006410: 6e74 2063 656e 7465 7265 6420 6174 2028  nt centered at (
-00006420: 783d 302c 2079 3d30 292e 2222 220a 2020  x=0, y=0).""".  
-00006430: 2020 2020 2020 7369 203d 2073 656c 662e        si = self.
-00006440: 7369 7a65 5f69 6e66 6f0a 2020 2020 2020  size_info.      
-00006450: 2020 7963 203d 2073 692e 736f 7574 6820    yc = si.south 
-00006460: 2b20 7369 2e68 6569 6768 7420 2f20 320a  + si.height / 2.
-00006470: 2020 2020 2020 2020 7863 203d 2073 692e          xc = si.
-00006480: 7765 7374 202b 2073 692e 7769 6474 6820  west + si.width 
-00006490: 2f20 320a 2020 2020 2020 2020 6365 6e74  / 2.        cent
-000064a0: 6572 203d 2028 7863 2c20 7963 290a 2020  er = (xc, yc).  
-000064b0: 2020 2020 2020 5f72 6566 203d 2043 6f6d        _ref = Com
-000064c0: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
-000064d0: 7365 6c66 290a 2020 2020 2020 2020 5f72  self).        _r
-000064e0: 6566 2e6d 6f76 6528 6365 6e74 6572 2c20  ef.move(center, 
-000064f0: 706f 7369 7469 6f6e 290a 2020 2020 2020  position).      
-00006500: 2020 7265 7475 726e 205f 7265 660a 0a20    return _ref.. 
-00006510: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
-00006520: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
-00006530: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-00006540: 6120 7374 7269 6e67 2072 6570 7265 7365  a string represe
-00006550: 6e74 6174 696f 6e20 6f66 2074 6865 206f  ntation of the o
-00006560: 626a 6563 742e 2222 220a 2020 2020 2020  bject.""".      
-00006570: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-00006580: 2020 2020 2020 2066 227b 7365 6c66 2e6e         f"{self.n
-00006590: 616d 657d 3a20 7569 6420 7b73 656c 662e  ame}: uid {self.
-000065a0: 7569 647d 2c20 220a 2020 2020 2020 2020  uid}, ".        
-000065b0: 2020 2020 6622 706f 7274 7320 7b6c 6973      f"ports {lis
-000065c0: 7428 7365 6c66 2e70 6f72 7473 2e6b 6579  t(self.ports.key
-000065d0: 7328 2929 7d2c 2022 0a20 2020 2020 2020  s())}, ".       
-000065e0: 2020 2020 2066 2272 6566 6572 656e 6365       f"reference
-000065f0: 7320 7b6c 6973 7428 7365 6c66 2e6e 616d  s {list(self.nam
-00006600: 6564 5f72 6566 6572 656e 6365 732e 6b65  ed_references.ke
-00006610: 7973 2829 297d 2c20 220a 2020 2020 2020  ys())}, ".      
-00006620: 2020 2020 2020 6622 7b6c 656e 2873 656c        f"{len(sel
-00006630: 662e 706f 6c79 676f 6e73 297d 2070 6f6c  f.polygons)} pol
-00006640: 7967 6f6e 7322 0a20 2020 2020 2020 2029  ygons".        )
-00006650: 0a0a 2020 2020 6465 6620 7070 7269 6e74  ..    def pprint
-00006660: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00006670: 2020 2020 2020 2020 2222 2250 7269 6e74          """Print
-00006680: 7320 636f 6d70 6f6e 656e 7420 696e 666f  s component info
-00006690: 2e22 2222 0a20 2020 2020 2020 2074 7279  .""".        try
-000066a0: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
-000066b0: 6f6d 2072 6963 6820 696d 706f 7274 2070  om rich import p
-000066c0: 7265 7474 790a 0a20 2020 2020 2020 2020  retty..         
-000066d0: 2020 2070 7265 7474 792e 696e 7374 616c     pretty.instal
-000066e0: 6c28 290a 2020 2020 2020 2020 2020 2020  l().            
-000066f0: 7072 6574 7479 2e70 7072 696e 7428 7365  pretty.pprint(se
-00006700: 6c66 2e74 6f5f 6469 6374 2829 290a 2020  lf.to_dict()).  
-00006710: 2020 2020 2020 6578 6365 7074 2049 6d70        except Imp
-00006720: 6f72 7445 7272 6f72 3a0a 2020 2020 2020  ortError:.      
-00006730: 2020 2020 2020 7072 696e 7428 7961 6d6c        print(yaml
-00006740: 2e64 756d 7028 7365 6c66 2e74 6f5f 6469  .dump(self.to_di
-00006750: 6374 2829 2929 0a0a 2020 2020 6465 6620  ct()))..    def 
-00006760: 7070 7269 6e74 5f70 6f72 7473 2873 656c  pprint_ports(sel
-00006770: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00006780: 2020 2020 2222 2250 7269 6e74 7320 636f      """Prints co
-00006790: 6d70 6f6e 656e 7420 6e65 746c 6973 7473  mponent netlists
-000067a0: 2e22 2222 0a20 2020 2020 2020 2070 6f72  .""".        por
-000067b0: 7473 5f6c 6973 7420 3d20 7365 6c66 2e67  ts_list = self.g
-000067c0: 6574 5f70 6f72 7473 5f6c 6973 7428 290a  et_ports_list().
-000067d0: 2020 2020 2020 2020 666f 7220 706f 7274          for port
-000067e0: 2069 6e20 706f 7274 735f 6c69 7374 3a0a   in ports_list:.
-000067f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00006800: 7428 706f 7274 290a 0a20 2020 2040 7072  t(port)..    @pr
-00006810: 6f70 6572 7479 0a20 2020 2064 6566 206d  operty.    def m
-00006820: 6574 6164 6174 615f 6368 696c 6428 7365  etadata_child(se
-00006830: 6c66 2920 2d3e 2044 6963 743a 0a20 2020  lf) -> Dict:.   
-00006840: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00006850: 6d65 7461 6461 7461 2066 726f 6d20 6368  metadata from ch
-00006860: 696c 6420 6966 2061 6e79 2c20 4f74 6865  ild if any, Othe
-00006870: 7277 6973 6520 7265 7475 726e 7320 636f  rwise returns co
-00006880: 6d70 6f6e 656e 7420 6f77 6e2e 0a0a 2020  mponent own...  
-00006890: 2020 2020 2020 6d65 7461 6461 7461 2047        metadata G
-000068a0: 7265 6174 2074 6f20 6163 6365 7373 2074  reat to access t
-000068b0: 6865 2063 6869 6c64 7265 6e20 6d65 7461  he children meta
-000068c0: 6461 7461 2061 7420 7468 6520 626f 7474  data at the bott
-000068d0: 6f6d 206f 6620 7468 650a 2020 2020 2020  om of the.      
-000068e0: 2020 6869 6572 6172 6368 792e 0a20 2020    hierarchy..   
-000068f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00006900: 2073 6574 7469 6e67 7320 3d20 6469 6374   settings = dict
-00006910: 2873 656c 662e 7365 7474 696e 6773 290a  (self.settings).
-00006920: 0a20 2020 2020 2020 2077 6869 6c65 2073  .        while s
-00006930: 6574 7469 6e67 732e 6765 7428 2263 6869  ettings.get("chi
-00006940: 6c64 2229 3a0a 2020 2020 2020 2020 2020  ld"):.          
-00006950: 2020 7365 7474 696e 6773 203d 2073 6574    settings = set
-00006960: 7469 6e67 732e 6765 7428 2263 6869 6c64  tings.get("child
-00006970: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
-00006980: 726e 2064 6963 7428 7365 7474 696e 6773  rn dict(settings
-00006990: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
-000069a0: 0a20 2020 2064 6566 206d 6574 6164 6174  .    def metadat
-000069b0: 6128 7365 6c66 2920 2d3e 2044 6963 743a  a(self) -> Dict:
-000069c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000069d0: 6469 6374 2873 656c 662e 7365 7474 696e  dict(self.settin
-000069e0: 6773 290a 0a20 2020 2064 6566 2061 6464  gs)..    def add
-000069f0: 5f70 6f72 7428 0a20 2020 2020 2020 2073  _port(.        s
-00006a00: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
-00006a10: 653a 204f 7074 696f 6e61 6c5b 556e 696f  e: Optional[Unio
-00006a20: 6e5b 7374 722c 206f 626a 6563 745d 5d20  n[str, object]] 
-00006a30: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00006a40: 6365 6e74 6572 3a20 4f70 7469 6f6e 616c  center: Optional
-00006a50: 5b54 7570 6c65 5b66 6c6f 6174 2c20 666c  [Tuple[float, fl
-00006a60: 6f61 745d 5d20 3d20 4e6f 6e65 2c0a 2020  oat]] = None,.  
-00006a70: 2020 2020 2020 7769 6474 683a 204f 7074        width: Opt
-00006a80: 696f 6e61 6c5b 666c 6f61 745d 203d 204e  ional[float] = N
-00006a90: 6f6e 652c 0a20 2020 2020 2020 206f 7269  one,.        ori
-00006aa0: 656e 7461 7469 6f6e 3a20 4f70 7469 6f6e  entation: Option
-00006ab0: 616c 5b66 6c6f 6174 5d20 3d20 4e6f 6e65  al[float] = None
-00006ac0: 2c0a 2020 2020 2020 2020 706f 7274 3a20  ,.        port: 
-00006ad0: 4f70 7469 6f6e 616c 5b50 6f72 745d 203d  Optional[Port] =
-00006ae0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
-00006af0: 6179 6572 3a20 4f70 7469 6f6e 616c 5b4c  ayer: Optional[L
-00006b00: 6179 6572 5370 6563 5d20 3d20 4e6f 6e65  ayerSpec] = None
-00006b10: 2c0a 2020 2020 2020 2020 706f 7274 5f74  ,.        port_t
-00006b20: 7970 653a 204f 7074 696f 6e61 6c5b 7374  ype: Optional[st
-00006b30: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
-00006b40: 2020 2063 726f 7373 5f73 6563 7469 6f6e     cross_section
-00006b50: 3a20 4f70 7469 6f6e 616c 5b43 726f 7373  : Optional[Cross
-00006b60: 5365 6374 696f 6e5d 203d 204e 6f6e 652c  Section] = None,
-00006b70: 0a20 2020 2029 202d 3e20 506f 7274 3a0a  .    ) -> Port:.
-00006b80: 2020 2020 2020 2020 2222 2241 6464 2070          """Add p
-00006b90: 6f72 7420 746f 2063 6f6d 706f 6e65 6e74  ort to component
-00006ba0: 2e0a 0a20 2020 2020 2020 2059 6f75 2063  ...        You c
-00006bb0: 616e 2063 6f70 7920 616e 2065 7869 7374  an copy an exist
-00006bc0: 696e 6720 706f 7274 206c 696b 6520 6164  ing port like ad
-00006bd0: 645f 706f 7274 2870 6f72 7420 3d20 6578  d_port(port = ex
-00006be0: 6973 7469 6e67 5f70 6f72 7429 206f 720a  isting_port) or.
-00006bf0: 2020 2020 2020 2020 6372 6561 7465 2061          create a
-00006c00: 206e 6577 2070 6f72 7420 6164 645f 706f   new port add_po
-00006c10: 7274 286d 796e 616d 652c 206d 7963 656e  rt(myname, mycen
-00006c20: 7465 722c 206d 7977 6964 7468 2c20 6d79  ter, mywidth, my
-00006c30: 6f72 6965 6e74 6174 696f 6e29 2e0a 2020  orientation)..  
-00006c40: 2020 2020 2020 596f 7520 6361 6e20 616c        You can al
-00006c50: 736f 2063 6f70 7920 616e 2065 7869 7374  so copy an exist
-00006c60: 696e 6720 706f 7274 0a20 2020 2020 2020  ing port.       
-00006c70: 2077 6974 6820 6120 6e65 7720 6e61 6d65   with a new name
-00006c80: 2061 6464 5f70 6f72 7428 706f 7274 203d   add_port(port =
-00006c90: 2065 7869 7374 696e 675f 706f 7274 2c20   existing_port, 
-00006ca0: 6e61 6d65 203d 206e 6577 5f6e 616d 6529  name = new_name)
-00006cb0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00006cc0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00006cd0: 3a20 706f 7274 206e 616d 652e 0a20 2020  : port name..   
-00006ce0: 2020 2020 2020 2020 2063 656e 7465 723a           center:
-00006cf0: 2078 2c20 792e 0a20 2020 2020 2020 2020   x, y..         
-00006d00: 2020 2077 6964 7468 3a20 696e 2075 6d2e     width: in um.
-00006d10: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-00006d20: 656e 7461 7469 6f6e 3a20 696e 2064 6567  entation: in deg
-00006d30: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-00006d40: 7274 3a20 6f70 7469 6f6e 616c 2070 6f72  rt: optional por
-00006d50: 742e 0a20 2020 2020 2020 2020 2020 206c  t..            l
-00006d60: 6179 6572 3a20 706f 7274 206c 6179 6572  ayer: port layer
-00006d70: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-00006d80: 7274 5f74 7970 653a 206f 7074 6963 616c  rt_type: optical
-00006d90: 2c20 656c 6563 7472 6963 616c 2c20 7665  , electrical, ve
-00006da0: 7274 6963 616c 5f64 632c 2076 6572 7469  rtical_dc, verti
-00006db0: 6361 6c5f 7465 2c20 7665 7274 6963 616c  cal_te, vertical
-00006dc0: 5f74 6d2e 2044 6566 6175 6c74 7320 746f  _tm. Defaults to
-00006dd0: 206f 7074 6963 616c 2e0a 2020 2020 2020   optical..      
-00006de0: 2020 2020 2020 6372 6f73 735f 7365 6374        cross_sect
-00006df0: 696f 6e3a 2070 6f72 7420 6372 6f73 735f  ion: port cross_
-00006e00: 7365 6374 696f 6e2e 0a20 2020 2020 2020  section..       
-00006e10: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00006e20: 6d20 6764 7366 6163 746f 7279 2e70 646b  m gdsfactory.pdk
-00006e30: 2069 6d70 6f72 7420 6765 745f 6c61 7965   import get_laye
-00006e40: 720a 0a20 2020 2020 2020 206c 6179 6572  r..        layer
-00006e50: 203d 2067 6574 5f6c 6179 6572 286c 6179   = get_layer(lay
-00006e60: 6572 290a 0a20 2020 2020 2020 2069 6620  er)..        if 
-00006e70: 706f 7274 3a0a 2020 2020 2020 2020 2020  port:.          
-00006e80: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00006e90: 6e63 6528 706f 7274 2c20 506f 7274 293a  nce(port, Port):
-00006ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006eb0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00006ec0: 7228 6622 6164 645f 706f 7274 2829 206e  r(f"add_port() n
-00006ed0: 6565 6473 2061 2050 6f72 742c 2067 6f74  eeds a Port, got
-00006ee0: 207b 7479 7065 2870 6f72 7429 7d22 290a   {type(port)}").
-00006ef0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-00006f00: 706f 7274 2e63 6f70 7928 290a 2020 2020  port.copy().    
-00006f10: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-00006f20: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00006f30: 2020 2020 2020 2020 2020 2020 2070 2e6e               p.n
-00006f40: 616d 6520 3d20 6e61 6d65 0a20 2020 2020  ame = name.     
-00006f50: 2020 2020 2020 2069 6620 6365 6e74 6572         if center
-00006f60: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00006f70: 2020 2020 2020 2020 2020 2020 2020 702e                p.
-00006f80: 6365 6e74 6572 203d 2063 656e 7465 720a  center = center.
-00006f90: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-00006fa0: 6964 7468 2069 7320 6e6f 7420 4e6f 6e65  idth is not None
-00006fb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006fc0: 2020 702e 7769 6474 6820 3d20 7769 6474    p.width = widt
-00006fd0: 680a 2020 2020 2020 2020 2020 2020 6966  h.            if
-00006fe0: 206f 7269 656e 7461 7469 6f6e 2069 7320   orientation is 
-00006ff0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00007000: 2020 2020 2020 2020 2020 702e 6f72 6965            p.orie
-00007010: 6e74 6174 696f 6e20 3d20 6f72 6965 6e74  ntation = orient
-00007020: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-00007030: 2020 6966 2070 6f72 745f 7479 7065 2069    if port_type i
-00007040: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00007050: 2020 2020 2020 2020 2020 2020 702e 706f              p.po
-00007060: 7274 5f74 7970 6520 3d20 706f 7274 5f74  rt_type = port_t
-00007070: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
-00007080: 6966 206c 6179 6572 2069 7320 6e6f 7420  if layer is not 
-00007090: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000070a0: 2020 2020 2020 702e 6c61 7965 7220 3d20        p.layer = 
-000070b0: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
-000070c0: 2020 702e 7061 7265 6e74 203d 2073 656c    p.parent = sel
-000070d0: 660a 0a20 2020 2020 2020 2065 6c69 6620  f..        elif 
-000070e0: 6973 696e 7374 616e 6365 286e 616d 652c  isinstance(name,
-000070f0: 2050 6f72 7429 3a0a 2020 2020 2020 2020   Port):.        
-00007100: 2020 2020 7020 3d20 6e61 6d65 2e63 6f70      p = name.cop
-00007110: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-00007120: 702e 7061 7265 6e74 203d 2073 656c 660a  p.parent = self.
-00007130: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00007140: 203d 2070 2e6e 616d 650a 2020 2020 2020   = p.name.      
-00007150: 2020 656c 6966 2063 656e 7465 7220 6973    elif center is
-00007160: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00007170: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00007180: 726f 7228 2250 6f72 7420 6e65 6564 7320  ror("Port needs 
-00007190: 6365 6e74 6572 2070 6172 616d 6574 6572  center parameter
-000071a0: 2028 782c 2079 2920 756d 2e22 290a 0a20   (x, y) um.").. 
-000071b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000071c0: 2020 2020 2020 2020 2070 203d 2050 6f72           p = Por
-000071d0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-000071e0: 2020 206e 616d 653d 6e61 6d65 2c0a 2020     name=name,.  
-000071f0: 2020 2020 2020 2020 2020 2020 2020 6365                ce
-00007200: 6e74 6572 3d63 656e 7465 722c 0a20 2020  nter=center,.   
-00007210: 2020 2020 2020 2020 2020 2020 2077 6964               wid
-00007220: 7468 3d77 6964 7468 2c0a 2020 2020 2020  th=width,.      
-00007230: 2020 2020 2020 2020 2020 6f72 6965 6e74            orient
-00007240: 6174 696f 6e3d 6f72 6965 6e74 6174 696f  ation=orientatio
-00007250: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00007260: 2020 2070 6172 656e 743d 7365 6c66 2c0a     parent=self,.
-00007270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007280: 6c61 7965 723d 6c61 7965 722c 0a20 2020  layer=layer,.   
-00007290: 2020 2020 2020 2020 2020 2020 2070 6f72               por
-000072a0: 745f 7479 7065 3d70 6f72 745f 7479 7065  t_type=port_type
-000072b0: 206f 7220 226f 7074 6963 616c 222c 0a20   or "optical",. 
-000072c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000072d0: 726f 7373 5f73 6563 7469 6f6e 3d63 726f  ross_section=cro
-000072e0: 7373 5f73 6563 7469 6f6e 2c0a 2020 2020  ss_section,.    
-000072f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00007300: 2020 6966 206e 616d 6520 6973 206e 6f74    if name is not
-00007310: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00007320: 2020 2070 2e6e 616d 6520 3d20 6e61 6d65     p.name = name
-00007330: 0a20 2020 2020 2020 2069 6620 702e 6e61  .        if p.na
-00007340: 6d65 2069 6e20 7365 6c66 2e70 6f72 7473  me in self.ports
-00007350: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00007360: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00007370: 2261 6464 5f70 6f72 7428 2920 506f 7274  "add_port() Port
-00007380: 206e 616d 6520 7b70 2e6e 616d 6521 727d   name {p.name!r}
-00007390: 2065 7869 7374 7320 696e 207b 7365 6c66   exists in {self
-000073a0: 2e6e 616d 6521 727d 2229 0a0a 2020 2020  .name!r}")..    
-000073b0: 2020 2020 7365 6c66 2e70 6f72 7473 5b70      self.ports[p
-000073c0: 2e6e 616d 655d 203d 2070 0a20 2020 2020  .name] = p.     
-000073d0: 2020 2072 6574 7572 6e20 700a 0a20 2020     return p..   
-000073e0: 2064 6566 2061 6464 5f70 6f72 7473 280a   def add_ports(.
-000073f0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00007400: 2020 2020 2020 706f 7274 733a 2055 6e69        ports: Uni
-00007410: 6f6e 5b4c 6973 745b 506f 7274 5d2c 2044  on[List[Port], D
-00007420: 6963 745b 7374 722c 2050 6f72 745d 5d2c  ict[str, Port]],
-00007430: 0a20 2020 2020 2020 2070 7265 6669 783a  .        prefix:
-00007440: 2073 7472 203d 2022 222c 0a20 2020 2020   str = "",.     
-00007450: 2020 2073 7566 6669 783a 2073 7472 203d     suffix: str =
-00007460: 2022 222c 0a20 2020 2020 2020 202a 2a6b   "",.        **k
-00007470: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
-00007480: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00007490: 2241 6464 2061 206c 6973 7420 6f72 2064  "Add a list or d
-000074a0: 6963 7420 6f66 2070 6f72 7473 2e0a 0a20  ict of ports... 
-000074b0: 2020 2020 2020 2079 6f75 2063 616e 2069         you can i
-000074c0: 6e63 6c75 6465 2061 2070 7265 6669 7820  nclude a prefix 
-000074d0: 746f 2061 6464 2074 6f20 7468 6520 6e65  to add to the ne
-000074e0: 7720 706f 7274 206e 616d 6573 2074 6f20  w port names to 
-000074f0: 6176 6f69 6420 6e61 6d65 2063 6f6e 666c  avoid name confl
-00007500: 6963 7473 2e0a 0a20 2020 2020 2020 2041  icts...        A
-00007510: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00007520: 2070 6f72 7473 3a20 6c69 7374 206f 7220   ports: list or 
-00007530: 6469 6374 206f 6620 706f 7274 732e 0a20  dict of ports.. 
-00007540: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00007550: 783a 2074 6f20 7072 6570 656e 6420 746f  x: to prepend to
-00007560: 2065 6163 6820 706f 7274 206e 616d 652e   each port name.
-00007570: 0a20 2020 2020 2020 2020 2020 2073 7566  .            suf
-00007580: 6669 783a 2074 6f20 6170 7065 6e64 2074  fix: to append t
-00007590: 6f20 6561 6368 2070 6f72 7420 6e61 6d65  o each port name
-000075a0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000075b0: 2020 2020 2020 706f 7274 7320 3d20 706f        ports = po
-000075c0: 7274 7320 6966 2069 7369 6e73 7461 6e63  rts if isinstanc
-000075d0: 6528 706f 7274 732c 206c 6973 7429 2065  e(ports, list) e
-000075e0: 6c73 6520 706f 7274 732e 7661 6c75 6573  lse ports.values
-000075f0: 2829 0a20 2020 2020 2020 2066 6f72 2070  ().        for p
-00007600: 6f72 7420 696e 206c 6973 7428 706f 7274  ort in list(port
-00007610: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00007620: 6e61 6d65 203d 2066 227b 7072 6566 6978  name = f"{prefix
-00007630: 7d7b 706f 7274 2e6e 616d 657d 7b73 7566  }{port.name}{suf
-00007640: 6669 787d 220a 2020 2020 2020 2020 2020  fix}".          
-00007650: 2020 7365 6c66 2e61 6464 5f70 6f72 7428    self.add_port(
-00007660: 6e61 6d65 3d6e 616d 652c 2070 6f72 743d  name=name, port=
-00007670: 706f 7274 2c20 2a2a 6b77 6172 6773 290a  port, **kwargs).
-00007680: 0a20 2020 2064 6566 2073 6e61 705f 706f  .    def snap_po
-00007690: 7274 735f 746f 5f67 7269 6428 7365 6c66  rts_to_grid(self
-000076a0: 2c20 6e6d 3a20 696e 7420 3d20 3129 202d  , nm: int = 1) -
-000076b0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000076c0: 666f 7220 706f 7274 2069 6e20 7365 6c66  for port in self
-000076d0: 2e70 6f72 7473 2e76 616c 7565 7328 293a  .ports.values():
-000076e0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
-000076f0: 742e 736e 6170 5f74 6f5f 6772 6964 286e  t.snap_to_grid(n
-00007700: 6d3d 6e6d 290a 0a20 2020 2064 6566 2072  m=nm)..    def r
-00007710: 656d 6f76 655f 6c61 7965 7273 280a 2020  emove_layers(.  
-00007720: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00007730: 2020 2020 6c61 7965 7273 3a20 4c69 7374      layers: List
-00007740: 5b4c 6179 6572 5370 6563 5d2c 0a20 2020  [LayerSpec],.   
-00007750: 2020 2020 2069 6e63 6c75 6465 5f6c 6162       include_lab
-00007760: 656c 733a 2062 6f6f 6c20 3d20 5472 7565  els: bool = True
-00007770: 2c0a 2020 2020 2020 2020 696e 7665 7274  ,.        invert
-00007780: 5f73 656c 6563 7469 6f6e 3a20 626f 6f6c  _selection: bool
-00007790: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-000077a0: 2020 7265 6375 7273 6976 653a 2062 6f6f    recursive: boo
-000077b0: 6c20 3d20 5472 7565 2c0a 2020 2020 2920  l = True,.    ) 
-000077c0: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-000077d0: 2020 2020 2020 2222 2252 656d 6f76 6520        """Remove 
-000077e0: 6120 6c69 7374 206f 6620 6c61 7965 7273  a list of layers
-000077f0: 2061 6e64 2072 6574 7572 6e73 2074 6865   and returns the
-00007800: 2073 616d 6520 436f 6d70 6f6e 656e 742e   same Component.
-00007810: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00007820: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00007830: 7273 3a20 6c69 7374 206f 6620 6c61 7965  rs: list of laye
-00007840: 7273 2074 6f20 7265 6d6f 7665 2e0a 2020  rs to remove..  
-00007850: 2020 2020 2020 2020 2020 696e 636c 7564            includ
-00007860: 655f 6c61 6265 6c73 3a20 7265 6d6f 7665  e_labels: remove
-00007870: 206c 6162 656c 7320 6f6e 2074 686f 7365   labels on those
-00007880: 206c 6179 6572 732e 0a20 2020 2020 2020   layers..       
-00007890: 2020 2020 2069 6e76 6572 745f 7365 6c65       invert_sele
-000078a0: 6374 696f 6e3a 2072 656d 6f76 6573 2061  ction: removes a
-000078b0: 6c6c 206c 6179 6572 7320 6578 6365 7074  ll layers except
-000078c0: 206c 6179 6572 7320 7370 6563 6966 6965   layers specifie
-000078d0: 642e 0a20 2020 2020 2020 2020 2020 2072  d..            r
-000078e0: 6563 7572 7369 7665 3a20 6f70 6572 6174  ecursive: operat
-000078f0: 6520 6f6e 2074 6865 2063 656c 6c73 2069  e on the cells i
-00007900: 6e63 6c75 6465 6420 696e 2074 6869 7320  ncluded in this 
-00007910: 6365 6c6c 2e0a 2020 2020 2020 2020 2222  cell..        ""
-00007920: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
-00007930: 6473 6661 6374 6f72 7920 696d 706f 7274  dsfactory import
-00007940: 2067 6574 5f6c 6179 6572 0a0a 2020 2020   get_layer..    
-00007950: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
-00007960: 7365 6c66 2e66 6c61 7474 656e 2829 2069  self.flatten() i
-00007970: 6620 7265 6375 7273 6976 6520 616e 6420  f recursive and 
-00007980: 7365 6c66 2e72 6566 6572 656e 6365 7320  self.references 
-00007990: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
-000079a0: 2020 6c61 7965 7273 203d 205b 6765 745f    layers = [get_
-000079b0: 6c61 7965 7228 6c61 7965 7229 2066 6f72  layer(layer) for
-000079c0: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
-000079d0: 5d0a 0a20 2020 2020 2020 2073 686f 756c  ]..        shoul
-000079e0: 645f 7265 6d6f 7665 203d 206e 6f74 2069  d_remove = not i
-000079f0: 6e76 6572 745f 7365 6c65 6374 696f 6e0a  nvert_selection.
-00007a00: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-00007a10: 742e 5f63 656c 6c2e 6669 6c74 6572 280a  t._cell.filter(.
-00007a20: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-00007a30: 3d6c 6179 6572 732c 0a20 2020 2020 2020  =layers,.       
-00007a40: 2020 2020 2072 656d 6f76 653d 7368 6f75       remove=shou
-00007a50: 6c64 5f72 656d 6f76 652c 0a20 2020 2020  ld_remove,.     
-00007a60: 2020 2020 2020 2070 6f6c 7967 6f6e 733d         polygons=
-00007a70: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00007a80: 2020 7061 7468 733d 5472 7565 2c0a 2020    paths=True,.  
-00007a90: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
-00007aa0: 3d69 6e63 6c75 6465 5f6c 6162 656c 732c  =include_labels,
-00007ab0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00007ac0: 2020 2072 6574 7572 6e20 636f 6d70 6f6e     return compon
-00007ad0: 656e 740a 0a20 2020 2064 6566 2065 7874  ent..    def ext
-00007ae0: 7261 6374 280a 2020 2020 2020 2020 7365  ract(.        se
-00007af0: 6c66 2c0a 2020 2020 2020 2020 6c61 7965  lf,.        laye
-00007b00: 7273 3a20 4c69 7374 5b55 6e69 6f6e 5b54  rs: List[Union[T
-00007b10: 7570 6c65 5b69 6e74 2c20 696e 745d 2c20  uple[int, int], 
-00007b20: 7374 725d 5d2c 0a20 2020 2029 202d 3e20  str]],.    ) -> 
-00007b30: 436f 6d70 6f6e 656e 743a 0a20 2020 2020  Component:.     
-00007b40: 2020 2022 2222 4578 7472 6163 7420 706f     """Extract po
-00007b50: 6c79 676f 6e73 2066 726f 6d20 6120 436f  lygons from a Co
-00007b60: 6d70 6f6e 656e 7420 616e 6420 7265 7475  mponent and retu
-00007b70: 726e 7320 6120 6e65 7720 436f 6d70 6f6e  rns a new Compon
-00007b80: 656e 742e 2222 220a 2020 2020 2020 2020  ent.""".        
-00007b90: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-00007ba0: 7064 6b20 696d 706f 7274 2067 6574 5f6c  pdk import get_l
-00007bb0: 6179 6572 0a0a 2020 2020 2020 2020 6966  ayer..        if
-00007bc0: 2074 7970 6528 6c61 7965 7273 2920 6e6f   type(layers) no
-00007bd0: 7420 696e 2028 6c69 7374 2c20 7475 706c  t in (list, tupl
-00007be0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00007bf0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00007c00: 2866 226c 6179 6572 7320 7b6c 6179 6572  (f"layers {layer
-00007c10: 7321 727d 206e 6565 6473 2074 6f20 6265  s!r} needs to be
-00007c20: 2061 206c 6973 7420 6f72 2074 7570 6c65   a list or tuple
-00007c30: 2229 0a0a 2020 2020 2020 2020 6c61 7965  ")..        laye
-00007c40: 7273 203d 205b 6765 745f 6c61 7965 7228  rs = [get_layer(
-00007c50: 6c61 7965 7229 2066 6f72 206c 6179 6572  layer) for layer
-00007c60: 2069 6e20 6c61 7965 7273 5d0a 2020 2020   in layers].    
-00007c70: 2020 2020 2320 636f 6d70 6f6e 656e 7420      # component 
-00007c80: 3d20 7365 6c66 2e63 6f70 7928 290a 2020  = self.copy().  
-00007c90: 2020 2020 2020 2320 636f 6d70 6f6e 656e        # componen
-00007ca0: 742e 5f63 656c 6c2e 6669 6c74 6572 2873  t._cell.filter(s
-00007cb0: 7065 633d 6c61 7965 7273 2c20 7265 6d6f  pec=layers, remo
-00007cc0: 7665 3d46 616c 7365 290a 0a20 2020 2020  ve=False)..     
-00007cd0: 2020 2063 6f6d 706f 6e65 6e74 203d 2043     component = C
-00007ce0: 6f6d 706f 6e65 6e74 2829 0a20 2020 2020  omponent().     
-00007cf0: 2020 2070 6f6c 795f 6469 6374 203d 2073     poly_dict = s
-00007d00: 656c 662e 6765 745f 706f 6c79 676f 6e73  elf.get_polygons
-00007d10: 2862 795f 7370 6563 3d54 7275 652c 2069  (by_spec=True, i
-00007d20: 6e63 6c75 6465 5f70 6174 6873 3d46 616c  nclude_paths=Fal
-00007d30: 7365 290a 0a20 2020 2020 2020 2066 6f72  se)..        for
-00007d40: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
-00007d50: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00007d60: 206c 6179 6572 2069 6e20 706f 6c79 5f64   layer in poly_d
-00007d70: 6963 743a 0a20 2020 2020 2020 2020 2020  ict:.           
-00007d80: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
-00007d90: 706f 6c79 5f64 6963 745b 6c61 7965 725d  poly_dict[layer]
-00007da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007db0: 2066 6f72 2070 6f6c 7967 6f6e 2069 6e20   for polygon in 
-00007dc0: 706f 6c79 676f 6e73 3a0a 2020 2020 2020  polygons:.      
-00007dd0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00007de0: 6d70 6f6e 656e 742e 6164 645f 706f 6c79  mponent.add_poly
-00007df0: 676f 6e28 706f 6c79 676f 6e2c 206c 6179  gon(polygon, lay
-00007e00: 6572 290a 0a20 2020 2020 2020 2066 6f72  er)..        for
-00007e10: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
-00007e20: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00007e30: 7220 7061 7468 2069 6e20 7365 6c66 2e5f  r path in self._
-00007e40: 6365 6c6c 2e67 6574 5f70 6174 6873 286c  cell.get_paths(l
-00007e50: 6179 6572 3d6c 6179 6572 293a 0a20 2020  ayer=layer):.   
-00007e60: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00007e70: 706f 6e65 6e74 2e61 6464 2870 6174 6829  ponent.add(path)
-00007e80: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00007e90: 2063 6f6d 706f 6e65 6e74 0a0a 2020 2020   component..    
-00007ea0: 6465 6620 6164 645f 706f 6c79 676f 6e28  def add_polygon(
-00007eb0: 7365 6c66 2c20 706f 696e 7473 2c20 6c61  self, points, la
-00007ec0: 7965 723d 6e70 2e6e 616e 293a 0a20 2020  yer=np.nan):.   
-00007ed0: 2020 2020 2022 2222 4164 6473 2061 2050       """Adds a P
-00007ee0: 6f6c 7967 6f6e 2074 6f20 7468 6520 436f  olygon to the Co
-00007ef0: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
-00007f00: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00007f10: 2020 2020 706f 696e 7473 3a20 436f 6f72      points: Coor
-00007f20: 6469 6e61 7465 7320 6f66 2074 6865 2076  dinates of the v
-00007f30: 6572 7469 6365 7320 6f66 2074 6865 2050  ertices of the P
-00007f40: 6f6c 7967 6f6e 2e0a 2020 2020 2020 2020  olygon..        
-00007f50: 2020 2020 6c61 7965 723a 206c 6179 6572      layer: layer
-00007f60: 2073 7065 6320 746f 2061 6464 2070 6f6c   spec to add pol
-00007f70: 7967 6f6e 206f 6e2e 0a20 2020 2020 2020  ygon on..       
-00007f80: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00007f90: 6d20 6764 7366 6163 746f 7279 2e70 646b  m gdsfactory.pdk
-00007fa0: 2069 6d70 6f72 7420 6765 745f 6c61 7965   import get_laye
-00007fb0: 720a 0a20 2020 2020 2020 206c 6179 6572  r..        layer
-00007fc0: 203d 2067 6574 5f6c 6179 6572 286c 6179   = get_layer(lay
-00007fd0: 6572 290a 0a20 2020 2020 2020 2069 6620  er)..        if 
-00007fe0: 6c61 7965 7220 6973 204e 6f6e 653a 0a20  layer is None:. 
-00007ff0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008000: 6e20 4e6f 6e65 0a0a 2020 2020 2020 2020  n None..        
-00008010: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00008020: 2069 6620 6973 696e 7374 616e 6365 286c   if isinstance(l
-00008030: 6179 6572 2c20 7365 7429 3a0a 2020 2020  ayer, set):.    
-00008040: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008050: 726e 205b 7365 6c66 2e61 6464 5f70 6f6c  rn [self.add_pol
-00008060: 7967 6f6e 2870 6f69 6e74 732c 206c 7929  ygon(points, ly)
+00000100: 726f 6d20 636f 7079 2069 6d70 6f72 7420  rom copy import 
+00000110: 6465 6570 636f 7079 0a66 726f 6d20 636f  deepcopy.from co
+00000120: 6c6c 6563 7469 6f6e 7320 696d 706f 7274  llections import
+00000130: 2043 6f75 6e74 6572 0a66 726f 6d20 636f   Counter.from co
+00000140: 6c6c 6563 7469 6f6e 732e 6162 6320 696d  llections.abc im
+00000150: 706f 7274 2049 7465 7261 626c 650a 6672  port Iterable.fr
+00000160: 6f6d 2070 6174 686c 6962 2069 6d70 6f72  om pathlib impor
+00000170: 7420 5061 7468 0a66 726f 6d20 7479 7069  t Path.from typi
+00000180: 6e67 2069 6d70 6f72 7420 416e 792c 2044  ng import Any, D
+00000190: 6963 742c 204c 6973 742c 204f 7074 696f  ict, List, Optio
+000001a0: 6e61 6c2c 2053 6574 2c20 5475 706c 652c  nal, Set, Tuple,
+000001b0: 2055 6e69 6f6e 0a0a 696d 706f 7274 2067   Union..import g
+000001c0: 6473 746b 0a69 6d70 6f72 7420 6e75 6d70  dstk.import nump
+000001d0: 7920 6173 206e 700a 696d 706f 7274 2079  y as np.import y
+000001e0: 616d 6c0a 6672 6f6d 206f 6d65 6761 636f  aml.from omegaco
+000001f0: 6e66 2069 6d70 6f72 7420 4469 6374 436f  nf import DictCo
+00000200: 6e66 6967 2c20 4f6d 6567 6143 6f6e 660a  nfig, OmegaConf.
+00000210: 6672 6f6d 2074 7970 696e 675f 6578 7465  from typing_exte
+00000220: 6e73 696f 6e73 2069 6d70 6f72 7420 4c69  nsions import Li
+00000230: 7465 7261 6c0a 0a66 726f 6d20 6764 7366  teral..from gdsf
+00000240: 6163 746f 7279 2e63 6f6d 706f 6e65 6e74  actory.component
+00000250: 5f6c 6179 6f75 7420 696d 706f 7274 2028  _layout import (
+00000260: 0a20 2020 204c 6162 656c 2c0a 2020 2020  .    Label,.    
+00000270: 506f 6c79 676f 6e2c 0a20 2020 205f 616c  Polygon,.    _al
+00000280: 6967 6e2c 0a20 2020 205f 6469 7374 7269  ign,.    _distri
+00000290: 6275 7465 2c0a 2020 2020 5f47 656f 6d65  bute,.    _Geome
+000002a0: 7472 7948 656c 7065 722c 0a20 2020 205f  tryHelper,.    _
+000002b0: 7061 7273 655f 6c61 7965 722c 0a20 2020  parse_layer,.   
+000002c0: 2067 6574 5f70 6f6c 7967 6f6e 732c 0a29   get_polygons,.)
+000002d0: 0a66 726f 6d20 6764 7366 6163 746f 7279  .from gdsfactory
+000002e0: 2e63 6f6d 706f 6e65 6e74 5f72 6566 6572  .component_refer
+000002f0: 656e 6365 2069 6d70 6f72 7420 436f 6d70  ence import Comp
+00000300: 6f6e 656e 7452 6566 6572 656e 6365 2c20  onentReference, 
+00000310: 436f 6f72 6469 6e61 7465 2c20 5369 7a65  Coordinate, Size
+00000320: 496e 666f 0a66 726f 6d20 6764 7366 6163  Info.from gdsfac
+00000330: 746f 7279 2e63 6f6e 6669 6720 696d 706f  tory.config impo
+00000340: 7274 2043 4f4e 462c 206c 6f67 6765 722c  rt CONF, logger,
+00000350: 2047 4453 4449 525f 5445 4d50 0a66 726f   GDSDIR_TEMP.fro
+00000360: 6d20 6764 7366 6163 746f 7279 2e63 726f  m gdsfactory.cro
+00000370: 7373 5f73 6563 7469 6f6e 2069 6d70 6f72  ss_section impor
+00000380: 7420 4372 6f73 7353 6563 7469 6f6e 0a66  t CrossSection.f
+00000390: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
+000003a0: 6f72 7420 696d 706f 7274 2028 0a20 2020  ort import (.   
+000003b0: 2050 6f72 742c 0a20 2020 2061 7574 6f5f   Port,.    auto_
+000003c0: 7265 6e61 6d65 5f70 6f72 7473 2c0a 2020  rename_ports,.  
+000003d0: 2020 6175 746f 5f72 656e 616d 655f 706f    auto_rename_po
+000003e0: 7274 735f 636f 756e 7465 725f 636c 6f63  rts_counter_cloc
+000003f0: 6b77 6973 652c 0a20 2020 2061 7574 6f5f  kwise,.    auto_
+00000400: 7265 6e61 6d65 5f70 6f72 7473 5f6c 6179  rename_ports_lay
+00000410: 6572 5f6f 7269 656e 7461 7469 6f6e 2c0a  er_orientation,.
+00000420: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
+00000430: 706f 7274 735f 6f72 6965 6e74 6174 696f  ports_orientatio
+00000440: 6e2c 0a20 2020 206d 6170 5f70 6f72 7473  n,.    map_ports
+00000450: 5f6c 6179 6572 5f74 6f5f 6f72 6965 6e74  _layer_to_orient
+00000460: 6174 696f 6e2c 0a20 2020 206d 6170 5f70  ation,.    map_p
+00000470: 6f72 7473 5f74 6f5f 6f72 6965 6e74 6174  orts_to_orientat
+00000480: 696f 6e5f 6363 772c 0a20 2020 206d 6170  ion_ccw,.    map
+00000490: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
+000004a0: 6174 696f 6e5f 6377 2c0a 2020 2020 7365  ation_cw,.    se
+000004b0: 6c65 6374 5f70 6f72 7473 2c0a 290a 6672  lect_ports,.).fr
+000004c0: 6f6d 2067 6473 6661 6374 6f72 792e 7365  om gdsfactory.se
+000004d0: 7269 616c 697a 6174 696f 6e20 696d 706f  rialization impo
+000004e0: 7274 2063 6c65 616e 5f64 6963 740a 6672  rt clean_dict.fr
+000004f0: 6f6d 2067 6473 6661 6374 6f72 792e 736e  om gdsfactory.sn
+00000500: 6170 2069 6d70 6f72 7420 736e 6170 5f74  ap import snap_t
+00000510: 6f5f 6772 6964 0a66 726f 6d20 6764 7366  o_grid.from gdsf
+00000520: 6163 746f 7279 2e74 6563 686e 6f6c 6f67  actory.technolog
+00000530: 7920 696d 706f 7274 204c 6179 6572 5669  y import LayerVi
+00000540: 6577 2c20 4c61 7965 7256 6965 7773 2c20  ew, LayerViews, 
+00000550: 4c61 7965 7253 7461 636b 0a66 726f 6d20  LayerStack.from 
+00000560: 6764 7366 6163 746f 7279 2e67 656e 6572  gdsfactory.gener
+00000570: 6963 5f74 6563 6820 696d 706f 7274 204c  ic_tech import L
+00000580: 4159 4552 0a0a 506c 6f74 7465 7220 3d20  AYER..Plotter = 
+00000590: 4c69 7465 7261 6c5b 2268 6f6c 6f76 6965  Literal["holovie
+000005a0: 7773 222c 2022 6d61 7470 6c6f 746c 6962  ws", "matplotlib
+000005b0: 222c 2022 7174 222c 2022 6b6c 6179 6f75  ", "qt", "klayou
+000005c0: 7422 5d0a 4178 6973 203d 204c 6974 6572  t"].Axis = Liter
+000005d0: 616c 5b22 7822 2c20 2279 225d 0a0a 0a63  al["x", "y"]...c
+000005e0: 6c61 7373 2055 6e63 6163 6865 6443 6f6d  lass UncachedCom
+000005f0: 706f 6e65 6e74 5761 726e 696e 6728 5573  ponentWarning(Us
+00000600: 6572 5761 726e 696e 6729 3a0a 2020 2020  erWarning):.    
+00000610: 7061 7373 0a0a 0a63 6c61 7373 2055 6e63  pass...class Unc
+00000620: 6163 6865 6443 6f6d 706f 6e65 6e74 4572  achedComponentEr
+00000630: 726f 7228 5661 6c75 6545 7272 6f72 293a  ror(ValueError):
+00000640: 0a20 2020 2070 6173 730a 0a0a 636c 6173  .    pass...clas
+00000650: 7320 4d75 7461 6269 6c69 7479 4572 726f  s MutabilityErro
+00000660: 7228 5661 6c75 6545 7272 6f72 293a 0a20  r(ValueError):. 
+00000670: 2020 2070 6173 730a 0a0a 6465 6620 5f67     pass...def _g
+00000680: 6574 5f64 6570 656e 6465 6e63 6965 7328  et_dependencies(
+00000690: 636f 6d70 6f6e 656e 742c 2072 6566 6572  component, refer
+000006a0: 656e 6365 735f 7365 7429 202d 3e20 4e6f  ences_set) -> No
+000006b0: 6e65 3a0a 2020 2020 666f 7220 7265 6620  ne:.    for ref 
+000006c0: 696e 2063 6f6d 706f 6e65 6e74 2e72 6566  in component.ref
+000006d0: 6572 656e 6365 733a 0a20 2020 2020 2020  erences:.       
+000006e0: 2072 6566 6572 656e 6365 735f 7365 742e   references_set.
+000006f0: 6164 6428 7265 662e 7265 665f 6365 6c6c  add(ref.ref_cell
+00000700: 290a 2020 2020 2020 2020 5f67 6574 5f64  ).        _get_d
+00000710: 6570 656e 6465 6e63 6965 7328 7265 662e  ependencies(ref.
+00000720: 7265 665f 6365 6c6c 2c20 7265 6665 7265  ref_cell, refere
+00000730: 6e63 6573 5f73 6574 290a 0a0a 6d75 7461  nces_set)...muta
+00000740: 6269 6c69 7479 5f65 7272 6f72 5f6d 6573  bility_error_mes
+00000750: 7361 6765 203d 2022 2222 0a59 6f75 2063  sage = """.You c
+00000760: 616e 6e6f 7420 6d6f 6469 6679 2061 2043  annot modify a C
+00000770: 6f6d 706f 6e65 6e74 2061 6674 6572 2063  omponent after c
+00000780: 7265 6174 696f 6e20 6173 2069 7420 7769  reation as it wi
+00000790: 6c6c 2061 6666 6563 7420 616c 6c20 6f66  ll affect all of
+000007a0: 2069 7473 2069 6e73 7461 6e63 6573 2e0a   its instances..
+000007b0: 0a43 7265 6174 6520 6120 6e65 7720 436f  .Create a new Co
+000007c0: 6d70 6f6e 656e 7420 616e 6420 6164 6420  mponent and add 
+000007d0: 6120 7265 6665 7265 6e63 6520 746f 2069  a reference to i
+000007e0: 742e 0a0a 466f 7220 6578 616d 706c 653a  t...For example:
+000007f0: 0a0a 2320 4241 440a 6320 3d20 6766 2e63  ..# BAD.c = gf.c
+00000800: 6f6d 706f 6e65 6e74 732e 6265 6e64 5f65  omponents.bend_e
+00000810: 756c 6572 2829 0a63 2e61 6464 5f72 6566  uler().c.add_ref
+00000820: 2867 662e 636f 6d70 6f6e 656e 7473 2e6d  (gf.components.m
+00000830: 7a69 2829 290a 0a23 2047 4f4f 440a 6320  zi())..# GOOD.c 
+00000840: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
+00000850: 0a63 2e61 6464 5f72 6566 2867 662e 636f  .c.add_ref(gf.co
+00000860: 6d70 6f6e 656e 7473 2e62 656e 645f 6575  mponents.bend_eu
+00000870: 6c65 7228 2929 0a63 2e61 6464 5f72 6566  ler()).c.add_ref
+00000880: 2867 662e 636f 6d70 6f6e 656e 7473 2e6d  (gf.components.m
+00000890: 7a69 2829 290a 2222 220a 0a6d 6f76 655f  zi())."""..move_
+000008a0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+000008b0: 2222 220a 596f 7520 6361 6e6e 6f74 206d  """.You cannot m
+000008c0: 6f76 6520 6120 436f 6d70 6f6e 656e 742e  ove a Component.
+000008d0: 2059 6f75 2063 616e 2063 7265 6174 6520   You can create 
+000008e0: 6120 6e65 7720 436f 6d70 6f6e 656e 742c  a new Component,
+000008f0: 2061 6464 2061 2072 6566 6572 656e 6365   add a reference
+00000900: 2074 6f20 7468 6520 6f74 6865 7220 436f   to the other Co
+00000910: 6d70 6f6e 656e 7420 616e 6420 7468 656e  mponent and then
+00000920: 206d 6f76 6520 7468 6520 7265 6665 7265   move the refere
+00000930: 6e63 652e 0a0a 466f 7220 6578 616d 706c  nce...For exampl
+00000940: 653a 0a0a 2320 4241 440a 6320 3d20 6766  e:..# BAD.c = gf
+00000950: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
+00000960: 6967 6874 2829 0a63 2e78 6d69 6e20 3d20  ight().c.xmin = 
+00000970: 3130 0a0a 2320 474f 4f44 0a63 203d 2067  10..# GOOD.c = g
+00000980: 662e 436f 6d70 6f6e 656e 7428 290a 7265  f.Component().re
+00000990: 6620 3d20 632e 6164 645f 7265 6628 6766  f = c.add_ref(gf
+000009a0: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
+000009b0: 6967 6874 2829 2920 2320 6f72 2072 6566  ight()) # or ref
+000009c0: 203d 2063 203c 3c20 6766 2e63 6f6d 706f   = c << gf.compo
+000009d0: 6e65 6e74 732e 7374 7261 6967 6874 2829  nents.straight()
+000009e0: 0a72 6566 2e78 6d69 6e20 3d20 3130 0a22  .ref.xmin = 10."
+000009f0: 2222 0a0a 5061 7468 5479 7065 203d 2055  ""..PathType = U
+00000a00: 6e69 6f6e 5b73 7472 2c20 5061 7468 5d0a  nion[str, Path].
+00000a10: 466c 6f61 7432 203d 2054 7570 6c65 5b66  Float2 = Tuple[f
+00000a20: 6c6f 6174 2c20 666c 6f61 745d 0a4c 6179  loat, float].Lay
+00000a30: 6572 203d 2054 7570 6c65 5b69 6e74 2c20  er = Tuple[int, 
+00000a40: 696e 745d 0a4c 6179 6572 7320 3d20 5475  int].Layers = Tu
+00000a50: 706c 655b 4c61 7965 722c 202e 2e2e 5d0a  ple[Layer, ...].
+00000a60: 4c61 7965 7253 7065 6320 3d20 556e 696f  LayerSpec = Unio
+00000a70: 6e5b 7374 722c 2069 6e74 2c20 4c61 7965  n[str, int, Laye
+00000a80: 722c 204e 6f6e 655d 0a0a 5f74 696d 6573  r, None].._times
+00000a90: 7461 6d70 3230 3139 203d 2064 6174 6574  tamp2019 = datet
+00000aa0: 696d 652e 6461 7465 7469 6d65 2e66 726f  ime.datetime.fro
+00000ab0: 6d74 696d 6573 7461 6d70 2831 3537 3230  mtimestamp(15720
+00000ac0: 3134 3139 322e 3832 3733 290a 4d41 585f  14192.8273).MAX_
+00000ad0: 4e41 4d45 5f4c 454e 4754 4820 3d20 3332  NAME_LENGTH = 32
+00000ae0: 0a0a 0a64 6566 205f 726e 6428 6172 722c  ...def _rnd(arr,
+00000af0: 2070 7265 6369 7369 6f6e 3d31 652d 3429   precision=1e-4)
+00000b00: 3a0a 2020 2020 6172 7220 3d20 6e70 2e61  :.    arr = np.a
+00000b10: 7363 6f6e 7469 6775 6f75 7361 7272 6179  scontiguousarray
+00000b20: 2861 7272 290a 2020 2020 6e64 6967 6974  (arr).    ndigit
+00000b30: 7320 3d20 726f 756e 6428 2d6d 6174 682e  s = round(-math.
+00000b40: 6c6f 6731 3028 7072 6563 6973 696f 6e29  log10(precision)
+00000b50: 290a 2020 2020 7265 7475 726e 206e 702e  ).    return np.
+00000b60: 6173 636f 6e74 6967 756f 7573 6172 7261  ascontiguousarra
+00000b70: 7928 6172 722e 726f 756e 6428 6e64 6967  y(arr.round(ndig
+00000b80: 6974 7329 202f 2070 7265 6369 7369 6f6e  its) / precision
+00000b90: 2c20 6474 7970 653d 6e70 2e69 6e74 3634  , dtype=np.int64
+00000ba0: 290a 0a0a 636c 6173 7320 436f 6d70 6f6e  )...class Compon
+00000bb0: 656e 7428 5f47 656f 6d65 7472 7948 656c  ent(_GeometryHel
+00000bc0: 7065 7229 3a0a 2020 2020 2222 2241 2043  per):.    """A C
+00000bd0: 6f6d 706f 6e65 6e74 2069 7320 616e 2065  omponent is an e
+00000be0: 6d70 7479 2063 616e 7661 7320 7768 6572  mpty canvas wher
+00000bf0: 6520 796f 7520 6164 6420 706f 6c79 676f  e you add polygo
+00000c00: 6e73 2c20 7265 6665 7265 6e63 6573 2061  ns, references a
+00000c10: 6e64 2070 6f72 7473 205c 0a20 2020 2020  nd ports \.     
+00000c20: 2020 2020 2020 2028 746f 2063 6f6e 6e65         (to conne
+00000c30: 6374 2074 6f20 6f74 6865 7220 636f 6d70  ct to other comp
+00000c40: 6f6e 656e 7473 292e 0a0a 2020 2020 2d20  onents)...    - 
+00000c50: 7374 6f72 6573 2073 6574 7469 6e67 7320  stores settings 
+00000c60: 7468 6174 2079 6f75 2075 7365 2074 6f20  that you use to 
+00000c70: 6275 696c 6420 7468 6520 636f 6d70 6f6e  build the compon
+00000c80: 656e 740a 2020 2020 2d20 7374 6f72 6573  ent.    - stores
+00000c90: 2069 6e66 6f20 7468 6174 2079 6f75 2077   info that you w
+00000ca0: 616e 7420 746f 2075 7365 0a20 2020 202d  ant to use.    -
+00000cb0: 2063 616e 2072 6574 7572 6e20 706f 7274   can return port
+00000cc0: 7320 6279 2074 7970 6520 286f 7074 6963  s by type (optic
+00000cd0: 616c 2c20 656c 6563 7472 6963 616c 202e  al, electrical .
+00000ce0: 2e2e 290a 2020 2020 2d20 6361 6e20 7265  ..).    - can re
+00000cf0: 7475 726e 206e 6574 6c69 7374 2066 6f72  turn netlist for
+00000d00: 2063 6972 6375 6974 2073 696d 756c 6174   circuit simulat
+00000d10: 696f 6e0a 2020 2020 2d20 6361 6e20 7772  ion.    - can wr
+00000d20: 6974 6520 746f 2047 4453 2c20 4f41 5349  ite to GDS, OASI
+00000d30: 530a 2020 2020 2d20 6361 6e20 7368 6f77  S.    - can show
+00000d40: 2069 6e20 4b4c 6179 6f75 742c 206d 6174   in KLayout, mat
+00000d50: 706c 6f74 6c69 622c 2033 442c 2051 5420  plotlib, 3D, QT 
+00000d60: 7669 6577 6572 2c20 686f 6c6f 7669 6577  viewer, holoview
+00000d70: 730a 2020 2020 2d20 6361 6e20 7265 7475  s.    - can retu
+00000d80: 726e 2063 6f70 792c 206d 6972 726f 722c  rn copy, mirror,
+00000d90: 2066 6c61 7474 656e 6564 2028 6e6f 2072   flattened (no r
+00000da0: 6566 6572 656e 6365 7329 0a0a 2020 2020  eferences)..    
+00000db0: 4172 6773 3a0a 2020 2020 2020 2020 6e61  Args:.        na
+00000dc0: 6d65 3a20 636f 6d70 6f6e 656e 745f 6e61  me: component_na
+00000dd0: 6d65 2e20 5573 6520 4063 656c 6c20 6465  me. Use @cell de
+00000de0: 636f 7261 746f 7220 666f 7220 6175 746f  corator for auto
+00000df0: 2d6e 616d 696e 672e 0a20 2020 2020 2020  -naming..       
+00000e00: 2077 6974 685f 7575 6964 3a20 6164 6473   with_uuid: adds
+00000e10: 2075 6e69 7175 6520 6964 656e 7469 6669   unique identifi
+00000e20: 6572 2e0a 0a20 2020 2050 726f 7065 7274  er...    Propert
+00000e30: 6965 733a 0a20 2020 2020 2020 2069 6e66  ies:.        inf
+00000e40: 6f3a 2064 6963 7469 6f6e 6172 7920 7468  o: dictionary th
+00000e50: 6174 2069 6e63 6c75 6465 730a 2020 2020  at includes.    
+00000e60: 2020 2020 2020 2020 2d20 6465 7269 7665          - derive
+00000e70: 6420 7072 6f70 6572 7469 6573 0a20 2020  d properties.   
+00000e80: 2020 2020 2020 2020 202d 2065 7874 6572           - exter
+00000e90: 6e61 6c20 6d65 7461 6461 7461 2028 7465  nal metadata (te
+00000ea0: 7374 5f70 726f 746f 636f 6c2c 2064 6f63  st_protocol, doc
+00000eb0: 732c 202e 2e2e 290a 2020 2020 2020 2020  s, ...).        
+00000ec0: 2020 2020 2d20 7369 6d75 6c61 7469 6f6e      - simulation
+00000ed0: 5f73 6574 7469 6e67 730a 2020 2020 2020  _settings.      
+00000ee0: 2020 2020 2020 2d20 6675 6e63 7469 6f6e        - function
+00000ef0: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
+00000f00: 2020 2d20 6e61 6d65 3a20 666f 7220 7468    - name: for th
+00000f10: 6520 636f 6d70 6f6e 656e 740a 0a20 2020  e component..   
+00000f20: 2020 2020 2073 6574 7469 6e67 733a 0a20       settings:. 
+00000f30: 2020 2020 2020 2020 2020 2066 756c 6c3a             full:
+00000f40: 2066 756c 6c20 7365 7474 696e 6773 2070   full settings p
+00000f50: 6173 7365 6420 746f 2074 6865 2066 756e  assed to the fun
+00000f60: 6374 696f 6e20 746f 2063 7265 6174 6520  ction to create 
+00000f70: 636f 6d70 6f6e 656e 742e 0a20 2020 2020  component..     
+00000f80: 2020 2020 2020 2063 6861 6e67 6564 3a20         changed: 
+00000f90: 6368 616e 6765 6420 7365 7474 696e 6773  changed settings
+00000fa0: 2e0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+00000fb0: 6661 756c 743a 2064 6566 6175 6c74 2063  fault: default c
+00000fc0: 6f6d 706f 6e65 6e74 2073 6574 7469 6e67  omponent setting
+00000fd0: 732e 0a20 2020 2020 2020 2020 2020 2063  s..            c
+00000fe0: 6869 6c64 3a20 6469 6374 2069 6e66 6f20  hild: dict info 
+00000ff0: 6672 6f6d 2074 6865 2063 6869 6c64 7265  from the childre
+00001000: 6e2c 2069 6620 616e 792e 0a20 2020 2022  n, if any..    "
+00001010: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00001020: 6974 5f5f 280a 2020 2020 2020 2020 7365  it__(.        se
+00001030: 6c66 2c0a 2020 2020 2020 2020 6e61 6d65  lf,.        name
+00001040: 3a20 7374 7220 3d20 2255 6e6e 616d 6564  : str = "Unnamed
+00001050: 222c 0a20 2020 2020 2020 2077 6974 685f  ",.        with_
+00001060: 7575 6964 3a20 626f 6f6c 203d 2046 616c  uuid: bool = Fal
+00001070: 7365 2c0a 2020 2020 2920 2d3e 204e 6f6e  se,.    ) -> Non
+00001080: 653a 0a20 2020 2020 2020 2022 2222 496e  e:.        """In
+00001090: 6974 6961 6c69 7a65 2074 6865 2043 6f6d  itialize the Com
+000010a0: 706f 6e65 6e74 206f 626a 6563 742e 2222  ponent object.""
+000010b0: 220a 2020 2020 2020 2020 7365 6c66 2e75  ".        self.u
+000010c0: 6964 203d 2073 7472 2875 7569 642e 7575  id = str(uuid.uu
+000010d0: 6964 3428 2929 5b3a 385d 0a20 2020 2020  id4())[:8].     
+000010e0: 2020 2069 6620 7769 7468 5f75 7569 6420     if with_uuid 
+000010f0: 6f72 206e 616d 6520 3d3d 2022 556e 6e61  or name == "Unna
+00001100: 6d65 6422 3a0a 2020 2020 2020 2020 2020  med":.          
+00001110: 2020 6e61 6d65 202b 3d20 6622 5f7b 7365    name += f"_{se
+00001120: 6c66 2e75 6964 7d22 0a0a 2020 2020 2020  lf.uid}"..      
+00001130: 2020 7365 6c66 2e5f 6365 6c6c 203d 2067    self._cell = g
+00001140: 6473 746b 2e43 656c 6c28 6e61 6d65 3d6e  dstk.Cell(name=n
+00001150: 616d 6529 0a20 2020 2020 2020 2073 656c  ame).        sel
+00001160: 662e 6e61 6d65 203d 206e 616d 650a 2020  f.name = name.  
+00001170: 2020 2020 2020 7365 6c66 2e69 6e66 6f3a        self.info:
+00001180: 2044 6963 745b 7374 722c 2041 6e79 5d20   Dict[str, Any] 
+00001190: 3d20 7b7d 0a0a 2020 2020 2020 2020 7365  = {}..        se
+000011a0: 6c66 2e73 6574 7469 6e67 733a 2044 6963  lf.settings: Dic
+000011b0: 745b 7374 722c 2041 6e79 5d20 3d20 7b7d  t[str, Any] = {}
+000011c0: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
+000011d0: 6f63 6b65 6420 3d20 4661 6c73 650a 2020  ocked = False.  
+000011e0: 2020 2020 2020 7365 6c66 2e67 6574 5f63        self.get_c
+000011f0: 6869 6c64 5f6e 616d 6520 3d20 4661 6c73  hild_name = Fals
+00001200: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
+00001210: 7265 6665 7265 6e63 655f 6e61 6d65 735f  reference_names_
+00001220: 636f 756e 7465 7220 3d20 436f 756e 7465  counter = Counte
+00001230: 7228 290a 2020 2020 2020 2020 7365 6c66  r().        self
+00001240: 2e5f 7265 6665 7265 6e63 655f 6e61 6d65  ._reference_name
+00001250: 735f 7573 6564 203d 2073 6574 2829 0a20  s_used = set(). 
+00001260: 2020 2020 2020 2073 656c 662e 5f6e 616d         self._nam
+00001270: 6564 5f72 6566 6572 656e 6365 7320 3d20  ed_references = 
+00001280: 7b7d 0a20 2020 2020 2020 2073 656c 662e  {}.        self.
+00001290: 5f72 6566 6572 656e 6365 7320 3d20 5b5d  _references = []
+000012a0: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+000012b0: 6f72 7473 203d 207b 7d0a 0a20 2020 2040  orts = {}..    @
+000012c0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+000012d0: 2072 6566 6572 656e 6365 7328 7365 6c66   references(self
+000012e0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000012f0: 6e20 7365 6c66 2e5f 7265 6665 7265 6e63  n self._referenc
+00001300: 6573 0a0a 2020 2020 4070 726f 7065 7274  es..    @propert
+00001310: 790a 2020 2020 6465 6620 706f 6c79 676f  y.    def polygo
+00001320: 6e73 2873 656c 6629 202d 3e20 4c69 7374  ns(self) -> List
+00001330: 5b50 6f6c 7967 6f6e 5d3a 0a20 2020 2020  [Polygon]:.     
+00001340: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00001350: 6365 6c6c 2e70 6f6c 7967 6f6e 730a 0a20  cell.polygons.. 
+00001360: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00001370: 2064 6566 2061 7265 6128 7365 6c66 2920   def area(self) 
+00001380: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
+00001390: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+000013a0: 656c 6c2e 6172 6561 0a0a 2020 2020 4070  ell.area..    @p
+000013b0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+000013c0: 6c61 6265 6c73 2873 656c 6629 202d 3e20  labels(self) -> 
+000013d0: 4c69 7374 5b4c 6162 656c 5d3a 0a20 2020  List[Label]:.   
+000013e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000013f0: 2e5f 6365 6c6c 2e6c 6162 656c 730a 0a20  ._cell.labels.. 
+00001400: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00001410: 2064 6566 2070 6174 6873 2873 656c 6629   def paths(self)
+00001420: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00001430: 2073 656c 662e 5f63 656c 6c2e 7061 7468   self._cell.path
+00001440: 730a 0a20 2020 2040 7072 6f70 6572 7479  s..    @property
+00001450: 0a20 2020 2064 6566 206e 616d 6528 7365  .    def name(se
+00001460: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
+00001470: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00001480: 5f63 656c 6c2e 6e61 6d65 0a0a 2020 2020  _cell.name..    
+00001490: 406e 616d 652e 7365 7474 6572 0a20 2020  @name.setter.   
+000014a0: 2064 6566 206e 616d 6528 7365 6c66 2c20   def name(self, 
+000014b0: 7661 6c75 6529 202d 3e20 4e6f 6e65 3a0a  value) -> None:.
+000014c0: 2020 2020 2020 2020 7365 6c66 2e5f 6365          self._ce
+000014d0: 6c6c 2e6e 616d 6520 3d20 7661 6c75 650a  ll.name = value.
+000014e0: 0a20 2020 2064 6566 205f 5f69 7465 725f  .    def __iter_
+000014f0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00001500: 2022 2222 596f 7520 6361 6e20 6974 6572   """You can iter
+00001510: 6174 6520 6f76 6572 2070 6f6c 7967 6f6e  ate over polygon
+00001520: 732c 2070 6174 6873 2c20 6c61 6265 6c73  s, paths, labels
+00001530: 2061 6e64 2072 6566 6572 656e 6365 732e   and references.
+00001540: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00001550: 726e 2069 7465 7274 6f6f 6c73 2e63 6861  rn itertools.cha
+00001560: 696e 2873 656c 662e 706f 6c79 676f 6e73  in(self.polygons
+00001570: 2c20 7365 6c66 2e70 6174 6873 2c20 7365  , self.paths, se
+00001580: 6c66 2e6c 6162 656c 732c 2073 656c 662e  lf.labels, self.
+00001590: 7265 6665 7265 6e63 6573 290a 0a20 2020  references)..   
+000015a0: 2064 6566 2067 6574 5f70 6f6c 7967 6f6e   def get_polygon
+000015b0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+000015c0: 0a20 2020 2020 2020 2062 795f 7370 6563  .        by_spec
+000015d0: 3a20 556e 696f 6e5b 626f 6f6c 2c20 5475  : Union[bool, Tu
+000015e0: 706c 655b 696e 742c 2069 6e74 5d5d 203d  ple[int, int]] =
+000015f0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00001600: 6465 7074 683a 204f 7074 696f 6e61 6c5b  depth: Optional[
+00001610: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
+00001620: 2020 2020 2069 6e63 6c75 6465 5f70 6174       include_pat
+00001630: 6873 3a20 626f 6f6c 203d 2054 7275 652c  hs: bool = True,
+00001640: 0a20 2020 2020 2020 2061 735f 6172 7261  .        as_arra
+00001650: 793a 2062 6f6f 6c20 3d20 5472 7565 2c0a  y: bool = True,.
+00001660: 2020 2020 2920 2d3e 2055 6e69 6f6e 5b4c      ) -> Union[L
+00001670: 6973 745b 506f 6c79 676f 6e5d 2c20 4469  ist[Polygon], Di
+00001680: 6374 5b54 7570 6c65 5b69 6e74 2c20 696e  ct[Tuple[int, in
+00001690: 745d 2c20 4c69 7374 5b50 6f6c 7967 6f6e  t], List[Polygon
+000016a0: 5d5d 5d3a 0a20 2020 2020 2020 2022 2222  ]]]:.        """
+000016b0: 5265 7475 726e 2061 206c 6973 7420 6f66  Return a list of
+000016c0: 2070 6f6c 7967 6f6e 7320 696e 2074 6869   polygons in thi
+000016d0: 7320 6365 6c6c 2e0a 0a20 2020 2020 2020  s cell...       
+000016e0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000016f0: 2020 2062 795f 7370 6563 3a20 626f 6f6c     by_spec: bool
+00001700: 206f 7220 6c61 7965 720a 2020 2020 2020   or layer.      
+00001710: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00001720: 652c 2074 6865 2072 6574 7572 6e20 7661  e, the return va
+00001730: 6c75 6520 6973 2061 2064 6963 7469 6f6e  lue is a diction
+00001740: 6172 7920 7769 7468 2074 6865 0a20 2020  ary with the.   
+00001750: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+00001760: 7967 6f6e 7320 6f66 2065 6163 6820 696e  ygons of each in
+00001770: 6469 7669 6475 616c 2070 6169 7220 286c  dividual pair (l
+00001780: 6179 6572 2c20 6461 7461 7479 7065 292c  ayer, datatype),
+00001790: 2077 6869 6368 0a20 2020 2020 2020 2020   which.         
+000017a0: 2020 2020 2020 2061 7265 2075 7365 6420         are used 
+000017b0: 6173 206b 6579 732e 2020 4966 2073 6574  as keys.  If set
+000017c0: 2074 6f20 6120 7475 706c 6520 6f66 2028   to a tuple of (
+000017d0: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
+000017e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000017f0: 2020 6f6e 6c79 2070 6f6c 7967 6f6e 7320    only polygons 
+00001800: 7769 7468 2074 6861 7420 7370 6563 6966  with that specif
+00001810: 6963 6174 696f 6e20 6172 6520 7265 7475  ication are retu
+00001820: 726e 6564 2e0a 2020 2020 2020 2020 2020  rned..          
+00001830: 2020 6465 7074 683a 2069 6e74 6567 6572    depth: integer
+00001840: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
+00001850: 2020 2020 2020 2020 2049 6620 6e6f 7420           If not 
+00001860: 4e6f 6e65 2c20 6465 6669 6e65 7320 6672  None, defines fr
+00001870: 6f6d 2068 6f77 206d 616e 7920 7265 6665  om how many refe
+00001880: 7265 6e63 6520 6c65 7665 6c73 2074 6f0a  rence levels to.
+00001890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000018a0: 7265 7472 6965 7665 2070 6f6c 7967 6f6e  retrieve polygon
+000018b0: 732e 2020 5265 6665 7265 6e63 6573 2062  s.  References b
+000018c0: 656c 6f77 2074 6869 7320 6c65 7665 6c20  elow this level 
+000018d0: 7769 6c6c 2072 6573 756c 740a 2020 2020  will result.    
+000018e0: 2020 2020 2020 2020 2020 2020 696e 2061              in a
+000018f0: 2062 6f75 6e64 696e 6720 626f 782e 2020   bounding box.  
+00001900: 4966 2060 6279 5f73 7065 6360 2069 7320  If `by_spec` is 
+00001910: 5472 7565 2074 6865 206b 6579 2077 696c  True the key wil
+00001920: 6c20 6265 2074 6865 0a20 2020 2020 2020  l be the.       
+00001930: 2020 2020 2020 2020 206e 616d 6520 6f66           name of
+00001940: 2074 6869 7320 6365 6c6c 2e0a 2020 2020   this cell..    
+00001950: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+00001960: 7061 7468 733a 2049 6620 5472 7565 2c20  paths: If True, 
+00001970: 706f 6c79 676f 6e61 6c20 7265 7072 6573  polygonal repres
+00001980: 656e 7461 7469 6f6e 206f 6620 7061 7468  entation of path
+00001990: 7320 6172 6520 616c 736f 2069 6e63 6c75  s are also inclu
+000019a0: 6465 6420 696e 2074 6865 2072 6573 756c  ded in the resul
+000019b0: 742e 0a20 2020 2020 2020 2020 2020 2061  t..            a
+000019c0: 735f 6172 7261 793a 2077 6865 6e20 6173  s_array: when as
+000019d0: 5f61 7272 6179 3d66 616c 7365 2c20 7265  _array=false, re
+000019e0: 7475 726e 2074 6865 2050 6f6c 7967 6f6e  turn the Polygon
+000019f0: 206f 626a 6563 7473 2069 6e73 7465 6164   objects instead
+00001a00: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001a10: 2020 706f 6c79 676f 6e20 6f62 6a65 6374    polygon object
+00001a20: 7320 6861 7665 206d 6f72 6520 696e 666f  s have more info
+00001a30: 726d 6174 696f 6e20 2865 7370 6563 6961  rmation (especia
+00001a40: 6c6c 7920 7768 656e 2062 795f 7370 6563  lly when by_spec
+00001a50: 3d46 616c 7365 2920 616e 6420 6172 6520  =False) and are 
+00001a60: 6661 7374 6572 2074 6f20 7265 7472 6965  faster to retrie
+00001a70: 7665 2e0a 0a20 2020 2020 2020 2052 6574  ve...        Ret
+00001a80: 7572 6e73 0a20 2020 2020 2020 2020 2020  urns.           
+00001a90: 206f 7574 3a20 6c69 7374 206f 6620 6172   out: list of ar
+00001aa0: 7261 792d 6c69 6b65 5b4e 5d5b 325d 206f  ray-like[N][2] o
+00001ab0: 7220 6469 6374 696f 6e61 7279 0a20 2020  r dictionary.   
+00001ac0: 2020 2020 2020 2020 2020 2020 204c 6973               Lis
+00001ad0: 7420 636f 6e74 6169 6e69 6e67 2074 6865  t containing the
+00001ae0: 2063 6f6f 7264 696e 6174 6573 206f 6620   coordinates of 
+00001af0: 7468 6520 7665 7274 6963 6573 206f 6620  the vertices of 
+00001b00: 6561 6368 0a20 2020 2020 2020 2020 2020  each.           
+00001b10: 2020 2020 2070 6f6c 7967 6f6e 2c20 6f72       polygon, or
+00001b20: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
+00001b30: 2077 6974 6820 7468 6520 6c69 7374 206f   with the list o
+00001b40: 6620 706f 6c79 676f 6e73 2028 6966 0a20  f polygons (if. 
+00001b50: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+00001b60: 6279 5f73 7065 6360 2069 7320 5472 7565  by_spec` is True
+00001b70: 292e 0a0a 2020 2020 2020 2020 4e6f 7465  )...        Note
+00001b80: 3a0a 2020 2020 2020 2020 2020 2020 496e  :.            In
+00001b90: 7374 616e 6365 7320 6f66 2060 466c 6578  stances of `Flex
+00001ba0: 5061 7468 6020 616e 6420 6052 6f62 7573  Path` and `Robus
+00001bb0: 7450 6174 6860 2061 7265 2061 6c73 6f20  tPath` are also 
+00001bc0: 696e 636c 7564 6564 2069 6e0a 2020 2020  included in.    
+00001bd0: 2020 2020 2020 2020 7468 6520 7265 7375          the resu
+00001be0: 6c74 2062 7920 636f 6d70 7574 696e 6720  lt by computing 
+00001bf0: 7468 6569 7220 706f 6c79 676f 6e61 6c20  their polygonal 
+00001c00: 626f 756e 6461 7279 2e0a 2020 2020 2020  boundary..      
+00001c10: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00001c20: 7475 726e 2067 6574 5f70 6f6c 7967 6f6e  turn get_polygon
+00001c30: 7328 0a20 2020 2020 2020 2020 2020 2069  s(.            i
+00001c40: 6e73 7461 6e63 653d 7365 6c66 2c0a 2020  nstance=self,.  
+00001c50: 2020 2020 2020 2020 2020 6279 5f73 7065            by_spe
+00001c60: 633d 6279 5f73 7065 632c 0a20 2020 2020  c=by_spec,.     
+00001c70: 2020 2020 2020 2064 6570 7468 3d64 6570         depth=dep
+00001c80: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00001c90: 696e 636c 7564 655f 7061 7468 733d 696e  include_paths=in
+00001ca0: 636c 7564 655f 7061 7468 732c 0a20 2020  clude_paths,.   
+00001cb0: 2020 2020 2020 2020 2061 735f 6172 7261           as_arra
+00001cc0: 793d 6173 5f61 7272 6179 2c0a 2020 2020  y=as_array,.    
+00001cd0: 2020 2020 290a 0a20 2020 2064 6566 2067      )..    def g
+00001ce0: 6574 5f64 6570 656e 6465 6e63 6965 7328  et_dependencies(
+00001cf0: 7365 6c66 2c20 7265 6375 7273 6976 653a  self, recursive:
+00001d00: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
+00001d10: 3e20 4c69 7374 5b43 6f6d 706f 6e65 6e74  > List[Component
+00001d20: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
+00001d30: 7475 726e 2061 206c 6973 7420 6f66 2043  turn a list of C
+00001d40: 6f6d 706f 6e65 6e74 7320 7265 6665 7265  omponents refere
+00001d50: 6e63 6564 2062 7920 7468 6973 2043 6f6d  nced by this Com
+00001d60: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+00001d70: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00001d80: 2020 2072 6563 7572 7369 7665 3a20 4966     recursive: If
+00001d90: 2054 7275 6520 7265 7475 726e 7320 6465   True returns de
+00001da0: 7065 6e64 656e 6369 6573 2072 6563 7572  pendencies recur
+00001db0: 7369 7665 6c79 2e0a 0a20 2020 2020 2020  sively...       
+00001dc0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00001dd0: 6e6f 7420 7265 6375 7273 6976 653a 0a20  not recursive:. 
+00001de0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00001df0: 6e20 6c69 7374 287b 7265 662e 7061 7265  n list({ref.pare
+00001e00: 6e74 2066 6f72 2072 6566 2069 6e20 7365  nt for ref in se
+00001e10: 6c66 2e72 6566 6572 656e 6365 737d 290a  lf.references}).
+00001e20: 0a20 2020 2020 2020 2072 6566 6572 656e  .        referen
+00001e30: 6365 735f 7365 7420 3d20 7365 7428 290a  ces_set = set().
+00001e40: 2020 2020 2020 2020 5f67 6574 5f64 6570          _get_dep
+00001e50: 656e 6465 6e63 6965 7328 7365 6c66 2c20  endencies(self, 
+00001e60: 7265 6665 7265 6e63 6573 5f73 6574 3d72  references_set=r
+00001e70: 6566 6572 656e 6365 735f 7365 7429 0a20  eferences_set). 
+00001e80: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
+00001e90: 7374 2872 6566 6572 656e 6365 735f 7365  st(references_se
+00001ea0: 7429 0a0a 2020 2020 6465 6620 6765 745f  t)..    def get_
+00001eb0: 636f 6d70 6f6e 656e 745f 7370 6563 2873  component_spec(s
+00001ec0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00001ed0: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+00001ee0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00001ef0: 2020 2020 2022 636f 6d70 6f6e 656e 7422       "component"
+00001f00: 3a20 7365 6c66 2e73 6574 7469 6e67 732e  : self.settings.
+00001f10: 6675 6e63 7469 6f6e 5f6e 616d 652c 0a20  function_name,. 
+00001f20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00001f30: 7365 7474 696e 6773 223a 2073 656c 662e  settings": self.
+00001f40: 7365 7474 696e 6773 2e63 6861 6e67 6564  settings.changed
+00001f50: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
+00001f60: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00001f70: 656c 662e 7365 7474 696e 6773 0a20 2020  elf.settings.   
+00001f80: 2020 2020 2020 2020 2065 6c73 6520 7b22           else {"
+00001f90: 636f 6d70 6f6e 656e 7422 3a20 7365 6c66  component": self
+00001fa0: 2e6e 616d 652c 2022 7365 7474 696e 6773  .name, "settings
+00001fb0: 223a 207b 7d7d 0a20 2020 2020 2020 2029  ": {}}.        )
+00001fc0: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
+00001fd0: 7465 6d5f 5f28 7365 6c66 2c20 6b65 7929  tem__(self, key)
+00001fe0: 3a0a 2020 2020 2020 2020 2222 2241 6363  :.        """Acc
+00001ff0: 6573 7320 7265 6665 7265 6e63 6520 706f  ess reference po
+00002000: 7274 732e 2222 220a 2020 2020 2020 2020  rts.""".        
+00002010: 6966 206b 6579 206e 6f74 2069 6e20 7365  if key not in se
+00002020: 6c66 2e70 6f72 7473 3a0a 2020 2020 2020  lf.ports:.      
+00002030: 2020 2020 2020 706f 7274 7320 3d20 6c69        ports = li
+00002040: 7374 2873 656c 662e 706f 7274 732e 6b65  st(self.ports.ke
+00002050: 7973 2829 290a 2020 2020 2020 2020 2020  ys()).          
+00002060: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00002070: 6f72 2866 227b 6b65 7921 727d 206e 6f74  or(f"{key!r} not
+00002080: 2069 6e20 7b70 6f72 7473 7d22 290a 0a20   in {ports}").. 
+00002090: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000020a0: 6c66 2e70 6f72 7473 5b6b 6579 5d0a 0a20  lf.ports[key].. 
+000020b0: 2020 2064 6566 205f 5f6c 7368 6966 745f     def __lshift_
+000020c0: 5f28 7365 6c66 2c20 656c 656d 656e 7429  _(self, element)
+000020d0: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
+000020e0: 7665 6e69 656e 6365 206f 7065 7261 746f  venience operato
+000020f0: 7220 6571 7569 7661 6c65 6e74 2074 6f20  r equivalent to 
+00002100: 6164 645f 7265 6628 292e 2222 220a 2020  add_ref().""".  
+00002110: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00002120: 662e 6164 645f 7265 6628 656c 656d 656e  f.add_ref(elemen
+00002130: 7429 0a0a 2020 2020 6465 6620 756e 6c6f  t)..    def unlo
+00002140: 636b 2873 656c 6629 202d 3e20 4e6f 6e65  ck(self) -> None
+00002150: 3a0a 2020 2020 2020 2020 2222 224f 6e6c  :.        """Onl
+00002160: 7920 646f 2074 6869 7320 6966 2079 6f75  y do this if you
+00002170: 206b 6e6f 7720 7768 6174 2079 6f75 2061   know what you a
+00002180: 7265 2064 6f69 6e67 2e22 2222 0a20 2020  re doing.""".   
+00002190: 2020 2020 2073 656c 662e 5f6c 6f63 6b65       self._locke
+000021a0: 6420 3d20 4661 6c73 650a 0a20 2020 2064  d = False..    d
+000021b0: 6566 206c 6f63 6b28 7365 6c66 2920 2d3e  ef lock(self) ->
+000021c0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+000021d0: 2222 4d61 6b65 7320 7375 7265 2063 6f6d  ""Makes sure com
+000021e0: 706f 6e65 6e74 7320 6361 6e27 7420 6164  ponents can't ad
+000021f0: 6420 6e65 7720 656c 656d 656e 7473 206f  d new elements o
+00002200: 7220 6d6f 7665 2065 7869 7374 696e 6720  r move existing 
+00002210: 6f6e 6573 2e0a 0a20 2020 2020 2020 2043  ones...        C
+00002220: 6f6d 706f 6e65 6e74 7320 6c6f 636b 2061  omponents lock a
+00002230: 7574 6f6d 6174 6963 616c 6c79 2077 6865  utomatically whe
+00002240: 6e20 676f 696e 6720 696e 746f 2074 6865  n going into the
+00002250: 2043 4143 4845 2074 6f0a 2020 2020 2020   CACHE to.      
+00002260: 2020 656e 7375 7265 206f 6e65 2063 6f6d    ensure one com
+00002270: 706f 6e65 6e74 2064 6f65 7320 6e6f 7420  ponent does not 
+00002280: 6368 616e 6765 206f 7468 6572 730a 2020  change others.  
+00002290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000022a0: 2020 7365 6c66 2e5f 6c6f 636b 6564 203d    self._locked =
+000022b0: 2054 7275 650a 0a20 2020 2064 6566 205f   True..    def _
+000022c0: 5f73 6574 6974 656d 5f5f 2873 656c 662c  _setitem__(self,
+000022d0: 206b 6579 2c20 656c 656d 656e 7429 3a0a   key, element):.
+000022e0: 2020 2020 2020 2020 2222 2241 6c6c 6f77          """Allow
+000022f0: 2061 6464 696e 6720 706f 6c79 676f 6e73   adding polygons
+00002300: 2061 6e64 2063 656c 6c20 7265 6665 7265   and cell refere
+00002310: 6e63 6573 2e0a 0a20 2020 2020 2020 206c  nces...        l
+00002320: 696b 6520 445b 2761 7263 3327 5d20 3d20  ike D['arc3'] = 
+00002330: 7067 2e61 7263 2829 0a0a 2020 2020 2020  pg.arc()..      
+00002340: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+00002350: 2020 2020 6b65 793a 2041 6c69 6173 206e      key: Alias n
+00002360: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+00002370: 2065 6c65 6d65 6e74 3a20 4f62 6a65 6374   element: Object
+00002380: 2074 6861 7420 7769 6c6c 2062 6520 6163   that will be ac
+00002390: 6365 7373 6962 6c65 2062 7920 616c 6961  cessible by alia
+000023a0: 7320 6e61 6d65 2e0a 0a20 2020 2020 2020  s name...       
+000023b0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+000023c0: 6973 696e 7374 616e 6365 2865 6c65 6d65  isinstance(eleme
+000023d0: 6e74 2c20 2843 6f6d 706f 6e65 6e74 5265  nt, (ComponentRe
+000023e0: 6665 7265 6e63 652c 2050 6f6c 7967 6f6e  ference, Polygon
+000023f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00002400: 7365 6c66 2e6e 616d 6564 5f72 6566 6572  self.named_refer
+00002410: 656e 6365 735b 6b65 795d 203d 2065 6c65  ences[key] = ele
+00002420: 6d65 6e74 0a20 2020 2020 2020 2065 6c73  ment.        els
+00002430: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00002440: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00002450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002460: 2066 2254 7269 6564 2074 6f20 6173 7369   f"Tried to assi
+00002470: 676e 2061 6c69 6173 207b 6b65 7921 727d  gn alias {key!r}
+00002480: 2069 6e20 436f 6d70 6f6e 656e 7420 7b73   in Component {s
+00002490: 656c 662e 6e61 6d65 2172 7d2c 220a 2020  elf.name!r},".  
+000024a0: 2020 2020 2020 2020 2020 2020 2020 2262                "b
+000024b0: 7574 2066 6169 6c65 6420 6265 6361 7573  ut failed becaus
+000024c0: 6520 7468 6520 6974 656d 2077 6173 206e  e the item was n
+000024d0: 6f74 2061 2043 6f6d 706f 6e65 6e74 5265  ot a ComponentRe
+000024e0: 6665 7265 6e63 6522 0a20 2020 2020 2020  ference".       
+000024f0: 2020 2020 2029 0a0a 2020 2020 4063 6c61       )..    @cla
+00002500: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00002510: 205f 5f67 6574 5f76 616c 6964 6174 6f72   __get_validator
+00002520: 735f 5f28 636c 7329 3a0a 2020 2020 2020  s__(cls):.      
+00002530: 2020 2222 2247 6574 2076 616c 6964 6174    """Get validat
+00002540: 6f72 7320 666f 7220 7468 6520 436f 6d70  ors for the Comp
+00002550: 6f6e 656e 7420 6f62 6a65 6374 2e22 2222  onent object."""
+00002560: 0a20 2020 2020 2020 2079 6965 6c64 2063  .        yield c
+00002570: 6c73 2e76 616c 6964 6174 650a 0a20 2020  ls.validate..   
+00002580: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00002590: 2020 6465 6620 7661 6c69 6461 7465 2863    def validate(c
+000025a0: 6c73 2c20 7629 3a0a 2020 2020 2020 2020  ls, v):.        
+000025b0: 2222 2250 7964 616e 7469 6320 6173 7375  """Pydantic assu
+000025c0: 6d65 7320 636f 6d70 6f6e 656e 7420 6973  mes component is
+000025d0: 2076 616c 6964 2069 6620 7468 6520 666f   valid if the fo
+000025e0: 6c6c 6f77 696e 6720 6172 6520 7472 7565  llowing are true
+000025f0: 2e0a 0a20 2020 2020 2020 202d 206e 616d  ...        - nam
+00002600: 6520 6368 6172 6163 7465 7273 203c 204d  e characters < M
+00002610: 4158 5f4e 414d 455f 4c45 4e47 5448 0a20  AX_NAME_LENGTH. 
+00002620: 2020 2020 2020 202d 2069 7320 6e6f 7420         - is not 
+00002630: 656d 7074 7920 2868 6173 2072 6566 6572  empty (has refer
+00002640: 656e 6365 7320 6f72 2070 6f6c 7967 6f6e  ences or polygon
+00002650: 7329 0a20 2020 2020 2020 2022 2222 0a20  s).        """. 
+00002660: 2020 2020 2020 204d 4158 5f4e 414d 455f         MAX_NAME_
+00002670: 4c45 4e47 5448 203d 2039 390a 2020 2020  LENGTH = 99.    
+00002680: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+00002690: 7461 6e63 6528 0a20 2020 2020 2020 2020  tance(.         
+000026a0: 2020 2076 2c20 436f 6d70 6f6e 656e 740a     v, Component.
+000026b0: 2020 2020 2020 2020 292c 2066 2254 7970          ), f"Typ
+000026c0: 6545 7272 6f72 2c20 476f 7420 7b74 7970  eError, Got {typ
+000026d0: 6528 7629 7d2c 2065 7870 6563 7469 6e67  e(v)}, expecting
+000026e0: 2043 6f6d 706f 6e65 6e74 220a 2020 2020   Component".    
+000026f0: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
+00002700: 2020 2020 2020 2020 206c 656e 2876 2e6e           len(v.n
+00002710: 616d 6529 203c 3d20 4d41 585f 4e41 4d45  ame) <= MAX_NAME
+00002720: 5f4c 454e 4754 480a 2020 2020 2020 2020  _LENGTH.        
+00002730: 292c 2066 226e 616d 6520 607b 762e 6e61  ), f"name `{v.na
+00002740: 6d65 7d60 207b 6c65 6e28 762e 6e61 6d65  me}` {len(v.name
+00002750: 297d 203e 207b 4d41 585f 4e41 4d45 5f4c  )} > {MAX_NAME_L
+00002760: 454e 4754 487d 2022 0a20 2020 2020 2020  ENGTH} ".       
+00002770: 2072 6574 7572 6e20 760a 0a20 2020 2040   return v..    @
+00002780: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00002790: 206e 616d 6564 5f72 6566 6572 656e 6365   named_reference
+000027a0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+000027b0: 2072 6574 7572 6e20 7365 6c66 2e5f 6e61   return self._na
+000027c0: 6d65 645f 7265 6665 7265 6e63 6573 0a0a  med_references..
+000027d0: 2020 2020 6465 6620 6164 645f 6c61 6265      def add_labe
+000027e0: 6c28 0a20 2020 2020 2020 2073 656c 662c  l(.        self,
+000027f0: 0a20 2020 2020 2020 2074 6578 743a 2073  .        text: s
+00002800: 7472 203d 2022 6865 6c6c 6f22 2c0a 2020  tr = "hello",.  
+00002810: 2020 2020 2020 706f 7369 7469 6f6e 3a20        position: 
+00002820: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
+00002830: 6174 5d20 3d20 2830 2e30 2c20 302e 3029  at] = (0.0, 0.0)
+00002840: 2c0a 2020 2020 2020 2020 6d61 676e 6966  ,.        magnif
+00002850: 6963 6174 696f 6e3a 2066 6c6f 6174 203d  ication: float =
+00002860: 2031 2e30 2c0a 2020 2020 2020 2020 726f   1.0,.        ro
+00002870: 7461 7469 6f6e 3a20 666c 6f61 7420 3d20  tation: float = 
+00002880: 302c 0a20 2020 2020 2020 2061 6e63 686f  0,.        ancho
+00002890: 723a 2073 7472 203d 2022 6f22 2c0a 2020  r: str = "o",.  
+000028a0: 2020 2020 2020 6c61 7965 723d 2254 4558        layer="TEX
+000028b0: 5422 2c0a 2020 2020 2020 2020 785f 7265  T",.        x_re
+000028c0: 666c 6563 7469 6f6e 3d46 616c 7365 2c0a  flection=False,.
+000028d0: 2020 2020 2920 2d3e 204c 6162 656c 3a0a      ) -> Label:.
+000028e0: 2020 2020 2020 2020 2222 2241 6464 7320          """Adds 
+000028f0: 4c61 6265 6c20 746f 2074 6865 2043 6f6d  Label to the Com
+00002900: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+00002910: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00002920: 2020 2074 6578 743a 204c 6162 656c 2074     text: Label t
+00002930: 6578 742e 0a20 2020 2020 2020 2020 2020  ext..           
+00002940: 2070 6f73 6974 696f 6e3a 2078 2d2c 2079   position: x-, y
+00002950: 2d63 6f6f 7264 696e 6174 6573 206f 6620  -coordinates of 
+00002960: 7468 6520 4c61 6265 6c20 6c6f 6361 7469  the Label locati
+00002970: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
+00002980: 6d61 676e 6966 6963 6174 696f 6e3a 204d  magnification: M
+00002990: 6167 6e69 6669 6361 7469 6f6e 2066 6163  agnification fac
+000029a0: 746f 7220 666f 7220 7468 6520 4c61 6265  tor for the Labe
+000029b0: 6c20 7465 7874 2e0a 2020 2020 2020 2020  l text..        
+000029c0: 2020 2020 726f 7461 7469 6f6e 3a20 416e      rotation: An
+000029d0: 676c 6520 726f 7461 7469 6f6e 206f 6620  gle rotation of 
+000029e0: 7468 6520 4c61 6265 6c20 7465 7874 2e0a  the Label text..
+000029f0: 2020 2020 2020 2020 2020 2020 616e 6368              anch
+00002a00: 6f72 3a20 7b27 6e27 2c20 2765 272c 2027  or: {'n', 'e', '
+00002a10: 7327 2c20 2777 272c 2027 6f27 2c20 276e  s', 'w', 'o', 'n
+00002a20: 6527 2c20 276e 7727 2c20 2e2e 2e7d 0a20  e', 'nw', ...}. 
+00002a30: 2020 2020 2020 2020 2020 2020 2020 2050                 P
+00002a40: 6f73 6974 696f 6e20 6f66 2074 6865 2061  osition of the a
+00002a50: 6e63 686f 7220 7265 6c61 7469 7665 2074  nchor relative t
+00002a60: 6f20 7468 6520 7465 7874 2e0a 2020 2020  o the text..    
+00002a70: 2020 2020 2020 2020 6c61 7965 723a 2053          layer: S
+00002a80: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
+00002a90: 2074 6f20 7075 7420 4c61 6265 6c20 6f6e   to put Label on
+00002aa0: 2e0a 2020 2020 2020 2020 2020 2020 785f  ..            x_
+00002ab0: 7265 666c 6563 7469 6f6e 3a20 5472 7565  reflection: True
+00002ac0: 2072 6566 6c65 6374 7320 6163 726f 7373   reflects across
+00002ad0: 2074 6865 2068 6f72 697a 6f6e 7461 6c20   the horizontal 
+00002ae0: 6178 6973 2062 6566 6f72 6520 726f 7461  axis before rota
+00002af0: 7469 6f6e 2e0a 2020 2020 2020 2020 2222  tion..        ""
+00002b00: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00002b10: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
+00002b20: 706f 7274 2067 6574 5f6c 6179 6572 0a0a  port get_layer..
+00002b30: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
+00002b40: 6765 745f 6c61 7965 7228 6c61 7965 7229  get_layer(layer)
+00002b50: 0a0a 2020 2020 2020 2020 6764 735f 6c61  ..        gds_la
+00002b60: 7965 722c 2067 6473 5f64 6174 6174 7970  yer, gds_datatyp
+00002b70: 6520 3d20 6c61 7965 720a 0a20 2020 2020  e = layer..     
+00002b80: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+00002b90: 616e 6365 2874 6578 742c 2073 7472 293a  ance(text, str):
+00002ba0: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
+00002bb0: 7420 3d20 7465 7874 0a20 2020 2020 2020  t = text.       
+00002bc0: 206c 6162 656c 203d 204c 6162 656c 280a   label = Label(.
+00002bd0: 2020 2020 2020 2020 2020 2020 7465 7874              text
+00002be0: 3d74 6578 742c 0a20 2020 2020 2020 2020  =text,.         
+00002bf0: 2020 206f 7269 6769 6e3d 706f 7369 7469     origin=positi
+00002c00: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00002c10: 616e 6368 6f72 3d61 6e63 686f 722c 0a20  anchor=anchor,. 
+00002c20: 2020 2020 2020 2020 2020 206d 6167 6e69             magni
+00002c30: 6669 6361 7469 6f6e 3d6d 6167 6e69 6669  fication=magnifi
+00002c40: 6361 7469 6f6e 2c0a 2020 2020 2020 2020  cation,.        
+00002c50: 2020 2020 726f 7461 7469 6f6e 3d72 6f74      rotation=rot
+00002c60: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
+00002c70: 2020 206c 6179 6572 3d67 6473 5f6c 6179     layer=gds_lay
+00002c80: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00002c90: 7465 7874 7479 7065 3d67 6473 5f64 6174  texttype=gds_dat
+00002ca0: 6174 7970 652c 0a20 2020 2020 2020 2020  atype,.         
+00002cb0: 2020 2078 5f72 6566 6c65 6374 696f 6e3d     x_reflection=
+00002cc0: 785f 7265 666c 6563 7469 6f6e 2c0a 2020  x_reflection,.  
+00002cd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00002ce0: 7365 6c66 2e61 6464 286c 6162 656c 290a  self.add(label).
+00002cf0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00002d00: 6162 656c 0a0a 2020 2020 4070 726f 7065  abel..    @prope
+00002d10: 7274 790a 2020 2020 6465 6620 6262 6f78  rty.    def bbox
+00002d20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00002d30: 2222 2252 6574 7572 6e73 2074 6865 2062  """Returns the b
+00002d40: 6f75 6e64 696e 6720 626f 7820 6f66 2074  ounding box of t
+00002d50: 6865 2043 6f6d 706f 6e65 6e74 5265 6665  he ComponentRefe
+00002d60: 7265 6e63 652e 0a0a 2020 2020 2020 2020  rence...        
+00002d70: 6974 2073 6e61 7073 2074 6f20 3320 6465  it snaps to 3 de
+00002d80: 6369 6d61 6c73 2069 6e20 756d 2028 302e  cimals in um (0.
+00002d90: 3030 3175 6d20 3d20 316e 6d20 7072 6563  001um = 1nm prec
+00002da0: 6973 696f 6e29 0a20 2020 2020 2020 2022  ision).        "
+00002db0: 2222 0a20 2020 2020 2020 2062 626f 7820  "".        bbox 
+00002dc0: 3d20 7365 6c66 2e5f 6365 6c6c 2e62 6f75  = self._cell.bou
+00002dd0: 6e64 696e 675f 626f 7828 290a 2020 2020  nding_box().    
+00002de0: 2020 2020 6966 2062 626f 7820 6973 204e      if bbox is N
+00002df0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00002e00: 2062 626f 7820 3d20 2828 302c 2030 292c   bbox = ((0, 0),
+00002e10: 2028 302c 2030 2929 0a20 2020 2020 2020   (0, 0)).       
+00002e20: 2072 6574 7572 6e20 6e70 2e72 6f75 6e64   return np.round
+00002e30: 2862 626f 782c 2033 290a 0a20 2020 2040  (bbox, 3)..    @
+00002e40: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00002e50: 2070 6f72 7473 5f6c 6179 6572 2873 656c   ports_layer(sel
+00002e60: 6629 202d 3e20 4469 6374 5b73 7472 2c20  f) -> Dict[str, 
+00002e70: 7374 725d 3a0a 2020 2020 2020 2020 2222  str]:.        ""
+00002e80: 2252 6574 7572 6e73 2061 206d 6170 7069  "Returns a mappi
+00002e90: 6e67 2066 726f 6d20 6c61 7965 7230 5f6c  ng from layer0_l
+00002ea0: 6179 6572 315f 4530 3a20 706f 7274 4e61  ayer1_E0: portNa
+00002eb0: 6d65 2e22 2222 0a20 2020 2020 2020 2072  me.""".        r
+00002ec0: 6574 7572 6e20 6d61 705f 706f 7274 735f  eturn map_ports_
+00002ed0: 6c61 7965 725f 746f 5f6f 7269 656e 7461  layer_to_orienta
+00002ee0: 7469 6f6e 2873 656c 662e 706f 7274 7329  tion(self.ports)
+00002ef0: 0a0a 2020 2020 6465 6620 706f 7274 5f62  ..    def port_b
+00002f00: 795f 6f72 6965 6e74 6174 696f 6e5f 6377  y_orientation_cw
+00002f10: 2873 656c 662c 206b 6579 3a20 7374 722c  (self, key: str,
+00002f20: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00002f30: 2020 2020 2222 2252 6574 7572 6e73 2070      """Returns p
+00002f40: 6f72 7420 6279 2069 6e64 6578 696e 6720  ort by indexing 
+00002f50: 7468 656d 2063 6c6f 636b 7769 7365 2e22  them clockwise."
+00002f60: 2222 0a20 2020 2020 2020 206d 203d 206d  "".        m = m
+00002f70: 6170 5f70 6f72 7473 5f74 6f5f 6f72 6965  ap_ports_to_orie
+00002f80: 6e74 6174 696f 6e5f 6377 2873 656c 662e  ntation_cw(self.
+00002f90: 706f 7274 732c 202a 2a6b 7761 7267 7329  ports, **kwargs)
+00002fa0: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
+00002fb0: 6e6f 7420 696e 206d 3a0a 2020 2020 2020  not in m:.      
+00002fc0: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
+00002fd0: 7272 6f72 2866 227b 6b65 797d 206e 6f74  rror(f"{key} not
+00002fe0: 2069 6e20 7b6c 6973 7428 6d2e 6b65 7973   in {list(m.keys
+00002ff0: 2829 297d 2229 0a20 2020 2020 2020 206b  ())}").        k
+00003000: 6579 3220 3d20 6d5b 6b65 795d 0a20 2020  ey2 = m[key].   
+00003010: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00003020: 2e70 6f72 7473 5b6b 6579 325d 0a0a 2020  .ports[key2]..  
+00003030: 2020 6465 6620 706f 7274 5f62 795f 6f72    def port_by_or
+00003040: 6965 6e74 6174 696f 6e5f 6363 7728 7365  ientation_ccw(se
+00003050: 6c66 2c20 6b65 793a 2073 7472 2c20 2a2a  lf, key: str, **
+00003060: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00003070: 2022 2222 5265 7475 726e 7320 706f 7274   """Returns port
+00003080: 2062 7920 696e 6465 7869 6e67 2074 6865   by indexing the
+00003090: 6d20 636c 6f63 6b77 6973 652e 2222 220a  m clockwise.""".
+000030a0: 2020 2020 2020 2020 6d20 3d20 6d61 705f          m = map_
+000030b0: 706f 7274 735f 746f 5f6f 7269 656e 7461  ports_to_orienta
+000030c0: 7469 6f6e 5f63 6377 2873 656c 662e 706f  tion_ccw(self.po
+000030d0: 7274 732c 202a 2a6b 7761 7267 7329 0a20  rts, **kwargs). 
+000030e0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
+000030f0: 7420 696e 206d 3a0a 2020 2020 2020 2020  t in m:.        
+00003100: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
+00003110: 6f72 2866 227b 6b65 797d 206e 6f74 2069  or(f"{key} not i
+00003120: 6e20 7b6c 6973 7428 6d2e 6b65 7973 2829  n {list(m.keys()
+00003130: 297d 2229 0a20 2020 2020 2020 206b 6579  )}").        key
+00003140: 3220 3d20 6d5b 6b65 795d 0a20 2020 2020  2 = m[key].     
+00003150: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
+00003160: 6f72 7473 5b6b 6579 325d 0a0a 2020 2020  orts[key2]..    
+00003170: 6465 6620 6765 745f 706f 7274 735f 7873  def get_ports_xs
+00003180: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
+00003190: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
+000031a0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+000031b0: 2078 6469 7374 616e 6365 2066 726f 6d20   xdistance from 
+000031c0: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
+000031d0: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
+000031e0: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+000031f0: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
+00003200: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
+00003210: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00003220: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
+00003230: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+00003240: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
+00003250: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
+00003260: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
+00003270: 7420 7769 6474 682e 0a20 2020 2020 2020  t width..       
+00003280: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
+00003290: 7564 6564 3a20 4c69 7374 206f 6620 6c61  uded: List of la
+000032a0: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
+000032b0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+000032c0: 745f 7479 7065 3a20 6f70 7469 6361 6c2c  t_type: optical,
+000032d0: 2065 6c65 6374 7269 6361 6c2c 202e 2e2e   electrical, ...
+000032e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000032f0: 2020 2020 2070 6f72 7473 5f63 7720 3d20       ports_cw = 
+00003300: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
+00003310: 6973 7428 636c 6f63 6b77 6973 653d 5472  ist(clockwise=Tr
+00003320: 7565 2c20 2a2a 6b77 6172 6773 290a 2020  ue, **kwargs).  
+00003330: 2020 2020 2020 706f 7274 735f 6363 7720        ports_ccw 
+00003340: 3d20 7365 6c66 2e67 6574 5f70 6f72 7473  = self.get_ports
+00003350: 5f6c 6973 7428 636c 6f63 6b77 6973 653d  _list(clockwise=
+00003360: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
+00003370: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003380: 736e 6170 5f74 6f5f 6772 6964 2870 6f72  snap_to_grid(por
+00003390: 7473 5f63 6377 5b30 5d2e 7820 2d20 706f  ts_ccw[0].x - po
+000033a0: 7274 735f 6377 5b30 5d2e 7829 0a0a 2020  rts_cw[0].x)..  
+000033b0: 2020 6465 6620 6765 745f 706f 7274 735f    def get_ports_
+000033c0: 7973 697a 6528 7365 6c66 2c20 2a2a 6b77  ysize(self, **kw
+000033d0: 6172 6773 2920 2d3e 2066 6c6f 6174 3a0a  args) -> float:.
+000033e0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+000033f0: 6e73 2079 6469 7374 616e 6365 2066 726f  ns ydistance fro
+00003400: 6d20 6561 7374 2074 6f20 7765 7374 2070  m east to west p
+00003410: 6f72 7473 2e0a 0a20 2020 2020 2020 204b  orts...        K
+00003420: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
+00003430: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
+00003440: 706f 7274 2047 4453 206c 6179 6572 2e0a  port GDS layer..
+00003450: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00003460: 6978 3a20 7769 7468 2069 6e20 706f 7274  ix: with in port
+00003470: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+00003480: 2020 206f 7269 656e 7461 7469 6f6e 3a20     orientation: 
+00003490: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
+000034a0: 2020 2020 2020 2020 7769 6474 683a 2070          width: p
+000034b0: 6f72 7420 7769 6474 6820 2875 6d29 2e0a  ort width (um)..
+000034c0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+000034d0: 7273 5f65 7863 6c75 6465 643a 204c 6973  rs_excluded: Lis
+000034e0: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
+000034f0: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
+00003500: 2020 2020 706f 7274 5f74 7970 653a 206f      port_type: o
+00003510: 7074 6963 616c 2c20 656c 6563 7472 6963  ptical, electric
+00003520: 616c 2c20 2e2e 2e0a 2020 2020 2020 2020  al, ....        
+00003530: 2222 220a 2020 2020 2020 2020 706f 7274  """.        port
+00003540: 735f 6377 203d 2073 656c 662e 6765 745f  s_cw = self.get_
+00003550: 706f 7274 735f 6c69 7374 2863 6c6f 636b  ports_list(clock
+00003560: 7769 7365 3d54 7275 652c 202a 2a6b 7761  wise=True, **kwa
+00003570: 7267 7329 0a20 2020 2020 2020 2070 6f72  rgs).        por
+00003580: 7473 5f63 6377 203d 2073 656c 662e 6765  ts_ccw = self.ge
+00003590: 745f 706f 7274 735f 6c69 7374 2863 6c6f  t_ports_list(clo
+000035a0: 636b 7769 7365 3d46 616c 7365 2c20 2a2a  ckwise=False, **
+000035b0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+000035c0: 7265 7475 726e 2073 6e61 705f 746f 5f67  return snap_to_g
+000035d0: 7269 6428 706f 7274 735f 6363 775b 305d  rid(ports_ccw[0]
+000035e0: 2e79 202d 2070 6f72 7473 5f63 775b 305d  .y - ports_cw[0]
+000035f0: 2e79 290a 0a20 2020 2064 6566 2070 6c6f  .y)..    def plo
+00003600: 745f 6e65 746c 6973 7428 0a20 2020 2020  t_netlist(.     
+00003610: 2020 2073 656c 662c 2077 6974 685f 6c61     self, with_la
+00003620: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
+00003630: 652c 2066 6f6e 745f 7765 6967 6874 3a20  e, font_weight: 
+00003640: 7374 7220 3d20 226e 6f72 6d61 6c22 2c20  str = "normal", 
+00003650: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
+00003660: 2020 2020 2020 2020 2222 2250 6c6f 7473          """Plots
+00003670: 2061 206e 6574 6c69 7374 2067 7261 7068   a netlist graph
+00003680: 2077 6974 6820 6e65 7477 6f72 6b78 2e0a   with networkx..
+00003690: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+000036a0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+000036b0: 6c61 6265 6c73 3a20 6164 6420 6c61 6265  labels: add labe
+000036c0: 6c20 746f 2065 6163 6820 6e6f 6465 2e0a  l to each node..
+000036d0: 2020 2020 2020 2020 2020 2020 666f 6e74              font
+000036e0: 5f77 6569 6768 743a 206e 6f72 6d61 6c2c  _weight: normal,
+000036f0: 2062 6f6c 642e 0a20 2020 2020 2020 2020   bold..         
+00003700: 2020 202a 2a6b 7761 7267 733a 206b 6579     **kwargs: key
+00003710: 776f 7264 2061 7267 756d 656e 7473 2066  word arguments f
+00003720: 6f72 2074 6865 2067 6574 5f6e 6574 6c69  or the get_netli
+00003730: 7374 2066 756e 6374 696f 6e0a 2020 2020  st function.    
+00003740: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00003750: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
+00003760: 622e 7079 706c 6f74 2061 7320 706c 740a  b.pyplot as plt.
+00003770: 2020 2020 2020 2020 696d 706f 7274 206e          import n
+00003780: 6574 776f 726b 7820 6173 206e 780a 0a20  etworkx as nx.. 
+00003790: 2020 2020 2020 2070 6c74 2e66 6967 7572         plt.figur
+000037a0: 6528 290a 2020 2020 2020 2020 6e65 746c  e().        netl
+000037b0: 6973 7420 3d20 7365 6c66 2e67 6574 5f6e  ist = self.get_n
+000037c0: 6574 6c69 7374 282a 2a6b 7761 7267 7329  etlist(**kwargs)
+000037d0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
+000037e0: 696f 6e73 203d 206e 6574 6c69 7374 5b22  ions = netlist["
+000037f0: 636f 6e6e 6563 7469 6f6e 7322 5d0a 2020  connections"].  
+00003800: 2020 2020 2020 706c 6163 656d 656e 7473        placements
+00003810: 203d 206e 6574 6c69 7374 5b22 706c 6163   = netlist["plac
+00003820: 656d 656e 7473 225d 0a20 2020 2020 2020  ements"].       
+00003830: 2047 203d 206e 782e 4772 6170 6828 290a   G = nx.Graph().
+00003840: 2020 2020 2020 2020 472e 6164 645f 6564          G.add_ed
+00003850: 6765 735f 6672 6f6d 280a 2020 2020 2020  ges_from(.      
+00003860: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
+00003870: 2020 2020 2020 2020 2822 2c22 2e6a 6f69          (",".joi
+00003880: 6e28 6b2e 7370 6c69 7428 222c 2229 5b3a  n(k.split(",")[:
+00003890: 2d31 5d29 2c20 222c 222e 6a6f 696e 2876  -1]), ",".join(v
+000038a0: 2e73 706c 6974 2822 2c22 295b 3a2d 315d  .split(",")[:-1]
+000038b0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+000038c0: 2020 2066 6f72 206b 2c20 7620 696e 2063     for k, v in c
+000038d0: 6f6e 6e65 6374 696f 6e73 2e69 7465 6d73  onnections.items
+000038e0: 2829 0a20 2020 2020 2020 2020 2020 205d  ().            ]
+000038f0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00003900: 2020 2070 6f73 203d 207b 6b3a 2028 765b     pos = {k: (v[
+00003910: 2278 225d 2c20 765b 2279 225d 2920 666f  "x"], v["y"]) fo
+00003920: 7220 6b2c 2076 2069 6e20 706c 6163 656d  r k, v in placem
+00003930: 656e 7473 2e69 7465 6d73 2829 7d0a 2020  ents.items()}.  
+00003940: 2020 2020 2020 6c61 6265 6c73 203d 207b        labels = {
+00003950: 6b3a 2022 2c22 2e6a 6f69 6e28 6b2e 7370  k: ",".join(k.sp
+00003960: 6c69 7428 222c 2229 5b3a 315d 2920 666f  lit(",")[:1]) fo
+00003970: 7220 6b20 696e 2070 6c61 6365 6d65 6e74  r k in placement
+00003980: 732e 6b65 7973 2829 7d0a 2020 2020 2020  s.keys()}.      
+00003990: 2020 6e78 2e64 7261 7728 0a20 2020 2020    nx.draw(.     
+000039a0: 2020 2020 2020 2047 2c0a 2020 2020 2020         G,.      
+000039b0: 2020 2020 2020 7769 7468 5f6c 6162 656c        with_label
+000039c0: 733d 7769 7468 5f6c 6162 656c 732c 0a20  s=with_labels,. 
+000039d0: 2020 2020 2020 2020 2020 2066 6f6e 745f             font_
+000039e0: 7765 6967 6874 3d66 6f6e 745f 7765 6967  weight=font_weig
+000039f0: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
+00003a00: 6c61 6265 6c73 3d6c 6162 656c 732c 0a20  labels=labels,. 
+00003a10: 2020 2020 2020 2020 2020 2070 6f73 3d70             pos=p
+00003a20: 6f73 2c0a 2020 2020 2020 2020 290a 2020  os,.        ).  
+00003a30: 2020 2020 2020 7265 7475 726e 2047 0a0a        return G..
+00003a40: 2020 2020 6465 6620 706c 6f74 5f6e 6574      def plot_net
+00003a50: 6c69 7374 5f66 6c61 7428 0a20 2020 2020  list_flat(.     
+00003a60: 2020 2073 656c 662c 2077 6974 685f 6c61     self, with_la
+00003a70: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
+00003a80: 652c 2066 6f6e 745f 7765 6967 6874 3a20  e, font_weight: 
+00003a90: 7374 7220 3d20 226e 6f72 6d61 6c22 2c20  str = "normal", 
+00003aa0: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
+00003ab0: 2020 2020 2020 2020 2222 2250 6c6f 7473          """Plots
+00003ac0: 2061 206e 6574 6c69 7374 2067 7261 7068   a netlist graph
+00003ad0: 2077 6974 6820 6e65 7477 6f72 6b78 2e0a   with networkx..
+00003ae0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00003af0: 2020 2020 2020 2020 2020 2066 6c61 743a             flat:
+00003b00: 2069 6620 7472 7565 2c20 7769 6c6c 2070   if true, will p
+00003b10: 6c6f 7420 7468 6520 666c 6174 206e 6574  lot the flat net
+00003b20: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
+00003b30: 2077 6974 685f 6c61 6265 6c73 3a20 6164   with_labels: ad
+00003b40: 6420 6c61 6265 6c20 746f 2065 6163 6820  d label to each 
+00003b50: 6e6f 6465 2e0a 2020 2020 2020 2020 2020  node..          
+00003b60: 2020 666f 6e74 5f77 6569 6768 743a 206e    font_weight: n
+00003b70: 6f72 6d61 6c2c 2062 6f6c 642e 0a20 2020  ormal, bold..   
+00003b80: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+00003b90: 733a 206b 6579 776f 7264 2061 7267 756d  s: keyword argum
+00003ba0: 656e 7473 2066 6f72 2074 6865 2067 6574  ents for the get
+00003bb0: 5f6e 6574 6c69 7374 2066 756e 6374 696f  _netlist functio
+00003bc0: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+00003bd0: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
+00003be0: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
+00003bf0: 7320 706c 740a 2020 2020 2020 2020 696d  s plt.        im
+00003c00: 706f 7274 206e 6574 776f 726b 7820 6173  port networkx as
+00003c10: 206e 780a 0a20 2020 2020 2020 2070 6c74   nx..        plt
+00003c20: 2e66 6967 7572 6528 290a 2020 2020 2020  .figure().      
+00003c30: 2020 6e65 746c 6973 7420 3d20 7365 6c66    netlist = self
+00003c40: 2e67 6574 5f6e 6574 6c69 7374 5f66 6c61  .get_netlist_fla
+00003c50: 7428 2a2a 6b77 6172 6773 290a 2020 2020  t(**kwargs).    
+00003c60: 2020 2020 636f 6e6e 6563 7469 6f6e 7320      connections 
+00003c70: 3d20 6e65 746c 6973 745b 2263 6f6e 6e65  = netlist["conne
+00003c80: 6374 696f 6e73 225d 0a20 2020 2020 2020  ctions"].       
+00003c90: 2070 6c61 6365 6d65 6e74 7320 3d20 6e65   placements = ne
+00003ca0: 746c 6973 745b 2270 6c61 6365 6d65 6e74  tlist["placement
+00003cb0: 7322 5d0a 2020 2020 2020 2020 636f 6e6e  s"].        conn
+00003cc0: 6563 7469 6f6e 735f 6c69 7374 203d 205b  ections_list = [
+00003cd0: 5d0a 2020 2020 2020 2020 666f 7220 6b2c  ].        for k,
+00003ce0: 2076 5f6c 6973 7420 696e 2063 6f6e 6e65   v_list in conne
+00003cf0: 6374 696f 6e73 2e69 7465 6d73 2829 3a0a  ctions.items():.
+00003d00: 2020 2020 2020 2020 2020 2020 636f 6e6e              conn
+00003d10: 6563 7469 6f6e 735f 6c69 7374 2e65 7874  ections_list.ext
+00003d20: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+00003d30: 2020 2020 2028 222c 222e 6a6f 696e 286b       (",".join(k
+00003d40: 2e73 706c 6974 2822 2c22 295b 3a2d 315d  .split(",")[:-1]
+00003d50: 292c 2022 2c22 2e6a 6f69 6e28 762e 7370  ), ",".join(v.sp
+00003d60: 6c69 7428 222c 2229 5b3a 2d31 5d29 290a  lit(",")[:-1])).
+00003d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d80: 666f 7220 7620 696e 2076 5f6c 6973 740a  for v in v_list.
+00003d90: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00003da0: 2020 2020 2020 4720 3d20 6e78 2e47 7261        G = nx.Gra
+00003db0: 7068 2829 0a20 2020 2020 2020 2047 2e61  ph().        G.a
+00003dc0: 6464 5f65 6467 6573 5f66 726f 6d28 636f  dd_edges_from(co
+00003dd0: 6e6e 6563 7469 6f6e 735f 6c69 7374 290a  nnections_list).
+00003de0: 2020 2020 2020 2020 706f 7320 3d20 7b6b          pos = {k
+00003df0: 3a20 2876 5b22 7822 5d2c 2076 5b22 7922  : (v["x"], v["y"
+00003e00: 5d29 2066 6f72 206b 2c20 7620 696e 2070  ]) for k, v in p
+00003e10: 6c61 6365 6d65 6e74 732e 6974 656d 7328  lacements.items(
+00003e20: 297d 0a20 2020 2020 2020 206c 6162 656c  )}.        label
+00003e30: 7320 3d20 7b6b 3a20 222c 222e 6a6f 696e  s = {k: ",".join
+00003e40: 286b 2e73 706c 6974 2822 2c22 295b 3a31  (k.split(",")[:1
+00003e50: 5d29 2066 6f72 206b 2069 6e20 706c 6163  ]) for k in plac
+00003e60: 656d 656e 7473 2e6b 6579 7328 297d 0a20  ements.keys()}. 
+00003e70: 2020 2020 2020 206e 782e 6472 6177 280a         nx.draw(.
+00003e80: 2020 2020 2020 2020 2020 2020 472c 0a20              G,. 
+00003e90: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00003ea0: 6c61 6265 6c73 3d77 6974 685f 6c61 6265  labels=with_labe
+00003eb0: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+00003ec0: 666f 6e74 5f77 6569 6768 743d 666f 6e74  font_weight=font
+00003ed0: 5f77 6569 6768 742c 0a20 2020 2020 2020  _weight,.       
+00003ee0: 2020 2020 206c 6162 656c 733d 6c61 6265       labels=labe
+00003ef0: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+00003f00: 706f 733d 706f 732c 0a20 2020 2020 2020  pos=pos,.       
+00003f10: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00003f20: 6e20 470a 0a20 2020 2064 6566 2067 6574  n G..    def get
+00003f30: 5f6e 6574 6c69 7374 5f79 616d 6c28 7365  _netlist_yaml(se
+00003f40: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
+00003f50: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
+00003f60: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+00003f70: 7366 6163 746f 7279 2e67 6574 5f6e 6574  sfactory.get_net
+00003f80: 6c69 7374 2069 6d70 6f72 7420 6765 745f  list import get_
+00003f90: 6e65 746c 6973 745f 7961 6d6c 0a0a 2020  netlist_yaml..  
+00003fa0: 2020 2020 2020 7265 7475 726e 2067 6574        return get
+00003fb0: 5f6e 6574 6c69 7374 5f79 616d 6c28 7365  _netlist_yaml(se
+00003fc0: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
+00003fd0: 2020 2064 6566 2077 7269 7465 5f6e 6574     def write_net
+00003fe0: 6c69 7374 2873 656c 662c 2066 696c 6570  list(self, filep
+00003ff0: 6174 683a 2073 7472 2920 2d3e 204e 6f6e  ath: str) -> Non
+00004000: 653a 0a20 2020 2020 2020 2022 2222 5772  e:.        """Wr
+00004010: 6974 6520 6e65 746c 6973 7420 696e 2059  ite netlist in Y
+00004020: 414d 4c2e 2222 220a 2020 2020 2020 2020  AML.""".        
+00004030: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
+00004040: 6574 5f6e 6574 6c69 7374 2829 0a20 2020  et_netlist().   
+00004050: 2020 2020 204f 6d65 6761 436f 6e66 2e73       OmegaConf.s
+00004060: 6176 6528 6e65 746c 6973 742c 2066 696c  ave(netlist, fil
+00004070: 6570 6174 6829 0a0a 2020 2020 6465 6620  epath)..    def 
+00004080: 7772 6974 655f 6e65 746c 6973 745f 646f  write_netlist_do
+00004090: 7428 7365 6c66 2c20 6669 6c65 7061 7468  t(self, filepath
+000040a0: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+000040b0: 3d20 4e6f 6e65 2920 2d3e 204e 6f6e 653a  = None) -> None:
+000040c0: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
+000040d0: 6520 6e65 746c 6973 7420 6772 6170 6820  e netlist graph 
+000040e0: 696e 2044 4f54 2066 6f72 6d61 742e 2222  in DOT format.""
+000040f0: 220a 2020 2020 2020 2020 6672 6f6d 206e  ".        from n
+00004100: 6574 776f 726b 782e 6472 6177 696e 672e  etworkx.drawing.
+00004110: 6e78 5f61 6772 6170 6820 696d 706f 7274  nx_agraph import
+00004120: 2077 7269 7465 5f64 6f74 0a0a 2020 2020   write_dot..    
+00004130: 2020 2020 6669 6c65 7061 7468 203d 2066      filepath = f
+00004140: 696c 6570 6174 6820 6f72 2066 227b 7365  ilepath or f"{se
+00004150: 6c66 2e6e 616d 657d 2e64 6f74 220a 0a20  lf.name}.dot".. 
+00004160: 2020 2020 2020 2047 203d 2073 656c 662e         G = self.
+00004170: 706c 6f74 5f6e 6574 6c69 7374 2829 0a20  plot_netlist(). 
+00004180: 2020 2020 2020 2077 7269 7465 5f64 6f74         write_dot
+00004190: 2847 2c20 6669 6c65 7061 7468 290a 0a20  (G, filepath).. 
+000041a0: 2020 2064 6566 2067 6574 5f6e 6574 6c69     def get_netli
+000041b0: 7374 2873 656c 662c 202a 2a6b 7761 7267  st(self, **kwarg
+000041c0: 7329 202d 3e20 4469 6374 5b73 7472 2c20  s) -> Dict[str, 
+000041d0: 416e 795d 3a0a 2020 2020 2020 2020 2222  Any]:.        ""
+000041e0: 2246 726f 6d20 436f 6d70 6f6e 656e 7420  "From Component 
+000041f0: 7265 7475 726e 7320 696e 7374 616e 6365  returns instance
+00004200: 732c 2063 6f6e 6e65 6374 696f 6e73 2061  s, connections a
+00004210: 6e64 2070 6c61 6365 6d65 6e74 7320 6469  nd placements di
+00004220: 6374 2e0a 0a20 2020 2020 2020 204b 6579  ct...        Key
+00004230: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+00004240: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+00004250: 3a20 746f 2065 7874 7261 6374 206e 6574  : to extract net
+00004260: 6c69 7374 2e0a 2020 2020 2020 2020 2020  list..          
+00004270: 2020 6675 6c6c 5f73 6574 7469 6e67 733a    full_settings:
+00004280: 2054 7275 6520 7265 7475 726e 7320 616c   True returns al
+00004290: 6c2c 2066 616c 7365 2063 6861 6e67 6564  l, false changed
+000042a0: 2073 6574 7469 6e67 732e 0a20 2020 2020   settings..     
+000042b0: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
+000042c0: 3a20 746f 6c65 7261 6e63 6520 696e 206e  : tolerance in n
+000042d0: 6d20 746f 2063 6f6e 7369 6465 7220 7477  m to consider tw
+000042e0: 6f20 706f 7274 7320 636f 6e6e 6563 7465  o ports connecte
+000042f0: 642e 0a20 2020 2020 2020 2020 2020 2065  d..            e
+00004300: 7863 6c75 6465 5f70 6f72 745f 7479 7065  xclude_port_type
+00004310: 733a 206f 7074 696f 6e61 6c20 6c69 7374  s: optional list
+00004320: 206f 6620 706f 7274 2074 7970 6573 2074   of port types t
+00004330: 6f20 6578 636c 7564 6520 6672 6f6d 206e  o exclude from n
+00004340: 6574 6c69 7374 696e 672e 0a20 2020 2020  etlisting..     
+00004350: 2020 2020 2020 2067 6574 5f69 6e73 7461         get_insta
+00004360: 6e63 655f 6e61 6d65 3a20 6675 6e63 7469  nce_name: functi
+00004370: 6f6e 2074 6f20 6765 7420 696e 7374 616e  on to get instan
+00004380: 6365 206e 616d 652e 0a20 2020 2020 2020  ce name..       
+00004390: 2020 2020 2061 6c6c 6f77 5f6d 756c 7469       allow_multi
+000043a0: 706c 653a 2046 616c 7365 2074 6f20 7261  ple: False to ra
+000043b0: 6973 6520 616e 2065 7272 6f72 2069 6620  ise an error if 
+000043c0: 6d6f 7265 2074 6861 6e20 7477 6f20 706f  more than two po
+000043d0: 7274 7320 7368 6172 6520 7468 6520 7361  rts share the sa
+000043e0: 6d65 2063 6f6e 6e65 6374 696f 6e2e 0a20  me connection.. 
+000043f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004400: 6620 5472 7565 2c20 7769 6c6c 2072 6574  f True, will ret
+00004410: 7572 6e20 6b65 793a 205b 7661 6c75 655d  urn key: [value]
+00004420: 2070 6169 7273 2077 6974 6820 5b76 616c   pairs with [val
+00004430: 7565 5d20 6120 6c69 7374 206f 6620 616c  ue] a list of al
+00004440: 6c20 636f 6e6e 6563 7465 6420 696e 7374  l connected inst
+00004450: 616e 6365 732e 0a0a 2020 2020 2020 2020  ances...        
+00004460: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
+00004470: 2020 2020 204e 6574 6c69 7374 2064 6963       Netlist dic
+00004480: 7420 2869 6e73 7461 6e63 6573 2c20 636f  t (instances, co
+00004490: 6e6e 6563 7469 6f6e 732c 2070 6c61 6365  nnections, place
+000044a0: 6d65 6e74 732c 2070 6f72 7473 290a 2020  ments, ports).  
+000044b0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000044c0: 7374 616e 6365 733a 2044 6963 7420 6f66  stances: Dict of
+000044d0: 2069 6e73 7461 6e63 6520 6e61 6d65 2061   instance name a
+000044e0: 6e64 2073 6574 7469 6e67 732e 0a20 2020  nd settings..   
+000044f0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00004500: 6e65 6374 696f 6e73 3a20 4469 6374 206f  nections: Dict o
+00004510: 6620 496e 7374 616e 6365 314e 616d 652c  f Instance1Name,
+00004520: 706f 7274 4e61 6d65 3a20 496e 7374 616e  portName: Instan
+00004530: 6365 324e 616d 652c 706f 7274 4e61 6d65  ce2Name,portName
+00004540: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004550: 2020 706c 6163 656d 656e 7473 3a20 4469    placements: Di
+00004560: 6374 206f 6620 696e 7374 616e 6365 206e  ct of instance n
+00004570: 616d 6573 2061 6e64 2070 6c61 6365 6d65  ames and placeme
+00004580: 6e74 7320 2878 2c20 792c 2072 6f74 6174  nts (x, y, rotat
+00004590: 696f 6e29 2e0a 2020 2020 2020 2020 2020  ion)..          
+000045a0: 2020 2020 2020 706f 7274 733a 2044 6963        ports: Dic
+000045b0: 7420 706f 7274 4e61 6d65 3a20 436f 6d70  t portName: Comp
+000045c0: 6f6e 656e 744e 616d 652c 706f 7274 2e0a  onentName,port..
+000045d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045e0: 6e61 6d65 3a20 6e61 6d65 206f 6620 636f  name: name of co
+000045f0: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
+00004600: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00004610: 6d20 6764 7366 6163 746f 7279 2e67 6574  m gdsfactory.get
+00004620: 5f6e 6574 6c69 7374 2069 6d70 6f72 7420  _netlist import 
+00004630: 6765 745f 6e65 746c 6973 740a 0a20 2020  get_netlist..   
+00004640: 2020 2020 2072 6574 7572 6e20 6765 745f       return get_
+00004650: 6e65 746c 6973 7428 636f 6d70 6f6e 656e  netlist(componen
+00004660: 743d 7365 6c66 2c20 2a2a 6b77 6172 6773  t=self, **kwargs
+00004670: 290a 0a20 2020 2064 6566 2067 6574 5f6e  )..    def get_n
+00004680: 6574 6c69 7374 5f72 6563 7572 7369 7665  etlist_recursive
+00004690: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+000046a0: 202d 3e20 4469 6374 5b73 7472 2c20 4469   -> Dict[str, Di
+000046b0: 6374 436f 6e66 6967 5d3a 0a20 2020 2020  ctConfig]:.     
+000046c0: 2020 2022 2222 5265 7475 726e 7320 7265     """Returns re
+000046d0: 6375 7273 6976 6520 6e65 746c 6973 7420  cursive netlist 
+000046e0: 666f 7220 6120 636f 6d70 6f6e 656e 7420  for a component 
+000046f0: 616e 6420 7375 6263 6f6d 706f 6e65 6e74  and subcomponent
+00004700: 732e 0a0a 2020 2020 2020 2020 4b65 7977  s...        Keyw
+00004710: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
+00004720: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
+00004730: 2074 6f20 6578 7472 6163 7420 6e65 746c   to extract netl
+00004740: 6973 742e 0a20 2020 2020 2020 2020 2020  ist..           
+00004750: 2063 6f6d 706f 6e65 6e74 5f73 7566 6669   component_suffi
+00004760: 783a 2073 7566 6669 7820 746f 2061 7070  x: suffix to app
+00004770: 656e 6420 746f 2065 6163 6820 636f 6d70  end to each comp
+00004780: 6f6e 656e 7420 6e61 6d65 2e0a 2020 2020  onent name..    
+00004790: 2020 2020 2020 2020 2020 2020 7573 6566              usef
+000047a0: 756c 2069 6620 746f 2073 6176 6520 616e  ul if to save an
+000047b0: 6420 7265 6c6f 6164 2061 2062 6163 6b2d  d reload a back-
+000047c0: 616e 6e6f 7461 7465 6420 6e65 746c 6973  annotated netlis
+000047d0: 742e 0a20 2020 2020 2020 2020 2020 2067  t..            g
+000047e0: 6574 5f6e 6574 6c69 7374 5f66 756e 633a  et_netlist_func:
+000047f0: 2066 756e 6374 696f 6e20 746f 2065 7874   function to ext
+00004800: 7261 6374 2069 6e64 6976 6964 7561 6c20  ract individual 
+00004810: 6e65 746c 6973 7473 2e0a 2020 2020 2020  netlists..      
+00004820: 2020 2020 2020 6675 6c6c 5f73 6574 7469        full_setti
+00004830: 6e67 733a 2054 7275 6520 7265 7475 726e  ngs: True return
+00004840: 7320 616c 6c2c 2066 616c 7365 2063 6861  s all, false cha
+00004850: 6e67 6564 2073 6574 7469 6e67 732e 0a20  nged settings.. 
+00004860: 2020 2020 2020 2020 2020 2074 6f6c 6572             toler
+00004870: 616e 6365 3a20 746f 6c65 7261 6e63 6520  ance: tolerance 
+00004880: 696e 206e 6d20 746f 2063 6f6e 7369 6465  in nm to conside
+00004890: 7220 7477 6f20 706f 7274 7320 636f 6e6e  r two ports conn
+000048a0: 6563 7465 642e 0a20 2020 2020 2020 2020  ected..         
+000048b0: 2020 2065 7863 6c75 6465 5f70 6f72 745f     exclude_port_
+000048c0: 7479 7065 733a 206f 7074 696f 6e61 6c20  types: optional 
+000048d0: 6c69 7374 206f 6620 706f 7274 2074 7970  list of port typ
+000048e0: 6573 2074 6f20 6578 636c 7564 6520 6672  es to exclude fr
+000048f0: 6f6d 206e 6574 6c69 7374 696e 672e 0a20  om netlisting.. 
+00004900: 2020 2020 2020 2020 2020 2067 6574 5f69             get_i
+00004910: 6e73 7461 6e63 655f 6e61 6d65 3a20 6675  nstance_name: fu
+00004920: 6e63 7469 6f6e 2074 6f20 6765 7420 696e  nction to get in
+00004930: 7374 616e 6365 206e 616d 652e 0a20 2020  stance name..   
+00004940: 2020 2020 2020 2020 2061 6c6c 6f77 5f6d           allow_m
+00004950: 756c 7469 706c 653a 2046 616c 7365 2074  ultiple: False t
+00004960: 6f20 7261 6973 6520 616e 2065 7272 6f72  o raise an error
+00004970: 2069 6620 6d6f 7265 2074 6861 6e20 7477   if more than tw
+00004980: 6f20 706f 7274 7320 7368 6172 6520 7468  o ports share th
+00004990: 6520 7361 6d65 2063 6f6e 6e65 6374 696f  e same connectio
+000049a0: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
+000049b0: 2020 2069 6620 5472 7565 2c20 7769 6c6c     if True, will
+000049c0: 2072 6574 7572 6e20 6b65 793a 205b 7661   return key: [va
+000049d0: 6c75 655d 2070 6169 7273 2077 6974 6820  lue] pairs with 
+000049e0: 5b76 616c 7565 5d20 6120 6c69 7374 206f  [value] a list o
+000049f0: 6620 616c 6c20 636f 6e6e 6563 7465 6420  f all connected 
+00004a00: 696e 7374 616e 6365 732e 0a0a 2020 2020  instances...    
+00004a10: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+00004a20: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
+00004a30: 6172 7920 6f66 206e 6574 6c69 7374 732c  ary of netlists,
+00004a40: 206b 6579 6564 2062 7920 7468 6520 6e61   keyed by the na
+00004a50: 6d65 206f 6620 6561 6368 2063 6f6d 706f  me of each compo
+00004a60: 6e65 6e74 2e0a 2020 2020 2020 2020 2222  nent..        ""
+00004a70: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00004a80: 6473 6661 6374 6f72 792e 6765 745f 6e65  dsfactory.get_ne
+00004a90: 746c 6973 7420 696d 706f 7274 2067 6574  tlist import get
+00004aa0: 5f6e 6574 6c69 7374 5f72 6563 7572 7369  _netlist_recursi
+00004ab0: 7665 0a0a 2020 2020 2020 2020 7265 7475  ve..        retu
+00004ac0: 726e 2067 6574 5f6e 6574 6c69 7374 5f72  rn get_netlist_r
+00004ad0: 6563 7572 7369 7665 2863 6f6d 706f 6e65  ecursive(compone
+00004ae0: 6e74 3d73 656c 662c 202a 2a6b 7761 7267  nt=self, **kwarg
+00004af0: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
+00004b00: 6e65 746c 6973 745f 666c 6174 2873 656c  netlist_flat(sel
+00004b10: 662c 202a 2a6b 7761 7267 7329 202d 3e20  f, **kwargs) -> 
+00004b20: 4469 6374 5b73 7472 2c20 4469 6374 436f  Dict[str, DictCo
+00004b30: 6e66 6967 5d3a 0a20 2020 2020 2020 2022  nfig]:.        "
+00004b40: 2222 5265 7475 726e 7320 6120 6e65 746c  ""Returns a netl
+00004b50: 6973 7420 7768 6572 6520 616c 6c20 7375  ist where all su
+00004b60: 6269 6e73 7461 6e63 6573 2061 7265 2065  binstances are e
+00004b70: 7870 6f73 6564 2061 6e64 2069 6e64 6570  xposed and indep
+00004b80: 656e 6465 6e74 6c79 206e 616d 6564 2e0a  endently named..
+00004b90: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+00004ba0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00004bb0: 2020 2063 6f6d 706f 6e65 6e74 3a20 746f     component: to
+00004bc0: 2065 7874 7261 6374 206e 6574 6c69 7374   extract netlist
+00004bd0: 2e0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00004be0: 6d70 6f6e 656e 745f 7375 6666 6978 3a20  mponent_suffix: 
+00004bf0: 7375 6666 6978 2074 6f20 6170 7065 6e64  suffix to append
+00004c00: 2074 6f20 6561 6368 2063 6f6d 706f 6e65   to each compone
+00004c10: 6e74 206e 616d 652e 0a20 2020 2020 2020  nt name..       
+00004c20: 2020 2020 2020 2020 2075 7365 6675 6c20           useful 
+00004c30: 6966 2074 6f20 7361 7665 2061 6e64 2072  if to save and r
+00004c40: 656c 6f61 6420 6120 6261 636b 2d61 6e6e  eload a back-ann
+00004c50: 6f74 6174 6564 206e 6574 6c69 7374 2e0a  otated netlist..
+00004c60: 2020 2020 2020 2020 2020 2020 6765 745f              get_
+00004c70: 6e65 746c 6973 745f 6675 6e63 3a20 6675  netlist_func: fu
+00004c80: 6e63 7469 6f6e 2074 6f20 6578 7472 6163  nction to extrac
+00004c90: 7420 696e 6469 7669 6475 616c 206e 6574  t individual net
+00004ca0: 6c69 7374 732e 0a20 2020 2020 2020 2020  lists..         
+00004cb0: 2020 2066 756c 6c5f 7365 7474 696e 6773     full_settings
+00004cc0: 3a20 5472 7565 2072 6574 7572 6e73 2061  : True returns a
+00004cd0: 6c6c 2c20 6661 6c73 6520 6368 616e 6765  ll, false change
+00004ce0: 6420 7365 7474 696e 6773 2e0a 2020 2020  d settings..    
+00004cf0: 2020 2020 2020 2020 746f 6c65 7261 6e63          toleranc
+00004d00: 653a 2074 6f6c 6572 616e 6365 2069 6e20  e: tolerance in 
+00004d10: 6e6d 2074 6f20 636f 6e73 6964 6572 2074  nm to consider t
+00004d20: 776f 2070 6f72 7473 2063 6f6e 6e65 6374  wo ports connect
+00004d30: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+00004d40: 6578 636c 7564 655f 706f 7274 5f74 7970  exclude_port_typ
+00004d50: 6573 3a20 6f70 7469 6f6e 616c 206c 6973  es: optional lis
+00004d60: 7420 6f66 2070 6f72 7420 7479 7065 7320  t of port types 
+00004d70: 746f 2065 7863 6c75 6465 2066 726f 6d20  to exclude from 
+00004d80: 6e65 746c 6973 7469 6e67 2e0a 2020 2020  netlisting..    
+00004d90: 2020 2020 2020 2020 6765 745f 696e 7374          get_inst
+00004da0: 616e 6365 5f6e 616d 653a 2066 756e 6374  ance_name: funct
+00004db0: 696f 6e20 746f 2067 6574 2069 6e73 7461  ion to get insta
+00004dc0: 6e63 6520 6e61 6d65 2e0a 2020 2020 2020  nce name..      
+00004dd0: 2020 2020 2020 616c 6c6f 775f 6d75 6c74        allow_mult
+00004de0: 6970 6c65 3a20 4661 6c73 6520 746f 2072  iple: False to r
+00004df0: 6169 7365 2061 6e20 6572 726f 7220 6966  aise an error if
+00004e00: 206d 6f72 6520 7468 616e 2074 776f 2070   more than two p
+00004e10: 6f72 7473 2073 6861 7265 2074 6865 2073  orts share the s
+00004e20: 616d 6520 636f 6e6e 6563 7469 6f6e 2e0a  ame connection..
+00004e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e40: 6966 2054 7275 652c 2077 696c 6c20 7265  if True, will re
+00004e50: 7475 726e 206b 6579 3a20 5b76 616c 7565  turn key: [value
+00004e60: 5d20 7061 6972 7320 7769 7468 205b 7661  ] pairs with [va
+00004e70: 6c75 655d 2061 206c 6973 7420 6f66 2061  lue] a list of a
+00004e80: 6c6c 2063 6f6e 6e65 6374 6564 2069 6e73  ll connected ins
+00004e90: 7461 6e63 6573 2e0a 0a20 2020 2020 2020  tances...       
+00004ea0: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+00004eb0: 2020 2020 2020 4469 6374 696f 6e61 7279        Dictionary
+00004ec0: 206f 6620 6e65 746c 6973 7473 2c20 6b65   of netlists, ke
+00004ed0: 7965 6420 6279 2074 6865 206e 616d 6520  yed by the name 
+00004ee0: 6f66 2065 6163 6820 636f 6d70 6f6e 656e  of each componen
+00004ef0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+00004f00: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+00004f10: 6163 746f 7279 2e67 6574 5f6e 6574 6c69  actory.get_netli
+00004f20: 7374 5f66 6c61 7420 696d 706f 7274 2067  st_flat import g
+00004f30: 6574 5f6e 6574 6c69 7374 5f66 6c61 740a  et_netlist_flat.
+00004f40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00004f50: 6765 745f 6e65 746c 6973 745f 666c 6174  get_netlist_flat
+00004f60: 2863 6f6d 706f 6e65 6e74 3d73 656c 662c  (component=self,
+00004f70: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00004f80: 6465 6620 6173 7365 7274 5f70 6f72 7473  def assert_ports
+00004f90: 5f6f 6e5f 6772 6964 2873 656c 662c 206e  _on_grid(self, n
+00004fa0: 6d3a 2069 6e74 203d 2031 2920 2d3e 204e  m: int = 1) -> N
+00004fb0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00004fc0: 4173 7365 7274 7320 7468 6174 2061 6c6c  Asserts that all
+00004fd0: 2070 6f72 7473 2061 7265 206f 6e20 6772   ports are on gr
+00004fe0: 6964 2e22 2222 0a20 2020 2020 2020 2066  id.""".        f
+00004ff0: 6f72 2070 6f72 7420 696e 2073 656c 662e  or port in self.
+00005000: 706f 7274 732e 7661 6c75 6573 2829 3a0a  ports.values():.
+00005010: 2020 2020 2020 2020 2020 2020 706f 7274              port
+00005020: 2e61 7373 6572 745f 6f6e 5f67 7269 6428  .assert_on_grid(
+00005030: 6e6d 3d6e 6d29 0a0a 2020 2020 6465 6620  nm=nm)..    def 
+00005040: 6765 745f 706f 7274 7328 7365 6c66 2c20  get_ports(self, 
+00005050: 6465 7074 683d 4e6f 6e65 293a 0a20 2020  depth=None):.   
+00005060: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00005070: 636f 7069 6573 206f 6620 616c 6c20 7468  copies of all th
+00005080: 6520 706f 7274 7320 6f66 2074 6865 2043  e ports of the C
+00005090: 6f6d 706f 6e65 6e74 2c20 726f 7461 7465  omponent, rotate
+000050a0: 6420 616e 6420 5c0a 2020 2020 2020 2020  d and \.        
+000050b0: 2020 2020 2020 2020 7472 616e 736c 6174          translat
+000050c0: 6564 2073 6f20 7468 6174 2074 6865 7927  ed so that they'
+000050d0: 7265 2069 6e20 7468 6569 7220 746f 702d  re in their top-
+000050e0: 6c65 7665 6c20 706f 7369 7469 6f6e 2e0a  level position..
+000050f0: 0a20 2020 2020 2020 2054 6865 2050 6f72  .        The Por
+00005100: 7473 2072 6574 7572 6e65 6420 6172 6520  ts returned are 
+00005110: 636f 7069 6573 206f 6620 7468 6520 6f72  copies of the or
+00005120: 6967 696e 616c 732c 2062 7574 2065 6163  iginals, but eac
+00005130: 6820 636f 7079 2068 6173 2074 6865 2073  h copy has the s
+00005140: 616d 650a 2020 2020 2020 2020 6060 7569  ame.        ``ui
+00005150: 6460 6020 6173 2074 6865 206f 7269 6769  d`` as the origi
+00005160: 6e61 6c20 736f 2074 6861 7420 7468 6579  nal so that they
+00005170: 2063 616e 2062 6520 7472 6163 6564 2062   can be traced b
+00005180: 6163 6b20 746f 2074 6865 206f 7269 6769  ack to the origi
+00005190: 6e61 6c20 6966 206e 6565 6465 642e 0a0a  nal if needed...
+000051a0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000051b0: 2020 2020 2020 2020 2020 6465 7074 6820            depth 
+000051c0: 3a20 696e 7420 6f72 204e 6f6e 650a 2020  : int or None.  
+000051d0: 2020 2020 2020 2020 2020 2020 2020 4966                If
+000051e0: 206e 6f74 204e 6f6e 652c 2064 6566 696e   not None, defin
+000051f0: 6573 2066 726f 6d20 686f 7720 6d61 6e79  es from how many
+00005200: 2072 6566 6572 656e 6365 206c 6576 656c   reference level
+00005210: 7320 746f 0a20 2020 2020 2020 2020 2020  s to.           
+00005220: 2020 2020 2072 6574 7269 6576 6520 506f       retrieve Po
+00005230: 7274 7320 6672 6f6d 2e0a 0a20 2020 2020  rts from...     
+00005240: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+00005250: 2020 2020 2020 2020 706f 7274 5f6c 6973          port_lis
+00005260: 7420 3a20 6c69 7374 206f 6620 506f 7274  t : list of Port
+00005270: 204c 6973 7420 6f66 2061 6c6c 2050 6f72   List of all Por
+00005280: 7473 2069 6e20 7468 6520 436f 6d70 6f6e  ts in the Compon
+00005290: 656e 742e 0a20 2020 2020 2020 2022 2222  ent..        """
+000052a0: 0a20 2020 2020 2020 2070 6f72 745f 6c69  .        port_li
+000052b0: 7374 203d 205b 702e 5f63 6f70 7928 2920  st = [p._copy() 
+000052c0: 666f 7220 7020 696e 2073 656c 662e 706f  for p in self.po
+000052d0: 7274 732e 7661 6c75 6573 2829 5d0a 0a20  rts.values()].. 
+000052e0: 2020 2020 2020 2069 6620 6465 7074 6820         if depth 
+000052f0: 6973 204e 6f6e 6520 6f72 2064 6570 7468  is None or depth
+00005300: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00005310: 2020 666f 7220 7220 696e 2073 656c 662e    for r in self.
+00005320: 7265 6665 7265 6e63 6573 3a0a 2020 2020  references:.    
+00005330: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00005340: 6465 7074 6820 3d20 4e6f 6e65 2069 6620  depth = None if 
+00005350: 6465 7074 6820 6973 204e 6f6e 6520 656c  depth is None el
+00005360: 7365 2064 6570 7468 202d 2031 0a20 2020  se depth - 1.   
+00005370: 2020 2020 2020 2020 2020 2020 2072 6566               ref
+00005380: 5f70 6f72 7473 203d 2072 2e70 6172 656e  _ports = r.paren
+00005390: 742e 6765 745f 706f 7274 7328 6465 7074  t.get_ports(dept
+000053a0: 683d 6e65 775f 6465 7074 6829 0a0a 2020  h=new_depth)..  
+000053b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000053c0: 5472 616e 7366 6f72 6d20 706f 7274 7320  Transform ports 
+000053d0: 7468 6174 2063 616d 6520 6672 6f6d 2061  that came from a
+000053e0: 2072 6566 6572 656e 6365 0a20 2020 2020   reference.     
+000053f0: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
+00005400: 6f72 7473 5f74 7261 6e73 666f 726d 6564  orts_transformed
+00005410: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00005420: 2020 2020 2020 666f 7220 7270 2069 6e20        for rp in 
+00005430: 7265 665f 706f 7274 733a 0a20 2020 2020  ref_ports:.     
+00005440: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00005450: 6577 5f70 6f72 7420 3d20 7270 2e5f 636f  ew_port = rp._co
+00005460: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
+00005470: 2020 2020 2020 2020 206e 6577 5f63 656e           new_cen
+00005480: 7465 722c 206e 6577 5f6f 7269 656e 7461  ter, new_orienta
+00005490: 7469 6f6e 203d 2072 2e5f 7472 616e 7366  tion = r._transf
+000054a0: 6f72 6d5f 706f 7274 280a 2020 2020 2020  orm_port(.      
+000054b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054c0: 2020 7270 2e63 656e 7465 722c 0a20 2020    rp.center,.   
+000054d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054e0: 2020 2020 2072 702e 6f72 6965 6e74 6174       rp.orientat
+000054f0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00005500: 2020 2020 2020 2020 2020 2020 2072 2e6f               r.o
+00005510: 7269 6769 6e2c 0a20 2020 2020 2020 2020  rigin,.         
+00005520: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00005530: 2e72 6f74 6174 696f 6e2c 0a20 2020 2020  .rotation,.     
+00005540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005550: 2020 2072 2e78 5f72 6566 6c65 6374 696f     r.x_reflectio
+00005560: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00005570: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00005580: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00005590: 5f70 6f72 742e 6365 6e74 6572 203d 206e  _port.center = n
+000055a0: 6577 5f63 656e 7465 720a 2020 2020 2020  ew_center.      
+000055b0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000055c0: 775f 706f 7274 2e6e 6577 5f6f 7269 656e  w_port.new_orien
+000055d0: 7461 7469 6f6e 203d 206e 6577 5f6f 7269  tation = new_ori
+000055e0: 656e 7461 7469 6f6e 0a20 2020 2020 2020  entation.       
+000055f0: 2020 2020 2020 2020 2020 2020 2072 6566               ref
+00005600: 5f70 6f72 7473 5f74 7261 6e73 666f 726d  _ports_transform
+00005610: 6564 2e61 7070 656e 6428 6e65 775f 706f  ed.append(new_po
+00005620: 7274 290a 2020 2020 2020 2020 2020 2020  rt).            
+00005630: 2020 2020 706f 7274 5f6c 6973 7420 2b3d      port_list +=
+00005640: 2072 6566 5f70 6f72 7473 5f74 7261 6e73   ref_ports_trans
+00005650: 666f 726d 6564 0a0a 2020 2020 2020 2020  formed..        
+00005660: 7265 7475 726e 2070 6f72 745f 6c69 7374  return port_list
+00005670: 0a0a 2020 2020 6465 6620 6765 745f 706f  ..    def get_po
+00005680: 7274 735f 6469 6374 2873 656c 662c 202a  rts_dict(self, *
+00005690: 2a6b 7761 7267 7329 202d 3e20 4469 6374  *kwargs) -> Dict
+000056a0: 5b73 7472 2c20 506f 7274 5d3a 0a20 2020  [str, Port]:.   
+000056b0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+000056c0: 6120 6469 6374 206f 6620 706f 7274 732e  a dict of ports.
+000056d0: 0a0a 2020 2020 2020 2020 4b65 7977 6f72  ..        Keywor
+000056e0: 6420 4172 6773 3a0a 2020 2020 2020 2020  d Args:.        
+000056f0: 2020 2020 6c61 7965 723a 2070 6f72 7420      layer: port 
+00005700: 4744 5320 6c61 7965 722e 0a20 2020 2020  GDS layer..     
+00005710: 2020 2020 2020 2070 7265 6669 783a 2073         prefix: s
+00005720: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
+00005730: 2070 7265 6669 7820 696e 2070 6f72 7420   prefix in port 
+00005740: 6e61 6d65 2e0a 2020 2020 2020 2020 2020  name..          
+00005750: 2020 7375 6666 6978 3a20 7365 6c65 6374    suffix: select
+00005760: 2070 6f72 7473 2077 6974 6820 706f 7274   ports with port
+00005770: 206e 616d 6520 7375 6666 6978 2e0a 2020   name suffix..  
+00005780: 2020 2020 2020 2020 2020 6f72 6965 6e74            orient
+00005790: 6174 696f 6e3a 2073 656c 6563 7420 706f  ation: select po
+000057a0: 7274 7320 7769 7468 206f 7269 656e 7461  rts with orienta
+000057b0: 7469 6f6e 2069 6e20 6465 6772 6565 732e  tion in degrees.
+000057c0: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
+000057d0: 7468 3a20 7365 6c65 6374 2070 6f72 7473  th: select ports
+000057e0: 2077 6974 6820 706f 7274 2077 6964 7468   with port width
+000057f0: 2e0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+00005800: 7965 7273 5f65 7863 6c75 6465 643a 204c  yers_excluded: L
+00005810: 6973 7420 6f66 206c 6179 6572 7320 746f  ist of layers to
+00005820: 2065 7863 6c75 6465 2e0a 2020 2020 2020   exclude..      
+00005830: 2020 2020 2020 706f 7274 5f74 7970 653a        port_type:
+00005840: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
+00005850: 7468 2070 6f72 745f 7479 7065 2028 6f70  th port_type (op
+00005860: 7469 6361 6c2c 2065 6c65 6374 7269 6361  tical, electrica
+00005870: 6c2c 2076 6572 7469 6361 6c5f 7465 292e  l, vertical_te).
+00005880: 0a20 2020 2020 2020 2020 2020 2063 6c6f  .            clo
+00005890: 636b 7769 7365 3a20 6966 2054 7275 652c  ckwise: if True,
+000058a0: 2073 6f72 7420 706f 7274 7320 636c 6f63   sort ports cloc
+000058b0: 6b77 6973 652c 2046 616c 7365 3a20 636f  kwise, False: co
+000058c0: 756e 7465 722d 636c 6f63 6b77 6973 652e  unter-clockwise.
+000058d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000058e0: 2020 2020 2072 6574 7572 6e20 7365 6c65       return sele
+000058f0: 6374 5f70 6f72 7473 2873 656c 662e 706f  ct_ports(self.po
+00005900: 7274 732c 202a 2a6b 7761 7267 7329 0a0a  rts, **kwargs)..
+00005910: 2020 2020 6465 6620 6765 745f 706f 7274      def get_port
+00005920: 735f 6c69 7374 2873 656c 662c 202a 2a6b  s_list(self, **k
+00005930: 7761 7267 7329 202d 3e20 4c69 7374 5b50  wargs) -> List[P
+00005940: 6f72 745d 3a0a 2020 2020 2020 2020 2222  ort]:.        ""
+00005950: 2252 6574 7572 6e73 206c 6973 7420 6f66  "Returns list of
+00005960: 2070 6f72 7473 2e0a 0a20 2020 2020 2020   ports...       
+00005970: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
+00005980: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00005990: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
+000059a0: 6974 6820 4744 5320 6c61 7965 722e 0a20  ith GDS layer.. 
+000059b0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+000059c0: 783a 2073 656c 6563 7420 706f 7274 7320  x: select ports 
+000059d0: 7769 7468 2070 7265 6669 7820 696e 2070  with prefix in p
+000059e0: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
+000059f0: 2020 2020 2020 7375 6666 6978 3a20 7365        suffix: se
+00005a00: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
+00005a10: 706f 7274 206e 616d 6520 7375 6666 6978  port name suffix
+00005a20: 2e0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+00005a30: 6965 6e74 6174 696f 6e3a 2073 656c 6563  ientation: selec
+00005a40: 7420 706f 7274 7320 7769 7468 206f 7269  t ports with ori
+00005a50: 656e 7461 7469 6f6e 2069 6e20 6465 6772  entation in degr
+00005a60: 6565 732e 0a20 2020 2020 2020 2020 2020  ees..           
+00005a70: 206f 7269 656e 7461 7469 6f6e 3a20 7365   orientation: se
+00005a80: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
+00005a90: 6f72 6965 6e74 6174 696f 6e20 696e 2064  orientation in d
+00005aa0: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
+00005ab0: 2020 2020 7769 6474 683a 2073 656c 6563      width: selec
+00005ac0: 7420 706f 7274 7320 7769 7468 2070 6f72  t ports with por
+00005ad0: 7420 7769 6474 682e 0a20 2020 2020 2020  t width..       
+00005ae0: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
+00005af0: 7564 6564 3a20 4c69 7374 206f 6620 6c61  uded: List of la
+00005b00: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
+00005b10: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+00005b20: 745f 7479 7065 3a20 7365 6c65 6374 2070  t_type: select p
+00005b30: 6f72 7473 2077 6974 6820 706f 7274 5f74  orts with port_t
+00005b40: 7970 6520 286f 7074 6963 616c 2c20 656c  ype (optical, el
+00005b50: 6563 7472 6963 616c 2c20 7665 7274 6963  ectrical, vertic
+00005b60: 616c 5f74 6529 2e0a 2020 2020 2020 2020  al_te)..        
+00005b70: 2020 2020 636c 6f63 6b77 6973 653a 2069      clockwise: i
+00005b80: 6620 5472 7565 2c20 736f 7274 2070 6f72  f True, sort por
+00005b90: 7473 2063 6c6f 636b 7769 7365 2c20 4661  ts clockwise, Fa
+00005ba0: 6c73 653a 2063 6f75 6e74 6572 2d63 6c6f  lse: counter-clo
+00005bb0: 636b 7769 7365 2e0a 2020 2020 2020 2020  ckwise..        
+00005bc0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00005bd0: 726e 206c 6973 7428 7365 6c65 6374 5f70  rn list(select_p
+00005be0: 6f72 7473 2873 656c 662e 706f 7274 732c  orts(self.ports,
+00005bf0: 202a 2a6b 7761 7267 7329 2e76 616c 7565   **kwargs).value
+00005c00: 7328 2929 0a0a 2020 2020 6465 6620 6765  s())..    def ge
+00005c10: 745f 706f 7274 735f 7061 6e64 6173 2873  t_ports_pandas(s
+00005c20: 656c 6629 3a0a 2020 2020 2020 2020 696d  elf):.        im
+00005c30: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
+00005c40: 640a 0a20 2020 2020 2020 2063 6f6c 5f73  d..        col_s
+00005c50: 7065 6320 3d20 5b0a 2020 2020 2020 2020  pec = [.        
+00005c60: 2020 2020 226e 616d 6522 2c0a 2020 2020      "name",.    
+00005c70: 2020 2020 2020 2020 2277 6964 7468 222c          "width",
+00005c80: 0a20 2020 2020 2020 2020 2020 2022 6365  .            "ce
+00005c90: 6e74 6572 222c 0a20 2020 2020 2020 2020  nter",.         
+00005ca0: 2020 2022 6f72 6965 6e74 6174 696f 6e22     "orientation"
+00005cb0: 2c0a 2020 2020 2020 2020 2020 2020 226c  ,.            "l
+00005cc0: 6179 6572 222c 0a20 2020 2020 2020 2020  ayer",.         
+00005cd0: 2020 2022 706f 7274 5f74 7970 6522 2c0a     "port_type",.
+00005ce0: 2020 2020 2020 2020 2020 2020 2273 6865              "she
+00005cf0: 6172 5f61 6e67 6c65 222c 0a20 2020 2020  ar_angle",.     
+00005d00: 2020 205d 0a0a 2020 2020 2020 2020 7265     ]..        re
+00005d10: 7475 726e 2070 642e 4461 7461 4672 616d  turn pd.DataFram
+00005d20: 6528 0a20 2020 2020 2020 2020 2020 205b  e(.            [
+00005d30: 706f 7274 2e74 6f5f 6469 6374 2829 2066  port.to_dict() f
+00005d40: 6f72 2070 6f72 7420 696e 2073 656c 662e  or port in self.
+00005d50: 6765 745f 706f 7274 735f 6c69 7374 2829  get_ports_list()
+00005d60: 5d2c 2063 6f6c 756d 6e73 3d63 6f6c 5f73  ], columns=col_s
+00005d70: 7065 630a 2020 2020 2020 2020 290a 0a20  pec.        ).. 
+00005d80: 2020 2064 6566 2067 6574 5f70 6f72 7473     def get_ports
+00005d90: 5f70 6f6c 6172 7328 7365 6c66 293a 0a20  _polars(self):. 
+00005da0: 2020 2020 2020 2069 6d70 6f72 7420 706f         import po
+00005db0: 6c61 7273 2061 7320 706c 0a0a 2020 2020  lars as pl..    
+00005dc0: 2020 2020 636f 6c5f 7370 6563 203d 207b      col_spec = {
+00005dd0: 0a20 2020 2020 2020 2020 2020 2022 6e61  .            "na
+00005de0: 6d65 223a 2070 6c2e 5574 6638 2c0a 2020  me": pl.Utf8,.  
+00005df0: 2020 2020 2020 2020 2020 2277 6964 7468            "width
+00005e00: 223a 2070 6c2e 466c 6f61 7436 342c 0a20  ": pl.Float64,. 
+00005e10: 2020 2020 2020 2020 2020 2022 6365 6e74             "cent
+00005e20: 6572 223a 2070 6c2e 4c69 7374 2870 6c2e  er": pl.List(pl.
+00005e30: 466c 6f61 7436 3429 2c0a 2020 2020 2020  Float64),.      
+00005e40: 2020 2020 2020 226f 7269 656e 7461 7469        "orientati
+00005e50: 6f6e 223a 2070 6c2e 466c 6f61 7436 342c  on": pl.Float64,
+00005e60: 0a20 2020 2020 2020 2020 2020 2022 6c61  .            "la
+00005e70: 7965 7222 3a20 706c 2e4c 6973 7428 706c  yer": pl.List(pl
+00005e80: 2e55 496e 7431 3629 2c0a 2020 2020 2020  .UInt16),.      
+00005e90: 2020 2020 2020 2270 6f72 745f 7479 7065        "port_type
+00005ea0: 223a 2070 6c2e 5574 6638 2c0a 2020 2020  ": pl.Utf8,.    
+00005eb0: 2020 2020 2020 2020 2273 6865 6172 5f61          "shear_a
+00005ec0: 6e67 6c65 223a 2070 6c2e 466c 6f61 7436  ngle": pl.Float6
+00005ed0: 342c 0a20 2020 2020 2020 207d 0a0a 2020  4,.        }..  
+00005ee0: 2020 2020 2020 7265 7475 726e 2070 6c2e        return pl.
+00005ef0: 4461 7461 4672 616d 6528 0a20 2020 2020  DataFrame(.     
+00005f00: 2020 2020 2020 205b 706f 7274 2e74 6f5f         [port.to_
+00005f10: 6469 6374 2829 2066 6f72 2070 6f72 7420  dict() for port 
+00005f20: 696e 2073 656c 662e 6765 745f 706f 7274  in self.get_port
+00005f30: 735f 6c69 7374 2829 5d2c 2073 6368 656d  s_list()], schem
+00005f40: 613d 636f 6c5f 7370 6563 0a20 2020 2020  a=col_spec.     
+00005f50: 2020 2029 0a0a 2020 2020 6465 6620 7265     )..    def re
+00005f60: 6628 0a20 2020 2020 2020 2073 656c 662c  f(.        self,
+00005f70: 0a20 2020 2020 2020 2070 6f73 6974 696f  .        positio
+00005f80: 6e3a 2043 6f6f 7264 696e 6174 6520 3d20  n: Coordinate = 
+00005f90: 2830 2c20 3029 2c0a 2020 2020 2020 2020  (0, 0),.        
+00005fa0: 706f 7274 5f69 643a 204f 7074 696f 6e61  port_id: Optiona
+00005fb0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
+00005fc0: 2020 2020 2020 2072 6f74 6174 696f 6e3a         rotation:
+00005fd0: 2066 6c6f 6174 203d 2030 2c0a 2020 2020   float = 0,.    
+00005fe0: 2020 2020 685f 6d69 7272 6f72 3a20 626f      h_mirror: bo
+00005ff0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00006000: 2020 2020 765f 6d69 7272 6f72 3a20 626f      v_mirror: bo
+00006010: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00006020: 2920 2d3e 2043 6f6d 706f 6e65 6e74 5265  ) -> ComponentRe
+00006030: 6665 7265 6e63 653a 0a20 2020 2020 2020  ference:.       
+00006040: 2022 2222 5265 7475 726e 7320 436f 6d70   """Returns Comp
+00006050: 6f6e 656e 7420 7265 6665 7265 6e63 652e  onent reference.
+00006060: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00006070: 2020 2020 2020 2020 2020 2020 706f 7369              posi
+00006080: 7469 6f6e 3a20 782c 2079 2070 6f73 6974  tion: x, y posit
+00006090: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+000060a0: 2070 6f72 745f 6964 3a20 6e61 6d65 206f   port_id: name o
+000060b0: 6620 7468 6520 706f 7274 2e0a 2020 2020  f the port..    
+000060c0: 2020 2020 2020 2020 726f 7461 7469 6f6e          rotation
+000060d0: 3a20 696e 2064 6567 7265 6573 2e0a 2020  : in degrees..  
+000060e0: 2020 2020 2020 2020 2020 685f 6d69 7272            h_mirr
+000060f0: 6f72 3a20 686f 7269 7a6f 6e74 616c 206d  or: horizontal m
+00006100: 6972 726f 7220 7573 696e 6720 7920 6178  irror using y ax
+00006110: 6973 2028 782c 2031 2920 2831 2c20 3029  is (x, 1) (1, 0)
+00006120: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006130: 2020 5468 6973 2069 7320 7468 6520 6d6f    This is the mo
+00006140: 7374 2063 6f6d 6d6f 6e20 6d69 7272 6f72  st common mirror
+00006150: 2e0a 2020 2020 2020 2020 2020 2020 765f  ..            v_
+00006160: 6d69 7272 6f72 3a20 7665 7274 6963 616c  mirror: vertical
+00006170: 206d 6972 726f 7220 7573 696e 6720 7820   mirror using x 
+00006180: 6178 6973 2028 312c 2079 2920 2830 2c20  axis (1, y) (0, 
+00006190: 7929 2e0a 2020 2020 2020 2020 2222 220a  y)..        """.
+000061a0: 2020 2020 2020 2020 5f72 6566 203d 2043          _ref = C
+000061b0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+000061c0: 6528 7365 6c66 290a 0a20 2020 2020 2020  e(self)..       
+000061d0: 2069 6620 706f 7274 5f69 6420 616e 6420   if port_id and 
+000061e0: 706f 7274 5f69 6420 6e6f 7420 696e 2073  port_id not in s
+000061f0: 656c 662e 706f 7274 733a 0a20 2020 2020  elf.ports:.     
+00006200: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00006210: 7565 4572 726f 7228 6622 706f 7274 207b  ueError(f"port {
+00006220: 706f 7274 5f69 647d 206e 6f74 2069 6e20  port_id} not in 
+00006230: 7b73 656c 662e 706f 7274 732e 6b65 7973  {self.ports.keys
+00006240: 2829 7d22 290a 0a20 2020 2020 2020 206f  ()}")..        o
+00006250: 7269 6769 6e20 3d20 7365 6c66 2e70 6f72  rigin = self.por
+00006260: 7473 5b70 6f72 745f 6964 5d2e 6365 6e74  ts[port_id].cent
+00006270: 6572 2069 6620 706f 7274 5f69 6420 656c  er if port_id el
+00006280: 7365 2028 302c 2030 290a 2020 2020 2020  se (0, 0).      
+00006290: 2020 6966 2068 5f6d 6972 726f 723a 0a20    if h_mirror:. 
+000062a0: 2020 2020 2020 2020 2020 205f 7265 662e             _ref.
+000062b0: 6d69 7272 6f72 5f78 2870 6f72 745f 6964  mirror_x(port_id
+000062c0: 290a 0a20 2020 2020 2020 2069 6620 765f  )..        if v_
+000062d0: 6d69 7272 6f72 3a0a 2020 2020 2020 2020  mirror:.        
+000062e0: 2020 2020 5f72 6566 2e6d 6972 726f 725f      _ref.mirror_
+000062f0: 7928 706f 7274 5f69 6429 0a0a 2020 2020  y(port_id)..    
+00006300: 2020 2020 6966 2072 6f74 6174 696f 6e20      if rotation 
+00006310: 213d 2030 3a0a 2020 2020 2020 2020 2020  != 0:.          
+00006320: 2020 5f72 6566 2e72 6f74 6174 6528 726f    _ref.rotate(ro
+00006330: 7461 7469 6f6e 2c20 6f72 6967 696e 290a  tation, origin).
+00006340: 2020 2020 2020 2020 5f72 6566 2e6d 6f76          _ref.mov
+00006350: 6528 6f72 6967 696e 2c20 706f 7369 7469  e(origin, positi
+00006360: 6f6e 290a 0a20 2020 2020 2020 2072 6574  on)..        ret
+00006370: 7572 6e20 5f72 6566 0a0a 2020 2020 6465  urn _ref..    de
+00006380: 6620 7265 665f 6365 6e74 6572 2873 656c  f ref_center(sel
+00006390: 662c 2070 6f73 6974 696f 6e3d 2830 2c20  f, position=(0, 
+000063a0: 3029 293a 0a20 2020 2020 2020 2022 2222  0)):.        """
+000063b0: 5265 7475 726e 7320 6120 7265 6665 7265  Returns a refere
+000063c0: 6e63 6520 6f66 2074 6865 2063 6f6d 706f  nce of the compo
+000063d0: 6e65 6e74 2063 656e 7465 7265 6420 6174  nent centered at
+000063e0: 2028 783d 302c 2079 3d30 292e 2222 220a   (x=0, y=0).""".
+000063f0: 2020 2020 2020 2020 7369 203d 2073 656c          si = sel
+00006400: 662e 7369 7a65 5f69 6e66 6f0a 2020 2020  f.size_info.    
+00006410: 2020 2020 7963 203d 2073 692e 736f 7574      yc = si.sout
+00006420: 6820 2b20 7369 2e68 6569 6768 7420 2f20  h + si.height / 
+00006430: 320a 2020 2020 2020 2020 7863 203d 2073  2.        xc = s
+00006440: 692e 7765 7374 202b 2073 692e 7769 6474  i.west + si.widt
+00006450: 6820 2f20 320a 2020 2020 2020 2020 6365  h / 2.        ce
+00006460: 6e74 6572 203d 2028 7863 2c20 7963 290a  nter = (xc, yc).
+00006470: 2020 2020 2020 2020 5f72 6566 203d 2043          _ref = C
+00006480: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+00006490: 6528 7365 6c66 290a 2020 2020 2020 2020  e(self).        
+000064a0: 5f72 6566 2e6d 6f76 6528 6365 6e74 6572  _ref.move(center
+000064b0: 2c20 706f 7369 7469 6f6e 290a 2020 2020  , position).    
+000064c0: 2020 2020 7265 7475 726e 205f 7265 660a      return _ref.
+000064d0: 0a20 2020 2064 6566 205f 5f72 6570 725f  .    def __repr_
+000064e0: 5f28 7365 6c66 2920 2d3e 2073 7472 3a0a  _(self) -> str:.
+000064f0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00006500: 6e20 6120 7374 7269 6e67 2072 6570 7265  n a string repre
+00006510: 7365 6e74 6174 696f 6e20 6f66 2074 6865  sentation of the
+00006520: 206f 626a 6563 742e 2222 220a 2020 2020   object.""".    
+00006530: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
+00006540: 2020 2020 2020 2020 2066 227b 7365 6c66           f"{self
+00006550: 2e6e 616d 657d 3a20 7569 6420 7b73 656c  .name}: uid {sel
+00006560: 662e 7569 647d 2c20 220a 2020 2020 2020  f.uid}, ".      
+00006570: 2020 2020 2020 6622 706f 7274 7320 7b6c        f"ports {l
+00006580: 6973 7428 7365 6c66 2e70 6f72 7473 2e6b  ist(self.ports.k
+00006590: 6579 7328 2929 7d2c 2022 0a20 2020 2020  eys())}, ".     
+000065a0: 2020 2020 2020 2066 2272 6566 6572 656e         f"referen
+000065b0: 6365 7320 7b6c 6973 7428 7365 6c66 2e6e  ces {list(self.n
+000065c0: 616d 6564 5f72 6566 6572 656e 6365 732e  amed_references.
+000065d0: 6b65 7973 2829 297d 2c20 220a 2020 2020  keys())}, ".    
+000065e0: 2020 2020 2020 2020 6622 7b6c 656e 2873          f"{len(s
+000065f0: 656c 662e 706f 6c79 676f 6e73 297d 2070  elf.polygons)} p
+00006600: 6f6c 7967 6f6e 7322 0a20 2020 2020 2020  olygons".       
+00006610: 2029 0a0a 2020 2020 6465 6620 7070 7269   )..    def ppri
+00006620: 6e74 2873 656c 6629 202d 3e20 4e6f 6e65  nt(self) -> None
+00006630: 3a0a 2020 2020 2020 2020 2222 2250 7269  :.        """Pri
+00006640: 6e74 7320 636f 6d70 6f6e 656e 7420 696e  nts component in
+00006650: 666f 2e22 2222 0a20 2020 2020 2020 2074  fo.""".        t
+00006660: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00006670: 6672 6f6d 2072 6963 6820 696d 706f 7274  from rich import
+00006680: 2070 7265 7474 790a 0a20 2020 2020 2020   pretty..       
+00006690: 2020 2020 2070 7265 7474 792e 696e 7374       pretty.inst
+000066a0: 616c 6c28 290a 2020 2020 2020 2020 2020  all().          
+000066b0: 2020 7072 6574 7479 2e70 7072 696e 7428    pretty.pprint(
+000066c0: 7365 6c66 2e74 6f5f 6469 6374 2829 290a  self.to_dict()).
+000066d0: 2020 2020 2020 2020 6578 6365 7074 2049          except I
+000066e0: 6d70 6f72 7445 7272 6f72 3a0a 2020 2020  mportError:.    
+000066f0: 2020 2020 2020 2020 7072 696e 7428 7961          print(ya
+00006700: 6d6c 2e64 756d 7028 7365 6c66 2e74 6f5f  ml.dump(self.to_
+00006710: 6469 6374 2829 2929 0a0a 2020 2020 6465  dict()))..    de
+00006720: 6620 7070 7269 6e74 5f70 6f72 7473 2873  f pprint_ports(s
+00006730: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00006740: 2020 2020 2020 2222 2250 7269 6e74 7320        """Prints 
+00006750: 636f 6d70 6f6e 656e 7420 6e65 746c 6973  component netlis
+00006760: 7473 2e22 2222 0a20 2020 2020 2020 2070  ts.""".        p
+00006770: 6f72 7473 5f6c 6973 7420 3d20 7365 6c66  orts_list = self
+00006780: 2e67 6574 5f70 6f72 7473 5f6c 6973 7428  .get_ports_list(
+00006790: 290a 2020 2020 2020 2020 666f 7220 706f  ).        for po
+000067a0: 7274 2069 6e20 706f 7274 735f 6c69 7374  rt in ports_list
+000067b0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+000067c0: 696e 7428 706f 7274 290a 0a20 2020 2040  int(port)..    @
+000067d0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+000067e0: 206d 6574 6164 6174 615f 6368 696c 6428   metadata_child(
+000067f0: 7365 6c66 2920 2d3e 2044 6963 743a 0a20  self) -> Dict:. 
+00006800: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00006810: 7320 6d65 7461 6461 7461 2066 726f 6d20  s metadata from 
+00006820: 6368 696c 6420 6966 2061 6e79 2c20 4f74  child if any, Ot
+00006830: 6865 7277 6973 6520 7265 7475 726e 7320  herwise returns 
+00006840: 636f 6d70 6f6e 656e 7420 6f77 6e2e 0a0a  component own...
+00006850: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+00006860: 2047 7265 6174 2074 6f20 6163 6365 7373   Great to access
+00006870: 2074 6865 2063 6869 6c64 7265 6e20 6d65   the children me
+00006880: 7461 6461 7461 2061 7420 7468 6520 626f  tadata at the bo
+00006890: 7474 6f6d 206f 6620 7468 650a 2020 2020  ttom of the.    
+000068a0: 2020 2020 6869 6572 6172 6368 792e 0a20      hierarchy.. 
+000068b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000068c0: 2020 2073 6574 7469 6e67 7320 3d20 6469     settings = di
+000068d0: 6374 2873 656c 662e 7365 7474 696e 6773  ct(self.settings
+000068e0: 290a 0a20 2020 2020 2020 2077 6869 6c65  )..        while
+000068f0: 2073 6574 7469 6e67 732e 6765 7428 2263   settings.get("c
+00006900: 6869 6c64 2229 3a0a 2020 2020 2020 2020  hild"):.        
+00006910: 2020 2020 7365 7474 696e 6773 203d 2073      settings = s
+00006920: 6574 7469 6e67 732e 6765 7428 2263 6869  ettings.get("chi
+00006930: 6c64 2229 0a0a 2020 2020 2020 2020 7265  ld")..        re
+00006940: 7475 726e 2064 6963 7428 7365 7474 696e  turn dict(settin
+00006950: 6773 290a 0a20 2020 2040 7072 6f70 6572  gs)..    @proper
+00006960: 7479 0a20 2020 2064 6566 206d 6574 6164  ty.    def metad
+00006970: 6174 6128 7365 6c66 2920 2d3e 2044 6963  ata(self) -> Dic
+00006980: 743a 0a20 2020 2020 2020 2072 6574 7572  t:.        retur
+00006990: 6e20 6469 6374 2873 656c 662e 7365 7474  n dict(self.sett
+000069a0: 696e 6773 290a 0a20 2020 2064 6566 2061  ings)..    def a
+000069b0: 6464 5f70 6f72 7428 0a20 2020 2020 2020  dd_port(.       
+000069c0: 2073 656c 662c 0a20 2020 2020 2020 206e   self,.        n
+000069d0: 616d 653a 204f 7074 696f 6e61 6c5b 556e  ame: Optional[Un
+000069e0: 696f 6e5b 7374 722c 206f 626a 6563 745d  ion[str, object]
+000069f0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00006a00: 2020 6365 6e74 6572 3a20 4f70 7469 6f6e    center: Option
+00006a10: 616c 5b54 7570 6c65 5b66 6c6f 6174 2c20  al[Tuple[float, 
+00006a20: 666c 6f61 745d 5d20 3d20 4e6f 6e65 2c0a  float]] = None,.
+00006a30: 2020 2020 2020 2020 7769 6474 683a 204f          width: O
+00006a40: 7074 696f 6e61 6c5b 666c 6f61 745d 203d  ptional[float] =
+00006a50: 204e 6f6e 652c 0a20 2020 2020 2020 206f   None,.        o
+00006a60: 7269 656e 7461 7469 6f6e 3a20 4f70 7469  rientation: Opti
+00006a70: 6f6e 616c 5b66 6c6f 6174 5d20 3d20 4e6f  onal[float] = No
+00006a80: 6e65 2c0a 2020 2020 2020 2020 706f 7274  ne,.        port
+00006a90: 3a20 4f70 7469 6f6e 616c 5b50 6f72 745d  : Optional[Port]
+00006aa0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00006ab0: 206c 6179 6572 3a20 4f70 7469 6f6e 616c   layer: Optional
+00006ac0: 5b4c 6179 6572 5370 6563 5d20 3d20 4e6f  [LayerSpec] = No
+00006ad0: 6e65 2c0a 2020 2020 2020 2020 706f 7274  ne,.        port
+00006ae0: 5f74 7970 653a 204f 7074 696f 6e61 6c5b  _type: Optional[
+00006af0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00006b00: 2020 2020 2063 726f 7373 5f73 6563 7469       cross_secti
+00006b10: 6f6e 3a20 4f70 7469 6f6e 616c 5b43 726f  on: Optional[Cro
+00006b20: 7373 5365 6374 696f 6e5d 203d 204e 6f6e  ssSection] = Non
+00006b30: 652c 0a20 2020 2029 202d 3e20 506f 7274  e,.    ) -> Port
+00006b40: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
+00006b50: 2070 6f72 7420 746f 2063 6f6d 706f 6e65   port to compone
+00006b60: 6e74 2e0a 0a20 2020 2020 2020 2059 6f75  nt...        You
+00006b70: 2063 616e 2063 6f70 7920 616e 2065 7869   can copy an exi
+00006b80: 7374 696e 6720 706f 7274 206c 696b 6520  sting port like 
+00006b90: 6164 645f 706f 7274 2870 6f72 7420 3d20  add_port(port = 
+00006ba0: 6578 6973 7469 6e67 5f70 6f72 7429 206f  existing_port) o
+00006bb0: 720a 2020 2020 2020 2020 6372 6561 7465  r.        create
+00006bc0: 2061 206e 6577 2070 6f72 7420 6164 645f   a new port add_
+00006bd0: 706f 7274 286d 796e 616d 652c 206d 7963  port(myname, myc
+00006be0: 656e 7465 722c 206d 7977 6964 7468 2c20  enter, mywidth, 
+00006bf0: 6d79 6f72 6965 6e74 6174 696f 6e29 2e0a  myorientation)..
+00006c00: 2020 2020 2020 2020 596f 7520 6361 6e20          You can 
+00006c10: 616c 736f 2063 6f70 7920 616e 2065 7869  also copy an exi
+00006c20: 7374 696e 6720 706f 7274 0a20 2020 2020  sting port.     
+00006c30: 2020 2077 6974 6820 6120 6e65 7720 6e61     with a new na
+00006c40: 6d65 2061 6464 5f70 6f72 7428 706f 7274  me add_port(port
+00006c50: 203d 2065 7869 7374 696e 675f 706f 7274   = existing_port
+00006c60: 2c20 6e61 6d65 203d 206e 6577 5f6e 616d  , name = new_nam
+00006c70: 6529 0a0a 2020 2020 2020 2020 4172 6773  e)..        Args
+00006c80: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+00006c90: 6d65 3a20 706f 7274 206e 616d 652e 0a20  me: port name.. 
+00006ca0: 2020 2020 2020 2020 2020 2063 656e 7465             cente
+00006cb0: 723a 2078 2c20 792e 0a20 2020 2020 2020  r: x, y..       
+00006cc0: 2020 2020 2077 6964 7468 3a20 696e 2075       width: in u
+00006cd0: 6d2e 0a20 2020 2020 2020 2020 2020 206f  m..            o
+00006ce0: 7269 656e 7461 7469 6f6e 3a20 696e 2064  rientation: in d
+00006cf0: 6567 2e0a 2020 2020 2020 2020 2020 2020  eg..            
+00006d00: 706f 7274 3a20 6f70 7469 6f6e 616c 2070  port: optional p
+00006d10: 6f72 742e 0a20 2020 2020 2020 2020 2020  ort..           
+00006d20: 206c 6179 6572 3a20 706f 7274 206c 6179   layer: port lay
+00006d30: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
+00006d40: 706f 7274 5f74 7970 653a 206f 7074 6963  port_type: optic
+00006d50: 616c 2c20 656c 6563 7472 6963 616c 2c20  al, electrical, 
+00006d60: 7665 7274 6963 616c 5f64 632c 2076 6572  vertical_dc, ver
+00006d70: 7469 6361 6c5f 7465 2c20 7665 7274 6963  tical_te, vertic
+00006d80: 616c 5f74 6d2e 2044 6566 6175 6c74 7320  al_tm. Defaults 
+00006d90: 746f 206f 7074 6963 616c 2e0a 2020 2020  to optical..    
+00006da0: 2020 2020 2020 2020 6372 6f73 735f 7365          cross_se
+00006db0: 6374 696f 6e3a 2070 6f72 7420 6372 6f73  ction: port cros
+00006dc0: 735f 7365 6374 696f 6e2e 0a20 2020 2020  s_section..     
+00006dd0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00006de0: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
+00006df0: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
+00006e00: 7965 720a 0a20 2020 2020 2020 206c 6179  yer..        lay
+00006e10: 6572 203d 2067 6574 5f6c 6179 6572 286c  er = get_layer(l
+00006e20: 6179 6572 290a 0a20 2020 2020 2020 2069  ayer)..        i
+00006e30: 6620 706f 7274 3a0a 2020 2020 2020 2020  f port:.        
+00006e40: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00006e50: 7461 6e63 6528 706f 7274 2c20 506f 7274  tance(port, Port
+00006e60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00006e70: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00006e80: 726f 7228 6622 6164 645f 706f 7274 2829  ror(f"add_port()
+00006e90: 206e 6565 6473 2061 2050 6f72 742c 2067   needs a Port, g
+00006ea0: 6f74 207b 7479 7065 2870 6f72 7429 7d22  ot {type(port)}"
+00006eb0: 290a 2020 2020 2020 2020 2020 2020 7020  ).            p 
+00006ec0: 3d20 706f 7274 2e63 6f70 7928 290a 2020  = port.copy().  
+00006ed0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+00006ee0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00006ef0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00006f00: 2e6e 616d 6520 3d20 6e61 6d65 0a20 2020  .name = name.   
+00006f10: 2020 2020 2020 2020 2069 6620 6365 6e74           if cent
+00006f20: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0a  er is not None:.
+00006f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f40: 702e 6365 6e74 6572 203d 2063 656e 7465  p.center = cente
+00006f50: 720a 2020 2020 2020 2020 2020 2020 6966  r.            if
+00006f60: 2077 6964 7468 2069 7320 6e6f 7420 4e6f   width is not No
+00006f70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006f80: 2020 2020 702e 7769 6474 6820 3d20 7769      p.width = wi
+00006f90: 6474 680a 2020 2020 2020 2020 2020 2020  dth.            
+00006fa0: 6966 206f 7269 656e 7461 7469 6f6e 2069  if orientation i
+00006fb0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00006fc0: 2020 2020 2020 2020 2020 2020 702e 6f72              p.or
+00006fd0: 6965 6e74 6174 696f 6e20 3d20 6f72 6965  ientation = orie
+00006fe0: 6e74 6174 696f 6e0a 2020 2020 2020 2020  ntation.        
+00006ff0: 2020 2020 6966 2070 6f72 745f 7479 7065      if port_type
+00007000: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00007010: 2020 2020 2020 2020 2020 2020 2020 702e                p.
+00007020: 706f 7274 5f74 7970 6520 3d20 706f 7274  port_type = port
+00007030: 5f74 7970 650a 2020 2020 2020 2020 2020  _type.          
+00007040: 2020 6966 206c 6179 6572 2069 7320 6e6f    if layer is no
+00007050: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00007060: 2020 2020 2020 2020 702e 6c61 7965 7220          p.layer 
+00007070: 3d20 6c61 7965 720a 2020 2020 2020 2020  = layer.        
+00007080: 2020 2020 702e 7061 7265 6e74 203d 2073      p.parent = s
+00007090: 656c 660a 0a20 2020 2020 2020 2065 6c69  elf..        eli
+000070a0: 6620 6973 696e 7374 616e 6365 286e 616d  f isinstance(nam
+000070b0: 652c 2050 6f72 7429 3a0a 2020 2020 2020  e, Port):.      
+000070c0: 2020 2020 2020 7020 3d20 6e61 6d65 2e63        p = name.c
+000070d0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
+000070e0: 2020 702e 7061 7265 6e74 203d 2073 656c    p.parent = sel
+000070f0: 660a 2020 2020 2020 2020 2020 2020 6e61  f.            na
+00007100: 6d65 203d 2070 2e6e 616d 650a 2020 2020  me = p.name.    
+00007110: 2020 2020 656c 6966 2063 656e 7465 7220      elif center 
+00007120: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00007130: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00007140: 4572 726f 7228 2250 6f72 7420 6e65 6564  Error("Port need
+00007150: 7320 6365 6e74 6572 2070 6172 616d 6574  s center paramet
+00007160: 6572 2028 782c 2079 2920 756d 2e22 290a  er (x, y) um.").
+00007170: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00007180: 2020 2020 2020 2020 2020 2070 203d 2050             p = P
+00007190: 6f72 7428 0a20 2020 2020 2020 2020 2020  ort(.           
+000071a0: 2020 2020 206e 616d 653d 6e61 6d65 2c0a       name=name,.
+000071b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000071c0: 6365 6e74 6572 3d63 656e 7465 722c 0a20  center=center,. 
+000071d0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+000071e0: 6964 7468 3d77 6964 7468 2c0a 2020 2020  idth=width,.    
+000071f0: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
+00007200: 6e74 6174 696f 6e3d 6f72 6965 6e74 6174  ntation=orientat
+00007210: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00007220: 2020 2020 2070 6172 656e 743d 7365 6c66       parent=self
+00007230: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007240: 2020 6c61 7965 723d 6c61 7965 722c 0a20    layer=layer,. 
+00007250: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00007260: 6f72 745f 7479 7065 3d70 6f72 745f 7479  ort_type=port_ty
+00007270: 7065 206f 7220 226f 7074 6963 616c 222c  pe or "optical",
+00007280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007290: 2063 726f 7373 5f73 6563 7469 6f6e 3d63   cross_section=c
+000072a0: 726f 7373 5f73 6563 7469 6f6e 2c0a 2020  ross_section,.  
+000072b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000072c0: 2020 2020 6966 206e 616d 6520 6973 206e      if name is n
+000072d0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000072e0: 2020 2020 2070 2e6e 616d 6520 3d20 6e61       p.name = na
+000072f0: 6d65 0a20 2020 2020 2020 2069 6620 702e  me.        if p.
+00007300: 6e61 6d65 2069 6e20 7365 6c66 2e70 6f72  name in self.por
+00007310: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00007320: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00007330: 2866 2261 6464 5f70 6f72 7428 2920 506f  (f"add_port() Po
+00007340: 7274 206e 616d 6520 7b70 2e6e 616d 6521  rt name {p.name!
+00007350: 727d 2065 7869 7374 7320 696e 207b 7365  r} exists in {se
+00007360: 6c66 2e6e 616d 6521 727d 2229 0a0a 2020  lf.name!r}")..  
+00007370: 2020 2020 2020 7365 6c66 2e70 6f72 7473        self.ports
+00007380: 5b70 2e6e 616d 655d 203d 2070 0a20 2020  [p.name] = p.   
+00007390: 2020 2020 2072 6574 7572 6e20 700a 0a20       return p.. 
+000073a0: 2020 2064 6566 2061 6464 5f70 6f72 7473     def add_ports
+000073b0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+000073c0: 2020 2020 2020 2020 706f 7274 733a 2055          ports: U
+000073d0: 6e69 6f6e 5b4c 6973 745b 506f 7274 5d2c  nion[List[Port],
+000073e0: 2044 6963 745b 7374 722c 2050 6f72 745d   Dict[str, Port]
+000073f0: 5d2c 0a20 2020 2020 2020 2070 7265 6669  ],.        prefi
+00007400: 783a 2073 7472 203d 2022 222c 0a20 2020  x: str = "",.   
+00007410: 2020 2020 2073 7566 6669 783a 2073 7472       suffix: str
+00007420: 203d 2022 222c 0a20 2020 2020 2020 202a   = "",.        *
+00007430: 2a6b 7761 7267 732c 0a20 2020 2029 202d  *kwargs,.    ) -
+00007440: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00007450: 2222 2241 6464 2061 206c 6973 7420 6f72  """Add a list or
+00007460: 2064 6963 7420 6f66 2070 6f72 7473 2e0a   dict of ports..
+00007470: 0a20 2020 2020 2020 2079 6f75 2063 616e  .        you can
+00007480: 2069 6e63 6c75 6465 2061 2070 7265 6669   include a prefi
+00007490: 7820 746f 2061 6464 2074 6f20 7468 6520  x to add to the 
+000074a0: 6e65 7720 706f 7274 206e 616d 6573 2074  new port names t
+000074b0: 6f20 6176 6f69 6420 6e61 6d65 2063 6f6e  o avoid name con
+000074c0: 666c 6963 7473 2e0a 0a20 2020 2020 2020  flicts...       
+000074d0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000074e0: 2020 2070 6f72 7473 3a20 6c69 7374 206f     ports: list o
+000074f0: 7220 6469 6374 206f 6620 706f 7274 732e  r dict of ports.
+00007500: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00007510: 6669 783a 2074 6f20 7072 6570 656e 6420  fix: to prepend 
+00007520: 746f 2065 6163 6820 706f 7274 206e 616d  to each port nam
+00007530: 652e 0a20 2020 2020 2020 2020 2020 2073  e..            s
+00007540: 7566 6669 783a 2074 6f20 6170 7065 6e64  uffix: to append
+00007550: 2074 6f20 6561 6368 2070 6f72 7420 6e61   to each port na
+00007560: 6d65 2e0a 2020 2020 2020 2020 2222 220a  me..        """.
+00007570: 2020 2020 2020 2020 706f 7274 7320 3d20          ports = 
+00007580: 706f 7274 7320 6966 2069 7369 6e73 7461  ports if isinsta
+00007590: 6e63 6528 706f 7274 732c 206c 6973 7429  nce(ports, list)
+000075a0: 2065 6c73 6520 706f 7274 732e 7661 6c75   else ports.valu
+000075b0: 6573 2829 0a20 2020 2020 2020 2066 6f72  es().        for
+000075c0: 2070 6f72 7420 696e 206c 6973 7428 706f   port in list(po
+000075d0: 7274 7329 3a0a 2020 2020 2020 2020 2020  rts):.          
+000075e0: 2020 6e61 6d65 203d 2066 227b 7072 6566    name = f"{pref
+000075f0: 6978 7d7b 706f 7274 2e6e 616d 657d 7b73  ix}{port.name}{s
+00007600: 7566 6669 787d 220a 2020 2020 2020 2020  uffix}".        
+00007610: 2020 2020 7365 6c66 2e61 6464 5f70 6f72      self.add_por
+00007620: 7428 6e61 6d65 3d6e 616d 652c 2070 6f72  t(name=name, por
+00007630: 743d 706f 7274 2c20 2a2a 6b77 6172 6773  t=port, **kwargs
+00007640: 290a 0a20 2020 2064 6566 2073 6e61 705f  )..    def snap_
+00007650: 706f 7274 735f 746f 5f67 7269 6428 7365  ports_to_grid(se
+00007660: 6c66 2c20 6e6d 3a20 696e 7420 3d20 3129  lf, nm: int = 1)
+00007670: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00007680: 2020 666f 7220 706f 7274 2069 6e20 7365    for port in se
+00007690: 6c66 2e70 6f72 7473 2e76 616c 7565 7328  lf.ports.values(
+000076a0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+000076b0: 6f72 742e 736e 6170 5f74 6f5f 6772 6964  ort.snap_to_grid
+000076c0: 286e 6d3d 6e6d 290a 0a20 2020 2064 6566  (nm=nm)..    def
+000076d0: 2072 656d 6f76 655f 6c61 7965 7273 280a   remove_layers(.
+000076e0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000076f0: 2020 2020 2020 6c61 7965 7273 3a20 4c69        layers: Li
+00007700: 7374 5b4c 6179 6572 5370 6563 5d2c 0a20  st[LayerSpec],. 
+00007710: 2020 2020 2020 2069 6e63 6c75 6465 5f6c         include_l
+00007720: 6162 656c 733a 2062 6f6f 6c20 3d20 5472  abels: bool = Tr
+00007730: 7565 2c0a 2020 2020 2020 2020 696e 7665  ue,.        inve
+00007740: 7274 5f73 656c 6563 7469 6f6e 3a20 626f  rt_selection: bo
+00007750: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00007760: 2020 2020 7265 6375 7273 6976 653a 2062      recursive: b
+00007770: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
+00007780: 2920 2d3e 2043 6f6d 706f 6e65 6e74 3a0a  ) -> Component:.
+00007790: 2020 2020 2020 2020 2222 2252 656d 6f76          """Remov
+000077a0: 6520 6120 6c69 7374 206f 6620 6c61 7965  e a list of laye
+000077b0: 7273 2061 6e64 2072 6574 7572 6e73 2074  rs and returns t
+000077c0: 6865 2073 616d 6520 436f 6d70 6f6e 656e  he same Componen
+000077d0: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
+000077e0: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
+000077f0: 7965 7273 3a20 6c69 7374 206f 6620 6c61  yers: list of la
+00007800: 7965 7273 2074 6f20 7265 6d6f 7665 2e0a  yers to remove..
+00007810: 2020 2020 2020 2020 2020 2020 696e 636c              incl
+00007820: 7564 655f 6c61 6265 6c73 3a20 7265 6d6f  ude_labels: remo
+00007830: 7665 206c 6162 656c 7320 6f6e 2074 686f  ve labels on tho
+00007840: 7365 206c 6179 6572 732e 0a20 2020 2020  se layers..     
+00007850: 2020 2020 2020 2069 6e76 6572 745f 7365         invert_se
+00007860: 6c65 6374 696f 6e3a 2072 656d 6f76 6573  lection: removes
+00007870: 2061 6c6c 206c 6179 6572 7320 6578 6365   all layers exce
+00007880: 7074 206c 6179 6572 7320 7370 6563 6966  pt layers specif
+00007890: 6965 642e 0a20 2020 2020 2020 2020 2020  ied..           
+000078a0: 2072 6563 7572 7369 7665 3a20 6f70 6572   recursive: oper
+000078b0: 6174 6520 6f6e 2074 6865 2063 656c 6c73  ate on the cells
+000078c0: 2069 6e63 6c75 6465 6420 696e 2074 6869   included in thi
+000078d0: 7320 6365 6c6c 2e0a 2020 2020 2020 2020  s cell..        
+000078e0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+000078f0: 2067 6473 6661 6374 6f72 7920 696d 706f   gdsfactory impo
+00007900: 7274 2067 6574 5f6c 6179 6572 0a0a 2020  rt get_layer..  
+00007910: 2020 2020 2020 636f 6d70 6f6e 656e 7420        component 
+00007920: 3d20 7365 6c66 2e66 6c61 7474 656e 2829  = self.flatten()
+00007930: 2069 6620 7265 6375 7273 6976 6520 616e   if recursive an
+00007940: 6420 7365 6c66 2e72 6566 6572 656e 6365  d self.reference
+00007950: 7320 656c 7365 2073 656c 660a 2020 2020  s else self.    
+00007960: 2020 2020 6c61 7965 7273 203d 205b 6765      layers = [ge
+00007970: 745f 6c61 7965 7228 6c61 7965 7229 2066  t_layer(layer) f
+00007980: 6f72 206c 6179 6572 2069 6e20 6c61 7965  or layer in laye
+00007990: 7273 5d0a 0a20 2020 2020 2020 2073 686f  rs]..        sho
+000079a0: 756c 645f 7265 6d6f 7665 203d 206e 6f74  uld_remove = not
+000079b0: 2069 6e76 6572 745f 7365 6c65 6374 696f   invert_selectio
+000079c0: 6e0a 2020 2020 2020 2020 636f 6d70 6f6e  n.        compon
+000079d0: 656e 742e 5f63 656c 6c2e 6669 6c74 6572  ent._cell.filter
+000079e0: 280a 2020 2020 2020 2020 2020 2020 7370  (.            sp
+000079f0: 6563 3d6c 6179 6572 732c 0a20 2020 2020  ec=layers,.     
+00007a00: 2020 2020 2020 2072 656d 6f76 653d 7368         remove=sh
+00007a10: 6f75 6c64 5f72 656d 6f76 652c 0a20 2020  ould_remove,.   
+00007a20: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00007a30: 733d 5472 7565 2c0a 2020 2020 2020 2020  s=True,.        
+00007a40: 2020 2020 7061 7468 733d 5472 7565 2c0a      paths=True,.
+00007a50: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
+00007a60: 6c73 3d69 6e63 6c75 6465 5f6c 6162 656c  ls=include_label
+00007a70: 732c 0a20 2020 2020 2020 2029 0a20 2020  s,.        ).   
+00007a80: 2020 2020 2072 6574 7572 6e20 636f 6d70       return comp
+00007a90: 6f6e 656e 740a 0a20 2020 2064 6566 2065  onent..    def e
+00007aa0: 7874 7261 6374 280a 2020 2020 2020 2020  xtract(.        
+00007ab0: 7365 6c66 2c0a 2020 2020 2020 2020 6c61  self,.        la
+00007ac0: 7965 7273 3a20 4c69 7374 5b55 6e69 6f6e  yers: List[Union
+00007ad0: 5b54 7570 6c65 5b69 6e74 2c20 696e 745d  [Tuple[int, int]
+00007ae0: 2c20 7374 725d 5d2c 0a20 2020 2029 202d  , str]],.    ) -
+00007af0: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
+00007b00: 2020 2020 2022 2222 4578 7472 6163 7420       """Extract 
+00007b10: 706f 6c79 676f 6e73 2066 726f 6d20 6120  polygons from a 
+00007b20: 436f 6d70 6f6e 656e 7420 616e 6420 7265  Component and re
+00007b30: 7475 726e 7320 6120 6e65 7720 436f 6d70  turns a new Comp
+00007b40: 6f6e 656e 742e 2222 220a 2020 2020 2020  onent.""".      
+00007b50: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+00007b60: 792e 7064 6b20 696d 706f 7274 2067 6574  y.pdk import get
+00007b70: 5f6c 6179 6572 0a0a 2020 2020 2020 2020  _layer..        
+00007b80: 6966 2074 7970 6528 6c61 7965 7273 2920  if type(layers) 
+00007b90: 6e6f 7420 696e 2028 6c69 7374 2c20 7475  not in (list, tu
+00007ba0: 706c 6529 3a0a 2020 2020 2020 2020 2020  ple):.          
+00007bb0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00007bc0: 6f72 2866 226c 6179 6572 7320 7b6c 6179  or(f"layers {lay
+00007bd0: 6572 7321 727d 206e 6565 6473 2074 6f20  ers!r} needs to 
+00007be0: 6265 2061 206c 6973 7420 6f72 2074 7570  be a list or tup
+00007bf0: 6c65 2229 0a0a 2020 2020 2020 2020 6c61  le")..        la
+00007c00: 7965 7273 203d 205b 6765 745f 6c61 7965  yers = [get_laye
+00007c10: 7228 6c61 7965 7229 2066 6f72 206c 6179  r(layer) for lay
+00007c20: 6572 2069 6e20 6c61 7965 7273 5d0a 2020  er in layers].  
+00007c30: 2020 2020 2020 2320 636f 6d70 6f6e 656e        # componen
+00007c40: 7420 3d20 7365 6c66 2e63 6f70 7928 290a  t = self.copy().
+00007c50: 2020 2020 2020 2020 2320 636f 6d70 6f6e          # compon
+00007c60: 656e 742e 5f63 656c 6c2e 6669 6c74 6572  ent._cell.filter
+00007c70: 2873 7065 633d 6c61 7965 7273 2c20 7265  (spec=layers, re
+00007c80: 6d6f 7665 3d46 616c 7365 290a 0a20 2020  move=False)..   
+00007c90: 2020 2020 2063 6f6d 706f 6e65 6e74 203d       component =
+00007ca0: 2043 6f6d 706f 6e65 6e74 2829 0a20 2020   Component().   
+00007cb0: 2020 2020 2070 6f6c 795f 6469 6374 203d       poly_dict =
+00007cc0: 2073 656c 662e 6765 745f 706f 6c79 676f   self.get_polygo
+00007cd0: 6e73 2862 795f 7370 6563 3d54 7275 652c  ns(by_spec=True,
+00007ce0: 2069 6e63 6c75 6465 5f70 6174 6873 3d46   include_paths=F
+00007cf0: 616c 7365 290a 0a20 2020 2020 2020 2066  alse)..        f
+00007d00: 6f72 206c 6179 6572 2069 6e20 6c61 7965  or layer in laye
+00007d10: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00007d20: 6966 206c 6179 6572 2069 6e20 706f 6c79  if layer in poly
+00007d30: 5f64 6963 743a 0a20 2020 2020 2020 2020  _dict:.         
+00007d40: 2020 2020 2020 2070 6f6c 7967 6f6e 7320         polygons 
+00007d50: 3d20 706f 6c79 5f64 6963 745b 6c61 7965  = poly_dict[laye
+00007d60: 725d 0a20 2020 2020 2020 2020 2020 2020  r].             
+00007d70: 2020 2066 6f72 2070 6f6c 7967 6f6e 2069     for polygon i
+00007d80: 6e20 706f 6c79 676f 6e73 3a0a 2020 2020  n polygons:.    
+00007d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007da0: 636f 6d70 6f6e 656e 742e 6164 645f 706f  component.add_po
+00007db0: 6c79 676f 6e28 706f 6c79 676f 6e2c 206c  lygon(polygon, l
+00007dc0: 6179 6572 290a 0a20 2020 2020 2020 2066  ayer)..        f
+00007dd0: 6f72 206c 6179 6572 2069 6e20 6c61 7965  or layer in laye
+00007de0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00007df0: 666f 7220 7061 7468 2069 6e20 7365 6c66  for path in self
+00007e00: 2e5f 6365 6c6c 2e67 6574 5f70 6174 6873  ._cell.get_paths
+00007e10: 286c 6179 6572 3d6c 6179 6572 293a 0a20  (layer=layer):. 
+00007e20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00007e30: 6f6d 706f 6e65 6e74 2e61 6464 2870 6174  omponent.add(pat
+00007e40: 6829 0a0a 2020 2020 2020 2020 7265 7475  h)..        retu
+00007e50: 726e 2063 6f6d 706f 6e65 6e74 0a0a 2020  rn component..  
+00007e60: 2020 6465 6620 6164 645f 706f 6c79 676f    def add_polygo
+00007e70: 6e28 7365 6c66 2c20 706f 696e 7473 2c20  n(self, points, 
+00007e80: 6c61 7965 723d 6e70 2e6e 616e 293a 0a20  layer=np.nan):. 
+00007e90: 2020 2020 2020 2022 2222 4164 6473 2061         """Adds a
+00007ea0: 2050 6f6c 7967 6f6e 2074 6f20 7468 6520   Polygon to the 
+00007eb0: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+00007ec0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00007ed0: 2020 2020 2020 706f 696e 7473 3a20 436f        points: Co
+00007ee0: 6f72 6469 6e61 7465 7320 6f66 2074 6865  ordinates of the
+00007ef0: 2076 6572 7469 6365 7320 6f66 2074 6865   vertices of the
+00007f00: 2050 6f6c 7967 6f6e 2e0a 2020 2020 2020   Polygon..      
+00007f10: 2020 2020 2020 6c61 7965 723a 206c 6179        layer: lay
+00007f20: 6572 2073 7065 6320 746f 2061 6464 2070  er spec to add p
+00007f30: 6f6c 7967 6f6e 206f 6e2e 0a20 2020 2020  olygon on..     
+00007f40: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00007f50: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
+00007f60: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
+00007f70: 7965 720a 0a20 2020 2020 2020 206c 6179  yer..        lay
+00007f80: 6572 203d 2067 6574 5f6c 6179 6572 286c  er = get_layer(l
+00007f90: 6179 6572 290a 0a20 2020 2020 2020 2069  ayer)..        i
+00007fa0: 6620 6c61 7965 7220 6973 204e 6f6e 653a  f layer is None:
+00007fb0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00007fc0: 7572 6e20 4e6f 6e65 0a0a 2020 2020 2020  urn None..      
+00007fd0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00007fe0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00007ff0: 286c 6179 6572 2c20 7365 7429 3a0a 2020  (layer, set):.  
+00008000: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00008010: 7475 726e 205b 7365 6c66 2e61 6464 5f70  turn [self.add_p
+00008020: 6f6c 7967 6f6e 2870 6f69 6e74 732c 206c  olygon(points, l
+00008030: 7929 2066 6f72 206c 7920 696e 206c 6179  y) for ly in lay
+00008040: 6572 5d0a 2020 2020 2020 2020 2020 2020  er].            
+00008050: 656c 6966 2061 6c6c 2869 7369 6e73 7461  elif all(isinsta
+00008060: 6e63 6528 6c79 2c20 284c 6179 6572 2929  nce(ly, (Layer))
 00008070: 2066 6f72 206c 7920 696e 206c 6179 6572   for ly in layer
-00008080: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-00008090: 6966 2061 6c6c 2869 7369 6e73 7461 6e63  if all(isinstanc
-000080a0: 6528 6c79 2c20 284c 6179 6572 2929 2066  e(ly, (Layer)) f
-000080b0: 6f72 206c 7920 696e 206c 6179 6572 293a  or ly in layer):
-000080c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000080d0: 2072 6574 7572 6e20 5b73 656c 662e 6164   return [self.ad
-000080e0: 645f 706f 6c79 676f 6e28 706f 696e 7473  d_polygon(points
-000080f0: 2c20 6c79 2920 666f 7220 6c79 2069 6e20  , ly) for ly in 
-00008100: 6c61 7965 725d 0a20 2020 2020 2020 2020  layer].         
-00008110: 2020 2065 6c69 6620 6c65 6e28 6c61 7965     elif len(laye
-00008120: 7229 203e 2032 3a20 2023 2053 6f6d 656f  r) > 2:  # Someo
-00008130: 6e65 2077 726f 7465 2065 2e67 2e20 6c61  ne wrote e.g. la
-00008140: 7965 7220 3d20 5b31 2c34 2c35 5d0a 2020  yer = [1,4,5].  
-00008150: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00008160: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00008080: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00008090: 2020 2072 6574 7572 6e20 5b73 656c 662e     return [self.
+000080a0: 6164 645f 706f 6c79 676f 6e28 706f 696e  add_polygon(poin
+000080b0: 7473 2c20 6c79 2920 666f 7220 6c79 2069  ts, ly) for ly i
+000080c0: 6e20 6c61 7965 725d 0a20 2020 2020 2020  n layer].       
+000080d0: 2020 2020 2065 6c69 6620 6c65 6e28 6c61       elif len(la
+000080e0: 7965 7229 203e 2032 3a20 2023 2053 6f6d  yer) > 2:  # Som
+000080f0: 656f 6e65 2077 726f 7465 2065 2e67 2e20  eone wrote e.g. 
+00008100: 6c61 7965 7220 3d20 5b31 2c34 2c35 5d0a  layer = [1,4,5].
+00008110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008120: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00008130: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008140: 2020 2020 2020 2222 2220 5b50 4849 444c        """ [PHIDL
+00008150: 5d20 4966 2073 7065 6369 6679 696e 6720  ] If specifying 
+00008160: 6d75 6c74 6970 6c65 206c 6179 6572 730a  multiple layers.
 00008170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008180: 2020 2020 2222 2220 5b50 4849 444c 5d20      """ [PHIDL] 
-00008190: 4966 2073 7065 6369 6679 696e 6720 6d75  If specifying mu
-000081a0: 6c74 6970 6c65 206c 6179 6572 730a 2020  ltiple layers.  
-000081b0: 2020 2020 2020 2020 2020 2020 2020 796f                yo
-000081c0: 7520 6d75 7374 2075 7365 2073 6574 206e  u must use set n
-000081d0: 6f74 6174 696f 6e2c 2065 2e67 2e20 7b31  otation, e.g. {1
-000081e0: 2c35 2c38 7d20 2222 220a 2020 2020 2020  ,5,8} """.      
-000081f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00008200: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00008210: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00008220: 2020 7061 7373 0a0a 2020 2020 2020 2020    pass..        
-00008230: 6966 2069 7369 6e73 7461 6e63 6528 706f  if isinstance(po
-00008240: 696e 7473 2c20 6764 7374 6b2e 506f 6c79  ints, gdstk.Poly
-00008250: 676f 6e29 3a0a 2020 2020 2020 2020 2020  gon):.          
-00008260: 2020 2320 6966 206c 6179 6572 2069 7320    # if layer is 
-00008270: 756e 7370 6563 6966 6965 6420 6f72 206d  unspecified or m
-00008280: 6174 6368 6573 206f 7269 6769 6e61 6c20  atches original 
-00008290: 706f 6c79 676f 6e2c 206a 7573 7420 6164  polygon, just ad
-000082a0: 6420 6974 2061 732d 6973 0a20 2020 2020  d it as-is.     
-000082b0: 2020 2020 2020 2070 6f6c 7967 6f6e 203d         polygon =
-000082c0: 2070 6f69 6e74 730a 2020 2020 2020 2020   points.        
-000082d0: 2020 2020 6966 206c 6179 6572 2069 7320      if layer is 
-000082e0: 6e70 2e6e 616e 206f 7220 280a 2020 2020  np.nan or (.    
-000082f0: 2020 2020 2020 2020 2020 2020 6973 696e              isin
-00008300: 7374 616e 6365 286c 6179 6572 2c20 7475  stance(layer, tu
-00008310: 706c 6529 2061 6e64 2028 706f 6c79 676f  ple) and (polygo
-00008320: 6e2e 6c61 7965 722c 2070 6f6c 7967 6f6e  n.layer, polygon
-00008330: 2e64 6174 6174 7970 6529 203d 3d20 6c61  .datatype) == la
-00008340: 7965 720a 2020 2020 2020 2020 2020 2020  yer.            
-00008350: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00008360: 2020 2070 6f6c 7967 6f6e 203d 2050 6f6c     polygon = Pol
-00008370: 7967 6f6e 2870 6f6c 7967 6f6e 2e70 6f69  ygon(polygon.poi
-00008380: 6e74 732c 2070 6f6c 7967 6f6e 2e6c 6179  nts, polygon.lay
-00008390: 6572 2c20 706f 6c79 676f 6e2e 6461 7461  er, polygon.data
-000083a0: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
-000083b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000083c0: 2020 2020 2020 2020 6c61 7965 722c 2064          layer, d
-000083d0: 6174 6174 7970 6520 3d20 5f70 6172 7365  atatype = _parse
-000083e0: 5f6c 6179 6572 286c 6179 6572 290a 2020  _layer(layer).  
-000083f0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00008400: 6c79 676f 6e20 3d20 506f 6c79 676f 6e28  lygon = Polygon(
-00008410: 706f 6c79 676f 6e2e 706f 696e 7473 2c20  polygon.points, 
-00008420: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
-00008430: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008440: 662e 5f61 6464 5f70 6f6c 7967 6f6e 7328  f._add_polygons(
-00008450: 706f 6c79 676f 6e29 0a20 2020 2020 2020  polygon).       
-00008460: 2020 2020 2072 6574 7572 6e20 706f 6c79       return poly
-00008470: 676f 6e0a 0a20 2020 2020 2020 2065 6c69  gon..        eli
-00008480: 6620 6861 7361 7474 7228 706f 696e 7473  f hasattr(points
-00008490: 2c20 2267 656f 6d73 2229 3a0a 2020 2020  , "geoms"):.    
-000084a0: 2020 2020 2020 2020 666f 7220 6765 6f6d          for geom
-000084b0: 2069 6e20 706f 696e 7473 2e67 656f 6d73   in points.geoms
-000084c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000084d0: 2020 706f 6c79 676f 6e20 3d20 7365 6c66    polygon = self
-000084e0: 2e61 6464 5f70 6f6c 7967 6f6e 2867 656f  .add_polygon(geo
-000084f0: 6d2c 206c 6179 6572 3d6c 6179 6572 290a  m, layer=layer).
-00008500: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008510: 726e 2070 6f6c 7967 6f6e 0a20 2020 2020  rn polygon.     
-00008520: 2020 2065 6c69 6620 6861 7361 7474 7228     elif hasattr(
-00008530: 706f 696e 7473 2c20 2265 7874 6572 696f  points, "exterio
-00008540: 7222 293a 2020 2320 706f 696e 7473 2069  r"):  # points i
-00008550: 7320 6120 7368 6170 656c 7920 506f 6c79  s a shapely Poly
-00008560: 676f 6e0a 2020 2020 2020 2020 2020 2020  gon.            
-00008570: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
-00008580: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
-00008590: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-000085a0: 2020 706f 696e 7473 5f6f 6e5f 6772 6964    points_on_grid
-000085b0: 203d 206e 702e 726f 756e 6428 706f 696e   = np.round(poin
-000085c0: 7473 2e65 7874 6572 696f 722e 636f 6f72  ts.exterior.coor
-000085d0: 6473 2c20 3329 0a20 2020 2020 2020 2020  ds, 3).         
-000085e0: 2020 2070 6f6c 7967 6f6e 203d 2067 6473     polygon = gds
-000085f0: 746b 2e50 6f6c 7967 6f6e 2870 6f69 6e74  tk.Polygon(point
-00008600: 735f 6f6e 5f67 7269 642c 206c 6179 6572  s_on_grid, layer
-00008610: 2c20 6461 7461 7479 7065 290a 0a20 2020  , datatype)..   
-00008620: 2020 2020 2020 2020 2069 6620 706f 696e           if poin
-00008630: 7473 2e69 6e74 6572 696f 7273 3a0a 2020  ts.interiors:.  
-00008640: 2020 2020 2020 2020 2020 2020 2020 6672                fr
-00008650: 6f6d 2073 6861 7065 6c79 2069 6d70 6f72  om shapely impor
-00008660: 7420 6765 745f 636f 6f72 6469 6e61 7465  t get_coordinate
-00008670: 730a 0a20 2020 2020 2020 2020 2020 2020  s..             
-00008680: 2020 2070 6f69 6e74 735f 6f6e 5f67 7269     points_on_gri
-00008690: 645f 696e 7465 7269 6f72 203d 206e 702e  d_interior = np.
-000086a0: 726f 756e 6428 6765 745f 636f 6f72 6469  round(get_coordi
-000086b0: 6e61 7465 7328 706f 696e 7473 2e69 6e74  nates(points.int
-000086c0: 6572 696f 7273 292c 2033 290a 2020 2020  eriors), 3).    
-000086d0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-000086e0: 676f 6e5f 696e 7465 7269 6f72 203d 2067  gon_interior = g
-000086f0: 6473 746b 2e50 6f6c 7967 6f6e 280a 2020  dstk.Polygon(.  
-00008700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008710: 2020 706f 696e 7473 5f6f 6e5f 6772 6964    points_on_grid
-00008720: 5f69 6e74 6572 696f 722c 206c 6179 6572  _interior, layer
-00008730: 2c20 6461 7461 7479 7065 0a20 2020 2020  , datatype.     
-00008740: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00008750: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
-00008760: 7967 6f6e 7320 3d20 6764 7374 6b2e 626f  ygons = gdstk.bo
-00008770: 6f6c 6561 6e28 0a20 2020 2020 2020 2020  olean(.         
-00008780: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00008790: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-000087a0: 2020 2020 2020 2020 706f 6c79 676f 6e5f          polygon_
-000087b0: 696e 7465 7269 6f72 2c0a 2020 2020 2020  interior,.      
-000087c0: 2020 2020 2020 2020 2020 2020 2020 6f70                op
-000087d0: 6572 6174 696f 6e3d 226e 6f74 222c 0a20  eration="not",. 
-000087e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087f0: 2020 206c 6179 6572 3d6c 6179 6572 2c0a     layer=layer,.
-00008800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008810: 2020 2020 6461 7461 7479 7065 3d64 6174      datatype=dat
-00008820: 6174 7970 652c 0a20 2020 2020 2020 2020  atype,.         
-00008830: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00008840: 2020 2020 2020 2020 2066 6f72 2070 6f6c           for pol
-00008850: 7967 6f6e 2069 6e20 706f 6c79 676f 6e73  ygon in polygons
-00008860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008870: 2020 2020 2020 7365 6c66 2e5f 6164 645f        self._add_
-00008880: 706f 6c79 676f 6e73 2870 6f6c 7967 6f6e  polygons(polygon
-00008890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000088a0: 2020 7265 7475 726e 2070 6f6c 7967 6f6e    return polygon
-000088b0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000088c0: 6c66 2e5f 6164 645f 706f 6c79 676f 6e73  lf._add_polygons
-000088d0: 2870 6f6c 7967 6f6e 290a 2020 2020 2020  (polygon).      
-000088e0: 2020 2020 2020 7265 7475 726e 2070 6f6c        return pol
-000088f0: 7967 6f6e 0a0a 2020 2020 2020 2020 706f  ygon..        po
-00008900: 696e 7473 203d 206e 702e 6173 6172 7261  ints = np.asarra
-00008910: 7928 706f 696e 7473 290a 2020 2020 2020  y(points).      
-00008920: 2020 6966 2070 6f69 6e74 732e 6e64 696d    if points.ndim
-00008930: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00008940: 2020 2072 6574 7572 6e20 5b73 656c 662e     return [self.
-00008950: 6164 645f 706f 6c79 676f 6e28 706f 6c79  add_polygon(poly
-00008960: 2c20 6c61 7965 723d 6c61 7965 7229 2066  , layer=layer) f
-00008970: 6f72 2070 6f6c 7920 696e 2070 6f69 6e74  or poly in point
-00008980: 735d 0a20 2020 2020 2020 2069 6620 6c61  s].        if la
-00008990: 7965 7220 6973 206e 702e 6e61 6e3a 0a20  yer is np.nan:. 
-000089a0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-000089b0: 203d 2030 0a0a 2020 2020 2020 2020 6966   = 0..        if
-000089c0: 2070 6f69 6e74 732e 6e64 696d 203d 3d20   points.ndim == 
-000089d0: 323a 0a20 2020 2020 2020 2020 2020 2023  2:.            #
-000089e0: 2061 6464 2073 696e 676c 6520 706f 6c79   add single poly
-000089f0: 676f 6e20 6672 6f6d 2070 6f69 6e74 730a  gon from points.
-00008a00: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00008a10: 656e 2870 6f69 6e74 735b 305d 2920 3e20  en(points[0]) > 
-00008a20: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00008a30: 2020 2023 2043 6f6e 7665 7274 2074 6f20     # Convert to 
-00008a40: 666f 726d 205b 5b31 2c32 5d2c 5b33 2c34  form [[1,2],[3,4
-00008a50: 5d2c 5b35 2c36 5d5d 0a20 2020 2020 2020  ],[5,6]].       
-00008a60: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
-00008a70: 3d20 6e70 2e63 6f6c 756d 6e5f 7374 6163  = np.column_stac
-00008a80: 6b28 706f 696e 7473 290a 2020 2020 2020  k(points).      
-00008a90: 2020 2020 2020 6c61 7965 722c 2064 6174        layer, dat
-00008aa0: 6174 7970 6520 3d20 5f70 6172 7365 5f6c  atype = _parse_l
-00008ab0: 6179 6572 286c 6179 6572 290a 2020 2020  ayer(layer).    
-00008ac0: 2020 2020 2020 2020 706f 6c79 676f 6e20          polygon 
-00008ad0: 3d20 506f 6c79 676f 6e28 706f 696e 7473  = Polygon(points
-00008ae0: 2c20 6c61 7965 723d 6c61 7965 722c 2064  , layer=layer, d
-00008af0: 6174 6174 7970 653d 6461 7461 7479 7065  atatype=datatype
-00008b00: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00008b10: 6c66 2e5f 6164 645f 706f 6c79 676f 6e73  lf._add_polygons
-00008b20: 2870 6f6c 7967 6f6e 290a 2020 2020 2020  (polygon).      
-00008b30: 2020 2020 2020 7265 7475 726e 2070 6f6c        return pol
-00008b40: 7967 6f6e 0a20 2020 2020 2020 2065 6c69  ygon.        eli
-00008b50: 6620 706f 696e 7473 2e6e 6469 6d20 3d3d  f points.ndim ==
-00008b60: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
-00008b70: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
-00008b80: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
-00008b90: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-00008ba0: 2020 706f 6c79 676f 6e73 203d 205b 0a20    polygons = [. 
-00008bb0: 2020 2020 2020 2020 2020 2020 2020 2050                 P
-00008bc0: 6f6c 7967 6f6e 2870 706f 696e 7473 2c20  olygon(ppoints, 
-00008bd0: 6c61 7965 723d 6c61 7965 722c 2064 6174  layer=layer, dat
-00008be0: 6174 7970 653d 6461 7461 7479 7065 2920  atype=datatype) 
-00008bf0: 666f 7220 7070 6f69 6e74 7320 696e 2070  for ppoints in p
-00008c00: 6f69 6e74 730a 2020 2020 2020 2020 2020  oints.          
-00008c10: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
-00008c20: 7365 6c66 2e5f 6164 645f 706f 6c79 676f  self._add_polygo
-00008c30: 6e73 282a 706f 6c79 676f 6e73 290a 2020  ns(*polygons).  
-00008c40: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00008c50: 2070 6f6c 7967 6f6e 730a 2020 2020 2020   polygons.      
-00008c60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00008c70: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00008c80: 7272 6f72 2866 2255 6e61 626c 6520 746f  rror(f"Unable to
-00008c90: 2061 6464 207b 706f 696e 7473 2e6e 6469   add {points.ndi
-00008ca0: 6d7d 2d64 696d 656e 7369 6f6e 616c 2070  m}-dimensional p
-00008cb0: 6f69 6e74 7320 6f62 6a65 6374 2229 0a0a  oints object")..
-00008cc0: 2020 2020 6465 6620 5f61 6464 5f70 6f6c      def _add_pol
-00008cd0: 7967 6f6e 7328 7365 6c66 2c20 2a70 6f6c  ygons(self, *pol
-00008ce0: 7967 6f6e 733a 204c 6973 745b 506f 6c79  ygons: List[Poly
-00008cf0: 676f 6e5d 2920 2d3e 204e 6f6e 653a 0a20  gon]) -> None:. 
-00008d00: 2020 2020 2020 2073 656c 662e 6973 5f75         self.is_u
-00008d10: 6e6c 6f63 6b65 6428 290a 2020 2020 2020  nlocked().      
-00008d20: 2020 7365 6c66 2e5f 6365 6c6c 2e61 6464    self._cell.add
-00008d30: 282a 706f 6c79 676f 6e73 290a 0a20 2020  (*polygons)..   
-00008d40: 2064 6566 2063 6f70 7928 7365 6c66 2920   def copy(self) 
-00008d50: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-00008d60: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
-00008d70: 7928 7365 6c66 290a 0a20 2020 2064 6566  y(self)..    def
-00008d80: 2061 6464 5f72 6566 5f63 6f6e 7461 696e   add_ref_contain
-00008d90: 6572 2873 656c 662c 2063 6f6d 706f 6e65  er(self, compone
-00008da0: 6e74 3a20 436f 6d70 6f6e 656e 7429 202d  nt: Component) -
-00008db0: 3e20 436f 6d70 6f6e 656e 7452 6566 6572  > ComponentRefer
-00008dc0: 656e 6365 3a0a 2020 2020 2020 2020 2222  ence:.        ""
-00008dd0: 2241 6464 2072 6566 6572 656e 6365 2c20  "Add reference, 
-00008de0: 706f 7274 7320 616e 6420 636f 7079 5f63  ports and copy_c
-00008df0: 6869 6c64 5f69 6e66 6f2e 2222 220a 2020  hild_info.""".  
-00008e00: 2020 2020 2020 7265 6620 3d20 7365 6c66        ref = self
-00008e10: 203c 3c20 636f 6d70 6f6e 656e 740a 2020   << component.  
-00008e20: 2020 2020 2020 7365 6c66 2e61 6464 5f70        self.add_p
-00008e30: 6f72 7473 2872 6566 2e70 6f72 7473 290a  orts(ref.ports).
-00008e40: 2020 2020 2020 2020 7365 6c66 2e63 6f70          self.cop
-00008e50: 795f 6368 696c 645f 696e 666f 2863 6f6d  y_child_info(com
-00008e60: 706f 6e65 6e74 290a 2020 2020 2020 2020  ponent).        
-00008e70: 7265 7475 726e 2072 6566 0a0a 2020 2020  return ref..    
-00008e80: 6465 6620 636f 7079 5f63 6869 6c64 5f69  def copy_child_i
-00008e90: 6e66 6f28 7365 6c66 2c20 636f 6d70 6f6e  nfo(self, compon
-00008ea0: 656e 743a 2043 6f6d 706f 6e65 6e74 2920  ent: Component) 
-00008eb0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00008ec0: 2022 2222 436f 7079 2061 6e64 2073 6574   """Copy and set
-00008ed0: 7469 6e67 7320 696e 666f 2066 726f 6d20  tings info from 
-00008ee0: 6368 696c 6420 636f 6d70 6f6e 656e 7420  child component 
-00008ef0: 696e 746f 2070 6172 656e 742e 0a0a 2020  into parent...  
-00008f00: 2020 2020 2020 5061 7265 6e74 2063 6f6d        Parent com
-00008f10: 706f 6e65 6e74 7320 6361 6e20 6163 6365  ponents can acce
-00008f20: 7373 2063 6869 6c64 2063 656c 6c73 2073  ss child cells s
-00008f30: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
-00008f40: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00008f50: 6e6f 7420 6973 696e 7374 616e 6365 2863  not isinstance(c
-00008f60: 6f6d 706f 6e65 6e74 2c20 2843 6f6d 706f  omponent, (Compo
-00008f70: 6e65 6e74 2c20 436f 6d70 6f6e 656e 7452  nent, ComponentR
-00008f80: 6566 6572 656e 6365 2929 3a0a 2020 2020  eference)):.    
-00008f90: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00008fa0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00008fb0: 2020 2020 2020 2020 2020 6622 7b74 7970            f"{typ
-00008fc0: 6528 636f 6d70 6f6e 656e 7429 7d22 2022  e(component)}" "
-00008fd0: 6973 206e 6f74 2061 2043 6f6d 706f 6e65  is not a Compone
-00008fe0: 6e74 206f 7220 436f 6d70 6f6e 656e 7452  nt or ComponentR
-00008ff0: 6566 6572 656e 6365 220a 2020 2020 2020  eference".      
-00009000: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00009010: 2073 656c 662e 6765 745f 6368 696c 645f   self.get_child_
-00009020: 6e61 6d65 203d 2054 7275 650a 2020 2020  name = True.    
-00009030: 2020 2020 7365 6c66 2e63 6869 6c64 203d      self.child =
-00009040: 2063 6f6d 706f 6e65 6e74 0a20 2020 2020   component.     
-00009050: 2020 2073 656c 662e 696e 666f 2e75 7064     self.info.upd
-00009060: 6174 6528 636f 6d70 6f6e 656e 742e 696e  ate(component.in
-00009070: 666f 290a 2020 2020 2020 2020 7365 6c66  fo).        self
-00009080: 2e73 6574 7469 6e67 732e 7570 6461 7465  .settings.update
-00009090: 2863 6f6d 706f 6e65 6e74 2e73 6574 7469  (component.setti
-000090a0: 6e67 7329 0a0a 2020 2020 4070 726f 7065  ngs)..    @prope
-000090b0: 7274 790a 2020 2020 6465 6620 7369 7a65  rty.    def size
-000090c0: 5f69 6e66 6f28 7365 6c66 2920 2d3e 2053  _info(self) -> S
-000090d0: 697a 6549 6e66 6f3a 0a20 2020 2020 2020  izeInfo:.       
-000090e0: 2022 2222 5369 7a65 2069 6e66 6f20 6f66   """Size info of
-000090f0: 2074 6865 2063 6f6d 706f 6e65 6e74 2e22   the component."
-00009100: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00009110: 6e20 5369 7a65 496e 666f 2873 656c 662e  n SizeInfo(self.
-00009120: 6262 6f78 290a 0a20 2020 2064 6566 2067  bbox)..    def g
-00009130: 6574 5f73 6574 7469 6e67 2873 656c 662c  et_setting(self,
-00009140: 2073 6574 7469 6e67 3a20 7374 7229 202d   setting: str) -
-00009150: 3e20 556e 696f 6e5b 7374 722c 2069 6e74  > Union[str, int
-00009160: 2c20 666c 6f61 745d 3a0a 2020 2020 2020  , float]:.      
-00009170: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-00009180: 2020 2020 2020 2073 656c 662e 696e 666f         self.info
-00009190: 2e67 6574 2873 6574 7469 6e67 290a 2020  .get(setting).  
-000091a0: 2020 2020 2020 2020 2020 6f72 2073 656c            or sel
-000091b0: 662e 7365 7474 696e 6773 2e66 756c 6c2e  f.settings.full.
-000091c0: 6765 7428 7365 7474 696e 6729 0a20 2020  get(setting).   
-000091d0: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
-000091e0: 2e6d 6574 6164 6174 615f 6368 696c 642e  .metadata_child.
-000091f0: 6765 7428 7365 7474 696e 6729 0a20 2020  get(setting).   
-00009200: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00009210: 6973 5f75 6e6c 6f63 6b65 6428 7365 6c66  is_unlocked(self
-00009220: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00009230: 2020 2022 2222 5261 6973 6573 2065 7272     """Raises err
-00009240: 6f72 2069 6620 436f 6d70 6f6e 656e 7420  or if Component 
-00009250: 6973 206c 6f63 6b65 642e 2222 220a 2020  is locked.""".  
-00009260: 2020 2020 2020 6966 2073 656c 662e 5f6c        if self._l
-00009270: 6f63 6b65 643a 0a20 2020 2020 2020 2020  ocked:.         
-00009280: 2020 2072 6169 7365 204d 7574 6162 696c     raise Mutabil
-00009290: 6974 7945 7272 6f72 280a 2020 2020 2020  ityError(.      
-000092a0: 2020 2020 2020 2020 2020 6622 436f 6d70            f"Comp
-000092b0: 6f6e 656e 7420 7b73 656c 662e 6e61 6d65  onent {self.name
-000092c0: 2172 7d20 6361 6e6e 6f74 2062 6520 6d6f  !r} cannot be mo
-000092d0: 6469 6669 6564 2061 7320 6974 2773 2061  dified as it's a
-000092e0: 6c72 6561 6479 206f 6e20 6361 6368 652e  lready on cache.
-000092f0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00009300: 2020 202b 206d 7574 6162 696c 6974 795f     + mutability_
-00009310: 6572 726f 725f 6d65 7373 6167 650a 2020  error_message.  
-00009320: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00009330: 2064 6566 205f 6164 6428 7365 6c66 2c20   def _add(self, 
-00009340: 656c 656d 656e 7429 202d 3e20 4e6f 6e65  element) -> None
-00009350: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
-00009360: 2061 206e 6577 2065 6c65 6d65 6e74 206f   a new element o
-00009370: 7220 6c69 7374 206f 6620 656c 656d 656e  r list of elemen
-00009380: 7473 2074 6f20 7468 6973 2043 6f6d 706f  ts to this Compo
-00009390: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
-000093a0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000093b0: 2065 6c65 6d65 6e74 3a20 506f 6c79 676f   element: Polygo
-000093c0: 6e2c 2043 6f6d 706f 6e65 6e74 5265 6665  n, ComponentRefe
-000093d0: 7265 6e63 6520 6f72 2069 7465 7261 626c  rence or iterabl
-000093e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000093f0: 2020 5468 6520 656c 656d 656e 7420 6f72    The element or
-00009400: 2069 7465 7261 626c 6520 6f66 2065 6c65   iterable of ele
-00009410: 6d65 6e74 7320 746f 2062 6520 696e 7365  ments to be inse
-00009420: 7274 6564 2069 6e20 7468 6973 2063 656c  rted in this cel
-00009430: 6c2e 0a0a 2020 2020 2020 2020 5261 6973  l...        Rais
-00009440: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00009450: 4d75 7461 6269 6c69 7479 4572 726f 723a  MutabilityError:
-00009460: 2069 6620 636f 6d70 6f6e 656e 7420 6973   if component is
-00009470: 206c 6f63 6b65 642e 0a20 2020 2020 2020   locked..       
-00009480: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-00009490: 662e 6973 5f75 6e6c 6f63 6b65 6428 290a  f.is_unlocked().
-000094a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000094b0: 7461 6e63 6528 656c 656d 656e 742c 2043  tance(element, C
-000094c0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-000094d0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-000094e0: 7365 6c66 2e5f 6365 6c6c 2e61 6464 2865  self._cell.add(e
-000094f0: 6c65 6d65 6e74 2e5f 7265 6665 7265 6e63  lement._referenc
-00009500: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-00009510: 656c 662e 5f72 6566 6572 656e 6365 732e  elf._references.
-00009520: 6170 7065 6e64 2865 6c65 6d65 6e74 290a  append(element).
-00009530: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00009540: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00009550: 6365 6c6c 2e61 6464 2865 6c65 6d65 6e74  cell.add(element
-00009560: 290a 0a20 2020 2064 6566 2061 6464 2873  )..    def add(s
-00009570: 656c 662c 2065 6c65 6d65 6e74 2920 2d3e  elf, element) ->
-00009580: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00009590: 2222 4164 6420 6120 6e65 7720 656c 656d  ""Add a new elem
-000095a0: 656e 7420 6f72 206c 6973 7420 6f66 2065  ent or list of e
-000095b0: 6c65 6d65 6e74 7320 746f 2074 6869 7320  lements to this 
-000095c0: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
-000095d0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-000095e0: 2020 2020 2020 656c 656d 656e 743a 2050        element: P
-000095f0: 6f6c 7967 6f6e 2c20 436f 6d70 6f6e 656e  olygon, Componen
-00009600: 7452 6566 6572 656e 6365 206f 7220 6974  tReference or it
-00009610: 6572 6162 6c65 0a20 2020 2020 2020 2020  erable.         
-00009620: 2020 2020 2020 2054 6865 2065 6c65 6d65         The eleme
-00009630: 6e74 206f 7220 6974 6572 6162 6c65 206f  nt or iterable o
-00009640: 6620 656c 656d 656e 7473 2074 6f20 6265  f elements to be
-00009650: 2069 6e73 6572 7465 6420 696e 2074 6869   inserted in thi
-00009660: 7320 6365 6c6c 2e0a 0a20 2020 2020 2020  s cell...       
-00009670: 2052 6169 7365 733a 0a20 2020 2020 2020   Raises:.       
-00009680: 2020 2020 204d 7574 6162 696c 6974 7945       MutabilityE
-00009690: 7272 6f72 3a20 6966 2063 6f6d 706f 6e65  rror: if compone
-000096a0: 6e74 2069 7320 6c6f 636b 6564 2e0a 2020  nt is locked..  
-000096b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000096c0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000096d0: 656c 656d 656e 742c 2043 6f6d 706f 6e65  element, Compone
-000096e0: 6e74 5265 6665 7265 6e63 6529 3a0a 2020  ntReference):.  
-000096f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00009700: 7265 6769 7374 6572 5f72 6566 6572 656e  register_referen
-00009710: 6365 2865 6c65 6d65 6e74 290a 2020 2020  ce(element).    
-00009720: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
-00009730: 6428 656c 656d 656e 7429 0a20 2020 2020  d(element).     
-00009740: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00009750: 6365 2865 6c65 6d65 6e74 2c20 4974 6572  ce(element, Iter
-00009760: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
-00009770: 2020 2066 6f72 2073 7562 656c 656d 656e     for subelemen
-00009780: 7420 696e 2065 6c65 6d65 6e74 3a0a 2020  t in element:.  
-00009790: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000097a0: 6c66 2e61 6464 2873 7562 656c 656d 656e  lf.add(subelemen
-000097b0: 7429 0a20 2020 2020 2020 2065 6c73 653a  t).        else:
-000097c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000097d0: 662e 5f61 6464 2865 6c65 6d65 6e74 290a  f._add(element).
-000097e0: 0a20 2020 2064 6566 2061 6464 5f61 7272  .    def add_arr
-000097f0: 6179 280a 2020 2020 2020 2020 7365 6c66  ay(.        self
-00009800: 2c0a 2020 2020 2020 2020 636f 6d70 6f6e  ,.        compon
-00009810: 656e 743a 2043 6f6d 706f 6e65 6e74 2c0a  ent: Component,.
-00009820: 2020 2020 2020 2020 636f 6c75 6d6e 733a          columns:
-00009830: 2069 6e74 203d 2032 2c0a 2020 2020 2020   int = 2,.      
-00009840: 2020 726f 7773 3a20 696e 7420 3d20 322c    rows: int = 2,
-00009850: 0a20 2020 2020 2020 2073 7061 6369 6e67  .        spacing
-00009860: 3a20 5475 706c 655b 666c 6f61 742c 2066  : Tuple[float, f
-00009870: 6c6f 6174 5d20 3d20 2831 3030 2c20 3130  loat] = (100, 10
-00009880: 3029 2c0a 2020 2020 2020 2020 616c 6961  0),.        alia
-00009890: 733a 204f 7074 696f 6e61 6c5b 7374 725d  s: Optional[str]
-000098a0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-000098b0: 3e20 436f 6d70 6f6e 656e 7452 6566 6572  > ComponentRefer
-000098c0: 656e 6365 3a0a 2020 2020 2020 2020 2222  ence:.        ""
-000098d0: 2243 7265 6174 6573 2061 2043 6f6d 706f  "Creates a Compo
-000098e0: 6e65 6e74 5265 6665 7265 6e63 6520 7265  nentReference re
-000098f0: 6665 7265 6e63 6520 746f 2061 2043 6f6d  ference to a Com
-00009900: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00009910: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00009920: 2020 2063 6f6d 706f 6e65 6e74 3a20 5468     component: Th
-00009930: 6520 7265 6665 7265 6e63 6564 2063 6f6d  e referenced com
-00009940: 706f 6e65 6e74 2e0a 2020 2020 2020 2020  ponent..        
-00009950: 2020 2020 636f 6c75 6d6e 733a 204e 756d      columns: Num
-00009960: 6265 7220 6f66 2063 6f6c 756d 6e73 2069  ber of columns i
-00009970: 6e20 7468 6520 6172 7261 792e 0a20 2020  n the array..   
-00009980: 2020 2020 2020 2020 2072 6f77 733a 204e           rows: N
-00009990: 756d 6265 7220 6f66 2072 6f77 7320 696e  umber of rows in
-000099a0: 2074 6865 2061 7272 6179 2e0a 2020 2020   the array..    
-000099b0: 2020 2020 2020 2020 7370 6163 696e 673a          spacing:
-000099c0: 2061 7272 6179 2d6c 696b 655b 325d 206f   array-like[2] o
-000099d0: 6620 696e 7420 6f72 2066 6c6f 6174 2e0a  f int or float..
-000099e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099f0: 4469 7374 616e 6365 2062 6574 7765 656e  Distance between
-00009a00: 2061 646a 6163 656e 7420 636f 6c75 6d6e   adjacent column
-00009a10: 7320 616e 6420 6164 6a61 6365 6e74 2072  s and adjacent r
-00009a20: 6f77 732e 0a20 2020 2020 2020 2020 2020  ows..           
-00009a30: 2061 6c69 6173 3a20 7374 7220 6f72 204e   alias: str or N
-00009a40: 6f6e 652e 2041 6c69 6173 206f 6620 7468  one. Alias of th
-00009a50: 6520 7265 6665 7265 6e63 6564 2043 6f6d  e referenced Com
-00009a60: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00009a70: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00009a80: 2020 2020 2061 3a20 436f 6d70 6f6e 656e       a: Componen
-00009a90: 7452 6566 6572 656e 6365 2063 6f6e 7461  tReference conta
-00009aa0: 696e 696e 6720 7265 6665 7265 6e63 6573  ining references
-00009ab0: 2074 6f20 7468 6520 436f 6d70 6f6e 656e   to the Componen
-00009ac0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
-00009ad0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00009ae0: 696e 7374 616e 6365 2863 6f6d 706f 6e65  instance(compone
-00009af0: 6e74 2c20 436f 6d70 6f6e 656e 7429 3a0a  nt, Component):.
-00009b00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00009b10: 6520 5479 7065 4572 726f 7228 2261 6464  e TypeError("add
-00009b20: 5f61 7272 6179 2829 206e 6565 6473 2061  _array() needs a
-00009b30: 2043 6f6d 706f 6e65 6e74 206f 626a 6563   Component objec
-00009b40: 742e 2229 0a20 2020 2020 2020 2072 6566  t.").        ref
-00009b50: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
-00009b60: 7265 6e63 6528 0a20 2020 2020 2020 2020  rence(.         
-00009b70: 2020 2063 6f6d 706f 6e65 6e74 3d63 6f6d     component=com
-00009b80: 706f 6e65 6e74 2c0a 2020 2020 2020 2020  ponent,.        
-00009b90: 2020 2020 636f 6c75 6d6e 733d 696e 7428      columns=int(
-00009ba0: 726f 756e 6428 636f 6c75 6d6e 7329 292c  round(columns)),
-00009bb0: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
-00009bc0: 733d 696e 7428 726f 756e 6428 726f 7773  s=int(round(rows
-00009bd0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00009be0: 7370 6163 696e 673d 7370 6163 696e 672c  spacing=spacing,
-00009bf0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00009c00: 2020 2072 6566 2e6e 616d 6520 3d20 4e6f     ref.name = No
-00009c10: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-00009c20: 5f61 6464 2872 6566 290a 2020 2020 2020  _add(ref).      
-00009c30: 2020 7365 6c66 2e5f 7265 6769 7374 6572    self._register
-00009c40: 5f72 6566 6572 656e 6365 2872 6566 6572  _reference(refer
-00009c50: 656e 6365 3d72 6566 2c20 616c 6961 733d  ence=ref, alias=
-00009c60: 616c 6961 7329 0a20 2020 2020 2020 2072  alias).        r
-00009c70: 6574 7572 6e20 7265 660a 0a20 2020 2064  eturn ref..    d
-00009c80: 6566 2064 6973 7472 6962 7574 6528 0a20  ef distribute(. 
-00009c90: 2020 2020 2020 2073 656c 662c 2065 6c65         self, ele
-00009ca0: 6d65 6e74 733d 2261 6c6c 222c 2064 6972  ments="all", dir
-00009cb0: 6563 7469 6f6e 3d22 7822 2c20 7370 6163  ection="x", spac
-00009cc0: 696e 673d 3130 302c 2073 6570 6172 6174  ing=100, separat
-00009cd0: 696f 6e3d 5472 7565 2c20 6564 6765 3d22  ion=True, edge="
-00009ce0: 6365 6e74 6572 220a 2020 2020 293a 0a20  center".    ):. 
-00009cf0: 2020 2020 2020 2022 2222 4469 7374 7269         """Distri
-00009d00: 6275 7465 7320 7468 6520 7370 6563 6966  butes the specif
-00009d10: 6965 6420 656c 656d 656e 7473 2069 6e20  ied elements in 
-00009d20: 7468 6520 436f 6d70 6f6e 656e 742e 0a0a  the Component...
-00009d30: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00009d40: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-00009d50: 7473 203a 2061 7272 6179 2d6c 696b 6520  ts : array-like 
-00009d60: 6f66 206f 626a 6563 7473 206f 7220 2761  of objects or 'a
-00009d70: 6c6c 270a 2020 2020 2020 2020 2020 2020  ll'.            
-00009d80: 2020 2020 456c 656d 656e 7473 2074 6f20      Elements to 
-00009d90: 6469 7374 7269 6275 7465 2e0a 2020 2020  distribute..    
-00009da0: 2020 2020 2020 2020 6469 7265 6374 696f          directio
-00009db0: 6e20 3a20 7b27 7827 2c20 2779 277d 0a20  n : {'x', 'y'}. 
-00009dc0: 2020 2020 2020 2020 2020 2020 2020 2044                 D
-00009dd0: 6972 6563 7469 6f6e 206f 6620 6469 7374  irection of dist
-00009de0: 7269 6275 7469 6f6e 3b20 6569 7468 6572  ribution; either
-00009df0: 2061 206c 696e 6520 696e 2074 6865 2078   a line in the x
-00009e00: 2d64 6972 6563 7469 6f6e 206f 720a 2020  -direction or.  
-00009e10: 2020 2020 2020 2020 2020 2020 2020 792d                y-
-00009e20: 6469 7265 6374 696f 6e2e 0a20 2020 2020  direction..     
-00009e30: 2020 2020 2020 2073 7061 6369 6e67 203a         spacing :
-00009e40: 2069 6e74 206f 7220 666c 6f61 740a 2020   int or float.  
-00009e50: 2020 2020 2020 2020 2020 2020 2020 4469                Di
-00009e60: 7374 616e 6365 2062 6574 7765 656e 2065  stance between e
-00009e70: 6c65 6d65 6e74 732e 0a20 2020 2020 2020  lements..       
-00009e80: 2020 2020 2073 6570 6172 6174 696f 6e20       separation 
-00009e90: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
-00009ea0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00009eb0: 6775 6172 616e 7465 6573 2065 6c65 6d65  guarantees eleme
-00009ec0: 6e74 7320 6172 6520 7365 7061 7261 7465  nts are separate
-00009ed0: 6420 7769 7468 2061 2066 6978 6564 2073  d with a fixed s
-00009ee0: 7061 6369 6e67 0a20 2020 2020 2020 2020  pacing.         
-00009ef0: 2020 2020 2020 2062 6574 7765 656e 3b20         between; 
-00009f00: 6966 2020 4661 6c73 652c 2065 6c65 6d65  if  False, eleme
-00009f10: 6e74 7320 6172 6520 7370 6163 6564 2065  nts are spaced e
-00009f20: 7665 6e6c 7920 616c 6f6e 6720 6120 6772  venly along a gr
-00009f30: 6964 2e0a 2020 2020 2020 2020 2020 2020  id..            
-00009f40: 6564 6765 203a 207b 2778 272c 2027 786d  edge : {'x', 'xm
-00009f50: 696e 272c 2027 786d 6178 272c 2027 7927  in', 'xmax', 'y'
-00009f60: 2c20 2779 6d69 6e27 2c20 2779 6d61 7827  , 'ymin', 'ymax'
-00009f70: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00009f80: 2020 5768 6963 6820 6564 6765 2074 6f20    Which edge to 
-00009f90: 7065 7266 6f72 6d20 7468 6520 6469 7374  perform the dist
-00009fa0: 7269 6275 7469 6f6e 2061 6c6f 6e67 2028  ribution along (
-00009fb0: 756e 7573 6564 2069 660a 2020 2020 2020  unused if.      
-00009fc0: 2020 2020 2020 2020 2020 7365 7061 7261            separa
-00009fd0: 7469 6f6e 203d 3d20 5472 7565 290a 0a20  tion == True).. 
-00009fe0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00009ff0: 2020 2069 6620 656c 656d 656e 7473 203d     if elements =
-0000a000: 3d20 2261 6c6c 223a 0a20 2020 2020 2020  = "all":.       
-0000a010: 2020 2020 2065 6c65 6d65 6e74 7320 3d20       elements = 
-0000a020: 7365 6c66 2e70 6f6c 7967 6f6e 7320 2b20  self.polygons + 
-0000a030: 7365 6c66 2e72 6566 6572 656e 6365 730a  self.references.
-0000a040: 2020 2020 2020 2020 5f64 6973 7472 6962          _distrib
-0000a050: 7574 6528 0a20 2020 2020 2020 2020 2020  ute(.           
-0000a060: 2065 6c65 6d65 6e74 733d 656c 656d 656e   elements=elemen
-0000a070: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-0000a080: 6469 7265 6374 696f 6e3d 6469 7265 6374  direction=direct
-0000a090: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0000a0a0: 2073 7061 6369 6e67 3d73 7061 6369 6e67   spacing=spacing
-0000a0b0: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
-0000a0c0: 7061 7261 7469 6f6e 3d73 6570 6172 6174  paration=separat
-0000a0d0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0000a0e0: 2065 6467 653d 6564 6765 2c0a 2020 2020   edge=edge,.    
-0000a0f0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-0000a100: 7475 726e 2073 656c 660a 0a20 2020 2064  turn self..    d
-0000a110: 6566 2061 6c69 676e 2873 656c 662c 2065  ef align(self, e
-0000a120: 6c65 6d65 6e74 733d 2261 6c6c 222c 2061  lements="all", a
-0000a130: 6c69 676e 6d65 6e74 3d22 796d 6178 2229  lignment="ymax")
-0000a140: 3a0a 2020 2020 2020 2020 2222 2241 6c69  :.        """Ali
-0000a150: 676e 2065 6c65 6d65 6e74 7320 696e 2074  gn elements in t
-0000a160: 6865 2043 6f6d 706f 6e65 6e74 2e0a 0a20  he Component... 
-0000a170: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-0000a180: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
-0000a190: 7320 3a20 6172 7261 792d 6c69 6b65 206f  s : array-like o
-0000a1a0: 6620 6f62 6a65 6374 732c 206f 7220 2761  f objects, or 'a
-0000a1b0: 6c6c 270a 2020 2020 2020 2020 2020 2020  ll'.            
-0000a1c0: 2020 2020 456c 656d 656e 7473 2069 6e20      Elements in 
-0000a1d0: 7468 6520 436f 6d70 6f6e 656e 7420 746f  the Component to
-0000a1e0: 2061 6c69 676e 2e0a 2020 2020 2020 2020   align..        
-0000a1f0: 2020 2020 616c 6967 6e6d 656e 7420 3a20      alignment : 
-0000a200: 7b27 7827 2c20 2779 272c 2027 786d 696e  {'x', 'y', 'xmin
-0000a210: 272c 2027 786d 6178 272c 2027 796d 696e  ', 'xmax', 'ymin
-0000a220: 272c 2027 796d 6178 277d 0a20 2020 2020  ', 'ymax'}.     
-0000a230: 2020 2020 2020 2020 2020 2057 6869 6368             Which
-0000a240: 2065 6467 6520 746f 2061 6c69 676e 2061   edge to align a
-0000a250: 6c6f 6e67 2028 652e 672e 2027 796d 6178  long (e.g. 'ymax
-0000a260: 2720 7769 6c6c 206d 6f76 6520 7468 6520  ' will move the 
-0000a270: 656c 656d 656e 7473 2073 7563 680a 2020  elements such.  
-0000a280: 2020 2020 2020 2020 2020 2020 2020 7468                th
-0000a290: 6174 2061 6c6c 206f 6620 7468 6569 7220  at all of their 
-0000a2a0: 746f 706d 6f73 7420 706f 696e 7473 2061  topmost points a
-0000a2b0: 7265 2061 6c69 676e 6564 292e 0a20 2020  re aligned)..   
-0000a2c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000a2d0: 2069 6620 656c 656d 656e 7473 203d 3d20   if elements == 
-0000a2e0: 2261 6c6c 223a 0a20 2020 2020 2020 2020  "all":.         
-0000a2f0: 2020 2065 6c65 6d65 6e74 7320 3d20 7365     elements = se
-0000a300: 6c66 2e70 6f6c 7967 6f6e 7320 2b20 7365  lf.polygons + se
-0000a310: 6c66 2e72 6566 6572 656e 6365 730a 2020  lf.references.  
-0000a320: 2020 2020 2020 5f61 6c69 676e 2865 6c65        _align(ele
-0000a330: 6d65 6e74 732c 2061 6c69 676e 6d65 6e74  ments, alignment
-0000a340: 3d61 6c69 676e 6d65 6e74 290a 2020 2020  =alignment).    
-0000a350: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
-0000a360: 0a20 2020 2064 6566 2066 6c61 7474 656e  .    def flatten
-0000a370: 2873 656c 662c 2073 696e 676c 655f 6c61  (self, single_la
-0000a380: 7965 723a 204f 7074 696f 6e61 6c5b 4c61  yer: Optional[La
-0000a390: 7965 7253 7065 635d 203d 204e 6f6e 6529  yerSpec] = None)
-0000a3a0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-0000a3b0: 7572 6e73 2061 2066 6c61 7474 656e 6564  urns a flattened
-0000a3c0: 2063 6f70 7920 6f66 2074 6865 2063 6f6d   copy of the com
-0000a3d0: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-0000a3e0: 2046 6c61 7474 656e 7320 7468 6520 6869   Flattens the hi
-0000a3f0: 6572 6172 6368 7920 6f66 2074 6865 2043  erarchy of the C
-0000a400: 6f6d 706f 6e65 6e74 2073 7563 6820 7468  omponent such th
-0000a410: 6174 2074 6865 7265 2061 7265 206e 6f20  at there are no 
-0000a420: 6c6f 6e67 6572 0a20 2020 2020 2020 2061  longer.        a
-0000a430: 6e79 2072 6566 6572 656e 6365 7320 746f  ny references to
-0000a440: 206f 7468 6572 2043 6f6d 706f 6e65 6e74   other Component
-0000a450: 732e 2041 6c6c 2070 6f6c 7967 6f6e 7320  s. All polygons 
-0000a460: 616e 6420 6c61 6265 6c73 2066 726f 6d0a  and labels from.
-0000a470: 2020 2020 2020 2020 756e 6465 726c 7969          underlyi
-0000a480: 6e67 2072 6566 6572 656e 6365 7320 6172  ng references ar
-0000a490: 6520 636f 7069 6564 2061 6e64 2070 6c61  e copied and pla
-0000a4a0: 6365 6420 696e 2074 6865 2074 6f70 2d6c  ced in the top-l
-0000a4b0: 6576 656c 2043 6f6d 706f 6e65 6e74 2e0a  evel Component..
-0000a4c0: 2020 2020 2020 2020 4966 2073 696e 676c          If singl
-0000a4d0: 655f 6c61 7965 7220 6973 2073 7065 6369  e_layer is speci
-0000a4e0: 6669 6564 2c20 616c 6c20 706f 6c79 676f  fied, all polygo
-0000a4f0: 6e73 2061 7265 206d 6f76 6564 2074 6f20  ns are moved to 
-0000a500: 7468 6174 206c 6179 6572 2e0a 0a20 2020  that layer...   
-0000a510: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-0000a520: 2020 2020 2020 2073 696e 676c 655f 6c61         single_la
-0000a530: 7965 723a 206d 6f76 6520 616c 6c20 706f  yer: move all po
-0000a540: 6c79 676f 6e73 2061 7265 206d 6f76 6564  lygons are moved
-0000a550: 2074 6f20 7468 6520 7370 6563 6966 6965   to the specifie
-0000a560: 6420 286f 7074 696f 6e61 6c29 2e0a 2020  d (optional)..  
-0000a570: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000a580: 2020 636f 6d70 6f6e 656e 745f 666c 6174    component_flat
-0000a590: 203d 2043 6f6d 706f 6e65 6e74 2829 0a0a   = Component()..
-0000a5a0: 2020 2020 2020 2020 5f63 656c 6c20 3d20          _cell = 
-0000a5b0: 7365 6c66 2e5f 6365 6c6c 2e63 6f70 7928  self._cell.copy(
-0000a5c0: 6e61 6d65 3d63 6f6d 706f 6e65 6e74 5f66  name=component_f
-0000a5d0: 6c61 742e 6e61 6d65 290a 2020 2020 2020  lat.name).      
-0000a5e0: 2020 5f63 656c 6c20 3d20 5f63 656c 6c2e    _cell = _cell.
-0000a5f0: 666c 6174 7465 6e28 290a 2020 2020 2020  flatten().      
-0000a600: 2020 636f 6d70 6f6e 656e 745f 666c 6174    component_flat
-0000a610: 2e5f 6365 6c6c 203d 205f 6365 6c6c 0a20  ._cell = _cell. 
-0000a620: 2020 2020 2020 2069 6620 7369 6e67 6c65         if single
-0000a630: 5f6c 6179 6572 2069 7320 6e6f 7420 4e6f  _layer is not No
-0000a640: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000a650: 6672 6f6d 2067 6473 6661 6374 6f72 7920  from gdsfactory 
-0000a660: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
-0000a670: 0a0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
-0000a680: 7965 722c 2064 6174 6174 7970 6520 3d20  yer, datatype = 
-0000a690: 6765 745f 6c61 7965 7228 7369 6e67 6c65  get_layer(single
-0000a6a0: 5f6c 6179 6572 290a 2020 2020 2020 2020  _layer).        
-0000a6b0: 2020 2020 666f 7220 706f 6c79 676f 6e20      for polygon 
-0000a6c0: 696e 205f 6365 6c6c 2e70 6f6c 7967 6f6e  in _cell.polygon
-0000a6d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000a6e0: 2020 2070 6f6c 7967 6f6e 2e6c 6179 6572     polygon.layer
-0000a6f0: 203d 206c 6179 6572 0a20 2020 2020 2020   = layer.       
-0000a700: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-0000a710: 2e64 6174 6174 7970 6520 3d20 6461 7461  .datatype = data
-0000a720: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
-0000a730: 2066 6f72 2070 6174 6820 696e 205f 6365   for path in _ce
-0000a740: 6c6c 2e70 6174 6873 3a0a 2020 2020 2020  ll.paths:.      
-0000a750: 2020 2020 2020 2020 2020 7061 7468 2e73            path.s
-0000a760: 6574 5f6c 6179 6572 7328 6c61 7965 7229  et_layers(layer)
-0000a770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a780: 2070 6174 682e 7365 745f 6461 7461 7479   path.set_dataty
-0000a790: 7065 7328 6461 7461 7479 7065 290a 0a20  pes(datatype).. 
-0000a7a0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-0000a7b0: 5f66 6c61 742e 696e 666f 203d 2073 656c  _flat.info = sel
-0000a7c0: 662e 696e 666f 2e63 6f70 7928 290a 2020  f.info.copy().  
-0000a7d0: 2020 2020 2020 636f 6d70 6f6e 656e 745f        component_
-0000a7e0: 666c 6174 2e61 6464 5f70 6f72 7473 2873  flat.add_ports(s
-0000a7f0: 656c 662e 706f 7274 7329 0a20 2020 2020  elf.ports).     
-0000a800: 2020 2072 6574 7572 6e20 636f 6d70 6f6e     return compon
-0000a810: 656e 745f 666c 6174 0a0a 2020 2020 6465  ent_flat..    de
-0000a820: 6620 666c 6174 7465 6e5f 7265 6665 7265  f flatten_refere
-0000a830: 6e63 6528 7365 6c66 2c20 7265 663a 2043  nce(self, ref: C
-0000a840: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-0000a850: 6529 202d 3e20 4e6f 6e65 3a0a 2020 2020  e) -> None:.    
-0000a860: 2020 2020 2222 2246 726f 6d20 6578 6973      """From exis
-0000a870: 7469 6e67 2063 656c 6c20 7265 706c 6163  ting cell replac
-0000a880: 6573 2072 6566 6572 656e 6365 2077 6974  es reference wit
-0000a890: 6820 6120 666c 6174 7465 6e20 7265 6665  h a flatten refe
-0000a8a0: 7265 6e63 6520 5c0a 2020 2020 2020 2020  rence \.        
-0000a8b0: 7768 6963 6820 6861 7320 7468 6520 7472  which has the tr
-0000a8c0: 616e 7366 6f72 6d61 7469 6f6e 7320 616c  ansformations al
-0000a8d0: 7265 6164 7920 6170 706c 6965 642e 0a0a  ready applied...
-0000a8e0: 2020 2020 2020 2020 5472 616e 7366 6f72          Transfor
-0000a8f0: 6d65 6420 7265 6665 7265 6e63 6520 6b65  med reference ke
-0000a900: 6570 7320 7468 6520 6f72 6967 696e 616c  eps the original
-0000a910: 206e 616d 652e 0a0a 2020 2020 2020 2020   name...        
-0000a920: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-0000a930: 2020 7265 663a 2074 6865 2072 6566 6572    ref: the refer
-0000a940: 656e 6365 2074 6f20 666c 6174 7465 6e20  ence to flatten 
-0000a950: 696e 746f 2061 206e 6577 2063 656c 6c2e  into a new cell.
-0000a960: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000a970: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-0000a980: 6374 6f72 792e 6675 6e63 7469 6f6e 7320  ctory.functions 
-0000a990: 696d 706f 7274 2074 7261 6e73 666f 726d  import transform
-0000a9a0: 6564 0a0a 2020 2020 2020 2020 7365 6c66  ed..        self
-0000a9b0: 2e72 656d 6f76 6528 7265 6629 0a20 2020  .remove(ref).   
-0000a9c0: 2020 2020 206e 6577 5f63 6f6d 706f 6e65       new_compone
-0000a9d0: 6e74 203d 2074 7261 6e73 666f 726d 6564  nt = transformed
-0000a9e0: 2872 6566 2c20 6465 636f 7261 746f 723d  (ref, decorator=
-0000a9f0: 4e6f 6e65 290a 2020 2020 2020 2020 7365  None).        se
-0000aa00: 6c66 2e61 6464 5f72 6566 286e 6577 5f63  lf.add_ref(new_c
-0000aa10: 6f6d 706f 6e65 6e74 2c20 616c 6961 733d  omponent, alias=
-0000aa20: 7265 662e 6e61 6d65 290a 0a20 2020 2064  ref.name)..    d
-0000aa30: 6566 2061 6464 5f72 6566 280a 2020 2020  ef add_ref(.    
-0000aa40: 2020 2020 7365 6c66 2c20 636f 6d70 6f6e      self, compon
-0000aa50: 656e 743a 2043 6f6d 706f 6e65 6e74 2c20  ent: Component, 
-0000aa60: 616c 6961 733a 204f 7074 696f 6e61 6c5b  alias: Optional[
-0000aa70: 7374 725d 203d 204e 6f6e 652c 202a 2a6b  str] = None, **k
-0000aa80: 7761 7267 730a 2020 2020 2920 2d3e 2043  wargs.    ) -> C
-0000aa90: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-0000aaa0: 653a 0a20 2020 2020 2020 2022 2222 4164  e:.        """Ad
-0000aab0: 6420 436f 6d70 6f6e 656e 7452 6566 6572  d ComponentRefer
-0000aac0: 656e 6365 2074 6f20 7468 6520 6375 7272  ence to the curr
-0000aad0: 656e 7420 436f 6d70 6f6e 656e 742e 0a0a  ent Component...
-0000aae0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-0000aaf0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-0000ab00: 656e 743a 2043 6f6d 706f 6e65 6e74 2e0a  ent: Component..
-0000ab10: 2020 2020 2020 2020 2020 2020 616c 6961              alia
-0000ab20: 733a 206e 616d 6564 5f72 6566 6572 656e  s: named_referen
-0000ab30: 6365 732e 0a0a 2020 2020 2020 2020 4b65  ces...        Ke
-0000ab40: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
-0000ab50: 2020 2020 2020 2020 636f 6c75 6d6e 733a          columns:
-0000ab60: 204e 756d 6265 7220 6f66 2063 6f6c 756d   Number of colum
-0000ab70: 6e73 2069 6e20 7468 6520 6172 7261 792e  ns in the array.
-0000ab80: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
-0000ab90: 733a 204e 756d 6265 7220 6f66 2072 6f77  s: Number of row
-0000aba0: 7320 696e 2074 6865 2061 7272 6179 2e0a  s in the array..
-0000abb0: 2020 2020 2020 2020 2020 2020 7370 6163              spac
-0000abc0: 696e 673a 2044 6973 7461 6e63 6573 2062  ing: Distances b
-0000abd0: 6574 7765 656e 2061 646a 6163 656e 7420  etween adjacent 
-0000abe0: 636f 6c75 6d6e 7320 616e 6420 6164 6a61  columns and adja
-0000abf0: 6365 6e74 2072 6f77 732e 0a20 2020 2020  cent rows..     
-0000ac00: 2020 2020 2020 206f 7269 6769 6e3a 2061         origin: a
-0000ac10: 7272 6179 2d6c 696b 655b 325d 206f 6620  rray-like[2] of 
-0000ac20: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-0000ac30: 2020 2020 2020 2020 2020 2020 2050 6f73               Pos
-0000ac40: 6974 696f 6e20 7768 6572 6520 7468 6520  ition where the 
-0000ac50: 6365 6c6c 2069 7320 696e 7365 7274 6564  cell is inserted
-0000ac60: 2e0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-0000ac70: 7461 7469 6f6e 203a 2069 6e74 206f 7220  tation : int or 
-0000ac80: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-0000ac90: 2020 2020 2020 416e 676c 6520 6f66 2072        Angle of r
-0000aca0: 6f74 6174 696f 6e20 6f66 2074 6865 2072  otation of the r
-0000acb0: 6566 6572 656e 6365 2028 696e 2060 6465  eference (in `de
-0000acc0: 6772 6565 7360 292e 0a20 2020 2020 2020  grees`)..       
-0000acd0: 2020 2020 206d 6167 6e69 6669 6361 7469       magnificati
-0000ace0: 6f6e 203a 2069 6e74 206f 7220 666c 6f61  on : int or floa
-0000acf0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0000ad00: 2020 4d61 676e 6966 6963 6174 696f 6e20    Magnification 
-0000ad10: 6661 6374 6f72 2066 6f72 2074 6865 2072  factor for the r
-0000ad20: 6566 6572 656e 6365 2e0a 2020 2020 2020  eference..      
-0000ad30: 2020 2020 2020 785f 7265 666c 6563 7469        x_reflecti
-0000ad40: 6f6e 203a 2062 6f6f 6c0a 2020 2020 2020  on : bool.      
-0000ad50: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-0000ad60: 652c 2074 6865 2072 6566 6572 656e 6365  e, the reference
-0000ad70: 2069 7320 7265 666c 6563 7465 6420 7061   is reflected pa
-0000ad80: 7261 6c6c 656c 2074 6f20 7468 6520 7820  rallel to the x 
-0000ad90: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
-0000ada0: 2020 2020 2020 2020 2020 6265 666f 7265            before
-0000adb0: 2062 6569 6e67 2072 6f74 6174 6564 2e0a   being rotated..
-0000adc0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0000add0: 203a 2073 7472 2028 6f70 7469 6f6e 616c   : str (optional
-0000ade0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000adf0: 2020 4120 6e61 6d65 2066 6f72 2074 6865    A name for the
-0000ae00: 2072 6566 6572 656e 6365 2028 6966 2070   reference (if p
-0000ae10: 726f 7669 6465 6429 2e0a 0a20 2020 2020  rovided)...     
-0000ae20: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0000ae30: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0000ae40: 2863 6f6d 706f 6e65 6e74 2c20 436f 6d70  (component, Comp
-0000ae50: 6f6e 656e 7429 3a0a 2020 2020 2020 2020  onent):.        
-0000ae60: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-0000ae70: 726f 7228 6622 7479 7065 203d 207b 7479  ror(f"type = {ty
-0000ae80: 7065 2843 6f6d 706f 6e65 6e74 297d 206e  pe(Component)} n
-0000ae90: 6565 6473 2074 6f20 6265 2061 2043 6f6d  eeds to be a Com
-0000aea0: 706f 6e65 6e74 2e22 290a 2020 2020 2020  ponent.").      
-0000aeb0: 2020 7265 6620 3d20 436f 6d70 6f6e 656e    ref = Componen
-0000aec0: 7452 6566 6572 656e 6365 2863 6f6d 706f  tReference(compo
-0000aed0: 6e65 6e74 2c20 2a2a 6b77 6172 6773 290a  nent, **kwargs).
-0000aee0: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
-0000aef0: 6428 7265 6629 0a20 2020 2020 2020 2073  d(ref).        s
-0000af00: 656c 662e 5f72 6567 6973 7465 725f 7265  elf._register_re
-0000af10: 6665 7265 6e63 6528 7265 6665 7265 6e63  ference(referenc
-0000af20: 653d 7265 662c 2061 6c69 6173 3d61 6c69  e=ref, alias=ali
-0000af30: 6173 290a 2020 2020 2020 2020 7265 7475  as).        retu
-0000af40: 726e 2072 6566 0a0a 2020 2020 6465 6620  rn ref..    def 
-0000af50: 5f72 6567 6973 7465 725f 7265 6665 7265  _register_refere
-0000af60: 6e63 6528 0a20 2020 2020 2020 2073 656c  nce(.        sel
-0000af70: 662c 2072 6566 6572 656e 6365 3a20 436f  f, reference: Co
-0000af80: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-0000af90: 2c20 616c 6961 733a 204f 7074 696f 6e61  , alias: Optiona
-0000afa0: 6c5b 7374 725d 203d 204e 6f6e 650a 2020  l[str] = None.  
-0000afb0: 2020 2920 2d3e 204e 6f6e 653a 0a20 2020    ) -> None:.   
-0000afc0: 2020 2020 2063 6f6d 706f 6e65 6e74 203d       component =
-0000afd0: 2072 6566 6572 656e 6365 2e70 6172 656e   reference.paren
-0000afe0: 740a 2020 2020 2020 2020 7265 6665 7265  t.        refere
-0000aff0: 6e63 652e 6f77 6e65 7220 3d20 7365 6c66  nce.owner = self
-0000b000: 0a0a 2020 2020 2020 2020 6966 2061 6c69  ..        if ali
-0000b010: 6173 2069 7320 4e6f 6e65 3a0a 2020 2020  as is None:.    
-0000b020: 2020 2020 2020 2020 6966 2072 6566 6572          if refer
-0000b030: 656e 6365 2e6e 616d 6520 6973 206e 6f74  ence.name is not
-0000b040: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b050: 2020 2020 2020 2061 6c69 6173 203d 2072         alias = r
-0000b060: 6566 6572 656e 6365 2e6e 616d 650a 2020  eference.name.  
-0000b070: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b090: 7072 6566 6978 203d 2028 0a20 2020 2020  prefix = (.     
-0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000b0b0: 6f6d 706f 6e65 6e74 2e73 6574 7469 6e67  omponent.setting
-0000b0c0: 732e 6675 6e63 7469 6f6e 5f6e 616d 650a  s.function_name.
+00008180: 796f 7520 6d75 7374 2075 7365 2073 6574  you must use set
+00008190: 206e 6f74 6174 696f 6e2c 2065 2e67 2e20   notation, e.g. 
+000081a0: 7b31 2c35 2c38 7d20 2222 220a 2020 2020  {1,5,8} """.    
+000081b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000081c0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+000081d0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+000081e0: 2020 2020 7061 7373 0a0a 2020 2020 2020      pass..      
+000081f0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00008200: 706f 696e 7473 2c20 6764 7374 6b2e 506f  points, gdstk.Po
+00008210: 6c79 676f 6e29 3a0a 2020 2020 2020 2020  lygon):.        
+00008220: 2020 2020 2320 6966 206c 6179 6572 2069      # if layer i
+00008230: 7320 756e 7370 6563 6966 6965 6420 6f72  s unspecified or
+00008240: 206d 6174 6368 6573 206f 7269 6769 6e61   matches origina
+00008250: 6c20 706f 6c79 676f 6e2c 206a 7573 7420  l polygon, just 
+00008260: 6164 6420 6974 2061 732d 6973 0a20 2020  add it as-is.   
+00008270: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00008280: 203d 2070 6f69 6e74 730a 2020 2020 2020   = points.      
+00008290: 2020 2020 2020 6966 206c 6179 6572 2069        if layer i
+000082a0: 7320 6e70 2e6e 616e 206f 7220 280a 2020  s np.nan or (.  
+000082b0: 2020 2020 2020 2020 2020 2020 2020 6973                is
+000082c0: 696e 7374 616e 6365 286c 6179 6572 2c20  instance(layer, 
+000082d0: 7475 706c 6529 2061 6e64 2028 706f 6c79  tuple) and (poly
+000082e0: 676f 6e2e 6c61 7965 722c 2070 6f6c 7967  gon.layer, polyg
+000082f0: 6f6e 2e64 6174 6174 7970 6529 203d 3d20  on.datatype) == 
+00008300: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
+00008310: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00008320: 2020 2020 2070 6f6c 7967 6f6e 203d 2050       polygon = P
+00008330: 6f6c 7967 6f6e 2870 6f6c 7967 6f6e 2e70  olygon(polygon.p
+00008340: 6f69 6e74 732c 2070 6f6c 7967 6f6e 2e6c  oints, polygon.l
+00008350: 6179 6572 2c20 706f 6c79 676f 6e2e 6461  ayer, polygon.da
+00008360: 7461 7479 7065 290a 2020 2020 2020 2020  tatype).        
+00008370: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00008380: 2020 2020 2020 2020 2020 6c61 7965 722c            layer,
+00008390: 2064 6174 6174 7970 6520 3d20 5f70 6172   datatype = _par
+000083a0: 7365 5f6c 6179 6572 286c 6179 6572 290a  se_layer(layer).
+000083b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000083c0: 706f 6c79 676f 6e20 3d20 506f 6c79 676f  polygon = Polygo
+000083d0: 6e28 706f 6c79 676f 6e2e 706f 696e 7473  n(polygon.points
+000083e0: 2c20 6c61 7965 722c 2064 6174 6174 7970  , layer, datatyp
+000083f0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+00008400: 6966 2068 6173 6174 7472 2870 6f69 6e74  if hasattr(point
+00008410: 732c 2022 7072 6f70 6572 7469 6573 2229  s, "properties")
+00008420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008430: 2020 706f 6c79 676f 6e2e 7072 6f70 6572    polygon.proper
+00008440: 7469 6573 203d 2064 6565 7063 6f70 7928  ties = deepcopy(
+00008450: 706f 696e 7473 2e70 726f 7065 7274 6965  points.propertie
+00008460: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00008470: 7365 6c66 2e5f 6164 645f 706f 6c79 676f  self._add_polygo
+00008480: 6e73 2870 6f6c 7967 6f6e 290a 2020 2020  ns(polygon).    
+00008490: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+000084a0: 6f6c 7967 6f6e 0a0a 2020 2020 2020 2020  olygon..        
+000084b0: 656c 6966 2068 6173 6174 7472 2870 6f69  elif hasattr(poi
+000084c0: 6e74 732c 2022 6765 6f6d 7322 293a 0a20  nts, "geoms"):. 
+000084d0: 2020 2020 2020 2020 2020 2066 6f72 2067             for g
+000084e0: 656f 6d20 696e 2070 6f69 6e74 732e 6765  eom in points.ge
+000084f0: 6f6d 733a 0a20 2020 2020 2020 2020 2020  oms:.           
+00008500: 2020 2020 2070 6f6c 7967 6f6e 203d 2073       polygon = s
+00008510: 656c 662e 6164 645f 706f 6c79 676f 6e28  elf.add_polygon(
+00008520: 6765 6f6d 2c20 6c61 7965 723d 6c61 7965  geom, layer=laye
+00008530: 7229 0a20 2020 2020 2020 2020 2020 2072  r).            r
+00008540: 6574 7572 6e20 706f 6c79 676f 6e0a 2020  eturn polygon.  
+00008550: 2020 2020 2020 656c 6966 2068 6173 6174        elif hasat
+00008560: 7472 2870 6f69 6e74 732c 2022 6578 7465  tr(points, "exte
+00008570: 7269 6f72 2229 3a20 2023 2070 6f69 6e74  rior"):  # point
+00008580: 7320 6973 2061 2073 6861 7065 6c79 2050  s is a shapely P
+00008590: 6f6c 7967 6f6e 0a20 2020 2020 2020 2020  olygon.         
+000085a0: 2020 206c 6179 6572 2c20 6461 7461 7479     layer, dataty
+000085b0: 7065 203d 205f 7061 7273 655f 6c61 7965  pe = _parse_laye
+000085c0: 7228 6c61 7965 7229 0a20 2020 2020 2020  r(layer).       
+000085d0: 2020 2020 2070 6f69 6e74 735f 6f6e 5f67       points_on_g
+000085e0: 7269 6420 3d20 6e70 2e72 6f75 6e64 2870  rid = np.round(p
+000085f0: 6f69 6e74 732e 6578 7465 7269 6f72 2e63  oints.exterior.c
+00008600: 6f6f 7264 732c 2033 290a 2020 2020 2020  oords, 3).      
+00008610: 2020 2020 2020 706f 6c79 676f 6e20 3d20        polygon = 
+00008620: 6764 7374 6b2e 506f 6c79 676f 6e28 706f  gdstk.Polygon(po
+00008630: 696e 7473 5f6f 6e5f 6772 6964 2c20 6c61  ints_on_grid, la
+00008640: 7965 722c 2064 6174 6174 7970 6529 0a0a  yer, datatype)..
+00008650: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00008660: 6f69 6e74 732e 696e 7465 7269 6f72 733a  oints.interiors:
+00008670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008680: 2066 726f 6d20 7368 6170 656c 7920 696d   from shapely im
+00008690: 706f 7274 2067 6574 5f63 6f6f 7264 696e  port get_coordin
+000086a0: 6174 6573 0a0a 2020 2020 2020 2020 2020  ates..          
+000086b0: 2020 2020 2020 706f 696e 7473 5f6f 6e5f        points_on_
+000086c0: 6772 6964 5f69 6e74 6572 696f 7220 3d20  grid_interior = 
+000086d0: 6e70 2e72 6f75 6e64 2867 6574 5f63 6f6f  np.round(get_coo
+000086e0: 7264 696e 6174 6573 2870 6f69 6e74 732e  rdinates(points.
+000086f0: 696e 7465 7269 6f72 7329 2c20 3329 0a20  interiors), 3). 
+00008700: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00008710: 6f6c 7967 6f6e 5f69 6e74 6572 696f 7220  olygon_interior 
+00008720: 3d20 6764 7374 6b2e 506f 6c79 676f 6e28  = gdstk.Polygon(
+00008730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008740: 2020 2020 2070 6f69 6e74 735f 6f6e 5f67       points_on_g
+00008750: 7269 645f 696e 7465 7269 6f72 2c20 6c61  rid_interior, la
+00008760: 7965 722c 2064 6174 6174 7970 650a 2020  yer, datatype.  
+00008770: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00008780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008790: 706f 6c79 676f 6e73 203d 2067 6473 746b  polygons = gdstk
+000087a0: 2e62 6f6f 6c65 616e 280a 2020 2020 2020  .boolean(.      
+000087b0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+000087c0: 6c79 676f 6e2c 0a20 2020 2020 2020 2020  lygon,.         
+000087d0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+000087e0: 6f6e 5f69 6e74 6572 696f 722c 0a20 2020  on_interior,.   
+000087f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008800: 206f 7065 7261 7469 6f6e 3d22 6e6f 7422   operation="not"
+00008810: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008820: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
+00008830: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00008840: 2020 2020 2020 2064 6174 6174 7970 653d         datatype=
+00008850: 6461 7461 7479 7065 2c0a 2020 2020 2020  datatype,.      
+00008860: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00008870: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00008880: 706f 6c79 676f 6e20 696e 2070 6f6c 7967  polygon in polyg
+00008890: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
+000088a0: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
+000088b0: 6464 5f70 6f6c 7967 6f6e 7328 706f 6c79  dd_polygons(poly
+000088c0: 676f 6e29 0a20 2020 2020 2020 2020 2020  gon).           
+000088d0: 2020 2020 2072 6574 7572 6e20 706f 6c79       return poly
+000088e0: 676f 6e0a 0a20 2020 2020 2020 2020 2020  gon..           
+000088f0: 2073 656c 662e 5f61 6464 5f70 6f6c 7967   self._add_polyg
+00008900: 6f6e 7328 706f 6c79 676f 6e29 0a20 2020  ons(polygon).   
+00008910: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008920: 706f 6c79 676f 6e0a 0a20 2020 2020 2020  polygon..       
+00008930: 2070 6f69 6e74 7320 3d20 6e70 2e61 7361   points = np.asa
+00008940: 7272 6179 2870 6f69 6e74 7329 0a20 2020  rray(points).   
+00008950: 2020 2020 2069 6620 706f 696e 7473 2e6e       if points.n
+00008960: 6469 6d20 3d3d 2031 3a0a 2020 2020 2020  dim == 1:.      
+00008970: 2020 2020 2020 7265 7475 726e 205b 7365        return [se
+00008980: 6c66 2e61 6464 5f70 6f6c 7967 6f6e 2870  lf.add_polygon(p
+00008990: 6f6c 792c 206c 6179 6572 3d6c 6179 6572  oly, layer=layer
+000089a0: 2920 666f 7220 706f 6c79 2069 6e20 706f  ) for poly in po
+000089b0: 696e 7473 5d0a 2020 2020 2020 2020 6966  ints].        if
+000089c0: 206c 6179 6572 2069 7320 6e70 2e6e 616e   layer is np.nan
+000089d0: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
+000089e0: 7965 7220 3d20 300a 0a20 2020 2020 2020  yer = 0..       
+000089f0: 2069 6620 706f 696e 7473 2e6e 6469 6d20   if points.ndim 
+00008a00: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00008a10: 2020 2320 6164 6420 7369 6e67 6c65 2070    # add single p
+00008a20: 6f6c 7967 6f6e 2066 726f 6d20 706f 696e  olygon from poin
+00008a30: 7473 0a20 2020 2020 2020 2020 2020 2069  ts.            i
+00008a40: 6620 6c65 6e28 706f 696e 7473 5b30 5d29  f len(points[0])
+00008a50: 203e 2032 3a0a 2020 2020 2020 2020 2020   > 2:.          
+00008a60: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
+00008a70: 746f 2066 6f72 6d20 5b5b 312c 325d 2c5b  to form [[1,2],[
+00008a80: 332c 345d 2c5b 352c 365d 5d0a 2020 2020  3,4],[5,6]].    
+00008a90: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00008aa0: 7473 203d 206e 702e 636f 6c75 6d6e 5f73  ts = np.column_s
+00008ab0: 7461 636b 2870 6f69 6e74 7329 0a20 2020  tack(points).   
+00008ac0: 2020 2020 2020 2020 206c 6179 6572 2c20           layer, 
+00008ad0: 6461 7461 7479 7065 203d 205f 7061 7273  datatype = _pars
+00008ae0: 655f 6c61 7965 7228 6c61 7965 7229 0a20  e_layer(layer). 
+00008af0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00008b00: 6f6e 203d 2050 6f6c 7967 6f6e 2870 6f69  on = Polygon(poi
+00008b10: 6e74 732c 206c 6179 6572 3d6c 6179 6572  nts, layer=layer
+00008b20: 2c20 6461 7461 7479 7065 3d64 6174 6174  , datatype=datat
+00008b30: 7970 6529 0a20 2020 2020 2020 2020 2020  ype).           
+00008b40: 2073 656c 662e 5f61 6464 5f70 6f6c 7967   self._add_polyg
+00008b50: 6f6e 7328 706f 6c79 676f 6e29 0a20 2020  ons(polygon).   
+00008b60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008b70: 706f 6c79 676f 6e0a 2020 2020 2020 2020  polygon.        
+00008b80: 656c 6966 2070 6f69 6e74 732e 6e64 696d  elif points.ndim
+00008b90: 203d 3d20 333a 0a20 2020 2020 2020 2020   == 3:.         
+00008ba0: 2020 206c 6179 6572 2c20 6461 7461 7479     layer, dataty
+00008bb0: 7065 203d 205f 7061 7273 655f 6c61 7965  pe = _parse_laye
+00008bc0: 7228 6c61 7965 7229 0a20 2020 2020 2020  r(layer).       
+00008bd0: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
+00008be0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00008bf0: 2020 506f 6c79 676f 6e28 7070 6f69 6e74    Polygon(ppoint
+00008c00: 732c 206c 6179 6572 3d6c 6179 6572 2c20  s, layer=layer, 
+00008c10: 6461 7461 7479 7065 3d64 6174 6174 7970  datatype=datatyp
+00008c20: 6529 2066 6f72 2070 706f 696e 7473 2069  e) for ppoints i
+00008c30: 6e20 706f 696e 7473 0a20 2020 2020 2020  n points.       
+00008c40: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+00008c50: 2020 2073 656c 662e 5f61 6464 5f70 6f6c     self._add_pol
+00008c60: 7967 6f6e 7328 2a70 6f6c 7967 6f6e 7329  ygons(*polygons)
+00008c70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00008c80: 7572 6e20 706f 6c79 676f 6e73 0a20 2020  urn polygons.   
+00008c90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00008ca0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00008cb0: 7565 4572 726f 7228 6622 556e 6162 6c65  ueError(f"Unable
+00008cc0: 2074 6f20 6164 6420 7b70 6f69 6e74 732e   to add {points.
+00008cd0: 6e64 696d 7d2d 6469 6d65 6e73 696f 6e61  ndim}-dimensiona
+00008ce0: 6c20 706f 696e 7473 206f 626a 6563 7422  l points object"
+00008cf0: 290a 0a20 2020 2064 6566 205f 6164 645f  )..    def _add_
+00008d00: 706f 6c79 676f 6e73 2873 656c 662c 202a  polygons(self, *
+00008d10: 706f 6c79 676f 6e73 3a20 4c69 7374 5b50  polygons: List[P
+00008d20: 6f6c 7967 6f6e 5d29 202d 3e20 4e6f 6e65  olygon]) -> None
+00008d30: 3a0a 2020 2020 2020 2020 7365 6c66 2e69  :.        self.i
+00008d40: 735f 756e 6c6f 636b 6564 2829 0a20 2020  s_unlocked().   
+00008d50: 2020 2020 2073 656c 662e 5f63 656c 6c2e       self._cell.
+00008d60: 6164 6428 2a70 6f6c 7967 6f6e 7329 0a0a  add(*polygons)..
+00008d70: 2020 2020 6465 6620 636f 7079 2873 656c      def copy(sel
+00008d80: 6629 202d 3e20 436f 6d70 6f6e 656e 743a  f) -> Component:
+00008d90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00008da0: 636f 7079 2873 656c 6629 0a0a 2020 2020  copy(self)..    
+00008db0: 6465 6620 6164 645f 7265 665f 636f 6e74  def add_ref_cont
+00008dc0: 6169 6e65 7228 7365 6c66 2c20 636f 6d70  ainer(self, comp
+00008dd0: 6f6e 656e 743a 2043 6f6d 706f 6e65 6e74  onent: Component
+00008de0: 2920 2d3e 2043 6f6d 706f 6e65 6e74 5265  ) -> ComponentRe
+00008df0: 6665 7265 6e63 653a 0a20 2020 2020 2020  ference:.       
+00008e00: 2022 2222 4164 6420 7265 6665 7265 6e63   """Add referenc
+00008e10: 652c 2070 6f72 7473 2061 6e64 2063 6f70  e, ports and cop
+00008e20: 795f 6368 696c 645f 696e 666f 2e22 2222  y_child_info."""
+00008e30: 0a20 2020 2020 2020 2072 6566 203d 2073  .        ref = s
+00008e40: 656c 6620 3c3c 2063 6f6d 706f 6e65 6e74  elf << component
+00008e50: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+00008e60: 645f 706f 7274 7328 7265 662e 706f 7274  d_ports(ref.port
+00008e70: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+00008e80: 636f 7079 5f63 6869 6c64 5f69 6e66 6f28  copy_child_info(
+00008e90: 636f 6d70 6f6e 656e 7429 0a20 2020 2020  component).     
+00008ea0: 2020 2072 6574 7572 6e20 7265 660a 0a20     return ref.. 
+00008eb0: 2020 2064 6566 2063 6f70 795f 6368 696c     def copy_chil
+00008ec0: 645f 696e 666f 2873 656c 662c 2063 6f6d  d_info(self, com
+00008ed0: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
+00008ee0: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
+00008ef0: 2020 2020 2222 2243 6f70 7920 616e 6420      """Copy and 
+00008f00: 7365 7474 696e 6773 2069 6e66 6f20 6672  settings info fr
+00008f10: 6f6d 2063 6869 6c64 2063 6f6d 706f 6e65  om child compone
+00008f20: 6e74 2069 6e74 6f20 7061 7265 6e74 2e0a  nt into parent..
+00008f30: 0a20 2020 2020 2020 2050 6172 656e 7420  .        Parent 
+00008f40: 636f 6d70 6f6e 656e 7473 2063 616e 2061  components can a
+00008f50: 6363 6573 7320 6368 696c 6420 6365 6c6c  ccess child cell
+00008f60: 7320 7365 7474 696e 6773 2e0a 2020 2020  s settings..    
+00008f70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00008f80: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00008f90: 6528 636f 6d70 6f6e 656e 742c 2028 436f  e(component, (Co
+00008fa0: 6d70 6f6e 656e 742c 2043 6f6d 706f 6e65  mponent, Compone
+00008fb0: 6e74 5265 6665 7265 6e63 6529 293a 0a20  ntReference)):. 
+00008fc0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00008fd0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00008fe0: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
+00008ff0: 7479 7065 2863 6f6d 706f 6e65 6e74 297d  type(component)}
+00009000: 2220 2269 7320 6e6f 7420 6120 436f 6d70  " "is not a Comp
+00009010: 6f6e 656e 7420 6f72 2043 6f6d 706f 6e65  onent or Compone
+00009020: 6e74 5265 6665 7265 6e63 6522 0a20 2020  ntReference".   
+00009030: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00009040: 2020 2020 7365 6c66 2e67 6574 5f63 6869      self.get_chi
+00009050: 6c64 5f6e 616d 6520 3d20 5472 7565 0a20  ld_name = True. 
+00009060: 2020 2020 2020 2073 656c 662e 6368 696c         self.chil
+00009070: 6420 3d20 636f 6d70 6f6e 656e 740a 2020  d = component.  
+00009080: 2020 2020 2020 7365 6c66 2e69 6e66 6f2e        self.info.
+00009090: 7570 6461 7465 2863 6f6d 706f 6e65 6e74  update(component
+000090a0: 2e69 6e66 6f29 0a20 2020 2020 2020 2073  .info).        s
+000090b0: 656c 662e 7365 7474 696e 6773 2e75 7064  elf.settings.upd
+000090c0: 6174 6528 636f 6d70 6f6e 656e 742e 7365  ate(component.se
+000090d0: 7474 696e 6773 290a 0a20 2020 2040 7072  ttings)..    @pr
+000090e0: 6f70 6572 7479 0a20 2020 2064 6566 2073  operty.    def s
+000090f0: 697a 655f 696e 666f 2873 656c 6629 202d  ize_info(self) -
+00009100: 3e20 5369 7a65 496e 666f 3a0a 2020 2020  > SizeInfo:.    
+00009110: 2020 2020 2222 2253 697a 6520 696e 666f      """Size info
+00009120: 206f 6620 7468 6520 636f 6d70 6f6e 656e   of the componen
+00009130: 742e 2222 220a 2020 2020 2020 2020 7265  t.""".        re
+00009140: 7475 726e 2053 697a 6549 6e66 6f28 7365  turn SizeInfo(se
+00009150: 6c66 2e62 626f 7829 0a0a 2020 2020 6465  lf.bbox)..    de
+00009160: 6620 6765 745f 7365 7474 696e 6728 7365  f get_setting(se
+00009170: 6c66 2c20 7365 7474 696e 673a 2073 7472  lf, setting: str
+00009180: 2920 2d3e 2055 6e69 6f6e 5b73 7472 2c20  ) -> Union[str, 
+00009190: 696e 742c 2066 6c6f 6174 5d3a 0a20 2020  int, float]:.   
+000091a0: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
+000091b0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+000091c0: 6e66 6f2e 6765 7428 7365 7474 696e 6729  nfo.get(setting)
+000091d0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+000091e0: 7365 6c66 2e73 6574 7469 6e67 732e 6675  self.settings.fu
+000091f0: 6c6c 2e67 6574 2873 6574 7469 6e67 290a  ll.get(setting).
+00009200: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
+00009210: 656c 662e 6d65 7461 6461 7461 5f63 6869  elf.metadata_chi
+00009220: 6c64 2e67 6574 2873 6574 7469 6e67 290a  ld.get(setting).
+00009230: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00009240: 6566 2069 735f 756e 6c6f 636b 6564 2873  ef is_unlocked(s
+00009250: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00009260: 2020 2020 2020 2222 2252 6169 7365 7320        """Raises 
+00009270: 6572 726f 7220 6966 2043 6f6d 706f 6e65  error if Compone
+00009280: 6e74 2069 7320 6c6f 636b 6564 2e22 2222  nt is locked."""
+00009290: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000092a0: 2e5f 6c6f 636b 6564 3a0a 2020 2020 2020  ._locked:.      
+000092b0: 2020 2020 2020 7261 6973 6520 4d75 7461        raise Muta
+000092c0: 6269 6c69 7479 4572 726f 7228 0a20 2020  bilityError(.   
+000092d0: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
+000092e0: 6f6d 706f 6e65 6e74 207b 7365 6c66 2e6e  omponent {self.n
+000092f0: 616d 6521 727d 2063 616e 6e6f 7420 6265  ame!r} cannot be
+00009300: 206d 6f64 6966 6965 6420 6173 2069 7427   modified as it'
+00009310: 7320 616c 7265 6164 7920 6f6e 2063 6163  s already on cac
+00009320: 6865 2e20 220a 2020 2020 2020 2020 2020  he. ".          
+00009330: 2020 2020 2020 2b20 6d75 7461 6269 6c69        + mutabili
+00009340: 7479 5f65 7272 6f72 5f6d 6573 7361 6765  ty_error_message
+00009350: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00009360: 2020 2020 6465 6620 5f61 6464 2873 656c      def _add(sel
+00009370: 662c 2065 6c65 6d65 6e74 2920 2d3e 204e  f, element) -> N
+00009380: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00009390: 4164 6420 6120 6e65 7720 656c 656d 656e  Add a new elemen
+000093a0: 7420 6f72 206c 6973 7420 6f66 2065 6c65  t or list of ele
+000093b0: 6d65 6e74 7320 746f 2074 6869 7320 436f  ments to this Co
+000093c0: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
+000093d0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+000093e0: 2020 2020 656c 656d 656e 743a 2050 6f6c      element: Pol
+000093f0: 7967 6f6e 2c20 436f 6d70 6f6e 656e 7452  ygon, ComponentR
+00009400: 6566 6572 656e 6365 206f 7220 6974 6572  eference or iter
+00009410: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
+00009420: 2020 2020 2054 6865 2065 6c65 6d65 6e74       The element
+00009430: 206f 7220 6974 6572 6162 6c65 206f 6620   or iterable of 
+00009440: 656c 656d 656e 7473 2074 6f20 6265 2069  elements to be i
+00009450: 6e73 6572 7465 6420 696e 2074 6869 7320  nserted in this 
+00009460: 6365 6c6c 2e0a 0a20 2020 2020 2020 2052  cell...        R
+00009470: 6169 7365 733a 0a20 2020 2020 2020 2020  aises:.         
+00009480: 2020 204d 7574 6162 696c 6974 7945 7272     MutabilityErr
+00009490: 6f72 3a20 6966 2063 6f6d 706f 6e65 6e74  or: if component
+000094a0: 2069 7320 6c6f 636b 6564 2e0a 2020 2020   is locked..    
+000094b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000094c0: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
+000094d0: 2829 0a20 2020 2020 2020 2069 6620 6973  ().        if is
+000094e0: 696e 7374 616e 6365 2865 6c65 6d65 6e74  instance(element
+000094f0: 2c20 436f 6d70 6f6e 656e 7452 6566 6572  , ComponentRefer
+00009500: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
+00009510: 2020 2073 656c 662e 5f63 656c 6c2e 6164     self._cell.ad
+00009520: 6428 656c 656d 656e 742e 5f72 6566 6572  d(element._refer
+00009530: 656e 6365 290a 2020 2020 2020 2020 2020  ence).          
+00009540: 2020 7365 6c66 2e5f 7265 6665 7265 6e63    self._referenc
+00009550: 6573 2e61 7070 656e 6428 656c 656d 656e  es.append(elemen
+00009560: 7429 0a20 2020 2020 2020 2065 6c73 653a  t).        else:
+00009570: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009580: 662e 5f63 656c 6c2e 6164 6428 656c 656d  f._cell.add(elem
+00009590: 656e 7429 0a0a 2020 2020 6465 6620 6164  ent)..    def ad
+000095a0: 6428 7365 6c66 2c20 656c 656d 656e 7429  d(self, element)
+000095b0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+000095c0: 2020 2222 2241 6464 2061 206e 6577 2065    """Add a new e
+000095d0: 6c65 6d65 6e74 206f 7220 6c69 7374 206f  lement or list o
+000095e0: 6620 656c 656d 656e 7473 2074 6f20 7468  f elements to th
+000095f0: 6973 2043 6f6d 706f 6e65 6e74 2e0a 0a20  is Component... 
+00009600: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00009610: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+00009620: 3a20 506f 6c79 676f 6e2c 2043 6f6d 706f  : Polygon, Compo
+00009630: 6e65 6e74 5265 6665 7265 6e63 6520 6f72  nentReference or
+00009640: 2069 7465 7261 626c 650a 2020 2020 2020   iterable.      
+00009650: 2020 2020 2020 2020 2020 5468 6520 656c            The el
+00009660: 656d 656e 7420 6f72 2069 7465 7261 626c  ement or iterabl
+00009670: 6520 6f66 2065 6c65 6d65 6e74 7320 746f  e of elements to
+00009680: 2062 6520 696e 7365 7274 6564 2069 6e20   be inserted in 
+00009690: 7468 6973 2063 656c 6c2e 0a0a 2020 2020  this cell...    
+000096a0: 2020 2020 5261 6973 6573 3a0a 2020 2020      Raises:.    
+000096b0: 2020 2020 2020 2020 4d75 7461 6269 6c69          Mutabili
+000096c0: 7479 4572 726f 723a 2069 6620 636f 6d70  tyError: if comp
+000096d0: 6f6e 656e 7420 6973 206c 6f63 6b65 642e  onent is locked.
+000096e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000096f0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00009700: 6365 2865 6c65 6d65 6e74 2c20 436f 6d70  ce(element, Comp
+00009710: 6f6e 656e 7452 6566 6572 656e 6365 293a  onentReference):
+00009720: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009730: 662e 5f72 6567 6973 7465 725f 7265 6665  f._register_refe
+00009740: 7265 6e63 6528 656c 656d 656e 7429 0a20  rence(element). 
+00009750: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009760: 5f61 6464 2865 6c65 6d65 6e74 290a 2020  _add(element).  
+00009770: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+00009780: 7461 6e63 6528 656c 656d 656e 742c 2049  tance(element, I
+00009790: 7465 7261 626c 6529 3a0a 2020 2020 2020  terable):.      
+000097a0: 2020 2020 2020 666f 7220 7375 6265 6c65        for subele
+000097b0: 6d65 6e74 2069 6e20 656c 656d 656e 743a  ment in element:
+000097c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000097d0: 2073 656c 662e 6164 6428 7375 6265 6c65   self.add(subele
+000097e0: 6d65 6e74 290a 2020 2020 2020 2020 656c  ment).        el
+000097f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00009800: 7365 6c66 2e5f 6164 6428 656c 656d 656e  self._add(elemen
+00009810: 7429 0a0a 2020 2020 6465 6620 6164 645f  t)..    def add_
+00009820: 6172 7261 7928 0a20 2020 2020 2020 2073  array(.        s
+00009830: 656c 662c 0a20 2020 2020 2020 2063 6f6d  elf,.        com
+00009840: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
+00009850: 742c 0a20 2020 2020 2020 2063 6f6c 756d  t,.        colum
+00009860: 6e73 3a20 696e 7420 3d20 322c 0a20 2020  ns: int = 2,.   
+00009870: 2020 2020 2072 6f77 733a 2069 6e74 203d       rows: int =
+00009880: 2032 2c0a 2020 2020 2020 2020 7370 6163   2,.        spac
+00009890: 696e 673a 2054 7570 6c65 5b66 6c6f 6174  ing: Tuple[float
+000098a0: 2c20 666c 6f61 745d 203d 2028 3130 302c  , float] = (100,
+000098b0: 2031 3030 292c 0a20 2020 2020 2020 2061   100),.        a
+000098c0: 6c69 6173 3a20 4f70 7469 6f6e 616c 5b73  lias: Optional[s
+000098d0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+000098e0: 2920 2d3e 2043 6f6d 706f 6e65 6e74 5265  ) -> ComponentRe
+000098f0: 6665 7265 6e63 653a 0a20 2020 2020 2020  ference:.       
+00009900: 2022 2222 4372 6561 7465 7320 6120 436f   """Creates a Co
+00009910: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+00009920: 2072 6566 6572 656e 6365 2074 6f20 6120   reference to a 
+00009930: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+00009940: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00009950: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
+00009960: 2054 6865 2072 6566 6572 656e 6365 6420   The referenced 
+00009970: 636f 6d70 6f6e 656e 742e 0a20 2020 2020  component..     
+00009980: 2020 2020 2020 2063 6f6c 756d 6e73 3a20         columns: 
+00009990: 4e75 6d62 6572 206f 6620 636f 6c75 6d6e  Number of column
+000099a0: 7320 696e 2074 6865 2061 7272 6179 2e0a  s in the array..
+000099b0: 2020 2020 2020 2020 2020 2020 726f 7773              rows
+000099c0: 3a20 4e75 6d62 6572 206f 6620 726f 7773  : Number of rows
+000099d0: 2069 6e20 7468 6520 6172 7261 792e 0a20   in the array.. 
+000099e0: 2020 2020 2020 2020 2020 2073 7061 6369             spaci
+000099f0: 6e67 3a20 6172 7261 792d 6c69 6b65 5b32  ng: array-like[2
+00009a00: 5d20 6f66 2069 6e74 206f 7220 666c 6f61  ] of int or floa
+00009a10: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
+00009a20: 2020 2044 6973 7461 6e63 6520 6265 7477     Distance betw
+00009a30: 6565 6e20 6164 6a61 6365 6e74 2063 6f6c  een adjacent col
+00009a40: 756d 6e73 2061 6e64 2061 646a 6163 656e  umns and adjacen
+00009a50: 7420 726f 7773 2e0a 2020 2020 2020 2020  t rows..        
+00009a60: 2020 2020 616c 6961 733a 2073 7472 206f      alias: str o
+00009a70: 7220 4e6f 6e65 2e20 416c 6961 7320 6f66  r None. Alias of
+00009a80: 2074 6865 2072 6566 6572 656e 6365 6420   the referenced 
+00009a90: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+00009aa0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00009ab0: 2020 2020 2020 2020 613a 2043 6f6d 706f          a: Compo
+00009ac0: 6e65 6e74 5265 6665 7265 6e63 6520 636f  nentReference co
+00009ad0: 6e74 6169 6e69 6e67 2072 6566 6572 656e  ntaining referen
+00009ae0: 6365 7320 746f 2074 6865 2043 6f6d 706f  ces to the Compo
+00009af0: 6e65 6e74 2e0a 2020 2020 2020 2020 2222  nent..        ""
+00009b00: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+00009b10: 2069 7369 6e73 7461 6e63 6528 636f 6d70   isinstance(comp
+00009b20: 6f6e 656e 742c 2043 6f6d 706f 6e65 6e74  onent, Component
+00009b30: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00009b40: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
+00009b50: 6164 645f 6172 7261 7928 2920 6e65 6564  add_array() need
+00009b60: 7320 6120 436f 6d70 6f6e 656e 7420 6f62  s a Component ob
+00009b70: 6a65 6374 2e22 290a 2020 2020 2020 2020  ject.").        
+00009b80: 7265 6620 3d20 436f 6d70 6f6e 656e 7452  ref = ComponentR
+00009b90: 6566 6572 656e 6365 280a 2020 2020 2020  eference(.      
+00009ba0: 2020 2020 2020 636f 6d70 6f6e 656e 743d        component=
+00009bb0: 636f 6d70 6f6e 656e 742c 0a20 2020 2020  component,.     
+00009bc0: 2020 2020 2020 2063 6f6c 756d 6e73 3d69         columns=i
+00009bd0: 6e74 2872 6f75 6e64 2863 6f6c 756d 6e73  nt(round(columns
+00009be0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00009bf0: 726f 7773 3d69 6e74 2872 6f75 6e64 2872  rows=int(round(r
+00009c00: 6f77 7329 292c 0a20 2020 2020 2020 2020  ows)),.         
+00009c10: 2020 2073 7061 6369 6e67 3d73 7061 6369     spacing=spaci
+00009c20: 6e67 2c0a 2020 2020 2020 2020 290a 2020  ng,.        ).  
+00009c30: 2020 2020 2020 7265 662e 6e61 6d65 203d        ref.name =
+00009c40: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00009c50: 6c66 2e5f 6164 6428 7265 6629 0a20 2020  lf._add(ref).   
+00009c60: 2020 2020 2073 656c 662e 5f72 6567 6973       self._regis
+00009c70: 7465 725f 7265 6665 7265 6e63 6528 7265  ter_reference(re
+00009c80: 6665 7265 6e63 653d 7265 662c 2061 6c69  ference=ref, ali
+00009c90: 6173 3d61 6c69 6173 290a 2020 2020 2020  as=alias).      
+00009ca0: 2020 7265 7475 726e 2072 6566 0a0a 2020    return ref..  
+00009cb0: 2020 6465 6620 6469 7374 7269 6275 7465    def distribute
+00009cc0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00009cd0: 656c 656d 656e 7473 3d22 616c 6c22 2c20  elements="all", 
+00009ce0: 6469 7265 6374 696f 6e3d 2278 222c 2073  direction="x", s
+00009cf0: 7061 6369 6e67 3d31 3030 2c20 7365 7061  pacing=100, sepa
+00009d00: 7261 7469 6f6e 3d54 7275 652c 2065 6467  ration=True, edg
+00009d10: 653d 2263 656e 7465 7222 0a20 2020 2029  e="center".    )
+00009d20: 3a0a 2020 2020 2020 2020 2222 2244 6973  :.        """Dis
+00009d30: 7472 6962 7574 6573 2074 6865 2073 7065  tributes the spe
+00009d40: 6369 6669 6564 2065 6c65 6d65 6e74 7320  cified elements 
+00009d50: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
+00009d60: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00009d70: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
+00009d80: 6d65 6e74 7320 3a20 6172 7261 792d 6c69  ments : array-li
+00009d90: 6b65 206f 6620 6f62 6a65 6374 7320 6f72  ke of objects or
+00009da0: 2027 616c 6c27 0a20 2020 2020 2020 2020   'all'.         
+00009db0: 2020 2020 2020 2045 6c65 6d65 6e74 7320         Elements 
+00009dc0: 746f 2064 6973 7472 6962 7574 652e 0a20  to distribute.. 
+00009dd0: 2020 2020 2020 2020 2020 2064 6972 6563             direc
+00009de0: 7469 6f6e 203a 207b 2778 272c 2027 7927  tion : {'x', 'y'
+00009df0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00009e00: 2020 4469 7265 6374 696f 6e20 6f66 2064    Direction of d
+00009e10: 6973 7472 6962 7574 696f 6e3b 2065 6974  istribution; eit
+00009e20: 6865 7220 6120 6c69 6e65 2069 6e20 7468  her a line in th
+00009e30: 6520 782d 6469 7265 6374 696f 6e20 6f72  e x-direction or
+00009e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e50: 2079 2d64 6972 6563 7469 6f6e 2e0a 2020   y-direction..  
+00009e60: 2020 2020 2020 2020 2020 7370 6163 696e            spacin
+00009e70: 6720 3a20 696e 7420 6f72 2066 6c6f 6174  g : int or float
+00009e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e90: 2044 6973 7461 6e63 6520 6265 7477 6565   Distance betwee
+00009ea0: 6e20 656c 656d 656e 7473 2e0a 2020 2020  n elements..    
+00009eb0: 2020 2020 2020 2020 7365 7061 7261 7469          separati
+00009ec0: 6f6e 203a 2062 6f6f 6c0a 2020 2020 2020  on : bool.      
+00009ed0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00009ee0: 652c 2067 7561 7261 6e74 6565 7320 656c  e, guarantees el
+00009ef0: 656d 656e 7473 2061 7265 2073 6570 6172  ements are separ
+00009f00: 6174 6564 2077 6974 6820 6120 6669 7865  ated with a fixe
+00009f10: 6420 7370 6163 696e 670a 2020 2020 2020  d spacing.      
+00009f20: 2020 2020 2020 2020 2020 6265 7477 6565            betwee
+00009f30: 6e3b 2069 6620 2046 616c 7365 2c20 656c  n; if  False, el
+00009f40: 656d 656e 7473 2061 7265 2073 7061 6365  ements are space
+00009f50: 6420 6576 656e 6c79 2061 6c6f 6e67 2061  d evenly along a
+00009f60: 2067 7269 642e 0a20 2020 2020 2020 2020   grid..         
+00009f70: 2020 2065 6467 6520 3a20 7b27 7827 2c20     edge : {'x', 
+00009f80: 2778 6d69 6e27 2c20 2778 6d61 7827 2c20  'xmin', 'xmax', 
+00009f90: 2779 272c 2027 796d 696e 272c 2027 796d  'y', 'ymin', 'ym
+00009fa0: 6178 277d 0a20 2020 2020 2020 2020 2020  ax'}.           
+00009fb0: 2020 2020 2057 6869 6368 2065 6467 6520       Which edge 
+00009fc0: 746f 2070 6572 666f 726d 2074 6865 2064  to perform the d
+00009fd0: 6973 7472 6962 7574 696f 6e20 616c 6f6e  istribution alon
+00009fe0: 6720 2875 6e75 7365 6420 6966 0a20 2020  g (unused if.   
+00009ff0: 2020 2020 2020 2020 2020 2020 2073 6570               sep
+0000a000: 6172 6174 696f 6e20 3d3d 2054 7275 6529  aration == True)
+0000a010: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000a020: 2020 2020 2020 6966 2065 6c65 6d65 6e74        if element
+0000a030: 7320 3d3d 2022 616c 6c22 3a0a 2020 2020  s == "all":.    
+0000a040: 2020 2020 2020 2020 656c 656d 656e 7473          elements
+0000a050: 203d 2073 656c 662e 706f 6c79 676f 6e73   = self.polygons
+0000a060: 202b 2073 656c 662e 7265 6665 7265 6e63   + self.referenc
+0000a070: 6573 0a20 2020 2020 2020 205f 6469 7374  es.        _dist
+0000a080: 7269 6275 7465 280a 2020 2020 2020 2020  ribute(.        
+0000a090: 2020 2020 656c 656d 656e 7473 3d65 6c65      elements=ele
+0000a0a0: 6d65 6e74 732c 0a20 2020 2020 2020 2020  ments,.         
+0000a0b0: 2020 2064 6972 6563 7469 6f6e 3d64 6972     direction=dir
+0000a0c0: 6563 7469 6f6e 2c0a 2020 2020 2020 2020  ection,.        
+0000a0d0: 2020 2020 7370 6163 696e 673d 7370 6163      spacing=spac
+0000a0e0: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
+0000a0f0: 2073 6570 6172 6174 696f 6e3d 7365 7061   separation=sepa
+0000a100: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
+0000a110: 2020 2020 6564 6765 3d65 6467 652c 0a20      edge=edge,. 
+0000a120: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000a130: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+0000a140: 2020 6465 6620 616c 6967 6e28 7365 6c66    def align(self
+0000a150: 2c20 656c 656d 656e 7473 3d22 616c 6c22  , elements="all"
+0000a160: 2c20 616c 6967 6e6d 656e 743d 2279 6d61  , alignment="yma
+0000a170: 7822 293a 0a20 2020 2020 2020 2022 2222  x"):.        """
+0000a180: 416c 6967 6e20 656c 656d 656e 7473 2069  Align elements i
+0000a190: 6e20 7468 6520 436f 6d70 6f6e 656e 742e  n the Component.
+0000a1a0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+0000a1b0: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+0000a1c0: 656e 7473 203a 2061 7272 6179 2d6c 696b  ents : array-lik
+0000a1d0: 6520 6f66 206f 626a 6563 7473 2c20 6f72  e of objects, or
+0000a1e0: 2027 616c 6c27 0a20 2020 2020 2020 2020   'all'.         
+0000a1f0: 2020 2020 2020 2045 6c65 6d65 6e74 7320         Elements 
+0000a200: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
+0000a210: 2074 6f20 616c 6967 6e2e 0a20 2020 2020   to align..     
+0000a220: 2020 2020 2020 2061 6c69 676e 6d65 6e74         alignment
+0000a230: 203a 207b 2778 272c 2027 7927 2c20 2778   : {'x', 'y', 'x
+0000a240: 6d69 6e27 2c20 2778 6d61 7827 2c20 2779  min', 'xmax', 'y
+0000a250: 6d69 6e27 2c20 2779 6d61 7827 7d0a 2020  min', 'ymax'}.  
+0000a260: 2020 2020 2020 2020 2020 2020 2020 5768                Wh
+0000a270: 6963 6820 6564 6765 2074 6f20 616c 6967  ich edge to alig
+0000a280: 6e20 616c 6f6e 6720 2865 2e67 2e20 2779  n along (e.g. 'y
+0000a290: 6d61 7827 2077 696c 6c20 6d6f 7665 2074  max' will move t
+0000a2a0: 6865 2065 6c65 6d65 6e74 7320 7375 6368  he elements such
+0000a2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a2c0: 2074 6861 7420 616c 6c20 6f66 2074 6865   that all of the
+0000a2d0: 6972 2074 6f70 6d6f 7374 2070 6f69 6e74  ir topmost point
+0000a2e0: 7320 6172 6520 616c 6967 6e65 6429 2e0a  s are aligned)..
+0000a2f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000a300: 2020 2020 6966 2065 6c65 6d65 6e74 7320      if elements 
+0000a310: 3d3d 2022 616c 6c22 3a0a 2020 2020 2020  == "all":.      
+0000a320: 2020 2020 2020 656c 656d 656e 7473 203d        elements =
+0000a330: 2073 656c 662e 706f 6c79 676f 6e73 202b   self.polygons +
+0000a340: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
+0000a350: 0a20 2020 2020 2020 205f 616c 6967 6e28  .        _align(
+0000a360: 656c 656d 656e 7473 2c20 616c 6967 6e6d  elements, alignm
+0000a370: 656e 743d 616c 6967 6e6d 656e 7429 0a20  ent=alignment). 
+0000a380: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000a390: 6c66 0a0a 2020 2020 6465 6620 666c 6174  lf..    def flat
+0000a3a0: 7465 6e28 7365 6c66 2c20 7369 6e67 6c65  ten(self, single
+0000a3b0: 5f6c 6179 6572 3a20 4f70 7469 6f6e 616c  _layer: Optional
+0000a3c0: 5b4c 6179 6572 5370 6563 5d20 3d20 4e6f  [LayerSpec] = No
+0000a3d0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+0000a3e0: 5265 7475 726e 7320 6120 666c 6174 7465  Returns a flatte
+0000a3f0: 6e65 6420 636f 7079 206f 6620 7468 6520  ned copy of the 
+0000a400: 636f 6d70 6f6e 656e 742e 0a0a 2020 2020  component...    
+0000a410: 2020 2020 466c 6174 7465 6e73 2074 6865      Flattens the
+0000a420: 2068 6965 7261 7263 6879 206f 6620 7468   hierarchy of th
+0000a430: 6520 436f 6d70 6f6e 656e 7420 7375 6368  e Component such
+0000a440: 2074 6861 7420 7468 6572 6520 6172 6520   that there are 
+0000a450: 6e6f 206c 6f6e 6765 720a 2020 2020 2020  no longer.      
+0000a460: 2020 616e 7920 7265 6665 7265 6e63 6573    any references
+0000a470: 2074 6f20 6f74 6865 7220 436f 6d70 6f6e   to other Compon
+0000a480: 656e 7473 2e20 416c 6c20 706f 6c79 676f  ents. All polygo
+0000a490: 6e73 2061 6e64 206c 6162 656c 7320 6672  ns and labels fr
+0000a4a0: 6f6d 0a20 2020 2020 2020 2075 6e64 6572  om.        under
+0000a4b0: 6c79 696e 6720 7265 6665 7265 6e63 6573  lying references
+0000a4c0: 2061 7265 2063 6f70 6965 6420 616e 6420   are copied and 
+0000a4d0: 706c 6163 6564 2069 6e20 7468 6520 746f  placed in the to
+0000a4e0: 702d 6c65 7665 6c20 436f 6d70 6f6e 656e  p-level Componen
+0000a4f0: 742e 0a20 2020 2020 2020 2049 6620 7369  t..        If si
+0000a500: 6e67 6c65 5f6c 6179 6572 2069 7320 7370  ngle_layer is sp
+0000a510: 6563 6966 6965 642c 2061 6c6c 2070 6f6c  ecified, all pol
+0000a520: 7967 6f6e 7320 6172 6520 6d6f 7665 6420  ygons are moved 
+0000a530: 746f 2074 6861 7420 6c61 7965 722e 0a0a  to that layer...
+0000a540: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+0000a550: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
+0000a560: 5f6c 6179 6572 3a20 6d6f 7665 2061 6c6c  _layer: move all
+0000a570: 2070 6f6c 7967 6f6e 7320 6172 6520 6d6f   polygons are mo
+0000a580: 7665 6420 746f 2074 6865 2073 7065 6369  ved to the speci
+0000a590: 6669 6564 2028 6f70 7469 6f6e 616c 292e  fied (optional).
+0000a5a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000a5b0: 2020 2020 2063 6f6d 706f 6e65 6e74 5f66       component_f
+0000a5c0: 6c61 7420 3d20 436f 6d70 6f6e 656e 7428  lat = Component(
+0000a5d0: 290a 0a20 2020 2020 2020 205f 6365 6c6c  )..        _cell
+0000a5e0: 203d 2073 656c 662e 5f63 656c 6c2e 636f   = self._cell.co
+0000a5f0: 7079 286e 616d 653d 636f 6d70 6f6e 656e  py(name=componen
+0000a600: 745f 666c 6174 2e6e 616d 6529 0a20 2020  t_flat.name).   
+0000a610: 2020 2020 205f 6365 6c6c 203d 205f 6365       _cell = _ce
+0000a620: 6c6c 2e66 6c61 7474 656e 2829 0a20 2020  ll.flatten().   
+0000a630: 2020 2020 2063 6f6d 706f 6e65 6e74 5f66       component_f
+0000a640: 6c61 742e 5f63 656c 6c20 3d20 5f63 656c  lat._cell = _cel
+0000a650: 6c0a 2020 2020 2020 2020 6966 2073 696e  l.        if sin
+0000a660: 676c 655f 6c61 7965 7220 6973 206e 6f74  gle_layer is not
+0000a670: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000a680: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000a690: 7279 2069 6d70 6f72 7420 6765 745f 6c61  ry import get_la
+0000a6a0: 7965 720a 0a20 2020 2020 2020 2020 2020  yer..           
+0000a6b0: 206c 6179 6572 2c20 6461 7461 7479 7065   layer, datatype
+0000a6c0: 203d 2067 6574 5f6c 6179 6572 2873 696e   = get_layer(sin
+0000a6d0: 676c 655f 6c61 7965 7229 0a20 2020 2020  gle_layer).     
+0000a6e0: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
+0000a6f0: 6f6e 2069 6e20 5f63 656c 6c2e 706f 6c79  on in _cell.poly
+0000a700: 676f 6e73 3a0a 2020 2020 2020 2020 2020  gons:.          
+0000a710: 2020 2020 2020 706f 6c79 676f 6e2e 6c61        polygon.la
+0000a720: 7965 7220 3d20 6c61 7965 720a 2020 2020  yer = layer.    
+0000a730: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
+0000a740: 676f 6e2e 6461 7461 7479 7065 203d 2064  gon.datatype = d
+0000a750: 6174 6174 7970 650a 2020 2020 2020 2020  atatype.        
+0000a760: 2020 2020 666f 7220 7061 7468 2069 6e20      for path in 
+0000a770: 5f63 656c 6c2e 7061 7468 733a 0a20 2020  _cell.paths:.   
+0000a780: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+0000a790: 682e 7365 745f 6c61 7965 7273 286c 6179  h.set_layers(lay
+0000a7a0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0000a7b0: 2020 2020 7061 7468 2e73 6574 5f64 6174      path.set_dat
+0000a7c0: 6174 7970 6573 2864 6174 6174 7970 6529  atypes(datatype)
+0000a7d0: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
+0000a7e0: 656e 745f 666c 6174 2e69 6e66 6f20 3d20  ent_flat.info = 
+0000a7f0: 7365 6c66 2e69 6e66 6f2e 636f 7079 2829  self.info.copy()
+0000a800: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
+0000a810: 6e74 5f66 6c61 742e 6164 645f 706f 7274  nt_flat.add_port
+0000a820: 7328 7365 6c66 2e70 6f72 7473 290a 2020  s(self.ports).  
+0000a830: 2020 2020 2020 7265 7475 726e 2063 6f6d        return com
+0000a840: 706f 6e65 6e74 5f66 6c61 740a 0a20 2020  ponent_flat..   
+0000a850: 2064 6566 2066 6c61 7474 656e 5f72 6566   def flatten_ref
+0000a860: 6572 656e 6365 2873 656c 662c 2072 6566  erence(self, ref
+0000a870: 3a20 436f 6d70 6f6e 656e 7452 6566 6572  : ComponentRefer
+0000a880: 656e 6365 2920 2d3e 204e 6f6e 653a 0a20  ence) -> None:. 
+0000a890: 2020 2020 2020 2022 2222 4672 6f6d 2065         """From e
+0000a8a0: 7869 7374 696e 6720 6365 6c6c 2072 6570  xisting cell rep
+0000a8b0: 6c61 6365 7320 7265 6665 7265 6e63 6520  laces reference 
+0000a8c0: 7769 7468 2061 2066 6c61 7474 656e 2072  with a flatten r
+0000a8d0: 6566 6572 656e 6365 205c 0a20 2020 2020  eference \.     
+0000a8e0: 2020 2077 6869 6368 2068 6173 2074 6865     which has the
+0000a8f0: 2074 7261 6e73 666f 726d 6174 696f 6e73   transformations
+0000a900: 2061 6c72 6561 6479 2061 7070 6c69 6564   already applied
+0000a910: 2e0a 0a20 2020 2020 2020 2054 7261 6e73  ...        Trans
+0000a920: 666f 726d 6564 2072 6566 6572 656e 6365  formed reference
+0000a930: 206b 6565 7073 2074 6865 206f 7269 6769   keeps the origi
+0000a940: 6e61 6c20 6e61 6d65 2e0a 0a20 2020 2020  nal name...     
+0000a950: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000a960: 2020 2020 2072 6566 3a20 7468 6520 7265       ref: the re
+0000a970: 6665 7265 6e63 6520 746f 2066 6c61 7474  ference to flatt
+0000a980: 656e 2069 6e74 6f20 6120 6e65 7720 6365  en into a new ce
+0000a990: 6c6c 2e0a 0a20 2020 2020 2020 2022 2222  ll...        """
+0000a9a0: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+0000a9b0: 7366 6163 746f 7279 2e66 756e 6374 696f  sfactory.functio
+0000a9c0: 6e73 2069 6d70 6f72 7420 7472 616e 7366  ns import transf
+0000a9d0: 6f72 6d65 640a 0a20 2020 2020 2020 2073  ormed..        s
+0000a9e0: 656c 662e 7265 6d6f 7665 2872 6566 290a  elf.remove(ref).
+0000a9f0: 2020 2020 2020 2020 6e65 775f 636f 6d70          new_comp
+0000aa00: 6f6e 656e 7420 3d20 7472 616e 7366 6f72  onent = transfor
+0000aa10: 6d65 6428 7265 662c 2064 6563 6f72 6174  med(ref, decorat
+0000aa20: 6f72 3d4e 6f6e 6529 0a20 2020 2020 2020  or=None).       
+0000aa30: 2073 656c 662e 6164 645f 7265 6628 6e65   self.add_ref(ne
+0000aa40: 775f 636f 6d70 6f6e 656e 742c 2061 6c69  w_component, ali
+0000aa50: 6173 3d72 6566 2e6e 616d 6529 0a0a 2020  as=ref.name)..  
+0000aa60: 2020 6465 6620 6164 645f 7265 6628 0a20    def add_ref(. 
+0000aa70: 2020 2020 2020 2073 656c 662c 2063 6f6d         self, com
+0000aa80: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
+0000aa90: 742c 2061 6c69 6173 3a20 4f70 7469 6f6e  t, alias: Option
+0000aaa0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c20  al[str] = None, 
+0000aab0: 2a2a 6b77 6172 6773 0a20 2020 2029 202d  **kwargs.    ) -
+0000aac0: 3e20 436f 6d70 6f6e 656e 7452 6566 6572  > ComponentRefer
+0000aad0: 656e 6365 3a0a 2020 2020 2020 2020 2222  ence:.        ""
+0000aae0: 2241 6464 2043 6f6d 706f 6e65 6e74 5265  "Add ComponentRe
+0000aaf0: 6665 7265 6e63 6520 746f 2074 6865 2063  ference to the c
+0000ab00: 7572 7265 6e74 2043 6f6d 706f 6e65 6e74  urrent Component
+0000ab10: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+0000ab20: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+0000ab30: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
+0000ab40: 742e 0a20 2020 2020 2020 2020 2020 2061  t..            a
+0000ab50: 6c69 6173 3a20 6e61 6d65 645f 7265 6665  lias: named_refe
+0000ab60: 7265 6e63 6573 2e0a 0a20 2020 2020 2020  rences...       
+0000ab70: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
+0000ab80: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+0000ab90: 6e73 3a20 4e75 6d62 6572 206f 6620 636f  ns: Number of co
+0000aba0: 6c75 6d6e 7320 696e 2074 6865 2061 7272  lumns in the arr
+0000abb0: 6179 2e0a 2020 2020 2020 2020 2020 2020  ay..            
+0000abc0: 726f 7773 3a20 4e75 6d62 6572 206f 6620  rows: Number of 
+0000abd0: 726f 7773 2069 6e20 7468 6520 6172 7261  rows in the arra
+0000abe0: 792e 0a20 2020 2020 2020 2020 2020 2073  y..            s
+0000abf0: 7061 6369 6e67 3a20 4469 7374 616e 6365  pacing: Distance
+0000ac00: 7320 6265 7477 6565 6e20 6164 6a61 6365  s between adjace
+0000ac10: 6e74 2063 6f6c 756d 6e73 2061 6e64 2061  nt columns and a
+0000ac20: 646a 6163 656e 7420 726f 7773 2e0a 2020  djacent rows..  
+0000ac30: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+0000ac40: 3a20 6172 7261 792d 6c69 6b65 5b32 5d20  : array-like[2] 
+0000ac50: 6f66 2069 6e74 206f 7220 666c 6f61 740a  of int or float.
+0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac70: 506f 7369 7469 6f6e 2077 6865 7265 2074  Position where t
+0000ac80: 6865 2063 656c 6c20 6973 2069 6e73 6572  he cell is inser
+0000ac90: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
+0000aca0: 2072 6f74 6174 696f 6e20 3a20 696e 7420   rotation : int 
+0000acb0: 6f72 2066 6c6f 6174 0a20 2020 2020 2020  or float.       
+0000acc0: 2020 2020 2020 2020 2041 6e67 6c65 206f           Angle o
+0000acd0: 6620 726f 7461 7469 6f6e 206f 6620 7468  f rotation of th
+0000ace0: 6520 7265 6665 7265 6e63 6520 2869 6e20  e reference (in 
+0000acf0: 6064 6567 7265 6573 6029 2e0a 2020 2020  `degrees`)..    
+0000ad00: 2020 2020 2020 2020 6d61 676e 6966 6963          magnific
+0000ad10: 6174 696f 6e20 3a20 696e 7420 6f72 2066  ation : int or f
+0000ad20: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+0000ad30: 2020 2020 204d 6167 6e69 6669 6361 7469       Magnificati
+0000ad40: 6f6e 2066 6163 746f 7220 666f 7220 7468  on factor for th
+0000ad50: 6520 7265 6665 7265 6e63 652e 0a20 2020  e reference..   
+0000ad60: 2020 2020 2020 2020 2078 5f72 6566 6c65           x_refle
+0000ad70: 6374 696f 6e20 3a20 626f 6f6c 0a20 2020  ction : bool.   
+0000ad80: 2020 2020 2020 2020 2020 2020 2049 6620               If 
+0000ad90: 5472 7565 2c20 7468 6520 7265 6665 7265  True, the refere
+0000ada0: 6e63 6520 6973 2072 6566 6c65 6374 6564  nce is reflected
+0000adb0: 2070 6172 616c 6c65 6c20 746f 2074 6865   parallel to the
+0000adc0: 2078 2064 6972 6563 7469 6f6e 0a20 2020   x direction.   
+0000add0: 2020 2020 2020 2020 2020 2020 2062 6566               bef
+0000ade0: 6f72 6520 6265 696e 6720 726f 7461 7465  ore being rotate
+0000adf0: 642e 0a20 2020 2020 2020 2020 2020 206e  d..            n
+0000ae00: 616d 6520 3a20 7374 7220 286f 7074 696f  ame : str (optio
+0000ae10: 6e61 6c29 0a20 2020 2020 2020 2020 2020  nal).           
+0000ae20: 2020 2020 2041 206e 616d 6520 666f 7220       A name for 
+0000ae30: 7468 6520 7265 6665 7265 6e63 6520 2869  the reference (i
+0000ae40: 6620 7072 6f76 6964 6564 292e 0a0a 2020  f provided)...  
+0000ae50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ae60: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0000ae70: 6e63 6528 636f 6d70 6f6e 656e 742c 2043  nce(component, C
+0000ae80: 6f6d 706f 6e65 6e74 293a 0a20 2020 2020  omponent):.     
+0000ae90: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0000aea0: 6545 7272 6f72 2866 2274 7970 6520 3d20  eError(f"type = 
+0000aeb0: 7b74 7970 6528 436f 6d70 6f6e 656e 7429  {type(Component)
+0000aec0: 7d20 6e65 6564 7320 746f 2062 6520 6120  } needs to be a 
+0000aed0: 436f 6d70 6f6e 656e 742e 2229 0a20 2020  Component.").   
+0000aee0: 2020 2020 2072 6566 203d 2043 6f6d 706f       ref = Compo
+0000aef0: 6e65 6e74 5265 6665 7265 6e63 6528 636f  nentReference(co
+0000af00: 6d70 6f6e 656e 742c 202a 2a6b 7761 7267  mponent, **kwarg
+0000af10: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+0000af20: 5f61 6464 2872 6566 290a 2020 2020 2020  _add(ref).      
+0000af30: 2020 7365 6c66 2e5f 7265 6769 7374 6572    self._register
+0000af40: 5f72 6566 6572 656e 6365 2872 6566 6572  _reference(refer
+0000af50: 656e 6365 3d72 6566 2c20 616c 6961 733d  ence=ref, alias=
+0000af60: 616c 6961 7329 0a20 2020 2020 2020 2072  alias).        r
+0000af70: 6574 7572 6e20 7265 660a 0a20 2020 2064  eturn ref..    d
+0000af80: 6566 205f 7265 6769 7374 6572 5f72 6566  ef _register_ref
+0000af90: 6572 656e 6365 280a 2020 2020 2020 2020  erence(.        
+0000afa0: 7365 6c66 2c20 7265 6665 7265 6e63 653a  self, reference:
+0000afb0: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+0000afc0: 6e63 652c 2061 6c69 6173 3a20 4f70 7469  nce, alias: Opti
+0000afd0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+0000afe0: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+0000aff0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+0000b000: 7420 3d20 7265 6665 7265 6e63 652e 7061  t = reference.pa
+0000b010: 7265 6e74 0a20 2020 2020 2020 2072 6566  rent.        ref
+0000b020: 6572 656e 6365 2e6f 776e 6572 203d 2073  erence.owner = s
+0000b030: 656c 660a 0a20 2020 2020 2020 2069 6620  elf..        if 
+0000b040: 616c 6961 7320 6973 204e 6f6e 653a 0a20  alias is None:. 
+0000b050: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0000b060: 6665 7265 6e63 652e 6e61 6d65 2069 7320  ference.name is 
+0000b070: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000b080: 2020 2020 2020 2020 2020 616c 6961 7320            alias 
+0000b090: 3d20 7265 6665 7265 6e63 652e 6e61 6d65  = reference.name
+0000b0a0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000b0b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000b0c0: 2020 2070 7265 6669 7820 3d20 280a 2020     prefix = (.  
 0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0e0: 2020 2020 6966 2068 6173 6174 7472 2863      if hasattr(c
-0000b0f0: 6f6d 706f 6e65 6e74 2c20 2273 6574 7469  omponent, "setti
-0000b100: 6e67 7322 290a 2020 2020 2020 2020 2020  ngs").          
-0000b110: 2020 2020 2020 2020 2020 616e 6420 6861            and ha
-0000b120: 7361 7474 7228 636f 6d70 6f6e 656e 742e  sattr(component.
-0000b130: 7365 7474 696e 6773 2c20 2266 756e 6374  settings, "funct
-0000b140: 696f 6e5f 6e61 6d65 2229 0a20 2020 2020  ion_name").     
-0000b150: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000b160: 6c73 6520 636f 6d70 6f6e 656e 742e 6e61  lse component.na
-0000b170: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0000b180: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000b190: 2020 2020 2073 656c 662e 5f72 6566 6572       self._refer
-0000b1a0: 656e 6365 5f6e 616d 6573 5f63 6f75 6e74  ence_names_count
-0000b1b0: 6572 2e75 7064 6174 6528 7b70 7265 6669  er.update({prefi
-0000b1c0: 783a 2031 7d29 0a20 2020 2020 2020 2020  x: 1}).         
-0000b1d0: 2020 2020 2020 2061 6c69 6173 203d 2066         alias = f
-0000b1e0: 227b 7072 6566 6978 7d5f 7b73 656c 662e  "{prefix}_{self.
-0000b1f0: 5f72 6566 6572 656e 6365 5f6e 616d 6573  _reference_names
-0000b200: 5f63 6f75 6e74 6572 5b70 7265 6669 785d  _counter[prefix]
-0000b210: 7d22 0a0a 2020 2020 2020 2020 2020 2020  }"..            
-0000b220: 2020 2020 7768 696c 6520 616c 6961 7320      while alias 
-0000b230: 696e 2073 656c 662e 5f6e 616d 6564 5f72  in self._named_r
-0000b240: 6566 6572 656e 6365 733a 0a20 2020 2020  eferences:.     
-0000b250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b260: 656c 662e 5f72 6566 6572 656e 6365 5f6e  elf._reference_n
-0000b270: 616d 6573 5f63 6f75 6e74 6572 2e75 7064  ames_counter.upd
-0000b280: 6174 6528 7b70 7265 6669 783a 2031 7d29  ate({prefix: 1})
-0000b290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b2a0: 2020 2020 2061 6c69 6173 203d 2066 227b       alias = f"{
-0000b2b0: 7072 6566 6978 7d5f 7b73 656c 662e 5f72  prefix}_{self._r
-0000b2c0: 6566 6572 656e 6365 5f6e 616d 6573 5f63  eference_names_c
-0000b2d0: 6f75 6e74 6572 5b70 7265 6669 785d 7d22  ounter[prefix]}"
-0000b2e0: 0a0a 2020 2020 2020 2020 7265 6665 7265  ..        refere
-0000b2f0: 6e63 652e 6e61 6d65 203d 2061 6c69 6173  nce.name = alias
-0000b300: 0a20 2020 2020 2020 2073 656c 662e 5f6e  .        self._n
-0000b310: 616d 6564 5f72 6566 6572 656e 6365 735b  amed_references[
-0000b320: 616c 6961 735d 203d 2072 6566 6572 656e  alias] = referen
-0000b330: 6365 0a0a 2020 2020 4070 726f 7065 7274  ce..    @propert
-0000b340: 790a 2020 2020 6465 6620 6c61 7965 7273  y.    def layers
-0000b350: 2873 656c 6629 202d 3e20 5365 745b 5475  (self) -> Set[Tu
-0000b360: 706c 655b 696e 742c 2069 6e74 5d5d 3a0a  ple[int, int]]:.
-0000b370: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000b380: 6e73 2061 2073 6574 206f 6620 7468 6520  ns a set of the 
-0000b390: 4c61 7965 7273 2069 6e20 7468 6520 436f  Layers in the Co
-0000b3a0: 6d70 6f6e 656e 742e 2222 220a 2020 2020  mponent.""".    
-0000b3b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000b3c0: 6765 745f 6c61 7965 7273 2829 0a0a 2020  get_layers()..  
-0000b3d0: 2020 6465 6620 6765 745f 6c61 7965 7273    def get_layers
-0000b3e0: 2873 656c 6629 202d 3e20 5365 745b 5475  (self) -> Set[Tu
-0000b3f0: 706c 655b 696e 742c 2069 6e74 5d5d 3a0a  ple[int, int]]:.
-0000b400: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000b410: 6e20 6120 7365 7420 6f66 2028 6c61 7965  n a set of (laye
-0000b420: 722c 2064 6174 6174 7970 6529 2e0a 0a20  r, datatype)... 
-0000b430: 2020 2020 2020 202e 2e20 636f 6465 203a         .. code :
-0000b440: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000b450: 6d70 6f72 7420 6764 7366 6163 746f 7279  mport gdsfactory
-0000b460: 2061 7320 6766 0a20 2020 2020 2020 2020   as gf.         
-0000b470: 2020 2067 662e 636f 6d70 6f6e 656e 7473     gf.components
-0000b480: 2e73 7472 6169 6768 7428 292e 6765 745f  .straight().get_
-0000b490: 6c61 7965 7273 2829 203d 3d20 7b28 312c  layers() == {(1,
-0000b4a0: 2030 292c 2028 3131 312c 2030 297d 0a20   0), (111, 0)}. 
-0000b4b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000b4c0: 2020 2070 6f6c 7967 6f6e 7320 3d20 7365     polygons = se
-0000b4d0: 6c66 2e5f 6365 6c6c 2e67 6574 5f70 6f6c  lf._cell.get_pol
-0000b4e0: 7967 6f6e 7328 6465 7074 683d 4e6f 6e65  ygons(depth=None
-0000b4f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000b500: 207b 2870 6f6c 7967 6f6e 2e6c 6179 6572   {(polygon.layer
-0000b510: 2c20 706f 6c79 676f 6e2e 6461 7461 7479  , polygon.dataty
-0000b520: 7065 2920 666f 7220 706f 6c79 676f 6e20  pe) for polygon 
-0000b530: 696e 2070 6f6c 7967 6f6e 737d 0a0a 2020  in polygons}..  
-0000b540: 2020 6465 6620 6765 745f 6c61 7965 725f    def get_layer_
-0000b550: 6e61 6d65 7328 7365 6c66 2920 2d3e 204c  names(self) -> L
-0000b560: 6973 745b 5475 706c 655b 696e 742c 2069  ist[Tuple[int, i
-0000b570: 6e74 5d5d 3a0a 2020 2020 2020 2020 2222  nt]]:.        ""
-0000b580: 2252 6574 7572 6e20 6c61 7965 7220 6e61  "Return layer na
-0000b590: 6d65 7320 7573 6564 2069 6e20 7468 6520  mes used in the 
-0000b5a0: 6465 7369 676e 2e0a 0a20 2020 2020 2020  design...       
-0000b5b0: 202e 2e20 636f 6465 203a 3a0a 0a20 2020   .. code ::..   
-0000b5c0: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
-0000b5d0: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
-0000b5e0: 0a20 2020 2020 2020 2020 2020 2067 662e  .            gf.
-0000b5f0: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
-0000b600: 6768 7428 292e 6765 745f 6e61 6d65 7328  ght().get_names(
-0000b610: 2920 3d3d 205b 2757 4727 5d0a 2020 2020  ) == ['WG'].    
-0000b620: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000b630: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
-0000b640: 7920 6173 2067 660a 0a20 2020 2020 2020  y as gf..       
-0000b650: 2050 444b 203d 2067 662e 6765 745f 6163   PDK = gf.get_ac
-0000b660: 7469 7665 5f70 646b 2829 0a20 2020 2020  tive_pdk().     
-0000b670: 2020 204c 4159 4552 5320 3d20 5044 4b2e     LAYERS = PDK.
-0000b680: 6c61 7965 7273 0a20 2020 2020 2020 206e  layers.        n
-0000b690: 616d 655f 746f 5f6c 6179 6572 203d 2064  ame_to_layer = d
-0000b6a0: 6963 7428 4c41 5945 5253 290a 2020 2020  ict(LAYERS).    
-0000b6b0: 2020 2020 6c61 7965 725f 746f 5f6e 616d      layer_to_nam
-0000b6c0: 6520 3d20 7b76 3a20 6b20 666f 7220 6b2c  e = {v: k for k,
-0000b6d0: 2076 2069 6e20 6e61 6d65 5f74 6f5f 6c61   v in name_to_la
-0000b6e0: 7965 722e 6974 656d 7328 297d 0a20 2020  yer.items()}.   
-0000b6f0: 2020 2020 206c 6179 6572 5f6e 616d 6573       layer_names
-0000b700: 203d 205b 5d0a 0a20 2020 2020 2020 2066   = []..        f
-0000b710: 6f72 206c 6179 6572 2069 6e20 7365 6c66  or layer in self
-0000b720: 2e6c 6179 6572 733a 0a20 2020 2020 2020  .layers:.       
-0000b730: 2020 2020 2069 6620 6c61 7965 7220 6e6f       if layer no
-0000b740: 7420 696e 206c 6179 6572 5f74 6f5f 6e61  t in layer_to_na
-0000b750: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-0000b760: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
-0000b770: 6e28 6622 7b6c 6179 6572 7d20 6e6f 7420  n(f"{layer} not 
-0000b780: 696e 204c 6179 6572 4d61 702e 222c 2073  in LayerMap.", s
-0000b790: 7461 636b 6c65 7665 6c3d 3329 0a20 2020  tacklevel=3).   
-0000b7a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000b7b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000b7c0: 6179 6572 5f6e 616d 6573 2e61 7070 656e  ayer_names.appen
-0000b7d0: 6428 6c61 7965 725f 746f 5f6e 616d 655b  d(layer_to_name[
-0000b7e0: 6c61 7965 725d 290a 2020 2020 2020 2020  layer]).        
-0000b7f0: 7265 7475 726e 206c 6179 6572 5f6e 616d  return layer_nam
-0000b800: 6573 0a0a 2020 2020 6465 6620 5f69 7079  es..    def _ipy
-0000b810: 7468 6f6e 5f64 6973 706c 6179 5f28 7365  thon_display_(se
-0000b820: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000b830: 2020 2020 2022 2222 5368 6f77 2067 656f       """Show geo
-0000b840: 6d65 7472 7920 696e 204b 4c61 796f 7574  metry in KLayout
-0000b850: 2061 6e64 2069 6e20 6d61 7470 6c6f 746c   and in matplotl
-0000b860: 6962 2066 6f72 204a 7570 7974 6572 204e  ib for Jupyter N
-0000b870: 6f74 6562 6f6f 6b73 2e22 2222 0a20 2020  otebooks.""".   
-0000b880: 2020 2020 2073 656c 662e 7368 6f77 2873       self.show(s
-0000b890: 686f 775f 706f 7274 733d 5472 7565 2920  how_ports=True) 
-0000b8a0: 2023 2073 686f 7720 696e 206b 6c61 796f   # show in klayo
-0000b8b0: 7574 0a20 2020 2020 2020 2073 656c 662e  ut.        self.
-0000b8c0: 706c 6f74 5f6b 6c61 796f 7574 2829 0a20  plot_klayout(). 
-0000b8d0: 2020 2020 2020 2070 7269 6e74 2873 656c         print(sel
-0000b8e0: 6629 0a0a 2020 2020 6465 6620 6164 645f  f)..    def add_
-0000b8f0: 7069 6e73 5f74 7269 616e 676c 6528 0a20  pins_triangle(. 
-0000b900: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000b910: 2020 2020 2070 6f72 745f 6d61 726b 6572       port_marker
-0000b920: 5f6c 6179 6572 3a20 4c61 7965 7220 3d20  _layer: Layer = 
-0000b930: 2831 2c20 3130 292c 0a20 2020 2029 3a0a  (1, 10),.    ):.
-0000b940: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000b950: 6e73 2063 6f6d 706f 6e65 6e74 2077 6974  ns component wit
-0000b960: 6820 7472 6961 6e67 756c 6172 2070 696e  h triangular pin
-0000b970: 732e 2222 220a 2020 2020 2020 2020 6672  s.""".        fr
-0000b980: 6f6d 2067 6473 6661 6374 6f72 792e 6164  om gdsfactory.ad
-0000b990: 645f 7069 6e73 2069 6d70 6f72 7420 6164  d_pins import ad
-0000b9a0: 645f 7069 6e73 5f74 7269 616e 676c 650a  d_pins_triangle.
-0000b9b0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
-0000b9c0: 6e74 203d 2073 656c 662e 636f 7079 2829  nt = self.copy()
-0000b9d0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
-0000b9e0: 6e74 2e6e 616d 6520 3d20 7365 6c66 2e6e  nt.name = self.n
-0000b9f0: 616d 650a 2020 2020 2020 2020 6164 645f  ame.        add_
-0000ba00: 7069 6e73 5f74 7269 616e 676c 6528 636f  pins_triangle(co
-0000ba10: 6d70 6f6e 656e 743d 636f 6d70 6f6e 656e  mponent=componen
-0000ba20: 742c 206c 6179 6572 3d70 6f72 745f 6d61  t, layer=port_ma
-0000ba30: 726b 6572 5f6c 6179 6572 290a 2020 2020  rker_layer).    
-0000ba40: 2020 2020 7265 7475 726e 2063 6f6d 706f      return compo
-0000ba50: 6e65 6e74 0a0a 2020 2020 6465 6620 706c  nent..    def pl
-0000ba60: 6f74 5f77 6964 6765 7428 0a20 2020 2020  ot_widget(.     
-0000ba70: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0000ba80: 2073 686f 775f 706f 7274 733a 2062 6f6f   show_ports: boo
-0000ba90: 6c20 3d20 5472 7565 2c0a 2020 2020 2020  l = True,.      
-0000baa0: 2020 706f 7274 5f6d 6172 6b65 725f 6c61    port_marker_la
-0000bab0: 7965 723a 204c 6179 6572 203d 2028 312c  yer: Layer = (1,
-0000bac0: 2031 3029 2c0a 2020 2020 2920 2d3e 204e   10),.    ) -> N
-0000bad0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000bae0: 5265 7475 726e 7320 6970 7974 686f 6e20  Returns ipython 
-0000baf0: 7769 6467 6574 2066 6f72 206b 6c61 796f  widget for klayo
-0000bb00: 7574 2076 6973 7561 6c69 7a61 7469 6f6e  ut visualization
-0000bb10: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-0000bb20: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-0000bb30: 775f 706f 7274 733a 2073 686f 7773 2063  w_ports: shows c
-0000bb40: 6f6d 706f 6e65 6e74 2077 6974 6820 706f  omponent with po
-0000bb50: 7274 206d 6172 6b65 7273 2061 6e64 206c  rt markers and l
-0000bb60: 6162 656c 732e 0a20 2020 2020 2020 2020  abels..         
-0000bb70: 2020 2070 6f72 745f 6d61 726b 6572 5f6c     port_marker_l
-0000bb80: 6179 6572 3a20 666f 7220 7468 6520 706f  ayer: for the po
-0000bb90: 7274 732e 0a20 2020 2020 2020 2022 2222  rts..        """
-0000bba0: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-0000bbb0: 7366 6163 746f 7279 2e70 646b 2069 6d70  sfactory.pdk imp
-0000bbc0: 6f72 7420 6765 745f 6c61 7965 725f 7669  ort get_layer_vi
-0000bbd0: 6577 730a 2020 2020 2020 2020 6672 6f6d  ews.        from
-0000bbe0: 2067 6473 6661 6374 6f72 792e 7769 6467   gdsfactory.widg
-0000bbf0: 6574 732e 6c61 796f 7574 5f76 6965 7765  ets.layout_viewe
-0000bc00: 7220 696d 706f 7274 204c 6179 6f75 7456  r import LayoutV
-0000bc10: 6965 7765 720a 2020 2020 2020 2020 6672  iewer.        fr
-0000bc20: 6f6d 2049 5079 7468 6f6e 2e64 6973 706c  om IPython.displ
-0000bc30: 6179 2069 6d70 6f72 7420 6469 7370 6c61  ay import displa
-0000bc40: 790a 0a20 2020 2020 2020 2063 6f6d 706f  y..        compo
-0000bc50: 6e65 6e74 203d 2028 0a20 2020 2020 2020  nent = (.       
-0000bc60: 2020 2020 2073 656c 662e 6164 645f 7069       self.add_pi
-0000bc70: 6e73 5f74 7269 616e 676c 6528 706f 7274  ns_triangle(port
-0000bc80: 5f6d 6172 6b65 725f 6c61 7965 723d 706f  _marker_layer=po
-0000bc90: 7274 5f6d 6172 6b65 725f 6c61 7965 7229  rt_marker_layer)
-0000bca0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000bcb0: 7368 6f77 5f70 6f72 7473 0a20 2020 2020  show_ports.     
-0000bcc0: 2020 2020 2020 2065 6c73 6520 7365 6c66         else self
-0000bcd0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000bce0: 2020 2020 6764 7370 6174 6820 3d20 636f      gdspath = co
-0000bcf0: 6d70 6f6e 656e 742e 7772 6974 655f 6764  mponent.write_gd
-0000bd00: 7328 6c6f 6767 696e 673d 4661 6c73 6529  s(logging=False)
-0000bd10: 0a20 2020 2020 2020 206c 7970 5f70 6174  .        lyp_pat
-0000bd20: 6820 3d20 6764 7370 6174 682e 7769 7468  h = gdspath.with
-0000bd30: 5f73 7566 6669 7828 222e 6c79 7022 290a  _suffix(".lyp").
-0000bd40: 0a20 2020 2020 2020 206c 6179 6572 5f76  .        layer_v
-0000bd50: 6965 7773 203d 2067 6574 5f6c 6179 6572  iews = get_layer
-0000bd60: 5f76 6965 7773 2829 0a20 2020 2020 2020  _views().       
-0000bd70: 206c 6179 6572 5f76 6965 7773 2e74 6f5f   layer_views.to_
-0000bd80: 6c79 7028 6669 6c65 7061 7468 3d6c 7970  lyp(filepath=lyp
-0000bd90: 5f70 6174 6829 0a0a 2020 2020 2020 2020  _path)..        
-0000bda0: 6c61 796f 7574 203d 204c 6179 6f75 7456  layout = LayoutV
-0000bdb0: 6965 7765 7228 6764 7370 6174 682c 206c  iewer(gdspath, l
-0000bdc0: 7970 5f70 6174 6829 0a20 2020 2020 2020  yp_path).       
-0000bdd0: 2064 6973 706c 6179 286c 6179 6f75 742e   display(layout.
-0000bde0: 7769 6467 6574 290a 0a20 2020 2064 6566  widget)..    def
-0000bdf0: 2070 6c6f 745f 6b6c 6179 6f75 7428 0a20   plot_klayout(. 
-0000be00: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000be10: 2020 2020 2073 686f 775f 706f 7274 733a       show_ports:
-0000be20: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-0000be30: 2020 2020 2020 706f 7274 5f6d 6172 6b65        port_marke
-0000be40: 725f 6c61 7965 723a 204c 6179 6572 203d  r_layer: Layer =
-0000be50: 2028 312c 2031 3029 2c0a 2020 2020 2020   (1, 10),.      
-0000be60: 2020 7368 6f77 5f6c 6162 656c 733a 2062    show_labels: b
-0000be70: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0000be80: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
-0000be90: 2020 2020 2222 2252 6574 7572 6e73 206b      """Returns k
-0000bea0: 6c61 796f 7574 2069 6d61 6765 2e0a 0a20  layout image... 
-0000beb0: 2020 2020 2020 2049 6620 6974 2066 6169         If it fai
-0000bec0: 6c73 2074 6f20 696d 706f 7274 206b 6c61  ls to import kla
-0000bed0: 796f 7574 2064 6566 6175 6c74 7320 746f  yout defaults to
-0000bee0: 206d 6174 706c 6f74 6c69 622e 0a0a 2020   matplotlib...  
-0000bef0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-0000bf00: 2020 2020 2020 2020 7368 6f77 5f70 6f72          show_por
-0000bf10: 7473 3a20 7368 6f77 7320 636f 6d70 6f6e  ts: shows compon
-0000bf20: 656e 7420 7769 7468 2070 6f72 7420 6d61  ent with port ma
-0000bf30: 726b 6572 7320 616e 6420 6c61 6265 6c73  rkers and labels
-0000bf40: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-0000bf50: 7274 5f6d 6172 6b65 725f 6c61 7965 723a  rt_marker_layer:
-0000bf60: 2066 6f72 2074 6865 2070 6f72 7473 2e0a   for the ports..
-0000bf70: 2020 2020 2020 2020 2020 2020 7368 6f77              show
-0000bf80: 5f6c 6162 656c 733a 2073 686f 7773 206c  _labels: shows l
-0000bf90: 6162 656c 732e 0a20 2020 2020 2020 2022  abels..        "
-0000bfa0: 2222 0a0a 2020 2020 2020 2020 636f 6d70  ""..        comp
-0000bfb0: 6f6e 656e 7420 3d20 280a 2020 2020 2020  onent = (.      
-0000bfc0: 2020 2020 2020 7365 6c66 2e61 6464 5f70        self.add_p
-0000bfd0: 696e 735f 7472 6961 6e67 6c65 2870 6f72  ins_triangle(por
-0000bfe0: 745f 6d61 726b 6572 5f6c 6179 6572 3d70  t_marker_layer=p
-0000bff0: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
-0000c000: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000c010: 2073 686f 775f 706f 7274 730a 2020 2020   show_ports.    
-0000c020: 2020 2020 2020 2020 656c 7365 2073 656c          else sel
-0000c030: 660a 2020 2020 2020 2020 290a 0a20 2020  f.        )..   
-0000c040: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000c050: 2020 2020 2020 696d 706f 7274 206b 6c61        import kla
-0000c060: 796f 7574 2e64 6220 6173 2064 6220 2023  yout.db as db  #
-0000c070: 206e 6f71 613a 2046 3430 310a 2020 2020   noqa: F401.    
-0000c080: 2020 2020 2020 2020 696d 706f 7274 206b          import k
-0000c090: 6c61 796f 7574 2e6c 6179 2061 7320 6c61  layout.lay as la
-0000c0a0: 790a 2020 2020 2020 2020 2020 2020 6672  y.            fr
-0000c0b0: 6f6d 2067 6473 6661 6374 6f72 792e 7064  om gdsfactory.pd
-0000c0c0: 6b20 696d 706f 7274 2067 6574 5f6c 6179  k import get_lay
-0000c0d0: 6572 5f76 6965 7773 0a20 2020 2020 2020  er_views.       
-0000c0e0: 2020 2020 2066 726f 6d20 4950 7974 686f       from IPytho
-0000c0f0: 6e2e 6469 7370 6c61 7920 696d 706f 7274  n.display import
-0000c100: 2064 6973 706c 6179 0a20 2020 2020 2020   display.       
-0000c110: 2020 2020 2066 726f 6d20 6970 7977 6964       from ipywid
-0000c120: 6765 7473 2069 6d70 6f72 7420 496d 6167  gets import Imag
-0000c130: 650a 0a20 2020 2020 2020 2020 2020 2067  e..            g
-0000c140: 6473 7061 7468 203d 2063 6f6d 706f 6e65  dspath = compone
-0000c150: 6e74 2e77 7269 7465 5f67 6473 286c 6f67  nt.write_gds(log
-0000c160: 6769 6e67 3d46 616c 7365 290a 2020 2020  ging=False).    
-0000c170: 2020 2020 2020 2020 6c79 705f 7061 7468          lyp_path
-0000c180: 203d 2067 6473 7061 7468 2e77 6974 685f   = gdspath.with_
-0000c190: 7375 6666 6978 2822 2e6c 7970 2229 0a0a  suffix(".lyp")..
-0000c1a0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-0000c1b0: 725f 7669 6577 7320 3d20 6765 745f 6c61  r_views = get_la
-0000c1c0: 7965 725f 7669 6577 7328 290a 2020 2020  yer_views().    
-0000c1d0: 2020 2020 2020 2020 6c61 7965 725f 7669          layer_vi
-0000c1e0: 6577 732e 746f 5f6c 7970 2866 696c 6570  ews.to_lyp(filep
-0000c1f0: 6174 683d 6c79 705f 7061 7468 290a 0a20  ath=lyp_path).. 
-0000c200: 2020 2020 2020 2020 2020 206c 6179 6f75             layou
-0000c210: 745f 7669 6577 203d 206c 6179 2e4c 6179  t_view = lay.Lay
-0000c220: 6f75 7456 6965 7728 290a 2020 2020 2020  outView().      
-0000c230: 2020 2020 2020 6c61 796f 7574 5f76 6965        layout_vie
-0000c240: 772e 6c6f 6164 5f6c 6179 6f75 7428 7374  w.load_layout(st
-0000c250: 7228 6764 7370 6174 682e 6162 736f 6c75  r(gdspath.absolu
-0000c260: 7465 2829 2929 0a20 2020 2020 2020 2020  te())).         
-0000c270: 2020 206c 6179 6f75 745f 7669 6577 2e6d     layout_view.m
-0000c280: 6178 5f68 6965 7228 290a 2020 2020 2020  ax_hier().      
-0000c290: 2020 2020 2020 6c61 796f 7574 5f76 6965        layout_vie
-0000c2a0: 772e 6c6f 6164 5f6c 6179 6572 5f70 726f  w.load_layer_pro
-0000c2b0: 7073 2873 7472 286c 7970 5f70 6174 6829  ps(str(lyp_path)
-0000c2c0: 290a 0a20 2020 2020 2020 2020 2020 206c  )..            l
-0000c2d0: 6179 6f75 745f 7669 6577 2e73 6574 5f63  ayout_view.set_c
-0000c2e0: 6f6e 6669 6728 2274 6578 742d 7669 7369  onfig("text-visi
-0000c2f0: 626c 6522 2c20 2274 7275 6522 2069 6620  ble", "true" if 
-0000c300: 7368 6f77 5f6c 6162 656c 7320 656c 7365  show_labels else
-0000c310: 2022 6661 6c73 6522 290a 0a20 2020 2020   "false")..     
-0000c320: 2020 2020 2020 2070 6978 656c 5f62 7566         pixel_buf
-0000c330: 6665 7220 3d20 6c61 796f 7574 5f76 6965  fer = layout_vie
-0000c340: 772e 6765 745f 7069 7865 6c73 5f77 6974  w.get_pixels_wit
-0000c350: 685f 6f70 7469 6f6e 7328 3830 302c 2036  h_options(800, 6
-0000c360: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
-0000c370: 706e 675f 6461 7461 203d 2070 6978 656c  png_data = pixel
-0000c380: 5f62 7566 6665 722e 746f 5f70 6e67 5f64  _buffer.to_png_d
-0000c390: 6174 6128 290a 2020 2020 2020 2020 2020  ata().          
-0000c3a0: 2020 696d 6167 6520 3d20 496d 6167 6528    image = Image(
-0000c3b0: 7661 6c75 653d 706e 675f 6461 7461 2c20  value=png_data, 
-0000c3c0: 666f 726d 6174 3d22 706e 6722 290a 2020  format="png").  
-0000c3d0: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-0000c3e0: 7928 696d 6167 6529 0a0a 2020 2020 2020  y(image)..      
-0000c3f0: 2020 6578 6365 7074 2049 6d70 6f72 7445    except ImportE
-0000c400: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0000c410: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-0000c420: 2020 2020 2020 2020 2022 596f 7520 6361           "You ca
-0000c430: 6e20 696e 7374 616c 6c20 6070 6970 2069  n install `pip i
-0000c440: 6e73 7461 6c6c 2067 6473 6661 6374 6f72  nstall gdsfactor
-0000c450: 795b 6675 6c6c 5d60 2066 6f72 2062 6574  y[full]` for bet
-0000c460: 7465 7220 7669 7375 616c 697a 6174 696f  ter visualizatio
-0000c470: 6e22 0a20 2020 2020 2020 2020 2020 2029  n".            )
-0000c480: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0000c490: 706f 6e65 6e74 2e70 6c6f 7428 706c 6f74  ponent.plot(plot
-0000c4a0: 7465 723d 226d 6174 706c 6f74 6c69 6222  ter="matplotlib"
-0000c4b0: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
-0000c4c0: 6a75 7079 7465 7228 7365 6c66 293a 0a20  jupyter(self):. 
-0000c4d0: 2020 2020 2020 2022 2222 5368 6f77 7320         """Shows 
-0000c4e0: 6375 7272 656e 7420 6764 7320 696e 206b  current gds in k
-0000c4f0: 6c61 796f 7574 2e20 5573 6573 204b 7765  layout. Uses Kwe
-0000c500: 6220 6966 2073 6572 7665 7220 7275 6e6e  b if server runn
-0000c510: 696e 672e 0a0a 2020 2020 2020 2020 6966  ing...        if
-0000c520: 206e 6f74 2074 7269 6573 2075 7369 6e67   not tries using
-0000c530: 204b 6c61 796f 7574 2077 6964 6765 7420   Klayout widget 
-0000c540: 616e 6420 6669 6e61 6c6c 7920 6465 6661  and finally defa
-0000c550: 756c 7473 2074 6f20 6d61 7470 6c6f 746c  ults to matplotl
-0000c560: 6962 2e0a 2020 2020 2020 2020 2222 220a  ib..        """.
-0000c570: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000c580: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
-0000c590: 6f73 0a20 2020 2020 2020 2020 2020 2066  os.            f
-0000c5a0: 726f 6d20 6764 7366 6163 746f 7279 2e63  rom gdsfactory.c
-0000c5b0: 6f6e 6669 6720 696d 706f 7274 2050 4154  onfig import PAT
-0000c5c0: 480a 2020 2020 2020 2020 2020 2020 6672  H.            fr
-0000c5d0: 6f6d 2067 6473 6661 6374 6f72 792e 7064  om gdsfactory.pd
-0000c5e0: 6b20 696d 706f 7274 2067 6574 5f6c 6179  k import get_lay
-0000c5f0: 6572 5f76 6965 7773 0a20 2020 2020 2020  er_views.       
-0000c600: 2020 2020 2066 726f 6d20 4950 7974 686f       from IPytho
-0000c610: 6e2e 6469 7370 6c61 7920 696d 706f 7274  n.display import
-0000c620: 2049 4672 616d 650a 2020 2020 2020 2020   IFrame.        
-0000c630: 2020 2020 696d 706f 7274 206b 7765 622e      import kweb.
-0000c640: 7365 7276 6572 5f6a 7570 7974 6572 2061  server_jupyter a
-0000c650: 7320 6b6a 0a20 2020 2020 2020 2020 2020  s kj.           
-0000c660: 2066 726f 6d20 6874 6d6c 2069 6d70 6f72   from html impor
-0000c670: 7420 6573 6361 7065 0a0a 2020 2020 2020  t escape..      
-0000c680: 2020 2020 2020 6764 7370 6174 6820 3d20        gdspath = 
-0000c690: 7365 6c66 2e77 7269 7465 5f67 6473 2867  self.write_gds(g
-0000c6a0: 6473 6469 723d 5041 5448 2e67 6473 6c69  dsdir=PATH.gdsli
-0000c6b0: 6220 2f20 2265 7874 7261 222c 206c 6f67  b / "extra", log
-0000c6c0: 6769 6e67 3d46 616c 7365 290a 0a20 2020  ging=False)..   
-0000c6d0: 2020 2020 2020 2020 2064 6972 7061 7468           dirpath
-0000c6e0: 203d 2047 4453 4449 525f 5445 4d50 0a20   = GDSDIR_TEMP. 
-0000c6f0: 2020 2020 2020 2020 2020 2064 6972 7061             dirpa
-0000c700: 7468 2e6d 6b64 6972 2865 7869 7374 5f6f  th.mkdir(exist_o
-0000c710: 6b3d 5472 7565 2c20 7061 7265 6e74 733d  k=True, parents=
-0000c720: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0000c730: 2020 6c79 705f 7061 7468 203d 2064 6972    lyp_path = dir
-0000c740: 7061 7468 202f 2022 6c61 7965 7273 2e6c  path / "layers.l
-0000c750: 7970 220a 0a20 2020 2020 2020 2020 2020  yp"..           
-0000c760: 206c 6179 6572 5f70 726f 7073 203d 2067   layer_props = g
-0000c770: 6574 5f6c 6179 6572 5f76 6965 7773 2829  et_layer_views()
-0000c780: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-0000c790: 6572 5f70 726f 7073 2e74 6f5f 6c79 7028  er_props.to_lyp(
-0000c7a0: 6669 6c65 7061 7468 3d6c 7970 5f70 6174  filepath=lyp_pat
-0000c7b0: 6829 0a0a 2020 2020 2020 2020 2020 2020  h)..            
-0000c7c0: 706f 7274 203d 206b 6a2e 706f 7274 2069  port = kj.port i
-0000c7d0: 6620 6861 7361 7474 7228 6b6a 2c20 2270  f hasattr(kj, "p
-0000c7e0: 6f72 7422 2920 656c 7365 2038 3030 300a  ort") else 8000.
-0000c7f0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-0000c800: 203d 2066 2268 7474 703a 2f2f 3132 372e   = f"http://127.
-0000c810: 302e 302e 313a 7b70 6f72 747d 2f67 6473  0.0.1:{port}/gds
-0000c820: 3f67 6473 5f66 696c 653d 7b65 7363 6170  ?gds_file={escap
-0000c830: 6528 7374 7228 6764 7370 6174 6829 297d  e(str(gdspath))}
-0000c840: 266c 6179 6572 5f70 726f 7073 3d7b 6573  &layer_props={es
-0000c850: 6361 7065 2873 7472 286c 7970 5f70 6174  cape(str(lyp_pat
-0000c860: 6829 297d 220a 2020 2020 2020 2020 2020  h))}".          
-0000c870: 2020 6c6f 6767 6572 2e64 6562 7567 2873    logger.debug(s
-0000c880: 7263 290a 0a20 2020 2020 2020 2020 2020  rc)..           
-0000c890: 2069 6620 6b6a 2e6a 7570 7974 6572 5f73   if kj.jupyter_s
-0000c8a0: 6572 7665 7220 616e 6420 6e6f 7420 6f73  erver and not os
-0000c8b0: 2e65 6e76 6972 6f6e 2e67 6574 2822 444f  .environ.get("DO
-0000c8c0: 4353 222c 2046 616c 7365 293a 0a20 2020  CS", False):.   
-0000c8d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000c8e0: 7572 6e20 4946 7261 6d65 280a 2020 2020  urn IFrame(.    
-0000c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c900: 7372 633d 7372 632c 0a20 2020 2020 2020  src=src,.       
-0000c910: 2020 2020 2020 2020 2020 2020 2077 6964               wid
-0000c920: 7468 3d31 3430 302c 0a20 2020 2020 2020  th=1400,.       
-0000c930: 2020 2020 2020 2020 2020 2020 2068 6569               hei
-0000c940: 6768 743d 3630 302c 0a20 2020 2020 2020  ght=600,.       
-0000c950: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000c960: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000c970: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000c980: 7572 6e20 7365 6c66 2e70 6c6f 745f 6b6c  urn self.plot_kl
-0000c990: 6179 6f75 7428 290a 2020 2020 2020 2020  ayout().        
-0000c9a0: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
-0000c9b0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-0000c9c0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-0000c9d0: 2020 2020 2020 2022 596f 7520 6361 6e20         "You can 
-0000c9e0: 696e 7374 616c 6c20 6070 6970 2069 6e73  install `pip ins
-0000c9f0: 7461 6c6c 2067 6473 6661 6374 6f72 795b  tall gdsfactory[
-0000ca00: 6675 6c6c 5d60 2066 6f72 2062 6574 7465  full]` for bette
-0000ca10: 7220 7669 7375 616c 697a 6174 696f 6e22  r visualization"
-0000ca20: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000ca30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000ca40: 6e20 7365 6c66 2e70 6c6f 745f 6b6c 6179  n self.plot_klay
-0000ca50: 6f75 7428 290a 0a20 2020 2064 6566 2070  out()..    def p
-0000ca60: 6c6f 745f 6d61 7470 6c6f 746c 6962 2873  lot_matplotlib(s
-0000ca70: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
-0000ca80: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000ca90: 2222 2250 6c6f 7420 636f 6d70 6f6e 656e  """Plot componen
-0000caa0: 7420 7573 696e 6720 6d61 7470 6c6f 746c  t using matplotl
-0000cab0: 6962 2e0a 0a20 2020 2020 2020 204b 6579  ib...        Key
-0000cac0: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
-0000cad0: 2020 2020 2020 2073 686f 775f 706f 7274         show_port
-0000cae0: 733a 2053 6574 7320 7768 6574 6865 7220  s: Sets whether 
-0000caf0: 706f 7274 7320 6172 6520 6472 6177 6e2e  ports are drawn.
-0000cb00: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-0000cb10: 775f 7375 6270 6f72 7473 3a20 5365 7473  w_subports: Sets
-0000cb20: 2077 6865 7468 6572 2073 7562 706f 7274   whether subport
-0000cb30: 7320 2870 6f72 7473 2074 6861 7420 6265  s (ports that be
-0000cb40: 6c6f 6e67 2074 6f20 7265 6665 7265 6e63  long to referenc
-0000cb50: 6573 2920 6172 6520 6472 6177 6e2e 0a20  es) are drawn.. 
-0000cb60: 2020 2020 2020 2020 2020 206c 6162 656c             label
-0000cb70: 5f61 6c69 6173 6573 3a20 5365 7473 2077  _aliases: Sets w
-0000cb80: 6865 7468 6572 2061 6c69 6173 6573 2061  hether aliases a
-0000cb90: 7265 206c 6162 656c 6564 2077 6974 6820  re labeled with 
-0000cba0: 6120 7465 7874 206e 616d 652e 0a20 2020  a text name..   
-0000cbb0: 2020 2020 2020 2020 206e 6577 5f77 696e           new_win
-0000cbc0: 646f 773a 2049 6620 5472 7565 2c20 6561  dow: If True, ea
-0000cbd0: 6368 2063 616c 6c20 746f 2071 7569 636b  ch call to quick
-0000cbe0: 706c 6f74 2829 2077 696c 6c20 6765 6e65  plot() will gene
-0000cbf0: 7261 7465 2061 2073 6570 6172 6174 6520  rate a separate 
-0000cc00: 7769 6e64 6f77 2e0a 2020 2020 2020 2020  window..        
-0000cc10: 2020 2020 626c 6f63 6b69 6e67 3a20 4966      blocking: If
-0000cc20: 2054 7275 652c 2063 616c 6c69 6e67 2071   True, calling q
-0000cc30: 7569 636b 706c 6f74 2829 2077 696c 6c20  uickplot() will 
-0000cc40: 7061 7573 6520 6578 6563 7574 696f 6e20  pause execution 
-0000cc50: 6f66 2028 2262 6c6f 636b 2229 2074 6865  of ("block") the
-0000cc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cc70: 2072 656d 6169 6e64 6572 206f 6620 7468   remainder of th
-0000cc80: 6520 7079 7468 6f6e 2063 6f64 6520 756e  e python code un
-0000cc90: 7469 6c20 7468 6520 7175 6963 6b70 6c6f  til the quickplo
-0000cca0: 7428 2920 7769 6e64 6f77 2069 7320 636c  t() window is cl
-0000ccb0: 6f73 6564 2e0a 2020 2020 2020 2020 2020  osed..          
-0000ccc0: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-0000ccd0: 7468 6520 7769 6e64 6f77 2077 696c 6c20  the window will 
-0000cce0: 6265 206f 7065 6e65 6420 616e 6420 636f  be opened and co
-0000ccf0: 6465 2077 696c 6c20 636f 6e74 696e 7565  de will continue
-0000cd00: 2074 6f20 7275 6e2e 0a20 2020 2020 2020   to run..       
-0000cd10: 2020 2020 207a 6f6f 6d5f 6661 6374 6f72       zoom_factor
-0000cd20: 3a20 5365 7473 2074 6865 2073 6361 6c69  : Sets the scali
-0000cd30: 6e67 2066 6163 746f 7220 7768 656e 207a  ng factor when z
-0000cd40: 6f6f 6d69 6e67 2074 6865 2071 7569 636b  ooming the quick
-0000cd50: 706c 6f74 2077 696e 646f 7720 7769 7468  plot window with
-0000cd60: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-0000cd70: 2020 2020 206d 6f75 7365 7768 6565 6c2f       mousewheel/
-0000cd80: 7472 6163 6b70 6164 2e0a 2020 2020 2020  trackpad..      
-0000cd90: 2020 2020 2020 696e 7465 7261 6374 6976        interactiv
-0000cda0: 655f 7a6f 6f6d 3a20 456e 6162 6c65 7320  e_zoom: Enables 
-0000cdb0: 7573 696e 6720 6d6f 7573 6577 6865 656c  using mousewheel
-0000cdc0: 2f74 7261 636b 7061 6420 746f 207a 6f6f  /trackpad to zoo
-0000cdd0: 6d2e 0a20 2020 2020 2020 2020 2020 2066  m..            f
-0000cde0: 6f6e 7473 697a 653a 2066 6f72 206c 6162  ontsize: for lab
-0000cdf0: 656c 732e 0a20 2020 2020 2020 2020 2020  els..           
-0000ce00: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
-0000ce10: 3a20 6c69 7374 206f 6620 6c61 7965 7273  : list of layers
-0000ce20: 2074 6f20 6578 636c 7564 652e 0a20 2020   to exclude..   
-0000ce30: 2020 2020 2020 2020 206c 6179 6572 5f76           layer_v
-0000ce40: 6965 7773 3a20 6c61 7965 725f 7669 6577  iews: layer_view
-0000ce50: 7320 636f 6c6f 7273 206c 6f61 6465 6420  s colors loaded 
-0000ce60: 6672 6f6d 204b 6c61 796f 7574 2e0a 2020  from Klayout..  
-0000ce70: 2020 2020 2020 2020 2020 6d69 6e5f 6173            min_as
-0000ce80: 7065 6374 3a20 6d69 6e69 6d75 6d20 6173  pect: minimum as
-0000ce90: 7065 6374 2072 6174 696f 2e0a 2020 2020  pect ratio..    
-0000cea0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ceb0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-0000cec0: 7175 6963 6b70 6c6f 7474 6572 2069 6d70  quickplotter imp
-0000ced0: 6f72 7420 7175 6963 6b70 6c6f 740a 0a20  ort quickplot.. 
-0000cee0: 2020 2020 2020 2071 7569 636b 706c 6f74         quickplot
-0000cef0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-0000cf00: 0a0a 2020 2020 6465 6620 706c 6f74 2873  ..    def plot(s
-0000cf10: 656c 662c 2070 6c6f 7474 6572 3a20 4f70  elf, plotter: Op
-0000cf20: 7469 6f6e 616c 5b50 6c6f 7474 6572 5d20  tional[Plotter] 
-0000cf30: 3d20 4e6f 6e65 2c20 2a2a 6b77 6172 6773  = None, **kwargs
-0000cf40: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000cf50: 2020 2022 2222 5265 7475 726e 7320 636f     """Returns co
-0000cf60: 6d70 6f6e 656e 7420 706c 6f74 2075 7369  mponent plot usi
-0000cf70: 6e67 206b 6c61 796f 7574 2c20 6d61 7470  ng klayout, matp
-0000cf80: 6c6f 746c 6962 2c20 686f 6c6f 7669 6577  lotlib, holoview
-0000cf90: 7320 6f72 2071 742e 0a0a 2020 2020 2020  s or qt...      
-0000cfa0: 2020 5765 2072 6563 6f6d 6d65 6e64 2075    We recommend u
-0000cfb0: 7369 6e67 206b 6c61 796f 7574 2e0a 0a20  sing klayout... 
-0000cfc0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-0000cfd0: 2020 2020 2020 2020 2070 6c6f 7474 6572           plotter
-0000cfe0: 3a20 706c 6f74 2062 6163 6b65 6e64 2028  : plot backend (
-0000cff0: 2768 6f6c 6f76 6965 7773 272c 2027 6d61  'holoviews', 'ma
-0000d000: 7470 6c6f 746c 6962 272c 2027 7174 272c  tplotlib', 'qt',
-0000d010: 2027 6b6c 6179 6f75 7427 292e 0a20 2020   'klayout')..   
-0000d020: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000d030: 2070 6c6f 7474 6572 203d 2070 6c6f 7474   plotter = plott
-0000d040: 6572 206f 7220 434f 4e46 2e67 6574 2822  er or CONF.get("
-0000d050: 706c 6f74 7465 7222 2c20 226d 6174 706c  plotter", "matpl
-0000d060: 6f74 6c69 6222 290a 0a20 2020 2020 2020  otlib")..       
-0000d070: 2069 6620 706c 6f74 7465 7220 3d3d 2022   if plotter == "
-0000d080: 6b6c 6179 6f75 7422 3a0a 2020 2020 2020  klayout":.      
-0000d090: 2020 2020 2020 7365 6c66 2e70 6c6f 745f        self.plot_
-0000d0a0: 6b6c 6179 6f75 7428 290a 2020 2020 2020  klayout().      
-0000d0b0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-0000d0c0: 2020 2020 2020 656c 6966 2070 6c6f 7474        elif plott
-0000d0d0: 6572 203d 3d20 226d 6174 706c 6f74 6c69  er == "matplotli
-0000d0e0: 6222 3a0a 2020 2020 2020 2020 2020 2020  b":.            
-0000d0f0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-0000d100: 7175 6963 6b70 6c6f 7474 6572 2069 6d70  quickplotter imp
-0000d110: 6f72 7420 7175 6963 6b70 6c6f 740a 0a20  ort quickplot.. 
-0000d120: 2020 2020 2020 2020 2020 2071 7569 636b             quick
-0000d130: 706c 6f74 2873 656c 662c 202a 2a6b 7761  plot(self, **kwa
-0000d140: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-0000d150: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-0000d160: 2065 6c69 6620 706c 6f74 7465 7220 3d3d   elif plotter ==
-0000d170: 2022 686f 6c6f 7669 6577 7322 3a0a 2020   "holoviews":.  
-0000d180: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0000d190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d1a0: 6d70 6f72 7420 686f 6c6f 7669 6577 7320  mport holoviews 
-0000d1b0: 6173 2068 760a 0a20 2020 2020 2020 2020  as hv..         
-0000d1c0: 2020 2020 2020 2068 762e 6578 7465 6e73         hv.extens
-0000d1d0: 696f 6e28 2262 6f6b 6568 2229 0a20 2020  ion("bokeh").   
-0000d1e0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000d1f0: 496d 706f 7274 4572 726f 7220 6173 2065  ImportError as e
-0000d200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d210: 2020 7072 696e 7428 2279 6f75 206e 6565    print("you nee
-0000d220: 6420 746f 2060 7069 7020 696e 7374 616c  d to `pip instal
-0000d230: 6c20 686f 6c6f 7669 6577 7360 2229 0a20  l holoviews`"). 
-0000d240: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000d250: 6169 7365 2065 0a20 2020 2020 2020 2020  aise e.         
-0000d260: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
-0000d270: 6c6f 745f 686f 6c6f 7669 6577 7328 2a2a  lot_holoviews(**
-0000d280: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
-0000d290: 2065 6c69 6620 706c 6f74 7465 7220 3d3d   elif plotter ==
-0000d2a0: 2022 7174 223a 0a20 2020 2020 2020 2020   "qt":.         
-0000d2b0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-0000d2c0: 7279 2e71 7569 636b 706c 6f74 7465 7220  ry.quickplotter 
-0000d2d0: 696d 706f 7274 2071 7569 636b 706c 6f74  import quickplot
-0000d2e0: 320a 0a20 2020 2020 2020 2020 2020 2071  2..            q
-0000d2f0: 7569 636b 706c 6f74 3228 7365 6c66 290a  uickplot2(self).
-0000d300: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d310: 726e 0a20 2020 2020 2020 2065 6c73 653a  rn.        else:
-0000d320: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000d330: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-0000d340: 7b70 6c6f 7474 6572 2172 7d20 6e6f 7420  {plotter!r} not 
-0000d350: 696e 207b 506c 6f74 7465 727d 2229 0a0a  in {Plotter}")..
-0000d360: 2020 2020 6465 6620 706c 6f74 5f68 6f6c      def plot_hol
-0000d370: 6f76 6965 7773 280a 2020 2020 2020 2020  oviews(.        
-0000d380: 7365 6c66 2c0a 2020 2020 2020 2020 6c61  self,.        la
-0000d390: 7965 7273 5f65 7863 6c75 6465 643a 204f  yers_excluded: O
-0000d3a0: 7074 696f 6e61 6c5b 4c61 7965 7273 5d20  ptional[Layers] 
-0000d3b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0000d3c0: 6c61 7965 725f 7669 6577 733a 204f 7074  layer_views: Opt
-0000d3d0: 696f 6e61 6c5b 4c61 7965 7256 6965 7773  ional[LayerViews
-0000d3e0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0000d3f0: 2020 6d69 6e5f 6173 7065 6374 3a20 666c    min_aspect: fl
-0000d400: 6f61 7420 3d20 302e 3235 2c0a 2020 2020  oat = 0.25,.    
-0000d410: 2020 2020 7061 6464 696e 673a 2066 6c6f      padding: flo
-0000d420: 6174 203d 2030 2e35 2c0a 2020 2020 293a  at = 0.5,.    ):
-0000d430: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
-0000d440: 2063 6f6d 706f 6e65 6e74 2069 6e20 686f   component in ho
-0000d450: 6c6f 7669 6577 732e 0a0a 2020 2020 2020  loviews...      
-0000d460: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0000d470: 2020 2020 6c61 7965 7273 5f65 7863 6c75      layers_exclu
-0000d480: 6465 643a 206c 6973 7420 6f66 206c 6179  ded: list of lay
-0000d490: 6572 7320 746f 2065 7863 6c75 6465 2e0a  ers to exclude..
-0000d4a0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-0000d4b0: 725f 7669 6577 733a 206c 6179 6572 5f76  r_views: layer_v
-0000d4c0: 6965 7773 2063 6f6c 6f72 7320 6c6f 6164  iews colors load
-0000d4d0: 6564 2066 726f 6d20 4b6c 6179 6f75 742e  ed from Klayout.
-0000d4e0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-0000d4f0: 5f61 7370 6563 743a 206d 696e 696d 756d  _aspect: minimum
-0000d500: 2061 7370 6563 7420 7261 7469 6f2e 0a20   aspect ratio.. 
-0000d510: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
-0000d520: 6e67 3a20 6172 6f75 6e64 2062 6f75 6e64  ng: around bound
-0000d530: 696e 6720 626f 782e 0a0a 2020 2020 2020  ing box...      
-0000d540: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-0000d550: 2020 2020 2020 2048 6f6c 6f76 6965 7773         Holoviews
-0000d560: 204f 7665 726c 6179 2074 6f20 6469 7370   Overlay to disp
-0000d570: 6c61 7920 616c 6c20 706f 6c79 676f 6e73  lay all polygons
-0000d580: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000d590: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-0000d5a0: 6374 6f72 792e 6164 645f 7069 6e73 2069  ctory.add_pins i
-0000d5b0: 6d70 6f72 7420 6765 745f 7069 6e5f 7472  mport get_pin_tr
-0000d5c0: 6961 6e67 6c65 5f70 6f6c 7967 6f6e 5f74  iangle_polygon_t
-0000d5d0: 6970 0a20 2020 2020 2020 2066 726f 6d20  ip.        from 
-0000d5e0: 6764 7366 6163 746f 7279 2e67 656e 6572  gdsfactory.gener
-0000d5f0: 6963 5f74 6563 6820 696d 706f 7274 204c  ic_tech import L
-0000d600: 4159 4552 5f56 4945 5753 0a0a 2020 2020  AYER_VIEWS..    
-0000d610: 2020 2020 6966 206c 6179 6572 5f76 6965      if layer_vie
-0000d620: 7773 2069 7320 4e6f 6e65 3a0a 2020 2020  ws is None:.    
-0000d630: 2020 2020 2020 2020 6c61 7965 725f 7669          layer_vi
-0000d640: 6577 7320 3d20 4c41 5945 525f 5649 4557  ews = LAYER_VIEW
-0000d650: 530a 0a20 2020 2020 2020 2074 7279 3a0a  S..        try:.
-0000d660: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-0000d670: 7274 2068 6f6c 6f76 6965 7773 2061 7320  rt holoviews as 
-0000d680: 6876 0a0a 2020 2020 2020 2020 2020 2020  hv..            
-0000d690: 6876 2e65 7874 656e 7369 6f6e 2822 626f  hv.extension("bo
-0000d6a0: 6b65 6822 290a 2020 2020 2020 2020 6578  keh").        ex
-0000d6b0: 6365 7074 2049 6d70 6f72 7445 7272 6f72  cept ImportError
-0000d6c0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000d6d0: 2020 2070 7269 6e74 2822 796f 7520 6e65     print("you ne
-0000d6e0: 6564 2074 6f20 6070 6970 2069 6e73 7461  ed to `pip insta
-0000d6f0: 6c6c 2068 6f6c 6f76 6965 7773 6022 290a  ll holoviews`").
-0000d700: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000d710: 6520 650a 0a20 2020 2020 2020 2073 656c  e e..        sel
-0000d720: 662e 5f62 625f 7661 6c69 6420 3d20 4661  f._bb_valid = Fa
-0000d730: 6c73 6520 2023 2072 6563 6f6d 7075 7465  lse  # recompute
-0000d740: 2074 6865 2062 6f75 6e64 696e 6720 626f   the bounding bo
-0000d750: 780a 2020 2020 2020 2020 6220 3d20 7365  x.        b = se
-0000d760: 6c66 2e62 626f 7820 2b20 2828 2d70 6164  lf.bbox + ((-pad
-0000d770: 6469 6e67 2c20 2d70 6164 6469 6e67 292c  ding, -padding),
-0000d780: 2028 7061 6464 696e 672c 2070 6164 6469   (padding, paddi
-0000d790: 6e67 2929 0a20 2020 2020 2020 2062 203d  ng)).        b =
-0000d7a0: 206e 702e 6172 7261 7928 622e 666c 6174   np.array(b.flat
-0000d7b0: 290a 2020 2020 2020 2020 6365 6e74 6572  ).        center
-0000d7c0: 203d 206e 702e 6172 7261 7928 286e 702e   = np.array((np.
-0000d7d0: 7375 6d28 625b 3a3a 325d 2920 2f20 322c  sum(b[::2]) / 2,
-0000d7e0: 206e 702e 7375 6d28 625b 313a 3a32 5d29   np.sum(b[1::2])
-0000d7f0: 202f 2032 2929 0a20 2020 2020 2020 2073   / 2)).        s
-0000d800: 697a 6520 3d20 6e70 2e61 7272 6179 2828  ize = np.array((
-0000d810: 6e70 2e61 6273 2862 5b32 5d20 2d20 625b  np.abs(b[2] - b[
-0000d820: 305d 292c 206e 702e 6162 7328 625b 335d  0]), np.abs(b[3]
-0000d830: 202d 2062 5b31 5d29 2929 0a20 2020 2020   - b[1]))).     
-0000d840: 2020 2064 7820 3d20 6e70 2e61 7272 6179     dx = np.array
-0000d850: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
-0000d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d870: 6e70 2e6d 6178 696d 756d 286d 696e 5f61  np.maximum(min_a
-0000d880: 7370 6563 7420 2a20 7369 7a65 5b31 5d2c  spect * size[1],
-0000d890: 2073 697a 655b 305d 2920 2f20 322c 0a20   size[0]) / 2,. 
-0000d8a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000d8b0: 702e 6d61 7869 6d75 6d28 7369 7a65 5b31  p.maximum(size[1
-0000d8c0: 5d2c 206d 696e 5f61 7370 6563 7420 2a20  ], min_aspect * 
-0000d8d0: 7369 7a65 5b30 5d29 202f 2032 2c0a 2020  size[0]) / 2,.  
-0000d8e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000d8f0: 2020 2020 290a 2020 2020 2020 2020 6220      ).        b 
-0000d900: 3d20 6e70 2e68 7374 6163 6b28 2863 656e  = np.hstack((cen
-0000d910: 7465 7220 2d20 6478 2c20 6365 6e74 6572  ter - dx, center
-0000d920: 202b 2064 7829 290a 0a20 2020 2020 2020   + dx))..       
-0000d930: 2070 6c6f 7473 5f74 6f5f 6f76 6572 6c61   plots_to_overla
-0000d940: 7920 3d20 5b5d 0a20 2020 2020 2020 206c  y = [].        l
-0000d950: 6179 6572 735f 6578 636c 7564 6564 203d  ayers_excluded =
-0000d960: 205b 5d20 6966 206c 6179 6572 735f 6578   [] if layers_ex
-0000d970: 636c 7564 6564 2069 7320 4e6f 6e65 2065  cluded is None e
-0000d980: 6c73 6520 6c61 7965 7273 5f65 7863 6c75  lse layers_exclu
-0000d990: 6465 640a 0a20 2020 2020 2020 2066 6f72  ded..        for
-0000d9a0: 206c 6179 6572 2c20 706f 6c79 676f 6e20   layer, polygon 
-0000d9b0: 696e 2073 656c 662e 6765 745f 706f 6c79  in self.get_poly
-0000d9c0: 676f 6e73 2862 795f 7370 6563 3d54 7275  gons(by_spec=Tru
-0000d9d0: 6529 2e69 7465 6d73 2829 3a0a 2020 2020  e).items():.    
-0000d9e0: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
-0000d9f0: 2069 6e20 6c61 7965 7273 5f65 7863 6c75   in layers_exclu
-0000da00: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
-0000da10: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
-0000da20: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da40: 6c61 7965 725f 7669 6577 203d 206c 6179  layer_view = lay
-0000da50: 6572 5f76 6965 7773 2e67 6574 5f66 726f  er_views.get_fro
-0000da60: 6d5f 7475 706c 6528 6c61 7965 7229 0a20  m_tuple(layer). 
-0000da70: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000da80: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
-0000da90: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0000daa0: 7965 7273 203d 206c 6973 7428 6c61 7965  yers = list(laye
-0000dab0: 725f 7669 6577 732e 6765 745f 6c61 7965  r_views.get_laye
-0000dac0: 725f 7669 6577 7328 292e 6b65 7973 2829  r_views().keys()
-0000dad0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000dae0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-0000daf0: 6622 7b6c 6179 6572 2172 7d20 6e6f 7420  f"{layer!r} not 
-0000db00: 6465 6669 6e65 6420 696e 207b 6c61 7965  defined in {laye
-0000db10: 7273 7d22 2c20 7374 6163 6b6c 6576 656c  rs}", stacklevel
-0000db20: 3d33 290a 2020 2020 2020 2020 2020 2020  =3).            
-0000db30: 2020 2020 6c61 7965 725f 7669 6577 203d      layer_view =
-0000db40: 204c 6179 6572 5669 6577 286c 6179 6572   LayerView(layer
-0000db50: 3d6c 6179 6572 290a 2020 2020 2020 2020  =layer).        
-0000db60: 2020 2020 2320 544f 444f 3a20 4d61 7463      # TODO: Matc
-0000db70: 6820 7570 206f 7074 696f 6e73 2077 6974  h up options wit
-0000db80: 6820 4c61 7965 7256 6965 7773 0a20 2020  h LayerViews.   
-0000db90: 2020 2020 2020 2020 2070 6c6f 7473 5f74           plots_t
-0000dba0: 6f5f 6f76 6572 6c61 792e 6170 7065 6e64  o_overlay.append
-0000dbb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000dbc0: 2020 6876 2e50 6f6c 7967 6f6e 7328 706f    hv.Polygons(po
-0000dbd0: 6c79 676f 6e2c 206c 6162 656c 3d73 7472  lygon, label=str
-0000dbe0: 286c 6179 6572 5f76 6965 772e 6e61 6d65  (layer_view.name
-0000dbf0: 2929 2e6f 7074 7328 0a20 2020 2020 2020  )).opts(.       
-0000dc00: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0000dc10: 615f 6173 7065 6374 3d31 2c0a 2020 2020  a_aspect=1,.    
-0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc30: 6672 616d 655f 7769 6474 683d 3530 302c  frame_width=500,
-0000dc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc50: 2020 2020 2079 6c69 6d3d 2862 5b31 5d2c       ylim=(b[1],
-0000dc60: 2062 5b33 5d29 2c0a 2020 2020 2020 2020   b[3]),.        
-0000dc70: 2020 2020 2020 2020 2020 2020 786c 696d              xlim
-0000dc80: 3d28 625b 305d 2c20 625b 325d 292c 0a20  =(b[0], b[2]),. 
-0000dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dca0: 2020 2066 696c 6c5f 636f 6c6f 723d 6c61     fill_color=la
-0000dcb0: 7965 725f 7669 6577 2e66 696c 6c5f 636f  yer_view.fill_co
-0000dcc0: 6c6f 722e 6173 5f72 6762 2829 206f 7220  lor.as_rgb() or 
-0000dcd0: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0000dce0: 2020 2020 2020 2020 6c69 6e65 5f63 6f6c          line_col
-0000dcf0: 6f72 3d6c 6179 6572 5f76 6965 772e 6672  or=layer_view.fr
-0000dd00: 616d 655f 636f 6c6f 722e 6173 5f72 6762  ame_color.as_rgb
-0000dd10: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
-0000dd20: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000dd30: 6c6c 5f61 6c70 6861 3d6c 6179 6572 5f76  ll_alpha=layer_v
-0000dd40: 6965 772e 6765 745f 616c 7068 6128 2920  iew.get_alpha() 
-0000dd50: 6f72 2022 222c 0a20 2020 2020 2020 2020  or "",.         
-0000dd60: 2020 2020 2020 2020 2020 206c 696e 655f             line_
-0000dd70: 616c 7068 613d 6c61 7965 725f 7669 6577  alpha=layer_view
-0000dd80: 2e67 6574 5f61 6c70 6861 2829 206f 7220  .get_alpha() or 
-0000dd90: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0000dda0: 2020 2020 2020 2020 746f 6f6c 733d 5b22          tools=["
-0000ddb0: 686f 7665 7222 5d2c 0a20 2020 2020 2020  hover"],.       
-0000ddc0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000ddd0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000dde0: 2066 6f72 206e 616d 652c 2070 6f72 7420   for name, port 
-0000ddf0: 696e 2073 656c 662e 706f 7274 732e 6974  in self.ports.it
-0000de00: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-0000de10: 2020 206e 616d 6520 3d20 7374 7228 6e61     name = str(na
-0000de20: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000de30: 706f 6c79 676f 6e2c 2070 7469 7020 3d20  polygon, ptip = 
-0000de40: 6765 745f 7069 6e5f 7472 6961 6e67 6c65  get_pin_triangle
-0000de50: 5f70 6f6c 7967 6f6e 5f74 6970 2870 6f72  _polygon_tip(por
-0000de60: 743d 706f 7274 290a 0a20 2020 2020 2020  t=port)..       
-0000de70: 2020 2020 2070 6c6f 7473 5f74 6f5f 6f76       plots_to_ov
-0000de80: 6572 6c61 792e 6170 7065 6e64 280a 2020  erlay.append(.  
-0000de90: 2020 2020 2020 2020 2020 2020 2020 6876                hv
-0000dea0: 2e50 6f6c 7967 6f6e 7328 706f 6c79 676f  .Polygons(polygo
-0000deb0: 6e2c 206c 6162 656c 3d6e 616d 6529 2e6f  n, label=name).o
-0000dec0: 7074 7328 0a20 2020 2020 2020 2020 2020  pts(.           
-0000ded0: 2020 2020 2020 2020 2064 6174 615f 6173           data_as
-0000dee0: 7065 6374 3d31 2c0a 2020 2020 2020 2020  pect=1,.        
-0000def0: 2020 2020 2020 2020 2020 2020 6672 616d              fram
-0000df00: 655f 7769 6474 683d 3530 302c 0a20 2020  e_width=500,.   
-0000df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df20: 2066 696c 6c5f 616c 7068 613d 302c 0a20   fill_alpha=0,. 
-0000df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df40: 2020 2079 6c69 6d3d 2862 5b31 5d2c 2062     ylim=(b[1], b
-0000df50: 5b33 5d29 2c0a 2020 2020 2020 2020 2020  [3]),.          
-0000df60: 2020 2020 2020 2020 2020 786c 696d 3d28            xlim=(
-0000df70: 625b 305d 2c20 625b 325d 292c 0a20 2020  b[0], b[2]),.   
-0000df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df90: 2063 6f6c 6f72 3d22 7265 6422 2c0a 2020   color="red",.  
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfb0: 2020 6c69 6e65 5f61 6c70 6861 3d6c 6179    line_alpha=lay
-0000dfc0: 6572 5f76 6965 772e 6765 745f 616c 7068  er_view.get_alph
-0000dfd0: 6128 2920 6f72 2022 222c 0a20 2020 2020  a() or "",.     
-0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000dff0: 6f6f 6c73 3d5b 2268 6f76 6572 225d 2c0a  ools=["hover"],.
-0000e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e010: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e020: 2020 2a20 6876 2e54 6578 7428 7074 6970    * hv.Text(ptip
-0000e030: 5b30 5d2c 2070 7469 705b 315d 2c20 6e61  [0], ptip[1], na
-0000e040: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000e050: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000e060: 6e20 6876 2e4f 7665 726c 6179 2870 6c6f  n hv.Overlay(plo
-0000e070: 7473 5f74 6f5f 6f76 6572 6c61 7929 2e6f  ts_to_overlay).o
-0000e080: 7074 7328 0a20 2020 2020 2020 2020 2020  pts(.           
-0000e090: 2073 686f 775f 6c65 6765 6e64 3d54 7275   show_legend=Tru
-0000e0a0: 652c 2073 6861 7265 645f 6178 6573 3d46  e, shared_axes=F
-0000e0b0: 616c 7365 2c20 796c 696d 3d28 625b 315d  alse, ylim=(b[1]
-0000e0c0: 2c20 625b 335d 292c 2078 6c69 6d3d 2862  , b[3]), xlim=(b
-0000e0d0: 5b30 5d2c 2062 5b32 5d29 0a20 2020 2020  [0], b[2]).     
-0000e0e0: 2020 2029 0a0a 2020 2020 6465 6620 7368     )..    def sh
-0000e0f0: 6f77 280a 2020 2020 2020 2020 7365 6c66  ow(.        self
-0000e100: 2c0a 2020 2020 2020 2020 7368 6f77 5f70  ,.        show_p
-0000e110: 6f72 7473 3a20 626f 6f6c 203d 2046 616c  orts: bool = Fal
-0000e120: 7365 2c0a 2020 2020 2020 2020 7368 6f77  se,.        show
-0000e130: 5f73 7562 706f 7274 733a 2062 6f6f 6c20  _subports: bool 
-0000e140: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0000e150: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
-0000e160: 6572 3a20 4c61 7965 7220 3d20 2831 2c20  er: Layer = (1, 
-0000e170: 3130 292c 0a20 2020 2020 2020 202a 2a6b  10),.        **k
-0000e180: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
-0000e190: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000e1a0: 2253 686f 7720 636f 6d70 6f6e 656e 7420  "Show component 
-0000e1b0: 696e 204b 4c61 796f 7574 2e0a 0a20 2020  in KLayout...   
-0000e1c0: 2020 2020 2072 6574 7572 6e73 2061 2063       returns a c
-0000e1d0: 6f70 7920 6f66 2074 6865 2043 6f6d 706f  opy of the Compo
-0000e1e0: 6e65 6e74 2c20 736f 2074 6865 206f 7269  nent, so the ori
-0000e1f0: 6769 6e61 6c20 636f 6d70 6f6e 656e 7420  ginal component 
-0000e200: 7265 6d61 696e 7320 696e 7461 6374 2e0a  remains intact..
-0000e210: 2020 2020 2020 2020 7769 7468 2070 696e          with pin
-0000e220: 7320 6d61 726b 6572 7320 6f6e 2065 6163  s markers on eac
-0000e230: 6820 706f 7274 2073 686f 775f 706f 7274  h port show_port
-0000e240: 7320 3d20 5472 7565 2c20 616e 6420 6f70  s = True, and op
-0000e250: 7469 6f6e 616c 6c79 2061 6c73 6f0a 2020  tionally also.  
-0000e260: 2020 2020 2020 7468 6520 706f 7274 7320        the ports 
-0000e270: 6672 6f6d 2074 6865 2072 6566 6572 656e  from the referen
-0000e280: 6365 7320 2873 686f 775f 7375 6270 6f72  ces (show_subpor
-0000e290: 7473 3d54 7275 6529 0a0a 2020 2020 2020  ts=True)..      
-0000e2a0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0000e2b0: 2020 2020 7368 6f77 5f70 6f72 7473 3a20      show_ports: 
-0000e2c0: 7368 6f77 7320 636f 6d70 6f6e 656e 7420  shows component 
-0000e2d0: 7769 7468 2070 6f72 7420 6d61 726b 6572  with port marker
-0000e2e0: 7320 616e 6420 6c61 6265 6c73 2e0a 2020  s and labels..  
-0000e2f0: 2020 2020 2020 2020 2020 7368 6f77 5f73            show_s
-0000e300: 7562 706f 7274 733a 2061 6464 2070 6f72  ubports: add por
-0000e310: 7473 206d 6172 6b65 7273 2061 6e64 206c  ts markers and l
-0000e320: 6162 656c 7320 746f 2072 6566 6572 656e  abels to referen
-0000e330: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
-0000e340: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
-0000e350: 6572 3a20 666f 7220 7468 6520 706f 7274  er: for the port
-0000e360: 732e 0a0a 2020 2020 2020 2020 4b65 7977  s...        Keyw
-0000e370: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
-0000e380: 2020 2020 2020 6764 7370 6174 683a 2047        gdspath: G
-0000e390: 4453 2066 696c 6520 7061 7468 2074 6f20  DS file path to 
-0000e3a0: 7772 6974 6520 746f 2e0a 2020 2020 2020  write to..      
-0000e3b0: 2020 2020 2020 6764 7364 6972 3a20 6469        gdsdir: di
-0000e3c0: 7265 6374 6f72 7920 666f 7220 7468 6520  rectory for the 
-0000e3d0: 4744 5320 6669 6c65 2e20 4465 6661 756c  GDS file. Defaul
-0000e3e0: 7473 2074 6f20 2f74 6d70 2f2e 0a20 2020  ts to /tmp/..   
-0000e3f0: 2020 2020 2020 2020 2075 6e69 743a 2075           unit: u
-0000e400: 6e69 7420 7369 7a65 2066 6f72 206f 626a  nit size for obj
-0000e410: 6563 7473 2069 6e20 6c69 6272 6172 792e  ects in library.
-0000e420: 2031 756d 2062 7920 6465 6661 756c 742e   1um by default.
-0000e430: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-0000e440: 6369 7369 6f6e 3a20 666f 7220 6f62 6a65  cision: for obje
-0000e450: 6374 2064 696d 656e 7369 6f6e 7320 696e  ct dimensions in
-0000e460: 2074 6865 206c 6962 7261 7279 2028 6d29   the library (m)
-0000e470: 2e20 316e 6d20 6279 2064 6566 6175 6c74  . 1nm by default
-0000e480: 2e0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
-0000e490: 6d65 7374 616d 703a 2044 6566 6175 6c74  mestamp: Default
-0000e4a0: 7320 746f 2032 3031 392d 3130 2d32 352e  s to 2019-10-25.
-0000e4b0: 2049 6620 4e6f 6e65 2075 7365 7320 6375   If None uses cu
-0000e4c0: 7272 656e 7420 7469 6d65 2e0a 2020 2020  rrent time..    
-0000e4d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e4e0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-0000e4f0: 6164 645f 7069 6e73 2069 6d70 6f72 7420  add_pins import 
-0000e500: 6164 645f 7069 6e73 5f74 7269 616e 676c  add_pins_triangl
-0000e510: 650a 2020 2020 2020 2020 6672 6f6d 2067  e.        from g
-0000e520: 6473 6661 6374 6f72 792e 7368 6f77 2069  dsfactory.show i
-0000e530: 6d70 6f72 7420 7368 6f77 0a0a 2020 2020  mport show..    
-0000e540: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
-0000e550: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0000e560: 6c66 2e61 6464 5f70 696e 735f 7472 6961  lf.add_pins_tria
-0000e570: 6e67 6c65 2870 6f72 745f 6d61 726b 6572  ngle(port_marker
-0000e580: 5f6c 6179 6572 3d70 6f72 745f 6d61 726b  _layer=port_mark
-0000e590: 6572 5f6c 6179 6572 290a 2020 2020 2020  er_layer).      
-0000e5a0: 2020 2020 2020 6966 2073 686f 775f 706f        if show_po
-0000e5b0: 7274 730a 2020 2020 2020 2020 2020 2020  rts.            
-0000e5c0: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
-0000e5d0: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-0000e5e0: 7368 6f77 5f73 7562 706f 7274 733a 0a20  show_subports:. 
-0000e5f0: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
-0000e600: 6e65 6e74 203d 2073 656c 662e 636f 7079  nent = self.copy
-0000e610: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
-0000e620: 6f6d 706f 6e65 6e74 2e6e 616d 6520 3d20  omponent.name = 
-0000e630: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
-0000e640: 2020 2020 2020 666f 7220 7265 6665 7265        for refere
-0000e650: 6e63 6520 696e 2063 6f6d 706f 6e65 6e74  nce in component
-0000e660: 2e72 6566 6572 656e 6365 733a 0a20 2020  .references:.   
-0000e670: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000e680: 6973 696e 7374 616e 6365 2863 6f6d 706f  isinstance(compo
-0000e690: 6e65 6e74 2c20 436f 6d70 6f6e 656e 7452  nent, ComponentR
-0000e6a0: 6566 6572 656e 6365 293a 0a20 2020 2020  eference):.     
-0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000e6c0: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
-0000e6d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000e6e0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-0000e6f0: 656e 743d 636f 6d70 6f6e 656e 742c 0a20  ent=component,. 
-0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e710: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-0000e720: 3d72 6566 6572 656e 6365 2c0a 2020 2020  =reference,.    
-0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e740: 2020 2020 6c61 7965 723d 706f 7274 5f6d      layer=port_m
-0000e750: 6172 6b65 725f 6c61 7965 722c 0a20 2020  arker_layer,.   
+0000b0e0: 2020 636f 6d70 6f6e 656e 742e 7365 7474    component.sett
+0000b0f0: 696e 6773 2e66 756e 6374 696f 6e5f 6e61  ings.function_na
+0000b100: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0000b110: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
+0000b120: 7228 636f 6d70 6f6e 656e 742c 2022 7365  r(component, "se
+0000b130: 7474 696e 6773 2229 0a20 2020 2020 2020  ttings").       
+0000b140: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+0000b150: 2068 6173 6174 7472 2863 6f6d 706f 6e65   hasattr(compone
+0000b160: 6e74 2e73 6574 7469 6e67 732c 2022 6675  nt.settings, "fu
+0000b170: 6e63 7469 6f6e 5f6e 616d 6522 290a 2020  nction_name").  
+0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b190: 2020 656c 7365 2063 6f6d 706f 6e65 6e74    else component
+0000b1a0: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
+0000b1b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000b1c0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
+0000b1d0: 6665 7265 6e63 655f 6e61 6d65 735f 636f  ference_names_co
+0000b1e0: 756e 7465 722e 7570 6461 7465 287b 7072  unter.update({pr
+0000b1f0: 6566 6978 3a20 317d 290a 2020 2020 2020  efix: 1}).      
+0000b200: 2020 2020 2020 2020 2020 616c 6961 7320            alias 
+0000b210: 3d20 6622 7b70 7265 6669 787d 5f7b 7365  = f"{prefix}_{se
+0000b220: 6c66 2e5f 7265 6665 7265 6e63 655f 6e61  lf._reference_na
+0000b230: 6d65 735f 636f 756e 7465 725b 7072 6566  mes_counter[pref
+0000b240: 6978 5d7d 220a 0a20 2020 2020 2020 2020  ix]}"..         
+0000b250: 2020 2020 2020 2077 6869 6c65 2061 6c69         while ali
+0000b260: 6173 2069 6e20 7365 6c66 2e5f 6e61 6d65  as in self._name
+0000b270: 645f 7265 6665 7265 6e63 6573 3a0a 2020  d_references:.  
+0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b290: 2020 7365 6c66 2e5f 7265 6665 7265 6e63    self._referenc
+0000b2a0: 655f 6e61 6d65 735f 636f 756e 7465 722e  e_names_counter.
+0000b2b0: 7570 6461 7465 287b 7072 6566 6978 3a20  update({prefix: 
+0000b2c0: 317d 290a 2020 2020 2020 2020 2020 2020  1}).            
+0000b2d0: 2020 2020 2020 2020 616c 6961 7320 3d20          alias = 
+0000b2e0: 6622 7b70 7265 6669 787d 5f7b 7365 6c66  f"{prefix}_{self
+0000b2f0: 2e5f 7265 6665 7265 6e63 655f 6e61 6d65  ._reference_name
+0000b300: 735f 636f 756e 7465 725b 7072 6566 6978  s_counter[prefix
+0000b310: 5d7d 220a 0a20 2020 2020 2020 2072 6566  ]}"..        ref
+0000b320: 6572 656e 6365 2e6e 616d 6520 3d20 616c  erence.name = al
+0000b330: 6961 730a 2020 2020 2020 2020 7365 6c66  ias.        self
+0000b340: 2e5f 6e61 6d65 645f 7265 6665 7265 6e63  ._named_referenc
+0000b350: 6573 5b61 6c69 6173 5d20 3d20 7265 6665  es[alias] = refe
+0000b360: 7265 6e63 650a 0a20 2020 2040 7072 6f70  rence..    @prop
+0000b370: 6572 7479 0a20 2020 2064 6566 206c 6179  erty.    def lay
+0000b380: 6572 7328 7365 6c66 2920 2d3e 2053 6574  ers(self) -> Set
+0000b390: 5b54 7570 6c65 5b69 6e74 2c20 696e 745d  [Tuple[int, int]
+0000b3a0: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
+0000b3b0: 7475 726e 7320 6120 7365 7420 6f66 2074  turns a set of t
+0000b3c0: 6865 204c 6179 6572 7320 696e 2074 6865  he Layers in the
+0000b3d0: 2043 6f6d 706f 6e65 6e74 2e22 2222 0a20   Component.""". 
+0000b3e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000b3f0: 6c66 2e67 6574 5f6c 6179 6572 7328 290a  lf.get_layers().
+0000b400: 0a20 2020 2064 6566 2067 6574 5f6c 6179  .    def get_lay
+0000b410: 6572 7328 7365 6c66 2920 2d3e 2053 6574  ers(self) -> Set
+0000b420: 5b54 7570 6c65 5b69 6e74 2c20 696e 745d  [Tuple[int, int]
+0000b430: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
+0000b440: 7475 726e 2061 2073 6574 206f 6620 286c  turn a set of (l
+0000b450: 6179 6572 2c20 6461 7461 7479 7065 292e  ayer, datatype).
+0000b460: 0a0a 2020 2020 2020 2020 2e2e 2063 6f64  ..        .. cod
+0000b470: 6520 3a3a 0a0a 2020 2020 2020 2020 2020  e ::..          
+0000b480: 2020 696d 706f 7274 2067 6473 6661 6374    import gdsfact
+0000b490: 6f72 7920 6173 2067 660a 2020 2020 2020  ory as gf.      
+0000b4a0: 2020 2020 2020 6766 2e63 6f6d 706f 6e65        gf.compone
+0000b4b0: 6e74 732e 7374 7261 6967 6874 2829 2e67  nts.straight().g
+0000b4c0: 6574 5f6c 6179 6572 7328 2920 3d3d 207b  et_layers() == {
+0000b4d0: 2831 2c20 3029 2c20 2831 3131 2c20 3029  (1, 0), (111, 0)
+0000b4e0: 7d0a 2020 2020 2020 2020 2222 220a 2020  }.        """.  
+0000b4f0: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
+0000b500: 2073 656c 662e 5f63 656c 6c2e 6765 745f   self._cell.get_
+0000b510: 706f 6c79 676f 6e73 2864 6570 7468 3d4e  polygons(depth=N
+0000b520: 6f6e 6529 0a20 2020 2020 2020 2072 6574  one).        ret
+0000b530: 7572 6e20 7b28 706f 6c79 676f 6e2e 6c61  urn {(polygon.la
+0000b540: 7965 722c 2070 6f6c 7967 6f6e 2e64 6174  yer, polygon.dat
+0000b550: 6174 7970 6529 2066 6f72 2070 6f6c 7967  atype) for polyg
+0000b560: 6f6e 2069 6e20 706f 6c79 676f 6e73 7d0a  on in polygons}.
+0000b570: 0a20 2020 2064 6566 2067 6574 5f6c 6179  .    def get_lay
+0000b580: 6572 5f6e 616d 6573 2873 656c 6629 202d  er_names(self) -
+0000b590: 3e20 4c69 7374 5b54 7570 6c65 5b69 6e74  > List[Tuple[int
+0000b5a0: 2c20 696e 745d 5d3a 0a20 2020 2020 2020  , int]]:.       
+0000b5b0: 2022 2222 5265 7475 726e 206c 6179 6572   """Return layer
+0000b5c0: 206e 616d 6573 2075 7365 6420 696e 2074   names used in t
+0000b5d0: 6865 2064 6573 6967 6e2e 0a0a 2020 2020  he design...    
+0000b5e0: 2020 2020 2e2e 2063 6f64 6520 3a3a 0a0a      .. code ::..
+0000b5f0: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+0000b600: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
+0000b610: 2067 660a 2020 2020 2020 2020 2020 2020   gf.            
+0000b620: 6766 2e63 6f6d 706f 6e65 6e74 732e 7374  gf.components.st
+0000b630: 7261 6967 6874 2829 2e67 6574 5f6e 616d  raight().get_nam
+0000b640: 6573 2829 203d 3d20 5b27 5747 275d 0a20  es() == ['WG']. 
+0000b650: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000b660: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+0000b670: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
+0000b680: 2020 2020 5044 4b20 3d20 6766 2e67 6574      PDK = gf.get
+0000b690: 5f61 6374 6976 655f 7064 6b28 290a 2020  _active_pdk().  
+0000b6a0: 2020 2020 2020 4c41 5945 5253 203d 2050        LAYERS = P
+0000b6b0: 444b 2e6c 6179 6572 730a 2020 2020 2020  DK.layers.      
+0000b6c0: 2020 6e61 6d65 5f74 6f5f 6c61 7965 7220    name_to_layer 
+0000b6d0: 3d20 6469 6374 284c 4159 4552 5329 0a20  = dict(LAYERS). 
+0000b6e0: 2020 2020 2020 206c 6179 6572 5f74 6f5f         layer_to_
+0000b6f0: 6e61 6d65 203d 207b 763a 206b 2066 6f72  name = {v: k for
+0000b700: 206b 2c20 7620 696e 206e 616d 655f 746f   k, v in name_to
+0000b710: 5f6c 6179 6572 2e69 7465 6d73 2829 7d0a  _layer.items()}.
+0000b720: 2020 2020 2020 2020 6c61 7965 725f 6e61          layer_na
+0000b730: 6d65 7320 3d20 5b5d 0a0a 2020 2020 2020  mes = []..      
+0000b740: 2020 666f 7220 6c61 7965 7220 696e 2073    for layer in s
+0000b750: 656c 662e 6c61 7965 7273 3a0a 2020 2020  elf.layers:.    
+0000b760: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
+0000b770: 206e 6f74 2069 6e20 6c61 7965 725f 746f   not in layer_to
+0000b780: 5f6e 616d 653a 0a20 2020 2020 2020 2020  _name:.         
+0000b790: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+0000b7a0: 7761 726e 2866 227b 6c61 7965 727d 206e  warn(f"{layer} n
+0000b7b0: 6f74 2069 6e20 4c61 7965 724d 6170 2e22  ot in LayerMap."
+0000b7c0: 2c20 7374 6163 6b6c 6576 656c 3d33 290a  , stacklevel=3).
+0000b7d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000b7e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b7f0: 2020 6c61 7965 725f 6e61 6d65 732e 6170    layer_names.ap
+0000b800: 7065 6e64 286c 6179 6572 5f74 6f5f 6e61  pend(layer_to_na
+0000b810: 6d65 5b6c 6179 6572 5d29 0a20 2020 2020  me[layer]).     
+0000b820: 2020 2072 6574 7572 6e20 6c61 7965 725f     return layer_
+0000b830: 6e61 6d65 730a 0a20 2020 2064 6566 205f  names..    def _
+0000b840: 6970 7974 686f 6e5f 6469 7370 6c61 795f  ipython_display_
+0000b850: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000b860: 2020 2020 2020 2020 2222 2253 686f 7720          """Show 
+0000b870: 6765 6f6d 6574 7279 2069 6e20 4b4c 6179  geometry in KLay
+0000b880: 6f75 7420 616e 6420 696e 206d 6174 706c  out and in matpl
+0000b890: 6f74 6c69 6220 666f 7220 4a75 7079 7465  otlib for Jupyte
+0000b8a0: 7220 4e6f 7465 626f 6f6b 732e 2222 220a  r Notebooks.""".
+0000b8b0: 2020 2020 2020 2020 7365 6c66 2e73 686f          self.sho
+0000b8c0: 7728 7368 6f77 5f70 6f72 7473 3d54 7275  w(show_ports=Tru
+0000b8d0: 6529 2020 2320 7368 6f77 2069 6e20 6b6c  e)  # show in kl
+0000b8e0: 6179 6f75 740a 2020 2020 2020 2020 7365  ayout.        se
+0000b8f0: 6c66 2e70 6c6f 745f 6b6c 6179 6f75 7428  lf.plot_klayout(
+0000b900: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+0000b910: 7365 6c66 290a 0a20 2020 2064 6566 2061  self)..    def a
+0000b920: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
+0000b930: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000b940: 2020 2020 2020 2020 706f 7274 5f6d 6172          port_mar
+0000b950: 6b65 725f 6c61 7965 723a 204c 6179 6572  ker_layer: Layer
+0000b960: 203d 2028 312c 2031 3029 2c0a 2020 2020   = (1, 10),.    
+0000b970: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+0000b980: 7475 726e 7320 636f 6d70 6f6e 656e 7420  turns component 
+0000b990: 7769 7468 2074 7269 616e 6775 6c61 7220  with triangular 
+0000b9a0: 7069 6e73 2e22 2222 0a20 2020 2020 2020  pins.""".       
+0000b9b0: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
+0000b9c0: 2e61 6464 5f70 696e 7320 696d 706f 7274  .add_pins import
+0000b9d0: 2061 6464 5f70 696e 735f 7472 6961 6e67   add_pins_triang
+0000b9e0: 6c65 0a0a 2020 2020 2020 2020 636f 6d70  le..        comp
+0000b9f0: 6f6e 656e 7420 3d20 7365 6c66 2e63 6f70  onent = self.cop
+0000ba00: 7928 290a 2020 2020 2020 2020 636f 6d70  y().        comp
+0000ba10: 6f6e 656e 742e 6e61 6d65 203d 2073 656c  onent.name = sel
+0000ba20: 662e 6e61 6d65 0a20 2020 2020 2020 2061  f.name.        a
+0000ba30: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
+0000ba40: 2863 6f6d 706f 6e65 6e74 3d63 6f6d 706f  (component=compo
+0000ba50: 6e65 6e74 2c20 6c61 7965 723d 706f 7274  nent, layer=port
+0000ba60: 5f6d 6172 6b65 725f 6c61 7965 7229 0a20  _marker_layer). 
+0000ba70: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+0000ba80: 6d70 6f6e 656e 740a 0a20 2020 2064 6566  mponent..    def
+0000ba90: 2070 6c6f 745f 7769 6467 6574 280a 2020   plot_widget(.  
+0000baa0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000bab0: 2020 2020 7368 6f77 5f70 6f72 7473 3a20      show_ports: 
+0000bac0: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+0000bad0: 2020 2020 2070 6f72 745f 6d61 726b 6572       port_marker
+0000bae0: 5f6c 6179 6572 3a20 4c61 7965 7220 3d20  _layer: Layer = 
+0000baf0: 2831 2c20 3130 292c 0a20 2020 2029 202d  (1, 10),.    ) -
+0000bb00: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000bb10: 2222 2252 6574 7572 6e73 2069 7079 7468  """Returns ipyth
+0000bb20: 6f6e 2077 6964 6765 7420 666f 7220 6b6c  on widget for kl
+0000bb30: 6179 6f75 7420 7669 7375 616c 697a 6174  ayout visualizat
+0000bb40: 696f 6e2e 0a0a 2020 2020 2020 2020 4172  ion...        Ar
+0000bb50: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0000bb60: 7368 6f77 5f70 6f72 7473 3a20 7368 6f77  show_ports: show
+0000bb70: 7320 636f 6d70 6f6e 656e 7420 7769 7468  s component with
+0000bb80: 2070 6f72 7420 6d61 726b 6572 7320 616e   port markers an
+0000bb90: 6420 6c61 6265 6c73 2e0a 2020 2020 2020  d labels..      
+0000bba0: 2020 2020 2020 706f 7274 5f6d 6172 6b65        port_marke
+0000bbb0: 725f 6c61 7965 723a 2066 6f72 2074 6865  r_layer: for the
+0000bbc0: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
+0000bbd0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+0000bbe0: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
+0000bbf0: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
+0000bc00: 5f76 6965 7773 0a20 2020 2020 2020 2066  _views.        f
+0000bc10: 726f 6d20 6764 7366 6163 746f 7279 2e77  rom gdsfactory.w
+0000bc20: 6964 6765 7473 2e6c 6179 6f75 745f 7669  idgets.layout_vi
+0000bc30: 6577 6572 2069 6d70 6f72 7420 4c61 796f  ewer import Layo
+0000bc40: 7574 5669 6577 6572 0a20 2020 2020 2020  utViewer.       
+0000bc50: 2066 726f 6d20 4950 7974 686f 6e2e 6469   from IPython.di
+0000bc60: 7370 6c61 7920 696d 706f 7274 2064 6973  splay import dis
+0000bc70: 706c 6179 0a0a 2020 2020 2020 2020 636f  play..        co
+0000bc80: 6d70 6f6e 656e 7420 3d20 280a 2020 2020  mponent = (.    
+0000bc90: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+0000bca0: 5f70 696e 735f 7472 6961 6e67 6c65 2870  _pins_triangle(p
+0000bcb0: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
+0000bcc0: 3d70 6f72 745f 6d61 726b 6572 5f6c 6179  =port_marker_lay
+0000bcd0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0000bce0: 6966 2073 686f 775f 706f 7274 730a 2020  if show_ports.  
+0000bcf0: 2020 2020 2020 2020 2020 656c 7365 2073            else s
+0000bd00: 656c 660a 2020 2020 2020 2020 290a 0a20  elf.        ).. 
+0000bd10: 2020 2020 2020 2067 6473 7061 7468 203d         gdspath =
+0000bd20: 2063 6f6d 706f 6e65 6e74 2e77 7269 7465   component.write
+0000bd30: 5f67 6473 286c 6f67 6769 6e67 3d46 616c  _gds(logging=Fal
+0000bd40: 7365 290a 2020 2020 2020 2020 6c79 705f  se).        lyp_
+0000bd50: 7061 7468 203d 2067 6473 7061 7468 2e77  path = gdspath.w
+0000bd60: 6974 685f 7375 6666 6978 2822 2e6c 7970  ith_suffix(".lyp
+0000bd70: 2229 0a0a 2020 2020 2020 2020 6c61 7965  ")..        laye
+0000bd80: 725f 7669 6577 7320 3d20 6765 745f 6c61  r_views = get_la
+0000bd90: 7965 725f 7669 6577 7328 290a 2020 2020  yer_views().    
+0000bda0: 2020 2020 6c61 7965 725f 7669 6577 732e      layer_views.
+0000bdb0: 746f 5f6c 7970 2866 696c 6570 6174 683d  to_lyp(filepath=
+0000bdc0: 6c79 705f 7061 7468 290a 0a20 2020 2020  lyp_path)..     
+0000bdd0: 2020 206c 6179 6f75 7420 3d20 4c61 796f     layout = Layo
+0000bde0: 7574 5669 6577 6572 2867 6473 7061 7468  utViewer(gdspath
+0000bdf0: 2c20 6c79 705f 7061 7468 290a 2020 2020  , lyp_path).    
+0000be00: 2020 2020 6469 7370 6c61 7928 6c61 796f      display(layo
+0000be10: 7574 2e77 6964 6765 7429 0a0a 2020 2020  ut.widget)..    
+0000be20: 6465 6620 706c 6f74 5f6b 6c61 796f 7574  def plot_klayout
+0000be30: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000be40: 2020 2020 2020 2020 7368 6f77 5f70 6f72          show_por
+0000be50: 7473 3a20 626f 6f6c 203d 2054 7275 652c  ts: bool = True,
+0000be60: 0a20 2020 2020 2020 2070 6f72 745f 6d61  .        port_ma
+0000be70: 726b 6572 5f6c 6179 6572 3a20 4c61 7965  rker_layer: Laye
+0000be80: 7220 3d20 2831 2c20 3130 292c 0a20 2020  r = (1, 10),.   
+0000be90: 2020 2020 2073 686f 775f 6c61 6265 6c73       show_labels
+0000bea0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0000beb0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+0000bec0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+0000bed0: 7320 6b6c 6179 6f75 7420 696d 6167 652e  s klayout image.
+0000bee0: 0a0a 2020 2020 2020 2020 4966 2069 7420  ..        If it 
+0000bef0: 6661 696c 7320 746f 2069 6d70 6f72 7420  fails to import 
+0000bf00: 6b6c 6179 6f75 7420 6465 6661 756c 7473  klayout defaults
+0000bf10: 2074 6f20 6d61 7470 6c6f 746c 6962 2e0a   to matplotlib..
+0000bf20: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+0000bf30: 2020 2020 2020 2020 2020 2073 686f 775f             show_
+0000bf40: 706f 7274 733a 2073 686f 7773 2063 6f6d  ports: shows com
+0000bf50: 706f 6e65 6e74 2077 6974 6820 706f 7274  ponent with port
+0000bf60: 206d 6172 6b65 7273 2061 6e64 206c 6162   markers and lab
+0000bf70: 656c 732e 0a20 2020 2020 2020 2020 2020  els..           
+0000bf80: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
+0000bf90: 6572 3a20 666f 7220 7468 6520 706f 7274  er: for the port
+0000bfa0: 732e 0a20 2020 2020 2020 2020 2020 2073  s..            s
+0000bfb0: 686f 775f 6c61 6265 6c73 3a20 7368 6f77  how_labels: show
+0000bfc0: 7320 6c61 6265 6c73 2e0a 2020 2020 2020  s labels..      
+0000bfd0: 2020 2222 220a 0a20 2020 2020 2020 2063    """..        c
+0000bfe0: 6f6d 706f 6e65 6e74 203d 2028 0a20 2020  omponent = (.   
+0000bff0: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+0000c000: 645f 7069 6e73 5f74 7269 616e 676c 6528  d_pins_triangle(
+0000c010: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
+0000c020: 723d 706f 7274 5f6d 6172 6b65 725f 6c61  r=port_marker_la
+0000c030: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
+0000c040: 2069 6620 7368 6f77 5f70 6f72 7473 0a20   if show_ports. 
+0000c050: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+0000c060: 7365 6c66 0a20 2020 2020 2020 2029 0a0a  self.        )..
+0000c070: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000c080: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+0000c090: 6b6c 6179 6f75 742e 6462 2061 7320 6462  klayout.db as db
+0000c0a0: 2020 2320 6e6f 7161 3a20 4634 3031 0a20    # noqa: F401. 
+0000c0b0: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+0000c0c0: 7420 6b6c 6179 6f75 742e 6c61 7920 6173  t klayout.lay as
+0000c0d0: 206c 6179 0a20 2020 2020 2020 2020 2020   lay.           
+0000c0e0: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
+0000c0f0: 2e70 646b 2069 6d70 6f72 7420 6765 745f  .pdk import get_
+0000c100: 6c61 7965 725f 7669 6577 730a 2020 2020  layer_views.    
+0000c110: 2020 2020 2020 2020 6672 6f6d 2049 5079          from IPy
+0000c120: 7468 6f6e 2e64 6973 706c 6179 2069 6d70  thon.display imp
+0000c130: 6f72 7420 6469 7370 6c61 790a 2020 2020  ort display.    
+0000c140: 2020 2020 2020 2020 6672 6f6d 2069 7079          from ipy
+0000c150: 7769 6467 6574 7320 696d 706f 7274 2049  widgets import I
+0000c160: 6d61 6765 0a0a 2020 2020 2020 2020 2020  mage..          
+0000c170: 2020 6764 7370 6174 6820 3d20 636f 6d70    gdspath = comp
+0000c180: 6f6e 656e 742e 7772 6974 655f 6764 7328  onent.write_gds(
+0000c190: 6c6f 6767 696e 673d 4661 6c73 6529 0a20  logging=False). 
+0000c1a0: 2020 2020 2020 2020 2020 206c 7970 5f70             lyp_p
+0000c1b0: 6174 6820 3d20 6764 7370 6174 682e 7769  ath = gdspath.wi
+0000c1c0: 7468 5f73 7566 6669 7828 222e 6c79 7022  th_suffix(".lyp"
+0000c1d0: 290a 0a20 2020 2020 2020 2020 2020 206c  )..            l
+0000c1e0: 6179 6572 5f76 6965 7773 203d 2067 6574  ayer_views = get
+0000c1f0: 5f6c 6179 6572 5f76 6965 7773 2829 0a20  _layer_views(). 
+0000c200: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+0000c210: 5f76 6965 7773 2e74 6f5f 6c79 7028 6669  _views.to_lyp(fi
+0000c220: 6c65 7061 7468 3d6c 7970 5f70 6174 6829  lepath=lyp_path)
+0000c230: 0a0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+0000c240: 796f 7574 5f76 6965 7720 3d20 6c61 792e  yout_view = lay.
+0000c250: 4c61 796f 7574 5669 6577 2829 0a20 2020  LayoutView().   
+0000c260: 2020 2020 2020 2020 206c 6179 6f75 745f           layout_
+0000c270: 7669 6577 2e6c 6f61 645f 6c61 796f 7574  view.load_layout
+0000c280: 2873 7472 2867 6473 7061 7468 2e61 6273  (str(gdspath.abs
+0000c290: 6f6c 7574 6528 2929 290a 2020 2020 2020  olute())).      
+0000c2a0: 2020 2020 2020 6c61 796f 7574 5f76 6965        layout_vie
+0000c2b0: 772e 6d61 785f 6869 6572 2829 0a20 2020  w.max_hier().   
+0000c2c0: 2020 2020 2020 2020 206c 6179 6f75 745f           layout_
+0000c2d0: 7669 6577 2e6c 6f61 645f 6c61 7965 725f  view.load_layer_
+0000c2e0: 7072 6f70 7328 7374 7228 6c79 705f 7061  props(str(lyp_pa
+0000c2f0: 7468 2929 0a0a 2020 2020 2020 2020 2020  th))..          
+0000c300: 2020 6c61 796f 7574 5f76 6965 772e 7365    layout_view.se
+0000c310: 745f 636f 6e66 6967 2822 7465 7874 2d76  t_config("text-v
+0000c320: 6973 6962 6c65 222c 2022 7472 7565 2220  isible", "true" 
+0000c330: 6966 2073 686f 775f 6c61 6265 6c73 2065  if show_labels e
+0000c340: 6c73 6520 2266 616c 7365 2229 0a0a 2020  lse "false")..  
+0000c350: 2020 2020 2020 2020 2020 7069 7865 6c5f            pixel_
+0000c360: 6275 6666 6572 203d 206c 6179 6f75 745f  buffer = layout_
+0000c370: 7669 6577 2e67 6574 5f70 6978 656c 735f  view.get_pixels_
+0000c380: 7769 7468 5f6f 7074 696f 6e73 2838 3030  with_options(800
+0000c390: 2c20 3630 3029 0a20 2020 2020 2020 2020  , 600).         
+0000c3a0: 2020 2070 6e67 5f64 6174 6120 3d20 7069     png_data = pi
+0000c3b0: 7865 6c5f 6275 6666 6572 2e74 6f5f 706e  xel_buffer.to_pn
+0000c3c0: 675f 6461 7461 2829 0a20 2020 2020 2020  g_data().       
+0000c3d0: 2020 2020 2069 6d61 6765 203d 2049 6d61       image = Ima
+0000c3e0: 6765 2876 616c 7565 3d70 6e67 5f64 6174  ge(value=png_dat
+0000c3f0: 612c 2066 6f72 6d61 743d 2270 6e67 2229  a, format="png")
+0000c400: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
+0000c410: 706c 6179 2869 6d61 6765 290a 0a20 2020  play(image)..   
+0000c420: 2020 2020 2065 7863 6570 7420 496d 706f       except Impo
+0000c430: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
+0000c440: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+0000c450: 2020 2020 2020 2020 2020 2020 2259 6f75              "You
+0000c460: 2063 616e 2069 6e73 7461 6c6c 2060 7069   can install `pi
+0000c470: 7020 696e 7374 616c 6c20 6764 7366 6163  p install gdsfac
+0000c480: 746f 7279 5b66 756c 6c5d 6020 666f 7220  tory[full]` for 
+0000c490: 6265 7474 6572 2076 6973 7561 6c69 7a61  better visualiza
+0000c4a0: 7469 6f6e 220a 2020 2020 2020 2020 2020  tion".          
+0000c4b0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000c4c0: 636f 6d70 6f6e 656e 742e 706c 6f74 2870  component.plot(p
+0000c4d0: 6c6f 7474 6572 3d22 6d61 7470 6c6f 746c  lotter="matplotl
+0000c4e0: 6962 2229 0a0a 2020 2020 6465 6620 706c  ib")..    def pl
+0000c4f0: 6f74 5f6a 7570 7974 6572 2873 656c 6629  ot_jupyter(self)
+0000c500: 3a0a 2020 2020 2020 2020 2222 2253 686f  :.        """Sho
+0000c510: 7773 2063 7572 7265 6e74 2067 6473 2069  ws current gds i
+0000c520: 6e20 6b6c 6179 6f75 742e 2055 7365 7320  n klayout. Uses 
+0000c530: 4b77 6562 2069 6620 7365 7276 6572 2072  Kweb if server r
+0000c540: 756e 6e69 6e67 2e0a 0a20 2020 2020 2020  unning...       
+0000c550: 2069 6620 6e6f 7420 7472 6965 7320 7573   if not tries us
+0000c560: 696e 6720 4b6c 6179 6f75 7420 7769 6467  ing Klayout widg
+0000c570: 6574 2061 6e64 2066 696e 616c 6c79 2064  et and finally d
+0000c580: 6566 6175 6c74 7320 746f 206d 6174 706c  efaults to matpl
+0000c590: 6f74 6c69 622e 0a20 2020 2020 2020 2022  otlib..        "
+0000c5a0: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
+0000c5b0: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+0000c5c0: 7274 206f 730a 2020 2020 2020 2020 2020  rt os.          
+0000c5d0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+0000c5e0: 792e 636f 6e66 6967 2069 6d70 6f72 7420  y.config import 
+0000c5f0: 5041 5448 0a20 2020 2020 2020 2020 2020  PATH.           
+0000c600: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
+0000c610: 2e70 646b 2069 6d70 6f72 7420 6765 745f  .pdk import get_
+0000c620: 6c61 7965 725f 7669 6577 730a 2020 2020  layer_views.    
+0000c630: 2020 2020 2020 2020 6672 6f6d 2049 5079          from IPy
+0000c640: 7468 6f6e 2e64 6973 706c 6179 2069 6d70  thon.display imp
+0000c650: 6f72 7420 4946 7261 6d65 0a20 2020 2020  ort IFrame.     
+0000c660: 2020 2020 2020 2069 6d70 6f72 7420 6b77         import kw
+0000c670: 6562 2e73 6572 7665 725f 6a75 7079 7465  eb.server_jupyte
+0000c680: 7220 6173 206b 6a0a 2020 2020 2020 2020  r as kj.        
+0000c690: 2020 2020 6672 6f6d 2068 746d 6c20 696d      from html im
+0000c6a0: 706f 7274 2065 7363 6170 650a 0a20 2020  port escape..   
+0000c6b0: 2020 2020 2020 2020 2067 6473 7061 7468           gdspath
+0000c6c0: 203d 2073 656c 662e 7772 6974 655f 6764   = self.write_gd
+0000c6d0: 7328 6764 7364 6972 3d50 4154 482e 6764  s(gdsdir=PATH.gd
+0000c6e0: 736c 6962 202f 2022 6578 7472 6122 2c20  slib / "extra", 
+0000c6f0: 6c6f 6767 696e 673d 4661 6c73 6529 0a0a  logging=False)..
+0000c700: 2020 2020 2020 2020 2020 2020 6469 7270              dirp
+0000c710: 6174 6820 3d20 4744 5344 4952 5f54 454d  ath = GDSDIR_TEM
+0000c720: 500a 2020 2020 2020 2020 2020 2020 6469  P.            di
+0000c730: 7270 6174 682e 6d6b 6469 7228 6578 6973  rpath.mkdir(exis
+0000c740: 745f 6f6b 3d54 7275 652c 2070 6172 656e  t_ok=True, paren
+0000c750: 7473 3d54 7275 6529 0a20 2020 2020 2020  ts=True).       
+0000c760: 2020 2020 206c 7970 5f70 6174 6820 3d20       lyp_path = 
+0000c770: 6469 7270 6174 6820 2f20 226c 6179 6572  dirpath / "layer
+0000c780: 732e 6c79 7022 0a0a 2020 2020 2020 2020  s.lyp"..        
+0000c790: 2020 2020 6c61 7965 725f 7072 6f70 7320      layer_props 
+0000c7a0: 3d20 6765 745f 6c61 7965 725f 7669 6577  = get_layer_view
+0000c7b0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0000c7c0: 6c61 7965 725f 7072 6f70 732e 746f 5f6c  layer_props.to_l
+0000c7d0: 7970 2866 696c 6570 6174 683d 6c79 705f  yp(filepath=lyp_
+0000c7e0: 7061 7468 290a 0a20 2020 2020 2020 2020  path)..         
+0000c7f0: 2020 2070 6f72 7420 3d20 6b6a 2e70 6f72     port = kj.por
+0000c800: 7420 6966 2068 6173 6174 7472 286b 6a2c  t if hasattr(kj,
+0000c810: 2022 706f 7274 2229 2065 6c73 6520 3830   "port") else 80
+0000c820: 3030 0a0a 2020 2020 2020 2020 2020 2020  00..            
+0000c830: 7372 6320 3d20 6622 6874 7470 3a2f 2f31  src = f"http://1
+0000c840: 3237 2e30 2e30 2e31 3a7b 706f 7274 7d2f  27.0.0.1:{port}/
+0000c850: 6764 733f 6764 735f 6669 6c65 3d7b 6573  gds?gds_file={es
+0000c860: 6361 7065 2873 7472 2867 6473 7061 7468  cape(str(gdspath
+0000c870: 2929 7d26 6c61 7965 725f 7072 6f70 733d  ))}&layer_props=
+0000c880: 7b65 7363 6170 6528 7374 7228 6c79 705f  {escape(str(lyp_
+0000c890: 7061 7468 2929 7d22 0a20 2020 2020 2020  path))}".       
+0000c8a0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+0000c8b0: 6728 7372 6329 0a0a 2020 2020 2020 2020  g(src)..        
+0000c8c0: 2020 2020 6966 206b 6a2e 6a75 7079 7465      if kj.jupyte
+0000c8d0: 725f 7365 7276 6572 2061 6e64 206e 6f74  r_server and not
+0000c8e0: 206f 732e 656e 7669 726f 6e2e 6765 7428   os.environ.get(
+0000c8f0: 2244 4f43 5322 2c20 4661 6c73 6529 3a0a  "DOCS", False):.
+0000c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c910: 7265 7475 726e 2049 4672 616d 6528 0a20  return IFrame(. 
+0000c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c930: 2020 2073 7263 3d73 7263 2c0a 2020 2020     src=src,.    
+0000c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c950: 7769 6474 683d 3134 3030 2c0a 2020 2020  width=1400,.    
+0000c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c970: 6865 6967 6874 3d36 3030 2c0a 2020 2020  height=600,.    
+0000c980: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000c990: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9b0: 7265 7475 726e 2073 656c 662e 706c 6f74  return self.plot
+0000c9c0: 5f6b 6c61 796f 7574 2829 0a20 2020 2020  _klayout().     
+0000c9d0: 2020 2065 7863 6570 7420 496d 706f 7274     except Import
+0000c9e0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+0000c9f0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+0000ca00: 2020 2020 2020 2020 2020 2259 6f75 2063            "You c
+0000ca10: 616e 2069 6e73 7461 6c6c 2060 7069 7020  an install `pip 
+0000ca20: 696e 7374 616c 6c20 6764 7366 6163 746f  install gdsfacto
+0000ca30: 7279 5b66 756c 6c5d 6020 666f 7220 6265  ry[full]` for be
+0000ca40: 7474 6572 2076 6973 7561 6c69 7a61 7469  tter visualizati
+0000ca50: 6f6e 220a 2020 2020 2020 2020 2020 2020  on".            
+0000ca60: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000ca70: 7475 726e 2073 656c 662e 706c 6f74 5f6b  turn self.plot_k
+0000ca80: 6c61 796f 7574 2829 0a0a 2020 2020 6465  layout()..    de
+0000ca90: 6620 706c 6f74 5f6d 6174 706c 6f74 6c69  f plot_matplotli
+0000caa0: 6228 7365 6c66 2c20 2a2a 6b77 6172 6773  b(self, **kwargs
+0000cab0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000cac0: 2020 2022 2222 506c 6f74 2063 6f6d 706f     """Plot compo
+0000cad0: 6e65 6e74 2075 7369 6e67 206d 6174 706c  nent using matpl
+0000cae0: 6f74 6c69 622e 0a0a 2020 2020 2020 2020  otlib...        
+0000caf0: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
+0000cb00: 2020 2020 2020 2020 2020 7368 6f77 5f70            show_p
+0000cb10: 6f72 7473 3a20 5365 7473 2077 6865 7468  orts: Sets wheth
+0000cb20: 6572 2070 6f72 7473 2061 7265 2064 7261  er ports are dra
+0000cb30: 776e 2e0a 2020 2020 2020 2020 2020 2020  wn..            
+0000cb40: 7368 6f77 5f73 7562 706f 7274 733a 2053  show_subports: S
+0000cb50: 6574 7320 7768 6574 6865 7220 7375 6270  ets whether subp
+0000cb60: 6f72 7473 2028 706f 7274 7320 7468 6174  orts (ports that
+0000cb70: 2062 656c 6f6e 6720 746f 2072 6566 6572   belong to refer
+0000cb80: 656e 6365 7329 2061 7265 2064 7261 776e  ences) are drawn
+0000cb90: 2e0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+0000cba0: 6265 6c5f 616c 6961 7365 733a 2053 6574  bel_aliases: Set
+0000cbb0: 7320 7768 6574 6865 7220 616c 6961 7365  s whether aliase
+0000cbc0: 7320 6172 6520 6c61 6265 6c65 6420 7769  s are labeled wi
+0000cbd0: 7468 2061 2074 6578 7420 6e61 6d65 2e0a  th a text name..
+0000cbe0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000cbf0: 7769 6e64 6f77 3a20 4966 2054 7275 652c  window: If True,
+0000cc00: 2065 6163 6820 6361 6c6c 2074 6f20 7175   each call to qu
+0000cc10: 6963 6b70 6c6f 7428 2920 7769 6c6c 2067  ickplot() will g
+0000cc20: 656e 6572 6174 6520 6120 7365 7061 7261  enerate a separa
+0000cc30: 7465 2077 696e 646f 772e 0a20 2020 2020  te window..     
+0000cc40: 2020 2020 2020 2062 6c6f 636b 696e 673a         blocking:
+0000cc50: 2049 6620 5472 7565 2c20 6361 6c6c 696e   If True, callin
+0000cc60: 6720 7175 6963 6b70 6c6f 7428 2920 7769  g quickplot() wi
+0000cc70: 6c6c 2070 6175 7365 2065 7865 6375 7469  ll pause executi
+0000cc80: 6f6e 206f 6620 2822 626c 6f63 6b22 2920  on of ("block") 
+0000cc90: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+0000cca0: 2020 2020 7265 6d61 696e 6465 7220 6f66      remainder of
+0000ccb0: 2074 6865 2070 7974 686f 6e20 636f 6465   the python code
+0000ccc0: 2075 6e74 696c 2074 6865 2071 7569 636b   until the quick
+0000ccd0: 706c 6f74 2829 2077 696e 646f 7720 6973  plot() window is
+0000cce0: 2063 6c6f 7365 642e 0a20 2020 2020 2020   closed..       
+0000ccf0: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
+0000cd00: 652c 2074 6865 2077 696e 646f 7720 7769  e, the window wi
+0000cd10: 6c6c 2062 6520 6f70 656e 6564 2061 6e64  ll be opened and
+0000cd20: 2063 6f64 6520 7769 6c6c 2063 6f6e 7469   code will conti
+0000cd30: 6e75 6520 746f 2072 756e 2e0a 2020 2020  nue to run..    
+0000cd40: 2020 2020 2020 2020 7a6f 6f6d 5f66 6163          zoom_fac
+0000cd50: 746f 723a 2053 6574 7320 7468 6520 7363  tor: Sets the sc
+0000cd60: 616c 696e 6720 6661 6374 6f72 2077 6865  aling factor whe
+0000cd70: 6e20 7a6f 6f6d 696e 6720 7468 6520 7175  n zooming the qu
+0000cd80: 6963 6b70 6c6f 7420 7769 6e64 6f77 2077  ickplot window w
+0000cd90: 6974 6820 7468 650a 2020 2020 2020 2020  ith the.        
+0000cda0: 2020 2020 2020 2020 6d6f 7573 6577 6865          mousewhe
+0000cdb0: 656c 2f74 7261 636b 7061 642e 0a20 2020  el/trackpad..   
+0000cdc0: 2020 2020 2020 2020 2069 6e74 6572 6163           interac
+0000cdd0: 7469 7665 5f7a 6f6f 6d3a 2045 6e61 626c  tive_zoom: Enabl
+0000cde0: 6573 2075 7369 6e67 206d 6f75 7365 7768  es using mousewh
+0000cdf0: 6565 6c2f 7472 6163 6b70 6164 2074 6f20  eel/trackpad to 
+0000ce00: 7a6f 6f6d 2e0a 2020 2020 2020 2020 2020  zoom..          
+0000ce10: 2020 666f 6e74 7369 7a65 3a20 666f 7220    fontsize: for 
+0000ce20: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
+0000ce30: 2020 2020 6c61 7965 7273 5f65 7863 6c75      layers_exclu
+0000ce40: 6465 643a 206c 6973 7420 6f66 206c 6179  ded: list of lay
+0000ce50: 6572 7320 746f 2065 7863 6c75 6465 2e0a  ers to exclude..
+0000ce60: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000ce70: 725f 7669 6577 733a 206c 6179 6572 5f76  r_views: layer_v
+0000ce80: 6965 7773 2063 6f6c 6f72 7320 6c6f 6164  iews colors load
+0000ce90: 6564 2066 726f 6d20 4b6c 6179 6f75 742e  ed from Klayout.
+0000cea0: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+0000ceb0: 5f61 7370 6563 743a 206d 696e 696d 756d  _aspect: minimum
+0000cec0: 2061 7370 6563 7420 7261 7469 6f2e 0a20   aspect ratio.. 
+0000ced0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000cee0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000cef0: 7279 2e71 7569 636b 706c 6f74 7465 7220  ry.quickplotter 
+0000cf00: 696d 706f 7274 2071 7569 636b 706c 6f74  import quickplot
+0000cf10: 0a0a 2020 2020 2020 2020 7175 6963 6b70  ..        quickp
+0000cf20: 6c6f 7428 7365 6c66 2c20 2a2a 6b77 6172  lot(self, **kwar
+0000cf30: 6773 290a 0a20 2020 2064 6566 2070 6c6f  gs)..    def plo
+0000cf40: 7428 7365 6c66 2c20 706c 6f74 7465 723a  t(self, plotter:
+0000cf50: 204f 7074 696f 6e61 6c5b 506c 6f74 7465   Optional[Plotte
+0000cf60: 725d 203d 204e 6f6e 652c 202a 2a6b 7761  r] = None, **kwa
+0000cf70: 7267 7329 202d 3e20 4e6f 6e65 3a0a 2020  rgs) -> None:.  
+0000cf80: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+0000cf90: 2063 6f6d 706f 6e65 6e74 2070 6c6f 7420   component plot 
+0000cfa0: 7573 696e 6720 6b6c 6179 6f75 742c 206d  using klayout, m
+0000cfb0: 6174 706c 6f74 6c69 622c 2068 6f6c 6f76  atplotlib, holov
+0000cfc0: 6965 7773 206f 7220 7174 2e0a 0a20 2020  iews or qt...   
+0000cfd0: 2020 2020 2057 6520 7265 636f 6d6d 656e       We recommen
+0000cfe0: 6420 7573 696e 6720 6b6c 6179 6f75 742e  d using klayout.
+0000cff0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+0000d000: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
+0000d010: 7465 723a 2070 6c6f 7420 6261 636b 656e  ter: plot backen
+0000d020: 6420 2827 686f 6c6f 7669 6577 7327 2c20  d ('holoviews', 
+0000d030: 276d 6174 706c 6f74 6c69 6227 2c20 2771  'matplotlib', 'q
+0000d040: 7427 2c20 276b 6c61 796f 7574 2729 2e0a  t', 'klayout')..
+0000d050: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000d060: 2020 2020 706c 6f74 7465 7220 3d20 706c      plotter = pl
+0000d070: 6f74 7465 7220 6f72 2043 4f4e 462e 6765  otter or CONF.ge
+0000d080: 7428 2270 6c6f 7474 6572 222c 2022 6d61  t("plotter", "ma
+0000d090: 7470 6c6f 746c 6962 2229 0a0a 2020 2020  tplotlib")..    
+0000d0a0: 2020 2020 6966 2070 6c6f 7474 6572 203d      if plotter =
+0000d0b0: 3d20 226b 6c61 796f 7574 223a 0a20 2020  = "klayout":.   
+0000d0c0: 2020 2020 2020 2020 2073 656c 662e 706c           self.pl
+0000d0d0: 6f74 5f6b 6c61 796f 7574 2829 0a20 2020  ot_klayout().   
+0000d0e0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0000d0f0: 0a20 2020 2020 2020 2065 6c69 6620 706c  .        elif pl
+0000d100: 6f74 7465 7220 3d3d 2022 6d61 7470 6c6f  otter == "matplo
+0000d110: 746c 6962 223a 0a20 2020 2020 2020 2020  tlib":.         
+0000d120: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000d130: 7279 2e71 7569 636b 706c 6f74 7465 7220  ry.quickplotter 
+0000d140: 696d 706f 7274 2071 7569 636b 706c 6f74  import quickplot
+0000d150: 0a0a 2020 2020 2020 2020 2020 2020 7175  ..            qu
+0000d160: 6963 6b70 6c6f 7428 7365 6c66 2c20 2a2a  ickplot(self, **
+0000d170: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+0000d180: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+0000d190: 2020 2020 656c 6966 2070 6c6f 7474 6572      elif plotter
+0000d1a0: 203d 3d20 2268 6f6c 6f76 6965 7773 223a   == "holoviews":
+0000d1b0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000d1c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d1d0: 2020 696d 706f 7274 2068 6f6c 6f76 6965    import holovie
+0000d1e0: 7773 2061 7320 6876 0a0a 2020 2020 2020  ws as hv..      
+0000d1f0: 2020 2020 2020 2020 2020 6876 2e65 7874            hv.ext
+0000d200: 656e 7369 6f6e 2822 626f 6b65 6822 290a  ension("bokeh").
+0000d210: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000d220: 7074 2049 6d70 6f72 7445 7272 6f72 2061  pt ImportError a
+0000d230: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000d240: 2020 2020 2070 7269 6e74 2822 796f 7520       print("you 
+0000d250: 6e65 6564 2074 6f20 6070 6970 2069 6e73  need to `pip ins
+0000d260: 7461 6c6c 2068 6f6c 6f76 6965 7773 6022  tall holoviews`"
+0000d270: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d280: 2020 7261 6973 6520 650a 2020 2020 2020    raise e.      
+0000d290: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000d2a0: 662e 706c 6f74 5f68 6f6c 6f76 6965 7773  f.plot_holoviews
+0000d2b0: 282a 2a6b 7761 7267 7329 0a0a 2020 2020  (**kwargs)..    
+0000d2c0: 2020 2020 656c 6966 2070 6c6f 7474 6572      elif plotter
+0000d2d0: 203d 3d20 2271 7422 3a0a 2020 2020 2020   == "qt":.      
+0000d2e0: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+0000d2f0: 6374 6f72 792e 7175 6963 6b70 6c6f 7474  ctory.quickplott
+0000d300: 6572 2069 6d70 6f72 7420 7175 6963 6b70  er import quickp
+0000d310: 6c6f 7432 0a0a 2020 2020 2020 2020 2020  lot2..          
+0000d320: 2020 7175 6963 6b70 6c6f 7432 2873 656c    quickplot2(sel
+0000d330: 6629 0a20 2020 2020 2020 2020 2020 2072  f).            r
+0000d340: 6574 7572 6e0a 2020 2020 2020 2020 656c  eturn.        el
+0000d350: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d360: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0000d370: 2866 227b 706c 6f74 7465 7221 727d 206e  (f"{plotter!r} n
+0000d380: 6f74 2069 6e20 7b50 6c6f 7474 6572 7d22  ot in {Plotter}"
+0000d390: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
+0000d3a0: 686f 6c6f 7669 6577 7328 0a20 2020 2020  holoviews(.     
+0000d3b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0000d3c0: 206c 6179 6572 735f 6578 636c 7564 6564   layers_excluded
+0000d3d0: 3a20 4f70 7469 6f6e 616c 5b4c 6179 6572  : Optional[Layer
+0000d3e0: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
+0000d3f0: 2020 206c 6179 6572 5f76 6965 7773 3a20     layer_views: 
+0000d400: 4f70 7469 6f6e 616c 5b4c 6179 6572 5669  Optional[LayerVi
+0000d410: 6577 735d 203d 204e 6f6e 652c 0a20 2020  ews] = None,.   
+0000d420: 2020 2020 206d 696e 5f61 7370 6563 743a       min_aspect:
+0000d430: 2066 6c6f 6174 203d 2030 2e32 352c 0a20   float = 0.25,. 
+0000d440: 2020 2020 2020 2070 6164 6469 6e67 3a20         padding: 
+0000d450: 666c 6f61 7420 3d20 302e 352c 0a20 2020  float = 0.5,.   
+0000d460: 2029 3a0a 2020 2020 2020 2020 2222 2250   ):.        """P
+0000d470: 6c6f 7420 636f 6d70 6f6e 656e 7420 696e  lot component in
+0000d480: 2068 6f6c 6f76 6965 7773 2e0a 0a20 2020   holoviews...   
+0000d490: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0000d4a0: 2020 2020 2020 206c 6179 6572 735f 6578         layers_ex
+0000d4b0: 636c 7564 6564 3a20 6c69 7374 206f 6620  cluded: list of 
+0000d4c0: 6c61 7965 7273 2074 6f20 6578 636c 7564  layers to exclud
+0000d4d0: 652e 0a20 2020 2020 2020 2020 2020 206c  e..            l
+0000d4e0: 6179 6572 5f76 6965 7773 3a20 6c61 7965  ayer_views: laye
+0000d4f0: 725f 7669 6577 7320 636f 6c6f 7273 206c  r_views colors l
+0000d500: 6f61 6465 6420 6672 6f6d 204b 6c61 796f  oaded from Klayo
+0000d510: 7574 2e0a 2020 2020 2020 2020 2020 2020  ut..            
+0000d520: 6d69 6e5f 6173 7065 6374 3a20 6d69 6e69  min_aspect: mini
+0000d530: 6d75 6d20 6173 7065 6374 2072 6174 696f  mum aspect ratio
+0000d540: 2e0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+0000d550: 6464 696e 673a 2061 726f 756e 6420 626f  dding: around bo
+0000d560: 756e 6469 6e67 2062 6f78 2e0a 0a20 2020  unding box...   
+0000d570: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
+0000d580: 2020 2020 2020 2020 2020 486f 6c6f 7669            Holovi
+0000d590: 6577 7320 4f76 6572 6c61 7920 746f 2064  ews Overlay to d
+0000d5a0: 6973 706c 6179 2061 6c6c 2070 6f6c 7967  isplay all polyg
+0000d5b0: 6f6e 732e 0a20 2020 2020 2020 2022 2222  ons..        """
+0000d5c0: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+0000d5d0: 7366 6163 746f 7279 2e61 6464 5f70 696e  sfactory.add_pin
+0000d5e0: 7320 696d 706f 7274 2067 6574 5f70 696e  s import get_pin
+0000d5f0: 5f74 7269 616e 676c 655f 706f 6c79 676f  _triangle_polygo
+0000d600: 6e5f 7469 700a 2020 2020 2020 2020 6672  n_tip.        fr
+0000d610: 6f6d 2067 6473 6661 6374 6f72 792e 6765  om gdsfactory.ge
+0000d620: 6e65 7269 635f 7465 6368 2069 6d70 6f72  neric_tech impor
+0000d630: 7420 4c41 5945 525f 5649 4557 530a 0a20  t LAYER_VIEWS.. 
+0000d640: 2020 2020 2020 2069 6620 6c61 7965 725f         if layer_
+0000d650: 7669 6577 7320 6973 204e 6f6e 653a 0a20  views is None:. 
+0000d660: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+0000d670: 5f76 6965 7773 203d 204c 4159 4552 5f56  _views = LAYER_V
+0000d680: 4945 5753 0a0a 2020 2020 2020 2020 7472  IEWS..        tr
+0000d690: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
+0000d6a0: 6d70 6f72 7420 686f 6c6f 7669 6577 7320  mport holoviews 
+0000d6b0: 6173 2068 760a 0a20 2020 2020 2020 2020  as hv..         
+0000d6c0: 2020 2068 762e 6578 7465 6e73 696f 6e28     hv.extension(
+0000d6d0: 2262 6f6b 6568 2229 0a20 2020 2020 2020  "bokeh").       
+0000d6e0: 2065 7863 6570 7420 496d 706f 7274 4572   except ImportEr
+0000d6f0: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0000d700: 2020 2020 2020 7072 696e 7428 2279 6f75        print("you
+0000d710: 206e 6565 6420 746f 2060 7069 7020 696e   need to `pip in
+0000d720: 7374 616c 6c20 686f 6c6f 7669 6577 7360  stall holoviews`
+0000d730: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0000d740: 6169 7365 2065 0a0a 2020 2020 2020 2020  aise e..        
+0000d750: 7365 6c66 2e5f 6262 5f76 616c 6964 203d  self._bb_valid =
+0000d760: 2046 616c 7365 2020 2320 7265 636f 6d70   False  # recomp
+0000d770: 7574 6520 7468 6520 626f 756e 6469 6e67  ute the bounding
+0000d780: 2062 6f78 0a20 2020 2020 2020 2062 203d   box.        b =
+0000d790: 2073 656c 662e 6262 6f78 202b 2028 282d   self.bbox + ((-
+0000d7a0: 7061 6464 696e 672c 202d 7061 6464 696e  padding, -paddin
+0000d7b0: 6729 2c20 2870 6164 6469 6e67 2c20 7061  g), (padding, pa
+0000d7c0: 6464 696e 6729 290a 2020 2020 2020 2020  dding)).        
+0000d7d0: 6220 3d20 6e70 2e61 7272 6179 2862 2e66  b = np.array(b.f
+0000d7e0: 6c61 7429 0a20 2020 2020 2020 2063 656e  lat).        cen
+0000d7f0: 7465 7220 3d20 6e70 2e61 7272 6179 2828  ter = np.array((
+0000d800: 6e70 2e73 756d 2862 5b3a 3a32 5d29 202f  np.sum(b[::2]) /
+0000d810: 2032 2c20 6e70 2e73 756d 2862 5b31 3a3a   2, np.sum(b[1::
+0000d820: 325d 2920 2f20 3229 290a 2020 2020 2020  2]) / 2)).      
+0000d830: 2020 7369 7a65 203d 206e 702e 6172 7261    size = np.arra
+0000d840: 7928 286e 702e 6162 7328 625b 325d 202d  y((np.abs(b[2] -
+0000d850: 2062 5b30 5d29 2c20 6e70 2e61 6273 2862   b[0]), np.abs(b
+0000d860: 5b33 5d20 2d20 625b 315d 2929 290a 2020  [3] - b[1]))).  
+0000d870: 2020 2020 2020 6478 203d 206e 702e 6172        dx = np.ar
+0000d880: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
+0000d890: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000d8a0: 2020 206e 702e 6d61 7869 6d75 6d28 6d69     np.maximum(mi
+0000d8b0: 6e5f 6173 7065 6374 202a 2073 697a 655b  n_aspect * size[
+0000d8c0: 315d 2c20 7369 7a65 5b30 5d29 202f 2032  1], size[0]) / 2
+0000d8d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d8e0: 2020 6e70 2e6d 6178 696d 756d 2873 697a    np.maximum(siz
+0000d8f0: 655b 315d 2c20 6d69 6e5f 6173 7065 6374  e[1], min_aspect
+0000d900: 202a 2073 697a 655b 305d 2920 2f20 322c   * size[0]) / 2,
+0000d910: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000d920: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000d930: 2062 203d 206e 702e 6873 7461 636b 2828   b = np.hstack((
+0000d940: 6365 6e74 6572 202d 2064 782c 2063 656e  center - dx, cen
+0000d950: 7465 7220 2b20 6478 2929 0a0a 2020 2020  ter + dx))..    
+0000d960: 2020 2020 706c 6f74 735f 746f 5f6f 7665      plots_to_ove
+0000d970: 726c 6179 203d 205b 5d0a 2020 2020 2020  rlay = [].      
+0000d980: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
+0000d990: 6420 3d20 5b5d 2069 6620 6c61 7965 7273  d = [] if layers
+0000d9a0: 5f65 7863 6c75 6465 6420 6973 204e 6f6e  _excluded is Non
+0000d9b0: 6520 656c 7365 206c 6179 6572 735f 6578  e else layers_ex
+0000d9c0: 636c 7564 6564 0a0a 2020 2020 2020 2020  cluded..        
+0000d9d0: 666f 7220 6c61 7965 722c 2070 6f6c 7967  for layer, polyg
+0000d9e0: 6f6e 2069 6e20 7365 6c66 2e67 6574 5f70  on in self.get_p
+0000d9f0: 6f6c 7967 6f6e 7328 6279 5f73 7065 633d  olygons(by_spec=
+0000da00: 5472 7565 292e 6974 656d 7328 293a 0a20  True).items():. 
+0000da10: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
+0000da20: 7965 7220 696e 206c 6179 6572 735f 6578  yer in layers_ex
+0000da30: 636c 7564 6564 3a0a 2020 2020 2020 2020  cluded:.        
+0000da40: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0000da50: 0a0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+0000da60: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000da70: 2020 206c 6179 6572 5f76 6965 7720 3d20     layer_view = 
+0000da80: 6c61 7965 725f 7669 6577 732e 6765 745f  layer_views.get_
+0000da90: 6672 6f6d 5f74 7570 6c65 286c 6179 6572  from_tuple(layer
+0000daa0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+0000dab0: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
+0000dac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dad0: 206c 6179 6572 7320 3d20 6c69 7374 286c   layers = list(l
+0000dae0: 6179 6572 5f76 6965 7773 2e67 6574 5f6c  ayer_views.get_l
+0000daf0: 6179 6572 5f76 6965 7773 2829 2e6b 6579  ayer_views().key
+0000db00: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
+0000db10: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+0000db20: 726e 2866 227b 6c61 7965 7221 727d 206e  rn(f"{layer!r} n
+0000db30: 6f74 2064 6566 696e 6564 2069 6e20 7b6c  ot defined in {l
+0000db40: 6179 6572 737d 222c 2073 7461 636b 6c65  ayers}", stackle
+0000db50: 7665 6c3d 3329 0a20 2020 2020 2020 2020  vel=3).         
+0000db60: 2020 2020 2020 206c 6179 6572 5f76 6965         layer_vie
+0000db70: 7720 3d20 4c61 7965 7256 6965 7728 6c61  w = LayerView(la
+0000db80: 7965 723d 6c61 7965 7229 0a20 2020 2020  yer=layer).     
+0000db90: 2020 2020 2020 2023 2054 4f44 4f3a 204d         # TODO: M
+0000dba0: 6174 6368 2075 7020 6f70 7469 6f6e 7320  atch up options 
+0000dbb0: 7769 7468 204c 6179 6572 5669 6577 730a  with LayerViews.
+0000dbc0: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
+0000dbd0: 735f 746f 5f6f 7665 726c 6179 2e61 7070  s_to_overlay.app
+0000dbe0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+0000dbf0: 2020 2020 2068 762e 506f 6c79 676f 6e73       hv.Polygons
+0000dc00: 2870 6f6c 7967 6f6e 2c20 6c61 6265 6c3d  (polygon, label=
+0000dc10: 7374 7228 6c61 7965 725f 7669 6577 2e6e  str(layer_view.n
+0000dc20: 616d 6529 292e 6f70 7473 280a 2020 2020  ame)).opts(.    
+0000dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc40: 6461 7461 5f61 7370 6563 743d 312c 0a20  data_aspect=1,. 
+0000dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc60: 2020 2066 7261 6d65 5f77 6964 7468 3d35     frame_width=5
+0000dc70: 3030 2c0a 2020 2020 2020 2020 2020 2020  00,.            
+0000dc80: 2020 2020 2020 2020 796c 696d 3d28 625b          ylim=(b[
+0000dc90: 315d 2c20 625b 335d 292c 0a20 2020 2020  1], b[3]),.     
+0000dca0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+0000dcb0: 6c69 6d3d 2862 5b30 5d2c 2062 5b32 5d29  lim=(b[0], b[2])
+0000dcc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000dcd0: 2020 2020 2020 6669 6c6c 5f63 6f6c 6f72        fill_color
+0000dce0: 3d6c 6179 6572 5f76 6965 772e 6669 6c6c  =layer_view.fill
+0000dcf0: 5f63 6f6c 6f72 2e61 735f 7267 6228 2920  _color.as_rgb() 
+0000dd00: 6f72 2022 222c 0a20 2020 2020 2020 2020  or "",.         
+0000dd10: 2020 2020 2020 2020 2020 206c 696e 655f             line_
+0000dd20: 636f 6c6f 723d 6c61 7965 725f 7669 6577  color=layer_view
+0000dd30: 2e66 7261 6d65 5f63 6f6c 6f72 2e61 735f  .frame_color.as_
+0000dd40: 7267 6228 2920 6f72 2022 222c 0a20 2020  rgb() or "",.   
+0000dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd60: 2066 696c 6c5f 616c 7068 613d 6c61 7965   fill_alpha=laye
+0000dd70: 725f 7669 6577 2e67 6574 5f61 6c70 6861  r_view.get_alpha
+0000dd80: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
+0000dd90: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0000dda0: 6e65 5f61 6c70 6861 3d6c 6179 6572 5f76  ne_alpha=layer_v
+0000ddb0: 6965 772e 6765 745f 616c 7068 6128 2920  iew.get_alpha() 
+0000ddc0: 6f72 2022 222c 0a20 2020 2020 2020 2020  or "",.         
+0000ddd0: 2020 2020 2020 2020 2020 2074 6f6f 6c73             tools
+0000dde0: 3d5b 2268 6f76 6572 225d 2c0a 2020 2020  =["hover"],.    
+0000ddf0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000de00: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000de10: 2020 2020 666f 7220 6e61 6d65 2c20 706f      for name, po
+0000de20: 7274 2069 6e20 7365 6c66 2e70 6f72 7473  rt in self.ports
+0000de30: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+0000de40: 2020 2020 2020 6e61 6d65 203d 2073 7472        name = str
+0000de50: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
+0000de60: 2020 2070 6f6c 7967 6f6e 2c20 7074 6970     polygon, ptip
+0000de70: 203d 2067 6574 5f70 696e 5f74 7269 616e   = get_pin_trian
+0000de80: 676c 655f 706f 6c79 676f 6e5f 7469 7028  gle_polygon_tip(
+0000de90: 706f 7274 3d70 6f72 7429 0a0a 2020 2020  port=port)..    
+0000dea0: 2020 2020 2020 2020 706c 6f74 735f 746f          plots_to
+0000deb0: 5f6f 7665 726c 6179 2e61 7070 656e 6428  _overlay.append(
+0000dec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ded0: 2068 762e 506f 6c79 676f 6e73 2870 6f6c   hv.Polygons(pol
+0000dee0: 7967 6f6e 2c20 6c61 6265 6c3d 6e61 6d65  ygon, label=name
+0000def0: 292e 6f70 7473 280a 2020 2020 2020 2020  ).opts(.        
+0000df00: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0000df10: 5f61 7370 6563 743d 312c 0a20 2020 2020  _aspect=1,.     
+0000df20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000df30: 7261 6d65 5f77 6964 7468 3d35 3030 2c0a  rame_width=500,.
+0000df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df50: 2020 2020 6669 6c6c 5f61 6c70 6861 3d30      fill_alpha=0
+0000df60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000df70: 2020 2020 2020 796c 696d 3d28 625b 315d        ylim=(b[1]
+0000df80: 2c20 625b 335d 292c 0a20 2020 2020 2020  , b[3]),.       
+0000df90: 2020 2020 2020 2020 2020 2020 2078 6c69               xli
+0000dfa0: 6d3d 2862 5b30 5d2c 2062 5b32 5d29 2c0a  m=(b[0], b[2]),.
+0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfc0: 2020 2020 636f 6c6f 723d 2272 6564 222c      color="red",
+0000dfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dfe0: 2020 2020 206c 696e 655f 616c 7068 613d       line_alpha=
+0000dff0: 6c61 7965 725f 7669 6577 2e67 6574 5f61  layer_view.get_a
+0000e000: 6c70 6861 2829 206f 7220 2222 2c0a 2020  lpha() or "",.  
+0000e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e020: 2020 746f 6f6c 733d 5b22 686f 7665 7222    tools=["hover"
+0000e030: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000e040: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000e050: 2020 2020 202a 2068 762e 5465 7874 2870       * hv.Text(p
+0000e060: 7469 705b 305d 2c20 7074 6970 5b31 5d2c  tip[0], ptip[1],
+0000e070: 206e 616d 6529 0a20 2020 2020 2020 2020   name).         
+0000e080: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
+0000e090: 7475 726e 2068 762e 4f76 6572 6c61 7928  turn hv.Overlay(
+0000e0a0: 706c 6f74 735f 746f 5f6f 7665 726c 6179  plots_to_overlay
+0000e0b0: 292e 6f70 7473 280a 2020 2020 2020 2020  ).opts(.        
+0000e0c0: 2020 2020 7368 6f77 5f6c 6567 656e 643d      show_legend=
+0000e0d0: 5472 7565 2c20 7368 6172 6564 5f61 7865  True, shared_axe
+0000e0e0: 733d 4661 6c73 652c 2079 6c69 6d3d 2862  s=False, ylim=(b
+0000e0f0: 5b31 5d2c 2062 5b33 5d29 2c20 786c 696d  [1], b[3]), xlim
+0000e100: 3d28 625b 305d 2c20 625b 325d 290a 2020  =(b[0], b[2]).  
+0000e110: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+0000e120: 2073 686f 7728 0a20 2020 2020 2020 2073   show(.        s
+0000e130: 656c 662c 0a20 2020 2020 2020 2073 686f  elf,.        sho
+0000e140: 775f 706f 7274 733a 2062 6f6f 6c20 3d20  w_ports: bool = 
+0000e150: 4661 6c73 652c 0a20 2020 2020 2020 2073  False,.        s
+0000e160: 686f 775f 7375 6270 6f72 7473 3a20 626f  how_subports: bo
+0000e170: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+0000e180: 2020 2020 706f 7274 5f6d 6172 6b65 725f      port_marker_
+0000e190: 6c61 7965 723a 204c 6179 6572 203d 2028  layer: Layer = (
+0000e1a0: 312c 2031 3029 2c0a 2020 2020 2020 2020  1, 10),.        
+0000e1b0: 2a2a 6b77 6172 6773 2c0a 2020 2020 2920  **kwargs,.    ) 
+0000e1c0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000e1d0: 2022 2222 5368 6f77 2063 6f6d 706f 6e65   """Show compone
+0000e1e0: 6e74 2069 6e20 4b4c 6179 6f75 742e 0a0a  nt in KLayout...
+0000e1f0: 2020 2020 2020 2020 7265 7475 726e 7320          returns 
+0000e200: 6120 636f 7079 206f 6620 7468 6520 436f  a copy of the Co
+0000e210: 6d70 6f6e 656e 742c 2073 6f20 7468 6520  mponent, so the 
+0000e220: 6f72 6967 696e 616c 2063 6f6d 706f 6e65  original compone
+0000e230: 6e74 2072 656d 6169 6e73 2069 6e74 6163  nt remains intac
+0000e240: 742e 0a20 2020 2020 2020 2077 6974 6820  t..        with 
+0000e250: 7069 6e73 206d 6172 6b65 7273 206f 6e20  pins markers on 
+0000e260: 6561 6368 2070 6f72 7420 7368 6f77 5f70  each port show_p
+0000e270: 6f72 7473 203d 2054 7275 652c 2061 6e64  orts = True, and
+0000e280: 206f 7074 696f 6e61 6c6c 7920 616c 736f   optionally also
+0000e290: 0a20 2020 2020 2020 2074 6865 2070 6f72  .        the por
+0000e2a0: 7473 2066 726f 6d20 7468 6520 7265 6665  ts from the refe
+0000e2b0: 7265 6e63 6573 2028 7368 6f77 5f73 7562  rences (show_sub
+0000e2c0: 706f 7274 733d 5472 7565 290a 0a20 2020  ports=True)..   
+0000e2d0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0000e2e0: 2020 2020 2020 2073 686f 775f 706f 7274         show_port
+0000e2f0: 733a 2073 686f 7773 2063 6f6d 706f 6e65  s: shows compone
+0000e300: 6e74 2077 6974 6820 706f 7274 206d 6172  nt with port mar
+0000e310: 6b65 7273 2061 6e64 206c 6162 656c 732e  kers and labels.
+0000e320: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+0000e330: 775f 7375 6270 6f72 7473 3a20 6164 6420  w_subports: add 
+0000e340: 706f 7274 7320 6d61 726b 6572 7320 616e  ports markers an
+0000e350: 6420 6c61 6265 6c73 2074 6f20 7265 6665  d labels to refe
+0000e360: 7265 6e63 6573 2e0a 2020 2020 2020 2020  rences..        
+0000e370: 2020 2020 706f 7274 5f6d 6172 6b65 725f      port_marker_
+0000e380: 6c61 7965 723a 2066 6f72 2074 6865 2070  layer: for the p
+0000e390: 6f72 7473 2e0a 0a20 2020 2020 2020 204b  orts...        K
+0000e3a0: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
+0000e3b0: 2020 2020 2020 2020 2067 6473 7061 7468           gdspath
+0000e3c0: 3a20 4744 5320 6669 6c65 2070 6174 6820  : GDS file path 
+0000e3d0: 746f 2077 7269 7465 2074 6f2e 0a20 2020  to write to..   
+0000e3e0: 2020 2020 2020 2020 2067 6473 6469 723a           gdsdir:
+0000e3f0: 2064 6972 6563 746f 7279 2066 6f72 2074   directory for t
+0000e400: 6865 2047 4453 2066 696c 652e 2044 6566  he GDS file. Def
+0000e410: 6175 6c74 7320 746f 202f 746d 702f 2e0a  aults to /tmp/..
+0000e420: 2020 2020 2020 2020 2020 2020 756e 6974              unit
+0000e430: 3a20 756e 6974 2073 697a 6520 666f 7220  : unit size for 
+0000e440: 6f62 6a65 6374 7320 696e 206c 6962 7261  objects in libra
+0000e450: 7279 2e20 3175 6d20 6279 2064 6566 6175  ry. 1um by defau
+0000e460: 6c74 2e0a 2020 2020 2020 2020 2020 2020  lt..            
+0000e470: 7072 6563 6973 696f 6e3a 2066 6f72 206f  precision: for o
+0000e480: 626a 6563 7420 6469 6d65 6e73 696f 6e73  bject dimensions
+0000e490: 2069 6e20 7468 6520 6c69 6272 6172 7920   in the library 
+0000e4a0: 286d 292e 2031 6e6d 2062 7920 6465 6661  (m). 1nm by defa
+0000e4b0: 756c 742e 0a20 2020 2020 2020 2020 2020  ult..           
+0000e4c0: 2074 696d 6573 7461 6d70 3a20 4465 6661   timestamp: Defa
+0000e4d0: 756c 7473 2074 6f20 3230 3139 2d31 302d  ults to 2019-10-
+0000e4e0: 3235 2e20 4966 204e 6f6e 6520 7573 6573  25. If None uses
+0000e4f0: 2063 7572 7265 6e74 2074 696d 652e 0a20   current time.. 
+0000e500: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000e510: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000e520: 7279 2e61 6464 5f70 696e 7320 696d 706f  ry.add_pins impo
+0000e530: 7274 2061 6464 5f70 696e 735f 7472 6961  rt add_pins_tria
+0000e540: 6e67 6c65 0a20 2020 2020 2020 2066 726f  ngle.        fro
+0000e550: 6d20 6764 7366 6163 746f 7279 2e73 686f  m gdsfactory.sho
+0000e560: 7720 696d 706f 7274 2073 686f 770a 0a20  w import show.. 
+0000e570: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000e580: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0000e590: 2073 656c 662e 6164 645f 7069 6e73 5f74   self.add_pins_t
+0000e5a0: 7269 616e 676c 6528 706f 7274 5f6d 6172  riangle(port_mar
+0000e5b0: 6b65 725f 6c61 7965 723d 706f 7274 5f6d  ker_layer=port_m
+0000e5c0: 6172 6b65 725f 6c61 7965 7229 0a20 2020  arker_layer).   
+0000e5d0: 2020 2020 2020 2020 2069 6620 7368 6f77           if show
+0000e5e0: 5f70 6f72 7473 0a20 2020 2020 2020 2020  _ports.         
+0000e5f0: 2020 2065 6c73 6520 7365 6c66 0a20 2020     else self.   
+0000e600: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000e610: 6966 2073 686f 775f 7375 6270 6f72 7473  if show_subports
+0000e620: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0000e630: 6d70 6f6e 656e 7420 3d20 7365 6c66 2e63  mponent = self.c
+0000e640: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
+0000e650: 2020 636f 6d70 6f6e 656e 742e 6e61 6d65    component.name
+0000e660: 203d 2073 656c 662e 6e61 6d65 0a20 2020   = self.name.   
+0000e670: 2020 2020 2020 2020 2066 6f72 2072 6566           for ref
+0000e680: 6572 656e 6365 2069 6e20 636f 6d70 6f6e  erence in compon
+0000e690: 656e 742e 7265 6665 7265 6e63 6573 3a0a  ent.references:.
+0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6b0: 6966 2069 7369 6e73 7461 6e63 6528 636f  if isinstance(co
+0000e6c0: 6d70 6f6e 656e 742c 2043 6f6d 706f 6e65  mponent, Compone
+0000e6d0: 6e74 5265 6665 7265 6e63 6529 3a0a 2020  ntReference):.  
+0000e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6f0: 2020 6164 645f 7069 6e73 5f74 7269 616e    add_pins_trian
+0000e700: 676c 6528 0a20 2020 2020 2020 2020 2020  gle(.           
+0000e710: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+0000e720: 706f 6e65 6e74 3d63 6f6d 706f 6e65 6e74  ponent=component
+0000e730: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e740: 2020 2020 2020 2020 2020 7265 6665 7265            refere
+0000e750: 6e63 653d 7265 6665 7265 6e63 652c 0a20  nce=reference,. 
 0000e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e770: 2029 0a0a 2020 2020 2020 2020 7368 6f77   )..        show
-0000e780: 2863 6f6d 706f 6e65 6e74 2c20 2a2a 6b77  (component, **kw
-0000e790: 6172 6773 290a 0a20 2020 2064 6566 205f  args)..    def _
-0000e7a0: 7772 6974 655f 6c69 6272 6172 7928 0a20  write_library(. 
-0000e7b0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000e7c0: 2020 2020 2067 6473 7061 7468 3a20 4f70       gdspath: Op
-0000e7d0: 7469 6f6e 616c 5b50 6174 6854 7970 655d  tional[PathType]
-0000e7e0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000e7f0: 2067 6473 6469 723a 204f 7074 696f 6e61   gdsdir: Optiona
-0000e800: 6c5b 5061 7468 5479 7065 5d20 3d20 4e6f  l[PathType] = No
-0000e810: 6e65 2c0a 2020 2020 2020 2020 7469 6d65  ne,.        time
-0000e820: 7374 616d 703a 204f 7074 696f 6e61 6c5b  stamp: Optional[
-0000e830: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-0000e840: 655d 203d 205f 7469 6d65 7374 616d 7032  e] = _timestamp2
-0000e850: 3031 392c 0a20 2020 2020 2020 206c 6f67  019,.        log
-0000e860: 6769 6e67 3a20 626f 6f6c 203d 2054 7275  ging: bool = Tru
-0000e870: 652c 0a20 2020 2020 2020 2077 6974 685f  e,.        with_
-0000e880: 6f61 7369 733a 2062 6f6f 6c20 3d20 4661  oasis: bool = Fa
-0000e890: 6c73 652c 0a20 2020 2020 2020 202a 2a6b  lse,.        **k
-0000e8a0: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
-0000e8b0: 5061 7468 3a0a 2020 2020 2020 2020 2222  Path:.        ""
-0000e8c0: 2257 7269 7465 2063 6f6d 706f 6e65 6e74  "Write component
-0000e8d0: 2074 6f20 4744 5320 6f72 204f 4153 4953   to GDS or OASIS
-0000e8e0: 2061 6e64 2072 6574 7572 6e73 2067 6473   and returns gds
-0000e8f0: 7061 7468 2e0a 0a20 2020 2020 2020 2041  path...        A
-0000e900: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-0000e910: 2067 6473 7061 7468 3a20 4744 5320 6669   gdspath: GDS fi
-0000e920: 6c65 2070 6174 6820 746f 2077 7269 7465  le path to write
-0000e930: 2074 6f2e 0a20 2020 2020 2020 2020 2020   to..           
-0000e940: 2067 6473 6469 723a 2064 6972 6563 746f   gdsdir: directo
-0000e950: 7279 2066 6f72 2074 6865 2047 4453 2066  ry for the GDS f
-0000e960: 696c 652e 2044 6566 6175 6c74 7320 746f  ile. Defaults to
-0000e970: 202f 746d 702f 7261 6e64 6f6d 4669 6c65   /tmp/randomFile
-0000e980: 2f67 6473 6661 6374 6f72 792e 0a20 2020  /gdsfactory..   
-0000e990: 2020 2020 2020 2020 2074 696d 6573 7461           timesta
-0000e9a0: 6d70 3a20 4465 6661 756c 7473 2074 6f20  mp: Defaults to 
-0000e9b0: 3230 3139 2d31 302d 3235 2066 6f72 2063  2019-10-25 for c
-0000e9c0: 6f6e 7369 7374 656e 7420 6861 7368 2e0a  onsistent hash..
-0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9e0: 4966 204e 6f6e 6520 7573 6573 2063 7572  If None uses cur
-0000e9f0: 7265 6e74 2074 696d 652e 0a20 2020 2020  rent time..     
-0000ea00: 2020 2020 2020 206c 6f67 6769 6e67 3a20         logging: 
-0000ea10: 6469 7361 626c 6520 4744 5320 7061 7468  disable GDS path
-0000ea20: 206c 6f67 6769 6e67 2c20 666f 7220 6578   logging, for ex
-0000ea30: 616d 706c 6520 666f 7220 7368 6f77 696e  ample for showin
-0000ea40: 6720 6974 2069 6e20 4b4c 6179 6f75 742e  g it in KLayout.
-0000ea50: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000ea60: 685f 6f61 7369 733a 2049 6620 5472 7565  h_oasis: If True
-0000ea70: 2c20 6669 6c65 2077 696c 6c20 6265 2077  , file will be w
-0000ea80: 7269 7474 656e 2074 6f20 4f41 5349 532e  ritten to OASIS.
-0000ea90: 204f 7468 6572 7769 7365 2c20 6669 6c65   Otherwise, file
-0000eaa0: 2077 696c 6c20 6265 2077 7269 7474 656e   will be written
-0000eab0: 2074 6f20 4744 532e 0a0a 2020 2020 2020   to GDS...      
-0000eac0: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
-0000ead0: 2020 2020 2020 2020 2020 2020 4b65 7977              Keyw
-0000eae0: 6f72 6420 6172 6775 6d65 6e74 7320 7769  ord arguments wi
-0000eaf0: 6c6c 206f 7665 7272 6964 6520 7468 6520  ll override the 
-0000eb00: 6163 7469 7665 2050 444b 2773 2064 6566  active PDK's def
-0000eb10: 6175 6c74 2047 6473 5772 6974 6553 6574  ault GdsWriteSet
-0000eb20: 7469 6e67 7320 616e 6420 4f61 7369 7357  tings and OasisW
-0000eb30: 7269 7465 5365 7474 696e 6773 2e0a 0a20  riteSettings... 
-0000eb40: 2020 2020 2020 2020 2020 2047 6473 2073             Gds s
-0000eb50: 6574 7469 6e67 733a 0a20 2020 2020 2020  ettings:.       
-0000eb60: 2020 2020 2020 2020 2075 6e69 743a 2075           unit: u
-0000eb70: 6e69 7420 7369 7a65 2066 6f72 206f 626a  nit size for obj
-0000eb80: 6563 7473 2069 6e20 6c69 6272 6172 792e  ects in library.
-0000eb90: 2031 756d 2062 7920 6465 6661 756c 742e   1um by default.
-0000eba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ebb0: 2070 7265 6369 7369 6f6e 3a20 666f 7220   precision: for 
-0000ebc0: 6469 6d65 6e73 696f 6e73 2069 6e20 7468  dimensions in th
-0000ebd0: 6520 6c69 6272 6172 7920 286d 292e 2031  e library (m). 1
-0000ebe0: 6e6d 2062 7920 6465 6661 756c 742e 0a20  nm by default.. 
-0000ebf0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000ec00: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
-0000ec10: 3a20 7370 6563 6966 7920 686f 7720 746f  : specify how to
-0000ec20: 2072 6573 6f6c 7665 2064 7570 6c69 6361   resolve duplica
-0000ec30: 7465 2d6e 616d 6564 2063 656c 6c73 2e20  te-named cells. 
-0000ec40: 4368 6f6f 7365 206f 6e65 206f 6620 7468  Choose one of th
-0000ec50: 6520 666f 6c6c 6f77 696e 673a 0a20 2020  e following:.   
-0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec70: 2022 7761 726e 2220 2864 6566 6175 6c74   "warn" (default
-0000ec80: 293a 206f 7665 7277 7269 7465 2061 6c6c  ): overwrite all
-0000ec90: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
-0000eca0: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
-0000ecb0: 2064 7570 6c69 6361 7465 7320 2861 7262   duplicates (arb
-0000ecc0: 6974 7261 7269 6c79 292e 0a20 2020 2020  itrarily)..     
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000ece0: 6572 726f 7222 3a20 7468 726f 7720 6120  error": throw a 
-0000ecf0: 5661 6c75 6545 7272 6f72 2077 6865 6e20  ValueError when 
-0000ed00: 6174 7465 6d70 7469 6e67 2074 6f20 7772  attempting to wr
-0000ed10: 6974 6520 6120 6764 7320 7769 7468 2064  ite a gds with d
-0000ed20: 7570 6c69 6361 7465 2063 656c 6c73 2e0a  uplicate cells..
-0000ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed40: 2020 2020 226f 7665 7277 7269 7465 223a      "overwrite":
-0000ed50: 206f 7665 7277 7269 7465 2061 6c6c 2064   overwrite all d
-0000ed60: 7570 6c69 6361 7465 2063 656c 6c73 2077  uplicate cells w
-0000ed70: 6974 6820 6f6e 6520 6f66 2074 6865 2064  ith one of the d
-0000ed80: 7570 6c69 6361 7465 732c 2077 6974 686f  uplicates, witho
-0000ed90: 7574 2077 6172 6e69 6e67 2e0a 2020 2020  ut warning..    
-0000eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edb0: 4e6f 6e65 3a20 646f 206e 6f74 2074 7279  None: do not try
-0000edc0: 2074 6f20 7265 736f 6c76 6520 2861 7420   to resolve (at 
-0000edd0: 796f 7572 206f 776e 2072 6973 6b21 290a  your own risk!).
-0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edf0: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
-0000ee00: 7265 6673 3a20 666c 6174 7465 6e73 2063  refs: flattens c
-0000ee10: 6f6d 706f 6e65 6e74 2072 6566 6572 656e  omponent referen
-0000ee20: 6365 7320 7768 6963 6820 6861 7665 2069  ces which have i
-0000ee30: 6e76 616c 6964 2074 7261 6e73 666f 726d  nvalid transform
-0000ee40: 6174 696f 6e73 2e0a 2020 2020 2020 2020  ations..        
-0000ee50: 2020 2020 2020 2020 6d61 785f 706f 696e          max_poin
-0000ee60: 7473 3a20 4d61 7869 6d61 6c20 6e75 6d62  ts: Maximal numb
-0000ee70: 6572 206f 6620 7665 7274 6963 6573 2070  er of vertices p
-0000ee80: 6572 2070 6f6c 7967 6f6e 2e20 506f 6c79  er polygon. Poly
-0000ee90: 676f 6e73 2077 6974 6820 6d6f 7265 2076  gons with more v
-0000eea0: 6572 7469 6365 7320 7468 6174 2074 6869  ertices that thi
-0000eeb0: 7320 6172 6520 6175 746f 6d61 7469 6361  s are automatica
-0000eec0: 6c6c 7920 6672 6163 7475 7265 642e 0a0a  lly fractured...
-0000eed0: 2020 2020 2020 2020 2020 2020 4f61 7369              Oasi
-0000eee0: 7320 7365 7474 696e 6773 3a0a 2020 2020  s settings:.    
-0000eef0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-0000ef00: 7265 7373 696f 6e5f 6c65 7665 6c3a 204c  ression_level: L
-0000ef10: 6576 656c 206f 6620 636f 6d70 7265 7373  evel of compress
-0000ef20: 696f 6e20 666f 7220 6365 6c6c 7320 2862  ion for cells (b
-0000ef30: 6574 7765 656e 2030 2061 6e64 2039 292e  etween 0 and 9).
-0000ef40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef50: 2020 2020 2053 6574 7469 6e67 2074 6f20       Setting to 
-0000ef60: 3020 7769 6c6c 2064 6973 6162 6c65 2063  0 will disable c
-0000ef70: 656c 6c20 636f 6d70 7265 7373 696f 6e2c  ell compression,
-0000ef80: 2031 2067 6976 6573 2074 6865 2062 6573   1 gives the bes
-0000ef90: 7420 7370 6565 6420 616e 6420 392c 2074  t speed and 9, t
-0000efa0: 6865 2062 6573 7420 636f 6d70 7265 7373  he best compress
-0000efb0: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
-0000efc0: 2020 2020 2064 6574 6563 745f 7265 6374       detect_rect
-0000efd0: 616e 676c 6573 3a20 5374 6f72 6520 7265  angles: Store re
-0000efe0: 6374 616e 676c 6573 2069 6e20 636f 6d70  ctangles in comp
-0000eff0: 7265 7373 6564 2066 6f72 6d61 742e 0a20  ressed format.. 
-0000f000: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000f010: 6574 6563 745f 7472 6170 657a 6f69 6473  etect_trapezoids
-0000f020: 3a20 5374 6f72 6520 7472 6170 657a 6f69  : Store trapezoi
-0000f030: 6473 2069 6e20 636f 6d70 7265 7373 6564  ds in compressed
-0000f040: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
-0000f050: 2020 2020 2020 2020 2063 6972 636c 655f           circle_
-0000f060: 746f 6c65 7261 6e63 653a 2054 6f6c 6572  tolerance: Toler
-0000f070: 616e 6365 2066 6f72 2064 6574 6563 7469  ance for detecti
-0000f080: 6e67 2063 6972 636c 6573 2e20 4966 206c  ng circles. If l
-0000f090: 6573 7320 6f72 2065 7175 616c 2074 6f20  ess or equal to 
-0000f0a0: 302c 206e 6f20 6465 7465 6374 696f 6e20  0, no detection 
-0000f0b0: 6973 2070 6572 666f 726d 6564 2e20 4369  is performed. Ci
-0000f0c0: 7263 6c65 7320 6172 6520 7374 6f72 6564  rcles are stored
-0000f0d0: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
-0000f0e0: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
-0000f0f0: 2020 2020 2020 2076 616c 6964 6174 696f         validatio
-0000f100: 6e20 2822 6372 6333 3222 2c20 2263 6865  n ("crc32", "che
-0000f110: 636b 7375 6d33 3222 2c20 4e6f 6e65 293a  cksum32", None):
-0000f120: 2074 7970 6520 6f66 2076 616c 6964 6174   type of validat
-0000f130: 696f 6e20 746f 2069 6e63 6c75 6465 2069  ion to include i
-0000f140: 6e20 7468 6520 7361 7665 6420 6669 6c65  n the saved file
-0000f150: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f160: 2020 7374 616e 6461 7264 5f70 726f 7065    standard_prope
-0000f170: 7274 6965 733a 2053 746f 7265 2073 7461  rties: Store sta
-0000f180: 6e64 6172 6420 4f41 5349 5320 7072 6f70  ndard OASIS prop
-0000f190: 6572 7469 6573 2069 6e20 7468 6520 6669  erties in the fi
-0000f1a0: 6c65 2e0a 0a20 2020 2020 2020 2022 2222  le...        """
-0000f1b0: 0a0a 2020 2020 2020 2020 6672 6f6d 2067  ..        from g
-0000f1c0: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
-0000f1d0: 706f 7274 2067 6574 5f61 6374 6976 655f  port get_active_
-0000f1e0: 7064 6b0a 0a20 2020 2020 2020 2069 6620  pdk..        if 
-0000f1f0: 6764 7370 6174 6820 616e 6420 6764 7364  gdspath and gdsd
-0000f200: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
-0000f210: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
-0000f220: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000f230: 6764 7370 6174 6820 616e 6420 6764 7364  gdspath and gdsd
-0000f240: 6972 2068 6176 6520 626f 7468 2062 6565  ir have both bee
-0000f250: 6e20 7370 6563 6966 6965 642e 2067 6473  n specified. gds
-0000f260: 7061 7468 2077 696c 6c20 7461 6b65 2070  path will take p
-0000f270: 7265 6365 6465 6e63 6520 616e 6420 6764  recedence and gd
-0000f280: 7364 6972 2077 696c 6c20 6265 2069 676e  sdir will be ign
-0000f290: 6f72 6564 2e22 2c0a 2020 2020 2020 2020  ored.",.        
-0000f2a0: 2020 2020 2020 2020 7374 6163 6b6c 6576          stacklev
-0000f2b0: 656c 3d33 2c0a 2020 2020 2020 2020 2020  el=3,.          
-0000f2c0: 2020 290a 0a20 2020 2020 2020 2064 6566    )..        def
-0000f2d0: 6175 6c74 5f73 6574 7469 6e67 7320 3d20  ault_settings = 
-0000f2e0: 6765 745f 6163 7469 7665 5f70 646b 2829  get_active_pdk()
-0000f2f0: 2e67 6473 5f77 7269 7465 5f73 6574 7469  .gds_write_setti
-0000f300: 6e67 730a 2020 2020 2020 2020 6465 6661  ngs.        defa
-0000f310: 756c 745f 6f61 7369 735f 7365 7474 696e  ult_oasis_settin
-0000f320: 6773 203d 2067 6574 5f61 6374 6976 655f  gs = get_active_
-0000f330: 7064 6b28 292e 6f61 7369 735f 7365 7474  pdk().oasis_sett
-0000f340: 696e 6773 0a0a 2020 2020 2020 2020 6578  ings..        ex
-0000f350: 706c 6963 6974 5f67 6473 5f73 6574 7469  plicit_gds_setti
-0000f360: 6e67 7320 3d20 7b0a 2020 2020 2020 2020  ngs = {.        
-0000f370: 2020 2020 6b3a 2076 0a20 2020 2020 2020      k: v.       
-0000f380: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
-0000f390: 206b 7761 7267 732e 6974 656d 7328 290a   kwargs.items().
-0000f3a0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0000f3b0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000f3c0: 206b 2069 6e20 6465 6661 756c 745f 7365   k in default_se
-0000f3d0: 7474 696e 6773 2e64 6963 7428 290a 2020  ttings.dict().  
-0000f3e0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0000f3f0: 6578 706c 6963 6974 5f6f 6173 5f73 6574  explicit_oas_set
-0000f400: 7469 6e67 7320 3d20 7b0a 2020 2020 2020  tings = {.      
-0000f410: 2020 2020 2020 6b3a 2076 0a20 2020 2020        k: v.     
-0000f420: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-0000f430: 696e 206b 7761 7267 732e 6974 656d 7328  in kwargs.items(
-0000f440: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000f450: 2076 2069 7320 6e6f 7420 4e6f 6e65 2061   v is not None a
-0000f460: 6e64 206b 2069 6e20 6465 6661 756c 745f  nd k in default_
-0000f470: 6f61 7369 735f 7365 7474 696e 6773 2e64  oasis_settings.d
-0000f480: 6963 7428 290a 2020 2020 2020 2020 7d0a  ict().        }.
-0000f490: 2020 2020 2020 2020 2320 7570 6461 7465          # update
-0000f4a0: 2074 6865 2077 7269 7465 2073 6574 7469   the write setti
-0000f4b0: 6e67 7320 7769 7468 2061 6e79 2073 6574  ngs with any set
-0000f4c0: 7469 6e67 7320 6578 706c 6963 6974 6c79  tings explicitly
-0000f4d0: 2070 6173 7365 640a 2020 2020 2020 2020   passed.        
-0000f4e0: 7772 6974 655f 7365 7474 696e 6773 203d  write_settings =
-0000f4f0: 2064 6566 6175 6c74 5f73 6574 7469 6e67   default_setting
-0000f500: 732e 636f 7079 2875 7064 6174 653d 6578  s.copy(update=ex
-0000f510: 706c 6963 6974 5f67 6473 5f73 6574 7469  plicit_gds_setti
-0000f520: 6e67 7329 0a20 2020 2020 2020 206f 6173  ngs).        oas
-0000f530: 6973 5f73 6574 7469 6e67 7320 3d20 6465  is_settings = de
-0000f540: 6661 756c 745f 6f61 7369 735f 7365 7474  fault_oasis_sett
-0000f550: 696e 6773 2e63 6f70 7928 7570 6461 7465  ings.copy(update
-0000f560: 3d65 7870 6c69 6369 745f 6f61 735f 7365  =explicit_oas_se
-0000f570: 7474 696e 6773 290a 0a20 2020 2020 2020  ttings)..       
-0000f580: 205f 6368 6563 6b5f 756e 6361 6368 6564   _check_uncached
-0000f590: 5f63 6f6d 706f 6e65 6e74 7328 0a20 2020  _components(.   
-0000f5a0: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
-0000f5b0: 6e74 3d73 656c 662c 206d 6f64 653d 7772  nt=self, mode=wr
-0000f5c0: 6974 655f 7365 7474 696e 6773 2e6f 6e5f  ite_settings.on_
-0000f5d0: 756e 6361 6368 6564 5f63 6f6d 706f 6e65  uncached_compone
-0000f5e0: 6e74 0a20 2020 2020 2020 2029 0a0a 2020  nt.        )..  
-0000f5f0: 2020 2020 2020 6966 2077 7269 7465 5f73        if write_s
-0000f600: 6574 7469 6e67 732e 666c 6174 7465 6e5f  ettings.flatten_
-0000f610: 696e 7661 6c69 645f 7265 6673 3a0a 2020  invalid_refs:.  
-0000f620: 2020 2020 2020 2020 2020 746f 705f 6365            top_ce
-0000f630: 6c6c 203d 2066 6c61 7474 656e 5f69 6e76  ll = flatten_inv
-0000f640: 616c 6964 5f72 6566 735f 7265 6375 7273  alid_refs_recurs
-0000f650: 6976 6528 7365 6c66 290a 2020 2020 2020  ive(self).      
-0000f660: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000f670: 2020 2020 746f 705f 6365 6c6c 203d 2073      top_cell = s
-0000f680: 656c 660a 0a20 2020 2020 2020 2067 6473  elf..        gds
-0000f690: 6469 7220 3d20 6764 7364 6972 206f 7220  dir = gdsdir or 
-0000f6a0: 4744 5344 4952 5f54 454d 500a 2020 2020  GDSDIR_TEMP.    
-0000f6b0: 2020 2020 6764 7364 6972 203d 2070 6174      gdsdir = pat
-0000f6c0: 686c 6962 2e50 6174 6828 6764 7364 6972  hlib.Path(gdsdir
-0000f6d0: 290a 2020 2020 2020 2020 6966 2077 6974  ).        if wit
-0000f6e0: 685f 6f61 7369 733a 0a20 2020 2020 2020  h_oasis:.       
-0000f6f0: 2020 2020 2067 6473 7061 7468 203d 2067       gdspath = g
-0000f700: 6473 7061 7468 206f 7220 6764 7364 6972  dspath or gdsdir
-0000f710: 202f 2066 227b 746f 705f 6365 6c6c 2e6e   / f"{top_cell.n
-0000f720: 616d 657d 2e6f 6173 220a 2020 2020 2020  ame}.oas".      
-0000f730: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000f740: 2020 2020 6764 7370 6174 6820 3d20 6764      gdspath = gd
-0000f750: 7370 6174 6820 6f72 2067 6473 6469 7220  spath or gdsdir 
-0000f760: 2f20 6622 7b74 6f70 5f63 656c 6c2e 6e61  / f"{top_cell.na
-0000f770: 6d65 7d2e 6764 7322 0a20 2020 2020 2020  me}.gds".       
-0000f780: 2067 6473 7061 7468 203d 2070 6174 686c   gdspath = pathl
-0000f790: 6962 2e50 6174 6828 6764 7370 6174 6829  ib.Path(gdspath)
-0000f7a0: 0a20 2020 2020 2020 2067 6473 6469 7220  .        gdsdir 
-0000f7b0: 3d20 6764 7370 6174 682e 7061 7265 6e74  = gdspath.parent
-0000f7c0: 0a20 2020 2020 2020 2067 6473 6469 722e  .        gdsdir.
-0000f7d0: 6d6b 6469 7228 6578 6973 745f 6f6b 3d54  mkdir(exist_ok=T
-0000f7e0: 7275 652c 2070 6172 656e 7473 3d54 7275  rue, parents=Tru
-0000f7f0: 6529 0a0a 2020 2020 2020 2020 6365 6c6c  e)..        cell
-0000f800: 7320 3d20 746f 705f 6365 6c6c 2e67 6574  s = top_cell.get
-0000f810: 5f64 6570 656e 6465 6e63 6965 7328 7265  _dependencies(re
-0000f820: 6375 7273 6976 653d 5472 7565 290a 2020  cursive=True).  
-0000f830: 2020 2020 2020 6365 6c6c 5f6e 616d 6573        cell_names
-0000f840: 203d 205b 6365 6c6c 2e6e 616d 6520 666f   = [cell.name fo
-0000f850: 7220 6365 6c6c 2069 6e20 6c69 7374 2863  r cell in list(c
-0000f860: 656c 6c73 295d 0a20 2020 2020 2020 2063  ells)].        c
-0000f870: 656c 6c5f 6e61 6d65 735f 756e 6971 7565  ell_names_unique
-0000f880: 203d 2073 6574 2863 656c 6c5f 6e61 6d65   = set(cell_name
-0000f890: 7329 0a0a 2020 2020 2020 2020 6966 206c  s)..        if l
-0000f8a0: 656e 2863 656c 6c5f 6e61 6d65 7329 2021  en(cell_names) !
-0000f8b0: 3d20 6c65 6e28 7365 7428 6365 6c6c 5f6e  = len(set(cell_n
-0000f8c0: 616d 6573 2929 3a0a 2020 2020 2020 2020  ames)):.        
-0000f8d0: 2020 2020 666f 7220 6365 6c6c 5f6e 616d      for cell_nam
-0000f8e0: 6520 696e 2063 656c 6c5f 6e61 6d65 735f  e in cell_names_
-0000f8f0: 756e 6971 7565 3a0a 2020 2020 2020 2020  unique:.        
-0000f900: 2020 2020 2020 2020 6365 6c6c 5f6e 616d          cell_nam
-0000f910: 6573 2e72 656d 6f76 6528 6365 6c6c 5f6e  es.remove(cell_n
-0000f920: 616d 6529 0a0a 2020 2020 2020 2020 2020  ame)..          
-0000f930: 2020 6966 2077 7269 7465 5f73 6574 7469    if write_setti
-0000f940: 6e67 732e 6f6e 5f64 7570 6c69 6361 7465  ngs.on_duplicate
-0000f950: 5f63 656c 6c20 3d3d 2022 6572 726f 7222  _cell == "error"
-0000f960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f970: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000f980: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000f990: 2020 2020 2020 2020 6622 4475 706c 6963          f"Duplic
-0000f9a0: 6174 6564 2063 656c 6c20 6e61 6d65 7320  ated cell names 
-0000f9b0: 696e 207b 746f 705f 6365 6c6c 2e6e 616d  in {top_cell.nam
-0000f9c0: 6521 727d 3a20 7b63 656c 6c5f 6e61 6d65  e!r}: {cell_name
-0000f9d0: 7321 727d 220a 2020 2020 2020 2020 2020  s!r}".          
-0000f9e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000f9f0: 2020 2020 656c 6966 2077 7269 7465 5f73      elif write_s
-0000fa00: 6574 7469 6e67 732e 6f6e 5f64 7570 6c69  ettings.on_dupli
-0000fa10: 6361 7465 5f63 656c 6c20 696e 207b 2277  cate_cell in {"w
-0000fa20: 6172 6e22 2c20 226f 7665 7277 7269 7465  arn", "overwrite
-0000fa30: 227d 3a0a 2020 2020 2020 2020 2020 2020  "}:.            
-0000fa40: 2020 2020 6966 2077 7269 7465 5f73 6574      if write_set
-0000fa50: 7469 6e67 732e 6f6e 5f64 7570 6c69 6361  tings.on_duplica
-0000fa60: 7465 5f63 656c 6c20 3d3d 2022 7761 726e  te_cell == "warn
-0000fa70: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0000fa80: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
-0000fa90: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
-0000faa0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000fab0: 4475 706c 6963 6174 6564 2063 656c 6c20  Duplicated cell 
-0000fac0: 6e61 6d65 7320 696e 207b 746f 705f 6365  names in {top_ce
-0000fad0: 6c6c 2e6e 616d 6521 727d 3a20 207b 6365  ll.name!r}:  {ce
-0000fae0: 6c6c 5f6e 616d 6573 7d22 2c0a 2020 2020  ll_names}",.    
-0000faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb00: 2020 2020 7374 6163 6b6c 6576 656c 3d33      stacklevel=3
-0000fb10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fb20: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000fb30: 2020 2020 2020 2020 6365 6c6c 735f 6469          cells_di
-0000fb40: 6374 203d 207b 6365 6c6c 2e6e 616d 653a  ct = {cell.name:
-0000fb50: 2063 656c 6c2e 5f63 656c 6c20 666f 7220   cell._cell for 
-0000fb60: 6365 6c6c 2069 6e20 6365 6c6c 737d 0a20  cell in cells}. 
-0000fb70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000fb80: 656c 6c73 203d 2063 656c 6c73 5f64 6963  ells = cells_dic
-0000fb90: 742e 7661 6c75 6573 2829 0a20 2020 2020  t.values().     
-0000fba0: 2020 2020 2020 2065 6c69 6620 7772 6974         elif writ
-0000fbb0: 655f 7365 7474 696e 6773 2e6f 6e5f 6475  e_settings.on_du
-0000fbc0: 706c 6963 6174 655f 6365 6c6c 2069 7320  plicate_cell is 
-0000fbd0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000fbe0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000fbf0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0000fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc10: 6622 6f6e 5f64 7570 6c69 6361 7465 5f63  f"on_duplicate_c
-0000fc20: 656c 6c3a 207b 7772 6974 655f 7365 7474  ell: {write_sett
-0000fc30: 696e 6773 2e6f 6e5f 6475 706c 6963 6174  ings.on_duplicat
-0000fc40: 655f 6365 6c6c 2172 7d20 6e6f 7420 696e  e_cell!r} not in
-0000fc50: 2028 4e6f 6e65 2c20 7761 726e 2c20 6572   (None, warn, er
-0000fc60: 726f 722c 206f 7665 7277 7269 7465 2922  ror, overwrite)"
-0000fc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fc80: 2029 0a0a 2020 2020 2020 2020 616c 6c5f   )..        all_
-0000fc90: 6365 6c6c 7320 3d20 5b74 6f70 5f63 656c  cells = [top_cel
-0000fca0: 6c2e 5f63 656c 6c5d 202b 2073 6f72 7465  l._cell] + sorte
-0000fcb0: 6428 6365 6c6c 732c 206b 6579 3d6c 616d  d(cells, key=lam
-0000fcc0: 6264 6120 6363 3a20 6363 2e6e 616d 6529  bda cc: cc.name)
-0000fcd0: 0a0a 2020 2020 2020 2020 6e6f 5f6e 616d  ..        no_nam
-0000fce0: 655f 6365 6c6c 7320 3d20 5b0a 2020 2020  e_cells = [.    
-0000fcf0: 2020 2020 2020 2020 6365 6c6c 2e6e 616d          cell.nam
-0000fd00: 6520 666f 7220 6365 6c6c 2069 6e20 616c  e for cell in al
-0000fd10: 6c5f 6365 6c6c 7320 6966 2063 656c 6c2e  l_cells if cell.
-0000fd20: 6e61 6d65 2e73 7461 7274 7377 6974 6828  name.startswith(
-0000fd30: 2255 6e6e 616d 6564 2229 0a20 2020 2020  "Unnamed").     
-0000fd40: 2020 205d 0a0a 2020 2020 2020 2020 6966     ]..        if
-0000fd50: 206e 6f5f 6e61 6d65 5f63 656c 6c73 3a0a   no_name_cells:.
-0000fd60: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0000fd70: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
-0000fd80: 2020 2020 2020 2020 2020 2066 2243 6f6d             f"Com
-0000fd90: 706f 6e65 6e74 207b 746f 705f 6365 6c6c  ponent {top_cell
-0000fda0: 2e6e 616d 6521 727d 2063 6f6e 7461 696e  .name!r} contain
-0000fdb0: 7320 7b6c 656e 286e 6f5f 6e61 6d65 5f63  s {len(no_name_c
-0000fdc0: 656c 6c73 297d 2055 6e6e 616d 6564 2063  ells)} Unnamed c
-0000fdd0: 656c 6c73 222c 0a20 2020 2020 2020 2020  ells",.         
-0000fde0: 2020 2020 2020 2073 7461 636b 6c65 7665         stackleve
-0000fdf0: 6c3d 332c 0a20 2020 2020 2020 2020 2020  l=3,.           
-0000fe00: 2029 0a0a 2020 2020 2020 2020 2320 666f   )..        # fo
-0000fe10: 7220 6365 6c6c 2069 6e20 616c 6c5f 6365  r cell in all_ce
-0000fe20: 6c6c 733a 0a20 2020 2020 2020 2023 2020  lls:.        #  
-0000fe30: 2020 2070 7269 6e74 2863 656c 6c2e 6e61     print(cell.na
-0000fe40: 6d65 2c20 7479 7065 2863 656c 6c29 290a  me, type(cell)).
-0000fe50: 0a20 2020 2020 2020 206c 6962 203d 2067  .        lib = g
-0000fe60: 6473 746b 2e4c 6962 7261 7279 280a 2020  dstk.Library(.  
-0000fe70: 2020 2020 2020 2020 2020 756e 6974 3d77            unit=w
-0000fe80: 7269 7465 5f73 6574 7469 6e67 732e 756e  rite_settings.un
-0000fe90: 6974 2c20 7072 6563 6973 696f 6e3d 7772  it, precision=wr
-0000fea0: 6974 655f 7365 7474 696e 6773 2e70 7265  ite_settings.pre
-0000feb0: 6369 7369 6f6e 0a20 2020 2020 2020 2029  cision.        )
-0000fec0: 0a20 2020 2020 2020 206c 6962 2e61 6464  .        lib.add
-0000fed0: 2874 6f70 5f63 656c 6c2e 5f63 656c 6c29  (top_cell._cell)
-0000fee0: 0a20 2020 2020 2020 206c 6962 2e61 6464  .        lib.add
-0000fef0: 282a 746f 705f 6365 6c6c 2e5f 6365 6c6c  (*top_cell._cell
-0000ff00: 2e64 6570 656e 6465 6e63 6965 7328 5472  .dependencies(Tr
-0000ff10: 7565 2929 0a0a 2020 2020 2020 2020 6966  ue))..        if
-0000ff20: 2077 6974 685f 6f61 7369 733a 0a20 2020   with_oasis:.   
-0000ff30: 2020 2020 2020 2020 206c 6962 2e77 7269           lib.wri
-0000ff40: 7465 5f6f 6173 2867 6473 7061 7468 2c20  te_oas(gdspath, 
-0000ff50: 2a2a 6f61 7369 735f 7365 7474 696e 6773  **oasis_settings
-0000ff60: 2e64 6963 7428 2929 0a20 2020 2020 2020  .dict()).       
-0000ff70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000ff80: 2020 206c 6962 2e77 7269 7465 5f67 6473     lib.write_gds
-0000ff90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ffa0: 2020 6764 7370 6174 682c 2074 696d 6573    gdspath, times
-0000ffb0: 7461 6d70 3d74 696d 6573 7461 6d70 2c20  tamp=timestamp, 
-0000ffc0: 6d61 785f 706f 696e 7473 3d77 7269 7465  max_points=write
-0000ffd0: 5f73 6574 7469 6e67 732e 6d61 785f 706f  _settings.max_po
-0000ffe0: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
-0000fff0: 2029 0a20 2020 2020 2020 2069 6620 6c6f   ).        if lo
-00010000: 6767 696e 673a 0a20 2020 2020 2020 2020  gging:.         
-00010010: 2020 206c 6f67 6765 722e 696e 666f 2866     logger.info(f
-00010020: 2257 726f 7465 2074 6f20 7b73 7472 2867  "Wrote to {str(g
-00010030: 6473 7061 7468 2921 727d 2229 0a20 2020  dspath)!r}").   
-00010040: 2020 2020 2072 6574 7572 6e20 6764 7370       return gdsp
-00010050: 6174 680a 0a20 2020 2064 6566 2077 7269  ath..    def wri
-00010060: 7465 5f67 6473 280a 2020 2020 2020 2020  te_gds(.        
-00010070: 7365 6c66 2c0a 2020 2020 2020 2020 6764  self,.        gd
-00010080: 7370 6174 683a 204f 7074 696f 6e61 6c5b  spath: Optional[
-00010090: 5061 7468 5479 7065 5d20 3d20 4e6f 6e65  PathType] = None
-000100a0: 2c0a 2020 2020 2020 2020 6764 7364 6972  ,.        gdsdir
-000100b0: 3a20 4f70 7469 6f6e 616c 5b50 6174 6854  : Optional[PathT
-000100c0: 7970 655d 203d 204e 6f6e 652c 0a20 2020  ype] = None,.   
-000100d0: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-000100e0: 2020 2029 202d 3e20 5061 7468 3a0a 2020     ) -> Path:.  
-000100f0: 2020 2020 2020 2222 2257 7269 7465 2063        """Write c
-00010100: 6f6d 706f 6e65 6e74 2074 6f20 4744 5320  omponent to GDS 
-00010110: 616e 6420 7265 7475 726e 7320 6764 7370  and returns gdsp
-00010120: 6174 682e 0a0a 2020 2020 2020 2020 4172  ath...        Ar
-00010130: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00010140: 6764 7370 6174 683a 2047 4453 2066 696c  gdspath: GDS fil
-00010150: 6520 7061 7468 2074 6f20 7772 6974 6520  e path to write 
-00010160: 746f 2e0a 2020 2020 2020 2020 2020 2020  to..            
-00010170: 6764 7364 6972 3a20 6469 7265 6374 6f72  gdsdir: director
-00010180: 7920 666f 7220 7468 6520 4744 5320 6669  y for the GDS fi
-00010190: 6c65 2e20 4465 6661 756c 7473 2074 6f20  le. Defaults to 
-000101a0: 2f74 6d70 2f72 616e 646f 6d46 696c 652f  /tmp/randomFile/
-000101b0: 6764 7366 6163 746f 7279 2e0a 0a20 2020  gdsfactory...   
-000101c0: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
-000101d0: 733a 0a20 2020 2020 2020 2020 2020 2075  s:.            u
-000101e0: 6e69 743a 2075 6e69 7420 7369 7a65 2066  nit: unit size f
-000101f0: 6f72 206f 626a 6563 7473 2069 6e20 6c69  or objects in li
-00010200: 6272 6172 792e 2031 756d 2062 7920 6465  brary. 1um by de
-00010210: 6661 756c 742e 0a20 2020 2020 2020 2020  fault..         
-00010220: 2020 2070 7265 6369 7369 6f6e 3a20 666f     precision: fo
-00010230: 7220 6469 6d65 6e73 696f 6e73 2069 6e20  r dimensions in 
-00010240: 7468 6520 6c69 6272 6172 7920 286d 292e  the library (m).
-00010250: 2031 6e6d 2062 7920 6465 6661 756c 742e   1nm by default.
-00010260: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00010270: 6769 6e67 3a20 6469 7361 626c 6520 4744  ging: disable GD
-00010280: 5320 7061 7468 206c 6f67 6769 6e67 2c20  S path logging, 
-00010290: 666f 7220 6578 616d 706c 6520 666f 7220  for example for 
-000102a0: 7368 6f77 696e 6720 6974 2069 6e20 4b4c  showing it in KL
-000102b0: 6179 6f75 742e 0a20 2020 2020 2020 2020  ayout..         
-000102c0: 2020 206f 6e5f 6475 706c 6963 6174 655f     on_duplicate_
-000102d0: 6365 6c6c 3a20 7370 6563 6966 7920 686f  cell: specify ho
-000102e0: 7720 746f 2072 6573 6f6c 7665 2064 7570  w to resolve dup
-000102f0: 6c69 6361 7465 2d6e 616d 6564 2063 656c  licate-named cel
-00010300: 6c73 2e20 4368 6f6f 7365 206f 6e65 206f  ls. Choose one o
-00010310: 6620 7468 6520 666f 6c6c 6f77 696e 673a  f the following:
-00010320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010330: 2022 7761 726e 2220 2864 6566 6175 6c74   "warn" (default
-00010340: 293a 206f 7665 7277 7269 7465 2061 6c6c  ): overwrite all
-00010350: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
-00010360: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
-00010370: 2064 7570 6c69 6361 7465 7320 2861 7262   duplicates (arb
-00010380: 6974 7261 7269 6c79 292e 0a20 2020 2020  itrarily)..     
-00010390: 2020 2020 2020 2020 2020 2022 6572 726f             "erro
-000103a0: 7222 3a20 7468 726f 7720 6120 5661 6c75  r": throw a Valu
-000103b0: 6545 7272 6f72 2077 6865 6e20 6174 7465  eError when atte
-000103c0: 6d70 7469 6e67 2074 6f20 7772 6974 6520  mpting to write 
-000103d0: 6120 6764 7320 7769 7468 2064 7570 6c69  a gds with dupli
-000103e0: 6361 7465 2063 656c 6c73 2e0a 2020 2020  cate cells..    
-000103f0: 2020 2020 2020 2020 2020 2020 226f 7665              "ove
-00010400: 7277 7269 7465 223a 206f 7665 7277 7269  rwrite": overwri
-00010410: 7465 2061 6c6c 2064 7570 6c69 6361 7465  te all duplicate
-00010420: 2063 656c 6c73 2077 6974 6820 6f6e 6520   cells with one 
-00010430: 6f66 2074 6865 2064 7570 6c69 6361 7465  of the duplicate
-00010440: 732c 2077 6974 686f 7574 2077 6172 6e69  s, without warni
-00010450: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
-00010460: 6f6e 5f75 6e63 6163 6865 645f 636f 6d70  on_uncached_comp
-00010470: 6f6e 656e 743a 204c 6974 6572 616c 5b22  onent: Literal["
-00010480: 7761 726e 222c 2022 6572 726f 7222 5d20  warn", "error"] 
-00010490: 3d20 2277 6172 6e22 0a20 2020 2020 2020  = "warn".       
-000104a0: 2020 2020 2066 6c61 7474 656e 5f69 6e76       flatten_inv
-000104b0: 616c 6964 5f72 6566 733a 2066 6c61 7474  alid_refs: flatt
-000104c0: 656e 7320 636f 6d70 6f6e 656e 7420 7265  ens component re
-000104d0: 6665 7265 6e63 6573 2077 6869 6368 2068  ferences which h
-000104e0: 6176 6520 696e 7661 6c69 6420 7472 616e  ave invalid tran
-000104f0: 7366 6f72 6d61 7469 6f6e 732e 0a20 2020  sformations..   
-00010500: 2020 2020 2020 2020 206d 6178 5f70 6f69           max_poi
-00010510: 6e74 733a 204d 6178 696d 616c 206e 756d  nts: Maximal num
-00010520: 6265 7220 6f66 2076 6572 7469 6365 7320  ber of vertices 
-00010530: 7065 7220 706f 6c79 676f 6e2e 0a20 2020  per polygon..   
-00010540: 2020 2020 2020 2020 2020 2020 2050 6f6c               Pol
-00010550: 7967 6f6e 7320 7769 7468 206d 6f72 6520  ygons with more 
-00010560: 7665 7274 6963 6573 2074 6861 7420 7468  vertices that th
-00010570: 6973 2061 7265 2061 7574 6f6d 6174 6963  is are automatic
-00010580: 616c 6c79 2066 7261 6374 7572 6564 2e0a  ally fractured..
-00010590: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-000105a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000105b0: 2e5f 7772 6974 655f 6c69 6272 6172 7928  ._write_library(
-000105c0: 0a20 2020 2020 2020 2020 2020 2067 6473  .            gds
-000105d0: 7061 7468 3d67 6473 7061 7468 2c20 6764  path=gdspath, gd
-000105e0: 7364 6972 3d67 6473 6469 722c 2077 6974  sdir=gdsdir, wit
-000105f0: 685f 6f61 7369 733d 4661 6c73 652c 202a  h_oasis=False, *
-00010600: 2a6b 7761 7267 730a 2020 2020 2020 2020  *kwargs.        
-00010610: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
-00010620: 5f6f 6173 280a 2020 2020 2020 2020 7365  _oas(.        se
-00010630: 6c66 2c0a 2020 2020 2020 2020 6764 7370  lf,.        gdsp
-00010640: 6174 683a 204f 7074 696f 6e61 6c5b 5061  ath: Optional[Pa
-00010650: 7468 5479 7065 5d20 3d20 4e6f 6e65 2c0a  thType] = None,.
-00010660: 2020 2020 2020 2020 6764 7364 6972 3a20          gdsdir: 
-00010670: 4f70 7469 6f6e 616c 5b50 6174 6854 7970  Optional[PathTyp
-00010680: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
-00010690: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-000106a0: 2029 202d 3e20 5061 7468 3a0a 2020 2020   ) -> Path:.    
-000106b0: 2020 2020 2222 2257 7269 7465 2063 6f6d      """Write com
-000106c0: 706f 6e65 6e74 2074 6f20 4744 5320 616e  ponent to GDS an
-000106d0: 6420 7265 7475 726e 7320 6764 7370 6174  d returns gdspat
-000106e0: 682e 0a0a 2020 2020 2020 2020 4172 6773  h...        Args
-000106f0: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
-00010700: 7370 6174 683a 2047 4453 2066 696c 6520  spath: GDS file 
-00010710: 7061 7468 2074 6f20 7772 6974 6520 746f  path to write to
-00010720: 2e0a 2020 2020 2020 2020 2020 2020 6764  ..            gd
-00010730: 7364 6972 3a20 6469 7265 6374 6f72 7920  sdir: directory 
-00010740: 666f 7220 7468 6520 4744 5320 6669 6c65  for the GDS file
-00010750: 2e20 4465 6661 756c 7473 2074 6f20 2f74  . Defaults to /t
-00010760: 6d70 2f72 616e 646f 6d46 696c 652f 6764  mp/randomFile/gd
-00010770: 7366 6163 746f 7279 2e0a 0a20 2020 2020  sfactory...     
-00010780: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
-00010790: 0a20 2020 2020 2020 2020 2020 2075 6e69  .            uni
-000107a0: 743a 2075 6e69 7420 7369 7a65 2066 6f72  t: unit size for
-000107b0: 206f 626a 6563 7473 2069 6e20 6c69 6272   objects in libr
-000107c0: 6172 792e 2031 756d 2062 7920 6465 6661  ary. 1um by defa
-000107d0: 756c 742e 0a20 2020 2020 2020 2020 2020  ult..           
-000107e0: 2070 7265 6369 7369 6f6e 3a20 666f 7220   precision: for 
-000107f0: 6469 6d65 6e73 696f 6e73 2069 6e20 7468  dimensions in th
-00010800: 6520 6c69 6272 6172 7920 286d 292e 2031  e library (m). 1
-00010810: 6e6d 2062 7920 6465 6661 756c 742e 0a20  nm by default.. 
-00010820: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
-00010830: 6e67 3a20 6469 7361 626c 6520 4744 5320  ng: disable GDS 
-00010840: 7061 7468 206c 6f67 6769 6e67 2c20 666f  path logging, fo
-00010850: 7220 6578 616d 706c 6520 666f 7220 7368  r example for sh
-00010860: 6f77 696e 6720 6974 2069 6e20 4b4c 6179  owing it in KLay
-00010870: 6f75 742e 0a20 2020 2020 2020 2020 2020  out..           
-00010880: 206f 6e5f 6475 706c 6963 6174 655f 6365   on_duplicate_ce
-00010890: 6c6c 3a20 7370 6563 6966 7920 686f 7720  ll: specify how 
-000108a0: 746f 2072 6573 6f6c 7665 2064 7570 6c69  to resolve dupli
-000108b0: 6361 7465 2d6e 616d 6564 2063 656c 6c73  cate-named cells
-000108c0: 2e20 4368 6f6f 7365 206f 6e65 206f 6620  . Choose one of 
-000108d0: 7468 6520 666f 6c6c 6f77 696e 673a 0a20  the following:. 
-000108e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000108f0: 7761 726e 2220 2864 6566 6175 6c74 293a  warn" (default):
-00010900: 206f 7665 7277 7269 7465 2061 6c6c 2064   overwrite all d
-00010910: 7570 6c69 6361 7465 2063 656c 6c73 2077  uplicate cells w
-00010920: 6974 6820 6f6e 6520 6f66 2074 6865 2064  ith one of the d
-00010930: 7570 6c69 6361 7465 7320 2861 7262 6974  uplicates (arbit
-00010940: 7261 7269 6c79 292e 0a20 2020 2020 2020  rarily)..       
-00010950: 2020 2020 2020 2020 2022 6572 726f 7222           "error"
-00010960: 3a20 7468 726f 7720 6120 5661 6c75 6545  : throw a ValueE
-00010970: 7272 6f72 2077 6865 6e20 6174 7465 6d70  rror when attemp
-00010980: 7469 6e67 2074 6f20 7772 6974 6520 6120  ting to write a 
-00010990: 6764 7320 7769 7468 2064 7570 6c69 6361  gds with duplica
-000109a0: 7465 2063 656c 6c73 2e0a 2020 2020 2020  te cells..      
-000109b0: 2020 2020 2020 2020 2020 226f 7665 7277            "overw
-000109c0: 7269 7465 223a 206f 7665 7277 7269 7465  rite": overwrite
-000109d0: 2061 6c6c 2064 7570 6c69 6361 7465 2063   all duplicate c
-000109e0: 656c 6c73 2077 6974 6820 6f6e 6520 6f66  ells with one of
-000109f0: 2074 6865 2064 7570 6c69 6361 7465 732c   the duplicates,
-00010a00: 2077 6974 686f 7574 2077 6172 6e69 6e67   without warning
-00010a10: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010a20: 2020 4e6f 6e65 3a20 646f 206e 6f74 2074    None: do not t
-00010a30: 7279 2074 6f20 7265 736f 6c76 6520 2861  ry to resolve (a
-00010a40: 7420 796f 7572 206f 776e 2072 6973 6b21  t your own risk!
-00010a50: 290a 2020 2020 2020 2020 2020 2020 6f6e  ).            on
-00010a60: 5f75 6e63 6163 6865 645f 636f 6d70 6f6e  _uncached_compon
-00010a70: 656e 743a 204c 6974 6572 616c 5b22 7761  ent: Literal["wa
-00010a80: 726e 222c 2022 6572 726f 7222 5d20 3d20  rn", "error"] = 
-00010a90: 2277 6172 6e22 0a20 2020 2020 2020 2020  "warn".         
-00010aa0: 2020 2066 6c61 7474 656e 5f69 6e76 616c     flatten_inval
-00010ab0: 6964 5f72 6566 733a 2066 6c61 7474 656e  id_refs: flatten
-00010ac0: 7320 636f 6d70 6f6e 656e 7420 7265 6665  s component refe
-00010ad0: 7265 6e63 6573 2077 6869 6368 2068 6176  rences which hav
-00010ae0: 6520 696e 7661 6c69 6420 7472 616e 7366  e invalid transf
-00010af0: 6f72 6d61 7469 6f6e 732e 0a20 2020 2020  ormations..     
-00010b00: 2020 2020 2020 2063 6f6d 7072 6573 7369         compressi
-00010b10: 6f6e 5f6c 6576 656c 3a20 4c65 7665 6c20  on_level: Level 
-00010b20: 6f66 2063 6f6d 7072 6573 7369 6f6e 2066  of compression f
-00010b30: 6f72 2063 656c 6c73 2028 6265 7477 6565  or cells (betwee
-00010b40: 6e20 3020 616e 6420 3929 2e0a 2020 2020  n 0 and 9)..    
-00010b50: 2020 2020 2020 2020 2020 2020 5365 7474              Sett
-00010b60: 696e 6720 746f 2030 2077 696c 6c20 6469  ing to 0 will di
-00010b70: 7361 626c 6520 6365 6c6c 2063 6f6d 7072  sable cell compr
-00010b80: 6573 7369 6f6e 2c20 3120 6769 7665 7320  ession, 1 gives 
-00010b90: 7468 6520 6265 7374 2073 7065 6564 2061  the best speed a
-00010ba0: 6e64 2039 2c20 7468 6520 6265 7374 2063  nd 9, the best c
-00010bb0: 6f6d 7072 6573 7369 6f6e 2e0a 2020 2020  ompression..    
-00010bc0: 2020 2020 2020 2020 6465 7465 6374 5f72          detect_r
-00010bd0: 6563 7461 6e67 6c65 733a 2053 746f 7265  ectangles: Store
-00010be0: 2072 6563 7461 6e67 6c65 7320 696e 2063   rectangles in c
-00010bf0: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
-00010c00: 2e0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00010c10: 7465 6374 5f74 7261 7065 7a6f 6964 733a  tect_trapezoids:
-00010c20: 2053 746f 7265 2074 7261 7065 7a6f 6964   Store trapezoid
-00010c30: 7320 696e 2063 6f6d 7072 6573 7365 6420  s in compressed 
-00010c40: 666f 726d 6174 2e0a 2020 2020 2020 2020  format..        
-00010c50: 2020 2020 6369 7263 6c65 5f74 6f6c 6572      circle_toler
-00010c60: 616e 6365 3a20 546f 6c65 7261 6e63 6520  ance: Tolerance 
-00010c70: 666f 7220 6465 7465 6374 696e 6720 6369  for detecting ci
-00010c80: 7263 6c65 732e 2049 6620 6c65 7373 206f  rcles. If less o
-00010c90: 7220 6571 7561 6c20 746f 2030 2c20 6e6f  r equal to 0, no
-00010ca0: 2064 6574 6563 7469 6f6e 2069 7320 7065   detection is pe
-00010cb0: 7266 6f72 6d65 642e 0a20 2020 2020 2020  rformed..       
-00010cc0: 2020 2020 2020 2020 2043 6972 636c 6573           Circles
-00010cd0: 2061 7265 2073 746f 7265 6420 696e 2063   are stored in c
-00010ce0: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
-00010cf0: 2e0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-00010d00: 6c69 6461 7469 6f6e 2028 2263 7263 3332  lidation ("crc32
-00010d10: 222c 2022 6368 6563 6b73 756d 3332 222c  ", "checksum32",
-00010d20: 204e 6f6e 6529 20e2 8093 2074 7970 6520   None) ... type 
-00010d30: 6f66 2076 616c 6964 6174 696f 6e20 746f  of validation to
-00010d40: 2069 6e63 6c75 6465 2069 6e20 7468 6520   include in the 
-00010d50: 7361 7665 6420 6669 6c65 2e0a 2020 2020  saved file..    
-00010d60: 2020 2020 2020 2020 7374 616e 6461 7264          standard
-00010d70: 5f70 726f 7065 7274 6965 733a 2053 746f  _properties: Sto
-00010d80: 7265 2073 7461 6e64 6172 6420 4f41 5349  re standard OASI
-00010d90: 5320 7072 6f70 6572 7469 6573 2069 6e20  S properties in 
-00010da0: 7468 6520 6669 6c65 2e0a 2020 2020 2020  the file..      
-00010db0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00010dc0: 7475 726e 2073 656c 662e 5f77 7269 7465  turn self._write
-00010dd0: 5f6c 6962 7261 7279 280a 2020 2020 2020  _library(.      
-00010de0: 2020 2020 2020 6764 7370 6174 683d 6764        gdspath=gd
-00010df0: 7370 6174 682c 0a20 2020 2020 2020 2020  spath,.         
-00010e00: 2020 2067 6473 6469 723d 6764 7364 6972     gdsdir=gdsdir
-00010e10: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
-00010e20: 7468 5f6f 6173 6973 3d54 7275 652c 0a20  th_oasis=True,. 
-00010e30: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
-00010e40: 7267 732c 0a20 2020 2020 2020 2029 0a0a  rgs,.        )..
-00010e50: 2020 2020 6465 6620 7772 6974 655f 6764      def write_gd
-00010e60: 735f 7769 7468 5f6d 6574 6164 6174 6128  s_with_metadata(
-00010e70: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-00010e80: 7761 7267 7329 202d 3e20 5061 7468 3a0a  wargs) -> Path:.
-00010e90: 2020 2020 2020 2020 2222 2257 7269 7465          """Write
-00010ea0: 2063 6f6d 706f 6e65 6e74 2069 6e20 4744   component in GD
-00010eb0: 5320 616e 6420 6d65 7461 6461 7461 2028  S and metadata (
-00010ec0: 636f 6d70 6f6e 656e 7420 7365 7474 696e  component settin
-00010ed0: 6773 2920 696e 2059 414d 4c2e 2222 220a  gs) in YAML.""".
-00010ee0: 2020 2020 2020 2020 6764 7370 6174 6820          gdspath 
-00010ef0: 3d20 7365 6c66 2e77 7269 7465 5f67 6473  = self.write_gds
-00010f00: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
-00010f10: 290a 2020 2020 2020 2020 6d65 7461 6461  ).        metada
-00010f20: 7461 203d 2067 6473 7061 7468 2e77 6974  ta = gdspath.wit
-00010f30: 685f 7375 6666 6978 2822 2e79 6d6c 2229  h_suffix(".yml")
-00010f40: 0a20 2020 2020 2020 206d 6574 6164 6174  .        metadat
-00010f50: 612e 7772 6974 655f 7465 7874 2873 656c  a.write_text(sel
-00010f60: 662e 746f 5f79 616d 6c28 7769 7468 5f63  f.to_yaml(with_c
-00010f70: 656c 6c73 3d54 7275 652c 2077 6974 685f  ells=True, with_
-00010f80: 706f 7274 733d 5472 7565 2929 0a20 2020  ports=True)).   
-00010f90: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-00010fa0: 2866 2257 7269 7465 2059 414d 4c20 6d65  (f"Write YAML me
-00010fb0: 7461 6461 7461 2074 6f20 7b73 7472 286d  tadata to {str(m
-00010fc0: 6574 6164 6174 6129 2172 7d22 290a 2020  etadata)!r}").  
-00010fd0: 2020 2020 2020 7265 7475 726e 2067 6473        return gds
-00010fe0: 7061 7468 0a0a 2020 2020 6465 6620 746f  path..    def to
-00010ff0: 5f64 6963 7428 0a20 2020 2020 2020 2073  _dict(.        s
-00011000: 656c 662c 0a20 2020 2020 2020 2069 676e  elf,.        ign
-00011010: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
-00011020: 7265 6669 783a 204f 7074 696f 6e61 6c5b  refix: Optional[
-00011030: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
-00011040: 652c 0a20 2020 2020 2020 2069 676e 6f72  e,.        ignor
-00011050: 655f 6675 6e63 7469 6f6e 735f 7072 6566  e_functions_pref
-00011060: 6978 3a20 4f70 7469 6f6e 616c 5b4c 6973  ix: Optional[Lis
-00011070: 745b 7374 725d 5d20 3d20 4e6f 6e65 2c0a  t[str]] = None,.
-00011080: 2020 2020 2020 2020 7769 7468 5f63 656c          with_cel
-00011090: 6c73 3a20 626f 6f6c 203d 2046 616c 7365  ls: bool = False
-000110a0: 2c0a 2020 2020 2020 2020 7769 7468 5f70  ,.        with_p
-000110b0: 6f72 7473 3a20 626f 6f6c 203d 2054 7275  orts: bool = Tru
-000110c0: 652c 0a20 2020 2029 202d 3e20 4469 6374  e,.    ) -> Dict
-000110d0: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
-000110e0: 2020 2020 2222 2252 6574 7572 6e73 2044      """Returns D
-000110f0: 6963 7420 7265 7072 6573 656e 7461 7469  ict representati
-00011100: 6f6e 206f 6620 6120 636f 6d70 6f6e 656e  on of a componen
-00011110: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
-00011120: 3a0a 2020 2020 2020 2020 2020 2020 6967  :.            ig
-00011130: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
-00011140: 7072 6566 6978 3a20 666f 7220 636f 6d70  prefix: for comp
-00011150: 6f6e 656e 7473 2074 6f20 6967 6e6f 7265  onents to ignore
-00011160: 2077 6865 6e20 6578 706f 7274 696e 672e   when exporting.
-00011170: 0a20 2020 2020 2020 2020 2020 2069 676e  .            ign
-00011180: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
-00011190: 6566 6978 3a20 666f 7220 6675 6e63 7469  efix: for functi
-000111a0: 6f6e 7320 746f 2069 676e 6f72 6520 7768  ons to ignore wh
-000111b0: 656e 2065 7870 6f72 7469 6e67 2e0a 2020  en exporting..  
-000111c0: 2020 2020 2020 2020 2020 7769 7468 5f63            with_c
-000111d0: 656c 6c73 3a20 7772 6974 6520 6365 6c6c  ells: write cell
-000111e0: 7320 7265 6375 7273 6976 656c 792e 0a20  s recursively.. 
-000111f0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-00011200: 706f 7274 733a 2077 7269 7465 2070 6f72  ports: write por
-00011210: 7420 696e 666f 726d 6174 696f 6e20 6469  t information di
-00011220: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
-00011230: 2020 2020 2020 2020 6420 3d20 7b7d 0a20          d = {}. 
-00011240: 2020 2020 2020 2069 6620 7769 7468 5f70         if with_p
-00011250: 6f72 7473 3a0a 2020 2020 2020 2020 2020  orts:.          
-00011260: 2020 706f 7274 7320 3d20 7b70 6f72 742e    ports = {port.
-00011270: 6e61 6d65 3a20 706f 7274 2e74 6f5f 6469  name: port.to_di
-00011280: 6374 2829 2066 6f72 2070 6f72 7420 696e  ct() for port in
-00011290: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
-000112a0: 6c69 7374 2829 7d0a 2020 2020 2020 2020  list()}.        
-000112b0: 2020 2020 645b 2270 6f72 7473 225d 203d      d["ports"] =
-000112c0: 2070 6f72 7473 0a0a 2020 2020 2020 2020   ports..        
-000112d0: 6966 2077 6974 685f 6365 6c6c 733a 0a20  if with_cells:. 
-000112e0: 2020 2020 2020 2020 2020 2063 656c 6c73             cells
-000112f0: 203d 2072 6563 7572 7365 5f73 7472 7563   = recurse_struc
-00011300: 7475 7265 7328 0a20 2020 2020 2020 2020  tures(.         
-00011310: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00011320: 2020 2020 2020 2020 2020 2020 2069 676e               ign
-00011330: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
-00011340: 6566 6978 3d69 676e 6f72 655f 6675 6e63  efix=ignore_func
-00011350: 7469 6f6e 735f 7072 6566 6978 2c0a 2020  tions_prefix,.  
-00011360: 2020 2020 2020 2020 2020 2020 2020 6967                ig
-00011370: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
-00011380: 7072 6566 6978 3d69 676e 6f72 655f 636f  prefix=ignore_co
-00011390: 6d70 6f6e 656e 7473 5f70 7265 6669 782c  mponents_prefix,
-000113a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000113b0: 2020 2020 2020 2020 2020 2064 5b22 6365             d["ce
-000113c0: 6c6c 7322 5d20 3d20 636c 6561 6e5f 6469  lls"] = clean_di
-000113d0: 6374 2863 656c 6c73 290a 0a20 2020 2020  ct(cells)..     
-000113e0: 2020 2064 5b22 6e61 6d65 225d 203d 2073     d["name"] = s
-000113f0: 656c 662e 6e61 6d65 0a20 2020 2020 2020  elf.name.       
-00011400: 2064 5b22 7365 7474 696e 6773 225d 203d   d["settings"] =
-00011410: 2063 6c65 616e 5f64 6963 7428 6469 6374   clean_dict(dict
-00011420: 2873 656c 662e 7365 7474 696e 6773 2929  (self.settings))
-00011430: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011440: 640a 0a20 2020 2064 6566 2074 6f5f 7961  d..    def to_ya
-00011450: 6d6c 2873 656c 662c 202a 2a6b 7761 7267  ml(self, **kwarg
-00011460: 7329 202d 3e20 7374 723a 0a20 2020 2020  s) -> str:.     
-00011470: 2020 2022 2222 5772 6974 6520 4469 6374     """Write Dict
-00011480: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
-00011490: 6f66 2061 2063 6f6d 706f 6e65 6e74 2069  of a component i
-000114a0: 6e20 5941 4d4c 2066 6f72 6d61 742e 0a0a  n YAML format...
-000114b0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-000114c0: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
-000114d0: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
-000114e0: 6978 3a20 666f 7220 636f 6d70 6f6e 656e  ix: for componen
-000114f0: 7473 2074 6f20 6967 6e6f 7265 2077 6865  ts to ignore whe
-00011500: 6e20 6578 706f 7274 696e 672e 0a20 2020  n exporting..   
-00011510: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
-00011520: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
-00011530: 3a20 666f 7220 6675 6e63 7469 6f6e 7320  : for functions 
-00011540: 746f 2069 676e 6f72 6520 7768 656e 2065  to ignore when e
-00011550: 7870 6f72 7469 6e67 2e0a 2020 2020 2020  xporting..      
-00011560: 2020 2020 2020 7769 7468 5f63 656c 6c73        with_cells
-00011570: 3a20 7772 6974 6520 6365 6c6c 7320 7265  : write cells re
-00011580: 6375 7273 6976 656c 792e 0a20 2020 2020  cursively..     
-00011590: 2020 2020 2020 2077 6974 685f 706f 7274         with_port
-000115a0: 733a 2077 7269 7465 2070 6f72 7420 696e  s: write port in
-000115b0: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
-000115c0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-000115d0: 6574 7572 6e20 4f6d 6567 6143 6f6e 662e  eturn OmegaConf.
-000115e0: 746f 5f79 616d 6c28 636c 6561 6e5f 6469  to_yaml(clean_di
-000115f0: 6374 2873 656c 662e 746f 5f64 6963 7428  ct(self.to_dict(
-00011600: 2a2a 6b77 6172 6773 2929 290a 0a20 2020  **kwargs)))..   
-00011610: 2064 6566 2074 6f5f 6469 6374 5f70 6f6c   def to_dict_pol
-00011620: 7967 6f6e 7328 7365 6c66 2920 2d3e 2044  ygons(self) -> D
-00011630: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
-00011640: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00011650: 7320 6120 6469 6374 2072 6570 7265 7365  s a dict represe
-00011660: 6e74 6174 696f 6e20 6f66 2074 6865 2066  ntation of the f
-00011670: 6c61 7474 656e 6564 2063 6f6d 706f 6e65  lattened compone
-00011680: 6e74 2e22 2222 0a20 2020 2020 2020 2064  nt.""".        d
-00011690: 203d 207b 7d0a 2020 2020 2020 2020 706f   = {}.        po
-000116a0: 6c79 676f 6e73 203d 207b 7d0a 2020 2020  lygons = {}.    
-000116b0: 2020 2020 6c61 7965 725f 746f 5f70 6f6c      layer_to_pol
-000116c0: 7967 6f6e 7320 3d20 7365 6c66 2e67 6574  ygons = self.get
-000116d0: 5f70 6f6c 7967 6f6e 7328 6279 5f73 7065  _polygons(by_spe
-000116e0: 633d 5472 7565 290a 0a20 2020 2020 2020  c=True)..       
-000116f0: 2066 6f72 206c 6179 6572 2c20 706f 6c79   for layer, poly
-00011700: 676f 6e73 5f6c 6179 6572 2069 6e20 6c61  gons_layer in la
-00011710: 7965 725f 746f 5f70 6f6c 7967 6f6e 732e  yer_to_polygons.
-00011720: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00011730: 2020 2020 206c 6179 6572 5f6e 616d 6520       layer_name 
-00011740: 3d20 6622 7b6c 6179 6572 5b30 5d7d 5f7b  = f"{layer[0]}_{
-00011750: 6c61 7965 725b 315d 7d22 0a20 2020 2020  layer[1]}".     
-00011760: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
-00011770: 6f6e 2069 6e20 706f 6c79 676f 6e73 5f6c  on in polygons_l
-00011780: 6179 6572 3a0a 2020 2020 2020 2020 2020  ayer:.          
-00011790: 2020 2020 2020 706f 6c79 676f 6e73 5b6c        polygons[l
-000117a0: 6179 6572 5f6e 616d 655d 203d 205b 7475  ayer_name] = [tu
-000117b0: 706c 6528 736e 6170 5f74 6f5f 6772 6964  ple(snap_to_grid
-000117c0: 2876 2929 2066 6f72 2076 2069 6e20 706f  (v)) for v in po
-000117d0: 6c79 676f 6e5d 0a0a 2020 2020 2020 2020  lygon]..        
-000117e0: 706f 7274 7320 3d20 7b70 6f72 742e 6e61  ports = {port.na
-000117f0: 6d65 3a20 706f 7274 2e73 6574 7469 6e67  me: port.setting
-00011800: 7320 666f 7220 706f 7274 2069 6e20 7365  s for port in se
-00011810: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
-00011820: 7428 297d 0a20 2020 2020 2020 2063 6c65  t()}.        cle
-00011830: 616e 5f64 6963 7428 706f 7274 7329 0a20  an_dict(ports). 
-00011840: 2020 2020 2020 2063 6c65 616e 5f64 6963         clean_dic
-00011850: 7428 706f 6c79 676f 6e73 290a 2020 2020  t(polygons).    
-00011860: 2020 2020 642e 696e 666f 203d 2073 656c      d.info = sel
-00011870: 662e 696e 666f 0a20 2020 2020 2020 2064  f.info.        d
-00011880: 2e70 6f6c 7967 6f6e 7320 3d20 706f 6c79  .polygons = poly
-00011890: 676f 6e73 0a20 2020 2020 2020 2064 2e70  gons.        d.p
-000118a0: 6f72 7473 203d 2070 6f72 7473 0a20 2020  orts = ports.   
-000118b0: 2020 2020 2072 6574 7572 6e20 640a 0a20       return d.. 
-000118c0: 2020 2064 6566 2061 7574 6f5f 7265 6e61     def auto_rena
-000118d0: 6d65 5f70 6f72 7473 2873 656c 662c 202a  me_ports(self, *
-000118e0: 2a6b 7761 7267 7329 202d 3e20 4e6f 6e65  *kwargs) -> None
-000118f0: 3a0a 2020 2020 2020 2020 2222 2252 656e  :.        """Ren
-00011900: 616d 6520 706f 7274 7320 6279 206f 7269  ame ports by ori
-00011910: 656e 7461 7469 6f6e 204e 5345 5720 286e  entation NSEW (n
-00011920: 6f72 7468 2c20 736f 7574 682c 2065 6173  orth, south, eas
-00011930: 742c 2077 6573 7429 2e0a 0a20 2020 2020  t, west)...     
-00011940: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
-00011950: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
-00011960: 6374 696f 6e3a 2074 6f20 7265 6e61 6d65  ction: to rename
-00011970: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
-00011980: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
-00011990: 5f6f 7074 6963 616c 3a20 746f 2073 656c  _optical: to sel
-000119a0: 6563 7420 6f70 7469 6361 6c20 706f 7274  ect optical port
-000119b0: 732e 0a20 2020 2020 2020 2020 2020 2073  s..            s
-000119c0: 656c 6563 745f 706f 7274 735f 656c 6563  elect_ports_elec
-000119d0: 7472 6963 616c 3a20 746f 2073 656c 6563  trical: to selec
-000119e0: 7420 656c 6563 7472 6963 616c 2070 6f72  t electrical por
-000119f0: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
-00011a00: 7072 6566 6978 5f6f 7074 6963 616c 3a20  prefix_optical: 
-00011a10: 7072 6566 6978 2e0a 2020 2020 2020 2020  prefix..        
-00011a20: 2020 2020 7072 6566 6978 5f65 6c65 6374      prefix_elect
-00011a30: 7269 6361 6c3a 2070 7265 6669 782e 0a0a  rical: prefix...
-00011a40: 2020 2020 2020 2020 2e2e 2063 6f64 653a          .. code:
-00011a50: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011a60: 2020 2020 2033 2020 340a 2020 2020 2020       3  4.      
-00011a70: 2020 2020 2020 2020 2020 205f 7c5f 5f7c             _|__|
-00011a80: 5f0a 2020 2020 2020 2020 2020 2020 2032  _.             2
-00011a90: 202d 7c20 2020 2020 207c 2d20 350a 2020   -|      |- 5.  
-00011aa0: 2020 2020 2020 2020 2020 2020 2020 7c20                | 
-00011ab0: 2020 2020 207c 0a20 2020 2020 2020 2020       |.         
-00011ac0: 2020 2020 3120 2d7c 5f5f 5f5f 5f5f 7c2d      1 -|______|-
-00011ad0: 2036 0a20 2020 2020 2020 2020 2020 2020   6.             
-00011ae0: 2020 2020 207c 2020 7c0a 2020 2020 2020       |  |.      
-00011af0: 2020 2020 2020 2020 2020 2020 3820 2037              8  7
-00011b00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00011b10: 2020 2020 2073 656c 662e 6973 5f75 6e6c       self.is_unl
-00011b20: 6f63 6b65 6428 290a 2020 2020 2020 2020  ocked().        
-00011b30: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
-00011b40: 7328 7365 6c66 2c20 2a2a 6b77 6172 6773  s(self, **kwargs
-00011b50: 290a 0a20 2020 2064 6566 2061 7574 6f5f  )..    def auto_
-00011b60: 7265 6e61 6d65 5f70 6f72 7473 5f63 6f75  rename_ports_cou
-00011b70: 6e74 6572 5f63 6c6f 636b 7769 7365 2873  nter_clockwise(s
-00011b80: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
-00011b90: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00011ba0: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
-00011bb0: 2829 0a20 2020 2020 2020 2061 7574 6f5f  ().        auto_
-00011bc0: 7265 6e61 6d65 5f70 6f72 7473 5f63 6f75  rename_ports_cou
-00011bd0: 6e74 6572 5f63 6c6f 636b 7769 7365 2873  nter_clockwise(s
-00011be0: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
-00011bf0: 2020 2020 6465 6620 6175 746f 5f72 656e      def auto_ren
-00011c00: 616d 655f 706f 7274 735f 6c61 7965 725f  ame_ports_layer_
-00011c10: 6f72 6965 6e74 6174 696f 6e28 7365 6c66  orientation(self
-00011c20: 2c20 2a2a 6b77 6172 6773 2920 2d3e 204e  , **kwargs) -> N
-00011c30: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
-00011c40: 662e 6973 5f75 6e6c 6f63 6b65 6428 290a  f.is_unlocked().
-00011c50: 2020 2020 2020 2020 6175 746f 5f72 656e          auto_ren
-00011c60: 616d 655f 706f 7274 735f 6c61 7965 725f  ame_ports_layer_
-00011c70: 6f72 6965 6e74 6174 696f 6e28 7365 6c66  orientation(self
-00011c80: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-00011c90: 2064 6566 2061 7574 6f5f 7265 6e61 6d65   def auto_rename
-00011ca0: 5f70 6f72 7473 5f6f 7269 656e 7461 7469  _ports_orientati
-00011cb0: 6f6e 2873 656c 662c 202a 2a6b 7761 7267  on(self, **kwarg
-00011cc0: 7329 202d 3e20 4e6f 6e65 3a0a 2020 2020  s) -> None:.    
-00011cd0: 2020 2020 2222 2252 656e 616d 6520 706f      """Rename po
-00011ce0: 7274 7320 6279 206f 7269 656e 7461 7469  rts by orientati
-00011cf0: 6f6e 204e 5345 5720 286e 6f72 7468 2c20  on NSEW (north, 
-00011d00: 736f 7574 682c 2065 6173 742c 2077 6573  south, east, wes
-00011d10: 7429 2e0a 0a20 2020 2020 2020 204b 6579  t)...        Key
-00011d20: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
-00011d30: 2020 2020 2020 2066 756e 6374 696f 6e3a         function:
-00011d40: 2074 6f20 7265 6e61 6d65 2070 6f72 7473   to rename ports
-00011d50: 2e0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00011d60: 6c65 6374 5f70 6f72 7473 5f6f 7074 6963  lect_ports_optic
-00011d70: 616c 3a20 746f 2073 656c 6563 7420 706f  al: to select po
-00011d80: 7274 732e 0a20 2020 2020 2020 2020 2020  rts..           
-00011d90: 2073 656c 6563 745f 706f 7274 735f 656c   select_ports_el
-00011da0: 6563 7472 6963 616c 3a0a 2020 2020 2020  ectrical:.      
-00011db0: 2020 2020 2020 7072 6566 6978 5f6f 7074        prefix_opt
-00011dc0: 6963 616c 3a0a 2020 2020 2020 2020 2020  ical:.          
-00011dd0: 2020 7072 6566 6978 5f65 6c65 6374 7269    prefix_electri
-00011de0: 6361 6c3a 0a0a 2020 2020 2020 2020 2e2e  cal:..        ..
-00011df0: 2063 6f64 653a 3a0a 0a20 2020 2020 2020   code::..       
-00011e00: 2020 2020 2020 2020 2020 4e30 2020 4e31            N0  N1
-00011e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011e20: 2020 7c5f 5f5f 7c5f 0a20 2020 2020 2020    |___|_.       
-00011e30: 2020 2020 2057 3120 2d7c 2020 2020 2020       W1 -|      
-00011e40: 7c2d 2045 310a 2020 2020 2020 2020 2020  |- E1.          
-00011e50: 2020 2020 2020 7c20 2020 2020 207c 0a20        |      |. 
-00011e60: 2020 2020 2020 2020 2020 2057 3020 2d7c             W0 -|
-00011e70: 5f5f 5f5f 5f5f 7c2d 2045 300a 2020 2020  ______|- E0.    
-00011e80: 2020 2020 2020 2020 2020 2020 207c 2020               |  
-00011e90: 207c 0a20 2020 2020 2020 2020 2020 2020   |.             
-00011ea0: 2020 2053 3020 2020 5331 0a20 2020 2020     S0   S1.     
-00011eb0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-00011ec0: 656c 662e 6973 5f75 6e6c 6f63 6b65 6428  elf.is_unlocked(
-00011ed0: 290a 2020 2020 2020 2020 6175 746f 5f72  ).        auto_r
-00011ee0: 656e 616d 655f 706f 7274 735f 6f72 6965  ename_ports_orie
-00011ef0: 6e74 6174 696f 6e28 7365 6c66 2c20 2a2a  ntation(self, **
-00011f00: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
-00011f10: 206d 6f76 6528 0a20 2020 2020 2020 2073   move(.        s
-00011f20: 656c 662c 0a20 2020 2020 2020 206f 7269  elf,.        ori
-00011f30: 6769 6e3a 2046 6c6f 6174 3220 3d20 2830  gin: Float2 = (0
-00011f40: 2c20 3029 2c0a 2020 2020 2020 2020 6465  , 0),.        de
-00011f50: 7374 696e 6174 696f 6e3a 204f 7074 696f  stination: Optio
-00011f60: 6e61 6c5b 466c 6f61 7432 5d20 3d20 4e6f  nal[Float2] = No
-00011f70: 6e65 2c0a 2020 2020 2020 2020 6178 6973  ne,.        axis
-00011f80: 3a20 4f70 7469 6f6e 616c 5b41 7869 735d  : Optional[Axis]
-00011f90: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-00011fa0: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
-00011fb0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00011fc0: 6e65 7720 436f 6d70 6f6e 656e 7420 7769  new Component wi
-00011fd0: 7468 2061 206d 6f76 6564 2072 6566 6572  th a moved refer
-00011fe0: 656e 6365 2074 6f20 7468 6520 6f72 6967  ence to the orig
-00011ff0: 696e 616c 2e0a 0a20 2020 2020 2020 2063  inal...        c
-00012000: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
-00012010: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00012020: 2020 2020 206f 7269 6769 6e3a 206f 6620       origin: of 
-00012030: 636f 6d70 6f6e 656e 742e 0a20 2020 2020  component..     
-00012040: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
-00012050: 6f6e 3a20 782c 2079 2e0a 2020 2020 2020  on: x, y..      
-00012060: 2020 2020 2020 6178 6973 3a20 7820 6f72        axis: x or
-00012070: 2079 2e0a 2020 2020 2020 2020 2222 220a   y..        """.
-00012080: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00012090: 6c75 6545 7272 6f72 286d 6f76 655f 6572  lueError(move_er
-000120a0: 726f 725f 6d65 7373 6167 6529 0a0a 2020  ror_message)..  
-000120b0: 2020 6465 6620 6d69 7272 6f72 2873 656c    def mirror(sel
-000120c0: 662c 2070 313a 2046 6c6f 6174 3220 3d20  f, p1: Float2 = 
-000120d0: 2830 2c20 3129 2c20 7032 3a20 466c 6f61  (0, 1), p2: Floa
-000120e0: 7432 203d 2028 302c 2030 292c 202a 2a6b  t2 = (0, 0), **k
-000120f0: 7761 7267 7329 202d 3e20 436f 6d70 6f6e  wargs) -> Compon
-00012100: 656e 743a 0a20 2020 2020 2020 2022 2222  ent:.        """
-00012110: 5265 7475 726e 7320 6e65 7720 436f 6d70  Returns new Comp
-00012120: 6f6e 656e 7420 7769 7468 2061 206d 6972  onent with a mir
-00012130: 726f 7265 6420 7265 6665 7265 6e63 652e  rored reference.
-00012140: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00012150: 2020 2020 2020 2020 2020 2020 7031 3a20              p1: 
-00012160: 6669 7273 7420 706f 696e 7420 746f 2064  first point to d
-00012170: 6566 696e 6520 6d69 7272 6f72 2061 7869  efine mirror axi
-00012180: 732e 0a20 2020 2020 2020 2020 2020 2070  s..            p
-00012190: 323a 2073 6563 6f6e 6420 706f 696e 7420  2: second point 
-000121a0: 746f 2064 6566 696e 6520 6d69 7272 6f72  to define mirror
-000121b0: 2061 7869 732e 0a20 2020 2020 2020 2022   axis..        "
-000121c0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-000121d0: 6764 7366 6163 746f 7279 2e66 756e 6374  gdsfactory.funct
-000121e0: 696f 6e73 2069 6d70 6f72 7420 6d69 7272  ions import mirr
-000121f0: 6f72 0a0a 2020 2020 2020 2020 7265 7475  or..        retu
-00012200: 726e 206d 6972 726f 7228 636f 6d70 6f6e  rn mirror(compon
-00012210: 656e 743d 7365 6c66 2c20 7031 3d70 312c  ent=self, p1=p1,
-00012220: 2070 323d 7032 2c20 2a2a 6b77 6172 6773   p2=p2, **kwargs
-00012230: 290a 0a20 2020 2064 6566 2072 6f74 6174  )..    def rotat
-00012240: 6528 7365 6c66 2c20 616e 676c 653a 2066  e(self, angle: f
-00012250: 6c6f 6174 203d 2039 302c 202a 2a6b 7761  loat = 90, **kwa
-00012260: 7267 7329 202d 3e20 436f 6d70 6f6e 656e  rgs) -> Componen
-00012270: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
-00012280: 7475 726e 7320 6e65 7720 636f 6d70 6f6e  turns new compon
-00012290: 656e 7420 7769 7468 2061 2072 6f74 6174  ent with a rotat
-000122a0: 6564 2072 6566 6572 656e 6365 2074 6f20  ed reference to 
-000122b0: 7468 6520 6f72 6967 696e 616c 2e0a 0a20  the original... 
-000122c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000122d0: 2020 2020 2020 2020 2061 6e67 6c65 3a20           angle: 
-000122e0: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
-000122f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00012300: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-00012310: 6675 6e63 7469 6f6e 7320 696d 706f 7274  functions import
-00012320: 2072 6f74 6174 650a 0a20 2020 2020 2020   rotate..       
-00012330: 2072 6574 7572 6e20 726f 7461 7465 2863   return rotate(c
-00012340: 6f6d 706f 6e65 6e74 3d73 656c 662c 2061  omponent=self, a
-00012350: 6e67 6c65 3d61 6e67 6c65 2c20 2a2a 6b77  ngle=angle, **kw
-00012360: 6172 6773 290a 0a20 2020 2064 6566 2061  args)..    def a
-00012370: 6464 5f70 6164 6469 6e67 2873 656c 662c  dd_padding(self,
-00012380: 202a 2a6b 7761 7267 7329 202d 3e20 436f   **kwargs) -> Co
-00012390: 6d70 6f6e 656e 743a 0a20 2020 2020 2020  mponent:.       
-000123a0: 2022 2222 5265 7475 726e 7320 7361 6d65   """Returns same
-000123b0: 2063 6f6d 706f 6e65 6e74 2077 6974 6820   component with 
-000123c0: 7061 6464 696e 672e 0a0a 2020 2020 2020  padding...      
-000123d0: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
-000123e0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-000123f0: 6f6e 656e 743a 2066 6f72 2070 6164 6469  onent: for paddi
-00012400: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
-00012410: 6c61 7965 7273 3a20 6c69 7374 206f 6620  layers: list of 
-00012420: 6c61 7965 7273 2e0a 2020 2020 2020 2020  layers..        
-00012430: 2020 2020 7375 6666 6978 2066 6f72 206e      suffix for n
-00012440: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-00012450: 2064 6566 6175 6c74 3a20 6465 6661 756c   default: defaul
-00012460: 7420 7061 6464 696e 6720 2835 3075 6d29  t padding (50um)
-00012470: 2e0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-00012480: 703a 206e 6f72 7468 2070 6164 6469 6e67  p: north padding
-00012490: 2e0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
-000124a0: 7474 6f6d 3a20 736f 7574 6820 7061 6464  ttom: south padd
-000124b0: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-000124c0: 2072 6967 6874 3a20 6561 7374 2070 6164   right: east pad
-000124d0: 6469 6e67 2e0a 2020 2020 2020 2020 2020  ding..          
-000124e0: 2020 6c65 6674 3a20 7765 7374 2070 6164    left: west pad
-000124f0: 6469 6e67 2e0a 2020 2020 2020 2020 2222  ding..        ""
-00012500: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
-00012510: 6473 6661 6374 6f72 792e 6164 645f 7061  dsfactory.add_pa
-00012520: 6464 696e 6720 696d 706f 7274 2061 6464  dding import add
-00012530: 5f70 6164 6469 6e67 0a0a 2020 2020 2020  _padding..      
-00012540: 2020 7265 7475 726e 2061 6464 5f70 6164    return add_pad
-00012550: 6469 6e67 2863 6f6d 706f 6e65 6e74 3d73  ding(component=s
-00012560: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
-00012570: 2020 2020 6465 6620 6162 736f 7262 2873      def absorb(s
-00012580: 656c 662c 2072 6566 6572 656e 6365 2920  elf, reference) 
-00012590: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-000125a0: 2020 2020 2020 2222 2241 6273 6f72 6273        """Absorbs
-000125b0: 2070 6f6c 7967 6f6e 7320 6672 6f6d 2043   polygons from C
-000125c0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-000125d0: 6520 696e 746f 2043 6f6d 706f 6e65 6e74  e into Component
-000125e0: 2e0a 0a20 2020 2020 2020 2044 6573 7472  ...        Destr
-000125f0: 6f79 7320 7468 6520 7265 6665 7265 6e63  oys the referenc
-00012600: 6520 696e 2074 6865 2070 726f 6365 7373  e in the process
-00012610: 2062 7574 206b 6565 7069 6e67 2074 6865   but keeping the
-00012620: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
-00012630: 792e 0a0a 2020 2020 2020 2020 4172 6773  y...        Args
-00012640: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00012650: 6665 7265 6e63 653a 2043 6f6d 706f 6e65  ference: Compone
-00012660: 6e74 5265 6665 7265 6e63 6520 746f 2062  ntReference to b
-00012670: 6520 6162 736f 7262 6564 2069 6e74 6f20  e absorbed into 
-00012680: 7468 6520 436f 6d70 6f6e 656e 742e 0a20  the Component.. 
-00012690: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000126a0: 2020 2069 6620 7265 6665 7265 6e63 6520     if reference 
-000126b0: 6e6f 7420 696e 2073 656c 662e 7265 6665  not in self.refe
-000126c0: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
-000126d0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000126e0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-000126f0: 2020 2020 2020 2254 6865 2072 6566 6572        "The refer
-00012700: 656e 6365 2079 6f75 2061 736b 6564 2074  ence you asked t
-00012710: 6f20 6162 736f 7262 2064 6f65 7320 6e6f  o absorb does no
-00012720: 7420 6578 6973 7420 696e 2074 6869 7320  t exist in this 
-00012730: 436f 6d70 6f6e 656e 742e 220a 2020 2020  Component.".    
-00012740: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00012750: 2020 7265 665f 706f 6c79 676f 6e73 203d    ref_polygons =
-00012760: 2072 6566 6572 656e 6365 2e67 6574 5f70   reference.get_p
-00012770: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
-00012780: 2020 2020 2062 795f 7370 6563 3d46 616c       by_spec=Fal
-00012790: 7365 2c20 696e 636c 7564 655f 7061 7468  se, include_path
-000127a0: 733d 4661 6c73 652c 2061 735f 6172 7261  s=False, as_arra
-000127b0: 793d 4661 6c73 650a 2020 2020 2020 2020  y=False.        
-000127c0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-000127d0: 6164 645f 706f 6c79 676f 6e73 282a 7265  add_polygons(*re
-000127e0: 665f 706f 6c79 676f 6e73 290a 0a20 2020  f_polygons)..   
-000127f0: 2020 2020 2073 656c 662e 6164 6428 7265       self.add(re
-00012800: 6665 7265 6e63 652e 6765 745f 6c61 6265  ference.get_labe
-00012810: 6c73 2829 290a 2020 2020 2020 2020 7365  ls()).        se
-00012820: 6c66 2e61 6464 2872 6566 6572 656e 6365  lf.add(reference
-00012830: 2e67 6574 5f70 6174 6873 2829 290a 2020  .get_paths()).  
-00012840: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
-00012850: 6528 7265 6665 7265 6e63 6529 0a20 2020  e(reference).   
-00012860: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00012870: 0a0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
-00012880: 2873 656c 662c 2069 7465 6d73 293a 0a20  (self, items):. 
-00012890: 2020 2020 2020 2022 2222 5265 6d6f 7665         """Remove
-000128a0: 7320 6974 656d 7320 6672 6f6d 2061 2043  s items from a C
-000128b0: 6f6d 706f 6e65 6e74 2c20 7768 6963 6820  omponent, which 
-000128c0: 6361 6e20 696e 636c 7564 6520 506f 7274  can include Port
-000128d0: 732c 2050 6f6c 7967 6f6e 5365 7473 205c  s, PolygonSets \
-000128e0: 0a20 2020 2020 2020 2043 656c 6c52 6566  .        CellRef
-000128f0: 6572 656e 6365 732c 2043 6f6d 706f 6e65  erences, Compone
-00012900: 6e74 5265 6665 7265 6e63 6573 2061 6e64  ntReferences and
-00012910: 204c 6162 656c 732e 0a0a 2020 2020 2020   Labels...      
-00012920: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00012930: 2020 2020 6974 656d 733a 206c 6973 7420      items: list 
-00012940: 6f66 2049 7465 6d73 2074 6f20 6265 2072  of Items to be r
-00012950: 656d 6f76 6564 2066 726f 6d20 7468 6520  emoved from the 
-00012960: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
-00012970: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00012980: 6620 6e6f 7420 6861 7361 7474 7228 6974  f not hasattr(it
-00012990: 656d 732c 2022 5f5f 6974 6572 5f5f 2229  ems, "__iter__")
-000129a0: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
-000129b0: 656d 7320 3d20 5b69 7465 6d73 5d0a 2020  ems = [items].  
-000129c0: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
-000129d0: 6e20 6974 656d 733a 0a20 2020 2020 2020  n items:.       
-000129e0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-000129f0: 6365 2869 7465 6d2c 2050 6f72 7429 3a0a  ce(item, Port):.
-00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a10: 7365 6c66 2e70 6f72 7473 203d 207b 6b3a  self.ports = {k:
-00012a20: 2076 2066 6f72 206b 2c20 7620 696e 2073   v for k, v in s
-00012a30: 656c 662e 706f 7274 732e 6974 656d 7328  elf.ports.items(
-00012a40: 2920 6966 2076 2021 3d20 6974 656d 7d0a  ) if v != item}.
-00012a50: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00012a60: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-00012a70: 2c20 6764 7374 6b2e 5265 6665 7265 6e63  , gdstk.Referenc
-00012a80: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00012a90: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e72      self._cell.r
-00012aa0: 656d 6f76 6528 6974 656d 290a 2020 2020  emove(item).    
-00012ab0: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00012ac0: 2e6f 776e 6572 203d 204e 6f6e 650a 2020  .owner = None.  
-00012ad0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-00012ae0: 7369 6e73 7461 6e63 6528 6974 656d 2c20  sinstance(item, 
-00012af0: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
-00012b00: 6365 293a 0a20 2020 2020 2020 2020 2020  ce):.           
-00012b10: 2020 2020 2073 656c 662e 7265 6665 7265       self.refere
-00012b20: 6e63 6573 2e72 656d 6f76 6528 6974 656d  nces.remove(item
-00012b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012b40: 2020 7365 6c66 2e5f 6365 6c6c 2e72 656d    self._cell.rem
-00012b50: 6f76 6528 6974 656d 2e5f 7265 6665 7265  ove(item._refere
-00012b60: 6e63 6529 0a20 2020 2020 2020 2020 2020  nce).           
-00012b70: 2020 2020 2069 7465 6d2e 6f77 6e65 7220       item.owner 
-00012b80: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-00012b90: 2020 2020 2020 2073 656c 662e 5f6e 616d         self._nam
-00012ba0: 6564 5f72 6566 6572 656e 6365 732e 706f  ed_references.po
-00012bb0: 7028 6974 656d 2e6e 616d 6529 0a20 2020  p(item.name).   
-00012bc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00012bd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012be0: 656c 662e 5f63 656c 6c2e 7265 6d6f 7665  elf._cell.remove
-00012bf0: 2869 7465 6d29 0a0a 2020 2020 2020 2020  (item)..        
-00012c00: 7365 6c66 2e5f 6262 5f76 616c 6964 203d  self._bb_valid =
-00012c10: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
-00012c20: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
-00012c30: 6465 6620 6861 7368 5f67 656f 6d65 7472  def hash_geometr
-00012c40: 7928 7365 6c66 2c20 7072 6563 6973 696f  y(self, precisio
-00012c50: 6e3a 2066 6c6f 6174 203d 2031 652d 3429  n: float = 1e-4)
-00012c60: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-00012c70: 2022 2222 5265 7475 726e 7320 616e 2053   """Returns an S
-00012c80: 4841 3120 6861 7368 206f 6620 7468 6520  HA1 hash of the 
-00012c90: 6765 6f6d 6574 7279 2069 6e20 7468 6520  geometry in the 
-00012ca0: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
-00012cb0: 2020 2020 466f 7220 6561 6368 206c 6179      For each lay
-00012cc0: 6572 2c20 6561 6368 2070 6f6c 7967 6f6e  er, each polygon
-00012cd0: 2069 7320 696e 6469 7669 6475 616c 6c79   is individually
-00012ce0: 2068 6173 6865 6420 616e 6420 7468 656e   hashed and then
-00012cf0: 2074 6865 2070 6f6c 7967 6f6e 2068 6173   the polygon has
-00012d00: 6865 730a 2020 2020 2020 2020 6172 6520  hes.        are 
-00012d10: 736f 7274 6564 2c20 746f 2065 6e73 7572  sorted, to ensur
-00012d20: 6520 7468 6520 6861 7368 2073 7461 7973  e the hash stays
-00012d30: 2063 6f6e 7374 616e 7420 7265 6761 7264   constant regard
-00012d40: 6c65 7373 206f 6620 7468 6520 6f72 6465  less of the orde
-00012d50: 7269 6e67 0a20 2020 2020 2020 2074 6865  ring.        the
-00012d60: 2070 6f6c 7967 6f6e 732e 2020 5369 6d69   polygons.  Simi
-00012d70: 6c61 726c 792c 2074 6865 206c 6179 6572  larly, the layer
-00012d80: 7320 6172 6520 736f 7274 6564 2062 7920  s are sorted by 
-00012d90: 286c 6179 6572 2c20 6461 7461 7479 7065  (layer, datatype
-00012da0: 292e 0a0a 2020 2020 2020 2020 4172 6773  )...        Args
-00012db0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00012dc0: 6563 6973 696f 6e3a 2052 6f75 6e64 696e  ecision: Roundin
-00012dd0: 6720 7072 6563 6973 696f 6e20 666f 7220  g precision for 
-00012de0: 7468 6520 7468 6520 6f62 6a65 6374 7320  the the objects 
-00012df0: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
-00012e00: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012e10: 2020 466f 7220 696e 7374 616e 6365 2c20    For instance, 
-00012e20: 6120 7072 6563 6973 696f 6e20 6f66 2031  a precision of 1
-00012e30: 652d 3220 7769 6c6c 2072 6f75 6e64 2061  e-2 will round a
-00012e40: 2070 6f69 6e74 2061 740a 2020 2020 2020   point at.      
-00012e50: 2020 2020 2020 2020 2020 2830 2e31 3234            (0.124
-00012e60: 2c20 312e 3734 3829 2074 6f20 2830 2e31  , 1.748) to (0.1
-00012e70: 322c 2031 2e37 3529 2e0a 0a20 2020 2020  2, 1.75)...     
-00012e80: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-00012e90: 6f6c 7967 6f6e 735f 6279 5f73 7065 6320  olygons_by_spec 
-00012ea0: 3d20 7365 6c66 2e67 6574 5f70 6f6c 7967  = self.get_polyg
-00012eb0: 6f6e 7328 6279 5f73 7065 633d 5472 7565  ons(by_spec=True
-00012ec0: 2c20 6173 5f61 7272 6179 3d46 616c 7365  , as_array=False
-00012ed0: 290a 2020 2020 2020 2020 6c61 7965 7273  ).        layers
-00012ee0: 203d 206e 702e 6172 7261 7928 6c69 7374   = np.array(list
-00012ef0: 2870 6f6c 7967 6f6e 735f 6279 5f73 7065  (polygons_by_spe
-00012f00: 632e 6b65 7973 2829 2929 0a20 2020 2020  c.keys())).     
-00012f10: 2020 2073 6f72 7465 645f 6c61 7965 7273     sorted_layers
-00012f20: 203d 206c 6179 6572 735b 6e70 2e6c 6578   = layers[np.lex
-00012f30: 736f 7274 2828 6c61 7965 7273 5b3a 2c20  sort((layers[:, 
-00012f40: 305d 2c20 6c61 7965 7273 5b3a 2c20 315d  0], layers[:, 1]
-00012f50: 2929 5d0a 0a20 2020 2020 2020 2066 696e  ))]..        fin
-00012f60: 616c 5f68 6173 6820 3d20 6861 7368 6c69  al_hash = hashli
-00012f70: 622e 7368 6131 2829 0a20 2020 2020 2020  b.sha1().       
-00012f80: 2066 6f72 206c 6179 6572 2069 6e20 736f   for layer in so
-00012f90: 7274 6564 5f6c 6179 6572 733a 0a20 2020  rted_layers:.   
-00012fa0: 2020 2020 2020 2020 206c 6179 6572 5f68           layer_h
-00012fb0: 6173 6820 3d20 6861 7368 6c69 622e 7368  ash = hashlib.sh
-00012fc0: 6131 286c 6179 6572 2e61 7374 7970 6528  a1(layer.astype(
-00012fd0: 6e70 2e69 6e74 3634 2929 2e64 6967 6573  np.int64)).diges
-00012fe0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00012ff0: 706f 6c79 676f 6e73 203d 2070 6f6c 7967  polygons = polyg
-00013000: 6f6e 735f 6279 5f73 7065 635b 7475 706c  ons_by_spec[tupl
-00013010: 6528 6c61 7965 7229 5d0a 2020 2020 2020  e(layer)].      
-00013020: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
-00013030: 205b 5f72 6e64 2870 2e70 6f69 6e74 732c   [_rnd(p.points,
-00013040: 2070 7265 6369 7369 6f6e 2920 666f 7220   precision) for 
-00013050: 7020 696e 2070 6f6c 7967 6f6e 735d 0a20  p in polygons]. 
-00013060: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00013070: 6f6e 5f68 6173 6865 7320 3d20 6e70 2e73  on_hashes = np.s
-00013080: 6f72 7428 5b68 6173 686c 6962 2e73 6861  ort([hashlib.sha
-00013090: 3128 7029 2e64 6967 6573 7428 2920 666f  1(p).digest() fo
-000130a0: 7220 7020 696e 2070 6f6c 7967 6f6e 735d  r p in polygons]
-000130b0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
-000130c0: 6e61 6c5f 6861 7368 2e75 7064 6174 6528  nal_hash.update(
-000130d0: 6c61 7965 725f 6861 7368 290a 2020 2020  layer_hash).    
-000130e0: 2020 2020 2020 2020 666f 7220 7068 2069          for ph i
-000130f0: 6e20 706f 6c79 676f 6e5f 6861 7368 6573  n polygon_hashes
-00013100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013110: 2020 6669 6e61 6c5f 6861 7368 2e75 7064    final_hash.upd
-00013120: 6174 6528 7068 290a 0a20 2020 2020 2020  ate(ph)..       
-00013130: 2072 6574 7572 6e20 6669 6e61 6c5f 6861   return final_ha
-00013140: 7368 2e68 6578 6469 6765 7374 2829 0a0a  sh.hexdigest()..
-00013150: 2020 2020 6465 6620 6765 745f 6c61 6265      def get_labe
-00013160: 6c73 280a 2020 2020 2020 2020 7365 6c66  ls(.        self
-00013170: 2c20 6170 706c 795f 7265 7065 7469 7469  , apply_repetiti
-00013180: 6f6e 733d 5472 7565 2c20 6465 7074 683a  ons=True, depth:
-00013190: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-000131a0: 204e 6f6e 652c 206c 6179 6572 3d4e 6f6e   None, layer=Non
-000131b0: 650a 2020 2020 2920 2d3e 204c 6973 745b  e.    ) -> List[
-000131c0: 4c61 6265 6c5d 3a0a 2020 2020 2020 2020  Label]:.        
-000131d0: 2222 2252 6574 7572 6e20 6c61 6265 6c73  """Return labels
-000131e0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-000131f0: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
-00013200: 6c79 5f72 6570 6574 6974 696f 6e73 3a2e  ly_repetitions:.
-00013210: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-00013220: 7468 3a20 4e6f 6e65 2072 6574 7572 6e73  th: None returns
-00013230: 2061 6c6c 206c 6162 656c 7320 616e 6420   all labels and 
-00013240: 3020 746f 7020 6c65 7665 6c2e 0a20 2020  0 top level..   
-00013250: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
-00013260: 6c61 7965 7273 7065 632e 0a20 2020 2020  layerspec..     
-00013270: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00013280: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
-00013290: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
-000132a0: 7965 720a 0a20 2020 2020 2020 2069 6620  yer..        if 
-000132b0: 6c61 7965 723a 0a20 2020 2020 2020 2020  layer:.         
-000132c0: 2020 206c 6179 6572 2c20 7465 7874 7479     layer, textty
-000132d0: 7065 203d 2067 6574 5f6c 6179 6572 286c  pe = get_layer(l
-000132e0: 6179 6572 290a 2020 2020 2020 2020 656c  ayer).        el
-000132f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00013300: 7465 7874 7479 7065 203d 204e 6f6e 650a  texttype = None.
-00013310: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00013320: 656c 662e 5f63 656c 6c2e 6765 745f 6c61  elf._cell.get_la
-00013330: 6265 6c73 280a 2020 2020 2020 2020 2020  bels(.          
-00013340: 2020 6170 706c 795f 7265 7065 7469 7469    apply_repetiti
-00013350: 6f6e 733d 6170 706c 795f 7265 7065 7469  ons=apply_repeti
-00013360: 7469 6f6e 732c 0a20 2020 2020 2020 2020  tions,.         
-00013370: 2020 2064 6570 7468 3d64 6570 7468 2c0a     depth=depth,.
-00013380: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00013390: 723d 6c61 7965 722c 0a20 2020 2020 2020  r=layer,.       
-000133a0: 2020 2020 2074 6578 7474 7970 653d 7465       texttype=te
-000133b0: 7874 7479 7065 2c0a 2020 2020 2020 2020  xttype,.        
-000133c0: 290a 0a20 2020 2064 6566 2072 656d 6f76  )..    def remov
-000133d0: 655f 6c61 6265 6c73 2873 656c 6629 202d  e_labels(self) -
-000133e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000133f0: 2222 2252 656d 6f76 6520 6c61 6265 6c73  """Remove labels
-00013400: 2e22 2222 0a20 2020 2020 2020 2073 656c  .""".        sel
-00013410: 662e 5f63 656c 6c2e 7265 6d6f 7665 282a  f._cell.remove(*
-00013420: 7365 6c66 2e6c 6162 656c 7329 0a0a 2020  self.labels)..  
-00013430: 2020 2320 4465 7072 6563 6174 6564 0a20    # Deprecated. 
-00013440: 2020 2064 6566 2067 6574 5f69 6e66 6f28     def get_info(
-00013450: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00013460: 2222 4761 7468 6572 7320 7468 6520 2e69  ""Gathers the .i
-00013470: 6e66 6f20 6469 6374 696f 6e61 7269 6573  nfo dictionaries
-00013480: 2066 726f 6d20 6576 6572 7920 7375 622d   from every sub-
-00013490: 436f 6d70 6f6e 656e 7420 616e 6420 7265  Component and re
-000134a0: 7475 726e 7320 7468 656d 2069 6e20 6120  turns them in a 
-000134b0: 6c69 7374 2e0a 0a20 2020 2020 2020 2041  list...        A
-000134c0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000134d0: 2064 6570 7468 3a20 696e 7420 6f72 204e   depth: int or N
-000134e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000134f0: 2020 2020 4966 206e 6f74 204e 6f6e 652c      If not None,
-00013500: 2064 6566 696e 6573 2066 726f 6d20 686f   defines from ho
-00013510: 7720 6d61 6e79 2072 6566 6572 656e 6365  w many reference
-00013520: 206c 6576 656c 7320 746f 0a20 2020 2020   levels to.     
-00013530: 2020 2020 2020 2020 2020 2072 6574 7269             retri
-00013540: 6576 6520 506f 7274 7320 6672 6f6d 2e0a  eve Ports from..
-00013550: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00013560: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-00013570: 7374 206f 6620 6469 6374 696f 6e61 7269  st of dictionari
-00013580: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00013590: 2020 204c 6973 7420 6f66 2074 6865 2022     List of the "
-000135a0: 2e69 6e66 6f22 2070 726f 7065 7274 7920  .info" property 
-000135b0: 6469 6374 696f 6e61 7269 6573 2066 726f  dictionaries fro
-000135c0: 6d20 616c 6c20 7375 622d 436f 6d70 6f6e  m all sub-Compon
-000135d0: 656e 7473 0a20 2020 2020 2020 2022 2222  ents.        """
-000135e0: 0a20 2020 2020 2020 2044 5f6c 6973 7420  .        D_list 
-000135f0: 3d20 7365 6c66 2e67 6574 5f64 6570 656e  = self.get_depen
-00013600: 6465 6e63 6965 7328 7265 6375 7273 6976  dencies(recursiv
-00013610: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00013620: 7265 7475 726e 205b 442e 696e 666f 2e63  return [D.info.c
-00013630: 6f70 7928 2920 666f 7220 4420 696e 2044  opy() for D in D
-00013640: 5f6c 6973 745d 0a0a 2020 2020 6465 6620  _list]..    def 
-00013650: 7265 6d61 705f 6c61 7965 7273 280a 2020  remap_layers(.  
-00013660: 2020 2020 2020 7365 6c66 2c20 6c61 7965        self, laye
-00013670: 726d 6170 2c20 696e 636c 7564 655f 6c61  rmap, include_la
-00013680: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
-00013690: 652c 2069 6e63 6c75 6465 5f70 6174 6873  e, include_paths
-000136a0: 3a20 626f 6f6c 203d 2054 7275 650a 2020  : bool = True.  
-000136b0: 2020 2920 2d3e 2043 6f6d 706f 6e65 6e74    ) -> Component
-000136c0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-000136d0: 7572 6e73 2061 2063 6f70 7920 6f66 2074  urns a copy of t
-000136e0: 6865 2063 6f6d 706f 6e65 6e74 2077 6974  he component wit
-000136f0: 6820 7265 6d61 7070 6564 206c 6179 6572  h remapped layer
-00013700: 732e 0a0a 2020 2020 2020 2020 4172 6773  s...        Args
-00013710: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-00013720: 7965 726d 6170 3a20 4469 6374 696f 6e61  yermap: Dictiona
-00013730: 7279 206f 6620 7661 6c75 6573 2069 6e20  ry of values in 
-00013740: 666f 726d 6174 207b 6c61 7965 725f 6672  format {layer_fr
-00013750: 6f6d 203a 206c 6179 6572 5f74 6f7d 2e0a  om : layer_to}..
-00013760: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00013770: 7564 655f 6c61 6265 6c73 3a20 5365 6c65  ude_labels: Sele
-00013780: 6374 7320 7768 6574 6865 7220 746f 206d  cts whether to m
-00013790: 6f76 6520 4c61 6265 6c73 2061 6c6f 6e67  ove Labels along
-000137a0: 2077 6974 6820 706f 6c79 676f 6e73 2e0a   with polygons..
-000137b0: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-000137c0: 7564 655f 7061 7468 733a 2053 656c 6563  ude_paths: Selec
-000137d0: 7473 2077 6865 7468 6572 2074 6f20 6d6f  ts whether to mo
-000137e0: 7665 2050 6174 6873 2061 6c6f 6e67 2077  ve Paths along w
-000137f0: 6974 6820 706f 6c79 676f 6e73 2e0a 2020  ith polygons..  
-00013800: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013810: 2020 636f 6d70 6f6e 656e 7420 3d20 7365    component = se
-00013820: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
-00013830: 2020 6c61 7965 726d 6170 203d 207b 5f70    layermap = {_p
-00013840: 6172 7365 5f6c 6179 6572 286b 293a 205f  arse_layer(k): _
-00013850: 7061 7273 655f 6c61 7965 7228 7629 2066  parse_layer(v) f
-00013860: 6f72 206b 2c20 7620 696e 206c 6179 6572  or k, v in layer
-00013870: 6d61 702e 6974 656d 7328 297d 0a0a 2020  map.items()}..  
-00013880: 2020 2020 2020 616c 6c5f 4420 3d20 6c69        all_D = li
-00013890: 7374 2863 6f6d 706f 6e65 6e74 2e67 6574  st(component.get
-000138a0: 5f64 6570 656e 6465 6e63 6965 7328 5472  _dependencies(Tr
-000138b0: 7565 2929 0a20 2020 2020 2020 2061 6c6c  ue)).        all
-000138c0: 5f44 2e61 7070 656e 6428 636f 6d70 6f6e  _D.append(compon
-000138d0: 656e 7429 0a20 2020 2020 2020 2066 6f72  ent).        for
-000138e0: 2044 2069 6e20 616c 6c5f 443a 0a20 2020   D in all_D:.   
-000138f0: 2020 2020 2020 2020 2066 6f72 2070 2069           for p i
-00013900: 6e20 442e 706f 6c79 676f 6e73 3a0a 2020  n D.polygons:.  
-00013910: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00013920: 7965 7220 3d20 2870 2e6c 6179 6572 2c20  yer = (p.layer, 
-00013930: 702e 6461 7461 7479 7065 290a 2020 2020  p.datatype).    
-00013940: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00013950: 6179 6572 2069 6e20 6c61 7965 726d 6170  ayer in layermap
-00013960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013970: 2020 2020 2020 6e65 775f 6c61 7965 7220        new_layer 
-00013980: 3d20 6c61 7965 726d 6170 5b6c 6179 6572  = layermap[layer
-00013990: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000139a0: 2020 2020 2020 702e 6c61 7965 7220 3d20        p.layer = 
-000139b0: 6e65 775f 6c61 7965 725b 305d 0a20 2020  new_layer[0].   
-000139c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139d0: 2070 2e64 6174 6174 7970 6520 3d20 6e65   p.datatype = ne
-000139e0: 775f 6c61 7965 725b 315d 0a20 2020 2020  w_layer[1].     
-000139f0: 2020 2020 2020 2069 6620 696e 636c 7564         if includ
-00013a00: 655f 6c61 6265 6c73 3a0a 2020 2020 2020  e_labels:.      
-00013a10: 2020 2020 2020 2020 2020 666f 7220 6c61            for la
-00013a20: 6265 6c20 696e 2044 2e6c 6162 656c 733a  bel in D.labels:
-00013a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013a40: 2020 2020 206f 7269 6769 6e61 6c5f 6c61       original_la
-00013a50: 7965 7220 3d20 286c 6162 656c 2e6c 6179  yer = (label.lay
-00013a60: 6572 2c20 6c61 6265 6c2e 7465 7874 7479  er, label.textty
-00013a70: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
-00013a80: 2020 2020 2020 2020 6f72 6967 696e 616c          original
-00013a90: 5f6c 6179 6572 203d 205f 7061 7273 655f  _layer = _parse_
-00013aa0: 6c61 7965 7228 6f72 6967 696e 616c 5f6c  layer(original_l
-00013ab0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-00013ac0: 2020 2020 2020 2020 2020 6966 206f 7269            if ori
-00013ad0: 6769 6e61 6c5f 6c61 7965 7220 696e 206c  ginal_layer in l
-00013ae0: 6179 6572 6d61 703a 0a20 2020 2020 2020  ayermap:.       
-00013af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b00: 206e 6577 5f6c 6179 6572 203d 206c 6179   new_layer = lay
-00013b10: 6572 6d61 705b 6f72 6967 696e 616c 5f6c  ermap[original_l
-00013b20: 6179 6572 5d0a 2020 2020 2020 2020 2020  ayer].          
-00013b30: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00013b40: 6265 6c2e 6c61 7965 7220 3d20 6e65 775f  bel.layer = new_
-00013b50: 6c61 7965 725b 305d 0a20 2020 2020 2020  layer[0].       
-00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b70: 206c 6162 656c 2e74 6578 7474 7970 6520   label.texttype 
-00013b80: 3d20 6e65 775f 6c61 7965 725b 315d 0a0a  = new_layer[1]..
-00013b90: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00013ba0: 6e63 6c75 6465 5f70 6174 6873 3a0a 2020  nclude_paths:.  
-00013bb0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00013bc0: 7220 7061 7468 2069 6e20 442e 7061 7468  r path in D.path
-00013bd0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00013be0: 2020 2020 2020 206e 6577 5f6c 6179 6572         new_layer
-00013bf0: 7320 3d20 6c69 7374 2870 6174 682e 6c61  s = list(path.la
-00013c00: 7965 7273 290a 2020 2020 2020 2020 2020  yers).          
-00013c10: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-00013c20: 7461 7479 7065 7320 3d20 6c69 7374 2870  tatypes = list(p
-00013c30: 6174 682e 6461 7461 7479 7065 7329 0a20  ath.datatypes). 
-00013c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c50: 2020 2066 6f72 206c 6179 6572 5f6e 756d     for layer_num
-00013c60: 6265 7220 696e 2072 616e 6765 286c 656e  ber in range(len
-00013c70: 286e 6577 5f6c 6179 6572 7329 293a 0a20  (new_layers)):. 
-00013c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c90: 2020 2020 2020 206f 7269 6769 6e61 6c5f         original_
-00013ca0: 6c61 7965 7220 3d20 5f70 6172 7365 5f6c  layer = _parse_l
-00013cb0: 6179 6572 280a 2020 2020 2020 2020 2020  ayer(.          
-00013cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cd0: 2020 286e 6577 5f6c 6179 6572 735b 6c61    (new_layers[la
-00013ce0: 7965 725f 6e75 6d62 6572 5d2c 206e 6577  yer_number], new
-00013cf0: 5f64 6174 6174 7970 6573 5b6c 6179 6572  _datatypes[layer
-00013d00: 5f6e 756d 6265 725d 290a 2020 2020 2020  _number]).      
-00013d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00013d30: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00013d40: 7269 6769 6e61 6c5f 6c61 7965 7220 696e  riginal_layer in
-00013d50: 206c 6179 6572 6d61 703a 0a20 2020 2020   layermap:.     
-00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d70: 2020 2020 2020 206e 6577 5f6c 6179 6572         new_layer
-00013d80: 203d 206c 6179 6572 6d61 705b 6f72 6967   = layermap[orig
-00013d90: 696e 616c 5f6c 6179 6572 5d0a 2020 2020  inal_layer].    
-00013da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013db0: 2020 2020 2020 2020 6e65 775f 6c61 7965          new_laye
-00013dc0: 7273 5b6c 6179 6572 5f6e 756d 6265 725d  rs[layer_number]
-00013dd0: 203d 206e 6577 5f6c 6179 6572 5b30 5d0a   = new_layer[0].
-00013de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013df0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00013e00: 6461 7461 7479 7065 735b 6c61 7965 725f  datatypes[layer_
-00013e10: 6e75 6d62 6572 5d20 3d20 6e65 775f 6c61  number] = new_la
-00013e20: 7965 725b 315d 0a20 2020 2020 2020 2020  yer[1].         
-00013e30: 2020 2020 2020 2020 2020 2070 6174 682e             path.
-00013e40: 7365 745f 6c61 7965 7273 282a 6e65 775f  set_layers(*new_
-00013e50: 6c61 7965 7273 290a 2020 2020 2020 2020  layers).        
-00013e60: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00013e70: 2e73 6574 5f64 6174 6174 7970 6573 282a  .set_datatypes(*
-00013e80: 6e65 775f 6461 7461 7479 7065 7329 0a20  new_datatypes). 
-00013e90: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-00013ea0: 6d70 6f6e 656e 740a 0a20 2020 2064 6566  mponent..    def
-00013eb0: 2074 6f5f 3364 280a 2020 2020 2020 2020   to_3d(.        
-00013ec0: 7365 6c66 2c0a 2020 2020 2020 2020 6c61  self,.        la
-00013ed0: 7965 725f 7669 6577 733a 204f 7074 696f  yer_views: Optio
-00013ee0: 6e61 6c5b 4c61 7965 7256 6965 7773 5d20  nal[LayerViews] 
-00013ef0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00013f00: 6c61 7965 725f 7374 6163 6b3a 204f 7074  layer_stack: Opt
-00013f10: 696f 6e61 6c5b 4c61 7965 7253 7461 636b  ional[LayerStack
-00013f20: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00013f30: 2020 6578 636c 7564 655f 6c61 7965 7273    exclude_layers
-00013f40: 3a20 4f70 7469 6f6e 616c 5b54 7570 6c65  : Optional[Tuple
-00013f50: 5b4c 6179 6572 2c20 2e2e 2e5d 5d20 3d20  [Layer, ...]] = 
-00013f60: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
-00013f70: 2020 2020 2022 2222 5265 7475 726e 2043       """Return C
-00013f80: 6f6d 706f 6e65 6e74 2033 4420 7472 696d  omponent 3D trim
-00013f90: 6573 6820 5363 656e 652e 0a0a 2020 2020  esh Scene...    
-00013fa0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00013fb0: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
-00013fc0: 2074 6f20 6578 7472 7564 6520 696e 2033   to extrude in 3
-00013fd0: 442e 0a20 2020 2020 2020 2020 2020 206c  D..            l
-00013fe0: 6179 6572 5f76 6965 7773 3a20 6c61 7965  ayer_views: laye
-00013ff0: 7220 636f 6c6f 7273 2066 726f 6d20 4b6c  r colors from Kl
-00014000: 6179 6f75 7420 4c61 7965 7220 5072 6f70  ayout Layer Prop
-00014010: 6572 7469 6573 2066 696c 652e 0a20 2020  erties file..   
-00014020: 2020 2020 2020 2020 2020 2020 2044 6566               Def
-00014030: 6175 6c74 7320 746f 2061 6374 6976 6520  aults to active 
-00014040: 5044 4b2e 6c61 7965 725f 7669 6577 732e  PDK.layer_views.
-00014050: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00014060: 6572 5f73 7461 636b 3a20 636f 6e74 6169  er_stack: contai
-00014070: 6e73 2074 6869 636b 6e65 7373 2061 6e64  ns thickness and
-00014080: 207a 6d69 6e20 666f 7220 6561 6368 206c   zmin for each l
-00014090: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
-000140a0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-000140b0: 6f20 6163 7469 7665 2050 444b 2e6c 6179  o active PDK.lay
-000140c0: 6572 5f73 7461 636b 2e0a 2020 2020 2020  er_stack..      
-000140d0: 2020 2020 2020 6578 636c 7564 655f 6c61        exclude_la
-000140e0: 7965 7273 3a20 6c61 7965 7273 2074 6f20  yers: layers to 
-000140f0: 6578 636c 7564 652e 0a0a 2020 2020 2020  exclude...      
-00014100: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00014110: 6f6d 2067 6473 6661 6374 6f72 792e 6578  om gdsfactory.ex
-00014120: 706f 7274 2e74 6f5f 3364 2069 6d70 6f72  port.to_3d impor
-00014130: 7420 746f 5f33 640a 0a20 2020 2020 2020  t to_3d..       
-00014140: 2072 6574 7572 6e20 746f 5f33 6428 0a20   return to_3d(. 
-00014150: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-00014160: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00014170: 6572 5f76 6965 7773 3d6c 6179 6572 5f76  er_views=layer_v
-00014180: 6965 7773 2c0a 2020 2020 2020 2020 2020  iews,.          
-00014190: 2020 6c61 7965 725f 7374 6163 6b3d 6c61    layer_stack=la
-000141a0: 7965 725f 7374 6163 6b2c 0a20 2020 2020  yer_stack,.     
-000141b0: 2020 2020 2020 2065 7863 6c75 6465 5f6c         exclude_l
-000141c0: 6179 6572 733d 6578 636c 7564 655f 6c61  ayers=exclude_la
-000141d0: 7965 7273 2c0a 2020 2020 2020 2020 290a  yers,.        ).
-000141e0: 0a20 2020 2064 6566 2074 6f5f 6e70 280a  .    def to_np(.
-000141f0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00014200: 2020 2020 2020 6e6d 5f70 6572 5f70 6978        nm_per_pix
-00014210: 656c 3a20 696e 7420 3d20 3230 2c0a 2020  el: int = 20,.  
-00014220: 2020 2020 2020 6c61 7965 7273 3a20 4c61        layers: La
-00014230: 7965 7273 203d 2028 2831 2c20 3029 2c29  yers = ((1, 0),)
-00014240: 2c0a 2020 2020 2020 2020 7661 6c75 6573  ,.        values
-00014250: 3a20 4f70 7469 6f6e 616c 5b54 7570 6c65  : Optional[Tuple
-00014260: 5b66 6c6f 6174 2c20 2e2e 2e5d 5d20 3d20  [float, ...]] = 
-00014270: 4e6f 6e65 2c0a 2020 2020 2020 2020 7061  None,.        pa
-00014280: 645f 7769 6474 683a 2069 6e74 203d 2031  d_width: int = 1
-00014290: 2c0a 2020 2020 2920 2d3e 206e 702e 6e64  ,.    ) -> np.nd
-000142a0: 6172 7261 793a 0a20 2020 2020 2020 2022  array:.        "
-000142b0: 2222 5265 7475 726e 7320 6120 7069 7865  ""Returns a pixe
-000142c0: 6c61 7465 6420 6e75 6d70 7920 6172 7261  lated numpy arra
-000142d0: 7920 6672 6f6d 2043 6f6d 706f 6e65 6e74  y from Component
-000142e0: 2070 6f6c 7967 6f6e 732e 0a0a 2020 2020   polygons...    
-000142f0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00014300: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
-00014310: 2043 6f6d 706f 6e65 6e74 2e0a 2020 2020   Component..    
-00014320: 2020 2020 2020 2020 6e6d 5f70 6572 5f70          nm_per_p
-00014330: 6978 656c 3a20 796f 7520 6361 6e20 676f  ixel: you can go
-00014340: 2066 726f 6d20 3230 2028 636f 6172 7365   from 20 (coarse
-00014350: 2920 746f 2034 2028 6669 6e65 292e 0a20  ) to 4 (fine).. 
-00014360: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00014370: 733a 2074 6f20 636f 6e76 6572 742e 204f  s: to convert. O
-00014380: 7264 6572 206d 6174 7465 7273 2028 6c61  rder matters (la
-00014390: 7474 6572 206f 7665 7277 7269 7465 2066  tter overwrite f
-000143a0: 6f72 6d65 7229 2e0a 2020 2020 2020 2020  ormer)..        
-000143b0: 2020 2020 7661 6c75 6573 3a20 6173 736f      values: asso
-000143c0: 6369 6174 6564 2074 6f20 6561 6368 206c  ciated to each l
-000143d0: 6179 6572 2028 6465 6661 756c 7473 2074  ayer (defaults t
-000143e0: 6f20 3129 2e0a 2020 2020 2020 2020 2020  o 1)..          
-000143f0: 2020 7061 645f 7769 6474 683a 2070 6164    pad_width: pad
-00014400: 6469 6e67 2070 6978 656c 7320 6172 6f75  ding pixels arou
-00014410: 6e64 2074 6865 2069 6d61 6765 2e0a 0a20  nd the image... 
-00014420: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00014430: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00014440: 7279 2e65 7870 6f72 742e 746f 5f6e 7020  ry.export.to_np 
-00014450: 696d 706f 7274 2074 6f5f 6e70 0a0a 2020  import to_np..  
-00014460: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
-00014470: 6e70 280a 2020 2020 2020 2020 2020 2020  np(.            
-00014480: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-00014490: 2020 6e6d 5f70 6572 5f70 6978 656c 3d6e    nm_per_pixel=n
-000144a0: 6d5f 7065 725f 7069 7865 6c2c 0a20 2020  m_per_pixel,.   
-000144b0: 2020 2020 2020 2020 206c 6179 6572 733d           layers=
-000144c0: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
-000144d0: 2020 2020 7661 6c75 6573 3d76 616c 7565      values=value
-000144e0: 732c 0a20 2020 2020 2020 2020 2020 2070  s,.            p
-000144f0: 6164 5f77 6964 7468 3d70 6164 5f77 6964  ad_width=pad_wid
-00014500: 7468 2c0a 2020 2020 2020 2020 290a 0a20  th,.        ).. 
-00014510: 2020 2064 6566 2077 7269 7465 5f73 746c     def write_stl
-00014520: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00014530: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-00014540: 3a20 7374 722c 0a20 2020 2020 2020 206c  : str,.        l
-00014550: 6179 6572 5f73 7461 636b 3a20 4f70 7469  ayer_stack: Opti
-00014560: 6f6e 616c 5b4c 6179 6572 5374 6163 6b5d  onal[LayerStack]
-00014570: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00014580: 2065 7863 6c75 6465 5f6c 6179 6572 733a   exclude_layers:
-00014590: 204f 7074 696f 6e61 6c5b 5475 706c 655b   Optional[Tuple[
-000145a0: 4c61 7965 722c 202e 2e2e 5d5d 203d 204e  Layer, ...]] = N
-000145b0: 6f6e 652c 0a20 2020 2029 202d 3e20 6e70  one,.    ) -> np
-000145c0: 2e6e 6461 7272 6179 3a0a 2020 2020 2020  .ndarray:.      
-000145d0: 2020 2222 2257 7269 7465 2061 2043 6f6d    """Write a Com
-000145e0: 706f 6e65 6e74 2074 6f20 5354 4c20 666f  ponent to STL fo
-000145f0: 7220 3344 2070 7269 6e74 696e 672e 0a0a  r 3D printing...
-00014600: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00014610: 2020 2020 2020 2020 2020 6669 6c65 7061            filepa
-00014620: 7468 3a20 746f 2077 7269 7465 2053 544c  th: to write STL
-00014630: 2074 6f2e 0a20 2020 2020 2020 2020 2020   to..           
-00014640: 206c 6179 6572 5f73 7461 636b 3a20 636f   layer_stack: co
-00014650: 6e74 6169 6e73 2074 6869 636b 6e65 7373  ntains thickness
-00014660: 2061 6e64 207a 6d69 6e20 666f 7220 6561   and zmin for ea
-00014670: 6368 206c 6179 6572 2e0a 2020 2020 2020  ch layer..      
-00014680: 2020 2020 2020 6578 636c 7564 655f 6c61        exclude_la
-00014690: 7965 7273 3a20 6c61 7965 7273 2074 6f20  yers: layers to 
-000146a0: 6578 636c 7564 652e 0a20 2020 2020 2020  exclude..       
-000146b0: 2020 2020 2075 7365 5f6c 6179 6572 5f6e       use_layer_n
-000146c0: 616d 653a 2049 6620 5472 7565 2c20 7573  ame: If True, us
-000146d0: 6573 204c 6179 6572 4c65 7665 6c20 6e61  es LayerLevel na
-000146e0: 6d65 7320 696e 206f 7574 7075 7420 6669  mes in output fi
-000146f0: 6c65 6e61 6d65 7320 7261 7468 6572 2074  lenames rather t
-00014700: 6861 6e20 6764 735f 6c61 7965 7220 616e  han gds_layer an
-00014710: 6420 6764 735f 6461 7461 7479 7065 2e0a  d gds_datatype..
-00014720: 2020 2020 2020 2020 2020 2020 6875 6c6c              hull
-00014730: 5f69 6e76 616c 6964 5f70 6f6c 7967 6f6e  _invalid_polygon
-00014740: 733a 2049 6620 5472 7565 2c20 7265 706c  s: If True, repl
-00014750: 6163 6573 2069 6e76 616c 6964 2070 6f6c  aces invalid pol
-00014760: 7967 6f6e 7320 2864 6574 6572 6d69 6e65  ygons (determine
-00014770: 6420 6279 2073 6861 7065 6c79 2e50 6f6c  d by shapely.Pol
-00014780: 7967 6f6e 2e69 735f 7661 6c69 6429 2077  ygon.is_valid) w
-00014790: 6974 6820 6974 7320 636f 6e76 6578 2068  ith its convex h
-000147a0: 756c 6c2e 0a20 2020 2020 2020 2020 2020  ull..           
-000147b0: 2073 6361 6c65 3a20 4f70 7469 6f6e 616c   scale: Optional
-000147c0: 2066 6163 746f 7220 6279 2077 6869 6368   factor by which
-000147d0: 2074 6f20 7363 616c 6520 6d65 7368 6573   to scale meshes
-000147e0: 2062 6566 6f72 6520 7772 6974 696e 672e   before writing.
-000147f0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00014800: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-00014810: 6374 6f72 792e 6578 706f 7274 2e74 6f5f  ctory.export.to_
-00014820: 7374 6c20 696d 706f 7274 2074 6f5f 7374  stl import to_st
-00014830: 6c0a 0a20 2020 2020 2020 2072 6574 7572  l..        retur
-00014840: 6e20 746f 5f73 746c 280a 2020 2020 2020  n to_stl(.      
-00014850: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00014860: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-00014870: 3d66 696c 6570 6174 682c 0a20 2020 2020  =filepath,.     
-00014880: 2020 2020 2020 206c 6179 6572 5f73 7461         layer_sta
-00014890: 636b 3d6c 6179 6572 5f73 7461 636b 2c0a  ck=layer_stack,.
-000148a0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
-000148b0: 7564 655f 6c61 7965 7273 3d65 7863 6c75  ude_layers=exclu
-000148c0: 6465 5f6c 6179 6572 732c 0a20 2020 2020  de_layers,.     
-000148d0: 2020 2029 0a0a 2020 2020 6465 6620 746f     )..    def to
-000148e0: 5f67 6d73 6828 0a20 2020 2020 2020 2073  _gmsh(.        s
-000148f0: 656c 662c 0a20 2020 2020 2020 2074 7970  elf,.        typ
-00014900: 652c 0a20 2020 2020 2020 207a 3d4e 6f6e  e,.        z=Non
-00014910: 652c 0a20 2020 2020 2020 2078 7365 6374  e,.        xsect
-00014920: 696f 6e5f 626f 756e 6473 3d4e 6f6e 652c  ion_bounds=None,
-00014930: 0a20 2020 2020 2020 206c 6179 6572 5f73  .        layer_s
-00014940: 7461 636b 3d4e 6f6e 652c 0a20 2020 2020  tack=None,.     
-00014950: 2020 2077 6166 6572 5f70 6164 6469 6e67     wafer_padding
-00014960: 3d30 2e30 2c0a 2020 2020 2020 2020 7761  =0.0,.        wa
-00014970: 6665 725f 6c61 7965 723d 4c41 5945 522e  fer_layer=LAYER.
-00014980: 5741 4645 522c 0a20 2020 2020 2020 202a  WAFER,.        *
-00014990: 6172 6773 2c0a 2020 2020 2020 2020 2a2a  args,.        **
-000149a0: 6b77 6172 6773 2c0a 2020 2020 293a 0a20  kwargs,.    ):. 
-000149b0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-000149c0: 7320 6120 676d 7368 206d 7368 206f 6620  s a gmsh msh of 
-000149d0: 7468 6520 636f 6d70 6f6e 656e 7420 666f  the component fo
-000149e0: 7220 6669 6e69 7465 2065 6c65 6d65 6e74  r finite element
-000149f0: 2073 696d 756c 6174 696f 6e2e 0a0a 2020   simulation...  
-00014a00: 2020 2020 2020 4172 6775 6d65 6e74 733a        Arguments:
-00014a10: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
-00014a20: 653a 206f 6e65 206f 6620 2278 7922 2c20  e: one of "xy", 
-00014a30: 2275 7a22 2c20 6f72 2022 3344 222e 2044  "uz", or "3D". D
-00014a40: 6574 6572 6d69 6e65 7320 7468 6520 7479  etermines the ty
-00014a50: 7065 206f 6620 6d65 7368 2074 6f20 7265  pe of mesh to re
-00014a60: 7475 726e 2e0a 2020 2020 2020 2020 2020  turn..          
-00014a70: 2020 7a3a 2075 7365 6420 746f 2064 6566    z: used to def
-00014a80: 696e 6520 7a2d 736c 6963 6520 666f 7220  ine z-slice for 
-00014a90: 7879 206d 6573 6869 6e67 0a20 2020 2020  xy meshing.     
-00014aa0: 2020 2020 2020 2078 7365 6374 696f 6e5f         xsection_
-00014ab0: 626f 756e 6473 3a20 7573 6564 2074 6f20  bounds: used to 
-00014ac0: 6465 6669 6e65 2069 6e2d 706c 616e 6520  define in-plane 
-00014ad0: 6c69 6e65 2066 6f72 2075 7a20 6d65 7368  line for uz mesh
-00014ae0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00014af0: 7761 6665 725f 7061 6464 696e 673a 2070  wafer_padding: p
-00014b00: 6164 6469 6e67 2062 6579 6f6e 6420 6262  adding beyond bb
-00014b10: 6f78 2074 6f20 6164 6420 746f 2057 4146  ox to add to WAF
-00014b20: 4552 206c 6179 6572 732e 0a0a 2020 2020  ER layers...    
-00014b30: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
-00014b40: 3a0a 2020 2020 2020 2020 2020 2020 4172  :.            Ar
-00014b50: 6775 6d65 6e74 7320 666f 7220 7468 6520  guments for the 
-00014b60: 7461 7267 6574 206d 6573 6869 6e67 2066  target meshing f
-00014b70: 756e 6374 696f 6e20 696e 2067 6473 6661  unction in gdsfa
-00014b80: 6374 6f72 792e 7369 6d75 6c61 7469 6f6e  ctory.simulation
-00014b90: 2e67 6d73 680a 2020 2020 2020 2020 2222  .gmsh.        ""
-00014ba0: 220a 2020 2020 2020 2020 2320 4164 6420  ".        # Add 
-00014bb0: 5741 4645 5220 6c61 7965 723a 0a20 2020  WAFER layer:.   
-00014bc0: 2020 2020 2070 6164 6465 645f 636f 6d70       padded_comp
-00014bd0: 6f6e 656e 7420 3d20 436f 6d70 6f6e 656e  onent = Componen
-00014be0: 7428 290a 2020 2020 2020 2020 7061 6464  t().        padd
-00014bf0: 6564 5f63 6f6d 706f 6e65 6e74 203c 3c20  ed_component << 
-00014c00: 7365 6c66 0a20 2020 2020 2020 2028 786d  self.        (xm
-00014c10: 696e 2c20 796d 696e 292c 2028 786d 6178  in, ymin), (xmax
-00014c20: 2c20 796d 6178 2920 3d20 7365 6c66 2e62  , ymax) = self.b
-00014c30: 626f 780a 2020 2020 2020 2020 706f 696e  box.        poin
-00014c40: 7473 203d 205b 0a20 2020 2020 2020 2020  ts = [.         
-00014c50: 2020 205b 786d 696e 202d 2077 6166 6572     [xmin - wafer
-00014c60: 5f70 6164 6469 6e67 2c20 796d 696e 202d  _padding, ymin -
-00014c70: 2077 6166 6572 5f70 6164 6469 6e67 5d2c   wafer_padding],
-00014c80: 0a20 2020 2020 2020 2020 2020 205b 786d  .            [xm
-00014c90: 6178 202b 2077 6166 6572 5f70 6164 6469  ax + wafer_paddi
-00014ca0: 6e67 2c20 796d 696e 202d 2077 6166 6572  ng, ymin - wafer
-00014cb0: 5f70 6164 6469 6e67 5d2c 0a20 2020 2020  _padding],.     
-00014cc0: 2020 2020 2020 205b 786d 6178 202b 2077         [xmax + w
-00014cd0: 6166 6572 5f70 6164 6469 6e67 2c20 796d  afer_padding, ym
-00014ce0: 6178 202b 2077 6166 6572 5f70 6164 6469  ax + wafer_paddi
-00014cf0: 6e67 5d2c 0a20 2020 2020 2020 2020 2020  ng],.           
-00014d00: 205b 786d 696e 202d 2077 6166 6572 5f70   [xmin - wafer_p
-00014d10: 6164 6469 6e67 2c20 796d 6178 202b 2077  adding, ymax + w
-00014d20: 6166 6572 5f70 6164 6469 6e67 5d2c 0a20  afer_padding],. 
-00014d30: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00014d40: 2070 6164 6465 645f 636f 6d70 6f6e 656e   padded_componen
-00014d50: 742e 6164 645f 706f 6c79 676f 6e28 706f  t.add_polygon(po
-00014d60: 696e 7473 2c20 6c61 7965 723d 7761 6665  ints, layer=wafe
-00014d70: 725f 6c61 7965 7229 0a0a 2020 2020 2020  r_layer)..      
-00014d80: 2020 6966 206c 6179 6572 5f73 7461 636b    if layer_stack
-00014d90: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00014da0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00014db0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00014dc0: 2020 2020 2020 2020 2741 204c 6179 6572          'A Layer
-00014dd0: 5374 6163 6b20 6d75 7374 2062 6520 7072  Stack must be pr
-00014de0: 6f76 6964 6564 2074 6872 6f75 6768 2061  ovided through a
-00014df0: 7267 756d 656e 7420 226c 6179 6572 5f73  rgument "layer_s
-00014e00: 7461 636b 222e 270a 2020 2020 2020 2020  tack".'.        
-00014e10: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-00014e20: 2074 7970 6520 3d3d 2022 7879 223a 0a20   type == "xy":. 
-00014e30: 2020 2020 2020 2020 2020 2069 6620 7a20             if z 
-00014e40: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00014e50: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00014e60: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00014e70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00014e80: 466f 7220 7879 2d6d 6573 6869 6e67 2c20  For xy-meshing, 
-00014e90: 6120 7a2d 7661 6c75 6520 6d75 7374 2062  a z-value must b
-00014ea0: 6520 7072 6f76 6964 6564 2076 6961 2074  e provided via t
-00014eb0: 6865 2066 6c6f 6174 2061 7267 756d 656e  he float argumen
-00014ec0: 7420 227a 222e 270a 2020 2020 2020 2020  t "z".'.        
-00014ed0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00014ee0: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-00014ef0: 6374 6f72 792e 7369 6d75 6c61 7469 6f6e  ctory.simulation
-00014f00: 2e67 6d73 682e 7879 5f78 7365 6374 696f  .gmsh.xy_xsectio
-00014f10: 6e5f 6d65 7368 2069 6d70 6f72 7420 7879  n_mesh import xy
-00014f20: 5f78 7365 6374 696f 6e5f 6d65 7368 0a0a  _xsection_mesh..
-00014f30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00014f40: 726e 2078 795f 7873 6563 7469 6f6e 5f6d  rn xy_xsection_m
-00014f50: 6573 6828 7061 6464 6564 5f63 6f6d 706f  esh(padded_compo
-00014f60: 6e65 6e74 2c20 7a2c 206c 6179 6572 5f73  nent, z, layer_s
-00014f70: 7461 636b 2c20 2a2a 6b77 6172 6773 290a  tack, **kwargs).
-00014f80: 2020 2020 2020 2020 656c 6966 2074 7970          elif typ
-00014f90: 6520 3d3d 2022 757a 223a 0a20 2020 2020  e == "uz":.     
-00014fa0: 2020 2020 2020 2069 6620 7873 6563 7469         if xsecti
-00014fb0: 6f6e 5f62 6f75 6e64 7320 6973 204e 6f6e  on_bounds is Non
-00014fc0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00014fd0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00014fe0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00014ff0: 2020 2020 2020 2020 2022 466f 7220 757a           "For uz
-00015000: 2d6d 6573 6869 6e67 2c20 796f 7520 6d75  -meshing, you mu
-00015010: 7374 2070 726f 7669 6465 2061 206c 696e  st provide a lin
-00015020: 6520 696e 2074 6865 2078 792d 706c 616e  e in the xy-plan
-00015030: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-00015040: 2020 2020 2020 2020 2276 6961 2074 6865          "via the
-00015050: 2054 7570 6c65 2061 7267 756d 656e 7420   Tuple argument 
-00015060: 5b5b 7831 2c79 315d 2c20 5b78 322c 7932  [[x1,y1], [x2,y2
-00015070: 5d5d 2078 7365 6374 696f 6e5f 626f 756e  ]] xsection_boun
-00015080: 6473 2e22 0a20 2020 2020 2020 2020 2020  ds.".           
-00015090: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000150a0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-000150b0: 7279 2e73 696d 756c 6174 696f 6e2e 676d  ry.simulation.gm
-000150c0: 7368 2e75 7a5f 7873 6563 7469 6f6e 5f6d  sh.uz_xsection_m
-000150d0: 6573 6820 696d 706f 7274 2075 7a5f 7873  esh import uz_xs
-000150e0: 6563 7469 6f6e 5f6d 6573 680a 0a20 2020  ection_mesh..   
-000150f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00015100: 757a 5f78 7365 6374 696f 6e5f 6d65 7368  uz_xsection_mesh
-00015110: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00015120: 2020 7061 6464 6564 5f63 6f6d 706f 6e65    padded_compone
-00015130: 6e74 2c20 7873 6563 7469 6f6e 5f62 6f75  nt, xsection_bou
-00015140: 6e64 732c 206c 6179 6572 5f73 7461 636b  nds, layer_stack
-00015150: 2c20 2a2a 6b77 6172 6773 0a20 2020 2020  , **kwargs.     
-00015160: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00015170: 2065 6c69 6620 7479 7065 203d 3d20 2233   elif type == "3
-00015180: 4422 3a0a 2020 2020 2020 2020 2020 2020  D":.            
-00015190: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-000151a0: 7369 6d75 6c61 7469 6f6e 2e67 6d73 682e  simulation.gmsh.
-000151b0: 7879 7a5f 6d65 7368 2069 6d70 6f72 7420  xyz_mesh import 
-000151c0: 7879 7a5f 6d65 7368 0a0a 2020 2020 2020  xyz_mesh..      
-000151d0: 2020 2020 2020 7265 7475 726e 2078 797a        return xyz
-000151e0: 5f6d 6573 6828 7061 6464 6564 5f63 6f6d  _mesh(padded_com
-000151f0: 706f 6e65 6e74 2c20 6c61 7965 725f 7374  ponent, layer_st
-00015200: 6163 6b2c 202a 2a6b 7761 7267 7329 0a20  ack, **kwargs). 
-00015210: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00015220: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00015230: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00015240: 2020 2020 2020 2020 2020 2027 5265 7175             'Requ
-00015250: 6972 6564 2061 7267 756d 656e 7420 2274  ired argument "t
-00015260: 7970 6522 206d 7573 7420 6265 206f 6e65  ype" must be one
-00015270: 206f 6620 2278 7922 2c20 2275 7a22 2c20   of "xy", "uz", 
-00015280: 6f72 2022 3344 222e 270a 2020 2020 2020  or "3D".'.      
-00015290: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-000152a0: 206f 6666 7365 7428 0a20 2020 2020 2020   offset(.       
-000152b0: 2073 656c 662c 0a20 2020 2020 2020 2064   self,.        d
-000152c0: 6973 7461 6e63 653a 2066 6c6f 6174 203d  istance: float =
-000152d0: 2030 2e31 2c0a 2020 2020 2020 2020 706f   0.1,.        po
-000152e0: 6c79 676f 6e73 3d4e 6f6e 652c 0a20 2020  lygons=None,.   
-000152f0: 2020 2020 2075 7365 5f75 6e69 6f6e 3a20       use_union: 
-00015300: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-00015310: 2020 2020 2070 7265 6369 7369 6f6e 3a20       precision: 
-00015320: 666c 6f61 7420 3d20 3165 2d34 2c0a 2020  float = 1e-4,.  
-00015330: 2020 2020 2020 6a6f 696e 3a20 7374 7220        join: str 
-00015340: 3d20 226d 6974 6572 222c 0a20 2020 2020  = "miter",.     
-00015350: 2020 2074 6f6c 6572 616e 6365 3a20 696e     tolerance: in
-00015360: 7420 3d20 322c 0a20 2020 2020 2020 206c  t = 2,.        l
-00015370: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
-00015380: 3d20 2257 4722 2c0a 2020 2020 2920 2d3e  = "WG",.    ) ->
-00015390: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
-000153a0: 2020 2020 2222 2252 6574 7572 6e73 206e      """Returns n
-000153b0: 6577 2043 6f6d 706f 6e65 6e74 2077 6974  ew Component wit
-000153c0: 6820 706f 6c79 676f 6e73 2065 726f 6465  h polygons erode
-000153d0: 6420 6f72 2064 696c 6174 6564 2062 7920  d or dilated by 
-000153e0: 616e 206f 6666 7365 742e 0a0a 2020 2020  an offset...    
-000153f0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00015400: 2020 2020 2020 6469 7374 616e 6365 3a20        distance: 
-00015410: 4469 7374 616e 6365 2074 6f20 6f66 6673  Distance to offs
-00015420: 6574 2070 6f6c 7967 6f6e 732e 2050 6f73  et polygons. Pos
-00015430: 6974 6976 6520 7661 6c75 6573 2065 7870  itive values exp
-00015440: 616e 642c 206e 6567 6174 6976 6520 7368  and, negative sh
-00015450: 7269 6e6b 2e0a 2020 2020 2020 2020 2020  rink..          
-00015460: 2020 7072 6563 6973 696f 6e3a 2044 6573    precision: Des
-00015470: 6972 6564 2070 7265 6369 7369 6f6e 2066  ired precision f
-00015480: 6f72 2072 6f75 6e64 696e 6720 7665 7274  or rounding vert
-00015490: 6578 2063 6f6f 7264 696e 6174 6573 2e0a  ex coordinates..
-000154a0: 2020 2020 2020 2020 2020 2020 6a6f 696e              join
-000154b0: 3a20 7b27 6d69 7465 7227 2c20 2762 6576  : {'miter', 'bev
-000154c0: 656c 272c 2027 726f 756e 6427 7d20 5479  el', 'round'} Ty
-000154d0: 7065 206f 6620 6a6f 696e 2075 7365 6420  pe of join used 
-000154e0: 746f 2063 7265 6174 6520 706f 6c79 676f  to create polygo
-000154f0: 6e20 6f66 6673 6574 0a20 2020 2020 2020  n offset.       
-00015500: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
-00015510: 466f 7220 6d69 7465 7220 6a6f 696e 7473  For miter joints
-00015520: 2c20 7468 6973 206e 756d 6265 7220 6d75  , this number mu
-00015530: 7374 2062 6520 6174 206c 6561 7374 2032  st be at least 2
-00015540: 2072 6570 7265 7365 6e74 7320 7468 650a   represents the.
-00015550: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00015560: 7869 6d61 6c20 6469 7374 616e 6365 2069  ximal distance i
-00015570: 6e20 6d75 6c74 6970 6c65 7320 6f66 206f  n multiples of o
-00015580: 6666 7365 7420 6265 7477 6565 6e20 6e65  ffset between ne
-00015590: 7720 7665 7274 6963 6573 2061 6e64 2074  w vertices and t
-000155a0: 6865 6972 0a20 2020 2020 2020 2020 2020  heir.           
-000155b0: 2020 206f 7269 6769 6e61 6c20 706f 7369     original posi
-000155c0: 7469 6f6e 2062 6566 6f72 6520 6265 7665  tion before beve
-000155d0: 6c69 6e67 2074 6f20 6176 6f69 6420 7370  ling to avoid sp
-000155e0: 696b 6573 2061 7420 6163 7574 6520 6a6f  ikes at acute jo
-000155f0: 696e 7473 2e20 466f 720a 2020 2020 2020  ints. For.      
-00015600: 2020 2020 2020 2020 726f 756e 6420 6a6f          round jo
-00015610: 696e 7473 2c20 6974 2069 6e64 6963 6174  ints, it indicat
-00015620: 6573 2074 6865 2063 7572 7661 7475 7265  es the curvature
-00015630: 2072 6573 6f6c 7574 696f 6e20 696e 206e   resolution in n
-00015640: 756d 6265 7220 6f66 0a20 2020 2020 2020  umber of.       
-00015650: 2020 2020 2020 2070 6f69 6e74 7320 7065         points pe
-00015660: 7220 6675 6c6c 2063 6972 636c 652e 0a20  r full circle.. 
-00015670: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00015680: 3a20 5370 6563 6966 6963 206c 6179 6572  : Specific layer
-00015690: 2066 6f72 206e 6577 2070 6f6c 7967 6f6e   for new polygon
-000156a0: 732e 0a0a 2020 2020 2020 2020 2222 220a  s...        """.
-000156b0: 2020 2020 2020 2020 696d 706f 7274 2067          import g
-000156c0: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
-000156d0: 0a20 2020 2020 2020 2067 6473 5f6c 6179  .        gds_lay
-000156e0: 6572 2c20 6764 735f 6461 7461 7479 7065  er, gds_datatype
-000156f0: 203d 2067 662e 6765 745f 6c61 7965 7228   = gf.get_layer(
-00015700: 6c61 7965 7229 0a20 2020 2020 2020 2070  layer).        p
-00015710: 203d 2067 6473 746b 2e6f 6666 7365 7428   = gdstk.offset(
-00015720: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
-00015730: 7967 6f6e 7320 6f72 2073 656c 662e 6765  ygons or self.ge
-00015740: 745f 706f 6c79 676f 6e73 2829 2c0a 2020  t_polygons(),.  
-00015750: 2020 2020 2020 2020 2020 6469 7374 616e            distan
-00015760: 6365 3d64 6973 7461 6e63 652c 0a20 2020  ce=distance,.   
-00015770: 2020 2020 2020 2020 206a 6f69 6e3d 6a6f           join=jo
-00015780: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-00015790: 746f 6c65 7261 6e63 653d 746f 6c65 7261  tolerance=tolera
-000157a0: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
-000157b0: 2070 7265 6369 7369 6f6e 3d70 7265 6369   precision=preci
-000157c0: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
-000157d0: 2020 7573 655f 756e 696f 6e3d 7573 655f    use_union=use_
-000157e0: 756e 696f 6e2c 0a20 2020 2020 2020 2020  union,.         
-000157f0: 2020 206c 6179 6572 3d67 6473 5f6c 6179     layer=gds_lay
-00015800: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00015810: 6461 7461 7479 7065 3d67 6473 5f64 6174  datatype=gds_dat
-00015820: 6174 7970 652c 0a20 2020 2020 2020 2029  atype,.        )
-00015830: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
-00015840: 656e 7420 3d20 6766 2e43 6f6d 706f 6e65  ent = gf.Compone
-00015850: 6e74 2829 0a20 2020 2020 2020 2063 6f6d  nt().        com
-00015860: 706f 6e65 6e74 2e61 6464 5f70 6f6c 7967  ponent.add_polyg
-00015870: 6f6e 2870 2c20 6c61 7965 723d 6c61 7965  on(p, layer=laye
-00015880: 7229 0a20 2020 2020 2020 2072 6574 7572  r).        retur
-00015890: 6e20 636f 6d70 6f6e 656e 740a 0a0a 6465  n component...de
-000158a0: 6620 636f 7079 280a 2020 2020 443a 2043  f copy(.    D: C
-000158b0: 6f6d 706f 6e65 6e74 2c0a 2020 2020 7265  omponent,.    re
-000158c0: 6665 7265 6e63 6573 3d4e 6f6e 652c 0a20  ferences=None,. 
-000158d0: 2020 2070 6f72 7473 3d4e 6f6e 652c 0a20     ports=None,. 
-000158e0: 2020 2070 6f6c 7967 6f6e 733d 4e6f 6e65     polygons=None
-000158f0: 2c0a 2020 2020 7061 7468 733d 4e6f 6e65  ,.    paths=None
-00015900: 2c0a 2020 2020 6e61 6d65 3d4e 6f6e 652c  ,.    name=None,
-00015910: 0a20 2020 206c 6162 656c 733d 4e6f 6e65  .    labels=None
-00015920: 2c0a 2920 2d3e 2043 6f6d 706f 6e65 6e74  ,.) -> Component
-00015930: 3a0a 2020 2020 2222 2252 6574 7572 6e73  :.    """Returns
-00015940: 2061 2043 6f6d 706f 6e65 6e74 2063 6f70   a Component cop
-00015950: 792e 0a0a 2020 2020 4172 6773 3a0a 2020  y...    Args:.  
-00015960: 2020 2020 2020 443a 2063 6f6d 706f 6e65        D: compone
-00015970: 6e74 2074 6f20 636f 7079 2e0a 2020 2020  nt to copy..    
-00015980: 2222 220a 2020 2020 445f 636f 7079 203d  """.    D_copy =
-00015990: 2043 6f6d 706f 6e65 6e74 2829 0a20 2020   Component().   
-000159a0: 2044 5f63 6f70 792e 696e 666f 203d 2044   D_copy.info = D
-000159b0: 2e69 6e66 6f0a 2020 2020 2320 445f 636f  .info.    # D_co
-000159c0: 7079 2e5f 6365 6c6c 203d 2044 2e5f 6365  py._cell = D._ce
-000159d0: 6c6c 2e63 6f70 7928 6e61 6d65 3d44 5f63  ll.copy(name=D_c
-000159e0: 6f70 792e 6e61 6d65 290a 0a20 2020 2066  opy.name)..    f
-000159f0: 6f72 2072 6566 2069 6e20 7265 6665 7265  or ref in refere
-00015a00: 6e63 6573 2069 6620 7265 6665 7265 6e63  nces if referenc
-00015a10: 6573 2069 7320 6e6f 7420 4e6f 6e65 2065  es is not None e
-00015a20: 6c73 6520 442e 7265 6665 7265 6e63 6573  lse D.references
-00015a30: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
-00015a40: 2e61 6464 2863 6f70 795f 7265 6665 7265  .add(copy_refere
-00015a50: 6e63 6528 7265 6629 290a 2020 2020 666f  nce(ref)).    fo
-00015a60: 7220 706f 7274 2069 6e20 2870 6f72 7473  r port in (ports
-00015a70: 2069 6620 706f 7274 7320 6973 206e 6f74   if ports is not
-00015a80: 204e 6f6e 6520 656c 7365 2044 2e70 6f72   None else D.por
-00015a90: 7473 292e 7661 6c75 6573 2829 3a0a 2020  ts).values():.  
-00015aa0: 2020 2020 2020 445f 636f 7079 2e61 6464        D_copy.add
-00015ab0: 5f70 6f72 7428 706f 7274 3d70 6f72 7429  _port(port=port)
-00015ac0: 0a20 2020 2066 6f72 2070 6f6c 7920 696e  .    for poly in
-00015ad0: 2070 6f6c 7967 6f6e 7320 6966 2070 6f6c   polygons if pol
-00015ae0: 7967 6f6e 7320 6973 206e 6f74 204e 6f6e  ygons is not Non
-00015af0: 6520 656c 7365 2044 2e70 6f6c 7967 6f6e  e else D.polygon
-00015b00: 733a 0a20 2020 2020 2020 2044 5f63 6f70  s:.        D_cop
-00015b10: 792e 6164 645f 706f 6c79 676f 6e28 706f  y.add_polygon(po
-00015b20: 6c79 290a 2020 2020 666f 7220 7061 7468  ly).    for path
-00015b30: 2069 6e20 7061 7468 7320 6966 2070 6174   in paths if pat
-00015b40: 6873 2069 7320 6e6f 7420 4e6f 6e65 2065  hs is not None e
-00015b50: 6c73 6520 442e 7061 7468 733a 0a20 2020  lse D.paths:.   
-00015b60: 2020 2020 2044 5f63 6f70 792e 6164 6428       D_copy.add(
-00015b70: 7061 7468 290a 2020 2020 666f 7220 6c61  path).    for la
-00015b80: 6265 6c20 696e 206c 6162 656c 7320 6966  bel in labels if
-00015b90: 206c 6162 656c 7320 6973 206e 6f74 204e   labels is not N
-00015ba0: 6f6e 6520 656c 7365 2044 2e6c 6162 656c  one else D.label
-00015bb0: 733a 0a20 2020 2020 2020 2044 5f63 6f70  s:.        D_cop
-00015bc0: 792e 6164 645f 6c61 6265 6c28 0a20 2020  y.add_label(.   
-00015bd0: 2020 2020 2020 2020 2074 6578 743d 6c61           text=la
-00015be0: 6265 6c2e 7465 7874 2c0a 2020 2020 2020  bel.text,.      
-00015bf0: 2020 2020 2020 706f 7369 7469 6f6e 3d6c        position=l
-00015c00: 6162 656c 2e6f 7269 6769 6e2c 0a20 2020  abel.origin,.   
-00015c10: 2020 2020 2020 2020 206c 6179 6572 3d28           layer=(
-00015c20: 6c61 6265 6c2e 6c61 7965 722c 206c 6162  label.layer, lab
-00015c30: 656c 2e74 6578 7474 7970 6529 2c0a 2020  el.texttype),.  
-00015c40: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
-00015c50: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
-00015c60: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
-00015c70: 2e6e 616d 6520 3d20 6e61 6d65 0a0a 2020  .name = name..  
-00015c80: 2020 7265 7475 726e 2044 5f63 6f70 790a    return D_copy.
-00015c90: 0a0a 6465 6620 636f 7079 5f72 6566 6572  ..def copy_refer
-00015ca0: 656e 6365 280a 2020 2020 7265 662c 0a20  ence(.    ref,. 
-00015cb0: 2020 2070 6172 656e 743d 4e6f 6e65 2c0a     parent=None,.
-00015cc0: 2020 2020 636f 6c75 6d6e 733d 4e6f 6e65      columns=None
-00015cd0: 2c0a 2020 2020 726f 7773 3d4e 6f6e 652c  ,.    rows=None,
-00015ce0: 0a20 2020 2073 7061 6369 6e67 3d4e 6f6e  .    spacing=Non
-00015cf0: 652c 0a20 2020 206f 7269 6769 6e3d 4e6f  e,.    origin=No
-00015d00: 6e65 2c0a 2020 2020 726f 7461 7469 6f6e  ne,.    rotation
-00015d10: 3d4e 6f6e 652c 0a20 2020 206d 6167 6e69  =None,.    magni
-00015d20: 6669 6361 7469 6f6e 3d4e 6f6e 652c 0a20  fication=None,. 
-00015d30: 2020 2078 5f72 6566 6c65 6374 696f 6e3d     x_reflection=
-00015d40: 4e6f 6e65 2c0a 2020 2020 6e61 6d65 3d4e  None,.    name=N
-00015d50: 6f6e 652c 0a20 2020 2076 313d 4e6f 6e65  one,.    v1=None
-00015d60: 2c0a 2020 2020 7632 3d4e 6f6e 652c 0a29  ,.    v2=None,.)
-00015d70: 202d 3e20 436f 6d70 6f6e 656e 7452 6566   -> ComponentRef
-00015d80: 6572 656e 6365 3a0a 2020 2020 7265 7475  erence:.    retu
-00015d90: 726e 2043 6f6d 706f 6e65 6e74 5265 6665  rn ComponentRefe
-00015da0: 7265 6e63 6528 0a20 2020 2020 2020 2063  rence(.        c
-00015db0: 6f6d 706f 6e65 6e74 3d70 6172 656e 7420  omponent=parent 
-00015dc0: 6f72 2072 6566 2e70 6172 656e 742c 0a20  or ref.parent,. 
-00015dd0: 2020 2020 2020 2063 6f6c 756d 6e73 3d63         columns=c
-00015de0: 6f6c 756d 6e73 206f 7220 7265 662e 636f  olumns or ref.co
-00015df0: 6c75 6d6e 732c 0a20 2020 2020 2020 2072  lumns,.        r
-00015e00: 6f77 733d 726f 7773 206f 7220 7265 662e  ows=rows or ref.
-00015e10: 726f 7773 2c0a 2020 2020 2020 2020 7370  rows,.        sp
-00015e20: 6163 696e 673d 7370 6163 696e 6720 6f72  acing=spacing or
-00015e30: 2072 6566 2e73 7061 6369 6e67 2c0a 2020   ref.spacing,.  
-00015e40: 2020 2020 2020 6f72 6967 696e 3d6f 7269        origin=ori
-00015e50: 6769 6e20 6f72 2072 6566 2e6f 7269 6769  gin or ref.origi
-00015e60: 6e2c 0a20 2020 2020 2020 2072 6f74 6174  n,.        rotat
-00015e70: 696f 6e3d 726f 7461 7469 6f6e 206f 7220  ion=rotation or 
-00015e80: 7265 662e 726f 7461 7469 6f6e 2c0a 2020  ref.rotation,.  
-00015e90: 2020 2020 2020 6d61 676e 6966 6963 6174        magnificat
-00015ea0: 696f 6e3d 6d61 676e 6966 6963 6174 696f  ion=magnificatio
-00015eb0: 6e20 6f72 2072 6566 2e6d 6167 6e69 6669  n or ref.magnifi
-00015ec0: 6361 7469 6f6e 2c0a 2020 2020 2020 2020  cation,.        
-00015ed0: 785f 7265 666c 6563 7469 6f6e 3d78 5f72  x_reflection=x_r
-00015ee0: 6566 6c65 6374 696f 6e20 6f72 2072 6566  eflection or ref
-00015ef0: 2e78 5f72 6566 6c65 6374 696f 6e2c 0a20  .x_reflection,. 
-00015f00: 2020 2020 2020 206e 616d 653d 6e61 6d65         name=name
-00015f10: 206f 7220 7265 662e 6e61 6d65 2c0a 2020   or ref.name,.  
-00015f20: 2020 2020 2020 7631 3d76 3120 6f72 2072        v1=v1 or r
-00015f30: 6566 2e76 312c 0a20 2020 2020 2020 2076  ef.v1,.        v
-00015f40: 323d 7632 206f 7220 7265 662e 7632 2c0a  2=v2 or ref.v2,.
-00015f50: 2020 2020 290a 0a0a 6465 6620 7465 7374      )...def test
-00015f60: 5f67 6574 5f6c 6179 6572 7328 2920 2d3e  _get_layers() ->
-00015f70: 2043 6f6d 706f 6e65 6e74 3a0a 2020 2020   Component:.    
-00015f80: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
-00015f90: 7920 6173 2067 660a 0a20 2020 2063 3120  y as gf..    c1 
-00015fa0: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
-00015fb0: 7374 7261 6967 6874 280a 2020 2020 2020  straight(.      
-00015fc0: 2020 6c65 6e67 7468 3d31 302c 0a20 2020    length=10,.   
-00015fd0: 2020 2020 2077 6964 7468 3d30 2e35 2c0a       width=0.5,.
-00015fe0: 2020 2020 2020 2020 6c61 7965 723d 2832          layer=(2
-00015ff0: 2c20 3029 2c0a 2020 2020 2020 2020 6262  , 0),.        bb
-00016000: 6f78 5f6c 6179 6572 733d 5b28 3131 312c  ox_layers=[(111,
-00016010: 2030 295d 2c0a 2020 2020 2020 2020 6262   0)],.        bb
-00016020: 6f78 5f6f 6666 7365 7473 3d5b 335d 2c0a  ox_offsets=[3],.
-00016030: 2020 2020 2020 2020 7769 7468 5f62 626f          with_bbo
-00016040: 783d 5472 7565 2c0a 2020 2020 2020 2020  x=True,.        
-00016050: 636c 6164 6469 6e67 5f6c 6179 6572 733d  cladding_layers=
-00016060: 4e6f 6e65 2c0a 2020 2020 2020 2020 6164  None,.        ad
-00016070: 645f 7069 6e73 3d4e 6f6e 652c 0a20 2020  d_pins=None,.   
-00016080: 2020 2020 2061 6464 5f62 626f 783d 4e6f       add_bbox=No
-00016090: 6e65 2c0a 2020 2020 290a 2020 2020 6173  ne,.    ).    as
-000160a0: 7365 7274 2063 312e 6765 745f 6c61 7965  sert c1.get_laye
-000160b0: 7273 2829 203d 3d20 7b28 322c 2030 292c  rs() == {(2, 0),
-000160c0: 2028 3131 312c 2030 297d 2c20 6331 2e67   (111, 0)}, c1.g
-000160d0: 6574 5f6c 6179 6572 7328 290a 2020 2020  et_layers().    
-000160e0: 2320 7265 7475 726e 2063 310a 2020 2020  # return c1.    
-000160f0: 6332 203d 2063 312e 7265 6d6f 7665 5f6c  c2 = c1.remove_l
-00016100: 6179 6572 7328 5b28 3131 312c 2030 295d  ayers([(111, 0)]
-00016110: 290a 2020 2020 6173 7365 7274 2063 322e  ).    assert c2.
-00016120: 6765 745f 6c61 7965 7273 2829 203d 3d20  get_layers() == 
-00016130: 7b28 322c 2030 297d 2c20 6332 2e67 6574  {(2, 0)}, c2.get
-00016140: 5f6c 6179 6572 7328 290a 2020 2020 7265  _layers().    re
-00016150: 7475 726e 2063 320a 0a0a 6465 6620 5f66  turn c2...def _f
-00016160: 696c 7465 725f 706f 6c79 7328 706f 6c79  ilter_polys(poly
-00016170: 676f 6e73 2c20 6c61 7965 7273 5f65 7863  gons, layers_exc
-00016180: 6c29 3a0a 2020 2020 7265 7475 726e 205b  l):.    return [
-00016190: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
-000161a0: 0a20 2020 2020 2020 2066 6f72 2070 6f6c  .        for pol
-000161b0: 7967 6f6e 2c20 6c61 7965 722c 2064 6174  ygon, layer, dat
-000161c0: 6174 7970 6520 696e 207a 6970 280a 2020  atype in zip(.  
-000161d0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
-000161e0: 6e73 2e70 6f6c 7967 6f6e 732c 2070 6f6c  ns.polygons, pol
-000161f0: 7967 6f6e 732e 6c61 7965 7273 2c20 706f  ygons.layers, po
-00016200: 6c79 676f 6e73 2e64 6174 6174 7970 6573  lygons.datatypes
-00016210: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00016220: 2020 2069 6620 286c 6179 6572 2c20 6461     if (layer, da
-00016230: 7461 7479 7065 2920 6e6f 7420 696e 206c  tatype) not in l
-00016240: 6179 6572 735f 6578 636c 0a20 2020 205d  ayers_excl.    ]
-00016250: 0a0a 0a64 6566 2072 6563 7572 7365 5f73  ...def recurse_s
-00016260: 7472 7563 7475 7265 7328 0a20 2020 2063  tructures(.    c
-00016270: 6f6d 706f 6e65 6e74 3a20 436f 6d70 6f6e  omponent: Compon
-00016280: 656e 742c 0a20 2020 2069 676e 6f72 655f  ent,.    ignore_
-00016290: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
-000162a0: 783a 204f 7074 696f 6e61 6c5b 4c69 7374  x: Optional[List
-000162b0: 5b73 7472 5d5d 203d 204e 6f6e 652c 0a20  [str]] = None,. 
-000162c0: 2020 2069 676e 6f72 655f 6675 6e63 7469     ignore_functi
-000162d0: 6f6e 735f 7072 6566 6978 3a20 4f70 7469  ons_prefix: Opti
-000162e0: 6f6e 616c 5b4c 6973 745b 7374 725d 5d20  onal[List[str]] 
-000162f0: 3d20 4e6f 6e65 2c0a 2920 2d3e 2044 6963  = None,.) -> Dic
-00016300: 745b 7374 722c 2041 6e79 5d3a 0a20 2020  t[str, Any]:.   
-00016310: 2022 2222 5265 6375 7273 6520 636f 6d70   """Recurse comp
-00016320: 6f6e 656e 7420 616e 6420 636f 6d70 6f6e  onent and compon
-00016330: 656e 7473 2072 6566 6572 656e 6365 7320  ents references 
-00016340: 7265 6375 7273 6976 656c 792e 0a0a 2020  recursively...  
-00016350: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00016360: 636f 6d70 6f6e 656e 743a 2063 6f6d 706f  component: compo
-00016370: 6e65 6e74 2074 6f20 7265 6375 7273 652e  nent to recurse.
-00016380: 0a20 2020 2020 2020 2069 676e 6f72 655f  .        ignore_
-00016390: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
-000163a0: 783a 206c 6973 7420 6f66 2070 7265 6669  x: list of prefi
-000163b0: 7820 746f 2069 676e 6f72 652e 0a20 2020  x to ignore..   
-000163c0: 2020 2020 2069 676e 6f72 655f 6675 6e63       ignore_func
-000163d0: 7469 6f6e 735f 7072 6566 6978 3a20 6c69  tions_prefix: li
-000163e0: 7374 206f 6620 7072 6566 6978 2074 6f20  st of prefix to 
-000163f0: 6967 6e6f 7265 2e0a 2020 2020 2222 220a  ignore..    """.
-00016400: 2020 2020 6967 6e6f 7265 5f66 756e 6374      ignore_funct
-00016410: 696f 6e73 5f70 7265 6669 7820 3d20 6967  ions_prefix = ig
-00016420: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
-00016430: 7265 6669 7820 6f72 205b 5d0a 2020 2020  refix or [].    
-00016440: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
-00016450: 735f 7072 6566 6978 203d 2069 676e 6f72  s_prefix = ignor
-00016460: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
-00016470: 6669 7820 6f72 205b 5d0a 0a20 2020 2069  fix or []..    i
-00016480: 6620 280a 2020 2020 2020 2020 6861 7361  f (.        hasa
-00016490: 7474 7228 636f 6d70 6f6e 656e 742c 2022  ttr(component, "
-000164a0: 6675 6e63 7469 6f6e 5f6e 616d 6522 290a  function_name").
-000164b0: 2020 2020 2020 2020 616e 6420 636f 6d70          and comp
-000164c0: 6f6e 656e 742e 6675 6e63 7469 6f6e 5f6e  onent.function_n
-000164d0: 616d 6520 696e 2069 676e 6f72 655f 6675  ame in ignore_fu
-000164e0: 6e63 7469 6f6e 735f 7072 6566 6978 0a20  nctions_prefix. 
-000164f0: 2020 2029 3a0a 2020 2020 2020 2020 7265     ):.        re
-00016500: 7475 726e 207b 7d0a 0a20 2020 2069 6620  turn {}..    if 
-00016510: 6861 7361 7474 7228 636f 6d70 6f6e 656e  hasattr(componen
-00016520: 742c 2022 6e61 6d65 2229 2061 6e64 2061  t, "name") and a
-00016530: 6e79 280a 2020 2020 2020 2020 636f 6d70  ny(.        comp
-00016540: 6f6e 656e 742e 6e61 6d65 2e73 7461 7274  onent.name.start
-00016550: 7377 6974 6828 6929 2066 6f72 2069 2069  swith(i) for i i
-00016560: 6e20 6967 6e6f 7265 5f63 6f6d 706f 6e65  n ignore_compone
-00016570: 6e74 735f 7072 6566 6978 0a20 2020 2029  nts_prefix.    )
-00016580: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00016590: 207b 7d0a 0a20 2020 206f 7574 7075 7420   {}..    output 
-000165a0: 3d20 7b63 6f6d 706f 6e65 6e74 2e6e 616d  = {component.nam
-000165b0: 653a 2064 6963 7428 636f 6d70 6f6e 656e  e: dict(componen
-000165c0: 742e 7365 7474 696e 6773 297d 0a20 2020  t.settings)}.   
-000165d0: 2066 6f72 2072 6566 6572 656e 6365 2069   for reference i
-000165e0: 6e20 636f 6d70 6f6e 656e 742e 7265 6665  n component.refe
-000165f0: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
-00016600: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-00016610: 2069 7369 6e73 7461 6e63 6528 7265 6665   isinstance(refe
-00016620: 7265 6e63 652c 2043 6f6d 706f 6e65 6e74  rence, Component
-00016630: 5265 6665 7265 6e63 6529 0a20 2020 2020  Reference).     
-00016640: 2020 2020 2020 2061 6e64 2072 6566 6572         and refer
-00016650: 656e 6365 2e72 6566 5f63 656c 6c2e 6e61  ence.ref_cell.na
-00016660: 6d65 206e 6f74 2069 6e20 6f75 7470 7574  me not in output
-00016670: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
-00016680: 2020 2020 2020 2020 6f75 7470 7574 2e75          output.u
-00016690: 7064 6174 6528 7265 6375 7273 655f 7374  pdate(recurse_st
-000166a0: 7275 6374 7572 6573 2872 6566 6572 656e  ructures(referen
-000166b0: 6365 2e72 6566 5f63 656c 6c29 290a 0a20  ce.ref_cell)).. 
-000166c0: 2020 2072 6574 7572 6e20 6f75 7470 7574     return output
-000166d0: 0a0a 0a64 6566 2066 6c61 7474 656e 5f69  ...def flatten_i
-000166e0: 6e76 616c 6964 5f72 6566 735f 7265 6375  nvalid_refs_recu
-000166f0: 7273 6976 6528 0a20 2020 2063 6f6d 706f  rsive(.    compo
-00016700: 6e65 6e74 3a20 436f 6d70 6f6e 656e 742c  nent: Component,
-00016710: 0a20 2020 2067 7269 645f 7369 7a65 3a20  .    grid_size: 
-00016720: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d20  Optional[float] 
-00016730: 3d20 4e6f 6e65 2c0a 2020 2020 7570 6461  = None,.    upda
-00016740: 7465 645f 636f 6d70 6f6e 656e 7473 3d4e  ted_components=N
-00016750: 6f6e 652c 0a20 2020 2074 7261 7665 7273  one,.    travers
-00016760: 6564 5f63 6f6d 706f 6e65 6e74 733d 4e6f  ed_components=No
-00016770: 6e65 2c0a 293a 0a20 2020 2022 2222 5265  ne,.):.    """Re
-00016780: 6375 7273 6976 656c 7920 666c 6174 7465  cursively flatte
-00016790: 6e73 2063 6f6d 706f 6e65 6e74 2072 6566  ns component ref
-000167a0: 6572 656e 6365 7320 7768 6963 6820 6861  erences which ha
-000167b0: 7665 2069 6e76 616c 6964 2074 7261 6e73  ve invalid trans
-000167c0: 666f 726d 6174 696f 6e73 2028 692e 652e  formations (i.e.
-000167d0: 206e 6f6e 2d39 3020 6465 6720 726f 7461   non-90 deg rota
-000167e0: 7469 6f6e 7320 6f72 2073 7562 2d67 7269  tions or sub-gri
-000167f0: 6420 7472 616e 736c 6174 696f 6e73 2920  d translations) 
-00016800: 616e 6420 7265 7475 726e 7320 6120 636f  and returns a co
-00016810: 7079 2069 6620 616e 7920 7375 6263 656c  py if any subcel
-00016820: 6c73 2068 6176 6520 6265 656e 206d 6f64  ls have been mod
-00016830: 6966 6965 642e 0a0a 2020 2020 5741 524e  ified...    WARN
-00016840: 494e 473a 2074 6869 7320 6675 6e63 7469  ING: this functi
-00016850: 6f6e 2077 696c 6c20 7072 6f64 7563 6520  on will produce 
-00016860: 7361 6d65 2d6e 616d 6520 636f 7069 6573  same-name copies
-00016870: 206f 6620 6365 6c6c 732e 2049 7420 6973   of cells. It is
-00016880: 2073 7472 6963 746c 7920 6d65 616e 7420   strictly meant 
-00016890: 746f 2062 6520 7573 6564 206f 6e20 7772  to be used on wr
-000168a0: 6974 6520 6f66 2074 6865 2047 4453 2066  ite of the GDS f
-000168b0: 696c 6520 616e 640a 2020 2020 7368 6f75  ile and.    shou
-000168c0: 6c64 206e 6f74 2062 6520 6d69 7865 6420  ld not be mixed 
-000168d0: 7769 7468 206f 7468 6572 2063 656c 6c73  with other cells
-000168e0: 2c20 6f72 2079 6f75 2077 696c 6c20 6c69  , or you will li
-000168f0: 6b65 6c79 2065 7870 6572 6965 6e63 6520  kely experience 
-00016900: 6973 7375 6573 2077 6974 6820 6475 706c  issues with dupl
-00016910: 6963 6174 6520 6365 6c6c 730a 0a20 2020  icate cells..   
-00016920: 2041 7267 733a 0a20 2020 2020 2020 2063   Args:.        c
-00016930: 6f6d 706f 6e65 6e74 3a20 7468 6520 636f  omponent: the co
-00016940: 6d70 6f6e 656e 7420 746f 2066 6978 2028  mponent to fix (
-00016950: 696e 2070 6c61 6365 292e 0a20 2020 2020  in place)..     
-00016960: 2020 2067 7269 645f 7369 7a65 3a20 7468     grid_size: th
-00016970: 6520 4744 5320 6772 6964 2073 697a 652c  e GDS grid size,
-00016980: 2069 6e20 756d 2c20 6465 6661 756c 7473   in um, defaults
-00016990: 2074 6f20 6163 7469 7665 2050 444b 2e67   to active PDK.g
-000169a0: 6574 5f67 7269 645f 7369 7a65 2829 0a20  et_grid_size(). 
-000169b0: 2020 2020 2020 2020 2020 2061 6e79 2074             any t
-000169c0: 7261 6e73 6c61 7469 6f6e 7320 7769 7468  ranslations with
-000169d0: 2068 6967 6865 7220 7265 736f 6c75 7469   higher resoluti
-000169e0: 6f6e 2074 6861 6e20 7468 6973 2061 7265  on than this are
-000169f0: 2063 6f6e 7369 6465 7265 6420 696e 7661   considered inva
-00016a00: 6c69 642e 0a20 2020 2020 2020 2075 7064  lid..        upd
-00016a10: 6174 6564 5f63 6f6d 706f 6e65 6e74 733a  ated_components:
-00016a20: 2074 6865 2072 756e 6e69 6e67 2064 6963   the running dic
-00016a30: 7469 6f6e 6172 7920 6f66 2063 6f6d 706f  tionary of compo
-00016a40: 6e65 6e74 7320 7768 6963 6820 6861 7665  nents which have
-00016a50: 2062 6565 6e20 6d6f 6469 6669 6564 2062   been modified b
-00016a60: 7920 7468 6973 2074 7261 6e73 666f 726d  y this transform
-00016a70: 6174 696f 6e2e 2053 686f 756c 6420 616c  ation. Should al
-00016a80: 7761 7973 2062 6520 4e6f 6e65 2c20 6578  ways be None, ex
-00016a90: 6365 7074 2066 6f72 2072 6563 7572 7369  cept for recursi
-00016aa0: 7665 2069 6e76 6f63 6174 696f 6e73 2e0a  ve invocations..
-00016ab0: 2020 2020 2020 2020 7472 6176 6572 7365          traverse
-00016ac0: 645f 636f 6d70 6f6e 656e 7473 3a20 7468  d_components: th
-00016ad0: 6520 7365 7420 6f66 2063 6f6d 706f 6e65  e set of compone
-00016ae0: 6e74 206e 616d 6573 2077 6869 6368 2068  nt names which h
-00016af0: 6176 6520 6265 656e 2074 7261 7665 7273  ave been travers
-00016b00: 6564 2e20 5368 6f75 6c64 2061 6c77 6179  ed. Should alway
-00016b10: 7320 6265 204e 6f6e 652c 2065 7863 6570  s be None, excep
-00016b20: 7420 666f 7220 7265 6375 7273 6976 6520  t for recursive 
-00016b30: 696e 766f 6361 7469 6f6e 732e 0a20 2020  invocations..   
-00016b40: 2022 2222 0a20 2020 2066 726f 6d20 6764   """.    from gd
-00016b50: 7366 6163 746f 7279 2e64 6563 6f72 6174  sfactory.decorat
-00016b60: 6f72 7320 696d 706f 7274 2069 735f 696e  ors import is_in
-00016b70: 7661 6c69 645f 7265 660a 0a20 2020 2069  valid_ref..    i
-00016b80: 6e76 616c 6964 5f72 6566 7320 3d20 5b5d  nvalid_refs = []
-00016b90: 0a20 2020 2072 6566 7320 3d20 636f 6d70  .    refs = comp
-00016ba0: 6f6e 656e 742e 7265 6665 7265 6e63 6573  onent.references
-00016bb0: 0a20 2020 2073 7562 6365 6c6c 5f6d 6f64  .    subcell_mod
-00016bc0: 6966 6965 6420 3d20 4661 6c73 650a 2020  ified = False.  
-00016bd0: 2020 6966 2075 7064 6174 6564 5f63 6f6d    if updated_com
-00016be0: 706f 6e65 6e74 7320 6973 204e 6f6e 653a  ponents is None:
-00016bf0: 0a20 2020 2020 2020 2075 7064 6174 6564  .        updated
-00016c00: 5f63 6f6d 706f 6e65 6e74 7320 3d20 7b7d  _components = {}
-00016c10: 0a20 2020 2069 6620 7472 6176 6572 7365  .    if traverse
-00016c20: 645f 636f 6d70 6f6e 656e 7473 2069 7320  d_components is 
-00016c30: 4e6f 6e65 3a0a 2020 2020 2020 2020 7472  None:.        tr
-00016c40: 6176 6572 7365 645f 636f 6d70 6f6e 656e  aversed_componen
-00016c50: 7473 203d 2073 6574 2829 0a20 2020 2066  ts = set().    f
-00016c60: 6f72 2072 6566 2069 6e20 7265 6673 3a0a  or ref in refs:.
-00016c70: 2020 2020 2020 2020 2320 6d61 726b 2061          # mark a
-00016c80: 6e79 2069 6e76 616c 6964 2072 6566 7320  ny invalid refs 
-00016c90: 666f 7220 666c 6174 7465 6e69 6e67 0a20  for flattening. 
-00016ca0: 2020 2020 2020 2023 206f 7468 6572 7769         # otherwi
-00016cb0: 7365 2c20 6368 6563 6b20 6966 2074 6865  se, check if the
-00016cc0: 7265 2061 7265 2061 6e79 206d 6f64 6966  re are any modif
-00016cd0: 6965 6420 6365 6c6c 7320 6265 6e65 6174  ied cells beneat
-00016ce0: 6820 2877 6520 6e65 6564 206e 6f74 2064  h (we need not d
-00016cf0: 6f20 7468 6973 2069 6620 7468 6520 7265  o this if the re
-00016d00: 6620 7769 6c6c 2062 6520 666c 6174 7465  f will be flatte
-00016d10: 6e65 6420 616e 7977 6179 7329 0a20 2020  ned anyways).   
-00016d20: 2020 2020 2069 6620 6973 5f69 6e76 616c       if is_inval
-00016d30: 6964 5f72 6566 2872 6566 2c20 6772 6964  id_ref(ref, grid
-00016d40: 5f73 697a 6529 3a0a 2020 2020 2020 2020  _size):.        
-00016d50: 2020 2020 696e 7661 6c69 645f 7265 6673      invalid_refs
-00016d60: 2e61 7070 656e 6428 7265 662e 6e61 6d65  .append(ref.name
-00016d70: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00016d80: 2020 2020 2020 2020 2020 2020 2320 6f74              # ot
-00016d90: 6865 7277 6973 652c 2072 6563 7572 7369  herwise, recursi
-00016da0: 7665 6c79 2066 6c61 7474 656e 2072 6566  vely flatten ref
-00016db0: 7320 6966 2074 6865 2073 7562 6365 6c6c  s if the subcell
-00016dc0: 2068 6173 206e 6f74 2061 6c72 6561 6479   has not already
-00016dd0: 2062 6565 6e20 7472 6176 6572 7365 640a   been traversed.
-00016de0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00016df0: 6566 2e70 6172 656e 742e 6e61 6d65 206e  ef.parent.name n
-00016e00: 6f74 2069 6e20 7472 6176 6572 7365 645f  ot in traversed_
-00016e10: 636f 6d70 6f6e 656e 7473 3a0a 2020 2020  components:.    
-00016e20: 2020 2020 2020 2020 2020 2020 666c 6174              flat
-00016e30: 7465 6e5f 696e 7661 6c69 645f 7265 6673  ten_invalid_refs
-00016e40: 5f72 6563 7572 7369 7665 280a 2020 2020  _recursive(.    
-00016e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e60: 7265 662e 7061 7265 6e74 2c0a 2020 2020  ref.parent,.    
-00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e80: 6772 6964 5f73 697a 653d 6772 6964 5f73  grid_size=grid_s
-00016e90: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-00016ea0: 2020 2020 2020 2020 2075 7064 6174 6564           updated
-00016eb0: 5f63 6f6d 706f 6e65 6e74 733d 7570 6461  _components=upda
-00016ec0: 7465 645f 636f 6d70 6f6e 656e 7473 2c0a  ted_components,.
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 2020 2020 7472 6176 6572 7365 645f 636f      traversed_co
-00016ef0: 6d70 6f6e 656e 7473 3d74 7261 7665 7273  mponents=travers
-00016f00: 6564 5f63 6f6d 706f 6e65 6e74 732c 0a20  ed_components,. 
-00016f10: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00016f20: 0a20 2020 2020 2020 2020 2020 2023 206e  .            # n
-00016f30: 6f77 2c20 6966 2074 6865 2072 6566 2773  ow, if the ref's
-00016f40: 2063 656c 6c20 6265 656e 206d 6f64 6966   cell been modif
-00016f50: 6965 642c 206d 6172 6b20 6974 2061 7320  ied, mark it as 
-00016f60: 7375 6368 0a20 2020 2020 2020 2020 2020  such.           
-00016f70: 2069 6620 7265 662e 7061 7265 6e74 2e6e   if ref.parent.n
-00016f80: 616d 6520 696e 2075 7064 6174 6564 5f63  ame in updated_c
-00016f90: 6f6d 706f 6e65 6e74 733a 0a20 2020 2020  omponents:.     
-00016fa0: 2020 2020 2020 2020 2020 2073 7562 6365             subce
-00016fb0: 6c6c 5f6d 6f64 6966 6965 6420 3d20 5472  ll_modified = Tr
-00016fc0: 7565 0a20 2020 2069 6620 696e 7661 6c69  ue.    if invali
-00016fd0: 645f 7265 6673 206f 7220 7375 6263 656c  d_refs or subcel
-00016fe0: 6c5f 6d6f 6469 6669 6564 3a0a 2020 2020  l_modified:.    
-00016ff0: 2020 2020 6e65 775f 636f 6d70 6f6e 656e      new_componen
-00017000: 7420 3d20 636f 6d70 6f6e 656e 742e 636f  t = component.co
-00017010: 7079 2829 0a20 2020 2020 2020 206e 6577  py().        new
-00017020: 5f63 6f6d 706f 6e65 6e74 2e6e 616d 6520  _component.name 
-00017030: 3d20 636f 6d70 6f6e 656e 742e 6e61 6d65  = component.name
-00017040: 0a20 2020 2020 2020 2023 206d 616b 6520  .        # make 
-00017050: 7375 7265 2061 6c6c 206d 6f64 6966 6965  sure all modifie
-00017060: 6420 6365 6c6c 7320 6861 7665 2074 6865  d cells have the
-00017070: 6972 2072 6566 6572 656e 6365 7320 7570  ir references up
-00017080: 6461 7465 640a 2020 2020 2020 2020 6e65  dated.        ne
-00017090: 775f 7265 6673 203d 206e 6577 5f63 6f6d  w_refs = new_com
-000170a0: 706f 6e65 6e74 2e72 6566 6572 656e 6365  ponent.reference
-000170b0: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
-000170c0: 2066 6f72 2072 6566 2069 6e20 6e65 775f   for ref in new_
-000170d0: 7265 6673 3a0a 2020 2020 2020 2020 2020  refs:.          
-000170e0: 2020 6966 2072 6566 2e6e 616d 6520 696e    if ref.name in
-000170f0: 2069 6e76 616c 6964 5f72 6566 733a 0a20   invalid_refs:. 
-00017100: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00017110: 6577 5f63 6f6d 706f 6e65 6e74 2e66 6c61  ew_component.fla
-00017120: 7474 656e 5f72 6566 6572 656e 6365 2872  tten_reference(r
-00017130: 6566 290a 2020 2020 2020 2020 2020 2020  ef).            
-00017140: 656c 6966 2028 0a20 2020 2020 2020 2020  elif (.         
-00017150: 2020 2020 2020 2072 6566 2e70 6172 656e         ref.paren
-00017160: 742e 6e61 6d65 2069 6e20 7570 6461 7465  t.name in update
-00017170: 645f 636f 6d70 6f6e 656e 7473 0a20 2020  d_components.   
-00017180: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00017190: 2072 6566 2e70 6172 656e 7420 6973 206e   ref.parent is n
-000171a0: 6f74 2075 7064 6174 6564 5f63 6f6d 706f  ot updated_compo
-000171b0: 6e65 6e74 735b 7265 662e 7061 7265 6e74  nents[ref.parent
-000171c0: 2e6e 616d 655d 0a20 2020 2020 2020 2020  .name].         
-000171d0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-000171e0: 2020 2020 2020 7265 662e 7061 7265 6e74        ref.parent
-000171f0: 203d 2075 7064 6174 6564 5f63 6f6d 706f   = updated_compo
-00017200: 6e65 6e74 735b 7265 662e 7061 7265 6e74  nents[ref.parent
-00017210: 2e6e 616d 655d 0a20 2020 2020 2020 2063  .name].        c
-00017220: 6f6d 706f 6e65 6e74 203d 206e 6577 5f63  omponent = new_c
-00017230: 6f6d 706f 6e65 6e74 0a20 2020 2020 2020  omponent.       
-00017240: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
-00017250: 6e74 735b 636f 6d70 6f6e 656e 742e 6e61  nts[component.na
-00017260: 6d65 5d20 3d20 6e65 775f 636f 6d70 6f6e  me] = new_compon
-00017270: 656e 740a 2020 2020 7472 6176 6572 7365  ent.    traverse
-00017280: 645f 636f 6d70 6f6e 656e 7473 2e61 6464  d_components.add
-00017290: 2863 6f6d 706f 6e65 6e74 2e6e 616d 6529  (component.name)
-000172a0: 0a20 2020 2072 6574 7572 6e20 636f 6d70  .    return comp
-000172b0: 6f6e 656e 740a 0a0a 6465 6620 5f63 6865  onent...def _che
-000172c0: 636b 5f75 6e63 6163 6865 645f 636f 6d70  ck_uncached_comp
-000172d0: 6f6e 656e 7473 2863 6f6d 706f 6e65 6e74  onents(component
-000172e0: 2c20 6d6f 6465 293a 0a20 2020 2076 616c  , mode):.    val
-000172f0: 6964 5f6d 6f64 6573 203d 205b 2277 6172  id_modes = ["war
-00017300: 6e22 2c20 2265 7272 6f72 222c 2022 6967  n", "error", "ig
-00017310: 6e6f 7265 225d 0a0a 2020 2020 6966 206d  nore"]..    if m
-00017320: 6f64 6520 3d3d 2022 6967 6e6f 7265 223a  ode == "ignore":
-00017330: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
-00017340: 2020 2020 656c 6966 206d 6f64 6520 6e6f      elif mode no
-00017350: 7420 696e 2076 616c 6964 5f6d 6f64 6573  t in valid_modes
-00017360: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00017370: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00017380: 2020 2020 2020 2020 6622 7b6d 6f64 657d          f"{mode}
-00017390: 2069 7320 6e6f 7420 6120 7661 6c69 6420   is not a valid 
-000173a0: 7661 6c75 6520 666f 7220 6f6e 5f75 6e63  value for on_unc
-000173b0: 6163 6865 645f 636f 6d70 6f6e 656e 742e  ached_component.
-000173c0: 2054 7279 206f 6e65 206f 6620 7468 6573   Try one of thes
-000173d0: 653a 207b 7661 6c69 645f 6d6f 6465 737d  e: {valid_modes}
-000173e0: 2e22 0a20 2020 2020 2020 2029 0a0a 2020  .".        )..  
-000173f0: 2020 666f 7220 7375 625f 636f 6d70 6f6e    for sub_compon
-00017400: 656e 7420 696e 2063 6f6d 706f 6e65 6e74  ent in component
-00017410: 2e67 6574 5f64 6570 656e 6465 6e63 6965  .get_dependencie
-00017420: 7328 7265 6375 7273 6976 653d 5472 7565  s(recursive=True
-00017430: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
-00017440: 7420 7375 625f 636f 6d70 6f6e 656e 742e  t sub_component.
-00017450: 5f6c 6f63 6b65 643a 0a20 2020 2020 2020  _locked:.       
-00017460: 2020 2020 206d 6573 7361 6765 203d 2028       message = (
-00017470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017480: 2066 2243 6f6d 706f 6e65 6e74 207b 7375   f"Component {su
-00017490: 625f 636f 6d70 6f6e 656e 742e 6e61 6d65  b_component.name
-000174a0: 2172 7d20 7761 7320 4e4f 5420 7072 6f70  !r} was NOT prop
-000174b0: 6572 6c79 206c 6f63 6b65 642e 2022 0a20  erly locked. ". 
-000174c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000174d0: 596f 7520 6e65 6564 2074 6f20 7772 6974  You need to writ
-000174e0: 6520 6974 2069 6e74 6f20 6120 6675 6e63  e it into a func
-000174f0: 7469 6f6e 2074 6861 7420 6861 7320 7468  tion that has th
-00017500: 6520 4063 656c 6c20 6465 636f 7261 746f  e @cell decorato
-00017510: 722e 220a 2020 2020 2020 2020 2020 2020  r.".            
-00017520: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00017530: 206d 6f64 6520 3d3d 2022 7761 726e 223a   mode == "warn":
-00017540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017550: 2077 6172 6e69 6e67 732e 7761 726e 286d   warnings.warn(m
-00017560: 6573 7361 6765 2c20 556e 6361 6368 6564  essage, Uncached
-00017570: 436f 6d70 6f6e 656e 7457 6172 6e69 6e67  ComponentWarning
-00017580: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00017590: 6c69 6620 6d6f 6465 203d 3d20 2265 7272  lif mode == "err
-000175a0: 6f72 223a 0a20 2020 2020 2020 2020 2020  or":.           
-000175b0: 2020 2020 2072 6169 7365 2055 6e63 6163       raise Uncac
-000175c0: 6865 6443 6f6d 706f 6e65 6e74 4572 726f  hedComponentErro
-000175d0: 7228 6d65 7373 6167 6529 0a0a 0a64 6566  r(message)...def
-000175e0: 2074 6573 745f 7361 6d65 5f75 6964 2829   test_same_uid()
-000175f0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
-00017600: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
-00017610: 6173 2067 660a 0a20 2020 2063 203d 2043  as gf..    c = C
-00017620: 6f6d 706f 6e65 6e74 2829 0a20 2020 2063  omponent().    c
-00017630: 203c 3c20 6766 2e63 6f6d 706f 6e65 6e74   << gf.component
-00017640: 732e 7265 6374 616e 676c 6528 290a 2020  s.rectangle().  
-00017650: 2020 6320 3c3c 2067 662e 636f 6d70 6f6e    c << gf.compon
-00017660: 656e 7473 2e72 6563 7461 6e67 6c65 2829  ents.rectangle()
-00017670: 0a0a 2020 2020 7231 203d 2063 2e72 6566  ..    r1 = c.ref
-00017680: 6572 656e 6365 735b 305d 2e70 6172 656e  erences[0].paren
-00017690: 740a 2020 2020 7232 203d 2063 2e72 6566  t.    r2 = c.ref
-000176a0: 6572 656e 6365 735b 315d 2e70 6172 656e  erences[1].paren
-000176b0: 740a 0a20 2020 2061 7373 6572 7420 7231  t..    assert r1
-000176c0: 2e75 6964 203d 3d20 7232 2e75 6964 2c20  .uid == r2.uid, 
-000176d0: 6622 7b72 312e 7569 647d 206d 7573 7420  f"{r1.uid} must 
-000176e0: 6571 7561 6c20 7b72 322e 7569 647d 220a  equal {r2.uid}".
-000176f0: 0a0a 6465 6620 7465 7374 5f6e 6574 6c69  ..def test_netli
-00017700: 7374 5f73 696d 706c 6528 2920 2d3e 204e  st_simple() -> N
-00017710: 6f6e 653a 0a20 2020 2069 6d70 6f72 7420  one:.    import 
-00017720: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
-00017730: 0a0a 2020 2020 6320 3d20 6766 2e43 6f6d  ..    c = gf.Com
-00017740: 706f 6e65 6e74 2829 0a20 2020 2063 3120  ponent().    c1 
-00017750: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
-00017760: 656e 7473 2e73 7472 6169 6768 7428 6c65  ents.straight(le
-00017770: 6e67 7468 3d31 2c20 7769 6474 683d 3229  ngth=1, width=2)
-00017780: 0a20 2020 2063 3220 3d20 6320 3c3c 2067  .    c2 = c << g
-00017790: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
-000177a0: 6169 6768 7428 6c65 6e67 7468 3d32 2c20  aight(length=2, 
-000177b0: 7769 6474 683d 3229 0a20 2020 2063 322e  width=2).    c2.
-000177c0: 636f 6e6e 6563 7428 706f 7274 3d22 6f31  connect(port="o1
-000177d0: 222c 2064 6573 7469 6e61 7469 6f6e 3d63  ", destination=c
-000177e0: 312e 706f 7274 735b 226f 3222 5d29 0a20  1.ports["o2"]). 
-000177f0: 2020 2063 2e61 6464 5f70 6f72 7428 226f     c.add_port("o
-00017800: 3122 2c20 706f 7274 3d63 312e 706f 7274  1", port=c1.port
-00017810: 735b 226f 3122 5d29 0a20 2020 2063 2e61  s["o1"]).    c.a
-00017820: 6464 5f70 6f72 7428 226f 3222 2c20 706f  dd_port("o2", po
-00017830: 7274 3d63 322e 706f 7274 735b 226f 3222  rt=c2.ports["o2"
-00017840: 5d29 0a20 2020 206e 6574 6c69 7374 203d  ]).    netlist =
-00017850: 2063 2e67 6574 5f6e 6574 6c69 7374 2829   c.get_netlist()
-00017860: 0a20 2020 2023 2070 7269 6e74 286e 6574  .    # print(net
-00017870: 6c69 7374 2e70 7265 7474 7928 2929 0a20  list.pretty()). 
-00017880: 2020 2061 7373 6572 7420 6c65 6e28 6e65     assert len(ne
-00017890: 746c 6973 745b 2269 6e73 7461 6e63 6573  tlist["instances
-000178a0: 225d 2920 3d3d 2032 0a0a 0a64 6566 2074  "]) == 2...def t
-000178b0: 6573 745f 6e65 746c 6973 745f 7369 6d70  est_netlist_simp
-000178c0: 6c65 5f77 6964 7468 5f6d 6973 6d61 7463  le_width_mismatc
-000178d0: 685f 7468 726f 7773 5f65 7272 6f72 2829  h_throws_error()
-000178e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
-000178f0: 706f 7274 2070 7974 6573 740a 0a20 2020  port pytest..   
-00017900: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
-00017910: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
-00017920: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
-00017930: 0a20 2020 2063 3120 3d20 6320 3c3c 2067  .    c1 = c << g
-00017940: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
-00017950: 6169 6768 7428 6c65 6e67 7468 3d31 2c20  aight(length=1, 
-00017960: 7769 6474 683d 3129 0a20 2020 2063 3220  width=1).    c2 
-00017970: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
-00017980: 656e 7473 2e73 7472 6169 6768 7428 6c65  ents.straight(le
-00017990: 6e67 7468 3d32 2c20 7769 6474 683d 3229  ngth=2, width=2)
-000179a0: 0a20 2020 2063 322e 636f 6e6e 6563 7428  .    c2.connect(
-000179b0: 706f 7274 3d22 6f31 222c 2064 6573 7469  port="o1", desti
-000179c0: 6e61 7469 6f6e 3d63 312e 706f 7274 735b  nation=c1.ports[
-000179d0: 226f 3222 5d29 0a20 2020 2063 2e61 6464  "o2"]).    c.add
-000179e0: 5f70 6f72 7428 226f 3122 2c20 706f 7274  _port("o1", port
-000179f0: 3d63 312e 706f 7274 735b 226f 3122 5d29  =c1.ports["o1"])
-00017a00: 0a20 2020 2063 2e61 6464 5f70 6f72 7428  .    c.add_port(
-00017a10: 226f 3222 2c20 706f 7274 3d63 322e 706f  "o2", port=c2.po
-00017a20: 7274 735b 226f 3222 5d29 0a20 2020 2077  rts["o2"]).    w
-00017a30: 6974 6820 7079 7465 7374 2e72 6169 7365  ith pytest.raise
-00017a40: 7328 5661 6c75 6545 7272 6f72 293a 0a20  s(ValueError):. 
-00017a50: 2020 2020 2020 2063 2e67 6574 5f6e 6574         c.get_net
-00017a60: 6c69 7374 2829 0a0a 0a64 6566 2074 6573  list()...def tes
-00017a70: 745f 6e65 746c 6973 745f 636f 6d70 6c65  t_netlist_comple
-00017a80: 7828 2920 2d3e 204e 6f6e 653a 0a20 2020  x() -> None:.   
-00017a90: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
-00017aa0: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
-00017ab0: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
-00017ac0: 6d7a 695f 6172 6d73 2829 0a20 2020 206e  mzi_arms().    n
-00017ad0: 6574 6c69 7374 203d 2063 2e67 6574 5f6e  etlist = c.get_n
-00017ae0: 6574 6c69 7374 2829 0a20 2020 2023 2070  etlist().    # p
-00017af0: 7269 6e74 286e 6574 6c69 7374 2e70 7265  rint(netlist.pre
-00017b00: 7474 7928 2929 0a20 2020 2061 7373 6572  tty()).    asser
-00017b10: 7420 6c65 6e28 6e65 746c 6973 745b 2269  t len(netlist["i
-00017b20: 6e73 7461 6e63 6573 225d 2920 3d3d 2034  nstances"]) == 4
-00017b30: 2c20 6c65 6e28 6e65 746c 6973 745b 2269  , len(netlist["i
-00017b40: 6e73 7461 6e63 6573 225d 290a 0a0a 6465  nstances"])...de
-00017b50: 6620 7465 7374 5f65 7874 7261 6374 2829  f test_extract()
-00017b60: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
-00017b70: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
-00017b80: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
-00017b90: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
-00017ba0: 732e 7374 7261 6967 6874 280a 2020 2020  s.straight(.    
-00017bb0: 2020 2020 6c65 6e67 7468 3d31 302c 0a20      length=10,. 
-00017bc0: 2020 2020 2020 2077 6964 7468 3d30 2e35         width=0.5
-00017bd0: 2c0a 2020 2020 2020 2020 6262 6f78 5f6c  ,.        bbox_l
-00017be0: 6179 6572 733d 5b67 662e 4c41 5945 522e  ayers=[gf.LAYER.
-00017bf0: 5747 434c 4144 5d2c 0a20 2020 2020 2020  WGCLAD],.       
-00017c00: 2062 626f 785f 6f66 6673 6574 733d 5b33   bbox_offsets=[3
-00017c10: 5d2c 0a20 2020 2020 2020 2077 6974 685f  ],.        with_
-00017c20: 6262 6f78 3d54 7275 652c 0a20 2020 2020  bbox=True,.     
-00017c30: 2020 2063 6c61 6464 696e 675f 6c61 7965     cladding_laye
-00017c40: 7273 3d4e 6f6e 652c 0a20 2020 2020 2020  rs=None,.       
-00017c50: 2061 6464 5f70 696e 733d 4e6f 6e65 2c0a   add_pins=None,.
-00017c60: 2020 2020 2020 2020 6164 645f 6262 6f78          add_bbox
-00017c70: 3d4e 6f6e 652c 0a20 2020 2029 0a20 2020  =None,.    ).   
-00017c80: 2063 3220 3d20 632e 6578 7472 6163 7428   c2 = c.extract(
-00017c90: 6c61 7965 7273 3d5b 6766 2e4c 4159 4552  layers=[gf.LAYER
-00017ca0: 2e57 4743 4c41 445d 290a 0a20 2020 2061  .WGCLAD])..    a
-00017cb0: 7373 6572 7420 6c65 6e28 632e 706f 6c79  ssert len(c.poly
-00017cc0: 676f 6e73 2920 3d3d 2032 2c20 6c65 6e28  gons) == 2, len(
-00017cd0: 632e 706f 6c79 676f 6e73 290a 2020 2020  c.polygons).    
-00017ce0: 6173 7365 7274 206c 656e 2863 322e 706f  assert len(c2.po
-00017cf0: 6c79 676f 6e73 2920 3d3d 2031 2c20 6c65  lygons) == 1, le
-00017d00: 6e28 6332 2e70 6f6c 7967 6f6e 7329 0a20  n(c2.polygons). 
-00017d10: 2020 2061 7373 6572 7420 6766 2e4c 4159     assert gf.LAY
-00017d20: 4552 2e57 4743 4c41 4420 696e 2063 322e  ER.WGCLAD in c2.
-00017d30: 6c61 7965 7273 0a20 2020 2072 6574 7572  layers.    retur
-00017d40: 6e20 6332 0a0a 0a64 6566 2068 6173 685f  n c2...def hash_
-00017d50: 6669 6c65 2866 696c 6570 6174 6829 3a0a  file(filepath):.
-00017d60: 2020 2020 6d64 3520 3d20 6861 7368 6c69      md5 = hashli
-00017d70: 622e 6d64 3528 290a 2020 2020 6d64 352e  b.md5().    md5.
-00017d80: 7570 6461 7465 2866 696c 6570 6174 682e  update(filepath.
-00017d90: 7265 6164 5f62 7974 6573 2829 290a 2020  read_bytes()).  
-00017da0: 2020 7265 7475 726e 206d 6435 2e68 6578    return md5.hex
-00017db0: 6469 6765 7374 2829 0a0a 0a64 6566 2074  digest()...def t
-00017dc0: 6573 745f 6262 6f78 5f72 6566 6572 656e  est_bbox_referen
-00017dd0: 6365 2829 202d 3e20 436f 6d70 6f6e 656e  ce() -> Componen
-00017de0: 743a 0a20 2020 2069 6d70 6f72 7420 6764  t:.    import gd
-00017df0: 7366 6163 746f 7279 2061 7320 6766 0a0a  sfactory as gf..
-00017e00: 2020 2020 6320 3d20 6766 2e43 6f6d 706f      c = gf.Compo
-00017e10: 6e65 6e74 2822 636f 6d70 6f6e 656e 745f  nent("component_
-00017e20: 7769 7468 5f6f 6666 6772 6964 5f70 6f6c  with_offgrid_pol
-00017e30: 7967 6f6e 7322 290a 2020 2020 6331 203d  ygons").    c1 =
-00017e40: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
-00017e50: 6e74 732e 7265 6374 616e 676c 6528 7369  nts.rectangle(si
-00017e60: 7a65 3d28 312e 3565 2d33 2c20 312e 3565  ze=(1.5e-3, 1.5e
-00017e70: 2d33 292c 2070 6f72 745f 7479 7065 3d4e  -3), port_type=N
-00017e80: 6f6e 6529 0a20 2020 2063 3220 3d20 6320  one).    c2 = c 
-00017e90: 3c3c 2067 662e 636f 6d70 6f6e 656e 7473  << gf.components
-00017ea0: 2e72 6563 7461 6e67 6c65 2873 697a 653d  .rectangle(size=
-00017eb0: 2831 2e35 652d 332c 2031 2e35 652d 3329  (1.5e-3, 1.5e-3)
-00017ec0: 2c20 706f 7274 5f74 7970 653d 4e6f 6e65  , port_type=None
-00017ed0: 290a 2020 2020 6332 2e78 6d69 6e20 3d20  ).    c2.xmin = 
-00017ee0: 6331 2e78 6d61 780a 0a20 2020 2061 7373  c1.xmax..    ass
-00017ef0: 6572 7420 6332 2e78 7369 7a65 203d 3d20  ert c2.xsize == 
-00017f00: 3265 2d33 0a20 2020 2072 6574 7572 6e20  2e-3.    return 
-00017f10: 6332 0a0a 0a64 6566 2074 6573 745f 6262  c2...def test_bb
-00017f20: 6f78 5f63 6f6d 706f 6e65 6e74 2829 202d  ox_component() -
-00017f30: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
-00017f40: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-00017f50: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
-00017f60: 636f 6d70 6f6e 656e 7473 2e72 6563 7461  components.recta
-00017f70: 6e67 6c65 2873 697a 653d 2831 2e35 652d  ngle(size=(1.5e-
-00017f80: 332c 2031 2e35 652d 3329 2c20 706f 7274  3, 1.5e-3), port
-00017f90: 5f74 7970 653d 4e6f 6e65 290a 2020 2020  _type=None).    
-00017fa0: 6173 7365 7274 2063 2e78 7369 7a65 203d  assert c.xsize =
-00017fb0: 3d20 3265 2d33 0a0a 0a64 6566 2074 6573  = 2e-3...def tes
-00017fc0: 745f 7265 6d61 705f 6c61 7965 7273 2829  t_remap_layers()
-00017fd0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
-00017fe0: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
-00017ff0: 6173 2067 660a 0a20 2020 2063 203d 2067  as gf..    c = g
-00018000: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
-00018010: 6169 6768 7428 6c61 7965 723d 2832 2c20  aight(layer=(2, 
-00018020: 3029 290a 2020 2020 7265 6d61 7020 3d20  0)).    remap = 
-00018030: 632e 7265 6d61 705f 6c61 7965 7273 286c  c.remap_layers(l
-00018040: 6179 6572 6d61 703d 7b28 322c 2030 293a  ayermap={(2, 0):
-00018050: 2067 662e 4c41 5945 522e 5747 4e7d 290a   gf.LAYER.WGN}).
-00018060: 2020 2020 6861 7368 5f67 656f 6d65 7472      hash_geometr
-00018070: 7920 3d20 2238 3366 6263 3661 3832 3839  y = "83fbc6a8289
-00018080: 3530 3565 6165 6433 6132 6533 6162 3237  505eaed3a2e3ab27
-00018090: 3963 6330 3366 3565 3464 3030 6322 0a0a  9cc03f5e4d00c"..
-000180a0: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
-000180b0: 2020 2020 2072 656d 6170 2e68 6173 685f       remap.hash_
-000180c0: 6765 6f6d 6574 7279 2829 203d 3d20 6861  geometry() == ha
-000180d0: 7368 5f67 656f 6d65 7472 790a 2020 2020  sh_geometry.    
-000180e0: 292c 2066 2268 6173 685f 6765 6f6d 6574  ), f"hash_geomet
-000180f0: 7279 203d 207b 7265 6d61 702e 6861 7368  ry = {remap.hash
-00018100: 5f67 656f 6d65 7472 7928 2921 727d 220a  _geometry()!r}".
-00018110: 0a0a 6465 6620 7465 7374 5f72 656d 6f76  ..def test_remov
-00018120: 655f 6c61 6265 6c73 2829 202d 3e20 4e6f  e_labels() -> No
-00018130: 6e65 3a0a 2020 2020 696d 706f 7274 2067  ne:.    import g
-00018140: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
-00018150: 0a20 2020 2063 203d 2067 662e 632e 7374  .    c = gf.c.st
-00018160: 7261 6967 6874 2829 0a20 2020 2063 2e72  raight().    c.r
-00018170: 656d 6f76 655f 6c61 6265 6c73 2829 0a0a  emove_labels()..
-00018180: 2020 2020 6173 7365 7274 206c 656e 2863      assert len(c
-00018190: 2e6c 6162 656c 7329 203d 3d20 300a 0a0a  .labels) == 0...
-000181a0: 6465 6620 7465 7374 5f69 6d70 6f72 745f  def test_import_
-000181b0: 6764 735f 7365 7474 696e 6773 2829 202d  gds_settings() -
-000181c0: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
-000181d0: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-000181e0: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
-000181f0: 636f 6d70 6f6e 656e 7473 2e6d 7a69 2829  components.mzi()
-00018200: 0a20 2020 2067 6473 7061 7468 203d 2063  .    gdspath = c
-00018210: 2e77 7269 7465 5f67 6473 5f77 6974 685f  .write_gds_with_
-00018220: 6d65 7461 6461 7461 2829 0a20 2020 2063  metadata().    c
-00018230: 3220 3d20 6766 2e69 6d70 6f72 745f 6764  2 = gf.import_gd
-00018240: 7328 6764 7370 6174 682c 206e 616d 653d  s(gdspath, name=
-00018250: 226d 7a69 5f73 616d 706c 6522 2c20 7265  "mzi_sample", re
-00018260: 6164 5f6d 6574 6164 6174 613d 5472 7565  ad_metadata=True
-00018270: 290a 2020 2020 6333 203d 2067 662e 726f  ).    c3 = gf.ro
-00018280: 7574 696e 672e 6164 645f 6669 6265 725f  uting.add_fiber_
-00018290: 7369 6e67 6c65 2863 3229 0a20 2020 2061  single(c2).    a
-000182a0: 7373 6572 7420 6333 0a0a 0a64 6566 2074  ssert c3...def t
-000182b0: 6573 745f 666c 6174 7465 6e5f 696e 7661  est_flatten_inva
-000182c0: 6c69 645f 7265 6673 5f72 6563 7572 7369  lid_refs_recursi
-000182d0: 7665 2829 202d 3e20 4e6f 6e65 3a0a 2020  ve() -> None:.  
-000182e0: 2020 696d 706f 7274 2067 6473 6661 6374    import gdsfact
-000182f0: 6f72 7920 6173 2067 660a 2020 2020 6672  ory as gf.    fr
-00018300: 6f6d 2067 6473 6661 6374 6f72 792e 6469  om gdsfactory.di
-00018310: 6666 7465 7374 2069 6d70 6f72 7420 7275  fftest import ru
-00018320: 6e5f 786f 720a 2020 2020 6672 6f6d 2067  n_xor.    from g
-00018330: 6473 6661 6374 6f72 792e 726f 7574 696e  dsfactory.routin
-00018340: 672e 616c 6c5f 616e 676c 6520 696d 706f  g.all_angle impo
-00018350: 7274 2067 6574 5f62 756e 646c 655f 616c  rt get_bundle_al
-00018360: 6c5f 616e 676c 650a 0a20 2020 2040 6766  l_angle..    @gf
-00018370: 2e63 656c 6c0a 2020 2020 6465 6620 666c  .cell.    def fl
-00018380: 6174 2829 3a0a 2020 2020 2020 2020 6320  at():.        c 
-00018390: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
-000183a0: 0a20 2020 2020 2020 206d 6d69 3120 3d20  .        mmi1 = 
-000183b0: 2863 203c 3c20 6766 2e63 6f6d 706f 6e65  (c << gf.compone
-000183c0: 6e74 732e 6d6d 6931 7832 2829 292e 6d6f  nts.mmi1x2()).mo
-000183d0: 7665 2828 302c 202d 312e 3030 3035 2929  ve((0, -1.0005))
-000183e0: 0a20 2020 2020 2020 206d 6d69 3220 3d20  .        mmi2 = 
-000183f0: 2863 203c 3c20 6766 2e63 6f6d 706f 6e65  (c << gf.compone
-00018400: 6e74 732e 6d6d 6931 7832 2829 292e 726f  nts.mmi1x2()).ro
-00018410: 7461 7465 2838 3029 0a20 2020 2020 2020  tate(80).       
-00018420: 206d 6d69 322e 6d6f 7665 2828 3430 2c20   mmi2.move((40, 
-00018430: 3230 2929 0a20 2020 2020 2020 2062 756e  20)).        bun
-00018440: 646c 6520 3d20 6765 745f 6275 6e64 6c65  dle = get_bundle
-00018450: 5f61 6c6c 5f61 6e67 6c65 285b 6d6d 6931  _all_angle([mmi1
-00018460: 2e70 6f72 7473 5b22 6f32 225d 5d2c 205b  .ports["o2"]], [
-00018470: 6d6d 6932 2e70 6f72 7473 5b22 6f31 225d  mmi2.ports["o1"]
-00018480: 5d29 0a20 2020 2020 2020 2066 6f72 2072  ]).        for r
-00018490: 6f75 7465 2069 6e20 6275 6e64 6c65 3a0a  oute in bundle:.
-000184a0: 2020 2020 2020 2020 2020 2020 632e 6164              c.ad
-000184b0: 6428 726f 7574 652e 7265 6665 7265 6e63  d(route.referenc
-000184c0: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
-000184d0: 726e 2063 0a0a 2020 2020 4067 662e 6365  rn c..    @gf.ce
-000184e0: 6c6c 0a20 2020 2064 6566 2068 6965 7261  ll.    def hiera
-000184f0: 7263 6879 2829 3a0a 2020 2020 2020 2020  rchy():.        
-00018500: 6320 3d20 6766 2e43 6f6d 706f 6e65 6e74  c = gf.Component
-00018510: 2829 0a20 2020 2020 2020 2028 6320 3c3c  ().        (c <<
-00018520: 2066 6c61 7428 2929 2e72 6f74 6174 6528   flat()).rotate(
-00018530: 3333 290a 2020 2020 2020 2020 2863 203c  33).        (c <
-00018540: 3c20 666c 6174 2829 292e 726f 7461 7465  < flat()).rotate
-00018550: 2833 3329 2e6d 6f76 6528 2830 2c20 3130  (33).move((0, 10
-00018560: 3029 290a 2020 2020 2020 2020 2863 203c  0)).        (c <
-00018570: 3c20 666c 6174 2829 292e 6d6f 7665 2828  < flat()).move((
-00018580: 3130 302c 2030 2929 0a20 2020 2020 2020  100, 0)).       
-00018590: 2072 6574 7572 6e20 630a 0a20 2020 2063   return c..    c
-000185a0: 5f6f 7269 6720 3d20 6869 6572 6172 6368  _orig = hierarch
-000185b0: 7928 290a 2020 2020 635f 6e65 7720 3d20  y().    c_new = 
-000185c0: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
-000185d0: 7265 6673 5f72 6563 7572 7369 7665 2863  refs_recursive(c
-000185e0: 5f6f 7269 6729 0a20 2020 2061 7373 6572  _orig).    asser
-000185f0: 7420 635f 6e65 7720 6973 206e 6f74 2063  t c_new is not c
-00018600: 5f6f 7269 670a 2020 2020 696e 7661 6c69  _orig.    invali
-00018610: 645f 7265 6673 5f66 696c 656e 616d 6520  d_refs_filename 
-00018620: 3d20 2269 6e76 616c 6964 5f72 6566 732e  = "invalid_refs.
-00018630: 6764 7322 0a20 2020 2069 6e76 616c 6964  gds".    invalid
-00018640: 5f72 6566 735f 6669 7865 645f 6669 6c65  _refs_fixed_file
-00018650: 6e61 6d65 203d 2022 696e 7661 6c69 645f  name = "invalid_
-00018660: 7265 6673 5f66 6978 6564 2e67 6473 220a  refs_fixed.gds".
-00018670: 2020 2020 2320 6764 7320 6669 6c65 7320      # gds files 
-00018680: 7368 6f75 6c64 2073 7469 6c6c 2062 6520  should still be 
-00018690: 7361 6d65 2074 6f20 316e 6d20 746f 6c65  same to 1nm tole
-000186a0: 7261 6e63 650a 2020 2020 635f 6f72 6967  rance.    c_orig
-000186b0: 2e77 7269 7465 5f67 6473 2869 6e76 616c  .write_gds(inval
-000186c0: 6964 5f72 6566 735f 6669 6c65 6e61 6d65  id_refs_filename
-000186d0: 290a 2020 2020 635f 6e65 772e 7772 6974  ).    c_new.writ
-000186e0: 655f 6764 7328 696e 7661 6c69 645f 7265  e_gds(invalid_re
-000186f0: 6673 5f66 6978 6564 5f66 696c 656e 616d  fs_fixed_filenam
-00018700: 6529 0a20 2020 2072 756e 5f78 6f72 2869  e).    run_xor(i
-00018710: 6e76 616c 6964 5f72 6566 735f 6669 6c65  nvalid_refs_file
-00018720: 6e61 6d65 2c20 696e 7661 6c69 645f 7265  name, invalid_re
-00018730: 6673 5f66 6978 6564 5f66 696c 656e 616d  fs_fixed_filenam
-00018740: 6529 0a0a 0a69 6620 5f5f 6e61 6d65 5f5f  e)...if __name__
-00018750: 203d 3d20 225f 5f6d 6169 6e5f 5f22 3a0a   == "__main__":.
-00018760: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
-00018770: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
-00018780: 2063 203d 2067 662e 436f 6d70 6f6e 656e   c = gf.Componen
-00018790: 7428 290a 2020 2020 7020 3d20 632e 6164  t().    p = c.ad
-000187a0: 645f 706f 6c79 676f 6e28 0a20 2020 2020  d_polygon(.     
-000187b0: 2020 205b 282d 382c 2036 2c20 372c 2039     [(-8, 6, 7, 9
-000187c0: 292c 2028 2d36 2c20 382c 2031 372c 2035  ), (-6, 8, 17, 5
-000187d0: 295d 2c20 6c61 7965 723d 2831 2c20 3029  )], layer=(1, 0)
-000187e0: 0a20 2020 2029 2020 2320 4744 5320 6c61  .    )  # GDS la
-000187f0: 7965 7273 2061 7265 2074 7570 6c65 7320  yers are tuples 
-00018800: 6f66 2069 6e74 7320 2862 7574 2069 6620  of ints (but if 
-00018810: 7765 2075 7365 206f 6e6c 7920 6f6e 6520  we use only one 
-00018820: 6e75 6d62 6572 2069 7420 6173 7375 6d65  number it assume
-00018830: 7320 7468 6520 6f74 6865 7220 6e75 6d62  s the other numb
-00018840: 6572 2069 7320 3029 0a0a 2020 2020 2320  er is 0)..    # 
-00018850: 6332 203d 2067 662e 436f 6d70 6f6e 656e  c2 = gf.Componen
-00018860: 7428 290a 2020 2020 6320 3d20 6766 2e63  t().    c = gf.c
-00018870: 6f6d 706f 6e65 6e74 732e 6d7a 6928 290a  omponents.mzi().
-00018880: 2020 2020 7072 696e 7428 632e 6765 745f      print(c.get_
-00018890: 6c61 7965 725f 6e61 6d65 7328 2929 0a20  layer_names()). 
-000188a0: 2020 2023 2063 203d 2067 662e 636f 6d70     # c = gf.comp
-000188b0: 6f6e 656e 7473 2e6d 7a69 2829 0a20 2020  onents.mzi().   
-000188c0: 2023 2070 7269 6e74 2863 2e67 6574 5f6c   # print(c.get_l
-000188d0: 6179 6572 5f6e 616d 6573 2829 290a 2020  ayer_names()).  
-000188e0: 2020 2320 7220 3d20 632e 7265 6628 290a    # r = c.ref().
-000188f0: 2020 2020 2320 6332 2e63 6f70 795f 6368      # c2.copy_ch
-00018900: 696c 645f 696e 666f 2863 2e6e 616d 6564  ild_info(c.named
-00018910: 5f72 6566 6572 656e 6365 735b 2273 7874  _references["sxt
-00018920: 225d 290a 2020 2020 2320 7465 7374 5f72  "]).    # test_r
-00018930: 656d 6170 5f6c 6179 6572 7328 290a 2020  emap_layers().  
-00018940: 2020 2320 6320 3d20 7465 7374 5f67 6574    # c = test_get
-00018950: 5f6c 6179 6572 7328 290a 2020 2020 2320  _layers().    # 
-00018960: 632e 706c 6f74 5f71 7428 290a 2020 2020  c.plot_qt().    
-00018970: 2320 632e 706c 6f74 6828 290a 2020 2020  # c.ploth().    
-00018980: 2320 6320 3d20 7465 7374 5f65 7874 7261  # c = test_extra
-00018990: 6374 2829 0a20 2020 2023 2067 6473 7061  ct().    # gdspa
-000189a0: 7468 203d 2063 2e77 7269 7465 5f67 6473  th = c.write_gds
-000189b0: 2829 0a20 2020 2023 2067 662e 7368 6f77  ().    # gf.show
-000189c0: 2867 6473 7061 7468 290a 2020 2020 2320  (gdspath).    # 
-000189d0: 632e 7368 6f77 2873 686f 775f 706f 7274  c.show(show_port
-000189e0: 733d 5472 7565 290a 2020 2020 632e 7368  s=True).    c.sh
-000189f0: 6f77 2829 0a                             ow().
+0000e770: 2020 2020 2020 206c 6179 6572 3d70 6f72         layer=por
+0000e780: 745f 6d61 726b 6572 5f6c 6179 6572 2c0a  t_marker_layer,.
+0000e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e7a0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+0000e7b0: 686f 7728 636f 6d70 6f6e 656e 742c 202a  how(component, *
+0000e7c0: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
+0000e7d0: 6620 5f77 7269 7465 5f6c 6962 7261 7279  f _write_library
+0000e7e0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000e7f0: 2020 2020 2020 2020 6764 7370 6174 683a          gdspath:
+0000e800: 204f 7074 696f 6e61 6c5b 5061 7468 5479   Optional[PathTy
+0000e810: 7065 5d20 3d20 4e6f 6e65 2c0a 2020 2020  pe] = None,.    
+0000e820: 2020 2020 6764 7364 6972 3a20 4f70 7469      gdsdir: Opti
+0000e830: 6f6e 616c 5b50 6174 6854 7970 655d 203d  onal[PathType] =
+0000e840: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
+0000e850: 696d 6573 7461 6d70 3a20 4f70 7469 6f6e  imestamp: Option
+0000e860: 616c 5b64 6174 6574 696d 652e 6461 7465  al[datetime.date
+0000e870: 7469 6d65 5d20 3d20 5f74 696d 6573 7461  time] = _timesta
+0000e880: 6d70 3230 3139 2c0a 2020 2020 2020 2020  mp2019,.        
+0000e890: 6c6f 6767 696e 673a 2062 6f6f 6c20 3d20  logging: bool = 
+0000e8a0: 5472 7565 2c0a 2020 2020 2020 2020 7769  True,.        wi
+0000e8b0: 7468 5f6f 6173 6973 3a20 626f 6f6c 203d  th_oasis: bool =
+0000e8c0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+0000e8d0: 7769 7468 5f6d 6574 6164 6174 613a 2062  with_metadata: b
+0000e8e0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0000e8f0: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
+0000e900: 2020 2029 202d 3e20 5061 7468 3a0a 2020     ) -> Path:.  
+0000e910: 2020 2020 2020 2222 2257 7269 7465 2063        """Write c
+0000e920: 6f6d 706f 6e65 6e74 2074 6f20 4744 5320  omponent to GDS 
+0000e930: 6f72 204f 4153 4953 2061 6e64 2072 6574  or OASIS and ret
+0000e940: 7572 6e73 2067 6473 7061 7468 2e0a 0a20  urns gdspath... 
+0000e950: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+0000e960: 2020 2020 2020 2020 2067 6473 7061 7468           gdspath
+0000e970: 3a20 4744 5320 6669 6c65 2070 6174 6820  : GDS file path 
+0000e980: 746f 2077 7269 7465 2074 6f2e 0a20 2020  to write to..   
+0000e990: 2020 2020 2020 2020 2067 6473 6469 723a           gdsdir:
+0000e9a0: 2064 6972 6563 746f 7279 2066 6f72 2074   directory for t
+0000e9b0: 6865 2047 4453 2066 696c 652e 2044 6566  he GDS file. Def
+0000e9c0: 6175 6c74 7320 746f 202f 746d 702f 7261  aults to /tmp/ra
+0000e9d0: 6e64 6f6d 4669 6c65 2f67 6473 6661 6374  ndomFile/gdsfact
+0000e9e0: 6f72 792e 0a20 2020 2020 2020 2020 2020  ory..           
+0000e9f0: 2074 696d 6573 7461 6d70 3a20 4465 6661   timestamp: Defa
+0000ea00: 756c 7473 2074 6f20 3230 3139 2d31 302d  ults to 2019-10-
+0000ea10: 3235 2066 6f72 2063 6f6e 7369 7374 656e  25 for consisten
+0000ea20: 7420 6861 7368 2e0a 2020 2020 2020 2020  t hash..        
+0000ea30: 2020 2020 2020 2020 4966 204e 6f6e 6520          If None 
+0000ea40: 7573 6573 2063 7572 7265 6e74 2074 696d  uses current tim
+0000ea50: 652e 0a20 2020 2020 2020 2020 2020 206c  e..            l
+0000ea60: 6f67 6769 6e67 3a20 6469 7361 626c 6520  ogging: disable 
+0000ea70: 4744 5320 7061 7468 206c 6f67 6769 6e67  GDS path logging
+0000ea80: 2c20 666f 7220 6578 616d 706c 6520 666f  , for example fo
+0000ea90: 7220 7368 6f77 696e 6720 6974 2069 6e20  r showing it in 
+0000eaa0: 4b4c 6179 6f75 742e 0a20 2020 2020 2020  KLayout..       
+0000eab0: 2020 2020 2077 6974 685f 6f61 7369 733a       with_oasis:
+0000eac0: 2049 6620 5472 7565 2c20 6669 6c65 2077   If True, file w
+0000ead0: 696c 6c20 6265 2077 7269 7474 656e 2074  ill be written t
+0000eae0: 6f20 4f41 5349 532e 204f 7468 6572 7769  o OASIS. Otherwi
+0000eaf0: 7365 2c20 6669 6c65 2077 696c 6c20 6265  se, file will be
+0000eb00: 2077 7269 7474 656e 2074 6f20 4744 532e   written to GDS.
+0000eb10: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0000eb20: 685f 6d65 7461 6461 7461 3a20 7772 6974  h_metadata: writ
+0000eb30: 6573 206d 6574 6164 6174 6120 696e 2059  es metadata in Y
+0000eb40: 414d 4c20 666f 726d 6174 2e0a 0a20 2020  AML format...   
+0000eb50: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
+0000eb60: 733a 0a20 2020 2020 2020 2020 2020 204b  s:.            K
+0000eb70: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+0000eb80: 2077 696c 6c20 6f76 6572 7269 6465 2074   will override t
+0000eb90: 6865 2061 6374 6976 6520 5044 4b27 7320  he active PDK's 
+0000eba0: 6465 6661 756c 7420 4764 7357 7269 7465  default GdsWrite
+0000ebb0: 5365 7474 696e 6773 2061 6e64 204f 6173  Settings and Oas
+0000ebc0: 6973 5772 6974 6553 6574 7469 6e67 732e  isWriteSettings.
+0000ebd0: 0a0a 2020 2020 2020 2020 2020 2020 4764  ..            Gd
+0000ebe0: 7320 7365 7474 696e 6773 3a0a 2020 2020  s settings:.    
+0000ebf0: 2020 2020 2020 2020 2020 2020 756e 6974              unit
+0000ec00: 3a20 756e 6974 2073 697a 6520 666f 7220  : unit size for 
+0000ec10: 6f62 6a65 6374 7320 696e 206c 6962 7261  objects in libra
+0000ec20: 7279 2e20 3175 6d20 6279 2064 6566 6175  ry. 1um by defau
+0000ec30: 6c74 2e0a 2020 2020 2020 2020 2020 2020  lt..            
+0000ec40: 2020 2020 7072 6563 6973 696f 6e3a 2066      precision: f
+0000ec50: 6f72 2064 696d 656e 7369 6f6e 7320 696e  or dimensions in
+0000ec60: 2074 6865 206c 6962 7261 7279 2028 6d29   the library (m)
+0000ec70: 2e20 316e 6d20 6279 2064 6566 6175 6c74  . 1nm by default
+0000ec80: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ec90: 2020 6f6e 5f64 7570 6c69 6361 7465 5f63    on_duplicate_c
+0000eca0: 656c 6c3a 2073 7065 6369 6679 2068 6f77  ell: specify how
+0000ecb0: 2074 6f20 7265 736f 6c76 6520 6475 706c   to resolve dupl
+0000ecc0: 6963 6174 652d 6e61 6d65 6420 6365 6c6c  icate-named cell
+0000ecd0: 732e 2043 686f 6f73 6520 6f6e 6520 6f66  s. Choose one of
+0000ece0: 2074 6865 2066 6f6c 6c6f 7769 6e67 3a0a   the following:.
+0000ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed00: 2020 2020 2277 6172 6e22 2028 6465 6661      "warn" (defa
+0000ed10: 756c 7429 3a20 6f76 6572 7772 6974 6520  ult): overwrite 
+0000ed20: 616c 6c20 6475 706c 6963 6174 6520 6365  all duplicate ce
+0000ed30: 6c6c 7320 7769 7468 206f 6e65 206f 6620  lls with one of 
+0000ed40: 7468 6520 6475 706c 6963 6174 6573 2028  the duplicates (
+0000ed50: 6172 6269 7472 6172 696c 7929 2e0a 2020  arbitrarily)..  
+0000ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed70: 2020 2265 7272 6f72 223a 2074 6872 6f77    "error": throw
+0000ed80: 2061 2056 616c 7565 4572 726f 7220 7768   a ValueError wh
+0000ed90: 656e 2061 7474 656d 7074 696e 6720 746f  en attempting to
+0000eda0: 2077 7269 7465 2061 2067 6473 2077 6974   write a gds wit
+0000edb0: 6820 6475 706c 6963 6174 6520 6365 6c6c  h duplicate cell
+0000edc0: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+0000edd0: 2020 2020 2020 2022 6f76 6572 7772 6974         "overwrit
+0000ede0: 6522 3a20 6f76 6572 7772 6974 6520 616c  e": overwrite al
+0000edf0: 6c20 6475 706c 6963 6174 6520 6365 6c6c  l duplicate cell
+0000ee00: 7320 7769 7468 206f 6e65 206f 6620 7468  s with one of th
+0000ee10: 6520 6475 706c 6963 6174 6573 2c20 7769  e duplicates, wi
+0000ee20: 7468 6f75 7420 7761 726e 696e 672e 0a20  thout warning.. 
+0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee40: 2020 204e 6f6e 653a 2064 6f20 6e6f 7420     None: do not 
+0000ee50: 7472 7920 746f 2072 6573 6f6c 7665 2028  try to resolve (
+0000ee60: 6174 2079 6f75 7220 6f77 6e20 7269 736b  at your own risk
+0000ee70: 2129 0a20 2020 2020 2020 2020 2020 2020  !).             
+0000ee80: 2020 2066 6c61 7474 656e 5f69 6e76 616c     flatten_inval
+0000ee90: 6964 5f72 6566 733a 2066 6c61 7474 656e  id_refs: flatten
+0000eea0: 7320 636f 6d70 6f6e 656e 7420 7265 6665  s component refe
+0000eeb0: 7265 6e63 6573 2077 6869 6368 2068 6176  rences which hav
+0000eec0: 6520 696e 7661 6c69 6420 7472 616e 7366  e invalid transf
+0000eed0: 6f72 6d61 7469 6f6e 732e 0a20 2020 2020  ormations..     
+0000eee0: 2020 2020 2020 2020 2020 206d 6178 5f70             max_p
+0000eef0: 6f69 6e74 733a 204d 6178 696d 616c 206e  oints: Maximal n
+0000ef00: 756d 6265 7220 6f66 2076 6572 7469 6365  umber of vertice
+0000ef10: 7320 7065 7220 706f 6c79 676f 6e2e 2050  s per polygon. P
+0000ef20: 6f6c 7967 6f6e 7320 7769 7468 206d 6f72  olygons with mor
+0000ef30: 6520 7665 7274 6963 6573 2074 6861 7420  e vertices that 
+0000ef40: 7468 6973 2061 7265 2061 7574 6f6d 6174  this are automat
+0000ef50: 6963 616c 6c79 2066 7261 6374 7572 6564  ically fractured
+0000ef60: 2e0a 0a20 2020 2020 2020 2020 2020 204f  ...            O
+0000ef70: 6173 6973 2073 6574 7469 6e67 733a 0a20  asis settings:. 
+0000ef80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000ef90: 6f6d 7072 6573 7369 6f6e 5f6c 6576 656c  ompression_level
+0000efa0: 3a20 4c65 7665 6c20 6f66 2063 6f6d 7072  : Level of compr
+0000efb0: 6573 7369 6f6e 2066 6f72 2063 656c 6c73  ession for cells
+0000efc0: 2028 6265 7477 6565 6e20 3020 616e 6420   (between 0 and 
+0000efd0: 3929 2e0a 2020 2020 2020 2020 2020 2020  9)..            
+0000efe0: 2020 2020 2020 2020 5365 7474 696e 6720          Setting 
+0000eff0: 746f 2030 2077 696c 6c20 6469 7361 626c  to 0 will disabl
+0000f000: 6520 6365 6c6c 2063 6f6d 7072 6573 7369  e cell compressi
+0000f010: 6f6e 2c20 3120 6769 7665 7320 7468 6520  on, 1 gives the 
+0000f020: 6265 7374 2073 7065 6564 2061 6e64 2039  best speed and 9
+0000f030: 2c20 7468 6520 6265 7374 2063 6f6d 7072  , the best compr
+0000f040: 6573 7369 6f6e 2e0a 2020 2020 2020 2020  ession..        
+0000f050: 2020 2020 2020 2020 6465 7465 6374 5f72          detect_r
+0000f060: 6563 7461 6e67 6c65 733a 2053 746f 7265  ectangles: Store
+0000f070: 2072 6563 7461 6e67 6c65 7320 696e 2063   rectangles in c
+0000f080: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
+0000f090: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f0a0: 2020 6465 7465 6374 5f74 7261 7065 7a6f    detect_trapezo
+0000f0b0: 6964 733a 2053 746f 7265 2074 7261 7065  ids: Store trape
+0000f0c0: 7a6f 6964 7320 696e 2063 6f6d 7072 6573  zoids in compres
+0000f0d0: 7365 6420 666f 726d 6174 2e0a 2020 2020  sed format..    
+0000f0e0: 2020 2020 2020 2020 2020 2020 6369 7263              circ
+0000f0f0: 6c65 5f74 6f6c 6572 616e 6365 3a20 546f  le_tolerance: To
+0000f100: 6c65 7261 6e63 6520 666f 7220 6465 7465  lerance for dete
+0000f110: 6374 696e 6720 6369 7263 6c65 732e 2049  cting circles. I
+0000f120: 6620 6c65 7373 206f 7220 6571 7561 6c20  f less or equal 
+0000f130: 746f 2030 2c20 6e6f 2064 6574 6563 7469  to 0, no detecti
+0000f140: 6f6e 2069 7320 7065 7266 6f72 6d65 642e  on is performed.
+0000f150: 2043 6972 636c 6573 2061 7265 2073 746f   Circles are sto
+0000f160: 7265 6420 696e 2063 6f6d 7072 6573 7365  red in compresse
+0000f170: 6420 666f 726d 6174 2e0a 2020 2020 2020  d format..      
+0000f180: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
+0000f190: 7469 6f6e 2028 2263 7263 3332 222c 2022  tion ("crc32", "
+0000f1a0: 6368 6563 6b73 756d 3332 222c 204e 6f6e  checksum32", Non
+0000f1b0: 6529 3a20 7479 7065 206f 6620 7661 6c69  e): type of vali
+0000f1c0: 6461 7469 6f6e 2074 6f20 696e 636c 7564  dation to includ
+0000f1d0: 6520 696e 2074 6865 2073 6176 6564 2066  e in the saved f
+0000f1e0: 696c 652e 0a20 2020 2020 2020 2020 2020  ile..           
+0000f1f0: 2020 2020 2073 7461 6e64 6172 645f 7072       standard_pr
+0000f200: 6f70 6572 7469 6573 3a20 5374 6f72 6520  operties: Store 
+0000f210: 7374 616e 6461 7264 204f 4153 4953 2070  standard OASIS p
+0000f220: 726f 7065 7274 6965 7320 696e 2074 6865  roperties in the
+0000f230: 2066 696c 652e 0a0a 2020 2020 2020 2020   file...        
+0000f240: 2222 220a 0a20 2020 2020 2020 2066 726f  """..        fro
+0000f250: 6d20 6764 7366 6163 746f 7279 2e70 646b  m gdsfactory.pdk
+0000f260: 2069 6d70 6f72 7420 6765 745f 6163 7469   import get_acti
+0000f270: 7665 5f70 646b 0a0a 2020 2020 2020 2020  ve_pdk..        
+0000f280: 6966 2067 6473 7061 7468 2061 6e64 2067  if gdspath and g
+0000f290: 6473 6469 723a 0a20 2020 2020 2020 2020  dsdir:.         
+0000f2a0: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+0000f2b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000f2c0: 2020 2267 6473 7061 7468 2061 6e64 2067    "gdspath and g
+0000f2d0: 6473 6469 7220 6861 7665 2062 6f74 6820  dsdir have both 
+0000f2e0: 6265 656e 2073 7065 6369 6669 6564 2e20  been specified. 
+0000f2f0: 6764 7370 6174 6820 7769 6c6c 2074 616b  gdspath will tak
+0000f300: 6520 7072 6563 6564 656e 6365 2061 6e64  e precedence and
+0000f310: 2067 6473 6469 7220 7769 6c6c 2062 6520   gdsdir will be 
+0000f320: 6967 6e6f 7265 642e 222c 0a20 2020 2020  ignored.",.     
+0000f330: 2020 2020 2020 2020 2020 2073 7461 636b             stack
+0000f340: 6c65 7665 6c3d 332c 0a20 2020 2020 2020  level=3,.       
+0000f350: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000f360: 6465 6661 756c 745f 7365 7474 696e 6773  default_settings
+0000f370: 203d 2067 6574 5f61 6374 6976 655f 7064   = get_active_pd
+0000f380: 6b28 292e 6764 735f 7772 6974 655f 7365  k().gds_write_se
+0000f390: 7474 696e 6773 0a20 2020 2020 2020 2064  ttings.        d
+0000f3a0: 6566 6175 6c74 5f6f 6173 6973 5f73 6574  efault_oasis_set
+0000f3b0: 7469 6e67 7320 3d20 6765 745f 6163 7469  tings = get_acti
+0000f3c0: 7665 5f70 646b 2829 2e6f 6173 6973 5f73  ve_pdk().oasis_s
+0000f3d0: 6574 7469 6e67 730a 0a20 2020 2020 2020  ettings..       
+0000f3e0: 2065 7870 6c69 6369 745f 6764 735f 7365   explicit_gds_se
+0000f3f0: 7474 696e 6773 203d 207b 0a20 2020 2020  ttings = {.     
+0000f400: 2020 2020 2020 206b 3a20 760a 2020 2020         k: v.    
+0000f410: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+0000f420: 2069 6e20 6b77 6172 6773 2e69 7465 6d73   in kwargs.items
+0000f430: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
+0000f440: 6620 7620 6973 206e 6f74 204e 6f6e 6520  f v is not None 
+0000f450: 616e 6420 6b20 696e 2064 6566 6175 6c74  and k in default
+0000f460: 5f73 6574 7469 6e67 732e 6469 6374 2829  _settings.dict()
+0000f470: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+0000f480: 2020 2065 7870 6c69 6369 745f 6f61 735f     explicit_oas_
+0000f490: 7365 7474 696e 6773 203d 207b 0a20 2020  settings = {.   
+0000f4a0: 2020 2020 2020 2020 206b 3a20 760a 2020           k: v.  
+0000f4b0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
+0000f4c0: 2076 2069 6e20 6b77 6172 6773 2e69 7465   v in kwargs.ite
+0000f4d0: 6d73 2829 0a20 2020 2020 2020 2020 2020  ms().           
+0000f4e0: 2069 6620 7620 6973 206e 6f74 204e 6f6e   if v is not Non
+0000f4f0: 6520 616e 6420 6b20 696e 2064 6566 6175  e and k in defau
+0000f500: 6c74 5f6f 6173 6973 5f73 6574 7469 6e67  lt_oasis_setting
+0000f510: 732e 6469 6374 2829 0a20 2020 2020 2020  s.dict().       
+0000f520: 207d 0a20 2020 2020 2020 2023 2075 7064   }.        # upd
+0000f530: 6174 6520 7468 6520 7772 6974 6520 7365  ate the write se
+0000f540: 7474 696e 6773 2077 6974 6820 616e 7920  ttings with any 
+0000f550: 7365 7474 696e 6773 2065 7870 6c69 6369  settings explici
+0000f560: 746c 7920 7061 7373 6564 0a20 2020 2020  tly passed.     
+0000f570: 2020 2077 7269 7465 5f73 6574 7469 6e67     write_setting
+0000f580: 7320 3d20 6465 6661 756c 745f 7365 7474  s = default_sett
+0000f590: 696e 6773 2e63 6f70 7928 7570 6461 7465  ings.copy(update
+0000f5a0: 3d65 7870 6c69 6369 745f 6764 735f 7365  =explicit_gds_se
+0000f5b0: 7474 696e 6773 290a 2020 2020 2020 2020  ttings).        
+0000f5c0: 6f61 7369 735f 7365 7474 696e 6773 203d  oasis_settings =
+0000f5d0: 2064 6566 6175 6c74 5f6f 6173 6973 5f73   default_oasis_s
+0000f5e0: 6574 7469 6e67 732e 636f 7079 2875 7064  ettings.copy(upd
+0000f5f0: 6174 653d 6578 706c 6963 6974 5f6f 6173  ate=explicit_oas
+0000f600: 5f73 6574 7469 6e67 7329 0a0a 2020 2020  _settings)..    
+0000f610: 2020 2020 5f63 6865 636b 5f75 6e63 6163      _check_uncac
+0000f620: 6865 645f 636f 6d70 6f6e 656e 7473 280a  hed_components(.
+0000f630: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+0000f640: 6f6e 656e 743d 7365 6c66 2c20 6d6f 6465  onent=self, mode
+0000f650: 3d77 7269 7465 5f73 6574 7469 6e67 732e  =write_settings.
+0000f660: 6f6e 5f75 6e63 6163 6865 645f 636f 6d70  on_uncached_comp
+0000f670: 6f6e 656e 740a 2020 2020 2020 2020 290a  onent.        ).
+0000f680: 0a20 2020 2020 2020 2069 6620 7772 6974  .        if writ
+0000f690: 655f 7365 7474 696e 6773 2e66 6c61 7474  e_settings.flatt
+0000f6a0: 656e 5f69 6e76 616c 6964 5f72 6566 733a  en_invalid_refs:
+0000f6b0: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
+0000f6c0: 5f63 656c 6c20 3d20 666c 6174 7465 6e5f  _cell = flatten_
+0000f6d0: 696e 7661 6c69 645f 7265 6673 5f72 6563  invalid_refs_rec
+0000f6e0: 7572 7369 7665 2873 656c 6629 0a20 2020  ursive(self).   
+0000f6f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000f700: 2020 2020 2020 2074 6f70 5f63 656c 6c20         top_cell 
+0000f710: 3d20 7365 6c66 0a0a 2020 2020 2020 2020  = self..        
+0000f720: 6764 7364 6972 203d 2067 6473 6469 7220  gdsdir = gdsdir 
+0000f730: 6f72 2047 4453 4449 525f 5445 4d50 0a20  or GDSDIR_TEMP. 
+0000f740: 2020 2020 2020 2067 6473 6469 7220 3d20         gdsdir = 
+0000f750: 7061 7468 6c69 622e 5061 7468 2867 6473  pathlib.Path(gds
+0000f760: 6469 7229 0a20 2020 2020 2020 2069 6620  dir).        if 
+0000f770: 7769 7468 5f6f 6173 6973 3a0a 2020 2020  with_oasis:.    
+0000f780: 2020 2020 2020 2020 6764 7370 6174 6820          gdspath 
+0000f790: 3d20 6764 7370 6174 6820 6f72 2067 6473  = gdspath or gds
+0000f7a0: 6469 7220 2f20 6622 7b74 6f70 5f63 656c  dir / f"{top_cel
+0000f7b0: 6c2e 6e61 6d65 7d2e 6f61 7322 0a20 2020  l.name}.oas".   
+0000f7c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000f7d0: 2020 2020 2020 2067 6473 7061 7468 203d         gdspath =
+0000f7e0: 2067 6473 7061 7468 206f 7220 6764 7364   gdspath or gdsd
+0000f7f0: 6972 202f 2066 227b 746f 705f 6365 6c6c  ir / f"{top_cell
+0000f800: 2e6e 616d 657d 2e67 6473 220a 2020 2020  .name}.gds".    
+0000f810: 2020 2020 6764 7370 6174 6820 3d20 7061      gdspath = pa
+0000f820: 7468 6c69 622e 5061 7468 2867 6473 7061  thlib.Path(gdspa
+0000f830: 7468 290a 2020 2020 2020 2020 6764 7364  th).        gdsd
+0000f840: 6972 203d 2067 6473 7061 7468 2e70 6172  ir = gdspath.par
+0000f850: 656e 740a 2020 2020 2020 2020 6764 7364  ent.        gdsd
+0000f860: 6972 2e6d 6b64 6972 2865 7869 7374 5f6f  ir.mkdir(exist_o
+0000f870: 6b3d 5472 7565 2c20 7061 7265 6e74 733d  k=True, parents=
+0000f880: 5472 7565 290a 0a20 2020 2020 2020 2063  True)..        c
+0000f890: 656c 6c73 203d 2074 6f70 5f63 656c 6c2e  ells = top_cell.
+0000f8a0: 6765 745f 6465 7065 6e64 656e 6369 6573  get_dependencies
+0000f8b0: 2872 6563 7572 7369 7665 3d54 7275 6529  (recursive=True)
+0000f8c0: 0a20 2020 2020 2020 2063 656c 6c5f 6e61  .        cell_na
+0000f8d0: 6d65 7320 3d20 5b63 656c 6c2e 6e61 6d65  mes = [cell.name
+0000f8e0: 2066 6f72 2063 656c 6c20 696e 206c 6973   for cell in lis
+0000f8f0: 7428 6365 6c6c 7329 5d0a 2020 2020 2020  t(cells)].      
+0000f900: 2020 6365 6c6c 5f6e 616d 6573 5f75 6e69    cell_names_uni
+0000f910: 7175 6520 3d20 7365 7428 6365 6c6c 5f6e  que = set(cell_n
+0000f920: 616d 6573 290a 0a20 2020 2020 2020 2069  ames)..        i
+0000f930: 6620 6c65 6e28 6365 6c6c 5f6e 616d 6573  f len(cell_names
+0000f940: 2920 213d 206c 656e 2873 6574 2863 656c  ) != len(set(cel
+0000f950: 6c5f 6e61 6d65 7329 293a 0a20 2020 2020  l_names)):.     
+0000f960: 2020 2020 2020 2066 6f72 2063 656c 6c5f         for cell_
+0000f970: 6e61 6d65 2069 6e20 6365 6c6c 5f6e 616d  name in cell_nam
+0000f980: 6573 5f75 6e69 7175 653a 0a20 2020 2020  es_unique:.     
+0000f990: 2020 2020 2020 2020 2020 2063 656c 6c5f             cell_
+0000f9a0: 6e61 6d65 732e 7265 6d6f 7665 2863 656c  names.remove(cel
+0000f9b0: 6c5f 6e61 6d65 290a 0a20 2020 2020 2020  l_name)..       
+0000f9c0: 2020 2020 2069 6620 7772 6974 655f 7365       if write_se
+0000f9d0: 7474 696e 6773 2e6f 6e5f 6475 706c 6963  ttings.on_duplic
+0000f9e0: 6174 655f 6365 6c6c 203d 3d20 2265 7272  ate_cell == "err
+0000f9f0: 6f72 223a 0a20 2020 2020 2020 2020 2020  or":.           
+0000fa00: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000fa10: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0000fa20: 2020 2020 2020 2020 2020 2066 2244 7570             f"Dup
+0000fa30: 6c69 6361 7465 6420 6365 6c6c 206e 616d  licated cell nam
+0000fa40: 6573 2069 6e20 7b74 6f70 5f63 656c 6c2e  es in {top_cell.
+0000fa50: 6e61 6d65 2172 7d3a 207b 6365 6c6c 5f6e  name!r}: {cell_n
+0000fa60: 616d 6573 2172 7d22 0a20 2020 2020 2020  ames!r}".       
+0000fa70: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000fa80: 2020 2020 2020 2065 6c69 6620 7772 6974         elif writ
+0000fa90: 655f 7365 7474 696e 6773 2e6f 6e5f 6475  e_settings.on_du
+0000faa0: 706c 6963 6174 655f 6365 6c6c 2069 6e20  plicate_cell in 
+0000fab0: 7b22 7761 726e 222c 2022 6f76 6572 7772  {"warn", "overwr
+0000fac0: 6974 6522 7d3a 0a20 2020 2020 2020 2020  ite"}:.         
+0000fad0: 2020 2020 2020 2069 6620 7772 6974 655f         if write_
+0000fae0: 7365 7474 696e 6773 2e6f 6e5f 6475 706c  settings.on_dupl
+0000faf0: 6963 6174 655f 6365 6c6c 203d 3d20 2277  icate_cell == "w
+0000fb00: 6172 6e22 3a0a 2020 2020 2020 2020 2020  arn":.          
+0000fb10: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+0000fb20: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
+0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb40: 2066 2244 7570 6c69 6361 7465 6420 6365   f"Duplicated ce
+0000fb50: 6c6c 206e 616d 6573 2069 6e20 7b74 6f70  ll names in {top
+0000fb60: 5f63 656c 6c2e 6e61 6d65 2172 7d3a 2020  _cell.name!r}:  
+0000fb70: 7b63 656c 6c5f 6e61 6d65 737d 222c 0a20  {cell_names}",. 
+0000fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb90: 2020 2020 2020 2073 7461 636b 6c65 7665         stackleve
+0000fba0: 6c3d 332c 0a20 2020 2020 2020 2020 2020  l=3,.           
+0000fbb0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000fbc0: 2020 2020 2020 2020 2020 2063 656c 6c73             cells
+0000fbd0: 5f64 6963 7420 3d20 7b63 656c 6c2e 6e61  _dict = {cell.na
+0000fbe0: 6d65 3a20 6365 6c6c 2e5f 6365 6c6c 2066  me: cell._cell f
+0000fbf0: 6f72 2063 656c 6c20 696e 2063 656c 6c73  or cell in cells
+0000fc00: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0000fc10: 2020 6365 6c6c 7320 3d20 6365 6c6c 735f    cells = cells_
+0000fc20: 6469 6374 2e76 616c 7565 7328 290a 2020  dict.values().  
+0000fc30: 2020 2020 2020 2020 2020 656c 6966 2077            elif w
+0000fc40: 7269 7465 5f73 6574 7469 6e67 732e 6f6e  rite_settings.on
+0000fc50: 5f64 7570 6c69 6361 7465 5f63 656c 6c20  _duplicate_cell 
+0000fc60: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000fc70: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000fc80: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+0000fc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fca0: 2020 2066 226f 6e5f 6475 706c 6963 6174     f"on_duplicat
+0000fcb0: 655f 6365 6c6c 3a20 7b77 7269 7465 5f73  e_cell: {write_s
+0000fcc0: 6574 7469 6e67 732e 6f6e 5f64 7570 6c69  ettings.on_dupli
+0000fcd0: 6361 7465 5f63 656c 6c21 727d 206e 6f74  cate_cell!r} not
+0000fce0: 2069 6e20 284e 6f6e 652c 2077 6172 6e2c   in (None, warn,
+0000fcf0: 2065 7272 6f72 2c20 6f76 6572 7772 6974   error, overwrit
+0000fd00: 6529 220a 2020 2020 2020 2020 2020 2020  e)".            
+0000fd10: 2020 2020 290a 0a20 2020 2020 2020 2061      )..        a
+0000fd20: 6c6c 5f63 656c 6c73 203d 205b 746f 705f  ll_cells = [top_
+0000fd30: 6365 6c6c 2e5f 6365 6c6c 5d20 2b20 736f  cell._cell] + so
+0000fd40: 7274 6564 2863 656c 6c73 2c20 6b65 793d  rted(cells, key=
+0000fd50: 6c61 6d62 6461 2063 633a 2063 632e 6e61  lambda cc: cc.na
+0000fd60: 6d65 290a 0a20 2020 2020 2020 206e 6f5f  me)..        no_
+0000fd70: 6e61 6d65 5f63 656c 6c73 203d 205b 0a20  name_cells = [. 
+0000fd80: 2020 2020 2020 2020 2020 2063 656c 6c2e             cell.
+0000fd90: 6e61 6d65 2066 6f72 2063 656c 6c20 696e  name for cell in
+0000fda0: 2061 6c6c 5f63 656c 6c73 2069 6620 6365   all_cells if ce
+0000fdb0: 6c6c 2e6e 616d 652e 7374 6172 7473 7769  ll.name.startswi
+0000fdc0: 7468 2822 556e 6e61 6d65 6422 290a 2020  th("Unnamed").  
+0000fdd0: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+0000fde0: 2069 6620 6e6f 5f6e 616d 655f 6365 6c6c   if no_name_cell
+0000fdf0: 733a 0a20 2020 2020 2020 2020 2020 2077  s:.            w
+0000fe00: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
+0000fe10: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0000fe20: 436f 6d70 6f6e 656e 7420 7b74 6f70 5f63  Component {top_c
+0000fe30: 656c 6c2e 6e61 6d65 2172 7d20 636f 6e74  ell.name!r} cont
+0000fe40: 6169 6e73 207b 6c65 6e28 6e6f 5f6e 616d  ains {len(no_nam
+0000fe50: 655f 6365 6c6c 7329 7d20 556e 6e61 6d65  e_cells)} Unname
+0000fe60: 6420 6365 6c6c 7322 2c0a 2020 2020 2020  d cells",.      
+0000fe70: 2020 2020 2020 2020 2020 7374 6163 6b6c            stackl
+0000fe80: 6576 656c 3d33 2c0a 2020 2020 2020 2020  evel=3,.        
+0000fe90: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+0000fea0: 2066 6f72 2063 656c 6c20 696e 2061 6c6c   for cell in all
+0000feb0: 5f63 656c 6c73 3a0a 2020 2020 2020 2020  _cells:.        
+0000fec0: 2320 2020 2020 7072 696e 7428 6365 6c6c  #     print(cell
+0000fed0: 2e6e 616d 652c 2074 7970 6528 6365 6c6c  .name, type(cell
+0000fee0: 2929 0a0a 2020 2020 2020 2020 6c69 6220  ))..        lib 
+0000fef0: 3d20 6764 7374 6b2e 4c69 6272 6172 7928  = gdstk.Library(
+0000ff00: 0a20 2020 2020 2020 2020 2020 2075 6e69  .            uni
+0000ff10: 743d 7772 6974 655f 7365 7474 696e 6773  t=write_settings
+0000ff20: 2e75 6e69 742c 2070 7265 6369 7369 6f6e  .unit, precision
+0000ff30: 3d77 7269 7465 5f73 6574 7469 6e67 732e  =write_settings.
+0000ff40: 7072 6563 6973 696f 6e0a 2020 2020 2020  precision.      
+0000ff50: 2020 290a 2020 2020 2020 2020 6c69 622e    ).        lib.
+0000ff60: 6164 6428 746f 705f 6365 6c6c 2e5f 6365  add(top_cell._ce
+0000ff70: 6c6c 290a 2020 2020 2020 2020 6c69 622e  ll).        lib.
+0000ff80: 6164 6428 2a74 6f70 5f63 656c 6c2e 5f63  add(*top_cell._c
+0000ff90: 656c 6c2e 6465 7065 6e64 656e 6369 6573  ell.dependencies
+0000ffa0: 2854 7275 6529 290a 0a20 2020 2020 2020  (True))..       
+0000ffb0: 2069 6620 7769 7468 5f6f 6173 6973 3a0a   if with_oasis:.
+0000ffc0: 2020 2020 2020 2020 2020 2020 6c69 622e              lib.
+0000ffd0: 7772 6974 655f 6f61 7328 6764 7370 6174  write_oas(gdspat
+0000ffe0: 682c 202a 2a6f 6173 6973 5f73 6574 7469  h, **oasis_setti
+0000fff0: 6e67 732e 6469 6374 2829 290a 2020 2020  ngs.dict()).    
+00010000: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00010010: 2020 2020 2020 6c69 622e 7772 6974 655f        lib.write_
+00010020: 6764 7328 0a20 2020 2020 2020 2020 2020  gds(.           
+00010030: 2020 2020 2067 6473 7061 7468 2c20 7469       gdspath, ti
+00010040: 6d65 7374 616d 703d 7469 6d65 7374 616d  mestamp=timestam
+00010050: 702c 206d 6178 5f70 6f69 6e74 733d 7772  p, max_points=wr
+00010060: 6974 655f 7365 7474 696e 6773 2e6d 6178  ite_settings.max
+00010070: 5f70 6f69 6e74 730a 2020 2020 2020 2020  _points.        
+00010080: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+00010090: 206c 6f67 6769 6e67 3a0a 2020 2020 2020   logging:.      
+000100a0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+000100b0: 6f28 6622 5772 6f74 6520 746f 207b 7374  o(f"Wrote to {st
+000100c0: 7228 6764 7370 6174 6829 2172 7d22 290a  r(gdspath)!r}").
+000100d0: 2020 2020 2020 2020 6966 2077 6974 685f          if with_
+000100e0: 6d65 7461 6461 7461 3a0a 2020 2020 2020  metadata:.      
+000100f0: 2020 2020 2020 6d65 7461 6461 7461 203d        metadata =
+00010100: 2067 6473 7061 7468 2e77 6974 685f 7375   gdspath.with_su
+00010110: 6666 6978 2822 2e79 6d6c 2229 0a20 2020  ffix(".yml").   
+00010120: 2020 2020 2020 2020 206d 6574 6164 6174           metadat
+00010130: 612e 7772 6974 655f 7465 7874 2873 656c  a.write_text(sel
+00010140: 662e 746f 5f79 616d 6c28 7769 7468 5f63  f.to_yaml(with_c
+00010150: 656c 6c73 3d54 7275 652c 2077 6974 685f  ells=True, with_
+00010160: 706f 7274 733d 5472 7565 2929 0a20 2020  ports=True)).   
+00010170: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00010180: 696e 666f 2866 2257 7269 7465 2059 414d  info(f"Write YAM
+00010190: 4c20 6d65 7461 6461 7461 2074 6f20 7b73  L metadata to {s
+000101a0: 7472 286d 6574 6164 6174 6129 2172 7d22  tr(metadata)!r}"
+000101b0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000101c0: 6e20 6764 7370 6174 680a 0a20 2020 2064  n gdspath..    d
+000101d0: 6566 2077 7269 7465 5f67 6473 280a 2020  ef write_gds(.  
+000101e0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000101f0: 2020 2020 6764 7370 6174 683a 204f 7074      gdspath: Opt
+00010200: 696f 6e61 6c5b 5061 7468 5479 7065 5d20  ional[PathType] 
+00010210: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00010220: 6764 7364 6972 3a20 4f70 7469 6f6e 616c  gdsdir: Optional
+00010230: 5b50 6174 6854 7970 655d 203d 204e 6f6e  [PathType] = Non
+00010240: 652c 0a20 2020 2020 2020 202a 2a6b 7761  e,.        **kwa
+00010250: 7267 732c 0a20 2020 2029 202d 3e20 5061  rgs,.    ) -> Pa
+00010260: 7468 3a0a 2020 2020 2020 2020 2222 2257  th:.        """W
+00010270: 7269 7465 2063 6f6d 706f 6e65 6e74 2074  rite component t
+00010280: 6f20 4744 5320 616e 6420 7265 7475 726e  o GDS and return
+00010290: 7320 6764 7370 6174 682e 0a0a 2020 2020  s gdspath...    
+000102a0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+000102b0: 2020 2020 2020 6764 7370 6174 683a 2047        gdspath: G
+000102c0: 4453 2066 696c 6520 7061 7468 2074 6f20  DS file path to 
+000102d0: 7772 6974 6520 746f 2e0a 2020 2020 2020  write to..      
+000102e0: 2020 2020 2020 6764 7364 6972 3a20 6469        gdsdir: di
+000102f0: 7265 6374 6f72 7920 666f 7220 7468 6520  rectory for the 
+00010300: 4744 5320 6669 6c65 2e20 4465 6661 756c  GDS file. Defaul
+00010310: 7473 2074 6f20 2f74 6d70 2f72 616e 646f  ts to /tmp/rando
+00010320: 6d46 696c 652f 6764 7366 6163 746f 7279  mFile/gdsfactory
+00010330: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
+00010340: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
+00010350: 2020 2020 2075 6e69 743a 2075 6e69 7420       unit: unit 
+00010360: 7369 7a65 2066 6f72 206f 626a 6563 7473  size for objects
+00010370: 2069 6e20 6c69 6272 6172 792e 2031 756d   in library. 1um
+00010380: 2062 7920 6465 6661 756c 742e 0a20 2020   by default..   
+00010390: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
+000103a0: 6f6e 3a20 666f 7220 6469 6d65 6e73 696f  on: for dimensio
+000103b0: 6e73 2069 6e20 7468 6520 6c69 6272 6172  ns in the librar
+000103c0: 7920 286d 292e 2031 6e6d 2062 7920 6465  y (m). 1nm by de
+000103d0: 6661 756c 742e 0a20 2020 2020 2020 2020  fault..         
+000103e0: 2020 206c 6f67 6769 6e67 3a20 6469 7361     logging: disa
+000103f0: 626c 6520 4744 5320 7061 7468 206c 6f67  ble GDS path log
+00010400: 6769 6e67 2c20 666f 7220 6578 616d 706c  ging, for exampl
+00010410: 6520 666f 7220 7368 6f77 696e 6720 6974  e for showing it
+00010420: 2069 6e20 4b4c 6179 6f75 742e 0a20 2020   in KLayout..   
+00010430: 2020 2020 2020 2020 206f 6e5f 6475 706c           on_dupl
+00010440: 6963 6174 655f 6365 6c6c 3a20 7370 6563  icate_cell: spec
+00010450: 6966 7920 686f 7720 746f 2072 6573 6f6c  ify how to resol
+00010460: 7665 2064 7570 6c69 6361 7465 2d6e 616d  ve duplicate-nam
+00010470: 6564 2063 656c 6c73 2e20 4368 6f6f 7365  ed cells. Choose
+00010480: 206f 6e65 206f 6620 7468 6520 666f 6c6c   one of the foll
+00010490: 6f77 696e 673a 0a20 2020 2020 2020 2020  owing:.         
+000104a0: 2020 2020 2020 2022 7761 726e 2220 2864         "warn" (d
+000104b0: 6566 6175 6c74 293a 206f 7665 7277 7269  efault): overwri
+000104c0: 7465 2061 6c6c 2064 7570 6c69 6361 7465  te all duplicate
+000104d0: 2063 656c 6c73 2077 6974 6820 6f6e 6520   cells with one 
+000104e0: 6f66 2074 6865 2064 7570 6c69 6361 7465  of the duplicate
+000104f0: 7320 2861 7262 6974 7261 7269 6c79 292e  s (arbitrarily).
+00010500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010510: 2022 6572 726f 7222 3a20 7468 726f 7720   "error": throw 
+00010520: 6120 5661 6c75 6545 7272 6f72 2077 6865  a ValueError whe
+00010530: 6e20 6174 7465 6d70 7469 6e67 2074 6f20  n attempting to 
+00010540: 7772 6974 6520 6120 6764 7320 7769 7468  write a gds with
+00010550: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
+00010560: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010570: 2020 226f 7665 7277 7269 7465 223a 206f    "overwrite": o
+00010580: 7665 7277 7269 7465 2061 6c6c 2064 7570  verwrite all dup
+00010590: 6c69 6361 7465 2063 656c 6c73 2077 6974  licate cells wit
+000105a0: 6820 6f6e 6520 6f66 2074 6865 2064 7570  h one of the dup
+000105b0: 6c69 6361 7465 732c 2077 6974 686f 7574  licates, without
+000105c0: 2077 6172 6e69 6e67 2e0a 2020 2020 2020   warning..      
+000105d0: 2020 2020 2020 6f6e 5f75 6e63 6163 6865        on_uncache
+000105e0: 645f 636f 6d70 6f6e 656e 743a 204c 6974  d_component: Lit
+000105f0: 6572 616c 5b22 7761 726e 222c 2022 6572  eral["warn", "er
+00010600: 726f 7222 5d20 3d20 2277 6172 6e22 0a20  ror"] = "warn". 
+00010610: 2020 2020 2020 2020 2020 2066 6c61 7474             flatt
+00010620: 656e 5f69 6e76 616c 6964 5f72 6566 733a  en_invalid_refs:
+00010630: 2066 6c61 7474 656e 7320 636f 6d70 6f6e   flattens compon
+00010640: 656e 7420 7265 6665 7265 6e63 6573 2077  ent references w
+00010650: 6869 6368 2068 6176 6520 696e 7661 6c69  hich have invali
+00010660: 6420 7472 616e 7366 6f72 6d61 7469 6f6e  d transformation
+00010670: 732e 0a20 2020 2020 2020 2020 2020 206d  s..            m
+00010680: 6178 5f70 6f69 6e74 733a 204d 6178 696d  ax_points: Maxim
+00010690: 616c 206e 756d 6265 7220 6f66 2076 6572  al number of ver
+000106a0: 7469 6365 7320 7065 7220 706f 6c79 676f  tices per polygo
+000106b0: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
+000106c0: 2020 2050 6f6c 7967 6f6e 7320 7769 7468     Polygons with
+000106d0: 206d 6f72 6520 7665 7274 6963 6573 2074   more vertices t
+000106e0: 6861 7420 7468 6973 2061 7265 2061 7574  hat this are aut
+000106f0: 6f6d 6174 6963 616c 6c79 2066 7261 6374  omatically fract
+00010700: 7572 6564 2e0a 2020 2020 2020 2020 2020  ured..          
+00010710: 2020 7769 7468 5f6d 6574 6164 6174 613a    with_metadata:
+00010720: 2077 7269 7465 7320 6d65 7461 6461 7461   writes metadata
+00010730: 2069 6e20 5941 4d4c 2066 6f72 6d61 742e   in YAML format.
+00010740: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00010750: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00010760: 662e 5f77 7269 7465 5f6c 6962 7261 7279  f._write_library
+00010770: 280a 2020 2020 2020 2020 2020 2020 6764  (.            gd
+00010780: 7370 6174 683d 6764 7370 6174 682c 2067  spath=gdspath, g
+00010790: 6473 6469 723d 6764 7364 6972 2c20 7769  dsdir=gdsdir, wi
+000107a0: 7468 5f6f 6173 6973 3d46 616c 7365 2c20  th_oasis=False, 
+000107b0: 2a2a 6b77 6172 6773 0a20 2020 2020 2020  **kwargs.       
+000107c0: 2029 0a0a 2020 2020 6465 6620 7772 6974   )..    def writ
+000107d0: 655f 6f61 7328 0a20 2020 2020 2020 2073  e_oas(.        s
+000107e0: 656c 662c 0a20 2020 2020 2020 2067 6473  elf,.        gds
+000107f0: 7061 7468 3a20 4f70 7469 6f6e 616c 5b50  path: Optional[P
+00010800: 6174 6854 7970 655d 203d 204e 6f6e 652c  athType] = None,
+00010810: 0a20 2020 2020 2020 2067 6473 6469 723a  .        gdsdir:
+00010820: 204f 7074 696f 6e61 6c5b 5061 7468 5479   Optional[PathTy
+00010830: 7065 5d20 3d20 4e6f 6e65 2c0a 2020 2020  pe] = None,.    
+00010840: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+00010850: 2020 2920 2d3e 2050 6174 683a 0a20 2020    ) -> Path:.   
+00010860: 2020 2020 2022 2222 5772 6974 6520 636f       """Write co
+00010870: 6d70 6f6e 656e 7420 746f 2047 4453 2061  mponent to GDS a
+00010880: 6e64 2072 6574 7572 6e73 2067 6473 7061  nd returns gdspa
+00010890: 7468 2e0a 0a20 2020 2020 2020 2041 7267  th...        Arg
+000108a0: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
+000108b0: 6473 7061 7468 3a20 4744 5320 6669 6c65  dspath: GDS file
+000108c0: 2070 6174 6820 746f 2077 7269 7465 2074   path to write t
+000108d0: 6f2e 0a20 2020 2020 2020 2020 2020 2067  o..            g
+000108e0: 6473 6469 723a 2064 6972 6563 746f 7279  dsdir: directory
+000108f0: 2066 6f72 2074 6865 2047 4453 2066 696c   for the GDS fil
+00010900: 652e 2044 6566 6175 6c74 7320 746f 202f  e. Defaults to /
+00010910: 746d 702f 7261 6e64 6f6d 4669 6c65 2f67  tmp/randomFile/g
+00010920: 6473 6661 6374 6f72 792e 0a0a 2020 2020  dsfactory...    
+00010930: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
+00010940: 3a0a 2020 2020 2020 2020 2020 2020 756e  :.            un
+00010950: 6974 3a20 756e 6974 2073 697a 6520 666f  it: unit size fo
+00010960: 7220 6f62 6a65 6374 7320 696e 206c 6962  r objects in lib
+00010970: 7261 7279 2e20 3175 6d20 6279 2064 6566  rary. 1um by def
+00010980: 6175 6c74 2e0a 2020 2020 2020 2020 2020  ault..          
+00010990: 2020 7072 6563 6973 696f 6e3a 2066 6f72    precision: for
+000109a0: 2064 696d 656e 7369 6f6e 7320 696e 2074   dimensions in t
+000109b0: 6865 206c 6962 7261 7279 2028 6d29 2e20  he library (m). 
+000109c0: 316e 6d20 6279 2064 6566 6175 6c74 2e0a  1nm by default..
+000109d0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+000109e0: 696e 673a 2064 6973 6162 6c65 2047 4453  ing: disable GDS
+000109f0: 2070 6174 6820 6c6f 6767 696e 672c 2066   path logging, f
+00010a00: 6f72 2065 7861 6d70 6c65 2066 6f72 2073  or example for s
+00010a10: 686f 7769 6e67 2069 7420 696e 204b 4c61  howing it in KLa
+00010a20: 796f 7574 2e0a 2020 2020 2020 2020 2020  yout..          
+00010a30: 2020 6f6e 5f64 7570 6c69 6361 7465 5f63    on_duplicate_c
+00010a40: 656c 6c3a 2073 7065 6369 6679 2068 6f77  ell: specify how
+00010a50: 2074 6f20 7265 736f 6c76 6520 6475 706c   to resolve dupl
+00010a60: 6963 6174 652d 6e61 6d65 6420 6365 6c6c  icate-named cell
+00010a70: 732e 2043 686f 6f73 6520 6f6e 6520 6f66  s. Choose one of
+00010a80: 2074 6865 2066 6f6c 6c6f 7769 6e67 3a0a   the following:.
+00010a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010aa0: 2277 6172 6e22 2028 6465 6661 756c 7429  "warn" (default)
+00010ab0: 3a20 6f76 6572 7772 6974 6520 616c 6c20  : overwrite all 
+00010ac0: 6475 706c 6963 6174 6520 6365 6c6c 7320  duplicate cells 
+00010ad0: 7769 7468 206f 6e65 206f 6620 7468 6520  with one of the 
+00010ae0: 6475 706c 6963 6174 6573 2028 6172 6269  duplicates (arbi
+00010af0: 7472 6172 696c 7929 2e0a 2020 2020 2020  trarily)..      
+00010b00: 2020 2020 2020 2020 2020 2265 7272 6f72            "error
+00010b10: 223a 2074 6872 6f77 2061 2056 616c 7565  ": throw a Value
+00010b20: 4572 726f 7220 7768 656e 2061 7474 656d  Error when attem
+00010b30: 7074 696e 6720 746f 2077 7269 7465 2061  pting to write a
+00010b40: 2067 6473 2077 6974 6820 6475 706c 6963   gds with duplic
+00010b50: 6174 6520 6365 6c6c 732e 0a20 2020 2020  ate cells..     
+00010b60: 2020 2020 2020 2020 2020 2022 6f76 6572             "over
+00010b70: 7772 6974 6522 3a20 6f76 6572 7772 6974  write": overwrit
+00010b80: 6520 616c 6c20 6475 706c 6963 6174 6520  e all duplicate 
+00010b90: 6365 6c6c 7320 7769 7468 206f 6e65 206f  cells with one o
+00010ba0: 6620 7468 6520 6475 706c 6963 6174 6573  f the duplicates
+00010bb0: 2c20 7769 7468 6f75 7420 7761 726e 696e  , without warnin
+00010bc0: 672e 0a20 2020 2020 2020 2020 2020 2020  g..             
+00010bd0: 2020 204e 6f6e 653a 2064 6f20 6e6f 7420     None: do not 
+00010be0: 7472 7920 746f 2072 6573 6f6c 7665 2028  try to resolve (
+00010bf0: 6174 2079 6f75 7220 6f77 6e20 7269 736b  at your own risk
+00010c00: 2129 0a20 2020 2020 2020 2020 2020 206f  !).            o
+00010c10: 6e5f 756e 6361 6368 6564 5f63 6f6d 706f  n_uncached_compo
+00010c20: 6e65 6e74 3a20 4c69 7465 7261 6c5b 2277  nent: Literal["w
+00010c30: 6172 6e22 2c20 2265 7272 6f72 225d 203d  arn", "error"] =
+00010c40: 2022 7761 726e 220a 2020 2020 2020 2020   "warn".        
+00010c50: 2020 2020 666c 6174 7465 6e5f 696e 7661      flatten_inva
+00010c60: 6c69 645f 7265 6673 3a20 666c 6174 7465  lid_refs: flatte
+00010c70: 6e73 2063 6f6d 706f 6e65 6e74 2072 6566  ns component ref
+00010c80: 6572 656e 6365 7320 7768 6963 6820 6861  erences which ha
+00010c90: 7665 2069 6e76 616c 6964 2074 7261 6e73  ve invalid trans
+00010ca0: 666f 726d 6174 696f 6e73 2e0a 2020 2020  formations..    
+00010cb0: 2020 2020 2020 2020 636f 6d70 7265 7373          compress
+00010cc0: 696f 6e5f 6c65 7665 6c3a 204c 6576 656c  ion_level: Level
+00010cd0: 206f 6620 636f 6d70 7265 7373 696f 6e20   of compression 
+00010ce0: 666f 7220 6365 6c6c 7320 2862 6574 7765  for cells (betwe
+00010cf0: 656e 2030 2061 6e64 2039 292e 0a20 2020  en 0 and 9)..   
+00010d00: 2020 2020 2020 2020 2020 2020 2053 6574               Set
+00010d10: 7469 6e67 2074 6f20 3020 7769 6c6c 2064  ting to 0 will d
+00010d20: 6973 6162 6c65 2063 656c 6c20 636f 6d70  isable cell comp
+00010d30: 7265 7373 696f 6e2c 2031 2067 6976 6573  ression, 1 gives
+00010d40: 2074 6865 2062 6573 7420 7370 6565 6420   the best speed 
+00010d50: 616e 6420 392c 2074 6865 2062 6573 7420  and 9, the best 
+00010d60: 636f 6d70 7265 7373 696f 6e2e 0a20 2020  compression..   
+00010d70: 2020 2020 2020 2020 2064 6574 6563 745f           detect_
+00010d80: 7265 6374 616e 676c 6573 3a20 5374 6f72  rectangles: Stor
+00010d90: 6520 7265 6374 616e 676c 6573 2069 6e20  e rectangles in 
+00010da0: 636f 6d70 7265 7373 6564 2066 6f72 6d61  compressed forma
+00010db0: 742e 0a20 2020 2020 2020 2020 2020 2064  t..            d
+00010dc0: 6574 6563 745f 7472 6170 657a 6f69 6473  etect_trapezoids
+00010dd0: 3a20 5374 6f72 6520 7472 6170 657a 6f69  : Store trapezoi
+00010de0: 6473 2069 6e20 636f 6d70 7265 7373 6564  ds in compressed
+00010df0: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
+00010e00: 2020 2020 2063 6972 636c 655f 746f 6c65       circle_tole
+00010e10: 7261 6e63 653a 2054 6f6c 6572 616e 6365  rance: Tolerance
+00010e20: 2066 6f72 2064 6574 6563 7469 6e67 2063   for detecting c
+00010e30: 6972 636c 6573 2e20 4966 206c 6573 7320  ircles. If less 
+00010e40: 6f72 2065 7175 616c 2074 6f20 302c 206e  or equal to 0, n
+00010e50: 6f20 6465 7465 6374 696f 6e20 6973 2070  o detection is p
+00010e60: 6572 666f 726d 6564 2e0a 2020 2020 2020  erformed..      
+00010e70: 2020 2020 2020 2020 2020 4369 7263 6c65            Circle
+00010e80: 7320 6172 6520 7374 6f72 6564 2069 6e20  s are stored in 
+00010e90: 636f 6d70 7265 7373 6564 2066 6f72 6d61  compressed forma
+00010ea0: 742e 0a20 2020 2020 2020 2020 2020 2076  t..            v
+00010eb0: 616c 6964 6174 696f 6e20 2822 6372 6333  alidation ("crc3
+00010ec0: 3222 2c20 2263 6865 636b 7375 6d33 3222  2", "checksum32"
+00010ed0: 2c20 4e6f 6e65 2920 e280 9320 7479 7065  , None) ... type
+00010ee0: 206f 6620 7661 6c69 6461 7469 6f6e 2074   of validation t
+00010ef0: 6f20 696e 636c 7564 6520 696e 2074 6865  o include in the
+00010f00: 2073 6176 6564 2066 696c 652e 0a20 2020   saved file..   
+00010f10: 2020 2020 2020 2020 2073 7461 6e64 6172           standar
+00010f20: 645f 7072 6f70 6572 7469 6573 3a20 5374  d_properties: St
+00010f30: 6f72 6520 7374 616e 6461 7264 204f 4153  ore standard OAS
+00010f40: 4953 2070 726f 7065 7274 6965 7320 696e  IS properties in
+00010f50: 2074 6865 2066 696c 652e 0a20 2020 2020   the file..     
+00010f60: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00010f70: 6574 7572 6e20 7365 6c66 2e5f 7772 6974  eturn self._writ
+00010f80: 655f 6c69 6272 6172 7928 0a20 2020 2020  e_library(.     
+00010f90: 2020 2020 2020 2067 6473 7061 7468 3d67         gdspath=g
+00010fa0: 6473 7061 7468 2c0a 2020 2020 2020 2020  dspath,.        
+00010fb0: 2020 2020 6764 7364 6972 3d67 6473 6469      gdsdir=gdsdi
+00010fc0: 722c 0a20 2020 2020 2020 2020 2020 2077  r,.            w
+00010fd0: 6974 685f 6f61 7369 733d 5472 7565 2c0a  ith_oasis=True,.
+00010fe0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+00010ff0: 6172 6773 2c0a 2020 2020 2020 2020 290a  args,.        ).
+00011000: 0a20 2020 2064 6566 2077 7269 7465 5f67  .    def write_g
+00011010: 6473 5f77 6974 685f 6d65 7461 6461 7461  ds_with_metadata
+00011020: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
+00011030: 6b77 6172 6773 2920 2d3e 2050 6174 683a  kwargs) -> Path:
+00011040: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
+00011050: 6520 636f 6d70 6f6e 656e 7420 696e 2047  e component in G
+00011060: 4453 2061 6e64 206d 6574 6164 6174 6120  DS and metadata 
+00011070: 2863 6f6d 706f 6e65 6e74 2073 6574 7469  (component setti
+00011080: 6e67 7329 2069 6e20 5941 4d4c 2e22 2222  ngs) in YAML."""
+00011090: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
+000110a0: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+000110b0: 2020 2020 2243 6f6d 706f 6e65 6e74 2e77      "Component.w
+000110c0: 7269 7465 5f67 6473 5f77 6974 685f 6d65  rite_gds_with_me
+000110d0: 7461 6461 7461 2829 2069 7320 6465 7072  tadata() is depr
+000110e0: 6563 6174 6564 2e20 220a 2020 2020 2020  ecated. ".      
+000110f0: 2020 2020 2020 2255 7365 2043 6f6d 706f        "Use Compo
+00011100: 6e65 6e74 2e77 7269 7465 5f67 6473 2877  nent.write_gds(w
+00011110: 6974 685f 6d65 7461 6461 7461 3d54 7275  ith_metadata=Tru
+00011120: 6529 206f 7220 436f 6d70 6f6e 656e 742e  e) or Component.
+00011130: 7772 6974 655f 6f61 7328 7769 7468 5f6d  write_oas(with_m
+00011140: 6574 6164 6174 613d 5472 7565 292e 222c  etadata=True).",
+00011150: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+00011160: 636b 6c65 7665 6c3d 332c 0a20 2020 2020  cklevel=3,.     
+00011170: 2020 2029 0a20 2020 2020 2020 2067 6473     ).        gds
+00011180: 7061 7468 203d 2073 656c 662e 7772 6974  path = self.writ
+00011190: 655f 6764 7328 2a61 7267 732c 202a 2a6b  e_gds(*args, **k
+000111a0: 7761 7267 7329 0a20 2020 2020 2020 206d  wargs).        m
+000111b0: 6574 6164 6174 6120 3d20 6764 7370 6174  etadata = gdspat
+000111c0: 682e 7769 7468 5f73 7566 6669 7828 222e  h.with_suffix(".
+000111d0: 796d 6c22 290a 2020 2020 2020 2020 6d65  yml").        me
+000111e0: 7461 6461 7461 2e77 7269 7465 5f74 6578  tadata.write_tex
+000111f0: 7428 7365 6c66 2e74 6f5f 7961 6d6c 2877  t(self.to_yaml(w
+00011200: 6974 685f 6365 6c6c 733d 5472 7565 2c20  ith_cells=True, 
+00011210: 7769 7468 5f70 6f72 7473 3d54 7275 6529  with_ports=True)
+00011220: 290a 2020 2020 2020 2020 6c6f 6767 6572  ).        logger
+00011230: 2e69 6e66 6f28 6622 5772 6974 6520 5941  .info(f"Write YA
+00011240: 4d4c 206d 6574 6164 6174 6120 746f 207b  ML metadata to {
+00011250: 7374 7228 6d65 7461 6461 7461 2921 727d  str(metadata)!r}
+00011260: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+00011270: 6e20 6764 7370 6174 680a 0a20 2020 2064  n gdspath..    d
+00011280: 6566 2074 6f5f 6469 6374 280a 2020 2020  ef to_dict(.    
+00011290: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000112a0: 2020 6967 6e6f 7265 5f63 6f6d 706f 6e65    ignore_compone
+000112b0: 6e74 735f 7072 6566 6978 3a20 4f70 7469  nts_prefix: Opti
+000112c0: 6f6e 616c 5b4c 6973 745b 7374 725d 5d20  onal[List[str]] 
+000112d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000112e0: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
+000112f0: 5f70 7265 6669 783a 204f 7074 696f 6e61  _prefix: Optiona
+00011300: 6c5b 4c69 7374 5b73 7472 5d5d 203d 204e  l[List[str]] = N
+00011310: 6f6e 652c 0a20 2020 2020 2020 2077 6974  one,.        wit
+00011320: 685f 6365 6c6c 733a 2062 6f6f 6c20 3d20  h_cells: bool = 
+00011330: 4661 6c73 652c 0a20 2020 2020 2020 2077  False,.        w
+00011340: 6974 685f 706f 7274 733a 2062 6f6f 6c20  ith_ports: bool 
+00011350: 3d20 5472 7565 2c0a 2020 2020 2920 2d3e  = True,.    ) ->
+00011360: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
+00011370: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00011380: 726e 7320 4469 6374 2072 6570 7265 7365  rns Dict represe
+00011390: 6e74 6174 696f 6e20 6f66 2061 2063 6f6d  ntation of a com
+000113a0: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+000113b0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000113c0: 2020 2069 676e 6f72 655f 636f 6d70 6f6e     ignore_compon
+000113d0: 656e 7473 5f70 7265 6669 783a 2066 6f72  ents_prefix: for
+000113e0: 2063 6f6d 706f 6e65 6e74 7320 746f 2069   components to i
+000113f0: 676e 6f72 6520 7768 656e 2065 7870 6f72  gnore when expor
+00011400: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
+00011410: 2020 6967 6e6f 7265 5f66 756e 6374 696f    ignore_functio
+00011420: 6e73 5f70 7265 6669 783a 2066 6f72 2066  ns_prefix: for f
+00011430: 756e 6374 696f 6e73 2074 6f20 6967 6e6f  unctions to igno
+00011440: 7265 2077 6865 6e20 6578 706f 7274 696e  re when exportin
+00011450: 672e 0a20 2020 2020 2020 2020 2020 2077  g..            w
+00011460: 6974 685f 6365 6c6c 733a 2077 7269 7465  ith_cells: write
+00011470: 2063 656c 6c73 2072 6563 7572 7369 7665   cells recursive
+00011480: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
+00011490: 7769 7468 5f70 6f72 7473 3a20 7772 6974  with_ports: writ
+000114a0: 6520 706f 7274 2069 6e66 6f72 6d61 7469  e port informati
+000114b0: 6f6e 2064 6963 742e 0a20 2020 2020 2020  on dict..       
+000114c0: 2022 2222 0a20 2020 2020 2020 2064 203d   """.        d =
+000114d0: 207b 7d0a 2020 2020 2020 2020 6966 2077   {}.        if w
+000114e0: 6974 685f 706f 7274 733a 0a20 2020 2020  ith_ports:.     
+000114f0: 2020 2020 2020 2070 6f72 7473 203d 207b         ports = {
+00011500: 706f 7274 2e6e 616d 653a 2070 6f72 742e  port.name: port.
+00011510: 746f 5f64 6963 7428 2920 666f 7220 706f  to_dict() for po
+00011520: 7274 2069 6e20 7365 6c66 2e67 6574 5f70  rt in self.get_p
+00011530: 6f72 7473 5f6c 6973 7428 297d 0a20 2020  orts_list()}.   
+00011540: 2020 2020 2020 2020 2064 5b22 706f 7274           d["port
+00011550: 7322 5d20 3d20 706f 7274 730a 0a20 2020  s"] = ports..   
+00011560: 2020 2020 2069 6620 7769 7468 5f63 656c       if with_cel
+00011570: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+00011580: 6365 6c6c 7320 3d20 7265 6375 7273 655f  cells = recurse_
+00011590: 7374 7275 6374 7572 6573 280a 2020 2020  structures(.    
+000115a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000115b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000115c0: 2020 6967 6e6f 7265 5f66 756e 6374 696f    ignore_functio
+000115d0: 6e73 5f70 7265 6669 783d 6967 6e6f 7265  ns_prefix=ignore
+000115e0: 5f66 756e 6374 696f 6e73 5f70 7265 6669  _functions_prefi
+000115f0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+00011600: 2020 2069 676e 6f72 655f 636f 6d70 6f6e     ignore_compon
+00011610: 656e 7473 5f70 7265 6669 783d 6967 6e6f  ents_prefix=igno
+00011620: 7265 5f63 6f6d 706f 6e65 6e74 735f 7072  re_components_pr
+00011630: 6566 6978 2c0a 2020 2020 2020 2020 2020  efix,.          
+00011640: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00011650: 645b 2263 656c 6c73 225d 203d 2063 6c65  d["cells"] = cle
+00011660: 616e 5f64 6963 7428 6365 6c6c 7329 0a0a  an_dict(cells)..
+00011670: 2020 2020 2020 2020 645b 226e 616d 6522          d["name"
+00011680: 5d20 3d20 7365 6c66 2e6e 616d 650a 2020  ] = self.name.  
+00011690: 2020 2020 2020 645b 2273 6574 7469 6e67        d["setting
+000116a0: 7322 5d20 3d20 636c 6561 6e5f 6469 6374  s"] = clean_dict
+000116b0: 2864 6963 7428 7365 6c66 2e73 6574 7469  (dict(self.setti
+000116c0: 6e67 7329 290a 2020 2020 2020 2020 7265  ngs)).        re
+000116d0: 7475 726e 2064 0a0a 2020 2020 6465 6620  turn d..    def 
+000116e0: 746f 5f79 616d 6c28 7365 6c66 2c20 2a2a  to_yaml(self, **
+000116f0: 6b77 6172 6773 2920 2d3e 2073 7472 3a0a  kwargs) -> str:.
+00011700: 2020 2020 2020 2020 2222 2257 7269 7465          """Write
+00011710: 2044 6963 7420 7265 7072 6573 656e 7461   Dict representa
+00011720: 7469 6f6e 206f 6620 6120 636f 6d70 6f6e  tion of a compon
+00011730: 656e 7420 696e 2059 414d 4c20 666f 726d  ent in YAML form
+00011740: 6174 2e0a 0a20 2020 2020 2020 2041 7267  at...        Arg
+00011750: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+00011760: 676e 6f72 655f 636f 6d70 6f6e 656e 7473  gnore_components
+00011770: 5f70 7265 6669 783a 2066 6f72 2063 6f6d  _prefix: for com
+00011780: 706f 6e65 6e74 7320 746f 2069 676e 6f72  ponents to ignor
+00011790: 6520 7768 656e 2065 7870 6f72 7469 6e67  e when exporting
+000117a0: 2e0a 2020 2020 2020 2020 2020 2020 6967  ..            ig
+000117b0: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
+000117c0: 7265 6669 783a 2066 6f72 2066 756e 6374  refix: for funct
+000117d0: 696f 6e73 2074 6f20 6967 6e6f 7265 2077  ions to ignore w
+000117e0: 6865 6e20 6578 706f 7274 696e 672e 0a20  hen exporting.. 
+000117f0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00011800: 6365 6c6c 733a 2077 7269 7465 2063 656c  cells: write cel
+00011810: 6c73 2072 6563 7572 7369 7665 6c79 2e0a  ls recursively..
+00011820: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00011830: 5f70 6f72 7473 3a20 7772 6974 6520 706f  _ports: write po
+00011840: 7274 2069 6e66 6f72 6d61 7469 6f6e 2e0a  rt information..
+00011850: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00011860: 2020 2020 7265 7475 726e 204f 6d65 6761      return Omega
+00011870: 436f 6e66 2e74 6f5f 7961 6d6c 2863 6c65  Conf.to_yaml(cle
+00011880: 616e 5f64 6963 7428 7365 6c66 2e74 6f5f  an_dict(self.to_
+00011890: 6469 6374 282a 2a6b 7761 7267 7329 2929  dict(**kwargs)))
+000118a0: 0a0a 2020 2020 6465 6620 746f 5f64 6963  ..    def to_dic
+000118b0: 745f 706f 6c79 676f 6e73 2873 656c 6629  t_polygons(self)
+000118c0: 202d 3e20 4469 6374 5b73 7472 2c20 416e   -> Dict[str, An
+000118d0: 795d 3a0a 2020 2020 2020 2020 2222 2252  y]:.        """R
+000118e0: 6574 7572 6e73 2061 2064 6963 7420 7265  eturns a dict re
+000118f0: 7072 6573 656e 7461 7469 6f6e 206f 6620  presentation of 
+00011900: 7468 6520 666c 6174 7465 6e65 6420 636f  the flattened co
+00011910: 6d70 6f6e 656e 742e 2222 220a 2020 2020  mponent.""".    
+00011920: 2020 2020 6420 3d20 7b7d 0a20 2020 2020      d = {}.     
+00011930: 2020 2070 6f6c 7967 6f6e 7320 3d20 7b7d     polygons = {}
+00011940: 0a20 2020 2020 2020 206c 6179 6572 5f74  .        layer_t
+00011950: 6f5f 706f 6c79 676f 6e73 203d 2073 656c  o_polygons = sel
+00011960: 662e 6765 745f 706f 6c79 676f 6e73 2862  f.get_polygons(b
+00011970: 795f 7370 6563 3d54 7275 6529 0a0a 2020  y_spec=True)..  
+00011980: 2020 2020 2020 666f 7220 6c61 7965 722c        for layer,
+00011990: 2070 6f6c 7967 6f6e 735f 6c61 7965 7220   polygons_layer 
+000119a0: 696e 206c 6179 6572 5f74 6f5f 706f 6c79  in layer_to_poly
+000119b0: 676f 6e73 2e69 7465 6d73 2829 3a0a 2020  gons.items():.  
+000119c0: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
+000119d0: 6e61 6d65 203d 2066 227b 6c61 7965 725b  name = f"{layer[
+000119e0: 305d 7d5f 7b6c 6179 6572 5b31 5d7d 220a  0]}_{layer[1]}".
+000119f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00011a00: 706f 6c79 676f 6e20 696e 2070 6f6c 7967  polygon in polyg
+00011a10: 6f6e 735f 6c61 7965 723a 0a20 2020 2020  ons_layer:.     
+00011a20: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00011a30: 6f6e 735b 6c61 7965 725f 6e61 6d65 5d20  ons[layer_name] 
+00011a40: 3d20 5b74 7570 6c65 2873 6e61 705f 746f  = [tuple(snap_to
+00011a50: 5f67 7269 6428 7629 2920 666f 7220 7620  _grid(v)) for v 
+00011a60: 696e 2070 6f6c 7967 6f6e 5d0a 0a20 2020  in polygon]..   
+00011a70: 2020 2020 2070 6f72 7473 203d 207b 706f       ports = {po
+00011a80: 7274 2e6e 616d 653a 2070 6f72 742e 7365  rt.name: port.se
+00011a90: 7474 696e 6773 2066 6f72 2070 6f72 7420  ttings for port 
+00011aa0: 696e 2073 656c 662e 6765 745f 706f 7274  in self.get_port
+00011ab0: 735f 6c69 7374 2829 7d0a 2020 2020 2020  s_list()}.      
+00011ac0: 2020 636c 6561 6e5f 6469 6374 2870 6f72    clean_dict(por
+00011ad0: 7473 290a 2020 2020 2020 2020 636c 6561  ts).        clea
+00011ae0: 6e5f 6469 6374 2870 6f6c 7967 6f6e 7329  n_dict(polygons)
+00011af0: 0a20 2020 2020 2020 2064 2e69 6e66 6f20  .        d.info 
+00011b00: 3d20 7365 6c66 2e69 6e66 6f0a 2020 2020  = self.info.    
+00011b10: 2020 2020 642e 706f 6c79 676f 6e73 203d      d.polygons =
+00011b20: 2070 6f6c 7967 6f6e 730a 2020 2020 2020   polygons.      
+00011b30: 2020 642e 706f 7274 7320 3d20 706f 7274    d.ports = port
+00011b40: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+00011b50: 2064 0a0a 2020 2020 6465 6620 6175 746f   d..    def auto
+00011b60: 5f72 656e 616d 655f 706f 7274 7328 7365  _rename_ports(se
+00011b70: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
+00011b80: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00011b90: 2222 5265 6e61 6d65 2070 6f72 7473 2062  ""Rename ports b
+00011ba0: 7920 6f72 6965 6e74 6174 696f 6e20 4e53  y orientation NS
+00011bb0: 4557 2028 6e6f 7274 682c 2073 6f75 7468  EW (north, south
+00011bc0: 2c20 6561 7374 2c20 7765 7374 292e 0a0a  , east, west)...
+00011bd0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+00011be0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00011bf0: 2020 6675 6e63 7469 6f6e 3a20 746f 2072    function: to r
+00011c00: 656e 616d 6520 706f 7274 732e 0a20 2020  ename ports..   
+00011c10: 2020 2020 2020 2020 2073 656c 6563 745f           select_
+00011c20: 706f 7274 735f 6f70 7469 6361 6c3a 2074  ports_optical: t
+00011c30: 6f20 7365 6c65 6374 206f 7074 6963 616c  o select optical
+00011c40: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
+00011c50: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
+00011c60: 5f65 6c65 6374 7269 6361 6c3a 2074 6f20  _electrical: to 
+00011c70: 7365 6c65 6374 2065 6c65 6374 7269 6361  select electrica
+00011c80: 6c20 706f 7274 732e 0a20 2020 2020 2020  l ports..       
+00011c90: 2020 2020 2070 7265 6669 785f 6f70 7469       prefix_opti
+00011ca0: 6361 6c3a 2070 7265 6669 782e 0a20 2020  cal: prefix..   
+00011cb0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00011cc0: 656c 6563 7472 6963 616c 3a20 7072 6566  electrical: pref
+00011cd0: 6978 2e0a 0a20 2020 2020 2020 202e 2e20  ix...        .. 
+00011ce0: 636f 6465 3a3a 0a0a 2020 2020 2020 2020  code::..        
+00011cf0: 2020 2020 2020 2020 2020 3320 2034 0a20            3  4. 
+00011d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d10: 5f7c 5f5f 7c5f 0a20 2020 2020 2020 2020  _|__|_.         
+00011d20: 2020 2020 3220 2d7c 2020 2020 2020 7c2d      2 -|      |-
+00011d30: 2035 0a20 2020 2020 2020 2020 2020 2020   5.             
+00011d40: 2020 207c 2020 2020 2020 7c0a 2020 2020     |      |.    
+00011d50: 2020 2020 2020 2020 2031 202d 7c5f 5f5f           1 -|___
+00011d60: 5f5f 5f7c 2d20 360a 2020 2020 2020 2020  ___|- 6.        
+00011d70: 2020 2020 2020 2020 2020 7c20 207c 0a20            |  |. 
+00011d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d90: 2038 2020 370a 2020 2020 2020 2020 2222   8  7.        ""
+00011da0: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
+00011db0: 735f 756e 6c6f 636b 6564 2829 0a20 2020  s_unlocked().   
+00011dc0: 2020 2020 2061 7574 6f5f 7265 6e61 6d65       auto_rename
+00011dd0: 5f70 6f72 7473 2873 656c 662c 202a 2a6b  _ports(self, **k
+00011de0: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
+00011df0: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
+00011e00: 735f 636f 756e 7465 725f 636c 6f63 6b77  s_counter_clockw
+00011e10: 6973 6528 7365 6c66 2c20 2a2a 6b77 6172  ise(self, **kwar
+00011e20: 6773 2920 2d3e 204e 6f6e 653a 0a20 2020  gs) -> None:.   
+00011e30: 2020 2020 2073 656c 662e 6973 5f75 6e6c       self.is_unl
+00011e40: 6f63 6b65 6428 290a 2020 2020 2020 2020  ocked().        
+00011e50: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
+00011e60: 735f 636f 756e 7465 725f 636c 6f63 6b77  s_counter_clockw
+00011e70: 6973 6528 7365 6c66 2c20 2a2a 6b77 6172  ise(self, **kwar
+00011e80: 6773 290a 0a20 2020 2064 6566 2061 7574  gs)..    def aut
+00011e90: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6c  o_rename_ports_l
+00011ea0: 6179 6572 5f6f 7269 656e 7461 7469 6f6e  ayer_orientation
+00011eb0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+00011ec0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00011ed0: 2020 7365 6c66 2e69 735f 756e 6c6f 636b    self.is_unlock
+00011ee0: 6564 2829 0a20 2020 2020 2020 2061 7574  ed().        aut
+00011ef0: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6c  o_rename_ports_l
+00011f00: 6179 6572 5f6f 7269 656e 7461 7469 6f6e  ayer_orientation
+00011f10: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+00011f20: 0a0a 2020 2020 6465 6620 6175 746f 5f72  ..    def auto_r
+00011f30: 656e 616d 655f 706f 7274 735f 6f72 6965  ename_ports_orie
+00011f40: 6e74 6174 696f 6e28 7365 6c66 2c20 2a2a  ntation(self, **
+00011f50: 6b77 6172 6773 2920 2d3e 204e 6f6e 653a  kwargs) -> None:
+00011f60: 0a20 2020 2020 2020 2022 2222 5265 6e61  .        """Rena
+00011f70: 6d65 2070 6f72 7473 2062 7920 6f72 6965  me ports by orie
+00011f80: 6e74 6174 696f 6e20 4e53 4557 2028 6e6f  ntation NSEW (no
+00011f90: 7274 682c 2073 6f75 7468 2c20 6561 7374  rth, south, east
+00011fa0: 2c20 7765 7374 292e 0a0a 2020 2020 2020  , west)...      
+00011fb0: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
+00011fc0: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+00011fd0: 7469 6f6e 3a20 746f 2072 656e 616d 6520  tion: to rename 
+00011fe0: 706f 7274 732e 0a20 2020 2020 2020 2020  ports..         
+00011ff0: 2020 2073 656c 6563 745f 706f 7274 735f     select_ports_
+00012000: 6f70 7469 6361 6c3a 2074 6f20 7365 6c65  optical: to sele
+00012010: 6374 2070 6f72 7473 2e0a 2020 2020 2020  ct ports..      
+00012020: 2020 2020 2020 7365 6c65 6374 5f70 6f72        select_por
+00012030: 7473 5f65 6c65 6374 7269 6361 6c3a 0a20  ts_electrical:. 
+00012040: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00012050: 785f 6f70 7469 6361 6c3a 0a20 2020 2020  x_optical:.     
+00012060: 2020 2020 2020 2070 7265 6669 785f 656c         prefix_el
+00012070: 6563 7472 6963 616c 3a0a 0a20 2020 2020  ectrical:..     
+00012080: 2020 202e 2e20 636f 6465 3a3a 0a0a 2020     .. code::..  
+00012090: 2020 2020 2020 2020 2020 2020 2020 204e                 N
+000120a0: 3020 204e 310a 2020 2020 2020 2020 2020  0  N1.          
+000120b0: 2020 2020 2020 207c 5f5f 5f7c 5f0a 2020         |___|_.  
+000120c0: 2020 2020 2020 2020 2020 5731 202d 7c20            W1 -| 
+000120d0: 2020 2020 207c 2d20 4531 0a20 2020 2020       |- E1.     
+000120e0: 2020 2020 2020 2020 2020 207c 2020 2020             |    
+000120f0: 2020 7c0a 2020 2020 2020 2020 2020 2020    |.            
+00012100: 5730 202d 7c5f 5f5f 5f5f 5f7c 2d20 4530  W0 -|______|- E0
+00012110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012120: 2020 7c20 2020 7c0a 2020 2020 2020 2020    |   |.        
+00012130: 2020 2020 2020 2020 5330 2020 2053 310a          S0   S1.
+00012140: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012150: 2020 2020 7365 6c66 2e69 735f 756e 6c6f      self.is_unlo
+00012160: 636b 6564 2829 0a20 2020 2020 2020 2061  cked().        a
+00012170: 7574 6f5f 7265 6e61 6d65 5f70 6f72 7473  uto_rename_ports
+00012180: 5f6f 7269 656e 7461 7469 6f6e 2873 656c  _orientation(sel
+00012190: 662c 202a 2a6b 7761 7267 7329 0a0a 2020  f, **kwargs)..  
+000121a0: 2020 6465 6620 6d6f 7665 280a 2020 2020    def move(.    
+000121b0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000121c0: 2020 6f72 6967 696e 3a20 466c 6f61 7432    origin: Float2
+000121d0: 203d 2028 302c 2030 292c 0a20 2020 2020   = (0, 0),.     
+000121e0: 2020 2064 6573 7469 6e61 7469 6f6e 3a20     destination: 
+000121f0: 4f70 7469 6f6e 616c 5b46 6c6f 6174 325d  Optional[Float2]
+00012200: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00012210: 2061 7869 733a 204f 7074 696f 6e61 6c5b   axis: Optional[
+00012220: 4178 6973 5d20 3d20 4e6f 6e65 2c0a 2020  Axis] = None,.  
+00012230: 2020 2920 2d3e 2043 6f6d 706f 6e65 6e74    ) -> Component
+00012240: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00012250: 7572 6e73 206e 6577 2043 6f6d 706f 6e65  urns new Compone
+00012260: 6e74 2077 6974 6820 6120 6d6f 7665 6420  nt with a moved 
+00012270: 7265 6665 7265 6e63 6520 746f 2074 6865  reference to the
+00012280: 206f 7269 6769 6e61 6c2e 0a0a 2020 2020   original...    
+00012290: 2020 2020 636f 6d70 6f6e 656e 742e 0a0a      component...
+000122a0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000122b0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+000122c0: 3a20 6f66 2063 6f6d 706f 6e65 6e74 2e0a  : of component..
+000122d0: 2020 2020 2020 2020 2020 2020 6465 7374              dest
+000122e0: 696e 6174 696f 6e3a 2078 2c20 792e 0a20  ination: x, y.. 
+000122f0: 2020 2020 2020 2020 2020 2061 7869 733a             axis:
+00012300: 2078 206f 7220 792e 0a20 2020 2020 2020   x or y..       
+00012310: 2022 2222 0a20 2020 2020 2020 2072 6169   """.        rai
+00012320: 7365 2056 616c 7565 4572 726f 7228 6d6f  se ValueError(mo
+00012330: 7665 5f65 7272 6f72 5f6d 6573 7361 6765  ve_error_message
+00012340: 290a 0a20 2020 2064 6566 206d 6972 726f  )..    def mirro
+00012350: 7228 7365 6c66 2c20 7031 3a20 466c 6f61  r(self, p1: Floa
+00012360: 7432 203d 2028 302c 2031 292c 2070 323a  t2 = (0, 1), p2:
+00012370: 2046 6c6f 6174 3220 3d20 2830 2c20 3029   Float2 = (0, 0)
+00012380: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2043  , **kwargs) -> C
+00012390: 6f6d 706f 6e65 6e74 3a0a 2020 2020 2020  omponent:.      
+000123a0: 2020 2222 2252 6574 7572 6e73 206e 6577    """Returns new
+000123b0: 2043 6f6d 706f 6e65 6e74 2077 6974 6820   Component with 
+000123c0: 6120 6d69 7272 6f72 6564 2072 6566 6572  a mirrored refer
+000123d0: 656e 6365 2e0a 0a20 2020 2020 2020 2041  ence...        A
+000123e0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+000123f0: 2070 313a 2066 6972 7374 2070 6f69 6e74   p1: first point
+00012400: 2074 6f20 6465 6669 6e65 206d 6972 726f   to define mirro
+00012410: 7220 6178 6973 2e0a 2020 2020 2020 2020  r axis..        
+00012420: 2020 2020 7032 3a20 7365 636f 6e64 2070      p2: second p
+00012430: 6f69 6e74 2074 6f20 6465 6669 6e65 206d  oint to define m
+00012440: 6972 726f 7220 6178 6973 2e0a 2020 2020  irror axis..    
+00012450: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00012460: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00012470: 6675 6e63 7469 6f6e 7320 696d 706f 7274  functions import
+00012480: 206d 6972 726f 720a 0a20 2020 2020 2020   mirror..       
+00012490: 2072 6574 7572 6e20 6d69 7272 6f72 2863   return mirror(c
+000124a0: 6f6d 706f 6e65 6e74 3d73 656c 662c 2070  omponent=self, p
+000124b0: 313d 7031 2c20 7032 3d70 322c 202a 2a6b  1=p1, p2=p2, **k
+000124c0: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
+000124d0: 726f 7461 7465 2873 656c 662c 2061 6e67  rotate(self, ang
+000124e0: 6c65 3a20 666c 6f61 7420 3d20 3930 2c20  le: float = 90, 
+000124f0: 2a2a 6b77 6172 6773 2920 2d3e 2043 6f6d  **kwargs) -> Com
+00012500: 706f 6e65 6e74 3a0a 2020 2020 2020 2020  ponent:.        
+00012510: 2222 2252 6574 7572 6e73 206e 6577 2063  """Returns new c
+00012520: 6f6d 706f 6e65 6e74 2077 6974 6820 6120  omponent with a 
+00012530: 726f 7461 7465 6420 7265 6665 7265 6e63  rotated referenc
+00012540: 6520 746f 2074 6865 206f 7269 6769 6e61  e to the origina
+00012550: 6c2e 0a0a 2020 2020 2020 2020 4172 6773  l...        Args
+00012560: 3a0a 2020 2020 2020 2020 2020 2020 616e  :.            an
+00012570: 676c 653a 2069 6e20 6465 6772 6565 732e  gle: in degrees.
+00012580: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00012590: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
+000125a0: 746f 7279 2e66 756e 6374 696f 6e73 2069  tory.functions i
+000125b0: 6d70 6f72 7420 726f 7461 7465 0a0a 2020  mport rotate..  
+000125c0: 2020 2020 2020 7265 7475 726e 2072 6f74        return rot
+000125d0: 6174 6528 636f 6d70 6f6e 656e 743d 7365  ate(component=se
+000125e0: 6c66 2c20 616e 676c 653d 616e 676c 652c  lf, angle=angle,
+000125f0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00012600: 6465 6620 6164 645f 7061 6464 696e 6728  def add_padding(
+00012610: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
+00012620: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
+00012630: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00012640: 2073 616d 6520 636f 6d70 6f6e 656e 7420   same component 
+00012650: 7769 7468 2070 6164 6469 6e67 2e0a 0a20  with padding... 
+00012660: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
+00012670: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00012680: 2063 6f6d 706f 6e65 6e74 3a20 666f 7220   component: for 
+00012690: 7061 6464 696e 672e 0a20 2020 2020 2020  padding..       
+000126a0: 2020 2020 206c 6179 6572 733a 206c 6973       layers: lis
+000126b0: 7420 6f66 206c 6179 6572 732e 0a20 2020  t of layers..   
+000126c0: 2020 2020 2020 2020 2073 7566 6669 7820           suffix 
+000126d0: 666f 7220 6e61 6d65 2e0a 2020 2020 2020  for name..      
+000126e0: 2020 2020 2020 6465 6661 756c 743a 2064        default: d
+000126f0: 6566 6175 6c74 2070 6164 6469 6e67 2028  efault padding (
+00012700: 3530 756d 292e 0a20 2020 2020 2020 2020  50um)..         
+00012710: 2020 2074 6f70 3a20 6e6f 7274 6820 7061     top: north pa
+00012720: 6464 696e 672e 0a20 2020 2020 2020 2020  dding..         
+00012730: 2020 2062 6f74 746f 6d3a 2073 6f75 7468     bottom: south
+00012740: 2070 6164 6469 6e67 2e0a 2020 2020 2020   padding..      
+00012750: 2020 2020 2020 7269 6768 743a 2065 6173        right: eas
+00012760: 7420 7061 6464 696e 672e 0a20 2020 2020  t padding..     
+00012770: 2020 2020 2020 206c 6566 743a 2077 6573         left: wes
+00012780: 7420 7061 6464 696e 672e 0a20 2020 2020  t padding..     
+00012790: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+000127a0: 726f 6d20 6764 7366 6163 746f 7279 2e61  rom gdsfactory.a
+000127b0: 6464 5f70 6164 6469 6e67 2069 6d70 6f72  dd_padding impor
+000127c0: 7420 6164 645f 7061 6464 696e 670a 0a20  t add_padding.. 
+000127d0: 2020 2020 2020 2072 6574 7572 6e20 6164         return ad
+000127e0: 645f 7061 6464 696e 6728 636f 6d70 6f6e  d_padding(compon
+000127f0: 656e 743d 7365 6c66 2c20 2a2a 6b77 6172  ent=self, **kwar
+00012800: 6773 290a 0a20 2020 2064 6566 2061 6273  gs)..    def abs
+00012810: 6f72 6228 7365 6c66 2c20 7265 6665 7265  orb(self, refere
+00012820: 6e63 6529 202d 3e20 436f 6d70 6f6e 656e  nce) -> Componen
+00012830: 743a 0a20 2020 2020 2020 2022 2222 4162  t:.        """Ab
+00012840: 736f 7262 7320 706f 6c79 676f 6e73 2066  sorbs polygons f
+00012850: 726f 6d20 436f 6d70 6f6e 656e 7452 6566  rom ComponentRef
+00012860: 6572 656e 6365 2069 6e74 6f20 436f 6d70  erence into Comp
+00012870: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
+00012880: 4465 7374 726f 7973 2074 6865 2072 6566  Destroys the ref
+00012890: 6572 656e 6365 2069 6e20 7468 6520 7072  erence in the pr
+000128a0: 6f63 6573 7320 6275 7420 6b65 6570 696e  ocess but keepin
+000128b0: 6720 7468 6520 706f 6c79 676f 6e20 6765  g the polygon ge
+000128c0: 6f6d 6574 7279 2e0a 0a20 2020 2020 2020  ometry...       
+000128d0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000128e0: 2020 2072 6566 6572 656e 6365 3a20 436f     reference: Co
+000128f0: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+00012900: 2074 6f20 6265 2061 6273 6f72 6265 6420   to be absorbed 
+00012910: 696e 746f 2074 6865 2043 6f6d 706f 6e65  into the Compone
+00012920: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
+00012930: 2020 2020 2020 2020 6966 2072 6566 6572          if refer
+00012940: 656e 6365 206e 6f74 2069 6e20 7365 6c66  ence not in self
+00012950: 2e72 6566 6572 656e 6365 733a 0a20 2020  .references:.   
+00012960: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00012970: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00012980: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
+00012990: 7265 6665 7265 6e63 6520 796f 7520 6173  reference you as
+000129a0: 6b65 6420 746f 2061 6273 6f72 6220 646f  ked to absorb do
+000129b0: 6573 206e 6f74 2065 7869 7374 2069 6e20  es not exist in 
+000129c0: 7468 6973 2043 6f6d 706f 6e65 6e74 2e22  this Component."
+000129d0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000129e0: 2020 2020 2020 2072 6566 5f70 6f6c 7967         ref_polyg
+000129f0: 6f6e 7320 3d20 7265 6665 7265 6e63 652e  ons = reference.
+00012a00: 6765 745f 706f 6c79 676f 6e73 280a 2020  get_polygons(.  
+00012a10: 2020 2020 2020 2020 2020 6279 5f73 7065            by_spe
+00012a20: 633d 4661 6c73 652c 2069 6e63 6c75 6465  c=False, include
+00012a30: 5f70 6174 6873 3d46 616c 7365 2c20 6173  _paths=False, as
+00012a40: 5f61 7272 6179 3d46 616c 7365 0a20 2020  _array=False.   
+00012a50: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+00012a60: 656c 662e 5f61 6464 5f70 6f6c 7967 6f6e  elf._add_polygon
+00012a70: 7328 2a72 6566 5f70 6f6c 7967 6f6e 7329  s(*ref_polygons)
+00012a80: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00012a90: 6464 2872 6566 6572 656e 6365 2e67 6574  dd(reference.get
+00012aa0: 5f6c 6162 656c 7328 2929 0a20 2020 2020  _labels()).     
+00012ab0: 2020 2073 656c 662e 6164 6428 7265 6665     self.add(refe
+00012ac0: 7265 6e63 652e 6765 745f 7061 7468 7328  rence.get_paths(
+00012ad0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+00012ae0: 7265 6d6f 7665 2872 6566 6572 656e 6365  remove(reference
+00012af0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00012b00: 2073 656c 660a 0a20 2020 2064 6566 2072   self..    def r
+00012b10: 656d 6f76 6528 7365 6c66 2c20 6974 656d  emove(self, item
+00012b20: 7329 3a0a 2020 2020 2020 2020 2222 2252  s):.        """R
+00012b30: 656d 6f76 6573 2069 7465 6d73 2066 726f  emoves items fro
+00012b40: 6d20 6120 436f 6d70 6f6e 656e 742c 2077  m a Component, w
+00012b50: 6869 6368 2063 616e 2069 6e63 6c75 6465  hich can include
+00012b60: 2050 6f72 7473 2c20 506f 6c79 676f 6e53   Ports, PolygonS
+00012b70: 6574 7320 5c0a 2020 2020 2020 2020 4365  ets \.        Ce
+00012b80: 6c6c 5265 6665 7265 6e63 6573 2c20 436f  llReferences, Co
+00012b90: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+00012ba0: 7320 616e 6420 4c61 6265 6c73 2e0a 0a20  s and Labels... 
+00012bb0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00012bc0: 2020 2020 2020 2020 2069 7465 6d73 3a20           items: 
+00012bd0: 6c69 7374 206f 6620 4974 656d 7320 746f  list of Items to
+00012be0: 2062 6520 7265 6d6f 7665 6420 6672 6f6d   be removed from
+00012bf0: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
+00012c00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012c10: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
+00012c20: 7472 2869 7465 6d73 2c20 225f 5f69 7465  tr(items, "__ite
+00012c30: 725f 5f22 293a 0a20 2020 2020 2020 2020  r__"):.         
+00012c40: 2020 2069 7465 6d73 203d 205b 6974 656d     items = [item
+00012c50: 735d 0a20 2020 2020 2020 2066 6f72 2069  s].        for i
+00012c60: 7465 6d20 696e 2069 7465 6d73 3a0a 2020  tem in items:.  
+00012c70: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00012c80: 6e73 7461 6e63 6528 6974 656d 2c20 506f  nstance(item, Po
+00012c90: 7274 293a 0a20 2020 2020 2020 2020 2020  rt):.           
+00012ca0: 2020 2020 2073 656c 662e 706f 7274 7320       self.ports 
+00012cb0: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+00012cc0: 2069 6e20 7365 6c66 2e70 6f72 7473 2e69   in self.ports.i
+00012cd0: 7465 6d73 2829 2069 6620 7620 213d 2069  tems() if v != i
+00012ce0: 7465 6d7d 0a20 2020 2020 2020 2020 2020  tem}.           
+00012cf0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00012d00: 2869 7465 6d2c 2067 6473 746b 2e52 6566  (item, gdstk.Ref
+00012d10: 6572 656e 6365 293a 0a20 2020 2020 2020  erence):.       
+00012d20: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+00012d30: 656c 6c2e 7265 6d6f 7665 2869 7465 6d29  ell.remove(item)
+00012d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012d50: 2069 7465 6d2e 6f77 6e65 7220 3d20 4e6f   item.owner = No
+00012d60: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
+00012d70: 6c69 6620 6973 696e 7374 616e 6365 2869  lif isinstance(i
+00012d80: 7465 6d2c 2043 6f6d 706f 6e65 6e74 5265  tem, ComponentRe
+00012d90: 6665 7265 6e63 6529 3a0a 2020 2020 2020  ference):.      
+00012da0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+00012db0: 6566 6572 656e 6365 732e 7265 6d6f 7665  eferences.remove
+00012dc0: 2869 7465 6d29 0a20 2020 2020 2020 2020  (item).         
+00012dd0: 2020 2020 2020 2073 656c 662e 5f63 656c         self._cel
+00012de0: 6c2e 7265 6d6f 7665 2869 7465 6d2e 5f72  l.remove(item._r
+00012df0: 6566 6572 656e 6365 290a 2020 2020 2020  eference).      
+00012e00: 2020 2020 2020 2020 2020 6974 656d 2e6f            item.o
+00012e10: 776e 6572 203d 204e 6f6e 650a 2020 2020  wner = None.    
+00012e20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012e30: 2e5f 6e61 6d65 645f 7265 6665 7265 6e63  ._named_referenc
+00012e40: 6573 2e70 6f70 2869 7465 6d2e 6e61 6d65  es.pop(item.name
+00012e50: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00012e60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00012e70: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e72      self._cell.r
+00012e80: 656d 6f76 6528 6974 656d 290a 0a20 2020  emove(item)..   
+00012e90: 2020 2020 2073 656c 662e 5f62 625f 7661       self._bb_va
+00012ea0: 6c69 6420 3d20 4661 6c73 650a 2020 2020  lid = False.    
+00012eb0: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
+00012ec0: 0a20 2020 2064 6566 2068 6173 685f 6765  .    def hash_ge
+00012ed0: 6f6d 6574 7279 2873 656c 662c 2070 7265  ometry(self, pre
+00012ee0: 6369 7369 6f6e 3a20 666c 6f61 7420 3d20  cision: float = 
+00012ef0: 3165 2d34 2920 2d3e 2073 7472 3a0a 2020  1e-4) -> str:.  
+00012f00: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00012f10: 2061 6e20 5348 4131 2068 6173 6820 6f66   an SHA1 hash of
+00012f20: 2074 6865 2067 656f 6d65 7472 7920 696e   the geometry in
+00012f30: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
+00012f40: 0a20 2020 2020 2020 2046 6f72 2065 6163  .        For eac
+00012f50: 6820 6c61 7965 722c 2065 6163 6820 706f  h layer, each po
+00012f60: 6c79 676f 6e20 6973 2069 6e64 6976 6964  lygon is individ
+00012f70: 7561 6c6c 7920 6861 7368 6564 2061 6e64  ually hashed and
+00012f80: 2074 6865 6e20 7468 6520 706f 6c79 676f   then the polygo
+00012f90: 6e20 6861 7368 6573 0a20 2020 2020 2020  n hashes.       
+00012fa0: 2061 7265 2073 6f72 7465 642c 2074 6f20   are sorted, to 
+00012fb0: 656e 7375 7265 2074 6865 2068 6173 6820  ensure the hash 
+00012fc0: 7374 6179 7320 636f 6e73 7461 6e74 2072  stays constant r
+00012fd0: 6567 6172 646c 6573 7320 6f66 2074 6865  egardless of the
+00012fe0: 206f 7264 6572 696e 670a 2020 2020 2020   ordering.      
+00012ff0: 2020 7468 6520 706f 6c79 676f 6e73 2e20    the polygons. 
+00013000: 2053 696d 696c 6172 6c79 2c20 7468 6520   Similarly, the 
+00013010: 6c61 7965 7273 2061 7265 2073 6f72 7465  layers are sorte
+00013020: 6420 6279 2028 6c61 7965 722c 2064 6174  d by (layer, dat
+00013030: 6174 7970 6529 2e0a 0a20 2020 2020 2020  atype)...       
+00013040: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00013050: 2020 2070 7265 6369 7369 6f6e 3a20 526f     precision: Ro
+00013060: 756e 6469 6e67 2070 7265 6369 7369 6f6e  unding precision
+00013070: 2066 6f72 2074 6865 2074 6865 206f 626a   for the the obj
+00013080: 6563 7473 2069 6e20 7468 6520 436f 6d70  ects in the Comp
+00013090: 6f6e 656e 742e 0a20 2020 2020 2020 2020  onent..         
+000130a0: 2020 2020 2020 2046 6f72 2069 6e73 7461         For insta
+000130b0: 6e63 652c 2061 2070 7265 6369 7369 6f6e  nce, a precision
+000130c0: 206f 6620 3165 2d32 2077 696c 6c20 726f   of 1e-2 will ro
+000130d0: 756e 6420 6120 706f 696e 7420 6174 0a20  und a point at. 
+000130e0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000130f0: 302e 3132 342c 2031 2e37 3438 2920 746f  0.124, 1.748) to
+00013100: 2028 302e 3132 2c20 312e 3735 292e 0a0a   (0.12, 1.75)...
+00013110: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013120: 2020 2020 706f 6c79 676f 6e73 5f62 795f      polygons_by_
+00013130: 7370 6563 203d 2073 656c 662e 6765 745f  spec = self.get_
+00013140: 706f 6c79 676f 6e73 2862 795f 7370 6563  polygons(by_spec
+00013150: 3d54 7275 652c 2061 735f 6172 7261 793d  =True, as_array=
+00013160: 4661 6c73 6529 0a20 2020 2020 2020 206c  False).        l
+00013170: 6179 6572 7320 3d20 6e70 2e61 7272 6179  ayers = np.array
+00013180: 286c 6973 7428 706f 6c79 676f 6e73 5f62  (list(polygons_b
+00013190: 795f 7370 6563 2e6b 6579 7328 2929 290a  y_spec.keys())).
+000131a0: 2020 2020 2020 2020 736f 7274 6564 5f6c          sorted_l
+000131b0: 6179 6572 7320 3d20 6c61 7965 7273 5b6e  ayers = layers[n
+000131c0: 702e 6c65 7873 6f72 7428 286c 6179 6572  p.lexsort((layer
+000131d0: 735b 3a2c 2030 5d2c 206c 6179 6572 735b  s[:, 0], layers[
+000131e0: 3a2c 2031 5d29 295d 0a0a 2020 2020 2020  :, 1]))]..      
+000131f0: 2020 6669 6e61 6c5f 6861 7368 203d 2068    final_hash = h
+00013200: 6173 686c 6962 2e73 6861 3128 290a 2020  ashlib.sha1().  
+00013210: 2020 2020 2020 666f 7220 6c61 7965 7220        for layer 
+00013220: 696e 2073 6f72 7465 645f 6c61 7965 7273  in sorted_layers
+00013230: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
+00013240: 7965 725f 6861 7368 203d 2068 6173 686c  yer_hash = hashl
+00013250: 6962 2e73 6861 3128 6c61 7965 722e 6173  ib.sha1(layer.as
+00013260: 7479 7065 286e 702e 696e 7436 3429 292e  type(np.int64)).
+00013270: 6469 6765 7374 2829 0a20 2020 2020 2020  digest().       
+00013280: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
+00013290: 706f 6c79 676f 6e73 5f62 795f 7370 6563  polygons_by_spec
+000132a0: 5b74 7570 6c65 286c 6179 6572 295d 0a20  [tuple(layer)]. 
+000132b0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+000132c0: 6f6e 7320 3d20 5b5f 726e 6428 702e 706f  ons = [_rnd(p.po
+000132d0: 696e 7473 2c20 7072 6563 6973 696f 6e29  ints, precision)
+000132e0: 2066 6f72 2070 2069 6e20 706f 6c79 676f   for p in polygo
+000132f0: 6e73 5d0a 2020 2020 2020 2020 2020 2020  ns].            
+00013300: 706f 6c79 676f 6e5f 6861 7368 6573 203d  polygon_hashes =
+00013310: 206e 702e 736f 7274 285b 6861 7368 6c69   np.sort([hashli
+00013320: 622e 7368 6131 2870 292e 6469 6765 7374  b.sha1(p).digest
+00013330: 2829 2066 6f72 2070 2069 6e20 706f 6c79  () for p in poly
+00013340: 676f 6e73 5d29 0a20 2020 2020 2020 2020  gons]).         
+00013350: 2020 2066 696e 616c 5f68 6173 682e 7570     final_hash.up
+00013360: 6461 7465 286c 6179 6572 5f68 6173 6829  date(layer_hash)
+00013370: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00013380: 2070 6820 696e 2070 6f6c 7967 6f6e 5f68   ph in polygon_h
+00013390: 6173 6865 733a 0a20 2020 2020 2020 2020  ashes:.         
+000133a0: 2020 2020 2020 2066 696e 616c 5f68 6173         final_has
+000133b0: 682e 7570 6461 7465 2870 6829 0a0a 2020  h.update(ph)..  
+000133c0: 2020 2020 2020 7265 7475 726e 2066 696e        return fin
+000133d0: 616c 5f68 6173 682e 6865 7864 6967 6573  al_hash.hexdiges
+000133e0: 7428 290a 0a20 2020 2064 6566 2067 6574  t()..    def get
+000133f0: 5f6c 6162 656c 7328 0a20 2020 2020 2020  _labels(.       
+00013400: 2073 656c 662c 2061 7070 6c79 5f72 6570   self, apply_rep
+00013410: 6574 6974 696f 6e73 3d54 7275 652c 2064  etitions=True, d
+00013420: 6570 7468 3a20 4f70 7469 6f6e 616c 5b69  epth: Optional[i
+00013430: 6e74 5d20 3d20 4e6f 6e65 2c20 6c61 7965  nt] = None, laye
+00013440: 723d 4e6f 6e65 0a20 2020 2029 202d 3e20  r=None.    ) -> 
+00013450: 4c69 7374 5b4c 6162 656c 5d3a 0a20 2020  List[Label]:.   
+00013460: 2020 2020 2022 2222 5265 7475 726e 206c       """Return l
+00013470: 6162 656c 732e 0a0a 2020 2020 2020 2020  abels...        
+00013480: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00013490: 2020 6170 706c 795f 7265 7065 7469 7469    apply_repetiti
+000134a0: 6f6e 733a 2e0a 2020 2020 2020 2020 2020  ons:..          
+000134b0: 2020 6465 7074 683a 204e 6f6e 6520 7265    depth: None re
+000134c0: 7475 726e 7320 616c 6c20 6c61 6265 6c73  turns all labels
+000134d0: 2061 6e64 2030 2074 6f70 206c 6576 656c   and 0 top level
+000134e0: 2e0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+000134f0: 7965 723a 206c 6179 6572 7370 6563 2e0a  yer: layerspec..
+00013500: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013510: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+00013520: 6f72 792e 7064 6b20 696d 706f 7274 2067  ory.pdk import g
+00013530: 6574 5f6c 6179 6572 0a0a 2020 2020 2020  et_layer..      
+00013540: 2020 6966 206c 6179 6572 3a0a 2020 2020    if layer:.    
+00013550: 2020 2020 2020 2020 6c61 7965 722c 2074          layer, t
+00013560: 6578 7474 7970 6520 3d20 6765 745f 6c61  exttype = get_la
+00013570: 7965 7228 6c61 7965 7229 0a20 2020 2020  yer(layer).     
+00013580: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00013590: 2020 2020 2074 6578 7474 7970 6520 3d20       texttype = 
+000135a0: 4e6f 6e65 0a20 2020 2020 2020 2072 6574  None.        ret
+000135b0: 7572 6e20 7365 6c66 2e5f 6365 6c6c 2e67  urn self._cell.g
+000135c0: 6574 5f6c 6162 656c 7328 0a20 2020 2020  et_labels(.     
+000135d0: 2020 2020 2020 2061 7070 6c79 5f72 6570         apply_rep
+000135e0: 6574 6974 696f 6e73 3d61 7070 6c79 5f72  etitions=apply_r
+000135f0: 6570 6574 6974 696f 6e73 2c0a 2020 2020  epetitions,.    
+00013600: 2020 2020 2020 2020 6465 7074 683d 6465          depth=de
+00013610: 7074 682c 0a20 2020 2020 2020 2020 2020  pth,.           
+00013620: 206c 6179 6572 3d6c 6179 6572 2c0a 2020   layer=layer,.  
+00013630: 2020 2020 2020 2020 2020 7465 7874 7479            textty
+00013640: 7065 3d74 6578 7474 7970 652c 0a20 2020  pe=texttype,.   
+00013650: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00013660: 7265 6d6f 7665 5f6c 6162 656c 7328 7365  remove_labels(se
+00013670: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00013680: 2020 2020 2022 2222 5265 6d6f 7665 206c       """Remove l
+00013690: 6162 656c 732e 2222 220a 2020 2020 2020  abels.""".      
+000136a0: 2020 7365 6c66 2e5f 6365 6c6c 2e72 656d    self._cell.rem
+000136b0: 6f76 6528 2a73 656c 662e 6c61 6265 6c73  ove(*self.labels
+000136c0: 290a 0a20 2020 2023 2044 6570 7265 6361  )..    # Depreca
+000136d0: 7465 640a 2020 2020 6465 6620 6765 745f  ted.    def get_
+000136e0: 696e 666f 2873 656c 6629 3a0a 2020 2020  info(self):.    
+000136f0: 2020 2020 2222 2247 6174 6865 7273 2074      """Gathers t
+00013700: 6865 202e 696e 666f 2064 6963 7469 6f6e  he .info diction
+00013710: 6172 6965 7320 6672 6f6d 2065 7665 7279  aries from every
+00013720: 2073 7562 2d43 6f6d 706f 6e65 6e74 2061   sub-Component a
+00013730: 6e64 2072 6574 7572 6e73 2074 6865 6d20  nd returns them 
+00013740: 696e 2061 206c 6973 742e 0a0a 2020 2020  in a list...    
+00013750: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00013760: 2020 2020 2020 6465 7074 683a 2069 6e74        depth: int
+00013770: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
+00013780: 2020 2020 2020 2020 2049 6620 6e6f 7420           If not 
+00013790: 4e6f 6e65 2c20 6465 6669 6e65 7320 6672  None, defines fr
+000137a0: 6f6d 2068 6f77 206d 616e 7920 7265 6665  om how many refe
+000137b0: 7265 6e63 6520 6c65 7665 6c73 2074 6f0a  rence levels to.
+000137c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137d0: 7265 7472 6965 7665 2050 6f72 7473 2066  retrieve Ports f
+000137e0: 726f 6d2e 0a0a 2020 2020 2020 2020 5265  rom...        Re
+000137f0: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
+00013800: 2020 206c 6973 7420 6f66 2064 6963 7469     list of dicti
+00013810: 6f6e 6172 6965 730a 2020 2020 2020 2020  onaries.        
+00013820: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+00013830: 7468 6520 222e 696e 666f 2220 7072 6f70  the ".info" prop
+00013840: 6572 7479 2064 6963 7469 6f6e 6172 6965  erty dictionarie
+00013850: 7320 6672 6f6d 2061 6c6c 2073 7562 2d43  s from all sub-C
+00013860: 6f6d 706f 6e65 6e74 730a 2020 2020 2020  omponents.      
+00013870: 2020 2222 220a 2020 2020 2020 2020 445f    """.        D_
+00013880: 6c69 7374 203d 2073 656c 662e 6765 745f  list = self.get_
+00013890: 6465 7065 6e64 656e 6369 6573 2872 6563  dependencies(rec
+000138a0: 7572 7369 7665 3d54 7275 6529 0a20 2020  ursive=True).   
+000138b0: 2020 2020 2072 6574 7572 6e20 5b44 2e69       return [D.i
+000138c0: 6e66 6f2e 636f 7079 2829 2066 6f72 2044  nfo.copy() for D
+000138d0: 2069 6e20 445f 6c69 7374 5d0a 0a20 2020   in D_list]..   
+000138e0: 2064 6566 2072 656d 6170 5f6c 6179 6572   def remap_layer
+000138f0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+00013900: 206c 6179 6572 6d61 702c 2069 6e63 6c75   layermap, inclu
+00013910: 6465 5f6c 6162 656c 733a 2062 6f6f 6c20  de_labels: bool 
+00013920: 3d20 5472 7565 2c20 696e 636c 7564 655f  = True, include_
+00013930: 7061 7468 733a 2062 6f6f 6c20 3d20 5472  paths: bool = Tr
+00013940: 7565 0a20 2020 2029 202d 3e20 436f 6d70  ue.    ) -> Comp
+00013950: 6f6e 656e 743a 0a20 2020 2020 2020 2022  onent:.        "
+00013960: 2222 5265 7475 726e 7320 6120 636f 7079  ""Returns a copy
+00013970: 206f 6620 7468 6520 636f 6d70 6f6e 656e   of the componen
+00013980: 7420 7769 7468 2072 656d 6170 7065 6420  t with remapped 
+00013990: 6c61 7965 7273 2e0a 0a20 2020 2020 2020  layers...       
+000139a0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000139b0: 2020 206c 6179 6572 6d61 703a 2044 6963     layermap: Dic
+000139c0: 7469 6f6e 6172 7920 6f66 2076 616c 7565  tionary of value
+000139d0: 7320 696e 2066 6f72 6d61 7420 7b6c 6179  s in format {lay
+000139e0: 6572 5f66 726f 6d20 3a20 6c61 7965 725f  er_from : layer_
+000139f0: 746f 7d2e 0a20 2020 2020 2020 2020 2020  to}..           
+00013a00: 2069 6e63 6c75 6465 5f6c 6162 656c 733a   include_labels:
+00013a10: 2053 656c 6563 7473 2077 6865 7468 6572   Selects whether
+00013a20: 2074 6f20 6d6f 7665 204c 6162 656c 7320   to move Labels 
+00013a30: 616c 6f6e 6720 7769 7468 2070 6f6c 7967  along with polyg
+00013a40: 6f6e 732e 0a20 2020 2020 2020 2020 2020  ons..           
+00013a50: 2069 6e63 6c75 6465 5f70 6174 6873 3a20   include_paths: 
+00013a60: 5365 6c65 6374 7320 7768 6574 6865 7220  Selects whether 
+00013a70: 746f 206d 6f76 6520 5061 7468 7320 616c  to move Paths al
+00013a80: 6f6e 6720 7769 7468 2070 6f6c 7967 6f6e  ong with polygon
+00013a90: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00013aa0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+00013ab0: 203d 2073 656c 662e 636f 7079 2829 0a20   = self.copy(). 
+00013ac0: 2020 2020 2020 206c 6179 6572 6d61 7020         layermap 
+00013ad0: 3d20 7b5f 7061 7273 655f 6c61 7965 7228  = {_parse_layer(
+00013ae0: 6b29 3a20 5f70 6172 7365 5f6c 6179 6572  k): _parse_layer
+00013af0: 2876 2920 666f 7220 6b2c 2076 2069 6e20  (v) for k, v in 
+00013b00: 6c61 7965 726d 6170 2e69 7465 6d73 2829  layermap.items()
+00013b10: 7d0a 0a20 2020 2020 2020 2061 6c6c 5f44  }..        all_D
+00013b20: 203d 206c 6973 7428 636f 6d70 6f6e 656e   = list(componen
+00013b30: 742e 6765 745f 6465 7065 6e64 656e 6369  t.get_dependenci
+00013b40: 6573 2854 7275 6529 290a 2020 2020 2020  es(True)).      
+00013b50: 2020 616c 6c5f 442e 6170 7065 6e64 2863    all_D.append(c
+00013b60: 6f6d 706f 6e65 6e74 290a 2020 2020 2020  omponent).      
+00013b70: 2020 666f 7220 4420 696e 2061 6c6c 5f44    for D in all_D
+00013b80: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00013b90: 7220 7020 696e 2044 2e70 6f6c 7967 6f6e  r p in D.polygon
+00013ba0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00013bb0: 2020 206c 6179 6572 203d 2028 702e 6c61     layer = (p.la
+00013bc0: 7965 722c 2070 2e64 6174 6174 7970 6529  yer, p.datatype)
+00013bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013be0: 2069 6620 6c61 7965 7220 696e 206c 6179   if layer in lay
+00013bf0: 6572 6d61 703a 0a20 2020 2020 2020 2020  ermap:.         
+00013c00: 2020 2020 2020 2020 2020 206e 6577 5f6c             new_l
+00013c10: 6179 6572 203d 206c 6179 6572 6d61 705b  ayer = layermap[
+00013c20: 6c61 7965 725d 0a20 2020 2020 2020 2020  layer].         
+00013c30: 2020 2020 2020 2020 2020 2070 2e6c 6179             p.lay
+00013c40: 6572 203d 206e 6577 5f6c 6179 6572 5b30  er = new_layer[0
+00013c50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00013c60: 2020 2020 2020 702e 6461 7461 7479 7065        p.datatype
+00013c70: 203d 206e 6577 5f6c 6179 6572 5b31 5d0a   = new_layer[1].
+00013c80: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00013c90: 6e63 6c75 6465 5f6c 6162 656c 733a 0a20  nclude_labels:. 
+00013ca0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00013cb0: 6f72 206c 6162 656c 2069 6e20 442e 6c61  or label in D.la
+00013cc0: 6265 6c73 3a0a 2020 2020 2020 2020 2020  bels:.          
+00013cd0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+00013ce0: 616c 5f6c 6179 6572 203d 2028 6c61 6265  al_layer = (labe
+00013cf0: 6c2e 6c61 7965 722c 206c 6162 656c 2e74  l.layer, label.t
+00013d00: 6578 7474 7970 6529 0a20 2020 2020 2020  exttype).       
+00013d10: 2020 2020 2020 2020 2020 2020 206f 7269               ori
+00013d20: 6769 6e61 6c5f 6c61 7965 7220 3d20 5f70  ginal_layer = _p
+00013d30: 6172 7365 5f6c 6179 6572 286f 7269 6769  arse_layer(origi
+00013d40: 6e61 6c5f 6c61 7965 7229 0a20 2020 2020  nal_layer).     
+00013d50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00013d60: 6620 6f72 6967 696e 616c 5f6c 6179 6572  f original_layer
+00013d70: 2069 6e20 6c61 7965 726d 6170 3a0a 2020   in layermap:.  
+00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d90: 2020 2020 2020 6e65 775f 6c61 7965 7220        new_layer 
+00013da0: 3d20 6c61 7965 726d 6170 5b6f 7269 6769  = layermap[origi
+00013db0: 6e61 6c5f 6c61 7965 725d 0a20 2020 2020  nal_layer].     
+00013dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013dd0: 2020 206c 6162 656c 2e6c 6179 6572 203d     label.layer =
+00013de0: 206e 6577 5f6c 6179 6572 5b30 5d0a 2020   new_layer[0].  
+00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e00: 2020 2020 2020 6c61 6265 6c2e 7465 7874        label.text
+00013e10: 7479 7065 203d 206e 6577 5f6c 6179 6572  type = new_layer
+00013e20: 5b31 5d0a 0a20 2020 2020 2020 2020 2020  [1]..           
+00013e30: 2069 6620 696e 636c 7564 655f 7061 7468   if include_path
+00013e40: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00013e50: 2020 2066 6f72 2070 6174 6820 696e 2044     for path in D
+00013e60: 2e70 6174 6873 3a0a 2020 2020 2020 2020  .paths:.        
+00013e70: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00013e80: 6c61 7965 7273 203d 206c 6973 7428 7061  layers = list(pa
+00013e90: 7468 2e6c 6179 6572 7329 0a20 2020 2020  th.layers).     
+00013ea0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00013eb0: 6577 5f64 6174 6174 7970 6573 203d 206c  ew_datatypes = l
+00013ec0: 6973 7428 7061 7468 2e64 6174 6174 7970  ist(path.datatyp
+00013ed0: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00013ee0: 2020 2020 2020 2020 666f 7220 6c61 7965          for laye
+00013ef0: 725f 6e75 6d62 6572 2069 6e20 7261 6e67  r_number in rang
+00013f00: 6528 6c65 6e28 6e65 775f 6c61 7965 7273  e(len(new_layers
+00013f10: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00013f20: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
+00013f30: 696e 616c 5f6c 6179 6572 203d 205f 7061  inal_layer = _pa
+00013f40: 7273 655f 6c61 7965 7228 0a20 2020 2020  rse_layer(.     
+00013f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f60: 2020 2020 2020 2028 6e65 775f 6c61 7965         (new_laye
+00013f70: 7273 5b6c 6179 6572 5f6e 756d 6265 725d  rs[layer_number]
+00013f80: 2c20 6e65 775f 6461 7461 7479 7065 735b  , new_datatypes[
+00013f90: 6c61 7965 725f 6e75 6d62 6572 5d29 0a20  layer_number]). 
+00013fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00013fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fd0: 2069 6620 6f72 6967 696e 616c 5f6c 6179   if original_lay
+00013fe0: 6572 2069 6e20 6c61 7965 726d 6170 3a0a  er in layermap:.
+00013ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014000: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00014010: 6c61 7965 7220 3d20 6c61 7965 726d 6170  layer = layermap
+00014020: 5b6f 7269 6769 6e61 6c5f 6c61 7965 725d  [original_layer]
+00014030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014040: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00014050: 5f6c 6179 6572 735b 6c61 7965 725f 6e75  _layers[layer_nu
+00014060: 6d62 6572 5d20 3d20 6e65 775f 6c61 7965  mber] = new_laye
+00014070: 725b 305d 0a20 2020 2020 2020 2020 2020  r[0].           
+00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014090: 206e 6577 5f64 6174 6174 7970 6573 5b6c   new_datatypes[l
+000140a0: 6179 6572 5f6e 756d 6265 725d 203d 206e  ayer_number] = n
+000140b0: 6577 5f6c 6179 6572 5b31 5d0a 2020 2020  ew_layer[1].    
+000140c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140d0: 7061 7468 2e73 6574 5f6c 6179 6572 7328  path.set_layers(
+000140e0: 2a6e 6577 5f6c 6179 6572 7329 0a20 2020  *new_layers).   
+000140f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014100: 2070 6174 682e 7365 745f 6461 7461 7479   path.set_dataty
+00014110: 7065 7328 2a6e 6577 5f64 6174 6174 7970  pes(*new_datatyp
+00014120: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
+00014130: 726e 2063 6f6d 706f 6e65 6e74 0a0a 2020  rn component..  
+00014140: 2020 6465 6620 746f 5f33 6428 0a20 2020    def to_3d(.   
+00014150: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00014160: 2020 206c 6179 6572 5f76 6965 7773 3a20     layer_views: 
+00014170: 4f70 7469 6f6e 616c 5b4c 6179 6572 5669  Optional[LayerVi
+00014180: 6577 735d 203d 204e 6f6e 652c 0a20 2020  ews] = None,.   
+00014190: 2020 2020 206c 6179 6572 5f73 7461 636b       layer_stack
+000141a0: 3a20 4f70 7469 6f6e 616c 5b4c 6179 6572  : Optional[Layer
+000141b0: 5374 6163 6b5d 203d 204e 6f6e 652c 0a20  Stack] = None,. 
+000141c0: 2020 2020 2020 2065 7863 6c75 6465 5f6c         exclude_l
+000141d0: 6179 6572 733a 204f 7074 696f 6e61 6c5b  ayers: Optional[
+000141e0: 5475 706c 655b 4c61 7965 722c 202e 2e2e  Tuple[Layer, ...
+000141f0: 5d5d 203d 204e 6f6e 652c 0a20 2020 2029  ]] = None,.    )
+00014200: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00014210: 7572 6e20 436f 6d70 6f6e 656e 7420 3344  urn Component 3D
+00014220: 2074 7269 6d65 7368 2053 6365 6e65 2e0a   trimesh Scene..
+00014230: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00014240: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+00014250: 6e65 6e74 3a20 746f 2065 7874 7275 6465  nent: to extrude
+00014260: 2069 6e20 3344 2e0a 2020 2020 2020 2020   in 3D..        
+00014270: 2020 2020 6c61 7965 725f 7669 6577 733a      layer_views:
+00014280: 206c 6179 6572 2063 6f6c 6f72 7320 6672   layer colors fr
+00014290: 6f6d 204b 6c61 796f 7574 204c 6179 6572  om Klayout Layer
+000142a0: 2050 726f 7065 7274 6965 7320 6669 6c65   Properties file
+000142b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000142c0: 2020 4465 6661 756c 7473 2074 6f20 6163    Defaults to ac
+000142d0: 7469 7665 2050 444b 2e6c 6179 6572 5f76  tive PDK.layer_v
+000142e0: 6965 7773 2e0a 2020 2020 2020 2020 2020  iews..          
+000142f0: 2020 6c61 7965 725f 7374 6163 6b3a 2063    layer_stack: c
+00014300: 6f6e 7461 696e 7320 7468 6963 6b6e 6573  ontains thicknes
+00014310: 7320 616e 6420 7a6d 696e 2066 6f72 2065  s and zmin for e
+00014320: 6163 6820 6c61 7965 722e 0a20 2020 2020  ach layer..     
+00014330: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+00014340: 6c74 7320 746f 2061 6374 6976 6520 5044  lts to active PD
+00014350: 4b2e 6c61 7965 725f 7374 6163 6b2e 0a20  K.layer_stack.. 
+00014360: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+00014370: 6465 5f6c 6179 6572 733a 206c 6179 6572  de_layers: layer
+00014380: 7320 746f 2065 7863 6c75 6465 2e0a 0a20  s to exclude... 
+00014390: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000143a0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+000143b0: 7279 2e65 7870 6f72 742e 746f 5f33 6420  ry.export.to_3d 
+000143c0: 696d 706f 7274 2074 6f5f 3364 0a0a 2020  import to_3d..  
+000143d0: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
+000143e0: 3364 280a 2020 2020 2020 2020 2020 2020  3d(.            
+000143f0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00014400: 2020 6c61 7965 725f 7669 6577 733d 6c61    layer_views=la
+00014410: 7965 725f 7669 6577 732c 0a20 2020 2020  yer_views,.     
+00014420: 2020 2020 2020 206c 6179 6572 5f73 7461         layer_sta
+00014430: 636b 3d6c 6179 6572 5f73 7461 636b 2c0a  ck=layer_stack,.
+00014440: 2020 2020 2020 2020 2020 2020 6578 636c              excl
+00014450: 7564 655f 6c61 7965 7273 3d65 7863 6c75  ude_layers=exclu
+00014460: 6465 5f6c 6179 6572 732c 0a20 2020 2020  de_layers,.     
+00014470: 2020 2029 0a0a 2020 2020 6465 6620 746f     )..    def to
+00014480: 5f6e 7028 0a20 2020 2020 2020 2073 656c  _np(.        sel
+00014490: 662c 0a20 2020 2020 2020 206e 6d5f 7065  f,.        nm_pe
+000144a0: 725f 7069 7865 6c3a 2069 6e74 203d 2032  r_pixel: int = 2
+000144b0: 302c 0a20 2020 2020 2020 206c 6179 6572  0,.        layer
+000144c0: 733a 204c 6179 6572 7320 3d20 2828 312c  s: Layers = ((1,
+000144d0: 2030 292c 292c 0a20 2020 2020 2020 2076   0),),.        v
+000144e0: 616c 7565 733a 204f 7074 696f 6e61 6c5b  alues: Optional[
+000144f0: 5475 706c 655b 666c 6f61 742c 202e 2e2e  Tuple[float, ...
+00014500: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
+00014510: 2020 2070 6164 5f77 6964 7468 3a20 696e     pad_width: in
+00014520: 7420 3d20 312c 0a20 2020 2029 202d 3e20  t = 1,.    ) -> 
+00014530: 6e70 2e6e 6461 7272 6179 3a0a 2020 2020  np.ndarray:.    
+00014540: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
+00014550: 2070 6978 656c 6174 6564 206e 756d 7079   pixelated numpy
+00014560: 2061 7272 6179 2066 726f 6d20 436f 6d70   array from Comp
+00014570: 6f6e 656e 7420 706f 6c79 676f 6e73 2e0a  onent polygons..
+00014580: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00014590: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+000145a0: 6e65 6e74 3a20 436f 6d70 6f6e 656e 742e  nent: Component.
+000145b0: 0a20 2020 2020 2020 2020 2020 206e 6d5f  .            nm_
+000145c0: 7065 725f 7069 7865 6c3a 2079 6f75 2063  per_pixel: you c
+000145d0: 616e 2067 6f20 6672 6f6d 2032 3020 2863  an go from 20 (c
+000145e0: 6f61 7273 6529 2074 6f20 3420 2866 696e  oarse) to 4 (fin
+000145f0: 6529 2e0a 2020 2020 2020 2020 2020 2020  e)..            
+00014600: 6c61 7965 7273 3a20 746f 2063 6f6e 7665  layers: to conve
+00014610: 7274 2e20 4f72 6465 7220 6d61 7474 6572  rt. Order matter
+00014620: 7320 286c 6174 7465 7220 6f76 6572 7772  s (latter overwr
+00014630: 6974 6520 666f 726d 6572 292e 0a20 2020  ite former)..   
+00014640: 2020 2020 2020 2020 2076 616c 7565 733a           values:
+00014650: 2061 7373 6f63 6961 7465 6420 746f 2065   associated to e
+00014660: 6163 6820 6c61 7965 7220 2864 6566 6175  ach layer (defau
+00014670: 6c74 7320 746f 2031 292e 0a20 2020 2020  lts to 1)..     
+00014680: 2020 2020 2020 2070 6164 5f77 6964 7468         pad_width
+00014690: 3a20 7061 6464 696e 6720 7069 7865 6c73  : padding pixels
+000146a0: 2061 726f 756e 6420 7468 6520 696d 6167   around the imag
+000146b0: 652e 0a0a 2020 2020 2020 2020 2222 220a  e...        """.
+000146c0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+000146d0: 6661 6374 6f72 792e 6578 706f 7274 2e74  factory.export.t
+000146e0: 6f5f 6e70 2069 6d70 6f72 7420 746f 5f6e  o_np import to_n
+000146f0: 700a 0a20 2020 2020 2020 2072 6574 7572  p..        retur
+00014700: 6e20 746f 5f6e 7028 0a20 2020 2020 2020  n to_np(.       
+00014710: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00014720: 2020 2020 2020 206e 6d5f 7065 725f 7069         nm_per_pi
+00014730: 7865 6c3d 6e6d 5f70 6572 5f70 6978 656c  xel=nm_per_pixel
+00014740: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
+00014750: 7965 7273 3d6c 6179 6572 732c 0a20 2020  yers=layers,.   
+00014760: 2020 2020 2020 2020 2076 616c 7565 733d           values=
+00014770: 7661 6c75 6573 2c0a 2020 2020 2020 2020  values,.        
+00014780: 2020 2020 7061 645f 7769 6474 683d 7061      pad_width=pa
+00014790: 645f 7769 6474 682c 0a20 2020 2020 2020  d_width,.       
+000147a0: 2029 0a0a 2020 2020 6465 6620 7772 6974   )..    def writ
+000147b0: 655f 7374 6c28 0a20 2020 2020 2020 2073  e_stl(.        s
+000147c0: 656c 662c 0a20 2020 2020 2020 2066 696c  elf,.        fil
+000147d0: 6570 6174 683a 2073 7472 2c0a 2020 2020  epath: str,.    
+000147e0: 2020 2020 6c61 7965 725f 7374 6163 6b3a      layer_stack:
+000147f0: 204f 7074 696f 6e61 6c5b 4c61 7965 7253   Optional[LayerS
+00014800: 7461 636b 5d20 3d20 4e6f 6e65 2c0a 2020  tack] = None,.  
+00014810: 2020 2020 2020 6578 636c 7564 655f 6c61        exclude_la
+00014820: 7965 7273 3a20 4f70 7469 6f6e 616c 5b54  yers: Optional[T
+00014830: 7570 6c65 5b4c 6179 6572 2c20 2e2e 2e5d  uple[Layer, ...]
+00014840: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
+00014850: 2d3e 206e 702e 6e64 6172 7261 793a 0a20  -> np.ndarray:. 
+00014860: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
+00014870: 6120 436f 6d70 6f6e 656e 7420 746f 2053  a Component to S
+00014880: 544c 2066 6f72 2033 4420 7072 696e 7469  TL for 3D printi
+00014890: 6e67 2e0a 0a20 2020 2020 2020 2041 7267  ng...        Arg
+000148a0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+000148b0: 696c 6570 6174 683a 2074 6f20 7772 6974  ilepath: to writ
+000148c0: 6520 5354 4c20 746f 2e0a 2020 2020 2020  e STL to..      
+000148d0: 2020 2020 2020 6c61 7965 725f 7374 6163        layer_stac
+000148e0: 6b3a 2063 6f6e 7461 696e 7320 7468 6963  k: contains thic
+000148f0: 6b6e 6573 7320 616e 6420 7a6d 696e 2066  kness and zmin f
+00014900: 6f72 2065 6163 6820 6c61 7965 722e 0a20  or each layer.. 
+00014910: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+00014920: 6465 5f6c 6179 6572 733a 206c 6179 6572  de_layers: layer
+00014930: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
+00014940: 2020 2020 2020 2020 2020 7573 655f 6c61            use_la
+00014950: 7965 725f 6e61 6d65 3a20 4966 2054 7275  yer_name: If Tru
+00014960: 652c 2075 7365 7320 4c61 7965 724c 6576  e, uses LayerLev
+00014970: 656c 206e 616d 6573 2069 6e20 6f75 7470  el names in outp
+00014980: 7574 2066 696c 656e 616d 6573 2072 6174  ut filenames rat
+00014990: 6865 7220 7468 616e 2067 6473 5f6c 6179  her than gds_lay
+000149a0: 6572 2061 6e64 2067 6473 5f64 6174 6174  er and gds_datat
+000149b0: 7970 652e 0a20 2020 2020 2020 2020 2020  ype..           
+000149c0: 2068 756c 6c5f 696e 7661 6c69 645f 706f   hull_invalid_po
+000149d0: 6c79 676f 6e73 3a20 4966 2054 7275 652c  lygons: If True,
+000149e0: 2072 6570 6c61 6365 7320 696e 7661 6c69   replaces invali
+000149f0: 6420 706f 6c79 676f 6e73 2028 6465 7465  d polygons (dete
+00014a00: 726d 696e 6564 2062 7920 7368 6170 656c  rmined by shapel
+00014a10: 792e 506f 6c79 676f 6e2e 6973 5f76 616c  y.Polygon.is_val
+00014a20: 6964 2920 7769 7468 2069 7473 2063 6f6e  id) with its con
+00014a30: 7665 7820 6875 6c6c 2e0a 2020 2020 2020  vex hull..      
+00014a40: 2020 2020 2020 7363 616c 653a 204f 7074        scale: Opt
+00014a50: 696f 6e61 6c20 6661 6374 6f72 2062 7920  ional factor by 
+00014a60: 7768 6963 6820 746f 2073 6361 6c65 206d  which to scale m
+00014a70: 6573 6865 7320 6265 666f 7265 2077 7269  eshes before wri
+00014a80: 7469 6e67 2e0a 0a20 2020 2020 2020 2022  ting...        "
+00014a90: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00014aa0: 6764 7366 6163 746f 7279 2e65 7870 6f72  gdsfactory.expor
+00014ab0: 742e 746f 5f73 746c 2069 6d70 6f72 7420  t.to_stl import 
+00014ac0: 746f 5f73 746c 0a0a 2020 2020 2020 2020  to_stl..        
+00014ad0: 7265 7475 726e 2074 6f5f 7374 6c28 0a20  return to_stl(. 
+00014ae0: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00014af0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00014b00: 6570 6174 683d 6669 6c65 7061 7468 2c0a  epath=filepath,.
+00014b10: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00014b20: 725f 7374 6163 6b3d 6c61 7965 725f 7374  r_stack=layer_st
+00014b30: 6163 6b2c 0a20 2020 2020 2020 2020 2020  ack,.           
+00014b40: 2065 7863 6c75 6465 5f6c 6179 6572 733d   exclude_layers=
+00014b50: 6578 636c 7564 655f 6c61 7965 7273 2c0a  exclude_layers,.
+00014b60: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00014b70: 6566 2074 6f5f 676d 7368 280a 2020 2020  ef to_gmsh(.    
+00014b80: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00014b90: 2020 7479 7065 2c0a 2020 2020 2020 2020    type,.        
+00014ba0: 7a3d 4e6f 6e65 2c0a 2020 2020 2020 2020  z=None,.        
+00014bb0: 7873 6563 7469 6f6e 5f62 6f75 6e64 733d  xsection_bounds=
+00014bc0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
+00014bd0: 7965 725f 7374 6163 6b3d 4e6f 6e65 2c0a  yer_stack=None,.
+00014be0: 2020 2020 2020 2020 7761 6665 725f 7061          wafer_pa
+00014bf0: 6464 696e 673d 302e 302c 0a20 2020 2020  dding=0.0,.     
+00014c00: 2020 2077 6166 6572 5f6c 6179 6572 3d4c     wafer_layer=L
+00014c10: 4159 4552 2e57 4146 4552 2c0a 2020 2020  AYER.WAFER,.    
+00014c20: 2020 2020 2a61 7267 732c 0a20 2020 2020      *args,.     
+00014c30: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
+00014c40: 2029 3a0a 2020 2020 2020 2020 2222 2252   ):.        """R
+00014c50: 6574 7572 6e73 2061 2067 6d73 6820 6d73  eturns a gmsh ms
+00014c60: 6820 6f66 2074 6865 2063 6f6d 706f 6e65  h of the compone
+00014c70: 6e74 2066 6f72 2066 696e 6974 6520 656c  nt for finite el
+00014c80: 656d 656e 7420 7369 6d75 6c61 7469 6f6e  ement simulation
+00014c90: 2e0a 0a20 2020 2020 2020 2041 7267 756d  ...        Argum
+00014ca0: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
+00014cb0: 2020 7479 7065 3a20 6f6e 6520 6f66 2022    type: one of "
+00014cc0: 7879 222c 2022 757a 222c 206f 7220 2233  xy", "uz", or "3
+00014cd0: 4422 2e20 4465 7465 726d 696e 6573 2074  D". Determines t
+00014ce0: 6865 2074 7970 6520 6f66 206d 6573 6820  he type of mesh 
+00014cf0: 746f 2072 6574 7572 6e2e 0a20 2020 2020  to return..     
+00014d00: 2020 2020 2020 207a 3a20 7573 6564 2074         z: used t
+00014d10: 6f20 6465 6669 6e65 207a 2d73 6c69 6365  o define z-slice
+00014d20: 2066 6f72 2078 7920 6d65 7368 696e 670a   for xy meshing.
+00014d30: 2020 2020 2020 2020 2020 2020 7873 6563              xsec
+00014d40: 7469 6f6e 5f62 6f75 6e64 733a 2075 7365  tion_bounds: use
+00014d50: 6420 746f 2064 6566 696e 6520 696e 2d70  d to define in-p
+00014d60: 6c61 6e65 206c 696e 6520 666f 7220 757a  lane line for uz
+00014d70: 206d 6573 6869 6e67 0a20 2020 2020 2020   meshing.       
+00014d80: 2020 2020 2077 6166 6572 5f70 6164 6469       wafer_paddi
+00014d90: 6e67 3a20 7061 6464 696e 6720 6265 796f  ng: padding beyo
+00014da0: 6e64 2062 626f 7820 746f 2061 6464 2074  nd bbox to add t
+00014db0: 6f20 5741 4645 5220 6c61 7965 7273 2e0a  o WAFER layers..
+00014dc0: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+00014dd0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00014de0: 2020 2041 7267 756d 656e 7473 2066 6f72     Arguments for
+00014df0: 2074 6865 2074 6172 6765 7420 6d65 7368   the target mesh
+00014e00: 696e 6720 6675 6e63 7469 6f6e 2069 6e20  ing function in 
+00014e10: 6764 7366 6163 746f 7279 2e73 696d 756c  gdsfactory.simul
+00014e20: 6174 696f 6e2e 676d 7368 0a20 2020 2020  ation.gmsh.     
+00014e30: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+00014e40: 2041 6464 2057 4146 4552 206c 6179 6572   Add WAFER layer
+00014e50: 3a0a 2020 2020 2020 2020 7061 6464 6564  :.        padded
+00014e60: 5f63 6f6d 706f 6e65 6e74 203d 2043 6f6d  _component = Com
+00014e70: 706f 6e65 6e74 2829 0a20 2020 2020 2020  ponent().       
+00014e80: 2070 6164 6465 645f 636f 6d70 6f6e 656e   padded_componen
+00014e90: 7420 3c3c 2073 656c 660a 2020 2020 2020  t << self.      
+00014ea0: 2020 2878 6d69 6e2c 2079 6d69 6e29 2c20    (xmin, ymin), 
+00014eb0: 2878 6d61 782c 2079 6d61 7829 203d 2073  (xmax, ymax) = s
+00014ec0: 656c 662e 6262 6f78 0a20 2020 2020 2020  elf.bbox.       
+00014ed0: 2070 6f69 6e74 7320 3d20 5b0a 2020 2020   points = [.    
+00014ee0: 2020 2020 2020 2020 5b78 6d69 6e20 2d20          [xmin - 
+00014ef0: 7761 6665 725f 7061 6464 696e 672c 2079  wafer_padding, y
+00014f00: 6d69 6e20 2d20 7761 6665 725f 7061 6464  min - wafer_padd
+00014f10: 696e 675d 2c0a 2020 2020 2020 2020 2020  ing],.          
+00014f20: 2020 5b78 6d61 7820 2b20 7761 6665 725f    [xmax + wafer_
+00014f30: 7061 6464 696e 672c 2079 6d69 6e20 2d20  padding, ymin - 
+00014f40: 7761 6665 725f 7061 6464 696e 675d 2c0a  wafer_padding],.
+00014f50: 2020 2020 2020 2020 2020 2020 5b78 6d61              [xma
+00014f60: 7820 2b20 7761 6665 725f 7061 6464 696e  x + wafer_paddin
+00014f70: 672c 2079 6d61 7820 2b20 7761 6665 725f  g, ymax + wafer_
+00014f80: 7061 6464 696e 675d 2c0a 2020 2020 2020  padding],.      
+00014f90: 2020 2020 2020 5b78 6d69 6e20 2d20 7761        [xmin - wa
+00014fa0: 6665 725f 7061 6464 696e 672c 2079 6d61  fer_padding, yma
+00014fb0: 7820 2b20 7761 6665 725f 7061 6464 696e  x + wafer_paddin
+00014fc0: 675d 2c0a 2020 2020 2020 2020 5d0a 2020  g],.        ].  
+00014fd0: 2020 2020 2020 7061 6464 6564 5f63 6f6d        padded_com
+00014fe0: 706f 6e65 6e74 2e61 6464 5f70 6f6c 7967  ponent.add_polyg
+00014ff0: 6f6e 2870 6f69 6e74 732c 206c 6179 6572  on(points, layer
+00015000: 3d77 6166 6572 5f6c 6179 6572 290a 0a20  =wafer_layer).. 
+00015010: 2020 2020 2020 2069 6620 6c61 7965 725f         if layer_
+00015020: 7374 6163 6b20 6973 204e 6f6e 653a 0a20  stack is None:. 
+00015030: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00015040: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00015050: 2020 2020 2020 2020 2020 2020 2027 4120               'A 
+00015060: 4c61 7965 7253 7461 636b 206d 7573 7420  LayerStack must 
+00015070: 6265 2070 726f 7669 6465 6420 7468 726f  be provided thro
+00015080: 7567 6820 6172 6775 6d65 6e74 2022 6c61  ugh argument "la
+00015090: 7965 725f 7374 6163 6b22 2e27 0a20 2020  yer_stack".'.   
+000150a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000150b0: 2020 2069 6620 7479 7065 203d 3d20 2278     if type == "x
+000150c0: 7922 3a0a 2020 2020 2020 2020 2020 2020  y":.            
+000150d0: 6966 207a 2069 7320 4e6f 6e65 3a0a 2020  if z is None:.  
+000150e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000150f0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015110: 2020 2020 2746 6f72 2078 792d 6d65 7368      'For xy-mesh
+00015120: 696e 672c 2061 207a 2d76 616c 7565 206d  ing, a z-value m
+00015130: 7573 7420 6265 2070 726f 7669 6465 6420  ust be provided 
+00015140: 7669 6120 7468 6520 666c 6f61 7420 6172  via the float ar
+00015150: 6775 6d65 6e74 2022 7a22 2e27 0a20 2020  gument "z".'.   
+00015160: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00015170: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+00015180: 6764 7366 6163 746f 7279 2e73 696d 756c  gdsfactory.simul
+00015190: 6174 696f 6e2e 676d 7368 2e78 795f 7873  ation.gmsh.xy_xs
+000151a0: 6563 7469 6f6e 5f6d 6573 6820 696d 706f  ection_mesh impo
+000151b0: 7274 2078 795f 7873 6563 7469 6f6e 5f6d  rt xy_xsection_m
+000151c0: 6573 680a 0a20 2020 2020 2020 2020 2020  esh..           
+000151d0: 2072 6574 7572 6e20 7879 5f78 7365 6374   return xy_xsect
+000151e0: 696f 6e5f 6d65 7368 2870 6164 6465 645f  ion_mesh(padded_
+000151f0: 636f 6d70 6f6e 656e 742c 207a 2c20 6c61  component, z, la
+00015200: 7965 725f 7374 6163 6b2c 202a 2a6b 7761  yer_stack, **kwa
+00015210: 7267 7329 0a20 2020 2020 2020 2065 6c69  rgs).        eli
+00015220: 6620 7479 7065 203d 3d20 2275 7a22 3a0a  f type == "uz":.
+00015230: 2020 2020 2020 2020 2020 2020 6966 2078              if x
+00015240: 7365 6374 696f 6e5f 626f 756e 6473 2069  section_bounds i
+00015250: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00015260: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00015270: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00015280: 2020 2020 2020 2020 2020 2020 2020 2246                "F
+00015290: 6f72 2075 7a2d 6d65 7368 696e 672c 2079  or uz-meshing, y
+000152a0: 6f75 206d 7573 7420 7072 6f76 6964 6520  ou must provide 
+000152b0: 6120 6c69 6e65 2069 6e20 7468 6520 7879  a line in the xy
+000152c0: 2d70 6c61 6e65 2022 0a20 2020 2020 2020  -plane ".       
+000152d0: 2020 2020 2020 2020 2020 2020 2022 7669               "vi
+000152e0: 6120 7468 6520 5475 706c 6520 6172 6775  a the Tuple argu
+000152f0: 6d65 6e74 205b 5b78 312c 7931 5d2c 205b  ment [[x1,y1], [
+00015300: 7832 2c79 325d 5d20 7873 6563 7469 6f6e  x2,y2]] xsection
+00015310: 5f62 6f75 6e64 732e 220a 2020 2020 2020  _bounds.".      
+00015320: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00015330: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+00015340: 6661 6374 6f72 792e 7369 6d75 6c61 7469  factory.simulati
+00015350: 6f6e 2e67 6d73 682e 757a 5f78 7365 6374  on.gmsh.uz_xsect
+00015360: 696f 6e5f 6d65 7368 2069 6d70 6f72 7420  ion_mesh import 
+00015370: 757a 5f78 7365 6374 696f 6e5f 6d65 7368  uz_xsection_mesh
+00015380: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00015390: 7475 726e 2075 7a5f 7873 6563 7469 6f6e  turn uz_xsection
+000153a0: 5f6d 6573 6828 0a20 2020 2020 2020 2020  _mesh(.         
+000153b0: 2020 2020 2020 2070 6164 6465 645f 636f         padded_co
+000153c0: 6d70 6f6e 656e 742c 2078 7365 6374 696f  mponent, xsectio
+000153d0: 6e5f 626f 756e 6473 2c20 6c61 7965 725f  n_bounds, layer_
+000153e0: 7374 6163 6b2c 202a 2a6b 7761 7267 730a  stack, **kwargs.
+000153f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00015400: 2020 2020 2020 656c 6966 2074 7970 6520        elif type 
+00015410: 3d3d 2022 3344 223a 0a20 2020 2020 2020  == "3D":.       
+00015420: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
+00015430: 746f 7279 2e73 696d 756c 6174 696f 6e2e  tory.simulation.
+00015440: 676d 7368 2e78 797a 5f6d 6573 6820 696d  gmsh.xyz_mesh im
+00015450: 706f 7274 2078 797a 5f6d 6573 680a 0a20  port xyz_mesh.. 
+00015460: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00015470: 6e20 7879 7a5f 6d65 7368 2870 6164 6465  n xyz_mesh(padde
+00015480: 645f 636f 6d70 6f6e 656e 742c 206c 6179  d_component, lay
+00015490: 6572 5f73 7461 636b 2c20 2a2a 6b77 6172  er_stack, **kwar
+000154a0: 6773 290a 2020 2020 2020 2020 656c 7365  gs).        else
+000154b0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000154c0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+000154d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154e0: 2752 6571 7569 7265 6420 6172 6775 6d65  'Required argume
+000154f0: 6e74 2022 7479 7065 2220 6d75 7374 2062  nt "type" must b
+00015500: 6520 6f6e 6520 6f66 2022 7879 222c 2022  e one of "xy", "
+00015510: 757a 222c 206f 7220 2233 4422 2e27 0a20  uz", or "3D".'. 
+00015520: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00015530: 2020 6465 6620 6f66 6673 6574 280a 2020    def offset(.  
+00015540: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00015550: 2020 2020 6469 7374 616e 6365 3a20 666c      distance: fl
+00015560: 6f61 7420 3d20 302e 312c 0a20 2020 2020  oat = 0.1,.     
+00015570: 2020 2070 6f6c 7967 6f6e 733d 4e6f 6e65     polygons=None
+00015580: 2c0a 2020 2020 2020 2020 7573 655f 756e  ,.        use_un
+00015590: 696f 6e3a 2062 6f6f 6c20 3d20 5472 7565  ion: bool = True
+000155a0: 2c0a 2020 2020 2020 2020 7072 6563 6973  ,.        precis
+000155b0: 696f 6e3a 2066 6c6f 6174 203d 2031 652d  ion: float = 1e-
+000155c0: 342c 0a20 2020 2020 2020 206a 6f69 6e3a  4,.        join:
+000155d0: 2073 7472 203d 2022 6d69 7465 7222 2c0a   str = "miter",.
+000155e0: 2020 2020 2020 2020 746f 6c65 7261 6e63          toleranc
+000155f0: 653a 2069 6e74 203d 2032 2c0a 2020 2020  e: int = 2,.    
+00015600: 2020 2020 6c61 7965 723a 204c 6179 6572      layer: Layer
+00015610: 5370 6563 203d 2022 5747 222c 0a20 2020  Spec = "WG",.   
+00015620: 2029 202d 3e20 436f 6d70 6f6e 656e 743a   ) -> Component:
+00015630: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00015640: 726e 7320 6e65 7720 436f 6d70 6f6e 656e  rns new Componen
+00015650: 7420 7769 7468 2070 6f6c 7967 6f6e 7320  t with polygons 
+00015660: 6572 6f64 6564 206f 7220 6469 6c61 7465  eroded or dilate
+00015670: 6420 6279 2061 6e20 6f66 6673 6574 2e0a  d by an offset..
+00015680: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00015690: 2020 2020 2020 2020 2020 2064 6973 7461             dista
+000156a0: 6e63 653a 2044 6973 7461 6e63 6520 746f  nce: Distance to
+000156b0: 206f 6666 7365 7420 706f 6c79 676f 6e73   offset polygons
+000156c0: 2e20 506f 7369 7469 7665 2076 616c 7565  . Positive value
+000156d0: 7320 6578 7061 6e64 2c20 6e65 6761 7469  s expand, negati
+000156e0: 7665 2073 6872 696e 6b2e 0a20 2020 2020  ve shrink..     
+000156f0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+00015700: 3a20 4465 7369 7265 6420 7072 6563 6973  : Desired precis
+00015710: 696f 6e20 666f 7220 726f 756e 6469 6e67  ion for rounding
+00015720: 2076 6572 7465 7820 636f 6f72 6469 6e61   vertex coordina
+00015730: 7465 732e 0a20 2020 2020 2020 2020 2020  tes..           
+00015740: 206a 6f69 6e3a 207b 276d 6974 6572 272c   join: {'miter',
+00015750: 2027 6265 7665 6c27 2c20 2772 6f75 6e64   'bevel', 'round
+00015760: 277d 2054 7970 6520 6f66 206a 6f69 6e20  '} Type of join 
+00015770: 7573 6564 2074 6f20 6372 6561 7465 2070  used to create p
+00015780: 6f6c 7967 6f6e 206f 6666 7365 740a 2020  olygon offset.  
+00015790: 2020 2020 2020 2020 2020 746f 6c65 7261            tolera
+000157a0: 6e63 653a 2046 6f72 206d 6974 6572 206a  nce: For miter j
+000157b0: 6f69 6e74 732c 2074 6869 7320 6e75 6d62  oints, this numb
+000157c0: 6572 206d 7573 7420 6265 2061 7420 6c65  er must be at le
+000157d0: 6173 7420 3220 7265 7072 6573 656e 7473  ast 2 represents
+000157e0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+000157f0: 2020 206d 6178 696d 616c 2064 6973 7461     maximal dista
+00015800: 6e63 6520 696e 206d 756c 7469 706c 6573  nce in multiples
+00015810: 206f 6620 6f66 6673 6574 2062 6574 7765   of offset betwe
+00015820: 656e 206e 6577 2076 6572 7469 6365 7320  en new vertices 
+00015830: 616e 6420 7468 6569 720a 2020 2020 2020  and their.      
+00015840: 2020 2020 2020 2020 6f72 6967 696e 616c          original
+00015850: 2070 6f73 6974 696f 6e20 6265 666f 7265   position before
+00015860: 2062 6576 656c 696e 6720 746f 2061 766f   beveling to avo
+00015870: 6964 2073 7069 6b65 7320 6174 2061 6375  id spikes at acu
+00015880: 7465 206a 6f69 6e74 732e 2046 6f72 0a20  te joints. For. 
+00015890: 2020 2020 2020 2020 2020 2020 2072 6f75               rou
+000158a0: 6e64 206a 6f69 6e74 732c 2069 7420 696e  nd joints, it in
+000158b0: 6469 6361 7465 7320 7468 6520 6375 7276  dicates the curv
+000158c0: 6174 7572 6520 7265 736f 6c75 7469 6f6e  ature resolution
+000158d0: 2069 6e20 6e75 6d62 6572 206f 660a 2020   in number of.  
+000158e0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+000158f0: 7473 2070 6572 2066 756c 6c20 6369 7263  ts per full circ
+00015900: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
+00015910: 6c61 7965 723a 2053 7065 6369 6669 6320  layer: Specific 
+00015920: 6c61 7965 7220 666f 7220 6e65 7720 706f  layer for new po
+00015930: 6c79 676f 6e73 2e0a 0a20 2020 2020 2020  lygons...       
+00015940: 2022 2222 0a20 2020 2020 2020 2069 6d70   """.        imp
+00015950: 6f72 7420 6764 7366 6163 746f 7279 2061  ort gdsfactory a
+00015960: 7320 6766 0a0a 2020 2020 2020 2020 6764  s gf..        gd
+00015970: 735f 6c61 7965 722c 2067 6473 5f64 6174  s_layer, gds_dat
+00015980: 6174 7970 6520 3d20 6766 2e67 6574 5f6c  atype = gf.get_l
+00015990: 6179 6572 286c 6179 6572 290a 2020 2020  ayer(layer).    
+000159a0: 2020 2020 7020 3d20 6764 7374 6b2e 6f66      p = gdstk.of
+000159b0: 6673 6574 280a 2020 2020 2020 2020 2020  fset(.          
+000159c0: 2020 706f 6c79 676f 6e73 206f 7220 7365    polygons or se
+000159d0: 6c66 2e67 6574 5f70 6f6c 7967 6f6e 7328  lf.get_polygons(
+000159e0: 292c 0a20 2020 2020 2020 2020 2020 2064  ),.            d
+000159f0: 6973 7461 6e63 653d 6469 7374 616e 6365  istance=distance
+00015a00: 2c0a 2020 2020 2020 2020 2020 2020 6a6f  ,.            jo
+00015a10: 696e 3d6a 6f69 6e2c 0a20 2020 2020 2020  in=join,.       
+00015a20: 2020 2020 2074 6f6c 6572 616e 6365 3d74       tolerance=t
+00015a30: 6f6c 6572 616e 6365 2c0a 2020 2020 2020  olerance,.      
+00015a40: 2020 2020 2020 7072 6563 6973 696f 6e3d        precision=
+00015a50: 7072 6563 6973 696f 6e2c 0a20 2020 2020  precision,.     
+00015a60: 2020 2020 2020 2075 7365 5f75 6e69 6f6e         use_union
+00015a70: 3d75 7365 5f75 6e69 6f6e 2c0a 2020 2020  =use_union,.    
+00015a80: 2020 2020 2020 2020 6c61 7965 723d 6764          layer=gd
+00015a90: 735f 6c61 7965 722c 0a20 2020 2020 2020  s_layer,.       
+00015aa0: 2020 2020 2064 6174 6174 7970 653d 6764       datatype=gd
+00015ab0: 735f 6461 7461 7479 7065 2c0a 2020 2020  s_datatype,.    
+00015ac0: 2020 2020 290a 0a20 2020 2020 2020 2063      )..        c
+00015ad0: 6f6d 706f 6e65 6e74 203d 2067 662e 436f  omponent = gf.Co
+00015ae0: 6d70 6f6e 656e 7428 290a 2020 2020 2020  mponent().      
+00015af0: 2020 636f 6d70 6f6e 656e 742e 6164 645f    component.add_
+00015b00: 706f 6c79 676f 6e28 702c 206c 6179 6572  polygon(p, layer
+00015b10: 3d6c 6179 6572 290a 2020 2020 2020 2020  =layer).        
+00015b20: 7265 7475 726e 2063 6f6d 706f 6e65 6e74  return component
+00015b30: 0a0a 0a64 6566 2064 6563 6c61 7261 7469  ...def declarati
+00015b40: 7665 5f63 6f6d 706f 6e65 6e74 2863 6c73  ve_component(cls
+00015b50: 293a 0a20 2020 2064 6563 6c20 3d20 636c  ):.    decl = cl
+00015b60: 7328 290a 2020 2020 636f 6d70 203d 2043  s().    comp = C
+00015b70: 6f6d 706f 6e65 6e74 2829 0a20 2020 2066  omponent().    f
+00015b80: 6f72 206b 2c20 7620 696e 2064 6563 6c2e  or k, v in decl.
+00015b90: 5f5f 636c 6173 735f 5f2e 5f5f 6469 6374  __class__.__dict
+00015ba0: 5f5f 2e69 7465 6d73 2829 3a0a 2020 2020  __.items():.    
+00015bb0: 2020 2020 6966 206b 2e73 7461 7274 7377      if k.startsw
+00015bc0: 6974 6828 225f 2229 206f 7220 6361 6c6c  ith("_") or call
+00015bd0: 6162 6c65 2876 293a 0a20 2020 2020 2020  able(v):.       
+00015be0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00015bf0: 2020 2020 2020 7265 6620 3d20 636f 6d70        ref = comp
+00015c00: 203c 3c20 760a 2020 2020 2020 2020 7365   << v.        se
+00015c10: 7461 7474 7228 636f 6d70 2c20 6b2c 2072  tattr(comp, k, r
+00015c20: 6566 290a 2020 2020 2020 2020 7365 7461  ef).        seta
+00015c30: 7474 7228 6465 636c 2c20 6b2c 2072 6566  ttr(decl, k, ref
+00015c40: 290a 2020 2020 666f 7220 7031 2c20 7032  ).    for p1, p2
+00015c50: 2069 6e20 6465 636c 2e63 6f6e 6e65 6374   in decl.connect
+00015c60: 696f 6e73 2829 3a0a 2020 2020 2020 2020  ions():.        
+00015c70: 7031 2e72 6566 6572 656e 6365 2e63 6f6e  p1.reference.con
+00015c80: 6e65 6374 2870 312e 6e61 6d65 2c20 7032  nect(p1.name, p2
+00015c90: 2e72 6566 6572 656e 6365 2e70 6f72 7473  .reference.ports
+00015ca0: 5b70 322e 6e61 6d65 5d29 0a20 2020 2066  [p2.name]).    f
+00015cb0: 6f72 206e 616d 652c 2070 2069 6e20 6465  or name, p in de
+00015cc0: 636c 2e70 6f72 7473 2829 2e69 7465 6d73  cl.ports().items
+00015cd0: 2829 3a0a 2020 2020 2020 2020 636f 6d70  ():.        comp
+00015ce0: 2e61 6464 5f70 6f72 7428 6e61 6d65 2c20  .add_port(name, 
+00015cf0: 706f 7274 3d70 2e72 6566 6572 656e 6365  port=p.reference
+00015d00: 2e70 6f72 7473 5b70 2e6e 616d 655d 290a  .ports[p.name]).
+00015d10: 2020 2020 7265 7475 726e 2063 6f6d 700a      return comp.
+00015d20: 0a0a 6465 6620 636f 7079 280a 2020 2020  ..def copy(.    
+00015d30: 443a 2043 6f6d 706f 6e65 6e74 2c0a 2020  D: Component,.  
+00015d40: 2020 7265 6665 7265 6e63 6573 3d4e 6f6e    references=Non
+00015d50: 652c 0a20 2020 2070 6f72 7473 3d4e 6f6e  e,.    ports=Non
+00015d60: 652c 0a20 2020 2070 6f6c 7967 6f6e 733d  e,.    polygons=
+00015d70: 4e6f 6e65 2c0a 2020 2020 7061 7468 733d  None,.    paths=
+00015d80: 4e6f 6e65 2c0a 2020 2020 6e61 6d65 3d4e  None,.    name=N
+00015d90: 6f6e 652c 0a20 2020 206c 6162 656c 733d  one,.    labels=
+00015da0: 4e6f 6e65 2c0a 2920 2d3e 2043 6f6d 706f  None,.) -> Compo
+00015db0: 6e65 6e74 3a0a 2020 2020 2222 2252 6574  nent:.    """Ret
+00015dc0: 7572 6e73 2061 2043 6f6d 706f 6e65 6e74  urns a Component
+00015dd0: 2063 6f70 792e 0a0a 2020 2020 4172 6773   copy...    Args
+00015de0: 3a0a 2020 2020 2020 2020 443a 2063 6f6d  :.        D: com
+00015df0: 706f 6e65 6e74 2074 6f20 636f 7079 2e0a  ponent to copy..
+00015e00: 2020 2020 2222 220a 2020 2020 445f 636f      """.    D_co
+00015e10: 7079 203d 2043 6f6d 706f 6e65 6e74 2829  py = Component()
+00015e20: 0a20 2020 2044 5f63 6f70 792e 696e 666f  .    D_copy.info
+00015e30: 203d 2044 2e69 6e66 6f0a 2020 2020 2320   = D.info.    # 
+00015e40: 445f 636f 7079 2e5f 6365 6c6c 203d 2044  D_copy._cell = D
+00015e50: 2e5f 6365 6c6c 2e63 6f70 7928 6e61 6d65  ._cell.copy(name
+00015e60: 3d44 5f63 6f70 792e 6e61 6d65 290a 0a20  =D_copy.name).. 
+00015e70: 2020 2066 6f72 2072 6566 2069 6e20 7265     for ref in re
+00015e80: 6665 7265 6e63 6573 2069 6620 7265 6665  ferences if refe
+00015e90: 7265 6e63 6573 2069 7320 6e6f 7420 4e6f  rences is not No
+00015ea0: 6e65 2065 6c73 6520 442e 7265 6665 7265  ne else D.refere
+00015eb0: 6e63 6573 3a0a 2020 2020 2020 2020 445f  nces:.        D_
+00015ec0: 636f 7079 2e61 6464 2863 6f70 795f 7265  copy.add(copy_re
+00015ed0: 6665 7265 6e63 6528 7265 6629 290a 2020  ference(ref)).  
+00015ee0: 2020 666f 7220 706f 7274 2069 6e20 2870    for port in (p
+00015ef0: 6f72 7473 2069 6620 706f 7274 7320 6973  orts if ports is
+00015f00: 206e 6f74 204e 6f6e 6520 656c 7365 2044   not None else D
+00015f10: 2e70 6f72 7473 292e 7661 6c75 6573 2829  .ports).values()
+00015f20: 3a0a 2020 2020 2020 2020 445f 636f 7079  :.        D_copy
+00015f30: 2e61 6464 5f70 6f72 7428 706f 7274 3d70  .add_port(port=p
+00015f40: 6f72 7429 0a20 2020 2066 6f72 2070 6f6c  ort).    for pol
+00015f50: 7920 696e 2070 6f6c 7967 6f6e 7320 6966  y in polygons if
+00015f60: 2070 6f6c 7967 6f6e 7320 6973 206e 6f74   polygons is not
+00015f70: 204e 6f6e 6520 656c 7365 2044 2e70 6f6c   None else D.pol
+00015f80: 7967 6f6e 733a 0a20 2020 2020 2020 2044  ygons:.        D
+00015f90: 5f63 6f70 792e 6164 645f 706f 6c79 676f  _copy.add_polygo
+00015fa0: 6e28 706f 6c79 290a 2020 2020 666f 7220  n(poly).    for 
+00015fb0: 7061 7468 2069 6e20 7061 7468 7320 6966  path in paths if
+00015fc0: 2070 6174 6873 2069 7320 6e6f 7420 4e6f   paths is not No
+00015fd0: 6e65 2065 6c73 6520 442e 7061 7468 733a  ne else D.paths:
+00015fe0: 0a20 2020 2020 2020 2044 5f63 6f70 792e  .        D_copy.
+00015ff0: 6164 6428 7061 7468 290a 2020 2020 666f  add(path).    fo
+00016000: 7220 6c61 6265 6c20 696e 206c 6162 656c  r label in label
+00016010: 7320 6966 206c 6162 656c 7320 6973 206e  s if labels is n
+00016020: 6f74 204e 6f6e 6520 656c 7365 2044 2e6c  ot None else D.l
+00016030: 6162 656c 733a 0a20 2020 2020 2020 2044  abels:.        D
+00016040: 5f63 6f70 792e 6164 645f 6c61 6265 6c28  _copy.add_label(
+00016050: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
+00016060: 743d 6c61 6265 6c2e 7465 7874 2c0a 2020  t=label.text,.  
+00016070: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00016080: 6f6e 3d6c 6162 656c 2e6f 7269 6769 6e2c  on=label.origin,
+00016090: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+000160a0: 6572 3d28 6c61 6265 6c2e 6c61 7965 722c  er=(label.layer,
+000160b0: 206c 6162 656c 2e74 6578 7474 7970 6529   label.texttype)
+000160c0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000160d0: 2069 6620 6e61 6d65 2069 7320 6e6f 7420   if name is not 
+000160e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 445f  None:.        D_
+000160f0: 636f 7079 2e6e 616d 6520 3d20 6e61 6d65  copy.name = name
+00016100: 0a0a 2020 2020 7265 7475 726e 2044 5f63  ..    return D_c
+00016110: 6f70 790a 0a0a 6465 6620 636f 7079 5f72  opy...def copy_r
+00016120: 6566 6572 656e 6365 280a 2020 2020 7265  eference(.    re
+00016130: 662c 0a20 2020 2070 6172 656e 743d 4e6f  f,.    parent=No
+00016140: 6e65 2c0a 2020 2020 636f 6c75 6d6e 733d  ne,.    columns=
+00016150: 4e6f 6e65 2c0a 2020 2020 726f 7773 3d4e  None,.    rows=N
+00016160: 6f6e 652c 0a20 2020 2073 7061 6369 6e67  one,.    spacing
+00016170: 3d4e 6f6e 652c 0a20 2020 206f 7269 6769  =None,.    origi
+00016180: 6e3d 4e6f 6e65 2c0a 2020 2020 726f 7461  n=None,.    rota
+00016190: 7469 6f6e 3d4e 6f6e 652c 0a20 2020 206d  tion=None,.    m
+000161a0: 6167 6e69 6669 6361 7469 6f6e 3d4e 6f6e  agnification=Non
+000161b0: 652c 0a20 2020 2078 5f72 6566 6c65 6374  e,.    x_reflect
+000161c0: 696f 6e3d 4e6f 6e65 2c0a 2020 2020 6e61  ion=None,.    na
+000161d0: 6d65 3d4e 6f6e 652c 0a20 2020 2076 313d  me=None,.    v1=
+000161e0: 4e6f 6e65 2c0a 2020 2020 7632 3d4e 6f6e  None,.    v2=Non
+000161f0: 652c 0a29 202d 3e20 436f 6d70 6f6e 656e  e,.) -> Componen
+00016200: 7452 6566 6572 656e 6365 3a0a 2020 2020  tReference:.    
+00016210: 7265 7475 726e 2043 6f6d 706f 6e65 6e74  return Component
+00016220: 5265 6665 7265 6e63 6528 0a20 2020 2020  Reference(.     
+00016230: 2020 2063 6f6d 706f 6e65 6e74 3d70 6172     component=par
+00016240: 656e 7420 6f72 2072 6566 2e70 6172 656e  ent or ref.paren
+00016250: 742c 0a20 2020 2020 2020 2063 6f6c 756d  t,.        colum
+00016260: 6e73 3d63 6f6c 756d 6e73 206f 7220 7265  ns=columns or re
+00016270: 662e 636f 6c75 6d6e 732c 0a20 2020 2020  f.columns,.     
+00016280: 2020 2072 6f77 733d 726f 7773 206f 7220     rows=rows or 
+00016290: 7265 662e 726f 7773 2c0a 2020 2020 2020  ref.rows,.      
+000162a0: 2020 7370 6163 696e 673d 7370 6163 696e    spacing=spacin
+000162b0: 6720 6f72 2072 6566 2e73 7061 6369 6e67  g or ref.spacing
+000162c0: 2c0a 2020 2020 2020 2020 6f72 6967 696e  ,.        origin
+000162d0: 3d6f 7269 6769 6e20 6f72 2072 6566 2e6f  =origin or ref.o
+000162e0: 7269 6769 6e2c 0a20 2020 2020 2020 2072  rigin,.        r
+000162f0: 6f74 6174 696f 6e3d 726f 7461 7469 6f6e  otation=rotation
+00016300: 206f 7220 7265 662e 726f 7461 7469 6f6e   or ref.rotation
+00016310: 2c0a 2020 2020 2020 2020 6d61 676e 6966  ,.        magnif
+00016320: 6963 6174 696f 6e3d 6d61 676e 6966 6963  ication=magnific
+00016330: 6174 696f 6e20 6f72 2072 6566 2e6d 6167  ation or ref.mag
+00016340: 6e69 6669 6361 7469 6f6e 2c0a 2020 2020  nification,.    
+00016350: 2020 2020 785f 7265 666c 6563 7469 6f6e      x_reflection
+00016360: 3d78 5f72 6566 6c65 6374 696f 6e20 6f72  =x_reflection or
+00016370: 2072 6566 2e78 5f72 6566 6c65 6374 696f   ref.x_reflectio
+00016380: 6e2c 0a20 2020 2020 2020 206e 616d 653d  n,.        name=
+00016390: 6e61 6d65 206f 7220 7265 662e 6e61 6d65  name or ref.name
+000163a0: 2c0a 2020 2020 2020 2020 7631 3d76 3120  ,.        v1=v1 
+000163b0: 6f72 2072 6566 2e76 312c 0a20 2020 2020  or ref.v1,.     
+000163c0: 2020 2076 323d 7632 206f 7220 7265 662e     v2=v2 or ref.
+000163d0: 7632 2c0a 2020 2020 290a 0a0a 6465 6620  v2,.    )...def 
+000163e0: 7465 7374 5f67 6574 5f6c 6179 6572 7328  test_get_layers(
+000163f0: 2920 2d3e 2043 6f6d 706f 6e65 6e74 3a0a  ) -> Component:.
+00016400: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
+00016410: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
+00016420: 2063 3120 3d20 6766 2e63 6f6d 706f 6e65   c1 = gf.compone
+00016430: 6e74 732e 7374 7261 6967 6874 280a 2020  nts.straight(.  
+00016440: 2020 2020 2020 6c65 6e67 7468 3d31 302c        length=10,
+00016450: 0a20 2020 2020 2020 2077 6964 7468 3d30  .        width=0
+00016460: 2e35 2c0a 2020 2020 2020 2020 6c61 7965  .5,.        laye
+00016470: 723d 2832 2c20 3029 2c0a 2020 2020 2020  r=(2, 0),.      
+00016480: 2020 6262 6f78 5f6c 6179 6572 733d 5b28    bbox_layers=[(
+00016490: 3131 312c 2030 295d 2c0a 2020 2020 2020  111, 0)],.      
+000164a0: 2020 6262 6f78 5f6f 6666 7365 7473 3d5b    bbox_offsets=[
+000164b0: 335d 2c0a 2020 2020 2020 2020 7769 7468  3],.        with
+000164c0: 5f62 626f 783d 5472 7565 2c0a 2020 2020  _bbox=True,.    
+000164d0: 2020 2020 636c 6164 6469 6e67 5f6c 6179      cladding_lay
+000164e0: 6572 733d 4e6f 6e65 2c0a 2020 2020 2020  ers=None,.      
+000164f0: 2020 6164 645f 7069 6e73 3d4e 6f6e 652c    add_pins=None,
+00016500: 0a20 2020 2020 2020 2061 6464 5f62 626f  .        add_bbo
+00016510: 783d 4e6f 6e65 2c0a 2020 2020 290a 2020  x=None,.    ).  
+00016520: 2020 6173 7365 7274 2063 312e 6765 745f    assert c1.get_
+00016530: 6c61 7965 7273 2829 203d 3d20 7b28 322c  layers() == {(2,
+00016540: 2030 292c 2028 3131 312c 2030 297d 2c20   0), (111, 0)}, 
+00016550: 6331 2e67 6574 5f6c 6179 6572 7328 290a  c1.get_layers().
+00016560: 2020 2020 2320 7265 7475 726e 2063 310a      # return c1.
+00016570: 2020 2020 6332 203d 2063 312e 7265 6d6f      c2 = c1.remo
+00016580: 7665 5f6c 6179 6572 7328 5b28 3131 312c  ve_layers([(111,
+00016590: 2030 295d 290a 2020 2020 6173 7365 7274   0)]).    assert
+000165a0: 2063 322e 6765 745f 6c61 7965 7273 2829   c2.get_layers()
+000165b0: 203d 3d20 7b28 322c 2030 297d 2c20 6332   == {(2, 0)}, c2
+000165c0: 2e67 6574 5f6c 6179 6572 7328 290a 2020  .get_layers().  
+000165d0: 2020 7265 7475 726e 2063 320a 0a0a 6465    return c2...de
+000165e0: 6620 5f66 696c 7465 725f 706f 6c79 7328  f _filter_polys(
+000165f0: 706f 6c79 676f 6e73 2c20 6c61 7965 7273  polygons, layers
+00016600: 5f65 7863 6c29 3a0a 2020 2020 7265 7475  _excl):.    retu
+00016610: 726e 205b 0a20 2020 2020 2020 2070 6f6c  rn [.        pol
+00016620: 7967 6f6e 0a20 2020 2020 2020 2066 6f72  ygon.        for
+00016630: 2070 6f6c 7967 6f6e 2c20 6c61 7965 722c   polygon, layer,
+00016640: 2064 6174 6174 7970 6520 696e 207a 6970   datatype in zip
+00016650: 280a 2020 2020 2020 2020 2020 2020 706f  (.            po
+00016660: 6c79 676f 6e73 2e70 6f6c 7967 6f6e 732c  lygons.polygons,
+00016670: 2070 6f6c 7967 6f6e 732e 6c61 7965 7273   polygons.layers
+00016680: 2c20 706f 6c79 676f 6e73 2e64 6174 6174  , polygons.datat
+00016690: 7970 6573 0a20 2020 2020 2020 2029 0a20  ypes.        ). 
+000166a0: 2020 2020 2020 2069 6620 286c 6179 6572         if (layer
+000166b0: 2c20 6461 7461 7479 7065 2920 6e6f 7420  , datatype) not 
+000166c0: 696e 206c 6179 6572 735f 6578 636c 0a20  in layers_excl. 
+000166d0: 2020 205d 0a0a 0a64 6566 2072 6563 7572     ]...def recur
+000166e0: 7365 5f73 7472 7563 7475 7265 7328 0a20  se_structures(. 
+000166f0: 2020 2063 6f6d 706f 6e65 6e74 3a20 436f     component: Co
+00016700: 6d70 6f6e 656e 742c 0a20 2020 2069 676e  mponent,.    ign
+00016710: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
+00016720: 7265 6669 783a 204f 7074 696f 6e61 6c5b  refix: Optional[
+00016730: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
+00016740: 652c 0a20 2020 2069 676e 6f72 655f 6675  e,.    ignore_fu
+00016750: 6e63 7469 6f6e 735f 7072 6566 6978 3a20  nctions_prefix: 
+00016760: 4f70 7469 6f6e 616c 5b4c 6973 745b 7374  Optional[List[st
+00016770: 725d 5d20 3d20 4e6f 6e65 2c0a 2920 2d3e  r]] = None,.) ->
+00016780: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
+00016790: 0a20 2020 2022 2222 5265 6375 7273 6520  .    """Recurse 
+000167a0: 636f 6d70 6f6e 656e 7420 616e 6420 636f  component and co
+000167b0: 6d70 6f6e 656e 7473 2072 6566 6572 656e  mponents referen
+000167c0: 6365 7320 7265 6375 7273 6976 656c 792e  ces recursively.
+000167d0: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
+000167e0: 2020 2020 636f 6d70 6f6e 656e 743a 2063      component: c
+000167f0: 6f6d 706f 6e65 6e74 2074 6f20 7265 6375  omponent to recu
+00016800: 7273 652e 0a20 2020 2020 2020 2069 676e  rse..        ign
+00016810: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
+00016820: 7265 6669 783a 206c 6973 7420 6f66 2070  refix: list of p
+00016830: 7265 6669 7820 746f 2069 676e 6f72 652e  refix to ignore.
+00016840: 0a20 2020 2020 2020 2069 676e 6f72 655f  .        ignore_
+00016850: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
+00016860: 3a20 6c69 7374 206f 6620 7072 6566 6978  : list of prefix
+00016870: 2074 6f20 6967 6e6f 7265 2e0a 2020 2020   to ignore..    
+00016880: 2222 220a 2020 2020 6967 6e6f 7265 5f66  """.    ignore_f
+00016890: 756e 6374 696f 6e73 5f70 7265 6669 7820  unctions_prefix 
+000168a0: 3d20 6967 6e6f 7265 5f66 756e 6374 696f  = ignore_functio
+000168b0: 6e73 5f70 7265 6669 7820 6f72 205b 5d0a  ns_prefix or [].
+000168c0: 2020 2020 6967 6e6f 7265 5f63 6f6d 706f      ignore_compo
+000168d0: 6e65 6e74 735f 7072 6566 6978 203d 2069  nents_prefix = i
+000168e0: 676e 6f72 655f 636f 6d70 6f6e 656e 7473  gnore_components
+000168f0: 5f70 7265 6669 7820 6f72 205b 5d0a 0a20  _prefix or [].. 
+00016900: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+00016910: 6861 7361 7474 7228 636f 6d70 6f6e 656e  hasattr(componen
+00016920: 742c 2022 6675 6e63 7469 6f6e 5f6e 616d  t, "function_nam
+00016930: 6522 290a 2020 2020 2020 2020 616e 6420  e").        and 
+00016940: 636f 6d70 6f6e 656e 742e 6675 6e63 7469  component.functi
+00016950: 6f6e 5f6e 616d 6520 696e 2069 676e 6f72  on_name in ignor
+00016960: 655f 6675 6e63 7469 6f6e 735f 7072 6566  e_functions_pref
+00016970: 6978 0a20 2020 2029 3a0a 2020 2020 2020  ix.    ):.      
+00016980: 2020 7265 7475 726e 207b 7d0a 0a20 2020    return {}..   
+00016990: 2069 6620 6861 7361 7474 7228 636f 6d70   if hasattr(comp
+000169a0: 6f6e 656e 742c 2022 6e61 6d65 2229 2061  onent, "name") a
+000169b0: 6e64 2061 6e79 280a 2020 2020 2020 2020  nd any(.        
+000169c0: 636f 6d70 6f6e 656e 742e 6e61 6d65 2e73  component.name.s
+000169d0: 7461 7274 7377 6974 6828 6929 2066 6f72  tartswith(i) for
+000169e0: 2069 2069 6e20 6967 6e6f 7265 5f63 6f6d   i in ignore_com
+000169f0: 706f 6e65 6e74 735f 7072 6566 6978 0a20  ponents_prefix. 
+00016a00: 2020 2029 3a0a 2020 2020 2020 2020 7265     ):.        re
+00016a10: 7475 726e 207b 7d0a 0a20 2020 206f 7574  turn {}..    out
+00016a20: 7075 7420 3d20 7b63 6f6d 706f 6e65 6e74  put = {component
+00016a30: 2e6e 616d 653a 2064 6963 7428 636f 6d70  .name: dict(comp
+00016a40: 6f6e 656e 742e 7365 7474 696e 6773 297d  onent.settings)}
+00016a50: 0a20 2020 2066 6f72 2072 6566 6572 656e  .    for referen
+00016a60: 6365 2069 6e20 636f 6d70 6f6e 656e 742e  ce in component.
+00016a70: 7265 6665 7265 6e63 6573 3a0a 2020 2020  references:.    
+00016a80: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00016a90: 2020 2020 2069 7369 6e73 7461 6e63 6528       isinstance(
+00016aa0: 7265 6665 7265 6e63 652c 2043 6f6d 706f  reference, Compo
+00016ab0: 6e65 6e74 5265 6665 7265 6e63 6529 0a20  nentReference). 
+00016ac0: 2020 2020 2020 2020 2020 2061 6e64 2072             and r
+00016ad0: 6566 6572 656e 6365 2e72 6566 5f63 656c  eference.ref_cel
+00016ae0: 6c2e 6e61 6d65 206e 6f74 2069 6e20 6f75  l.name not in ou
+00016af0: 7470 7574 0a20 2020 2020 2020 2029 3a0a  tput.        ):.
+00016b00: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+00016b10: 7574 2e75 7064 6174 6528 7265 6375 7273  ut.update(recurs
+00016b20: 655f 7374 7275 6374 7572 6573 2872 6566  e_structures(ref
+00016b30: 6572 656e 6365 2e72 6566 5f63 656c 6c29  erence.ref_cell)
+00016b40: 290a 0a20 2020 2072 6574 7572 6e20 6f75  )..    return ou
+00016b50: 7470 7574 0a0a 0a64 6566 2066 6c61 7474  tput...def flatt
+00016b60: 656e 5f69 6e76 616c 6964 5f72 6566 735f  en_invalid_refs_
+00016b70: 7265 6375 7273 6976 6528 0a20 2020 2063  recursive(.    c
+00016b80: 6f6d 706f 6e65 6e74 3a20 436f 6d70 6f6e  omponent: Compon
+00016b90: 656e 742c 0a20 2020 2067 7269 645f 7369  ent,.    grid_si
+00016ba0: 7a65 3a20 4f70 7469 6f6e 616c 5b66 6c6f  ze: Optional[flo
+00016bb0: 6174 5d20 3d20 4e6f 6e65 2c0a 2020 2020  at] = None,.    
+00016bc0: 7570 6461 7465 645f 636f 6d70 6f6e 656e  updated_componen
+00016bd0: 7473 3d4e 6f6e 652c 0a20 2020 2074 7261  ts=None,.    tra
+00016be0: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
+00016bf0: 733d 4e6f 6e65 2c0a 293a 0a20 2020 2022  s=None,.):.    "
+00016c00: 2222 5265 6375 7273 6976 656c 7920 666c  ""Recursively fl
+00016c10: 6174 7465 6e73 2063 6f6d 706f 6e65 6e74  attens component
+00016c20: 2072 6566 6572 656e 6365 7320 7768 6963   references whic
+00016c30: 6820 6861 7665 2069 6e76 616c 6964 2074  h have invalid t
+00016c40: 7261 6e73 666f 726d 6174 696f 6e73 2028  ransformations (
+00016c50: 692e 652e 206e 6f6e 2d39 3020 6465 6720  i.e. non-90 deg 
+00016c60: 726f 7461 7469 6f6e 7320 6f72 2073 7562  rotations or sub
+00016c70: 2d67 7269 6420 7472 616e 736c 6174 696f  -grid translatio
+00016c80: 6e73 2920 616e 6420 7265 7475 726e 7320  ns) and returns 
+00016c90: 6120 636f 7079 2069 6620 616e 7920 7375  a copy if any su
+00016ca0: 6263 656c 6c73 2068 6176 6520 6265 656e  bcells have been
+00016cb0: 206d 6f64 6966 6965 642e 0a0a 2020 2020   modified...    
+00016cc0: 5741 524e 494e 473a 2074 6869 7320 6675  WARNING: this fu
+00016cd0: 6e63 7469 6f6e 2077 696c 6c20 7072 6f64  nction will prod
+00016ce0: 7563 6520 7361 6d65 2d6e 616d 6520 636f  uce same-name co
+00016cf0: 7069 6573 206f 6620 6365 6c6c 732e 2049  pies of cells. I
+00016d00: 7420 6973 2073 7472 6963 746c 7920 6d65  t is strictly me
+00016d10: 616e 7420 746f 2062 6520 7573 6564 206f  ant to be used o
+00016d20: 6e20 7772 6974 6520 6f66 2074 6865 2047  n write of the G
+00016d30: 4453 2066 696c 6520 616e 640a 2020 2020  DS file and.    
+00016d40: 7368 6f75 6c64 206e 6f74 2062 6520 6d69  should not be mi
+00016d50: 7865 6420 7769 7468 206f 7468 6572 2063  xed with other c
+00016d60: 656c 6c73 2c20 6f72 2079 6f75 2077 696c  ells, or you wil
+00016d70: 6c20 6c69 6b65 6c79 2065 7870 6572 6965  l likely experie
+00016d80: 6e63 6520 6973 7375 6573 2077 6974 6820  nce issues with 
+00016d90: 6475 706c 6963 6174 6520 6365 6c6c 730a  duplicate cells.
+00016da0: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
+00016db0: 2020 2063 6f6d 706f 6e65 6e74 3a20 7468     component: th
+00016dc0: 6520 636f 6d70 6f6e 656e 7420 746f 2066  e component to f
+00016dd0: 6978 2028 696e 2070 6c61 6365 292e 0a20  ix (in place).. 
+00016de0: 2020 2020 2020 2067 7269 645f 7369 7a65         grid_size
+00016df0: 3a20 7468 6520 4744 5320 6772 6964 2073  : the GDS grid s
+00016e00: 697a 652c 2069 6e20 756d 2c20 6465 6661  ize, in um, defa
+00016e10: 756c 7473 2074 6f20 6163 7469 7665 2050  ults to active P
+00016e20: 444b 2e67 6574 5f67 7269 645f 7369 7a65  DK.get_grid_size
+00016e30: 2829 0a20 2020 2020 2020 2020 2020 2061  ().            a
+00016e40: 6e79 2074 7261 6e73 6c61 7469 6f6e 7320  ny translations 
+00016e50: 7769 7468 2068 6967 6865 7220 7265 736f  with higher reso
+00016e60: 6c75 7469 6f6e 2074 6861 6e20 7468 6973  lution than this
+00016e70: 2061 7265 2063 6f6e 7369 6465 7265 6420   are considered 
+00016e80: 696e 7661 6c69 642e 0a20 2020 2020 2020  invalid..       
+00016e90: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
+00016ea0: 6e74 733a 2074 6865 2072 756e 6e69 6e67  nts: the running
+00016eb0: 2064 6963 7469 6f6e 6172 7920 6f66 2063   dictionary of c
+00016ec0: 6f6d 706f 6e65 6e74 7320 7768 6963 6820  omponents which 
+00016ed0: 6861 7665 2062 6565 6e20 6d6f 6469 6669  have been modifi
+00016ee0: 6564 2062 7920 7468 6973 2074 7261 6e73  ed by this trans
+00016ef0: 666f 726d 6174 696f 6e2e 2053 686f 756c  formation. Shoul
+00016f00: 6420 616c 7761 7973 2062 6520 4e6f 6e65  d always be None
+00016f10: 2c20 6578 6365 7074 2066 6f72 2072 6563  , except for rec
+00016f20: 7572 7369 7665 2069 6e76 6f63 6174 696f  ursive invocatio
+00016f30: 6e73 2e0a 2020 2020 2020 2020 7472 6176  ns..        trav
+00016f40: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
+00016f50: 3a20 7468 6520 7365 7420 6f66 2063 6f6d  : the set of com
+00016f60: 706f 6e65 6e74 206e 616d 6573 2077 6869  ponent names whi
+00016f70: 6368 2068 6176 6520 6265 656e 2074 7261  ch have been tra
+00016f80: 7665 7273 6564 2e20 5368 6f75 6c64 2061  versed. Should a
+00016f90: 6c77 6179 7320 6265 204e 6f6e 652c 2065  lways be None, e
+00016fa0: 7863 6570 7420 666f 7220 7265 6375 7273  xcept for recurs
+00016fb0: 6976 6520 696e 766f 6361 7469 6f6e 732e  ive invocations.
+00016fc0: 0a20 2020 2022 2222 0a20 2020 2066 726f  .    """.    fro
+00016fd0: 6d20 6764 7366 6163 746f 7279 2e64 6563  m gdsfactory.dec
+00016fe0: 6f72 6174 6f72 7320 696d 706f 7274 2069  orators import i
+00016ff0: 735f 696e 7661 6c69 645f 7265 660a 0a20  s_invalid_ref.. 
+00017000: 2020 2069 6e76 616c 6964 5f72 6566 7320     invalid_refs 
+00017010: 3d20 5b5d 0a20 2020 2072 6566 7320 3d20  = [].    refs = 
+00017020: 636f 6d70 6f6e 656e 742e 7265 6665 7265  component.refere
+00017030: 6e63 6573 0a20 2020 2073 7562 6365 6c6c  nces.    subcell
+00017040: 5f6d 6f64 6966 6965 6420 3d20 4661 6c73  _modified = Fals
+00017050: 650a 2020 2020 6966 2075 7064 6174 6564  e.    if updated
+00017060: 5f63 6f6d 706f 6e65 6e74 7320 6973 204e  _components is N
+00017070: 6f6e 653a 0a20 2020 2020 2020 2075 7064  one:.        upd
+00017080: 6174 6564 5f63 6f6d 706f 6e65 6e74 7320  ated_components 
+00017090: 3d20 7b7d 0a20 2020 2069 6620 7472 6176  = {}.    if trav
+000170a0: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
+000170b0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000170c0: 2020 7472 6176 6572 7365 645f 636f 6d70    traversed_comp
+000170d0: 6f6e 656e 7473 203d 2073 6574 2829 0a20  onents = set(). 
+000170e0: 2020 2066 6f72 2072 6566 2069 6e20 7265     for ref in re
+000170f0: 6673 3a0a 2020 2020 2020 2020 2320 6d61  fs:.        # ma
+00017100: 726b 2061 6e79 2069 6e76 616c 6964 2072  rk any invalid r
+00017110: 6566 7320 666f 7220 666c 6174 7465 6e69  efs for flatteni
+00017120: 6e67 0a20 2020 2020 2020 2023 206f 7468  ng.        # oth
+00017130: 6572 7769 7365 2c20 6368 6563 6b20 6966  erwise, check if
+00017140: 2074 6865 7265 2061 7265 2061 6e79 206d   there are any m
+00017150: 6f64 6966 6965 6420 6365 6c6c 7320 6265  odified cells be
+00017160: 6e65 6174 6820 2877 6520 6e65 6564 206e  neath (we need n
+00017170: 6f74 2064 6f20 7468 6973 2069 6620 7468  ot do this if th
+00017180: 6520 7265 6620 7769 6c6c 2062 6520 666c  e ref will be fl
+00017190: 6174 7465 6e65 6420 616e 7977 6179 7329  attened anyways)
+000171a0: 0a20 2020 2020 2020 2069 6620 6973 5f69  .        if is_i
+000171b0: 6e76 616c 6964 5f72 6566 2872 6566 2c20  nvalid_ref(ref, 
+000171c0: 6772 6964 5f73 697a 6529 3a0a 2020 2020  grid_size):.    
+000171d0: 2020 2020 2020 2020 696e 7661 6c69 645f          invalid_
+000171e0: 7265 6673 2e61 7070 656e 6428 7265 662e  refs.append(ref.
+000171f0: 6e61 6d65 290a 2020 2020 2020 2020 656c  name).        el
+00017200: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00017210: 2320 6f74 6865 7277 6973 652c 2072 6563  # otherwise, rec
+00017220: 7572 7369 7665 6c79 2066 6c61 7474 656e  ursively flatten
+00017230: 2072 6566 7320 6966 2074 6865 2073 7562   refs if the sub
+00017240: 6365 6c6c 2068 6173 206e 6f74 2061 6c72  cell has not alr
+00017250: 6561 6479 2062 6565 6e20 7472 6176 6572  eady been traver
+00017260: 7365 640a 2020 2020 2020 2020 2020 2020  sed.            
+00017270: 6966 2072 6566 2e70 6172 656e 742e 6e61  if ref.parent.na
+00017280: 6d65 206e 6f74 2069 6e20 7472 6176 6572  me not in traver
+00017290: 7365 645f 636f 6d70 6f6e 656e 7473 3a0a  sed_components:.
+000172a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172b0: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
+000172c0: 7265 6673 5f72 6563 7572 7369 7665 280a  refs_recursive(.
+000172d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172e0: 2020 2020 7265 662e 7061 7265 6e74 2c0a      ref.parent,.
+000172f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017300: 2020 2020 6772 6964 5f73 697a 653d 6772      grid_size=gr
+00017310: 6964 5f73 697a 652c 0a20 2020 2020 2020  id_size,.       
+00017320: 2020 2020 2020 2020 2020 2020 2075 7064               upd
+00017330: 6174 6564 5f63 6f6d 706f 6e65 6e74 733d  ated_components=
+00017340: 7570 6461 7465 645f 636f 6d70 6f6e 656e  updated_componen
+00017350: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00017360: 2020 2020 2020 2020 7472 6176 6572 7365          traverse
+00017370: 645f 636f 6d70 6f6e 656e 7473 3d74 7261  d_components=tra
+00017380: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
+00017390: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000173a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000173b0: 2023 206e 6f77 2c20 6966 2074 6865 2072   # now, if the r
+000173c0: 6566 2773 2063 656c 6c20 6265 656e 206d  ef's cell been m
+000173d0: 6f64 6966 6965 642c 206d 6172 6b20 6974  odified, mark it
+000173e0: 2061 7320 7375 6368 0a20 2020 2020 2020   as such.       
+000173f0: 2020 2020 2069 6620 7265 662e 7061 7265       if ref.pare
+00017400: 6e74 2e6e 616d 6520 696e 2075 7064 6174  nt.name in updat
+00017410: 6564 5f63 6f6d 706f 6e65 6e74 733a 0a20  ed_components:. 
+00017420: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00017430: 7562 6365 6c6c 5f6d 6f64 6966 6965 6420  ubcell_modified 
+00017440: 3d20 5472 7565 0a20 2020 2069 6620 696e  = True.    if in
+00017450: 7661 6c69 645f 7265 6673 206f 7220 7375  valid_refs or su
+00017460: 6263 656c 6c5f 6d6f 6469 6669 6564 3a0a  bcell_modified:.
+00017470: 2020 2020 2020 2020 6e65 775f 636f 6d70          new_comp
+00017480: 6f6e 656e 7420 3d20 636f 6d70 6f6e 656e  onent = componen
+00017490: 742e 636f 7079 2829 0a20 2020 2020 2020  t.copy().       
+000174a0: 206e 6577 5f63 6f6d 706f 6e65 6e74 2e6e   new_component.n
+000174b0: 616d 6520 3d20 636f 6d70 6f6e 656e 742e  ame = component.
+000174c0: 6e61 6d65 0a20 2020 2020 2020 2023 206d  name.        # m
+000174d0: 616b 6520 7375 7265 2061 6c6c 206d 6f64  ake sure all mod
+000174e0: 6966 6965 6420 6365 6c6c 7320 6861 7665  ified cells have
+000174f0: 2074 6865 6972 2072 6566 6572 656e 6365   their reference
+00017500: 7320 7570 6461 7465 640a 2020 2020 2020  s updated.      
+00017510: 2020 6e65 775f 7265 6673 203d 206e 6577    new_refs = new
+00017520: 5f63 6f6d 706f 6e65 6e74 2e72 6566 6572  _component.refer
+00017530: 656e 6365 732e 636f 7079 2829 0a20 2020  ences.copy().   
+00017540: 2020 2020 2066 6f72 2072 6566 2069 6e20       for ref in 
+00017550: 6e65 775f 7265 6673 3a0a 2020 2020 2020  new_refs:.      
+00017560: 2020 2020 2020 6966 2072 6566 2e6e 616d        if ref.nam
+00017570: 6520 696e 2069 6e76 616c 6964 5f72 6566  e in invalid_ref
+00017580: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00017590: 2020 206e 6577 5f63 6f6d 706f 6e65 6e74     new_component
+000175a0: 2e66 6c61 7474 656e 5f72 6566 6572 656e  .flatten_referen
+000175b0: 6365 2872 6566 290a 2020 2020 2020 2020  ce(ref).        
+000175c0: 2020 2020 656c 6966 2028 0a20 2020 2020      elif (.     
+000175d0: 2020 2020 2020 2020 2020 2072 6566 2e70             ref.p
+000175e0: 6172 656e 742e 6e61 6d65 2069 6e20 7570  arent.name in up
+000175f0: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
+00017600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017610: 2061 6e64 2072 6566 2e70 6172 656e 7420   and ref.parent 
+00017620: 6973 206e 6f74 2075 7064 6174 6564 5f63  is not updated_c
+00017630: 6f6d 706f 6e65 6e74 735b 7265 662e 7061  omponents[ref.pa
+00017640: 7265 6e74 2e6e 616d 655d 0a20 2020 2020  rent.name].     
+00017650: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00017660: 2020 2020 2020 2020 2020 7265 662e 7061            ref.pa
+00017670: 7265 6e74 203d 2075 7064 6174 6564 5f63  rent = updated_c
+00017680: 6f6d 706f 6e65 6e74 735b 7265 662e 7061  omponents[ref.pa
+00017690: 7265 6e74 2e6e 616d 655d 0a20 2020 2020  rent.name].     
+000176a0: 2020 2063 6f6d 706f 6e65 6e74 203d 206e     component = n
+000176b0: 6577 5f63 6f6d 706f 6e65 6e74 0a20 2020  ew_component.   
+000176c0: 2020 2020 2075 7064 6174 6564 5f63 6f6d       updated_com
+000176d0: 706f 6e65 6e74 735b 636f 6d70 6f6e 656e  ponents[componen
+000176e0: 742e 6e61 6d65 5d20 3d20 6e65 775f 636f  t.name] = new_co
+000176f0: 6d70 6f6e 656e 740a 2020 2020 7472 6176  mponent.    trav
+00017700: 6572 7365 645f 636f 6d70 6f6e 656e 7473  ersed_components
+00017710: 2e61 6464 2863 6f6d 706f 6e65 6e74 2e6e  .add(component.n
+00017720: 616d 6529 0a20 2020 2072 6574 7572 6e20  ame).    return 
+00017730: 636f 6d70 6f6e 656e 740a 0a0a 6465 6620  component...def 
+00017740: 5f63 6865 636b 5f75 6e63 6163 6865 645f  _check_uncached_
+00017750: 636f 6d70 6f6e 656e 7473 2863 6f6d 706f  components(compo
+00017760: 6e65 6e74 2c20 6d6f 6465 293a 0a20 2020  nent, mode):.   
+00017770: 2076 616c 6964 5f6d 6f64 6573 203d 205b   valid_modes = [
+00017780: 2277 6172 6e22 2c20 2265 7272 6f72 222c  "warn", "error",
+00017790: 2022 6967 6e6f 7265 225d 0a0a 2020 2020   "ignore"]..    
+000177a0: 6966 206d 6f64 6520 3d3d 2022 6967 6e6f  if mode == "igno
+000177b0: 7265 223a 0a20 2020 2020 2020 2072 6574  re":.        ret
+000177c0: 7572 6e0a 2020 2020 656c 6966 206d 6f64  urn.    elif mod
+000177d0: 6520 6e6f 7420 696e 2076 616c 6964 5f6d  e not in valid_m
+000177e0: 6f64 6573 3a0a 2020 2020 2020 2020 7261  odes:.        ra
+000177f0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00017800: 2020 2020 2020 2020 2020 2020 6622 7b6d              f"{m
+00017810: 6f64 657d 2069 7320 6e6f 7420 6120 7661  ode} is not a va
+00017820: 6c69 6420 7661 6c75 6520 666f 7220 6f6e  lid value for on
+00017830: 5f75 6e63 6163 6865 645f 636f 6d70 6f6e  _uncached_compon
+00017840: 656e 742e 2054 7279 206f 6e65 206f 6620  ent. Try one of 
+00017850: 7468 6573 653a 207b 7661 6c69 645f 6d6f  these: {valid_mo
+00017860: 6465 737d 2e22 0a20 2020 2020 2020 2029  des}.".        )
+00017870: 0a0a 2020 2020 666f 7220 7375 625f 636f  ..    for sub_co
+00017880: 6d70 6f6e 656e 7420 696e 2063 6f6d 706f  mponent in compo
+00017890: 6e65 6e74 2e67 6574 5f64 6570 656e 6465  nent.get_depende
+000178a0: 6e63 6965 7328 7265 6375 7273 6976 653d  ncies(recursive=
+000178b0: 5472 7565 293a 0a20 2020 2020 2020 2069  True):.        i
+000178c0: 6620 6e6f 7420 7375 625f 636f 6d70 6f6e  f not sub_compon
+000178d0: 656e 742e 5f6c 6f63 6b65 643a 0a20 2020  ent._locked:.   
+000178e0: 2020 2020 2020 2020 206d 6573 7361 6765           message
+000178f0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00017900: 2020 2020 2066 2243 6f6d 706f 6e65 6e74       f"Component
+00017910: 207b 7375 625f 636f 6d70 6f6e 656e 742e   {sub_component.
+00017920: 6e61 6d65 2172 7d20 7761 7320 4e4f 5420  name!r} was NOT 
+00017930: 7072 6f70 6572 6c79 206c 6f63 6b65 642e  properly locked.
+00017940: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00017950: 2020 2022 596f 7520 6e65 6564 2074 6f20     "You need to 
+00017960: 7772 6974 6520 6974 2069 6e74 6f20 6120  write it into a 
+00017970: 6675 6e63 7469 6f6e 2074 6861 7420 6861  function that ha
+00017980: 7320 7468 6520 4063 656c 6c20 6465 636f  s the @cell deco
+00017990: 7261 746f 722e 220a 2020 2020 2020 2020  rator.".        
+000179a0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000179b0: 2020 6966 206d 6f64 6520 3d3d 2022 7761    if mode == "wa
+000179c0: 726e 223a 0a20 2020 2020 2020 2020 2020  rn":.           
+000179d0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+000179e0: 726e 286d 6573 7361 6765 2c20 556e 6361  rn(message, Unca
+000179f0: 6368 6564 436f 6d70 6f6e 656e 7457 6172  chedComponentWar
+00017a00: 6e69 6e67 2c20 7374 6163 6b6c 6576 656c  ning, stacklevel
+00017a10: 3d33 290a 0a20 2020 2020 2020 2020 2020  =3)..           
+00017a20: 2065 6c69 6620 6d6f 6465 203d 3d20 2265   elif mode == "e
+00017a30: 7272 6f72 223a 0a20 2020 2020 2020 2020  rror":.         
+00017a40: 2020 2020 2020 2072 6169 7365 2055 6e63         raise Unc
+00017a50: 6163 6865 6443 6f6d 706f 6e65 6e74 4572  achedComponentEr
+00017a60: 726f 7228 6d65 7373 6167 6529 0a0a 0a64  ror(message)...d
+00017a70: 6566 2074 6573 745f 7361 6d65 5f75 6964  ef test_same_uid
+00017a80: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+00017a90: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+00017aa0: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
+00017ab0: 2043 6f6d 706f 6e65 6e74 2829 0a20 2020   Component().   
+00017ac0: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
+00017ad0: 6e74 732e 7265 6374 616e 676c 6528 290a  nts.rectangle().
+00017ae0: 2020 2020 6320 3c3c 2067 662e 636f 6d70      c << gf.comp
+00017af0: 6f6e 656e 7473 2e72 6563 7461 6e67 6c65  onents.rectangle
+00017b00: 2829 0a0a 2020 2020 7231 203d 2063 2e72  ()..    r1 = c.r
+00017b10: 6566 6572 656e 6365 735b 305d 2e70 6172  eferences[0].par
+00017b20: 656e 740a 2020 2020 7232 203d 2063 2e72  ent.    r2 = c.r
+00017b30: 6566 6572 656e 6365 735b 315d 2e70 6172  eferences[1].par
+00017b40: 656e 740a 0a20 2020 2061 7373 6572 7420  ent..    assert 
+00017b50: 7231 2e75 6964 203d 3d20 7232 2e75 6964  r1.uid == r2.uid
+00017b60: 2c20 6622 7b72 312e 7569 647d 206d 7573  , f"{r1.uid} mus
+00017b70: 7420 6571 7561 6c20 7b72 322e 7569 647d  t equal {r2.uid}
+00017b80: 220a 0a0a 6465 6620 7465 7374 5f6e 6574  "...def test_net
+00017b90: 6c69 7374 5f73 696d 706c 6528 2920 2d3e  list_simple() ->
+00017ba0: 204e 6f6e 653a 0a20 2020 2069 6d70 6f72   None:.    impor
+00017bb0: 7420 6764 7366 6163 746f 7279 2061 7320  t gdsfactory as 
+00017bc0: 6766 0a0a 2020 2020 6320 3d20 6766 2e43  gf..    c = gf.C
+00017bd0: 6f6d 706f 6e65 6e74 2829 0a20 2020 2063  omponent().    c
+00017be0: 3120 3d20 6320 3c3c 2067 662e 636f 6d70  1 = c << gf.comp
+00017bf0: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
+00017c00: 6c65 6e67 7468 3d31 2c20 7769 6474 683d  length=1, width=
+00017c10: 3229 0a20 2020 2063 3220 3d20 6320 3c3c  2).    c2 = c <<
+00017c20: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+00017c30: 7472 6169 6768 7428 6c65 6e67 7468 3d32  traight(length=2
+00017c40: 2c20 7769 6474 683d 3229 0a20 2020 2063  , width=2).    c
+00017c50: 322e 636f 6e6e 6563 7428 706f 7274 3d22  2.connect(port="
+00017c60: 6f31 222c 2064 6573 7469 6e61 7469 6f6e  o1", destination
+00017c70: 3d63 312e 706f 7274 735b 226f 3222 5d29  =c1.ports["o2"])
+00017c80: 0a20 2020 2063 2e61 6464 5f70 6f72 7428  .    c.add_port(
+00017c90: 226f 3122 2c20 706f 7274 3d63 312e 706f  "o1", port=c1.po
+00017ca0: 7274 735b 226f 3122 5d29 0a20 2020 2063  rts["o1"]).    c
+00017cb0: 2e61 6464 5f70 6f72 7428 226f 3222 2c20  .add_port("o2", 
+00017cc0: 706f 7274 3d63 322e 706f 7274 735b 226f  port=c2.ports["o
+00017cd0: 3222 5d29 0a20 2020 206e 6574 6c69 7374  2"]).    netlist
+00017ce0: 203d 2063 2e67 6574 5f6e 6574 6c69 7374   = c.get_netlist
+00017cf0: 2829 0a20 2020 2023 2070 7269 6e74 286e  ().    # print(n
+00017d00: 6574 6c69 7374 2e70 7265 7474 7928 2929  etlist.pretty())
+00017d10: 0a20 2020 2061 7373 6572 7420 6c65 6e28  .    assert len(
+00017d20: 6e65 746c 6973 745b 2269 6e73 7461 6e63  netlist["instanc
+00017d30: 6573 225d 2920 3d3d 2032 0a0a 0a64 6566  es"]) == 2...def
+00017d40: 2074 6573 745f 6e65 746c 6973 745f 7369   test_netlist_si
+00017d50: 6d70 6c65 5f77 6964 7468 5f6d 6973 6d61  mple_width_misma
+00017d60: 7463 685f 7468 726f 7773 5f65 7272 6f72  tch_throws_error
+00017d70: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+00017d80: 696d 706f 7274 2070 7974 6573 740a 0a20  import pytest.. 
+00017d90: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+00017da0: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
+00017db0: 6320 3d20 6766 2e43 6f6d 706f 6e65 6e74  c = gf.Component
+00017dc0: 2829 0a20 2020 2063 3120 3d20 6320 3c3c  ().    c1 = c <<
+00017dd0: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+00017de0: 7472 6169 6768 7428 6c65 6e67 7468 3d31  traight(length=1
+00017df0: 2c20 7769 6474 683d 3129 0a20 2020 2063  , width=1).    c
+00017e00: 3220 3d20 6320 3c3c 2067 662e 636f 6d70  2 = c << gf.comp
+00017e10: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
+00017e20: 6c65 6e67 7468 3d32 2c20 7769 6474 683d  length=2, width=
+00017e30: 3229 0a20 2020 2063 322e 636f 6e6e 6563  2).    c2.connec
+00017e40: 7428 706f 7274 3d22 6f31 222c 2064 6573  t(port="o1", des
+00017e50: 7469 6e61 7469 6f6e 3d63 312e 706f 7274  tination=c1.port
+00017e60: 735b 226f 3222 5d29 0a20 2020 2063 2e61  s["o2"]).    c.a
+00017e70: 6464 5f70 6f72 7428 226f 3122 2c20 706f  dd_port("o1", po
+00017e80: 7274 3d63 312e 706f 7274 735b 226f 3122  rt=c1.ports["o1"
+00017e90: 5d29 0a20 2020 2063 2e61 6464 5f70 6f72  ]).    c.add_por
+00017ea0: 7428 226f 3222 2c20 706f 7274 3d63 322e  t("o2", port=c2.
+00017eb0: 706f 7274 735b 226f 3222 5d29 0a20 2020  ports["o2"]).   
+00017ec0: 2077 6974 6820 7079 7465 7374 2e72 6169   with pytest.rai
+00017ed0: 7365 7328 5661 6c75 6545 7272 6f72 293a  ses(ValueError):
+00017ee0: 0a20 2020 2020 2020 2063 2e67 6574 5f6e  .        c.get_n
+00017ef0: 6574 6c69 7374 2829 0a0a 0a64 6566 2074  etlist()...def t
+00017f00: 6573 745f 6e65 746c 6973 745f 636f 6d70  est_netlist_comp
+00017f10: 6c65 7828 2920 2d3e 204e 6f6e 653a 0a20  lex() -> None:. 
+00017f20: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+00017f30: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
+00017f40: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
+00017f50: 732e 6d7a 695f 6172 6d73 2829 0a20 2020  s.mzi_arms().   
+00017f60: 206e 6574 6c69 7374 203d 2063 2e67 6574   netlist = c.get
+00017f70: 5f6e 6574 6c69 7374 2829 0a20 2020 2023  _netlist().    #
+00017f80: 2070 7269 6e74 286e 6574 6c69 7374 2e70   print(netlist.p
+00017f90: 7265 7474 7928 2929 0a20 2020 2061 7373  retty()).    ass
+00017fa0: 6572 7420 6c65 6e28 6e65 746c 6973 745b  ert len(netlist[
+00017fb0: 2269 6e73 7461 6e63 6573 225d 2920 3d3d  "instances"]) ==
+00017fc0: 2034 2c20 6c65 6e28 6e65 746c 6973 745b   4, len(netlist[
+00017fd0: 2269 6e73 7461 6e63 6573 225d 290a 0a0a  "instances"])...
+00017fe0: 6465 6620 7465 7374 5f65 7874 7261 6374  def test_extract
+00017ff0: 2829 202d 3e20 436f 6d70 6f6e 656e 743a  () -> Component:
+00018000: 0a20 2020 2069 6d70 6f72 7420 6764 7366  .    import gdsf
+00018010: 6163 746f 7279 2061 7320 6766 0a0a 2020  actory as gf..  
+00018020: 2020 6320 3d20 6766 2e63 6f6d 706f 6e65    c = gf.compone
+00018030: 6e74 732e 7374 7261 6967 6874 280a 2020  nts.straight(.  
+00018040: 2020 2020 2020 6c65 6e67 7468 3d31 302c        length=10,
+00018050: 0a20 2020 2020 2020 2077 6964 7468 3d30  .        width=0
+00018060: 2e35 2c0a 2020 2020 2020 2020 6262 6f78  .5,.        bbox
+00018070: 5f6c 6179 6572 733d 5b67 662e 4c41 5945  _layers=[gf.LAYE
+00018080: 522e 5747 434c 4144 5d2c 0a20 2020 2020  R.WGCLAD],.     
+00018090: 2020 2062 626f 785f 6f66 6673 6574 733d     bbox_offsets=
+000180a0: 5b33 5d2c 0a20 2020 2020 2020 2077 6974  [3],.        wit
+000180b0: 685f 6262 6f78 3d54 7275 652c 0a20 2020  h_bbox=True,.   
+000180c0: 2020 2020 2063 6c61 6464 696e 675f 6c61       cladding_la
+000180d0: 7965 7273 3d4e 6f6e 652c 0a20 2020 2020  yers=None,.     
+000180e0: 2020 2061 6464 5f70 696e 733d 4e6f 6e65     add_pins=None
+000180f0: 2c0a 2020 2020 2020 2020 6164 645f 6262  ,.        add_bb
+00018100: 6f78 3d4e 6f6e 652c 0a20 2020 2029 0a20  ox=None,.    ). 
+00018110: 2020 2063 3220 3d20 632e 6578 7472 6163     c2 = c.extrac
+00018120: 7428 6c61 7965 7273 3d5b 6766 2e4c 4159  t(layers=[gf.LAY
+00018130: 4552 2e57 4743 4c41 445d 290a 0a20 2020  ER.WGCLAD])..   
+00018140: 2061 7373 6572 7420 6c65 6e28 632e 706f   assert len(c.po
+00018150: 6c79 676f 6e73 2920 3d3d 2032 2c20 6c65  lygons) == 2, le
+00018160: 6e28 632e 706f 6c79 676f 6e73 290a 2020  n(c.polygons).  
+00018170: 2020 6173 7365 7274 206c 656e 2863 322e    assert len(c2.
+00018180: 706f 6c79 676f 6e73 2920 3d3d 2031 2c20  polygons) == 1, 
+00018190: 6c65 6e28 6332 2e70 6f6c 7967 6f6e 7329  len(c2.polygons)
+000181a0: 0a20 2020 2061 7373 6572 7420 6766 2e4c  .    assert gf.L
+000181b0: 4159 4552 2e57 4743 4c41 4420 696e 2063  AYER.WGCLAD in c
+000181c0: 322e 6c61 7965 7273 0a20 2020 2072 6574  2.layers.    ret
+000181d0: 7572 6e20 6332 0a0a 0a64 6566 2068 6173  urn c2...def has
+000181e0: 685f 6669 6c65 2866 696c 6570 6174 6829  h_file(filepath)
+000181f0: 3a0a 2020 2020 6d64 3520 3d20 6861 7368  :.    md5 = hash
+00018200: 6c69 622e 6d64 3528 290a 2020 2020 6d64  lib.md5().    md
+00018210: 352e 7570 6461 7465 2866 696c 6570 6174  5.update(filepat
+00018220: 682e 7265 6164 5f62 7974 6573 2829 290a  h.read_bytes()).
+00018230: 2020 2020 7265 7475 726e 206d 6435 2e68      return md5.h
+00018240: 6578 6469 6765 7374 2829 0a0a 0a64 6566  exdigest()...def
+00018250: 2074 6573 745f 6262 6f78 5f72 6566 6572   test_bbox_refer
+00018260: 656e 6365 2829 202d 3e20 436f 6d70 6f6e  ence() -> Compon
+00018270: 656e 743a 0a20 2020 2069 6d70 6f72 7420  ent:.    import 
+00018280: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
+00018290: 0a0a 2020 2020 6320 3d20 6766 2e43 6f6d  ..    c = gf.Com
+000182a0: 706f 6e65 6e74 2822 636f 6d70 6f6e 656e  ponent("componen
+000182b0: 745f 7769 7468 5f6f 6666 6772 6964 5f70  t_with_offgrid_p
+000182c0: 6f6c 7967 6f6e 7322 290a 2020 2020 6331  olygons").    c1
+000182d0: 203d 2063 203c 3c20 6766 2e63 6f6d 706f   = c << gf.compo
+000182e0: 6e65 6e74 732e 7265 6374 616e 676c 6528  nents.rectangle(
+000182f0: 7369 7a65 3d28 312e 3565 2d33 2c20 312e  size=(1.5e-3, 1.
+00018300: 3565 2d33 292c 2070 6f72 745f 7479 7065  5e-3), port_type
+00018310: 3d4e 6f6e 6529 0a20 2020 2063 3220 3d20  =None).    c2 = 
+00018320: 6320 3c3c 2067 662e 636f 6d70 6f6e 656e  c << gf.componen
+00018330: 7473 2e72 6563 7461 6e67 6c65 2873 697a  ts.rectangle(siz
+00018340: 653d 2831 2e35 652d 332c 2031 2e35 652d  e=(1.5e-3, 1.5e-
+00018350: 3329 2c20 706f 7274 5f74 7970 653d 4e6f  3), port_type=No
+00018360: 6e65 290a 2020 2020 6332 2e78 6d69 6e20  ne).    c2.xmin 
+00018370: 3d20 6331 2e78 6d61 780a 0a20 2020 2061  = c1.xmax..    a
+00018380: 7373 6572 7420 6332 2e78 7369 7a65 203d  ssert c2.xsize =
+00018390: 3d20 3265 2d33 0a20 2020 2072 6574 7572  = 2e-3.    retur
+000183a0: 6e20 6332 0a0a 0a64 6566 2074 6573 745f  n c2...def test_
+000183b0: 6262 6f78 5f63 6f6d 706f 6e65 6e74 2829  bbox_component()
+000183c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
+000183d0: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
+000183e0: 6173 2067 660a 0a20 2020 2063 203d 2067  as gf..    c = g
+000183f0: 662e 636f 6d70 6f6e 656e 7473 2e72 6563  f.components.rec
+00018400: 7461 6e67 6c65 2873 697a 653d 2831 2e35  tangle(size=(1.5
+00018410: 652d 332c 2031 2e35 652d 3329 2c20 706f  e-3, 1.5e-3), po
+00018420: 7274 5f74 7970 653d 4e6f 6e65 290a 2020  rt_type=None).  
+00018430: 2020 6173 7365 7274 2063 2e78 7369 7a65    assert c.xsize
+00018440: 203d 3d20 3265 2d33 0a0a 0a64 6566 2074   == 2e-3...def t
+00018450: 6573 745f 7265 6d61 705f 6c61 7965 7273  est_remap_layers
+00018460: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+00018470: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+00018480: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
+00018490: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+000184a0: 7472 6169 6768 7428 6c61 7965 723d 2832  traight(layer=(2
+000184b0: 2c20 3029 290a 2020 2020 7265 6d61 7020  , 0)).    remap 
+000184c0: 3d20 632e 7265 6d61 705f 6c61 7965 7273  = c.remap_layers
+000184d0: 286c 6179 6572 6d61 703d 7b28 322c 2030  (layermap={(2, 0
+000184e0: 293a 2067 662e 4c41 5945 522e 5747 4e7d  ): gf.LAYER.WGN}
+000184f0: 290a 2020 2020 6861 7368 5f67 656f 6d65  ).    hash_geome
+00018500: 7472 7920 3d20 2238 3366 6263 3661 3832  try = "83fbc6a82
+00018510: 3839 3530 3565 6165 6433 6132 6533 6162  89505eaed3a2e3ab
+00018520: 3237 3963 6330 3366 3565 3464 3030 6322  279cc03f5e4d00c"
+00018530: 0a0a 2020 2020 6173 7365 7274 2028 0a20  ..    assert (. 
+00018540: 2020 2020 2020 2072 656d 6170 2e68 6173         remap.has
+00018550: 685f 6765 6f6d 6574 7279 2829 203d 3d20  h_geometry() == 
+00018560: 6861 7368 5f67 656f 6d65 7472 790a 2020  hash_geometry.  
+00018570: 2020 292c 2066 2268 6173 685f 6765 6f6d    ), f"hash_geom
+00018580: 6574 7279 203d 207b 7265 6d61 702e 6861  etry = {remap.ha
+00018590: 7368 5f67 656f 6d65 7472 7928 2921 727d  sh_geometry()!r}
+000185a0: 220a 0a0a 6465 6620 7465 7374 5f72 656d  "...def test_rem
+000185b0: 6f76 655f 6c61 6265 6c73 2829 202d 3e20  ove_labels() -> 
+000185c0: 4e6f 6e65 3a0a 2020 2020 696d 706f 7274  None:.    import
+000185d0: 2067 6473 6661 6374 6f72 7920 6173 2067   gdsfactory as g
+000185e0: 660a 0a20 2020 2063 203d 2067 662e 632e  f..    c = gf.c.
+000185f0: 7374 7261 6967 6874 2829 0a20 2020 2063  straight().    c
+00018600: 2e72 656d 6f76 655f 6c61 6265 6c73 2829  .remove_labels()
+00018610: 0a0a 2020 2020 6173 7365 7274 206c 656e  ..    assert len
+00018620: 2863 2e6c 6162 656c 7329 203d 3d20 300a  (c.labels) == 0.
+00018630: 0a0a 6465 6620 7465 7374 5f69 6d70 6f72  ..def test_impor
+00018640: 745f 6764 735f 7365 7474 696e 6773 2829  t_gds_settings()
+00018650: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
+00018660: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
+00018670: 6173 2067 660a 0a20 2020 2063 203d 2067  as gf..    c = g
+00018680: 662e 636f 6d70 6f6e 656e 7473 2e6d 7a69  f.components.mzi
+00018690: 2829 0a20 2020 2067 6473 7061 7468 203d  ().    gdspath =
+000186a0: 2063 2e77 7269 7465 5f67 6473 5f77 6974   c.write_gds_wit
+000186b0: 685f 6d65 7461 6461 7461 2829 0a20 2020  h_metadata().   
+000186c0: 2063 3220 3d20 6766 2e69 6d70 6f72 745f   c2 = gf.import_
+000186d0: 6764 7328 6764 7370 6174 682c 206e 616d  gds(gdspath, nam
+000186e0: 653d 226d 7a69 5f73 616d 706c 6522 2c20  e="mzi_sample", 
+000186f0: 7265 6164 5f6d 6574 6164 6174 613d 5472  read_metadata=Tr
+00018700: 7565 290a 2020 2020 6333 203d 2067 662e  ue).    c3 = gf.
+00018710: 726f 7574 696e 672e 6164 645f 6669 6265  routing.add_fibe
+00018720: 725f 7369 6e67 6c65 2863 3229 0a20 2020  r_single(c2).   
+00018730: 2061 7373 6572 7420 6333 0a0a 0a64 6566   assert c3...def
+00018740: 2074 6573 745f 666c 6174 7465 6e5f 696e   test_flatten_in
+00018750: 7661 6c69 645f 7265 6673 5f72 6563 7572  valid_refs_recur
+00018760: 7369 7665 2829 202d 3e20 4e6f 6e65 3a0a  sive() -> None:.
+00018770: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
+00018780: 6374 6f72 7920 6173 2067 660a 2020 2020  ctory as gf.    
+00018790: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+000187a0: 6469 6666 7465 7374 2069 6d70 6f72 7420  difftest import 
+000187b0: 7275 6e5f 786f 720a 2020 2020 6672 6f6d  run_xor.    from
+000187c0: 2067 6473 6661 6374 6f72 792e 726f 7574   gdsfactory.rout
+000187d0: 696e 672e 616c 6c5f 616e 676c 6520 696d  ing.all_angle im
+000187e0: 706f 7274 2067 6574 5f62 756e 646c 655f  port get_bundle_
+000187f0: 616c 6c5f 616e 676c 650a 0a20 2020 2040  all_angle..    @
+00018800: 6766 2e63 656c 6c0a 2020 2020 6465 6620  gf.cell.    def 
+00018810: 666c 6174 2829 3a0a 2020 2020 2020 2020  flat():.        
+00018820: 6320 3d20 6766 2e43 6f6d 706f 6e65 6e74  c = gf.Component
+00018830: 2829 0a20 2020 2020 2020 206d 6d69 3120  ().        mmi1 
+00018840: 3d20 2863 203c 3c20 6766 2e63 6f6d 706f  = (c << gf.compo
+00018850: 6e65 6e74 732e 6d6d 6931 7832 2829 292e  nents.mmi1x2()).
+00018860: 6d6f 7665 2828 302c 202d 312e 3030 3035  move((0, -1.0005
+00018870: 2929 0a20 2020 2020 2020 206d 6d69 3220  )).        mmi2 
+00018880: 3d20 2863 203c 3c20 6766 2e63 6f6d 706f  = (c << gf.compo
+00018890: 6e65 6e74 732e 6d6d 6931 7832 2829 292e  nents.mmi1x2()).
+000188a0: 726f 7461 7465 2838 3029 0a20 2020 2020  rotate(80).     
+000188b0: 2020 206d 6d69 322e 6d6f 7665 2828 3430     mmi2.move((40
+000188c0: 2c20 3230 2929 0a20 2020 2020 2020 2062  , 20)).        b
+000188d0: 756e 646c 6520 3d20 6765 745f 6275 6e64  undle = get_bund
+000188e0: 6c65 5f61 6c6c 5f61 6e67 6c65 285b 6d6d  le_all_angle([mm
+000188f0: 6931 2e70 6f72 7473 5b22 6f32 225d 5d2c  i1.ports["o2"]],
+00018900: 205b 6d6d 6932 2e70 6f72 7473 5b22 6f31   [mmi2.ports["o1
+00018910: 225d 5d29 0a20 2020 2020 2020 2066 6f72  "]]).        for
+00018920: 2072 6f75 7465 2069 6e20 6275 6e64 6c65   route in bundle
+00018930: 3a0a 2020 2020 2020 2020 2020 2020 632e  :.            c.
+00018940: 6164 6428 726f 7574 652e 7265 6665 7265  add(route.refere
+00018950: 6e63 6573 290a 2020 2020 2020 2020 7265  nces).        re
+00018960: 7475 726e 2063 0a0a 2020 2020 4067 662e  turn c..    @gf.
+00018970: 6365 6c6c 0a20 2020 2064 6566 2068 6965  cell.    def hie
+00018980: 7261 7263 6879 2829 3a0a 2020 2020 2020  rarchy():.      
+00018990: 2020 6320 3d20 6766 2e43 6f6d 706f 6e65    c = gf.Compone
+000189a0: 6e74 2829 0a20 2020 2020 2020 2028 6320  nt().        (c 
+000189b0: 3c3c 2066 6c61 7428 2929 2e72 6f74 6174  << flat()).rotat
+000189c0: 6528 3333 290a 2020 2020 2020 2020 2863  e(33).        (c
+000189d0: 203c 3c20 666c 6174 2829 292e 726f 7461   << flat()).rota
+000189e0: 7465 2833 3329 2e6d 6f76 6528 2830 2c20  te(33).move((0, 
+000189f0: 3130 3029 290a 2020 2020 2020 2020 2863  100)).        (c
+00018a00: 203c 3c20 666c 6174 2829 292e 6d6f 7665   << flat()).move
+00018a10: 2828 3130 302c 2030 2929 0a20 2020 2020  ((100, 0)).     
+00018a20: 2020 2072 6574 7572 6e20 630a 0a20 2020     return c..   
+00018a30: 2063 5f6f 7269 6720 3d20 6869 6572 6172   c_orig = hierar
+00018a40: 6368 7928 290a 2020 2020 635f 6e65 7720  chy().    c_new 
+00018a50: 3d20 666c 6174 7465 6e5f 696e 7661 6c69  = flatten_invali
+00018a60: 645f 7265 6673 5f72 6563 7572 7369 7665  d_refs_recursive
+00018a70: 2863 5f6f 7269 6729 0a20 2020 2061 7373  (c_orig).    ass
+00018a80: 6572 7420 635f 6e65 7720 6973 206e 6f74  ert c_new is not
+00018a90: 2063 5f6f 7269 670a 2020 2020 696e 7661   c_orig.    inva
+00018aa0: 6c69 645f 7265 6673 5f66 696c 656e 616d  lid_refs_filenam
+00018ab0: 6520 3d20 2269 6e76 616c 6964 5f72 6566  e = "invalid_ref
+00018ac0: 732e 6764 7322 0a20 2020 2069 6e76 616c  s.gds".    inval
+00018ad0: 6964 5f72 6566 735f 6669 7865 645f 6669  id_refs_fixed_fi
+00018ae0: 6c65 6e61 6d65 203d 2022 696e 7661 6c69  lename = "invali
+00018af0: 645f 7265 6673 5f66 6978 6564 2e67 6473  d_refs_fixed.gds
+00018b00: 220a 2020 2020 2320 6764 7320 6669 6c65  ".    # gds file
+00018b10: 7320 7368 6f75 6c64 2073 7469 6c6c 2062  s should still b
+00018b20: 6520 7361 6d65 2074 6f20 316e 6d20 746f  e same to 1nm to
+00018b30: 6c65 7261 6e63 650a 2020 2020 635f 6f72  lerance.    c_or
+00018b40: 6967 2e77 7269 7465 5f67 6473 2869 6e76  ig.write_gds(inv
+00018b50: 616c 6964 5f72 6566 735f 6669 6c65 6e61  alid_refs_filena
+00018b60: 6d65 290a 2020 2020 635f 6e65 772e 7772  me).    c_new.wr
+00018b70: 6974 655f 6764 7328 696e 7661 6c69 645f  ite_gds(invalid_
+00018b80: 7265 6673 5f66 6978 6564 5f66 696c 656e  refs_fixed_filen
+00018b90: 616d 6529 0a20 2020 2072 756e 5f78 6f72  ame).    run_xor
+00018ba0: 2869 6e76 616c 6964 5f72 6566 735f 6669  (invalid_refs_fi
+00018bb0: 6c65 6e61 6d65 2c20 696e 7661 6c69 645f  lename, invalid_
+00018bc0: 7265 6673 5f66 6978 6564 5f66 696c 656e  refs_fixed_filen
+00018bd0: 616d 6529 0a0a 0a69 6620 5f5f 6e61 6d65  ame)...if __name
+00018be0: 5f5f 203d 3d20 225f 5f6d 6169 6e5f 5f22  __ == "__main__"
+00018bf0: 3a0a 2020 2020 696d 706f 7274 2067 6473  :.    import gds
+00018c00: 6661 6374 6f72 7920 6173 2067 660a 0a20  factory as gf.. 
+00018c10: 2020 2063 203d 2067 662e 436f 6d70 6f6e     c = gf.Compon
+00018c20: 656e 7428 290a 2020 2020 7020 3d20 632e  ent().    p = c.
+00018c30: 6164 645f 706f 6c79 676f 6e28 0a20 2020  add_polygon(.   
+00018c40: 2020 2020 205b 282d 382c 2036 2c20 372c       [(-8, 6, 7,
+00018c50: 2039 292c 2028 2d36 2c20 382c 2031 372c   9), (-6, 8, 17,
+00018c60: 2035 295d 2c20 6c61 7965 723d 2831 2c20   5)], layer=(1, 
+00018c70: 3029 0a20 2020 2029 2020 2320 4744 5320  0).    )  # GDS 
+00018c80: 6c61 7965 7273 2061 7265 2074 7570 6c65  layers are tuple
+00018c90: 7320 6f66 2069 6e74 7320 2862 7574 2069  s of ints (but i
+00018ca0: 6620 7765 2075 7365 206f 6e6c 7920 6f6e  f we use only on
+00018cb0: 6520 6e75 6d62 6572 2069 7420 6173 7375  e number it assu
+00018cc0: 6d65 7320 7468 6520 6f74 6865 7220 6e75  mes the other nu
+00018cd0: 6d62 6572 2069 7320 3029 0a0a 2020 2020  mber is 0)..    
+00018ce0: 2320 6332 203d 2067 662e 436f 6d70 6f6e  # c2 = gf.Compon
+00018cf0: 656e 7428 290a 2020 2020 6320 3d20 6766  ent().    c = gf
+00018d00: 2e63 6f6d 706f 6e65 6e74 732e 6d7a 6928  .components.mzi(
+00018d10: 290a 2020 2020 7072 696e 7428 632e 6765  ).    print(c.ge
+00018d20: 745f 6c61 7965 725f 6e61 6d65 7328 2929  t_layer_names())
+00018d30: 0a20 2020 2023 2063 203d 2067 662e 636f  .    # c = gf.co
+00018d40: 6d70 6f6e 656e 7473 2e6d 7a69 2829 0a20  mponents.mzi(). 
+00018d50: 2020 2023 2070 7269 6e74 2863 2e67 6574     # print(c.get
+00018d60: 5f6c 6179 6572 5f6e 616d 6573 2829 290a  _layer_names()).
+00018d70: 2020 2020 2320 7220 3d20 632e 7265 6628      # r = c.ref(
+00018d80: 290a 2020 2020 2320 6332 2e63 6f70 795f  ).    # c2.copy_
+00018d90: 6368 696c 645f 696e 666f 2863 2e6e 616d  child_info(c.nam
+00018da0: 6564 5f72 6566 6572 656e 6365 735b 2273  ed_references["s
+00018db0: 7874 225d 290a 2020 2020 2320 7465 7374  xt"]).    # test
+00018dc0: 5f72 656d 6170 5f6c 6179 6572 7328 290a  _remap_layers().
+00018dd0: 2020 2020 2320 6320 3d20 7465 7374 5f67      # c = test_g
+00018de0: 6574 5f6c 6179 6572 7328 290a 2020 2020  et_layers().    
+00018df0: 2320 632e 706c 6f74 5f71 7428 290a 2020  # c.plot_qt().  
+00018e00: 2020 2320 632e 706c 6f74 6828 290a 2020    # c.ploth().  
+00018e10: 2020 2320 6320 3d20 7465 7374 5f65 7874    # c = test_ext
+00018e20: 7261 6374 2829 0a20 2020 2023 2067 6473  ract().    # gds
+00018e30: 7061 7468 203d 2063 2e77 7269 7465 5f67  path = c.write_g
+00018e40: 6473 2829 0a20 2020 2023 2067 662e 7368  ds().    # gf.sh
+00018e50: 6f77 2867 6473 7061 7468 290a 2020 2020  ow(gdspath).    
+00018e60: 2320 632e 7368 6f77 2873 686f 775f 706f  # c.show(show_po
+00018e70: 7274 733d 5472 7565 290a 2020 2020 632e  rts=True).    c.
+00018e80: 7368 6f77 2829 0a                        show().
```

### Comparing `gdsfactory-6.94.1/gdsfactory/component_layout.py` & `gdsfactory-6.95.0/gdsfactory/component_layout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/component_reference.py` & `gdsfactory-6.95.0/gdsfactory/component_reference.py`

 * *Files 1% similar despite different names*

```diff
@@ -477,14 +477,16 @@
             self._local_ports[name].parent = self
         # Remove any ports that no longer exist in the reference's parent
         parent_names = self.parent.ports.keys()
         local_names = list(self._local_ports.keys())
         for name in local_names:
             if name not in parent_names:
                 self._local_ports.pop(name)
+        for k in list(self._local_ports):
+            self._local_ports[k].reference = self
         return self._local_ports
 
     @property
     def info(self) -> Dict[str, Any]:
         return self.parent.info
 
     @property
```

### Comparing `gdsfactory-6.94.1/gdsfactory/components/C.py` & `gdsfactory-6.95.0/gdsfactory/components/C.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/L.py` & `gdsfactory-6.95.0/gdsfactory/components/L.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/__init__.py` & `gdsfactory-6.95.0/gdsfactory/components/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/add_fiducials.py` & `gdsfactory-6.95.0/gdsfactory/components/add_fiducials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/add_grating_couplers.py` & `gdsfactory-6.95.0/gdsfactory/components/add_grating_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/add_trenches.py` & `gdsfactory-6.95.0/gdsfactory/components/add_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/align.py` & `gdsfactory-6.95.0/gdsfactory/components/align.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/array_component.py` & `gdsfactory-6.95.0/gdsfactory/components/array_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/array_with_fanout.py` & `gdsfactory-6.95.0/gdsfactory/components/array_with_fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/array_with_via.py` & `gdsfactory-6.95.0/gdsfactory/components/array_with_via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/awg.py` & `gdsfactory-6.95.0/gdsfactory/components/awg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/bbox.py` & `gdsfactory-6.95.0/gdsfactory/components/bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/bend_circular.py` & `gdsfactory-6.95.0/gdsfactory/components/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/bend_circular_heater.py` & `gdsfactory-6.95.0/gdsfactory/components/bend_circular_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/bend_euler.py` & `gdsfactory-6.95.0/gdsfactory/components/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/bend_port.py` & `gdsfactory-6.95.0/gdsfactory/components/bend_port.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/bend_s.py` & `gdsfactory-6.95.0/gdsfactory/components/bend_s.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/bezier.py` & `gdsfactory-6.95.0/gdsfactory/components/bezier.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cavity.py` & `gdsfactory-6.95.0/gdsfactory/components/cavity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cdc.py` & `gdsfactory-6.95.0/gdsfactory/components/cdc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cdsem_all.py` & `gdsfactory-6.95.0/gdsfactory/components/cdsem_all.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cdsem_bend180.py` & `gdsfactory-6.95.0/gdsfactory/components/cdsem_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cdsem_coupler.py` & `gdsfactory-6.95.0/gdsfactory/components/cdsem_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cdsem_straight.py` & `gdsfactory-6.95.0/gdsfactory/components/cdsem_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cdsem_straight_density.py` & `gdsfactory-6.95.0/gdsfactory/components/cdsem_straight_density.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/circle.py` & `gdsfactory-6.95.0/gdsfactory/components/circle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coh_rx_dual_pol.py` & `gdsfactory-6.95.0/gdsfactory/components/coh_rx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coh_rx_single_pol.py` & `gdsfactory-6.95.0/gdsfactory/components/coh_rx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coh_tx_dual_pol.py` & `gdsfactory-6.95.0/gdsfactory/components/coh_tx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coh_tx_single_pol.py` & `gdsfactory-6.95.0/gdsfactory/components/coh_tx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/compass.py` & `gdsfactory-6.95.0/gdsfactory/components/compass.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/component_lattice.py` & `gdsfactory-6.95.0/gdsfactory/components/component_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/component_sequence.py` & `gdsfactory-6.95.0/gdsfactory/components/component_sequence.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/copy_layers.py` & `gdsfactory-6.95.0/gdsfactory/components/copy_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler90.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler90.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler90bend.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler90bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler_adiabatic.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler_asymmetric.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler_full.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler_full.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler_ring.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler_straight.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler_straight_asymmetric.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler_straight_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/coupler_symmetric.py` & `gdsfactory-6.95.0/gdsfactory/components/coupler_symmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cross.py` & `gdsfactory-6.95.0/gdsfactory/components/cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/crossing_waveguide.py` & `gdsfactory-6.95.0/gdsfactory/components/crossing_waveguide.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv` & `gdsfactory-6.95.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv` & `gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv` & `gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv` & `gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv` & `gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv` & `gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv` & `gdsfactory-6.95.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cutback_2x2.py` & `gdsfactory-6.95.0/gdsfactory/components/cutback_2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cutback_bend.py` & `gdsfactory-6.95.0/gdsfactory/components/cutback_bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cutback_component.py` & `gdsfactory-6.95.0/gdsfactory/components/cutback_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/cutback_splitter.py` & `gdsfactory-6.95.0/gdsfactory/components/cutback_splitter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/dbr.py` & `gdsfactory-6.95.0/gdsfactory/components/dbr.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/dbr_tapered.py` & `gdsfactory-6.95.0/gdsfactory/components/dbr_tapered.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/delay_snake.py` & `gdsfactory-6.95.0/gdsfactory/components/delay_snake.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/delay_snake2.py` & `gdsfactory-6.95.0/gdsfactory/components/delay_snake2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/delay_snake3.py` & `gdsfactory-6.95.0/gdsfactory/components/delay_snake3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/delay_snake_sbend.py` & `gdsfactory-6.95.0/gdsfactory/components/delay_snake_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/dicing_lane.py` & `gdsfactory-6.95.0/gdsfactory/components/dicing_lane.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/die.py` & `gdsfactory-6.95.0/gdsfactory/components/die.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/die_bbox.py` & `gdsfactory-6.95.0/gdsfactory/components/die_bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/die_bbox_frame.py` & `gdsfactory-6.95.0/gdsfactory/components/die_bbox_frame.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/disk.py` & `gdsfactory-6.95.0/gdsfactory/components/disk.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/edge_coupler_array.py` & `gdsfactory-6.95.0/gdsfactory/components/edge_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ellipse.py` & `gdsfactory-6.95.0/gdsfactory/components/ellipse.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/extend_ports_list.py` & `gdsfactory-6.95.0/gdsfactory/components/extend_ports_list.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/extension.py` & `gdsfactory-6.95.0/gdsfactory/components/extension.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/fiber.py` & `gdsfactory-6.95.0/gdsfactory/components/fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/fiber_array.py` & `gdsfactory-6.95.0/gdsfactory/components/fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/fiducial_squares.py` & `gdsfactory-6.95.0/gdsfactory/components/fiducial_squares.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ge_detector_straight_si_contacts.py` & `gdsfactory-6.95.0/gdsfactory/components/ge_detector_straight_si_contacts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_array.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_dual_pol.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_elliptical.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_elliptical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_elliptical_arbitrary.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_elliptical_lumerical.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_elliptical_trenches.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_elliptical_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_functions.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_loss.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_loss.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_loss_fiber_single.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_loss_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_rectangular.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_rectangular_arbitrary.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/grating_coupler_tree.py` & `gdsfactory-6.95.0/gdsfactory/components/grating_coupler_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/greek_cross.py` & `gdsfactory-6.95.0/gdsfactory/components/greek_cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/hline.py` & `gdsfactory-6.95.0/gdsfactory/components/hline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/interdigital_capacitor.py` & `gdsfactory-6.95.0/gdsfactory/components/interdigital_capacitor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/litho_calipers.py` & `gdsfactory-6.95.0/gdsfactory/components/litho_calipers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/litho_ruler.py` & `gdsfactory-6.95.0/gdsfactory/components/litho_ruler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/litho_steps.py` & `gdsfactory-6.95.0/gdsfactory/components/litho_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/logo.py` & `gdsfactory-6.95.0/gdsfactory/components/logo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/loop_mirror.py` & `gdsfactory-6.95.0/gdsfactory/components/loop_mirror.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mmi1x2.py` & `gdsfactory-6.95.0/gdsfactory/components/mmi1x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mmi1x2_with_sbend.py` & `gdsfactory-6.95.0/gdsfactory/components/mmi1x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mmi2x2.py` & `gdsfactory-6.95.0/gdsfactory/components/mmi2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mmi2x2_with_sbend.py` & `gdsfactory-6.95.0/gdsfactory/components/mmi2x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mmi_90degree_hybrid.py` & `gdsfactory-6.95.0/gdsfactory/components/mmi_90degree_hybrid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mode_converter.py` & `gdsfactory-6.95.0/gdsfactory/components/mode_converter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzi.py` & `gdsfactory-6.95.0/gdsfactory/components/mzi.py`

 * *Files 2% similar despite different names*

```diff
@@ -218,14 +218,19 @@
     mzi2x2_2x2,
     splitter=coupler,
     combiner=coupler,
 )
 
 
 if __name__ == "__main__":
+    from gdsfactory import get_generic_pdk
+
+    pdk = get_generic_pdk()
+    pdk.activate()
+
     c = mzi(cross_section="strip")
     # c = gf.components.mzi2x2_2x2(straight_x_top="straight_heater_metal")
     # c.show(show_ports=True)
 
     # c = gf.components.mzi2x2_2x2(straight_x_top="straight_heater_metal")
     c = gf.routing.add_fiber_array(c)
     c.show()
```

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzi_arm.py` & `gdsfactory-6.95.0/gdsfactory/components/mzi_arm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzi_arms.py` & `gdsfactory-6.95.0/gdsfactory/components/mzi_arms.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzi_lattice.py` & `gdsfactory-6.95.0/gdsfactory/components/mzi_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzi_pads_center.py` & `gdsfactory-6.95.0/gdsfactory/components/mzi_pads_center.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzi_phase_shifter.py` & `gdsfactory-6.95.0/gdsfactory/components/mzi_phase_shifter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzit.py` & `gdsfactory-6.95.0/gdsfactory/components/mzit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzit_lattice.py` & `gdsfactory-6.95.0/gdsfactory/components/mzit_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/mzm.py` & `gdsfactory-6.95.0/gdsfactory/components/mzm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/nxn.py` & `gdsfactory-6.95.0/gdsfactory/components/nxn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/optimal_90deg.py` & `gdsfactory-6.95.0/gdsfactory/components/optimal_90deg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/optimal_hairpin.py` & `gdsfactory-6.95.0/gdsfactory/components/optimal_hairpin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/optimal_step.py` & `gdsfactory-6.95.0/gdsfactory/components/optimal_step.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/pack_doe.py` & `gdsfactory-6.95.0/gdsfactory/components/pack_doe.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/pad.py` & `gdsfactory-6.95.0/gdsfactory/components/pad.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/pad_gsg.py` & `gdsfactory-6.95.0/gdsfactory/components/pad_gsg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/pads_shorted.py` & `gdsfactory-6.95.0/gdsfactory/components/pads_shorted.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/polarization_splitter_rotator.py` & `gdsfactory-6.95.0/gdsfactory/components/polarization_splitter_rotator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ramp.py` & `gdsfactory-6.95.0/gdsfactory/components/ramp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/rectangle.py` & `gdsfactory-6.95.0/gdsfactory/components/rectangle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/rectangle_with_slits.py` & `gdsfactory-6.95.0/gdsfactory/components/rectangle_with_slits.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/regular_polygon.py` & `gdsfactory-6.95.0/gdsfactory/components/regular_polygon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/resistance_meander.py` & `gdsfactory-6.95.0/gdsfactory/components/resistance_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/resistance_sheet.py` & `gdsfactory-6.95.0/gdsfactory/components/resistance_sheet.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring.py` & `gdsfactory-6.95.0/gdsfactory/components/ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_crow.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_crow.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_crow_couplers.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_crow_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_double.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_double_bend_coupler.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_double_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_double_heater.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_double_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_double_pn.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_double_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_section_based.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_section_based.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_single.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_single_array.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_single_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_single_bend_coupler.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_single_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_single_dut.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_single_dut.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_single_heater.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_single_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/ring_single_pn.py` & `gdsfactory-6.95.0/gdsfactory/components/ring_single_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/seal_ring.py` & `gdsfactory-6.95.0/gdsfactory/components/seal_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/snspd.py` & `gdsfactory-6.95.0/gdsfactory/components/snspd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/spiral_double.py` & `gdsfactory-6.95.0/gdsfactory/components/spiral_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/spiral_external_io.py` & `gdsfactory-6.95.0/gdsfactory/components/spiral_external_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/spiral_heater.py` & `gdsfactory-6.95.0/gdsfactory/components/spiral_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/spiral_inner_io.py` & `gdsfactory-6.95.0/gdsfactory/components/spiral_inner_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/splitter_chain.py` & `gdsfactory-6.95.0/gdsfactory/components/splitter_chain.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/splitter_tree.py` & `gdsfactory-6.95.0/gdsfactory/components/splitter_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight.py` & `gdsfactory-6.95.0/gdsfactory/components/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_array.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_heater_doped_rib.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_heater_doped_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_heater_doped_strip.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_heater_doped_strip.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_heater_meander.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_heater_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_heater_meander_doped.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_heater_meander_doped.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_heater_metal.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_heater_metal.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_pin.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_pin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_pin_slot.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_pin_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/straight_rib.py` & `gdsfactory-6.95.0/gdsfactory/components/straight_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/switch_tree.py` & `gdsfactory-6.95.0/gdsfactory/components/switch_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/taper.py` & `gdsfactory-6.95.0/gdsfactory/components/taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/taper_adiabatic.py` & `gdsfactory-6.95.0/gdsfactory/components/taper_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/taper_cross_section.py` & `gdsfactory-6.95.0/gdsfactory/components/taper_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/taper_from_csv.py` & `gdsfactory-6.95.0/gdsfactory/components/taper_from_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/taper_parabolic.py` & `gdsfactory-6.95.0/gdsfactory/components/taper_parabolic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/terminator.py` & `gdsfactory-6.95.0/gdsfactory/components/terminator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/text.py` & `gdsfactory-6.95.0/gdsfactory/components/text.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/text_freetype.py` & `gdsfactory-6.95.0/gdsfactory/components/text_freetype.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/text_rectangular.py` & `gdsfactory-6.95.0/gdsfactory/components/text_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/text_rectangular_font.py` & `gdsfactory-6.95.0/gdsfactory/components/text_rectangular_font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/triangles.py` & `gdsfactory-6.95.0/gdsfactory/components/triangles.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/verniers.py` & `gdsfactory-6.95.0/gdsfactory/components/verniers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/version_stamp.py` & `gdsfactory-6.95.0/gdsfactory/components/version_stamp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/via.py` & `gdsfactory-6.95.0/gdsfactory/components/via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/via_corner.py` & `gdsfactory-6.95.0/gdsfactory/components/via_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/via_cutback.py` & `gdsfactory-6.95.0/gdsfactory/components/via_cutback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/via_stack.py` & `gdsfactory-6.95.0/gdsfactory/components/via_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/via_stack_slot.py` & `gdsfactory-6.95.0/gdsfactory/components/via_stack_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/via_stack_with_offset.py` & `gdsfactory-6.95.0/gdsfactory/components/via_stack_with_offset.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/wafer.py` & `gdsfactory-6.95.0/gdsfactory/components/wafer.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/wire.py` & `gdsfactory-6.95.0/gdsfactory/components/wire.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/components/wire_sbend.py` & `gdsfactory-6.95.0/gdsfactory/components/wire_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/config.py` & `gdsfactory-6.95.0/gdsfactory/config.py`

 * *Files 2% similar despite different names*

```diff
@@ -30,15 +30,15 @@
 from loguru import logger
 import omegaconf
 from omegaconf import OmegaConf
 
 from rich.console import Console
 from rich.table import Table
 
-__version__ = "6.94.1"
+__version__ = "6.95.0"
 PathType = Union[str, pathlib.Path]
 
 home = pathlib.Path.home()
 cwd = pathlib.Path.cwd()
 module_path = pathlib.Path(__file__).parent.absolute()
 repo_path = module_path.parent
 home_path = pathlib.Path.home() / ".gdsfactory"
@@ -161,23 +161,24 @@
     klayout = generic_tech / "klayout"
     klayout_tech = klayout / "tech"
     klayout_lyp = klayout_tech / "generic_tech.lyp"
     klayout_yaml = generic_tech / "layer_views.yaml"
     schema_netlist = repo_path / "tests" / "schemas" / "netlist.json"
     netlists = module_path / "samples" / "netlists"
     gdsdir = repo_path / "tests" / "gds"
-    gdslib = repo_path / "data"
+    gdslib = home / ".gdsfactory"
     modes = gdslib / "modes"
     sparameters = gdslib / "sp"
     interconnect = gdslib / "interconnect"
     optimiser = repo_path / "tune"
     notebooks = repo_path / "docs" / "notebooks"
     plugins = module / "plugins"
     web = plugins / "web"
-    gds_ref = gdslib / "gds"
+    test_data = repo / "test-data"
+    gds_ref = test_data / "gds"
     gds_run = GDSDIR_TEMP / "gds_run"
     gds_diff = GDSDIR_TEMP / "gds_diff"
 
 
 def read_config(
     yamlpaths: Iterable[PathType] = (yamlpath_default, yamlpath_home, yamlpath_cwd),
 ) -> omegaconf.DictConfig:
```

### Comparing `gdsfactory-6.94.1/gdsfactory/constants.py` & `gdsfactory-6.95.0/gdsfactory/constants.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/containers.py` & `gdsfactory-6.95.0/gdsfactory/containers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/cross_section.py` & `gdsfactory-6.95.0/gdsfactory/cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/decorators.py` & `gdsfactory-6.95.0/gdsfactory/decorators.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/difftest.py` & `gdsfactory-6.95.0/gdsfactory/difftest.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/events.py` & `gdsfactory-6.95.0/gdsfactory/events.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/export/to_3d.py` & `gdsfactory-6.95.0/gdsfactory/export/to_3d.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/export/to_np.py` & `gdsfactory-6.95.0/gdsfactory/export/to_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/export/to_stl.py` & `gdsfactory-6.95.0/gdsfactory/export/to_stl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/export/write_gerbers.py` & `gdsfactory-6.95.0/gdsfactory/export/write_gerbers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/filestorage.py` & `gdsfactory-6.95.0/gdsfactory/filestorage.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/fill.py` & `gdsfactory-6.95.0/gdsfactory/fill.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/font.py` & `gdsfactory-6.95.0/gdsfactory/font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/functions.py` & `gdsfactory-6.95.0/gdsfactory/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/gdsdiff/gds_diff_git.py` & `gdsfactory-6.95.0/gdsfactory/gdsdiff/gds_diff_git.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/gdsdiff/gdsdiff.py` & `gdsfactory-6.95.0/gdsfactory/gdsdiff/gdsdiff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/gdsdiff/install.py` & `gdsfactory-6.95.0/gdsfactory/gdsdiff/install.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/gdsdiff/test_xor.py` & `gdsfactory-6.95.0/gdsfactory/gdsdiff/test_xor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/README.md` & `gdsfactory-6.95.0/gdsfactory/generic_tech/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/__init__.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/get_klayout_pyxs.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/get_klayout_pyxs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/drc/errors.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/drc/errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/grain.xml`

 * *Files 1% similar despite different names*

#### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/grain.xml`

```diff
@@ -1,13 +1,13 @@
 <?xml version="1.0" encoding="utf-8"?>
 <salt-grain>
   <name>gdsfactory</name>
   <token/>
   <hidden>false</hidden>
-  <version>6.94.1</version>
+  <version>6.95.0</version>
   <api-version/>
   <title>gdsfactory</title>
   <doc>EDA tool to layout integrated circuits</doc>
   <doc-url>https://gdsfactory.github.io/gdsfactory/</doc-url>
   <url>https://github.com/gdsfactory/gdsfactory</url>
   <license>MIT</license>
   <author>Joaquin Matres</author>
```

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/icon_128x128.png` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/icon_128x128.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/icon_64x64.png` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/icon_64x64.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/README.md` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/run_lvs.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/run_lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

 * *Files 16% similar despite different names*

#### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

```diff
@@ -12,15 +12,15 @@
   <show-in-menu>false</show-in-menu>
   <group-name/>
   <menu-path>gdsfactory.begin</menu-path>
   <interpreter>python</interpreter>
   <dsl-interpreter-name/>
   <text>import pya
 
-__version__ = &quot;6.94.1&quot;
+__version__ = &quot;6.95.0&quot;
 
 
 def set_menu():
     menu = pya.Application.instance().main_window().menu()
 
     s0 = &quot;gdsfactory&quot;
     if not (menu.is_menu(s0)):
```

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/generic.layerstack` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/layers.lyp` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/layers.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/tech.lyt` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/tech.lyt`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs` & `gdsfactory-6.95.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/layer_map.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/layer_stack.py` & `gdsfactory-6.95.0/gdsfactory/generic_tech/layer_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/generic_tech/layer_views.yaml` & `gdsfactory-6.95.0/gdsfactory/generic_tech/layer_views.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/__init__.py` & `gdsfactory-6.95.0/gdsfactory/geometry/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/boolean.py` & `gdsfactory-6.95.0/gdsfactory/geometry/boolean.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/boolean_klayout.py` & `gdsfactory-6.95.0/gdsfactory/geometry/boolean_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/boolean_polygons.py` & `gdsfactory-6.95.0/gdsfactory/geometry/boolean_polygons.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/check_duplicated_cells.py` & `gdsfactory-6.95.0/gdsfactory/geometry/check_duplicated_cells.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/check_exclusion.py` & `gdsfactory-6.95.0/gdsfactory/geometry/check_exclusion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/check_inclusion.py` & `gdsfactory-6.95.0/gdsfactory/geometry/check_inclusion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/check_space.py` & `gdsfactory-6.95.0/gdsfactory/geometry/check_space.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/check_width.py` & `gdsfactory-6.95.0/gdsfactory/geometry/check_width.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/fill_klayout.py` & `gdsfactory-6.95.0/gdsfactory/geometry/fill_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/fill_tiled.py` & `gdsfactory-6.95.0/gdsfactory/geometry/fill_tiled.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/fillet.py` & `gdsfactory-6.95.0/gdsfactory/geometry/fillet.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/functions.py` & `gdsfactory-6.95.0/gdsfactory/geometry/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/invert.py` & `gdsfactory-6.95.0/gdsfactory/geometry/invert.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/layer_priority.py` & `gdsfactory-6.95.0/gdsfactory/geometry/layer_priority.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/manhattanize.py` & `gdsfactory-6.95.0/gdsfactory/geometry/manhattanize.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/maskprep.py` & `gdsfactory-6.95.0/gdsfactory/geometry/maskprep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/maskprep_flat.py` & `gdsfactory-6.95.0/gdsfactory/geometry/maskprep_flat.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/offset.py` & `gdsfactory-6.95.0/gdsfactory/geometry/offset.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/outline.py` & `gdsfactory-6.95.0/gdsfactory/geometry/outline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/trim.py` & `gdsfactory-6.95.0/gdsfactory/geometry/trim.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/union.py` & `gdsfactory-6.95.0/gdsfactory/geometry/union.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/write_connectivity.py` & `gdsfactory-6.95.0/gdsfactory/geometry/write_connectivity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/write_drc.py` & `gdsfactory-6.95.0/gdsfactory/geometry/write_drc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/geometry/xor_diff.py` & `gdsfactory-6.95.0/gdsfactory/geometry/xor_diff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/get_factories.py` & `gdsfactory-6.95.0/gdsfactory/get_factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/get_netlist.py` & `gdsfactory-6.95.0/gdsfactory/get_netlist.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/get_netlist_flat.py` & `gdsfactory-6.95.0/gdsfactory/get_netlist_flat.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/get_netlist_klayout.py` & `gdsfactory-6.95.0/gdsfactory/get_netlist_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/grid.py` & `gdsfactory-6.95.0/gdsfactory/grid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/install.py` & `gdsfactory-6.95.0/gdsfactory/install.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/klive.py` & `gdsfactory-6.95.0/gdsfactory/klive.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/labels/__init__.py` & `gdsfactory-6.95.0/gdsfactory/labels/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/labels/add_label_yaml.py` & `gdsfactory-6.95.0/gdsfactory/labels/add_label_yaml.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/labels/ehva.py` & `gdsfactory-6.95.0/gdsfactory/labels/ehva.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/labels/merge_test_metadata.py` & `gdsfactory-6.95.0/gdsfactory/labels/merge_test_metadata.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/labels/siepic.py` & `gdsfactory-6.95.0/gdsfactory/labels/siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/labels/write_labels.py` & `gdsfactory-6.95.0/gdsfactory/labels/write_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/materials.py` & `gdsfactory-6.95.0/gdsfactory/materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/name.py` & `gdsfactory-6.95.0/gdsfactory/name.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/pack.py` & `gdsfactory-6.95.0/gdsfactory/pack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/path.py` & `gdsfactory-6.95.0/gdsfactory/path.py`

 * *Files 0% similar despite different names*

```diff
@@ -817,15 +817,16 @@
             p_pts = p_sec.points
 
             new_x_start = p.xmin + section.insets[0]
             new_x_stop = p.xmax - section.insets[1]
 
             if new_x_start > np.max(p_pts[:, 0]) or new_x_stop < np.min(p_pts[:, 0]):
                 warnings.warn(
-                    f"Cannot apply delay to Section '{section.name}', delay results in points outside of original path."
+                    f"Cannot apply delay to Section '{section.name}', delay results in points outside of original path.",
+                    stacklevel=3,
                 )
                 continue
 
             new_start_idx = np.argwhere(p_pts[:, 0] > new_x_start)[0, 0]
             new_stop_idx = np.argwhere(p_pts[:, 0] < new_x_stop)[-1, 0]
 
             new_start_point = [new_x_start, p_pts[new_start_idx, 1]]
```

### Comparing `gdsfactory-6.94.1/gdsfactory/pdk.py` & `gdsfactory-6.95.0/gdsfactory/pdk.py`

 * *Files 6% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 
 from __future__ import annotations
 import pathlib
 import warnings
 from functools import partial
 from typing import Any, Callable, Optional, Union, Tuple
 from typing_extensions import Literal
+from gdsfactory.name import MAX_NAME_LENGTH
 
 import numpy as np
 from omegaconf import DictConfig
 from pydantic import BaseModel, Field, validator
 
 from gdsfactory.config import PATH, logger
 from gdsfactory.containers import containers as containers_default
@@ -101,14 +102,51 @@
     )
     standard_properties: bool = Field(
         default=False,
         description="If true, stores standard OASIS properties in the file.",
     )
 
 
+class CellDecoratorSettings(BaseModel):
+    """Settings for cell_without_validator decorator function in gdsfactory.cell."""
+
+    with_hash: bool = Field(
+        default=False,
+        description="If true, will append a hash of the cell to the cell name.",
+    )
+    autoname: bool = Field(
+        default=True,
+        description="If true, will automatically name the cell based on its parameters.",
+    )
+    name: Optional[str] = Field(
+        default=None,
+        description="If set, will override the cell name with this value.",
+    )
+    cache: bool = Field(
+        default=True,
+        description="If true, will cache the cell in the gdsfactory.cell.CACHE",
+    )
+    flatten: bool = Field(
+        default=False,
+        description="If true, will flatten the cell before returning it.",
+    )
+    info: Dict[str, Any] = Field(
+        default={},
+        description="Additional information to store in the cell.",
+    )
+    prefix: Optional[str] = Field(
+        default=None,
+        description="If set, will prepend this string to the cell name.",
+    )
+    max_name_length: int = Field(
+        default=MAX_NAME_LENGTH,
+        description="Maximum length of the cell name.",
+    )
+
+
 class Pdk(BaseModel):
     """Store layers, cross_sections, cell functions, simulation_settings ...
 
     only one Pdk can be active at a given time.
 
     Parameters:
         name: PDK name.
@@ -136,14 +174,15 @@
             float: refractive index.
             float, float: refractive index real and imaginary part.
             function: function of wavelength.
         routing_strategies: functions enabled to route.
         circuit_yaml_parser: can parse different YAML formats.
         gds_write_settings: to write GDSII files.
         oasis_settings: to write OASIS files.
+        cell_decorator_settings: settings for cell_without_validator decorator function in gdsfactory.cell.
         bend_points_distance: default points distance for bends in um.
 
     """
 
     name: str
     cross_sections: Dict[str, CrossSectionFactory] = Field(default_factory=dict)
     cells: Dict[str, ComponentFactory] = Field(default_factory=dict)
@@ -164,14 +203,15 @@
     warn_off_grid_ports: bool = False
     constants: Dict[str, Any] = constants
     materials_index: Dict[str, MaterialSpec] = materials_index_default
     routing_strategies: Optional[Dict[str, Callable]] = None
     circuit_yaml_parser: Callable = cell_from_yaml
     gds_write_settings: GdsWriteSettings = GdsWriteSettings()
     oasis_settings: OasisWriteSettings = OasisWriteSettings()
+    cell_decorator_settings: CellDecoratorSettings = CellDecoratorSettings()
     bend_points_distance: float = 20 * nm
 
     @property
     def grid_size(self):
         """The minimum unit resolvable on the layout grid, relative to the unit."""
         return self.gds_write_settings.precision / self.gds_write_settings.unit
```

### Comparing `gdsfactory-6.94.1/gdsfactory/picmodel.py` & `gdsfactory-6.95.0/gdsfactory/picmodel.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/pixelate.py` & `gdsfactory-6.95.0/gdsfactory/pixelate.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/plugins/dagster/workflow.py` & `gdsfactory-6.95.0/gdsfactory/plugins/dagster/workflow.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/plugins/database/README.md` & `gdsfactory-6.95.0/gdsfactory/plugins/database/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/plugins/database/db_upload.py` & `gdsfactory-6.95.0/gdsfactory/plugins/database/db_upload.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/plugins/database/models.py` & `gdsfactory-6.95.0/gdsfactory/plugins/database/models.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/plugins/web/main.py` & `gdsfactory-6.95.0/gdsfactory/plugins/web/main.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/plugins/web/server.py` & `gdsfactory-6.95.0/gdsfactory/plugins/web/server.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/plugins/web/server_jupyter.py` & `gdsfactory-6.95.0/gdsfactory/plugins/web/server_jupyter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/plugins/web/static/client.css` & `gdsfactory-6.95.0/gdsfactory/plugins/web/static/client.css`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/port.py` & `gdsfactory-6.95.0/gdsfactory/port.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/quickplotter.py` & `gdsfactory-6.95.0/gdsfactory/quickplotter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/__init__.py` & `gdsfactory-6.95.0/gdsfactory/read/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/from_dphox.py` & `gdsfactory-6.95.0/gdsfactory/read/from_dphox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/from_gdspaths.py` & `gdsfactory-6.95.0/gdsfactory/read/from_gdspaths.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/from_np.py` & `gdsfactory-6.95.0/gdsfactory/read/from_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/from_phidl.py` & `gdsfactory-6.95.0/gdsfactory/read/from_phidl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/from_yaml.py` & `gdsfactory-6.95.0/gdsfactory/read/from_yaml.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/from_yaml_template.py` & `gdsfactory-6.95.0/gdsfactory/read/from_yaml_template.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/import_gds.py` & `gdsfactory-6.95.0/gdsfactory/read/import_gds.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/read/labels.py` & `gdsfactory-6.95.0/gdsfactory/read/labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/__init__.py` & `gdsfactory-6.95.0/gdsfactory/routing/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/add_electrical_pads_shortest.py` & `gdsfactory-6.95.0/gdsfactory/routing/add_electrical_pads_shortest.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/add_electrical_pads_top.py` & `gdsfactory-6.95.0/gdsfactory/routing/add_electrical_pads_top.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/add_electrical_pads_top_dc.py` & `gdsfactory-6.95.0/gdsfactory/routing/add_electrical_pads_top_dc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/add_fiber_array.py` & `gdsfactory-6.95.0/gdsfactory/routing/add_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/add_fiber_single.py` & `gdsfactory-6.95.0/gdsfactory/routing/add_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/add_pads.py` & `gdsfactory-6.95.0/gdsfactory/routing/add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/all_angle.py` & `gdsfactory-6.95.0/gdsfactory/routing/all_angle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/auto_taper.py` & `gdsfactory-6.95.0/gdsfactory/routing/auto_taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/factories.py` & `gdsfactory-6.95.0/gdsfactory/routing/factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/fanout.py` & `gdsfactory-6.95.0/gdsfactory/routing/fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/fanout2x2.py` & `gdsfactory-6.95.0/gdsfactory/routing/fanout2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_bundle.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_bundle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_bundle_corner.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_bundle_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_bundle_from_steps.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_bundle_from_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_bundle_from_waypoints.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_bundle_from_waypoints.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_bundle_path_length_match.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_bundle_path_length_match.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_bundle_sbend.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_bundle_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_bundle_u.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_bundle_u.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_input_labels.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_input_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_route.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_route.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_route_astar.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_route_astar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_route_from_steps.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_route_from_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_route_sbend.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_route_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_routes_bend180.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_routes_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/get_routes_straight.py` & `gdsfactory-6.95.0/gdsfactory/routing/get_routes_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/manhattan.py` & `gdsfactory-6.95.0/gdsfactory/routing/manhattan.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/path_length_matching.py` & `gdsfactory-6.95.0/gdsfactory/routing/path_length_matching.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/route_fiber_array.py` & `gdsfactory-6.95.0/gdsfactory/routing/route_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/route_fiber_single.py` & `gdsfactory-6.95.0/gdsfactory/routing/route_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/route_ports_to_side.py` & `gdsfactory-6.95.0/gdsfactory/routing/route_ports_to_side.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/route_quad.py` & `gdsfactory-6.95.0/gdsfactory/routing/route_quad.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/route_sharp.py` & `gdsfactory-6.95.0/gdsfactory/routing/route_sharp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/route_south.py` & `gdsfactory-6.95.0/gdsfactory/routing/route_south.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/sort_ports.py` & `gdsfactory-6.95.0/gdsfactory/routing/sort_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/routing/utils.py` & `gdsfactory-6.95.0/gdsfactory/routing/utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/01_component_pcell.py` & `gdsfactory-6.95.0/gdsfactory/samples/01_component_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/01_component_pcell/test_straight_wide.yml` & `gdsfactory-6.95.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/01_component_pcell_with_pins.py` & `gdsfactory-6.95.0/gdsfactory/samples/01_component_pcell_with_pins.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml` & `gdsfactory-6.95.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/03_move.py` & `gdsfactory-6.95.0/gdsfactory/samples/03_move.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/04_connect.py` & `gdsfactory-6.95.0/gdsfactory/samples/04_connect.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/05_remove_layers.py` & `gdsfactory-6.95.0/gdsfactory/samples/05_remove_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/06_remapping_layers.py` & `gdsfactory-6.95.0/gdsfactory/samples/06_remapping_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/07_flattening_device.py` & `gdsfactory-6.95.0/gdsfactory/samples/07_flattening_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/11_component_layout.py` & `gdsfactory-6.95.0/gdsfactory/samples/11_component_layout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/12_component_refs.py` & `gdsfactory-6.95.0/gdsfactory/samples/12_component_refs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/13_component_netlist.py` & `gdsfactory-6.95.0/gdsfactory/samples/13_component_netlist.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/14_component_connectivity.py` & `gdsfactory-6.95.0/gdsfactory/samples/14_component_connectivity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/15_component_sequence1.py` & `gdsfactory-6.95.0/gdsfactory/samples/15_component_sequence1.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/16_component_sequence2.py` & `gdsfactory-6.95.0/gdsfactory/samples/16_component_sequence2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/17_ports.py` & `gdsfactory-6.95.0/gdsfactory/samples/17_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/20_components.py` & `gdsfactory-6.95.0/gdsfactory/samples/20_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/22_add_pads.py` & `gdsfactory-6.95.0/gdsfactory/samples/22_add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/23_reticle.py` & `gdsfactory-6.95.0/gdsfactory/samples/23_reticle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/23_reticle_passives.py` & `gdsfactory-6.95.0/gdsfactory/samples/23_reticle_passives.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/24_doe_2.py` & `gdsfactory-6.95.0/gdsfactory/samples/24_doe_2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/24_doe_3.py` & `gdsfactory-6.95.0/gdsfactory/samples/24_doe_3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/30_lidar.py` & `gdsfactory-6.95.0/gdsfactory/samples/30_lidar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/30_lidar_pcell.py` & `gdsfactory-6.95.0/gdsfactory/samples/30_lidar_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/30_lidar_with_pads.py` & `gdsfactory-6.95.0/gdsfactory/samples/30_lidar_with_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing.py` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/big_device.py` & `gdsfactory-6.95.0/gdsfactory/samples/big_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/benchmark/fill_demo.py` & `gdsfactory-6.95.0/gdsfactory/samples/demo/benchmark/fill_demo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/circuits/mask.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/demo/circuits/mask.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml` & `gdsfactory-6.95.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/drc_errors.py` & `gdsfactory-6.95.0/gdsfactory/samples/demo/drc_errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/drc_write.py` & `gdsfactory-6.95.0/gdsfactory/samples/demo/drc_write.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/layers.py` & `gdsfactory-6.95.0/gdsfactory/samples/demo/layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/lvs.py` & `gdsfactory-6.95.0/gdsfactory/samples/demo/lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/demo/pcell.py` & `gdsfactory-6.95.0/gdsfactory/samples/demo/pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/netlists/mzi.yml` & `gdsfactory-6.95.0/gdsfactory/samples/netlists/mzi.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/netlists/mzi_full.yml` & `gdsfactory-6.95.0/gdsfactory/samples/netlists/mzi_full.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/fab_c.py` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/fab_d/phase_shifters.py` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c.py` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml` & `gdsfactory-6.95.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/schematic_editor.py` & `gdsfactory-6.95.0/gdsfactory/schematic_editor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/serialization.py` & `gdsfactory-6.95.0/gdsfactory/serialization.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/show.py` & `gdsfactory-6.95.0/gdsfactory/show.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/add_simulation_markers.py` & `gdsfactory-6.95.0/gdsfactory/simulation/add_simulation_markers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/convert_sparameters.py` & `gdsfactory-6.95.0/gdsfactory/simulation/convert_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/devsim/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/devsim/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/devsim/doping.py` & `gdsfactory-6.95.0/gdsfactory/simulation/devsim/doping.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/devsim/get_simulation.py` & `gdsfactory-6.95.0/gdsfactory/simulation/devsim/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/devsim/get_simulation_xsection.py` & `gdsfactory-6.95.0/gdsfactory/simulation/devsim/get_simulation_xsection.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/devsim/get_solver.py` & `gdsfactory-6.95.0/gdsfactory/simulation/devsim/get_solver.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/devsim/test_devsim.py` & `gdsfactory-6.95.0/gdsfactory/simulation/devsim/test_devsim.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/eme/meow_eme.py` & `gdsfactory-6.95.0/gdsfactory/simulation/eme/meow_eme.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/eme/test_meow_simulation.py` & `gdsfactory-6.95.0/gdsfactory/simulation/eme/test_meow_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/fem/mode_solver.py` & `gdsfactory-6.95.0/gdsfactory/simulation/fem/mode_solver.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/fem/test_mode_solver.py` & `gdsfactory-6.95.0/gdsfactory/simulation/fem/test_mode_solver.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/get_effective_indices.py` & `gdsfactory-6.95.0/gdsfactory/simulation/get_effective_indices.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/get_modes_path.py` & `gdsfactory-6.95.0/gdsfactory/simulation/get_modes_path.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/get_sparameters_path.py` & `gdsfactory-6.95.0/gdsfactory/simulation/get_sparameters_path.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_material.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_material.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_meep_geometry.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_meep_geometry.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_port_eigenmode.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_port_eigenmode.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_simulation.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_eigenmode.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_eigenmode.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_materials.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/write_sparameters_grating.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/write_sparameters_grating.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/write_sparameters_meep.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/write_sparameters_meep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/break_geometry.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/break_geometry.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/mesh.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/meshtracker.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/meshtracker.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/parse_component.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/parse_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/parse_gds.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/parse_gds.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/parse_layerstack.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/parse_layerstack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/refine.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/refine.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/scratch/mesh3D.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/scratch/mesh3D.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/tests/test_meshing.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/tests/test_meshing.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/uz_xsection_mesh.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/uz_xsection_mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/xy_xsection_mesh.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/xy_xsection_mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gmsh/xyz_mesh.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gmsh/xyz_mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/get_results.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/get_results.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/get_simulation.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/materials.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/modes.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/modes.py`

 * *Files 6% similar despite different names*

```diff
@@ -8,31 +8,33 @@
 - compute mode overlaps.
 
 """
 
 from __future__ import annotations
 
 import pathlib
-from typing import Optional, Tuple, Union
+from typing import Optional, Tuple, Union, Sequence, Any
 import hashlib
 import itertools
 
 import numpy as np
 import pydantic
 import tidy3d as td
 from tidy3d.plugins import waveguide
 from typing_extensions import Literal
 import xarray
 from tqdm.auto import tqdm
 
 from gdsfactory.config import logger
 from gdsfactory.serialization import clean_value_name
-from gdsfactory.pdk import MaterialSpec, get_material_index, get_modes_path
+from gdsfactory.pdk import MaterialSpec, get_modes_path
 from gdsfactory.typings import PathType
 
+from gdsfactory.simulation.gtidy3d.materials import get_medium
+
 
 Precision = Literal["single", "double"]
 
 
 class Waveguide(pydantic.BaseModel):
     """Waveguide Model.
 
@@ -97,15 +99,15 @@
                                ¦
                          box_thickness
                                ¦
                                v
         ________________________________________________
     """
 
-    wavelength: float
+    wavelength: Union[float, Sequence[float], Any]
     core_width: float
     core_thickness: float
     core_material: MaterialSpec
     clad_material: MaterialSpec
     box_material: Optional[MaterialSpec] = None
     slab_thickness: float = 0.0
     clad_thickness: Optional[float] = None
@@ -128,14 +130,18 @@
     _waveguide = pydantic.PrivateAttr()
 
     class Config:
         """pydantic config."""
 
         extra = "forbid"
 
+    @pydantic.validator("wavelength")
+    def _fix_wavelength_type(cls, value):
+        return np.array(value, dtype=float)
+
     @property
     def cache_path(self) -> Optional[PathType]:
         """Cache directory"""
         return get_modes_path()
 
     @property
     def filepath(self) -> Optional[pathlib.Path]:
@@ -154,41 +160,40 @@
         h = hashlib.md5(named_args_string.encode()).hexdigest()[:16]
         return cache_path / f"{self.__class__.__name__}_{h}.npz"
 
     @property
     def waveguide(self):
         """Tidy3D waveguide used by this instance."""
         if not hasattr(self, "_waveguide"):
-            n_core = get_material_index(self.core_material, self.wavelength)
-            core_medium = td.Medium(permittivity=n_core**2)
-            n_clad = get_material_index(self.clad_material, self.wavelength)
-            clad_medium = td.Medium(permittivity=n_clad**2)
-            if self.box_material:
-                n_box = get_material_index(self.box_material, self.wavelength)
-                box_medium = td.Medium(permittivity=n_box**2)
-            else:
-                box_medium = None
-
-            if self.sidewall_k != 0.0:
-                sidewall_medium = td.Medium.from_nk(
-                    n=n_clad, k=self.sidewall_k, freq=td.C_0 / self.wavelength
+            core_medium = get_medium(self.core_material)
+            clad_medium = get_medium(self.clad_material)
+            box_medium = get_medium(self.box_material) if self.box_material else None
+
+            freq0 = td.C_0 / np.mean(self.wavelength)
+            n_core = core_medium.eps_model(freq0) ** 0.5
+            n_clad = clad_medium.eps_model(freq0) ** 0.5
+
+            sidewall_medium = (
+                td.Medium.from_nk(
+                    n=n_clad.real, k=n_clad.imag + self.sidewall_k, freq=freq0
                 )
-            else:
-                sidewall_medium = None
-
-            if self.surface_k != 0.0:
-                surface_medium = td.Medium.from_nk(
-                    n=n_clad, k=self.surface_k, freq=td.C_0 / self.wavelength
+                if self.sidewall_k != 0.0
+                else None
+            )
+            surface_medium = (
+                td.Medium.from_nk(
+                    n=n_clad.real, k=n_clad.imag + self.surface_k, freq=freq0
                 )
-            else:
-                surface_medium = None
+                if self.surface_k != 0.0
+                else None
+            )
 
             mode_spec = td.ModeSpec(
                 num_modes=self.num_modes,
-                target_neff=n_core,
+                target_neff=n_core.real,
                 bend_radius=self.bend_radius,
                 bend_axis=1,
                 num_pml=(12, 12) if self.bend_radius else (0, 0),
                 precision=self.precision,
                 group_index_step=self.group_index_step,
             )
 
@@ -227,15 +232,15 @@
                 self._cached_data = np.load(filepath)
                 return self._cached_data
 
             wg = self.waveguide
 
             fields = wg.mode_solver.data._centered_fields
             self._cached_data = {
-                f + c: fields[f + c].isel(f=0, drop=True).values
+                f + c: fields[f + c].squeeze(drop=True).values
                 for f in "EH"
                 for c in "xyz"
             }
 
             self._cached_data["x"] = fields["Ex"].coords["x"].values
             self._cached_data["y"] = fields["Ex"].coords["y"].values
 
@@ -269,23 +274,28 @@
         """Effective mode area."""
         return self._data["mode_area"]
 
     @property
     def loss_dB_per_cm(self):
         """Propagation loss for computed modes in dB/cm."""
         wavelength = self.wavelength * 1e-6  # convert to m
-        alpha = 2 * np.pi * np.imag(self.n_eff) / wavelength  # lin/m loss
-        return 20 * np.log10(np.e) * alpha * 1e-2  # dB/cm loss
+        alpha = 2 * np.pi * np.imag(self.n_eff).T / wavelength  # lin/m loss
+        return 20 * np.log10(np.e) * alpha.T * 1e-2  # dB/cm loss
 
     @property
     def index(self) -> None:
         """Refractive index distribution on the simulation domain."""
         plane = self.waveguide.mode_solver.plane
+        wavelength = (
+            self.wavelength[self.wavelength.size // 2]
+            if self.wavelength.size > 1
+            else self.wavelength
+        )
         eps = self.waveguide.mode_solver.simulation.epsilon(
-            plane, freq=td.C_0 / self.wavelength
+            plane, freq=td.C_0 / wavelength
         )
         return eps.squeeze(drop=True).T ** 0.5
 
     def overlap(self, waveguide: Waveguide, conjugate: bool = True):
         """Calculate the mode overlap between waveguide modes.
 
         Parameters:
@@ -307,26 +317,43 @@
 
         Keyword arguments are passed to xarray.DataArray.plot.
         """
         artist = self.index.real.plot(**kwargs)
         artist.axes.set_aspect("equal")
 
     def plot_field(
-        self, field_name: str, value: str = "real", mode_index: int = 0, **kwargs
+        self,
+        field_name: str,
+        value: str = "real",
+        mode_index: int = 0,
+        wavelength: float = None,
+        **kwargs,
     ) -> None:
         """Plot the selected field distribution from a waveguide mode.
 
         Parameters:
             field_name: one of 'Ex', 'Ey', 'Ez', 'Hx', 'Hy', 'Hz'.
             value: component of the field to plot. One of 'real',
                 'imag', 'abs', 'phase', 'dB'.
             mode_index: mode selection.
+            wavelength: wavelength selection.
             kwargs: keyword arguments passed to xarray.DataArray.plot.
         """
-        data = self._data[field_name][:, :, mode_index]
+        data = self._data[field_name]
+
+        if self.num_modes > 1:
+            data = data[..., mode_index]
+        if self.wavelength.size > 1:
+            i = (
+                np.argmin(np.abs(wavelength - self.wavelength))
+                if wavelength
+                else self.wavelength.size // 2
+            )
+            data = data[..., i]
+
         if value == "real":
             data = data.real
         elif value == "imag":
             data = data.imag
         elif value == "abs":
             data = np.abs(data)
         elif value == "dB":
@@ -423,41 +450,40 @@
     core_width: Tuple[float, float]
     gap: float
 
     @property
     def waveguide(self):
         """Tidy3D waveguide used by this instance."""
         if not hasattr(self, "_waveguide"):
-            n_core = get_material_index(self.core_material, self.wavelength)
-            core_medium = td.Medium(permittivity=n_core**2)
-            n_clad = get_material_index(self.clad_material, self.wavelength)
-            clad_medium = td.Medium(permittivity=n_clad**2)
-            if self.box_material:
-                n_box = get_material_index(self.box_material, self.wavelength)
-                box_medium = td.Medium(permittivity=n_box**2)
-            else:
-                box_medium = None
-
-            if self.sidewall_k != 0.0:
-                sidewall_medium = td.Medium.from_nk(
-                    n=n_clad, k=self.sidewall_k, freq=td.C_0 / self.wavelength
+            core_medium = get_medium(self.core_material)
+            clad_medium = get_medium(self.clad_material)
+            box_medium = get_medium(self.box_material) if self.box_material else None
+
+            freq0 = td.C_0 / np.mean(self.wavelength)
+            n_core = core_medium.eps_model(freq0) ** 0.5
+            n_clad = clad_medium.eps_model(freq0) ** 0.5
+
+            sidewall_medium = (
+                td.Medium.from_nk(
+                    n=n_clad.real, k=n_clad.imag + self.sidewall_k, freq=freq0
                 )
-            else:
-                sidewall_medium = None
-
-            if self.surface_k != 0.0:
-                surface_medium = td.Medium.from_nk(
-                    n=n_clad, k=self.surface_k, freq=td.C_0 / self.wavelength
+                if self.sidewall_k != 0.0
+                else None
+            )
+            surface_medium = (
+                td.Medium.from_nk(
+                    n=n_clad.real, k=n_clad.imag + self.surface_k, freq=freq0
                 )
-            else:
-                surface_medium = None
+                if self.surface_k != 0.0
+                else None
+            )
 
             mode_spec = td.ModeSpec(
                 num_modes=self.num_modes,
-                target_neff=n_core,
+                target_neff=n_core.real,
                 bend_radius=self.bend_radius,
                 bend_axis=1,
                 num_pml=(12, 12) if self.bend_radius else (0, 0),
                 precision=self.precision,
                 group_index_step=self.group_index_step,
             )
 
@@ -508,33 +534,41 @@
     coordinates to organize the data.
 
     Args:
         waveguide: base waveguide geometry.
         attribute: desired waveguide attribute (retrieved with getattr).
         sweep_kwargs: Waveguide arguments and values to sweep.
     """
+    for prohibited in ("wavelength", "num_modes"):
+        if prohibited in sweep_kwargs:
+            raise ValueError(f"Parameter '{prohibited}' cannot be swept.")
+
     kwargs = {
         k: getattr(waveguide, k) for k in waveguide.__fields__ if k not in sweep_kwargs
     }
 
     keys = tuple(sweep_kwargs.keys())
     values = tuple(sweep_kwargs.values())
 
     shape = [len(v) for v in values]
-    shape.append(waveguide.num_modes)
+    if waveguide.wavelength.size > 1:
+        shape.append(waveguide.wavelength.size)
+        sweep_kwargs["wavelength"] = waveguide.wavelength.tolist()
+    if waveguide.num_modes > 1:
+        shape.append(waveguide.num_modes)
+        sweep_kwargs["mode_index"] = list(range(waveguide.num_modes))
 
     variations = tuple(itertools.product(*values))
     neff = np.array(
         [
             getattr(Waveguide(**kwargs, **dict(zip(keys, values))), attribute)
             for values in tqdm(variations)
         ]
     ).reshape(shape)
 
-    sweep_kwargs["mode_index"] = list(range(shape[-1]))
     return xarray.DataArray(neff, coords=sweep_kwargs, name=attribute)
 
 
 def sweep_n_eff(waveguide: Waveguide, **sweep_kwargs) -> np.ndarray:
     """Return the effective index for a range of waveguide geometries.
 
     The returned array uses the sweep arguments and the mode index as
@@ -637,117 +671,116 @@
         kwargs["gap"] = gap
         c = WaveguideCoupler(**kwargs)
         length.append(c.coupling_length(power_ratio))
     return np.array(length)
 
 
 if __name__ == "__main__":
-    import matplotlib.pyplot as plt
+    from matplotlib import pyplot
 
-    strip = Waveguide(
-        wavelength=1.55,
-        core_width=0.5,
-        core_thickness=0.22,
-        slab_thickness=0.0,
-        core_material="si",
-        clad_material="sio2",
-    )
-    # strip.plot_field(field_name="Ex", mode_index=0, value="dB")  # TE
-    strip.plot_grid()
-    plt.show()
+    # for num_modes in (1, 2):
+    #     for wavelength in (1.55, [1.54, 1.55, 1.56]):
+    #         strip = Waveguide(
+    #             wavelength=wavelength,
+    #             core_width=0.5,
+    #             core_thickness=0.22,
+    #             slab_thickness=0.0,
+    #             core_material="si",
+    #             clad_material="sio2",
+    #             num_modes=num_modes,
+    #         )
+    #         pyplot.figure()
+    #         strip.plot_field(field_name="Ex", mode_index=0, wavelength=1.55, value="real")
 
-    # from matplotlib import pyplot
     # rib = Waveguide(
     #     wavelength=1.55,
     #     core_width=0.5,
     #     core_thickness=0.25,
     #     slab_thickness=0.07,
     #     core_material="si",
     #     clad_material="sio2",
     #     group_index_step=True,
     #     num_modes=2,
     # )
     # print("\nRib:", rib)
     # print("Effective indices:", rib.n_eff)
     # print("Group indices:", rib.n_group)
     # print("Mode areas:", rib.mode_area)
-
+    #
     # fig, ax = pyplot.subplots(2, rib.num_modes + 1, tight_layout=True, figsize=(12, 8))
     # rib.plot_index(ax=ax[0, 0])
     # rib.waveguide.plot_structures(z=0, ax=ax[1, 0])
     # rib.waveguide.plot_grid(z=0, ax=ax[1, 0])
     # for i in range(rib.num_modes):
     #     rib.plot_field("Ex", mode_index=i, ax=ax[0, i + 1])
     #     rib.plot_field("Ey", mode_index=i, ax=ax[1, i + 1])
     #     ax[0, i + 1].set_title(f"Mode {i}")
     # fig.suptitle("Rib waveguide")
 
     # # Strip waveguide coupler
-
+    #
     # coupler = WaveguideCoupler(
     #     wavelength=1.55,
     #     core_width=(0.45, 0.45),
     #     core_thickness=0.22,
     #     core_material="si",
     #     clad_material="sio2",
     #     num_modes=4,
     #     gap=0.1,
     # )
-
+    #
     # print("\nCoupler:", coupler)
     # print("Effective indices:", coupler.n_eff)
     # print("Mode areas:", coupler.mode_area)
     # print("Coupling length:", coupler.coupling_length())
-
+    #
     # gaps = np.linspace(0.05, 0.15, 11)
     # lengths = sweep_coupling_length(coupler, gaps)
-
+    #
     # _, ax = pyplot.subplots(1, 1)
     # ax.plot(gaps, lengths)
     # ax.set(xlabel="Gap (μm)", ylabel="Coupling length (μm)")
     # ax.legend(["TE", "TM"])
     # ax.grid()
 
     # # Strip bend mismatch
-
-    # radii = np.arange(6, 21)
-    # radii = np.arange(6, 7)
+    #
+    # radii = np.arange(7, 21)
     # bend = Waveguide(
     #     wavelength=1.55,
     #     core_width=0.5,
     #     core_thickness=0.25,
     #     core_material="si",
     #     clad_material="sio2",
     #     num_modes=1,
     #     bend_radius=radii.min(),
     # )
     # mismatch = sweep_bend_mismatch(bend, radii)
-
+    #
     # fig, ax = pyplot.subplots(1, 2, tight_layout=True, figsize=(9, 4))
     # bend.plot_field("Ex", ax=ax[0])
     # ax[1].plot(radii, 10 * np.log10(mismatch))
     # ax[1].set(xlabel="Radius (μm)", ylabel="Mismatch (dB)")
     # ax[1].grid()
     # fig.suptitle("Strip waveguide bend")
-    # print(bend.filepath)
 
     # Effective index sweep
 
-    # wg = Waveguide(
-    #     wavelength=1.55,
-    #     core_width=0.5,
-    #     core_thickness=0.22,
-    #     core_material="si",
-    #     clad_material="sio2",
-    #     num_modes=2,
-    # )
-
-    # t = np.linspace(0.2, 0.25, 6)
-    # w = np.linspace(0.4, 0.6, 5)
-    # n_eff = sweep_n_eff(wg, core_width=w, core_thickness=t)
+    wg = Waveguide(
+        wavelength=1.55,
+        core_width=0.5,
+        core_thickness=0.22,
+        core_material="si",
+        clad_material="sio2",
+        num_modes=2,
+    )
 
-    # fig, ax = pyplot.subplots(1, 2, tight_layout=True, figsize=(9, 4))
-    # n_eff.sel(mode_index=0).real.plot(ax=ax[0])
-    # n_eff.sel(mode_index=1).real.plot(ax=ax[1])
-    # fig.suptitle("Effective index sweep")
+    t = np.linspace(0.2, 0.25, 6)
+    w = np.linspace(0.4, 0.6, 5)
+    n_eff = sweep_n_eff(wg, core_width=w, core_thickness=t)
+
+    fig, ax = pyplot.subplots(1, 2, tight_layout=True, figsize=(9, 4))
+    n_eff.sel(mode_index=0).real.plot(ax=ax[0])
+    n_eff.sel(mode_index=1).real.plot(ax=ax[1])
+    fig.suptitle("Effective index sweep")
 
-    # pyplot.show()
+    pyplot.show()
```

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/sim_run.yaml` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/sim_run.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_modes.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_results.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_results.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_simulation.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/utils.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/write_sparameters.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/write_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/lumerical/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/lumerical/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/lumerical/interconnect.py` & `gdsfactory-6.95.0/gdsfactory/simulation/lumerical/interconnect.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/lumerical/read.py` & `gdsfactory-6.95.0/gdsfactory/simulation/lumerical/read.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/lumerical/settings.py` & `gdsfactory-6.95.0/gdsfactory/simulation/lumerical/settings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py` & `gdsfactory-6.95.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py` & `gdsfactory-6.95.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/coupler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/find_coupling_vs_gap.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/find_coupling_vs_gap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/find_mode_dispersion.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/find_mode_dispersion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/find_modes.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/find_modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/find_modes_cross_section.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/find_modes_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/find_neff_vs_width.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/find_neff_vs_width.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/get_mode_solver_coupler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/get_mode_solver_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/get_mode_solver_cross_section.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/get_mode_solver_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/get_mode_solver_rib.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/get_mode_solver_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/neff_convergence_test.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/neff_convergence_test.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/overlap.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/overlap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_find_modes.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_find_modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/types.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/types.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/modes/waveguide.py` & `gdsfactory-6.95.0/gdsfactory/simulation/modes/waveguide.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/coupler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/mzi.py` & `gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/photonic_circuit_models/ring.py` & `gdsfactory-6.95.0/gdsfactory/simulation/photonic_circuit_models/ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/plot.py` & `gdsfactory-6.95.0/gdsfactory/simulation/plot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/plot_csv.py` & `gdsfactory-6.95.0/gdsfactory/simulation/plot_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/port_symmetries.py` & `gdsfactory-6.95.0/gdsfactory/simulation/port_symmetries.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/process/diffusion.py` & `gdsfactory-6.95.0/gdsfactory/simulation/process/diffusion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/process/implant_tables.py` & `gdsfactory-6.95.0/gdsfactory/simulation/process/implant_tables.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/process/pysrim.py` & `gdsfactory-6.95.0/gdsfactory/simulation/process/pysrim.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/process/silicon.py` & `gdsfactory-6.95.0/gdsfactory/simulation/process/silicon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/process/skew/antimony_si_skew.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/process/skew/antimony_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/process/skew/arsenic_si_skew.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/process/skew/arsenic_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/process/skew/boron_si_skew.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/process/skew/boron_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv` & `gdsfactory-6.95.0/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/build_model.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/build_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/femwell_waveguide_model.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/femwell_waveguide_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/interpolators.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/interpolators.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/meep_FDTD_model.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/meep_FDTD_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/meow_eme_model.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/meow_eme_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/mlp.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/mlp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/models.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/models.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/parameter.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/parameter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/plot_model.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/plot_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/read.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/read.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/tests/test_mzi.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/tests/test_mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/tests/test_mzi_lattice.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/tests/test_mzi_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sax/tests/test_parameters.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sax/tests/test_parameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/add_gc.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/add_gc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/circuit.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/__init__.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/bend_circular.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/bend_euler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler_fdtd.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler_fdtd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler_ring.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/gc.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/gc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mmi1x2.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mmi1x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mmi2x2.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mmi2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mzi.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/mzi_siepic.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/mzi_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/ring_double.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/ring_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/ring_double_siepic.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/ring_double_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/ring_single.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/ring_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/ring_single_siepic.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/ring_single_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/components/straight.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/components/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/get_transmission.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/get_transmission.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/model_from_gdsfactory.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/model_from_gdsfactory.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/model_from_sparameters.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/model_from_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/plot_circuit.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/plot_circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/plot_model.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/plot_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_circuit.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/simphony/tests/test_components.py` & `gdsfactory-6.95.0/gdsfactory/simulation/simphony/tests/test_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sipann/bend_circular.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sipann/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sipann/bend_euler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sipann/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sipann/coupler.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sipann/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sipann/coupler_ring.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sipann/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/sipann/straight.py` & `gdsfactory-6.95.0/gdsfactory/simulation/sipann/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/simulation/thermal/heater.py` & `gdsfactory-6.95.0/gdsfactory/simulation/thermal/heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/snap.py` & `gdsfactory-6.95.0/gdsfactory/snap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/symbols.py` & `gdsfactory-6.95.0/gdsfactory/symbols.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/technology/__init__.py` & `gdsfactory-6.95.0/gdsfactory/technology/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/technology/klayout_tech.py` & `gdsfactory-6.95.0/gdsfactory/technology/klayout_tech.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/technology/layer_map.py` & `gdsfactory-6.95.0/gdsfactory/technology/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/technology/layer_stack.py` & `gdsfactory-6.95.0/gdsfactory/technology/layer_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/technology/layer_views.py` & `gdsfactory-6.95.0/gdsfactory/technology/layer_views.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/technology/simulation_settings.py` & `gdsfactory-6.95.0/gdsfactory/technology/simulation_settings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/types.py` & `gdsfactory-6.95.0/gdsfactory/types.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/typings.py` & `gdsfactory-6.95.0/gdsfactory/typings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/utils/async_utils.py` & `gdsfactory-6.95.0/gdsfactory/utils/async_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/utils/file_utils.py` & `gdsfactory-6.95.0/gdsfactory/utils/file_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/utils/xml_utils.py` & `gdsfactory-6.95.0/gdsfactory/utils/xml_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/utils/yaml_utils.py` & `gdsfactory-6.95.0/gdsfactory/utils/yaml_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/watch.py` & `gdsfactory-6.95.0/gdsfactory/watch.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/widgets/layout_viewer.py` & `gdsfactory-6.95.0/gdsfactory/widgets/layout_viewer.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/gdsfactory/write_cells.py` & `gdsfactory-6.95.0/gdsfactory/write_cells.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.94.1/pyproject.toml` & `gdsfactory-6.95.0/pyproject.toml`

 * *Files 3% similar despite different names*

```diff
@@ -10,15 +10,15 @@
   "Programming Language :: Python :: 3.7",
   "Programming Language :: Python :: 3.8",
   "Programming Language :: Python :: 3.9",
   "Programming Language :: Python :: 3.10",
   "Programming Language :: Python :: 3.11",
   "Operating System :: OS Independent",
 ]
-version = "6.94.1"
+version = "6.95.0"
 authors = [
 {name = "gdsfactory community", email = "contact@gdsfactory.com"},
 ]
 keywords = ["eda", "photonics", "python"]
 license = {file = "LICENSE"}
 dependencies = [
   "click",
@@ -221,26 +221,32 @@
     ignore = [
       "E501",  # line too long, handled by black
       "B008",  # do not perform function calls in argument defaults
       "C901",  # too complex
       "B905",  # `zip()` without an explicit `strict=` parameter
       "C408",  # C408 Unnecessary `dict` call (rewrite as a literal)
       "B904",
+      "B028",  # stacklevel
     ]
     extend-exclude = ["docs/notebooks"]
 
     [tool.mypy]
     python_version = "3.10"
     strict = true
 
     [tool.pylsp-mypy]
     enabled = true
     live_mode = true
     strict = true
 
+    [tool.jupytext]
+    formats = "docs"
+    notebook_metadata_filter = "-all"
+    cell_metadata_filter = "-all"
+
     [tool.isort]
     multi_line_output = 3
     line_length = 88
     include_trailing_comma = true
     skip = "gdsfactory/__init__.py"
 
     [tool.setuptools.package-data]
```

### Comparing `gdsfactory-6.94.1/PKG-INFO` & `gdsfactory-6.95.0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: gdsfactory
-Version: 6.94.1
+Version: 6.95.0
 Summary: python library to generate GDS layouts
 Keywords: eda,photonics,python
 Author-email: gdsfactory community <contact@gdsfactory.com>
 Requires-Python: >=3.7
 Description-Content-Type: text/markdown
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
@@ -114,15 +114,15 @@
 Provides-Extra: full
 Provides-Extra: gmsh
 Provides-Extra: meow
 Provides-Extra: ray
 Provides-Extra: sax
 Provides-Extra: tidy3d
 
-# gdsfactory 6.94.1
+# gdsfactory 6.95.0
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![issues](https://img.shields.io/github/issues/gdsfactory/gdsfactory)](https://github.com/gdsfactory/gdsfactory/issues)
```

