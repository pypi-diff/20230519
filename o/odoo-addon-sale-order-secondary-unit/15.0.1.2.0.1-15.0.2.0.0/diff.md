# Comparing `tmp/odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1-py3-none-any.whl.zip` & `tmp/odoo_addon_sale_order_secondary_unit-15.0.2.0.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,28 +1,29 @@
-Zip file size: 31789 bytes, number of entries: 26
--rw-r--r--  2.0 unx     3475 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/README.rst
--rw-r--r--  2.0 unx       86 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/__init__.py
--rw-r--r--  2.0 unx      766 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/__manifest__.py
--rw-r--r--  2.0 unx     3229 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/i18n/de.po
--rw-r--r--  2.0 unx     3783 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/i18n/es.po
--rw-r--r--  2.0 unx     3114 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/i18n/sale_order_secondary_unit.pot
--rw-r--r--  2.0 unx     3428 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/i18n/zh_CN.po
--rw-r--r--  2.0 unx      121 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/models/__init__.py
--rw-r--r--  2.0 unx      488 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/models/product_template.py
--rw-r--r--  2.0 unx     2970 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/models/sale_order.py
--rw-r--r--  2.0 unx      178 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx      226 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      116 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      280 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/readme/USAGE.rst
--rw-r--r--  2.0 unx     1042 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/report/sale_report_templates.xml
--rw-r--r--  2.0 unx     9455 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/static/description/icon.png
--rw-r--r--  2.0 unx    13314 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/static/description/index.html
--rw-r--r--  2.0 unx      110 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/tests/__init__.py
--rw-r--r--  2.0 unx     4801 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/tests/test_sale_order_secondary_unit.py
--rw-r--r--  2.0 unx     2235 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/views/product_secondary_unit_views.xml
--rw-r--r--  2.0 unx      852 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/views/product_views.xml
--rw-r--r--  2.0 unx     2052 b- defN 23-Mar-31 06:52 odoo/addons/sale_order_secondary_unit/views/sale_order_views.xml
--rw-r--r--  2.0 unx     4157 b- defN 23-Mar-31 06:54 odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Mar-31 06:54 odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Mar-31 06:54 odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     3000 b- defN 23-Mar-31 06:54 odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/RECORD
-26 files, 63375 bytes uncompressed, 26617 bytes compressed:  58.0%
+Zip file size: 33146 bytes, number of entries: 27
+-rw-r--r--  2.0 unx     3475 b- defN 23-May-19 21:13 odoo/addons/sale_order_secondary_unit/README.rst
+-rw-r--r--  2.0 unx       86 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/__init__.py
+-rw-r--r--  2.0 unx      766 b- defN 23-May-19 21:13 odoo/addons/sale_order_secondary_unit/__manifest__.py
+-rw-r--r--  2.0 unx     3229 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/i18n/de.po
+-rw-r--r--  2.0 unx     3783 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/i18n/es.po
+-rw-r--r--  2.0 unx     3821 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/i18n/sale_order_secondary_unit.pot
+-rw-r--r--  2.0 unx     3428 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/i18n/zh_CN.po
+-rw-r--r--  2.0 unx      143 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/models/__init__.py
+-rw-r--r--  2.0 unx      631 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/models/product.py
+-rw-r--r--  2.0 unx     3003 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/models/product_template.py
+-rw-r--r--  2.0 unx     2284 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/models/sale_order.py
+-rw-r--r--  2.0 unx      178 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx      226 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      116 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      280 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/readme/USAGE.rst
+-rw-r--r--  2.0 unx     1042 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/report/sale_report_templates.xml
+-rw-r--r--  2.0 unx     9455 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/static/description/icon.png
+-rw-r--r--  2.0 unx    13314 b- defN 23-May-19 21:13 odoo/addons/sale_order_secondary_unit/static/description/index.html
+-rw-r--r--  2.0 unx      110 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/tests/__init__.py
+-rw-r--r--  2.0 unx     4805 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/tests/test_sale_order_secondary_unit.py
+-rw-r--r--  2.0 unx     2235 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/views/product_secondary_unit_views.xml
+-rw-r--r--  2.0 unx      736 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/views/product_views.xml
+-rw-r--r--  2.0 unx     3253 b- defN 23-May-19 21:12 odoo/addons/sale_order_secondary_unit/views/sale_order_views.xml
+-rw-r--r--  2.0 unx     4155 b- defN 23-May-19 21:13 odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-19 21:13 odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-May-19 21:13 odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     3104 b- defN 23-May-19 21:13 odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/RECORD
+27 files, 67755 bytes uncompressed, 27804 bytes compressed:  59.0%
```

## zipnote {}

```diff
@@ -18,14 +18,17 @@
 
 Filename: odoo/addons/sale_order_secondary_unit/i18n/zh_CN.po
 Comment: 
 
 Filename: odoo/addons/sale_order_secondary_unit/models/__init__.py
 Comment: 
 
+Filename: odoo/addons/sale_order_secondary_unit/models/product.py
+Comment: 
+
 Filename: odoo/addons/sale_order_secondary_unit/models/product_template.py
 Comment: 
 
 Filename: odoo/addons/sale_order_secondary_unit/models/sale_order.py
 Comment: 
 
 Filename: odoo/addons/sale_order_secondary_unit/readme/CONFIGURE.rst
@@ -60,20 +63,20 @@
 
 Filename: odoo/addons/sale_order_secondary_unit/views/product_views.xml
 Comment: 
 
 Filename: odoo/addons/sale_order_secondary_unit/views/sale_order_views.xml
 Comment: 
 
-Filename: odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/METADATA
+Filename: odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/WHEEL
+Filename: odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/top_level.txt
+Filename: odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/RECORD
+Filename: odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/sale_order_secondary_unit/__manifest__.py

```diff
@@ -1,13 +1,13 @@
 # Copyright 2018-2020 Tecnativa - Carlos Dauden
 # License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl).
 {
     "name": "Sale Order Secondary Unit",
     "summary": "Sale product in a secondary unit",
-    "version": "15.0.1.2.0",
+    "version": "15.0.2.0.0",
     "development_status": "Production/Stable",
     "category": "Sale",
     "website": "https://github.com/OCA/sale-workflow",
     "author": "Tecnativa, Odoo Community Association (OCA)",
     "license": "AGPL-3",
     "application": False,
     "installable": True,
```

## odoo/addons/sale_order_secondary_unit/i18n/sale_order_secondary_unit.pot

```diff
@@ -10,29 +10,24 @@
 "Language-Team: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: \n"
 "Plural-Forms: \n"
 
 #. module: sale_order_secondary_unit
-#: model:ir.model.fields,field_description:sale_order_secondary_unit.field_sale_order_line__secondary_uom_qty
-msgid "2nd Qty"
+#: model_terms:ir.ui.view,arch_db:sale_order_secondary_unit.view_order_form
+msgid "-&gt;"
 msgstr ""
 
 #. module: sale_order_secondary_unit
 #: model:ir.model.fields,field_description:sale_order_secondary_unit.field_sale_order_line__secondary_uom_unit_price
 msgid "2nd unit price"
 msgstr ""
 
 #. module: sale_order_secondary_unit
-#: model:ir.model.fields,field_description:sale_order_secondary_unit.field_sale_order_line__secondary_uom_id
-msgid "2nd uom"
-msgstr ""
-
-#. module: sale_order_secondary_unit
 #: model_terms:ir.ui.view,arch_db:sale_order_secondary_unit.report_saleorder_document
 msgid "<span>Second. Qty</span>"
 msgstr ""
 
 #. module: sale_order_secondary_unit
 #: model:ir.model.fields,field_description:sale_order_secondary_unit.field_product_product__sale_secondary_uom_id
 #: model:ir.model.fields,field_description:sale_order_secondary_unit.field_product_template__sale_secondary_uom_id
@@ -49,41 +44,71 @@
 #: model:ir.model.fields,help:sale_order_secondary_unit.field_product_template__sale_secondary_uom_id
 msgid ""
 "In order to set a value, please first add at least one record in 'Secondary "
 "Unit of Measure'"
 msgstr ""
 
 #. module: sale_order_secondary_unit
+#: model:ir.model,name:sale_order_secondary_unit.model_product_product
+msgid "Product"
+msgstr ""
+
+#. module: sale_order_secondary_unit
 #: model:ir.model,name:sale_order_secondary_unit.model_product_template
 #: model_terms:ir.ui.view,arch_db:sale_order_secondary_unit.product_secondary_unit_view_search
 msgid "Product Template"
 msgstr ""
 
 #. module: sale_order_secondary_unit
 #: model_terms:ir.ui.view,arch_db:sale_order_secondary_unit.product_secondary_unit_view_search
 msgid "Product Variant"
 msgstr ""
 
 #. module: sale_order_secondary_unit
+#: code:addons/sale_order_secondary_unit/models/product_template.py:0
+#, python-format
+msgid ""
+"Product variants have distinct sale secondary uom:\n"
+"{secondary_uom}\n"
+"All variants will be written with new secondary uom"
+msgstr ""
+
+#. module: sale_order_secondary_unit
 #: model:ir.model.fields,field_description:sale_order_secondary_unit.field_sale_order_line__product_uom_qty
 msgid "Quantity"
 msgstr ""
 
 #. module: sale_order_secondary_unit
 #: model:ir.model,name:sale_order_secondary_unit.model_sale_order_line
 msgid "Sales Order Line"
 msgstr ""
 
 #. module: sale_order_secondary_unit
+#: model:ir.model.fields,field_description:sale_order_secondary_unit.field_sale_order_line__secondary_uom_id
+msgid "Second unit"
+msgstr ""
+
+#. module: sale_order_secondary_unit
+#: model:ir.model.fields,field_description:sale_order_secondary_unit.field_sale_order_line__secondary_uom_qty
+msgid "Secondary Qty"
+msgstr ""
+
+#. module: sale_order_secondary_unit
 #: model:ir.actions.act_window,name:sale_order_secondary_unit.product_secondary_unit_action
 msgid "Secondary Unit"
 msgstr ""
 
 #. module: sale_order_secondary_unit
 #: model:ir.ui.menu,name:sale_order_secondary_unit.product_secondary_unit_menu
 msgid "Secondary Units of Measure"
 msgstr ""
 
 #. module: sale_order_secondary_unit
 #: model_terms:ir.ui.view,arch_db:sale_order_secondary_unit.product_secondary_unit_view_search
 msgid "UoM"
 msgstr ""
+
+#. module: sale_order_secondary_unit
+#: code:addons/sale_order_secondary_unit/models/product_template.py:0
+#, python-format
+msgid "Warning"
+msgstr ""
```

## odoo/addons/sale_order_secondary_unit/models/__init__.py

```diff
@@ -1,3 +1,4 @@
 # License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl).
+from . import product
 from . import product_template
 from . import sale_order
```

## odoo/addons/sale_order_secondary_unit/models/product_template.py

```diff
@@ -1,14 +1,72 @@
 # Copyright 2018-2020 Tecnativa - Sergio Teruel
 # License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl).
-from odoo import fields, models
+from odoo import _, api, fields, models
 
 
 class ProductTemplate(models.Model):
     _inherit = "product.template"
 
     sale_secondary_uom_id = fields.Many2one(
         comodel_name="product.secondary.unit",
         string="Default secondary unit for sales",
+        compute="_compute_sale_secondary_uom_id",
+        inverse="_inverse_sale_secondary_uom_id",
         help="In order to set a value, please first add at least one record"
         " in 'Secondary Unit of Measure'",
+        domain="[('product_tmpl_id', '=', id), ('product_id', '=', False)]",
+        store=True,
     )
+
+    @api.depends("product_variant_ids", "product_variant_ids.sale_secondary_uom_id")
+    def _compute_sale_secondary_uom_id(self):
+        unique_variants = self.filtered(lambda tmpl: tmpl.product_variant_count == 1)
+        for template in unique_variants:
+            template.sale_secondary_uom_id = (
+                template.product_variant_ids.sale_secondary_uom_id
+            )
+        for template in self - unique_variants:
+            if len(template.product_variant_ids.sale_secondary_uom_id) == 1:
+                template.sale_secondary_uom_id = (
+                    template.product_variant_ids.sale_secondary_uom_id
+                )
+            else:
+                template.sale_secondary_uom_id = False
+
+    def _inverse_sale_secondary_uom_id(self):
+        for template in self:
+            # if template.product_variant_count == 1:
+            template.product_variant_ids.sale_secondary_uom_id = (
+                template.sale_secondary_uom_id
+            )
+
+    @api.onchange("sale_secondary_uom_id")
+    def onchange_sale_secondary_uom_id(self):
+        if len(self.product_variant_ids.sale_secondary_uom_id) > 1:
+            return {
+                "warning": {
+                    "title": _("Warning"),
+                    "message": _(
+                        "Product variants have distinct sale secondary uom:"
+                        "\n{secondary_uom}\n"
+                        "All variants will be written with new secondary uom"
+                    ).format(
+                        secondary_uom="\n".join(
+                            self.product_variant_ids.mapped(
+                                "sale_secondary_uom_id.name"
+                            )
+                        )
+                    ),
+                }
+            }
+
+    @api.model_create_multi
+    def create(self, vals_list):
+        templates = super(ProductTemplate, self).create(vals_list)
+        # This is needed to set given values to first variant after creation
+        for template, vals in zip(templates, vals_list):
+            related_vals = {}
+            if vals.get("sale_secondary_uom_id"):
+                related_vals["sale_secondary_uom_id"] = vals["sale_secondary_uom_id"]
+            if related_vals:
+                template.write(related_vals)
+        return templates
```

## odoo/addons/sale_order_secondary_unit/models/sale_order.py

```diff
@@ -7,26 +7,17 @@
     _inherit = ["sale.order.line", "product.secondary.unit.mixin"]
     _name = "sale.order.line"
     _secondary_unit_fields = {
         "qty_field": "product_uom_qty",
         "uom_field": "product_uom",
     }
 
-    secondary_uom_qty = fields.Float(string="2nd Qty", digits="Product Unit of Measure")
-    secondary_uom_id = fields.Many2one(
-        comodel_name="product.secondary.unit",
-        string="2nd uom",
-        ondelete="restrict",
-    )
-
     secondary_uom_unit_price = fields.Float(
         string="2nd unit price",
-        digits="Product Unit of Measure",
-        store=False,
-        readonly=True,
+        digits="Product Price",
         compute="_compute_secondary_uom_unit_price",
     )
 
     product_uom_qty = fields.Float(
         store=True, readonly=False, compute="_compute_product_uom_qty", copy=True
     )
 
@@ -42,27 +33,20 @@
     def product_id_change(self):
         """
         If default sales secondary unit set on product, put on secondary
         quantity 1 for being the default quantity. We override this method,
         that is the one that sets by default 1 on the other quantity with that
         purpose.
         """
-        # Determine if we compute the sale line with one unit of secondary uom as default.
-        # Based on method of sale order line _update_taxes
-        default_secondary_qty = 0.0
-        if (
-            not self.product_uom or (self.product_id.uom_id.id != self.product_uom.id)
-        ) and not self.product_uom_qty:
-            default_secondary_qty = 1.0
         res = super().product_id_change()
+        line_uom_qty = self.product_uom_qty
+        self.secondary_uom_id = self.product_id.sale_secondary_uom_id
         if self.product_id.sale_secondary_uom_id:
-            line_uom_qty = self.product_uom_qty
-            self.secondary_uom_id = self.product_id.sale_secondary_uom_id
-            if default_secondary_qty:
-                self.secondary_uom_qty = default_secondary_qty
+            if line_uom_qty == 1.0:
+                self.secondary_uom_qty = 1.0
                 self.onchange_product_uom_for_secondary()
             else:
                 self.product_uom_qty = line_uom_qty
         return res
 
     @api.depends("secondary_uom_qty", "product_uom_qty", "price_unit")
     def _compute_secondary_uom_unit_price(self):
```

## odoo/addons/sale_order_secondary_unit/tests/test_sale_order_secondary_unit.py

```diff
@@ -1,25 +1,33 @@
 # Copyright 2018-2020 Tecnativa - Carlos Dauden
 # License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl).
-from odoo.tests import TransactionCase, tagged
+from odoo.tests import Form, TransactionCase, tagged
 
 
 @tagged("post_install", "-at_install")
 class TestSaleOrderSecondaryUnit(TransactionCase):
     @classmethod
     def setUpClass(cls):
         super().setUpClass()
         cls.product_uom_kg = cls.env.ref("uom.product_uom_kgm")
         cls.product_uom_gram = cls.env.ref("uom.product_uom_gram")
         cls.product_uom_unit = cls.env.ref("uom.product_uom_unit")
+        cls.price_list = cls.env["product.pricelist"].create(
+            {"name": "price list for test"}
+        )
         cls.product = cls.env["product.product"].create(
             {
                 "name": "test",
                 "uom_id": cls.product_uom_kg.id,
                 "uom_po_id": cls.product_uom_kg.id,
+            }
+        )
+        # Set secondary uom on product template
+        cls.product.product_tmpl_id.write(
+            {
                 "secondary_uom_ids": [
                     (
                         0,
                         0,
                         {
                             "name": "unit-500",
                             "uom_id": cls.product_uom_unit.id,
@@ -30,35 +38,22 @@
             }
         )
         cls.secondary_unit = cls.env["product.secondary.unit"].search(
             [("product_tmpl_id", "=", cls.product.product_tmpl_id.id)]
         )
         cls.product.sale_secondary_uom_id = cls.secondary_unit.id
         cls.partner = cls.env["res.partner"].create({"name": "test - partner"})
-        so = cls.env["sale.order"].new(
-            {
-                "partner_id": cls.partner.id,
-                "order_line": [
-                    (
-                        0,
-                        0,
-                        {
-                            "name": cls.product.name,
-                            "product_id": cls.product.id,
-                            "product_uom_qty": 1,
-                            "product_uom": cls.product.uom_id.id,
-                            "price_unit": 1000.00,
-                        },
-                    )
-                ],
-                "pricelist_id": cls.env.ref("product.list0").id,
-            }
-        )
-        so.onchange_partner_id()
-        cls.order = cls.env["sale.order"].create(so._convert_to_write(so._cache))
+        with Form(cls.env["sale.order"]) as order_form:
+            order_form.partner_id = cls.partner
+            order_form.pricelist_id = cls.price_list
+            with order_form.order_line.new() as line_form:
+                line_form.product_id = cls.product
+                line_form.product_uom_qty = 1
+                line_form.price_unit = 1000.00
+        cls.order = order_form.save()
 
     def test_onchange_secondary_uom(self):
         self.order.order_line.write(
             {"secondary_uom_id": self.secondary_unit.id, "secondary_uom_qty": 5}
         )
         self.order.order_line._compute_product_uom_qty()
         self.assertEqual(self.order.order_line.product_uom_qty, 2.5)
@@ -95,14 +90,16 @@
         self.assertEqual(self.order.order_line.secondary_uom_qty, 2)
 
         self.order.order_line.write({"product_uom_qty": 17})
         self.assertEqual(self.order.order_line.secondary_uom_qty, 2)
         self.assertEqual(self.order.order_line.product_uom_qty, 17)
 
     def test_secondary_uom_unit_price(self):
+        # Remove secondary uom in sale line to do a complete test of secondary price
+        self.order.order_line.secondary_uom_id = False
         self.assertEqual(self.order.order_line.secondary_uom_unit_price, 0)
         self.order.order_line.update(
             {"secondary_uom_id": self.secondary_unit.id, "product_uom_qty": 2}
         )
 
         self.assertEqual(self.order.order_line.secondary_uom_qty, 4)
         self.assertEqual(self.order.order_line.secondary_uom_unit_price, 500)
```

## odoo/addons/sale_order_secondary_unit/views/product_views.xml

### odoo/addons/sale_order_secondary_unit/views/product_views.xml

```diff
@@ -5,12 +5,12 @@
   <record id="product_template_form_view" model="ir.ui.view">
     <field name="name">Product template Secondary Unit</field>
     <field name="model">product.template</field>
     <field name="inherit_id" ref="product.product_template_form_view"/>
     <field name="groups_id" eval="[(4, ref('uom.group_uom'))]"/>
     <field name="arch" type="xml">
       <field name="uom_id" position="after">
-        <field name="sale_secondary_uom_id" domain="[('product_tmpl_id', '=', id)]" options="{'no_create': True}"/>
+        <field name="sale_secondary_uom_id" options="{'no_create': True}"/>
       </field>
     </field>
   </record>
 </odoo>
```

## odoo/addons/sale_order_secondary_unit/views/sale_order_views.xml

### odoo/addons/sale_order_secondary_unit/views/sale_order_views.xml

```diff
@@ -5,18 +5,31 @@
   <record id="view_order_form" model="ir.ui.view">
     <field name="name">Sale Order Secondary Unit</field>
     <field name="model">sale.order</field>
     <field name="inherit_id" ref="sale.view_order_form"/>
     <field name="groups_id" eval="[(4, ref('uom.group_uom'))]"/>
     <field name="arch" type="xml">
       <xpath expr="//field[@name='order_line']/form//field[@name='price_subtotal']" position="after">
-        <field name="secondary_uom_qty" class="oe_inline oe_no_button" attrs="{'readonly': [('state', 'in', ('done', 'cancel'))]}" optional="show"/>
-        <field name="secondary_uom_id" class="oe_inline" domain="[('product_tmpl_id.product_variant_ids', 'in', [product_id])]" attrs="{'readonly': [('state', 'in', ('done', 'cancel'))]}" optional="show"/>
-        <field name="secondary_uom_unit_price" readonly="1" optional="show"/>
+        <label for="secondary_uom_qty"/>
+        <div class="o_row" name="secondary_uom_qty">
+          <field name="secondary_uom_qty" class="oe_inline oe_no_button" widget="numeric_step" options="{'auto_select': True}" attrs="{'readonly': [('state', 'in', ('done', 'cancel'))]}"/>
+          <field name="secondary_uom_id" class="oe_inline oe_no_button" domain="['|', ('product_id', '=', product_id),                                     '&amp;', ('product_tmpl_id.product_variant_ids', 'in', [product_id]),                                              ('product_id', '=', False)]" options="{'no_create': True, 'no_open': True}" attrs="{'readonly': [('product_uom_readonly', '=', True)]}"/>
+        </div>
       </xpath>
       <xpath expr="//field[@name='order_line']/tree//field[@name='product_uom_qty']" position="before">
         <field name="secondary_uom_qty" attrs="{'readonly': [('parent.state', 'in', ('done', 'cancel'))]}"/>
-        <field name="secondary_uom_id" domain="[('product_tmpl_id.product_variant_ids', 'in', [product_id])]" options="{'no_create': True}" attrs="{'readonly': [('parent.state', 'in', ('done', 'cancel'))]}"/>
+        <field name="secondary_uom_id" domain="['|', ('product_id', '=', product_id),                                 '&amp;', ('product_tmpl_id.product_variant_ids', 'in', [product_id]),                                          ('product_id', '=', False)]" options="{'no_create': True}" attrs="{'readonly': [('product_uom_readonly', '=', True)]}"/>
+      </xpath>
+      <xpath expr="//field[@name='order_line']/kanban//field[@name='company_id']" position="after">
+        <field name="secondary_uom_id" invisible="1"/>
+        <field name="secondary_uom_qty" invisible="1"/>
+      </xpath>
+      <xpath expr="//field[@name='order_line']/kanban//t[@t-esc='record.product_uom_qty.value']" position="before">
+        <t t-if="record.secondary_uom_id.value">
+          <t t-esc="record.secondary_uom_qty.value"/>
+          <t t-esc="record.secondary_uom_id.value"/>
+          -&gt;
+        </t>
       </xpath>
     </field>
   </record>
 </odoo>
```

## Comparing `odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/METADATA` & `odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo-addon-sale-order-secondary-unit
-Version: 15.0.1.2.0.1
+Version: 15.0.2.0.0
 Summary: Sale product in a secondary unit
 Home-page: https://github.com/OCA/sale-workflow
 Author: Tecnativa, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/RECORD` & `odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/RECORD`

 * *Files 14% similar despite different names*

```diff
@@ -1,26 +1,27 @@
 odoo/addons/sale_order_secondary_unit/README.rst,sha256=JWeW7niZtcdjwcLcRIwKgwP5KzNqUE_J9p1A6akc_XE,3475
 odoo/addons/sale_order_secondary_unit/__init__.py,sha256=vjC7oVOHhST0bMtkabfH6FeMaqB-PHV4o8HQvIB_5NM,86
-odoo/addons/sale_order_secondary_unit/__manifest__.py,sha256=cWdTuFr7Xay14OzxcC1R2zdWgoYFA4kTUwmvygCimpE,766
+odoo/addons/sale_order_secondary_unit/__manifest__.py,sha256=wF5UZIrh2rNbPJZvReae0mNLs_MfGqjwfO0UYFseXDs,766
 odoo/addons/sale_order_secondary_unit/i18n/de.po,sha256=GlZEu_q0wKj2wqaOzAzHc81Cqd9RirEruwwhchmA43U,3229
 odoo/addons/sale_order_secondary_unit/i18n/es.po,sha256=tMnk5_BuoyD9uJfCz_BwIJhpfqv5lXViaNr7g7d4ABQ,3783
-odoo/addons/sale_order_secondary_unit/i18n/sale_order_secondary_unit.pot,sha256=K0JkwBhj5o_MwRnNjbaAl7EMcsjTAH0G1RWmrXDhOqE,3114
+odoo/addons/sale_order_secondary_unit/i18n/sale_order_secondary_unit.pot,sha256=wXQSA8QuYjY4EZKQUXYfcyygwDVcu_K3JuOd9RHBnvY,3821
 odoo/addons/sale_order_secondary_unit/i18n/zh_CN.po,sha256=-jv3L7-XfFbJiyMCNwzFhdYOh6oxJgO2JIPYmqFh9a4,3428
-odoo/addons/sale_order_secondary_unit/models/__init__.py,sha256=yv6AVmbUpBxvw4R_xcbu8JnpYsOpisuqKL1HLC6XMfQ,121
-odoo/addons/sale_order_secondary_unit/models/product_template.py,sha256=yAFc-seWruzNBMzA8bADXRJzfeoxM9rKSIt8PeQS4zA,488
-odoo/addons/sale_order_secondary_unit/models/sale_order.py,sha256=WMQococ5EiyOh5vDU7re_cM5ZHSccfprOUYCf5v-HEw,2970
+odoo/addons/sale_order_secondary_unit/models/__init__.py,sha256=My_U7Cg4Wytlg-QCx5v1-TIjlE30FoYnXZWVMvsViKQ,143
+odoo/addons/sale_order_secondary_unit/models/product.py,sha256=e_uBn6Lq9EFhry_4ujvBHZThebb4SjhznvnpmeyJz-Q,631
+odoo/addons/sale_order_secondary_unit/models/product_template.py,sha256=sVOHAp2F2rCXAe3V7TPZ_W13jLRpdP6QlMA8yEr4U-8,3003
+odoo/addons/sale_order_secondary_unit/models/sale_order.py,sha256=4DKYYMyyec1qftggRDou_McJShLKrLY8hoEL_EOlPr0,2284
 odoo/addons/sale_order_secondary_unit/readme/CONFIGURE.rst,sha256=7yB3Pcy0VZLDhItZrPtYjAYLwiXyl_fqP2OO6mHch_Q,178
 odoo/addons/sale_order_secondary_unit/readme/CONTRIBUTORS.rst,sha256=QtpuYf-9ECwL1WpKrPATU_28c-Kpc1PgbJx8BS_cRaA,226
 odoo/addons/sale_order_secondary_unit/readme/DESCRIPTION.rst,sha256=ozipA34kwFIPtbbevsojTmWWVMxw8P_lnn_Mlhj0Y5s,116
 odoo/addons/sale_order_secondary_unit/readme/USAGE.rst,sha256=ED9D1_Mnc5Zc_Xn8c4BBMT2fANOOlfFiA1yF1uOL23c,280
 odoo/addons/sale_order_secondary_unit/report/sale_report_templates.xml,sha256=NkWS69bfanw7ERCfDwdcUPVi07G7b5FbnoVgG_PY-_4,1042
 odoo/addons/sale_order_secondary_unit/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
 odoo/addons/sale_order_secondary_unit/static/description/index.html,sha256=l1DDxV3-Ofl02xg1zrDGxR3owlR2ktJFdzZaA9eKgWY,13314
 odoo/addons/sale_order_secondary_unit/tests/__init__.py,sha256=LiFi-QPZzWaLeioLMuRb--Zayl96z1lVXcRQWidZycQ,110
-odoo/addons/sale_order_secondary_unit/tests/test_sale_order_secondary_unit.py,sha256=ic1J0a0IQAIsUf-Xni2lpR2FDVq1_w2EjgZNo81Cdig,4801
+odoo/addons/sale_order_secondary_unit/tests/test_sale_order_secondary_unit.py,sha256=_m59i9TVWIQrO2lrcdSSkgWsrzY220g-nF7TVUpsr1s,4805
 odoo/addons/sale_order_secondary_unit/views/product_secondary_unit_views.xml,sha256=v4XYB7hq5kwqKcJ8rnkZAmP7miQMICfJT0sVyXnDL6c,2235
-odoo/addons/sale_order_secondary_unit/views/product_views.xml,sha256=4qJzfmbBktQDA4ZypP7AQA7Z1klvTuOcoprrLhQwQIg,852
-odoo/addons/sale_order_secondary_unit/views/sale_order_views.xml,sha256=Zj-gbdf7RDFKjwE896G5wsTUwr5GdKU8JqLDe6cEysE,2052
-odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/METADATA,sha256=EzKC6dbxNFijc1RWd8eSBvxWzJUhwGkoaAf4IAiD1EA,4157
-odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_sale_order_secondary_unit-15.0.1.2.0.1.dist-info/RECORD,,
+odoo/addons/sale_order_secondary_unit/views/product_views.xml,sha256=HJs2eKviTXzHGSoKKwKJaUmyL4SkNIWQIasfMgMJqA4,736
+odoo/addons/sale_order_secondary_unit/views/sale_order_views.xml,sha256=kGyfiqxZa3LMkIo8ZsqF07Cfz4q4IdLPFKbsiaMN9gQ,3253
+odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/METADATA,sha256=mo7c3OUm-OyFZrzlR1Vb_FjaF5PWvycwKVNPzfRQqMs,4155
+odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_sale_order_secondary_unit-15.0.2.0.0.dist-info/RECORD,,
```

