# Comparing `tmp/xarray-2023.4.2.tar.gz` & `tmp/xarray-2023.5.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "xarray-2023.4.2.tar", last modified: Thu Apr 20 18:28:08 2023, max compression
+gzip compressed data, was "xarray-2023.5.0.tar", last modified: Fri May 19 02:36:32 2023, max compression
```

## Comparing `xarray-2023.4.2.tar` & `xarray-2023.5.0.tar`

### file list

```diff
@@ -1,369 +1,374 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.168488 xarray-2023.4.2/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.068488 xarray-2023.4.2/.binder/
--rw-r--r--   0 runner    (1001) docker     (123)      533 2023-04-20 18:27:47.000000 xarray-2023.4.2/.binder/environment.yml
--rw-r--r--   0 runner    (1001) docker     (123)      297 2023-04-20 18:27:47.000000 xarray-2023.4.2/.codecov.yml
--rw-r--r--   0 runner    (1001) docker     (123)      115 2023-04-20 18:27:47.000000 xarray-2023.4.2/.git-blame-ignore-revs
--rw-r--r--   0 runner    (1001) docker     (123)      125 2023-04-20 18:27:47.000000 xarray-2023.4.2/.git_archival.txt
--rw-r--r--   0 runner    (1001) docker     (123)      138 2023-04-20 18:27:47.000000 xarray-2023.4.2/.gitattributes
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.068488 xarray-2023.4.2/.github/
--rw-r--r--   0 runner    (1001) docker     (123)       62 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/FUNDING.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.072487 xarray-2023.4.2/.github/ISSUE_TEMPLATE/
--rw-r--r--   0 runner    (1001) docker     (123)     2738 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/ISSUE_TEMPLATE/bugreport.yml
--rw-r--r--   0 runner    (1001) docker     (123)      702 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/ISSUE_TEMPLATE/config.yml
--rw-r--r--   0 runner    (1001) docker     (123)      490 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/ISSUE_TEMPLATE/misc.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1158 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/ISSUE_TEMPLATE/newfeature.yml
--rw-r--r--   0 runner    (1001) docker     (123)      258 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/PULL_REQUEST_TEMPLATE.md
--rw-r--r--   0 runner    (1001) docker     (123)     1167 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/config.yml
--rw-r--r--   0 runner    (1001) docker     (123)      156 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/dependabot.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1242 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/labeler.yml
--rw-r--r--   0 runner    (1001) docker     (123)     2133 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/stale.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.072487 xarray-2023.4.2/.github/workflows/
--rw-r--r--   0 runner    (1001) docker     (123)     2582 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/benchmarks-last-release.yml
--rw-r--r--   0 runner    (1001) docker     (123)     2748 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/benchmarks.yml
--rw-r--r--   0 runner    (1001) docker     (123)     6662 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/ci-additional.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     5047 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/ci.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     1163 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/configure-testpypi-version.py
--rw-r--r--   0 runner    (1001) docker     (123)      298 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/label-all.yml
--rw-r--r--   0 runner    (1001) docker     (123)      221 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/label-prs.yml
--rw-r--r--   0 runner    (1001) docker     (123)     2446 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/parse_logs.py
--rw-r--r--   0 runner    (1001) docker     (123)     1360 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/publish-test-results.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     2454 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/pypi-release.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     2259 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/testpypi-release.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     2735 2023-04-20 18:27:47.000000 xarray-2023.4.2/.github/workflows/upstream-dev-ci.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      865 2023-04-20 18:27:47.000000 xarray-2023.4.2/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)      163 2023-04-20 18:27:47.000000 xarray-2023.4.2/.pep8speaks.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1689 2023-04-20 18:27:47.000000 xarray-2023.4.2/.pre-commit-config.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      383 2023-04-20 18:27:47.000000 xarray-2023.4.2/.readthedocs.yaml
--rw-r--r--   0 runner    (1001) docker     (123)     3064 2023-04-20 18:27:47.000000 xarray-2023.4.2/CITATION.cff
--rw-r--r--   0 runner    (1001) docker     (123)     3230 2023-04-20 18:27:47.000000 xarray-2023.4.2/CODE_OF_CONDUCT.md
--rw-r--r--   0 runner    (1001) docker     (123)      127 2023-04-20 18:27:47.000000 xarray-2023.4.2/CONTRIBUTING.md
--rw-r--r--   0 runner    (1001) docker     (123)     4538 2023-04-20 18:27:47.000000 xarray-2023.4.2/HOW_TO_RELEASE.md
--rw-r--r--   0 runner    (1001) docker     (123)    10273 2023-04-20 18:27:47.000000 xarray-2023.4.2/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     3495 2023-04-20 18:28:08.168488 xarray-2023.4.2/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     8944 2023-04-20 18:27:47.000000 xarray-2023.4.2/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.072487 xarray-2023.4.2/asv_bench/
--rw-r--r--   0 runner    (1001) docker     (123)     6311 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/asv.conf.json
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.076487 xarray-2023.4.2/asv_bench/benchmarks/
--rw-r--r--   0 runner    (1001) docker     (123)     7991 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/README_CI.md
--rw-r--r--   0 runner    (1001) docker     (123)     1654 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1648 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/alignment.py
--rw-r--r--   0 runner    (1001) docker     (123)     1192 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/combine.py
--rw-r--r--   0 runner    (1001) docker     (123)     1872 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/dataarray_missing.py
--rw-r--r--   0 runner    (1001) docker     (123)    21598 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/dataset_io.py
--rw-r--r--   0 runner    (1001) docker     (123)     4421 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/groupby.py
--rw-r--r--   0 runner    (1001) docker     (123)      500 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/import.py
--rw-r--r--   0 runner    (1001) docker     (123)     5373 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/indexing.py
--rw-r--r--   0 runner    (1001) docker     (123)     1492 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/interp.py
--rw-r--r--   0 runner    (1001) docker     (123)     2443 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/merge.py
--rw-r--r--   0 runner    (1001) docker     (123)     1674 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/pandas.py
--rw-r--r--   0 runner    (1001) docker     (123)     1021 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/polyfit.py
--rw-r--r--   0 runner    (1001) docker     (123)     1379 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/reindexing.py
--rw-r--r--   0 runner    (1001) docker     (123)      784 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/renaming.py
--rw-r--r--   0 runner    (1001) docker     (123)     1037 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/repr.py
--rw-r--r--   0 runner    (1001) docker     (123)     4603 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/rolling.py
--rw-r--r--   0 runner    (1001) docker     (123)     1860 2023-04-20 18:27:47.000000 xarray-2023.4.2/asv_bench/benchmarks/unstacking.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.076487 xarray-2023.4.2/ci/
--rwxr-xr-x   0 runner    (1001) docker     (123)     1232 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/install-upstream-wheels.sh
--rwxr-xr-x   0 runner    (1001) docker     (123)     6565 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/min_deps_check.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.080487 xarray-2023.4.2/ci/requirements/
--rw-r--r--   0 runner    (1001) docker     (123)      596 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/requirements/all-but-dask.yml
--rw-r--r--   0 runner    (1001) docker     (123)      237 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/requirements/bare-minimum.yml
--rw-r--r--   0 runner    (1001) docker     (123)      812 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/requirements/doc.yml
--rw-r--r--   0 runner    (1001) docker     (123)      656 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/requirements/environment-py311.yml
--rw-r--r--   0 runner    (1001) docker     (123)      631 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/requirements/environment-windows-py311.yml
--rw-r--r--   0 runner    (1001) docker     (123)      630 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/requirements/environment-windows.yml
--rw-r--r--   0 runner    (1001) docker     (123)      653 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/requirements/environment.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1289 2023-04-20 18:27:47.000000 xarray-2023.4.2/ci/requirements/min-all-deps.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1232 2023-04-20 18:27:47.000000 xarray-2023.4.2/conftest.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.080487 xarray-2023.4.2/design_notes/
--rw-r--r--   0 runner    (1001) docker     (123)    28105 2023-04-20 18:27:47.000000 xarray-2023.4.2/design_notes/flexible_indexes_notes.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.084488 xarray-2023.4.2/doc/
--rw-r--r--   0 runner    (1001) docker     (123)     8471 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/Makefile
--rw-r--r--   0 runner    (1001) docker     (123)      189 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/README.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.092487 xarray-2023.4.2/doc/_static/
--rw-r--r--   0 runner    (1001) docker     (123)       46 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)    31185 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/advanced_selection_interpolation.svg
--rw-r--r--   0 runner    (1001) docker     (123)   114027 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/ci.png
--rw-r--r--   0 runner    (1001) docker     (123)    13488 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dask_array.png
--rwxr-xr-x   0 runner    (1001) docker     (123)       63 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram-build.sh
--rw-r--r--   0 runner    (1001) docker     (123)    13358 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram-logo.pdf
--rw-r--r--   0 runner    (1001) docker     (123)   117124 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram-logo.png
--rw-r--r--   0 runner    (1001) docker     (123)    66565 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram-logo.svg
--rw-r--r--   0 runner    (1001) docker     (123)    11200 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram-logo.tex
--rw-r--r--   0 runner    (1001) docker     (123)   183796 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram-square-logo.png
--rw-r--r--   0 runner    (1001) docker     (123)    10947 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram-square-logo.tex
--rw-r--r--   0 runner    (1001) docker     (123)    45348 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram.png
--rw-r--r--   0 runner    (1001) docker     (123)    10875 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/dataset-diagram.tex
--rw-r--r--   0 runner    (1001) docker     (123)     4286 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/favicon.ico
--rw-r--r--   0 runner    (1001) docker     (123)     3519 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/index_api.svg
--rw-r--r--   0 runner    (1001) docker     (123)     2528 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/index_contribute.svg
--rw-r--r--   0 runner    (1001) docker     (123)     3977 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/index_getting_started.svg
--rw-r--r--   0 runner    (1001) docker     (123)     6429 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/index_user_guide.svg
--rw-r--r--   0 runner    (1001) docker     (123)    24992 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/numfocus_logo.png
--rw-r--r--   0 runner    (1001) docker     (123)   104979 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/opendap-prism-tmax.png
--rw-r--r--   0 runner    (1001) docker     (123)     4761 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/style.css
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.096488 xarray-2023.4.2/doc/_static/thumbnails/
--rw-r--r--   0 runner    (1001) docker     (123)    32739 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/thumbnails/ERA5-GRIB-example.png
--rw-r--r--   0 runner    (1001) docker     (123)    77903 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/thumbnails/ROMS_ocean_model.png
--rw-r--r--   0 runner    (1001) docker     (123)    26018 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/thumbnails/area_weighted_temperature.png
--rw-r--r--   0 runner    (1001) docker     (123)   454794 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/thumbnails/monthly-means.png
--rw-r--r--   0 runner    (1001) docker     (123)    57609 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/thumbnails/multidimensional-coords.png
--rw-r--r--   0 runner    (1001) docker     (123)    37844 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/thumbnails/toy-weather-data.png
--rw-r--r--   0 runner    (1001) docker     (123)    43053 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/thumbnails/visualization_gallery.png
--rw-r--r--   0 runner    (1001) docker     (123)   664021 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_static/view-docs.png
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.064487 xarray-2023.4.2/doc/_templates/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.096488 xarray-2023.4.2/doc/_templates/autosummary/
--rw-r--r--   0 runner    (1001) docker     (123)      151 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_templates/autosummary/accessor.rst
--rw-r--r--   0 runner    (1001) docker     (123)      160 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_templates/autosummary/accessor_attribute.rst
--rw-r--r--   0 runner    (1001) docker     (123)      168 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_templates/autosummary/accessor_callable.rst
--rw-r--r--   0 runner    (1001) docker     (123)      157 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/_templates/autosummary/accessor_method.rst
--rw-r--r--   0 runner    (1001) docker     (123)    19245 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/api-hidden.rst
--rw-r--r--   0 runner    (1001) docker     (123)    21348 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/api.rst
--rw-r--r--   0 runner    (1001) docker     (123)    14644 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/conf.py
--rw-r--r--   0 runner    (1001) docker     (123)    42873 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/contributing.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1200 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/developers-meeting.rst
--rw-r--r--   0 runner    (1001) docker     (123)     9097 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/ecosystem.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.100488 xarray-2023.4.2/doc/examples/
--rw-r--r--   0 runner    (1001) docker     (123)     2823 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/ERA5-GRIB-example.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     7270 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/ROMS_ocean_model.ipynb
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.100488 xarray-2023.4.2/doc/examples/_code/
--rw-r--r--   0 runner    (1001) docker     (123)      703 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/_code/accessor_example.py
--rw-r--r--   0 runner    (1001) docker     (123)    28228 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/apply_ufunc_vectorize_1d.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     6187 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/area_weighted_temperature.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     1107 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/blank_template.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     7510 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/monthly-means.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)   445711 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/monthly_means_output.png
--rw-r--r--   0 runner    (1001) docker     (123)     6742 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/multidimensional-coords.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     8569 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/visualization_gallery.ipynb
--rw-r--r--   0 runner    (1001) docker     (123)     8734 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/examples/weather-data.ipynb
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.104488 xarray-2023.4.2/doc/gallery/
--rw-r--r--   0 runner    (1001) docker     (123)       30 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/gallery/README.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1285 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/gallery/plot_cartopy_facetgrid.py
--rw-r--r--   0 runner    (1001) docker     (123)     1035 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/gallery/plot_colorbar_center.py
--rw-r--r--   0 runner    (1001) docker     (123)      848 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/gallery/plot_control_colorbar.py
--rw-r--r--   0 runner    (1001) docker     (123)      908 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/gallery/plot_lines_from_2d.py
--rw-r--r--   0 runner    (1001) docker     (123)      747 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/gallery.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1844 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/gallery.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.104488 xarray-2023.4.2/doc/getting-started-guide/
--rw-r--r--   0 runner    (1001) docker     (123)    20697 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/getting-started-guide/faq.rst
--rw-r--r--   0 runner    (1001) docker     (123)      346 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/getting-started-guide/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)     6801 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/getting-started-guide/installing.rst
--rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/getting-started-guide/quick-overview.rst
--rw-r--r--   0 runner    (1001) docker     (123)     5851 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/getting-started-guide/why-xarray.rst
--rw-r--r--   0 runner    (1001) docker     (123)     4535 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/howdoi.rst
--rw-r--r--   0 runner    (1001) docker     (123)     2799 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/index.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.108487 xarray-2023.4.2/doc/internals/
--rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/internals/duck-arrays-integration.rst
--rw-r--r--   0 runner    (1001) docker     (123)     4040 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/internals/extending-xarray.rst
--rw-r--r--   0 runner    (1001) docker     (123)    17684 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/internals/how-to-add-new-backend.rst
--rw-r--r--   0 runner    (1001) docker     (123)      490 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/internals/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1561 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/internals/variable-objects.rst
--rw-r--r--   0 runner    (1001) docker     (123)     3083 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/internals/zarr-encoding-spec.rst
--rw-r--r--   0 runner    (1001) docker     (123)    12008 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/roadmap.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1087 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/tutorials-and-videos.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.112488 xarray-2023.4.2/doc/user-guide/
--rw-r--r--   0 runner    (1001) docker     (123)    11116 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/combining.rst
--rw-r--r--   0 runner    (1001) docker     (123)    29078 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/computation.rst
--rw-r--r--   0 runner    (1001) docker     (123)    23127 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/dask.rst
--rw-r--r--   0 runner    (1001) docker     (123)    21446 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/data-structures.rst
--rw-r--r--   0 runner    (1001) docker     (123)     2812 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/duckarrays.rst
--rw-r--r--   0 runner    (1001) docker     (123)     7383 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/groupby.rst
--rw-r--r--   0 runner    (1001) docker     (123)      428 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)    27433 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/indexing.rst
--rw-r--r--   0 runner    (1001) docker     (123)    10483 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/interpolation.rst
--rw-r--r--   0 runner    (1001) docker     (123)    47085 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/io.rst
--rw-r--r--   0 runner    (1001) docker     (123)      844 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/options.rst
--rw-r--r--   0 runner    (1001) docker     (123)     8704 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/pandas.rst
--rw-r--r--   0 runner    (1001) docker     (123)    31542 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/plotting.rst
--rw-r--r--   0 runner    (1001) docker     (123)    11220 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/reshaping.rst
--rw-r--r--   0 runner    (1001) docker     (123)     6179 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/terminology.rst
--rw-r--r--   0 runner    (1001) docker     (123)     8365 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/time-series.rst
--rw-r--r--   0 runner    (1001) docker     (123)     9199 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/user-guide/weather-climate.rst
--rw-r--r--   0 runner    (1001) docker     (123)     2479 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/videos.yml
--rw-r--r--   0 runner    (1001) docker     (123)   318211 2023-04-20 18:27:47.000000 xarray-2023.4.2/doc/whats-new.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.116488 xarray-2023.4.2/licenses/
--rw-r--r--   0 runner    (1001) docker     (123)     1485 2023-04-20 18:27:47.000000 xarray-2023.4.2/licenses/DASK_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)    18656 2023-04-20 18:27:47.000000 xarray-2023.4.2/licenses/ICOMOON_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1543 2023-04-20 18:27:47.000000 xarray-2023.4.2/licenses/NUMPY_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-04-20 18:27:47.000000 xarray-2023.4.2/licenses/PANDAS_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)    12761 2023-04-20 18:27:47.000000 xarray-2023.4.2/licenses/PYTHON_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1531 2023-04-20 18:27:47.000000 xarray-2023.4.2/licenses/SCIKIT_LEARN_LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1498 2023-04-20 18:27:47.000000 xarray-2023.4.2/licenses/SEABORN_LICENSE
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.116488 xarray-2023.4.2/properties/
--rw-r--r--   0 runner    (1001) docker     (123)      993 2023-04-20 18:27:47.000000 xarray-2023.4.2/properties/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      244 2023-04-20 18:27:47.000000 xarray-2023.4.2/properties/conftest.py
--rw-r--r--   0 runner    (1001) docker     (123)     1397 2023-04-20 18:27:47.000000 xarray-2023.4.2/properties/test_encode_decode.py
--rw-r--r--   0 runner    (1001) docker     (123)     3075 2023-04-20 18:27:47.000000 xarray-2023.4.2/properties/test_pandas_roundtrip.py
--rw-r--r--   0 runner    (1001) docker     (123)     1760 2023-04-20 18:27:47.000000 xarray-2023.4.2/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)      282 2023-04-20 18:27:47.000000 xarray-2023.4.2/requirements.txt
--rw-r--r--   0 runner    (1001) docker     (123)     4488 2023-04-20 18:28:08.168488 xarray-2023.4.2/setup.cfg
--rwxr-xr-x   0 runner    (1001) docker     (123)      103 2023-04-20 18:27:47.000000 xarray-2023.4.2/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.120488 xarray-2023.4.2/xarray/
--rw-r--r--   0 runner    (1001) docker     (123)     2843 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.128488 xarray-2023.4.2/xarray/backends/
--rw-r--r--   0 runner    (1001) docker     (123)     1708 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    64180 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/api.py
--rw-r--r--   0 runner    (1001) docker     (123)    13561 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/common.py
--rw-r--r--   0 runner    (1001) docker     (123)    12264 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/file_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)    13947 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/h5netcdf_.py
--rw-r--r--   0 runner    (1001) docker     (123)     5595 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/locks.py
--rw-r--r--   0 runner    (1001) docker     (123)     3661 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/lru_cache.py
--rw-r--r--   0 runner    (1001) docker     (123)     1392 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/memory.py
--rw-r--r--   0 runner    (1001) docker     (123)    20307 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/netCDF4_.py
--rw-r--r--   0 runner    (1001) docker     (123)     4163 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/netcdf3.py
--rw-r--r--   0 runner    (1001) docker     (123)     8139 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/plugins.py
--rw-r--r--   0 runner    (1001) docker     (123)     5696 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/pseudonetcdf_.py
--rw-r--r--   0 runner    (1001) docker     (123)     6472 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/pydap_.py
--rw-r--r--   0 runner    (1001) docker     (123)     4893 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/pynio_.py
--rw-r--r--   0 runner    (1001) docker     (123)    10902 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/scipy_.py
--rw-r--r--   0 runner    (1001) docker     (123)     2062 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/store.py
--rw-r--r--   0 runner    (1001) docker     (123)    34243 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/backends/zarr.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.128488 xarray-2023.4.2/xarray/coding/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/coding/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    13824 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/coding/calendar_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)    47274 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/coding/cftime_offsets.py
--rw-r--r--   0 runner    (1001) docker     (123)    29864 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/coding/cftimeindex.py
--rw-r--r--   0 runner    (1001) docker     (123)     9256 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/coding/frequencies.py
--rw-r--r--   0 runner    (1001) docker     (123)     7959 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/coding/strings.py
--rw-r--r--   0 runner    (1001) docker     (123)    27896 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/coding/times.py
--rw-r--r--   0 runner    (1001) docker     (123)    19049 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/coding/variables.py
--rw-r--r--   0 runner    (1001) docker     (123)    29000 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/conventions.py
--rw-r--r--   0 runner    (1001) docker     (123)     9712 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/convert.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.144488 xarray-2023.4.2/xarray/core/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   293555 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/_aggregations.py
--rw-r--r--   0 runner    (1001) docker     (123)    26253 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/_typed_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)    30052 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/_typed_ops.pyi
--rw-r--r--   0 runner    (1001) docker     (123)    20004 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/accessor_dt.py
--rw-r--r--   0 runner    (1001) docker     (123)    98648 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/accessor_str.py
--rw-r--r--   0 runner    (1001) docker     (123)    37538 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/alignment.py
--rw-r--r--   0 runner    (1001) docker     (123)     4406 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/arithmetic.py
--rw-r--r--   0 runner    (1001) docker     (123)    37528 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/combine.py
--rw-r--r--   0 runner    (1001) docker     (123)    61997 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/common.py
--rw-r--r--   0 runner    (1001) docker     (123)    75080 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/computation.py
--rw-r--r--   0 runner    (1001) docker     (123)    28139 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/concat.py
--rw-r--r--   0 runner    (1001) docker     (123)    16433 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/coordinates.py
--rw-r--r--   0 runner    (1001) docker     (123)     4000 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/dask_array_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)   254214 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/dataarray.py
--rw-r--r--   0 runner    (1001) docker     (123)   354135 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/dataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     4869 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/dtypes.py
--rw-r--r--   0 runner    (1001) docker     (123)    22628 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/duck_array_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)     3516 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/extensions.py
--rw-r--r--   0 runner    (1001) docker     (123)    27908 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/formatting.py
--rw-r--r--   0 runner    (1001) docker     (123)    10214 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/formatting_html.py
--rw-r--r--   0 runner    (1001) docker     (123)    52226 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/groupby.py
--rw-r--r--   0 runner    (1001) docker     (123)    54154 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/indexes.py
--rw-r--r--   0 runner    (1001) docker     (123)    57705 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/indexing.py
--rw-r--r--   0 runner    (1001) docker     (123)    39490 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/merge.py
--rw-r--r--   0 runner    (1001) docker     (123)    26320 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/missing.py
--rw-r--r--   0 runner    (1001) docker     (123)     5630 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/nanops.py
--rw-r--r--   0 runner    (1001) docker     (123)     1593 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/npcompat.py
--rw-r--r--   0 runner    (1001) docker     (123)     8209 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/nputils.py
--rw-r--r--   0 runner    (1001) docker     (123)     9945 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/ops.py
--rw-r--r--   0 runner    (1001) docker     (123)    11050 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/options.py
--rw-r--r--   0 runner    (1001) docker     (123)    22317 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/parallel.py
--rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/pdcompat.py
--rw-r--r--   0 runner    (1001) docker     (123)     2551 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/pycompat.py
--rw-r--r--   0 runner    (1001) docker     (123)    13973 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/resample.py
--rw-r--r--   0 runner    (1001) docker     (123)    19469 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/resample_cftime.py
--rw-r--r--   0 runner    (1001) docker     (123)    40143 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/rolling.py
--rw-r--r--   0 runner    (1001) docker     (123)     5745 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/rolling_exp.py
--rw-r--r--   0 runner    (1001) docker     (123)     6413 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/types.py
--rw-r--r--   0 runner    (1001) docker     (123)    35253 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/utils.py
--rw-r--r--   0 runner    (1001) docker     (123)   119875 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/variable.py
--rw-r--r--   0 runner    (1001) docker     (123)    19090 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/core/weighted.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.144488 xarray-2023.4.2/xarray/indexes/
--rw-r--r--   0 runner    (1001) docker     (123)      226 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/indexes/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.148488 xarray-2023.4.2/xarray/plot/
--rw-r--r--   0 runner    (1001) docker     (123)      573 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/plot/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    41974 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/plot/accessor.py
--rw-r--r--   0 runner    (1001) docker     (123)    85980 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/plot/dataarray_plot.py
--rw-r--r--   0 runner    (1001) docker     (123)    30818 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/plot/dataset_plot.py
--rw-r--r--   0 runner    (1001) docker     (123)    37227 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/plot/facetgrid.py
--rw-r--r--   0 runner    (1001) docker     (123)    59520 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/plot/utils.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/py.typed
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.148488 xarray-2023.4.2/xarray/static/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/static/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.148488 xarray-2023.4.2/xarray/static/css/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/static/css/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6075 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/static/css/style.css
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.148488 xarray-2023.4.2/xarray/static/html/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/static/html/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1343 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/static/html/icons-svg-inline.html
--rw-r--r--   0 runner    (1001) docker     (123)    14507 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/testing.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.164488 xarray-2023.4.2/xarray/tests/
--rw-r--r--   0 runner    (1001) docker     (123)     8789 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2145 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/conftest.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.168488 xarray-2023.4.2/xarray/tests/data/
--rw-r--r--   0 runner    (1001) docker     (123)     1184 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/data/bears.nc
--rw-r--r--   0 runner    (1001) docker     (123)     5232 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/data/example.grib
--rw-r--r--   0 runner    (1001) docker     (123)      783 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/data/example.ict
--rw-r--r--   0 runner    (1001) docker     (123)      608 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/data/example.uamiv
--rw-r--r--   0 runner    (1001) docker     (123)     1736 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/data/example_1.nc
--rw-r--r--   0 runner    (1001) docker     (123)      470 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/data/example_1.nc.gz
--rw-r--r--   0 runner    (1001) docker     (123)    20566 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_accessor_dt.py
--rw-r--r--   0 runner    (1001) docker     (123)   121928 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_accessor_str.py
--rw-r--r--   0 runner    (1001) docker     (123)     3705 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_array_api.py
--rw-r--r--   0 runner    (1001) docker     (123)   205405 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_backends.py
--rw-r--r--   0 runner    (1001) docker     (123)     7152 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_backends_api.py
--rw-r--r--   0 runner    (1001) docker     (123)      774 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_backends_common.py
--rw-r--r--   0 runner    (1001) docker     (123)     7176 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_backends_file_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)      366 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_backends_locks.py
--rw-r--r--   0 runner    (1001) docker     (123)     2300 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_backends_lru_cache.py
--rw-r--r--   0 runner    (1001) docker     (123)     7536 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_calendar_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)    44969 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_cftime_offsets.py
--rw-r--r--   0 runner    (1001) docker     (123)    40106 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_cftimeindex.py
--rw-r--r--   0 runner    (1001) docker     (123)     9248 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_cftimeindex_resample.py
--rw-r--r--   0 runner    (1001) docker     (123)    11478 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_coarsen.py
--rw-r--r--   0 runner    (1001) docker     (123)     5162 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_coding.py
--rw-r--r--   0 runner    (1001) docker     (123)     8071 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_coding_strings.py
--rw-r--r--   0 runner    (1001) docker     (123)    43161 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_coding_times.py
--rw-r--r--   0 runner    (1001) docker     (123)    44271 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_combine.py
--rw-r--r--   0 runner    (1001) docker     (123)    77115 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_computation.py
--rw-r--r--   0 runner    (1001) docker     (123)    46051 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_concat.py
--rw-r--r--   0 runner    (1001) docker     (123)    18885 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_conventions.py
--rw-r--r--   0 runner    (1001) docker     (123)     1681 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_cupy.py
--rw-r--r--   0 runner    (1001) docker     (123)    59984 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_dask.py
--rw-r--r--   0 runner    (1001) docker     (123)   246009 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_dataarray.py
--rw-r--r--   0 runner    (1001) docker     (123)   259858 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_dataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     4300 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_deprecation_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)     7699 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_distributed.py
--rw-r--r--   0 runner    (1001) docker     (123)     3472 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_dtypes.py
--rw-r--r--   0 runner    (1001) docker     (123)    30666 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_duck_array_ops.py
--rw-r--r--   0 runner    (1001) docker     (123)     2737 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_extensions.py
--rw-r--r--   0 runner    (1001) docker     (123)    24804 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_formatting.py
--rw-r--r--   0 runner    (1001) docker     (123)     6549 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_formatting_html.py
--rw-r--r--   0 runner    (1001) docker     (123)    80901 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_groupby.py
--rw-r--r--   0 runner    (1001) docker     (123)    25785 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_indexes.py
--rw-r--r--   0 runner    (1001) docker     (123)    31184 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_indexing.py
--rw-r--r--   0 runner    (1001) docker     (123)    29970 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_interp.py
--rw-r--r--   0 runner    (1001) docker     (123)    18119 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_merge.py
--rw-r--r--   0 runner    (1001) docker     (123)    23834 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_missing.py
--rw-r--r--   0 runner    (1001) docker     (123)      987 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_nputils.py
--rw-r--r--   0 runner    (1001) docker     (123)     7670 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_options.py
--rw-r--r--   0 runner    (1001) docker     (123)   119180 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_plot.py
--rw-r--r--   0 runner    (1001) docker     (123)    10344 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_plugins.py
--rw-r--r--   0 runner    (1001) docker     (123)      200 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_print_versions.py
--rw-r--r--   0 runner    (1001) docker     (123)    31207 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_rolling.py
--rw-r--r--   0 runner    (1001) docker     (123)    28760 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_sparse.py
--rw-r--r--   0 runner    (1001) docker     (123)     4723 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_testing.py
--rw-r--r--   0 runner    (1001) docker     (123)      982 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_tutorial.py
--rw-r--r--   0 runner    (1001) docker     (123)     4738 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_ufuncs.py
--rw-r--r--   0 runner    (1001) docker     (123)   188860 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_units.py
--rw-r--r--   0 runner    (1001) docker     (123)    11253 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)   110147 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_variable.py
--rw-r--r--   0 runner    (1001) docker     (123)    24189 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tests/test_weighted.py
--rw-r--r--   0 runner    (1001) docker     (123)     7254 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/tutorial.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.168488 xarray-2023.4.2/xarray/util/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4272 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/util/deprecation_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)    17583 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/util/generate_aggregations.py
--rw-r--r--   0 runner    (1001) docker     (123)     9194 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/util/generate_ops.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5219 2023-04-20 18:27:47.000000 xarray-2023.4.2/xarray/util/print_versions.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-20 18:28:08.120488 xarray-2023.4.2/xarray.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     3495 2023-04-20 18:28:07.000000 xarray-2023.4.2/xarray.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     9679 2023-04-20 18:28:08.000000 xarray-2023.4.2/xarray.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-20 18:28:07.000000 xarray-2023.4.2/xarray.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-20 18:28:07.000000 xarray-2023.4.2/xarray.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (123)      671 2023-04-20 18:28:07.000000 xarray-2023.4.2/xarray.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        7 2023-04-20 18:28:07.000000 xarray-2023.4.2/xarray.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.792526 xarray-2023.5.0/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.744524 xarray-2023.5.0/.binder/
+-rw-r--r--   0 runner    (1001) docker     (123)      533 2023-05-19 02:36:14.000000 xarray-2023.5.0/.binder/environment.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      297 2023-05-19 02:36:14.000000 xarray-2023.5.0/.codecov.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      115 2023-05-19 02:36:14.000000 xarray-2023.5.0/.git-blame-ignore-revs
+-rw-r--r--   0 runner    (1001) docker     (123)      125 2023-05-19 02:36:14.000000 xarray-2023.5.0/.git_archival.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      138 2023-05-19 02:36:14.000000 xarray-2023.5.0/.gitattributes
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.744524 xarray-2023.5.0/.github/
+-rw-r--r--   0 runner    (1001) docker     (123)       62 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/FUNDING.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.744524 xarray-2023.5.0/.github/ISSUE_TEMPLATE/
+-rw-r--r--   0 runner    (1001) docker     (123)     2738 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/ISSUE_TEMPLATE/bugreport.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      702 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/ISSUE_TEMPLATE/config.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      490 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/ISSUE_TEMPLATE/misc.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1158 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/ISSUE_TEMPLATE/newfeature.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      258 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/PULL_REQUEST_TEMPLATE.md
+-rw-r--r--   0 runner    (1001) docker     (123)     1167 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/config.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      156 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/dependabot.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1242 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/labeler.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     2133 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/stale.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.744524 xarray-2023.5.0/.github/workflows/
+-rw-r--r--   0 runner    (1001) docker     (123)     2582 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/benchmarks-last-release.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     2748 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/benchmarks.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     6662 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/ci-additional.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     5047 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/ci.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     1163 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/configure-testpypi-version.py
+-rw-r--r--   0 runner    (1001) docker     (123)      298 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/label-all.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      221 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/label-prs.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     2446 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/parse_logs.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1360 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/publish-test-results.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     2454 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/pypi-release.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     2259 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/testpypi-release.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     4523 2023-05-19 02:36:14.000000 xarray-2023.5.0/.github/workflows/upstream-dev-ci.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      865 2023-05-19 02:36:14.000000 xarray-2023.5.0/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)      163 2023-05-19 02:36:14.000000 xarray-2023.5.0/.pep8speaks.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1689 2023-05-19 02:36:14.000000 xarray-2023.5.0/.pre-commit-config.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      383 2023-05-19 02:36:14.000000 xarray-2023.5.0/.readthedocs.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)     3064 2023-05-19 02:36:14.000000 xarray-2023.5.0/CITATION.cff
+-rw-r--r--   0 runner    (1001) docker     (123)     3230 2023-05-19 02:36:14.000000 xarray-2023.5.0/CODE_OF_CONDUCT.md
+-rw-r--r--   0 runner    (1001) docker     (123)      127 2023-05-19 02:36:14.000000 xarray-2023.5.0/CONTRIBUTING.md
+-rw-r--r--   0 runner    (1001) docker     (123)     4763 2023-05-19 02:36:14.000000 xarray-2023.5.0/HOW_TO_RELEASE.md
+-rw-r--r--   0 runner    (1001) docker     (123)    10273 2023-05-19 02:36:14.000000 xarray-2023.5.0/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     3495 2023-05-19 02:36:32.792526 xarray-2023.5.0/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     8944 2023-05-19 02:36:14.000000 xarray-2023.5.0/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.744524 xarray-2023.5.0/asv_bench/
+-rw-r--r--   0 runner    (1001) docker     (123)     6350 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/asv.conf.json
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.748525 xarray-2023.5.0/asv_bench/benchmarks/
+-rw-r--r--   0 runner    (1001) docker     (123)     7991 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/README_CI.md
+-rw-r--r--   0 runner    (1001) docker     (123)     1654 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      622 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/accessors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1648 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/alignment.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1192 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/combine.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1872 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/dataarray_missing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21598 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/dataset_io.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5881 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/groupby.py
+-rw-r--r--   0 runner    (1001) docker     (123)      500 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/import.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5373 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/indexing.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1492 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/interp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2443 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/merge.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1674 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/pandas.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1021 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/polyfit.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1379 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/reindexing.py
+-rw-r--r--   0 runner    (1001) docker     (123)      784 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/renaming.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1037 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/repr.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4603 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/rolling.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1860 2023-05-19 02:36:14.000000 xarray-2023.5.0/asv_bench/benchmarks/unstacking.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.748525 xarray-2023.5.0/ci/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1232 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/install-upstream-wheels.sh
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6709 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/min_deps_check.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.748525 xarray-2023.5.0/ci/requirements/
+-rw-r--r--   0 runner    (1001) docker     (123)      601 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/requirements/all-but-dask.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      237 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/requirements/bare-minimum.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      812 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/requirements/doc.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      661 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/requirements/environment-py311.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      636 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/requirements/environment-windows-py311.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      635 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/requirements/environment-windows.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      658 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/requirements/environment.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1289 2023-05-19 02:36:14.000000 xarray-2023.5.0/ci/requirements/min-all-deps.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1232 2023-05-19 02:36:14.000000 xarray-2023.5.0/conftest.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.748525 xarray-2023.5.0/design_notes/
+-rw-r--r--   0 runner    (1001) docker     (123)    28105 2023-05-19 02:36:14.000000 xarray-2023.5.0/design_notes/flexible_indexes_notes.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.752524 xarray-2023.5.0/doc/
+-rw-r--r--   0 runner    (1001) docker     (123)     8471 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/Makefile
+-rw-r--r--   0 runner    (1001) docker     (123)      189 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/README.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.756525 xarray-2023.5.0/doc/_static/
+-rw-r--r--   0 runner    (1001) docker     (123)       46 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)    31185 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/advanced_selection_interpolation.svg
+-rw-r--r--   0 runner    (1001) docker     (123)   114027 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/ci.png
+-rw-r--r--   0 runner    (1001) docker     (123)    13488 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dask_array.png
+-rwxr-xr-x   0 runner    (1001) docker     (123)       63 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram-build.sh
+-rw-r--r--   0 runner    (1001) docker     (123)    13358 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram-logo.pdf
+-rw-r--r--   0 runner    (1001) docker     (123)   117124 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram-logo.png
+-rw-r--r--   0 runner    (1001) docker     (123)    66565 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram-logo.svg
+-rw-r--r--   0 runner    (1001) docker     (123)    11200 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram-logo.tex
+-rw-r--r--   0 runner    (1001) docker     (123)   183796 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram-square-logo.png
+-rw-r--r--   0 runner    (1001) docker     (123)    10947 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram-square-logo.tex
+-rw-r--r--   0 runner    (1001) docker     (123)    45348 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram.png
+-rw-r--r--   0 runner    (1001) docker     (123)    10875 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/dataset-diagram.tex
+-rw-r--r--   0 runner    (1001) docker     (123)     4286 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/favicon.ico
+-rw-r--r--   0 runner    (1001) docker     (123)     3519 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/index_api.svg
+-rw-r--r--   0 runner    (1001) docker     (123)     2528 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/index_contribute.svg
+-rw-r--r--   0 runner    (1001) docker     (123)     3977 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/index_getting_started.svg
+-rw-r--r--   0 runner    (1001) docker     (123)     6429 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/index_user_guide.svg
+-rw-r--r--   0 runner    (1001) docker     (123)    24992 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/numfocus_logo.png
+-rw-r--r--   0 runner    (1001) docker     (123)   104979 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/opendap-prism-tmax.png
+-rw-r--r--   0 runner    (1001) docker     (123)     4761 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/style.css
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.756525 xarray-2023.5.0/doc/_static/thumbnails/
+-rw-r--r--   0 runner    (1001) docker     (123)    32739 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/thumbnails/ERA5-GRIB-example.png
+-rw-r--r--   0 runner    (1001) docker     (123)    77903 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/thumbnails/ROMS_ocean_model.png
+-rw-r--r--   0 runner    (1001) docker     (123)    26018 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/thumbnails/area_weighted_temperature.png
+-rw-r--r--   0 runner    (1001) docker     (123)   454794 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/thumbnails/monthly-means.png
+-rw-r--r--   0 runner    (1001) docker     (123)    57609 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/thumbnails/multidimensional-coords.png
+-rw-r--r--   0 runner    (1001) docker     (123)    37844 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/thumbnails/toy-weather-data.png
+-rw-r--r--   0 runner    (1001) docker     (123)    43053 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/thumbnails/visualization_gallery.png
+-rw-r--r--   0 runner    (1001) docker     (123)   664021 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_static/view-docs.png
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.736524 xarray-2023.5.0/doc/_templates/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.760525 xarray-2023.5.0/doc/_templates/autosummary/
+-rw-r--r--   0 runner    (1001) docker     (123)      151 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_templates/autosummary/accessor.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      160 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_templates/autosummary/accessor_attribute.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      168 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_templates/autosummary/accessor_callable.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      157 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/_templates/autosummary/accessor_method.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    19245 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/api-hidden.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    21379 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/api.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    14643 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/conf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    42845 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/contributing.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1200 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/developers-meeting.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     9097 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/ecosystem.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.760525 xarray-2023.5.0/doc/examples/
+-rw-r--r--   0 runner    (1001) docker     (123)     2823 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/ERA5-GRIB-example.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     7270 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/ROMS_ocean_model.ipynb
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.760525 xarray-2023.5.0/doc/examples/_code/
+-rw-r--r--   0 runner    (1001) docker     (123)      703 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/_code/accessor_example.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28228 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/apply_ufunc_vectorize_1d.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     6187 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/area_weighted_temperature.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     1107 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/blank_template.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     7510 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/monthly-means.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)   445711 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/monthly_means_output.png
+-rw-r--r--   0 runner    (1001) docker     (123)     6742 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/multidimensional-coords.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     8569 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/visualization_gallery.ipynb
+-rw-r--r--   0 runner    (1001) docker     (123)     8734 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/examples/weather-data.ipynb
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.760525 xarray-2023.5.0/doc/gallery/
+-rw-r--r--   0 runner    (1001) docker     (123)       30 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/gallery/README.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1285 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/gallery/plot_cartopy_facetgrid.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1035 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/gallery/plot_colorbar_center.py
+-rw-r--r--   0 runner    (1001) docker     (123)      848 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/gallery/plot_control_colorbar.py
+-rw-r--r--   0 runner    (1001) docker     (123)      908 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/gallery/plot_lines_from_2d.py
+-rw-r--r--   0 runner    (1001) docker     (123)      747 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/gallery.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1844 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/gallery.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.760525 xarray-2023.5.0/doc/getting-started-guide/
+-rw-r--r--   0 runner    (1001) docker     (123)    20697 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/getting-started-guide/faq.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      346 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/getting-started-guide/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     6801 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/getting-started-guide/installing.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/getting-started-guide/quick-overview.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     5851 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/getting-started-guide/why-xarray.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     4535 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/howdoi.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     2799 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/index.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.764525 xarray-2023.5.0/doc/internals/
+-rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/internals/duck-arrays-integration.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     4040 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/internals/extending-xarray.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    17684 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/internals/how-to-add-new-backend.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      490 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/internals/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1561 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/internals/variable-objects.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     3083 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/internals/zarr-encoding-spec.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    12008 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/roadmap.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1087 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/tutorials-and-videos.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.764525 xarray-2023.5.0/doc/user-guide/
+-rw-r--r--   0 runner    (1001) docker     (123)    11116 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/combining.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    29189 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/computation.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    23127 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/dask.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    21446 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/data-structures.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     2812 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/duckarrays.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     7383 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/groupby.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      428 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    27433 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/indexing.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    10483 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/interpolation.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    47085 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/io.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      844 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/options.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     8704 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/pandas.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    31542 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/plotting.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    11220 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/reshaping.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     6179 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/terminology.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     8365 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/time-series.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     9199 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/user-guide/weather-climate.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     2479 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/videos.yml
+-rw-r--r--   0 runner    (1001) docker     (123)   321108 2023-05-19 02:36:14.000000 xarray-2023.5.0/doc/whats-new.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.768525 xarray-2023.5.0/licenses/
+-rw-r--r--   0 runner    (1001) docker     (123)     1485 2023-05-19 02:36:14.000000 xarray-2023.5.0/licenses/DASK_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)    18656 2023-05-19 02:36:14.000000 xarray-2023.5.0/licenses/ICOMOON_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1543 2023-05-19 02:36:14.000000 xarray-2023.5.0/licenses/NUMPY_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-05-19 02:36:14.000000 xarray-2023.5.0/licenses/PANDAS_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)    12761 2023-05-19 02:36:14.000000 xarray-2023.5.0/licenses/PYTHON_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1531 2023-05-19 02:36:14.000000 xarray-2023.5.0/licenses/SCIKIT_LEARN_LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1498 2023-05-19 02:36:14.000000 xarray-2023.5.0/licenses/SEABORN_LICENSE
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.768525 xarray-2023.5.0/properties/
+-rw-r--r--   0 runner    (1001) docker     (123)      993 2023-05-19 02:36:14.000000 xarray-2023.5.0/properties/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      244 2023-05-19 02:36:14.000000 xarray-2023.5.0/properties/conftest.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1397 2023-05-19 02:36:14.000000 xarray-2023.5.0/properties/test_encode_decode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3075 2023-05-19 02:36:14.000000 xarray-2023.5.0/properties/test_pandas_roundtrip.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1773 2023-05-19 02:36:14.000000 xarray-2023.5.0/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)      278 2023-05-19 02:36:14.000000 xarray-2023.5.0/requirements.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     4580 2023-05-19 02:36:32.796526 xarray-2023.5.0/setup.cfg
+-rwxr-xr-x   0 runner    (1001) docker     (123)      103 2023-05-19 02:36:14.000000 xarray-2023.5.0/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.768525 xarray-2023.5.0/xarray/
+-rw-r--r--   0 runner    (1001) docker     (123)     2843 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.772525 xarray-2023.5.0/xarray/backends/
+-rw-r--r--   0 runner    (1001) docker     (123)     1708 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    66968 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/api.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13833 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12264 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/file_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13947 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/h5netcdf_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5595 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/locks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3661 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/lru_cache.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1392 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/memory.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20307 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/netCDF4_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4163 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/netcdf3.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8172 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/plugins.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5696 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/pseudonetcdf_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6472 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/pydap_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4893 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/pynio_.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10902 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/scipy_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2062 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/store.py
+-rw-r--r--   0 runner    (1001) docker     (123)    35357 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/backends/zarr.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.772525 xarray-2023.5.0/xarray/coding/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/coding/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13824 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/coding/calendar_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)    47274 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/coding/cftime_offsets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29864 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/coding/cftimeindex.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9256 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/coding/frequencies.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8041 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/coding/strings.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27896 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/coding/times.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19168 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/coding/variables.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29000 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/conventions.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9712 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/convert.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.780526 xarray-2023.5.0/xarray/core/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   293555 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/_aggregations.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28533 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/_typed_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32142 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/_typed_ops.pyi
+-rw-r--r--   0 runner    (1001) docker     (123)    20311 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/accessor_dt.py
+-rw-r--r--   0 runner    (1001) docker     (123)    98648 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/accessor_str.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37538 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/alignment.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4406 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/arithmetic.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37528 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/combine.py
+-rw-r--r--   0 runner    (1001) docker     (123)    68915 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)    75278 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/computation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28139 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/concat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16433 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/coordinates.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3078 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/dask_array_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6190 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/daskmanager.py
+-rw-r--r--   0 runner    (1001) docker     (123)   258467 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/dataarray.py
+-rw-r--r--   0 runner    (1001) docker     (123)   357417 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/dataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4869 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/dtypes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23561 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/duck_array_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3516 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/extensions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27908 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/formatting.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10214 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/formatting_html.py
+-rw-r--r--   0 runner    (1001) docker     (123)    56789 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/groupby.py
+-rw-r--r--   0 runner    (1001) docker     (123)    54154 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/indexes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    57900 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/indexing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    39490 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/merge.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26507 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/missing.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5644 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/nanops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1593 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/npcompat.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8209 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/nputils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9973 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11050 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/options.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22317 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/parallel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9105 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/parallelcompat.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/pdcompat.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2762 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/pycompat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14121 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/resample.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19469 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/resample_cftime.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40165 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/rolling.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5745 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/rolling_exp.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6750 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/types.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37270 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)   122140 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/variable.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19161 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/core/weighted.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.780526 xarray-2023.5.0/xarray/indexes/
+-rw-r--r--   0 runner    (1001) docker     (123)      226 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/indexes/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.780526 xarray-2023.5.0/xarray/plot/
+-rw-r--r--   0 runner    (1001) docker     (123)      573 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/plot/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    41974 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/plot/accessor.py
+-rw-r--r--   0 runner    (1001) docker     (123)    86031 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/plot/dataarray_plot.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30818 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/plot/dataset_plot.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37227 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/plot/facetgrid.py
+-rw-r--r--   0 runner    (1001) docker     (123)    59520 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/plot/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/py.typed
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.780526 xarray-2023.5.0/xarray/static/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/static/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.780526 xarray-2023.5.0/xarray/static/css/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/static/css/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6075 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/static/css/style.css
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.780526 xarray-2023.5.0/xarray/static/html/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/static/html/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1343 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/static/html/icons-svg-inline.html
+-rw-r--r--   0 runner    (1001) docker     (123)    14507 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/testing.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.792526 xarray-2023.5.0/xarray/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)     8789 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2145 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/conftest.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.792526 xarray-2023.5.0/xarray/tests/data/
+-rw-r--r--   0 runner    (1001) docker     (123)     1184 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/data/bears.nc
+-rw-r--r--   0 runner    (1001) docker     (123)     5232 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/data/example.grib
+-rw-r--r--   0 runner    (1001) docker     (123)      783 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/data/example.ict
+-rw-r--r--   0 runner    (1001) docker     (123)      608 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/data/example.uamiv
+-rw-r--r--   0 runner    (1001) docker     (123)     1736 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/data/example_1.nc
+-rw-r--r--   0 runner    (1001) docker     (123)      470 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/data/example_1.nc.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    20566 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_accessor_dt.py
+-rw-r--r--   0 runner    (1001) docker     (123)   121928 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_accessor_str.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3705 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_array_api.py
+-rw-r--r--   0 runner    (1001) docker     (123)   205421 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_backends.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7152 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_backends_api.py
+-rw-r--r--   0 runner    (1001) docker     (123)      774 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_backends_common.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7176 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_backends_file_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)      366 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_backends_locks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2300 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_backends_lru_cache.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7536 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_calendar_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44969 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_cftime_offsets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40106 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_cftimeindex.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9248 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_cftimeindex_resample.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11478 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_coarsen.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5162 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_coding.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8071 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_coding_strings.py
+-rw-r--r--   0 runner    (1001) docker     (123)    43161 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_coding_times.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44271 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_combine.py
+-rw-r--r--   0 runner    (1001) docker     (123)    77115 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_computation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    46051 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_concat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18885 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_conventions.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1681 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_cupy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    60630 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_dask.py
+-rw-r--r--   0 runner    (1001) docker     (123)   248255 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_dataarray.py
+-rw-r--r--   0 runner    (1001) docker     (123)   260970 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_dataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4300 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_deprecation_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7699 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_distributed.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3472 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_dtypes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30666 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_duck_array_ops.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2737 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_extensions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24804 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_formatting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6549 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_formatting_html.py
+-rw-r--r--   0 runner    (1001) docker     (123)    84822 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_groupby.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25785 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_indexes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31184 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_indexing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29970 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_interp.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18119 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_merge.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23834 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_missing.py
+-rw-r--r--   0 runner    (1001) docker     (123)      987 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_nputils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7670 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_options.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6984 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_parallelcompat.py
+-rw-r--r--   0 runner    (1001) docker     (123)   119180 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_plot.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10361 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_plugins.py
+-rw-r--r--   0 runner    (1001) docker     (123)      200 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_print_versions.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31207 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_rolling.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28760 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_sparse.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4723 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_testing.py
+-rw-r--r--   0 runner    (1001) docker     (123)      982 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_tutorial.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4738 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_ufuncs.py
+-rw-r--r--   0 runner    (1001) docker     (123)   188860 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_units.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11253 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)   111128 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_variable.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24189 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tests/test_weighted.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7254 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/tutorial.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.792526 xarray-2023.5.0/xarray/util/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4272 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/util/deprecation_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17583 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/util/generate_aggregations.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9354 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/util/generate_ops.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5219 2023-05-19 02:36:14.000000 xarray-2023.5.0/xarray/util/print_versions.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-19 02:36:32.768525 xarray-2023.5.0/xarray.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     3495 2023-05-19 02:36:32.000000 xarray-2023.5.0/xarray.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     9839 2023-05-19 02:36:32.000000 xarray-2023.5.0/xarray.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-19 02:36:32.000000 xarray-2023.5.0/xarray.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       66 2023-05-19 02:36:32.000000 xarray-2023.5.0/xarray.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-19 02:36:32.000000 xarray-2023.5.0/xarray.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (123)      671 2023-05-19 02:36:32.000000 xarray-2023.5.0/xarray.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        7 2023-05-19 02:36:32.000000 xarray-2023.5.0/xarray.egg-info/top_level.txt
```

### Comparing `xarray-2023.4.2/.binder/environment.yml` & `xarray-2023.5.0/.binder/environment.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/ISSUE_TEMPLATE/bugreport.yml` & `xarray-2023.5.0/.github/ISSUE_TEMPLATE/bugreport.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/ISSUE_TEMPLATE/config.yml` & `xarray-2023.5.0/.github/ISSUE_TEMPLATE/config.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/ISSUE_TEMPLATE/newfeature.yml` & `xarray-2023.5.0/.github/ISSUE_TEMPLATE/newfeature.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/config.yml` & `xarray-2023.5.0/.github/config.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/labeler.yml` & `xarray-2023.5.0/.github/labeler.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/stale.yml` & `xarray-2023.5.0/.github/stale.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/workflows/benchmarks-last-release.yml` & `xarray-2023.5.0/.github/workflows/benchmarks-last-release.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/workflows/benchmarks.yml` & `xarray-2023.5.0/.github/workflows/benchmarks.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/workflows/ci-additional.yaml` & `xarray-2023.5.0/.github/workflows/ci-additional.yaml`

 * *Files 0% similar despite different names*

```diff
@@ -122,15 +122,15 @@
           python -m pip install mypy --force-reinstall
 
       - name: Run mypy
         run: |
           python -m mypy --install-types --non-interactive --cobertura-xml-report mypy_report
 
       - name: Upload mypy coverage to Codecov
-        uses: codecov/codecov-action@v3.1.2
+        uses: codecov/codecov-action@v3.1.3
         with:
           file: mypy_report/cobertura.xml
           flags: mypy
           env_vars: PYTHON_VERSION
           name: codecov-umbrella
           fail_ci_if_error: false
 
@@ -176,15 +176,15 @@
           python -m pip install mypy --force-reinstall
 
       - name: Run mypy
         run: |
           python -m mypy --install-types --non-interactive --cobertura-xml-report mypy_report
 
       - name: Upload mypy coverage to Codecov
-        uses: codecov/codecov-action@v3.1.2
+        uses: codecov/codecov-action@v3.1.3
         with:
           file: mypy_report/cobertura.xml
           flags: mypy39
           env_vars: PYTHON_VERSION
           name: codecov-umbrella
           fail_ci_if_error: false
```

### Comparing `xarray-2023.4.2/.github/workflows/ci.yaml` & `xarray-2023.5.0/.github/workflows/ci.yaml`

 * *Files 0% similar despite different names*

```diff
@@ -135,15 +135,15 @@
         if: always()
         uses: actions/upload-artifact@v3
         with:
           name: Test results for ${{ runner.os }}-${{ matrix.python-version }}
           path: pytest.xml
 
       - name: Upload code coverage to Codecov
-        uses: codecov/codecov-action@v3.1.2
+        uses: codecov/codecov-action@v3.1.3
         with:
           file: ./coverage.xml
           flags: unittests
           env_vars: RUNNER_OS,PYTHON_VERSION
           name: codecov-umbrella
           fail_ci_if_error: false
```

### Comparing `xarray-2023.4.2/.github/workflows/configure-testpypi-version.py` & `xarray-2023.5.0/.github/workflows/configure-testpypi-version.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/workflows/parse_logs.py` & `xarray-2023.5.0/.github/workflows/parse_logs.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/workflows/publish-test-results.yaml` & `xarray-2023.5.0/.github/workflows/publish-test-results.yaml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.github/workflows/pypi-release.yaml` & `xarray-2023.5.0/.github/workflows/pypi-release.yaml`

 * *Files 1% similar despite different names*

```diff
@@ -68,15 +68,15 @@
         run: |
           python -m pip install --upgrade pip
           python -m pip install dist/xarray*.whl
           python -m xarray.util.print_versions
 
       - name: Publish package to TestPyPI
         if: github.event_name == 'push'
-        uses: pypa/gh-action-pypi-publish@v1.8.5
+        uses: pypa/gh-action-pypi-publish@v1.8.6
         with:
           user: __token__
           password: ${{ secrets.TESTPYPI_TOKEN }}
           repository_url: https://test.pypi.org/legacy/
           verbose: true
 
 
@@ -86,12 +86,12 @@
     runs-on: ubuntu-latest
     steps:
       - uses: actions/download-artifact@v3
         with:
           name: releases
           path: dist
       - name: Publish package to PyPI
-        uses: pypa/gh-action-pypi-publish@v1.8.5
+        uses: pypa/gh-action-pypi-publish@v1.8.6
         with:
           user: __token__
           password: ${{ secrets.PYPI_TOKEN }}
           verbose: true
```

### Comparing `xarray-2023.4.2/.github/workflows/testpypi-release.yaml` & `xarray-2023.5.0/.github/workflows/testpypi-release.yaml`

 * *Files 1% similar despite different names*

```diff
@@ -74,13 +74,13 @@
         run: |
           python -m pip install --upgrade pip
           python -m pip install dist/xarray*.whl
           python -m xarray.util.print_versions
 
       - name: Publish package to TestPyPI
         if: github.event_name == 'push'
-        uses: pypa/gh-action-pypi-publish@v1.8.5
+        uses: pypa/gh-action-pypi-publish@v1.8.6
         with:
           user: __token__
           password: ${{ secrets.TESTPYPI_TOKEN }}
           repository_url: https://test.pypi.org/legacy/
           verbose: true
```

### Comparing `xarray-2023.4.2/.github/workflows/upstream-dev-ci.yaml` & `xarray-2023.5.0/.github/workflows/upstream-dev-ci.yaml`

 * *Files 26% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 on:
   push:
     branches:
       - main
   pull_request:
     branches:
       - main
+    types: [opened, reopened, synchronize, labeled]
   schedule:
     - cron: "0 0 * * *" # Daily At 00:00 UTC
   workflow_dispatch: # allows you to trigger the workflow run manually
 
 concurrency:
   group: ${{ github.workflow }}-${{ github.ref }}
   cancel-in-progress: true
@@ -37,14 +38,15 @@
     runs-on: ubuntu-latest
     needs: detect-ci-trigger
     if: |
         always()
         && (
             (github.event_name == 'schedule' || github.event_name == 'workflow_dispatch')
             || needs.detect-ci-trigger.outputs.triggered == 'true'
+            || contains( github.event.pull_request.labels.*.name, 'run-upstream')
         )
     defaults:
       run:
         shell: bash -l {0}
     strategy:
       fail-fast: false
       matrix:
@@ -88,7 +90,62 @@
           failure()
           && steps.status.outcome == 'failure'
           && github.event_name == 'schedule'
           && github.repository_owner == 'pydata'
         uses: xarray-contrib/issue-from-pytest-log@v1
         with:
           log-path: output-${{ matrix.python-version }}-log.jsonl
+
+  mypy-upstream-dev:
+    name: mypy-upstream-dev
+    runs-on: ubuntu-latest
+    needs: detect-ci-trigger
+    if: |
+        always()
+        && (
+            contains( github.event.pull_request.labels.*.name, 'run-upstream')
+        )
+    defaults:
+      run:
+        shell: bash -l {0}
+    strategy:
+      fail-fast: false
+      matrix:
+        python-version: ["3.10"]
+    steps:
+      - uses: actions/checkout@v3
+        with:
+          fetch-depth: 0 # Fetch all history for all branches and tags.
+      - name: Set up conda environment
+        uses: mamba-org/provision-with-micromamba@v15
+        with:
+          environment-file: ci/requirements/environment.yml
+          environment-name: xarray-tests
+          extra-specs: |
+            python=${{ matrix.python-version }}
+            pytest-reportlog
+            conda
+      - name: Install upstream versions
+        run: |
+          bash ci/install-upstream-wheels.sh
+      - name: Install xarray
+        run: |
+          python -m pip install --no-deps -e .
+      - name: Version info
+        run: |
+          conda info -a
+          conda list
+          python xarray/util/print_versions.py
+      - name: Install mypy
+        run: |
+          python -m pip install mypy --force-reinstall
+      - name: Run mypy
+        run: |
+          python -m mypy --install-types --non-interactive --cobertura-xml-report mypy_report
+      - name: Upload mypy coverage to Codecov
+        uses: codecov/codecov-action@v3.1.3
+        with:
+          file: mypy_report/cobertura.xml
+          flags: mypy
+          env_vars: PYTHON_VERSION
+          name: codecov-umbrella
+          fail_ci_if_error: false
```

### Comparing `xarray-2023.4.2/.gitignore` & `xarray-2023.5.0/.gitignore`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/.pre-commit-config.yaml` & `xarray-2023.5.0/.pre-commit-config.yaml`

 * *Files 1% similar despite different names*

```diff
@@ -12,15 +12,15 @@
     rev: v0.3.1
     hooks:
       - id: absolufy-imports
         name: absolufy-imports
         files: ^xarray/
   - repo: https://github.com/charliermarsh/ruff-pre-commit
     # Ruff version.
-    rev: 'v0.0.261'
+    rev: 'v0.0.267'
     hooks:
       - id: ruff
         args: ["--fix"]
   # https://github.com/python/black#version-control-integration
   - repo: https://github.com/psf/black
     rev: 23.3.0
     hooks:
@@ -29,15 +29,15 @@
     rev: v0.3.8
     hooks:
       - id: blackdoc
         exclude: "generate_aggregations.py"
         additional_dependencies: ["black==23.3.0"]
       - id: blackdoc-autoupdate-black
   - repo: https://github.com/pre-commit/mirrors-mypy
-    rev: v1.2.0
+    rev: v1.3.0
     hooks:
       - id: mypy
         # Copied from setup.cfg
         exclude: "properties|asv_bench"
         # This is slow and so we take it out of the fast-path; requires passing
         # `--hook-stage manual` to pre-commit
         stages: [manual]
```

### Comparing `xarray-2023.4.2/CITATION.cff` & `xarray-2023.5.0/CITATION.cff`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/CODE_OF_CONDUCT.md` & `xarray-2023.5.0/CODE_OF_CONDUCT.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/HOW_TO_RELEASE.md` & `xarray-2023.5.0/HOW_TO_RELEASE.md`

 * *Files 9% similar despite different names*

```diff
@@ -14,19 +14,24 @@
 <!-- markdownlint-disable MD031 -->
 
  1. Ensure your main branch is synced to upstream:
      ```sh
      git switch main
      git pull upstream main
      ```
- 2. Add a list of contributors with:
+ 2. Add a list of contributors.
+    First fetch all previous release tags so we can see the version number of the last release was:
+    ```sh
+    git fetch upstream --tags
+    ```
+    This will return a list of all the contributors since the last release:
     ```sh
     git log "$(git tag --sort=v:refname | tail -1).." --format=%aN | sort -u | perl -pe 's/\n/$1, /'
     ```
-    This will return the number of contributors:
+    This will return the total number of contributors:
     ```sh
     git log "$(git tag --sort=v:refname | tail -1).." --format=%aN | sort -u | wc -l
     ```
  3. Write a release summary: ~50 words describing the high level features. This
     will be used in the release emails, tweets, GitHub release notes, etc.
  4. Look over whats-new.rst and the docs. Make sure "What's New" is complete
     (check the date!) and add the release summary at the top.
```

### Comparing `xarray-2023.4.2/LICENSE` & `xarray-2023.5.0/LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/PKG-INFO` & `xarray-2023.5.0/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: xarray
-Version: 2023.4.2
+Version: 2023.5.0
 Summary: N-D labeled arrays and datasets in Python
 Home-page: https://github.com/pydata/xarray
 Author: xarray Developers
 Author-email: xarray@googlegroups.com
 License: Apache-2.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: License :: OSI Approved :: Apache Software License
```

### Comparing `xarray-2023.4.2/README.md` & `xarray-2023.5.0/README.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/asv.conf.json` & `xarray-2023.5.0/asv_bench/asv.conf.json`

 * *Files 0% similar despite different names*

```diff
@@ -26,14 +26,15 @@
 
     // The tool to use to create environments.  May be "conda",
     // "virtualenv" or other value depending on the plugins in use.
     // If missing or the empty string, the tool will be automatically
     // determined by looking for tools on the PATH environment
     // variable.
     "environment_type": "conda",
+    "conda_channels": ["conda-forge"],
 
     // timeout in seconds for installing any dependencies in environment
     // defaults to 10 min
     "install_timeout": 600,
 
     // the base URL to show a commit for the project.
     "show_commit_url": "https://github.com/pydata/xarray/commit/",
```

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/README_CI.md` & `xarray-2023.5.0/asv_bench/benchmarks/README_CI.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/__init__.py` & `xarray-2023.5.0/asv_bench/benchmarks/__init__.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/alignment.py` & `xarray-2023.5.0/asv_bench/benchmarks/alignment.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/combine.py` & `xarray-2023.5.0/asv_bench/benchmarks/combine.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/dataarray_missing.py` & `xarray-2023.5.0/asv_bench/benchmarks/dataarray_missing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/dataset_io.py` & `xarray-2023.5.0/asv_bench/benchmarks/dataset_io.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/indexing.py` & `xarray-2023.5.0/asv_bench/benchmarks/indexing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/interp.py` & `xarray-2023.5.0/asv_bench/benchmarks/interp.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/merge.py` & `xarray-2023.5.0/asv_bench/benchmarks/merge.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/pandas.py` & `xarray-2023.5.0/asv_bench/benchmarks/pandas.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/polyfit.py` & `xarray-2023.5.0/asv_bench/benchmarks/polyfit.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/reindexing.py` & `xarray-2023.5.0/asv_bench/benchmarks/reindexing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/renaming.py` & `xarray-2023.5.0/asv_bench/benchmarks/renaming.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/repr.py` & `xarray-2023.5.0/asv_bench/benchmarks/repr.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/rolling.py` & `xarray-2023.5.0/asv_bench/benchmarks/rolling.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/asv_bench/benchmarks/unstacking.py` & `xarray-2023.5.0/asv_bench/benchmarks/unstacking.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/ci/install-upstream-wheels.sh` & `xarray-2023.5.0/ci/install-upstream-wheels.sh`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/ci/min_deps_check.py` & `xarray-2023.5.0/ci/min_deps_check.py`

 * *Files 3% similar despite different names*

```diff
@@ -25,15 +25,15 @@
     "pytest",
     "pytest-cov",
     "pytest-env",
     "pytest-xdist",
     "pytest-timeout",
 }
 
-POLICY_MONTHS = {"python": 24, "numpy": 18}
+POLICY_MONTHS = {"python": 30, "numpy": 18}
 POLICY_MONTHS_DEFAULT = 12
 POLICY_OVERRIDE: dict[str, tuple[int, int]] = {}
 errors = []
 
 
 def error(msg: str) -> None:
     global errors
@@ -105,14 +105,17 @@
         out.update(
             {
                 (2, 7): datetime(2010, 6, 3),
                 (3, 5): datetime(2015, 9, 13),
                 (3, 6): datetime(2016, 12, 23),
                 (3, 7): datetime(2018, 6, 27),
                 (3, 8): datetime(2019, 10, 14),
+                (3, 9): datetime(2020, 10, 5),
+                (3, 10): datetime(2021, 10, 4),
+                (3, 11): datetime(2022, 10, 24),
             }
         )
 
     return out
 
 
 def process_pkg(
```

### Comparing `xarray-2023.4.2/ci/requirements/all-but-dask.yml` & `xarray-2023.5.0/ci/requirements/all-but-dask.yml`

 * *Files 2% similar despite different names*

```diff
@@ -22,15 +22,15 @@
   - nc-time-axis
   - netcdf4
   - numba
   - numbagg
   - numpy<1.24
   - packaging
   - pandas
-  - pint
+  - pint<0.21
   - pip
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
```

### Comparing `xarray-2023.4.2/ci/requirements/doc.yml` & `xarray-2023.5.0/ci/requirements/doc.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/ci/requirements/environment-py311.yml` & `xarray-2023.5.0/ci/requirements/environment-windows-py311.yml`

 * *Files 16% similar despite different names*

```diff
@@ -1,17 +1,15 @@
 name: xarray-tests
 channels:
   - conda-forge
-  - nodefaults
 dependencies:
-  - aiobotocore
   - boto3
   - bottleneck
   - cartopy
-  # - cdms2
+  # - cdms2  # Not available on Windows
   - cftime
   - dask-core
   - distributed
   - flox
   - fsspec!=2021.7.0
   - h5netcdf
   - h5py
@@ -20,21 +18,19 @@
   - iris
   - lxml  # Optional dep of pydap
   - matplotlib-base
   - nc-time-axis
   - netcdf4
   # - numba
   # - numbagg
-  - numexpr
   - numpy
   - packaging
   - pandas
-  - pint
+  - pint<0.21
   - pip
-  - pooch
   - pre-commit
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
```

### Comparing `xarray-2023.4.2/ci/requirements/environment-windows-py311.yml` & `xarray-2023.5.0/ci/requirements/environment-windows.yml`

 * *Files 6% similar despite different names*

```diff
@@ -16,29 +16,29 @@
   - hdf5
   - hypothesis
   - iris
   - lxml  # Optional dep of pydap
   - matplotlib-base
   - nc-time-axis
   - netcdf4
-  # - numba
-  # - numbagg
-  - numpy
+  - numba
+  - numbagg
+  - numpy<1.24
   - packaging
   - pandas
-  - pint
+  - pint<0.21
   - pip
   - pre-commit
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
   - pytest-timeout
   - rasterio
   - scipy
   - seaborn
-  # - sparse
+  - sparse
   - toolz
   - typing_extensions
   - zarr
```

### Comparing `xarray-2023.4.2/ci/requirements/environment-windows.yml` & `xarray-2023.5.0/ci/requirements/environment.yml`

 * *Files 12% similar despite different names*

```diff
@@ -1,15 +1,17 @@
 name: xarray-tests
 channels:
   - conda-forge
+  - nodefaults
 dependencies:
+  - aiobotocore
   - boto3
   - bottleneck
   - cartopy
-  # - cdms2  # Not available on Windows
+  - cdms2
   - cftime
   - dask-core
   - distributed
   - flox
   - fsspec!=2021.7.0
   - h5netcdf
   - h5py
@@ -18,19 +20,21 @@
   - iris
   - lxml  # Optional dep of pydap
   - matplotlib-base
   - nc-time-axis
   - netcdf4
   - numba
   - numbagg
+  - numexpr
   - numpy<1.24
   - packaging
   - pandas
-  - pint
+  - pint<0.21
   - pip
+  - pooch
   - pre-commit
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
```

### Comparing `xarray-2023.4.2/ci/requirements/environment.yml` & `xarray-2023.5.0/ci/requirements/environment-py311.yml`

 * *Files 20% similar despite different names*

```diff
@@ -3,46 +3,46 @@
   - conda-forge
   - nodefaults
 dependencies:
   - aiobotocore
   - boto3
   - bottleneck
   - cartopy
-  - cdms2
+  # - cdms2
   - cftime
   - dask-core
   - distributed
   - flox
   - fsspec!=2021.7.0
   - h5netcdf
   - h5py
   - hdf5
   - hypothesis
   - iris
   - lxml  # Optional dep of pydap
   - matplotlib-base
   - nc-time-axis
   - netcdf4
-  - numba
-  - numbagg
+  # - numba
+  # - numbagg
   - numexpr
-  - numpy<1.24
+  - numpy
   - packaging
   - pandas
-  - pint
+  - pint<0.21
   - pip
   - pooch
   - pre-commit
   - pseudonetcdf
   - pydap
   - pytest
   - pytest-cov
   - pytest-env
   - pytest-xdist
   - pytest-timeout
   - rasterio
   - scipy
   - seaborn
-  - sparse
+  # - sparse
   - toolz
   - typing_extensions
   - zarr
```

### Comparing `xarray-2023.4.2/ci/requirements/min-all-deps.yml` & `xarray-2023.5.0/ci/requirements/min-all-deps.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/conftest.py` & `xarray-2023.5.0/conftest.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/design_notes/flexible_indexes_notes.md` & `xarray-2023.5.0/design_notes/flexible_indexes_notes.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/Makefile` & `xarray-2023.5.0/doc/Makefile`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/advanced_selection_interpolation.svg` & `xarray-2023.5.0/doc/_static/advanced_selection_interpolation.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/ci.png` & `xarray-2023.5.0/doc/_static/ci.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dask_array.png` & `xarray-2023.5.0/doc/_static/dask_array.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dataset-diagram-logo.pdf` & `xarray-2023.5.0/doc/_static/dataset-diagram-logo.pdf`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dataset-diagram-logo.png` & `xarray-2023.5.0/doc/_static/dataset-diagram-logo.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dataset-diagram-logo.svg` & `xarray-2023.5.0/doc/_static/dataset-diagram-logo.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dataset-diagram-logo.tex` & `xarray-2023.5.0/doc/_static/dataset-diagram-logo.tex`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dataset-diagram-square-logo.png` & `xarray-2023.5.0/doc/_static/dataset-diagram-square-logo.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dataset-diagram-square-logo.tex` & `xarray-2023.5.0/doc/_static/dataset-diagram-square-logo.tex`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dataset-diagram.png` & `xarray-2023.5.0/doc/_static/dataset-diagram.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/dataset-diagram.tex` & `xarray-2023.5.0/doc/_static/dataset-diagram.tex`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/favicon.ico` & `xarray-2023.5.0/doc/_static/favicon.ico`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/index_api.svg` & `xarray-2023.5.0/doc/_static/index_api.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/index_contribute.svg` & `xarray-2023.5.0/doc/_static/index_contribute.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/index_getting_started.svg` & `xarray-2023.5.0/doc/_static/index_getting_started.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/index_user_guide.svg` & `xarray-2023.5.0/doc/_static/index_user_guide.svg`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/numfocus_logo.png` & `xarray-2023.5.0/doc/_static/numfocus_logo.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/opendap-prism-tmax.png` & `xarray-2023.5.0/doc/_static/opendap-prism-tmax.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/style.css` & `xarray-2023.5.0/doc/_static/style.css`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/thumbnails/ERA5-GRIB-example.png` & `xarray-2023.5.0/doc/_static/thumbnails/ERA5-GRIB-example.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/thumbnails/ROMS_ocean_model.png` & `xarray-2023.5.0/doc/_static/thumbnails/ROMS_ocean_model.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/thumbnails/area_weighted_temperature.png` & `xarray-2023.5.0/doc/_static/thumbnails/area_weighted_temperature.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/thumbnails/monthly-means.png` & `xarray-2023.5.0/doc/_static/thumbnails/monthly-means.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/thumbnails/multidimensional-coords.png` & `xarray-2023.5.0/doc/_static/thumbnails/multidimensional-coords.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/thumbnails/toy-weather-data.png` & `xarray-2023.5.0/doc/_static/thumbnails/toy-weather-data.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/thumbnails/visualization_gallery.png` & `xarray-2023.5.0/doc/_static/thumbnails/visualization_gallery.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/_static/view-docs.png` & `xarray-2023.5.0/doc/_static/view-docs.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/api-hidden.rst` & `xarray-2023.5.0/doc/api-hidden.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/api.rst` & `xarray-2023.5.0/doc/api.rst`

 * *Files 1% similar despite different names*

```diff
@@ -628,14 +628,15 @@
    open_dataarray
    DataArray.as_numpy
    DataArray.from_cdms2
    DataArray.from_dict
    DataArray.from_iris
    DataArray.from_series
    DataArray.to_cdms2
+   DataArray.to_dask_dataframe
    DataArray.to_dataframe
    DataArray.to_dataset
    DataArray.to_dict
    DataArray.to_index
    DataArray.to_iris
    DataArray.to_masked_array
    DataArray.to_netcdf
```

### Comparing `xarray-2023.4.2/doc/conf.py` & `xarray-2023.5.0/doc/conf.py`

 * *Files 0% similar despite different names*

```diff
@@ -234,15 +234,15 @@
     use_edit_page_button=True,
     use_repository_button=True,
     use_issues_button=True,
     home_page_in_toc=False,
     extra_footer="""<p>Xarray is a fiscally sponsored project of <a href="https://numfocus.org">NumFOCUS</a>,
     a nonprofit dedicated to supporting the open-source scientific computing community.<br>
     Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a></p>""",
-    twitter_url="https://twitter.com/xarray_devs",
+    twitter_url="https://twitter.com/xarray_dev",
     icon_links=[],  # workaround for pydata/pydata-sphinx-theme#1220
 )
 
 
 # The name of an image file (relative to this directory) to place at the top
 # of the sidebar.
 html_logo = "_static/dataset-diagram-logo.png"
```

### Comparing `xarray-2023.4.2/doc/contributing.rst` & `xarray-2023.5.0/doc/contributing.rst`

 * *Files 1% similar despite different names*

```diff
@@ -825,25 +825,25 @@
 For more, see the `pytest <http://doc.pytest.org/en/latest/>`_ documentation.
 
 Running the performance test suite
 ----------------------------------
 
 Performance matters and it is worth considering whether your code has introduced
 performance regressions.  *xarray* is starting to write a suite of benchmarking tests
-using `asv <https://github.com/spacetelescope/asv>`__
+using `asv <https://github.com/airspeed-velocity/asv>`__
 to enable easy monitoring of the performance of critical *xarray* operations.
 These benchmarks are all found in the ``xarray/asv_bench`` directory.
 
 To use all features of asv, you will need either ``conda`` or
 ``virtualenv``. For more details please check the `asv installation
-webpage <https://asv.readthedocs.io/en/latest/installing.html>`_.
+webpage <https://asv.readthedocs.io/en/stable/installing.html>`_.
 
 To install asv::
 
-    pip install git+https://github.com/spacetelescope/asv
+    python -m pip install asv
 
 If you need to run a benchmark, change your directory to ``asv_bench/`` and run::
 
     asv continuous -f 1.1 upstream/main HEAD
 
 You can replace ``HEAD`` with the name of the branch you are working on,
 and report benchmarks that changed by more than 10%.
@@ -1065,15 +1065,15 @@
 
 - **Properly comment and document your code.** See `"Documenting your code" <https://docs.xarray.dev/en/stable/contributing.html#documenting-your-code>`_.
 - **Test that the documentation builds correctly** by typing ``make html`` in the ``doc`` directory. This is not strictly necessary, but this may be easier than waiting for CI to catch a mistake. See `"Contributing to the documentation" <https://docs.xarray.dev/en/stable/contributing.html#contributing-to-the-documentation>`_.
 - **Test your code**.
 
   - Write new tests if needed. See `"Test-driven development/code writing" <https://docs.xarray.dev/en/stable/contributing.html#test-driven-development-code-writing>`_.
   - Test the code using `Pytest <http://doc.pytest.org/en/latest/>`_. Running all tests (type ``pytest`` in the root directory) takes a while, so feel free to only run the tests you think are needed based on your PR (example: ``pytest xarray/tests/test_dataarray.py``). CI will catch any failing tests.
-  - By default, the upstream dev CI is disabled on pull request and push events. You can override this behavior per commit by adding a <tt>[test-upstream]</tt> tag to the first line of the commit message. For documentation-only commits, you can skip the CI per commit by adding a "[skip-ci]" tag to the first line of the commit message.
+  - By default, the upstream dev CI is disabled on pull request and push events. You can override this behavior per commit by adding a ``[test-upstream]`` tag to the first line of the commit message. For documentation-only commits, you can skip the CI per commit by adding a ``[skip-ci]`` tag to the first line of the commit message.
 
 - **Properly format your code** and verify that it passes the formatting guidelines set by `Black <https://black.readthedocs.io/en/stable/>`_ and `Flake8 <http://flake8.pycqa.org/en/latest/>`_. See `"Code formatting" <https://docs.xarray.dev/en/stablcontributing.html#code-formatting>`_. You can use `pre-commit <https://pre-commit.com/>`_ to run these automatically on each commit.
 
   - Run ``pre-commit run --all-files`` in the root directory. This may modify some files. Confirm and commit any formatting changes.
 
 - **Push your code** and `create a PR on GitHub <https://help.github.com/en/articles/creating-a-pull-request>`_.
 - **Use a helpful title for your pull request** by summarizing the main contributions rather than using the latest commit message. If the PR addresses an `issue <https://github.com/pydata/xarray/issues>`_, please `reference it <https://help.github.com/en/articles/autolinked-references-and-urls>`_.
```

### Comparing `xarray-2023.4.2/doc/developers-meeting.rst` & `xarray-2023.5.0/doc/developers-meeting.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/ecosystem.rst` & `xarray-2023.5.0/doc/ecosystem.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/ERA5-GRIB-example.ipynb` & `xarray-2023.5.0/doc/examples/ERA5-GRIB-example.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/ROMS_ocean_model.ipynb` & `xarray-2023.5.0/doc/examples/ROMS_ocean_model.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/_code/accessor_example.py` & `xarray-2023.5.0/doc/examples/_code/accessor_example.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/apply_ufunc_vectorize_1d.ipynb` & `xarray-2023.5.0/doc/examples/apply_ufunc_vectorize_1d.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/area_weighted_temperature.ipynb` & `xarray-2023.5.0/doc/examples/area_weighted_temperature.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/blank_template.ipynb` & `xarray-2023.5.0/doc/examples/blank_template.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/monthly-means.ipynb` & `xarray-2023.5.0/doc/examples/monthly-means.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/monthly_means_output.png` & `xarray-2023.5.0/doc/examples/monthly_means_output.png`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/multidimensional-coords.ipynb` & `xarray-2023.5.0/doc/examples/multidimensional-coords.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/visualization_gallery.ipynb` & `xarray-2023.5.0/doc/examples/visualization_gallery.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/examples/weather-data.ipynb` & `xarray-2023.5.0/doc/examples/weather-data.ipynb`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/gallery/plot_cartopy_facetgrid.py` & `xarray-2023.5.0/doc/gallery/plot_cartopy_facetgrid.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/gallery/plot_colorbar_center.py` & `xarray-2023.5.0/doc/gallery/plot_colorbar_center.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/gallery/plot_control_colorbar.py` & `xarray-2023.5.0/doc/gallery/plot_control_colorbar.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/gallery/plot_lines_from_2d.py` & `xarray-2023.5.0/doc/gallery/plot_lines_from_2d.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/gallery.rst` & `xarray-2023.5.0/doc/gallery.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/gallery.yml` & `xarray-2023.5.0/doc/gallery.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/getting-started-guide/faq.rst` & `xarray-2023.5.0/doc/getting-started-guide/faq.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/getting-started-guide/installing.rst` & `xarray-2023.5.0/doc/getting-started-guide/installing.rst`

 * *Files 2% similar despite different names*

```diff
@@ -82,15 +82,15 @@
 .. _mindeps_policy:
 
 Minimum dependency versions
 ---------------------------
 Xarray adopts a rolling policy regarding the minimum supported version of its
 dependencies:
 
-- **Python:** 24 months
+- **Python:** 30 months
   (`NEP-29 <https://numpy.org/neps/nep-0029-deprecation_policy.html>`_)
 - **numpy:** 18 months
   (`NEP-29 <https://numpy.org/neps/nep-0029-deprecation_policy.html>`_)
 - **all other libraries:** 12 months
 
 This means the latest minor (X.Y) version from N months prior. Patch versions (x.y.Z)
 are not pinned, and only the latest available at the moment of publishing the xarray
```

### Comparing `xarray-2023.4.2/doc/getting-started-guide/quick-overview.rst` & `xarray-2023.5.0/doc/getting-started-guide/quick-overview.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/getting-started-guide/why-xarray.rst` & `xarray-2023.5.0/doc/getting-started-guide/why-xarray.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/howdoi.rst` & `xarray-2023.5.0/doc/howdoi.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/index.rst` & `xarray-2023.5.0/doc/index.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/internals/duck-arrays-integration.rst` & `xarray-2023.5.0/doc/internals/duck-arrays-integration.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/internals/extending-xarray.rst` & `xarray-2023.5.0/doc/internals/extending-xarray.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/internals/how-to-add-new-backend.rst` & `xarray-2023.5.0/doc/internals/how-to-add-new-backend.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/internals/variable-objects.rst` & `xarray-2023.5.0/doc/internals/variable-objects.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/internals/zarr-encoding-spec.rst` & `xarray-2023.5.0/doc/internals/zarr-encoding-spec.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/roadmap.rst` & `xarray-2023.5.0/doc/roadmap.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/tutorials-and-videos.rst` & `xarray-2023.5.0/doc/tutorials-and-videos.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/combining.rst` & `xarray-2023.5.0/doc/user-guide/combining.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/computation.rst` & `xarray-2023.5.0/doc/user-guide/computation.rst`

 * *Files 1% similar despite different names*

```diff
@@ -59,14 +59,18 @@
 Data arrays also implement many :py:class:`numpy.ndarray` methods:
 
 .. ipython:: python
 
     arr.round(2)
     arr.T
 
+    intarr = xr.DataArray([0, 1, 2, 3, 4, 5])
+    intarr << 2  # only supported for int types
+    intarr >> 1
+
 .. _missing_values:
 
 Missing values
 ==============
 
 Xarray represents missing values using the "NaN" (Not a Number) value from NumPy, which is a
 special floating-point value that indicates a value that is undefined or unrepresentable.
```

### Comparing `xarray-2023.4.2/doc/user-guide/dask.rst` & `xarray-2023.5.0/doc/user-guide/dask.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/data-structures.rst` & `xarray-2023.5.0/doc/user-guide/data-structures.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/duckarrays.rst` & `xarray-2023.5.0/doc/user-guide/duckarrays.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/groupby.rst` & `xarray-2023.5.0/doc/user-guide/groupby.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/indexing.rst` & `xarray-2023.5.0/doc/user-guide/indexing.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/interpolation.rst` & `xarray-2023.5.0/doc/user-guide/interpolation.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/io.rst` & `xarray-2023.5.0/doc/user-guide/io.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/options.rst` & `xarray-2023.5.0/doc/user-guide/options.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/pandas.rst` & `xarray-2023.5.0/doc/user-guide/pandas.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/plotting.rst` & `xarray-2023.5.0/doc/user-guide/plotting.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/reshaping.rst` & `xarray-2023.5.0/doc/user-guide/reshaping.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/terminology.rst` & `xarray-2023.5.0/doc/user-guide/terminology.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/time-series.rst` & `xarray-2023.5.0/doc/user-guide/time-series.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/user-guide/weather-climate.rst` & `xarray-2023.5.0/doc/user-guide/weather-climate.rst`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/videos.yml` & `xarray-2023.5.0/doc/videos.yml`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/doc/whats-new.rst` & `xarray-2023.5.0/doc/whats-new.rst`

 * *Files 1% similar despite different names*

```diff
@@ -11,14 +11,99 @@
     import xarray as xray
     import xarray
     import xarray as xr
 
     np.random.seed(123456)
 
 
+.. _whats-new.2023.05.1:
+
+v2023.05.1 (unreleased)
+-----------------------
+
+New Features
+~~~~~~~~~~~~
+
+
+Breaking changes
+~~~~~~~~~~~~~~~~
+
+
+Deprecations
+~~~~~~~~~~~~
+
+Performance
+~~~~~~~~~~~
+
+
+Bug fixes
+~~~~~~~~~
+
+
+Documentation
+~~~~~~~~~~~~~
+
+
+Internal Changes
+~~~~~~~~~~~~~~~~
+
+
+.. _whats-new.2023.05.0:
+
+v2023.05.0 (May 18, 2023)
+-------------------------
+
+This release adds some new methods and operators, updates our deprecation policy for python versions, fixes some bugs with groupby,
+and introduces experimental support for alternative chunked parallel array computation backends via a new plugin system!
+
+Thanks to our 14 contributors:
+Alan Brammer, crusaderky, David Stansby, dcherian, Deeksha, Deepak Cherian, Illviljan, James McCreight,
+Joe Hamman, Justus Magin, Kyle Sunden, Max Hollmann, mgunyho, and Tom Nicholas
+
+
+New Features
+~~~~~~~~~~~~
+- Added new method :py:meth:`DataArray.to_dask_dataframe`, convert a dataarray into a dask dataframe (:issue:`7409`).
+  By `Deeksha <https://github.com/dsgreen2>`_.
+- Add support for lshift and rshift binary operators (``<<``, ``>>``) on
+  :py:class:`xr.DataArray` of type :py:class:`int` (:issue:`7727` , :pull:`7741`).
+  By `Alan Brammer <https://github.com/abrammer>`_.
+- Keyword argument `data='array'` to both :py:meth:`xarray.Dataset.to_dict` and
+  :py:meth:`xarray.DataArray.to_dict` will now return data as the underlying array type.
+  Python lists are returned for `data='list'` or `data=True`. Supplying `data=False` only returns the schema without data.
+  ``encoding=True`` returns the encoding dictionary for the underlying variable also. (:issue:`1599`, :pull:`7739`) .
+  By `James McCreight <https://github.com/jmccreight>`_.
+
+Breaking changes
+~~~~~~~~~~~~~~~~
+- adjust the deprecation policy for python to once again align with NEP-29 (:issue:`7765`, :pull:`7793`)
+  By `Justus Magin <https://github.com/keewis>`_.
+
+Performance
+~~~~~~~~~~~
+- Optimize ``.dt `` accessor performance with ``CFTimeIndex``. (:pull:`7796`)
+  By `Deepak Cherian <https://github.com/dcherian>`_.
+
+Bug fixes
+~~~~~~~~~
+- Fix `as_compatible_data` for masked float arrays, now always creates a copy when mask is present (:issue:`2377`, :pull:`7788`).
+  By `Max Hollmann <https://github.com/maxhollmann>`_.
+- Fix groupby binary ops when grouped array is subset relative to other. (:issue:`7797`).
+  By `Deepak Cherian <https://github.com/dcherian>`_.
+- Fix groupby sum, prod for all-NaN groups with ``flox``. (:issue:`7808`).
+  By `Deepak Cherian <https://github.com/dcherian>`_.
+
+Internal Changes
+~~~~~~~~~~~~~~~~
+- Experimental support for wrapping chunked array libraries other than dask.
+  A new ABC is defined - :py:class:`xr.core.parallelcompat.ChunkManagerEntrypoint` - which can be subclassed and then
+  registered by alternative chunked array implementations. (:issue:`6807`, :pull:`7019`)
+  By `Tom Nicholas <https://github.com/TomNicholas>`_.
+
+
 .. _whats-new.2023.04.2:
 
 v2023.04.2 (April 20, 2023)
 ---------------------------
 
 This is a patch release to fix a bug with binning (:issue:`7766`)
```

### Comparing `xarray-2023.4.2/licenses/DASK_LICENSE` & `xarray-2023.5.0/licenses/DASK_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/licenses/ICOMOON_LICENSE` & `xarray-2023.5.0/licenses/ICOMOON_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/licenses/NUMPY_LICENSE` & `xarray-2023.5.0/licenses/NUMPY_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/licenses/PANDAS_LICENSE` & `xarray-2023.5.0/licenses/PANDAS_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/licenses/PYTHON_LICENSE` & `xarray-2023.5.0/licenses/PYTHON_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/licenses/SCIKIT_LEARN_LICENSE` & `xarray-2023.5.0/licenses/SCIKIT_LEARN_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/licenses/SEABORN_LICENSE` & `xarray-2023.5.0/licenses/SEABORN_LICENSE`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/properties/README.md` & `xarray-2023.5.0/properties/README.md`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/properties/test_encode_decode.py` & `xarray-2023.5.0/properties/test_encode_decode.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/properties/test_pandas_roundtrip.py` & `xarray-2023.5.0/properties/test_pandas_roundtrip.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/pyproject.toml` & `xarray-2023.5.0/pyproject.toml`

 * *Files 1% similar despite different names*

```diff
@@ -35,14 +35,15 @@
   "affine.*",
   "bottleneck.*",
   "cartopy.*",
   "cdms2.*",
   "cf_units.*",
   "cfgrib.*",
   "cftime.*",
+  "cubed.*",
   "cupy.*",
   "fsspec.*",
   "h5netcdf.*",
   "h5py.*",
   "importlib_metadata.*",
   "iris.*",
   "matplotlib.*",
```

### Comparing `xarray-2023.4.2/setup.cfg` & `xarray-2023.5.0/setup.cfg`

 * *Files 2% similar despite different names*

```diff
@@ -117,14 +117,18 @@
 [options.package_data]
 xarray = 
 	py.typed
 	tests/data/*
 	static/css/*
 	static/html/*
 
+[options.entry_points]
+xarray.chunkmanagers = 
+	dask = xarray.core.daskmanager:DaskManager
+
 [tool:pytest]
 python_files = test_*.py
 testpaths = xarray/tests properties
 filterwarnings = 
 	ignore:Using a non-tuple sequence for multidimensional indexing is deprecated:FutureWarning
 markers = 
 	flaky: flaky tests
```

### Comparing `xarray-2023.4.2/xarray/__init__.py` & `xarray-2023.5.0/xarray/__init__.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/__init__.py` & `xarray-2023.5.0/xarray/backends/__init__.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/api.py` & `xarray-2023.5.0/xarray/backends/api.py`

 * *Files 3% similar despite different names*

```diff
@@ -2,31 +2,42 @@
 
 import os
 from collections.abc import Hashable, Iterable, Mapping, MutableMapping, Sequence
 from functools import partial
 from glob import glob
 from io import BytesIO
 from numbers import Number
-from typing import TYPE_CHECKING, Any, Callable, Final, Literal, Union, cast, overload
+from typing import (
+    TYPE_CHECKING,
+    Any,
+    Callable,
+    Final,
+    Literal,
+    Union,
+    cast,
+    overload,
+)
 
 import numpy as np
 
 from xarray import backends, conventions
 from xarray.backends import plugins
 from xarray.backends.common import AbstractDataStore, ArrayWriter, _normalize_path
 from xarray.backends.locks import _get_scheduler
 from xarray.core import indexing
 from xarray.core.combine import (
     _infer_concat_order_from_positions,
     _nested_combine,
     combine_by_coords,
 )
+from xarray.core.daskmanager import DaskManager
 from xarray.core.dataarray import DataArray
 from xarray.core.dataset import Dataset, _get_chunk, _maybe_chunk
 from xarray.core.indexes import Index
+from xarray.core.parallelcompat import guess_chunkmanager
 from xarray.core.utils import is_remote_uri
 
 if TYPE_CHECKING:
     try:
         from dask.delayed import Delayed
     except ImportError:
         Delayed = None  # type: ignore
@@ -34,25 +45,25 @@
 
     from xarray.backends.common import BackendEntrypoint
     from xarray.core.types import (
         CombineAttrsOptions,
         CompatOptions,
         JoinOptions,
         NestedSequence,
+        T_Chunks,
     )
 
     T_NetcdfEngine = Literal["netcdf4", "scipy", "h5netcdf"]
     T_Engine = Union[
         T_NetcdfEngine,
         Literal["pydap", "pynio", "pseudonetcdf", "zarr"],
         type[BackendEntrypoint],
         str,  # no nice typing support for custom backends
         None,
     ]
-    T_Chunks = Union[int, dict[Any, Any], Literal["auto"], None]
     T_NetcdfTypes = Literal[
         "NETCDF4", "NETCDF4_CLASSIC", "NETCDF3_64BIT", "NETCDF3_CLASSIC"
     ]
 
 
 DATAARRAY_NAME = "__xarray_dataarray_name__"
 DATAARRAY_VARIABLE = "__xarray_dataarray_variable__"
@@ -293,45 +304,59 @@
 def _chunk_ds(
     backend_ds,
     filename_or_obj,
     engine,
     chunks,
     overwrite_encoded_chunks,
     inline_array,
+    chunked_array_type,
+    from_array_kwargs,
     **extra_tokens,
 ):
-    from dask.base import tokenize
+    chunkmanager = guess_chunkmanager(chunked_array_type)
 
-    mtime = _get_mtime(filename_or_obj)
-    token = tokenize(filename_or_obj, mtime, engine, chunks, **extra_tokens)
-    name_prefix = f"open_dataset-{token}"
+    # TODO refactor to move this dask-specific logic inside the DaskManager class
+    if isinstance(chunkmanager, DaskManager):
+        from dask.base import tokenize
+
+        mtime = _get_mtime(filename_or_obj)
+        token = tokenize(filename_or_obj, mtime, engine, chunks, **extra_tokens)
+        name_prefix = "open_dataset-"
+    else:
+        # not used
+        token = (None,)
+        name_prefix = None
 
     variables = {}
     for name, var in backend_ds.variables.items():
-        var_chunks = _get_chunk(var, chunks)
+        var_chunks = _get_chunk(var, chunks, chunkmanager)
         variables[name] = _maybe_chunk(
             name,
             var,
             var_chunks,
             overwrite_encoded_chunks=overwrite_encoded_chunks,
             name_prefix=name_prefix,
             token=token,
             inline_array=inline_array,
+            chunked_array_type=chunkmanager,
+            from_array_kwargs=from_array_kwargs.copy(),
         )
     return backend_ds._replace(variables)
 
 
 def _dataset_from_backend_dataset(
     backend_ds,
     filename_or_obj,
     engine,
     chunks,
     cache,
     overwrite_encoded_chunks,
     inline_array,
+    chunked_array_type,
+    from_array_kwargs,
     **extra_tokens,
 ):
     if not isinstance(chunks, (int, dict)) and chunks not in {None, "auto"}:
         raise ValueError(
             f"chunks must be an int, dict, 'auto', or None. Instead found {chunks}."
         )
 
@@ -342,14 +367,16 @@
         ds = _chunk_ds(
             backend_ds,
             filename_or_obj,
             engine,
             chunks,
             overwrite_encoded_chunks,
             inline_array,
+            chunked_array_type,
+            from_array_kwargs,
             **extra_tokens,
         )
 
     ds.set_close(backend_ds._close)
 
     # Ensure source filename always stored in dataset object
     if "source" not in ds.encoding and isinstance(filename_or_obj, (str, os.PathLike)):
@@ -369,14 +396,16 @@
     decode_times: bool | None = None,
     decode_timedelta: bool | None = None,
     use_cftime: bool | None = None,
     concat_characters: bool | None = None,
     decode_coords: Literal["coordinates", "all"] | bool | None = None,
     drop_variables: str | Iterable[str] | None = None,
     inline_array: bool = False,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
     backend_kwargs: dict[str, Any] | None = None,
     **kwargs,
 ) -> Dataset:
     """Open and decode a dataset from a file or file-like object.
 
     Parameters
     ----------
@@ -461,14 +490,23 @@
         inconsistent values.
     inline_array: bool, default: False
         How to include the array in the dask task graph.
         By default(``inline_array=False``) the array is included in a task by
         itself, and each chunk refers to that task by its key. With
         ``inline_array=True``, Dask will instead inline the array directly
         in the values of the task graph. See :py:func:`dask.array.from_array`.
+    chunked_array_type: str, optional
+        Which chunked array type to coerce this datasets' arrays to.
+        Defaults to 'dask' if installed, else whatever is registered via the `ChunkManagerEnetryPoint` system.
+        Experimental API that should not be relied upon.
+    from_array_kwargs: dict
+        Additional keyword arguments passed on to the `ChunkManagerEntrypoint.from_array` method used to create
+        chunked arrays, via whichever chunk manager is specified through the `chunked_array_type` kwarg.
+        For example if :py:func:`dask.array.Array` objects are used for chunking, additional kwargs will be passed
+        to :py:func:`dask.array.from_array`. Experimental API that should not be relied upon.
     backend_kwargs: dict
         Additional keyword arguments passed on to the engine open function,
         equivalent to `**kwargs`.
     **kwargs: dict
         Additional keyword arguments passed on to the engine open function.
         For example:
 
@@ -504,14 +542,17 @@
 
     if backend_kwargs is not None:
         kwargs.update(backend_kwargs)
 
     if engine is None:
         engine = plugins.guess_engine(filename_or_obj)
 
+    if from_array_kwargs is None:
+        from_array_kwargs = {}
+
     backend = plugins.get_backend(engine)
 
     decoders = _resolve_decoders_kwargs(
         decode_cf,
         open_backend_dataset_parameters=backend.open_dataset_parameters,
         mask_and_scale=mask_and_scale,
         decode_times=decode_times,
@@ -532,36 +573,40 @@
         backend_ds,
         filename_or_obj,
         engine,
         chunks,
         cache,
         overwrite_encoded_chunks,
         inline_array,
+        chunked_array_type,
+        from_array_kwargs,
         drop_variables=drop_variables,
         **decoders,
         **kwargs,
     )
     return ds
 
 
 def open_dataarray(
     filename_or_obj: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
     *,
-    engine: T_Engine = None,
-    chunks: T_Chunks = None,
+    engine: T_Engine | None = None,
+    chunks: T_Chunks | None = None,
     cache: bool | None = None,
     decode_cf: bool | None = None,
     mask_and_scale: bool | None = None,
     decode_times: bool | None = None,
     decode_timedelta: bool | None = None,
     use_cftime: bool | None = None,
     concat_characters: bool | None = None,
     decode_coords: Literal["coordinates", "all"] | bool | None = None,
     drop_variables: str | Iterable[str] | None = None,
     inline_array: bool = False,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
     backend_kwargs: dict[str, Any] | None = None,
     **kwargs,
 ) -> DataArray:
     """Open an DataArray from a file or file-like object containing a single
     data variable.
 
     This is designed to read netCDF files with only one data variable. If
@@ -648,14 +693,23 @@
         inconsistent values.
     inline_array: bool, default: False
         How to include the array in the dask task graph.
         By default(``inline_array=False``) the array is included in a task by
         itself, and each chunk refers to that task by its key. With
         ``inline_array=True``, Dask will instead inline the array directly
         in the values of the task graph. See :py:func:`dask.array.from_array`.
+    chunked_array_type: str, optional
+        Which chunked array type to coerce the underlying data array to.
+        Defaults to 'dask' if installed, else whatever is registered via the `ChunkManagerEnetryPoint` system.
+        Experimental API that should not be relied upon.
+    from_array_kwargs: dict
+        Additional keyword arguments passed on to the `ChunkManagerEntrypoint.from_array` method used to create
+        chunked arrays, via whichever chunk manager is specified through the `chunked_array_type` kwarg.
+        For example if :py:func:`dask.array.Array` objects are used for chunking, additional kwargs will be passed
+        to :py:func:`dask.array.from_array`. Experimental API that should not be relied upon.
     backend_kwargs: dict
         Additional keyword arguments passed on to the engine open function,
         equivalent to `**kwargs`.
     **kwargs: dict
         Additional keyword arguments passed on to the engine open function.
         For example:
 
@@ -691,14 +745,16 @@
         concat_characters=concat_characters,
         decode_coords=decode_coords,
         engine=engine,
         chunks=chunks,
         cache=cache,
         drop_variables=drop_variables,
         inline_array=inline_array,
+        chunked_array_type=chunked_array_type,
+        from_array_kwargs=from_array_kwargs,
         backend_kwargs=backend_kwargs,
         use_cftime=use_cftime,
         decode_timedelta=decode_timedelta,
         **kwargs,
     )
 
     if len(dataset.data_vars) != 1:
@@ -722,25 +778,25 @@
         data_array.name = None
 
     return data_array
 
 
 def open_mfdataset(
     paths: str | NestedSequence[str | os.PathLike],
-    chunks: T_Chunks = None,
+    chunks: T_Chunks | None = None,
     concat_dim: str
     | DataArray
     | Index
     | Sequence[str]
     | Sequence[DataArray]
     | Sequence[Index]
     | None = None,
     compat: CompatOptions = "no_conflicts",
     preprocess: Callable[[Dataset], Dataset] | None = None,
-    engine: T_Engine = None,
+    engine: T_Engine | None = None,
     data_vars: Literal["all", "minimal", "different"] | list[str] = "all",
     coords="different",
     combine: Literal["by_coords", "nested"] = "by_coords",
     parallel: bool = False,
     join: JoinOptions = "outer",
     attrs_file: str | os.PathLike | None = None,
     combine_attrs: CombineAttrsOptions = "override",
@@ -1486,14 +1542,15 @@
     compute: Literal[True] = True,
     consolidated: bool | None = None,
     append_dim: Hashable | None = None,
     region: Mapping[str, slice] | None = None,
     safe_chunks: bool = True,
     storage_options: dict[str, str] | None = None,
     zarr_version: int | None = None,
+    chunkmanager_store_kwargs: dict[str, Any] | None = None,
 ) -> backends.ZarrStore:
     ...
 
 
 # compute=False returns dask.Delayed
 @overload
 def to_zarr(
@@ -1508,14 +1565,15 @@
     compute: Literal[False],
     consolidated: bool | None = None,
     append_dim: Hashable | None = None,
     region: Mapping[str, slice] | None = None,
     safe_chunks: bool = True,
     storage_options: dict[str, str] | None = None,
     zarr_version: int | None = None,
+    chunkmanager_store_kwargs: dict[str, Any] | None = None,
 ) -> Delayed:
     ...
 
 
 def to_zarr(
     dataset: Dataset,
     store: MutableMapping | str | os.PathLike[str] | None = None,
@@ -1527,14 +1585,15 @@
     compute: bool = True,
     consolidated: bool | None = None,
     append_dim: Hashable | None = None,
     region: Mapping[str, slice] | None = None,
     safe_chunks: bool = True,
     storage_options: dict[str, str] | None = None,
     zarr_version: int | None = None,
+    chunkmanager_store_kwargs: dict[str, Any] | None = None,
 ) -> backends.ZarrStore | Delayed:
     """This function creates an appropriate datastore for writing a dataset to
     a zarr ztore
 
     See `Dataset.to_zarr` for full API docs.
     """
 
@@ -1648,15 +1707,17 @@
                     "which is not allowed in ``xarray.Dataset.to_zarr()`` with "
                     "mode='r+'. To allow writing new variables, set mode='a'."
                 )
 
     writer = ArrayWriter()
     # TODO: figure out how to properly handle unlimited_dims
     dump_to_store(dataset, zstore, writer, encoding=encoding)
-    writes = writer.sync(compute=compute)
+    writes = writer.sync(
+        compute=compute, chunkmanager_store_kwargs=chunkmanager_store_kwargs
+    )
 
     if compute:
         _finalize_store(writes, zstore)
     else:
         import dask
 
         return dask.delayed(_finalize_store)(writes, zstore)
```

### Comparing `xarray-2023.4.2/xarray/backends/common.py` & `xarray-2023.5.0/xarray/backends/common.py`

 * *Files 3% similar despite different names*

```diff
@@ -7,15 +7,16 @@
 from collections.abc import Iterable
 from typing import TYPE_CHECKING, Any, ClassVar
 
 import numpy as np
 
 from xarray.conventions import cf_encoder
 from xarray.core import indexing
-from xarray.core.pycompat import is_duck_dask_array
+from xarray.core.parallelcompat import get_chunked_array_type
+from xarray.core.pycompat import is_chunked_array
 from xarray.core.utils import FrozenDict, NdimSizeLenMixin, is_remote_uri
 
 if TYPE_CHECKING:
     from io import BufferedIOBase
 
     from xarray.core.dataset import Dataset
 
@@ -149,39 +150,43 @@
     def __init__(self, lock=None):
         self.sources = []
         self.targets = []
         self.regions = []
         self.lock = lock
 
     def add(self, source, target, region=None):
-        if is_duck_dask_array(source):
+        if is_chunked_array(source):
             self.sources.append(source)
             self.targets.append(target)
             self.regions.append(region)
         else:
             if region:
                 target[region] = source
             else:
                 target[...] = source
 
-    def sync(self, compute=True):
+    def sync(self, compute=True, chunkmanager_store_kwargs=None):
         if self.sources:
-            import dask.array as da
+            chunkmanager = get_chunked_array_type(*self.sources)
 
             # TODO: consider wrapping targets with dask.delayed, if this makes
             # for any discernible difference in perforance, e.g.,
             # targets = [dask.delayed(t) for t in self.targets]
 
-            delayed_store = da.store(
+            if chunkmanager_store_kwargs is None:
+                chunkmanager_store_kwargs = {}
+
+            delayed_store = chunkmanager.store(
                 self.sources,
                 self.targets,
                 lock=self.lock,
                 compute=compute,
                 flush=True,
                 regions=self.regions,
+                **chunkmanager_store_kwargs,
             )
             self.sources = []
             self.targets = []
             self.regions = []
             return delayed_store
```

### Comparing `xarray-2023.4.2/xarray/backends/file_manager.py` & `xarray-2023.5.0/xarray/backends/file_manager.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/h5netcdf_.py` & `xarray-2023.5.0/xarray/backends/h5netcdf_.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/locks.py` & `xarray-2023.5.0/xarray/backends/locks.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/lru_cache.py` & `xarray-2023.5.0/xarray/backends/lru_cache.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/memory.py` & `xarray-2023.5.0/xarray/backends/memory.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/netCDF4_.py` & `xarray-2023.5.0/xarray/backends/netCDF4_.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/netcdf3.py` & `xarray-2023.5.0/xarray/backends/netcdf3.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/plugins.py` & `xarray-2023.5.0/xarray/backends/plugins.py`

 * *Files 1% similar despite different names*

```diff
@@ -142,15 +142,15 @@
 def refresh_engines() -> None:
     """Refreshes the backend engines based on installed packages."""
     list_engines.cache_clear()
 
 
 def guess_engine(
     store_spec: str | os.PathLike[Any] | BufferedIOBase | AbstractDataStore,
-):
+) -> str | type[BackendEntrypoint]:
     engines = list_engines()
 
     for engine, backend in engines.items():
         try:
             if backend.guess_can_open(store_spec):
                 return engine
         except PermissionError:
```

### Comparing `xarray-2023.4.2/xarray/backends/pseudonetcdf_.py` & `xarray-2023.5.0/xarray/backends/pseudonetcdf_.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/pydap_.py` & `xarray-2023.5.0/xarray/backends/pydap_.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/pynio_.py` & `xarray-2023.5.0/xarray/backends/pynio_.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/scipy_.py` & `xarray-2023.5.0/xarray/backends/scipy_.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/store.py` & `xarray-2023.5.0/xarray/backends/store.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/backends/zarr.py` & `xarray-2023.5.0/xarray/backends/zarr.py`

 * *Files 2% similar despite different names*

```diff
@@ -15,14 +15,15 @@
     BackendArray,
     BackendEntrypoint,
     _encode_variable_name,
     _normalize_path,
 )
 from xarray.backends.store import StoreBackendEntrypoint
 from xarray.core import indexing
+from xarray.core.parallelcompat import guess_chunkmanager
 from xarray.core.pycompat import integer_types
 from xarray.core.utils import (
     FrozenDict,
     HiddenKeyDict,
     close_on_error,
 )
 from xarray.core.variable import Variable
@@ -712,14 +713,16 @@
     consolidated=None,
     overwrite_encoded_chunks=False,
     chunk_store=None,
     storage_options=None,
     decode_timedelta=None,
     use_cftime=None,
     zarr_version=None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
     **kwargs,
 ):
     """Load and decode a dataset from a Zarr store.
 
     The `store` object should be a valid store for a Zarr group. `store`
     variables must contain dimension metadata encoded in the
     `_ARRAY_DIMENSIONS` attribute or must have NCZarr format.
@@ -796,14 +799,23 @@
         represented using ``np.datetime64[ns]`` objects.  If False, always
         decode times to ``np.datetime64[ns]`` objects; if this is not possible
         raise an error.
     zarr_version : int or None, optional
         The desired zarr spec version to target (currently 2 or 3). The default
         of None will attempt to determine the zarr version from ``store`` when
         possible, otherwise defaulting to 2.
+    chunked_array_type: str, optional
+        Which chunked array type to coerce this datasets' arrays to.
+        Defaults to 'dask' if installed, else whatever is registered via the `ChunkManagerEnetryPoint` system.
+        Experimental API that should not be relied upon.
+    from_array_kwargs: dict, optional
+        Additional keyword arguments passed on to the `ChunkManagerEntrypoint.from_array` method used to create
+        chunked arrays, via whichever chunk manager is specified through the `chunked_array_type` kwarg.
+        Defaults to {'manager': 'dask'}, meaning additional kwargs will be passed eventually to
+        :py:func:`dask.array.from_array`. Experimental API that should not be relied upon.
 
     Returns
     -------
     dataset : Dataset
         The newly created dataset.
 
     See Also
@@ -813,20 +825,25 @@
 
     References
     ----------
     http://zarr.readthedocs.io/
     """
     from xarray.backends.api import open_dataset
 
+    if from_array_kwargs is None:
+        from_array_kwargs = {}
+
     if chunks == "auto":
         try:
-            import dask.array  # noqa
+            guess_chunkmanager(
+                chunked_array_type
+            )  # attempt to import that parallel backend
 
             chunks = {}
-        except ImportError:
+        except ValueError:
             chunks = None
 
     if kwargs:
         raise TypeError(
             "open_zarr() got unexpected keyword arguments " + ",".join(kwargs.keys())
         )
 
@@ -847,14 +864,16 @@
         mask_and_scale=mask_and_scale,
         decode_times=decode_times,
         concat_characters=concat_characters,
         decode_coords=decode_coords,
         engine="zarr",
         chunks=chunks,
         drop_variables=drop_variables,
+        chunked_array_type=chunked_array_type,
+        from_array_kwargs=from_array_kwargs,
         backend_kwargs=backend_kwargs,
         decode_timedelta=decode_timedelta,
         use_cftime=use_cftime,
         zarr_version=zarr_version,
     )
     return ds
```

### Comparing `xarray-2023.4.2/xarray/coding/calendar_ops.py` & `xarray-2023.5.0/xarray/coding/calendar_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/coding/cftime_offsets.py` & `xarray-2023.5.0/xarray/coding/cftime_offsets.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/coding/cftimeindex.py` & `xarray-2023.5.0/xarray/coding/cftimeindex.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/coding/frequencies.py` & `xarray-2023.5.0/xarray/coding/frequencies.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/coding/strings.py` & `xarray-2023.5.0/xarray/coding/strings.py`

 * *Files 6% similar despite different names*

```diff
@@ -10,15 +10,15 @@
     lazy_elemwise_func,
     pop_to,
     safe_setitem,
     unpack_for_decoding,
     unpack_for_encoding,
 )
 from xarray.core import indexing
-from xarray.core.pycompat import is_duck_dask_array
+from xarray.core.parallelcompat import get_chunked_array_type, is_chunked_array
 from xarray.core.variable import Variable
 
 
 def create_vlen_dtype(element_type):
     if element_type not in (str, bytes):
         raise TypeError(f"unsupported type for vlen_dtype: {element_type!r}")
     # based on h5py.special_dtype
@@ -130,18 +130,18 @@
 
 
 def bytes_to_char(arr):
     """Convert numpy/dask arrays from fixed width bytes to characters."""
     if arr.dtype.kind != "S":
         raise ValueError("argument must have a fixed-width bytes dtype")
 
-    if is_duck_dask_array(arr):
-        import dask.array as da
+    if is_chunked_array(arr):
+        chunkmanager = get_chunked_array_type(arr)
 
-        return da.map_blocks(
+        return chunkmanager.map_blocks(
             _numpy_bytes_to_char,
             arr,
             dtype="S1",
             chunks=arr.chunks + ((arr.dtype.itemsize,)),
             new_axis=[arr.ndim],
         )
     return _numpy_bytes_to_char(arr)
@@ -165,25 +165,25 @@
 
     size = arr.shape[-1]
 
     if not size:
         # can't make an S0 dtype
         return np.zeros(arr.shape[:-1], dtype=np.string_)
 
-    if is_duck_dask_array(arr):
-        import dask.array as da
+    if is_chunked_array(arr):
+        chunkmanager = get_chunked_array_type(arr)
 
         if len(arr.chunks[-1]) > 1:
             raise ValueError(
                 "cannot stacked dask character array with "
                 "multiple chunks in the last dimension: {}".format(arr)
             )
 
         dtype = np.dtype("S" + str(arr.shape[-1]))
-        return da.map_blocks(
+        return chunkmanager.map_blocks(
             _numpy_char_to_bytes,
             arr,
             dtype=dtype,
             chunks=arr.chunks[:-1],
             drop_axis=[arr.ndim - 1],
         )
     else:
```

### Comparing `xarray-2023.4.2/xarray/coding/times.py` & `xarray-2023.5.0/xarray/coding/times.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/coding/variables.py` & `xarray-2023.5.0/xarray/coding/variables.py`

 * *Files 2% similar despite different names*

```diff
@@ -6,15 +6,16 @@
 from functools import partial
 from typing import TYPE_CHECKING, Any, Callable, Union
 
 import numpy as np
 import pandas as pd
 
 from xarray.core import dtypes, duck_array_ops, indexing
-from xarray.core.pycompat import is_duck_dask_array
+from xarray.core.parallelcompat import get_chunked_array_type
+from xarray.core.pycompat import is_chunked_array
 from xarray.core.variable import Variable
 
 if TYPE_CHECKING:
     T_VarTuple = tuple[tuple[Hashable, ...], Any, dict, dict]
     T_Name = Union[Hashable, None]
 
 
@@ -53,15 +54,15 @@
 
     Do not construct this object directly: call lazy_elemwise_func instead.
 
     Values are computed upon indexing or coercion to a NumPy array.
     """
 
     def __init__(self, array, func: Callable, dtype: np.typing.DTypeLike):
-        assert not is_duck_dask_array(array)
+        assert not is_chunked_array(array)
         self.array = indexing.as_indexable(array)
         self.func = func
         self._dtype = dtype
 
     @property
     def dtype(self) -> np.dtype:
         return np.dtype(self._dtype)
@@ -154,18 +155,18 @@
     dtype : coercible to np.dtype
         Dtype for the result of this function.
 
     Returns
     -------
     Either a dask.array.Array or _ElementwiseFunctionArray.
     """
-    if is_duck_dask_array(array):
-        import dask.array as da
+    if is_chunked_array(array):
+        chunkmanager = get_chunked_array_type(array)
 
-        return da.map_blocks(func, array, dtype=dtype)
+        return chunkmanager.map_blocks(func, array, dtype=dtype)
     else:
         return _ElementwiseFunctionArray(array, func, dtype)
 
 
 def unpack_for_encoding(var: Variable) -> T_VarTuple:
     return var.dims, var.data, var.attrs.copy(), var.encoding.copy()
 
@@ -326,15 +327,15 @@
     """
 
     def encode(self, variable: Variable, name: T_Name = None) -> Variable:
         dims, data, attrs, encoding = unpack_for_encoding(variable)
 
         if "scale_factor" in encoding or "add_offset" in encoding:
             dtype = _choose_float_dtype(data.dtype, "add_offset" in encoding)
-            data = data.astype(dtype=dtype, copy=True)
+            data = duck_array_ops.astype(data, dtype=dtype, copy=True)
         if "add_offset" in encoding:
             data -= pop_to(encoding, attrs, "add_offset", name=name)
         if "scale_factor" in encoding:
             data /= pop_to(encoding, attrs, "scale_factor", name=name)
 
         return Variable(dims, data, attrs, encoding, fastpath=True)
 
@@ -373,15 +374,15 @@
             dims, data, attrs, encoding = unpack_for_encoding(variable)
 
             pop_to(encoding, attrs, "_Unsigned")
             signed_dtype = np.dtype(f"i{data.dtype.itemsize}")
             if "_FillValue" in attrs:
                 new_fill = signed_dtype.type(attrs["_FillValue"])
                 attrs["_FillValue"] = new_fill
-            data = duck_array_ops.around(data).astype(signed_dtype)
+            data = duck_array_ops.astype(duck_array_ops.around(data), signed_dtype)
 
             return Variable(dims, data, attrs, encoding, fastpath=True)
         else:
             return variable
 
     def decode(self, variable: Variable, name: T_Name = None) -> Variable:
         if "_Unsigned" in variable.attrs:
```

### Comparing `xarray-2023.4.2/xarray/conventions.py` & `xarray-2023.5.0/xarray/conventions.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/convert.py` & `xarray-2023.5.0/xarray/convert.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/_aggregations.py` & `xarray-2023.5.0/xarray/core/_aggregations.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/_typed_ops.py` & `xarray-2023.5.0/xarray/core/_typed_ops.py`

 * *Files 4% similar despite different names*

```diff
@@ -38,14 +38,20 @@
 
     def __xor__(self, other):
         return self._binary_op(other, operator.xor)
 
     def __or__(self, other):
         return self._binary_op(other, operator.or_)
 
+    def __lshift__(self, other):
+        return self._binary_op(other, operator.lshift)
+
+    def __rshift__(self, other):
+        return self._binary_op(other, operator.rshift)
+
     def __lt__(self, other):
         return self._binary_op(other, operator.lt)
 
     def __le__(self, other):
         return self._binary_op(other, operator.le)
 
     def __gt__(self, other):
@@ -119,14 +125,20 @@
 
     def __ixor__(self, other):
         return self._inplace_binary_op(other, operator.ixor)
 
     def __ior__(self, other):
         return self._inplace_binary_op(other, operator.ior)
 
+    def __ilshift__(self, other):
+        return self._inplace_binary_op(other, operator.ilshift)
+
+    def __irshift__(self, other):
+        return self._inplace_binary_op(other, operator.irshift)
+
     def _unary_op(self, f, *args, **kwargs):
         raise NotImplementedError
 
     def __neg__(self):
         return self._unary_op(operator.neg)
 
     def __pos__(self):
@@ -156,14 +168,16 @@
     __pow__.__doc__ = operator.pow.__doc__
     __truediv__.__doc__ = operator.truediv.__doc__
     __floordiv__.__doc__ = operator.floordiv.__doc__
     __mod__.__doc__ = operator.mod.__doc__
     __and__.__doc__ = operator.and_.__doc__
     __xor__.__doc__ = operator.xor.__doc__
     __or__.__doc__ = operator.or_.__doc__
+    __lshift__.__doc__ = operator.lshift.__doc__
+    __rshift__.__doc__ = operator.rshift.__doc__
     __lt__.__doc__ = operator.lt.__doc__
     __le__.__doc__ = operator.le.__doc__
     __gt__.__doc__ = operator.gt.__doc__
     __ge__.__doc__ = operator.ge.__doc__
     __eq__.__doc__ = nputils.array_eq.__doc__
     __ne__.__doc__ = nputils.array_ne.__doc__
     __radd__.__doc__ = operator.add.__doc__
@@ -182,14 +196,16 @@
     __ipow__.__doc__ = operator.ipow.__doc__
     __itruediv__.__doc__ = operator.itruediv.__doc__
     __ifloordiv__.__doc__ = operator.ifloordiv.__doc__
     __imod__.__doc__ = operator.imod.__doc__
     __iand__.__doc__ = operator.iand.__doc__
     __ixor__.__doc__ = operator.ixor.__doc__
     __ior__.__doc__ = operator.ior.__doc__
+    __ilshift__.__doc__ = operator.ilshift.__doc__
+    __irshift__.__doc__ = operator.irshift.__doc__
     __neg__.__doc__ = operator.neg.__doc__
     __pos__.__doc__ = operator.pos.__doc__
     __abs__.__doc__ = operator.abs.__doc__
     __invert__.__doc__ = operator.invert.__doc__
     round.__doc__ = ops.round_.__doc__
     argsort.__doc__ = ops.argsort.__doc__
     conj.__doc__ = ops.conj.__doc__
@@ -228,14 +244,20 @@
 
     def __xor__(self, other):
         return self._binary_op(other, operator.xor)
 
     def __or__(self, other):
         return self._binary_op(other, operator.or_)
 
+    def __lshift__(self, other):
+        return self._binary_op(other, operator.lshift)
+
+    def __rshift__(self, other):
+        return self._binary_op(other, operator.rshift)
+
     def __lt__(self, other):
         return self._binary_op(other, operator.lt)
 
     def __le__(self, other):
         return self._binary_op(other, operator.le)
 
     def __gt__(self, other):
@@ -309,14 +331,20 @@
 
     def __ixor__(self, other):
         return self._inplace_binary_op(other, operator.ixor)
 
     def __ior__(self, other):
         return self._inplace_binary_op(other, operator.ior)
 
+    def __ilshift__(self, other):
+        return self._inplace_binary_op(other, operator.ilshift)
+
+    def __irshift__(self, other):
+        return self._inplace_binary_op(other, operator.irshift)
+
     def _unary_op(self, f, *args, **kwargs):
         raise NotImplementedError
 
     def __neg__(self):
         return self._unary_op(operator.neg)
 
     def __pos__(self):
@@ -346,14 +374,16 @@
     __pow__.__doc__ = operator.pow.__doc__
     __truediv__.__doc__ = operator.truediv.__doc__
     __floordiv__.__doc__ = operator.floordiv.__doc__
     __mod__.__doc__ = operator.mod.__doc__
     __and__.__doc__ = operator.and_.__doc__
     __xor__.__doc__ = operator.xor.__doc__
     __or__.__doc__ = operator.or_.__doc__
+    __lshift__.__doc__ = operator.lshift.__doc__
+    __rshift__.__doc__ = operator.rshift.__doc__
     __lt__.__doc__ = operator.lt.__doc__
     __le__.__doc__ = operator.le.__doc__
     __gt__.__doc__ = operator.gt.__doc__
     __ge__.__doc__ = operator.ge.__doc__
     __eq__.__doc__ = nputils.array_eq.__doc__
     __ne__.__doc__ = nputils.array_ne.__doc__
     __radd__.__doc__ = operator.add.__doc__
@@ -372,14 +402,16 @@
     __ipow__.__doc__ = operator.ipow.__doc__
     __itruediv__.__doc__ = operator.itruediv.__doc__
     __ifloordiv__.__doc__ = operator.ifloordiv.__doc__
     __imod__.__doc__ = operator.imod.__doc__
     __iand__.__doc__ = operator.iand.__doc__
     __ixor__.__doc__ = operator.ixor.__doc__
     __ior__.__doc__ = operator.ior.__doc__
+    __ilshift__.__doc__ = operator.ilshift.__doc__
+    __irshift__.__doc__ = operator.irshift.__doc__
     __neg__.__doc__ = operator.neg.__doc__
     __pos__.__doc__ = operator.pos.__doc__
     __abs__.__doc__ = operator.abs.__doc__
     __invert__.__doc__ = operator.invert.__doc__
     round.__doc__ = ops.round_.__doc__
     argsort.__doc__ = ops.argsort.__doc__
     conj.__doc__ = ops.conj.__doc__
@@ -418,14 +450,20 @@
 
     def __xor__(self, other):
         return self._binary_op(other, operator.xor)
 
     def __or__(self, other):
         return self._binary_op(other, operator.or_)
 
+    def __lshift__(self, other):
+        return self._binary_op(other, operator.lshift)
+
+    def __rshift__(self, other):
+        return self._binary_op(other, operator.rshift)
+
     def __lt__(self, other):
         return self._binary_op(other, operator.lt)
 
     def __le__(self, other):
         return self._binary_op(other, operator.le)
 
     def __gt__(self, other):
@@ -499,14 +537,20 @@
 
     def __ixor__(self, other):
         return self._inplace_binary_op(other, operator.ixor)
 
     def __ior__(self, other):
         return self._inplace_binary_op(other, operator.ior)
 
+    def __ilshift__(self, other):
+        return self._inplace_binary_op(other, operator.ilshift)
+
+    def __irshift__(self, other):
+        return self._inplace_binary_op(other, operator.irshift)
+
     def _unary_op(self, f, *args, **kwargs):
         raise NotImplementedError
 
     def __neg__(self):
         return self._unary_op(operator.neg)
 
     def __pos__(self):
@@ -536,14 +580,16 @@
     __pow__.__doc__ = operator.pow.__doc__
     __truediv__.__doc__ = operator.truediv.__doc__
     __floordiv__.__doc__ = operator.floordiv.__doc__
     __mod__.__doc__ = operator.mod.__doc__
     __and__.__doc__ = operator.and_.__doc__
     __xor__.__doc__ = operator.xor.__doc__
     __or__.__doc__ = operator.or_.__doc__
+    __lshift__.__doc__ = operator.lshift.__doc__
+    __rshift__.__doc__ = operator.rshift.__doc__
     __lt__.__doc__ = operator.lt.__doc__
     __le__.__doc__ = operator.le.__doc__
     __gt__.__doc__ = operator.gt.__doc__
     __ge__.__doc__ = operator.ge.__doc__
     __eq__.__doc__ = nputils.array_eq.__doc__
     __ne__.__doc__ = nputils.array_ne.__doc__
     __radd__.__doc__ = operator.add.__doc__
@@ -562,14 +608,16 @@
     __ipow__.__doc__ = operator.ipow.__doc__
     __itruediv__.__doc__ = operator.itruediv.__doc__
     __ifloordiv__.__doc__ = operator.ifloordiv.__doc__
     __imod__.__doc__ = operator.imod.__doc__
     __iand__.__doc__ = operator.iand.__doc__
     __ixor__.__doc__ = operator.ixor.__doc__
     __ior__.__doc__ = operator.ior.__doc__
+    __ilshift__.__doc__ = operator.ilshift.__doc__
+    __irshift__.__doc__ = operator.irshift.__doc__
     __neg__.__doc__ = operator.neg.__doc__
     __pos__.__doc__ = operator.pos.__doc__
     __abs__.__doc__ = operator.abs.__doc__
     __invert__.__doc__ = operator.invert.__doc__
     round.__doc__ = ops.round_.__doc__
     argsort.__doc__ = ops.argsort.__doc__
     conj.__doc__ = ops.conj.__doc__
@@ -608,14 +656,20 @@
 
     def __xor__(self, other):
         return self._binary_op(other, operator.xor)
 
     def __or__(self, other):
         return self._binary_op(other, operator.or_)
 
+    def __lshift__(self, other):
+        return self._binary_op(other, operator.lshift)
+
+    def __rshift__(self, other):
+        return self._binary_op(other, operator.rshift)
+
     def __lt__(self, other):
         return self._binary_op(other, operator.lt)
 
     def __le__(self, other):
         return self._binary_op(other, operator.le)
 
     def __gt__(self, other):
@@ -666,14 +720,16 @@
     __pow__.__doc__ = operator.pow.__doc__
     __truediv__.__doc__ = operator.truediv.__doc__
     __floordiv__.__doc__ = operator.floordiv.__doc__
     __mod__.__doc__ = operator.mod.__doc__
     __and__.__doc__ = operator.and_.__doc__
     __xor__.__doc__ = operator.xor.__doc__
     __or__.__doc__ = operator.or_.__doc__
+    __lshift__.__doc__ = operator.lshift.__doc__
+    __rshift__.__doc__ = operator.rshift.__doc__
     __lt__.__doc__ = operator.lt.__doc__
     __le__.__doc__ = operator.le.__doc__
     __gt__.__doc__ = operator.gt.__doc__
     __ge__.__doc__ = operator.ge.__doc__
     __eq__.__doc__ = nputils.array_eq.__doc__
     __ne__.__doc__ = nputils.array_ne.__doc__
     __radd__.__doc__ = operator.add.__doc__
@@ -720,14 +776,20 @@
 
     def __xor__(self, other):
         return self._binary_op(other, operator.xor)
 
     def __or__(self, other):
         return self._binary_op(other, operator.or_)
 
+    def __lshift__(self, other):
+        return self._binary_op(other, operator.lshift)
+
+    def __rshift__(self, other):
+        return self._binary_op(other, operator.rshift)
+
     def __lt__(self, other):
         return self._binary_op(other, operator.lt)
 
     def __le__(self, other):
         return self._binary_op(other, operator.le)
 
     def __gt__(self, other):
@@ -778,14 +840,16 @@
     __pow__.__doc__ = operator.pow.__doc__
     __truediv__.__doc__ = operator.truediv.__doc__
     __floordiv__.__doc__ = operator.floordiv.__doc__
     __mod__.__doc__ = operator.mod.__doc__
     __and__.__doc__ = operator.and_.__doc__
     __xor__.__doc__ = operator.xor.__doc__
     __or__.__doc__ = operator.or_.__doc__
+    __lshift__.__doc__ = operator.lshift.__doc__
+    __rshift__.__doc__ = operator.rshift.__doc__
     __lt__.__doc__ = operator.lt.__doc__
     __le__.__doc__ = operator.le.__doc__
     __gt__.__doc__ = operator.gt.__doc__
     __ge__.__doc__ = operator.ge.__doc__
     __eq__.__doc__ = nputils.array_eq.__doc__
     __ne__.__doc__ = nputils.array_ne.__doc__
     __radd__.__doc__ = operator.add.__doc__
```

### Comparing `xarray-2023.4.2/xarray/core/_typed_ops.pyi` & `xarray-2023.5.0/xarray/core/_typed_ops.pyi`

 * *Files 1% similar despite different names*

```diff
@@ -40,14 +40,16 @@
     def __pow__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __truediv__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __floordiv__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __mod__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __and__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __xor__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __or__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
+    def __lshift__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
+    def __rshift__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __lt__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __le__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __gt__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __ge__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
     def __eq__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...  # type: ignore[override]
     def __ne__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...  # type: ignore[override]
     def __radd__(self: T_Dataset, other: DsCompatible) -> T_Dataset: ...
@@ -131,14 +133,26 @@
     @overload
     def __or__(self, other: T_Dataset) -> T_Dataset: ...
     @overload
     def __or__(self, other: "DatasetGroupBy") -> "Dataset": ...
     @overload
     def __or__(self: T_DataArray, other: DaCompatible) -> T_DataArray: ...
     @overload
+    def __lshift__(self, other: T_Dataset) -> T_Dataset: ...
+    @overload
+    def __lshift__(self, other: "DatasetGroupBy") -> "Dataset": ...
+    @overload
+    def __lshift__(self: T_DataArray, other: DaCompatible) -> T_DataArray: ...
+    @overload
+    def __rshift__(self, other: T_Dataset) -> T_Dataset: ...
+    @overload
+    def __rshift__(self, other: "DatasetGroupBy") -> "Dataset": ...
+    @overload
+    def __rshift__(self: T_DataArray, other: DaCompatible) -> T_DataArray: ...
+    @overload
     def __lt__(self, other: T_Dataset) -> T_Dataset: ...
     @overload
     def __lt__(self, other: "DatasetGroupBy") -> "Dataset": ...
     @overload
     def __lt__(self: T_DataArray, other: DaCompatible) -> T_DataArray: ...
     @overload
     def __le__(self, other: T_Dataset) -> T_Dataset: ...
@@ -301,14 +315,26 @@
     @overload
     def __or__(self, other: T_Dataset) -> T_Dataset: ...
     @overload
     def __or__(self, other: T_DataArray) -> T_DataArray: ...
     @overload
     def __or__(self: T_Variable, other: VarCompatible) -> T_Variable: ...
     @overload
+    def __lshift__(self, other: T_Dataset) -> T_Dataset: ...
+    @overload
+    def __lshift__(self, other: T_DataArray) -> T_DataArray: ...
+    @overload
+    def __lshift__(self: T_Variable, other: VarCompatible) -> T_Variable: ...
+    @overload
+    def __rshift__(self, other: T_Dataset) -> T_Dataset: ...
+    @overload
+    def __rshift__(self, other: T_DataArray) -> T_DataArray: ...
+    @overload
+    def __rshift__(self: T_Variable, other: VarCompatible) -> T_Variable: ...
+    @overload
     def __lt__(self, other: T_Dataset) -> T_Dataset: ...
     @overload
     def __lt__(self, other: T_DataArray) -> T_DataArray: ...
     @overload
     def __lt__(self: T_Variable, other: VarCompatible) -> T_Variable: ...
     @overload
     def __le__(self, other: T_Dataset) -> T_Dataset: ...
@@ -471,14 +497,26 @@
     @overload
     def __or__(self, other: T_Dataset) -> T_Dataset: ...
     @overload
     def __or__(self, other: "DataArray") -> "Dataset": ...
     @overload
     def __or__(self, other: GroupByIncompatible) -> NoReturn: ...
     @overload
+    def __lshift__(self, other: T_Dataset) -> T_Dataset: ...
+    @overload
+    def __lshift__(self, other: "DataArray") -> "Dataset": ...
+    @overload
+    def __lshift__(self, other: GroupByIncompatible) -> NoReturn: ...
+    @overload
+    def __rshift__(self, other: T_Dataset) -> T_Dataset: ...
+    @overload
+    def __rshift__(self, other: "DataArray") -> "Dataset": ...
+    @overload
+    def __rshift__(self, other: GroupByIncompatible) -> NoReturn: ...
+    @overload
     def __lt__(self, other: T_Dataset) -> T_Dataset: ...
     @overload
     def __lt__(self, other: "DataArray") -> "Dataset": ...
     @overload
     def __lt__(self, other: GroupByIncompatible) -> NoReturn: ...
     @overload
     def __le__(self, other: T_Dataset) -> T_Dataset: ...
@@ -631,14 +669,26 @@
     @overload
     def __or__(self, other: T_Dataset) -> T_Dataset: ...
     @overload
     def __or__(self, other: T_DataArray) -> T_DataArray: ...
     @overload
     def __or__(self, other: GroupByIncompatible) -> NoReturn: ...
     @overload
+    def __lshift__(self, other: T_Dataset) -> T_Dataset: ...
+    @overload
+    def __lshift__(self, other: T_DataArray) -> T_DataArray: ...
+    @overload
+    def __lshift__(self, other: GroupByIncompatible) -> NoReturn: ...
+    @overload
+    def __rshift__(self, other: T_Dataset) -> T_Dataset: ...
+    @overload
+    def __rshift__(self, other: T_DataArray) -> T_DataArray: ...
+    @overload
+    def __rshift__(self, other: GroupByIncompatible) -> NoReturn: ...
+    @overload
     def __lt__(self, other: T_Dataset) -> T_Dataset: ...
     @overload
     def __lt__(self, other: T_DataArray) -> T_DataArray: ...
     @overload
     def __lt__(self, other: GroupByIncompatible) -> NoReturn: ...
     @overload
     def __le__(self, other: T_Dataset) -> T_Dataset: ...
```

### Comparing `xarray-2023.4.2/xarray/core/accessor_dt.py` & `xarray-2023.5.0/xarray/core/accessor_dt.py`

 * *Files 2% similar despite different names*

```diff
@@ -10,14 +10,15 @@
 from xarray.core.common import (
     _contains_datetime_like_objects,
     is_np_datetime_like,
     is_np_timedelta_like,
 )
 from xarray.core.pycompat import is_duck_dask_array
 from xarray.core.types import T_DataArray
+from xarray.core.variable import IndexVariable
 
 if TYPE_CHECKING:
     from numpy.typing import DTypeLike
 
     from xarray.core.dataarray import DataArray
     from xarray.core.dataset import Dataset
     from xarray.core.types import CFCalendar
@@ -44,15 +45,18 @@
 
 def _access_through_cftimeindex(values, name):
     """Coerce an array of datetime-like values to a CFTimeIndex
     and access requested datetime component
     """
     from xarray.coding.cftimeindex import CFTimeIndex
 
-    values_as_cftimeindex = CFTimeIndex(values.ravel())
+    if not isinstance(values, CFTimeIndex):
+        values_as_cftimeindex = CFTimeIndex(values.ravel())
+    else:
+        values_as_cftimeindex = values
     if name == "season":
         months = values_as_cftimeindex.month
         field_values = _season_from_months(months)
     elif name == "date":
         raise AttributeError(
             "'CFTimeIndex' object has no attribute `date`. Consider using the floor method instead, for instance: `.time.dt.floor('D')`."
         )
@@ -111,15 +115,15 @@
             chunks = (3,) + values.chunksize
             new_axis = 0
 
         return map_blocks(
             access_method, values, name, dtype=dtype, new_axis=new_axis, chunks=chunks
         )
     else:
-        return access_method(values, name).astype(dtype)
+        return access_method(values, name).astype(dtype, copy=False)
 
 
 def _round_through_series_or_index(values, name, freq):
     """Coerce an array of datetime-like values to a pandas Series or xarray
     CFTimeIndex and apply requested rounding
     """
     from xarray.coding.cftimeindex import CFTimeIndex
@@ -196,31 +200,38 @@
         from dask.array import map_blocks
 
         return map_blocks(access_method, values, date_format)
     else:
         return access_method(values, date_format)
 
 
+def _index_or_data(obj):
+    if isinstance(obj.variable, IndexVariable):
+        return obj.to_index()
+    else:
+        return obj.data
+
+
 class TimeAccessor(Generic[T_DataArray]):
     __slots__ = ("_obj",)
 
     def __init__(self, obj: T_DataArray) -> None:
         self._obj = obj
 
     def _date_field(self, name: str, dtype: DTypeLike) -> T_DataArray:
         if dtype is None:
             dtype = self._obj.dtype
-        obj_type = type(self._obj)
-        result = _get_date_field(self._obj.data, name, dtype)
-        return obj_type(result, name=name, coords=self._obj.coords, dims=self._obj.dims)
+        result = _get_date_field(_index_or_data(self._obj), name, dtype)
+        newvar = self._obj.variable.copy(data=result, deep=False)
+        return self._obj._replace(newvar, name=name)
 
     def _tslib_round_accessor(self, name: str, freq: str) -> T_DataArray:
-        obj_type = type(self._obj)
-        result = _round_field(self._obj.data, name, freq)
-        return obj_type(result, name=name, coords=self._obj.coords, dims=self._obj.dims)
+        result = _round_field(_index_or_data(self._obj), name, freq)
+        newvar = self._obj.variable.copy(data=result, deep=False)
+        return self._obj._replace(newvar, name=name)
 
     def floor(self, freq: str) -> T_DataArray:
         """
         Round timestamps downward to specified frequency resolution.
 
         Parameters
         ----------
```

### Comparing `xarray-2023.4.2/xarray/core/accessor_str.py` & `xarray-2023.5.0/xarray/core/accessor_str.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/alignment.py` & `xarray-2023.5.0/xarray/core/alignment.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/arithmetic.py` & `xarray-2023.5.0/xarray/core/arithmetic.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/combine.py` & `xarray-2023.5.0/xarray/core/combine.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/common.py` & `xarray-2023.5.0/xarray/core/common.py`

 * *Files 11% similar despite different names*

```diff
@@ -9,16 +9,17 @@
 
 import numpy as np
 import pandas as pd
 
 from xarray.core import dtypes, duck_array_ops, formatting, formatting_html, ops
 from xarray.core.indexing import BasicIndexer, ExplicitlyIndexed
 from xarray.core.options import OPTIONS, _get_keep_attrs
+from xarray.core.parallelcompat import get_chunked_array_type, guess_chunkmanager
 from xarray.core.pdcompat import _convert_base_to_offset
-from xarray.core.pycompat import is_duck_dask_array
+from xarray.core.pycompat import is_chunked_array
 from xarray.core.utils import (
     Frozen,
     either_dict_or_kwargs,
     emit_user_level_warning,
     is_scalar,
 )
 
@@ -42,14 +43,15 @@
     from xarray.core.resample import Resample
     from xarray.core.rolling_exp import RollingExp
     from xarray.core.types import (
         DatetimeLike,
         DTypeLikeSave,
         ScalarOrArray,
         SideOptions,
+        T_Chunks,
         T_DataWithCoords,
         T_Variable,
     )
     from xarray.core.variable import Variable
 
     DTypeMaybeMapping = Union[DTypeLikeSave, Mapping[Any, DTypeLikeSave]]
 
@@ -155,15 +157,15 @@
 
     def __int__(self: Any) -> int:
         return int(self.values)
 
     def __complex__(self: Any) -> complex:
         return complex(self.values)
 
-    def __array__(self: Any, dtype: DTypeLike = None) -> np.ndarray:
+    def __array__(self: Any, dtype: DTypeLike | None = None) -> np.ndarray:
         return np.asarray(self.values, dtype=dtype)
 
     def __repr__(self) -> str:
         return formatting.array_repr(self)
 
     def _repr_html_(self):
         if OPTIONS["display_style"] == "text":
@@ -945,15 +947,15 @@
         References
         ----------
         .. [1] https://pandas.pydata.org/docs/user_guide/timeseries.html#dateoffset-objects
         """
         # TODO support non-string indexer after removing the old API.
 
         from xarray.core.dataarray import DataArray
-        from xarray.core.groupby import TimeResampleGrouper
+        from xarray.core.groupby import ResolvedTimeResampleGrouper, TimeResampleGrouper
         from xarray.core.resample import RESAMPLE_DIM
 
         if keep_attrs is not None:
             warnings.warn(
                 "Passing ``keep_attrs`` to ``resample`` has no effect and will raise an"
                 " error in xarray 0.20. Pass ``keep_attrs`` directly to the applied"
                 " function, e.g. ``resample(...).mean(keep_attrs=True)``."
@@ -1008,19 +1010,21 @@
             offset=offset,
             loffset=loffset,
         )
 
         group = DataArray(
             dim_coord, coords=dim_coord.coords, dims=dim_coord.dims, name=RESAMPLE_DIM
         )
+
+        rgrouper = ResolvedTimeResampleGrouper(grouper, group, self)
+
         return resample_cls(
             self,
-            group=group,
+            (rgrouper,),
             dim=dim_name,
-            grouper=grouper,
             resample_dim=RESAMPLE_DIM,
             restore_coord_dims=restore_coord_dims,
         )
 
     def where(
         self: T_DataWithCoords, cond: Any, other: Any = dtypes.NA, drop: bool = False
     ) -> T_DataWithCoords:
@@ -1390,67 +1394,114 @@
     def __getitem__(self, value):
         # implementations of this class should implement this method
         raise NotImplementedError()
 
 
 @overload
 def full_like(
-    other: DataArray, fill_value: Any, dtype: DTypeLikeSave = None
+    other: DataArray,
+    fill_value: Any,
+    dtype: DTypeLikeSave | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> DataArray:
     ...
 
 
 @overload
 def full_like(
-    other: Dataset, fill_value: Any, dtype: DTypeMaybeMapping = None
+    other: Dataset,
+    fill_value: Any,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset:
     ...
 
 
 @overload
 def full_like(
-    other: Variable, fill_value: Any, dtype: DTypeLikeSave = None
+    other: Variable,
+    fill_value: Any,
+    dtype: DTypeLikeSave | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Variable:
     ...
 
 
 @overload
 def full_like(
-    other: Dataset | DataArray, fill_value: Any, dtype: DTypeMaybeMapping = None
+    other: Dataset | DataArray,
+    fill_value: Any,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = {},
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray:
     ...
 
 
 @overload
 def full_like(
     other: Dataset | DataArray | Variable,
     fill_value: Any,
-    dtype: DTypeMaybeMapping = None,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray | Variable:
     ...
 
 
 def full_like(
     other: Dataset | DataArray | Variable,
     fill_value: Any,
-    dtype: DTypeMaybeMapping = None,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray | Variable:
-    """Return a new object with the same shape and type as a given object.
+    """
+    Return a new object with the same shape and type as a given object.
+
+    Returned object will be chunked if if the given object is chunked, or if chunks or chunked_array_type are specified.
 
     Parameters
     ----------
     other : DataArray, Dataset or Variable
         The reference object in input
     fill_value : scalar or dict-like
         Value to fill the new object with before returning it. If
         other is a Dataset, may also be a dict-like mapping data
         variables to fill values.
     dtype : dtype or dict-like of dtype, optional
         dtype of the new array. If a dict-like, maps dtypes to
         variables. If omitted, it defaults to other.dtype.
+    chunks : int, "auto", tuple of int or mapping of Hashable to int, optional
+        Chunk sizes along each dimension, e.g., ``5``, ``"auto"``, ``(5, 5)`` or
+        ``{"x": 5, "y": 5}``.
+    chunked_array_type: str, optional
+        Which chunked array type to coerce the underlying data array to.
+        Defaults to 'dask' if installed, else whatever is registered via the `ChunkManagerEnetryPoint` system.
+        Experimental API that should not be relied upon.
+    from_array_kwargs: dict, optional
+        Additional keyword arguments passed on to the `ChunkManagerEntrypoint.from_array` method used to create
+        chunked arrays, via whichever chunk manager is specified through the `chunked_array_type` kwarg.
+        For example, with dask as the default chunked array type, this method would pass additional kwargs
+        to :py:func:`dask.array.from_array`. Experimental API that should not be relied upon.
 
     Returns
     -------
     out : same as object
         New object with the same shape and type as other, with the data
         filled with fill_value. Coords will be copied from other.
         If other is based on dask, the new one will be as well, and will be
@@ -1556,101 +1607,183 @@
         if not isinstance(dtype, Mapping):
             dtype_ = {k: dtype for k in other.data_vars.keys()}
         else:
             dtype_ = dtype
 
         data_vars = {
             k: _full_like_variable(
-                v.variable, fill_value.get(k, dtypes.NA), dtype_.get(k, None)
+                v.variable,
+                fill_value.get(k, dtypes.NA),
+                dtype_.get(k, None),
+                chunks,
+                chunked_array_type,
+                from_array_kwargs,
             )
             for k, v in other.data_vars.items()
         }
         return Dataset(data_vars, coords=other.coords, attrs=other.attrs)
     elif isinstance(other, DataArray):
         if isinstance(dtype, Mapping):
             raise ValueError("'dtype' cannot be dict-like when passing a DataArray")
         return DataArray(
-            _full_like_variable(other.variable, fill_value, dtype),
+            _full_like_variable(
+                other.variable,
+                fill_value,
+                dtype,
+                chunks,
+                chunked_array_type,
+                from_array_kwargs,
+            ),
             dims=other.dims,
             coords=other.coords,
             attrs=other.attrs,
             name=other.name,
         )
     elif isinstance(other, Variable):
         if isinstance(dtype, Mapping):
             raise ValueError("'dtype' cannot be dict-like when passing a Variable")
-        return _full_like_variable(other, fill_value, dtype)
+        return _full_like_variable(
+            other, fill_value, dtype, chunks, chunked_array_type, from_array_kwargs
+        )
     else:
         raise TypeError("Expected DataArray, Dataset, or Variable")
 
 
 def _full_like_variable(
-    other: Variable, fill_value: Any, dtype: DTypeLike = None
+    other: Variable,
+    fill_value: Any,
+    dtype: DTypeLike | None = None,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Variable:
     """Inner function of full_like, where other must be a variable"""
     from xarray.core.variable import Variable
 
     if fill_value is dtypes.NA:
         fill_value = dtypes.get_fill_value(dtype if dtype is not None else other.dtype)
 
-    if is_duck_dask_array(other.data):
-        import dask.array
+    if (
+        is_chunked_array(other.data)
+        or chunked_array_type is not None
+        or chunks is not None
+    ):
+        if chunked_array_type is None:
+            chunkmanager = get_chunked_array_type(other.data)
+        else:
+            chunkmanager = guess_chunkmanager(chunked_array_type)
 
         if dtype is None:
             dtype = other.dtype
-        data = dask.array.full(
-            other.shape, fill_value, dtype=dtype, chunks=other.data.chunks
+
+        if from_array_kwargs is None:
+            from_array_kwargs = {}
+
+        data = chunkmanager.array_api.full(
+            other.shape,
+            fill_value,
+            dtype=dtype,
+            chunks=chunks if chunks else other.data.chunks,
+            **from_array_kwargs,
         )
     else:
         data = np.full_like(other.data, fill_value, dtype=dtype)
 
     return Variable(dims=other.dims, data=data, attrs=other.attrs)
 
 
 @overload
-def zeros_like(other: DataArray, dtype: DTypeLikeSave = None) -> DataArray:
+def zeros_like(
+    other: DataArray,
+    dtype: DTypeLikeSave | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
+) -> DataArray:
     ...
 
 
 @overload
-def zeros_like(other: Dataset, dtype: DTypeMaybeMapping = None) -> Dataset:
+def zeros_like(
+    other: Dataset,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
+) -> Dataset:
     ...
 
 
 @overload
-def zeros_like(other: Variable, dtype: DTypeLikeSave = None) -> Variable:
+def zeros_like(
+    other: Variable,
+    dtype: DTypeLikeSave | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
+) -> Variable:
     ...
 
 
 @overload
 def zeros_like(
-    other: Dataset | DataArray, dtype: DTypeMaybeMapping = None
+    other: Dataset | DataArray,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray:
     ...
 
 
 @overload
 def zeros_like(
-    other: Dataset | DataArray | Variable, dtype: DTypeMaybeMapping = None
+    other: Dataset | DataArray | Variable,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray | Variable:
     ...
 
 
 def zeros_like(
-    other: Dataset | DataArray | Variable, dtype: DTypeMaybeMapping = None
+    other: Dataset | DataArray | Variable,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray | Variable:
     """Return a new object of zeros with the same shape and
     type as a given dataarray or dataset.
 
     Parameters
     ----------
     other : DataArray, Dataset or Variable
         The reference object. The output will have the same dimensions and coordinates as this object.
     dtype : dtype, optional
         dtype of the new array. If omitted, it defaults to other.dtype.
+    chunks : int, "auto", tuple of int or mapping of Hashable to int, optional
+        Chunk sizes along each dimension, e.g., ``5``, ``"auto"``, ``(5, 5)`` or
+        ``{"x": 5, "y": 5}``.
+    chunked_array_type: str, optional
+        Which chunked array type to coerce the underlying data array to.
+        Defaults to 'dask' if installed, else whatever is registered via the `ChunkManagerEnetryPoint` system.
+        Experimental API that should not be relied upon.
+    from_array_kwargs: dict, optional
+        Additional keyword arguments passed on to the `ChunkManagerEntrypoint.from_array` method used to create
+        chunked arrays, via whichever chunk manager is specified through the `chunked_array_type` kwarg.
+        For example, with dask as the default chunked array type, this method would pass additional kwargs
+        to :py:func:`dask.array.from_array`. Experimental API that should not be relied upon.
 
     Returns
     -------
     out : DataArray, Dataset or Variable
         New object of zeros with the same shape and type as other.
 
     Examples
@@ -1686,58 +1819,113 @@
 
     See Also
     --------
     ones_like
     full_like
 
     """
-    return full_like(other, 0, dtype)
+    return full_like(
+        other,
+        0,
+        dtype,
+        chunks=chunks,
+        chunked_array_type=chunked_array_type,
+        from_array_kwargs=from_array_kwargs,
+    )
 
 
 @overload
-def ones_like(other: DataArray, dtype: DTypeLikeSave = None) -> DataArray:
+def ones_like(
+    other: DataArray,
+    dtype: DTypeLikeSave | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
+) -> DataArray:
     ...
 
 
 @overload
-def ones_like(other: Dataset, dtype: DTypeMaybeMapping = None) -> Dataset:
+def ones_like(
+    other: Dataset,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
+) -> Dataset:
     ...
 
 
 @overload
-def ones_like(other: Variable, dtype: DTypeLikeSave = None) -> Variable:
+def ones_like(
+    other: Variable,
+    dtype: DTypeLikeSave | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
+) -> Variable:
     ...
 
 
 @overload
 def ones_like(
-    other: Dataset | DataArray, dtype: DTypeMaybeMapping = None
+    other: Dataset | DataArray,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray:
     ...
 
 
 @overload
 def ones_like(
-    other: Dataset | DataArray | Variable, dtype: DTypeMaybeMapping = None
+    other: Dataset | DataArray | Variable,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray | Variable:
     ...
 
 
 def ones_like(
-    other: Dataset | DataArray | Variable, dtype: DTypeMaybeMapping = None
+    other: Dataset | DataArray | Variable,
+    dtype: DTypeMaybeMapping | None = None,
+    *,
+    chunks: T_Chunks = None,
+    chunked_array_type: str | None = None,
+    from_array_kwargs: dict[str, Any] | None = None,
 ) -> Dataset | DataArray | Variable:
     """Return a new object of ones with the same shape and
     type as a given dataarray or dataset.
 
     Parameters
     ----------
     other : DataArray, Dataset, or Variable
         The reference object. The output will have the same dimensions and coordinates as this object.
     dtype : dtype, optional
         dtype of the new array. If omitted, it defaults to other.dtype.
+    chunks : int, "auto", tuple of int or mapping of Hashable to int, optional
+        Chunk sizes along each dimension, e.g., ``5``, ``"auto"``, ``(5, 5)`` or
+        ``{"x": 5, "y": 5}``.
+    chunked_array_type: str, optional
+        Which chunked array type to coerce the underlying data array to.
+        Defaults to 'dask' if installed, else whatever is registered via the `ChunkManagerEnetryPoint` system.
+        Experimental API that should not be relied upon.
+    from_array_kwargs: dict, optional
+        Additional keyword arguments passed on to the `ChunkManagerEntrypoint.from_array` method used to create
+        chunked arrays, via whichever chunk manager is specified through the `chunked_array_type` kwarg.
+        For example, with dask as the default chunked array type, this method would pass additional kwargs
+        to :py:func:`dask.array.from_array`. Experimental API that should not be relied upon.
 
     Returns
     -------
     out : same as object
         New object of ones with the same shape and type as other.
 
     Examples
@@ -1765,15 +1953,22 @@
 
     See Also
     --------
     zeros_like
     full_like
 
     """
-    return full_like(other, 1, dtype)
+    return full_like(
+        other,
+        1,
+        dtype,
+        chunks=chunks,
+        chunked_array_type=chunked_array_type,
+        from_array_kwargs=from_array_kwargs,
+    )
 
 
 def get_chunksizes(
     variables: Iterable[Variable],
 ) -> Mapping[Any, tuple[int, ...]]:
     chunks: dict[Any, tuple[int, ...]] = {}
     for v in variables:
```

### Comparing `xarray-2023.4.2/xarray/core/computation.py` & `xarray-2023.5.0/xarray/core/computation.py`

 * *Files 3% similar despite different names*

```diff
@@ -45,4649 +45,4661 @@
 000002c0: 6174 7472 732c 206d 6572 6765 5f63 6f6f  attrs, merge_coo
 000002d0: 7264 696e 6174 6573 5f77 6974 686f 7574  rdinates_without
 000002e0: 5f61 6c69 676e 0a66 726f 6d20 7861 7272  _align.from xarr
 000002f0: 6179 2e63 6f72 652e 6f70 7469 6f6e 7320  ay.core.options 
 00000300: 696d 706f 7274 204f 5054 494f 4e53 2c20  import OPTIONS, 
 00000310: 5f67 6574 5f6b 6565 705f 6174 7472 730a  _get_keep_attrs.
 00000320: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-00000330: 2e70 7963 6f6d 7061 7420 696d 706f 7274  .pycompat import
-00000340: 2069 735f 6475 636b 5f64 6173 6b5f 6172   is_duck_dask_ar
-00000350: 7261 790a 6672 6f6d 2078 6172 7261 792e  ray.from xarray.
-00000360: 636f 7265 2e74 7970 6573 2069 6d70 6f72  core.types impor
-00000370: 7420 4469 6d73 2c20 545f 4461 7461 4172  t Dims, T_DataAr
-00000380: 7261 790a 6672 6f6d 2078 6172 7261 792e  ray.from xarray.
-00000390: 636f 7265 2e75 7469 6c73 2069 6d70 6f72  core.utils impor
-000003a0: 7420 6973 5f64 6963 745f 6c69 6b65 2c20  t is_dict_like, 
-000003b0: 6973 5f73 6361 6c61 720a 6672 6f6d 2078  is_scalar.from x
-000003c0: 6172 7261 792e 636f 7265 2e76 6172 6961  array.core.varia
-000003d0: 626c 6520 696d 706f 7274 2056 6172 6961  ble import Varia
-000003e0: 626c 650a 0a69 6620 5459 5045 5f43 4845  ble..if TYPE_CHE
-000003f0: 434b 494e 473a 0a20 2020 2066 726f 6d20  CKING:.    from 
-00000400: 7861 7272 6179 2e63 6f72 652e 636f 6f72  xarray.core.coor
-00000410: 6469 6e61 7465 7320 696d 706f 7274 2043  dinates import C
-00000420: 6f6f 7264 696e 6174 6573 0a20 2020 2066  oordinates.    f
-00000430: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
-00000440: 6461 7461 6172 7261 7920 696d 706f 7274  dataarray import
-00000450: 2044 6174 6141 7272 6179 0a20 2020 2066   DataArray.    f
-00000460: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
-00000470: 6461 7461 7365 7420 696d 706f 7274 2044  dataset import D
-00000480: 6174 6173 6574 0a20 2020 2066 726f 6d20  ataset.    from 
-00000490: 7861 7272 6179 2e63 6f72 652e 7479 7065  xarray.core.type
-000004a0: 7320 696d 706f 7274 2043 6f6d 6269 6e65  s import Combine
-000004b0: 4174 7472 734f 7074 696f 6e73 2c20 4a6f  AttrsOptions, Jo
-000004c0: 696e 4f70 7469 6f6e 730a 0a5f 4e4f 5f46  inOptions.._NO_F
-000004d0: 494c 4c5f 5641 4c55 4520 3d20 7574 696c  ILL_VALUE = util
-000004e0: 732e 5265 7072 4f62 6a65 6374 2822 3c6e  s.ReprObject("<n
-000004f0: 6f2d 6669 6c6c 2d76 616c 7565 3e22 290a  o-fill-value>").
-00000500: 5f44 4546 4155 4c54 5f4e 414d 4520 3d20  _DEFAULT_NAME = 
-00000510: 7574 696c 732e 5265 7072 4f62 6a65 6374  utils.ReprObject
-00000520: 2822 3c64 6566 6175 6c74 2d6e 616d 653e  ("<default-name>
-00000530: 2229 0a5f 4a4f 494e 535f 5749 5448 4f55  ")._JOINS_WITHOU
-00000540: 545f 4649 4c4c 5f56 414c 5545 5320 3d20  T_FILL_VALUES = 
-00000550: 6672 6f7a 656e 7365 7428 7b22 696e 6e65  frozenset({"inne
-00000560: 7222 2c20 2265 7861 6374 227d 290a 0a0a  r", "exact"})...
-00000570: 6465 6620 5f66 6972 7374 5f6f 665f 7479  def _first_of_ty
-00000580: 7065 2861 7267 732c 206b 696e 6429 3a0a  pe(args, kind):.
-00000590: 2020 2020 2222 2252 6574 7572 6e20 6569      """Return ei
-000005a0: 7468 6572 2066 6972 7374 206f 626a 6563  ther first objec
-000005b0: 7420 6f66 2074 7970 6520 276b 696e 6427  t of type 'kind'
-000005c0: 206f 7220 7261 6973 6520 6966 206e 6f74   or raise if not
-000005d0: 2066 6f75 6e64 2e22 2222 0a20 2020 2066   found.""".    f
-000005e0: 6f72 2061 7267 2069 6e20 6172 6773 3a0a  or arg in args:.
-000005f0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00000600: 7461 6e63 6528 6172 672c 206b 696e 6429  tance(arg, kind)
-00000610: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00000620: 7475 726e 2061 7267 0a20 2020 2072 6169  turn arg.    rai
-00000630: 7365 2056 616c 7565 4572 726f 7228 2254  se ValueError("T
-00000640: 6869 7320 7368 6f75 6c64 2062 6520 756e  his should be un
-00000650: 7265 6163 6861 626c 652e 2229 0a0a 0a64  reachable.")...d
-00000660: 6566 205f 616c 6c5f 6f66 5f74 7970 6528  ef _all_of_type(
-00000670: 6172 6773 2c20 6b69 6e64 293a 0a20 2020  args, kind):.   
-00000680: 2022 2222 5265 7475 726e 2061 6c6c 206f   """Return all o
-00000690: 626a 6563 7473 206f 6620 7479 7065 2027  bjects of type '
-000006a0: 6b69 6e64 2722 2222 0a20 2020 2072 6574  kind'""".    ret
-000006b0: 7572 6e20 5b61 7267 2066 6f72 2061 7267  urn [arg for arg
-000006c0: 2069 6e20 6172 6773 2069 6620 6973 696e   in args if isin
-000006d0: 7374 616e 6365 2861 7267 2c20 6b69 6e64  stance(arg, kind
-000006e0: 295d 0a0a 0a63 6c61 7373 205f 5546 756e  )]...class _UFun
-000006f0: 6353 6967 6e61 7475 7265 3a0a 2020 2020  cSignature:.    
-00000700: 2222 2243 6f72 6520 6469 6d65 6e73 696f  """Core dimensio
-00000710: 6e73 2073 6967 6e61 7475 7265 2066 6f72  ns signature for
-00000720: 2061 2067 6976 656e 2066 756e 6374 696f   a given functio
-00000730: 6e2e 0a0a 2020 2020 4261 7365 6420 6f6e  n...    Based on
-00000740: 2074 6865 2073 6967 6e61 7475 7265 2070   the signature p
-00000750: 726f 7669 6465 6420 6279 2067 656e 6572  rovided by gener
-00000760: 616c 697a 6564 2075 6675 6e63 7320 696e  alized ufuncs in
-00000770: 204e 756d 5079 2e0a 0a20 2020 2041 7474   NumPy...    Att
-00000780: 7269 6275 7465 730a 2020 2020 2d2d 2d2d  ributes.    ----
-00000790: 2d2d 2d2d 2d2d 0a20 2020 2069 6e70 7574  ------.    input
-000007a0: 5f63 6f72 655f 6469 6d73 203a 2074 7570  _core_dims : tup
-000007b0: 6c65 5b74 7570 6c65 5d0a 2020 2020 2020  le[tuple].      
-000007c0: 2020 436f 7265 2064 696d 656e 7369 6f6e    Core dimension
-000007d0: 206e 616d 6573 206f 6e20 6561 6368 2069   names on each i
-000007e0: 6e70 7574 2076 6172 6961 626c 652e 0a20  nput variable.. 
-000007f0: 2020 206f 7574 7075 745f 636f 7265 5f64     output_core_d
-00000800: 696d 7320 3a20 7475 706c 655b 7475 706c  ims : tuple[tupl
-00000810: 655d 0a20 2020 2020 2020 2043 6f72 6520  e].        Core 
-00000820: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
-00000830: 6f6e 2065 6163 6820 6f75 7470 7574 2076  on each output v
-00000840: 6172 6961 626c 652e 0a20 2020 2022 2222  ariable..    """
-00000850: 0a0a 2020 2020 5f5f 736c 6f74 735f 5f20  ..    __slots__ 
-00000860: 3d20 280a 2020 2020 2020 2020 2269 6e70  = (.        "inp
-00000870: 7574 5f63 6f72 655f 6469 6d73 222c 0a20  ut_core_dims",. 
-00000880: 2020 2020 2020 2022 6f75 7470 7574 5f63         "output_c
-00000890: 6f72 655f 6469 6d73 222c 0a20 2020 2020  ore_dims",.     
-000008a0: 2020 2022 5f61 6c6c 5f69 6e70 7574 5f63     "_all_input_c
-000008b0: 6f72 655f 6469 6d73 222c 0a20 2020 2020  ore_dims",.     
-000008c0: 2020 2022 5f61 6c6c 5f6f 7574 7075 745f     "_all_output_
-000008d0: 636f 7265 5f64 696d 7322 2c0a 2020 2020  core_dims",.    
-000008e0: 2020 2020 225f 616c 6c5f 636f 7265 5f64      "_all_core_d
-000008f0: 696d 7322 2c0a 2020 2020 290a 0a20 2020  ims",.    )..   
-00000900: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00000910: 6c66 2c20 696e 7075 745f 636f 7265 5f64  lf, input_core_d
-00000920: 696d 732c 206f 7574 7075 745f 636f 7265  ims, output_core
-00000930: 5f64 696d 733d 2828 292c 2929 3a0a 2020  _dims=((),)):.  
-00000940: 2020 2020 2020 7365 6c66 2e69 6e70 7574        self.input
-00000950: 5f63 6f72 655f 6469 6d73 203d 2074 7570  _core_dims = tup
-00000960: 6c65 2874 7570 6c65 2861 2920 666f 7220  le(tuple(a) for 
-00000970: 6120 696e 2069 6e70 7574 5f63 6f72 655f  a in input_core_
-00000980: 6469 6d73 290a 2020 2020 2020 2020 7365  dims).        se
-00000990: 6c66 2e6f 7574 7075 745f 636f 7265 5f64  lf.output_core_d
-000009a0: 696d 7320 3d20 7475 706c 6528 7475 706c  ims = tuple(tupl
-000009b0: 6528 6129 2066 6f72 2061 2069 6e20 6f75  e(a) for a in ou
-000009c0: 7470 7574 5f63 6f72 655f 6469 6d73 290a  tput_core_dims).
-000009d0: 2020 2020 2020 2020 7365 6c66 2e5f 616c          self._al
-000009e0: 6c5f 696e 7075 745f 636f 7265 5f64 696d  l_input_core_dim
-000009f0: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
-00000a00: 2073 656c 662e 5f61 6c6c 5f6f 7574 7075   self._all_outpu
-00000a10: 745f 636f 7265 5f64 696d 7320 3d20 4e6f  t_core_dims = No
-00000a20: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-00000a30: 5f61 6c6c 5f63 6f72 655f 6469 6d73 203d  _all_core_dims =
-00000a40: 204e 6f6e 650a 0a20 2020 2040 7072 6f70   None..    @prop
-00000a50: 6572 7479 0a20 2020 2064 6566 2061 6c6c  erty.    def all
-00000a60: 5f69 6e70 7574 5f63 6f72 655f 6469 6d73  _input_core_dims
-00000a70: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00000a80: 6966 2073 656c 662e 5f61 6c6c 5f69 6e70  if self._all_inp
-00000a90: 7574 5f63 6f72 655f 6469 6d73 2069 7320  ut_core_dims is 
-00000aa0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00000ab0: 2020 7365 6c66 2e5f 616c 6c5f 696e 7075    self._all_inpu
-00000ac0: 745f 636f 7265 5f64 696d 7320 3d20 6672  t_core_dims = fr
-00000ad0: 6f7a 656e 7365 7428 0a20 2020 2020 2020  ozenset(.       
-00000ae0: 2020 2020 2020 2020 2064 696d 2066 6f72           dim for
-00000af0: 2064 696d 7320 696e 2073 656c 662e 696e   dims in self.in
-00000b00: 7075 745f 636f 7265 5f64 696d 7320 666f  put_core_dims fo
-00000b10: 7220 6469 6d20 696e 2064 696d 730a 2020  r dim in dims.  
-00000b20: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00000b30: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00000b40: 5f61 6c6c 5f69 6e70 7574 5f63 6f72 655f  _all_input_core_
-00000b50: 6469 6d73 0a0a 2020 2020 4070 726f 7065  dims..    @prope
-00000b60: 7274 790a 2020 2020 6465 6620 616c 6c5f  rty.    def all_
-00000b70: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
-00000b80: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00000b90: 6966 2073 656c 662e 5f61 6c6c 5f6f 7574  if self._all_out
-00000ba0: 7075 745f 636f 7265 5f64 696d 7320 6973  put_core_dims is
-00000bb0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00000bc0: 2020 2073 656c 662e 5f61 6c6c 5f6f 7574     self._all_out
-00000bd0: 7075 745f 636f 7265 5f64 696d 7320 3d20  put_core_dims = 
-00000be0: 6672 6f7a 656e 7365 7428 0a20 2020 2020  frozenset(.     
-00000bf0: 2020 2020 2020 2020 2020 2064 696d 2066             dim f
-00000c00: 6f72 2064 696d 7320 696e 2073 656c 662e  or dims in self.
-00000c10: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
-00000c20: 2066 6f72 2064 696d 2069 6e20 6469 6d73   for dim in dims
-00000c30: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00000c40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00000c50: 6c66 2e5f 616c 6c5f 6f75 7470 7574 5f63  lf._all_output_c
-00000c60: 6f72 655f 6469 6d73 0a0a 2020 2020 4070  ore_dims..    @p
-00000c70: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00000c80: 616c 6c5f 636f 7265 5f64 696d 7328 7365  all_core_dims(se
-00000c90: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
-00000ca0: 7365 6c66 2e5f 616c 6c5f 636f 7265 5f64  self._all_core_d
-00000cb0: 696d 7320 6973 204e 6f6e 653a 0a20 2020  ims is None:.   
-00000cc0: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
-00000cd0: 6c6c 5f63 6f72 655f 6469 6d73 203d 2073  ll_core_dims = s
-00000ce0: 656c 662e 616c 6c5f 696e 7075 745f 636f  elf.all_input_co
-00000cf0: 7265 5f64 696d 7320 7c20 7365 6c66 2e61  re_dims | self.a
-00000d00: 6c6c 5f6f 7574 7075 745f 636f 7265 5f64  ll_output_core_d
-00000d10: 696d 730a 2020 2020 2020 2020 7265 7475  ims.        retu
-00000d20: 726e 2073 656c 662e 5f61 6c6c 5f63 6f72  rn self._all_cor
-00000d30: 655f 6469 6d73 0a0a 2020 2020 4070 726f  e_dims..    @pro
-00000d40: 7065 7274 790a 2020 2020 6465 6620 6469  perty.    def di
-00000d50: 6d73 5f6d 6170 2873 656c 6629 3a0a 2020  ms_map(self):.  
-00000d60: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
-00000d70: 2020 2020 2020 2020 2020 2063 6f72 655f             core_
-00000d80: 6469 6d3a 2066 2264 696d 7b6e 7d22 2066  dim: f"dim{n}" f
-00000d90: 6f72 206e 2c20 636f 7265 5f64 696d 2069  or n, core_dim i
-00000da0: 6e20 656e 756d 6572 6174 6528 736f 7274  n enumerate(sort
-00000db0: 6564 2873 656c 662e 616c 6c5f 636f 7265  ed(self.all_core
-00000dc0: 5f64 696d 7329 290a 2020 2020 2020 2020  _dims)).        
-00000dd0: 7d0a 0a20 2020 2040 7072 6f70 6572 7479  }..    @property
-00000de0: 0a20 2020 2064 6566 206e 756d 5f69 6e70  .    def num_inp
-00000df0: 7574 7328 7365 6c66 293a 0a20 2020 2020  uts(self):.     
-00000e00: 2020 2072 6574 7572 6e20 6c65 6e28 7365     return len(se
-00000e10: 6c66 2e69 6e70 7574 5f63 6f72 655f 6469  lf.input_core_di
-00000e20: 6d73 290a 0a20 2020 2040 7072 6f70 6572  ms)..    @proper
-00000e30: 7479 0a20 2020 2064 6566 206e 756d 5f6f  ty.    def num_o
-00000e40: 7574 7075 7473 2873 656c 6629 3a0a 2020  utputs(self):.  
-00000e50: 2020 2020 2020 7265 7475 726e 206c 656e        return len
-00000e60: 2873 656c 662e 6f75 7470 7574 5f63 6f72  (self.output_cor
-00000e70: 655f 6469 6d73 290a 0a20 2020 2064 6566  e_dims)..    def
-00000e80: 205f 5f65 715f 5f28 7365 6c66 2c20 6f74   __eq__(self, ot
-00000e90: 6865 7229 3a0a 2020 2020 2020 2020 7472  her):.        tr
-00000ea0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-00000eb0: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
-00000ec0: 2020 2020 2020 2020 7365 6c66 2e69 6e70          self.inp
-00000ed0: 7574 5f63 6f72 655f 6469 6d73 203d 3d20  ut_core_dims == 
-00000ee0: 6f74 6865 722e 696e 7075 745f 636f 7265  other.input_core
-00000ef0: 5f64 696d 730a 2020 2020 2020 2020 2020  _dims.          
-00000f00: 2020 2020 2020 616e 6420 7365 6c66 2e6f        and self.o
-00000f10: 7574 7075 745f 636f 7265 5f64 696d 7320  utput_core_dims 
-00000f20: 3d3d 206f 7468 6572 2e6f 7574 7075 745f  == other.output_
-00000f30: 636f 7265 5f64 696d 730a 2020 2020 2020  core_dims.      
-00000f40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00000f50: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
-00000f60: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00000f70: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00000f80: 0a20 2020 2064 6566 205f 5f6e 655f 5f28  .    def __ne__(
-00000f90: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
-00000fa0: 2020 2020 2020 7265 7475 726e 206e 6f74        return not
-00000fb0: 2073 656c 6620 3d3d 206f 7468 6572 0a0a   self == other..
-00000fc0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-00000fd0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00000fe0: 7265 7475 726e 2022 7b7d 287b 2172 7d2c  return "{}({!r},
-00000ff0: 207b 2172 7d29 222e 666f 726d 6174 280a   {!r})".format(.
-00001000: 2020 2020 2020 2020 2020 2020 7479 7065              type
-00001010: 2873 656c 6629 2e5f 5f6e 616d 655f 5f2c  (self).__name__,
-00001020: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
-00001030: 7428 7365 6c66 2e69 6e70 7574 5f63 6f72  t(self.input_cor
-00001040: 655f 6469 6d73 292c 0a20 2020 2020 2020  e_dims),.       
-00001050: 2020 2020 206c 6973 7428 7365 6c66 2e6f       list(self.o
-00001060: 7574 7075 745f 636f 7265 5f64 696d 7329  utput_core_dims)
-00001070: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00001080: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
-00001090: 6629 3a0a 2020 2020 2020 2020 6c68 7320  f):.        lhs 
-000010a0: 3d20 222c 222e 6a6f 696e 2822 287b 7d29  = ",".join("({})
-000010b0: 222e 666f 726d 6174 2822 2c22 2e6a 6f69  ".format(",".joi
-000010c0: 6e28 6469 6d73 2929 2066 6f72 2064 696d  n(dims)) for dim
-000010d0: 7320 696e 2073 656c 662e 696e 7075 745f  s in self.input_
-000010e0: 636f 7265 5f64 696d 7329 0a20 2020 2020  core_dims).     
-000010f0: 2020 2072 6873 203d 2022 2c22 2e6a 6f69     rhs = ",".joi
-00001100: 6e28 2228 7b7d 2922 2e66 6f72 6d61 7428  n("({})".format(
-00001110: 222c 222e 6a6f 696e 2864 696d 7329 2920  ",".join(dims)) 
-00001120: 666f 7220 6469 6d73 2069 6e20 7365 6c66  for dims in self
-00001130: 2e6f 7574 7075 745f 636f 7265 5f64 696d  .output_core_dim
-00001140: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-00001150: 6e20 6622 7b6c 6873 7d2d 3e7b 7268 737d  n f"{lhs}->{rhs}
-00001160: 220a 0a20 2020 2064 6566 2074 6f5f 6775  "..    def to_gu
-00001170: 6675 6e63 5f73 7472 696e 6728 7365 6c66  func_string(self
-00001180: 2c20 6578 636c 7564 655f 6469 6d73 3d66  , exclude_dims=f
-00001190: 726f 7a65 6e73 6574 2829 293a 0a20 2020  rozenset()):.   
-000011a0: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
-000011b0: 6e20 6571 7569 7661 6c65 6e74 2073 6967  n equivalent sig
-000011c0: 6e61 7475 7265 2073 7472 696e 6720 666f  nature string fo
-000011d0: 7220 6120 4e75 6d50 7920 6775 6675 6e63  r a NumPy gufunc
-000011e0: 2e0a 0a20 2020 2020 2020 2055 6e6c 696b  ...        Unlik
-000011f0: 6520 5f5f 7374 725f 5f2c 2068 616e 646c  e __str__, handl
-00001200: 6573 2064 696d 656e 7369 6f6e 7320 7468  es dimensions th
-00001210: 6174 2064 6f6e 2774 206d 6170 2074 6f20  at don't map to 
-00001220: 5079 7468 6f6e 0a20 2020 2020 2020 2069  Python.        i
-00001230: 6465 6e74 6966 6965 7273 2e0a 0a20 2020  dentifiers...   
-00001240: 2020 2020 2041 6c73 6f20 6372 6561 7465       Also create
-00001250: 7320 756e 6971 7565 206e 616d 6573 2066  s unique names f
-00001260: 6f72 2069 6e70 7574 5f63 6f72 655f 6469  or input_core_di
-00001270: 6d73 2063 6f6e 7461 696e 6564 2069 6e20  ms contained in 
-00001280: 6578 636c 7564 655f 6469 6d73 2e0a 2020  exclude_dims..  
-00001290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000012a0: 2020 696e 7075 745f 636f 7265 5f64 696d    input_core_dim
-000012b0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-000012c0: 2020 5b73 656c 662e 6469 6d73 5f6d 6170    [self.dims_map
-000012d0: 5b64 696d 5d20 666f 7220 6469 6d20 696e  [dim] for dim in
-000012e0: 2063 6f72 655f 6469 6d73 5d0a 2020 2020   core_dims].    
-000012f0: 2020 2020 2020 2020 666f 7220 636f 7265          for core
-00001300: 5f64 696d 7320 696e 2073 656c 662e 696e  _dims in self.in
-00001310: 7075 745f 636f 7265 5f64 696d 730a 2020  put_core_dims.  
-00001320: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00001330: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
-00001340: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00001350: 205b 7365 6c66 2e64 696d 735f 6d61 705b   [self.dims_map[
-00001360: 6469 6d5d 2066 6f72 2064 696d 2069 6e20  dim] for dim in 
-00001370: 636f 7265 5f64 696d 735d 0a20 2020 2020  core_dims].     
-00001380: 2020 2020 2020 2066 6f72 2063 6f72 655f         for core_
-00001390: 6469 6d73 2069 6e20 7365 6c66 2e6f 7574  dims in self.out
-000013a0: 7075 745f 636f 7265 5f64 696d 730a 2020  put_core_dims.  
-000013b0: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
-000013c0: 2023 2065 6e75 6d65 7261 7465 2069 6e70   # enumerate inp
-000013d0: 7574 5f63 6f72 655f 6469 6d73 2063 6f6e  ut_core_dims con
-000013e0: 7461 696e 6564 2069 6e20 6578 636c 7564  tained in exclud
-000013f0: 655f 6469 6d73 2074 6f20 6d61 6b65 2074  e_dims to make t
-00001400: 6865 6d20 756e 6971 7565 0a20 2020 2020  hem unique.     
-00001410: 2020 2069 6620 6578 636c 7564 655f 6469     if exclude_di
-00001420: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00001430: 6578 636c 7564 655f 6469 6d73 203d 205b  exclude_dims = [
-00001440: 7365 6c66 2e64 696d 735f 6d61 705b 6469  self.dims_map[di
-00001450: 6d5d 2066 6f72 2064 696d 2069 6e20 6578  m] for dim in ex
-00001460: 636c 7564 655f 6469 6d73 5d0a 0a20 2020  clude_dims]..   
-00001470: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
-00001480: 203d 2043 6f75 6e74 6572 2829 0a0a 2020   = Counter()..  
-00001490: 2020 2020 2020 2020 2020 6465 6620 5f65            def _e
-000014a0: 6e75 6d65 7261 7465 2864 696d 293a 0a20  numerate(dim):. 
-000014b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000014c0: 6620 6469 6d20 696e 2065 7863 6c75 6465  f dim in exclude
-000014d0: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
-000014e0: 2020 2020 2020 2020 2020 206e 203d 2063             n = c
-000014f0: 6f75 6e74 6572 5b64 696d 5d0a 2020 2020  ounter[dim].    
-00001500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001510: 636f 756e 7465 722e 7570 6461 7465 285b  counter.update([
-00001520: 6469 6d5d 290a 2020 2020 2020 2020 2020  dim]).          
-00001530: 2020 2020 2020 2020 2020 6469 6d20 3d20            dim = 
-00001540: 6622 7b64 696d 7d5f 7b6e 7d22 0a20 2020  f"{dim}_{n}".   
-00001550: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00001560: 7572 6e20 6469 6d0a 0a20 2020 2020 2020  urn dim..       
-00001570: 2020 2020 2069 6e70 7574 5f63 6f72 655f       input_core_
-00001580: 6469 6d73 203d 205b 0a20 2020 2020 2020  dims = [.       
-00001590: 2020 2020 2020 2020 205b 5f65 6e75 6d65           [_enume
-000015a0: 7261 7465 2864 696d 2920 666f 7220 6469  rate(dim) for di
-000015b0: 6d20 696e 2061 7267 5d20 666f 7220 6172  m in arg] for ar
-000015c0: 6720 696e 2069 6e70 7574 5f63 6f72 655f  g in input_core_
-000015d0: 6469 6d73 0a20 2020 2020 2020 2020 2020  dims.           
-000015e0: 205d 0a0a 2020 2020 2020 2020 616c 745f   ]..        alt_
-000015f0: 7369 676e 6174 7572 6520 3d20 7479 7065  signature = type
-00001600: 2873 656c 6629 2869 6e70 7574 5f63 6f72  (self)(input_cor
-00001610: 655f 6469 6d73 2c20 6f75 7470 7574 5f63  e_dims, output_c
-00001620: 6f72 655f 6469 6d73 290a 2020 2020 2020  ore_dims).      
-00001630: 2020 7265 7475 726e 2073 7472 2861 6c74    return str(alt
-00001640: 5f73 6967 6e61 7475 7265 290a 0a0a 6465  _signature)...de
-00001650: 6620 7265 7375 6c74 5f6e 616d 6528 6f62  f result_name(ob
-00001660: 6a65 6374 733a 2049 7465 7261 626c 655b  jects: Iterable[
-00001670: 416e 795d 2920 2d3e 2041 6e79 3a0a 2020  Any]) -> Any:.  
-00001680: 2020 2320 7573 6520 7468 6520 7361 6d65    # use the same
-00001690: 206e 616d 696e 6720 6865 7572 6973 7469   naming heuristi
-000016a0: 6373 2061 7320 7061 6e64 6173 3a0a 2020  cs as pandas:.  
-000016b0: 2020 2320 6874 7470 733a 2f2f 6769 7468    # https://gith
-000016c0: 7562 2e63 6f6d 2f62 6c61 7a65 2f62 6c61  ub.com/blaze/bla
-000016d0: 7a65 2f69 7373 7565 732f 3435 3823 6973  ze/issues/458#is
-000016e0: 7375 6563 6f6d 6d65 6e74 2d35 3139 3336  suecomment-51936
-000016f0: 3335 360a 2020 2020 6e61 6d65 7320 3d20  356.    names = 
-00001700: 7b67 6574 6174 7472 286f 626a 2c20 226e  {getattr(obj, "n
-00001710: 616d 6522 2c20 5f44 4546 4155 4c54 5f4e  ame", _DEFAULT_N
-00001720: 414d 4529 2066 6f72 206f 626a 2069 6e20  AME) for obj in 
-00001730: 6f62 6a65 6374 737d 0a20 2020 206e 616d  objects}.    nam
-00001740: 6573 2e64 6973 6361 7264 285f 4445 4641  es.discard(_DEFA
-00001750: 554c 545f 4e41 4d45 290a 2020 2020 6966  ULT_NAME).    if
-00001760: 206c 656e 286e 616d 6573 2920 3d3d 2031   len(names) == 1
-00001770: 3a0a 2020 2020 2020 2020 286e 616d 652c  :.        (name,
-00001780: 2920 3d20 6e61 6d65 730a 2020 2020 656c  ) = names.    el
-00001790: 7365 3a0a 2020 2020 2020 2020 6e61 6d65  se:.        name
-000017a0: 203d 204e 6f6e 650a 2020 2020 7265 7475   = None.    retu
-000017b0: 726e 206e 616d 650a 0a0a 6465 6620 5f67  rn name...def _g
-000017c0: 6574 5f63 6f6f 7264 735f 6c69 7374 2861  et_coords_list(a
-000017d0: 7267 733a 2049 7465 7261 626c 655b 416e  rgs: Iterable[An
-000017e0: 795d 2920 2d3e 206c 6973 745b 436f 6f72  y]) -> list[Coor
-000017f0: 6469 6e61 7465 735d 3a0a 2020 2020 636f  dinates]:.    co
-00001800: 6f72 6473 5f6c 6973 7420 3d20 5b5d 0a20  ords_list = []. 
-00001810: 2020 2066 6f72 2061 7267 2069 6e20 6172     for arg in ar
-00001820: 6773 3a0a 2020 2020 2020 2020 7472 793a  gs:.        try:
-00001830: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
-00001840: 7264 7320 3d20 6172 672e 636f 6f72 6473  rds = arg.coords
-00001850: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00001860: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
-00001870: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00001880: 2020 2320 736b 6970 2074 6869 7320 6172    # skip this ar
-00001890: 6775 6d65 6e74 0a20 2020 2020 2020 2065  gument.        e
-000018a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000018b0: 2063 6f6f 7264 735f 6c69 7374 2e61 7070   coords_list.app
-000018c0: 656e 6428 636f 6f72 6473 290a 2020 2020  end(coords).    
-000018d0: 7265 7475 726e 2063 6f6f 7264 735f 6c69  return coords_li
-000018e0: 7374 0a0a 0a64 6566 2062 7569 6c64 5f6f  st...def build_o
-000018f0: 7574 7075 745f 636f 6f72 6473 5f61 6e64  utput_coords_and
-00001900: 5f69 6e64 6578 6573 280a 2020 2020 6172  _indexes(.    ar
-00001910: 6773 3a20 4974 6572 6162 6c65 5b41 6e79  gs: Iterable[Any
-00001920: 5d2c 0a20 2020 2073 6967 6e61 7475 7265  ],.    signature
-00001930: 3a20 5f55 4675 6e63 5369 676e 6174 7572  : _UFuncSignatur
-00001940: 652c 0a20 2020 2065 7863 6c75 6465 5f64  e,.    exclude_d
-00001950: 696d 733a 2053 6574 203d 2066 726f 7a65  ims: Set = froze
-00001960: 6e73 6574 2829 2c0a 2020 2020 636f 6d62  nset(),.    comb
-00001970: 696e 655f 6174 7472 733a 2043 6f6d 6269  ine_attrs: Combi
-00001980: 6e65 4174 7472 734f 7074 696f 6e73 203d  neAttrsOptions =
-00001990: 2022 6f76 6572 7269 6465 222c 0a29 202d   "override",.) -
-000019a0: 3e20 7475 706c 655b 6c69 7374 5b64 6963  > tuple[list[dic
-000019b0: 745b 416e 792c 2056 6172 6961 626c 655d  t[Any, Variable]
-000019c0: 5d2c 206c 6973 745b 6469 6374 5b41 6e79  ], list[dict[Any
-000019d0: 2c20 496e 6465 785d 5d5d 3a0a 2020 2020  , Index]]]:.    
-000019e0: 2222 2242 7569 6c64 206f 7574 7075 7420  """Build output 
-000019f0: 636f 6f72 6469 6e61 7465 7320 616e 6420  coordinates and 
-00001a00: 696e 6465 7865 7320 666f 7220 616e 206f  indexes for an o
-00001a10: 7065 7261 7469 6f6e 2e0a 0a20 2020 2050  peration...    P
-00001a20: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00001a30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061 7267  --------.    arg
-00001a40: 7320 3a20 4974 6572 6162 6c65 0a20 2020  s : Iterable.   
-00001a50: 2020 2020 204c 6973 7420 6f66 2072 6177       List of raw
-00001a60: 206f 7065 7261 7469 6f6e 2061 7267 756d   operation argum
-00001a70: 656e 7473 2e20 416e 7920 7661 6c69 6420  ents. Any valid 
-00001a80: 7479 7065 7320 666f 7220 7861 7272 6179  types for xarray
-00001a90: 206f 7065 7261 7469 6f6e 730a 2020 2020   operations.    
-00001aa0: 2020 2020 6172 6520 4f4b 2c20 652e 672e      are OK, e.g.
-00001ab0: 2c20 7363 616c 6172 732c 2056 6172 6961  , scalars, Varia
-00001ac0: 626c 652c 2044 6174 6141 7272 6179 2c20  ble, DataArray, 
-00001ad0: 4461 7461 7365 742e 0a20 2020 2073 6967  Dataset..    sig
-00001ae0: 6e61 7475 7265 203a 205f 5566 756e 6353  nature : _UfuncS
-00001af0: 6967 6e61 7475 7265 0a20 2020 2020 2020  ignature.       
-00001b00: 2043 6f72 6520 6469 6d65 6e73 696f 6e73   Core dimensions
-00001b10: 2073 6967 6e61 7475 7265 2066 6f72 2074   signature for t
-00001b20: 6865 206f 7065 7261 7469 6f6e 2e0a 2020  he operation..  
-00001b30: 2020 6578 636c 7564 655f 6469 6d73 203a    exclude_dims :
-00001b40: 2073 6574 2c20 6f70 7469 6f6e 616c 0a20   set, optional. 
-00001b50: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-00001b60: 7320 6578 636c 7564 6564 2066 726f 6d20  s excluded from 
-00001b70: 7468 6520 6f70 6572 6174 696f 6e2e 2043  the operation. C
-00001b80: 6f6f 7264 696e 6174 6573 2061 6c6f 6e67  oordinates along
-00001b90: 2074 6865 7365 0a20 2020 2020 2020 2064   these.        d
-00001ba0: 696d 656e 7369 6f6e 7320 6172 6520 6472  imensions are dr
-00001bb0: 6f70 7065 642e 0a20 2020 2063 6f6d 6269  opped..    combi
-00001bc0: 6e65 5f61 7474 7273 203a 207b 2264 726f  ne_attrs : {"dro
-00001bd0: 7022 2c20 2269 6465 6e74 6963 616c 222c  p", "identical",
-00001be0: 2022 6e6f 5f63 6f6e 666c 6963 7473 222c   "no_conflicts",
-00001bf0: 2022 6472 6f70 5f63 6f6e 666c 6963 7473   "drop_conflicts
-00001c00: 222c 205c 0a20 2020 2020 2020 2020 2020  ", \.           
-00001c10: 2020 2020 2020 2020 2020 226f 7665 7272            "overr
-00001c20: 6964 6522 7d20 6f72 2063 616c 6c61 626c  ide"} or callabl
-00001c30: 652c 2064 6566 6175 6c74 3a20 2264 726f  e, default: "dro
-00001c40: 7022 0a20 2020 2020 2020 2041 2063 616c  p".        A cal
-00001c50: 6c61 626c 6520 6f72 2061 2073 7472 696e  lable or a strin
-00001c60: 6720 696e 6469 6361 7469 6e67 2068 6f77  g indicating how
-00001c70: 2074 6f20 636f 6d62 696e 6520 6174 7472   to combine attr
-00001c80: 7320 6f66 2074 6865 206f 626a 6563 7473  s of the objects
-00001c90: 2062 6569 6e67 0a20 2020 2020 2020 206d   being.        m
-00001ca0: 6572 6765 643a 0a0a 2020 2020 2020 2020  erged:..        
-00001cb0: 2d20 2264 726f 7022 3a20 656d 7074 7920  - "drop": empty 
-00001cc0: 6174 7472 7320 6f6e 2072 6574 7572 6e65  attrs on returne
-00001cd0: 6420 4461 7461 7365 742e 0a20 2020 2020  d Dataset..     
-00001ce0: 2020 202d 2022 6964 656e 7469 6361 6c22     - "identical"
-00001cf0: 3a20 616c 6c20 6174 7472 7320 6d75 7374  : all attrs must
-00001d00: 2062 6520 7468 6520 7361 6d65 206f 6e20   be the same on 
-00001d10: 6576 6572 7920 6f62 6a65 6374 2e0a 2020  every object..  
-00001d20: 2020 2020 2020 2d20 226e 6f5f 636f 6e66        - "no_conf
-00001d30: 6c69 6374 7322 3a20 6174 7472 7320 6672  licts": attrs fr
-00001d40: 6f6d 2061 6c6c 206f 626a 6563 7473 2061  om all objects a
-00001d50: 7265 2063 6f6d 6269 6e65 642c 2061 6e79  re combined, any
-00001d60: 2074 6861 7420 6861 7665 0a20 2020 2020   that have.     
-00001d70: 2020 2020 2074 6865 2073 616d 6520 6e61       the same na
-00001d80: 6d65 206d 7573 7420 616c 736f 2068 6176  me must also hav
-00001d90: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
-00001da0: 2e0a 2020 2020 2020 2020 2d20 2264 726f  ..        - "dro
-00001db0: 705f 636f 6e66 6c69 6374 7322 3a20 6174  p_conflicts": at
-00001dc0: 7472 7320 6672 6f6d 2061 6c6c 206f 626a  trs from all obj
-00001dd0: 6563 7473 2061 7265 2063 6f6d 6269 6e65  ects are combine
-00001de0: 642c 2061 6e79 2074 6861 7420 6861 7665  d, any that have
-00001df0: 0a20 2020 2020 2020 2020 2074 6865 2073  .          the s
-00001e00: 616d 6520 6e61 6d65 2062 7574 2064 6966  ame name but dif
-00001e10: 6665 7265 6e74 2076 616c 7565 7320 6172  ferent values ar
-00001e20: 6520 6472 6f70 7065 642e 0a20 2020 2020  e dropped..     
-00001e30: 2020 202d 2022 6f76 6572 7269 6465 223a     - "override":
-00001e40: 2073 6b69 7020 636f 6d70 6172 696e 6720   skip comparing 
-00001e50: 616e 6420 636f 7079 2061 7474 7273 2066  and copy attrs f
-00001e60: 726f 6d20 7468 6520 6669 7273 7420 6461  rom the first da
-00001e70: 7461 7365 7420 746f 0a20 2020 2020 2020  taset to.       
-00001e80: 2020 2074 6865 2072 6573 756c 742e 0a0a     the result...
-00001e90: 2020 2020 2020 2020 4966 2061 2063 616c          If a cal
-00001ea0: 6c61 626c 652c 2069 7420 6d75 7374 2065  lable, it must e
-00001eb0: 7870 6563 7420 6120 7365 7175 656e 6365  xpect a sequence
-00001ec0: 206f 6620 6060 6174 7472 7360 6020 6469   of ``attrs`` di
-00001ed0: 6374 7320 616e 6420 6120 636f 6e74 6578  cts and a contex
-00001ee0: 7420 6f62 6a65 6374 0a20 2020 2020 2020  t object.       
-00001ef0: 2061 7320 6974 7320 6f6e 6c79 2070 6172   as its only par
-00001f00: 616d 6574 6572 732e 0a0a 2020 2020 5265  ameters...    Re
-00001f10: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00001f20: 2d0a 2020 2020 4469 6374 696f 6e61 7269  -.    Dictionari
-00001f30: 6573 206f 6620 5661 7269 6162 6c65 2061  es of Variable a
-00001f40: 6e64 2049 6e64 6578 206f 626a 6563 7473  nd Index objects
-00001f50: 2077 6974 6820 6d65 7267 6564 2063 6f6f   with merged coo
-00001f60: 7264 696e 6174 6573 2e0a 2020 2020 2222  rdinates..    ""
-00001f70: 220a 2020 2020 636f 6f72 6473 5f6c 6973  ".    coords_lis
-00001f80: 7420 3d20 5f67 6574 5f63 6f6f 7264 735f  t = _get_coords_
-00001f90: 6c69 7374 2861 7267 7329 0a0a 2020 2020  list(args)..    
-00001fa0: 6966 206c 656e 2863 6f6f 7264 735f 6c69  if len(coords_li
-00001fb0: 7374 2920 3d3d 2031 2061 6e64 206e 6f74  st) == 1 and not
-00001fc0: 2065 7863 6c75 6465 5f64 696d 733a 0a20   exclude_dims:. 
-00001fd0: 2020 2020 2020 2023 2077 6520 6361 6e20         # we can 
-00001fe0: 736b 6970 2074 6865 2065 7870 656e 7369  skip the expensi
-00001ff0: 7665 206d 6572 6765 0a20 2020 2020 2020  ve merge.       
-00002000: 2028 756e 7061 636b 6564 5f63 6f6f 7264   (unpacked_coord
-00002010: 732c 2920 3d20 636f 6f72 6473 5f6c 6973  s,) = coords_lis
-00002020: 740a 2020 2020 2020 2020 6d65 7267 6564  t.        merged
-00002030: 5f76 6172 7320 3d20 6469 6374 2875 6e70  _vars = dict(unp
-00002040: 6163 6b65 645f 636f 6f72 6473 2e76 6172  acked_coords.var
-00002050: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
-00002060: 6d65 7267 6564 5f69 6e64 6578 6573 203d  merged_indexes =
-00002070: 2064 6963 7428 756e 7061 636b 6564 5f63   dict(unpacked_c
-00002080: 6f6f 7264 732e 7869 6e64 6578 6573 290a  oords.xindexes).
-00002090: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000020a0: 2020 6d65 7267 6564 5f76 6172 732c 206d    merged_vars, m
-000020b0: 6572 6765 645f 696e 6465 7865 7320 3d20  erged_indexes = 
-000020c0: 6d65 7267 655f 636f 6f72 6469 6e61 7465  merge_coordinate
-000020d0: 735f 7769 7468 6f75 745f 616c 6967 6e28  s_without_align(
-000020e0: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
-000020f0: 7264 735f 6c69 7374 2c20 6578 636c 7564  rds_list, exclud
-00002100: 655f 6469 6d73 3d65 7863 6c75 6465 5f64  e_dims=exclude_d
-00002110: 696d 732c 2063 6f6d 6269 6e65 5f61 7474  ims, combine_att
-00002120: 7273 3d63 6f6d 6269 6e65 5f61 7474 7273  rs=combine_attrs
-00002130: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00002140: 6f75 7470 7574 5f63 6f6f 7264 7320 3d20  output_coords = 
-00002150: 5b5d 0a20 2020 206f 7574 7075 745f 696e  [].    output_in
-00002160: 6465 7865 7320 3d20 5b5d 0a20 2020 2066  dexes = [].    f
-00002170: 6f72 206f 7574 7075 745f 6469 6d73 2069  or output_dims i
-00002180: 6e20 7369 676e 6174 7572 652e 6f75 7470  n signature.outp
-00002190: 7574 5f63 6f72 655f 6469 6d73 3a0a 2020  ut_core_dims:.  
-000021a0: 2020 2020 2020 6472 6f70 7065 645f 6469        dropped_di
-000021b0: 6d73 203d 2073 6967 6e61 7475 7265 2e61  ms = signature.a
-000021c0: 6c6c 5f69 6e70 7574 5f63 6f72 655f 6469  ll_input_core_di
-000021d0: 6d73 202d 2073 6574 286f 7574 7075 745f  ms - set(output_
-000021e0: 6469 6d73 290a 2020 2020 2020 2020 6966  dims).        if
-000021f0: 2064 726f 7070 6564 5f64 696d 733a 0a20   dropped_dims:. 
-00002200: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-00002210: 7265 645f 636f 6f72 6473 203d 207b 0a20  red_coords = {. 
-00002220: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00002230: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
-00002240: 6d65 7267 6564 5f76 6172 732e 6974 656d  merged_vars.item
-00002250: 7328 2920 6966 2064 726f 7070 6564 5f64  s() if dropped_d
-00002260: 696d 732e 6973 6469 736a 6f69 6e74 2876  ims.isdisjoint(v
-00002270: 2e64 696d 7329 0a20 2020 2020 2020 2020  .dims).         
-00002280: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00002290: 2066 696c 7465 7265 645f 696e 6465 7865   filtered_indexe
-000022a0: 7320 3d20 6669 6c74 6572 5f69 6e64 6578  s = filter_index
-000022b0: 6573 5f66 726f 6d5f 636f 6f72 6473 280a  es_from_coords(.
-000022c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000022d0: 6d65 7267 6564 5f69 6e64 6578 6573 2c20  merged_indexes, 
-000022e0: 7365 7428 6669 6c74 6572 6564 5f63 6f6f  set(filtered_coo
-000022f0: 7264 7329 0a20 2020 2020 2020 2020 2020  rds).           
-00002300: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
-00002310: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00002320: 7465 7265 645f 636f 6f72 6473 203d 206d  tered_coords = m
-00002330: 6572 6765 645f 7661 7273 0a20 2020 2020  erged_vars.     
-00002340: 2020 2020 2020 2066 696c 7465 7265 645f         filtered_
-00002350: 696e 6465 7865 7320 3d20 6d65 7267 6564  indexes = merged
-00002360: 5f69 6e64 6578 6573 0a20 2020 2020 2020  _indexes.       
-00002370: 206f 7574 7075 745f 636f 6f72 6473 2e61   output_coords.a
-00002380: 7070 656e 6428 6669 6c74 6572 6564 5f63  ppend(filtered_c
-00002390: 6f6f 7264 7329 0a20 2020 2020 2020 206f  oords).        o
-000023a0: 7574 7075 745f 696e 6465 7865 732e 6170  utput_indexes.ap
-000023b0: 7065 6e64 2866 696c 7465 7265 645f 696e  pend(filtered_in
-000023c0: 6465 7865 7329 0a0a 2020 2020 7265 7475  dexes)..    retu
-000023d0: 726e 206f 7574 7075 745f 636f 6f72 6473  rn output_coords
-000023e0: 2c20 6f75 7470 7574 5f69 6e64 6578 6573  , output_indexes
-000023f0: 0a0a 0a64 6566 2061 7070 6c79 5f64 6174  ...def apply_dat
-00002400: 6161 7272 6179 5f76 6675 6e63 280a 2020  aarray_vfunc(.  
-00002410: 2020 6675 6e63 2c0a 2020 2020 2a61 7267    func,.    *arg
-00002420: 732c 0a20 2020 2073 6967 6e61 7475 7265  s,.    signature
-00002430: 3a20 5f55 4675 6e63 5369 676e 6174 7572  : _UFuncSignatur
-00002440: 652c 0a20 2020 206a 6f69 6e3a 204a 6f69  e,.    join: Joi
-00002450: 6e4f 7074 696f 6e73 203d 2022 696e 6e65  nOptions = "inne
-00002460: 7222 2c0a 2020 2020 6578 636c 7564 655f  r",.    exclude_
-00002470: 6469 6d73 3d66 726f 7a65 6e73 6574 2829  dims=frozenset()
-00002480: 2c0a 2020 2020 6b65 6570 5f61 7474 7273  ,.    keep_attrs
-00002490: 3d22 6f76 6572 7269 6465 222c 0a29 202d  ="override",.) -
-000024a0: 3e20 7475 706c 655b 4461 7461 4172 7261  > tuple[DataArra
-000024b0: 792c 202e 2e2e 5d20 7c20 4461 7461 4172  y, ...] | DataAr
-000024c0: 7261 793a 0a20 2020 2022 2222 4170 706c  ray:.    """Appl
-000024d0: 7920 6120 7661 7269 6162 6c65 206c 6576  y a variable lev
-000024e0: 656c 2066 756e 6374 696f 6e20 6f76 6572  el function over
-000024f0: 2044 6174 6141 7272 6179 2c20 5661 7269   DataArray, Vari
-00002500: 6162 6c65 2061 6e64 2f6f 7220 6e64 6172  able and/or ndar
-00002510: 7261 790a 2020 2020 6f62 6a65 6374 732e  ray.    objects.
-00002520: 0a20 2020 2022 2222 0a20 2020 2066 726f  .    """.    fro
-00002530: 6d20 7861 7272 6179 2e63 6f72 652e 6461  m xarray.core.da
-00002540: 7461 6172 7261 7920 696d 706f 7274 2044  taarray import D
-00002550: 6174 6141 7272 6179 0a0a 2020 2020 6966  ataArray..    if
-00002560: 206c 656e 2861 7267 7329 203e 2031 3a0a   len(args) > 1:.
-00002570: 2020 2020 2020 2020 6172 6773 203d 2064          args = d
-00002580: 6565 705f 616c 6967 6e28 0a20 2020 2020  eep_align(.     
-00002590: 2020 2020 2020 2061 7267 732c 206a 6f69         args, joi
-000025a0: 6e3d 6a6f 696e 2c20 636f 7079 3d46 616c  n=join, copy=Fal
-000025b0: 7365 2c20 6578 636c 7564 653d 6578 636c  se, exclude=excl
-000025c0: 7564 655f 6469 6d73 2c20 7261 6973 655f  ude_dims, raise_
-000025d0: 6f6e 5f69 6e76 616c 6964 3d46 616c 7365  on_invalid=False
-000025e0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000025f0: 6f62 6a73 203d 205f 616c 6c5f 6f66 5f74  objs = _all_of_t
-00002600: 7970 6528 6172 6773 2c20 4461 7461 4172  ype(args, DataAr
-00002610: 7261 7929 0a0a 2020 2020 6966 206b 6565  ray)..    if kee
-00002620: 705f 6174 7472 7320 3d3d 2022 6472 6f70  p_attrs == "drop
-00002630: 223a 0a20 2020 2020 2020 206e 616d 6520  ":.        name 
-00002640: 3d20 7265 7375 6c74 5f6e 616d 6528 6172  = result_name(ar
-00002650: 6773 290a 2020 2020 656c 7365 3a0a 2020  gs).    else:.  
-00002660: 2020 2020 2020 6669 7273 745f 6f62 6a20        first_obj 
-00002670: 3d20 5f66 6972 7374 5f6f 665f 7479 7065  = _first_of_type
-00002680: 2861 7267 732c 2044 6174 6141 7272 6179  (args, DataArray
-00002690: 290a 2020 2020 2020 2020 6e61 6d65 203d  ).        name =
-000026a0: 2066 6972 7374 5f6f 626a 2e6e 616d 650a   first_obj.name.
-000026b0: 2020 2020 7265 7375 6c74 5f63 6f6f 7264      result_coord
-000026c0: 732c 2072 6573 756c 745f 696e 6465 7865  s, result_indexe
-000026d0: 7320 3d20 6275 696c 645f 6f75 7470 7574  s = build_output
-000026e0: 5f63 6f6f 7264 735f 616e 645f 696e 6465  _coords_and_inde
-000026f0: 7865 7328 0a20 2020 2020 2020 2061 7267  xes(.        arg
-00002700: 732c 2073 6967 6e61 7475 7265 2c20 6578  s, signature, ex
-00002710: 636c 7564 655f 6469 6d73 2c20 636f 6d62  clude_dims, comb
-00002720: 696e 655f 6174 7472 733d 6b65 6570 5f61  ine_attrs=keep_a
-00002730: 7474 7273 0a20 2020 2029 0a0a 2020 2020  ttrs.    )..    
-00002740: 6461 7461 5f76 6172 7320 3d20 5b67 6574  data_vars = [get
-00002750: 6174 7472 2861 2c20 2276 6172 6961 626c  attr(a, "variabl
-00002760: 6522 2c20 6129 2066 6f72 2061 2069 6e20  e", a) for a in 
-00002770: 6172 6773 5d0a 2020 2020 7265 7375 6c74  args].    result
-00002780: 5f76 6172 203d 2066 756e 6328 2a64 6174  _var = func(*dat
-00002790: 615f 7661 7273 290a 0a20 2020 206f 7574  a_vars)..    out
-000027a0: 3a20 7475 706c 655b 4461 7461 4172 7261  : tuple[DataArra
-000027b0: 792c 202e 2e2e 5d20 7c20 4461 7461 4172  y, ...] | DataAr
-000027c0: 7261 790a 2020 2020 6966 2073 6967 6e61  ray.    if signa
-000027d0: 7475 7265 2e6e 756d 5f6f 7574 7075 7473  ture.num_outputs
-000027e0: 203e 2031 3a0a 2020 2020 2020 2020 6f75   > 1:.        ou
-000027f0: 7420 3d20 7475 706c 6528 0a20 2020 2020  t = tuple(.     
-00002800: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
-00002810: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00002820: 2020 7661 7269 6162 6c65 2c20 636f 6f72    variable, coor
-00002830: 6473 3d63 6f6f 7264 732c 2069 6e64 6578  ds=coords, index
-00002840: 6573 3d69 6e64 6578 6573 2c20 6e61 6d65  es=indexes, name
-00002850: 3d6e 616d 652c 2066 6173 7470 6174 683d  =name, fastpath=
-00002860: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00002870: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
-00002880: 6f72 2076 6172 6961 626c 652c 2063 6f6f  or variable, coo
-00002890: 7264 732c 2069 6e64 6578 6573 2069 6e20  rds, indexes in 
-000028a0: 7a69 7028 0a20 2020 2020 2020 2020 2020  zip(.           
-000028b0: 2020 2020 2072 6573 756c 745f 7661 722c       result_var,
-000028c0: 2072 6573 756c 745f 636f 6f72 6473 2c20   result_coords, 
-000028d0: 7265 7375 6c74 5f69 6e64 6578 6573 0a20  result_indexes. 
-000028e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000028f0: 2020 2020 2029 0a20 2020 2065 6c73 653a       ).    else:
-00002900: 0a20 2020 2020 2020 2028 636f 6f72 6473  .        (coords
-00002910: 2c29 203d 2072 6573 756c 745f 636f 6f72  ,) = result_coor
-00002920: 6473 0a20 2020 2020 2020 2028 696e 6465  ds.        (inde
-00002930: 7865 732c 2920 3d20 7265 7375 6c74 5f69  xes,) = result_i
-00002940: 6e64 6578 6573 0a20 2020 2020 2020 206f  ndexes.        o
-00002950: 7574 203d 2044 6174 6141 7272 6179 280a  ut = DataArray(.
-00002960: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00002970: 6c74 5f76 6172 2c20 636f 6f72 6473 3d63  lt_var, coords=c
-00002980: 6f6f 7264 732c 2069 6e64 6578 6573 3d69  oords, indexes=i
-00002990: 6e64 6578 6573 2c20 6e61 6d65 3d6e 616d  ndexes, name=nam
-000029a0: 652c 2066 6173 7470 6174 683d 5472 7565  e, fastpath=True
-000029b0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000029c0: 6174 7472 7320 3d20 6d65 7267 655f 6174  attrs = merge_at
-000029d0: 7472 7328 5b78 2e61 7474 7273 2066 6f72  trs([x.attrs for
-000029e0: 2078 2069 6e20 6f62 6a73 5d2c 2063 6f6d   x in objs], com
-000029f0: 6269 6e65 5f61 7474 7273 3d6b 6565 705f  bine_attrs=keep_
-00002a00: 6174 7472 7329 0a20 2020 2069 6620 6973  attrs).    if is
-00002a10: 696e 7374 616e 6365 286f 7574 2c20 7475  instance(out, tu
-00002a20: 706c 6529 3a0a 2020 2020 2020 2020 666f  ple):.        fo
-00002a30: 7220 6461 2069 6e20 6f75 743a 0a20 2020  r da in out:.   
-00002a40: 2020 2020 2020 2020 2064 612e 6174 7472           da.attr
-00002a50: 7320 3d20 6174 7472 730a 2020 2020 656c  s = attrs.    el
-00002a60: 7365 3a0a 2020 2020 2020 2020 6f75 742e  se:.        out.
-00002a70: 6174 7472 7320 3d20 6174 7472 730a 0a20  attrs = attrs.. 
-00002a80: 2020 2072 6574 7572 6e20 6f75 740a 0a0a     return out...
-00002a90: 6465 6620 6f72 6465 7265 645f 7365 745f  def ordered_set_
-00002aa0: 756e 696f 6e28 616c 6c5f 6b65 7973 3a20  union(all_keys: 
-00002ab0: 6c69 7374 5b49 7465 7261 626c 655d 2920  list[Iterable]) 
-00002ac0: 2d3e 2049 7465 7261 626c 653a 0a20 2020  -> Iterable:.   
-00002ad0: 2072 6574 7572 6e20 7b6b 6579 3a20 4e6f   return {key: No
-00002ae0: 6e65 2066 6f72 206b 6579 7320 696e 2061  ne for keys in a
-00002af0: 6c6c 5f6b 6579 7320 666f 7220 6b65 7920  ll_keys for key 
-00002b00: 696e 206b 6579 737d 2e6b 6579 7328 290a  in keys}.keys().
-00002b10: 0a0a 6465 6620 6f72 6465 7265 645f 7365  ..def ordered_se
-00002b20: 745f 696e 7465 7273 6563 7469 6f6e 2861  t_intersection(a
-00002b30: 6c6c 5f6b 6579 733a 206c 6973 745b 4974  ll_keys: list[It
-00002b40: 6572 6162 6c65 5d29 202d 3e20 4974 6572  erable]) -> Iter
-00002b50: 6162 6c65 3a0a 2020 2020 696e 7465 7273  able:.    inters
-00002b60: 6563 7469 6f6e 203d 2073 6574 2861 6c6c  ection = set(all
-00002b70: 5f6b 6579 735b 305d 290a 2020 2020 666f  _keys[0]).    fo
-00002b80: 7220 6b65 7973 2069 6e20 616c 6c5f 6b65  r keys in all_ke
-00002b90: 7973 5b31 3a5d 3a0a 2020 2020 2020 2020  ys[1:]:.        
-00002ba0: 696e 7465 7273 6563 7469 6f6e 2e69 6e74  intersection.int
-00002bb0: 6572 7365 6374 696f 6e5f 7570 6461 7465  ersection_update
-00002bc0: 286b 6579 7329 0a20 2020 2072 6574 7572  (keys).    retur
-00002bd0: 6e20 5b6b 6579 2066 6f72 206b 6579 2069  n [key for key i
-00002be0: 6e20 616c 6c5f 6b65 7973 5b30 5d20 6966  n all_keys[0] if
-00002bf0: 206b 6579 2069 6e20 696e 7465 7273 6563   key in intersec
-00002c00: 7469 6f6e 5d0a 0a0a 6465 6620 6173 7365  tion]...def asse
-00002c10: 7274 5f61 6e64 5f72 6574 7572 6e5f 6578  rt_and_return_ex
-00002c20: 6163 745f 6d61 7463 6828 616c 6c5f 6b65  act_match(all_ke
-00002c30: 7973 293a 0a20 2020 2066 6972 7374 5f6b  ys):.    first_k
-00002c40: 6579 7320 3d20 616c 6c5f 6b65 7973 5b30  eys = all_keys[0
-00002c50: 5d0a 2020 2020 666f 7220 6b65 7973 2069  ].    for keys i
-00002c60: 6e20 616c 6c5f 6b65 7973 5b31 3a5d 3a0a  n all_keys[1:]:.
-00002c70: 2020 2020 2020 2020 6966 206b 6579 7320          if keys 
-00002c80: 213d 2066 6972 7374 5f6b 6579 733a 0a20  != first_keys:. 
-00002c90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00002ca0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00002cb0: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
-00002cc0: 6163 7420 6d61 7463 6820 7265 7175 6972  act match requir
-00002cd0: 6564 2066 6f72 2061 6c6c 2064 6174 6120  ed for all data 
-00002ce0: 7661 7269 6162 6c65 206e 616d 6573 2c20  variable names, 
-00002cf0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00002d00: 2020 6622 6275 7420 7b6b 6579 7321 727d    f"but {keys!r}
-00002d10: 2021 3d20 7b66 6972 7374 5f6b 6579 7321   != {first_keys!
-00002d20: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
-00002d30: 290a 2020 2020 7265 7475 726e 2066 6972  ).    return fir
-00002d40: 7374 5f6b 6579 730a 0a0a 5f4a 4f49 4e45  st_keys..._JOINE
-00002d50: 5253 3a20 6469 6374 5b73 7472 2c20 4361  RS: dict[str, Ca
-00002d60: 6c6c 6162 6c65 5d20 3d20 7b0a 2020 2020  llable] = {.    
-00002d70: 2269 6e6e 6572 223a 206f 7264 6572 6564  "inner": ordered
-00002d80: 5f73 6574 5f69 6e74 6572 7365 6374 696f  _set_intersectio
-00002d90: 6e2c 0a20 2020 2022 6f75 7465 7222 3a20  n,.    "outer": 
-00002da0: 6f72 6465 7265 645f 7365 745f 756e 696f  ordered_set_unio
-00002db0: 6e2c 0a20 2020 2022 6c65 6674 223a 206f  n,.    "left": o
-00002dc0: 7065 7261 746f 722e 6974 656d 6765 7474  perator.itemgett
-00002dd0: 6572 2830 292c 0a20 2020 2022 7269 6768  er(0),.    "righ
-00002de0: 7422 3a20 6f70 6572 6174 6f72 2e69 7465  t": operator.ite
-00002df0: 6d67 6574 7465 7228 2d31 292c 0a20 2020  mgetter(-1),.   
-00002e00: 2022 6578 6163 7422 3a20 6173 7365 7274   "exact": assert
-00002e10: 5f61 6e64 5f72 6574 7572 6e5f 6578 6163  _and_return_exac
-00002e20: 745f 6d61 7463 682c 0a7d 0a0a 0a64 6566  t_match,.}...def
-00002e30: 206a 6f69 6e5f 6469 6374 5f6b 6579 7328   join_dict_keys(
-00002e40: 6f62 6a65 6374 733a 2049 7465 7261 626c  objects: Iterabl
-00002e50: 655b 4d61 7070 696e 6720 7c20 416e 795d  e[Mapping | Any]
-00002e60: 2c20 686f 773a 2073 7472 203d 2022 696e  , how: str = "in
-00002e70: 6e65 7222 2920 2d3e 2049 7465 7261 626c  ner") -> Iterabl
-00002e80: 653a 0a20 2020 206a 6f69 6e65 7220 3d20  e:.    joiner = 
-00002e90: 5f4a 4f49 4e45 5253 5b68 6f77 5d0a 2020  _JOINERS[how].  
-00002ea0: 2020 616c 6c5f 6b65 7973 203d 205b 6f62    all_keys = [ob
-00002eb0: 6a2e 6b65 7973 2829 2066 6f72 206f 626a  j.keys() for obj
-00002ec0: 2069 6e20 6f62 6a65 6374 7320 6966 2068   in objects if h
-00002ed0: 6173 6174 7472 286f 626a 2c20 226b 6579  asattr(obj, "key
-00002ee0: 7322 295d 0a20 2020 2072 6574 7572 6e20  s")].    return 
-00002ef0: 6a6f 696e 6572 2861 6c6c 5f6b 6579 7329  joiner(all_keys)
-00002f00: 0a0a 0a64 6566 2063 6f6c 6c65 6374 5f64  ...def collect_d
-00002f10: 6963 745f 7661 6c75 6573 280a 2020 2020  ict_values(.    
-00002f20: 6f62 6a65 6374 733a 2049 7465 7261 626c  objects: Iterabl
-00002f30: 655b 4d61 7070 696e 6720 7c20 416e 795d  e[Mapping | Any]
-00002f40: 2c20 6b65 7973 3a20 4974 6572 6162 6c65  , keys: Iterable
-00002f50: 2c20 6669 6c6c 5f76 616c 7565 3a20 6f62  , fill_value: ob
-00002f60: 6a65 6374 203d 204e 6f6e 650a 2920 2d3e  ject = None.) ->
-00002f70: 206c 6973 745b 6c69 7374 5d3a 0a20 2020   list[list]:.   
-00002f80: 2072 6574 7572 6e20 5b0a 2020 2020 2020   return [.      
-00002f90: 2020 5b6f 626a 2e67 6574 286b 6579 2c20    [obj.get(key, 
-00002fa0: 6669 6c6c 5f76 616c 7565 2920 6966 2069  fill_value) if i
-00002fb0: 735f 6469 6374 5f6c 696b 6528 6f62 6a29  s_dict_like(obj)
-00002fc0: 2065 6c73 6520 6f62 6a20 666f 7220 6f62   else obj for ob
-00002fd0: 6a20 696e 206f 626a 6563 7473 5d0a 2020  j in objects].  
-00002fe0: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
-00002ff0: 206b 6579 730a 2020 2020 5d0a 0a0a 6465   keys.    ]...de
-00003000: 6620 5f61 735f 7661 7269 6162 6c65 735f  f _as_variables_
-00003010: 6f72 5f76 6172 6961 626c 6528 6172 6729  or_variable(arg)
-00003020: 3a0a 2020 2020 7472 793a 0a20 2020 2020  :.    try:.     
-00003030: 2020 2072 6574 7572 6e20 6172 672e 7661     return arg.va
-00003040: 7269 6162 6c65 730a 2020 2020 6578 6365  riables.    exce
-00003050: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
-00003060: 723a 0a20 2020 2020 2020 2074 7279 3a0a  r:.        try:.
-00003070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00003080: 726e 2061 7267 2e76 6172 6961 626c 650a  rn arg.variable.
-00003090: 2020 2020 2020 2020 6578 6365 7074 2041          except A
-000030a0: 7474 7269 6275 7465 4572 726f 723a 0a20  ttributeError:. 
-000030b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000030c0: 6e20 6172 670a 0a0a 6465 6620 5f75 6e70  n arg...def _unp
-000030d0: 6163 6b5f 6469 6374 5f74 7570 6c65 7328  ack_dict_tuples(
-000030e0: 0a20 2020 2072 6573 756c 745f 7661 7273  .    result_vars
-000030f0: 3a20 4d61 7070 696e 675b 416e 792c 2074  : Mapping[Any, t
-00003100: 7570 6c65 5b56 6172 6961 626c 652c 202e  uple[Variable, .
-00003110: 2e2e 5d5d 2c20 6e75 6d5f 6f75 7470 7574  ..]], num_output
-00003120: 733a 2069 6e74 0a29 202d 3e20 7475 706c  s: int.) -> tupl
-00003130: 655b 6469 6374 5b48 6173 6861 626c 652c  e[dict[Hashable,
-00003140: 2056 6172 6961 626c 655d 2c20 2e2e 2e5d   Variable], ...]
-00003150: 3a0a 2020 2020 6f75 743a 2074 7570 6c65  :.    out: tuple
-00003160: 5b64 6963 745b 4861 7368 6162 6c65 2c20  [dict[Hashable, 
-00003170: 5661 7269 6162 6c65 5d2c 202e 2e2e 5d20  Variable], ...] 
-00003180: 3d20 7475 706c 6528 7b7d 2066 6f72 205f  = tuple({} for _
-00003190: 2069 6e20 7261 6e67 6528 6e75 6d5f 6f75   in range(num_ou
-000031a0: 7470 7574 7329 290a 2020 2020 666f 7220  tputs)).    for 
-000031b0: 6e61 6d65 2c20 7661 6c75 6573 2069 6e20  name, values in 
-000031c0: 7265 7375 6c74 5f76 6172 732e 6974 656d  result_vars.item
-000031d0: 7328 293a 0a20 2020 2020 2020 2066 6f72  s():.        for
-000031e0: 2076 616c 7565 2c20 7265 7375 6c74 735f   value, results_
-000031f0: 6469 6374 2069 6e20 7a69 7028 7661 6c75  dict in zip(valu
-00003200: 6573 2c20 6f75 7429 3a0a 2020 2020 2020  es, out):.      
-00003210: 2020 2020 2020 7265 7375 6c74 735f 6469        results_di
-00003220: 6374 5b6e 616d 655d 203d 2076 616c 7565  ct[name] = value
-00003230: 0a20 2020 2072 6574 7572 6e20 6f75 740a  .    return out.
-00003240: 0a0a 6465 6620 6170 706c 795f 6469 6374  ..def apply_dict
-00003250: 5f6f 665f 7661 7269 6162 6c65 735f 7666  _of_variables_vf
-00003260: 756e 6328 0a20 2020 2066 756e 632c 202a  unc(.    func, *
-00003270: 6172 6773 2c20 7369 676e 6174 7572 653a  args, signature:
-00003280: 205f 5546 756e 6353 6967 6e61 7475 7265   _UFuncSignature
-00003290: 2c20 6a6f 696e 3d22 696e 6e65 7222 2c20  , join="inner", 
-000032a0: 6669 6c6c 5f76 616c 7565 3d4e 6f6e 650a  fill_value=None.
-000032b0: 293a 0a20 2020 2022 2222 4170 706c 7920  ):.    """Apply 
-000032c0: 6120 7661 7269 6162 6c65 206c 6576 656c  a variable level
-000032d0: 2066 756e 6374 696f 6e20 6f76 6572 2064   function over d
-000032e0: 6963 7473 206f 6620 4461 7461 4172 7261  icts of DataArra
-000032f0: 792c 2044 6174 6141 7272 6179 2c0a 2020  y, DataArray,.  
-00003300: 2020 5661 7269 6162 6c65 2061 6e64 206e    Variable and n
-00003310: 6461 7272 6179 206f 626a 6563 7473 2e0a  darray objects..
-00003320: 2020 2020 2222 220a 2020 2020 6172 6773      """.    args
-00003330: 203d 2074 7570 6c65 285f 6173 5f76 6172   = tuple(_as_var
-00003340: 6961 626c 6573 5f6f 725f 7661 7269 6162  iables_or_variab
-00003350: 6c65 2861 7267 2920 666f 7220 6172 6720  le(arg) for arg 
-00003360: 696e 2061 7267 7329 0a20 2020 206e 616d  in args).    nam
-00003370: 6573 203d 206a 6f69 6e5f 6469 6374 5f6b  es = join_dict_k
-00003380: 6579 7328 6172 6773 2c20 686f 773d 6a6f  eys(args, how=jo
-00003390: 696e 290a 2020 2020 6772 6f75 7065 645f  in).    grouped_
-000033a0: 6279 5f6e 616d 6520 3d20 636f 6c6c 6563  by_name = collec
-000033b0: 745f 6469 6374 5f76 616c 7565 7328 6172  t_dict_values(ar
-000033c0: 6773 2c20 6e61 6d65 732c 2066 696c 6c5f  gs, names, fill_
-000033d0: 7661 6c75 6529 0a0a 2020 2020 7265 7375  value)..    resu
-000033e0: 6c74 5f76 6172 7320 3d20 7b7d 0a20 2020  lt_vars = {}.   
-000033f0: 2066 6f72 206e 616d 652c 2076 6172 6961   for name, varia
-00003400: 626c 655f 6172 6773 2069 6e20 7a69 7028  ble_args in zip(
-00003410: 6e61 6d65 732c 2067 726f 7570 6564 5f62  names, grouped_b
-00003420: 795f 6e61 6d65 293a 0a20 2020 2020 2020  y_name):.       
-00003430: 2072 6573 756c 745f 7661 7273 5b6e 616d   result_vars[nam
-00003440: 655d 203d 2066 756e 6328 2a76 6172 6961  e] = func(*varia
-00003450: 626c 655f 6172 6773 290a 0a20 2020 2069  ble_args)..    i
-00003460: 6620 7369 676e 6174 7572 652e 6e75 6d5f  f signature.num_
-00003470: 6f75 7470 7574 7320 3e20 313a 0a20 2020  outputs > 1:.   
-00003480: 2020 2020 2072 6574 7572 6e20 5f75 6e70       return _unp
-00003490: 6163 6b5f 6469 6374 5f74 7570 6c65 7328  ack_dict_tuples(
-000034a0: 7265 7375 6c74 5f76 6172 732c 2073 6967  result_vars, sig
-000034b0: 6e61 7475 7265 2e6e 756d 5f6f 7574 7075  nature.num_outpu
-000034c0: 7473 290a 2020 2020 656c 7365 3a0a 2020  ts).    else:.  
-000034d0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-000034e0: 756c 745f 7661 7273 0a0a 0a64 6566 205f  ult_vars...def _
-000034f0: 6661 7374 5f64 6174 6173 6574 280a 2020  fast_dataset(.  
-00003500: 2020 7661 7269 6162 6c65 733a 2064 6963    variables: dic
-00003510: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
-00003520: 6162 6c65 5d2c 0a20 2020 2063 6f6f 7264  able],.    coord
-00003530: 5f76 6172 6961 626c 6573 3a20 4d61 7070  _variables: Mapp
-00003540: 696e 675b 4861 7368 6162 6c65 2c20 5661  ing[Hashable, Va
-00003550: 7269 6162 6c65 5d2c 0a20 2020 2069 6e64  riable],.    ind
-00003560: 6578 6573 3a20 6469 6374 5b48 6173 6861  exes: dict[Hasha
-00003570: 626c 652c 2049 6e64 6578 5d2c 0a29 202d  ble, Index],.) -
-00003580: 3e20 4461 7461 7365 743a 0a20 2020 2022  > Dataset:.    "
-00003590: 2222 4372 6561 7465 2061 2064 6174 6173  ""Create a datas
-000035a0: 6574 2061 7320 7175 6963 6b6c 7920 6173  et as quickly as
-000035b0: 2070 6f73 7369 626c 652e 0a0a 2020 2020   possible...    
-000035c0: 4265 7761 7265 3a20 7468 6520 6076 6172  Beware: the `var
-000035d0: 6961 626c 6573 6020 6469 6374 2069 7320  iables` dict is 
-000035e0: 6d6f 6469 6669 6564 2049 4e50 4c41 4345  modified INPLACE
-000035f0: 2e0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
-00003600: 6f6d 2078 6172 7261 792e 636f 7265 2e64  om xarray.core.d
-00003610: 6174 6173 6574 2069 6d70 6f72 7420 4461  ataset import Da
-00003620: 7461 7365 740a 0a20 2020 2076 6172 6961  taset..    varia
-00003630: 626c 6573 2e75 7064 6174 6528 636f 6f72  bles.update(coor
-00003640: 645f 7661 7269 6162 6c65 7329 0a20 2020  d_variables).   
-00003650: 2063 6f6f 7264 5f6e 616d 6573 203d 2073   coord_names = s
-00003660: 6574 2863 6f6f 7264 5f76 6172 6961 626c  et(coord_variabl
-00003670: 6573 290a 2020 2020 7265 7475 726e 2044  es).    return D
-00003680: 6174 6173 6574 2e5f 636f 6e73 7472 7563  ataset._construc
-00003690: 745f 6469 7265 6374 2876 6172 6961 626c  t_direct(variabl
-000036a0: 6573 2c20 636f 6f72 645f 6e61 6d65 732c  es, coord_names,
-000036b0: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
-000036c0: 290a 0a0a 6465 6620 6170 706c 795f 6461  )...def apply_da
-000036d0: 7461 7365 745f 7666 756e 6328 0a20 2020  taset_vfunc(.   
-000036e0: 2066 756e 632c 0a20 2020 202a 6172 6773   func,.    *args
-000036f0: 2c0a 2020 2020 7369 676e 6174 7572 653a  ,.    signature:
-00003700: 205f 5546 756e 6353 6967 6e61 7475 7265   _UFuncSignature
-00003710: 2c0a 2020 2020 6a6f 696e 3d22 696e 6e65  ,.    join="inne
-00003720: 7222 2c0a 2020 2020 6461 7461 7365 745f  r",.    dataset_
-00003730: 6a6f 696e 3d22 6578 6163 7422 2c0a 2020  join="exact",.  
-00003740: 2020 6669 6c6c 5f76 616c 7565 3d5f 4e4f    fill_value=_NO
-00003750: 5f46 494c 4c5f 5641 4c55 452c 0a20 2020  _FILL_VALUE,.   
-00003760: 2065 7863 6c75 6465 5f64 696d 733d 6672   exclude_dims=fr
-00003770: 6f7a 656e 7365 7428 292c 0a20 2020 206b  ozenset(),.    k
-00003780: 6565 705f 6174 7472 733d 226f 7665 7272  eep_attrs="overr
-00003790: 6964 6522 2c0a 2920 2d3e 2044 6174 6173  ide",.) -> Datas
-000037a0: 6574 207c 2074 7570 6c65 5b44 6174 6173  et | tuple[Datas
-000037b0: 6574 2c20 2e2e 2e5d 3a0a 2020 2020 2222  et, ...]:.    ""
-000037c0: 2241 7070 6c79 2061 2076 6172 6961 626c  "Apply a variabl
-000037d0: 6520 6c65 7665 6c20 6675 6e63 7469 6f6e  e level function
-000037e0: 206f 7665 7220 4461 7461 7365 742c 2064   over Dataset, d
-000037f0: 6963 7420 6f66 2044 6174 6141 7272 6179  ict of DataArray
-00003800: 2c0a 2020 2020 4461 7461 4172 7261 792c  ,.    DataArray,
-00003810: 2056 6172 6961 626c 6520 616e 642f 6f72   Variable and/or
-00003820: 206e 6461 7272 6179 206f 626a 6563 7473   ndarray objects
-00003830: 2e0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
-00003840: 6f6d 2078 6172 7261 792e 636f 7265 2e64  om xarray.core.d
-00003850: 6174 6173 6574 2069 6d70 6f72 7420 4461  ataset import Da
-00003860: 7461 7365 740a 0a20 2020 2069 6620 6461  taset..    if da
-00003870: 7461 7365 745f 6a6f 696e 206e 6f74 2069  taset_join not i
-00003880: 6e20 5f4a 4f49 4e53 5f57 4954 484f 5554  n _JOINS_WITHOUT
-00003890: 5f46 494c 4c5f 5641 4c55 4553 2061 6e64  _FILL_VALUES and
-000038a0: 2066 696c 6c5f 7661 6c75 6520 6973 205f   fill_value is _
-000038b0: 4e4f 5f46 494c 4c5f 5641 4c55 453a 0a20  NO_FILL_VALUE:. 
-000038c0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-000038d0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-000038e0: 2020 2020 2274 6f20 6170 706c 7920 616e      "to apply an
-000038f0: 206f 7065 7261 7469 6f6e 2074 6f20 6461   operation to da
-00003900: 7461 7365 7473 2077 6974 6820 6469 6666  tasets with diff
-00003910: 6572 656e 7420 220a 2020 2020 2020 2020  erent ".        
-00003920: 2020 2020 2264 6174 6120 7661 7269 6162      "data variab
-00003930: 6c65 7320 7769 7468 2061 7070 6c79 5f75  les with apply_u
-00003940: 6675 6e63 2c20 796f 7520 6d75 7374 2073  func, you must s
-00003950: 7570 706c 7920 7468 6520 220a 2020 2020  upply the ".    
-00003960: 2020 2020 2020 2020 2264 6174 6173 6574          "dataset
-00003970: 5f66 696c 6c5f 7661 6c75 6520 6172 6775  _fill_value argu
-00003980: 6d65 6e74 2e22 0a20 2020 2020 2020 2029  ment.".        )
-00003990: 0a0a 2020 2020 6f62 6a73 203d 205f 616c  ..    objs = _al
-000039a0: 6c5f 6f66 5f74 7970 6528 6172 6773 2c20  l_of_type(args, 
-000039b0: 4461 7461 7365 7429 0a0a 2020 2020 6966  Dataset)..    if
-000039c0: 206c 656e 2861 7267 7329 203e 2031 3a0a   len(args) > 1:.
-000039d0: 2020 2020 2020 2020 6172 6773 203d 2064          args = d
-000039e0: 6565 705f 616c 6967 6e28 0a20 2020 2020  eep_align(.     
-000039f0: 2020 2020 2020 2061 7267 732c 206a 6f69         args, joi
-00003a00: 6e3d 6a6f 696e 2c20 636f 7079 3d46 616c  n=join, copy=Fal
-00003a10: 7365 2c20 6578 636c 7564 653d 6578 636c  se, exclude=excl
-00003a20: 7564 655f 6469 6d73 2c20 7261 6973 655f  ude_dims, raise_
-00003a30: 6f6e 5f69 6e76 616c 6964 3d46 616c 7365  on_invalid=False
-00003a40: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00003a50: 6c69 7374 5f6f 665f 636f 6f72 6473 2c20  list_of_coords, 
-00003a60: 6c69 7374 5f6f 665f 696e 6465 7865 7320  list_of_indexes 
-00003a70: 3d20 6275 696c 645f 6f75 7470 7574 5f63  = build_output_c
-00003a80: 6f6f 7264 735f 616e 645f 696e 6465 7865  oords_and_indexe
-00003a90: 7328 0a20 2020 2020 2020 2061 7267 732c  s(.        args,
-00003aa0: 2073 6967 6e61 7475 7265 2c20 6578 636c   signature, excl
-00003ab0: 7564 655f 6469 6d73 2c20 636f 6d62 696e  ude_dims, combin
-00003ac0: 655f 6174 7472 733d 6b65 6570 5f61 7474  e_attrs=keep_att
-00003ad0: 7273 0a20 2020 2029 0a20 2020 2061 7267  rs.    ).    arg
-00003ae0: 7320 3d20 7475 706c 6528 6765 7461 7474  s = tuple(getatt
-00003af0: 7228 6172 672c 2022 6461 7461 5f76 6172  r(arg, "data_var
-00003b00: 7322 2c20 6172 6729 2066 6f72 2061 7267  s", arg) for arg
-00003b10: 2069 6e20 6172 6773 290a 0a20 2020 2072   in args)..    r
-00003b20: 6573 756c 745f 7661 7273 203d 2061 7070  esult_vars = app
-00003b30: 6c79 5f64 6963 745f 6f66 5f76 6172 6961  ly_dict_of_varia
-00003b40: 626c 6573 5f76 6675 6e63 280a 2020 2020  bles_vfunc(.    
-00003b50: 2020 2020 6675 6e63 2c20 2a61 7267 732c      func, *args,
-00003b60: 2073 6967 6e61 7475 7265 3d73 6967 6e61   signature=signa
-00003b70: 7475 7265 2c20 6a6f 696e 3d64 6174 6173  ture, join=datas
-00003b80: 6574 5f6a 6f69 6e2c 2066 696c 6c5f 7661  et_join, fill_va
-00003b90: 6c75 653d 6669 6c6c 5f76 616c 7565 0a20  lue=fill_value. 
-00003ba0: 2020 2029 0a0a 2020 2020 6f75 743a 2044     )..    out: D
-00003bb0: 6174 6173 6574 207c 2074 7570 6c65 5b44  ataset | tuple[D
-00003bc0: 6174 6173 6574 2c20 2e2e 2e5d 0a20 2020  ataset, ...].   
-00003bd0: 2069 6620 7369 676e 6174 7572 652e 6e75   if signature.nu
-00003be0: 6d5f 6f75 7470 7574 7320 3e20 313a 0a20  m_outputs > 1:. 
-00003bf0: 2020 2020 2020 206f 7574 203d 2074 7570         out = tup
-00003c00: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00003c10: 5f66 6173 745f 6461 7461 7365 7428 2a61  _fast_dataset(*a
-00003c20: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-00003c30: 2066 6f72 2061 7267 7320 696e 207a 6970   for args in zip
-00003c40: 2872 6573 756c 745f 7661 7273 2c20 6c69  (result_vars, li
-00003c50: 7374 5f6f 665f 636f 6f72 6473 2c20 6c69  st_of_coords, li
-00003c60: 7374 5f6f 665f 696e 6465 7865 7329 0a20  st_of_indexes). 
-00003c70: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
-00003c80: 653a 0a20 2020 2020 2020 2028 636f 6f72  e:.        (coor
-00003c90: 645f 7661 7273 2c29 203d 206c 6973 745f  d_vars,) = list_
-00003ca0: 6f66 5f63 6f6f 7264 730a 2020 2020 2020  of_coords.      
-00003cb0: 2020 2869 6e64 6578 6573 2c29 203d 206c    (indexes,) = l
-00003cc0: 6973 745f 6f66 5f69 6e64 6578 6573 0a20  ist_of_indexes. 
-00003cd0: 2020 2020 2020 206f 7574 203d 205f 6661         out = _fa
-00003ce0: 7374 5f64 6174 6173 6574 2872 6573 756c  st_dataset(resul
-00003cf0: 745f 7661 7273 2c20 636f 6f72 645f 7661  t_vars, coord_va
-00003d00: 7273 2c20 696e 6465 7865 733d 696e 6465  rs, indexes=inde
-00003d10: 7865 7329 0a0a 2020 2020 6174 7472 7320  xes)..    attrs 
-00003d20: 3d20 6d65 7267 655f 6174 7472 7328 5b78  = merge_attrs([x
-00003d30: 2e61 7474 7273 2066 6f72 2078 2069 6e20  .attrs for x in 
-00003d40: 6f62 6a73 5d2c 2063 6f6d 6269 6e65 5f61  objs], combine_a
-00003d50: 7474 7273 3d6b 6565 705f 6174 7472 7329  ttrs=keep_attrs)
-00003d60: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00003d70: 6365 286f 7574 2c20 7475 706c 6529 3a0a  ce(out, tuple):.
-00003d80: 2020 2020 2020 2020 666f 7220 6473 2069          for ds i
-00003d90: 6e20 6f75 743a 0a20 2020 2020 2020 2020  n out:.         
-00003da0: 2020 2064 732e 6174 7472 7320 3d20 6174     ds.attrs = at
-00003db0: 7472 730a 2020 2020 656c 7365 3a0a 2020  trs.    else:.  
-00003dc0: 2020 2020 2020 6f75 742e 6174 7472 7320        out.attrs 
-00003dd0: 3d20 6174 7472 730a 0a20 2020 2072 6574  = attrs..    ret
-00003de0: 7572 6e20 6f75 740a 0a0a 6465 6620 5f69  urn out...def _i
-00003df0: 7465 725f 6f76 6572 5f73 656c 6563 7469  ter_over_selecti
-00003e00: 6f6e 7328 6f62 6a2c 2064 696d 2c20 7661  ons(obj, dim, va
-00003e10: 6c75 6573 293a 0a20 2020 2022 2222 4974  lues):.    """It
-00003e20: 6572 6174 6520 6f76 6572 2073 656c 6563  erate over selec
-00003e30: 7469 6f6e 7320 6f66 2061 6e20 7861 7272  tions of an xarr
-00003e40: 6179 206f 626a 6563 7420 696e 2074 6865  ay object in the
-00003e50: 2070 726f 7669 6465 6420 6f72 6465 722e   provided order.
-00003e60: 2222 220a 2020 2020 6672 6f6d 2078 6172  """.    from xar
-00003e70: 7261 792e 636f 7265 2e67 726f 7570 6279  ray.core.groupby
-00003e80: 2069 6d70 6f72 7420 5f64 756d 6d79 5f63   import _dummy_c
-00003e90: 6f70 790a 0a20 2020 2064 756d 6d79 203d  opy..    dummy =
-00003ea0: 204e 6f6e 650a 2020 2020 666f 7220 7661   None.    for va
-00003eb0: 6c75 6520 696e 2076 616c 7565 733a 0a20  lue in values:. 
-00003ec0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00003ed0: 2020 2020 2020 2020 6f62 6a5f 7365 6c20          obj_sel 
-00003ee0: 3d20 6f62 6a2e 7365 6c28 2a2a 7b64 696d  = obj.sel(**{dim
-00003ef0: 3a20 7661 6c75 657d 290a 2020 2020 2020  : value}).      
-00003f00: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
-00003f10: 6f72 2c20 496e 6465 7845 7272 6f72 293a  or, IndexError):
-00003f20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00003f30: 6475 6d6d 7920 6973 204e 6f6e 653a 0a20  dummy is None:. 
-00003f40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00003f50: 756d 6d79 203d 205f 6475 6d6d 795f 636f  ummy = _dummy_co
-00003f60: 7079 286f 626a 290a 2020 2020 2020 2020  py(obj).        
-00003f70: 2020 2020 6f62 6a5f 7365 6c20 3d20 6475      obj_sel = du
-00003f80: 6d6d 790a 2020 2020 2020 2020 7969 656c  mmy.        yiel
-00003f90: 6420 6f62 6a5f 7365 6c0a 0a0a 6465 6620  d obj_sel...def 
-00003fa0: 6170 706c 795f 6772 6f75 7062 795f 6675  apply_groupby_fu
-00003fb0: 6e63 2866 756e 632c 202a 6172 6773 293a  nc(func, *args):
-00003fc0: 0a20 2020 2022 2222 4170 706c 7920 6120  .    """Apply a 
-00003fd0: 6461 7461 7365 7420 6f72 2064 6174 6172  dataset or datar
-00003fe0: 7261 7920 6c65 7665 6c20 6675 6e63 7469  ray level functi
-00003ff0: 6f6e 206f 7665 7220 4772 6f75 7042 792c  on over GroupBy,
-00004000: 2044 6174 6173 6574 2c0a 2020 2020 4461   Dataset,.    Da
-00004010: 7461 4172 7261 792c 2056 6172 6961 626c  taArray, Variabl
-00004020: 6520 616e 642f 6f72 206e 6461 7272 6179  e and/or ndarray
-00004030: 206f 626a 6563 7473 2e0a 2020 2020 2222   objects..    ""
-00004040: 220a 2020 2020 6672 6f6d 2078 6172 7261  ".    from xarra
-00004050: 792e 636f 7265 2e67 726f 7570 6279 2069  y.core.groupby i
-00004060: 6d70 6f72 7420 4772 6f75 7042 792c 2070  mport GroupBy, p
-00004070: 6565 6b5f 6174 0a20 2020 2066 726f 6d20  eek_at.    from 
-00004080: 7861 7272 6179 2e63 6f72 652e 7661 7269  xarray.core.vari
-00004090: 6162 6c65 2069 6d70 6f72 7420 5661 7269  able import Vari
-000040a0: 6162 6c65 0a0a 2020 2020 6772 6f75 7062  able..    groupb
-000040b0: 7973 203d 205b 6172 6720 666f 7220 6172  ys = [arg for ar
-000040c0: 6720 696e 2061 7267 7320 6966 2069 7369  g in args if isi
-000040d0: 6e73 7461 6e63 6528 6172 672c 2047 726f  nstance(arg, Gro
-000040e0: 7570 4279 295d 0a20 2020 2061 7373 6572  upBy)].    asser
-000040f0: 7420 6772 6f75 7062 7973 2c20 226d 7573  t groupbys, "mus
-00004100: 7420 6861 7665 2061 7420 6c65 6173 7420  t have at least 
-00004110: 6f6e 6520 6772 6f75 7062 7920 746f 2069  one groupby to i
-00004120: 7465 7261 7465 206f 7665 7222 0a20 2020  terate over".   
-00004130: 2066 6972 7374 5f67 726f 7570 6279 203d   first_groupby =
-00004140: 2067 726f 7570 6279 735b 305d 0a20 2020   groupbys[0].   
-00004150: 2069 6620 616e 7928 6e6f 7420 6669 7273   if any(not firs
-00004160: 745f 6772 6f75 7062 792e 5f67 726f 7570  t_groupby._group
-00004170: 2e65 7175 616c 7328 6762 2e5f 6772 6f75  .equals(gb._grou
-00004180: 7029 2066 6f72 2067 6220 696e 2067 726f  p) for gb in gro
-00004190: 7570 6279 735b 313a 5d29 3a0a 2020 2020  upbys[1:]):.    
-000041a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000041b0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-000041c0: 2020 2261 7070 6c79 5f75 6675 6e63 2063    "apply_ufunc c
-000041d0: 616e 206f 6e6c 7920 7065 7266 6f72 6d20  an only perform 
-000041e0: 6f70 6572 6174 696f 6e73 206f 7665 7220  operations over 
-000041f0: 220a 2020 2020 2020 2020 2020 2020 226d  ".            "m
-00004200: 756c 7469 706c 6520 4772 6f75 7042 7920  ultiple GroupBy 
-00004210: 6f62 6a65 6374 7320 6174 206f 6e63 6520  objects at once 
-00004220: 6966 2074 6865 7920 6172 6520 616c 6c20  if they are all 
-00004230: 220a 2020 2020 2020 2020 2020 2020 2267  ".            "g
-00004240: 726f 7570 6564 2074 6865 2073 616d 6520  rouped the same 
-00004250: 7761 7922 0a20 2020 2020 2020 2029 0a0a  way".        )..
-00004260: 2020 2020 6772 6f75 7065 645f 6469 6d20      grouped_dim 
-00004270: 3d20 6669 7273 745f 6772 6f75 7062 792e  = first_groupby.
-00004280: 5f67 726f 7570 2e6e 616d 650a 2020 2020  _group.name.    
-00004290: 756e 6971 7565 5f76 616c 7565 7320 3d20  unique_values = 
-000042a0: 6669 7273 745f 6772 6f75 7062 792e 5f75  first_groupby._u
-000042b0: 6e69 7175 655f 636f 6f72 642e 7661 6c75  nique_coord.valu
-000042c0: 6573 0a0a 2020 2020 6974 6572 6174 6f72  es..    iterator
-000042d0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2061  s = [].    for a
-000042e0: 7267 2069 6e20 6172 6773 3a0a 2020 2020  rg in args:.    
-000042f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00004300: 6528 6172 672c 2047 726f 7570 4279 293a  e(arg, GroupBy):
-00004310: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-00004320: 7261 746f 7220 3d20 2876 616c 7565 2066  rator = (value f
-00004330: 6f72 205f 2c20 7661 6c75 6520 696e 2061  or _, value in a
-00004340: 7267 290a 2020 2020 2020 2020 656c 6966  rg).        elif
-00004350: 2068 6173 6174 7472 2861 7267 2c20 2264   hasattr(arg, "d
-00004360: 696d 7322 2920 616e 6420 6772 6f75 7065  ims") and groupe
-00004370: 645f 6469 6d20 696e 2061 7267 2e64 696d  d_dim in arg.dim
-00004380: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-00004390: 6620 6973 696e 7374 616e 6365 2861 7267  f isinstance(arg
-000043a0: 2c20 5661 7269 6162 6c65 293a 0a20 2020  , Variable):.   
-000043b0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000043c0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043e0: 2020 2022 6772 6f75 7062 7920 6f70 6572     "groupby oper
-000043f0: 6174 696f 6e73 2063 616e 6e6f 7420 6265  ations cannot be
-00004400: 2070 6572 666f 726d 6564 2077 6974 6820   performed with 
-00004410: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00004420: 2020 2020 2020 2278 6172 7261 792e 5661        "xarray.Va
-00004430: 7269 6162 6c65 206f 626a 6563 7473 2074  riable objects t
-00004440: 6861 7420 7368 6172 6520 6120 6469 6d65  hat share a dime
-00004450: 6e73 696f 6e20 7769 7468 2022 0a20 2020  nsion with ".   
-00004460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004470: 2022 7468 6520 6772 6f75 7065 6420 6469   "the grouped di
-00004480: 6d65 6e73 696f 6e22 0a20 2020 2020 2020  mension".       
-00004490: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000044a0: 2020 2020 2020 2069 7465 7261 746f 7220         iterator 
-000044b0: 3d20 5f69 7465 725f 6f76 6572 5f73 656c  = _iter_over_sel
-000044c0: 6563 7469 6f6e 7328 6172 672c 2067 726f  ections(arg, gro
-000044d0: 7570 6564 5f64 696d 2c20 756e 6971 7565  uped_dim, unique
-000044e0: 5f76 616c 7565 7329 0a20 2020 2020 2020  _values).       
-000044f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00004500: 2020 2069 7465 7261 746f 7220 3d20 6974     iterator = it
-00004510: 6572 746f 6f6c 732e 7265 7065 6174 2861  ertools.repeat(a
-00004520: 7267 290a 2020 2020 2020 2020 6974 6572  rg).        iter
-00004530: 6174 6f72 732e 6170 7065 6e64 2869 7465  ators.append(ite
-00004540: 7261 746f 7229 0a0a 2020 2020 6170 706c  rator)..    appl
-00004550: 6965 6420 3d20 2866 756e 6328 2a7a 6970  ied = (func(*zip
-00004560: 7065 645f 6172 6773 2920 666f 7220 7a69  ped_args) for zi
-00004570: 7070 6564 5f61 7267 7320 696e 207a 6970  pped_args in zip
-00004580: 282a 6974 6572 6174 6f72 7329 290a 2020  (*iterators)).  
-00004590: 2020 6170 706c 6965 645f 6578 616d 706c    applied_exampl
-000045a0: 652c 2061 7070 6c69 6564 203d 2070 6565  e, applied = pee
-000045b0: 6b5f 6174 2861 7070 6c69 6564 290a 2020  k_at(applied).  
-000045c0: 2020 636f 6d62 696e 6520 3d20 6669 7273    combine = firs
-000045d0: 745f 6772 6f75 7062 792e 5f63 6f6d 6269  t_groupby._combi
-000045e0: 6e65 0a20 2020 2069 6620 6973 696e 7374  ne.    if isinst
-000045f0: 616e 6365 2861 7070 6c69 6564 5f65 7861  ance(applied_exa
-00004600: 6d70 6c65 2c20 7475 706c 6529 3a0a 2020  mple, tuple):.  
-00004610: 2020 2020 2020 636f 6d62 696e 6564 203d        combined =
-00004620: 2074 7570 6c65 2863 6f6d 6269 6e65 286f   tuple(combine(o
-00004630: 7574 7075 7429 2066 6f72 206f 7574 7075  utput) for outpu
-00004640: 7420 696e 207a 6970 282a 6170 706c 6965  t in zip(*applie
-00004650: 6429 290a 2020 2020 656c 7365 3a0a 2020  d)).    else:.  
-00004660: 2020 2020 2020 636f 6d62 696e 6564 203d        combined =
-00004670: 2063 6f6d 6269 6e65 2861 7070 6c69 6564   combine(applied
-00004680: 290a 2020 2020 7265 7475 726e 2063 6f6d  ).    return com
-00004690: 6269 6e65 640a 0a0a 6465 6620 756e 6966  bined...def unif
-000046a0: 6965 645f 6469 6d5f 7369 7a65 7328 0a20  ied_dim_sizes(. 
-000046b0: 2020 2076 6172 6961 626c 6573 3a20 4974     variables: It
-000046c0: 6572 6162 6c65 5b56 6172 6961 626c 655d  erable[Variable]
-000046d0: 2c20 6578 636c 7564 655f 6469 6d73 3a20  , exclude_dims: 
-000046e0: 5365 7420 3d20 6672 6f7a 656e 7365 7428  Set = frozenset(
-000046f0: 290a 2920 2d3e 2064 6963 745b 4861 7368  ).) -> dict[Hash
-00004700: 6162 6c65 2c20 696e 745d 3a0a 2020 2020  able, int]:.    
-00004710: 6469 6d5f 7369 7a65 733a 2064 6963 745b  dim_sizes: dict[
-00004720: 4861 7368 6162 6c65 2c20 696e 745d 203d  Hashable, int] =
-00004730: 207b 7d0a 0a20 2020 2066 6f72 2076 6172   {}..    for var
-00004740: 2069 6e20 7661 7269 6162 6c65 733a 0a20   in variables:. 
-00004750: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-00004760: 7428 7661 722e 6469 6d73 2929 203c 206c  t(var.dims)) < l
-00004770: 656e 2876 6172 2e64 696d 7329 3a0a 2020  en(var.dims):.  
-00004780: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00004790: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-000047a0: 2020 2020 2020 2020 2020 2020 2262 726f              "bro
-000047b0: 6164 6361 7374 696e 6720 6361 6e6e 6f74  adcasting cannot
-000047c0: 2068 616e 646c 6520 6475 706c 6963 6174   handle duplicat
-000047d0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-000047e0: 2020 2020 6622 6469 6d65 6e73 696f 6e73      f"dimensions
-000047f0: 206f 6e20 6120 7661 7269 6162 6c65 3a20   on a variable: 
-00004800: 7b6c 6973 7428 7661 722e 6469 6d73 297d  {list(var.dims)}
-00004810: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00004820: 2020 2020 2020 2020 666f 7220 6469 6d2c          for dim,
-00004830: 2073 697a 6520 696e 207a 6970 2876 6172   size in zip(var
-00004840: 2e64 696d 732c 2076 6172 2e73 6861 7065  .dims, var.shape
-00004850: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00004860: 6620 6469 6d20 6e6f 7420 696e 2065 7863  f dim not in exc
-00004870: 6c75 6465 5f64 696d 733a 0a20 2020 2020  lude_dims:.     
-00004880: 2020 2020 2020 2020 2020 2069 6620 6469             if di
-00004890: 6d20 6e6f 7420 696e 2064 696d 5f73 697a  m not in dim_siz
-000048a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000048b0: 2020 2020 2020 2020 6469 6d5f 7369 7a65          dim_size
-000048c0: 735b 6469 6d5d 203d 2073 697a 650a 2020  s[dim] = size.  
-000048d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000048e0: 6966 2064 696d 5f73 697a 6573 5b64 696d  if dim_sizes[dim
-000048f0: 5d20 213d 2073 697a 653a 0a20 2020 2020  ] != size:.     
-00004900: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00004910: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00004920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004930: 2020 2020 2020 2020 2022 6f70 6572 616e           "operan
-00004940: 6473 2063 616e 6e6f 7420 6265 2062 726f  ds cannot be bro
-00004950: 6164 6361 7374 2074 6f67 6574 6865 7220  adcast together 
-00004960: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00004970: 2020 2020 2020 2020 2020 2277 6974 6820            "with 
-00004980: 6d69 736d 6174 6368 6564 206c 656e 6774  mismatched lengt
-00004990: 6873 2066 6f72 2064 696d 656e 7369 6f6e  hs for dimension
-000049a0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000049b0: 2020 2020 2020 2020 2020 2066 227b 6469             f"{di
-000049c0: 6d7d 3a20 7b64 696d 5f73 697a 6573 5b64  m}: {dim_sizes[d
-000049d0: 696d 5d7d 2076 7320 7b73 697a 657d 220a  im]} vs {size}".
-000049e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049f0: 2020 2020 290a 2020 2020 7265 7475 726e      ).    return
-00004a00: 2064 696d 5f73 697a 6573 0a0a 0a53 4c49   dim_sizes...SLI
-00004a10: 4345 5f4e 4f4e 4520 3d20 736c 6963 6528  CE_NONE = slice(
-00004a20: 4e6f 6e65 290a 0a0a 6465 6620 6272 6f61  None)...def broa
-00004a30: 6463 6173 745f 636f 6d70 6174 5f64 6174  dcast_compat_dat
-00004a40: 6128 0a20 2020 2076 6172 6961 626c 653a  a(.    variable:
-00004a50: 2056 6172 6961 626c 652c 0a20 2020 2062   Variable,.    b
-00004a60: 726f 6164 6361 7374 5f64 696d 733a 2074  roadcast_dims: t
-00004a70: 7570 6c65 5b48 6173 6861 626c 652c 202e  uple[Hashable, .
-00004a80: 2e2e 5d2c 0a20 2020 2063 6f72 655f 6469  ..],.    core_di
-00004a90: 6d73 3a20 7475 706c 655b 4861 7368 6162  ms: tuple[Hashab
-00004aa0: 6c65 2c20 2e2e 2e5d 2c0a 2920 2d3e 2041  le, ...],.) -> A
-00004ab0: 6e79 3a0a 2020 2020 6461 7461 203d 2076  ny:.    data = v
-00004ac0: 6172 6961 626c 652e 6461 7461 0a0a 2020  ariable.data..  
-00004ad0: 2020 6f6c 645f 6469 6d73 203d 2076 6172    old_dims = var
-00004ae0: 6961 626c 652e 6469 6d73 0a20 2020 206e  iable.dims.    n
-00004af0: 6577 5f64 696d 7320 3d20 6272 6f61 6463  ew_dims = broadc
-00004b00: 6173 745f 6469 6d73 202b 2063 6f72 655f  ast_dims + core_
-00004b10: 6469 6d73 0a0a 2020 2020 6966 206e 6577  dims..    if new
-00004b20: 5f64 696d 7320 3d3d 206f 6c64 5f64 696d  _dims == old_dim
-00004b30: 733a 0a20 2020 2020 2020 2023 206f 7074  s:.        # opt
-00004b40: 696d 697a 6520 666f 7220 7468 6520 7479  imize for the ty
-00004b50: 7069 6361 6c20 6361 7365 0a20 2020 2020  pical case.     
-00004b60: 2020 2072 6574 7572 6e20 6461 7461 0a0a     return data..
-00004b70: 2020 2020 7365 745f 6f6c 645f 6469 6d73      set_old_dims
-00004b80: 203d 2073 6574 286f 6c64 5f64 696d 7329   = set(old_dims)
-00004b90: 0a20 2020 206d 6973 7369 6e67 5f63 6f72  .    missing_cor
-00004ba0: 655f 6469 6d73 203d 205b 6420 666f 7220  e_dims = [d for 
-00004bb0: 6420 696e 2063 6f72 655f 6469 6d73 2069  d in core_dims i
-00004bc0: 6620 6420 6e6f 7420 696e 2073 6574 5f6f  f d not in set_o
-00004bd0: 6c64 5f64 696d 735d 0a20 2020 2069 6620  ld_dims].    if 
-00004be0: 6d69 7373 696e 675f 636f 7265 5f64 696d  missing_core_dim
-00004bf0: 733a 0a20 2020 2020 2020 2072 6169 7365  s:.        raise
-00004c00: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00004c10: 2020 2020 2020 2020 2022 6f70 6572 616e           "operan
-00004c20: 6420 746f 2061 7070 6c79 5f75 6675 6e63  d to apply_ufunc
-00004c30: 2068 6173 2072 6571 7569 7265 6420 636f   has required co
-00004c40: 7265 2064 696d 656e 7369 6f6e 7320 7b7d  re dimensions {}
-00004c50: 2c20 6275 7420 220a 2020 2020 2020 2020  , but ".        
-00004c60: 2020 2020 2273 6f6d 6520 6f66 2074 6865      "some of the
-00004c70: 7365 2064 696d 656e 7369 6f6e 7320 6172  se dimensions ar
-00004c80: 6520 6162 7365 6e74 206f 6e20 616e 2069  e absent on an i
-00004c90: 6e70 7574 2076 6172 6961 626c 653a 207b  nput variable: {
-00004ca0: 7d22 2e66 6f72 6d61 7428 0a20 2020 2020  }".format(.     
-00004cb0: 2020 2020 2020 2020 2020 206c 6973 7428             list(
-00004cc0: 636f 7265 5f64 696d 7329 2c20 6d69 7373  core_dims), miss
-00004cd0: 696e 675f 636f 7265 5f64 696d 730a 2020  ing_core_dims.  
-00004ce0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00004cf0: 2020 2020 290a 0a20 2020 2073 6574 5f6e      )..    set_n
-00004d00: 6577 5f64 696d 7320 3d20 7365 7428 6e65  ew_dims = set(ne
-00004d10: 775f 6469 6d73 290a 2020 2020 756e 6578  w_dims).    unex
-00004d20: 7065 6374 6564 5f64 696d 7320 3d20 5b64  pected_dims = [d
-00004d30: 2066 6f72 2064 2069 6e20 6f6c 645f 6469   for d in old_di
-00004d40: 6d73 2069 6620 6420 6e6f 7420 696e 2073  ms if d not in s
-00004d50: 6574 5f6e 6577 5f64 696d 735d 0a20 2020  et_new_dims].   
-00004d60: 2069 6620 756e 6578 7065 6374 6564 5f64   if unexpected_d
-00004d70: 696d 733a 0a20 2020 2020 2020 2072 6169  ims:.        rai
-00004d80: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00004d90: 2020 2020 2020 2020 2020 2022 6f70 6572             "oper
-00004da0: 616e 6420 746f 2061 7070 6c79 5f75 6675  and to apply_ufu
-00004db0: 6e63 2065 6e63 6f75 6e74 6572 6564 2075  nc encountered u
-00004dc0: 6e65 7870 6563 7465 6420 220a 2020 2020  nexpected ".    
-00004dd0: 2020 2020 2020 2020 6622 6469 6d65 6e73          f"dimens
-00004de0: 696f 6e73 207b 756e 6578 7065 6374 6564  ions {unexpected
-00004df0: 5f64 696d 7321 727d 206f 6e20 616e 2069  _dims!r} on an i
-00004e00: 6e70 7574 2076 6172 6961 626c 653a 2074  nput variable: t
-00004e10: 6865 7365 2061 7265 2063 6f72 6520 220a  hese are core ".
-00004e20: 2020 2020 2020 2020 2020 2020 2264 696d              "dim
-00004e30: 656e 7369 6f6e 7320 6f6e 206f 7468 6572  ensions on other
-00004e40: 2069 6e70 7574 206f 7220 6f75 7470 7574   input or output
-00004e50: 2076 6172 6961 626c 6573 220a 2020 2020   variables".    
-00004e60: 2020 2020 290a 0a20 2020 2023 2066 6f72      )..    # for
-00004e70: 2063 6f6e 7369 7374 656e 6379 2077 6974   consistency wit
-00004e80: 6820 6e75 6d70 792c 206b 6565 7020 6272  h numpy, keep br
-00004e90: 6f61 6463 6173 7420 6469 6d65 6e73 696f  oadcast dimensio
-00004ea0: 6e73 2074 6f20 7468 6520 6c65 6674 0a20  ns to the left. 
-00004eb0: 2020 206f 6c64 5f62 726f 6164 6361 7374     old_broadcast
-00004ec0: 5f64 696d 7320 3d20 7475 706c 6528 6420  _dims = tuple(d 
-00004ed0: 666f 7220 6420 696e 2062 726f 6164 6361  for d in broadca
-00004ee0: 7374 5f64 696d 7320 6966 2064 2069 6e20  st_dims if d in 
-00004ef0: 7365 745f 6f6c 645f 6469 6d73 290a 2020  set_old_dims).  
-00004f00: 2020 7265 6f72 6465 7265 645f 6469 6d73    reordered_dims
-00004f10: 203d 206f 6c64 5f62 726f 6164 6361 7374   = old_broadcast
-00004f20: 5f64 696d 7320 2b20 636f 7265 5f64 696d  _dims + core_dim
-00004f30: 730a 2020 2020 6966 2072 656f 7264 6572  s.    if reorder
-00004f40: 6564 5f64 696d 7320 213d 206f 6c64 5f64  ed_dims != old_d
-00004f50: 696d 733a 0a20 2020 2020 2020 206f 7264  ims:.        ord
-00004f60: 6572 203d 2074 7570 6c65 286f 6c64 5f64  er = tuple(old_d
-00004f70: 696d 732e 696e 6465 7828 6429 2066 6f72  ims.index(d) for
-00004f80: 2064 2069 6e20 7265 6f72 6465 7265 645f   d in reordered_
-00004f90: 6469 6d73 290a 2020 2020 2020 2020 6461  dims).        da
-00004fa0: 7461 203d 2064 7563 6b5f 6172 7261 795f  ta = duck_array_
-00004fb0: 6f70 732e 7472 616e 7370 6f73 6528 6461  ops.transpose(da
-00004fc0: 7461 2c20 6f72 6465 7229 0a0a 2020 2020  ta, order)..    
-00004fd0: 6966 206e 6577 5f64 696d 7320 213d 2072  if new_dims != r
-00004fe0: 656f 7264 6572 6564 5f64 696d 733a 0a20  eordered_dims:. 
-00004ff0: 2020 2020 2020 206b 6579 5f70 6172 7473         key_parts
-00005000: 3a20 6c69 7374 5b73 6c69 6365 207c 204e  : list[slice | N
-00005010: 6f6e 655d 203d 205b 5d0a 2020 2020 2020  one] = [].      
-00005020: 2020 666f 7220 6469 6d20 696e 206e 6577    for dim in new
-00005030: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
-00005040: 2020 2069 6620 6469 6d20 696e 2073 6574     if dim in set
-00005050: 5f6f 6c64 5f64 696d 733a 0a20 2020 2020  _old_dims:.     
-00005060: 2020 2020 2020 2020 2020 206b 6579 5f70             key_p
-00005070: 6172 7473 2e61 7070 656e 6428 534c 4943  arts.append(SLIC
-00005080: 455f 4e4f 4e45 290a 2020 2020 2020 2020  E_NONE).        
-00005090: 2020 2020 656c 6966 206b 6579 5f70 6172      elif key_par
-000050a0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000050b0: 2020 2020 2320 6e6f 206e 6565 6420 746f      # no need to
-000050c0: 2069 6e73 6572 7420 6e65 7720 6178 6573   insert new axes
-000050d0: 2061 7420 7468 6520 6265 6769 6e6e 696e   at the beginnin
-000050e0: 6720 7468 6174 2061 7265 2061 6c72 6561  g that are alrea
-000050f0: 6479 0a20 2020 2020 2020 2020 2020 2020  dy.             
-00005100: 2020 2023 2068 616e 646c 6564 2062 7920     # handled by 
-00005110: 6272 6f61 6463 6173 7469 6e67 0a20 2020  broadcasting.   
-00005120: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00005130: 5f70 6172 7473 2e61 7070 656e 6428 6e70  _parts.append(np
-00005140: 2e6e 6577 6178 6973 290a 2020 2020 2020  .newaxis).      
-00005150: 2020 6461 7461 203d 2064 6174 615b 7475    data = data[tu
-00005160: 706c 6528 6b65 795f 7061 7274 7329 5d0a  ple(key_parts)].
-00005170: 0a20 2020 2072 6574 7572 6e20 6461 7461  .    return data
-00005180: 0a0a 0a64 6566 205f 7665 6374 6f72 697a  ...def _vectoriz
-00005190: 6528 6675 6e63 2c20 7369 676e 6174 7572  e(func, signatur
-000051a0: 652c 206f 7574 7075 745f 6474 7970 6573  e, output_dtypes
-000051b0: 2c20 6578 636c 7564 655f 6469 6d73 293a  , exclude_dims):
-000051c0: 0a20 2020 2069 6620 7369 676e 6174 7572  .    if signatur
-000051d0: 652e 616c 6c5f 636f 7265 5f64 696d 733a  e.all_core_dims:
-000051e0: 0a20 2020 2020 2020 2066 756e 6320 3d20  .        func = 
-000051f0: 6e70 2e76 6563 746f 7269 7a65 280a 2020  np.vectorize(.  
-00005200: 2020 2020 2020 2020 2020 6675 6e63 2c0a            func,.
-00005210: 2020 2020 2020 2020 2020 2020 6f74 7970              otyp
-00005220: 6573 3d6f 7574 7075 745f 6474 7970 6573  es=output_dtypes
-00005230: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-00005240: 676e 6174 7572 653d 7369 676e 6174 7572  gnature=signatur
-00005250: 652e 746f 5f67 7566 756e 635f 7374 7269  e.to_gufunc_stri
-00005260: 6e67 2865 7863 6c75 6465 5f64 696d 7329  ng(exclude_dims)
-00005270: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00005280: 656c 7365 3a0a 2020 2020 2020 2020 6675  else:.        fu
-00005290: 6e63 203d 206e 702e 7665 6374 6f72 697a  nc = np.vectoriz
-000052a0: 6528 6675 6e63 2c20 6f74 7970 6573 3d6f  e(func, otypes=o
-000052b0: 7574 7075 745f 6474 7970 6573 290a 0a20  utput_dtypes).. 
-000052c0: 2020 2072 6574 7572 6e20 6675 6e63 0a0a     return func..
-000052d0: 0a64 6566 2061 7070 6c79 5f76 6172 6961  .def apply_varia
-000052e0: 626c 655f 7566 756e 6328 0a20 2020 2066  ble_ufunc(.    f
-000052f0: 756e 632c 0a20 2020 202a 6172 6773 2c0a  unc,.    *args,.
-00005300: 2020 2020 7369 676e 6174 7572 653a 205f      signature: _
-00005310: 5546 756e 6353 6967 6e61 7475 7265 2c0a  UFuncSignature,.
-00005320: 2020 2020 6578 636c 7564 655f 6469 6d73      exclude_dims
-00005330: 3d66 726f 7a65 6e73 6574 2829 2c0a 2020  =frozenset(),.  
-00005340: 2020 6461 736b 3d22 666f 7262 6964 6465    dask="forbidde
-00005350: 6e22 2c0a 2020 2020 6f75 7470 7574 5f64  n",.    output_d
-00005360: 7479 7065 733d 4e6f 6e65 2c0a 2020 2020  types=None,.    
-00005370: 7665 6374 6f72 697a 653d 4661 6c73 652c  vectorize=False,
-00005380: 0a20 2020 206b 6565 705f 6174 7472 733d  .    keep_attrs=
-00005390: 226f 7665 7272 6964 6522 2c0a 2020 2020  "override",.    
-000053a0: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
-000053b0: 6773 3d4e 6f6e 652c 0a29 202d 3e20 5661  gs=None,.) -> Va
-000053c0: 7269 6162 6c65 207c 2074 7570 6c65 5b56  riable | tuple[V
-000053d0: 6172 6961 626c 652c 202e 2e2e 5d3a 0a20  ariable, ...]:. 
-000053e0: 2020 2022 2222 4170 706c 7920 6120 6e64     """Apply a nd
-000053f0: 6172 7261 7920 6c65 7665 6c20 6675 6e63  array level func
-00005400: 7469 6f6e 206f 7665 7220 5661 7269 6162  tion over Variab
-00005410: 6c65 2061 6e64 2f6f 7220 6e64 6172 7261  le and/or ndarra
-00005420: 7920 6f62 6a65 6374 732e 2222 220a 2020  y objects.""".  
-00005430: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00005440: 7265 2e76 6172 6961 626c 6520 696d 706f  re.variable impo
-00005450: 7274 2056 6172 6961 626c 652c 2061 735f  rt Variable, as_
-00005460: 636f 6d70 6174 6962 6c65 5f64 6174 610a  compatible_data.
-00005470: 0a20 2020 2064 696d 5f73 697a 6573 203d  .    dim_sizes =
-00005480: 2075 6e69 6669 6564 5f64 696d 5f73 697a   unified_dim_siz
-00005490: 6573 280a 2020 2020 2020 2020 2861 2066  es(.        (a f
-000054a0: 6f72 2061 2069 6e20 6172 6773 2069 6620  or a in args if 
-000054b0: 6861 7361 7474 7228 612c 2022 6469 6d73  hasattr(a, "dims
-000054c0: 2229 292c 2065 7863 6c75 6465 5f64 696d  ")), exclude_dim
-000054d0: 733d 6578 636c 7564 655f 6469 6d73 0a20  s=exclude_dims. 
-000054e0: 2020 2029 0a20 2020 2062 726f 6164 6361     ).    broadca
-000054f0: 7374 5f64 696d 7320 3d20 7475 706c 6528  st_dims = tuple(
-00005500: 0a20 2020 2020 2020 2064 696d 2066 6f72  .        dim for
-00005510: 2064 696d 2069 6e20 6469 6d5f 7369 7a65   dim in dim_size
-00005520: 7320 6966 2064 696d 206e 6f74 2069 6e20  s if dim not in 
-00005530: 7369 676e 6174 7572 652e 616c 6c5f 636f  signature.all_co
-00005540: 7265 5f64 696d 730a 2020 2020 290a 2020  re_dims.    ).  
-00005550: 2020 6f75 7470 7574 5f64 696d 7320 3d20    output_dims = 
-00005560: 5b62 726f 6164 6361 7374 5f64 696d 7320  [broadcast_dims 
-00005570: 2b20 6f75 7420 666f 7220 6f75 7420 696e  + out for out in
-00005580: 2073 6967 6e61 7475 7265 2e6f 7574 7075   signature.outpu
-00005590: 745f 636f 7265 5f64 696d 735d 0a0a 2020  t_core_dims]..  
-000055a0: 2020 696e 7075 745f 6461 7461 203d 205b    input_data = [
-000055b0: 0a20 2020 2020 2020 2062 726f 6164 6361  .        broadca
-000055c0: 7374 5f63 6f6d 7061 745f 6461 7461 2861  st_compat_data(a
-000055d0: 7267 2c20 6272 6f61 6463 6173 745f 6469  rg, broadcast_di
-000055e0: 6d73 2c20 636f 7265 5f64 696d 7329 0a20  ms, core_dims). 
-000055f0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00005600: 616e 6365 2861 7267 2c20 5661 7269 6162  ance(arg, Variab
-00005610: 6c65 290a 2020 2020 2020 2020 656c 7365  le).        else
-00005620: 2061 7267 0a20 2020 2020 2020 2066 6f72   arg.        for
-00005630: 2061 7267 2c20 636f 7265 5f64 696d 7320   arg, core_dims 
-00005640: 696e 207a 6970 2861 7267 732c 2073 6967  in zip(args, sig
-00005650: 6e61 7475 7265 2e69 6e70 7574 5f63 6f72  nature.input_cor
-00005660: 655f 6469 6d73 290a 2020 2020 5d0a 0a20  e_dims).    ].. 
-00005670: 2020 2069 6620 616e 7928 6973 5f64 7563     if any(is_duc
-00005680: 6b5f 6461 736b 5f61 7272 6179 2861 7272  k_dask_array(arr
-00005690: 6179 2920 666f 7220 6172 7261 7920 696e  ay) for array in
-000056a0: 2069 6e70 7574 5f64 6174 6129 3a0a 2020   input_data):.  
-000056b0: 2020 2020 2020 6966 2064 6173 6b20 3d3d        if dask ==
-000056c0: 2022 666f 7262 6964 6465 6e22 3a0a 2020   "forbidden":.  
-000056d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000056e0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-000056f0: 2020 2020 2020 2020 2020 2020 2261 7070              "app
-00005700: 6c79 5f75 6675 6e63 2065 6e63 6f75 6e74  ly_ufunc encount
-00005710: 6572 6564 2061 2064 6173 6b20 6172 7261  ered a dask arra
-00005720: 7920 6f6e 2061 6e20 220a 2020 2020 2020  y on an ".      
-00005730: 2020 2020 2020 2020 2020 2261 7267 756d            "argum
-00005740: 656e 742c 2062 7574 2068 616e 646c 696e  ent, but handlin
-00005750: 6720 666f 7220 6461 736b 2061 7272 6179  g for dask array
-00005760: 7320 6861 7320 6e6f 7420 220a 2020 2020  s has not ".    
-00005770: 2020 2020 2020 2020 2020 2020 2262 6565              "bee
-00005780: 6e20 656e 6162 6c65 642e 2045 6974 6865  n enabled. Eithe
-00005790: 7220 7365 7420 7468 6520 6060 6461 736b  r set the ``dask
-000057a0: 6060 2061 7267 756d 656e 7420 220a 2020  `` argument ".  
-000057b0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-000057c0: 7220 6c6f 6164 2079 6f75 7220 6461 7461  r load your data
-000057d0: 2069 6e74 6f20 6d65 6d6f 7279 2066 6972   into memory fir
-000057e0: 7374 2077 6974 6820 220a 2020 2020 2020  st with ".      
-000057f0: 2020 2020 2020 2020 2020 2260 602e 6c6f            "``.lo
-00005800: 6164 2829 6060 206f 7220 6060 2e63 6f6d  ad()`` or ``.com
-00005810: 7075 7465 2829 6060 220a 2020 2020 2020  pute()``".      
-00005820: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00005830: 656c 6966 2064 6173 6b20 3d3d 2022 7061  elif dask == "pa
-00005840: 7261 6c6c 656c 697a 6564 223a 0a20 2020  rallelized":.   
-00005850: 2020 2020 2020 2020 206e 756d 7079 5f66           numpy_f
-00005860: 756e 6320 3d20 6675 6e63 0a0a 2020 2020  unc = func..    
-00005870: 2020 2020 2020 2020 6966 2064 6173 6b5f          if dask_
-00005880: 6775 6675 6e63 5f6b 7761 7267 7320 6973  gufunc_kwargs is
-00005890: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000058a0: 2020 2020 2020 2064 6173 6b5f 6775 6675         dask_gufu
-000058b0: 6e63 5f6b 7761 7267 7320 3d20 7b7d 0a20  nc_kwargs = {}. 
-000058c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000058d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000058e0: 2064 6173 6b5f 6775 6675 6e63 5f6b 7761   dask_gufunc_kwa
-000058f0: 7267 7320 3d20 6461 736b 5f67 7566 756e  rgs = dask_gufun
-00005900: 635f 6b77 6172 6773 2e63 6f70 7928 290a  c_kwargs.copy().
-00005910: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
-00005920: 6f77 5f72 6563 6875 6e6b 203d 2064 6173  ow_rechunk = das
-00005930: 6b5f 6775 6675 6e63 5f6b 7761 7267 732e  k_gufunc_kwargs.
-00005940: 6765 7428 2261 6c6c 6f77 5f72 6563 6875  get("allow_rechu
-00005950: 6e6b 222c 204e 6f6e 6529 0a20 2020 2020  nk", None).     
-00005960: 2020 2020 2020 2069 6620 616c 6c6f 775f         if allow_
-00005970: 7265 6368 756e 6b20 6973 204e 6f6e 653a  rechunk is None:
-00005980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005990: 2066 6f72 206e 2c20 2864 6174 612c 2063   for n, (data, c
-000059a0: 6f72 655f 6469 6d73 2920 696e 2065 6e75  ore_dims) in enu
-000059b0: 6d65 7261 7465 280a 2020 2020 2020 2020  merate(.        
-000059c0: 2020 2020 2020 2020 2020 2020 7a69 7028              zip(
-000059d0: 696e 7075 745f 6461 7461 2c20 7369 676e  input_data, sign
-000059e0: 6174 7572 652e 696e 7075 745f 636f 7265  ature.input_core
-000059f0: 5f64 696d 7329 0a20 2020 2020 2020 2020  _dims).         
-00005a00: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-00005a10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00005a20: 2069 735f 6475 636b 5f64 6173 6b5f 6172   is_duck_dask_ar
-00005a30: 7261 7928 6461 7461 293a 0a20 2020 2020  ray(data):.     
-00005a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a50: 2020 2023 2063 6f72 6520 6469 6d65 6e73     # core dimens
-00005a60: 696f 6e73 2063 616e 6e6f 7420 7370 616e  ions cannot span
-00005a70: 206d 756c 7469 706c 6520 6368 756e 6b73   multiple chunks
-00005a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005a90: 2020 2020 2020 2020 2066 6f72 2061 7869           for axi
-00005aa0: 732c 2064 696d 2069 6e20 656e 756d 6572  s, dim in enumer
-00005ab0: 6174 6528 636f 7265 5f64 696d 732c 2073  ate(core_dims, s
-00005ac0: 7461 7274 3d2d 6c65 6e28 636f 7265 5f64  tart=-len(core_d
-00005ad0: 696d 7329 293a 0a20 2020 2020 2020 2020  ims)):.         
-00005ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005af0: 2020 2069 6620 6c65 6e28 6461 7461 2e63     if len(data.c
-00005b00: 6875 6e6b 735b 6178 6973 5d29 2021 3d20  hunks[axis]) != 
-00005b10: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00005b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b30: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00005b40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00005b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b60: 2020 2020 2020 2020 2066 2264 696d 656e           f"dimen
-00005b70: 7369 6f6e 207b 6469 6d7d 206f 6e20 7b6e  sion {dim} on {n
-00005b80: 7d74 6820 6675 6e63 7469 6f6e 2061 7267  }th function arg
-00005b90: 756d 656e 7420 746f 2022 0a20 2020 2020  ument to ".     
-00005ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bb0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00005bc0: 6170 706c 795f 7566 756e 6320 7769 7468  apply_ufunc with
-00005bd0: 2064 6173 6b3d 2770 6172 616c 6c65 6c69   dask='paralleli
-00005be0: 7a65 6427 2063 6f6e 7369 7374 7320 6f66  zed' consists of
-00005bf0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00000330: 2e70 6172 616c 6c65 6c63 6f6d 7061 7420  .parallelcompat 
+00000340: 696d 706f 7274 2067 6574 5f63 6875 6e6b  import get_chunk
+00000350: 6564 5f61 7272 6179 5f74 7970 650a 6672  ed_array_type.fr
+00000360: 6f6d 2078 6172 7261 792e 636f 7265 2e70  om xarray.core.p
+00000370: 7963 6f6d 7061 7420 696d 706f 7274 2069  ycompat import i
+00000380: 735f 6368 756e 6b65 645f 6172 7261 792c  s_chunked_array,
+00000390: 2069 735f 6475 636b 5f64 6173 6b5f 6172   is_duck_dask_ar
+000003a0: 7261 790a 6672 6f6d 2078 6172 7261 792e  ray.from xarray.
+000003b0: 636f 7265 2e74 7970 6573 2069 6d70 6f72  core.types impor
+000003c0: 7420 4469 6d73 2c20 545f 4461 7461 4172  t Dims, T_DataAr
+000003d0: 7261 790a 6672 6f6d 2078 6172 7261 792e  ray.from xarray.
+000003e0: 636f 7265 2e75 7469 6c73 2069 6d70 6f72  core.utils impor
+000003f0: 7420 6973 5f64 6963 745f 6c69 6b65 2c20  t is_dict_like, 
+00000400: 6973 5f73 6361 6c61 720a 6672 6f6d 2078  is_scalar.from x
+00000410: 6172 7261 792e 636f 7265 2e76 6172 6961  array.core.varia
+00000420: 626c 6520 696d 706f 7274 2056 6172 6961  ble import Varia
+00000430: 626c 650a 0a69 6620 5459 5045 5f43 4845  ble..if TYPE_CHE
+00000440: 434b 494e 473a 0a20 2020 2066 726f 6d20  CKING:.    from 
+00000450: 7861 7272 6179 2e63 6f72 652e 636f 6f72  xarray.core.coor
+00000460: 6469 6e61 7465 7320 696d 706f 7274 2043  dinates import C
+00000470: 6f6f 7264 696e 6174 6573 0a20 2020 2066  oordinates.    f
+00000480: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+00000490: 6461 7461 6172 7261 7920 696d 706f 7274  dataarray import
+000004a0: 2044 6174 6141 7272 6179 0a20 2020 2066   DataArray.    f
+000004b0: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+000004c0: 6461 7461 7365 7420 696d 706f 7274 2044  dataset import D
+000004d0: 6174 6173 6574 0a20 2020 2066 726f 6d20  ataset.    from 
+000004e0: 7861 7272 6179 2e63 6f72 652e 7479 7065  xarray.core.type
+000004f0: 7320 696d 706f 7274 2043 6f6d 6269 6e65  s import Combine
+00000500: 4174 7472 734f 7074 696f 6e73 2c20 4a6f  AttrsOptions, Jo
+00000510: 696e 4f70 7469 6f6e 730a 0a5f 4e4f 5f46  inOptions.._NO_F
+00000520: 494c 4c5f 5641 4c55 4520 3d20 7574 696c  ILL_VALUE = util
+00000530: 732e 5265 7072 4f62 6a65 6374 2822 3c6e  s.ReprObject("<n
+00000540: 6f2d 6669 6c6c 2d76 616c 7565 3e22 290a  o-fill-value>").
+00000550: 5f44 4546 4155 4c54 5f4e 414d 4520 3d20  _DEFAULT_NAME = 
+00000560: 7574 696c 732e 5265 7072 4f62 6a65 6374  utils.ReprObject
+00000570: 2822 3c64 6566 6175 6c74 2d6e 616d 653e  ("<default-name>
+00000580: 2229 0a5f 4a4f 494e 535f 5749 5448 4f55  ")._JOINS_WITHOU
+00000590: 545f 4649 4c4c 5f56 414c 5545 5320 3d20  T_FILL_VALUES = 
+000005a0: 6672 6f7a 656e 7365 7428 7b22 696e 6e65  frozenset({"inne
+000005b0: 7222 2c20 2265 7861 6374 227d 290a 0a0a  r", "exact"})...
+000005c0: 6465 6620 5f66 6972 7374 5f6f 665f 7479  def _first_of_ty
+000005d0: 7065 2861 7267 732c 206b 696e 6429 3a0a  pe(args, kind):.
+000005e0: 2020 2020 2222 2252 6574 7572 6e20 6569      """Return ei
+000005f0: 7468 6572 2066 6972 7374 206f 626a 6563  ther first objec
+00000600: 7420 6f66 2074 7970 6520 276b 696e 6427  t of type 'kind'
+00000610: 206f 7220 7261 6973 6520 6966 206e 6f74   or raise if not
+00000620: 2066 6f75 6e64 2e22 2222 0a20 2020 2066   found.""".    f
+00000630: 6f72 2061 7267 2069 6e20 6172 6773 3a0a  or arg in args:.
+00000640: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00000650: 7461 6e63 6528 6172 672c 206b 696e 6429  tance(arg, kind)
+00000660: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00000670: 7475 726e 2061 7267 0a20 2020 2072 6169  turn arg.    rai
+00000680: 7365 2056 616c 7565 4572 726f 7228 2254  se ValueError("T
+00000690: 6869 7320 7368 6f75 6c64 2062 6520 756e  his should be un
+000006a0: 7265 6163 6861 626c 652e 2229 0a0a 0a64  reachable.")...d
+000006b0: 6566 205f 616c 6c5f 6f66 5f74 7970 6528  ef _all_of_type(
+000006c0: 6172 6773 2c20 6b69 6e64 293a 0a20 2020  args, kind):.   
+000006d0: 2022 2222 5265 7475 726e 2061 6c6c 206f   """Return all o
+000006e0: 626a 6563 7473 206f 6620 7479 7065 2027  bjects of type '
+000006f0: 6b69 6e64 2722 2222 0a20 2020 2072 6574  kind'""".    ret
+00000700: 7572 6e20 5b61 7267 2066 6f72 2061 7267  urn [arg for arg
+00000710: 2069 6e20 6172 6773 2069 6620 6973 696e   in args if isin
+00000720: 7374 616e 6365 2861 7267 2c20 6b69 6e64  stance(arg, kind
+00000730: 295d 0a0a 0a63 6c61 7373 205f 5546 756e  )]...class _UFun
+00000740: 6353 6967 6e61 7475 7265 3a0a 2020 2020  cSignature:.    
+00000750: 2222 2243 6f72 6520 6469 6d65 6e73 696f  """Core dimensio
+00000760: 6e73 2073 6967 6e61 7475 7265 2066 6f72  ns signature for
+00000770: 2061 2067 6976 656e 2066 756e 6374 696f   a given functio
+00000780: 6e2e 0a0a 2020 2020 4261 7365 6420 6f6e  n...    Based on
+00000790: 2074 6865 2073 6967 6e61 7475 7265 2070   the signature p
+000007a0: 726f 7669 6465 6420 6279 2067 656e 6572  rovided by gener
+000007b0: 616c 697a 6564 2075 6675 6e63 7320 696e  alized ufuncs in
+000007c0: 204e 756d 5079 2e0a 0a20 2020 2041 7474   NumPy...    Att
+000007d0: 7269 6275 7465 730a 2020 2020 2d2d 2d2d  ributes.    ----
+000007e0: 2d2d 2d2d 2d2d 0a20 2020 2069 6e70 7574  ------.    input
+000007f0: 5f63 6f72 655f 6469 6d73 203a 2074 7570  _core_dims : tup
+00000800: 6c65 5b74 7570 6c65 5d0a 2020 2020 2020  le[tuple].      
+00000810: 2020 436f 7265 2064 696d 656e 7369 6f6e    Core dimension
+00000820: 206e 616d 6573 206f 6e20 6561 6368 2069   names on each i
+00000830: 6e70 7574 2076 6172 6961 626c 652e 0a20  nput variable.. 
+00000840: 2020 206f 7574 7075 745f 636f 7265 5f64     output_core_d
+00000850: 696d 7320 3a20 7475 706c 655b 7475 706c  ims : tuple[tupl
+00000860: 655d 0a20 2020 2020 2020 2043 6f72 6520  e].        Core 
+00000870: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
+00000880: 6f6e 2065 6163 6820 6f75 7470 7574 2076  on each output v
+00000890: 6172 6961 626c 652e 0a20 2020 2022 2222  ariable..    """
+000008a0: 0a0a 2020 2020 5f5f 736c 6f74 735f 5f20  ..    __slots__ 
+000008b0: 3d20 280a 2020 2020 2020 2020 2269 6e70  = (.        "inp
+000008c0: 7574 5f63 6f72 655f 6469 6d73 222c 0a20  ut_core_dims",. 
+000008d0: 2020 2020 2020 2022 6f75 7470 7574 5f63         "output_c
+000008e0: 6f72 655f 6469 6d73 222c 0a20 2020 2020  ore_dims",.     
+000008f0: 2020 2022 5f61 6c6c 5f69 6e70 7574 5f63     "_all_input_c
+00000900: 6f72 655f 6469 6d73 222c 0a20 2020 2020  ore_dims",.     
+00000910: 2020 2022 5f61 6c6c 5f6f 7574 7075 745f     "_all_output_
+00000920: 636f 7265 5f64 696d 7322 2c0a 2020 2020  core_dims",.    
+00000930: 2020 2020 225f 616c 6c5f 636f 7265 5f64      "_all_core_d
+00000940: 696d 7322 2c0a 2020 2020 290a 0a20 2020  ims",.    )..   
+00000950: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00000960: 6c66 2c20 696e 7075 745f 636f 7265 5f64  lf, input_core_d
+00000970: 696d 732c 206f 7574 7075 745f 636f 7265  ims, output_core
+00000980: 5f64 696d 733d 2828 292c 2929 3a0a 2020  _dims=((),)):.  
+00000990: 2020 2020 2020 7365 6c66 2e69 6e70 7574        self.input
+000009a0: 5f63 6f72 655f 6469 6d73 203d 2074 7570  _core_dims = tup
+000009b0: 6c65 2874 7570 6c65 2861 2920 666f 7220  le(tuple(a) for 
+000009c0: 6120 696e 2069 6e70 7574 5f63 6f72 655f  a in input_core_
+000009d0: 6469 6d73 290a 2020 2020 2020 2020 7365  dims).        se
+000009e0: 6c66 2e6f 7574 7075 745f 636f 7265 5f64  lf.output_core_d
+000009f0: 696d 7320 3d20 7475 706c 6528 7475 706c  ims = tuple(tupl
+00000a00: 6528 6129 2066 6f72 2061 2069 6e20 6f75  e(a) for a in ou
+00000a10: 7470 7574 5f63 6f72 655f 6469 6d73 290a  tput_core_dims).
+00000a20: 2020 2020 2020 2020 7365 6c66 2e5f 616c          self._al
+00000a30: 6c5f 696e 7075 745f 636f 7265 5f64 696d  l_input_core_dim
+00000a40: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
+00000a50: 2073 656c 662e 5f61 6c6c 5f6f 7574 7075   self._all_outpu
+00000a60: 745f 636f 7265 5f64 696d 7320 3d20 4e6f  t_core_dims = No
+00000a70: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+00000a80: 5f61 6c6c 5f63 6f72 655f 6469 6d73 203d  _all_core_dims =
+00000a90: 204e 6f6e 650a 0a20 2020 2040 7072 6f70   None..    @prop
+00000aa0: 6572 7479 0a20 2020 2064 6566 2061 6c6c  erty.    def all
+00000ab0: 5f69 6e70 7574 5f63 6f72 655f 6469 6d73  _input_core_dims
+00000ac0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00000ad0: 6966 2073 656c 662e 5f61 6c6c 5f69 6e70  if self._all_inp
+00000ae0: 7574 5f63 6f72 655f 6469 6d73 2069 7320  ut_core_dims is 
+00000af0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00000b00: 2020 7365 6c66 2e5f 616c 6c5f 696e 7075    self._all_inpu
+00000b10: 745f 636f 7265 5f64 696d 7320 3d20 6672  t_core_dims = fr
+00000b20: 6f7a 656e 7365 7428 0a20 2020 2020 2020  ozenset(.       
+00000b30: 2020 2020 2020 2020 2064 696d 2066 6f72           dim for
+00000b40: 2064 696d 7320 696e 2073 656c 662e 696e   dims in self.in
+00000b50: 7075 745f 636f 7265 5f64 696d 7320 666f  put_core_dims fo
+00000b60: 7220 6469 6d20 696e 2064 696d 730a 2020  r dim in dims.  
+00000b70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00000b80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00000b90: 5f61 6c6c 5f69 6e70 7574 5f63 6f72 655f  _all_input_core_
+00000ba0: 6469 6d73 0a0a 2020 2020 4070 726f 7065  dims..    @prope
+00000bb0: 7274 790a 2020 2020 6465 6620 616c 6c5f  rty.    def all_
+00000bc0: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+00000bd0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00000be0: 6966 2073 656c 662e 5f61 6c6c 5f6f 7574  if self._all_out
+00000bf0: 7075 745f 636f 7265 5f64 696d 7320 6973  put_core_dims is
+00000c00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00000c10: 2020 2073 656c 662e 5f61 6c6c 5f6f 7574     self._all_out
+00000c20: 7075 745f 636f 7265 5f64 696d 7320 3d20  put_core_dims = 
+00000c30: 6672 6f7a 656e 7365 7428 0a20 2020 2020  frozenset(.     
+00000c40: 2020 2020 2020 2020 2020 2064 696d 2066             dim f
+00000c50: 6f72 2064 696d 7320 696e 2073 656c 662e  or dims in self.
+00000c60: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+00000c70: 2066 6f72 2064 696d 2069 6e20 6469 6d73   for dim in dims
+00000c80: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00000c90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00000ca0: 6c66 2e5f 616c 6c5f 6f75 7470 7574 5f63  lf._all_output_c
+00000cb0: 6f72 655f 6469 6d73 0a0a 2020 2020 4070  ore_dims..    @p
+00000cc0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00000cd0: 616c 6c5f 636f 7265 5f64 696d 7328 7365  all_core_dims(se
+00000ce0: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
+00000cf0: 7365 6c66 2e5f 616c 6c5f 636f 7265 5f64  self._all_core_d
+00000d00: 696d 7320 6973 204e 6f6e 653a 0a20 2020  ims is None:.   
+00000d10: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
+00000d20: 6c6c 5f63 6f72 655f 6469 6d73 203d 2073  ll_core_dims = s
+00000d30: 656c 662e 616c 6c5f 696e 7075 745f 636f  elf.all_input_co
+00000d40: 7265 5f64 696d 7320 7c20 7365 6c66 2e61  re_dims | self.a
+00000d50: 6c6c 5f6f 7574 7075 745f 636f 7265 5f64  ll_output_core_d
+00000d60: 696d 730a 2020 2020 2020 2020 7265 7475  ims.        retu
+00000d70: 726e 2073 656c 662e 5f61 6c6c 5f63 6f72  rn self._all_cor
+00000d80: 655f 6469 6d73 0a0a 2020 2020 4070 726f  e_dims..    @pro
+00000d90: 7065 7274 790a 2020 2020 6465 6620 6469  perty.    def di
+00000da0: 6d73 5f6d 6170 2873 656c 6629 3a0a 2020  ms_map(self):.  
+00000db0: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
+00000dc0: 2020 2020 2020 2020 2020 2063 6f72 655f             core_
+00000dd0: 6469 6d3a 2066 2264 696d 7b6e 7d22 2066  dim: f"dim{n}" f
+00000de0: 6f72 206e 2c20 636f 7265 5f64 696d 2069  or n, core_dim i
+00000df0: 6e20 656e 756d 6572 6174 6528 736f 7274  n enumerate(sort
+00000e00: 6564 2873 656c 662e 616c 6c5f 636f 7265  ed(self.all_core
+00000e10: 5f64 696d 7329 290a 2020 2020 2020 2020  _dims)).        
+00000e20: 7d0a 0a20 2020 2040 7072 6f70 6572 7479  }..    @property
+00000e30: 0a20 2020 2064 6566 206e 756d 5f69 6e70  .    def num_inp
+00000e40: 7574 7328 7365 6c66 293a 0a20 2020 2020  uts(self):.     
+00000e50: 2020 2072 6574 7572 6e20 6c65 6e28 7365     return len(se
+00000e60: 6c66 2e69 6e70 7574 5f63 6f72 655f 6469  lf.input_core_di
+00000e70: 6d73 290a 0a20 2020 2040 7072 6f70 6572  ms)..    @proper
+00000e80: 7479 0a20 2020 2064 6566 206e 756d 5f6f  ty.    def num_o
+00000e90: 7574 7075 7473 2873 656c 6629 3a0a 2020  utputs(self):.  
+00000ea0: 2020 2020 2020 7265 7475 726e 206c 656e        return len
+00000eb0: 2873 656c 662e 6f75 7470 7574 5f63 6f72  (self.output_cor
+00000ec0: 655f 6469 6d73 290a 0a20 2020 2064 6566  e_dims)..    def
+00000ed0: 205f 5f65 715f 5f28 7365 6c66 2c20 6f74   __eq__(self, ot
+00000ee0: 6865 7229 3a0a 2020 2020 2020 2020 7472  her):.        tr
+00000ef0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+00000f00: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00000f10: 2020 2020 2020 2020 7365 6c66 2e69 6e70          self.inp
+00000f20: 7574 5f63 6f72 655f 6469 6d73 203d 3d20  ut_core_dims == 
+00000f30: 6f74 6865 722e 696e 7075 745f 636f 7265  other.input_core
+00000f40: 5f64 696d 730a 2020 2020 2020 2020 2020  _dims.          
+00000f50: 2020 2020 2020 616e 6420 7365 6c66 2e6f        and self.o
+00000f60: 7574 7075 745f 636f 7265 5f64 696d 7320  utput_core_dims 
+00000f70: 3d3d 206f 7468 6572 2e6f 7574 7075 745f  == other.output_
+00000f80: 636f 7265 5f64 696d 730a 2020 2020 2020  core_dims.      
+00000f90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00000fa0: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
+00000fb0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+00000fc0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00000fd0: 0a20 2020 2064 6566 205f 5f6e 655f 5f28  .    def __ne__(
+00000fe0: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
+00000ff0: 2020 2020 2020 7265 7475 726e 206e 6f74        return not
+00001000: 2073 656c 6620 3d3d 206f 7468 6572 0a0a   self == other..
+00001010: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
+00001020: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00001030: 7265 7475 726e 2022 7b7d 287b 2172 7d2c  return "{}({!r},
+00001040: 207b 2172 7d29 222e 666f 726d 6174 280a   {!r})".format(.
+00001050: 2020 2020 2020 2020 2020 2020 7479 7065              type
+00001060: 2873 656c 6629 2e5f 5f6e 616d 655f 5f2c  (self).__name__,
+00001070: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
+00001080: 7428 7365 6c66 2e69 6e70 7574 5f63 6f72  t(self.input_cor
+00001090: 655f 6469 6d73 292c 0a20 2020 2020 2020  e_dims),.       
+000010a0: 2020 2020 206c 6973 7428 7365 6c66 2e6f       list(self.o
+000010b0: 7574 7075 745f 636f 7265 5f64 696d 7329  utput_core_dims)
+000010c0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000010d0: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
+000010e0: 6629 3a0a 2020 2020 2020 2020 6c68 7320  f):.        lhs 
+000010f0: 3d20 222c 222e 6a6f 696e 2822 287b 7d29  = ",".join("({})
+00001100: 222e 666f 726d 6174 2822 2c22 2e6a 6f69  ".format(",".joi
+00001110: 6e28 6469 6d73 2929 2066 6f72 2064 696d  n(dims)) for dim
+00001120: 7320 696e 2073 656c 662e 696e 7075 745f  s in self.input_
+00001130: 636f 7265 5f64 696d 7329 0a20 2020 2020  core_dims).     
+00001140: 2020 2072 6873 203d 2022 2c22 2e6a 6f69     rhs = ",".joi
+00001150: 6e28 2228 7b7d 2922 2e66 6f72 6d61 7428  n("({})".format(
+00001160: 222c 222e 6a6f 696e 2864 696d 7329 2920  ",".join(dims)) 
+00001170: 666f 7220 6469 6d73 2069 6e20 7365 6c66  for dims in self
+00001180: 2e6f 7574 7075 745f 636f 7265 5f64 696d  .output_core_dim
+00001190: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
+000011a0: 6e20 6622 7b6c 6873 7d2d 3e7b 7268 737d  n f"{lhs}->{rhs}
+000011b0: 220a 0a20 2020 2064 6566 2074 6f5f 6775  "..    def to_gu
+000011c0: 6675 6e63 5f73 7472 696e 6728 7365 6c66  func_string(self
+000011d0: 2c20 6578 636c 7564 655f 6469 6d73 3d66  , exclude_dims=f
+000011e0: 726f 7a65 6e73 6574 2829 293a 0a20 2020  rozenset()):.   
+000011f0: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
+00001200: 6e20 6571 7569 7661 6c65 6e74 2073 6967  n equivalent sig
+00001210: 6e61 7475 7265 2073 7472 696e 6720 666f  nature string fo
+00001220: 7220 6120 4e75 6d50 7920 6775 6675 6e63  r a NumPy gufunc
+00001230: 2e0a 0a20 2020 2020 2020 2055 6e6c 696b  ...        Unlik
+00001240: 6520 5f5f 7374 725f 5f2c 2068 616e 646c  e __str__, handl
+00001250: 6573 2064 696d 656e 7369 6f6e 7320 7468  es dimensions th
+00001260: 6174 2064 6f6e 2774 206d 6170 2074 6f20  at don't map to 
+00001270: 5079 7468 6f6e 0a20 2020 2020 2020 2069  Python.        i
+00001280: 6465 6e74 6966 6965 7273 2e0a 0a20 2020  dentifiers...   
+00001290: 2020 2020 2041 6c73 6f20 6372 6561 7465       Also create
+000012a0: 7320 756e 6971 7565 206e 616d 6573 2066  s unique names f
+000012b0: 6f72 2069 6e70 7574 5f63 6f72 655f 6469  or input_core_di
+000012c0: 6d73 2063 6f6e 7461 696e 6564 2069 6e20  ms contained in 
+000012d0: 6578 636c 7564 655f 6469 6d73 2e0a 2020  exclude_dims..  
+000012e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000012f0: 2020 696e 7075 745f 636f 7265 5f64 696d    input_core_dim
+00001300: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+00001310: 2020 5b73 656c 662e 6469 6d73 5f6d 6170    [self.dims_map
+00001320: 5b64 696d 5d20 666f 7220 6469 6d20 696e  [dim] for dim in
+00001330: 2063 6f72 655f 6469 6d73 5d0a 2020 2020   core_dims].    
+00001340: 2020 2020 2020 2020 666f 7220 636f 7265          for core
+00001350: 5f64 696d 7320 696e 2073 656c 662e 696e  _dims in self.in
+00001360: 7075 745f 636f 7265 5f64 696d 730a 2020  put_core_dims.  
+00001370: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00001380: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+00001390: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+000013a0: 205b 7365 6c66 2e64 696d 735f 6d61 705b   [self.dims_map[
+000013b0: 6469 6d5d 2066 6f72 2064 696d 2069 6e20  dim] for dim in 
+000013c0: 636f 7265 5f64 696d 735d 0a20 2020 2020  core_dims].     
+000013d0: 2020 2020 2020 2066 6f72 2063 6f72 655f         for core_
+000013e0: 6469 6d73 2069 6e20 7365 6c66 2e6f 7574  dims in self.out
+000013f0: 7075 745f 636f 7265 5f64 696d 730a 2020  put_core_dims.  
+00001400: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+00001410: 2023 2065 6e75 6d65 7261 7465 2069 6e70   # enumerate inp
+00001420: 7574 5f63 6f72 655f 6469 6d73 2063 6f6e  ut_core_dims con
+00001430: 7461 696e 6564 2069 6e20 6578 636c 7564  tained in exclud
+00001440: 655f 6469 6d73 2074 6f20 6d61 6b65 2074  e_dims to make t
+00001450: 6865 6d20 756e 6971 7565 0a20 2020 2020  hem unique.     
+00001460: 2020 2069 6620 6578 636c 7564 655f 6469     if exclude_di
+00001470: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00001480: 6578 636c 7564 655f 6469 6d73 203d 205b  exclude_dims = [
+00001490: 7365 6c66 2e64 696d 735f 6d61 705b 6469  self.dims_map[di
+000014a0: 6d5d 2066 6f72 2064 696d 2069 6e20 6578  m] for dim in ex
+000014b0: 636c 7564 655f 6469 6d73 5d0a 0a20 2020  clude_dims]..   
+000014c0: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
+000014d0: 203d 2043 6f75 6e74 6572 2829 0a0a 2020   = Counter()..  
+000014e0: 2020 2020 2020 2020 2020 6465 6620 5f65            def _e
+000014f0: 6e75 6d65 7261 7465 2864 696d 293a 0a20  numerate(dim):. 
+00001500: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001510: 6620 6469 6d20 696e 2065 7863 6c75 6465  f dim in exclude
+00001520: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
+00001530: 2020 2020 2020 2020 2020 206e 203d 2063             n = c
+00001540: 6f75 6e74 6572 5b64 696d 5d0a 2020 2020  ounter[dim].    
+00001550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001560: 636f 756e 7465 722e 7570 6461 7465 285b  counter.update([
+00001570: 6469 6d5d 290a 2020 2020 2020 2020 2020  dim]).          
+00001580: 2020 2020 2020 2020 2020 6469 6d20 3d20            dim = 
+00001590: 6622 7b64 696d 7d5f 7b6e 7d22 0a20 2020  f"{dim}_{n}".   
+000015a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000015b0: 7572 6e20 6469 6d0a 0a20 2020 2020 2020  urn dim..       
+000015c0: 2020 2020 2069 6e70 7574 5f63 6f72 655f       input_core_
+000015d0: 6469 6d73 203d 205b 0a20 2020 2020 2020  dims = [.       
+000015e0: 2020 2020 2020 2020 205b 5f65 6e75 6d65           [_enume
+000015f0: 7261 7465 2864 696d 2920 666f 7220 6469  rate(dim) for di
+00001600: 6d20 696e 2061 7267 5d20 666f 7220 6172  m in arg] for ar
+00001610: 6720 696e 2069 6e70 7574 5f63 6f72 655f  g in input_core_
+00001620: 6469 6d73 0a20 2020 2020 2020 2020 2020  dims.           
+00001630: 205d 0a0a 2020 2020 2020 2020 616c 745f   ]..        alt_
+00001640: 7369 676e 6174 7572 6520 3d20 7479 7065  signature = type
+00001650: 2873 656c 6629 2869 6e70 7574 5f63 6f72  (self)(input_cor
+00001660: 655f 6469 6d73 2c20 6f75 7470 7574 5f63  e_dims, output_c
+00001670: 6f72 655f 6469 6d73 290a 2020 2020 2020  ore_dims).      
+00001680: 2020 7265 7475 726e 2073 7472 2861 6c74    return str(alt
+00001690: 5f73 6967 6e61 7475 7265 290a 0a0a 6465  _signature)...de
+000016a0: 6620 7265 7375 6c74 5f6e 616d 6528 6f62  f result_name(ob
+000016b0: 6a65 6374 733a 2049 7465 7261 626c 655b  jects: Iterable[
+000016c0: 416e 795d 2920 2d3e 2041 6e79 3a0a 2020  Any]) -> Any:.  
+000016d0: 2020 2320 7573 6520 7468 6520 7361 6d65    # use the same
+000016e0: 206e 616d 696e 6720 6865 7572 6973 7469   naming heuristi
+000016f0: 6373 2061 7320 7061 6e64 6173 3a0a 2020  cs as pandas:.  
+00001700: 2020 2320 6874 7470 733a 2f2f 6769 7468    # https://gith
+00001710: 7562 2e63 6f6d 2f62 6c61 7a65 2f62 6c61  ub.com/blaze/bla
+00001720: 7a65 2f69 7373 7565 732f 3435 3823 6973  ze/issues/458#is
+00001730: 7375 6563 6f6d 6d65 6e74 2d35 3139 3336  suecomment-51936
+00001740: 3335 360a 2020 2020 6e61 6d65 7320 3d20  356.    names = 
+00001750: 7b67 6574 6174 7472 286f 626a 2c20 226e  {getattr(obj, "n
+00001760: 616d 6522 2c20 5f44 4546 4155 4c54 5f4e  ame", _DEFAULT_N
+00001770: 414d 4529 2066 6f72 206f 626a 2069 6e20  AME) for obj in 
+00001780: 6f62 6a65 6374 737d 0a20 2020 206e 616d  objects}.    nam
+00001790: 6573 2e64 6973 6361 7264 285f 4445 4641  es.discard(_DEFA
+000017a0: 554c 545f 4e41 4d45 290a 2020 2020 6966  ULT_NAME).    if
+000017b0: 206c 656e 286e 616d 6573 2920 3d3d 2031   len(names) == 1
+000017c0: 3a0a 2020 2020 2020 2020 286e 616d 652c  :.        (name,
+000017d0: 2920 3d20 6e61 6d65 730a 2020 2020 656c  ) = names.    el
+000017e0: 7365 3a0a 2020 2020 2020 2020 6e61 6d65  se:.        name
+000017f0: 203d 204e 6f6e 650a 2020 2020 7265 7475   = None.    retu
+00001800: 726e 206e 616d 650a 0a0a 6465 6620 5f67  rn name...def _g
+00001810: 6574 5f63 6f6f 7264 735f 6c69 7374 2861  et_coords_list(a
+00001820: 7267 733a 2049 7465 7261 626c 655b 416e  rgs: Iterable[An
+00001830: 795d 2920 2d3e 206c 6973 745b 436f 6f72  y]) -> list[Coor
+00001840: 6469 6e61 7465 735d 3a0a 2020 2020 636f  dinates]:.    co
+00001850: 6f72 6473 5f6c 6973 7420 3d20 5b5d 0a20  ords_list = []. 
+00001860: 2020 2066 6f72 2061 7267 2069 6e20 6172     for arg in ar
+00001870: 6773 3a0a 2020 2020 2020 2020 7472 793a  gs:.        try:
+00001880: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
+00001890: 7264 7320 3d20 6172 672e 636f 6f72 6473  rds = arg.coords
+000018a0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000018b0: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
+000018c0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+000018d0: 2020 2320 736b 6970 2074 6869 7320 6172    # skip this ar
+000018e0: 6775 6d65 6e74 0a20 2020 2020 2020 2065  gument.        e
+000018f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00001900: 2063 6f6f 7264 735f 6c69 7374 2e61 7070   coords_list.app
+00001910: 656e 6428 636f 6f72 6473 290a 2020 2020  end(coords).    
+00001920: 7265 7475 726e 2063 6f6f 7264 735f 6c69  return coords_li
+00001930: 7374 0a0a 0a64 6566 2062 7569 6c64 5f6f  st...def build_o
+00001940: 7574 7075 745f 636f 6f72 6473 5f61 6e64  utput_coords_and
+00001950: 5f69 6e64 6578 6573 280a 2020 2020 6172  _indexes(.    ar
+00001960: 6773 3a20 4974 6572 6162 6c65 5b41 6e79  gs: Iterable[Any
+00001970: 5d2c 0a20 2020 2073 6967 6e61 7475 7265  ],.    signature
+00001980: 3a20 5f55 4675 6e63 5369 676e 6174 7572  : _UFuncSignatur
+00001990: 652c 0a20 2020 2065 7863 6c75 6465 5f64  e,.    exclude_d
+000019a0: 696d 733a 2053 6574 203d 2066 726f 7a65  ims: Set = froze
+000019b0: 6e73 6574 2829 2c0a 2020 2020 636f 6d62  nset(),.    comb
+000019c0: 696e 655f 6174 7472 733a 2043 6f6d 6269  ine_attrs: Combi
+000019d0: 6e65 4174 7472 734f 7074 696f 6e73 203d  neAttrsOptions =
+000019e0: 2022 6f76 6572 7269 6465 222c 0a29 202d   "override",.) -
+000019f0: 3e20 7475 706c 655b 6c69 7374 5b64 6963  > tuple[list[dic
+00001a00: 745b 416e 792c 2056 6172 6961 626c 655d  t[Any, Variable]
+00001a10: 5d2c 206c 6973 745b 6469 6374 5b41 6e79  ], list[dict[Any
+00001a20: 2c20 496e 6465 785d 5d5d 3a0a 2020 2020  , Index]]]:.    
+00001a30: 2222 2242 7569 6c64 206f 7574 7075 7420  """Build output 
+00001a40: 636f 6f72 6469 6e61 7465 7320 616e 6420  coordinates and 
+00001a50: 696e 6465 7865 7320 666f 7220 616e 206f  indexes for an o
+00001a60: 7065 7261 7469 6f6e 2e0a 0a20 2020 2050  peration...    P
+00001a70: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00001a80: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061 7267  --------.    arg
+00001a90: 7320 3a20 4974 6572 6162 6c65 0a20 2020  s : Iterable.   
+00001aa0: 2020 2020 204c 6973 7420 6f66 2072 6177       List of raw
+00001ab0: 206f 7065 7261 7469 6f6e 2061 7267 756d   operation argum
+00001ac0: 656e 7473 2e20 416e 7920 7661 6c69 6420  ents. Any valid 
+00001ad0: 7479 7065 7320 666f 7220 7861 7272 6179  types for xarray
+00001ae0: 206f 7065 7261 7469 6f6e 730a 2020 2020   operations.    
+00001af0: 2020 2020 6172 6520 4f4b 2c20 652e 672e      are OK, e.g.
+00001b00: 2c20 7363 616c 6172 732c 2056 6172 6961  , scalars, Varia
+00001b10: 626c 652c 2044 6174 6141 7272 6179 2c20  ble, DataArray, 
+00001b20: 4461 7461 7365 742e 0a20 2020 2073 6967  Dataset..    sig
+00001b30: 6e61 7475 7265 203a 205f 5566 756e 6353  nature : _UfuncS
+00001b40: 6967 6e61 7475 7265 0a20 2020 2020 2020  ignature.       
+00001b50: 2043 6f72 6520 6469 6d65 6e73 696f 6e73   Core dimensions
+00001b60: 2073 6967 6e61 7475 7265 2066 6f72 2074   signature for t
+00001b70: 6865 206f 7065 7261 7469 6f6e 2e0a 2020  he operation..  
+00001b80: 2020 6578 636c 7564 655f 6469 6d73 203a    exclude_dims :
+00001b90: 2073 6574 2c20 6f70 7469 6f6e 616c 0a20   set, optional. 
+00001ba0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+00001bb0: 7320 6578 636c 7564 6564 2066 726f 6d20  s excluded from 
+00001bc0: 7468 6520 6f70 6572 6174 696f 6e2e 2043  the operation. C
+00001bd0: 6f6f 7264 696e 6174 6573 2061 6c6f 6e67  oordinates along
+00001be0: 2074 6865 7365 0a20 2020 2020 2020 2064   these.        d
+00001bf0: 696d 656e 7369 6f6e 7320 6172 6520 6472  imensions are dr
+00001c00: 6f70 7065 642e 0a20 2020 2063 6f6d 6269  opped..    combi
+00001c10: 6e65 5f61 7474 7273 203a 207b 2264 726f  ne_attrs : {"dro
+00001c20: 7022 2c20 2269 6465 6e74 6963 616c 222c  p", "identical",
+00001c30: 2022 6e6f 5f63 6f6e 666c 6963 7473 222c   "no_conflicts",
+00001c40: 2022 6472 6f70 5f63 6f6e 666c 6963 7473   "drop_conflicts
+00001c50: 222c 205c 0a20 2020 2020 2020 2020 2020  ", \.           
+00001c60: 2020 2020 2020 2020 2020 226f 7665 7272            "overr
+00001c70: 6964 6522 7d20 6f72 2063 616c 6c61 626c  ide"} or callabl
+00001c80: 652c 2064 6566 6175 6c74 3a20 2264 726f  e, default: "dro
+00001c90: 7022 0a20 2020 2020 2020 2041 2063 616c  p".        A cal
+00001ca0: 6c61 626c 6520 6f72 2061 2073 7472 696e  lable or a strin
+00001cb0: 6720 696e 6469 6361 7469 6e67 2068 6f77  g indicating how
+00001cc0: 2074 6f20 636f 6d62 696e 6520 6174 7472   to combine attr
+00001cd0: 7320 6f66 2074 6865 206f 626a 6563 7473  s of the objects
+00001ce0: 2062 6569 6e67 0a20 2020 2020 2020 206d   being.        m
+00001cf0: 6572 6765 643a 0a0a 2020 2020 2020 2020  erged:..        
+00001d00: 2d20 2264 726f 7022 3a20 656d 7074 7920  - "drop": empty 
+00001d10: 6174 7472 7320 6f6e 2072 6574 7572 6e65  attrs on returne
+00001d20: 6420 4461 7461 7365 742e 0a20 2020 2020  d Dataset..     
+00001d30: 2020 202d 2022 6964 656e 7469 6361 6c22     - "identical"
+00001d40: 3a20 616c 6c20 6174 7472 7320 6d75 7374  : all attrs must
+00001d50: 2062 6520 7468 6520 7361 6d65 206f 6e20   be the same on 
+00001d60: 6576 6572 7920 6f62 6a65 6374 2e0a 2020  every object..  
+00001d70: 2020 2020 2020 2d20 226e 6f5f 636f 6e66        - "no_conf
+00001d80: 6c69 6374 7322 3a20 6174 7472 7320 6672  licts": attrs fr
+00001d90: 6f6d 2061 6c6c 206f 626a 6563 7473 2061  om all objects a
+00001da0: 7265 2063 6f6d 6269 6e65 642c 2061 6e79  re combined, any
+00001db0: 2074 6861 7420 6861 7665 0a20 2020 2020   that have.     
+00001dc0: 2020 2020 2074 6865 2073 616d 6520 6e61       the same na
+00001dd0: 6d65 206d 7573 7420 616c 736f 2068 6176  me must also hav
+00001de0: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
+00001df0: 2e0a 2020 2020 2020 2020 2d20 2264 726f  ..        - "dro
+00001e00: 705f 636f 6e66 6c69 6374 7322 3a20 6174  p_conflicts": at
+00001e10: 7472 7320 6672 6f6d 2061 6c6c 206f 626a  trs from all obj
+00001e20: 6563 7473 2061 7265 2063 6f6d 6269 6e65  ects are combine
+00001e30: 642c 2061 6e79 2074 6861 7420 6861 7665  d, any that have
+00001e40: 0a20 2020 2020 2020 2020 2074 6865 2073  .          the s
+00001e50: 616d 6520 6e61 6d65 2062 7574 2064 6966  ame name but dif
+00001e60: 6665 7265 6e74 2076 616c 7565 7320 6172  ferent values ar
+00001e70: 6520 6472 6f70 7065 642e 0a20 2020 2020  e dropped..     
+00001e80: 2020 202d 2022 6f76 6572 7269 6465 223a     - "override":
+00001e90: 2073 6b69 7020 636f 6d70 6172 696e 6720   skip comparing 
+00001ea0: 616e 6420 636f 7079 2061 7474 7273 2066  and copy attrs f
+00001eb0: 726f 6d20 7468 6520 6669 7273 7420 6461  rom the first da
+00001ec0: 7461 7365 7420 746f 0a20 2020 2020 2020  taset to.       
+00001ed0: 2020 2074 6865 2072 6573 756c 742e 0a0a     the result...
+00001ee0: 2020 2020 2020 2020 4966 2061 2063 616c          If a cal
+00001ef0: 6c61 626c 652c 2069 7420 6d75 7374 2065  lable, it must e
+00001f00: 7870 6563 7420 6120 7365 7175 656e 6365  xpect a sequence
+00001f10: 206f 6620 6060 6174 7472 7360 6020 6469   of ``attrs`` di
+00001f20: 6374 7320 616e 6420 6120 636f 6e74 6578  cts and a contex
+00001f30: 7420 6f62 6a65 6374 0a20 2020 2020 2020  t object.       
+00001f40: 2061 7320 6974 7320 6f6e 6c79 2070 6172   as its only par
+00001f50: 616d 6574 6572 732e 0a0a 2020 2020 5265  ameters...    Re
+00001f60: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00001f70: 2d0a 2020 2020 4469 6374 696f 6e61 7269  -.    Dictionari
+00001f80: 6573 206f 6620 5661 7269 6162 6c65 2061  es of Variable a
+00001f90: 6e64 2049 6e64 6578 206f 626a 6563 7473  nd Index objects
+00001fa0: 2077 6974 6820 6d65 7267 6564 2063 6f6f   with merged coo
+00001fb0: 7264 696e 6174 6573 2e0a 2020 2020 2222  rdinates..    ""
+00001fc0: 220a 2020 2020 636f 6f72 6473 5f6c 6973  ".    coords_lis
+00001fd0: 7420 3d20 5f67 6574 5f63 6f6f 7264 735f  t = _get_coords_
+00001fe0: 6c69 7374 2861 7267 7329 0a0a 2020 2020  list(args)..    
+00001ff0: 6966 206c 656e 2863 6f6f 7264 735f 6c69  if len(coords_li
+00002000: 7374 2920 3d3d 2031 2061 6e64 206e 6f74  st) == 1 and not
+00002010: 2065 7863 6c75 6465 5f64 696d 733a 0a20   exclude_dims:. 
+00002020: 2020 2020 2020 2023 2077 6520 6361 6e20         # we can 
+00002030: 736b 6970 2074 6865 2065 7870 656e 7369  skip the expensi
+00002040: 7665 206d 6572 6765 0a20 2020 2020 2020  ve merge.       
+00002050: 2028 756e 7061 636b 6564 5f63 6f6f 7264   (unpacked_coord
+00002060: 732c 2920 3d20 636f 6f72 6473 5f6c 6973  s,) = coords_lis
+00002070: 740a 2020 2020 2020 2020 6d65 7267 6564  t.        merged
+00002080: 5f76 6172 7320 3d20 6469 6374 2875 6e70  _vars = dict(unp
+00002090: 6163 6b65 645f 636f 6f72 6473 2e76 6172  acked_coords.var
+000020a0: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
+000020b0: 6d65 7267 6564 5f69 6e64 6578 6573 203d  merged_indexes =
+000020c0: 2064 6963 7428 756e 7061 636b 6564 5f63   dict(unpacked_c
+000020d0: 6f6f 7264 732e 7869 6e64 6578 6573 290a  oords.xindexes).
+000020e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000020f0: 2020 6d65 7267 6564 5f76 6172 732c 206d    merged_vars, m
+00002100: 6572 6765 645f 696e 6465 7865 7320 3d20  erged_indexes = 
+00002110: 6d65 7267 655f 636f 6f72 6469 6e61 7465  merge_coordinate
+00002120: 735f 7769 7468 6f75 745f 616c 6967 6e28  s_without_align(
+00002130: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
+00002140: 7264 735f 6c69 7374 2c20 6578 636c 7564  rds_list, exclud
+00002150: 655f 6469 6d73 3d65 7863 6c75 6465 5f64  e_dims=exclude_d
+00002160: 696d 732c 2063 6f6d 6269 6e65 5f61 7474  ims, combine_att
+00002170: 7273 3d63 6f6d 6269 6e65 5f61 7474 7273  rs=combine_attrs
+00002180: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00002190: 6f75 7470 7574 5f63 6f6f 7264 7320 3d20  output_coords = 
+000021a0: 5b5d 0a20 2020 206f 7574 7075 745f 696e  [].    output_in
+000021b0: 6465 7865 7320 3d20 5b5d 0a20 2020 2066  dexes = [].    f
+000021c0: 6f72 206f 7574 7075 745f 6469 6d73 2069  or output_dims i
+000021d0: 6e20 7369 676e 6174 7572 652e 6f75 7470  n signature.outp
+000021e0: 7574 5f63 6f72 655f 6469 6d73 3a0a 2020  ut_core_dims:.  
+000021f0: 2020 2020 2020 6472 6f70 7065 645f 6469        dropped_di
+00002200: 6d73 203d 2073 6967 6e61 7475 7265 2e61  ms = signature.a
+00002210: 6c6c 5f69 6e70 7574 5f63 6f72 655f 6469  ll_input_core_di
+00002220: 6d73 202d 2073 6574 286f 7574 7075 745f  ms - set(output_
+00002230: 6469 6d73 290a 2020 2020 2020 2020 6966  dims).        if
+00002240: 2064 726f 7070 6564 5f64 696d 733a 0a20   dropped_dims:. 
+00002250: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00002260: 7265 645f 636f 6f72 6473 203d 207b 0a20  red_coords = {. 
+00002270: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00002280: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+00002290: 6d65 7267 6564 5f76 6172 732e 6974 656d  merged_vars.item
+000022a0: 7328 2920 6966 2064 726f 7070 6564 5f64  s() if dropped_d
+000022b0: 696d 732e 6973 6469 736a 6f69 6e74 2876  ims.isdisjoint(v
+000022c0: 2e64 696d 7329 0a20 2020 2020 2020 2020  .dims).         
+000022d0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+000022e0: 2066 696c 7465 7265 645f 696e 6465 7865   filtered_indexe
+000022f0: 7320 3d20 6669 6c74 6572 5f69 6e64 6578  s = filter_index
+00002300: 6573 5f66 726f 6d5f 636f 6f72 6473 280a  es_from_coords(.
+00002310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002320: 6d65 7267 6564 5f69 6e64 6578 6573 2c20  merged_indexes, 
+00002330: 7365 7428 6669 6c74 6572 6564 5f63 6f6f  set(filtered_coo
+00002340: 7264 7329 0a20 2020 2020 2020 2020 2020  rds).           
+00002350: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+00002360: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00002370: 7465 7265 645f 636f 6f72 6473 203d 206d  tered_coords = m
+00002380: 6572 6765 645f 7661 7273 0a20 2020 2020  erged_vars.     
+00002390: 2020 2020 2020 2066 696c 7465 7265 645f         filtered_
+000023a0: 696e 6465 7865 7320 3d20 6d65 7267 6564  indexes = merged
+000023b0: 5f69 6e64 6578 6573 0a20 2020 2020 2020  _indexes.       
+000023c0: 206f 7574 7075 745f 636f 6f72 6473 2e61   output_coords.a
+000023d0: 7070 656e 6428 6669 6c74 6572 6564 5f63  ppend(filtered_c
+000023e0: 6f6f 7264 7329 0a20 2020 2020 2020 206f  oords).        o
+000023f0: 7574 7075 745f 696e 6465 7865 732e 6170  utput_indexes.ap
+00002400: 7065 6e64 2866 696c 7465 7265 645f 696e  pend(filtered_in
+00002410: 6465 7865 7329 0a0a 2020 2020 7265 7475  dexes)..    retu
+00002420: 726e 206f 7574 7075 745f 636f 6f72 6473  rn output_coords
+00002430: 2c20 6f75 7470 7574 5f69 6e64 6578 6573  , output_indexes
+00002440: 0a0a 0a64 6566 2061 7070 6c79 5f64 6174  ...def apply_dat
+00002450: 6161 7272 6179 5f76 6675 6e63 280a 2020  aarray_vfunc(.  
+00002460: 2020 6675 6e63 2c0a 2020 2020 2a61 7267    func,.    *arg
+00002470: 732c 0a20 2020 2073 6967 6e61 7475 7265  s,.    signature
+00002480: 3a20 5f55 4675 6e63 5369 676e 6174 7572  : _UFuncSignatur
+00002490: 652c 0a20 2020 206a 6f69 6e3a 204a 6f69  e,.    join: Joi
+000024a0: 6e4f 7074 696f 6e73 203d 2022 696e 6e65  nOptions = "inne
+000024b0: 7222 2c0a 2020 2020 6578 636c 7564 655f  r",.    exclude_
+000024c0: 6469 6d73 3d66 726f 7a65 6e73 6574 2829  dims=frozenset()
+000024d0: 2c0a 2020 2020 6b65 6570 5f61 7474 7273  ,.    keep_attrs
+000024e0: 3d22 6f76 6572 7269 6465 222c 0a29 202d  ="override",.) -
+000024f0: 3e20 7475 706c 655b 4461 7461 4172 7261  > tuple[DataArra
+00002500: 792c 202e 2e2e 5d20 7c20 4461 7461 4172  y, ...] | DataAr
+00002510: 7261 793a 0a20 2020 2022 2222 4170 706c  ray:.    """Appl
+00002520: 7920 6120 7661 7269 6162 6c65 206c 6576  y a variable lev
+00002530: 656c 2066 756e 6374 696f 6e20 6f76 6572  el function over
+00002540: 2044 6174 6141 7272 6179 2c20 5661 7269   DataArray, Vari
+00002550: 6162 6c65 2061 6e64 2f6f 7220 6e64 6172  able and/or ndar
+00002560: 7261 790a 2020 2020 6f62 6a65 6374 732e  ray.    objects.
+00002570: 0a20 2020 2022 2222 0a20 2020 2066 726f  .    """.    fro
+00002580: 6d20 7861 7272 6179 2e63 6f72 652e 6461  m xarray.core.da
+00002590: 7461 6172 7261 7920 696d 706f 7274 2044  taarray import D
+000025a0: 6174 6141 7272 6179 0a0a 2020 2020 6966  ataArray..    if
+000025b0: 206c 656e 2861 7267 7329 203e 2031 3a0a   len(args) > 1:.
+000025c0: 2020 2020 2020 2020 6172 6773 203d 2064          args = d
+000025d0: 6565 705f 616c 6967 6e28 0a20 2020 2020  eep_align(.     
+000025e0: 2020 2020 2020 2061 7267 732c 206a 6f69         args, joi
+000025f0: 6e3d 6a6f 696e 2c20 636f 7079 3d46 616c  n=join, copy=Fal
+00002600: 7365 2c20 6578 636c 7564 653d 6578 636c  se, exclude=excl
+00002610: 7564 655f 6469 6d73 2c20 7261 6973 655f  ude_dims, raise_
+00002620: 6f6e 5f69 6e76 616c 6964 3d46 616c 7365  on_invalid=False
+00002630: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00002640: 6f62 6a73 203d 205f 616c 6c5f 6f66 5f74  objs = _all_of_t
+00002650: 7970 6528 6172 6773 2c20 4461 7461 4172  ype(args, DataAr
+00002660: 7261 7929 0a0a 2020 2020 6966 206b 6565  ray)..    if kee
+00002670: 705f 6174 7472 7320 3d3d 2022 6472 6f70  p_attrs == "drop
+00002680: 223a 0a20 2020 2020 2020 206e 616d 6520  ":.        name 
+00002690: 3d20 7265 7375 6c74 5f6e 616d 6528 6172  = result_name(ar
+000026a0: 6773 290a 2020 2020 656c 7365 3a0a 2020  gs).    else:.  
+000026b0: 2020 2020 2020 6669 7273 745f 6f62 6a20        first_obj 
+000026c0: 3d20 5f66 6972 7374 5f6f 665f 7479 7065  = _first_of_type
+000026d0: 2861 7267 732c 2044 6174 6141 7272 6179  (args, DataArray
+000026e0: 290a 2020 2020 2020 2020 6e61 6d65 203d  ).        name =
+000026f0: 2066 6972 7374 5f6f 626a 2e6e 616d 650a   first_obj.name.
+00002700: 2020 2020 7265 7375 6c74 5f63 6f6f 7264      result_coord
+00002710: 732c 2072 6573 756c 745f 696e 6465 7865  s, result_indexe
+00002720: 7320 3d20 6275 696c 645f 6f75 7470 7574  s = build_output
+00002730: 5f63 6f6f 7264 735f 616e 645f 696e 6465  _coords_and_inde
+00002740: 7865 7328 0a20 2020 2020 2020 2061 7267  xes(.        arg
+00002750: 732c 2073 6967 6e61 7475 7265 2c20 6578  s, signature, ex
+00002760: 636c 7564 655f 6469 6d73 2c20 636f 6d62  clude_dims, comb
+00002770: 696e 655f 6174 7472 733d 6b65 6570 5f61  ine_attrs=keep_a
+00002780: 7474 7273 0a20 2020 2029 0a0a 2020 2020  ttrs.    )..    
+00002790: 6461 7461 5f76 6172 7320 3d20 5b67 6574  data_vars = [get
+000027a0: 6174 7472 2861 2c20 2276 6172 6961 626c  attr(a, "variabl
+000027b0: 6522 2c20 6129 2066 6f72 2061 2069 6e20  e", a) for a in 
+000027c0: 6172 6773 5d0a 2020 2020 7265 7375 6c74  args].    result
+000027d0: 5f76 6172 203d 2066 756e 6328 2a64 6174  _var = func(*dat
+000027e0: 615f 7661 7273 290a 0a20 2020 206f 7574  a_vars)..    out
+000027f0: 3a20 7475 706c 655b 4461 7461 4172 7261  : tuple[DataArra
+00002800: 792c 202e 2e2e 5d20 7c20 4461 7461 4172  y, ...] | DataAr
+00002810: 7261 790a 2020 2020 6966 2073 6967 6e61  ray.    if signa
+00002820: 7475 7265 2e6e 756d 5f6f 7574 7075 7473  ture.num_outputs
+00002830: 203e 2031 3a0a 2020 2020 2020 2020 6f75   > 1:.        ou
+00002840: 7420 3d20 7475 706c 6528 0a20 2020 2020  t = tuple(.     
+00002850: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
+00002860: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002870: 2020 7661 7269 6162 6c65 2c20 636f 6f72    variable, coor
+00002880: 6473 3d63 6f6f 7264 732c 2069 6e64 6578  ds=coords, index
+00002890: 6573 3d69 6e64 6578 6573 2c20 6e61 6d65  es=indexes, name
+000028a0: 3d6e 616d 652c 2066 6173 7470 6174 683d  =name, fastpath=
+000028b0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000028c0: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
+000028d0: 6f72 2076 6172 6961 626c 652c 2063 6f6f  or variable, coo
+000028e0: 7264 732c 2069 6e64 6578 6573 2069 6e20  rds, indexes in 
+000028f0: 7a69 7028 0a20 2020 2020 2020 2020 2020  zip(.           
+00002900: 2020 2020 2072 6573 756c 745f 7661 722c       result_var,
+00002910: 2072 6573 756c 745f 636f 6f72 6473 2c20   result_coords, 
+00002920: 7265 7375 6c74 5f69 6e64 6578 6573 0a20  result_indexes. 
+00002930: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00002940: 2020 2020 2029 0a20 2020 2065 6c73 653a       ).    else:
+00002950: 0a20 2020 2020 2020 2028 636f 6f72 6473  .        (coords
+00002960: 2c29 203d 2072 6573 756c 745f 636f 6f72  ,) = result_coor
+00002970: 6473 0a20 2020 2020 2020 2028 696e 6465  ds.        (inde
+00002980: 7865 732c 2920 3d20 7265 7375 6c74 5f69  xes,) = result_i
+00002990: 6e64 6578 6573 0a20 2020 2020 2020 206f  ndexes.        o
+000029a0: 7574 203d 2044 6174 6141 7272 6179 280a  ut = DataArray(.
+000029b0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+000029c0: 6c74 5f76 6172 2c20 636f 6f72 6473 3d63  lt_var, coords=c
+000029d0: 6f6f 7264 732c 2069 6e64 6578 6573 3d69  oords, indexes=i
+000029e0: 6e64 6578 6573 2c20 6e61 6d65 3d6e 616d  ndexes, name=nam
+000029f0: 652c 2066 6173 7470 6174 683d 5472 7565  e, fastpath=True
+00002a00: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00002a10: 6174 7472 7320 3d20 6d65 7267 655f 6174  attrs = merge_at
+00002a20: 7472 7328 5b78 2e61 7474 7273 2066 6f72  trs([x.attrs for
+00002a30: 2078 2069 6e20 6f62 6a73 5d2c 2063 6f6d   x in objs], com
+00002a40: 6269 6e65 5f61 7474 7273 3d6b 6565 705f  bine_attrs=keep_
+00002a50: 6174 7472 7329 0a20 2020 2069 6620 6973  attrs).    if is
+00002a60: 696e 7374 616e 6365 286f 7574 2c20 7475  instance(out, tu
+00002a70: 706c 6529 3a0a 2020 2020 2020 2020 666f  ple):.        fo
+00002a80: 7220 6461 2069 6e20 6f75 743a 0a20 2020  r da in out:.   
+00002a90: 2020 2020 2020 2020 2064 612e 6174 7472           da.attr
+00002aa0: 7320 3d20 6174 7472 730a 2020 2020 656c  s = attrs.    el
+00002ab0: 7365 3a0a 2020 2020 2020 2020 6f75 742e  se:.        out.
+00002ac0: 6174 7472 7320 3d20 6174 7472 730a 0a20  attrs = attrs.. 
+00002ad0: 2020 2072 6574 7572 6e20 6f75 740a 0a0a     return out...
+00002ae0: 6465 6620 6f72 6465 7265 645f 7365 745f  def ordered_set_
+00002af0: 756e 696f 6e28 616c 6c5f 6b65 7973 3a20  union(all_keys: 
+00002b00: 6c69 7374 5b49 7465 7261 626c 655d 2920  list[Iterable]) 
+00002b10: 2d3e 2049 7465 7261 626c 653a 0a20 2020  -> Iterable:.   
+00002b20: 2072 6574 7572 6e20 7b6b 6579 3a20 4e6f   return {key: No
+00002b30: 6e65 2066 6f72 206b 6579 7320 696e 2061  ne for keys in a
+00002b40: 6c6c 5f6b 6579 7320 666f 7220 6b65 7920  ll_keys for key 
+00002b50: 696e 206b 6579 737d 2e6b 6579 7328 290a  in keys}.keys().
+00002b60: 0a0a 6465 6620 6f72 6465 7265 645f 7365  ..def ordered_se
+00002b70: 745f 696e 7465 7273 6563 7469 6f6e 2861  t_intersection(a
+00002b80: 6c6c 5f6b 6579 733a 206c 6973 745b 4974  ll_keys: list[It
+00002b90: 6572 6162 6c65 5d29 202d 3e20 4974 6572  erable]) -> Iter
+00002ba0: 6162 6c65 3a0a 2020 2020 696e 7465 7273  able:.    inters
+00002bb0: 6563 7469 6f6e 203d 2073 6574 2861 6c6c  ection = set(all
+00002bc0: 5f6b 6579 735b 305d 290a 2020 2020 666f  _keys[0]).    fo
+00002bd0: 7220 6b65 7973 2069 6e20 616c 6c5f 6b65  r keys in all_ke
+00002be0: 7973 5b31 3a5d 3a0a 2020 2020 2020 2020  ys[1:]:.        
+00002bf0: 696e 7465 7273 6563 7469 6f6e 2e69 6e74  intersection.int
+00002c00: 6572 7365 6374 696f 6e5f 7570 6461 7465  ersection_update
+00002c10: 286b 6579 7329 0a20 2020 2072 6574 7572  (keys).    retur
+00002c20: 6e20 5b6b 6579 2066 6f72 206b 6579 2069  n [key for key i
+00002c30: 6e20 616c 6c5f 6b65 7973 5b30 5d20 6966  n all_keys[0] if
+00002c40: 206b 6579 2069 6e20 696e 7465 7273 6563   key in intersec
+00002c50: 7469 6f6e 5d0a 0a0a 6465 6620 6173 7365  tion]...def asse
+00002c60: 7274 5f61 6e64 5f72 6574 7572 6e5f 6578  rt_and_return_ex
+00002c70: 6163 745f 6d61 7463 6828 616c 6c5f 6b65  act_match(all_ke
+00002c80: 7973 293a 0a20 2020 2066 6972 7374 5f6b  ys):.    first_k
+00002c90: 6579 7320 3d20 616c 6c5f 6b65 7973 5b30  eys = all_keys[0
+00002ca0: 5d0a 2020 2020 666f 7220 6b65 7973 2069  ].    for keys i
+00002cb0: 6e20 616c 6c5f 6b65 7973 5b31 3a5d 3a0a  n all_keys[1:]:.
+00002cc0: 2020 2020 2020 2020 6966 206b 6579 7320          if keys 
+00002cd0: 213d 2066 6972 7374 5f6b 6579 733a 0a20  != first_keys:. 
+00002ce0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00002cf0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00002d00: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
+00002d10: 6163 7420 6d61 7463 6820 7265 7175 6972  act match requir
+00002d20: 6564 2066 6f72 2061 6c6c 2064 6174 6120  ed for all data 
+00002d30: 7661 7269 6162 6c65 206e 616d 6573 2c20  variable names, 
+00002d40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00002d50: 2020 6622 6275 7420 7b6b 6579 7321 727d    f"but {keys!r}
+00002d60: 2021 3d20 7b66 6972 7374 5f6b 6579 7321   != {first_keys!
+00002d70: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
+00002d80: 290a 2020 2020 7265 7475 726e 2066 6972  ).    return fir
+00002d90: 7374 5f6b 6579 730a 0a0a 5f4a 4f49 4e45  st_keys..._JOINE
+00002da0: 5253 3a20 6469 6374 5b73 7472 2c20 4361  RS: dict[str, Ca
+00002db0: 6c6c 6162 6c65 5d20 3d20 7b0a 2020 2020  llable] = {.    
+00002dc0: 2269 6e6e 6572 223a 206f 7264 6572 6564  "inner": ordered
+00002dd0: 5f73 6574 5f69 6e74 6572 7365 6374 696f  _set_intersectio
+00002de0: 6e2c 0a20 2020 2022 6f75 7465 7222 3a20  n,.    "outer": 
+00002df0: 6f72 6465 7265 645f 7365 745f 756e 696f  ordered_set_unio
+00002e00: 6e2c 0a20 2020 2022 6c65 6674 223a 206f  n,.    "left": o
+00002e10: 7065 7261 746f 722e 6974 656d 6765 7474  perator.itemgett
+00002e20: 6572 2830 292c 0a20 2020 2022 7269 6768  er(0),.    "righ
+00002e30: 7422 3a20 6f70 6572 6174 6f72 2e69 7465  t": operator.ite
+00002e40: 6d67 6574 7465 7228 2d31 292c 0a20 2020  mgetter(-1),.   
+00002e50: 2022 6578 6163 7422 3a20 6173 7365 7274   "exact": assert
+00002e60: 5f61 6e64 5f72 6574 7572 6e5f 6578 6163  _and_return_exac
+00002e70: 745f 6d61 7463 682c 0a7d 0a0a 0a64 6566  t_match,.}...def
+00002e80: 206a 6f69 6e5f 6469 6374 5f6b 6579 7328   join_dict_keys(
+00002e90: 6f62 6a65 6374 733a 2049 7465 7261 626c  objects: Iterabl
+00002ea0: 655b 4d61 7070 696e 6720 7c20 416e 795d  e[Mapping | Any]
+00002eb0: 2c20 686f 773a 2073 7472 203d 2022 696e  , how: str = "in
+00002ec0: 6e65 7222 2920 2d3e 2049 7465 7261 626c  ner") -> Iterabl
+00002ed0: 653a 0a20 2020 206a 6f69 6e65 7220 3d20  e:.    joiner = 
+00002ee0: 5f4a 4f49 4e45 5253 5b68 6f77 5d0a 2020  _JOINERS[how].  
+00002ef0: 2020 616c 6c5f 6b65 7973 203d 205b 6f62    all_keys = [ob
+00002f00: 6a2e 6b65 7973 2829 2066 6f72 206f 626a  j.keys() for obj
+00002f10: 2069 6e20 6f62 6a65 6374 7320 6966 2068   in objects if h
+00002f20: 6173 6174 7472 286f 626a 2c20 226b 6579  asattr(obj, "key
+00002f30: 7322 295d 0a20 2020 2072 6574 7572 6e20  s")].    return 
+00002f40: 6a6f 696e 6572 2861 6c6c 5f6b 6579 7329  joiner(all_keys)
+00002f50: 0a0a 0a64 6566 2063 6f6c 6c65 6374 5f64  ...def collect_d
+00002f60: 6963 745f 7661 6c75 6573 280a 2020 2020  ict_values(.    
+00002f70: 6f62 6a65 6374 733a 2049 7465 7261 626c  objects: Iterabl
+00002f80: 655b 4d61 7070 696e 6720 7c20 416e 795d  e[Mapping | Any]
+00002f90: 2c20 6b65 7973 3a20 4974 6572 6162 6c65  , keys: Iterable
+00002fa0: 2c20 6669 6c6c 5f76 616c 7565 3a20 6f62  , fill_value: ob
+00002fb0: 6a65 6374 203d 204e 6f6e 650a 2920 2d3e  ject = None.) ->
+00002fc0: 206c 6973 745b 6c69 7374 5d3a 0a20 2020   list[list]:.   
+00002fd0: 2072 6574 7572 6e20 5b0a 2020 2020 2020   return [.      
+00002fe0: 2020 5b6f 626a 2e67 6574 286b 6579 2c20    [obj.get(key, 
+00002ff0: 6669 6c6c 5f76 616c 7565 2920 6966 2069  fill_value) if i
+00003000: 735f 6469 6374 5f6c 696b 6528 6f62 6a29  s_dict_like(obj)
+00003010: 2065 6c73 6520 6f62 6a20 666f 7220 6f62   else obj for ob
+00003020: 6a20 696e 206f 626a 6563 7473 5d0a 2020  j in objects].  
+00003030: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
+00003040: 206b 6579 730a 2020 2020 5d0a 0a0a 6465   keys.    ]...de
+00003050: 6620 5f61 735f 7661 7269 6162 6c65 735f  f _as_variables_
+00003060: 6f72 5f76 6172 6961 626c 6528 6172 6729  or_variable(arg)
+00003070: 3a0a 2020 2020 7472 793a 0a20 2020 2020  :.    try:.     
+00003080: 2020 2072 6574 7572 6e20 6172 672e 7661     return arg.va
+00003090: 7269 6162 6c65 730a 2020 2020 6578 6365  riables.    exce
+000030a0: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
+000030b0: 723a 0a20 2020 2020 2020 2074 7279 3a0a  r:.        try:.
+000030c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000030d0: 726e 2061 7267 2e76 6172 6961 626c 650a  rn arg.variable.
+000030e0: 2020 2020 2020 2020 6578 6365 7074 2041          except A
+000030f0: 7474 7269 6275 7465 4572 726f 723a 0a20  ttributeError:. 
+00003100: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003110: 6e20 6172 670a 0a0a 6465 6620 5f75 6e70  n arg...def _unp
+00003120: 6163 6b5f 6469 6374 5f74 7570 6c65 7328  ack_dict_tuples(
+00003130: 0a20 2020 2072 6573 756c 745f 7661 7273  .    result_vars
+00003140: 3a20 4d61 7070 696e 675b 416e 792c 2074  : Mapping[Any, t
+00003150: 7570 6c65 5b56 6172 6961 626c 652c 202e  uple[Variable, .
+00003160: 2e2e 5d5d 2c20 6e75 6d5f 6f75 7470 7574  ..]], num_output
+00003170: 733a 2069 6e74 0a29 202d 3e20 7475 706c  s: int.) -> tupl
+00003180: 655b 6469 6374 5b48 6173 6861 626c 652c  e[dict[Hashable,
+00003190: 2056 6172 6961 626c 655d 2c20 2e2e 2e5d   Variable], ...]
+000031a0: 3a0a 2020 2020 6f75 743a 2074 7570 6c65  :.    out: tuple
+000031b0: 5b64 6963 745b 4861 7368 6162 6c65 2c20  [dict[Hashable, 
+000031c0: 5661 7269 6162 6c65 5d2c 202e 2e2e 5d20  Variable], ...] 
+000031d0: 3d20 7475 706c 6528 7b7d 2066 6f72 205f  = tuple({} for _
+000031e0: 2069 6e20 7261 6e67 6528 6e75 6d5f 6f75   in range(num_ou
+000031f0: 7470 7574 7329 290a 2020 2020 666f 7220  tputs)).    for 
+00003200: 6e61 6d65 2c20 7661 6c75 6573 2069 6e20  name, values in 
+00003210: 7265 7375 6c74 5f76 6172 732e 6974 656d  result_vars.item
+00003220: 7328 293a 0a20 2020 2020 2020 2066 6f72  s():.        for
+00003230: 2076 616c 7565 2c20 7265 7375 6c74 735f   value, results_
+00003240: 6469 6374 2069 6e20 7a69 7028 7661 6c75  dict in zip(valu
+00003250: 6573 2c20 6f75 7429 3a0a 2020 2020 2020  es, out):.      
+00003260: 2020 2020 2020 7265 7375 6c74 735f 6469        results_di
+00003270: 6374 5b6e 616d 655d 203d 2076 616c 7565  ct[name] = value
+00003280: 0a20 2020 2072 6574 7572 6e20 6f75 740a  .    return out.
+00003290: 0a0a 6465 6620 6170 706c 795f 6469 6374  ..def apply_dict
+000032a0: 5f6f 665f 7661 7269 6162 6c65 735f 7666  _of_variables_vf
+000032b0: 756e 6328 0a20 2020 2066 756e 632c 202a  unc(.    func, *
+000032c0: 6172 6773 2c20 7369 676e 6174 7572 653a  args, signature:
+000032d0: 205f 5546 756e 6353 6967 6e61 7475 7265   _UFuncSignature
+000032e0: 2c20 6a6f 696e 3d22 696e 6e65 7222 2c20  , join="inner", 
+000032f0: 6669 6c6c 5f76 616c 7565 3d4e 6f6e 650a  fill_value=None.
+00003300: 293a 0a20 2020 2022 2222 4170 706c 7920  ):.    """Apply 
+00003310: 6120 7661 7269 6162 6c65 206c 6576 656c  a variable level
+00003320: 2066 756e 6374 696f 6e20 6f76 6572 2064   function over d
+00003330: 6963 7473 206f 6620 4461 7461 4172 7261  icts of DataArra
+00003340: 792c 2044 6174 6141 7272 6179 2c0a 2020  y, DataArray,.  
+00003350: 2020 5661 7269 6162 6c65 2061 6e64 206e    Variable and n
+00003360: 6461 7272 6179 206f 626a 6563 7473 2e0a  darray objects..
+00003370: 2020 2020 2222 220a 2020 2020 6172 6773      """.    args
+00003380: 203d 2074 7570 6c65 285f 6173 5f76 6172   = tuple(_as_var
+00003390: 6961 626c 6573 5f6f 725f 7661 7269 6162  iables_or_variab
+000033a0: 6c65 2861 7267 2920 666f 7220 6172 6720  le(arg) for arg 
+000033b0: 696e 2061 7267 7329 0a20 2020 206e 616d  in args).    nam
+000033c0: 6573 203d 206a 6f69 6e5f 6469 6374 5f6b  es = join_dict_k
+000033d0: 6579 7328 6172 6773 2c20 686f 773d 6a6f  eys(args, how=jo
+000033e0: 696e 290a 2020 2020 6772 6f75 7065 645f  in).    grouped_
+000033f0: 6279 5f6e 616d 6520 3d20 636f 6c6c 6563  by_name = collec
+00003400: 745f 6469 6374 5f76 616c 7565 7328 6172  t_dict_values(ar
+00003410: 6773 2c20 6e61 6d65 732c 2066 696c 6c5f  gs, names, fill_
+00003420: 7661 6c75 6529 0a0a 2020 2020 7265 7375  value)..    resu
+00003430: 6c74 5f76 6172 7320 3d20 7b7d 0a20 2020  lt_vars = {}.   
+00003440: 2066 6f72 206e 616d 652c 2076 6172 6961   for name, varia
+00003450: 626c 655f 6172 6773 2069 6e20 7a69 7028  ble_args in zip(
+00003460: 6e61 6d65 732c 2067 726f 7570 6564 5f62  names, grouped_b
+00003470: 795f 6e61 6d65 293a 0a20 2020 2020 2020  y_name):.       
+00003480: 2072 6573 756c 745f 7661 7273 5b6e 616d   result_vars[nam
+00003490: 655d 203d 2066 756e 6328 2a76 6172 6961  e] = func(*varia
+000034a0: 626c 655f 6172 6773 290a 0a20 2020 2069  ble_args)..    i
+000034b0: 6620 7369 676e 6174 7572 652e 6e75 6d5f  f signature.num_
+000034c0: 6f75 7470 7574 7320 3e20 313a 0a20 2020  outputs > 1:.   
+000034d0: 2020 2020 2072 6574 7572 6e20 5f75 6e70       return _unp
+000034e0: 6163 6b5f 6469 6374 5f74 7570 6c65 7328  ack_dict_tuples(
+000034f0: 7265 7375 6c74 5f76 6172 732c 2073 6967  result_vars, sig
+00003500: 6e61 7475 7265 2e6e 756d 5f6f 7574 7075  nature.num_outpu
+00003510: 7473 290a 2020 2020 656c 7365 3a0a 2020  ts).    else:.  
+00003520: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+00003530: 756c 745f 7661 7273 0a0a 0a64 6566 205f  ult_vars...def _
+00003540: 6661 7374 5f64 6174 6173 6574 280a 2020  fast_dataset(.  
+00003550: 2020 7661 7269 6162 6c65 733a 2064 6963    variables: dic
+00003560: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
+00003570: 6162 6c65 5d2c 0a20 2020 2063 6f6f 7264  able],.    coord
+00003580: 5f76 6172 6961 626c 6573 3a20 4d61 7070  _variables: Mapp
+00003590: 696e 675b 4861 7368 6162 6c65 2c20 5661  ing[Hashable, Va
+000035a0: 7269 6162 6c65 5d2c 0a20 2020 2069 6e64  riable],.    ind
+000035b0: 6578 6573 3a20 6469 6374 5b48 6173 6861  exes: dict[Hasha
+000035c0: 626c 652c 2049 6e64 6578 5d2c 0a29 202d  ble, Index],.) -
+000035d0: 3e20 4461 7461 7365 743a 0a20 2020 2022  > Dataset:.    "
+000035e0: 2222 4372 6561 7465 2061 2064 6174 6173  ""Create a datas
+000035f0: 6574 2061 7320 7175 6963 6b6c 7920 6173  et as quickly as
+00003600: 2070 6f73 7369 626c 652e 0a0a 2020 2020   possible...    
+00003610: 4265 7761 7265 3a20 7468 6520 6076 6172  Beware: the `var
+00003620: 6961 626c 6573 6020 6469 6374 2069 7320  iables` dict is 
+00003630: 6d6f 6469 6669 6564 2049 4e50 4c41 4345  modified INPLACE
+00003640: 2e0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
+00003650: 6f6d 2078 6172 7261 792e 636f 7265 2e64  om xarray.core.d
+00003660: 6174 6173 6574 2069 6d70 6f72 7420 4461  ataset import Da
+00003670: 7461 7365 740a 0a20 2020 2076 6172 6961  taset..    varia
+00003680: 626c 6573 2e75 7064 6174 6528 636f 6f72  bles.update(coor
+00003690: 645f 7661 7269 6162 6c65 7329 0a20 2020  d_variables).   
+000036a0: 2063 6f6f 7264 5f6e 616d 6573 203d 2073   coord_names = s
+000036b0: 6574 2863 6f6f 7264 5f76 6172 6961 626c  et(coord_variabl
+000036c0: 6573 290a 2020 2020 7265 7475 726e 2044  es).    return D
+000036d0: 6174 6173 6574 2e5f 636f 6e73 7472 7563  ataset._construc
+000036e0: 745f 6469 7265 6374 2876 6172 6961 626c  t_direct(variabl
+000036f0: 6573 2c20 636f 6f72 645f 6e61 6d65 732c  es, coord_names,
+00003700: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+00003710: 290a 0a0a 6465 6620 6170 706c 795f 6461  )...def apply_da
+00003720: 7461 7365 745f 7666 756e 6328 0a20 2020  taset_vfunc(.   
+00003730: 2066 756e 632c 0a20 2020 202a 6172 6773   func,.    *args
+00003740: 2c0a 2020 2020 7369 676e 6174 7572 653a  ,.    signature:
+00003750: 205f 5546 756e 6353 6967 6e61 7475 7265   _UFuncSignature
+00003760: 2c0a 2020 2020 6a6f 696e 3d22 696e 6e65  ,.    join="inne
+00003770: 7222 2c0a 2020 2020 6461 7461 7365 745f  r",.    dataset_
+00003780: 6a6f 696e 3d22 6578 6163 7422 2c0a 2020  join="exact",.  
+00003790: 2020 6669 6c6c 5f76 616c 7565 3d5f 4e4f    fill_value=_NO
+000037a0: 5f46 494c 4c5f 5641 4c55 452c 0a20 2020  _FILL_VALUE,.   
+000037b0: 2065 7863 6c75 6465 5f64 696d 733d 6672   exclude_dims=fr
+000037c0: 6f7a 656e 7365 7428 292c 0a20 2020 206b  ozenset(),.    k
+000037d0: 6565 705f 6174 7472 733d 226f 7665 7272  eep_attrs="overr
+000037e0: 6964 6522 2c0a 2920 2d3e 2044 6174 6173  ide",.) -> Datas
+000037f0: 6574 207c 2074 7570 6c65 5b44 6174 6173  et | tuple[Datas
+00003800: 6574 2c20 2e2e 2e5d 3a0a 2020 2020 2222  et, ...]:.    ""
+00003810: 2241 7070 6c79 2061 2076 6172 6961 626c  "Apply a variabl
+00003820: 6520 6c65 7665 6c20 6675 6e63 7469 6f6e  e level function
+00003830: 206f 7665 7220 4461 7461 7365 742c 2064   over Dataset, d
+00003840: 6963 7420 6f66 2044 6174 6141 7272 6179  ict of DataArray
+00003850: 2c0a 2020 2020 4461 7461 4172 7261 792c  ,.    DataArray,
+00003860: 2056 6172 6961 626c 6520 616e 642f 6f72   Variable and/or
+00003870: 206e 6461 7272 6179 206f 626a 6563 7473   ndarray objects
+00003880: 2e0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
+00003890: 6f6d 2078 6172 7261 792e 636f 7265 2e64  om xarray.core.d
+000038a0: 6174 6173 6574 2069 6d70 6f72 7420 4461  ataset import Da
+000038b0: 7461 7365 740a 0a20 2020 2069 6620 6461  taset..    if da
+000038c0: 7461 7365 745f 6a6f 696e 206e 6f74 2069  taset_join not i
+000038d0: 6e20 5f4a 4f49 4e53 5f57 4954 484f 5554  n _JOINS_WITHOUT
+000038e0: 5f46 494c 4c5f 5641 4c55 4553 2061 6e64  _FILL_VALUES and
+000038f0: 2066 696c 6c5f 7661 6c75 6520 6973 205f   fill_value is _
+00003900: 4e4f 5f46 494c 4c5f 5641 4c55 453a 0a20  NO_FILL_VALUE:. 
+00003910: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00003920: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00003930: 2020 2020 2274 6f20 6170 706c 7920 616e      "to apply an
+00003940: 206f 7065 7261 7469 6f6e 2074 6f20 6461   operation to da
+00003950: 7461 7365 7473 2077 6974 6820 6469 6666  tasets with diff
+00003960: 6572 656e 7420 220a 2020 2020 2020 2020  erent ".        
+00003970: 2020 2020 2264 6174 6120 7661 7269 6162      "data variab
+00003980: 6c65 7320 7769 7468 2061 7070 6c79 5f75  les with apply_u
+00003990: 6675 6e63 2c20 796f 7520 6d75 7374 2073  func, you must s
+000039a0: 7570 706c 7920 7468 6520 220a 2020 2020  upply the ".    
+000039b0: 2020 2020 2020 2020 2264 6174 6173 6574          "dataset
+000039c0: 5f66 696c 6c5f 7661 6c75 6520 6172 6775  _fill_value argu
+000039d0: 6d65 6e74 2e22 0a20 2020 2020 2020 2029  ment.".        )
+000039e0: 0a0a 2020 2020 6f62 6a73 203d 205f 616c  ..    objs = _al
+000039f0: 6c5f 6f66 5f74 7970 6528 6172 6773 2c20  l_of_type(args, 
+00003a00: 4461 7461 7365 7429 0a0a 2020 2020 6966  Dataset)..    if
+00003a10: 206c 656e 2861 7267 7329 203e 2031 3a0a   len(args) > 1:.
+00003a20: 2020 2020 2020 2020 6172 6773 203d 2064          args = d
+00003a30: 6565 705f 616c 6967 6e28 0a20 2020 2020  eep_align(.     
+00003a40: 2020 2020 2020 2061 7267 732c 206a 6f69         args, joi
+00003a50: 6e3d 6a6f 696e 2c20 636f 7079 3d46 616c  n=join, copy=Fal
+00003a60: 7365 2c20 6578 636c 7564 653d 6578 636c  se, exclude=excl
+00003a70: 7564 655f 6469 6d73 2c20 7261 6973 655f  ude_dims, raise_
+00003a80: 6f6e 5f69 6e76 616c 6964 3d46 616c 7365  on_invalid=False
+00003a90: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00003aa0: 6c69 7374 5f6f 665f 636f 6f72 6473 2c20  list_of_coords, 
+00003ab0: 6c69 7374 5f6f 665f 696e 6465 7865 7320  list_of_indexes 
+00003ac0: 3d20 6275 696c 645f 6f75 7470 7574 5f63  = build_output_c
+00003ad0: 6f6f 7264 735f 616e 645f 696e 6465 7865  oords_and_indexe
+00003ae0: 7328 0a20 2020 2020 2020 2061 7267 732c  s(.        args,
+00003af0: 2073 6967 6e61 7475 7265 2c20 6578 636c   signature, excl
+00003b00: 7564 655f 6469 6d73 2c20 636f 6d62 696e  ude_dims, combin
+00003b10: 655f 6174 7472 733d 6b65 6570 5f61 7474  e_attrs=keep_att
+00003b20: 7273 0a20 2020 2029 0a20 2020 2061 7267  rs.    ).    arg
+00003b30: 7320 3d20 7475 706c 6528 6765 7461 7474  s = tuple(getatt
+00003b40: 7228 6172 672c 2022 6461 7461 5f76 6172  r(arg, "data_var
+00003b50: 7322 2c20 6172 6729 2066 6f72 2061 7267  s", arg) for arg
+00003b60: 2069 6e20 6172 6773 290a 0a20 2020 2072   in args)..    r
+00003b70: 6573 756c 745f 7661 7273 203d 2061 7070  esult_vars = app
+00003b80: 6c79 5f64 6963 745f 6f66 5f76 6172 6961  ly_dict_of_varia
+00003b90: 626c 6573 5f76 6675 6e63 280a 2020 2020  bles_vfunc(.    
+00003ba0: 2020 2020 6675 6e63 2c20 2a61 7267 732c      func, *args,
+00003bb0: 2073 6967 6e61 7475 7265 3d73 6967 6e61   signature=signa
+00003bc0: 7475 7265 2c20 6a6f 696e 3d64 6174 6173  ture, join=datas
+00003bd0: 6574 5f6a 6f69 6e2c 2066 696c 6c5f 7661  et_join, fill_va
+00003be0: 6c75 653d 6669 6c6c 5f76 616c 7565 0a20  lue=fill_value. 
+00003bf0: 2020 2029 0a0a 2020 2020 6f75 743a 2044     )..    out: D
+00003c00: 6174 6173 6574 207c 2074 7570 6c65 5b44  ataset | tuple[D
+00003c10: 6174 6173 6574 2c20 2e2e 2e5d 0a20 2020  ataset, ...].   
+00003c20: 2069 6620 7369 676e 6174 7572 652e 6e75   if signature.nu
+00003c30: 6d5f 6f75 7470 7574 7320 3e20 313a 0a20  m_outputs > 1:. 
+00003c40: 2020 2020 2020 206f 7574 203d 2074 7570         out = tup
+00003c50: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+00003c60: 5f66 6173 745f 6461 7461 7365 7428 2a61  _fast_dataset(*a
+00003c70: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
+00003c80: 2066 6f72 2061 7267 7320 696e 207a 6970   for args in zip
+00003c90: 2872 6573 756c 745f 7661 7273 2c20 6c69  (result_vars, li
+00003ca0: 7374 5f6f 665f 636f 6f72 6473 2c20 6c69  st_of_coords, li
+00003cb0: 7374 5f6f 665f 696e 6465 7865 7329 0a20  st_of_indexes). 
+00003cc0: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
+00003cd0: 653a 0a20 2020 2020 2020 2028 636f 6f72  e:.        (coor
+00003ce0: 645f 7661 7273 2c29 203d 206c 6973 745f  d_vars,) = list_
+00003cf0: 6f66 5f63 6f6f 7264 730a 2020 2020 2020  of_coords.      
+00003d00: 2020 2869 6e64 6578 6573 2c29 203d 206c    (indexes,) = l
+00003d10: 6973 745f 6f66 5f69 6e64 6578 6573 0a20  ist_of_indexes. 
+00003d20: 2020 2020 2020 206f 7574 203d 205f 6661         out = _fa
+00003d30: 7374 5f64 6174 6173 6574 2872 6573 756c  st_dataset(resul
+00003d40: 745f 7661 7273 2c20 636f 6f72 645f 7661  t_vars, coord_va
+00003d50: 7273 2c20 696e 6465 7865 733d 696e 6465  rs, indexes=inde
+00003d60: 7865 7329 0a0a 2020 2020 6174 7472 7320  xes)..    attrs 
+00003d70: 3d20 6d65 7267 655f 6174 7472 7328 5b78  = merge_attrs([x
+00003d80: 2e61 7474 7273 2066 6f72 2078 2069 6e20  .attrs for x in 
+00003d90: 6f62 6a73 5d2c 2063 6f6d 6269 6e65 5f61  objs], combine_a
+00003da0: 7474 7273 3d6b 6565 705f 6174 7472 7329  ttrs=keep_attrs)
+00003db0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00003dc0: 6365 286f 7574 2c20 7475 706c 6529 3a0a  ce(out, tuple):.
+00003dd0: 2020 2020 2020 2020 666f 7220 6473 2069          for ds i
+00003de0: 6e20 6f75 743a 0a20 2020 2020 2020 2020  n out:.         
+00003df0: 2020 2064 732e 6174 7472 7320 3d20 6174     ds.attrs = at
+00003e00: 7472 730a 2020 2020 656c 7365 3a0a 2020  trs.    else:.  
+00003e10: 2020 2020 2020 6f75 742e 6174 7472 7320        out.attrs 
+00003e20: 3d20 6174 7472 730a 0a20 2020 2072 6574  = attrs..    ret
+00003e30: 7572 6e20 6f75 740a 0a0a 6465 6620 5f69  urn out...def _i
+00003e40: 7465 725f 6f76 6572 5f73 656c 6563 7469  ter_over_selecti
+00003e50: 6f6e 7328 6f62 6a2c 2064 696d 2c20 7661  ons(obj, dim, va
+00003e60: 6c75 6573 293a 0a20 2020 2022 2222 4974  lues):.    """It
+00003e70: 6572 6174 6520 6f76 6572 2073 656c 6563  erate over selec
+00003e80: 7469 6f6e 7320 6f66 2061 6e20 7861 7272  tions of an xarr
+00003e90: 6179 206f 626a 6563 7420 696e 2074 6865  ay object in the
+00003ea0: 2070 726f 7669 6465 6420 6f72 6465 722e   provided order.
+00003eb0: 2222 220a 2020 2020 6672 6f6d 2078 6172  """.    from xar
+00003ec0: 7261 792e 636f 7265 2e67 726f 7570 6279  ray.core.groupby
+00003ed0: 2069 6d70 6f72 7420 5f64 756d 6d79 5f63   import _dummy_c
+00003ee0: 6f70 790a 0a20 2020 2064 756d 6d79 203d  opy..    dummy =
+00003ef0: 204e 6f6e 650a 2020 2020 666f 7220 7661   None.    for va
+00003f00: 6c75 6520 696e 2076 616c 7565 733a 0a20  lue in values:. 
+00003f10: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00003f20: 2020 2020 2020 2020 6f62 6a5f 7365 6c20          obj_sel 
+00003f30: 3d20 6f62 6a2e 7365 6c28 2a2a 7b64 696d  = obj.sel(**{dim
+00003f40: 3a20 7661 6c75 657d 290a 2020 2020 2020  : value}).      
+00003f50: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+00003f60: 6f72 2c20 496e 6465 7845 7272 6f72 293a  or, IndexError):
+00003f70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003f80: 6475 6d6d 7920 6973 204e 6f6e 653a 0a20  dummy is None:. 
+00003f90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00003fa0: 756d 6d79 203d 205f 6475 6d6d 795f 636f  ummy = _dummy_co
+00003fb0: 7079 286f 626a 290a 2020 2020 2020 2020  py(obj).        
+00003fc0: 2020 2020 6f62 6a5f 7365 6c20 3d20 6475      obj_sel = du
+00003fd0: 6d6d 790a 2020 2020 2020 2020 7969 656c  mmy.        yiel
+00003fe0: 6420 6f62 6a5f 7365 6c0a 0a0a 6465 6620  d obj_sel...def 
+00003ff0: 6170 706c 795f 6772 6f75 7062 795f 6675  apply_groupby_fu
+00004000: 6e63 2866 756e 632c 202a 6172 6773 293a  nc(func, *args):
+00004010: 0a20 2020 2022 2222 4170 706c 7920 6120  .    """Apply a 
+00004020: 6461 7461 7365 7420 6f72 2064 6174 6172  dataset or datar
+00004030: 7261 7920 6c65 7665 6c20 6675 6e63 7469  ray level functi
+00004040: 6f6e 206f 7665 7220 4772 6f75 7042 792c  on over GroupBy,
+00004050: 2044 6174 6173 6574 2c0a 2020 2020 4461   Dataset,.    Da
+00004060: 7461 4172 7261 792c 2056 6172 6961 626c  taArray, Variabl
+00004070: 6520 616e 642f 6f72 206e 6461 7272 6179  e and/or ndarray
+00004080: 206f 626a 6563 7473 2e0a 2020 2020 2222   objects..    ""
+00004090: 220a 2020 2020 6672 6f6d 2078 6172 7261  ".    from xarra
+000040a0: 792e 636f 7265 2e67 726f 7570 6279 2069  y.core.groupby i
+000040b0: 6d70 6f72 7420 4772 6f75 7042 792c 2070  mport GroupBy, p
+000040c0: 6565 6b5f 6174 0a20 2020 2066 726f 6d20  eek_at.    from 
+000040d0: 7861 7272 6179 2e63 6f72 652e 7661 7269  xarray.core.vari
+000040e0: 6162 6c65 2069 6d70 6f72 7420 5661 7269  able import Vari
+000040f0: 6162 6c65 0a0a 2020 2020 6772 6f75 7062  able..    groupb
+00004100: 7973 203d 205b 6172 6720 666f 7220 6172  ys = [arg for ar
+00004110: 6720 696e 2061 7267 7320 6966 2069 7369  g in args if isi
+00004120: 6e73 7461 6e63 6528 6172 672c 2047 726f  nstance(arg, Gro
+00004130: 7570 4279 295d 0a20 2020 2061 7373 6572  upBy)].    asser
+00004140: 7420 6772 6f75 7062 7973 2c20 226d 7573  t groupbys, "mus
+00004150: 7420 6861 7665 2061 7420 6c65 6173 7420  t have at least 
+00004160: 6f6e 6520 6772 6f75 7062 7920 746f 2069  one groupby to i
+00004170: 7465 7261 7465 206f 7665 7222 0a20 2020  terate over".   
+00004180: 2066 6972 7374 5f67 726f 7570 6279 203d   first_groupby =
+00004190: 2067 726f 7570 6279 735b 305d 0a20 2020   groupbys[0].   
+000041a0: 2028 6772 6f75 7065 722c 2920 3d20 6669   (grouper,) = fi
+000041b0: 7273 745f 6772 6f75 7062 792e 6772 6f75  rst_groupby.grou
+000041c0: 7065 7273 0a20 2020 2069 6620 616e 7928  pers.    if any(
+000041d0: 6e6f 7420 6772 6f75 7065 722e 6772 6f75  not grouper.grou
+000041e0: 702e 6571 7561 6c73 2867 622e 6772 6f75  p.equals(gb.grou
+000041f0: 7065 7273 5b30 5d2e 6772 6f75 7029 2066  pers[0].group) f
+00004200: 6f72 2067 6220 696e 2067 726f 7570 6279  or gb in groupby
+00004210: 735b 313a 5d29 3a0a 2020 2020 2020 2020  s[1:]):.        
+00004220: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00004230: 280a 2020 2020 2020 2020 2020 2020 2261  (.            "a
+00004240: 7070 6c79 5f75 6675 6e63 2063 616e 206f  pply_ufunc can o
+00004250: 6e6c 7920 7065 7266 6f72 6d20 6f70 6572  nly perform oper
+00004260: 6174 696f 6e73 206f 7665 7220 220a 2020  ations over ".  
+00004270: 2020 2020 2020 2020 2020 226d 756c 7469            "multi
+00004280: 706c 6520 4772 6f75 7042 7920 6f62 6a65  ple GroupBy obje
+00004290: 6374 7320 6174 206f 6e63 6520 6966 2074  cts at once if t
+000042a0: 6865 7920 6172 6520 616c 6c20 220a 2020  hey are all ".  
+000042b0: 2020 2020 2020 2020 2020 2267 726f 7570            "group
+000042c0: 6564 2074 6865 2073 616d 6520 7761 7922  ed the same way"
+000042d0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000042e0: 6772 6f75 7065 645f 6469 6d20 3d20 6772  grouped_dim = gr
+000042f0: 6f75 7065 722e 6e61 6d65 0a20 2020 2075  ouper.name.    u
+00004300: 6e69 7175 655f 7661 6c75 6573 203d 2067  nique_values = g
+00004310: 726f 7570 6572 2e75 6e69 7175 655f 636f  rouper.unique_co
+00004320: 6f72 642e 7661 6c75 6573 0a0a 2020 2020  ord.values..    
+00004330: 6974 6572 6174 6f72 7320 3d20 5b5d 0a20  iterators = []. 
+00004340: 2020 2066 6f72 2061 7267 2069 6e20 6172     for arg in ar
+00004350: 6773 3a0a 2020 2020 2020 2020 6966 2069  gs:.        if i
+00004360: 7369 6e73 7461 6e63 6528 6172 672c 2047  sinstance(arg, G
+00004370: 726f 7570 4279 293a 0a20 2020 2020 2020  roupBy):.       
+00004380: 2020 2020 2069 7465 7261 746f 7220 3d20       iterator = 
+00004390: 2876 616c 7565 2066 6f72 205f 2c20 7661  (value for _, va
+000043a0: 6c75 6520 696e 2061 7267 290a 2020 2020  lue in arg).    
+000043b0: 2020 2020 656c 6966 2068 6173 6174 7472      elif hasattr
+000043c0: 2861 7267 2c20 2264 696d 7322 2920 616e  (arg, "dims") an
+000043d0: 6420 6772 6f75 7065 645f 6469 6d20 696e  d grouped_dim in
+000043e0: 2061 7267 2e64 696d 733a 0a20 2020 2020   arg.dims:.     
+000043f0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00004400: 616e 6365 2861 7267 2c20 5661 7269 6162  ance(arg, Variab
+00004410: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+00004420: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00004430: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00004440: 2020 2020 2020 2020 2020 2022 6772 6f75             "grou
+00004450: 7062 7920 6f70 6572 6174 696f 6e73 2063  pby operations c
+00004460: 616e 6e6f 7420 6265 2070 6572 666f 726d  annot be perform
+00004470: 6564 2077 6974 6820 220a 2020 2020 2020  ed with ".      
+00004480: 2020 2020 2020 2020 2020 2020 2020 2278                "x
+00004490: 6172 7261 792e 5661 7269 6162 6c65 206f  array.Variable o
+000044a0: 626a 6563 7473 2074 6861 7420 7368 6172  bjects that shar
+000044b0: 6520 6120 6469 6d65 6e73 696f 6e20 7769  e a dimension wi
+000044c0: 7468 2022 0a20 2020 2020 2020 2020 2020  th ".           
+000044d0: 2020 2020 2020 2020 2022 7468 6520 6772           "the gr
+000044e0: 6f75 7065 6420 6469 6d65 6e73 696f 6e22  ouped dimension"
+000044f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004500: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+00004510: 7465 7261 746f 7220 3d20 5f69 7465 725f  terator = _iter_
+00004520: 6f76 6572 5f73 656c 6563 7469 6f6e 7328  over_selections(
+00004530: 6172 672c 2067 726f 7570 6564 5f64 696d  arg, grouped_dim
+00004540: 2c20 756e 6971 7565 5f76 616c 7565 7329  , unique_values)
+00004550: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00004560: 2020 2020 2020 2020 2020 2069 7465 7261             itera
+00004570: 746f 7220 3d20 6974 6572 746f 6f6c 732e  tor = itertools.
+00004580: 7265 7065 6174 2861 7267 290a 2020 2020  repeat(arg).    
+00004590: 2020 2020 6974 6572 6174 6f72 732e 6170      iterators.ap
+000045a0: 7065 6e64 2869 7465 7261 746f 7229 0a0a  pend(iterator)..
+000045b0: 2020 2020 6170 706c 6965 6420 3d20 2866      applied = (f
+000045c0: 756e 6328 2a7a 6970 7065 645f 6172 6773  unc(*zipped_args
+000045d0: 2920 666f 7220 7a69 7070 6564 5f61 7267  ) for zipped_arg
+000045e0: 7320 696e 207a 6970 282a 6974 6572 6174  s in zip(*iterat
+000045f0: 6f72 7329 290a 2020 2020 6170 706c 6965  ors)).    applie
+00004600: 645f 6578 616d 706c 652c 2061 7070 6c69  d_example, appli
+00004610: 6564 203d 2070 6565 6b5f 6174 2861 7070  ed = peek_at(app
+00004620: 6c69 6564 290a 2020 2020 636f 6d62 696e  lied).    combin
+00004630: 6520 3d20 6669 7273 745f 6772 6f75 7062  e = first_groupb
+00004640: 792e 5f63 6f6d 6269 6e65 0a20 2020 2069  y._combine.    i
+00004650: 6620 6973 696e 7374 616e 6365 2861 7070  f isinstance(app
+00004660: 6c69 6564 5f65 7861 6d70 6c65 2c20 7475  lied_example, tu
+00004670: 706c 6529 3a0a 2020 2020 2020 2020 636f  ple):.        co
+00004680: 6d62 696e 6564 203d 2074 7570 6c65 2863  mbined = tuple(c
+00004690: 6f6d 6269 6e65 286f 7574 7075 7429 2066  ombine(output) f
+000046a0: 6f72 206f 7574 7075 7420 696e 207a 6970  or output in zip
+000046b0: 282a 6170 706c 6965 6429 290a 2020 2020  (*applied)).    
+000046c0: 656c 7365 3a0a 2020 2020 2020 2020 636f  else:.        co
+000046d0: 6d62 696e 6564 203d 2063 6f6d 6269 6e65  mbined = combine
+000046e0: 2861 7070 6c69 6564 290a 2020 2020 7265  (applied).    re
+000046f0: 7475 726e 2063 6f6d 6269 6e65 640a 0a0a  turn combined...
+00004700: 6465 6620 756e 6966 6965 645f 6469 6d5f  def unified_dim_
+00004710: 7369 7a65 7328 0a20 2020 2076 6172 6961  sizes(.    varia
+00004720: 626c 6573 3a20 4974 6572 6162 6c65 5b56  bles: Iterable[V
+00004730: 6172 6961 626c 655d 2c20 6578 636c 7564  ariable], exclud
+00004740: 655f 6469 6d73 3a20 5365 7420 3d20 6672  e_dims: Set = fr
+00004750: 6f7a 656e 7365 7428 290a 2920 2d3e 2064  ozenset().) -> d
+00004760: 6963 745b 4861 7368 6162 6c65 2c20 696e  ict[Hashable, in
+00004770: 745d 3a0a 2020 2020 6469 6d5f 7369 7a65  t]:.    dim_size
+00004780: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
+00004790: 2c20 696e 745d 203d 207b 7d0a 0a20 2020  , int] = {}..   
+000047a0: 2066 6f72 2076 6172 2069 6e20 7661 7269   for var in vari
+000047b0: 6162 6c65 733a 0a20 2020 2020 2020 2069  ables:.        i
+000047c0: 6620 6c65 6e28 7365 7428 7661 722e 6469  f len(set(var.di
+000047d0: 6d73 2929 203c 206c 656e 2876 6172 2e64  ms)) < len(var.d
+000047e0: 696d 7329 3a0a 2020 2020 2020 2020 2020  ims):.          
+000047f0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00004800: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00004810: 2020 2020 2262 726f 6164 6361 7374 696e      "broadcastin
+00004820: 6720 6361 6e6e 6f74 2068 616e 646c 6520  g cannot handle 
+00004830: 6475 706c 6963 6174 6520 220a 2020 2020  duplicate ".    
+00004840: 2020 2020 2020 2020 2020 2020 6622 6469              f"di
+00004850: 6d65 6e73 696f 6e73 206f 6e20 6120 7661  mensions on a va
+00004860: 7269 6162 6c65 3a20 7b6c 6973 7428 7661  riable: {list(va
+00004870: 722e 6469 6d73 297d 220a 2020 2020 2020  r.dims)}".      
+00004880: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00004890: 666f 7220 6469 6d2c 2073 697a 6520 696e  for dim, size in
+000048a0: 207a 6970 2876 6172 2e64 696d 732c 2076   zip(var.dims, v
+000048b0: 6172 2e73 6861 7065 293a 0a20 2020 2020  ar.shape):.     
+000048c0: 2020 2020 2020 2069 6620 6469 6d20 6e6f         if dim no
+000048d0: 7420 696e 2065 7863 6c75 6465 5f64 696d  t in exclude_dim
+000048e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000048f0: 2020 2069 6620 6469 6d20 6e6f 7420 696e     if dim not in
+00004900: 2064 696d 5f73 697a 6573 3a0a 2020 2020   dim_sizes:.    
+00004910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004920: 6469 6d5f 7369 7a65 735b 6469 6d5d 203d  dim_sizes[dim] =
+00004930: 2073 697a 650a 2020 2020 2020 2020 2020   size.          
+00004940: 2020 2020 2020 656c 6966 2064 696d 5f73        elif dim_s
+00004950: 697a 6573 5b64 696d 5d20 213d 2073 697a  izes[dim] != siz
+00004960: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004970: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00004980: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00004990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049a0: 2022 6f70 6572 616e 6473 2063 616e 6e6f   "operands canno
+000049b0: 7420 6265 2062 726f 6164 6361 7374 2074  t be broadcast t
+000049c0: 6f67 6574 6865 7220 220a 2020 2020 2020  ogether ".      
+000049d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049e0: 2020 2277 6974 6820 6d69 736d 6174 6368    "with mismatch
+000049f0: 6564 206c 656e 6774 6873 2066 6f72 2064  ed lengths for d
+00004a00: 696d 656e 7369 6f6e 2022 0a20 2020 2020  imension ".     
+00004a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a20: 2020 2066 227b 6469 6d7d 3a20 7b64 696d     f"{dim}: {dim
+00004a30: 5f73 697a 6573 5b64 696d 5d7d 2076 7320  _sizes[dim]} vs 
+00004a40: 7b73 697a 657d 220a 2020 2020 2020 2020  {size}".        
+00004a50: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004a60: 2020 7265 7475 726e 2064 696d 5f73 697a    return dim_siz
+00004a70: 6573 0a0a 0a53 4c49 4345 5f4e 4f4e 4520  es...SLICE_NONE 
+00004a80: 3d20 736c 6963 6528 4e6f 6e65 290a 0a0a  = slice(None)...
+00004a90: 6465 6620 6272 6f61 6463 6173 745f 636f  def broadcast_co
+00004aa0: 6d70 6174 5f64 6174 6128 0a20 2020 2076  mpat_data(.    v
+00004ab0: 6172 6961 626c 653a 2056 6172 6961 626c  ariable: Variabl
+00004ac0: 652c 0a20 2020 2062 726f 6164 6361 7374  e,.    broadcast
+00004ad0: 5f64 696d 733a 2074 7570 6c65 5b48 6173  _dims: tuple[Has
+00004ae0: 6861 626c 652c 202e 2e2e 5d2c 0a20 2020  hable, ...],.   
+00004af0: 2063 6f72 655f 6469 6d73 3a20 7475 706c   core_dims: tupl
+00004b00: 655b 4861 7368 6162 6c65 2c20 2e2e 2e5d  e[Hashable, ...]
+00004b10: 2c0a 2920 2d3e 2041 6e79 3a0a 2020 2020  ,.) -> Any:.    
+00004b20: 6461 7461 203d 2076 6172 6961 626c 652e  data = variable.
+00004b30: 6461 7461 0a0a 2020 2020 6f6c 645f 6469  data..    old_di
+00004b40: 6d73 203d 2076 6172 6961 626c 652e 6469  ms = variable.di
+00004b50: 6d73 0a20 2020 206e 6577 5f64 696d 7320  ms.    new_dims 
+00004b60: 3d20 6272 6f61 6463 6173 745f 6469 6d73  = broadcast_dims
+00004b70: 202b 2063 6f72 655f 6469 6d73 0a0a 2020   + core_dims..  
+00004b80: 2020 6966 206e 6577 5f64 696d 7320 3d3d    if new_dims ==
+00004b90: 206f 6c64 5f64 696d 733a 0a20 2020 2020   old_dims:.     
+00004ba0: 2020 2023 206f 7074 696d 697a 6520 666f     # optimize fo
+00004bb0: 7220 7468 6520 7479 7069 6361 6c20 6361  r the typical ca
+00004bc0: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
+00004bd0: 6e20 6461 7461 0a0a 2020 2020 7365 745f  n data..    set_
+00004be0: 6f6c 645f 6469 6d73 203d 2073 6574 286f  old_dims = set(o
+00004bf0: 6c64 5f64 696d 7329 0a20 2020 206d 6973  ld_dims).    mis
+00004c00: 7369 6e67 5f63 6f72 655f 6469 6d73 203d  sing_core_dims =
+00004c10: 205b 6420 666f 7220 6420 696e 2063 6f72   [d for d in cor
+00004c20: 655f 6469 6d73 2069 6620 6420 6e6f 7420  e_dims if d not 
+00004c30: 696e 2073 6574 5f6f 6c64 5f64 696d 735d  in set_old_dims]
+00004c40: 0a20 2020 2069 6620 6d69 7373 696e 675f  .    if missing_
+00004c50: 636f 7265 5f64 696d 733a 0a20 2020 2020  core_dims:.     
+00004c60: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00004c70: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00004c80: 2022 6f70 6572 616e 6420 746f 2061 7070   "operand to app
+00004c90: 6c79 5f75 6675 6e63 2068 6173 2072 6571  ly_ufunc has req
+00004ca0: 7569 7265 6420 636f 7265 2064 696d 656e  uired core dimen
+00004cb0: 7369 6f6e 7320 7b7d 2c20 6275 7420 220a  sions {}, but ".
+00004cc0: 2020 2020 2020 2020 2020 2020 2273 6f6d              "som
+00004cd0: 6520 6f66 2074 6865 7365 2064 696d 656e  e of these dimen
+00004ce0: 7369 6f6e 7320 6172 6520 6162 7365 6e74  sions are absent
+00004cf0: 206f 6e20 616e 2069 6e70 7574 2076 6172   on an input var
+00004d00: 6961 626c 653a 207b 7d22 2e66 6f72 6d61  iable: {}".forma
+00004d10: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00004d20: 2020 206c 6973 7428 636f 7265 5f64 696d     list(core_dim
+00004d30: 7329 2c20 6d69 7373 696e 675f 636f 7265  s), missing_core
+00004d40: 5f64 696d 730a 2020 2020 2020 2020 2020  _dims.          
+00004d50: 2020 290a 2020 2020 2020 2020 290a 0a20    ).        ).. 
+00004d60: 2020 2073 6574 5f6e 6577 5f64 696d 7320     set_new_dims 
+00004d70: 3d20 7365 7428 6e65 775f 6469 6d73 290a  = set(new_dims).
+00004d80: 2020 2020 756e 6578 7065 6374 6564 5f64      unexpected_d
+00004d90: 696d 7320 3d20 5b64 2066 6f72 2064 2069  ims = [d for d i
+00004da0: 6e20 6f6c 645f 6469 6d73 2069 6620 6420  n old_dims if d 
+00004db0: 6e6f 7420 696e 2073 6574 5f6e 6577 5f64  not in set_new_d
+00004dc0: 696d 735d 0a20 2020 2069 6620 756e 6578  ims].    if unex
+00004dd0: 7065 6374 6564 5f64 696d 733a 0a20 2020  pected_dims:.   
+00004de0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00004df0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00004e00: 2020 2022 6f70 6572 616e 6420 746f 2061     "operand to a
+00004e10: 7070 6c79 5f75 6675 6e63 2065 6e63 6f75  pply_ufunc encou
+00004e20: 6e74 6572 6564 2075 6e65 7870 6563 7465  ntered unexpecte
+00004e30: 6420 220a 2020 2020 2020 2020 2020 2020  d ".            
+00004e40: 6622 6469 6d65 6e73 696f 6e73 207b 756e  f"dimensions {un
+00004e50: 6578 7065 6374 6564 5f64 696d 7321 727d  expected_dims!r}
+00004e60: 206f 6e20 616e 2069 6e70 7574 2076 6172   on an input var
+00004e70: 6961 626c 653a 2074 6865 7365 2061 7265  iable: these are
+00004e80: 2063 6f72 6520 220a 2020 2020 2020 2020   core ".        
+00004e90: 2020 2020 2264 696d 656e 7369 6f6e 7320      "dimensions 
+00004ea0: 6f6e 206f 7468 6572 2069 6e70 7574 206f  on other input o
+00004eb0: 7220 6f75 7470 7574 2076 6172 6961 626c  r output variabl
+00004ec0: 6573 220a 2020 2020 2020 2020 290a 0a20  es".        ).. 
+00004ed0: 2020 2023 2066 6f72 2063 6f6e 7369 7374     # for consist
+00004ee0: 656e 6379 2077 6974 6820 6e75 6d70 792c  ency with numpy,
+00004ef0: 206b 6565 7020 6272 6f61 6463 6173 7420   keep broadcast 
+00004f00: 6469 6d65 6e73 696f 6e73 2074 6f20 7468  dimensions to th
+00004f10: 6520 6c65 6674 0a20 2020 206f 6c64 5f62  e left.    old_b
+00004f20: 726f 6164 6361 7374 5f64 696d 7320 3d20  roadcast_dims = 
+00004f30: 7475 706c 6528 6420 666f 7220 6420 696e  tuple(d for d in
+00004f40: 2062 726f 6164 6361 7374 5f64 696d 7320   broadcast_dims 
+00004f50: 6966 2064 2069 6e20 7365 745f 6f6c 645f  if d in set_old_
+00004f60: 6469 6d73 290a 2020 2020 7265 6f72 6465  dims).    reorde
+00004f70: 7265 645f 6469 6d73 203d 206f 6c64 5f62  red_dims = old_b
+00004f80: 726f 6164 6361 7374 5f64 696d 7320 2b20  roadcast_dims + 
+00004f90: 636f 7265 5f64 696d 730a 2020 2020 6966  core_dims.    if
+00004fa0: 2072 656f 7264 6572 6564 5f64 696d 7320   reordered_dims 
+00004fb0: 213d 206f 6c64 5f64 696d 733a 0a20 2020  != old_dims:.   
+00004fc0: 2020 2020 206f 7264 6572 203d 2074 7570       order = tup
+00004fd0: 6c65 286f 6c64 5f64 696d 732e 696e 6465  le(old_dims.inde
+00004fe0: 7828 6429 2066 6f72 2064 2069 6e20 7265  x(d) for d in re
+00004ff0: 6f72 6465 7265 645f 6469 6d73 290a 2020  ordered_dims).  
+00005000: 2020 2020 2020 6461 7461 203d 2064 7563        data = duc
+00005010: 6b5f 6172 7261 795f 6f70 732e 7472 616e  k_array_ops.tran
+00005020: 7370 6f73 6528 6461 7461 2c20 6f72 6465  spose(data, orde
+00005030: 7229 0a0a 2020 2020 6966 206e 6577 5f64  r)..    if new_d
+00005040: 696d 7320 213d 2072 656f 7264 6572 6564  ims != reordered
+00005050: 5f64 696d 733a 0a20 2020 2020 2020 206b  _dims:.        k
+00005060: 6579 5f70 6172 7473 3a20 6c69 7374 5b73  ey_parts: list[s
+00005070: 6c69 6365 207c 204e 6f6e 655d 203d 205b  lice | None] = [
+00005080: 5d0a 2020 2020 2020 2020 666f 7220 6469  ].        for di
+00005090: 6d20 696e 206e 6577 5f64 696d 733a 0a20  m in new_dims:. 
+000050a0: 2020 2020 2020 2020 2020 2069 6620 6469             if di
+000050b0: 6d20 696e 2073 6574 5f6f 6c64 5f64 696d  m in set_old_dim
+000050c0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000050d0: 2020 206b 6579 5f70 6172 7473 2e61 7070     key_parts.app
+000050e0: 656e 6428 534c 4943 455f 4e4f 4e45 290a  end(SLICE_NONE).
+000050f0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00005100: 206b 6579 5f70 6172 7473 3a0a 2020 2020   key_parts:.    
+00005110: 2020 2020 2020 2020 2020 2020 2320 6e6f              # no
+00005120: 206e 6565 6420 746f 2069 6e73 6572 7420   need to insert 
+00005130: 6e65 7720 6178 6573 2061 7420 7468 6520  new axes at the 
+00005140: 6265 6769 6e6e 696e 6720 7468 6174 2061  beginning that a
+00005150: 7265 2061 6c72 6561 6479 0a20 2020 2020  re already.     
+00005160: 2020 2020 2020 2020 2020 2023 2068 616e             # han
+00005170: 646c 6564 2062 7920 6272 6f61 6463 6173  dled by broadcas
+00005180: 7469 6e67 0a20 2020 2020 2020 2020 2020  ting.           
+00005190: 2020 2020 206b 6579 5f70 6172 7473 2e61       key_parts.a
+000051a0: 7070 656e 6428 6e70 2e6e 6577 6178 6973  ppend(np.newaxis
+000051b0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+000051c0: 2064 6174 615b 7475 706c 6528 6b65 795f   data[tuple(key_
+000051d0: 7061 7274 7329 5d0a 0a20 2020 2072 6574  parts)]..    ret
+000051e0: 7572 6e20 6461 7461 0a0a 0a64 6566 205f  urn data...def _
+000051f0: 7665 6374 6f72 697a 6528 6675 6e63 2c20  vectorize(func, 
+00005200: 7369 676e 6174 7572 652c 206f 7574 7075  signature, outpu
+00005210: 745f 6474 7970 6573 2c20 6578 636c 7564  t_dtypes, exclud
+00005220: 655f 6469 6d73 293a 0a20 2020 2069 6620  e_dims):.    if 
+00005230: 7369 676e 6174 7572 652e 616c 6c5f 636f  signature.all_co
+00005240: 7265 5f64 696d 733a 0a20 2020 2020 2020  re_dims:.       
+00005250: 2066 756e 6320 3d20 6e70 2e76 6563 746f   func = np.vecto
+00005260: 7269 7a65 280a 2020 2020 2020 2020 2020  rize(.          
+00005270: 2020 6675 6e63 2c0a 2020 2020 2020 2020    func,.        
+00005280: 2020 2020 6f74 7970 6573 3d6f 7574 7075      otypes=outpu
+00005290: 745f 6474 7970 6573 2c0a 2020 2020 2020  t_dtypes,.      
+000052a0: 2020 2020 2020 7369 676e 6174 7572 653d        signature=
+000052b0: 7369 676e 6174 7572 652e 746f 5f67 7566  signature.to_guf
+000052c0: 756e 635f 7374 7269 6e67 2865 7863 6c75  unc_string(exclu
+000052d0: 6465 5f64 696d 7329 2c0a 2020 2020 2020  de_dims),.      
+000052e0: 2020 290a 2020 2020 656c 7365 3a0a 2020    ).    else:.  
+000052f0: 2020 2020 2020 6675 6e63 203d 206e 702e        func = np.
+00005300: 7665 6374 6f72 697a 6528 6675 6e63 2c20  vectorize(func, 
+00005310: 6f74 7970 6573 3d6f 7574 7075 745f 6474  otypes=output_dt
+00005320: 7970 6573 290a 0a20 2020 2072 6574 7572  ypes)..    retur
+00005330: 6e20 6675 6e63 0a0a 0a64 6566 2061 7070  n func...def app
+00005340: 6c79 5f76 6172 6961 626c 655f 7566 756e  ly_variable_ufun
+00005350: 6328 0a20 2020 2066 756e 632c 0a20 2020  c(.    func,.   
+00005360: 202a 6172 6773 2c0a 2020 2020 7369 676e   *args,.    sign
+00005370: 6174 7572 653a 205f 5546 756e 6353 6967  ature: _UFuncSig
+00005380: 6e61 7475 7265 2c0a 2020 2020 6578 636c  nature,.    excl
+00005390: 7564 655f 6469 6d73 3d66 726f 7a65 6e73  ude_dims=frozens
+000053a0: 6574 2829 2c0a 2020 2020 6461 736b 3d22  et(),.    dask="
+000053b0: 666f 7262 6964 6465 6e22 2c0a 2020 2020  forbidden",.    
+000053c0: 6f75 7470 7574 5f64 7479 7065 733d 4e6f  output_dtypes=No
+000053d0: 6e65 2c0a 2020 2020 7665 6374 6f72 697a  ne,.    vectoriz
+000053e0: 653d 4661 6c73 652c 0a20 2020 206b 6565  e=False,.    kee
+000053f0: 705f 6174 7472 733d 226f 7665 7272 6964  p_attrs="overrid
+00005400: 6522 2c0a 2020 2020 6461 736b 5f67 7566  e",.    dask_guf
+00005410: 756e 635f 6b77 6172 6773 3d4e 6f6e 652c  unc_kwargs=None,
+00005420: 0a29 202d 3e20 5661 7269 6162 6c65 207c  .) -> Variable |
+00005430: 2074 7570 6c65 5b56 6172 6961 626c 652c   tuple[Variable,
+00005440: 202e 2e2e 5d3a 0a20 2020 2022 2222 4170   ...]:.    """Ap
+00005450: 706c 7920 6120 6e64 6172 7261 7920 6c65  ply a ndarray le
+00005460: 7665 6c20 6675 6e63 7469 6f6e 206f 7665  vel function ove
+00005470: 7220 5661 7269 6162 6c65 2061 6e64 2f6f  r Variable and/o
+00005480: 7220 6e64 6172 7261 7920 6f62 6a65 6374  r ndarray object
+00005490: 732e 2222 220a 2020 2020 6672 6f6d 2078  s.""".    from x
+000054a0: 6172 7261 792e 636f 7265 2e76 6172 6961  array.core.varia
+000054b0: 626c 6520 696d 706f 7274 2056 6172 6961  ble import Varia
+000054c0: 626c 652c 2061 735f 636f 6d70 6174 6962  ble, as_compatib
+000054d0: 6c65 5f64 6174 610a 0a20 2020 2064 696d  le_data..    dim
+000054e0: 5f73 697a 6573 203d 2075 6e69 6669 6564  _sizes = unified
+000054f0: 5f64 696d 5f73 697a 6573 280a 2020 2020  _dim_sizes(.    
+00005500: 2020 2020 2861 2066 6f72 2061 2069 6e20      (a for a in 
+00005510: 6172 6773 2069 6620 6861 7361 7474 7228  args if hasattr(
+00005520: 612c 2022 6469 6d73 2229 292c 2065 7863  a, "dims")), exc
+00005530: 6c75 6465 5f64 696d 733d 6578 636c 7564  lude_dims=exclud
+00005540: 655f 6469 6d73 0a20 2020 2029 0a20 2020  e_dims.    ).   
+00005550: 2062 726f 6164 6361 7374 5f64 696d 7320   broadcast_dims 
+00005560: 3d20 7475 706c 6528 0a20 2020 2020 2020  = tuple(.       
+00005570: 2064 696d 2066 6f72 2064 696d 2069 6e20   dim for dim in 
+00005580: 6469 6d5f 7369 7a65 7320 6966 2064 696d  dim_sizes if dim
+00005590: 206e 6f74 2069 6e20 7369 676e 6174 7572   not in signatur
+000055a0: 652e 616c 6c5f 636f 7265 5f64 696d 730a  e.all_core_dims.
+000055b0: 2020 2020 290a 2020 2020 6f75 7470 7574      ).    output
+000055c0: 5f64 696d 7320 3d20 5b62 726f 6164 6361  _dims = [broadca
+000055d0: 7374 5f64 696d 7320 2b20 6f75 7420 666f  st_dims + out fo
+000055e0: 7220 6f75 7420 696e 2073 6967 6e61 7475  r out in signatu
+000055f0: 7265 2e6f 7574 7075 745f 636f 7265 5f64  re.output_core_d
+00005600: 696d 735d 0a0a 2020 2020 696e 7075 745f  ims]..    input_
+00005610: 6461 7461 203d 205b 0a20 2020 2020 2020  data = [.       
+00005620: 2062 726f 6164 6361 7374 5f63 6f6d 7061   broadcast_compa
+00005630: 745f 6461 7461 2861 7267 2c20 6272 6f61  t_data(arg, broa
+00005640: 6463 6173 745f 6469 6d73 2c20 636f 7265  dcast_dims, core
+00005650: 5f64 696d 7329 0a20 2020 2020 2020 2069  _dims).        i
+00005660: 6620 6973 696e 7374 616e 6365 2861 7267  f isinstance(arg
+00005670: 2c20 5661 7269 6162 6c65 290a 2020 2020  , Variable).    
+00005680: 2020 2020 656c 7365 2061 7267 0a20 2020      else arg.   
+00005690: 2020 2020 2066 6f72 2061 7267 2c20 636f       for arg, co
+000056a0: 7265 5f64 696d 7320 696e 207a 6970 2861  re_dims in zip(a
+000056b0: 7267 732c 2073 6967 6e61 7475 7265 2e69  rgs, signature.i
+000056c0: 6e70 7574 5f63 6f72 655f 6469 6d73 290a  nput_core_dims).
+000056d0: 2020 2020 5d0a 0a20 2020 2069 6620 616e      ]..    if an
+000056e0: 7928 6973 5f63 6875 6e6b 6564 5f61 7272  y(is_chunked_arr
+000056f0: 6179 2861 7272 6179 2920 666f 7220 6172  ay(array) for ar
+00005700: 7261 7920 696e 2069 6e70 7574 5f64 6174  ray in input_dat
+00005710: 6129 3a0a 2020 2020 2020 2020 6966 2064  a):.        if d
+00005720: 6173 6b20 3d3d 2022 666f 7262 6964 6465  ask == "forbidde
+00005730: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
+00005740: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00005750: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00005760: 2020 2261 7070 6c79 5f75 6675 6e63 2065    "apply_ufunc e
+00005770: 6e63 6f75 6e74 6572 6564 2061 2063 6875  ncountered a chu
+00005780: 6e6b 6564 2061 7272 6179 206f 6e20 616e  nked array on an
+00005790: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000057a0: 2020 2022 6172 6775 6d65 6e74 2c20 6275     "argument, bu
+000057b0: 7420 6861 6e64 6c69 6e67 2066 6f72 2063  t handling for c
+000057c0: 6875 6e6b 6564 2061 7272 6179 7320 6861  hunked arrays ha
+000057d0: 7320 6e6f 7420 220a 2020 2020 2020 2020  s not ".        
+000057e0: 2020 2020 2020 2020 2262 6565 6e20 656e          "been en
+000057f0: 6162 6c65 642e 2045 6974 6865 7220 7365  abled. Either se
+00005800: 7420 7468 6520 6060 6461 736b 6060 2061  t the ``dask`` a
+00005810: 7267 756d 656e 7420 220a 2020 2020 2020  rgument ".      
+00005820: 2020 2020 2020 2020 2020 226f 7220 6c6f            "or lo
+00005830: 6164 2079 6f75 7220 6461 7461 2069 6e74  ad your data int
+00005840: 6f20 6d65 6d6f 7279 2066 6972 7374 2077  o memory first w
+00005850: 6974 6820 220a 2020 2020 2020 2020 2020  ith ".          
+00005860: 2020 2020 2020 2260 602e 6c6f 6164 2829        "``.load()
+00005870: 6060 206f 7220 6060 2e63 6f6d 7075 7465  `` or ``.compute
+00005880: 2829 6060 220a 2020 2020 2020 2020 2020  ()``".          
+00005890: 2020 290a 2020 2020 2020 2020 656c 6966    ).        elif
+000058a0: 2064 6173 6b20 3d3d 2022 7061 7261 6c6c   dask == "parall
+000058b0: 656c 697a 6564 223a 0a20 2020 2020 2020  elized":.       
+000058c0: 2020 2020 2063 6875 6e6b 6d61 6e61 6765       chunkmanage
+000058d0: 7220 3d20 6765 745f 6368 756e 6b65 645f  r = get_chunked_
+000058e0: 6172 7261 795f 7479 7065 282a 696e 7075  array_type(*inpu
+000058f0: 745f 6461 7461 290a 0a20 2020 2020 2020  t_data)..       
+00005900: 2020 2020 206e 756d 7079 5f66 756e 6320       numpy_func 
+00005910: 3d20 6675 6e63 0a0a 2020 2020 2020 2020  = func..        
+00005920: 2020 2020 6966 2064 6173 6b5f 6775 6675      if dask_gufu
+00005930: 6e63 5f6b 7761 7267 7320 6973 204e 6f6e  nc_kwargs is Non
+00005940: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00005950: 2020 2064 6173 6b5f 6775 6675 6e63 5f6b     dask_gufunc_k
+00005960: 7761 7267 7320 3d20 7b7d 0a20 2020 2020  wargs = {}.     
+00005970: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00005980: 2020 2020 2020 2020 2020 2020 2064 6173               das
+00005990: 6b5f 6775 6675 6e63 5f6b 7761 7267 7320  k_gufunc_kwargs 
+000059a0: 3d20 6461 736b 5f67 7566 756e 635f 6b77  = dask_gufunc_kw
+000059b0: 6172 6773 2e63 6f70 7928 290a 0a20 2020  args.copy()..   
+000059c0: 2020 2020 2020 2020 2061 6c6c 6f77 5f72           allow_r
+000059d0: 6563 6875 6e6b 203d 2064 6173 6b5f 6775  echunk = dask_gu
+000059e0: 6675 6e63 5f6b 7761 7267 732e 6765 7428  func_kwargs.get(
+000059f0: 2261 6c6c 6f77 5f72 6563 6875 6e6b 222c  "allow_rechunk",
+00005a00: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+00005a10: 2020 2069 6620 616c 6c6f 775f 7265 6368     if allow_rech
+00005a20: 756e 6b20 6973 204e 6f6e 653a 0a20 2020  unk is None:.   
+00005a30: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00005a40: 206e 2c20 2864 6174 612c 2063 6f72 655f   n, (data, core_
+00005a50: 6469 6d73 2920 696e 2065 6e75 6d65 7261  dims) in enumera
+00005a60: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
+00005a70: 2020 2020 2020 2020 7a69 7028 696e 7075          zip(inpu
+00005a80: 745f 6461 7461 2c20 7369 676e 6174 7572  t_data, signatur
+00005a90: 652e 696e 7075 745f 636f 7265 5f64 696d  e.input_core_dim
+00005aa0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00005ab0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+00005ac0: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
+00005ad0: 6368 756e 6b65 645f 6172 7261 7928 6461  chunked_array(da
+00005ae0: 7461 293a 0a20 2020 2020 2020 2020 2020  ta):.           
+00005af0: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+00005b00: 6f72 6520 6469 6d65 6e73 696f 6e73 2063  ore dimensions c
+00005b10: 616e 6e6f 7420 7370 616e 206d 756c 7469  annot span multi
+00005b20: 706c 6520 6368 756e 6b73 0a20 2020 2020  ple chunks.     
+00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b40: 2020 2066 6f72 2061 7869 732c 2064 696d     for axis, dim
+00005b50: 2069 6e20 656e 756d 6572 6174 6528 636f   in enumerate(co
+00005b60: 7265 5f64 696d 732c 2073 7461 7274 3d2d  re_dims, start=-
+00005b70: 6c65 6e28 636f 7265 5f64 696d 7329 293a  len(core_dims)):
+00005b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005b90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00005ba0: 6c65 6e28 6461 7461 2e63 6875 6e6b 735b  len(data.chunks[
+00005bb0: 6178 6973 5d29 2021 3d20 313a 0a20 2020  axis]) != 1:.   
+00005bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005bd0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00005be0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00005bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00005c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c10: 2020 2020 2020 2022 6d75 6c74 6970 6c65         "multiple
-00005c20: 2063 6875 6e6b 732c 2062 7574 2069 7320   chunks, but is 
-00005c30: 616c 736f 2061 2063 6f72 6520 6469 6d65  also a core dime
-00005c40: 6e73 696f 6e2e 2054 6f20 220a 2020 2020  nsion. To ".    
+00005c10: 2020 2066 2264 696d 656e 7369 6f6e 207b     f"dimension {
+00005c20: 6469 6d7d 206f 6e20 7b6e 7d74 6820 6675  dim} on {n}th fu
+00005c30: 6e63 7469 6f6e 2061 7267 756d 656e 7420  nction argument 
+00005c40: 746f 2022 0a20 2020 2020 2020 2020 2020  to ".           
 00005c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c70: 2266 6978 2c20 6569 7468 6572 2072 6563  "fix, either rec
-00005c80: 6875 6e6b 2069 6e74 6f20 6120 7369 6e67  hunk into a sing
-00005c90: 6c65 2064 6173 6b20 6172 7261 7920 6368  le dask array ch
-00005ca0: 756e 6b20 616c 6f6e 6720 220a 2020 2020  unk along ".    
+00005c60: 2020 2020 2020 2020 2022 6170 706c 795f           "apply_
+00005c70: 7566 756e 6320 7769 7468 2064 6173 6b3d  ufunc with dask=
+00005c80: 2770 6172 616c 6c65 6c69 7a65 6427 2063  'parallelized' c
+00005c90: 6f6e 7369 7374 7320 6f66 2022 0a20 2020  onsists of ".   
+00005ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00005cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cd0: 6622 7468 6973 2064 696d 656e 7369 6f6e  f"this dimension
-00005ce0: 2c20 692e 652e 2c20 6060 2e63 6875 6e6b  , i.e., ``.chunk
-00005cf0: 2864 6963 7428 7b64 696d 7d3d 2d31 2929  (dict({dim}=-1))
-00005d00: 6060 2c20 6f72 2022 0a20 2020 2020 2020  ``, or ".       
-00005d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d20: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
-00005d30: 7373 2060 6061 6c6c 6f77 5f72 6563 6875  ss ``allow_rechu
-00005d40: 6e6b 3d54 7275 6560 6020 696e 2060 6064  nk=True`` in ``d
-00005d50: 6173 6b5f 6775 6675 6e63 5f6b 7761 7267  ask_gufunc_kwarg
-00005d60: 7360 6020 220a 2020 2020 2020 2020 2020  s`` ".          
-00005d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d80: 2020 2020 2020 2020 2020 2262 7574 2062            "but b
-00005d90: 6577 6172 6520 7468 6174 2074 6869 7320  eware that this 
-00005da0: 6d61 7920 7369 676e 6966 6963 616e 746c  may significantl
-00005db0: 7920 696e 6372 6561 7365 206d 656d 6f72  y increase memor
-00005dc0: 7920 7573 6167 652e 220a 2020 2020 2020  y usage.".      
-00005dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005de0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00005df0: 2020 2020 2020 2020 2020 2020 6461 736b              dask
-00005e00: 5f67 7566 756e 635f 6b77 6172 6773 5b22  _gufunc_kwargs["
-00005e10: 616c 6c6f 775f 7265 6368 756e 6b22 5d20  allow_rechunk"] 
-00005e20: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
-00005e30: 2020 2020 6f75 7470 7574 5f73 697a 6573      output_sizes
-00005e40: 203d 2064 6173 6b5f 6775 6675 6e63 5f6b   = dask_gufunc_k
-00005e50: 7761 7267 732e 706f 7028 226f 7574 7075  wargs.pop("outpu
-00005e60: 745f 7369 7a65 7322 2c20 7b7d 290a 2020  t_sizes", {}).  
-00005e70: 2020 2020 2020 2020 2020 6966 206f 7574            if out
-00005e80: 7075 745f 7369 7a65 733a 0a20 2020 2020  put_sizes:.     
-00005e90: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-00005ea0: 745f 7369 7a65 735f 7265 6e61 6d65 6420  t_sizes_renamed 
-00005eb0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-00005ec0: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
-00005ed0: 6c75 6520 696e 206f 7574 7075 745f 7369  lue in output_si
-00005ee0: 7a65 732e 6974 656d 7328 293a 0a20 2020  zes.items():.   
-00005ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f00: 2069 6620 6b65 7920 6e6f 7420 696e 2073   if key not in s
-00005f10: 6967 6e61 7475 7265 2e61 6c6c 5f6f 7574  ignature.all_out
-00005f20: 7075 745f 636f 7265 5f64 696d 733a 0a20  put_core_dims:. 
+00005cc0: 2022 6d75 6c74 6970 6c65 2063 6875 6e6b   "multiple chunk
+00005cd0: 732c 2062 7574 2069 7320 616c 736f 2061  s, but is also a
+00005ce0: 2063 6f72 6520 6469 6d65 6e73 696f 6e2e   core dimension.
+00005cf0: 2054 6f20 220a 2020 2020 2020 2020 2020   To ".          
+00005d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d10: 2020 2020 2020 2020 2020 2266 6978 2c20            "fix, 
+00005d20: 6569 7468 6572 2072 6563 6875 6e6b 2069  either rechunk i
+00005d30: 6e74 6f20 6120 7369 6e67 6c65 2061 7272  nto a single arr
+00005d40: 6179 2063 6875 6e6b 2061 6c6f 6e67 2022  ay chunk along "
+00005d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d70: 2020 2020 2066 2274 6869 7320 6469 6d65       f"this dime
+00005d80: 6e73 696f 6e2c 2069 2e65 2e2c 2060 602e  nsion, i.e., ``.
+00005d90: 6368 756e 6b28 6469 6374 287b 6469 6d7d  chunk(dict({dim}
+00005da0: 3d2d 3129 2960 602c 206f 7220 220a 2020  =-1))``, or ".  
+00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005dd0: 2020 2270 6173 7320 6060 616c 6c6f 775f    "pass ``allow_
+00005de0: 7265 6368 756e 6b3d 5472 7565 6060 2069  rechunk=True`` i
+00005df0: 6e20 6060 6461 736b 5f67 7566 756e 635f  n ``dask_gufunc_
+00005e00: 6b77 6172 6773 6060 2022 0a20 2020 2020  kwargs`` ".     
+00005e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00005e30: 6275 7420 6265 7761 7265 2074 6861 7420  but beware that 
+00005e40: 7468 6973 206d 6179 2073 6967 6e69 6669  this may signifi
+00005e50: 6361 6e74 6c79 2069 6e63 7265 6173 6520  cantly increase 
+00005e60: 6d65 6d6f 7279 2075 7361 6765 2e22 0a20  memory usage.". 
+00005e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e80: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00005e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005ea0: 2064 6173 6b5f 6775 6675 6e63 5f6b 7761   dask_gufunc_kwa
+00005eb0: 7267 735b 2261 6c6c 6f77 5f72 6563 6875  rgs["allow_rechu
+00005ec0: 6e6b 225d 203d 2054 7275 650a 0a20 2020  nk"] = True..   
+00005ed0: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+00005ee0: 7369 7a65 7320 3d20 6461 736b 5f67 7566  sizes = dask_guf
+00005ef0: 756e 635f 6b77 6172 6773 2e70 6f70 2822  unc_kwargs.pop("
+00005f00: 6f75 7470 7574 5f73 697a 6573 222c 207b  output_sizes", {
+00005f10: 7d29 0a20 2020 2020 2020 2020 2020 2069  }).            i
+00005f20: 6620 6f75 7470 7574 5f73 697a 6573 3a0a  f output_sizes:.
 00005f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f40: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00005f50: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00005f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f70: 2020 2020 2066 2264 696d 656e 7369 6f6e       f"dimension
-00005f80: 2027 7b6b 6579 7d27 2069 6e20 276f 7574   '{key}' in 'out
-00005f90: 7075 745f 7369 7a65 7327 206d 7573 7420  put_sizes' must 
-00005fa0: 636f 7272 6573 706f 6e64 2074 6f20 6f75  correspond to ou
-00005fb0: 7470 7574 5f63 6f72 655f 6469 6d73 220a  tput_core_dims".
-00005fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fd0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00005fe0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00005ff0: 7470 7574 5f73 697a 6573 5f72 656e 616d  tput_sizes_renam
-00006000: 6564 5b73 6967 6e61 7475 7265 2e64 696d  ed[signature.dim
-00006010: 735f 6d61 705b 6b65 795d 5d20 3d20 7661  s_map[key]] = va
-00006020: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-00006030: 2020 2020 6461 736b 5f67 7566 756e 635f      dask_gufunc_
-00006040: 6b77 6172 6773 5b22 6f75 7470 7574 5f73  kwargs["output_s
-00006050: 697a 6573 225d 203d 206f 7574 7075 745f  izes"] = output_
-00006060: 7369 7a65 735f 7265 6e61 6d65 640a 0a20  sizes_renamed.. 
-00006070: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-00006080: 6579 2069 6e20 7369 676e 6174 7572 652e  ey in signature.
-00006090: 616c 6c5f 6f75 7470 7574 5f63 6f72 655f  all_output_core_
-000060a0: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-000060b0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-000060c0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-000060d0: 6579 206e 6f74 2069 6e20 7369 676e 6174  ey not in signat
-000060e0: 7572 652e 616c 6c5f 696e 7075 745f 636f  ure.all_input_co
-000060f0: 7265 5f64 696d 7320 6f72 206b 6579 2069  re_dims or key i
-00006100: 6e20 6578 636c 7564 655f 6469 6d73 0a20  n exclude_dims. 
-00006110: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00006120: 2061 6e64 206b 6579 206e 6f74 2069 6e20   and key not in 
-00006130: 6f75 7470 7574 5f73 697a 6573 3a0a 2020  output_sizes:.  
-00006140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006150: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00006160: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00006170: 2020 2020 2020 2020 2020 2020 6622 6469              f"di
-00006180: 6d65 6e73 696f 6e20 277b 6b65 797d 2720  mension '{key}' 
-00006190: 696e 2027 6f75 7470 7574 5f63 6f72 655f  in 'output_core_
-000061a0: 6469 6d73 2720 6e65 6564 7320 636f 7272  dims' needs corr
-000061b0: 6573 706f 6e64 696e 6720 2864 696d 2c20  esponding (dim, 
-000061c0: 7369 7a65 2920 696e 2027 6f75 7470 7574  size) in 'output
-000061d0: 5f73 697a 6573 2722 0a20 2020 2020 2020  _sizes'".       
-000061e0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-000061f0: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-00006200: 6675 6e63 282a 6172 7261 7973 293a 0a20  func(*arrays):. 
-00006210: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00006220: 6d70 6f72 7420 6461 736b 2e61 7272 6179  mport dask.array
-00006230: 2061 7320 6461 0a0a 2020 2020 2020 2020   as da..        
-00006240: 2020 2020 2020 2020 7265 7320 3d20 6461          res = da
-00006250: 2e61 7070 6c79 5f67 7566 756e 6328 0a20  .apply_gufunc(. 
-00006260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006270: 2020 206e 756d 7079 5f66 756e 632c 0a20     numpy_func,. 
+00005f40: 6f75 7470 7574 5f73 697a 6573 5f72 656e  output_sizes_ren
+00005f50: 616d 6564 203d 207b 7d0a 2020 2020 2020  amed = {}.      
+00005f60: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+00005f70: 792c 2076 616c 7565 2069 6e20 6f75 7470  y, value in outp
+00005f80: 7574 5f73 697a 6573 2e69 7465 6d73 2829  ut_sizes.items()
+00005f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005fa0: 2020 2020 2020 6966 206b 6579 206e 6f74        if key not
+00005fb0: 2069 6e20 7369 676e 6174 7572 652e 616c   in signature.al
+00005fc0: 6c5f 6f75 7470 7574 5f63 6f72 655f 6469  l_output_core_di
+00005fd0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00005fe0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00005ff0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00006000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006010: 2020 2020 2020 2020 2020 6622 6469 6d65            f"dime
+00006020: 6e73 696f 6e20 277b 6b65 797d 2720 696e  nsion '{key}' in
+00006030: 2027 6f75 7470 7574 5f73 697a 6573 2720   'output_sizes' 
+00006040: 6d75 7374 2063 6f72 7265 7370 6f6e 6420  must correspond 
+00006050: 746f 206f 7574 7075 745f 636f 7265 5f64  to output_core_d
+00006060: 696d 7322 0a20 2020 2020 2020 2020 2020  ims".           
+00006070: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00006080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006090: 2020 206f 7574 7075 745f 7369 7a65 735f     output_sizes_
+000060a0: 7265 6e61 6d65 645b 7369 676e 6174 7572  renamed[signatur
+000060b0: 652e 6469 6d73 5f6d 6170 5b6b 6579 5d5d  e.dims_map[key]]
+000060c0: 203d 2076 616c 7565 0a20 2020 2020 2020   = value.       
+000060d0: 2020 2020 2020 2020 2064 6173 6b5f 6775           dask_gu
+000060e0: 6675 6e63 5f6b 7761 7267 735b 226f 7574  func_kwargs["out
+000060f0: 7075 745f 7369 7a65 7322 5d20 3d20 6f75  put_sizes"] = ou
+00006100: 7470 7574 5f73 697a 6573 5f72 656e 616d  tput_sizes_renam
+00006110: 6564 0a0a 2020 2020 2020 2020 2020 2020  ed..            
+00006120: 666f 7220 6b65 7920 696e 2073 6967 6e61  for key in signa
+00006130: 7475 7265 2e61 6c6c 5f6f 7574 7075 745f  ture.all_output_
+00006140: 636f 7265 5f64 696d 733a 0a20 2020 2020  core_dims:.     
+00006150: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
+00006160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006170: 2020 2020 6b65 7920 6e6f 7420 696e 2073      key not in s
+00006180: 6967 6e61 7475 7265 2e61 6c6c 5f69 6e70  ignature.all_inp
+00006190: 7574 5f63 6f72 655f 6469 6d73 206f 7220  ut_core_dims or 
+000061a0: 6b65 7920 696e 2065 7863 6c75 6465 5f64  key in exclude_d
+000061b0: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
+000061c0: 2020 2020 2920 616e 6420 6b65 7920 6e6f      ) and key no
+000061d0: 7420 696e 206f 7574 7075 745f 7369 7a65  t in output_size
+000061e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000061f0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00006200: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00006210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006220: 2066 2264 696d 656e 7369 6f6e 2027 7b6b   f"dimension '{k
+00006230: 6579 7d27 2069 6e20 276f 7574 7075 745f  ey}' in 'output_
+00006240: 636f 7265 5f64 696d 7327 206e 6565 6473  core_dims' needs
+00006250: 2063 6f72 7265 7370 6f6e 6469 6e67 2028   corresponding (
+00006260: 6469 6d2c 2073 697a 6529 2069 6e20 276f  dim, size) in 'o
+00006270: 7574 7075 745f 7369 7a65 7327 220a 2020  utput_sizes'".  
 00006280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006290: 2020 2073 6967 6e61 7475 7265 2e74 6f5f     signature.to_
-000062a0: 6775 6675 6e63 5f73 7472 696e 6728 6578  gufunc_string(ex
-000062b0: 636c 7564 655f 6469 6d73 292c 0a20 2020  clude_dims),.   
-000062c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062d0: 202a 6172 7261 7973 2c0a 2020 2020 2020   *arrays,.      
-000062e0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-000062f0: 6374 6f72 697a 653d 7665 6374 6f72 697a  ctorize=vectoriz
-00006300: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00006310: 2020 2020 2020 206f 7574 7075 745f 6474         output_dt
-00006320: 7970 6573 3d6f 7574 7075 745f 6474 7970  ypes=output_dtyp
-00006330: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-00006340: 2020 2020 2020 2020 2a2a 6461 736b 5f67          **dask_g
-00006350: 7566 756e 635f 6b77 6172 6773 2c0a 2020  ufunc_kwargs,.  
-00006360: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00006370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006380: 2072 6574 7572 6e20 7265 730a 0a20 2020   return res..   
-00006390: 2020 2020 2065 6c69 6620 6461 736b 203d       elif dask =
-000063a0: 3d20 2261 6c6c 6f77 6564 223a 0a20 2020  = "allowed":.   
-000063b0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-000063c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000063d0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000063e0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-000063f0: 2020 2020 2020 2020 2020 2275 6e6b 6e6f            "unkno
-00006400: 776e 2073 6574 7469 6e67 2066 6f72 2064  wn setting for d
-00006410: 6173 6b20 6172 7261 7920 6861 6e64 6c69  ask array handli
-00006420: 6e67 2069 6e20 220a 2020 2020 2020 2020  ng in ".        
-00006430: 2020 2020 2020 2020 2261 7070 6c79 5f75          "apply_u
-00006440: 6675 6e63 3a20 7b7d 222e 666f 726d 6174  func: {}".format
-00006450: 2864 6173 6b29 0a20 2020 2020 2020 2020  (dask).         
-00006460: 2020 2029 0a20 2020 2065 6c73 653a 0a20     ).    else:. 
-00006470: 2020 2020 2020 2069 6620 7665 6374 6f72         if vector
-00006480: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-00006490: 2066 756e 6320 3d20 5f76 6563 746f 7269   func = _vectori
-000064a0: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
-000064b0: 2020 2020 6675 6e63 2c20 7369 676e 6174      func, signat
-000064c0: 7572 652c 206f 7574 7075 745f 6474 7970  ure, output_dtyp
-000064d0: 6573 3d6f 7574 7075 745f 6474 7970 6573  es=output_dtypes
-000064e0: 2c20 6578 636c 7564 655f 6469 6d73 3d65  , exclude_dims=e
-000064f0: 7863 6c75 6465 5f64 696d 730a 2020 2020  xclude_dims.    
-00006500: 2020 2020 2020 2020 290a 0a20 2020 2072          )..    r
-00006510: 6573 756c 745f 6461 7461 203d 2066 756e  esult_data = fun
-00006520: 6328 2a69 6e70 7574 5f64 6174 6129 0a0a  c(*input_data)..
-00006530: 2020 2020 6966 2073 6967 6e61 7475 7265      if signature
-00006540: 2e6e 756d 5f6f 7574 7075 7473 203d 3d20  .num_outputs == 
-00006550: 313a 0a20 2020 2020 2020 2072 6573 756c  1:.        resul
-00006560: 745f 6461 7461 203d 2028 7265 7375 6c74  t_data = (result
-00006570: 5f64 6174 612c 290a 2020 2020 656c 6966  _data,).    elif
-00006580: 2028 0a20 2020 2020 2020 206e 6f74 2069   (.        not i
-00006590: 7369 6e73 7461 6e63 6528 7265 7375 6c74  sinstance(result
-000065a0: 5f64 6174 612c 2074 7570 6c65 2920 6f72  _data, tuple) or
-000065b0: 206c 656e 2872 6573 756c 745f 6461 7461   len(result_data
-000065c0: 2920 213d 2073 6967 6e61 7475 7265 2e6e  ) != signature.n
-000065d0: 756d 5f6f 7574 7075 7473 0a20 2020 2029  um_outputs.    )
-000065e0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-000065f0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00006600: 2020 2020 2020 2020 2261 7070 6c69 6564          "applied
-00006610: 2066 756e 6374 696f 6e20 646f 6573 206e   function does n
-00006620: 6f74 2068 6176 6520 7468 6520 6e75 6d62  ot have the numb
-00006630: 6572 206f 6620 220a 2020 2020 2020 2020  er of ".        
-00006640: 2020 2020 226f 7574 7075 7473 2073 7065      "outputs spe
-00006650: 6369 6669 6564 2069 6e20 7468 6520 7566  cified in the uf
-00006660: 756e 6320 7369 676e 6174 7572 652e 2022  unc signature. "
-00006670: 0a20 2020 2020 2020 2020 2020 2022 5265  .            "Re
-00006680: 7375 6c74 2069 7320 6e6f 7420 6120 7475  sult is not a tu
-00006690: 706c 6520 6f66 207b 7d20 656c 656d 656e  ple of {} elemen
-000066a0: 7473 3a20 7b21 727d 222e 666f 726d 6174  ts: {!r}".format
-000066b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000066c0: 2020 7369 676e 6174 7572 652e 6e75 6d5f    signature.num_
-000066d0: 6f75 7470 7574 732c 2072 6573 756c 745f  outputs, result_
-000066e0: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
-000066f0: 2029 0a20 2020 2020 2020 2029 0a0a 2020   ).        )..  
-00006700: 2020 6f62 6a73 203d 205f 616c 6c5f 6f66    objs = _all_of
-00006710: 5f74 7970 6528 6172 6773 2c20 5661 7269  _type(args, Vari
-00006720: 6162 6c65 290a 2020 2020 6174 7472 7320  able).    attrs 
-00006730: 3d20 6d65 7267 655f 6174 7472 7328 0a20  = merge_attrs(. 
-00006740: 2020 2020 2020 205b 6f62 6a2e 6174 7472         [obj.attr
-00006750: 7320 666f 7220 6f62 6a20 696e 206f 626a  s for obj in obj
-00006760: 735d 2c0a 2020 2020 2020 2020 636f 6d62  s],.        comb
-00006770: 696e 655f 6174 7472 733d 6b65 6570 5f61  ine_attrs=keep_a
-00006780: 7474 7273 2c0a 2020 2020 290a 0a20 2020  ttrs,.    )..   
-00006790: 206f 7574 7075 743a 206c 6973 745b 5661   output: list[Va
-000067a0: 7269 6162 6c65 5d20 3d20 5b5d 0a20 2020  riable] = [].   
-000067b0: 2066 6f72 2064 696d 732c 2064 6174 6120   for dims, data 
-000067c0: 696e 207a 6970 286f 7574 7075 745f 6469  in zip(output_di
-000067d0: 6d73 2c20 7265 7375 6c74 5f64 6174 6129  ms, result_data)
-000067e0: 3a0a 2020 2020 2020 2020 6461 7461 203d  :.        data =
-000067f0: 2061 735f 636f 6d70 6174 6962 6c65 5f64   as_compatible_d
-00006800: 6174 6128 6461 7461 290a 2020 2020 2020  ata(data).      
-00006810: 2020 6966 2064 6174 612e 6e64 696d 2021    if data.ndim !
-00006820: 3d20 6c65 6e28 6469 6d73 293a 0a20 2020  = len(dims):.   
-00006830: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00006840: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00006850: 2020 2020 2020 2020 2020 2022 6170 706c             "appl
-00006860: 6965 6420 6675 6e63 7469 6f6e 2072 6574  ied function ret
-00006870: 7572 6e65 6420 6461 7461 2077 6974 6820  urned data with 
-00006880: 756e 6578 7065 6374 6564 2022 0a20 2020  unexpected ".   
-00006890: 2020 2020 2020 2020 2020 2020 2066 226e               f"n
-000068a0: 756d 6265 7220 6f66 2064 696d 656e 7369  umber of dimensi
-000068b0: 6f6e 732e 2052 6563 6569 7665 6420 7b64  ons. Received {d
-000068c0: 6174 612e 6e64 696d 7d20 6469 6d65 6e73  ata.ndim} dimens
-000068d0: 696f 6e28 7329 2062 7574 2022 0a20 2020  ion(s) but ".   
-000068e0: 2020 2020 2020 2020 2020 2020 2066 2265               f"e
-000068f0: 7870 6563 7465 6420 7b6c 656e 2864 696d  xpected {len(dim
-00006900: 7329 7d20 6469 6d65 6e73 696f 6e73 2077  s)} dimensions w
-00006910: 6974 6820 6e61 6d65 733a 207b 6469 6d73  ith names: {dims
-00006920: 2172 7d22 0a20 2020 2020 2020 2020 2020  !r}".           
-00006930: 2029 0a0a 2020 2020 2020 2020 7661 7220   )..        var 
-00006940: 3d20 5661 7269 6162 6c65 2864 696d 732c  = Variable(dims,
-00006950: 2064 6174 612c 2066 6173 7470 6174 683d   data, fastpath=
-00006960: 5472 7565 290a 2020 2020 2020 2020 666f  True).        fo
-00006970: 7220 6469 6d2c 206e 6577 5f73 697a 6520  r dim, new_size 
-00006980: 696e 2076 6172 2e73 697a 6573 2e69 7465  in var.sizes.ite
-00006990: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-000069a0: 2020 6966 2064 696d 2069 6e20 6469 6d5f    if dim in dim_
-000069b0: 7369 7a65 7320 616e 6420 6e65 775f 7369  sizes and new_si
-000069c0: 7a65 2021 3d20 6469 6d5f 7369 7a65 735b  ze != dim_sizes[
-000069d0: 6469 6d5d 3a0a 2020 2020 2020 2020 2020  dim]:.          
-000069e0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000069f0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00006a00: 2020 2020 2020 2020 2020 2020 2273 697a              "siz
-00006a10: 6520 6f66 2064 696d 656e 7369 6f6e 207b  e of dimension {
-00006a20: 2172 7d20 6f6e 2069 6e70 7574 7320 7761  !r} on inputs wa
-00006a30: 7320 756e 6578 7065 6374 6564 6c79 2022  s unexpectedly "
-00006a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006a50: 2020 2020 2022 6368 616e 6765 6420 6279       "changed by
-00006a60: 2061 7070 6c69 6564 2066 756e 6374 696f   applied functio
-00006a70: 6e20 6672 6f6d 207b 7d20 746f 207b 7d2e  n from {} to {}.
-00006a80: 204f 6e6c 7920 220a 2020 2020 2020 2020   Only ".        
-00006a90: 2020 2020 2020 2020 2020 2020 2264 696d              "dim
-00006aa0: 656e 7369 6f6e 7320 7370 6563 6966 6965  ensions specifie
-00006ab0: 6420 696e 2060 6065 7863 6c75 6465 5f64  d in ``exclude_d
-00006ac0: 696d 7360 6020 7769 7468 2022 0a20 2020  ims`` with ".   
-00006ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ae0: 2022 7861 7272 6179 2e61 7070 6c79 5f75   "xarray.apply_u
-00006af0: 6675 6e63 2061 7265 2061 6c6c 6f77 6564  func are allowed
-00006b00: 2074 6f20 6368 616e 6765 2073 697a 652e   to change size.
-00006b10: 222e 666f 726d 6174 280a 2020 2020 2020  ".format(.      
-00006b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b30: 2020 6469 6d2c 2064 696d 5f73 697a 6573    dim, dim_sizes
-00006b40: 5b64 696d 5d2c 206e 6577 5f73 697a 650a  [dim], new_size.
-00006b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b60: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00006b70: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00006b80: 2076 6172 2e61 7474 7273 203d 2061 7474   var.attrs = att
-00006b90: 7273 0a20 2020 2020 2020 206f 7574 7075  rs.        outpu
-00006ba0: 742e 6170 7065 6e64 2876 6172 290a 0a20  t.append(var).. 
-00006bb0: 2020 2069 6620 7369 676e 6174 7572 652e     if signature.
-00006bc0: 6e75 6d5f 6f75 7470 7574 7320 3d3d 2031  num_outputs == 1
-00006bd0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00006be0: 206f 7574 7075 745b 305d 0a20 2020 2065   output[0].    e
-00006bf0: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
-00006c00: 7572 6e20 7475 706c 6528 6f75 7470 7574  urn tuple(output
-00006c10: 290a 0a0a 6465 6620 6170 706c 795f 6172  )...def apply_ar
-00006c20: 7261 795f 7566 756e 6328 6675 6e63 2c20  ray_ufunc(func, 
-00006c30: 2a61 7267 732c 2064 6173 6b3d 2266 6f72  *args, dask="for
-00006c40: 6269 6464 656e 2229 3a0a 2020 2020 2222  bidden"):.    ""
-00006c50: 2241 7070 6c79 2061 206e 6461 7272 6179  "Apply a ndarray
-00006c60: 206c 6576 656c 2066 756e 6374 696f 6e20   level function 
-00006c70: 6f76 6572 206e 6461 7272 6179 206f 626a  over ndarray obj
-00006c80: 6563 7473 2e22 2222 0a20 2020 2069 6620  ects.""".    if 
-00006c90: 616e 7928 6973 5f64 7563 6b5f 6461 736b  any(is_duck_dask
-00006ca0: 5f61 7272 6179 2861 7267 2920 666f 7220  _array(arg) for 
-00006cb0: 6172 6720 696e 2061 7267 7329 3a0a 2020  arg in args):.  
-00006cc0: 2020 2020 2020 6966 2064 6173 6b20 3d3d        if dask ==
-00006cd0: 2022 666f 7262 6964 6465 6e22 3a0a 2020   "forbidden":.  
-00006ce0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00006cf0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00006d00: 2020 2020 2020 2020 2020 2020 2261 7070              "app
-00006d10: 6c79 5f75 6675 6e63 2065 6e63 6f75 6e74  ly_ufunc encount
-00006d20: 6572 6564 2061 2064 6173 6b20 6172 7261  ered a dask arra
-00006d30: 7920 6f6e 2061 6e20 220a 2020 2020 2020  y on an ".      
-00006d40: 2020 2020 2020 2020 2020 2261 7267 756d            "argum
-00006d50: 656e 742c 2062 7574 2068 616e 646c 696e  ent, but handlin
-00006d60: 6720 666f 7220 6461 736b 2061 7272 6179  g for dask array
-00006d70: 7320 6861 7320 6e6f 7420 220a 2020 2020  s has not ".    
-00006d80: 2020 2020 2020 2020 2020 2020 2262 6565              "bee
-00006d90: 6e20 656e 6162 6c65 642e 2045 6974 6865  n enabled. Eithe
-00006da0: 7220 7365 7420 7468 6520 6060 6461 736b  r set the ``dask
-00006db0: 6060 2061 7267 756d 656e 7420 220a 2020  `` argument ".  
-00006dc0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-00006dd0: 7220 6c6f 6164 2079 6f75 7220 6461 7461  r load your data
-00006de0: 2069 6e74 6f20 6d65 6d6f 7279 2066 6972   into memory fir
-00006df0: 7374 2077 6974 6820 220a 2020 2020 2020  st with ".      
-00006e00: 2020 2020 2020 2020 2020 2260 602e 6c6f            "``.lo
-00006e10: 6164 2829 6060 206f 7220 6060 2e63 6f6d  ad()`` or ``.com
-00006e20: 7075 7465 2829 6060 220a 2020 2020 2020  pute()``".      
-00006e30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006e40: 656c 6966 2064 6173 6b20 3d3d 2022 7061  elif dask == "pa
-00006e50: 7261 6c6c 656c 697a 6564 223a 0a20 2020  rallelized":.   
-00006e60: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00006e70: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00006e80: 2020 2020 2020 2020 2020 2022 6361 6e6e             "cann
-00006e90: 6f74 2075 7365 2064 6173 6b3d 2770 6172  ot use dask='par
-00006ea0: 616c 6c65 6c69 7a65 6427 2066 6f72 2061  allelized' for a
-00006eb0: 7070 6c79 5f75 6675 6e63 2022 0a20 2020  pply_ufunc ".   
-00006ec0: 2020 2020 2020 2020 2020 2020 2022 756e               "un
-00006ed0: 6c65 7373 2061 7420 6c65 6173 7420 6f6e  less at least on
-00006ee0: 6520 696e 7075 7420 6973 2061 6e20 7861  e input is an xa
-00006ef0: 7272 6179 206f 626a 6563 7422 0a20 2020  rray object".   
-00006f00: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00006f10: 2020 2065 6c69 6620 6461 736b 203d 3d20     elif dask == 
-00006f20: 2261 6c6c 6f77 6564 223a 0a20 2020 2020  "allowed":.     
-00006f30: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00006f40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00006f50: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00006f60: 6545 7272 6f72 2866 2275 6e6b 6e6f 776e  eError(f"unknown
-00006f70: 2073 6574 7469 6e67 2066 6f72 2064 6173   setting for das
-00006f80: 6b20 6172 7261 7920 6861 6e64 6c69 6e67  k array handling
-00006f90: 3a20 7b64 6173 6b7d 2229 0a20 2020 2072  : {dask}").    r
-00006fa0: 6574 7572 6e20 6675 6e63 282a 6172 6773  eturn func(*args
-00006fb0: 290a 0a0a 6465 6620 6170 706c 795f 7566  )...def apply_uf
-00006fc0: 756e 6328 0a20 2020 2066 756e 633a 2043  unc(.    func: C
-00006fd0: 616c 6c61 626c 652c 0a20 2020 202a 6172  allable,.    *ar
-00006fe0: 6773 3a20 416e 792c 0a20 2020 2069 6e70  gs: Any,.    inp
-00006ff0: 7574 5f63 6f72 655f 6469 6d73 3a20 5365  ut_core_dims: Se
-00007000: 7175 656e 6365 5b53 6571 7565 6e63 655d  quence[Sequence]
-00007010: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00007020: 2020 2020 6f75 7470 7574 5f63 6f72 655f      output_core_
-00007030: 6469 6d73 3a20 5365 7175 656e 6365 5b53  dims: Sequence[S
-00007040: 6571 7565 6e63 655d 207c 204e 6f6e 6520  equence] | None 
-00007050: 3d20 2828 292c 292c 0a20 2020 2065 7863  = ((),),.    exc
-00007060: 6c75 6465 5f64 696d 733a 2053 6574 203d  lude_dims: Set =
-00007070: 2066 726f 7a65 6e73 6574 2829 2c0a 2020   frozenset(),.  
-00007080: 2020 7665 6374 6f72 697a 653a 2062 6f6f    vectorize: boo
-00007090: 6c20 3d20 4661 6c73 652c 0a20 2020 206a  l = False,.    j
-000070a0: 6f69 6e3a 204a 6f69 6e4f 7074 696f 6e73  oin: JoinOptions
-000070b0: 203d 2022 6578 6163 7422 2c0a 2020 2020   = "exact",.    
-000070c0: 6461 7461 7365 745f 6a6f 696e 3a20 7374  dataset_join: st
-000070d0: 7220 3d20 2265 7861 6374 222c 0a20 2020  r = "exact",.   
-000070e0: 2064 6174 6173 6574 5f66 696c 6c5f 7661   dataset_fill_va
-000070f0: 6c75 653a 206f 626a 6563 7420 3d20 5f4e  lue: object = _N
-00007100: 4f5f 4649 4c4c 5f56 414c 5545 2c0a 2020  O_FILL_VALUE,.  
-00007110: 2020 6b65 6570 5f61 7474 7273 3a20 626f    keep_attrs: bo
-00007120: 6f6c 207c 2073 7472 207c 204e 6f6e 6520  ol | str | None 
-00007130: 3d20 4e6f 6e65 2c0a 2020 2020 6b77 6172  = None,.    kwar
-00007140: 6773 3a20 4d61 7070 696e 6720 7c20 4e6f  gs: Mapping | No
-00007150: 6e65 203d 204e 6f6e 652c 0a20 2020 2064  ne = None,.    d
-00007160: 6173 6b3a 2073 7472 203d 2022 666f 7262  ask: str = "forb
-00007170: 6964 6465 6e22 2c0a 2020 2020 6f75 7470  idden",.    outp
-00007180: 7574 5f64 7479 7065 733a 2053 6571 7565  ut_dtypes: Seque
-00007190: 6e63 6520 7c20 4e6f 6e65 203d 204e 6f6e  nce | None = Non
-000071a0: 652c 0a20 2020 206f 7574 7075 745f 7369  e,.    output_si
-000071b0: 7a65 733a 204d 6170 7069 6e67 5b41 6e79  zes: Mapping[Any
-000071c0: 2c20 696e 745d 207c 204e 6f6e 6520 3d20  , int] | None = 
-000071d0: 4e6f 6e65 2c0a 2020 2020 6d65 7461 3a20  None,.    meta: 
-000071e0: 416e 7920 3d20 4e6f 6e65 2c0a 2020 2020  Any = None,.    
-000071f0: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
-00007200: 6773 3a20 6469 6374 5b73 7472 2c20 416e  gs: dict[str, An
-00007210: 795d 207c 204e 6f6e 6520 3d20 4e6f 6e65  y] | None = None
-00007220: 2c0a 2920 2d3e 2041 6e79 3a0a 2020 2020  ,.) -> Any:.    
-00007230: 2222 2241 7070 6c79 2061 2076 6563 746f  """Apply a vecto
-00007240: 7269 7a65 6420 6675 6e63 7469 6f6e 2066  rized function f
-00007250: 6f72 2075 6e6c 6162 656c 6564 2061 7272  or unlabeled arr
-00007260: 6179 7320 6f6e 2078 6172 7261 7920 6f62  ays on xarray ob
-00007270: 6a65 6374 732e 0a0a 2020 2020 5468 6520  jects...    The 
-00007280: 6675 6e63 7469 6f6e 2077 696c 6c20 6265  function will be
-00007290: 206d 6170 7065 6420 6f76 6572 2074 6865   mapped over the
-000072a0: 2064 6174 6120 7661 7269 6162 6c65 2873   data variable(s
-000072b0: 2920 6f66 2074 6865 2069 6e70 7574 0a20  ) of the input. 
-000072c0: 2020 2061 7267 756d 656e 7473 2075 7369     arguments usi
-000072d0: 6e67 2078 6172 7261 7927 7320 7374 616e  ng xarray's stan
-000072e0: 6461 7264 2072 756c 6573 2066 6f72 206c  dard rules for l
-000072f0: 6162 656c 6564 2063 6f6d 7075 7461 7469  abeled computati
-00007300: 6f6e 2c20 696e 636c 7564 696e 670a 2020  on, including.  
-00007310: 2020 616c 6967 6e6d 656e 742c 2062 726f    alignment, bro
-00007320: 6164 6361 7374 696e 672c 206c 6f6f 7069  adcasting, loopi
-00007330: 6e67 206f 7665 7220 4772 6f75 7042 792f  ng over GroupBy/
-00007340: 4461 7461 7365 7420 7661 7269 6162 6c65  Dataset variable
-00007350: 732c 2061 6e64 0a20 2020 206d 6572 6769  s, and.    mergi
-00007360: 6e67 206f 6620 636f 6f72 6469 6e61 7465  ng of coordinate
-00007370: 732e 0a0a 2020 2020 5061 7261 6d65 7465  s...    Paramete
-00007380: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00007390: 2d0a 2020 2020 6675 6e63 203a 2063 616c  -.    func : cal
-000073a0: 6c61 626c 650a 2020 2020 2020 2020 4675  lable.        Fu
-000073b0: 6e63 7469 6f6e 2074 6f20 6361 6c6c 206c  nction to call l
-000073c0: 696b 6520 6060 6675 6e63 282a 6172 6773  ike ``func(*args
-000073d0: 2c20 2a2a 6b77 6172 6773 2960 6020 6f6e  , **kwargs)`` on
-000073e0: 2075 6e6c 6162 656c 6564 2061 7272 6179   unlabeled array
-000073f0: 730a 2020 2020 2020 2020 2860 602e 6461  s.        (``.da
-00007400: 7461 6060 2920 7468 6174 2072 6574 7572  ta``) that retur
-00007410: 6e73 2061 6e20 6172 7261 7920 6f72 2074  ns an array or t
-00007420: 7570 6c65 206f 6620 6172 7261 7973 2e20  uple of arrays. 
-00007430: 4966 206d 756c 7469 706c 650a 2020 2020  If multiple.    
-00007440: 2020 2020 6172 6775 6d65 6e74 7320 7769      arguments wi
-00007450: 7468 206e 6f6e 2d6d 6174 6368 696e 6720  th non-matching 
-00007460: 6469 6d65 6e73 696f 6e73 2061 7265 2073  dimensions are s
-00007470: 7570 706c 6965 642c 2074 6869 7320 6675  upplied, this fu
-00007480: 6e63 7469 6f6e 2069 730a 2020 2020 2020  nction is.      
-00007490: 2020 6578 7065 6374 6564 2074 6f20 7665    expected to ve
-000074a0: 6374 6f72 697a 6520 2862 726f 6164 6361  ctorize (broadca
-000074b0: 7374 2920 6f76 6572 2061 7865 7320 6f66  st) over axes of
-000074c0: 2070 6f73 6974 696f 6e61 6c20 6172 6775   positional argu
-000074d0: 6d65 6e74 7320 696e 0a20 2020 2020 2020  ments in.       
-000074e0: 2074 6865 2073 7479 6c65 206f 6620 4e75   the style of Nu
-000074f0: 6d50 7920 756e 6976 6572 7361 6c20 6675  mPy universal fu
-00007500: 6e63 7469 6f6e 7320 5b31 5d5f 2028 6966  nctions [1]_ (if
-00007510: 2074 6869 7320 6973 206e 6f74 2074 6865   this is not the
-00007520: 2063 6173 652c 0a20 2020 2020 2020 2073   case,.        s
-00007530: 6574 2060 6076 6563 746f 7269 7a65 3d54  et ``vectorize=T
-00007540: 7275 6560 6029 2e20 4966 2074 6869 7320  rue``). If this 
-00007550: 6675 6e63 7469 6f6e 2072 6574 7572 6e73  function returns
-00007560: 206d 756c 7469 706c 6520 6f75 7470 7574   multiple output
-00007570: 732c 2079 6f75 0a20 2020 2020 2020 206d  s, you.        m
-00007580: 7573 7420 7365 7420 6060 6f75 7470 7574  ust set ``output
-00007590: 5f63 6f72 655f 6469 6d73 6060 2061 7320  _core_dims`` as 
-000075a0: 7765 6c6c 2e0a 2020 2020 2a61 7267 7320  well..    *args 
-000075b0: 3a20 4461 7461 7365 742c 2044 6174 6141  : Dataset, DataA
-000075c0: 7272 6179 2c20 4461 7461 4172 7261 7947  rray, DataArrayG
-000075d0: 726f 7570 4279 2c20 4461 7461 7365 7447  roupBy, DatasetG
-000075e0: 726f 7570 4279 2c20 5661 7269 6162 6c65  roupBy, Variable
-000075f0: 2c20 5c0a 2020 2020 2020 2020 6e75 6d70  , \.        nump
-00007600: 792e 6e64 6172 7261 792c 2064 6173 6b2e  y.ndarray, dask.
-00007610: 6172 7261 792e 4172 7261 7920 6f72 2073  array.Array or s
-00007620: 6361 6c61 720a 2020 2020 2020 2020 4d69  calar.        Mi
-00007630: 7820 6f66 206c 6162 656c 6564 2061 6e64  x of labeled and
-00007640: 2f6f 7220 756e 6c61 6265 6c65 6420 6172  /or unlabeled ar
-00007650: 7261 7973 2074 6f20 7768 6963 6820 746f  rays to which to
-00007660: 2061 7070 6c79 2074 6865 2066 756e 6374   apply the funct
-00007670: 696f 6e2e 0a20 2020 2069 6e70 7574 5f63  ion..    input_c
-00007680: 6f72 655f 6469 6d73 203a 2073 6571 7565  ore_dims : seque
-00007690: 6e63 6520 6f66 2073 6571 7565 6e63 652c  nce of sequence,
-000076a0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-000076b0: 2020 4c69 7374 206f 6620 7468 6520 7361    List of the sa
-000076c0: 6d65 206c 656e 6774 6820 6173 2060 6061  me length as ``a
-000076d0: 7267 7360 6020 6769 7669 6e67 2074 6865  rgs`` giving the
-000076e0: 206c 6973 7420 6f66 2063 6f72 6520 6469   list of core di
-000076f0: 6d65 6e73 696f 6e73 0a20 2020 2020 2020  mensions.       
-00007700: 206f 6e20 6561 6368 2069 6e70 7574 2061   on each input a
-00007710: 7267 756d 656e 7420 7468 6174 2073 686f  rgument that sho
-00007720: 756c 6420 6e6f 7420 6265 2062 726f 6164  uld not be broad
-00007730: 6361 7374 2e20 4279 2064 6566 6175 6c74  cast. By default
-00007740: 2c20 7765 0a20 2020 2020 2020 2061 7373  , we.        ass
-00007750: 756d 6520 7468 6572 6520 6172 6520 6e6f  ume there are no
-00007760: 2063 6f72 6520 6469 6d65 6e73 696f 6e73   core dimensions
-00007770: 206f 6e20 616e 7920 696e 7075 7420 6172   on any input ar
-00007780: 6775 6d65 6e74 732e 0a0a 2020 2020 2020  guments...      
-00007790: 2020 466f 7220 6578 616d 706c 652c 2060    For example, `
-000077a0: 6069 6e70 7574 5f63 6f72 655f 6469 6d73  `input_core_dims
-000077b0: 3d5b 5b5d 2c20 5b27 7469 6d65 275d 5d60  =[[], ['time']]`
-000077c0: 6020 696e 6469 6361 7465 7320 7468 6174  ` indicates that
-000077d0: 2061 6c6c 0a20 2020 2020 2020 2064 696d   all.        dim
-000077e0: 656e 7369 6f6e 7320 6f6e 2074 6865 2066  ensions on the f
-000077f0: 6972 7374 2061 7267 756d 656e 7420 616e  irst argument an
-00007800: 6420 616c 6c20 6469 6d65 6e73 696f 6e73  d all dimensions
-00007810: 206f 7468 6572 2074 6861 6e20 2774 696d   other than 'tim
-00007820: 6527 0a20 2020 2020 2020 206f 6e20 7468  e'.        on th
-00007830: 6520 7365 636f 6e64 2061 7267 756d 656e  e second argumen
-00007840: 7420 7368 6f75 6c64 2062 6520 6272 6f61  t should be broa
-00007850: 6463 6173 742e 0a0a 2020 2020 2020 2020  dcast...        
-00007860: 436f 7265 2064 696d 656e 7369 6f6e 7320  Core dimensions 
-00007870: 6172 6520 6175 746f 6d61 7469 6361 6c6c  are automaticall
-00007880: 7920 6d6f 7665 6420 746f 2074 6865 206c  y moved to the l
-00007890: 6173 7420 6178 6573 206f 6620 696e 7075  ast axes of inpu
-000078a0: 740a 2020 2020 2020 2020 7661 7269 6162  t.        variab
-000078b0: 6c65 7320 6265 666f 7265 2061 7070 6c79  les before apply
-000078c0: 696e 6720 6060 6675 6e63 6060 2c20 7768  ing ``func``, wh
-000078d0: 6963 6820 6661 6369 6c69 7461 7465 7320  ich facilitates 
-000078e0: 7573 696e 6720 4e75 6d50 7920 7374 796c  using NumPy styl
-000078f0: 650a 2020 2020 2020 2020 6765 6e65 7261  e.        genera
-00007900: 6c69 7a65 6420 7566 756e 6373 205b 325d  lized ufuncs [2]
-00007910: 5f2e 0a20 2020 206f 7574 7075 745f 636f  _..    output_co
-00007920: 7265 5f64 696d 7320 3a20 6c69 7374 206f  re_dims : list o
-00007930: 6620 7475 706c 652c 206f 7074 696f 6e61  f tuple, optiona
-00007940: 6c0a 2020 2020 2020 2020 4c69 7374 206f  l.        List o
-00007950: 6620 7468 6520 7361 6d65 206c 656e 6774  f the same lengt
-00007960: 6820 6173 2074 6865 206e 756d 6265 7220  h as the number 
-00007970: 6f66 206f 7574 7075 7420 6172 6775 6d65  of output argume
-00007980: 6e74 7320 6672 6f6d 0a20 2020 2020 2020  nts from.       
-00007990: 2060 6066 756e 6360 602c 2067 6976 696e   ``func``, givin
-000079a0: 6720 7468 6520 6c69 7374 206f 6620 636f  g the list of co
-000079b0: 7265 2064 696d 656e 7369 6f6e 7320 6f6e  re dimensions on
-000079c0: 2065 6163 6820 6f75 7470 7574 2074 6861   each output tha
-000079d0: 7420 7765 7265 0a20 2020 2020 2020 206e  t were.        n
-000079e0: 6f74 2062 726f 6164 6361 7374 206f 6e20  ot broadcast on 
-000079f0: 7468 6520 696e 7075 7473 2e20 4279 2064  the inputs. By d
-00007a00: 6566 6175 6c74 2c20 7765 2061 7373 756d  efault, we assum
-00007a10: 6520 7468 6174 2060 6066 756e 6360 600a  e that ``func``.
-00007a20: 2020 2020 2020 2020 6f75 7470 7574 7320          outputs 
-00007a30: 6578 6163 746c 7920 6f6e 6520 6172 7261  exactly one arra
-00007a40: 792c 2077 6974 6820 6178 6573 2063 6f72  y, with axes cor
-00007a50: 7265 7370 6f6e 6469 6e67 2074 6f20 6561  responding to ea
-00007a60: 6368 2062 726f 6164 6361 7374 0a20 2020  ch broadcast.   
-00007a70: 2020 2020 2064 696d 656e 7369 6f6e 2e0a       dimension..
-00007a80: 0a20 2020 2020 2020 2043 6f72 6520 6469  .        Core di
-00007a90: 6d65 6e73 696f 6e73 2061 7265 2061 7373  mensions are ass
-00007aa0: 756d 6564 2074 6f20 6170 7065 6172 2061  umed to appear a
-00007ab0: 7320 7468 6520 6c61 7374 2064 696d 656e  s the last dimen
-00007ac0: 7369 6f6e 7320 6f66 2065 6163 680a 2020  sions of each.  
-00007ad0: 2020 2020 2020 6f75 7470 7574 2069 6e20        output in 
-00007ae0: 7468 6520 7072 6f76 6964 6564 206f 7264  the provided ord
-00007af0: 6572 2e0a 2020 2020 6578 636c 7564 655f  er..    exclude_
-00007b00: 6469 6d73 203a 2073 6574 2c20 6f70 7469  dims : set, opti
-00007b10: 6f6e 616c 0a20 2020 2020 2020 2043 6f72  onal.        Cor
-00007b20: 6520 6469 6d65 6e73 696f 6e73 206f 6e20  e dimensions on 
-00007b30: 7468 6520 696e 7075 7473 2074 6f20 6578  the inputs to ex
-00007b40: 636c 7564 6520 6672 6f6d 2061 6c69 676e  clude from align
-00007b50: 6d65 6e74 2061 6e64 0a20 2020 2020 2020  ment and.       
-00007b60: 2062 726f 6164 6361 7374 696e 6720 656e   broadcasting en
-00007b70: 7469 7265 6c79 2e20 416e 7920 696e 7075  tirely. Any inpu
-00007b80: 7420 636f 6f72 6469 6e61 7465 7320 616c  t coordinates al
-00007b90: 6f6e 6720 7468 6573 6520 6469 6d65 6e73  ong these dimens
-00007ba0: 696f 6e73 0a20 2020 2020 2020 2077 696c  ions.        wil
-00007bb0: 6c20 6265 2064 726f 7070 6564 2e20 4561  l be dropped. Ea
-00007bc0: 6368 2065 7863 6c75 6465 6420 6469 6d65  ch excluded dime
-00007bd0: 6e73 696f 6e20 6d75 7374 2061 6c73 6f20  nsion must also 
-00007be0: 6170 7065 6172 2069 6e0a 2020 2020 2020  appear in.      
-00007bf0: 2020 6060 696e 7075 745f 636f 7265 5f64    ``input_core_d
-00007c00: 696d 7360 6020 666f 7220 6174 206c 6561  ims`` for at lea
-00007c10: 7374 206f 6e65 2061 7267 756d 656e 742e  st one argument.
-00007c20: 204f 6e6c 7920 6469 6d65 6e73 696f 6e73   Only dimensions
-00007c30: 206c 6973 7465 640a 2020 2020 2020 2020   listed.        
-00007c40: 6865 7265 2061 7265 2061 6c6c 6f77 6564  here are allowed
-00007c50: 2074 6f20 6368 616e 6765 2073 697a 6520   to change size 
-00007c60: 6265 7477 6565 6e20 696e 7075 7420 616e  between input an
-00007c70: 6420 6f75 7470 7574 206f 626a 6563 7473  d output objects
-00007c80: 2e0a 2020 2020 7665 6374 6f72 697a 6520  ..    vectorize 
-00007c90: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
-00007ca0: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-00007cb0: 2c20 7468 656e 2061 7373 756d 6520 6060  , then assume ``
-00007cc0: 6675 6e63 6060 206f 6e6c 7920 7461 6b65  func`` only take
-00007cd0: 7320 6172 7261 7973 2064 6566 696e 6564  s arrays defined
-00007ce0: 206f 7665 7220 636f 7265 0a20 2020 2020   over core.     
-00007cf0: 2020 2064 696d 656e 7369 6f6e 7320 6173     dimensions as
-00007d00: 2069 6e70 7574 2061 6e64 2076 6563 746f   input and vecto
-00007d10: 7269 7a65 2069 7420 6175 746f 6d61 7469  rize it automati
-00007d20: 6361 6c6c 7920 7769 7468 0a20 2020 2020  cally with.     
-00007d30: 2020 203a 7079 3a66 756e 633a 606e 756d     :py:func:`num
-00007d40: 7079 2e76 6563 746f 7269 7a65 602e 2054  py.vectorize`. T
-00007d50: 6869 7320 6f70 7469 6f6e 2065 7869 7374  his option exist
-00007d60: 7320 666f 7220 636f 6e76 656e 6965 6e63  s for convenienc
-00007d70: 652c 2062 7574 2069 730a 2020 2020 2020  e, but is.      
-00007d80: 2020 616c 6d6f 7374 2061 6c77 6179 7320    almost always 
-00007d90: 736c 6f77 6572 2074 6861 6e20 7375 7070  slower than supp
-00007da0: 6c79 696e 6720 6120 7072 652d 7665 6374  lying a pre-vect
-00007db0: 6f72 697a 6564 2066 756e 6374 696f 6e2e  orized function.
-00007dc0: 0a20 2020 206a 6f69 6e20 3a20 7b22 6f75  .    join : {"ou
-00007dd0: 7465 7222 2c20 2269 6e6e 6572 222c 2022  ter", "inner", "
-00007de0: 6c65 6674 222c 2022 7269 6768 7422 2c20  left", "right", 
-00007df0: 2265 7861 6374 227d 2c20 6465 6661 756c  "exact"}, defaul
-00007e00: 743a 2022 6578 6163 7422 0a20 2020 2020  t: "exact".     
-00007e10: 2020 204d 6574 686f 6420 666f 7220 6a6f     Method for jo
-00007e20: 696e 696e 6720 7468 6520 696e 6465 7865  ining the indexe
-00007e30: 7320 6f66 2074 6865 2070 6173 7365 6420  s of the passed 
-00007e40: 6f62 6a65 6374 7320 616c 6f6e 6720 6561  objects along ea
-00007e50: 6368 0a20 2020 2020 2020 2064 696d 656e  ch.        dimen
-00007e60: 7369 6f6e 2c20 616e 6420 7468 6520 7661  sion, and the va
-00007e70: 7269 6162 6c65 7320 6f66 2044 6174 6173  riables of Datas
-00007e80: 6574 206f 626a 6563 7473 2077 6974 6820  et objects with 
-00007e90: 6d69 736d 6174 6368 6564 0a20 2020 2020  mismatched.     
-00007ea0: 2020 2064 6174 6120 7661 7269 6162 6c65     data variable
-00007eb0: 733a 0a0a 2020 2020 2020 2020 2d20 276f  s:..        - 'o
-00007ec0: 7574 6572 273a 2075 7365 2074 6865 2075  uter': use the u
-00007ed0: 6e69 6f6e 206f 6620 6f62 6a65 6374 2069  nion of object i
-00007ee0: 6e64 6578 6573 0a20 2020 2020 2020 202d  ndexes.        -
-00007ef0: 2027 696e 6e65 7227 3a20 7573 6520 7468   'inner': use th
-00007f00: 6520 696e 7465 7273 6563 7469 6f6e 206f  e intersection o
-00007f10: 6620 6f62 6a65 6374 2069 6e64 6578 6573  f object indexes
-00007f20: 0a20 2020 2020 2020 202d 2027 6c65 6674  .        - 'left
-00007f30: 273a 2075 7365 2069 6e64 6578 6573 2066  ': use indexes f
-00007f40: 726f 6d20 7468 6520 6669 7273 7420 6f62  rom the first ob
-00007f50: 6a65 6374 2077 6974 6820 6561 6368 2064  ject with each d
-00007f60: 696d 656e 7369 6f6e 0a20 2020 2020 2020  imension.       
-00007f70: 202d 2027 7269 6768 7427 3a20 7573 6520   - 'right': use 
-00007f80: 696e 6465 7865 7320 6672 6f6d 2074 6865  indexes from the
-00007f90: 206c 6173 7420 6f62 6a65 6374 2077 6974   last object wit
-00007fa0: 6820 6561 6368 2064 696d 656e 7369 6f6e  h each dimension
-00007fb0: 0a20 2020 2020 2020 202d 2027 6578 6163  .        - 'exac
-00007fc0: 7427 3a20 7261 6973 6520 6056 616c 7565  t': raise `Value
-00007fd0: 4572 726f 7260 2069 6e73 7465 6164 206f  Error` instead o
-00007fe0: 6620 616c 6967 6e69 6e67 2077 6865 6e20  f aligning when 
-00007ff0: 696e 6465 7865 7320 746f 2062 650a 2020  indexes to be.  
-00008000: 2020 2020 2020 2020 616c 6967 6e65 6420          aligned 
-00008010: 6172 6520 6e6f 7420 6571 7561 6c0a 2020  are not equal.  
-00008020: 2020 6461 7461 7365 745f 6a6f 696e 203a    dataset_join :
-00008030: 207b 226f 7574 6572 222c 2022 696e 6e65   {"outer", "inne
-00008040: 7222 2c20 226c 6566 7422 2c20 2272 6967  r", "left", "rig
-00008050: 6874 222c 2022 6578 6163 7422 7d2c 2064  ht", "exact"}, d
-00008060: 6566 6175 6c74 3a20 2265 7861 6374 220a  efault: "exact".
-00008070: 2020 2020 2020 2020 4d65 7468 6f64 2066          Method f
-00008080: 6f72 206a 6f69 6e69 6e67 2076 6172 6961  or joining varia
-00008090: 626c 6573 206f 6620 4461 7461 7365 7420  bles of Dataset 
-000080a0: 6f62 6a65 6374 7320 7769 7468 206d 6973  objects with mis
-000080b0: 6d61 7463 6865 640a 2020 2020 2020 2020  matched.        
-000080c0: 6461 7461 2076 6172 6961 626c 6573 2e0a  data variables..
-000080d0: 0a20 2020 2020 2020 202d 2027 6f75 7465  .        - 'oute
-000080e0: 7227 3a20 7461 6b65 2076 6172 6961 626c  r': take variabl
-000080f0: 6573 2066 726f 6d20 626f 7468 2044 6174  es from both Dat
-00008100: 6173 6574 206f 626a 6563 7473 0a20 2020  aset objects.   
-00008110: 2020 2020 202d 2027 696e 6e65 7227 3a20       - 'inner': 
-00008120: 7461 6b65 206f 6e6c 7920 6f76 6572 6c61  take only overla
-00008130: 7070 6564 2076 6172 6961 626c 6573 0a20  pped variables. 
-00008140: 2020 2020 2020 202d 2027 6c65 6674 273a         - 'left':
-00008150: 2074 616b 6520 6f6e 6c79 2076 6172 6961   take only varia
-00008160: 626c 6573 2066 726f 6d20 7468 6520 6669  bles from the fi
-00008170: 7273 7420 6f62 6a65 6374 0a20 2020 2020  rst object.     
-00008180: 2020 202d 2027 7269 6768 7427 3a20 7461     - 'right': ta
-00008190: 6b65 206f 6e6c 7920 7661 7269 6162 6c65  ke only variable
-000081a0: 7320 6672 6f6d 2074 6865 206c 6173 7420  s from the last 
-000081b0: 6f62 6a65 6374 0a20 2020 2020 2020 202d  object.        -
-000081c0: 2027 6578 6163 7427 3a20 6461 7461 2076   'exact': data v
-000081d0: 6172 6961 626c 6573 206f 6e20 616c 6c20  ariables on all 
-000081e0: 4461 7461 7365 7420 6f62 6a65 6374 7320  Dataset objects 
-000081f0: 6d75 7374 206d 6174 6368 2065 7861 6374  must match exact
-00008200: 6c79 0a20 2020 2064 6174 6173 6574 5f66  ly.    dataset_f
-00008210: 696c 6c5f 7661 6c75 6520 3a20 6f70 7469  ill_value : opti
-00008220: 6f6e 616c 0a20 2020 2020 2020 2056 616c  onal.        Val
-00008230: 7565 2075 7365 6420 696e 2070 6c61 6365  ue used in place
-00008240: 206f 6620 6d69 7373 696e 6720 7661 7269   of missing vari
-00008250: 6162 6c65 7320 6f6e 2044 6174 6173 6574  ables on Dataset
-00008260: 2069 6e70 7574 7320 7768 656e 2074 6865   inputs when the
-00008270: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-00008280: 7320 646f 206e 6f74 2073 6861 7265 2074  s do not share t
-00008290: 6865 2065 7861 6374 2073 616d 6520 6060  he exact same ``
-000082a0: 6461 7461 5f76 6172 7360 602e 2052 6571  data_vars``. Req
-000082b0: 7569 7265 6420 6966 0a20 2020 2020 2020  uired if.       
-000082c0: 2060 6064 6174 6173 6574 5f6a 6f69 6e20   ``dataset_join 
-000082d0: 6e6f 7420 696e 207b 2769 6e6e 6572 272c  not in {'inner',
-000082e0: 2027 6578 6163 7427 7d60 602c 206f 7468   'exact'}``, oth
-000082f0: 6572 7769 7365 2069 676e 6f72 6564 2e0a  erwise ignored..
-00008300: 2020 2020 6b65 6570 5f61 7474 7273 203a      keep_attrs :
-00008310: 207b 2264 726f 7022 2c20 2269 6465 6e74   {"drop", "ident
-00008320: 6963 616c 222c 2022 6e6f 5f63 6f6e 666c  ical", "no_confl
-00008330: 6963 7473 222c 2022 6472 6f70 5f63 6f6e  icts", "drop_con
-00008340: 666c 6963 7473 222c 2022 6f76 6572 7269  flicts", "overri
-00008350: 6465 227d 206f 7220 626f 6f6c 2c20 6f70  de"} or bool, op
-00008360: 7469 6f6e 616c 0a20 2020 2020 2020 202d  tional.        -
-00008370: 2027 6472 6f70 2720 6f72 2046 616c 7365   'drop' or False
-00008380: 3a20 656d 7074 7920 6174 7472 7320 6f6e  : empty attrs on
-00008390: 2072 6574 7572 6e65 6420 7861 7272 6179   returned xarray
-000083a0: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
-000083b0: 202d 2027 6964 656e 7469 6361 6c27 3a20   - 'identical': 
-000083c0: 616c 6c20 6174 7472 7320 6d75 7374 2062  all attrs must b
-000083d0: 6520 7468 6520 7361 6d65 206f 6e20 6576  e the same on ev
-000083e0: 6572 7920 6f62 6a65 6374 2e0a 2020 2020  ery object..    
-000083f0: 2020 2020 2d20 276e 6f5f 636f 6e66 6c69      - 'no_confli
-00008400: 6374 7327 3a20 6174 7472 7320 6672 6f6d  cts': attrs from
-00008410: 2061 6c6c 206f 626a 6563 7473 2061 7265   all objects are
-00008420: 2063 6f6d 6269 6e65 642c 2061 6e79 2074   combined, any t
-00008430: 6861 7420 6861 7665 2074 6865 2073 616d  hat have the sam
-00008440: 6520 6e61 6d65 206d 7573 7420 616c 736f  e name must also
-00008450: 2068 6176 6520 7468 6520 7361 6d65 2076   have the same v
-00008460: 616c 7565 2e0a 2020 2020 2020 2020 2d20  alue..        - 
-00008470: 2764 726f 705f 636f 6e66 6c69 6374 7327  'drop_conflicts'
-00008480: 3a20 6174 7472 7320 6672 6f6d 2061 6c6c  : attrs from all
-00008490: 206f 626a 6563 7473 2061 7265 2063 6f6d   objects are com
-000084a0: 6269 6e65 642c 2061 6e79 2074 6861 7420  bined, any that 
-000084b0: 6861 7665 2074 6865 2073 616d 6520 6e61  have the same na
-000084c0: 6d65 2062 7574 2064 6966 6665 7265 6e74  me but different
-000084d0: 2076 616c 7565 7320 6172 6520 6472 6f70   values are drop
-000084e0: 7065 642e 0a20 2020 2020 2020 202d 2027  ped..        - '
-000084f0: 6f76 6572 7269 6465 2720 6f72 2054 7275  override' or Tru
-00008500: 653a 2073 6b69 7020 636f 6d70 6172 696e  e: skip comparin
-00008510: 6720 616e 6420 636f 7079 2061 7474 7273  g and copy attrs
-00008520: 2066 726f 6d20 7468 6520 6669 7273 7420   from the first 
-00008530: 6f62 6a65 6374 2074 6f20 7468 6520 7265  object to the re
-00008540: 7375 6c74 2e0a 2020 2020 6b77 6172 6773  sult..    kwargs
-00008550: 203a 2064 6963 742c 206f 7074 696f 6e61   : dict, optiona
-00008560: 6c0a 2020 2020 2020 2020 4f70 7469 6f6e  l.        Option
-00008570: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
-00008580: 656e 7473 2070 6173 7365 6420 6469 7265  ents passed dire
-00008590: 6374 6c79 206f 6e20 746f 2063 616c 6c20  ctly on to call 
-000085a0: 6060 6675 6e63 6060 2e0a 2020 2020 6461  ``func``..    da
-000085b0: 736b 203a 207b 2266 6f72 6269 6464 656e  sk : {"forbidden
-000085c0: 222c 2022 616c 6c6f 7765 6422 2c20 2270  ", "allowed", "p
-000085d0: 6172 616c 6c65 6c69 7a65 6422 7d2c 2064  arallelized"}, d
-000085e0: 6566 6175 6c74 3a20 2266 6f72 6269 6464  efault: "forbidd
-000085f0: 656e 220a 2020 2020 2020 2020 486f 7720  en".        How 
-00008600: 746f 2068 616e 646c 6520 6170 706c 7969  to handle applyi
-00008610: 6e67 2074 6f20 6f62 6a65 6374 7320 636f  ng to objects co
-00008620: 6e74 6169 6e69 6e67 206c 617a 7920 6461  ntaining lazy da
-00008630: 7461 2069 6e20 7468 6520 666f 726d 206f  ta in the form o
-00008640: 660a 2020 2020 2020 2020 6461 736b 2061  f.        dask a
-00008650: 7272 6179 733a 0a0a 2020 2020 2020 2020  rrays:..        
-00008660: 2d20 2766 6f72 6269 6464 656e 2720 2864  - 'forbidden' (d
-00008670: 6566 6175 6c74 293a 2072 6169 7365 2061  efault): raise a
-00008680: 6e20 6572 726f 7220 6966 2061 2064 6173  n error if a das
-00008690: 6b20 6172 7261 7920 6973 2065 6e63 6f75  k array is encou
-000086a0: 6e74 6572 6564 2e0a 2020 2020 2020 2020  ntered..        
-000086b0: 2d20 2761 6c6c 6f77 6564 273a 2070 6173  - 'allowed': pas
-000086c0: 7320 6461 736b 2061 7272 6179 7320 6469  s dask arrays di
-000086d0: 7265 6374 6c79 206f 6e20 746f 2060 6066  rectly on to ``f
-000086e0: 756e 6360 602e 2050 7265 6665 7220 7468  unc``. Prefer th
-000086f0: 6973 206f 7074 696f 6e20 6966 0a20 2020  is option if.   
-00008700: 2020 2020 2020 2060 6066 756e 6360 6020         ``func`` 
-00008710: 6e61 7469 7665 6c79 2073 7570 706f 7274  natively support
-00008720: 7320 6461 736b 2061 7272 6179 732e 0a20  s dask arrays.. 
-00008730: 2020 2020 2020 202d 2027 7061 7261 6c6c         - 'parall
-00008740: 656c 697a 6564 273a 2061 7574 6f6d 6174  elized': automat
-00008750: 6963 616c 6c79 2070 6172 616c 6c65 6c69  ically paralleli
-00008760: 7a65 2060 6066 756e 6360 6020 6966 2061  ze ``func`` if a
-00008770: 6e79 206f 6620 7468 650a 2020 2020 2020  ny of the.      
-00008780: 2020 2020 696e 7075 7473 2061 7265 2061      inputs are a
-00008790: 2064 6173 6b20 6172 7261 7920 6279 2075   dask array by u
-000087a0: 7369 6e67 203a 7079 3a66 756e 633a 6064  sing :py:func:`d
-000087b0: 6173 6b2e 6172 7261 792e 6170 706c 795f  ask.array.apply_
-000087c0: 6775 6675 6e63 602e 204d 756c 7469 706c  gufunc`. Multipl
-000087d0: 6520 6f75 7470 7574 0a20 2020 2020 2020  e output.       
-000087e0: 2020 2061 7267 756d 656e 7473 2061 7265     arguments are
-000087f0: 2073 7570 706f 7274 6564 2e20 4f6e 6c79   supported. Only
-00008800: 2075 7365 2074 6869 7320 6f70 7469 6f6e   use this option
-00008810: 2069 6620 6060 6675 6e63 6060 2064 6f65   if ``func`` doe
-00008820: 7320 6e6f 7420 6e61 7469 7665 6c79 0a20  s not natively. 
-00008830: 2020 2020 2020 2020 2073 7570 706f 7274           support
-00008840: 2064 6173 6b20 6172 7261 7973 2028 652e   dask arrays (e.
-00008850: 672e 2063 6f6e 7665 7274 7320 7468 656d  g. converts them
-00008860: 2074 6f20 6e75 6d70 7920 6172 7261 7973   to numpy arrays
-00008870: 292e 0a20 2020 2064 6173 6b5f 6775 6675  )..    dask_gufu
-00008880: 6e63 5f6b 7761 7267 7320 3a20 6469 6374  nc_kwargs : dict
-00008890: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-000088a0: 2020 204f 7074 696f 6e61 6c20 6b65 7977     Optional keyw
-000088b0: 6f72 6420 6172 6775 6d65 6e74 7320 7061  ord arguments pa
-000088c0: 7373 6564 2074 6f20 3a70 793a 6675 6e63  ssed to :py:func
-000088d0: 3a60 6461 736b 2e61 7272 6179 2e61 7070  :`dask.array.app
-000088e0: 6c79 5f67 7566 756e 6360 2069 660a 2020  ly_gufunc` if.  
-000088f0: 2020 2020 2020 6461 736b 3d27 7061 7261        dask='para
-00008900: 6c6c 656c 697a 6564 272e 2050 6f73 7369  llelized'. Possi
-00008910: 626c 6520 6b65 7977 6f72 6473 2061 7265  ble keywords are
-00008920: 2060 606f 7574 7075 745f 7369 7a65 7360   ``output_sizes`
-00008930: 602c 2060 6061 6c6c 6f77 5f72 6563 6875  `, ``allow_rechu
-00008940: 6e6b 6060 0a20 2020 2020 2020 2061 6e64  nk``.        and
-00008950: 2060 606d 6574 6160 602e 0a20 2020 206f   ``meta``..    o
-00008960: 7574 7075 745f 6474 7970 6573 203a 206c  utput_dtypes : l
-00008970: 6973 7420 6f66 2064 7479 7065 2c20 6f70  ist of dtype, op
-00008980: 7469 6f6e 616c 0a20 2020 2020 2020 204f  tional.        O
-00008990: 7074 696f 6e61 6c20 6c69 7374 206f 6620  ptional list of 
-000089a0: 6f75 7470 7574 2064 7479 7065 732e 204f  output dtypes. O
-000089b0: 6e6c 7920 7573 6564 2069 6620 6060 6461  nly used if ``da
-000089c0: 736b 3d27 7061 7261 6c6c 656c 697a 6564  sk='parallelized
-000089d0: 2760 6020 6f72 0a20 2020 2020 2020 2060  '`` or.        `
-000089e0: 6076 6563 746f 7269 7a65 3d54 7275 6560  `vectorize=True`
-000089f0: 602e 0a20 2020 206f 7574 7075 745f 7369  `..    output_si
-00008a00: 7a65 7320 3a20 6469 6374 2c20 6f70 7469  zes : dict, opti
-00008a10: 6f6e 616c 0a20 2020 2020 2020 204f 7074  onal.        Opt
-00008a20: 696f 6e61 6c20 6d61 7070 696e 6720 6672  ional mapping fr
-00008a30: 6f6d 2064 696d 656e 7369 6f6e 206e 616d  om dimension nam
-00008a40: 6573 2074 6f20 7369 7a65 7320 666f 7220  es to sizes for 
-00008a50: 6f75 7470 7574 732e 204f 6e6c 7920 7573  outputs. Only us
-00008a60: 6564 0a20 2020 2020 2020 2069 6620 6461  ed.        if da
-00008a70: 736b 3d27 7061 7261 6c6c 656c 697a 6564  sk='parallelized
-00008a80: 2720 616e 6420 6e65 7720 6469 6d65 6e73  ' and new dimens
-00008a90: 696f 6e73 2028 6e6f 7420 666f 756e 6420  ions (not found 
-00008aa0: 6f6e 2069 6e70 7574 7329 2061 7070 6561  on inputs) appea
-00008ab0: 720a 2020 2020 2020 2020 6f6e 206f 7574  r.        on out
-00008ac0: 7075 7473 2e20 6060 6f75 7470 7574 5f73  puts. ``output_s
-00008ad0: 697a 6573 6060 2073 686f 756c 6420 6265  izes`` should be
-00008ae0: 2067 6976 656e 2069 6e20 7468 6520 6060   given in the ``
-00008af0: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
-00008b00: 6773 6060 0a20 2020 2020 2020 2070 6172  gs``.        par
-00008b10: 616d 6574 6572 2e20 4974 2077 696c 6c20  ameter. It will 
-00008b20: 6265 2072 656d 6f76 6564 2061 7320 6469  be removed as di
-00008b30: 7265 6374 2070 6172 616d 6574 6572 2069  rect parameter i
-00008b40: 6e20 6120 6675 7475 7265 2076 6572 7369  n a future versi
-00008b50: 6f6e 2e0a 2020 2020 6d65 7461 203a 206f  on..    meta : o
-00008b60: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00008b70: 5369 7a65 2d30 206f 626a 6563 7420 7265  Size-0 object re
-00008b80: 7072 6573 656e 7469 6e67 2074 6865 2074  presenting the t
-00008b90: 7970 6520 6f66 2061 7272 6179 2077 7261  ype of array wra
-00008ba0: 7070 6564 2062 7920 6461 736b 2061 7272  pped by dask arr
-00008bb0: 6179 2e20 5061 7373 6564 206f 6e20 746f  ay. Passed on to
-00008bc0: 0a20 2020 2020 2020 203a 7079 3a66 756e  .        :py:fun
-00008bd0: 633a 6064 6173 6b2e 6172 7261 792e 6170  c:`dask.array.ap
-00008be0: 706c 795f 6775 6675 6e63 602e 2060 606d  ply_gufunc`. ``m
-00008bf0: 6574 6160 6020 7368 6f75 6c64 2062 6520  eta`` should be 
-00008c00: 6769 7665 6e20 696e 2074 6865 0a20 2020  given in the.   
-00008c10: 2020 2020 2060 6064 6173 6b5f 6775 6675       ``dask_gufu
-00008c20: 6e63 5f6b 7761 7267 7360 6020 7061 7261  nc_kwargs`` para
-00008c30: 6d65 7465 7220 2e20 4974 2077 696c 6c20  meter . It will 
-00008c40: 6265 2072 656d 6f76 6564 2061 7320 6469  be removed as di
-00008c50: 7265 6374 2070 6172 616d 6574 6572 0a20  rect parameter. 
-00008c60: 2020 2020 2020 2061 2066 7574 7572 6520         a future 
-00008c70: 7665 7273 696f 6e2e 0a0a 2020 2020 5265  version...    Re
-00008c80: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00008c90: 2d0a 2020 2020 5369 6e67 6c65 2076 616c  -.    Single val
-00008ca0: 7565 206f 7220 7475 706c 6520 6f66 2044  ue or tuple of D
-00008cb0: 6174 6173 6574 2c20 4461 7461 4172 7261  ataset, DataArra
-00008cc0: 792c 2056 6172 6961 626c 652c 2064 6173  y, Variable, das
-00008cd0: 6b2e 6172 7261 792e 4172 7261 7920 6f72  k.array.Array or
-00008ce0: 0a20 2020 206e 756d 7079 2e6e 6461 7272  .    numpy.ndarr
-00008cf0: 6179 2c20 7468 6520 6669 7273 7420 7479  ay, the first ty
-00008d00: 7065 206f 6e20 7468 6174 206c 6973 7420  pe on that list 
-00008d10: 746f 2061 7070 6561 7220 6f6e 2061 6e20  to appear on an 
-00008d20: 696e 7075 742e 0a0a 2020 2020 4e6f 7465  input...    Note
-00008d30: 730a 2020 2020 2d2d 2d2d 2d0a 2020 2020  s.    -----.    
-00008d40: 5468 6973 2066 756e 6374 696f 6e20 6973  This function is
-00008d50: 2064 6573 6967 6e65 6420 666f 7220 7468   designed for th
-00008d60: 6520 6d6f 7265 2063 6f6d 6d6f 6e20 6361  e more common ca
-00008d70: 7365 2077 6865 7265 2060 6066 756e 6360  se where ``func`
-00008d80: 6020 6361 6e20 776f 726b 206f 6e20 6e75  ` can work on nu
-00008d90: 6d70 790a 2020 2020 6172 7261 7973 2e20  mpy.    arrays. 
-00008da0: 4966 2060 6066 756e 6360 6020 6e65 6564  If ``func`` need
-00008db0: 7320 746f 206d 616e 6970 756c 6174 6520  s to manipulate 
-00008dc0: 6120 7768 6f6c 6520 7861 7272 6179 206f  a whole xarray o
-00008dd0: 626a 6563 7420 7375 6273 6574 2074 6f20  bject subset to 
-00008de0: 6561 6368 2062 6c6f 636b 0a20 2020 2069  each block.    i
-00008df0: 7420 6973 2070 6f73 7369 626c 6520 746f  t is possible to
-00008e00: 2075 7365 203a 7079 3a66 756e 633a 6078   use :py:func:`x
-00008e10: 6172 7261 792e 6d61 705f 626c 6f63 6b73  array.map_blocks
-00008e20: 602e 0a0a 2020 2020 4e6f 7465 2074 6861  `...    Note tha
-00008e30: 7420 6475 6520 746f 2074 6865 206f 7665  t due to the ove
-00008e40: 7268 6561 6420 3a70 793a 6675 6e63 3a60  rhead :py:func:`
-00008e50: 7861 7272 6179 2e6d 6170 5f62 6c6f 636b  xarray.map_block
-00008e60: 7360 2069 7320 636f 6e73 6964 6572 6162  s` is considerab
-00008e70: 6c79 2073 6c6f 7765 7220 7468 616e 2060  ly slower than `
-00008e80: 6061 7070 6c79 5f75 6675 6e63 6060 2e0a  `apply_ufunc``..
-00008e90: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
-00008ea0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2043    --------.    C
-00008eb0: 616c 6375 6c61 7465 2074 6865 2076 6563  alculate the vec
-00008ec0: 746f 7220 6d61 676e 6974 7564 6520 6f66  tor magnitude of
-00008ed0: 2074 776f 2061 7267 756d 656e 7473 3a0a   two arguments:.
-00008ee0: 0a20 2020 203e 3e3e 2064 6566 206d 6167  .    >>> def mag
-00008ef0: 6e69 7475 6465 2861 2c20 6229 3a0a 2020  nitude(a, b):.  
-00008f00: 2020 2e2e 2e20 2020 2020 6675 6e63 203d    ...     func =
-00008f10: 206c 616d 6264 6120 782c 2079 3a20 6e70   lambda x, y: np
-00008f20: 2e73 7172 7428 782a 2a32 202b 2079 2a2a  .sqrt(x**2 + y**
-00008f30: 3229 0a20 2020 202e 2e2e 2020 2020 2072  2).    ...     r
-00008f40: 6574 7572 6e20 7872 2e61 7070 6c79 5f75  eturn xr.apply_u
-00008f50: 6675 6e63 2866 756e 632c 2061 2c20 6229  func(func, a, b)
-00008f60: 0a20 2020 202e 2e2e 0a0a 2020 2020 596f  .    .....    Yo
-00008f70: 7520 6361 6e20 6e6f 7720 6170 706c 7920  u can now apply 
-00008f80: 6060 6d61 676e 6974 7564 6528 2960 6020  ``magnitude()`` 
-00008f90: 746f 203a 7079 3a63 6c61 7373 3a60 4461  to :py:class:`Da
-00008fa0: 7461 4172 7261 7960 2061 6e64 203a 7079  taArray` and :py
-00008fb0: 3a63 6c61 7373 3a60 4461 7461 7365 7460  :class:`Dataset`
-00008fc0: 0a20 2020 206f 626a 6563 7473 2c20 7769  .    objects, wi
-00008fd0: 7468 2061 7574 6f6d 6174 6963 616c 6c79  th automatically
-00008fe0: 2070 7265 7365 7276 6564 2064 696d 656e   preserved dimen
-00008ff0: 7369 6f6e 7320 616e 6420 636f 6f72 6469  sions and coordi
-00009000: 6e61 7465 732c 2065 2e67 2e2c 0a0a 2020  nates, e.g.,..  
-00009010: 2020 3e3e 3e20 6172 7261 7920 3d20 7872    >>> array = xr
-00009020: 2e44 6174 6141 7272 6179 285b 312c 2032  .DataArray([1, 2
-00009030: 2c20 335d 2c20 636f 6f72 6473 3d5b 2822  , 3], coords=[("
-00009040: 7822 2c20 5b30 2e31 2c20 302e 322c 2030  x", [0.1, 0.2, 0
-00009050: 2e33 5d29 5d29 0a20 2020 203e 3e3e 206d  .3])]).    >>> m
-00009060: 6167 6e69 7475 6465 2861 7272 6179 2c20  agnitude(array, 
-00009070: 2d61 7272 6179 290a 2020 2020 3c78 6172  -array).    <xar
-00009080: 7261 792e 4461 7461 4172 7261 7920 2878  ray.DataArray (x
-00009090: 3a20 3329 3e0a 2020 2020 6172 7261 7928  : 3)>.    array(
-000090a0: 5b31 2e34 3134 3231 3335 362c 2032 2e38  [1.41421356, 2.8
-000090b0: 3238 3432 3731 322c 2034 2e32 3432 3634  2842712, 4.24264
-000090c0: 3036 395d 290a 2020 2020 436f 6f72 6469  069]).    Coordi
-000090d0: 6e61 7465 733a 0a20 2020 2020 202a 2078  nates:.      * x
-000090e0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-000090f0: 7436 3420 302e 3120 302e 3220 302e 330a  t64 0.1 0.2 0.3.
-00009100: 0a20 2020 2050 6c61 696e 2073 6361 6c61  .    Plain scala
-00009110: 7273 2c20 6e75 6d70 7920 6172 7261 7973  rs, numpy arrays
-00009120: 2061 6e64 2061 206d 6978 206f 6620 7468   and a mix of th
-00009130: 6573 6520 7769 7468 2078 6172 7261 7920  ese with xarray 
-00009140: 6f62 6a65 6374 7320 6973 2061 6c73 6f0a  objects is also.
-00009150: 2020 2020 7375 7070 6f72 7465 643a 0a0a      supported:..
-00009160: 2020 2020 3e3e 3e20 6d61 676e 6974 7564      >>> magnitud
-00009170: 6528 332c 2034 290a 2020 2020 352e 300a  e(3, 4).    5.0.
-00009180: 2020 2020 3e3e 3e20 6d61 676e 6974 7564      >>> magnitud
-00009190: 6528 332c 206e 702e 6172 7261 7928 5b30  e(3, np.array([0
-000091a0: 2c20 345d 2929 0a20 2020 2061 7272 6179  , 4])).    array
-000091b0: 285b 332e 2c20 352e 5d29 0a20 2020 203e  ([3., 5.]).    >
-000091c0: 3e3e 206d 6167 6e69 7475 6465 2861 7272  >> magnitude(arr
-000091d0: 6179 2c20 3029 0a20 2020 203c 7861 7272  ay, 0).    <xarr
-000091e0: 6179 2e44 6174 6141 7272 6179 2028 783a  ay.DataArray (x:
-000091f0: 2033 293e 0a20 2020 2061 7272 6179 285b   3)>.    array([
-00009200: 312e 2c20 322e 2c20 332e 5d29 0a20 2020  1., 2., 3.]).   
-00009210: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-00009220: 2020 2020 2a20 7820 2020 2020 2020 2028      * x        (
-00009230: 7829 2066 6c6f 6174 3634 2030 2e31 2030  x) float64 0.1 0
-00009240: 2e32 2030 2e33 0a0a 2020 2020 4f74 6865  .2 0.3..    Othe
-00009250: 7220 6578 616d 706c 6573 206f 6620 686f  r examples of ho
-00009260: 7720 796f 7520 636f 756c 6420 7573 6520  w you could use 
-00009270: 6060 6170 706c 795f 7566 756e 6360 6020  ``apply_ufunc`` 
-00009280: 746f 2077 7269 7465 2066 756e 6374 696f  to write functio
-00009290: 6e73 2074 6f0a 2020 2020 2876 6572 7920  ns to.    (very 
-000092a0: 6e65 6172 6c79 2920 7265 706c 6963 6174  nearly) replicat
-000092b0: 6520 6578 6973 7469 6e67 2078 6172 7261  e existing xarra
-000092c0: 7920 6675 6e63 7469 6f6e 616c 6974 793a  y functionality:
-000092d0: 0a0a 2020 2020 436f 6d70 7574 6520 7468  ..    Compute th
-000092e0: 6520 6d65 616e 2028 6060 2e6d 6561 6e60  e mean (``.mean`
-000092f0: 6029 206f 7665 7220 6f6e 6520 6469 6d65  `) over one dime
-00009300: 6e73 696f 6e3a 0a0a 2020 2020 3e3e 3e20  nsion:..    >>> 
-00009310: 6465 6620 6d65 616e 286f 626a 2c20 6469  def mean(obj, di
-00009320: 6d29 3a0a 2020 2020 2e2e 2e20 2020 2020  m):.    ...     
-00009330: 2320 6e6f 7465 3a20 6170 706c 7920 616c  # note: apply al
-00009340: 7761 7973 206d 6f76 6573 2063 6f72 6520  ways moves core 
-00009350: 6469 6d65 6e73 696f 6e73 2074 6f20 7468  dimensions to th
-00009360: 6520 656e 640a 2020 2020 2e2e 2e20 2020  e end.    ...   
-00009370: 2020 7265 7475 726e 2061 7070 6c79 5f75    return apply_u
-00009380: 6675 6e63 280a 2020 2020 2e2e 2e20 2020  func(.    ...   
-00009390: 2020 2020 2020 6e70 2e6d 6561 6e2c 206f        np.mean, o
-000093a0: 626a 2c20 696e 7075 745f 636f 7265 5f64  bj, input_core_d
-000093b0: 696d 733d 5b5b 6469 6d5d 5d2c 206b 7761  ims=[[dim]], kwa
-000093c0: 7267 733d 7b22 6178 6973 223a 202d 317d  rgs={"axis": -1}
-000093d0: 0a20 2020 202e 2e2e 2020 2020 2029 0a20  .    ...     ). 
-000093e0: 2020 202e 2e2e 0a0a 2020 2020 496e 6e65     .....    Inne
-000093f0: 7220 7072 6f64 7563 7420 6f76 6572 2061  r product over a
-00009400: 2073 7065 6369 6669 6320 6469 6d65 6e73   specific dimens
-00009410: 696f 6e20 286c 696b 6520 3a70 793a 6675  ion (like :py:fu
-00009420: 6e63 3a60 646f 7460 293a 0a0a 2020 2020  nc:`dot`):..    
-00009430: 3e3e 3e20 6465 6620 5f69 6e6e 6572 2878  >>> def _inner(x
-00009440: 2c20 7929 3a0a 2020 2020 2e2e 2e20 2020  , y):.    ...   
-00009450: 2020 7265 7375 6c74 203d 206e 702e 6d61    result = np.ma
-00009460: 746d 756c 2878 5b2e 2e2e 2c20 6e70 2e6e  tmul(x[..., np.n
-00009470: 6577 6178 6973 2c20 3a5d 2c20 795b 2e2e  ewaxis, :], y[..
-00009480: 2e2c 203a 2c20 6e70 2e6e 6577 6178 6973  ., :, np.newaxis
-00009490: 5d29 0a20 2020 202e 2e2e 2020 2020 2072  ]).    ...     r
-000094a0: 6574 7572 6e20 7265 7375 6c74 5b2e 2e2e  eturn result[...
-000094b0: 2c20 302c 2030 5d0a 2020 2020 2e2e 2e0a  , 0, 0].    ....
-000094c0: 2020 2020 3e3e 3e20 6465 6620 696e 6e65      >>> def inne
-000094d0: 725f 7072 6f64 7563 7428 612c 2062 2c20  r_product(a, b, 
-000094e0: 6469 6d29 3a0a 2020 2020 2e2e 2e20 2020  dim):.    ...   
-000094f0: 2020 7265 7475 726e 2061 7070 6c79 5f75    return apply_u
-00009500: 6675 6e63 285f 696e 6e65 722c 2061 2c20  func(_inner, a, 
-00009510: 622c 2069 6e70 7574 5f63 6f72 655f 6469  b, input_core_di
-00009520: 6d73 3d5b 5b64 696d 5d2c 205b 6469 6d5d  ms=[[dim], [dim]
-00009530: 5d29 0a20 2020 202e 2e2e 0a0a 2020 2020  ]).    .....    
-00009540: 5374 6163 6b20 6f62 6a65 6374 7320 616c  Stack objects al
-00009550: 6f6e 6720 6120 6e65 7720 6469 6d65 6e73  ong a new dimens
-00009560: 696f 6e20 286c 696b 6520 3a70 793a 6675  ion (like :py:fu
-00009570: 6e63 3a60 636f 6e63 6174 6029 3a0a 0a20  nc:`concat`):.. 
-00009580: 2020 203e 3e3e 2064 6566 2073 7461 636b     >>> def stack
-00009590: 286f 626a 6563 7473 2c20 6469 6d2c 206e  (objects, dim, n
-000095a0: 6577 5f63 6f6f 7264 293a 0a20 2020 202e  ew_coord):.    .
-000095b0: 2e2e 2020 2020 2023 206e 6f74 653a 2074  ..     # note: t
-000095c0: 6869 7320 7665 7273 696f 6e20 646f 6573  his version does
-000095d0: 206e 6f74 2073 7461 636b 2063 6f6f 7264   not stack coord
-000095e0: 696e 6174 6573 0a20 2020 202e 2e2e 2020  inates.    ...  
-000095f0: 2020 2066 756e 6320 3d20 6c61 6d62 6461     func = lambda
-00009600: 202a 783a 206e 702e 7374 6163 6b28 782c   *x: np.stack(x,
-00009610: 2061 7869 733d 2d31 290a 2020 2020 2e2e   axis=-1).    ..
-00009620: 2e20 2020 2020 7265 7375 6c74 203d 2061  .     result = a
-00009630: 7070 6c79 5f75 6675 6e63 280a 2020 2020  pply_ufunc(.    
-00009640: 2e2e 2e20 2020 2020 2020 2020 6675 6e63  ...         func
-00009650: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
-00009660: 2020 2a6f 626a 6563 7473 2c0a 2020 2020    *objects,.    
-00009670: 2e2e 2e20 2020 2020 2020 2020 6f75 7470  ...         outp
-00009680: 7574 5f63 6f72 655f 6469 6d73 3d5b 5b64  ut_core_dims=[[d
-00009690: 696d 5d5d 2c0a 2020 2020 2e2e 2e20 2020  im]],.    ...   
-000096a0: 2020 2020 2020 6a6f 696e 3d22 6f75 7465        join="oute
-000096b0: 7222 2c0a 2020 2020 2e2e 2e20 2020 2020  r",.    ...     
-000096c0: 2020 2020 6461 7461 7365 745f 6669 6c6c      dataset_fill
-000096d0: 5f76 616c 7565 3d6e 702e 6e61 6e0a 2020  _value=np.nan.  
-000096e0: 2020 2e2e 2e20 2020 2020 290a 2020 2020    ...     ).    
-000096f0: 2e2e 2e20 2020 2020 7265 7375 6c74 5b64  ...     result[d
-00009700: 696d 5d20 3d20 6e65 775f 636f 6f72 640a  im] = new_coord.
-00009710: 2020 2020 2e2e 2e20 2020 2020 7265 7475      ...     retu
-00009720: 726e 2072 6573 756c 740a 2020 2020 2e2e  rn result.    ..
-00009730: 2e0a 0a20 2020 2049 6620 796f 7572 2066  ...    If your f
-00009740: 756e 6374 696f 6e20 6973 206e 6f74 2076  unction is not v
-00009750: 6563 746f 7269 7a65 6420 6275 7420 6361  ectorized but ca
-00009760: 6e20 6265 2061 7070 6c69 6564 206f 6e6c  n be applied onl
-00009770: 7920 746f 2063 6f72 650a 2020 2020 6469  y to core.    di
-00009780: 6d65 6e73 696f 6e73 2c20 796f 7520 6361  mensions, you ca
-00009790: 6e20 7573 6520 6060 7665 6374 6f72 697a  n use ``vectoriz
-000097a0: 653d 5472 7565 6060 2074 6f20 7475 726e  e=True`` to turn
-000097b0: 2069 6e74 6f20 6120 7665 6374 6f72 697a   into a vectoriz
-000097c0: 6564 0a20 2020 2066 756e 6374 696f 6e2e  ed.    function.
-000097d0: 2054 6869 7320 7772 6170 7320 3a70 793a   This wraps :py:
-000097e0: 6675 6e63 3a60 6e75 6d70 792e 7665 6374  func:`numpy.vect
-000097f0: 6f72 697a 6560 2c20 736f 2074 6865 206f  orize`, so the o
-00009800: 7065 7261 7469 6f6e 2069 736e 2774 0a20  peration isn't. 
-00009810: 2020 2074 6572 7269 626c 7920 6661 7374     terribly fast
-00009820: 2e20 4865 7265 2077 6527 6c6c 2075 7365  . Here we'll use
-00009830: 2069 7420 746f 2063 616c 6375 6c61 7465   it to calculate
-00009840: 2074 6865 2064 6973 7461 6e63 6520 6265   the distance be
-00009850: 7477 6565 6e0a 2020 2020 656d 7069 7269  tween.    empiri
-00009860: 6361 6c20 7361 6d70 6c65 7320 6672 6f6d  cal samples from
-00009870: 2074 776f 2070 726f 6261 6269 6c69 7479   two probability
-00009880: 2064 6973 7472 6962 7574 696f 6e73 2c20   distributions, 
-00009890: 7573 696e 6720 6120 7363 6970 790a 2020  using a scipy.  
-000098a0: 2020 6675 6e63 7469 6f6e 2074 6861 7420    function that 
-000098b0: 6e65 6564 7320 746f 2062 6520 6170 706c  needs to be appl
-000098c0: 6965 6420 746f 2076 6563 746f 7273 3a0a  ied to vectors:.
-000098d0: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
-000098e0: 7363 6970 792e 7374 6174 730a 2020 2020  scipy.stats.    
-000098f0: 3e3e 3e20 6465 6620 6561 7274 685f 6d6f  >>> def earth_mo
-00009900: 7665 725f 6469 7374 616e 6365 2866 6972  ver_distance(fir
-00009910: 7374 5f73 616d 706c 6573 2c20 7365 636f  st_samples, seco
-00009920: 6e64 5f73 616d 706c 6573 2c20 6469 6d3d  nd_samples, dim=
-00009930: 2265 6e73 656d 626c 6522 293a 0a20 2020  "ensemble"):.   
-00009940: 202e 2e2e 2020 2020 2072 6574 7572 6e20   ...     return 
-00009950: 6170 706c 795f 7566 756e 6328 0a20 2020  apply_ufunc(.   
-00009960: 202e 2e2e 2020 2020 2020 2020 2073 6369   ...         sci
-00009970: 7079 2e73 7461 7473 2e77 6173 7365 7273  py.stats.wassers
-00009980: 7465 696e 5f64 6973 7461 6e63 652c 0a20  tein_distance,. 
-00009990: 2020 202e 2e2e 2020 2020 2020 2020 2066     ...         f
-000099a0: 6972 7374 5f73 616d 706c 6573 2c0a 2020  irst_samples,.  
-000099b0: 2020 2e2e 2e20 2020 2020 2020 2020 7365    ...         se
-000099c0: 636f 6e64 5f73 616d 706c 6573 2c0a 2020  cond_samples,.  
-000099d0: 2020 2e2e 2e20 2020 2020 2020 2020 696e    ...         in
-000099e0: 7075 745f 636f 7265 5f64 696d 733d 5b5b  put_core_dims=[[
-000099f0: 6469 6d5d 2c20 5b64 696d 5d5d 2c0a 2020  dim], [dim]],.  
-00009a00: 2020 2e2e 2e20 2020 2020 2020 2020 7665    ...         ve
-00009a10: 6374 6f72 697a 653d 5472 7565 2c0a 2020  ctorize=True,.  
-00009a20: 2020 2e2e 2e20 2020 2020 290a 2020 2020    ...     ).    
-00009a30: 2e2e 2e0a 0a20 2020 204d 6f73 7420 6f66  .....    Most of
-00009a40: 204e 756d 5079 2773 2062 7569 6c74 696e   NumPy's builtin
-00009a50: 2066 756e 6374 696f 6e73 2061 6c72 6561   functions alrea
-00009a60: 6479 2062 726f 6164 6361 7374 2074 6865  dy broadcast the
-00009a70: 6972 2069 6e70 7574 730a 2020 2020 6170  ir inputs.    ap
-00009a80: 7072 6f70 7269 6174 656c 7920 666f 7220  propriately for 
-00009a90: 7573 6520 696e 2060 6061 7070 6c79 5f75  use in ``apply_u
-00009aa0: 6675 6e63 6060 2e20 596f 7520 6d61 7920  func``. You may 
-00009ab0: 6669 6e64 2068 656c 7065 7220 6675 6e63  find helper func
-00009ac0: 7469 6f6e 7320 7375 6368 2061 730a 2020  tions such as.  
-00009ad0: 2020 3a70 793a 6675 6e63 3a60 6e75 6d70    :py:func:`nump
-00009ae0: 792e 6272 6f61 6463 6173 745f 6172 7261  y.broadcast_arra
-00009af0: 7973 6020 6865 6c70 6675 6c20 696e 2077  ys` helpful in w
-00009b00: 7269 7469 6e67 2079 6f75 7220 6675 6e63  riting your func
-00009b10: 7469 6f6e 2e20 6060 6170 706c 795f 7566  tion. ``apply_uf
-00009b20: 756e 6360 6020 616c 736f 0a20 2020 2077  unc`` also.    w
-00009b30: 6f72 6b73 2077 656c 6c20 7769 7468 203a  orks well with :
-00009b40: 7079 3a66 756e 633a 606e 756d 6261 2e76  py:func:`numba.v
-00009b50: 6563 746f 7269 7a65 6020 616e 6420 3a70  ectorize` and :p
-00009b60: 793a 6675 6e63 3a60 6e75 6d62 612e 6775  y:func:`numba.gu
-00009b70: 7665 6374 6f72 697a 6560 2e0a 0a20 2020  vectorize`...   
-00009b80: 2053 6565 2041 6c73 6f0a 2020 2020 2d2d   See Also.    --
-00009b90: 2d2d 2d2d 2d2d 0a20 2020 206e 756d 7079  ------.    numpy
-00009ba0: 2e62 726f 6164 6361 7374 5f61 7272 6179  .broadcast_array
-00009bb0: 730a 2020 2020 6e75 6d62 612e 7665 6374  s.    numba.vect
-00009bc0: 6f72 697a 650a 2020 2020 6e75 6d62 612e  orize.    numba.
-00009bd0: 6775 7665 6374 6f72 697a 650a 2020 2020  guvectorize.    
-00009be0: 6461 736b 2e61 7272 6179 2e61 7070 6c79  dask.array.apply
-00009bf0: 5f67 7566 756e 630a 2020 2020 7861 7272  _gufunc.    xarr
-00009c00: 6179 2e6d 6170 5f62 6c6f 636b 730a 2020  ay.map_blocks.  
-00009c10: 2020 3a72 6566 3a60 6461 736b 2e61 7574    :ref:`dask.aut
-00009c20: 6f6d 6174 6963 2d70 6172 616c 6c65 6c69  omatic-paralleli
-00009c30: 7a61 7469 6f6e 600a 2020 2020 2020 2020  zation`.        
-00009c40: 5573 6572 2067 7569 6465 2064 6573 6372  User guide descr
-00009c50: 6962 696e 6720 3a70 793a 6675 6e63 3a60  ibing :py:func:`
-00009c60: 6170 706c 795f 7566 756e 6360 2061 6e64  apply_ufunc` and
-00009c70: 203a 7079 3a66 756e 633a 606d 6170 5f62   :py:func:`map_b
-00009c80: 6c6f 636b 7360 2e0a 0a20 2020 2052 6566  locks`...    Ref
-00009c90: 6572 656e 6365 730a 2020 2020 2d2d 2d2d  erences.    ----
-00009ca0: 2d2d 2d2d 2d2d 0a20 2020 202e 2e20 5b31  ------.    .. [1
-00009cb0: 5d20 6874 7470 733a 2f2f 6e75 6d70 792e  ] https://numpy.
-00009cc0: 6f72 672f 646f 632f 7374 6162 6c65 2f72  org/doc/stable/r
-00009cd0: 6566 6572 656e 6365 2f75 6675 6e63 732e  eference/ufuncs.
-00009ce0: 6874 6d6c 0a20 2020 202e 2e20 5b32 5d20  html.    .. [2] 
-00009cf0: 6874 7470 733a 2f2f 6e75 6d70 792e 6f72  https://numpy.or
-00009d00: 672f 646f 632f 7374 6162 6c65 2f72 6566  g/doc/stable/ref
-00009d10: 6572 656e 6365 2f63 2d61 7069 2f67 656e  erence/c-api/gen
-00009d20: 6572 616c 697a 6564 2d75 6675 6e63 732e  eralized-ufuncs.
-00009d30: 6874 6d6c 0a20 2020 2022 2222 0a20 2020  html.    """.   
-00009d40: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-00009d50: 652e 6461 7461 6172 7261 7920 696d 706f  e.dataarray impo
-00009d60: 7274 2044 6174 6141 7272 6179 0a20 2020  rt DataArray.   
-00009d70: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-00009d80: 652e 6772 6f75 7062 7920 696d 706f 7274  e.groupby import
-00009d90: 2047 726f 7570 4279 0a20 2020 2066 726f   GroupBy.    fro
-00009da0: 6d20 7861 7272 6179 2e63 6f72 652e 7661  m xarray.core.va
-00009db0: 7269 6162 6c65 2069 6d70 6f72 7420 5661  riable import Va
-00009dc0: 7269 6162 6c65 0a0a 2020 2020 6966 2069  riable..    if i
-00009dd0: 6e70 7574 5f63 6f72 655f 6469 6d73 2069  nput_core_dims i
-00009de0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00009df0: 696e 7075 745f 636f 7265 5f64 696d 7320  input_core_dims 
-00009e00: 3d20 2828 292c 2920 2a20 286c 656e 2861  = ((),) * (len(a
-00009e10: 7267 7329 290a 2020 2020 656c 6966 206c  rgs)).    elif l
-00009e20: 656e 2869 6e70 7574 5f63 6f72 655f 6469  en(input_core_di
-00009e30: 6d73 2920 213d 206c 656e 2861 7267 7329  ms) != len(args)
-00009e40: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00009e50: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00009e60: 2020 2020 2020 2020 6622 696e 7075 745f          f"input_
-00009e70: 636f 7265 5f64 696d 7320 6d75 7374 2062  core_dims must b
-00009e80: 6520 4e6f 6e65 206f 7220 6120 7475 706c  e None or a tupl
-00009e90: 6520 7769 7468 2074 6865 206c 656e 6774  e with the lengt
-00009ea0: 6820 7361 6d65 2074 6f20 220a 2020 2020  h same to ".    
-00009eb0: 2020 2020 2020 2020 6622 7468 6520 6e75          f"the nu
-00009ec0: 6d62 6572 206f 6620 6172 6775 6d65 6e74  mber of argument
-00009ed0: 732e 2022 0a20 2020 2020 2020 2020 2020  s. ".           
-00009ee0: 2066 2247 6976 656e 207b 6c65 6e28 696e   f"Given {len(in
-00009ef0: 7075 745f 636f 7265 5f64 696d 7329 7d20  put_core_dims)} 
-00009f00: 696e 7075 745f 636f 7265 5f64 696d 733a  input_core_dims:
-00009f10: 207b 696e 7075 745f 636f 7265 5f64 696d   {input_core_dim
-00009f20: 737d 2c20 220a 2020 2020 2020 2020 2020  s}, ".          
-00009f30: 2020 6622 2062 7574 206e 756d 6265 7220    f" but number 
-00009f40: 6f66 2061 7267 7320 6973 207b 6c65 6e28  of args is {len(
-00009f50: 6172 6773 297d 2e22 0a20 2020 2020 2020  args)}.".       
-00009f60: 2029 0a0a 2020 2020 6966 206b 7761 7267   )..    if kwarg
-00009f70: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00009f80: 2020 206b 7761 7267 7320 3d20 7b7d 0a0a     kwargs = {}..
-00009f90: 2020 2020 7369 676e 6174 7572 6520 3d20      signature = 
-00009fa0: 5f55 4675 6e63 5369 676e 6174 7572 6528  _UFuncSignature(
-00009fb0: 696e 7075 745f 636f 7265 5f64 696d 732c  input_core_dims,
-00009fc0: 206f 7574 7075 745f 636f 7265 5f64 696d   output_core_dim
-00009fd0: 7329 0a0a 2020 2020 6966 2065 7863 6c75  s)..    if exclu
-00009fe0: 6465 5f64 696d 733a 0a20 2020 2020 2020  de_dims:.       
-00009ff0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-0000a000: 6365 2865 7863 6c75 6465 5f64 696d 732c  ce(exclude_dims,
-0000a010: 2073 6574 293a 0a20 2020 2020 2020 2020   set):.         
-0000a020: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-0000a030: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000a040: 2020 2020 6622 4578 7065 6374 6564 2065      f"Expected e
-0000a050: 7863 6c75 6465 5f64 696d 7320 746f 2062  xclude_dims to b
-0000a060: 6520 6120 2773 6574 272e 2052 6563 6569  e a 'set'. Recei
-0000a070: 7665 6420 277b 7479 7065 2865 7863 6c75  ved '{type(exclu
-0000a080: 6465 5f64 696d 7329 2e5f 5f6e 616d 655f  de_dims).__name_
-0000a090: 5f7d 2720 696e 7374 6561 642e 220a 2020  _}' instead.".  
-0000a0a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000a0b0: 2020 2020 6966 206e 6f74 2065 7863 6c75      if not exclu
-0000a0c0: 6465 5f64 696d 7320 3c3d 2073 6967 6e61  de_dims <= signa
-0000a0d0: 7475 7265 2e61 6c6c 5f63 6f72 655f 6469  ture.all_core_di
-0000a0e0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-0000a0f0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000a100: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000a110: 2020 6622 6561 6368 2064 696d 656e 7369    f"each dimensi
-0000a120: 6f6e 2069 6e20 6065 7863 6c75 6465 5f64  on in `exclude_d
-0000a130: 696d 7360 206d 7573 7420 616c 736f 2062  ims` must also b
-0000a140: 6520 6120 220a 2020 2020 2020 2020 2020  e a ".          
-0000a150: 2020 2020 2020 6622 636f 7265 2064 696d        f"core dim
-0000a160: 656e 7369 6f6e 2069 6e20 7468 6520 6675  ension in the fu
-0000a170: 6e63 7469 6f6e 2073 6967 6e61 7475 7265  nction signature
-0000a180: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-0000a190: 2020 2020 6622 506c 6561 7365 206d 616b      f"Please mak
-0000a1a0: 6520 7b28 6578 636c 7564 655f 6469 6d73  e {(exclude_dims
-0000a1b0: 202d 2073 6967 6e61 7475 7265 2e61 6c6c   - signature.all
-0000a1c0: 5f63 6f72 655f 6469 6d73 297d 2061 2063  _core_dims)} a c
-0000a1d0: 6f72 6520 6469 6d65 6e73 696f 6e22 0a20  ore dimension". 
-0000a1e0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000a1f0: 2020 2320 6861 6e64 6c65 2064 6173 6b5f    # handle dask_
-0000a200: 6775 6675 6e63 5f6b 7761 7267 730a 2020  gufunc_kwargs.  
-0000a210: 2020 6966 2064 6173 6b20 3d3d 2022 7061    if dask == "pa
-0000a220: 7261 6c6c 656c 697a 6564 223a 0a20 2020  rallelized":.   
-0000a230: 2020 2020 2069 6620 6461 736b 5f67 7566       if dask_guf
-0000a240: 756e 635f 6b77 6172 6773 2069 7320 4e6f  unc_kwargs is No
-0000a250: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000a260: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
-0000a270: 6773 203d 207b 7d0a 2020 2020 2020 2020  gs = {}.        
-0000a280: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000a290: 2020 6461 736b 5f67 7566 756e 635f 6b77    dask_gufunc_kw
-0000a2a0: 6172 6773 203d 2064 6173 6b5f 6775 6675  args = dask_gufu
-0000a2b0: 6e63 5f6b 7761 7267 732e 636f 7079 2829  nc_kwargs.copy()
-0000a2c0: 0a20 2020 2020 2020 2023 2074 6f64 6f3a  .        # todo:
-0000a2d0: 2072 656d 6f76 6520 7761 726e 696e 6773   remove warnings
-0000a2e0: 2061 6674 6572 2064 6570 7265 6361 7469   after deprecati
-0000a2f0: 6f6e 2063 7963 6c65 0a20 2020 2020 2020  on cycle.       
-0000a300: 2069 6620 6d65 7461 2069 7320 6e6f 7420   if meta is not 
-0000a310: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000a320: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-0000a330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a340: 2022 6060 6d65 7461 6060 2073 686f 756c   "``meta`` shoul
-0000a350: 6420 6265 2067 6976 656e 2069 6e20 7468  d be given in th
-0000a360: 6520 6060 6461 736b 5f67 7566 756e 635f  e ``dask_gufunc_
-0000a370: 6b77 6172 6773 6060 2070 6172 616d 6574  kwargs`` paramet
-0000a380: 6572 2e22 0a20 2020 2020 2020 2020 2020  er.".           
-0000a390: 2020 2020 2022 2049 7420 7769 6c6c 2062       " It will b
-0000a3a0: 6520 7265 6d6f 7665 6420 6173 2064 6972  e removed as dir
-0000a3b0: 6563 7420 7061 7261 6d65 7465 7220 696e  ect parameter in
-0000a3c0: 2061 2066 7574 7572 6520 7665 7273 696f   a future versio
-0000a3d0: 6e2e 222c 0a20 2020 2020 2020 2020 2020  n.",.           
-0000a3e0: 2020 2020 2046 7574 7572 6557 6172 6e69       FutureWarni
-0000a3f0: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-0000a400: 2020 2020 7374 6163 6b6c 6576 656c 3d32      stacklevel=2
-0000a410: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000a420: 2020 2020 2020 2020 2020 2020 6461 736b              dask
-0000a430: 5f67 7566 756e 635f 6b77 6172 6773 2e73  _gufunc_kwargs.s
-0000a440: 6574 6465 6661 756c 7428 226d 6574 6122  etdefault("meta"
-0000a450: 2c20 6d65 7461 290a 2020 2020 2020 2020  , meta).        
-0000a460: 6966 206f 7574 7075 745f 7369 7a65 7320  if output_sizes 
-0000a470: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000a480: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0000a490: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
-0000a4a0: 2020 2020 2020 2020 2260 606f 7574 7075          "``outpu
-0000a4b0: 745f 7369 7a65 7360 6020 7368 6f75 6c64  t_sizes`` should
-0000a4c0: 2062 6520 6769 7665 6e20 696e 2074 6865   be given in the
-0000a4d0: 2060 6064 6173 6b5f 6775 6675 6e63 5f6b   ``dask_gufunc_k
-0000a4e0: 7761 7267 7360 6020 220a 2020 2020 2020  wargs`` ".      
-0000a4f0: 2020 2020 2020 2020 2020 2270 6172 616d            "param
-0000a500: 6574 6572 2e20 4974 2077 696c 6c20 6265  eter. It will be
-0000a510: 2072 656d 6f76 6564 2061 7320 6469 7265   removed as dire
-0000a520: 6374 2070 6172 616d 6574 6572 2069 6e20  ct parameter in 
-0000a530: 6120 6675 7475 7265 2022 0a20 2020 2020  a future ".     
-0000a540: 2020 2020 2020 2020 2020 2022 7665 7273             "vers
-0000a550: 696f 6e2e 222c 0a20 2020 2020 2020 2020  ion.",.         
-0000a560: 2020 2020 2020 2046 7574 7572 6557 6172         FutureWar
-0000a570: 6e69 6e67 2c0a 2020 2020 2020 2020 2020  ning,.          
-0000a580: 2020 2020 2020 7374 6163 6b6c 6576 656c        stacklevel
-0000a590: 3d32 2c0a 2020 2020 2020 2020 2020 2020  =2,.            
-0000a5a0: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-0000a5b0: 736b 5f67 7566 756e 635f 6b77 6172 6773  sk_gufunc_kwargs
-0000a5c0: 2e73 6574 6465 6661 756c 7428 226f 7574  .setdefault("out
-0000a5d0: 7075 745f 7369 7a65 7322 2c20 6f75 7470  put_sizes", outp
-0000a5e0: 7574 5f73 697a 6573 290a 0a20 2020 2069  ut_sizes)..    i
-0000a5f0: 6620 6b77 6172 6773 3a0a 2020 2020 2020  f kwargs:.      
-0000a600: 2020 6675 6e63 203d 2066 756e 6374 6f6f    func = functoo
-0000a610: 6c73 2e70 6172 7469 616c 2866 756e 632c  ls.partial(func,
-0000a620: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-0000a630: 6966 206b 6565 705f 6174 7472 7320 6973  if keep_attrs is
-0000a640: 204e 6f6e 653a 0a20 2020 2020 2020 206b   None:.        k
-0000a650: 6565 705f 6174 7472 7320 3d20 5f67 6574  eep_attrs = _get
-0000a660: 5f6b 6565 705f 6174 7472 7328 6465 6661  _keep_attrs(defa
-0000a670: 756c 743d 4661 6c73 6529 0a0a 2020 2020  ult=False)..    
-0000a680: 6966 2069 7369 6e73 7461 6e63 6528 6b65  if isinstance(ke
-0000a690: 6570 5f61 7474 7273 2c20 626f 6f6c 293a  ep_attrs, bool):
-0000a6a0: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
-0000a6b0: 7472 7320 3d20 226f 7665 7272 6964 6522  trs = "override"
-0000a6c0: 2069 6620 6b65 6570 5f61 7474 7273 2065   if keep_attrs e
-0000a6d0: 6c73 6520 2264 726f 7022 0a0a 2020 2020  lse "drop"..    
-0000a6e0: 7661 7269 6162 6c65 735f 7666 756e 6320  variables_vfunc 
-0000a6f0: 3d20 6675 6e63 746f 6f6c 732e 7061 7274  = functools.part
-0000a700: 6961 6c28 0a20 2020 2020 2020 2061 7070  ial(.        app
-0000a710: 6c79 5f76 6172 6961 626c 655f 7566 756e  ly_variable_ufun
-0000a720: 632c 0a20 2020 2020 2020 2066 756e 632c  c,.        func,
-0000a730: 0a20 2020 2020 2020 2073 6967 6e61 7475  .        signatu
-0000a740: 7265 3d73 6967 6e61 7475 7265 2c0a 2020  re=signature,.  
-0000a750: 2020 2020 2020 6578 636c 7564 655f 6469        exclude_di
-0000a760: 6d73 3d65 7863 6c75 6465 5f64 696d 732c  ms=exclude_dims,
-0000a770: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
-0000a780: 7472 733d 6b65 6570 5f61 7474 7273 2c0a  trs=keep_attrs,.
-0000a790: 2020 2020 2020 2020 6461 736b 3d64 6173          dask=das
-0000a7a0: 6b2c 0a20 2020 2020 2020 2076 6563 746f  k,.        vecto
-0000a7b0: 7269 7a65 3d76 6563 746f 7269 7a65 2c0a  rize=vectorize,.
-0000a7c0: 2020 2020 2020 2020 6f75 7470 7574 5f64          output_d
-0000a7d0: 7479 7065 733d 6f75 7470 7574 5f64 7479  types=output_dty
-0000a7e0: 7065 732c 0a20 2020 2020 2020 2064 6173  pes,.        das
-0000a7f0: 6b5f 6775 6675 6e63 5f6b 7761 7267 733d  k_gufunc_kwargs=
-0000a800: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
-0000a810: 6773 2c0a 2020 2020 290a 0a20 2020 2023  gs,.    )..    #
-0000a820: 2066 6565 6420 6772 6f75 7062 792d 6170   feed groupby-ap
-0000a830: 706c 795f 7566 756e 6320 7468 726f 7567  ply_ufunc throug
-0000a840: 6820 6170 706c 795f 6772 6f75 7062 795f  h apply_groupby_
-0000a850: 6675 6e63 0a20 2020 2069 6620 616e 7928  func.    if any(
-0000a860: 6973 696e 7374 616e 6365 2861 2c20 4772  isinstance(a, Gr
-0000a870: 6f75 7042 7929 2066 6f72 2061 2069 6e20  oupBy) for a in 
-0000a880: 6172 6773 293a 0a20 2020 2020 2020 2074  args):.        t
-0000a890: 6869 735f 6170 706c 7920 3d20 6675 6e63  his_apply = func
-0000a8a0: 746f 6f6c 732e 7061 7274 6961 6c28 0a20  tools.partial(. 
-0000a8b0: 2020 2020 2020 2020 2020 2061 7070 6c79             apply
-0000a8c0: 5f75 6675 6e63 2c0a 2020 2020 2020 2020  _ufunc,.        
-0000a8d0: 2020 2020 6675 6e63 2c0a 2020 2020 2020      func,.      
-0000a8e0: 2020 2020 2020 696e 7075 745f 636f 7265        input_core
-0000a8f0: 5f64 696d 733d 696e 7075 745f 636f 7265  _dims=input_core
-0000a900: 5f64 696d 732c 0a20 2020 2020 2020 2020  _dims,.         
-0000a910: 2020 206f 7574 7075 745f 636f 7265 5f64     output_core_d
-0000a920: 696d 733d 6f75 7470 7574 5f63 6f72 655f  ims=output_core_
-0000a930: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
-0000a940: 2020 6578 636c 7564 655f 6469 6d73 3d65    exclude_dims=e
-0000a950: 7863 6c75 6465 5f64 696d 732c 0a20 2020  xclude_dims,.   
-0000a960: 2020 2020 2020 2020 206a 6f69 6e3d 6a6f           join=jo
-0000a970: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-0000a980: 6461 7461 7365 745f 6a6f 696e 3d64 6174  dataset_join=dat
-0000a990: 6173 6574 5f6a 6f69 6e2c 0a20 2020 2020  aset_join,.     
-0000a9a0: 2020 2020 2020 2064 6174 6173 6574 5f66         dataset_f
-0000a9b0: 696c 6c5f 7661 6c75 653d 6461 7461 7365  ill_value=datase
-0000a9c0: 745f 6669 6c6c 5f76 616c 7565 2c0a 2020  t_fill_value,.  
-0000a9d0: 2020 2020 2020 2020 2020 6b65 6570 5f61            keep_a
-0000a9e0: 7474 7273 3d6b 6565 705f 6174 7472 732c  ttrs=keep_attrs,
-0000a9f0: 0a20 2020 2020 2020 2020 2020 2064 6173  .            das
-0000aa00: 6b3d 6461 736b 2c0a 2020 2020 2020 2020  k=dask,.        
-0000aa10: 2020 2020 7665 6374 6f72 697a 653d 7665      vectorize=ve
-0000aa20: 6374 6f72 697a 652c 0a20 2020 2020 2020  ctorize,.       
-0000aa30: 2020 2020 206f 7574 7075 745f 6474 7970       output_dtyp
-0000aa40: 6573 3d6f 7574 7075 745f 6474 7970 6573  es=output_dtypes
-0000aa50: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-0000aa60: 736b 5f67 7566 756e 635f 6b77 6172 6773  sk_gufunc_kwargs
-0000aa70: 3d64 6173 6b5f 6775 6675 6e63 5f6b 7761  =dask_gufunc_kwa
-0000aa80: 7267 732c 0a20 2020 2020 2020 2029 0a20  rgs,.        ). 
-0000aa90: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
-0000aaa0: 706c 795f 6772 6f75 7062 795f 6675 6e63  ply_groupby_func
-0000aab0: 2874 6869 735f 6170 706c 792c 202a 6172  (this_apply, *ar
-0000aac0: 6773 290a 2020 2020 2320 6665 6564 2064  gs).    # feed d
-0000aad0: 6174 6173 6574 7320 6170 706c 795f 7661  atasets apply_va
-0000aae0: 7269 6162 6c65 5f75 6675 6e63 2074 6872  riable_ufunc thr
-0000aaf0: 6f75 6768 2061 7070 6c79 5f64 6174 6173  ough apply_datas
-0000ab00: 6574 5f76 6675 6e63 0a20 2020 2065 6c69  et_vfunc.    eli
-0000ab10: 6620 616e 7928 6973 5f64 6963 745f 6c69  f any(is_dict_li
-0000ab20: 6b65 2861 2920 666f 7220 6120 696e 2061  ke(a) for a in a
-0000ab30: 7267 7329 3a0a 2020 2020 2020 2020 7265  rgs):.        re
-0000ab40: 7475 726e 2061 7070 6c79 5f64 6174 6173  turn apply_datas
-0000ab50: 6574 5f76 6675 6e63 280a 2020 2020 2020  et_vfunc(.      
-0000ab60: 2020 2020 2020 7661 7269 6162 6c65 735f        variables_
-0000ab70: 7666 756e 632c 0a20 2020 2020 2020 2020  vfunc,.         
-0000ab80: 2020 202a 6172 6773 2c0a 2020 2020 2020     *args,.      
-0000ab90: 2020 2020 2020 7369 676e 6174 7572 653d        signature=
-0000aba0: 7369 676e 6174 7572 652c 0a20 2020 2020  signature,.     
-0000abb0: 2020 2020 2020 206a 6f69 6e3d 6a6f 696e         join=join
-0000abc0: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
-0000abd0: 636c 7564 655f 6469 6d73 3d65 7863 6c75  clude_dims=exclu
-0000abe0: 6465 5f64 696d 732c 0a20 2020 2020 2020  de_dims,.       
-0000abf0: 2020 2020 2064 6174 6173 6574 5f6a 6f69       dataset_joi
-0000ac00: 6e3d 6461 7461 7365 745f 6a6f 696e 2c0a  n=dataset_join,.
-0000ac10: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0000ac20: 5f76 616c 7565 3d64 6174 6173 6574 5f66  _value=dataset_f
-0000ac30: 696c 6c5f 7661 6c75 652c 0a20 2020 2020  ill_value,.     
-0000ac40: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
-0000ac50: 733d 6b65 6570 5f61 7474 7273 2c0a 2020  s=keep_attrs,.  
-0000ac60: 2020 2020 2020 290a 2020 2020 2320 6665        ).    # fe
-0000ac70: 6564 2044 6174 6141 7272 6179 2061 7070  ed DataArray app
-0000ac80: 6c79 5f76 6172 6961 626c 655f 7566 756e  ly_variable_ufun
-0000ac90: 6320 7468 726f 7567 6820 6170 706c 795f  c through apply_
-0000aca0: 6461 7461 6172 7261 795f 7666 756e 630a  dataarray_vfunc.
-0000acb0: 2020 2020 656c 6966 2061 6e79 2869 7369      elif any(isi
-0000acc0: 6e73 7461 6e63 6528 612c 2044 6174 6141  nstance(a, DataA
-0000acd0: 7272 6179 2920 666f 7220 6120 696e 2061  rray) for a in a
-0000ace0: 7267 7329 3a0a 2020 2020 2020 2020 7265  rgs):.        re
-0000acf0: 7475 726e 2061 7070 6c79 5f64 6174 6161  turn apply_dataa
-0000ad00: 7272 6179 5f76 6675 6e63 280a 2020 2020  rray_vfunc(.    
-0000ad10: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0000ad20: 735f 7666 756e 632c 0a20 2020 2020 2020  s_vfunc,.       
-0000ad30: 2020 2020 202a 6172 6773 2c0a 2020 2020       *args,.    
-0000ad40: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
-0000ad50: 653d 7369 676e 6174 7572 652c 0a20 2020  e=signature,.   
-0000ad60: 2020 2020 2020 2020 206a 6f69 6e3d 6a6f           join=jo
-0000ad70: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-0000ad80: 6578 636c 7564 655f 6469 6d73 3d65 7863  exclude_dims=exc
-0000ad90: 6c75 6465 5f64 696d 732c 0a20 2020 2020  lude_dims,.     
-0000ada0: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
-0000adb0: 733d 6b65 6570 5f61 7474 7273 2c0a 2020  s=keep_attrs,.  
-0000adc0: 2020 2020 2020 290a 2020 2020 2320 6665        ).    # fe
-0000add0: 6564 2056 6172 6961 626c 6573 2064 6972  ed Variables dir
-0000ade0: 6563 746c 7920 7468 726f 7567 6820 6170  ectly through ap
-0000adf0: 706c 795f 7661 7269 6162 6c65 5f75 6675  ply_variable_ufu
-0000ae00: 6e63 0a20 2020 2065 6c69 6620 616e 7928  nc.    elif any(
-0000ae10: 6973 696e 7374 616e 6365 2861 2c20 5661  isinstance(a, Va
-0000ae20: 7269 6162 6c65 2920 666f 7220 6120 696e  riable) for a in
-0000ae30: 2061 7267 7329 3a0a 2020 2020 2020 2020   args):.        
-0000ae40: 7265 7475 726e 2076 6172 6961 626c 6573  return variables
-0000ae50: 5f76 6675 6e63 282a 6172 6773 290a 2020  _vfunc(*args).  
-0000ae60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000ae70: 2320 6665 6564 2061 6e79 7468 696e 6720  # feed anything 
-0000ae80: 656c 7365 2074 6872 6f75 6768 2061 7070  else through app
-0000ae90: 6c79 5f61 7272 6179 5f75 6675 6e63 0a20  ly_array_ufunc. 
-0000aea0: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
-0000aeb0: 706c 795f 6172 7261 795f 7566 756e 6328  ply_array_ufunc(
-0000aec0: 6675 6e63 2c20 2a61 7267 732c 2064 6173  func, *args, das
-0000aed0: 6b3d 6461 736b 290a 0a0a 6465 6620 636f  k=dask)...def co
-0000aee0: 7628 0a20 2020 2064 615f 613a 2054 5f44  v(.    da_a: T_D
-0000aef0: 6174 6141 7272 6179 2c20 6461 5f62 3a20  ataArray, da_b: 
-0000af00: 545f 4461 7461 4172 7261 792c 2064 696d  T_DataArray, dim
-0000af10: 3a20 4469 6d73 203d 204e 6f6e 652c 2064  : Dims = None, d
-0000af20: 646f 663a 2069 6e74 203d 2031 0a29 202d  dof: int = 1.) -
-0000af30: 3e20 545f 4461 7461 4172 7261 793a 0a20  > T_DataArray:. 
-0000af40: 2020 2022 2222 0a20 2020 2043 6f6d 7075     """.    Compu
-0000af50: 7465 2063 6f76 6172 6961 6e63 6520 6265  te covariance be
-0000af60: 7477 6565 6e20 7477 6f20 4461 7461 4172  tween two DataAr
-0000af70: 7261 7920 6f62 6a65 6374 7320 616c 6f6e  ray objects alon
-0000af80: 6720 6120 7368 6172 6564 2064 696d 656e  g a shared dimen
-0000af90: 7369 6f6e 2e0a 0a20 2020 2050 6172 616d  sion...    Param
-0000afa0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-0000afb0: 2d2d 2d2d 0a20 2020 2064 615f 6120 3a20  ----.    da_a : 
-0000afc0: 4461 7461 4172 7261 790a 2020 2020 2020  DataArray.      
-0000afd0: 2020 4172 7261 7920 746f 2063 6f6d 7075    Array to compu
-0000afe0: 7465 2e0a 2020 2020 6461 5f62 203a 2044  te..    da_b : D
-0000aff0: 6174 6141 7272 6179 0a20 2020 2020 2020  ataArray.       
-0000b000: 2041 7272 6179 2074 6f20 636f 6d70 7574   Array to comput
-0000b010: 652e 0a20 2020 2064 696d 203a 2073 7472  e..    dim : str
-0000b020: 2c20 6974 6572 6162 6c65 206f 6620 6861  , iterable of ha
-0000b030: 7368 6162 6c65 2c20 222e 2e2e 2220 6f72  shable, "..." or
-0000b040: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
-0000b050: 2020 2020 2020 2020 5468 6520 6469 6d65          The dime
-0000b060: 6e73 696f 6e20 616c 6f6e 6720 7768 6963  nsion along whic
-0000b070: 6820 7468 6520 636f 7661 7269 616e 6365  h the covariance
-0000b080: 2077 696c 6c20 6265 2063 6f6d 7075 7465   will be compute
-0000b090: 640a 2020 2020 6464 6f66 203a 2069 6e74  d.    ddof : int
-0000b0a0: 2c20 6465 6661 756c 743a 2031 0a20 2020  , default: 1.   
-0000b0b0: 2020 2020 2049 6620 6464 6f66 3d31 2c20       If ddof=1, 
-0000b0c0: 636f 7661 7269 616e 6365 2069 7320 6e6f  covariance is no
-0000b0d0: 726d 616c 697a 6564 2062 7920 4e2d 312c  rmalized by N-1,
-0000b0e0: 2067 6976 696e 6720 616e 2075 6e62 6961   giving an unbia
-0000b0f0: 7365 6420 6573 7469 6d61 7465 2c0a 2020  sed estimate,.  
-0000b100: 2020 2020 2020 656c 7365 206e 6f72 6d61        else norma
-0000b110: 6c69 7a61 7469 6f6e 2069 7320 6279 204e  lization is by N
-0000b120: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
-0000b130: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2063     -------.    c
-0000b140: 6f76 6172 6961 6e63 6520 3a20 4461 7461  ovariance : Data
-0000b150: 4172 7261 790a 0a20 2020 2053 6565 2041  Array..    See A
-0000b160: 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d  lso.    --------
-0000b170: 0a20 2020 2070 616e 6461 732e 5365 7269  .    pandas.Seri
-0000b180: 6573 2e63 6f76 203a 2063 6f72 7265 7370  es.cov : corresp
-0000b190: 6f6e 6469 6e67 2070 616e 6461 7320 6675  onding pandas fu
-0000b1a0: 6e63 7469 6f6e 0a20 2020 2078 6172 7261  nction.    xarra
-0000b1b0: 792e 636f 7272 203a 2072 6573 7065 6374  y.corr : respect
-0000b1c0: 6976 6520 6675 6e63 7469 6f6e 2074 6f20  ive function to 
-0000b1d0: 6361 6c63 756c 6174 6520 636f 7272 656c  calculate correl
-0000b1e0: 6174 696f 6e0a 0a20 2020 2045 7861 6d70  ation..    Examp
-0000b1f0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-0000b200: 0a20 2020 203e 3e3e 2066 726f 6d20 7861  .    >>> from xa
-0000b210: 7272 6179 2069 6d70 6f72 7420 4461 7461  rray import Data
-0000b220: 4172 7261 790a 2020 2020 3e3e 3e20 6461  Array.    >>> da
-0000b230: 5f61 203d 2044 6174 6141 7272 6179 280a  _a = DataArray(.
-0000b240: 2020 2020 2e2e 2e20 2020 2020 6e70 2e61      ...     np.a
-0000b250: 7272 6179 285b 5b31 2c20 322c 2033 5d2c  rray([[1, 2, 3],
-0000b260: 205b 302e 312c 2030 2e32 2c20 302e 335d   [0.1, 0.2, 0.3]
-0000b270: 2c20 5b33 2e32 2c20 302e 362c 2031 2e38  , [3.2, 0.6, 1.8
-0000b280: 5d5d 292c 0a20 2020 202e 2e2e 2020 2020  ]]),.    ...    
-0000b290: 2064 696d 733d 2822 7370 6163 6522 2c20   dims=("space", 
-0000b2a0: 2274 696d 6522 292c 0a20 2020 202e 2e2e  "time"),.    ...
-0000b2b0: 2020 2020 2063 6f6f 7264 733d 5b0a 2020       coords=[.  
-0000b2c0: 2020 2e2e 2e20 2020 2020 2020 2020 2822    ...         ("
-0000b2d0: 7370 6163 6522 2c20 5b22 4941 222c 2022  space", ["IA", "
-0000b2e0: 494c 222c 2022 494e 225d 292c 0a20 2020  IL", "IN"]),.   
-0000b2f0: 202e 2e2e 2020 2020 2020 2020 2028 2274   ...         ("t
-0000b300: 696d 6522 2c20 7064 2e64 6174 655f 7261  ime", pd.date_ra
-0000b310: 6e67 6528 2232 3030 302d 3031 2d30 3122  nge("2000-01-01"
-0000b320: 2c20 6672 6571 3d22 3144 222c 2070 6572  , freq="1D", per
-0000b330: 696f 6473 3d33 2929 2c0a 2020 2020 2e2e  iods=3)),.    ..
-0000b340: 2e20 2020 2020 5d2c 0a20 2020 202e 2e2e  .     ],.    ...
-0000b350: 2029 0a20 2020 203e 3e3e 2064 615f 610a   ).    >>> da_a.
-0000b360: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-0000b370: 4172 7261 7920 2873 7061 6365 3a20 332c  Array (space: 3,
-0000b380: 2074 696d 653a 2033 293e 0a20 2020 2061   time: 3)>.    a
-0000b390: 7272 6179 285b 5b31 2e20 2c20 322e 202c  rray([[1. , 2. ,
-0000b3a0: 2033 2e20 5d2c 0a20 2020 2020 2020 2020   3. ],.         
-0000b3b0: 2020 5b30 2e31 2c20 302e 322c 2030 2e33    [0.1, 0.2, 0.3
-0000b3c0: 5d2c 0a20 2020 2020 2020 2020 2020 5b33  ],.           [3
-0000b3d0: 2e32 2c20 302e 362c 2031 2e38 5d5d 290a  .2, 0.6, 1.8]]).
-0000b3e0: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-0000b3f0: 0a20 2020 2020 202a 2073 7061 6365 2020  .      * space  
-0000b400: 2020 2873 7061 6365 2920 3c55 3220 2749    (space) <U2 'I
-0000b410: 4127 2027 494c 2720 2749 4e27 0a20 2020  A' 'IL' 'IN'.   
-0000b420: 2020 202a 2074 696d 6520 2020 2020 2874     * time     (t
-0000b430: 696d 6529 2064 6174 6574 696d 6536 345b  ime) datetime64[
-0000b440: 6e73 5d20 3230 3030 2d30 312d 3031 2032  ns] 2000-01-01 2
-0000b450: 3030 302d 3031 2d30 3220 3230 3030 2d30  000-01-02 2000-0
-0000b460: 312d 3033 0a20 2020 203e 3e3e 2064 615f  1-03.    >>> da_
-0000b470: 6220 3d20 4461 7461 4172 7261 7928 0a20  b = DataArray(. 
-0000b480: 2020 202e 2e2e 2020 2020 206e 702e 6172     ...     np.ar
-0000b490: 7261 7928 5b5b 302e 322c 2030 2e34 2c20  ray([[0.2, 0.4, 
-0000b4a0: 302e 365d 2c20 5b31 352c 2031 302c 2035  0.6], [15, 10, 5
-0000b4b0: 5d2c 205b 332e 322c 2030 2e36 2c20 312e  ], [3.2, 0.6, 1.
-0000b4c0: 385d 5d29 2c0a 2020 2020 2e2e 2e20 2020  8]]),.    ...   
-0000b4d0: 2020 6469 6d73 3d28 2273 7061 6365 222c    dims=("space",
-0000b4e0: 2022 7469 6d65 2229 2c0a 2020 2020 2e2e   "time"),.    ..
-0000b4f0: 2e20 2020 2020 636f 6f72 6473 3d5b 0a20  .     coords=[. 
-0000b500: 2020 202e 2e2e 2020 2020 2020 2020 2028     ...         (
-0000b510: 2273 7061 6365 222c 205b 2249 4122 2c20  "space", ["IA", 
-0000b520: 2249 4c22 2c20 2249 4e22 5d29 2c0a 2020  "IL", "IN"]),.  
-0000b530: 2020 2e2e 2e20 2020 2020 2020 2020 2822    ...         ("
-0000b540: 7469 6d65 222c 2070 642e 6461 7465 5f72  time", pd.date_r
-0000b550: 616e 6765 2822 3230 3030 2d30 312d 3031  ange("2000-01-01
-0000b560: 222c 2066 7265 713d 2231 4422 2c20 7065  ", freq="1D", pe
-0000b570: 7269 6f64 733d 3329 292c 0a20 2020 202e  riods=3)),.    .
-0000b580: 2e2e 2020 2020 205d 2c0a 2020 2020 2e2e  ..     ],.    ..
-0000b590: 2e20 290a 2020 2020 3e3e 3e20 6461 5f62  . ).    >>> da_b
-0000b5a0: 0a20 2020 203c 7861 7272 6179 2e44 6174  .    <xarray.Dat
-0000b5b0: 6141 7272 6179 2028 7370 6163 653a 2033  aArray (space: 3
-0000b5c0: 2c20 7469 6d65 3a20 3329 3e0a 2020 2020  , time: 3)>.    
-0000b5d0: 6172 7261 7928 5b5b 2030 2e32 2c20 2030  array([[ 0.2,  0
-0000b5e0: 2e34 2c20 2030 2e36 5d2c 0a20 2020 2020  .4,  0.6],.     
-0000b5f0: 2020 2020 2020 5b31 352e 202c 2031 302e        [15. , 10.
-0000b600: 202c 2020 352e 205d 2c0a 2020 2020 2020   ,  5. ],.      
-0000b610: 2020 2020 205b 2033 2e32 2c20 2030 2e36       [ 3.2,  0.6
-0000b620: 2c20 2031 2e38 5d5d 290a 2020 2020 436f  ,  1.8]]).    Co
-0000b630: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-0000b640: 202a 2073 7061 6365 2020 2020 2873 7061   * space    (spa
-0000b650: 6365 2920 3c55 3220 2749 4127 2027 494c  ce) <U2 'IA' 'IL
-0000b660: 2720 2749 4e27 0a20 2020 2020 202a 2074  ' 'IN'.      * t
-0000b670: 696d 6520 2020 2020 2874 696d 6529 2064  ime     (time) d
-0000b680: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
-0000b690: 3030 2d30 312d 3031 2032 3030 302d 3031  00-01-01 2000-01
-0000b6a0: 2d30 3220 3230 3030 2d30 312d 3033 0a20  -02 2000-01-03. 
-0000b6b0: 2020 203e 3e3e 2078 722e 636f 7628 6461     >>> xr.cov(da
-0000b6c0: 5f61 2c20 6461 5f62 290a 2020 2020 3c78  _a, da_b).    <x
-0000b6d0: 6172 7261 792e 4461 7461 4172 7261 7920  array.DataArray 
-0000b6e0: 2829 3e0a 2020 2020 6172 7261 7928 2d33  ()>.    array(-3
-0000b6f0: 2e35 3330 3535 3535 3629 0a20 2020 203e  .53055556).    >
-0000b700: 3e3e 2078 722e 636f 7628 6461 5f61 2c20  >> xr.cov(da_a, 
-0000b710: 6461 5f62 2c20 6469 6d3d 2274 696d 6522  da_b, dim="time"
-0000b720: 290a 2020 2020 3c78 6172 7261 792e 4461  ).    <xarray.Da
-0000b730: 7461 4172 7261 7920 2873 7061 6365 3a20  taArray (space: 
-0000b740: 3329 3e0a 2020 2020 6172 7261 7928 5b20  3)>.    array([ 
-0000b750: 302e 3220 2020 2020 2020 2c20 2d30 2e35  0.2       , -0.5
-0000b760: 2020 2020 2020 202c 2020 312e 3639 3333         ,  1.6933
-0000b770: 3333 3333 5d29 0a20 2020 2043 6f6f 7264  3333]).    Coord
-0000b780: 696e 6174 6573 3a0a 2020 2020 2020 2a20  inates:.      * 
-0000b790: 7370 6163 6520 2020 2028 7370 6163 6529  space    (space)
-0000b7a0: 203c 5532 2027 4941 2720 2749 4c27 2027   <U2 'IA' 'IL' '
-0000b7b0: 494e 270a 2020 2020 2222 220a 2020 2020  IN'.    """.    
-0000b7c0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-0000b7d0: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
-0000b7e0: 7420 4461 7461 4172 7261 790a 0a20 2020  t DataArray..   
-0000b7f0: 2069 6620 616e 7928 6e6f 7420 6973 696e   if any(not isin
-0000b800: 7374 616e 6365 2861 7272 2c20 4461 7461  stance(arr, Data
-0000b810: 4172 7261 7929 2066 6f72 2061 7272 2069  Array) for arr i
-0000b820: 6e20 5b64 615f 612c 2064 615f 625d 293a  n [da_a, da_b]):
-0000b830: 0a20 2020 2020 2020 2072 6169 7365 2054  .        raise T
-0000b840: 7970 6545 7272 6f72 280a 2020 2020 2020  ypeError(.      
-0000b850: 2020 2020 2020 224f 6e6c 7920 7872 2e44        "Only xr.D
-0000b860: 6174 6141 7272 6179 2069 7320 7375 7070  ataArray is supp
-0000b870: 6f72 7465 642e 220a 2020 2020 2020 2020  orted.".        
-0000b880: 2020 2020 2247 6976 656e 207b 7d2e 222e      "Given {}.".
-0000b890: 666f 726d 6174 285b 7479 7065 2861 7272  format([type(arr
-0000b8a0: 2920 666f 7220 6172 7220 696e 205b 6461  ) for arr in [da
-0000b8b0: 5f61 2c20 6461 5f62 5d5d 290a 2020 2020  _a, da_b]]).    
-0000b8c0: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
-0000b8d0: 6e20 5f63 6f76 5f63 6f72 7228 6461 5f61  n _cov_corr(da_a
-0000b8e0: 2c20 6461 5f62 2c20 6469 6d3d 6469 6d2c  , da_b, dim=dim,
-0000b8f0: 2064 646f 663d 6464 6f66 2c20 6d65 7468   ddof=ddof, meth
-0000b900: 6f64 3d22 636f 7622 290a 0a0a 6465 6620  od="cov")...def 
-0000b910: 636f 7272 2864 615f 613a 2054 5f44 6174  corr(da_a: T_Dat
-0000b920: 6141 7272 6179 2c20 6461 5f62 3a20 545f  aArray, da_b: T_
-0000b930: 4461 7461 4172 7261 792c 2064 696d 3a20  DataArray, dim: 
-0000b940: 4469 6d73 203d 204e 6f6e 6529 202d 3e20  Dims = None) -> 
-0000b950: 545f 4461 7461 4172 7261 793a 0a20 2020  T_DataArray:.   
-0000b960: 2022 2222 0a20 2020 2043 6f6d 7075 7465   """.    Compute
-0000b970: 2074 6865 2050 6561 7273 6f6e 2063 6f72   the Pearson cor
-0000b980: 7265 6c61 7469 6f6e 2063 6f65 6666 6963  relation coeffic
-0000b990: 6965 6e74 2062 6574 7765 656e 0a20 2020  ient between.   
-0000b9a0: 2074 776f 2044 6174 6141 7272 6179 206f   two DataArray o
-0000b9b0: 626a 6563 7473 2061 6c6f 6e67 2061 2073  bjects along a s
-0000b9c0: 6861 7265 6420 6469 6d65 6e73 696f 6e2e  hared dimension.
-0000b9d0: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-0000b9e0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-0000b9f0: 2020 2020 6461 5f61 203a 2044 6174 6141      da_a : DataA
-0000ba00: 7272 6179 0a20 2020 2020 2020 2041 7272  rray.        Arr
-0000ba10: 6179 2074 6f20 636f 6d70 7574 652e 0a20  ay to compute.. 
-0000ba20: 2020 2064 615f 6220 3a20 4461 7461 4172     da_b : DataAr
-0000ba30: 7261 790a 2020 2020 2020 2020 4172 7261  ray.        Arra
-0000ba40: 7920 746f 2063 6f6d 7075 7465 2e0a 2020  y to compute..  
-0000ba50: 2020 6469 6d20 3a20 7374 722c 2069 7465    dim : str, ite
-0000ba60: 7261 626c 6520 6f66 2068 6173 6861 626c  rable of hashabl
-0000ba70: 652c 2022 2e2e 2e22 206f 7220 4e6f 6e65  e, "..." or None
-0000ba80: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0000ba90: 2020 2054 6865 2064 696d 656e 7369 6f6e     The dimension
-0000baa0: 2061 6c6f 6e67 2077 6869 6368 2074 6865   along which the
-0000bab0: 2063 6f72 7265 6c61 7469 6f6e 2077 696c   correlation wil
-0000bac0: 6c20 6265 2063 6f6d 7075 7465 640a 0a20  l be computed.. 
-0000bad0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-0000bae0: 2d2d 2d2d 2d2d 0a20 2020 2063 6f72 7265  ------.    corre
-0000baf0: 6c61 7469 6f6e 3a20 4461 7461 4172 7261  lation: DataArra
-0000bb00: 790a 0a20 2020 2053 6565 2041 6c73 6f0a  y..    See Also.
-0000bb10: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0000bb20: 2070 616e 6461 732e 5365 7269 6573 2e63   pandas.Series.c
-0000bb30: 6f72 7220 3a20 636f 7272 6573 706f 6e64  orr : correspond
-0000bb40: 696e 6720 7061 6e64 6173 2066 756e 6374  ing pandas funct
-0000bb50: 696f 6e0a 2020 2020 7861 7272 6179 2e63  ion.    xarray.c
-0000bb60: 6f76 203a 2075 6e64 6572 6c79 696e 6720  ov : underlying 
-0000bb70: 636f 7661 7269 616e 6365 2066 756e 6374  covariance funct
-0000bb80: 696f 6e0a 0a20 2020 2045 7861 6d70 6c65  ion..    Example
-0000bb90: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  s.    --------. 
-0000bba0: 2020 203e 3e3e 2066 726f 6d20 7861 7272     >>> from xarr
-0000bbb0: 6179 2069 6d70 6f72 7420 4461 7461 4172  ay import DataAr
-0000bbc0: 7261 790a 2020 2020 3e3e 3e20 6461 5f61  ray.    >>> da_a
-0000bbd0: 203d 2044 6174 6141 7272 6179 280a 2020   = DataArray(.  
-0000bbe0: 2020 2e2e 2e20 2020 2020 6e70 2e61 7272    ...     np.arr
-0000bbf0: 6179 285b 5b31 2c20 322c 2033 5d2c 205b  ay([[1, 2, 3], [
-0000bc00: 302e 312c 2030 2e32 2c20 302e 335d 2c20  0.1, 0.2, 0.3], 
-0000bc10: 5b33 2e32 2c20 302e 362c 2031 2e38 5d5d  [3.2, 0.6, 1.8]]
-0000bc20: 292c 0a20 2020 202e 2e2e 2020 2020 2064  ),.    ...     d
-0000bc30: 696d 733d 2822 7370 6163 6522 2c20 2274  ims=("space", "t
-0000bc40: 696d 6522 292c 0a20 2020 202e 2e2e 2020  ime"),.    ...  
-0000bc50: 2020 2063 6f6f 7264 733d 5b0a 2020 2020     coords=[.    
-0000bc60: 2e2e 2e20 2020 2020 2020 2020 2822 7370  ...         ("sp
-0000bc70: 6163 6522 2c20 5b22 4941 222c 2022 494c  ace", ["IA", "IL
-0000bc80: 222c 2022 494e 225d 292c 0a20 2020 202e  ", "IN"]),.    .
-0000bc90: 2e2e 2020 2020 2020 2020 2028 2274 696d  ..         ("tim
-0000bca0: 6522 2c20 7064 2e64 6174 655f 7261 6e67  e", pd.date_rang
-0000bcb0: 6528 2232 3030 302d 3031 2d30 3122 2c20  e("2000-01-01", 
-0000bcc0: 6672 6571 3d22 3144 222c 2070 6572 696f  freq="1D", perio
-0000bcd0: 6473 3d33 2929 2c0a 2020 2020 2e2e 2e20  ds=3)),.    ... 
-0000bce0: 2020 2020 5d2c 0a20 2020 202e 2e2e 2029      ],.    ... )
-0000bcf0: 0a20 2020 203e 3e3e 2064 615f 610a 2020  .    >>> da_a.  
-0000bd00: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
-0000bd10: 7261 7920 2873 7061 6365 3a20 332c 2074  ray (space: 3, t
-0000bd20: 696d 653a 2033 293e 0a20 2020 2061 7272  ime: 3)>.    arr
-0000bd30: 6179 285b 5b31 2e20 2c20 322e 202c 2033  ay([[1. , 2. , 3
-0000bd40: 2e20 5d2c 0a20 2020 2020 2020 2020 2020  . ],.           
-0000bd50: 5b30 2e31 2c20 302e 322c 2030 2e33 5d2c  [0.1, 0.2, 0.3],
-0000bd60: 0a20 2020 2020 2020 2020 2020 5b33 2e32  .           [3.2
-0000bd70: 2c20 302e 362c 2031 2e38 5d5d 290a 2020  , 0.6, 1.8]]).  
-0000bd80: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-0000bd90: 2020 2020 202a 2073 7061 6365 2020 2020       * space    
-0000bda0: 2873 7061 6365 2920 3c55 3220 2749 4127  (space) <U2 'IA'
-0000bdb0: 2027 494c 2720 2749 4e27 0a20 2020 2020   'IL' 'IN'.     
-0000bdc0: 202a 2074 696d 6520 2020 2020 2874 696d   * time     (tim
-0000bdd0: 6529 2064 6174 6574 696d 6536 345b 6e73  e) datetime64[ns
-0000bde0: 5d20 3230 3030 2d30 312d 3031 2032 3030  ] 2000-01-01 200
-0000bdf0: 302d 3031 2d30 3220 3230 3030 2d30 312d  0-01-02 2000-01-
-0000be00: 3033 0a20 2020 203e 3e3e 2064 615f 6220  03.    >>> da_b 
-0000be10: 3d20 4461 7461 4172 7261 7928 0a20 2020  = DataArray(.   
-0000be20: 202e 2e2e 2020 2020 206e 702e 6172 7261   ...     np.arra
-0000be30: 7928 5b5b 302e 322c 2030 2e34 2c20 302e  y([[0.2, 0.4, 0.
-0000be40: 365d 2c20 5b31 352c 2031 302c 2035 5d2c  6], [15, 10, 5],
-0000be50: 205b 332e 322c 2030 2e36 2c20 312e 385d   [3.2, 0.6, 1.8]
-0000be60: 5d29 2c0a 2020 2020 2e2e 2e20 2020 2020  ]),.    ...     
-0000be70: 6469 6d73 3d28 2273 7061 6365 222c 2022  dims=("space", "
-0000be80: 7469 6d65 2229 2c0a 2020 2020 2e2e 2e20  time"),.    ... 
-0000be90: 2020 2020 636f 6f72 6473 3d5b 0a20 2020      coords=[.   
-0000bea0: 202e 2e2e 2020 2020 2020 2020 2028 2273   ...         ("s
-0000beb0: 7061 6365 222c 205b 2249 4122 2c20 2249  pace", ["IA", "I
-0000bec0: 4c22 2c20 2249 4e22 5d29 2c0a 2020 2020  L", "IN"]),.    
-0000bed0: 2e2e 2e20 2020 2020 2020 2020 2822 7469  ...         ("ti
-0000bee0: 6d65 222c 2070 642e 6461 7465 5f72 616e  me", pd.date_ran
-0000bef0: 6765 2822 3230 3030 2d30 312d 3031 222c  ge("2000-01-01",
-0000bf00: 2066 7265 713d 2231 4422 2c20 7065 7269   freq="1D", peri
-0000bf10: 6f64 733d 3329 292c 0a20 2020 202e 2e2e  ods=3)),.    ...
-0000bf20: 2020 2020 205d 2c0a 2020 2020 2e2e 2e20       ],.    ... 
-0000bf30: 290a 2020 2020 3e3e 3e20 6461 5f62 0a20  ).    >>> da_b. 
-0000bf40: 2020 203c 7861 7272 6179 2e44 6174 6141     <xarray.DataA
-0000bf50: 7272 6179 2028 7370 6163 653a 2033 2c20  rray (space: 3, 
-0000bf60: 7469 6d65 3a20 3329 3e0a 2020 2020 6172  time: 3)>.    ar
-0000bf70: 7261 7928 5b5b 2030 2e32 2c20 2030 2e34  ray([[ 0.2,  0.4
-0000bf80: 2c20 2030 2e36 5d2c 0a20 2020 2020 2020  ,  0.6],.       
-0000bf90: 2020 2020 5b31 352e 202c 2031 302e 202c      [15. , 10. ,
-0000bfa0: 2020 352e 205d 2c0a 2020 2020 2020 2020    5. ],.        
-0000bfb0: 2020 205b 2033 2e32 2c20 2030 2e36 2c20     [ 3.2,  0.6, 
-0000bfc0: 2031 2e38 5d5d 290a 2020 2020 436f 6f72   1.8]]).    Coor
-0000bfd0: 6469 6e61 7465 733a 0a20 2020 2020 202a  dinates:.      *
-0000bfe0: 2073 7061 6365 2020 2020 2873 7061 6365   space    (space
-0000bff0: 2920 3c55 3220 2749 4127 2027 494c 2720  ) <U2 'IA' 'IL' 
-0000c000: 2749 4e27 0a20 2020 2020 202a 2074 696d  'IN'.      * tim
-0000c010: 6520 2020 2020 2874 696d 6529 2064 6174  e     (time) dat
-0000c020: 6574 696d 6536 345b 6e73 5d20 3230 3030  etime64[ns] 2000
-0000c030: 2d30 312d 3031 2032 3030 302d 3031 2d30  -01-01 2000-01-0
-0000c040: 3220 3230 3030 2d30 312d 3033 0a20 2020  2 2000-01-03.   
-0000c050: 203e 3e3e 2078 722e 636f 7272 2864 615f   >>> xr.corr(da_
-0000c060: 612c 2064 615f 6229 0a20 2020 203c 7861  a, da_b).    <xa
-0000c070: 7272 6179 2e44 6174 6141 7272 6179 2028  rray.DataArray (
-0000c080: 293e 0a20 2020 2061 7272 6179 282d 302e  )>.    array(-0.
-0000c090: 3537 3038 3737 3737 290a 2020 2020 3e3e  57087777).    >>
-0000c0a0: 3e20 7872 2e63 6f72 7228 6461 5f61 2c20  > xr.corr(da_a, 
-0000c0b0: 6461 5f62 2c20 6469 6d3d 2274 696d 6522  da_b, dim="time"
-0000c0c0: 290a 2020 2020 3c78 6172 7261 792e 4461  ).    <xarray.Da
-0000c0d0: 7461 4172 7261 7920 2873 7061 6365 3a20  taArray (space: 
-0000c0e0: 3329 3e0a 2020 2020 6172 7261 7928 5b20  3)>.    array([ 
-0000c0f0: 312e 2c20 2d31 2e2c 2020 312e 5d29 0a20  1., -1.,  1.]). 
-0000c100: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-0000c110: 2020 2020 2020 2a20 7370 6163 6520 2020        * space   
-0000c120: 2028 7370 6163 6529 203c 5532 2027 4941   (space) <U2 'IA
-0000c130: 2720 2749 4c27 2027 494e 270a 2020 2020  ' 'IL' 'IN'.    
-0000c140: 2222 220a 2020 2020 6672 6f6d 2078 6172  """.    from xar
-0000c150: 7261 792e 636f 7265 2e64 6174 6161 7272  ray.core.dataarr
-0000c160: 6179 2069 6d70 6f72 7420 4461 7461 4172  ay import DataAr
-0000c170: 7261 790a 0a20 2020 2069 6620 616e 7928  ray..    if any(
-0000c180: 6e6f 7420 6973 696e 7374 616e 6365 2861  not isinstance(a
-0000c190: 7272 2c20 4461 7461 4172 7261 7929 2066  rr, DataArray) f
-0000c1a0: 6f72 2061 7272 2069 6e20 5b64 615f 612c  or arr in [da_a,
-0000c1b0: 2064 615f 625d 293a 0a20 2020 2020 2020   da_b]):.       
-0000c1c0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-0000c1d0: 280a 2020 2020 2020 2020 2020 2020 224f  (.            "O
-0000c1e0: 6e6c 7920 7872 2e44 6174 6141 7272 6179  nly xr.DataArray
-0000c1f0: 2069 7320 7375 7070 6f72 7465 642e 220a   is supported.".
-0000c200: 2020 2020 2020 2020 2020 2020 2247 6976              "Giv
-0000c210: 656e 207b 7d2e 222e 666f 726d 6174 285b  en {}.".format([
-0000c220: 7479 7065 2861 7272 2920 666f 7220 6172  type(arr) for ar
-0000c230: 7220 696e 205b 6461 5f61 2c20 6461 5f62  r in [da_a, da_b
-0000c240: 5d5d 290a 2020 2020 2020 2020 290a 0a20  ]]).        ).. 
-0000c250: 2020 2072 6574 7572 6e20 5f63 6f76 5f63     return _cov_c
-0000c260: 6f72 7228 6461 5f61 2c20 6461 5f62 2c20  orr(da_a, da_b, 
-0000c270: 6469 6d3d 6469 6d2c 206d 6574 686f 643d  dim=dim, method=
-0000c280: 2263 6f72 7222 290a 0a0a 6465 6620 5f63  "corr")...def _c
-0000c290: 6f76 5f63 6f72 7228 0a20 2020 2064 615f  ov_corr(.    da_
-0000c2a0: 613a 2054 5f44 6174 6141 7272 6179 2c0a  a: T_DataArray,.
-0000c2b0: 2020 2020 6461 5f62 3a20 545f 4461 7461      da_b: T_Data
-0000c2c0: 4172 7261 792c 0a20 2020 2064 696d 3a20  Array,.    dim: 
-0000c2d0: 4469 6d73 203d 204e 6f6e 652c 0a20 2020  Dims = None,.   
-0000c2e0: 2064 646f 663a 2069 6e74 203d 2030 2c0a   ddof: int = 0,.
-0000c2f0: 2020 2020 6d65 7468 6f64 3a20 4c69 7465      method: Lite
-0000c300: 7261 6c5b 2263 6f76 222c 2022 636f 7272  ral["cov", "corr
-0000c310: 222c 204e 6f6e 655d 203d 204e 6f6e 652c  ", None] = None,
-0000c320: 0a29 202d 3e20 545f 4461 7461 4172 7261  .) -> T_DataArra
-0000c330: 793a 0a20 2020 2022 2222 0a20 2020 2049  y:.    """.    I
-0000c340: 6e74 6572 6e61 6c20 6d65 7468 6f64 2066  nternal method f
-0000c350: 6f72 2078 722e 636f 7628 2920 616e 6420  or xr.cov() and 
-0000c360: 7872 2e63 6f72 7228 2920 736f 206f 6e6c  xr.corr() so onl
-0000c370: 7920 6861 7665 2074 6f0a 2020 2020 7361  y have to.    sa
-0000c380: 6e69 7469 7a65 2074 6865 2069 6e70 7574  nitize the input
-0000c390: 2061 7272 6179 7320 6f6e 6365 2061 6e64   arrays once and
-0000c3a0: 2077 6520 646f 6e27 7420 7265 7065 6174   we don't repeat
-0000c3b0: 2063 6f64 652e 0a20 2020 2022 2222 0a20   code..    """. 
-0000c3c0: 2020 2023 2031 2e20 4272 6f61 6463 6173     # 1. Broadcas
-0000c3d0: 7420 7468 6520 7477 6f20 6172 7261 7973  t the two arrays
-0000c3e0: 0a20 2020 2064 615f 612c 2064 615f 6220  .    da_a, da_b 
-0000c3f0: 3d20 616c 6967 6e28 6461 5f61 2c20 6461  = align(da_a, da
-0000c400: 5f62 2c20 6a6f 696e 3d22 696e 6e65 7222  _b, join="inner"
-0000c410: 2c20 636f 7079 3d46 616c 7365 290a 0a20  , copy=False).. 
-0000c420: 2020 2023 2032 2e20 4967 6e6f 7265 2074     # 2. Ignore t
-0000c430: 6865 206e 616e 730a 2020 2020 7661 6c69  he nans.    vali
-0000c440: 645f 7661 6c75 6573 203d 2064 615f 612e  d_values = da_a.
-0000c450: 6e6f 746e 756c 6c28 2920 2620 6461 5f62  notnull() & da_b
-0000c460: 2e6e 6f74 6e75 6c6c 2829 0a20 2020 2064  .notnull().    d
-0000c470: 615f 6120 3d20 6461 5f61 2e77 6865 7265  a_a = da_a.where
-0000c480: 2876 616c 6964 5f76 616c 7565 7329 0a20  (valid_values). 
-0000c490: 2020 2064 615f 6220 3d20 6461 5f62 2e77     da_b = da_b.w
-0000c4a0: 6865 7265 2876 616c 6964 5f76 616c 7565  here(valid_value
-0000c4b0: 7329 0a20 2020 2076 616c 6964 5f63 6f75  s).    valid_cou
-0000c4c0: 6e74 203d 2076 616c 6964 5f76 616c 7565  nt = valid_value
-0000c4d0: 732e 7375 6d28 6469 6d29 202d 2064 646f  s.sum(dim) - ddo
-0000c4e0: 660a 0a20 2020 2023 2033 2e20 4465 7472  f..    # 3. Detr
-0000c4f0: 656e 6420 616c 6f6e 6720 7468 6520 6769  end along the gi
-0000c500: 7665 6e20 6469 6d0a 2020 2020 6465 6d65  ven dim.    deme
-0000c510: 616e 6564 5f64 615f 6120 3d20 6461 5f61  aned_da_a = da_a
-0000c520: 202d 2064 615f 612e 6d65 616e 2864 696d   - da_a.mean(dim
-0000c530: 3d64 696d 290a 2020 2020 6465 6d65 616e  =dim).    demean
-0000c540: 6564 5f64 615f 6220 3d20 6461 5f62 202d  ed_da_b = da_b -
-0000c550: 2064 615f 622e 6d65 616e 2864 696d 3d64   da_b.mean(dim=d
-0000c560: 696d 290a 0a20 2020 2023 2034 2e20 436f  im)..    # 4. Co
-0000c570: 6d70 7574 6520 636f 7661 7269 616e 6365  mpute covariance
-0000c580: 2061 6c6f 6e67 2074 6865 2067 6976 656e   along the given
-0000c590: 2064 696d 0a20 2020 2023 204e 2e42 2e20   dim.    # N.B. 
-0000c5a0: 6073 6b69 706e 613d 5472 7565 6020 6973  `skipna=True` is
-0000c5b0: 2072 6571 7569 7265 6420 6f72 2061 7574   required or aut
-0000c5c0: 6f2d 636f 7661 7269 616e 6365 2069 7320  o-covariance is 
-0000c5d0: 636f 6d70 7574 6564 2069 6e63 6f72 7265  computed incorre
-0000c5e0: 6374 6c79 2e20 452e 672e 0a20 2020 2023  ctly. E.g..    #
-0000c5f0: 2054 7279 2078 722e 636f 7628 6461 2c64   Try xr.cov(da,d
-0000c600: 6129 2066 6f72 2064 6120 3d20 7872 2e44  a) for da = xr.D
-0000c610: 6174 6141 7272 6179 285b 5b31 2c20 325d  ataArray([[1, 2]
-0000c620: 2c20 5b31 2c20 6e70 2e6e 616e 5d5d 2c20  , [1, np.nan]], 
-0000c630: 6469 6d73 3d5b 2278 222c 2022 7469 6d65  dims=["x", "time
-0000c640: 225d 290a 2020 2020 636f 7620 3d20 2864  "]).    cov = (d
-0000c650: 656d 6561 6e65 645f 6461 5f61 2e63 6f6e  emeaned_da_a.con
-0000c660: 6a28 2920 2a20 6465 6d65 616e 6564 5f64  j() * demeaned_d
-0000c670: 615f 6229 2e73 756d 280a 2020 2020 2020  a_b).sum(.      
-0000c680: 2020 6469 6d3d 6469 6d2c 2073 6b69 706e    dim=dim, skipn
-0000c690: 613d 5472 7565 2c20 6d69 6e5f 636f 756e  a=True, min_coun
-0000c6a0: 743d 310a 2020 2020 2920 2f20 2876 616c  t=1.    ) / (val
-0000c6b0: 6964 5f63 6f75 6e74 290a 0a20 2020 2069  id_count)..    i
-0000c6c0: 6620 6d65 7468 6f64 203d 3d20 2263 6f76  f method == "cov
-0000c6d0: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
-0000c6e0: 6e20 636f 7620 2023 2074 7970 653a 2069  n cov  # type: i
-0000c6f0: 676e 6f72 655b 7265 7475 726e 2d76 616c  gnore[return-val
-0000c700: 7565 5d0a 0a20 2020 2065 6c73 653a 0a20  ue]..    else:. 
-0000c710: 2020 2020 2020 2023 2063 6f6d 7075 7465         # compute
-0000c720: 2073 7464 202b 2063 6f72 720a 2020 2020   std + corr.    
-0000c730: 2020 2020 6461 5f61 5f73 7464 203d 2064      da_a_std = d
-0000c740: 615f 612e 7374 6428 6469 6d3d 6469 6d29  a_a.std(dim=dim)
-0000c750: 0a20 2020 2020 2020 2064 615f 625f 7374  .        da_b_st
-0000c760: 6420 3d20 6461 5f62 2e73 7464 2864 696d  d = da_b.std(dim
-0000c770: 3d64 696d 290a 2020 2020 2020 2020 636f  =dim).        co
-0000c780: 7272 203d 2063 6f76 202f 2028 6461 5f61  rr = cov / (da_a
-0000c790: 5f73 7464 202a 2064 615f 625f 7374 6429  _std * da_b_std)
-0000c7a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000c7b0: 636f 7272 2020 2320 7479 7065 3a20 6967  corr  # type: ig
-0000c7c0: 6e6f 7265 5b72 6574 7572 6e2d 7661 6c75  nore[return-valu
-0000c7d0: 655d 0a0a 0a64 6566 2063 726f 7373 280a  e]...def cross(.
-0000c7e0: 2020 2020 613a 2044 6174 6141 7272 6179      a: DataArray
-0000c7f0: 207c 2056 6172 6961 626c 652c 2062 3a20   | Variable, b: 
-0000c800: 4461 7461 4172 7261 7920 7c20 5661 7269  DataArray | Vari
-0000c810: 6162 6c65 2c20 2a2c 2064 696d 3a20 4861  able, *, dim: Ha
-0000c820: 7368 6162 6c65 0a29 202d 3e20 4461 7461  shable.) -> Data
-0000c830: 4172 7261 7920 7c20 5661 7269 6162 6c65  Array | Variable
-0000c840: 3a0a 2020 2020 2222 220a 2020 2020 436f  :.    """.    Co
-0000c850: 6d70 7574 6520 7468 6520 6372 6f73 7320  mpute the cross 
-0000c860: 7072 6f64 7563 7420 6f66 2074 776f 2028  product of two (
-0000c870: 6172 7261 7973 206f 6629 2076 6563 746f  arrays of) vecto
-0000c880: 7273 2e0a 0a20 2020 2054 6865 2063 726f  rs...    The cro
-0000c890: 7373 2070 726f 6475 6374 206f 6620 6061  ss product of `a
-0000c8a0: 6020 616e 6420 6062 6020 696e 203a 6d61  ` and `b` in :ma
-0000c8b0: 7468 3a60 525e 3360 2069 7320 6120 7665  th:`R^3` is a ve
-0000c8c0: 6374 6f72 0a20 2020 2070 6572 7065 6e64  ctor.    perpend
-0000c8d0: 6963 756c 6172 2074 6f20 626f 7468 2060  icular to both `
-0000c8e0: 6160 2061 6e64 2060 6260 2e20 5468 6520  a` and `b`. The 
-0000c8f0: 7665 6374 6f72 7320 696e 2060 6160 2061  vectors in `a` a
-0000c900: 6e64 2060 6260 2061 7265 0a20 2020 2064  nd `b` are.    d
-0000c910: 6566 696e 6564 2062 7920 7468 6520 7661  efined by the va
-0000c920: 6c75 6573 2061 6c6f 6e67 2074 6865 2064  lues along the d
-0000c930: 696d 656e 7369 6f6e 2060 6469 6d60 2061  imension `dim` a
-0000c940: 6e64 2063 616e 2068 6176 6520 7369 7a65  nd can have size
-0000c950: 730a 2020 2020 312c 2032 206f 7220 332e  s.    1, 2 or 3.
-0000c960: 2057 6865 7265 2074 6865 2073 697a 6520   Where the size 
-0000c970: 6f66 2065 6974 6865 7220 6061 6020 6f72  of either `a` or
-0000c980: 2060 6260 2069 730a 2020 2020 3120 6f72   `b` is.    1 or
-0000c990: 2032 2c20 7468 6520 7265 6d61 696e 696e   2, the remainin
-0000c9a0: 6720 636f 6d70 6f6e 656e 7473 206f 6620  g components of 
-0000c9b0: 7468 6520 696e 7075 7420 7665 6374 6f72  the input vector
-0000c9c0: 2069 7320 6173 7375 6d65 6420 746f 0a20   is assumed to. 
-0000c9d0: 2020 2062 6520 7a65 726f 2061 6e64 2074     be zero and t
-0000c9e0: 6865 2063 726f 7373 2070 726f 6475 6374  he cross product
-0000c9f0: 2063 616c 6375 6c61 7465 6420 6163 636f   calculated acco
-0000ca00: 7264 696e 676c 792e 2049 6e20 6361 7365  rdingly. In case
-0000ca10: 7320 7768 6572 650a 2020 2020 626f 7468  s where.    both
-0000ca20: 2069 6e70 7574 2076 6563 746f 7273 2068   input vectors h
-0000ca30: 6176 6520 6469 6d65 6e73 696f 6e20 322c  ave dimension 2,
-0000ca40: 2074 6865 207a 2d63 6f6d 706f 6e65 6e74   the z-component
-0000ca50: 206f 6620 7468 6520 6372 6f73 730a 2020   of the cross.  
-0000ca60: 2020 7072 6f64 7563 7420 6973 2072 6574    product is ret
-0000ca70: 7572 6e65 642e 0a0a 2020 2020 5061 7261  urned...    Para
-0000ca80: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-0000ca90: 2d2d 2d2d 2d0a 2020 2020 612c 2062 203a  -----.    a, b :
-0000caa0: 2044 6174 6141 7272 6179 206f 7220 5661   DataArray or Va
-0000cab0: 7269 6162 6c65 0a20 2020 2020 2020 2043  riable.        C
-0000cac0: 6f6d 706f 6e65 6e74 7320 6f66 2074 6865  omponents of the
-0000cad0: 2066 6972 7374 2061 6e64 2073 6563 6f6e   first and secon
-0000cae0: 6420 7665 6374 6f72 2873 292e 0a20 2020  d vector(s)..   
-0000caf0: 2064 696d 203a 2068 6173 6861 626c 650a   dim : hashable.
-0000cb00: 2020 2020 2020 2020 5468 6520 6469 6d65          The dime
-0000cb10: 6e73 696f 6e20 616c 6f6e 6720 7768 6963  nsion along whic
-0000cb20: 6820 7468 6520 6372 6f73 7320 7072 6f64  h the cross prod
-0000cb30: 7563 7420 7769 6c6c 2062 6520 636f 6d70  uct will be comp
-0000cb40: 7574 6564 2e0a 2020 2020 2020 2020 4d75  uted..        Mu
-0000cb50: 7374 2062 6520 6176 6169 6c61 626c 6520  st be available 
-0000cb60: 696e 2062 6f74 6820 7665 6374 6f72 732e  in both vectors.
-0000cb70: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-0000cb80: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-0000cb90: 5665 6374 6f72 2063 726f 7373 2d70 726f  Vector cross-pro
-0000cba0: 6475 6374 2077 6974 6820 3320 6469 6d65  duct with 3 dime
-0000cbb0: 6e73 696f 6e73 3a0a 0a20 2020 203e 3e3e  nsions:..    >>>
-0000cbc0: 2061 203d 2078 722e 4461 7461 4172 7261   a = xr.DataArra
-0000cbd0: 7928 5b31 2c20 322c 2033 5d29 0a20 2020  y([1, 2, 3]).   
-0000cbe0: 203e 3e3e 2062 203d 2078 722e 4461 7461   >>> b = xr.Data
-0000cbf0: 4172 7261 7928 5b34 2c20 352c 2036 5d29  Array([4, 5, 6])
-0000cc00: 0a20 2020 203e 3e3e 2078 722e 6372 6f73  .    >>> xr.cros
-0000cc10: 7328 612c 2062 2c20 6469 6d3d 2264 696d  s(a, b, dim="dim
-0000cc20: 5f30 2229 0a20 2020 203c 7861 7272 6179  _0").    <xarray
-0000cc30: 2e44 6174 6141 7272 6179 2028 6469 6d5f  .DataArray (dim_
-0000cc40: 303a 2033 293e 0a20 2020 2061 7272 6179  0: 3)>.    array
-0000cc50: 285b 2d33 2c20 2036 2c20 2d33 5d29 0a20  ([-3,  6, -3]). 
-0000cc60: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
-0000cc70: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
-0000cc80: 733a 2064 696d 5f30 0a0a 2020 2020 5665  s: dim_0..    Ve
-0000cc90: 6374 6f72 2063 726f 7373 2d70 726f 6475  ctor cross-produ
-0000cca0: 6374 2077 6974 6820 3220 6469 6d65 6e73  ct with 2 dimens
-0000ccb0: 696f 6e73 2c20 7265 7475 726e 7320 696e  ions, returns in
-0000ccc0: 2074 6865 2070 6572 7065 6e64 6963 756c   the perpendicul
-0000ccd0: 6172 0a20 2020 2064 6972 6563 7469 6f6e  ar.    direction
-0000cce0: 3a0a 0a20 2020 203e 3e3e 2061 203d 2078  :..    >>> a = x
-0000ccf0: 722e 4461 7461 4172 7261 7928 5b31 2c20  r.DataArray([1, 
-0000cd00: 325d 290a 2020 2020 3e3e 3e20 6220 3d20  2]).    >>> b = 
-0000cd10: 7872 2e44 6174 6141 7272 6179 285b 342c  xr.DataArray([4,
-0000cd20: 2035 5d29 0a20 2020 203e 3e3e 2078 722e   5]).    >>> xr.
-0000cd30: 6372 6f73 7328 612c 2062 2c20 6469 6d3d  cross(a, b, dim=
-0000cd40: 2264 696d 5f30 2229 0a20 2020 203c 7861  "dim_0").    <xa
-0000cd50: 7272 6179 2e44 6174 6141 7272 6179 2028  rray.DataArray (
-0000cd60: 293e 0a20 2020 2061 7272 6179 282d 3329  )>.    array(-3)
-0000cd70: 0a0a 2020 2020 5665 6374 6f72 2063 726f  ..    Vector cro
-0000cd80: 7373 2d70 726f 6475 6374 2077 6974 6820  ss-product with 
-0000cd90: 3320 6469 6d65 6e73 696f 6e73 2062 7574  3 dimensions but
-0000cda0: 207a 6572 6f73 2061 7420 7468 6520 6c61   zeros at the la
-0000cdb0: 7374 2061 7869 730a 2020 2020 7969 656c  st axis.    yiel
-0000cdc0: 6473 2074 6865 2073 616d 6520 7265 7375  ds the same resu
-0000cdd0: 6c74 7320 6173 2077 6974 6820 3220 6469  lts as with 2 di
-0000cde0: 6d65 6e73 696f 6e73 3a0a 0a20 2020 203e  mensions:..    >
-0000cdf0: 3e3e 2061 203d 2078 722e 4461 7461 4172  >> a = xr.DataAr
-0000ce00: 7261 7928 5b31 2c20 322c 2030 5d29 0a20  ray([1, 2, 0]). 
-0000ce10: 2020 203e 3e3e 2062 203d 2078 722e 4461     >>> b = xr.Da
-0000ce20: 7461 4172 7261 7928 5b34 2c20 352c 2030  taArray([4, 5, 0
-0000ce30: 5d29 0a20 2020 203e 3e3e 2078 722e 6372  ]).    >>> xr.cr
-0000ce40: 6f73 7328 612c 2062 2c20 6469 6d3d 2264  oss(a, b, dim="d
-0000ce50: 696d 5f30 2229 0a20 2020 203c 7861 7272  im_0").    <xarr
-0000ce60: 6179 2e44 6174 6141 7272 6179 2028 6469  ay.DataArray (di
-0000ce70: 6d5f 303a 2033 293e 0a20 2020 2061 7272  m_0: 3)>.    arr
-0000ce80: 6179 285b 2030 2c20 2030 2c20 2d33 5d29  ay([ 0,  0, -3])
-0000ce90: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
-0000cea0: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-0000ceb0: 7465 733a 2064 696d 5f30 0a0a 2020 2020  tes: dim_0..    
-0000cec0: 4f6e 6520 7665 6374 6f72 2077 6974 6820  One vector with 
-0000ced0: 6469 6d65 6e73 696f 6e20 323a 0a0a 2020  dimension 2:..  
-0000cee0: 2020 3e3e 3e20 6120 3d20 7872 2e44 6174    >>> a = xr.Dat
-0000cef0: 6141 7272 6179 280a 2020 2020 2e2e 2e20  aArray(.    ... 
-0000cf00: 2020 2020 5b31 2c20 325d 2c0a 2020 2020      [1, 2],.    
-0000cf10: 2e2e 2e20 2020 2020 6469 6d73 3d5b 2263  ...     dims=["c
-0000cf20: 6172 7465 7369 616e 225d 2c0a 2020 2020  artesian"],.    
-0000cf30: 2e2e 2e20 2020 2020 636f 6f72 6473 3d64  ...     coords=d
-0000cf40: 6963 7428 6361 7274 6573 6961 6e3d 285b  ict(cartesian=([
-0000cf50: 2263 6172 7465 7369 616e 225d 2c20 5b22  "cartesian"], ["
-0000cf60: 7822 2c20 2279 225d 2929 2c0a 2020 2020  x", "y"])),.    
-0000cf70: 2e2e 2e20 290a 2020 2020 3e3e 3e20 6220  ... ).    >>> b 
-0000cf80: 3d20 7872 2e44 6174 6141 7272 6179 280a  = xr.DataArray(.
-0000cf90: 2020 2020 2e2e 2e20 2020 2020 5b34 2c20      ...     [4, 
-0000cfa0: 352c 2036 5d2c 0a20 2020 202e 2e2e 2020  5, 6],.    ...  
-0000cfb0: 2020 2064 696d 733d 5b22 6361 7274 6573     dims=["cartes
-0000cfc0: 6961 6e22 5d2c 0a20 2020 202e 2e2e 2020  ian"],.    ...  
-0000cfd0: 2020 2063 6f6f 7264 733d 6469 6374 2863     coords=dict(c
-0000cfe0: 6172 7465 7369 616e 3d28 5b22 6361 7274  artesian=(["cart
-0000cff0: 6573 6961 6e22 5d2c 205b 2278 222c 2022  esian"], ["x", "
-0000d000: 7922 2c20 227a 225d 2929 2c0a 2020 2020  y", "z"])),.    
-0000d010: 2e2e 2e20 290a 2020 2020 3e3e 3e20 7872  ... ).    >>> xr
-0000d020: 2e63 726f 7373 2861 2c20 622c 2064 696d  .cross(a, b, dim
-0000d030: 3d22 6361 7274 6573 6961 6e22 290a 2020  ="cartesian").  
-0000d040: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
-0000d050: 7261 7920 2863 6172 7465 7369 616e 3a20  ray (cartesian: 
-0000d060: 3329 3e0a 2020 2020 6172 7261 7928 5b31  3)>.    array([1
-0000d070: 322c 202d 362c 202d 335d 290a 2020 2020  2, -6, -3]).    
-0000d080: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
-0000d090: 2020 202a 2063 6172 7465 7369 616e 2020     * cartesian  
-0000d0a0: 2863 6172 7465 7369 616e 2920 3c55 3120  (cartesian) <U1 
-0000d0b0: 2778 2720 2779 2720 277a 270a 0a20 2020  'x' 'y' 'z'..   
-0000d0c0: 204f 6e65 2076 6563 746f 7220 7769 7468   One vector with
-0000d0d0: 2064 696d 656e 7369 6f6e 2032 2062 7574   dimension 2 but
-0000d0e0: 2063 6f6f 7264 7320 696e 206f 7468 6572   coords in other
-0000d0f0: 2070 6f73 6974 696f 6e73 3a0a 0a20 2020   positions:..   
-0000d100: 203e 3e3e 2061 203d 2078 722e 4461 7461   >>> a = xr.Data
-0000d110: 4172 7261 7928 0a20 2020 202e 2e2e 2020  Array(.    ...  
-0000d120: 2020 205b 312c 2032 5d2c 0a20 2020 202e     [1, 2],.    .
-0000d130: 2e2e 2020 2020 2064 696d 733d 5b22 6361  ..     dims=["ca
-0000d140: 7274 6573 6961 6e22 5d2c 0a20 2020 202e  rtesian"],.    .
-0000d150: 2e2e 2020 2020 2063 6f6f 7264 733d 6469  ..     coords=di
-0000d160: 6374 2863 6172 7465 7369 616e 3d28 5b22  ct(cartesian=(["
-0000d170: 6361 7274 6573 6961 6e22 5d2c 205b 2278  cartesian"], ["x
-0000d180: 222c 2022 7a22 5d29 292c 0a20 2020 202e  ", "z"])),.    .
-0000d190: 2e2e 2029 0a20 2020 203e 3e3e 2062 203d  .. ).    >>> b =
-0000d1a0: 2078 722e 4461 7461 4172 7261 7928 0a20   xr.DataArray(. 
-0000d1b0: 2020 202e 2e2e 2020 2020 205b 342c 2035     ...     [4, 5
-0000d1c0: 2c20 365d 2c0a 2020 2020 2e2e 2e20 2020  , 6],.    ...   
-0000d1d0: 2020 6469 6d73 3d5b 2263 6172 7465 7369    dims=["cartesi
-0000d1e0: 616e 225d 2c0a 2020 2020 2e2e 2e20 2020  an"],.    ...   
-0000d1f0: 2020 636f 6f72 6473 3d64 6963 7428 6361    coords=dict(ca
-0000d200: 7274 6573 6961 6e3d 285b 2263 6172 7465  rtesian=(["carte
-0000d210: 7369 616e 225d 2c20 5b22 7822 2c20 2279  sian"], ["x", "y
-0000d220: 222c 2022 7a22 5d29 292c 0a20 2020 202e  ", "z"])),.    .
-0000d230: 2e2e 2029 0a20 2020 203e 3e3e 2078 722e  .. ).    >>> xr.
-0000d240: 6372 6f73 7328 612c 2062 2c20 6469 6d3d  cross(a, b, dim=
-0000d250: 2263 6172 7465 7369 616e 2229 0a20 2020  "cartesian").   
-0000d260: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
-0000d270: 6179 2028 6361 7274 6573 6961 6e3a 2033  ay (cartesian: 3
-0000d280: 293e 0a20 2020 2061 7272 6179 285b 2d31  )>.    array([-1
-0000d290: 302c 2020 2032 2c20 2020 355d 290a 2020  0,   2,   5]).  
-0000d2a0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-0000d2b0: 2020 2020 202a 2063 6172 7465 7369 616e       * cartesian
-0000d2c0: 2020 2863 6172 7465 7369 616e 2920 3c55    (cartesian) <U
-0000d2d0: 3120 2778 2720 2779 2720 277a 270a 0a20  1 'x' 'y' 'z'.. 
-0000d2e0: 2020 204d 756c 7469 706c 6520 7665 6374     Multiple vect
-0000d2f0: 6f72 2063 726f 7373 2d70 726f 6475 6374  or cross-product
-0000d300: 732e 204e 6f74 6520 7468 6174 2074 6865  s. Note that the
-0000d310: 2064 6972 6563 7469 6f6e 206f 6620 7468   direction of th
-0000d320: 650a 2020 2020 6372 6f73 7320 7072 6f64  e.    cross prod
-0000d330: 7563 7420 7665 6374 6f72 2069 7320 6465  uct vector is de
-0000d340: 6669 6e65 6420 6279 2074 6865 2072 6967  fined by the rig
-0000d350: 6874 2d68 616e 6420 7275 6c65 3a0a 0a20  ht-hand rule:.. 
-0000d360: 2020 203e 3e3e 2061 203d 2078 722e 4461     >>> a = xr.Da
-0000d370: 7461 4172 7261 7928 0a20 2020 202e 2e2e  taArray(.    ...
-0000d380: 2020 2020 205b 5b31 2c20 322c 2033 5d2c       [[1, 2, 3],
-0000d390: 205b 342c 2035 2c20 365d 5d2c 0a20 2020   [4, 5, 6]],.   
-0000d3a0: 202e 2e2e 2020 2020 2064 696d 733d 2822   ...     dims=("
-0000d3b0: 7469 6d65 222c 2022 6361 7274 6573 6961  time", "cartesia
-0000d3c0: 6e22 292c 0a20 2020 202e 2e2e 2020 2020  n"),.    ...    
-0000d3d0: 2063 6f6f 7264 733d 6469 6374 280a 2020   coords=dict(.  
-0000d3e0: 2020 2e2e 2e20 2020 2020 2020 2020 7469    ...         ti
-0000d3f0: 6d65 3d28 5b22 7469 6d65 225d 2c20 5b30  me=(["time"], [0
-0000d400: 2c20 315d 292c 0a20 2020 202e 2e2e 2020  , 1]),.    ...  
-0000d410: 2020 2020 2020 2063 6172 7465 7369 616e         cartesian
-0000d420: 3d28 5b22 6361 7274 6573 6961 6e22 5d2c  =(["cartesian"],
-0000d430: 205b 2278 222c 2022 7922 2c20 227a 225d   ["x", "y", "z"]
-0000d440: 292c 0a20 2020 202e 2e2e 2020 2020 2029  ),.    ...     )
-0000d450: 2c0a 2020 2020 2e2e 2e20 290a 2020 2020  ,.    ... ).    
-0000d460: 3e3e 3e20 6220 3d20 7872 2e44 6174 6141  >>> b = xr.DataA
-0000d470: 7272 6179 280a 2020 2020 2e2e 2e20 2020  rray(.    ...   
-0000d480: 2020 5b5b 342c 2035 2c20 365d 2c20 5b31    [[4, 5, 6], [1
-0000d490: 2c20 322c 2033 5d5d 2c0a 2020 2020 2e2e  , 2, 3]],.    ..
-0000d4a0: 2e20 2020 2020 6469 6d73 3d28 2274 696d  .     dims=("tim
-0000d4b0: 6522 2c20 2263 6172 7465 7369 616e 2229  e", "cartesian")
-0000d4c0: 2c0a 2020 2020 2e2e 2e20 2020 2020 636f  ,.    ...     co
-0000d4d0: 6f72 6473 3d64 6963 7428 0a20 2020 202e  ords=dict(.    .
-0000d4e0: 2e2e 2020 2020 2020 2020 2074 696d 653d  ..         time=
-0000d4f0: 285b 2274 696d 6522 5d2c 205b 302c 2031  (["time"], [0, 1
-0000d500: 5d29 2c0a 2020 2020 2e2e 2e20 2020 2020  ]),.    ...     
-0000d510: 2020 2020 6361 7274 6573 6961 6e3d 285b      cartesian=([
-0000d520: 2263 6172 7465 7369 616e 225d 2c20 5b22  "cartesian"], ["
-0000d530: 7822 2c20 2279 222c 2022 7a22 5d29 2c0a  x", "y", "z"]),.
-0000d540: 2020 2020 2e2e 2e20 2020 2020 292c 0a20      ...     ),. 
-0000d550: 2020 202e 2e2e 2029 0a20 2020 203e 3e3e     ... ).    >>>
-0000d560: 2078 722e 6372 6f73 7328 612c 2062 2c20   xr.cross(a, b, 
-0000d570: 6469 6d3d 2263 6172 7465 7369 616e 2229  dim="cartesian")
-0000d580: 0a20 2020 203c 7861 7272 6179 2e44 6174  .    <xarray.Dat
-0000d590: 6141 7272 6179 2028 7469 6d65 3a20 322c  aArray (time: 2,
-0000d5a0: 2063 6172 7465 7369 616e 3a20 3329 3e0a   cartesian: 3)>.
-0000d5b0: 2020 2020 6172 7261 7928 5b5b 2d33 2c20      array([[-3, 
-0000d5c0: 2036 2c20 2d33 5d2c 0a20 2020 2020 2020   6, -3],.       
-0000d5d0: 2020 2020 5b20 332c 202d 362c 2020 335d      [ 3, -6,  3]
-0000d5e0: 5d29 0a20 2020 2043 6f6f 7264 696e 6174  ]).    Coordinat
-0000d5f0: 6573 3a0a 2020 2020 2020 2a20 7469 6d65  es:.      * time
-0000d600: 2020 2020 2020 2028 7469 6d65 2920 696e         (time) in
-0000d610: 7436 3420 3020 310a 2020 2020 2020 2a20  t64 0 1.      * 
-0000d620: 6361 7274 6573 6961 6e20 2028 6361 7274  cartesian  (cart
-0000d630: 6573 6961 6e29 203c 5531 2027 7827 2027  esian) <U1 'x' '
-0000d640: 7927 2027 7a27 0a0a 2020 2020 4372 6f73  y' 'z'..    Cros
-0000d650: 7320 6361 6e20 6265 2063 616c 6c65 6420  s can be called 
-0000d660: 6f6e 2044 6174 6173 6574 7320 6279 2063  on Datasets by c
-0000d670: 6f6e 7665 7274 696e 6720 746f 2044 6174  onverting to Dat
-0000d680: 6141 7272 6179 7320 616e 6420 6c61 7465  aArrays and late
-0000d690: 720a 2020 2020 6261 636b 2074 6f20 6120  r.    back to a 
-0000d6a0: 4461 7461 7365 743a 0a0a 2020 2020 3e3e  Dataset:..    >>
-0000d6b0: 3e20 6473 5f61 203d 2078 722e 4461 7461  > ds_a = xr.Data
-0000d6c0: 7365 7428 6469 6374 2878 3d28 2264 696d  set(dict(x=("dim
-0000d6d0: 5f30 222c 205b 315d 292c 2079 3d28 2264  _0", [1]), y=("d
-0000d6e0: 696d 5f30 222c 205b 325d 292c 207a 3d28  im_0", [2]), z=(
-0000d6f0: 2264 696d 5f30 222c 205b 335d 2929 290a  "dim_0", [3]))).
-0000d700: 2020 2020 3e3e 3e20 6473 5f62 203d 2078      >>> ds_b = x
-0000d710: 722e 4461 7461 7365 7428 6469 6374 2878  r.Dataset(dict(x
-0000d720: 3d28 2264 696d 5f30 222c 205b 345d 292c  =("dim_0", [4]),
-0000d730: 2079 3d28 2264 696d 5f30 222c 205b 355d   y=("dim_0", [5]
-0000d740: 292c 207a 3d28 2264 696d 5f30 222c 205b  ), z=("dim_0", [
-0000d750: 365d 2929 290a 2020 2020 3e3e 3e20 6320  6]))).    >>> c 
-0000d760: 3d20 7872 2e63 726f 7373 280a 2020 2020  = xr.cross(.    
-0000d770: 2e2e 2e20 2020 2020 6473 5f61 2e74 6f5f  ...     ds_a.to_
-0000d780: 6172 7261 7928 2263 6172 7465 7369 616e  array("cartesian
-0000d790: 2229 2c20 6473 5f62 2e74 6f5f 6172 7261  "), ds_b.to_arra
-0000d7a0: 7928 2263 6172 7465 7369 616e 2229 2c20  y("cartesian"), 
-0000d7b0: 6469 6d3d 2263 6172 7465 7369 616e 220a  dim="cartesian".
-0000d7c0: 2020 2020 2e2e 2e20 290a 2020 2020 3e3e      ... ).    >>
-0000d7d0: 3e20 632e 746f 5f64 6174 6173 6574 2864  > c.to_dataset(d
-0000d7e0: 696d 3d22 6361 7274 6573 6961 6e22 290a  im="cartesian").
-0000d7f0: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-0000d800: 7365 743e 0a20 2020 2044 696d 656e 7369  set>.    Dimensi
-0000d810: 6f6e 733a 2020 2864 696d 5f30 3a20 3129  ons:  (dim_0: 1)
-0000d820: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
-0000d830: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-0000d840: 7465 733a 2064 696d 5f30 0a20 2020 2044  tes: dim_0.    D
-0000d850: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-0000d860: 2020 2020 2020 2078 2020 2020 2020 2020         x        
-0000d870: 2864 696d 5f30 2920 696e 7436 3420 2d33  (dim_0) int64 -3
-0000d880: 0a20 2020 2020 2020 2079 2020 2020 2020  .        y      
-0000d890: 2020 2864 696d 5f30 2920 696e 7436 3420    (dim_0) int64 
-0000d8a0: 360a 2020 2020 2020 2020 7a20 2020 2020  6.        z     
-0000d8b0: 2020 2028 6469 6d5f 3029 2069 6e74 3634     (dim_0) int64
-0000d8c0: 202d 330a 0a20 2020 2053 6565 2041 6c73   -3..    See Als
-0000d8d0: 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  o.    --------. 
-0000d8e0: 2020 206e 756d 7079 2e63 726f 7373 203a     numpy.cross :
-0000d8f0: 2043 6f72 7265 7370 6f6e 6469 6e67 206e   Corresponding n
-0000d900: 756d 7079 2066 756e 6374 696f 6e0a 2020  umpy function.  
-0000d910: 2020 2222 220a 0a20 2020 2069 6620 6469    """..    if di
-0000d920: 6d20 6e6f 7420 696e 2061 2e64 696d 733a  m not in a.dims:
-0000d930: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-0000d940: 616c 7565 4572 726f 7228 6622 4469 6d65  alueError(f"Dime
-0000d950: 6e73 696f 6e20 7b64 696d 2172 7d20 6e6f  nsion {dim!r} no
-0000d960: 7420 6f6e 2061 2229 0a20 2020 2065 6c69  t on a").    eli
-0000d970: 6620 6469 6d20 6e6f 7420 696e 2062 2e64  f dim not in b.d
-0000d980: 696d 733a 0a20 2020 2020 2020 2072 6169  ims:.        rai
-0000d990: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-0000d9a0: 4469 6d65 6e73 696f 6e20 7b64 696d 2172  Dimension {dim!r
-0000d9b0: 7d20 6e6f 7420 6f6e 2062 2229 0a0a 2020  } not on b")..  
-0000d9c0: 2020 6966 206e 6f74 2031 203c 3d20 612e    if not 1 <= a.
-0000d9d0: 7369 7a65 735b 6469 6d5d 203c 3d20 333a  sizes[dim] <= 3:
-0000d9e0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-0000d9f0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0000da00: 2020 2020 2020 2066 2254 6865 2073 697a         f"The siz
-0000da10: 6520 6f66 207b 6469 6d21 727d 206f 6e20  e of {dim!r} on 
-0000da20: 6120 6d75 7374 2062 6520 312c 2032 2c20  a must be 1, 2, 
-0000da30: 6f72 2033 2074 6f20 6265 2022 0a20 2020  or 3 to be ".   
-0000da40: 2020 2020 2020 2020 2066 2263 6f6d 7061           f"compa
-0000da50: 7469 626c 6520 7769 7468 2061 2063 726f  tible with a cro
-0000da60: 7373 2070 726f 6475 6374 2062 7574 2069  ss product but i
-0000da70: 7320 7b61 2e73 697a 6573 5b64 696d 5d7d  s {a.sizes[dim]}
-0000da80: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-0000da90: 656c 6966 206e 6f74 2031 203c 3d20 622e  elif not 1 <= b.
-0000daa0: 7369 7a65 735b 6469 6d5d 203c 3d20 333a  sizes[dim] <= 3:
-0000dab0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-0000dac0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0000dad0: 2020 2020 2020 2066 2254 6865 2073 697a         f"The siz
-0000dae0: 6520 6f66 207b 6469 6d21 727d 206f 6e20  e of {dim!r} on 
-0000daf0: 6220 6d75 7374 2062 6520 312c 2032 2c20  b must be 1, 2, 
-0000db00: 6f72 2033 2074 6f20 6265 2022 0a20 2020  or 3 to be ".   
-0000db10: 2020 2020 2020 2020 2066 2263 6f6d 7061           f"compa
-0000db20: 7469 626c 6520 7769 7468 2061 2063 726f  tible with a cro
-0000db30: 7373 2070 726f 6475 6374 2062 7574 2069  ss product but i
-0000db40: 7320 7b62 2e73 697a 6573 5b64 696d 5d7d  s {b.sizes[dim]}
-0000db50: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
-0000db60: 2061 6c6c 5f64 696d 7320 3d20 6c69 7374   all_dims = list
-0000db70: 2864 6963 742e 6672 6f6d 6b65 7973 2861  (dict.fromkeys(a
-0000db80: 2e64 696d 7320 2b20 622e 6469 6d73 2929  .dims + b.dims))
-0000db90: 0a0a 2020 2020 6966 2061 2e73 697a 6573  ..    if a.sizes
-0000dba0: 5b64 696d 5d20 213d 2062 2e73 697a 6573  [dim] != b.sizes
-0000dbb0: 5b64 696d 5d3a 0a20 2020 2020 2020 2023  [dim]:.        #
-0000dbc0: 2041 7272 6179 7320 6861 7665 2064 6966   Arrays have dif
-0000dbd0: 6665 7265 6e74 2073 697a 6573 2e20 4170  ferent sizes. Ap
-0000dbe0: 7065 6e64 207a 6572 6f73 2077 6865 7265  pend zeros where
-0000dbf0: 2074 6865 2073 6d61 6c6c 6572 0a20 2020   the smaller.   
-0000dc00: 2020 2020 2023 2061 7272 6179 2069 7320       # array is 
-0000dc10: 6d69 7373 696e 6720 6120 7661 6c75 652c  missing a value,
-0000dc20: 207a 6572 6f73 2077 696c 6c20 6e6f 7420   zeros will not 
-0000dc30: 6166 6665 6374 206e 702e 6372 6f73 733a  affect np.cross:
-0000dc40: 0a0a 2020 2020 2020 2020 6966 2028 0a20  ..        if (. 
-0000dc50: 2020 2020 2020 2020 2020 206e 6f74 2069             not i
-0000dc60: 7369 6e73 7461 6e63 6528 612c 2056 6172  sinstance(a, Var
-0000dc70: 6961 626c 6529 2020 2320 4f6e 6c79 2075  iable)  # Only u
-0000dc80: 7365 6420 746f 206d 616b 6520 6d79 7079  sed to make mypy
-0000dc90: 2068 6170 7079 2e0a 2020 2020 2020 2020   happy..        
-0000dca0: 2020 2020 616e 6420 6469 6d20 696e 2067      and dim in g
-0000dcb0: 6574 6174 7472 2861 2c20 2263 6f6f 7264  etattr(a, "coord
-0000dcc0: 7322 2c20 7b7d 290a 2020 2020 2020 2020  s", {}).        
-0000dcd0: 2020 2020 616e 6420 6e6f 7420 6973 696e      and not isin
-0000dce0: 7374 616e 6365 2862 2c20 5661 7269 6162  stance(b, Variab
-0000dcf0: 6c65 2920 2023 204f 6e6c 7920 7573 6564  le)  # Only used
-0000dd00: 2074 6f20 6d61 6b65 206d 7970 7920 6861   to make mypy ha
-0000dd10: 7070 792e 0a20 2020 2020 2020 2020 2020  ppy..           
-0000dd20: 2061 6e64 2064 696d 2069 6e20 6765 7461   and dim in geta
-0000dd30: 7474 7228 622c 2022 636f 6f72 6473 222c  ttr(b, "coords",
-0000dd40: 207b 7d29 0a20 2020 2020 2020 2029 3a0a   {}).        ):.
-0000dd50: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-0000dd60: 2074 6865 2061 7272 6179 7320 6861 7665   the arrays have
-0000dd70: 2063 6f6f 7264 7320 7765 206b 6e6f 7720   coords we know 
-0000dd80: 7768 6963 6820 696e 6465 7865 7320 746f  which indexes to
-0000dd90: 2066 696c 6c0a 2020 2020 2020 2020 2020   fill.          
-0000dda0: 2020 2320 7769 7468 207a 6572 6f73 3a0a    # with zeros:.
-0000ddb0: 2020 2020 2020 2020 2020 2020 612c 2062              a, b
-0000ddc0: 203d 2061 6c69 676e 280a 2020 2020 2020   = align(.      
-0000ddd0: 2020 2020 2020 2020 2020 612c 0a20 2020            a,.   
-0000dde0: 2020 2020 2020 2020 2020 2020 2062 2c0a               b,.
-0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de00: 6669 6c6c 5f76 616c 7565 3d30 2c0a 2020  fill_value=0,.  
-0000de10: 2020 2020 2020 2020 2020 2020 2020 6a6f                jo
-0000de20: 696e 3d22 6f75 7465 7222 2c0a 2020 2020  in="outer",.    
-0000de30: 2020 2020 2020 2020 2020 2020 6578 636c              excl
-0000de40: 7564 653d 7365 7428 616c 6c5f 6469 6d73  ude=set(all_dims
-0000de50: 2920 2d20 7b64 696d 7d2c 0a20 2020 2020  ) - {dim},.     
-0000de60: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000de70: 2065 6c69 6620 6d69 6e28 612e 7369 7a65   elif min(a.size
-0000de80: 735b 6469 6d5d 2c20 622e 7369 7a65 735b  s[dim], b.sizes[
-0000de90: 6469 6d5d 2920 3d3d 2032 3a0a 2020 2020  dim]) == 2:.    
-0000dea0: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-0000deb0: 2061 7272 6179 2064 6f65 736e 2774 2068   array doesn't h
-0000dec0: 6176 6520 636f 6f72 6473 2077 6520 6361  ave coords we ca
-0000ded0: 6e20 6f6e 6c79 2069 6e66 6572 0a20 2020  n only infer.   
-0000dee0: 2020 2020 2020 2020 2023 2074 6861 7420           # that 
-0000def0: 6974 2068 6173 2063 6f6d 706f 7369 7465  it has composite
-0000df00: 2076 616c 7565 7320 6966 2074 6865 2073   values if the s
-0000df10: 697a 6520 6973 2061 7420 6c65 6173 7420  ize is at least 
-0000df20: 322e 0a20 2020 2020 2020 2020 2020 2023  2..            #
-0000df30: 204f 6e63 6520 7061 6464 6564 2c20 7265   Once padded, re
-0000df40: 6368 756e 6b20 7468 6520 7061 6464 6564  chunk the padded
-0000df50: 2061 7272 6179 2062 6563 6175 7365 2061   array because a
-0000df60: 7070 6c79 5f75 6675 6e63 0a20 2020 2020  pply_ufunc.     
-0000df70: 2020 2020 2020 2023 2072 6571 7569 7265         # require
-0000df80: 7320 636f 7265 2064 696d 656e 7369 6f6e  s core dimension
-0000df90: 7320 6e6f 7420 746f 2062 6520 6368 756e  s not to be chun
-0000dfa0: 6b65 643a 0a20 2020 2020 2020 2020 2020  ked:.           
-0000dfb0: 2069 6620 612e 7369 7a65 735b 6469 6d5d   if a.sizes[dim]
-0000dfc0: 203c 2062 2e73 697a 6573 5b64 696d 5d3a   < b.sizes[dim]:
-0000dfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dfe0: 2061 203d 2061 2e70 6164 287b 6469 6d3a   a = a.pad({dim:
-0000dff0: 2028 302c 2031 297d 2c20 636f 6e73 7461   (0, 1)}, consta
-0000e000: 6e74 5f76 616c 7565 733d 3029 0a20 2020  nt_values=0).   
-0000e010: 2020 2020 2020 2020 2020 2020 2023 2054               # T
-0000e020: 4f44 4f3a 2053 686f 756c 6420 7061 6420  ODO: Should pad 
-0000e030: 6f72 2061 7070 6c79 5f75 6675 6e63 2068  or apply_ufunc h
-0000e040: 616e 646c 6520 636f 7272 6563 7420 6368  andle correct ch
-0000e050: 756e 6b69 6e67 3f0a 2020 2020 2020 2020  unking?.        
-0000e060: 2020 2020 2020 2020 6120 3d20 612e 6368          a = a.ch
-0000e070: 756e 6b28 7b64 696d 3a20 2d31 7d29 2069  unk({dim: -1}) i
-0000e080: 6620 6973 5f64 7563 6b5f 6461 736b 5f61  f is_duck_dask_a
-0000e090: 7272 6179 2861 2e64 6174 6129 2065 6c73  rray(a.data) els
-0000e0a0: 6520 610a 2020 2020 2020 2020 2020 2020  e a.            
-0000e0b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000e0c0: 2020 2020 2020 6220 3d20 622e 7061 6428        b = b.pad(
-0000e0d0: 7b64 696d 3a20 2830 2c20 3129 7d2c 2063  {dim: (0, 1)}, c
-0000e0e0: 6f6e 7374 616e 745f 7661 6c75 6573 3d30  onstant_values=0
-0000e0f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e100: 2020 2320 544f 444f 3a20 5368 6f75 6c64    # TODO: Should
-0000e110: 2070 6164 206f 7220 6170 706c 795f 7566   pad or apply_uf
-0000e120: 756e 6320 6861 6e64 6c65 2063 6f72 7265  unc handle corre
-0000e130: 6374 2063 6875 6e6b 696e 673f 0a20 2020  ct chunking?.   
-0000e140: 2020 2020 2020 2020 2020 2020 2062 203d               b =
-0000e150: 2062 2e63 6875 6e6b 287b 6469 6d3a 202d   b.chunk({dim: -
-0000e160: 317d 2920 6966 2069 735f 6475 636b 5f64  1}) if is_duck_d
-0000e170: 6173 6b5f 6172 7261 7928 622e 6461 7461  ask_array(b.data
-0000e180: 2920 656c 7365 2062 0a20 2020 2020 2020  ) else b.       
-0000e190: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000e1a0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000e1b0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0000e1c0: 2020 2020 2066 227b 6469 6d21 727d 206f       f"{dim!r} o
-0000e1d0: 6e20 7b27 6127 2069 6620 612e 7369 7a65  n {'a' if a.size
-0000e1e0: 735b 6469 6d5d 203d 3d20 3120 656c 7365  s[dim] == 1 else
-0000e1f0: 2027 6227 7d20 6973 2069 6e63 6f6d 7061   'b'} is incompa
-0000e200: 7469 626c 653a 220a 2020 2020 2020 2020  tible:".        
-0000e210: 2020 2020 2020 2020 2220 6469 6d65 6e73          " dimens
-0000e220: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
-0000e230: 7264 696e 6174 6573 206d 7573 7420 6861  rdinates must ha
-0000e240: 7665 2068 6176 6520 6120 6c65 6e67 7468  ve have a length
-0000e250: 206f 6620 3220 6f72 2033 220a 2020 2020   of 2 or 3".    
-0000e260: 2020 2020 2020 2020 290a 0a20 2020 2063          )..    c
-0000e270: 203d 2061 7070 6c79 5f75 6675 6e63 280a   = apply_ufunc(.
-0000e280: 2020 2020 2020 2020 6e70 2e63 726f 7373          np.cross
-0000e290: 2c0a 2020 2020 2020 2020 612c 0a20 2020  ,.        a,.   
-0000e2a0: 2020 2020 2062 2c0a 2020 2020 2020 2020       b,.        
-0000e2b0: 696e 7075 745f 636f 7265 5f64 696d 733d  input_core_dims=
-0000e2c0: 5b5b 6469 6d5d 2c20 5b64 696d 5d5d 2c0a  [[dim], [dim]],.
-0000e2d0: 2020 2020 2020 2020 6f75 7470 7574 5f63          output_c
-0000e2e0: 6f72 655f 6469 6d73 3d5b 5b64 696d 5d20  ore_dims=[[dim] 
-0000e2f0: 6966 2061 2e73 697a 6573 5b64 696d 5d20  if a.sizes[dim] 
-0000e300: 3d3d 2033 2065 6c73 6520 5b5d 5d2c 0a20  == 3 else []],. 
-0000e310: 2020 2020 2020 2064 6173 6b3d 2270 6172         dask="par
-0000e320: 616c 6c65 6c69 7a65 6422 2c0a 2020 2020  allelized",.    
-0000e330: 2020 2020 6f75 7470 7574 5f64 7479 7065      output_dtype
-0000e340: 733d 5b6e 702e 7265 7375 6c74 5f74 7970  s=[np.result_typ
-0000e350: 6528 612c 2062 295d 2c0a 2020 2020 290a  e(a, b)],.    ).
-0000e360: 2020 2020 6320 3d20 632e 7472 616e 7370      c = c.transp
-0000e370: 6f73 6528 2a61 6c6c 5f64 696d 732c 206d  ose(*all_dims, m
-0000e380: 6973 7369 6e67 5f64 696d 733d 2269 676e  issing_dims="ign
-0000e390: 6f72 6522 290a 0a20 2020 2072 6574 7572  ore")..    retur
-0000e3a0: 6e20 630a 0a0a 6465 6620 646f 7428 0a20  n c...def dot(. 
-0000e3b0: 2020 202a 6172 7261 7973 2c0a 2020 2020     *arrays,.    
-0000e3c0: 6469 6d73 3a20 4469 6d73 203d 204e 6f6e  dims: Dims = Non
-0000e3d0: 652c 0a20 2020 202a 2a6b 7761 7267 733a  e,.    **kwargs:
-0000e3e0: 2041 6e79 2c0a 293a 0a20 2020 2022 2222   Any,.):.    """
-0000e3f0: 4765 6e65 7261 6c69 7a65 6420 646f 7420  Generalized dot 
-0000e400: 7072 6f64 7563 7420 666f 7220 7861 7272  product for xarr
-0000e410: 6179 206f 626a 6563 7473 2e20 4c69 6b65  ay objects. Like
-0000e420: 206e 702e 6569 6e73 756d 2c20 6275 740a   np.einsum, but.
-0000e430: 2020 2020 7072 6f76 6964 6573 2061 2073      provides a s
-0000e440: 696d 706c 6572 2069 6e74 6572 6661 6365  impler interface
-0000e450: 2062 6173 6564 206f 6e20 6172 7261 7920   based on array 
-0000e460: 6469 6d65 6e73 696f 6e73 2e0a 0a20 2020  dimensions...   
-0000e470: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0000e480: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 202a  ----------.    *
-0000e490: 6172 7261 7973 203a 2044 6174 6141 7272  arrays : DataArr
-0000e4a0: 6179 206f 7220 5661 7269 6162 6c65 0a20  ay or Variable. 
-0000e4b0: 2020 2020 2020 2041 7272 6179 7320 746f         Arrays to
-0000e4c0: 2063 6f6d 7075 7465 2e0a 2020 2020 6469   compute..    di
-0000e4d0: 6d73 203a 2073 7472 2c20 6974 6572 6162  ms : str, iterab
-0000e4e0: 6c65 206f 6620 6861 7368 6162 6c65 2c20  le of hashable, 
-0000e4f0: 222e 2e2e 2220 6f72 204e 6f6e 652c 206f  "..." or None, o
-0000e500: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0000e510: 5768 6963 6820 6469 6d65 6e73 696f 6e73  Which dimensions
-0000e520: 2074 6f20 7375 6d20 6f76 6572 2e20 456c   to sum over. El
-0000e530: 6c69 7073 6973 2028 272e 2e2e 2729 2073  lipsis ('...') s
-0000e540: 756d 7320 6f76 6572 2061 6c6c 2064 696d  ums over all dim
-0000e550: 656e 7369 6f6e 732e 0a20 2020 2020 2020  ensions..       
-0000e560: 2049 6620 6e6f 7420 7370 6563 6966 6965   If not specifie
-0000e570: 642c 2074 6865 6e20 616c 6c20 7468 6520  d, then all the 
-0000e580: 636f 6d6d 6f6e 2064 696d 656e 7369 6f6e  common dimension
-0000e590: 7320 6172 6520 7375 6d6d 6564 206f 7665  s are summed ove
-0000e5a0: 722e 0a20 2020 202a 2a6b 7761 7267 7320  r..    **kwargs 
-0000e5b0: 3a20 6469 6374 0a20 2020 2020 2020 2041  : dict.        A
-0000e5c0: 6464 6974 696f 6e61 6c20 6b65 7977 6f72  dditional keywor
-0000e5d0: 6420 6172 6775 6d65 6e74 7320 7061 7373  d arguments pass
-0000e5e0: 6564 2074 6f20 6e75 6d70 792e 6569 6e73  ed to numpy.eins
-0000e5f0: 756d 206f 720a 2020 2020 2020 2020 6461  um or.        da
-0000e600: 736b 2e61 7272 6179 2e65 696e 7375 6d0a  sk.array.einsum.
-0000e610: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-0000e620: 202d 2d2d 2d2d 2d2d 0a20 2020 2044 6174   -------.    Dat
-0000e630: 6141 7272 6179 0a0a 2020 2020 4578 616d  aArray..    Exam
-0000e640: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
-0000e650: 2d0a 2020 2020 3e3e 3e20 6461 5f61 203d  -.    >>> da_a =
-0000e660: 2078 722e 4461 7461 4172 7261 7928 6e70   xr.DataArray(np
-0000e670: 2e61 7261 6e67 6528 3320 2a20 3229 2e72  .arange(3 * 2).r
-0000e680: 6573 6861 7065 2833 2c20 3229 2c20 6469  eshape(3, 2), di
-0000e690: 6d73 3d5b 2261 222c 2022 6222 5d29 0a20  ms=["a", "b"]). 
-0000e6a0: 2020 203e 3e3e 2064 615f 6220 3d20 7872     >>> da_b = xr
-0000e6b0: 2e44 6174 6141 7272 6179 286e 702e 6172  .DataArray(np.ar
-0000e6c0: 616e 6765 2833 202a 2032 202a 2032 292e  ange(3 * 2 * 2).
-0000e6d0: 7265 7368 6170 6528 332c 2032 2c20 3229  reshape(3, 2, 2)
-0000e6e0: 2c20 6469 6d73 3d5b 2261 222c 2022 6222  , dims=["a", "b"
-0000e6f0: 2c20 2263 225d 290a 2020 2020 3e3e 3e20  , "c"]).    >>> 
-0000e700: 6461 5f63 203d 2078 722e 4461 7461 4172  da_c = xr.DataAr
-0000e710: 7261 7928 6e70 2e61 7261 6e67 6528 3220  ray(np.arange(2 
-0000e720: 2a20 3329 2e72 6573 6861 7065 2832 2c20  * 3).reshape(2, 
-0000e730: 3329 2c20 6469 6d73 3d5b 2263 222c 2022  3), dims=["c", "
-0000e740: 6422 5d29 0a0a 2020 2020 3e3e 3e20 6461  d"])..    >>> da
-0000e750: 5f61 0a20 2020 203c 7861 7272 6179 2e44  _a.    <xarray.D
-0000e760: 6174 6141 7272 6179 2028 613a 2033 2c20  ataArray (a: 3, 
-0000e770: 623a 2032 293e 0a20 2020 2061 7272 6179  b: 2)>.    array
-0000e780: 285b 5b30 2c20 315d 2c0a 2020 2020 2020  ([[0, 1],.      
-0000e790: 2020 2020 205b 322c 2033 5d2c 0a20 2020       [2, 3],.   
-0000e7a0: 2020 2020 2020 2020 5b34 2c20 355d 5d29          [4, 5]])
-0000e7b0: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
-0000e7c0: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-0000e7d0: 7465 733a 2061 2c20 620a 0a20 2020 203e  tes: a, b..    >
-0000e7e0: 3e3e 2064 615f 620a 2020 2020 3c78 6172  >> da_b.    <xar
-0000e7f0: 7261 792e 4461 7461 4172 7261 7920 2861  ray.DataArray (a
-0000e800: 3a20 332c 2062 3a20 322c 2063 3a20 3229  : 3, b: 2, c: 2)
-0000e810: 3e0a 2020 2020 6172 7261 7928 5b5b 5b20  >.    array([[[ 
-0000e820: 302c 2020 315d 2c0a 2020 2020 2020 2020  0,  1],.        
-0000e830: 2020 2020 5b20 322c 2020 335d 5d2c 0a20      [ 2,  3]],. 
-0000e840: 2020 203c 424c 414e 4b4c 494e 453e 0a20     <BLANKLINE>. 
-0000e850: 2020 2020 2020 2020 2020 5b5b 2034 2c20            [[ 4, 
-0000e860: 2035 5d2c 0a20 2020 2020 2020 2020 2020   5],.           
-0000e870: 205b 2036 2c20 2037 5d5d 2c0a 2020 2020   [ 6,  7]],.    
-0000e880: 3c42 4c41 4e4b 4c49 4e45 3e0a 2020 2020  <BLANKLINE>.    
-0000e890: 2020 2020 2020 205b 5b20 382c 2020 395d         [[ 8,  9]
-0000e8a0: 2c0a 2020 2020 2020 2020 2020 2020 5b31  ,.            [1
-0000e8b0: 302c 2031 315d 5d5d 290a 2020 2020 4469  0, 11]]]).    Di
-0000e8c0: 6d65 6e73 696f 6e73 2077 6974 686f 7574  mensions without
-0000e8d0: 2063 6f6f 7264 696e 6174 6573 3a20 612c   coordinates: a,
-0000e8e0: 2062 2c20 630a 0a20 2020 203e 3e3e 2064   b, c..    >>> d
-0000e8f0: 615f 630a 2020 2020 3c78 6172 7261 792e  a_c.    <xarray.
-0000e900: 4461 7461 4172 7261 7920 2863 3a20 322c  DataArray (c: 2,
-0000e910: 2064 3a20 3329 3e0a 2020 2020 6172 7261   d: 3)>.    arra
-0000e920: 7928 5b5b 302c 2031 2c20 325d 2c0a 2020  y([[0, 1, 2],.  
-0000e930: 2020 2020 2020 2020 205b 332c 2034 2c20           [3, 4, 
-0000e940: 355d 5d29 0a20 2020 2044 696d 656e 7369  5]]).    Dimensi
-0000e950: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
-0000e960: 6469 6e61 7465 733a 2063 2c20 640a 0a20  dinates: c, d.. 
-0000e970: 2020 203e 3e3e 2078 722e 646f 7428 6461     >>> xr.dot(da
-0000e980: 5f61 2c20 6461 5f62 2c20 6469 6d73 3d5b  _a, da_b, dims=[
-0000e990: 2261 222c 2022 6222 5d29 0a20 2020 203c  "a", "b"]).    <
-0000e9a0: 7861 7272 6179 2e44 6174 6141 7272 6179  xarray.DataArray
-0000e9b0: 2028 633a 2032 293e 0a20 2020 2061 7272   (c: 2)>.    arr
-0000e9c0: 6179 285b 3131 302c 2031 3235 5d29 0a20  ay([110, 125]). 
-0000e9d0: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
-0000e9e0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
-0000e9f0: 733a 2063 0a0a 2020 2020 3e3e 3e20 7872  s: c..    >>> xr
-0000ea00: 2e64 6f74 2864 615f 612c 2064 615f 622c  .dot(da_a, da_b,
-0000ea10: 2064 696d 733d 5b22 6122 5d29 0a20 2020   dims=["a"]).   
-0000ea20: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
-0000ea30: 6179 2028 623a 2032 2c20 633a 2032 293e  ay (b: 2, c: 2)>
-0000ea40: 0a20 2020 2061 7272 6179 285b 5b34 302c  .    array([[40,
-0000ea50: 2034 365d 2c0a 2020 2020 2020 2020 2020   46],.          
-0000ea60: 205b 3730 2c20 3739 5d5d 290a 2020 2020   [70, 79]]).    
-0000ea70: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
-0000ea80: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
-0000ea90: 622c 2063 0a0a 2020 2020 3e3e 3e20 7872  b, c..    >>> xr
-0000eaa0: 2e64 6f74 2864 615f 612c 2064 615f 622c  .dot(da_a, da_b,
-0000eab0: 2064 615f 632c 2064 696d 733d 5b22 6222   da_c, dims=["b"
-0000eac0: 2c20 2263 225d 290a 2020 2020 3c78 6172  , "c"]).    <xar
-0000ead0: 7261 792e 4461 7461 4172 7261 7920 2861  ray.DataArray (a
-0000eae0: 3a20 332c 2064 3a20 3329 3e0a 2020 2020  : 3, d: 3)>.    
-0000eaf0: 6172 7261 7928 5b5b 2020 392c 2020 3134  array([[  9,  14
-0000eb00: 2c20 2031 395d 2c0a 2020 2020 2020 2020  ,  19],.        
-0000eb10: 2020 205b 2039 332c 2031 3530 2c20 3230     [ 93, 150, 20
-0000eb20: 375d 2c0a 2020 2020 2020 2020 2020 205b  7],.           [
-0000eb30: 3237 332c 2034 3436 2c20 3631 395d 5d29  273, 446, 619]])
-0000eb40: 0a20 2020 2044 696d 656e 7369 6f6e 7320  .    Dimensions 
-0000eb50: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-0000eb60: 7465 733a 2061 2c20 640a 0a20 2020 203e  tes: a, d..    >
-0000eb70: 3e3e 2078 722e 646f 7428 6461 5f61 2c20  >> xr.dot(da_a, 
-0000eb80: 6461 5f62 290a 2020 2020 3c78 6172 7261  da_b).    <xarra
-0000eb90: 792e 4461 7461 4172 7261 7920 2863 3a20  y.DataArray (c: 
-0000eba0: 3229 3e0a 2020 2020 6172 7261 7928 5b31  2)>.    array([1
-0000ebb0: 3130 2c20 3132 355d 290a 2020 2020 4469  10, 125]).    Di
-0000ebc0: 6d65 6e73 696f 6e73 2077 6974 686f 7574  mensions without
-0000ebd0: 2063 6f6f 7264 696e 6174 6573 3a20 630a   coordinates: c.
-0000ebe0: 0a20 2020 203e 3e3e 2078 722e 646f 7428  .    >>> xr.dot(
-0000ebf0: 6461 5f61 2c20 6461 5f62 2c20 6469 6d73  da_a, da_b, dims
-0000ec00: 3d2e 2e2e 290a 2020 2020 3c78 6172 7261  =...).    <xarra
-0000ec10: 792e 4461 7461 4172 7261 7920 2829 3e0a  y.DataArray ()>.
-0000ec20: 2020 2020 6172 7261 7928 3233 3529 0a20      array(235). 
-0000ec30: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
-0000ec40: 7861 7272 6179 2e63 6f72 652e 6461 7461  xarray.core.data
-0000ec50: 6172 7261 7920 696d 706f 7274 2044 6174  array import Dat
-0000ec60: 6141 7272 6179 0a20 2020 2066 726f 6d20  aArray.    from 
-0000ec70: 7861 7272 6179 2e63 6f72 652e 7661 7269  xarray.core.vari
-0000ec80: 6162 6c65 2069 6d70 6f72 7420 5661 7269  able import Vari
-0000ec90: 6162 6c65 0a0a 2020 2020 6966 2061 6e79  able..    if any
-0000eca0: 286e 6f74 2069 7369 6e73 7461 6e63 6528  (not isinstance(
-0000ecb0: 6172 722c 2028 5661 7269 6162 6c65 2c20  arr, (Variable, 
-0000ecc0: 4461 7461 4172 7261 7929 2920 666f 7220  DataArray)) for 
-0000ecd0: 6172 7220 696e 2061 7272 6179 7329 3a0a  arr in arrays):.
-0000ece0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-0000ecf0: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
-0000ed00: 2020 2020 2022 4f6e 6c79 2078 722e 4461       "Only xr.Da
-0000ed10: 7461 4172 7261 7920 616e 6420 7872 2e56  taArray and xr.V
-0000ed20: 6172 6961 626c 6520 6172 6520 7375 7070  ariable are supp
-0000ed30: 6f72 7465 642e 220a 2020 2020 2020 2020  orted.".        
-0000ed40: 2020 2020 2247 6976 656e 207b 7d2e 222e      "Given {}.".
-0000ed50: 666f 726d 6174 285b 7479 7065 2861 7272  format([type(arr
-0000ed60: 2920 666f 7220 6172 7220 696e 2061 7272  ) for arr in arr
-0000ed70: 6179 735d 290a 2020 2020 2020 2020 290a  ays]).        ).
-0000ed80: 0a20 2020 2069 6620 6c65 6e28 6172 7261  .    if len(arra
-0000ed90: 7973 2920 3d3d 2030 3a0a 2020 2020 2020  ys) == 0:.      
-0000eda0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-0000edb0: 7228 2241 7420 6c65 6173 7420 6f6e 6520  r("At least one 
-0000edc0: 6172 7261 7920 7368 6f75 6c64 2062 6520  array should be 
-0000edd0: 6769 7665 6e2e 2229 0a0a 2020 2020 636f  given.")..    co
-0000ede0: 6d6d 6f6e 5f64 696d 733a 2073 6574 5b48  mmon_dims: set[H
-0000edf0: 6173 6861 626c 655d 203d 2073 6574 2e69  ashable] = set.i
-0000ee00: 6e74 6572 7365 6374 696f 6e28 2a28 7365  ntersection(*(se
-0000ee10: 7428 6172 722e 6469 6d73 2920 666f 7220  t(arr.dims) for 
-0000ee20: 6172 7220 696e 2061 7272 6179 7329 290a  arr in arrays)).
-0000ee30: 2020 2020 616c 6c5f 6469 6d73 203d 205b      all_dims = [
-0000ee40: 5d0a 2020 2020 666f 7220 6172 7220 696e  ].    for arr in
-0000ee50: 2061 7272 6179 733a 0a20 2020 2020 2020   arrays:.       
-0000ee60: 2061 6c6c 5f64 696d 7320 2b3d 205b 6420   all_dims += [d 
-0000ee70: 666f 7220 6420 696e 2061 7272 2e64 696d  for d in arr.dim
-0000ee80: 7320 6966 2064 206e 6f74 2069 6e20 616c  s if d not in al
-0000ee90: 6c5f 6469 6d73 5d0a 0a20 2020 2065 696e  l_dims]..    ein
-0000eea0: 7375 6d5f 6178 6573 203d 2022 6162 6364  sum_axes = "abcd
-0000eeb0: 6566 6768 696a 6b6c 6d6e 6f70 7172 7374  efghijklmnopqrst
-0000eec0: 7576 7778 797a 220a 2020 2020 6469 6d5f  uvwxyz".    dim_
-0000eed0: 6d61 7020 3d20 7b64 3a20 6569 6e73 756d  map = {d: einsum
-0000eee0: 5f61 7865 735b 695d 2066 6f72 2069 2c20  _axes[i] for i, 
-0000eef0: 6420 696e 2065 6e75 6d65 7261 7465 2861  d in enumerate(a
-0000ef00: 6c6c 5f64 696d 7329 7d0a 0a20 2020 2069  ll_dims)}..    i
-0000ef10: 6620 6469 6d73 2069 7320 2e2e 2e3a 0a20  f dims is ...:. 
-0000ef20: 2020 2020 2020 2064 696d 7320 3d20 616c         dims = al
-0000ef30: 6c5f 6469 6d73 0a20 2020 2065 6c69 6620  l_dims.    elif 
-0000ef40: 6973 696e 7374 616e 6365 2864 696d 732c  isinstance(dims,
-0000ef50: 2073 7472 293a 0a20 2020 2020 2020 2064   str):.        d
-0000ef60: 696d 7320 3d20 2864 696d 732c 290a 2020  ims = (dims,).  
-0000ef70: 2020 656c 6966 2064 696d 7320 6973 204e    elif dims is N
-0000ef80: 6f6e 653a 0a20 2020 2020 2020 2023 2066  one:.        # f
-0000ef90: 696e 6420 6469 6d65 6e73 696f 6e73 2074  ind dimensions t
-0000efa0: 6861 7420 6f63 6375 7220 6d6f 7265 2074  hat occur more t
-0000efb0: 6861 6e20 6f6e 6520 7469 6d65 730a 2020  han one times.  
-0000efc0: 2020 2020 2020 6469 6d5f 636f 756e 7473        dim_counts
-0000efd0: 3a20 436f 756e 7465 7220 3d20 436f 756e  : Counter = Coun
-0000efe0: 7465 7228 290a 2020 2020 2020 2020 666f  ter().        fo
-0000eff0: 7220 6172 7220 696e 2061 7272 6179 733a  r arr in arrays:
-0000f000: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-0000f010: 5f63 6f75 6e74 732e 7570 6461 7465 2861  _counts.update(a
-0000f020: 7272 2e64 696d 7329 0a20 2020 2020 2020  rr.dims).       
-0000f030: 2064 696d 7320 3d20 7475 706c 6528 6420   dims = tuple(d 
-0000f040: 666f 7220 642c 2063 2069 6e20 6469 6d5f  for d, c in dim_
-0000f050: 636f 756e 7473 2e69 7465 6d73 2829 2069  counts.items() i
-0000f060: 6620 6320 3e20 3129 0a0a 2020 2020 646f  f c > 1)..    do
-0000f070: 745f 6469 6d73 3a20 7365 745b 4861 7368  t_dims: set[Hash
-0000f080: 6162 6c65 5d20 3d20 7365 7428 6469 6d73  able] = set(dims
-0000f090: 290a 0a20 2020 2023 2064 696d 656e 7369  )..    # dimensi
-0000f0a0: 6f6e 7320 746f 2062 6520 7061 7261 6c6c  ons to be parall
-0000f0b0: 656c 697a 6564 0a20 2020 2062 726f 6164  elized.    broad
-0000f0c0: 6361 7374 5f64 696d 7320 3d20 636f 6d6d  cast_dims = comm
-0000f0d0: 6f6e 5f64 696d 7320 2d20 646f 745f 6469  on_dims - dot_di
-0000f0e0: 6d73 0a20 2020 2069 6e70 7574 5f63 6f72  ms.    input_cor
-0000f0f0: 655f 6469 6d73 203d 205b 0a20 2020 2020  e_dims = [.     
-0000f100: 2020 205b 6420 666f 7220 6420 696e 2061     [d for d in a
-0000f110: 7272 2e64 696d 7320 6966 2064 206e 6f74  rr.dims if d not
-0000f120: 2069 6e20 6272 6f61 6463 6173 745f 6469   in broadcast_di
-0000f130: 6d73 5d20 666f 7220 6172 7220 696e 2061  ms] for arr in a
-0000f140: 7272 6179 730a 2020 2020 5d0a 2020 2020  rrays.    ].    
-0000f150: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
-0000f160: 203d 205b 0a20 2020 2020 2020 205b 6420   = [.        [d 
-0000f170: 666f 7220 6420 696e 2061 6c6c 5f64 696d  for d in all_dim
-0000f180: 7320 6966 2064 206e 6f74 2069 6e20 646f  s if d not in do
-0000f190: 745f 6469 6d73 2061 6e64 2064 206e 6f74  t_dims and d not
-0000f1a0: 2069 6e20 6272 6f61 6463 6173 745f 6469   in broadcast_di
-0000f1b0: 6d73 5d0a 2020 2020 5d0a 0a20 2020 2023  ms].    ]..    #
-0000f1c0: 2063 6f6e 7374 7275 6374 2065 696e 7375   construct einsu
-0000f1d0: 6d20 7375 6273 6372 6970 7473 2c20 7375  m subscripts, su
-0000f1e0: 6368 2061 7320 272e 2e2e 6162 632c 2e2e  ch as '...abc,..
-0000f1f0: 2e61 622d 3e2e 2e2e 6327 0a20 2020 2023  .ab->...c'.    #
-0000f200: 204e 6f74 653a 2069 6e70 7574 5f63 6f72   Note: input_cor
-0000f210: 655f 6469 6d73 2061 7265 2061 6c77 6179  e_dims are alway
-0000f220: 7320 6d6f 7665 6420 746f 2074 6865 206c  s moved to the l
-0000f230: 6173 7420 706f 7369 7469 6f6e 0a20 2020  ast position.   
-0000f240: 2073 7562 7363 7269 7074 735f 6c69 7374   subscripts_list
-0000f250: 203d 205b 0a20 2020 2020 2020 2022 2e2e   = [.        "..
-0000f260: 2e22 202b 2022 222e 6a6f 696e 2864 696d  ." + "".join(dim
-0000f270: 5f6d 6170 5b64 5d20 666f 7220 6420 696e  _map[d] for d in
-0000f280: 2064 7329 2066 6f72 2064 7320 696e 2069   ds) for ds in i
-0000f290: 6e70 7574 5f63 6f72 655f 6469 6d73 0a20  nput_core_dims. 
-0000f2a0: 2020 205d 0a20 2020 2073 7562 7363 7269     ].    subscri
-0000f2b0: 7074 7320 3d20 222c 222e 6a6f 696e 2873  pts = ",".join(s
-0000f2c0: 7562 7363 7269 7074 735f 6c69 7374 290a  ubscripts_list).
-0000f2d0: 2020 2020 7375 6273 6372 6970 7473 202b      subscripts +
-0000f2e0: 3d20 222d 3e2e 2e2e 2220 2b20 2222 2e6a  = "->..." + "".j
-0000f2f0: 6f69 6e28 6469 6d5f 6d61 705b 645d 2066  oin(dim_map[d] f
-0000f300: 6f72 2064 2069 6e20 6f75 7470 7574 5f63  or d in output_c
-0000f310: 6f72 655f 6469 6d73 5b30 5d29 0a0a 2020  ore_dims[0])..  
-0000f320: 2020 6a6f 696e 203d 204f 5054 494f 4e53    join = OPTIONS
-0000f330: 5b22 6172 6974 686d 6574 6963 5f6a 6f69  ["arithmetic_joi
-0000f340: 6e22 5d0a 2020 2020 2320 7573 696e 6720  n"].    # using 
-0000f350: 2269 6e6e 6572 2220 656d 756c 6174 6573  "inner" emulates
-0000f360: 2060 2861 202a 2062 292e 7375 6d28 2960   `(a * b).sum()`
-0000f370: 2066 6f72 2061 6c6c 206a 6f69 6e73 2028   for all joins (
-0000f380: 6578 6365 7074 2022 6578 6163 7422 290a  except "exact").
-0000f390: 2020 2020 6966 206a 6f69 6e20 213d 2022      if join != "
-0000f3a0: 6578 6163 7422 3a0a 2020 2020 2020 2020  exact":.        
-0000f3b0: 6a6f 696e 203d 2022 696e 6e65 7222 0a0a  join = "inner"..
-0000f3c0: 2020 2020 2320 7375 6273 6372 6970 7473      # subscripts
-0000f3d0: 2073 686f 756c 6420 6265 2070 6173 7365   should be passe
-0000f3e0: 6420 746f 206e 702e 6569 6e73 756d 2061  d to np.einsum a
-0000f3f0: 7320 6172 672c 206e 6f74 2061 7320 6b77  s arg, not as kw
-0000f400: 6172 6773 2e20 5765 206e 6565 640a 2020  args. We need.  
-0000f410: 2020 2320 746f 2063 6f6e 7374 7275 6374    # to construct
-0000f420: 2061 2070 6172 7469 616c 2066 756e 6374   a partial funct
-0000f430: 696f 6e20 666f 7220 6170 706c 795f 7566  ion for apply_uf
-0000f440: 756e 6320 746f 2077 6f72 6b2e 0a20 2020  unc to work..   
-0000f450: 2066 756e 6320 3d20 6675 6e63 746f 6f6c   func = functool
-0000f460: 732e 7061 7274 6961 6c28 6475 636b 5f61  s.partial(duck_a
-0000f470: 7272 6179 5f6f 7073 2e65 696e 7375 6d2c  rray_ops.einsum,
-0000f480: 2073 7562 7363 7269 7074 732c 202a 2a6b   subscripts, **k
-0000f490: 7761 7267 7329 0a20 2020 2072 6573 756c  wargs).    resul
-0000f4a0: 7420 3d20 6170 706c 795f 7566 756e 6328  t = apply_ufunc(
-0000f4b0: 0a20 2020 2020 2020 2066 756e 632c 0a20  .        func,. 
-0000f4c0: 2020 2020 2020 202a 6172 7261 7973 2c0a         *arrays,.
-0000f4d0: 2020 2020 2020 2020 696e 7075 745f 636f          input_co
-0000f4e0: 7265 5f64 696d 733d 696e 7075 745f 636f  re_dims=input_co
-0000f4f0: 7265 5f64 696d 732c 0a20 2020 2020 2020  re_dims,.       
-0000f500: 206f 7574 7075 745f 636f 7265 5f64 696d   output_core_dim
-0000f510: 733d 6f75 7470 7574 5f63 6f72 655f 6469  s=output_core_di
-0000f520: 6d73 2c0a 2020 2020 2020 2020 6a6f 696e  ms,.        join
-0000f530: 3d6a 6f69 6e2c 0a20 2020 2020 2020 2064  =join,.        d
-0000f540: 6173 6b3d 2261 6c6c 6f77 6564 222c 0a20  ask="allowed",. 
-0000f550: 2020 2029 0a20 2020 2072 6574 7572 6e20     ).    return 
-0000f560: 7265 7375 6c74 2e74 7261 6e73 706f 7365  result.transpose
-0000f570: 282a 616c 6c5f 6469 6d73 2c20 6d69 7373  (*all_dims, miss
-0000f580: 696e 675f 6469 6d73 3d22 6967 6e6f 7265  ing_dims="ignore
-0000f590: 2229 0a0a 0a64 6566 2077 6865 7265 2863  ")...def where(c
-0000f5a0: 6f6e 642c 2078 2c20 792c 206b 6565 705f  ond, x, y, keep_
-0000f5b0: 6174 7472 733d 4e6f 6e65 293a 0a20 2020  attrs=None):.   
-0000f5c0: 2022 2222 5265 7475 726e 2065 6c65 6d65   """Return eleme
-0000f5d0: 6e74 7320 6672 6f6d 2060 7860 206f 7220  nts from `x` or 
-0000f5e0: 6079 6020 6465 7065 6e64 696e 6720 6f6e  `y` depending on
-0000f5f0: 2060 636f 6e64 602e 0a0a 2020 2020 5065   `cond`...    Pe
-0000f600: 7266 6f72 6d73 2078 6172 7261 792d 6c69  rforms xarray-li
-0000f610: 6b65 2062 726f 6164 6361 7374 696e 6720  ke broadcasting 
-0000f620: 6163 726f 7373 2069 6e70 7574 2061 7267  across input arg
-0000f630: 756d 656e 7473 2e0a 0a20 2020 2041 6c6c  uments...    All
-0000f640: 2064 696d 656e 7369 6f6e 2063 6f6f 7264   dimension coord
-0000f650: 696e 6174 6573 206f 6e20 6078 6020 616e  inates on `x` an
-0000f660: 6420 6079 6020 206d 7573 7420 6265 2061  d `y`  must be a
-0000f670: 6c69 676e 6564 2077 6974 6820 6561 6368  ligned with each
-0000f680: 0a20 2020 206f 7468 6572 2061 6e64 2077  .    other and w
-0000f690: 6974 6820 6063 6f6e 6460 2e0a 0a20 2020  ith `cond`...   
-0000f6a0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0000f6b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2063  ----------.    c
-0000f6c0: 6f6e 6420 3a20 7363 616c 6172 2c20 6172  ond : scalar, ar
-0000f6d0: 7261 792c 2056 6172 6961 626c 652c 2044  ray, Variable, D
-0000f6e0: 6174 6141 7272 6179 206f 7220 4461 7461  ataArray or Data
-0000f6f0: 7365 740a 2020 2020 2020 2020 5768 656e  set.        When
-0000f700: 2054 7275 652c 2072 6574 7572 6e20 7661   True, return va
-0000f710: 6c75 6573 2066 726f 6d20 6078 602c 206f  lues from `x`, o
-0000f720: 7468 6572 7769 7365 2072 6574 7572 6e73  therwise returns
-0000f730: 2076 616c 7565 7320 6672 6f6d 2060 7960   values from `y`
-0000f740: 2e0a 2020 2020 7820 3a20 7363 616c 6172  ..    x : scalar
-0000f750: 2c20 6172 7261 792c 2056 6172 6961 626c  , array, Variabl
-0000f760: 652c 2044 6174 6141 7272 6179 206f 7220  e, DataArray or 
-0000f770: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
-0000f780: 7661 6c75 6573 2074 6f20 6368 6f6f 7365  values to choose
-0000f790: 2066 726f 6d20 7768 6572 6520 6063 6f6e   from where `con
-0000f7a0: 6460 2069 7320 5472 7565 0a20 2020 2079  d` is True.    y
-0000f7b0: 203a 2073 6361 6c61 722c 2061 7272 6179   : scalar, array
-0000f7c0: 2c20 5661 7269 6162 6c65 2c20 4461 7461  , Variable, Data
-0000f7d0: 4172 7261 7920 6f72 2044 6174 6173 6574  Array or Dataset
-0000f7e0: 0a20 2020 2020 2020 2076 616c 7565 7320  .        values 
-0000f7f0: 746f 2063 686f 6f73 6520 6672 6f6d 2077  to choose from w
-0000f800: 6865 7265 2060 636f 6e64 6020 6973 2046  here `cond` is F
-0000f810: 616c 7365 0a20 2020 206b 6565 705f 6174  alse.    keep_at
-0000f820: 7472 7320 3a20 626f 6f6c 206f 7220 7374  trs : bool or st
-0000f830: 7220 6f72 2063 616c 6c61 626c 652c 206f  r or callable, o
-0000f840: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0000f850: 486f 7720 746f 2074 7265 6174 2061 7474  How to treat att
-0000f860: 7273 2e20 4966 2054 7275 652c 206b 6565  rs. If True, kee
-0000f870: 7020 7468 6520 6174 7472 7320 6f66 2060  p the attrs of `
-0000f880: 7860 2e0a 0a20 2020 2052 6574 7572 6e73  x`...    Returns
-0000f890: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-0000f8a0: 2044 6174 6173 6574 2c20 4461 7461 4172   Dataset, DataAr
-0000f8b0: 7261 792c 2056 6172 6961 626c 6520 6f72  ray, Variable or
-0000f8c0: 2061 7272 6179 0a20 2020 2020 2020 2049   array.        I
-0000f8d0: 6e20 7072 696f 7269 7479 206f 7264 6572  n priority order
-0000f8e0: 3a20 4461 7461 7365 742c 2044 6174 6141  : Dataset, DataA
-0000f8f0: 7272 6179 2c20 5661 7269 6162 6c65 206f  rray, Variable o
-0000f900: 7220 6172 7261 792c 2077 6869 6368 6576  r array, whichev
-0000f910: 6572 0a20 2020 2020 2020 2074 7970 6520  er.        type 
-0000f920: 6170 7065 6172 7320 6173 2061 6e20 696e  appears as an in
-0000f930: 7075 7420 6172 6775 6d65 6e74 2e0a 0a20  put argument... 
-0000f940: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-0000f950: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
-0000f960: 2078 203d 2078 722e 4461 7461 4172 7261   x = xr.DataArra
-0000f970: 7928 0a20 2020 202e 2e2e 2020 2020 2030  y(.    ...     0
-0000f980: 2e31 202a 206e 702e 6172 616e 6765 2831  .1 * np.arange(1
-0000f990: 3029 2c0a 2020 2020 2e2e 2e20 2020 2020  0),.    ...     
-0000f9a0: 6469 6d73 3d5b 226c 6174 225d 2c0a 2020  dims=["lat"],.  
-0000f9b0: 2020 2e2e 2e20 2020 2020 636f 6f72 6473    ...     coords
-0000f9c0: 3d7b 226c 6174 223a 206e 702e 6172 616e  ={"lat": np.aran
-0000f9d0: 6765 2831 3029 7d2c 0a20 2020 202e 2e2e  ge(10)},.    ...
-0000f9e0: 2020 2020 206e 616d 653d 2273 7374 222c       name="sst",
-0000f9f0: 0a20 2020 202e 2e2e 2029 0a20 2020 203e  .    ... ).    >
-0000fa00: 3e3e 2078 0a20 2020 203c 7861 7272 6179  >> x.    <xarray
-0000fa10: 2e44 6174 6141 7272 6179 2027 7373 7427  .DataArray 'sst'
-0000fa20: 2028 6c61 743a 2031 3029 3e0a 2020 2020   (lat: 10)>.    
-0000fa30: 6172 7261 7928 5b30 2e20 2c20 302e 312c  array([0. , 0.1,
-0000fa40: 2030 2e32 2c20 302e 332c 2030 2e34 2c20   0.2, 0.3, 0.4, 
-0000fa50: 302e 352c 2030 2e36 2c20 302e 372c 2030  0.5, 0.6, 0.7, 0
-0000fa60: 2e38 2c20 302e 395d 290a 2020 2020 436f  .8, 0.9]).    Co
-0000fa70: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-0000fa80: 202a 206c 6174 2020 2020 2020 286c 6174   * lat      (lat
-0000fa90: 2920 696e 7436 3420 3020 3120 3220 3320  ) int64 0 1 2 3 
-0000faa0: 3420 3520 3620 3720 3820 390a 0a20 2020  4 5 6 7 8 9..   
-0000fab0: 203e 3e3e 2078 722e 7768 6572 6528 7820   >>> xr.where(x 
-0000fac0: 3c20 302e 352c 2078 2c20 7820 2a20 3130  < 0.5, x, x * 10
-0000fad0: 3029 0a20 2020 203c 7861 7272 6179 2e44  0).    <xarray.D
-0000fae0: 6174 6141 7272 6179 2027 7373 7427 2028  ataArray 'sst' (
-0000faf0: 6c61 743a 2031 3029 3e0a 2020 2020 6172  lat: 10)>.    ar
-0000fb00: 7261 7928 5b20 302e 202c 2020 302e 312c  ray([ 0. ,  0.1,
-0000fb10: 2020 302e 322c 2020 302e 332c 2020 302e    0.2,  0.3,  0.
-0000fb20: 342c 2035 302e 202c 2036 302e 202c 2037  4, 50. , 60. , 7
-0000fb30: 302e 202c 2038 302e 202c 2039 302e 205d  0. , 80. , 90. ]
-0000fb40: 290a 2020 2020 436f 6f72 6469 6e61 7465  ).    Coordinate
-0000fb50: 733a 0a20 2020 2020 202a 206c 6174 2020  s:.      * lat  
-0000fb60: 2020 2020 286c 6174 2920 696e 7436 3420      (lat) int64 
-0000fb70: 3020 3120 3220 3320 3420 3520 3620 3720  0 1 2 3 4 5 6 7 
-0000fb80: 3820 390a 0a20 2020 203e 3e3e 2079 203d  8 9..    >>> y =
-0000fb90: 2078 722e 4461 7461 4172 7261 7928 0a20   xr.DataArray(. 
-0000fba0: 2020 202e 2e2e 2020 2020 2030 2e31 202a     ...     0.1 *
-0000fbb0: 206e 702e 6172 616e 6765 2839 292e 7265   np.arange(9).re
-0000fbc0: 7368 6170 6528 332c 2033 292c 0a20 2020  shape(3, 3),.   
-0000fbd0: 202e 2e2e 2020 2020 2064 696d 733d 5b22   ...     dims=["
-0000fbe0: 6c61 7422 2c20 226c 6f6e 225d 2c0a 2020  lat", "lon"],.  
-0000fbf0: 2020 2e2e 2e20 2020 2020 636f 6f72 6473    ...     coords
-0000fc00: 3d7b 226c 6174 223a 206e 702e 6172 616e  ={"lat": np.aran
-0000fc10: 6765 2833 292c 2022 6c6f 6e22 3a20 3130  ge(3), "lon": 10
-0000fc20: 202b 206e 702e 6172 616e 6765 2833 297d   + np.arange(3)}
-0000fc30: 2c0a 2020 2020 2e2e 2e20 2020 2020 6e61  ,.    ...     na
-0000fc40: 6d65 3d22 7373 7422 2c0a 2020 2020 2e2e  me="sst",.    ..
-0000fc50: 2e20 290a 2020 2020 3e3e 3e20 790a 2020  . ).    >>> y.  
-0000fc60: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
-0000fc70: 7261 7920 2773 7374 2720 286c 6174 3a20  ray 'sst' (lat: 
-0000fc80: 332c 206c 6f6e 3a20 3329 3e0a 2020 2020  3, lon: 3)>.    
-0000fc90: 6172 7261 7928 5b5b 302e 202c 2030 2e31  array([[0. , 0.1
-0000fca0: 2c20 302e 325d 2c0a 2020 2020 2020 2020  , 0.2],.        
-0000fcb0: 2020 205b 302e 332c 2030 2e34 2c20 302e     [0.3, 0.4, 0.
-0000fcc0: 355d 2c0a 2020 2020 2020 2020 2020 205b  5],.           [
-0000fcd0: 302e 362c 2030 2e37 2c20 302e 385d 5d29  0.6, 0.7, 0.8]])
-0000fce0: 0a20 2020 2043 6f6f 7264 696e 6174 6573  .    Coordinates
-0000fcf0: 3a0a 2020 2020 2020 2a20 6c61 7420 2020  :.      * lat   
-0000fd00: 2020 2028 6c61 7429 2069 6e74 3634 2030     (lat) int64 0
-0000fd10: 2031 2032 0a20 2020 2020 202a 206c 6f6e   1 2.      * lon
-0000fd20: 2020 2020 2020 286c 6f6e 2920 696e 7436        (lon) int6
-0000fd30: 3420 3130 2031 3120 3132 0a0a 2020 2020  4 10 11 12..    
-0000fd40: 3e3e 3e20 7872 2e77 6865 7265 2879 2e6c  >>> xr.where(y.l
-0000fd50: 6174 203c 2031 2c20 792c 202d 3129 0a20  at < 1, y, -1). 
-0000fd60: 2020 203c 7861 7272 6179 2e44 6174 6141     <xarray.DataA
-0000fd70: 7272 6179 2028 6c61 743a 2033 2c20 6c6f  rray (lat: 3, lo
-0000fd80: 6e3a 2033 293e 0a20 2020 2061 7272 6179  n: 3)>.    array
-0000fd90: 285b 5b20 302e 202c 2020 302e 312c 2020  ([[ 0. ,  0.1,  
-0000fda0: 302e 325d 2c0a 2020 2020 2020 2020 2020  0.2],.          
-0000fdb0: 205b 2d31 2e20 2c20 2d31 2e20 2c20 2d31   [-1. , -1. , -1
-0000fdc0: 2e20 5d2c 0a20 2020 2020 2020 2020 2020  . ],.           
-0000fdd0: 5b2d 312e 202c 202d 312e 202c 202d 312e  [-1. , -1. , -1.
-0000fde0: 205d 5d29 0a20 2020 2043 6f6f 7264 696e   ]]).    Coordin
-0000fdf0: 6174 6573 3a0a 2020 2020 2020 2a20 6c61  ates:.      * la
-0000fe00: 7420 2020 2020 2028 6c61 7429 2069 6e74  t      (lat) int
-0000fe10: 3634 2030 2031 2032 0a20 2020 2020 202a  64 0 1 2.      *
-0000fe20: 206c 6f6e 2020 2020 2020 286c 6f6e 2920   lon      (lon) 
-0000fe30: 696e 7436 3420 3130 2031 3120 3132 0a0a  int64 10 11 12..
-0000fe40: 2020 2020 3e3e 3e20 636f 6e64 203d 2078      >>> cond = x
-0000fe50: 722e 4461 7461 4172 7261 7928 5b54 7275  r.DataArray([Tru
-0000fe60: 652c 2046 616c 7365 5d2c 2064 696d 733d  e, False], dims=
-0000fe70: 5b22 7822 5d29 0a20 2020 203e 3e3e 2078  ["x"]).    >>> x
-0000fe80: 203d 2078 722e 4461 7461 4172 7261 7928   = xr.DataArray(
-0000fe90: 5b31 2c20 325d 2c20 6469 6d73 3d5b 2279  [1, 2], dims=["y
-0000fea0: 225d 290a 2020 2020 3e3e 3e20 7872 2e77  "]).    >>> xr.w
-0000feb0: 6865 7265 2863 6f6e 642c 2078 2c20 3029  here(cond, x, 0)
-0000fec0: 0a20 2020 203c 7861 7272 6179 2e44 6174  .    <xarray.Dat
-0000fed0: 6141 7272 6179 2028 783a 2032 2c20 793a  aArray (x: 2, y:
-0000fee0: 2032 293e 0a20 2020 2061 7272 6179 285b   2)>.    array([
-0000fef0: 5b31 2c20 325d 2c0a 2020 2020 2020 2020  [1, 2],.        
-0000ff00: 2020 205b 302c 2030 5d5d 290a 2020 2020     [0, 0]]).    
-0000ff10: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
-0000ff20: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
-0000ff30: 782c 2079 0a0a 2020 2020 5365 6520 416c  x, y..    See Al
-0000ff40: 736f 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  so.    --------.
-0000ff50: 2020 2020 6e75 6d70 792e 7768 6572 6520      numpy.where 
-0000ff60: 3a20 636f 7272 6573 706f 6e64 696e 6720  : corresponding 
-0000ff70: 6e75 6d70 7920 6675 6e63 7469 6f6e 0a20  numpy function. 
-0000ff80: 2020 2044 6174 6173 6574 2e77 6865 7265     Dataset.where
-0000ff90: 2c20 4461 7461 4172 7261 792e 7768 6572  , DataArray.wher
-0000ffa0: 6520 3a0a 2020 2020 2020 2020 6571 7569  e :.        equi
-0000ffb0: 7661 6c65 6e74 206d 6574 686f 6473 0a20  valent methods. 
-0000ffc0: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
-0000ffd0: 7861 7272 6179 2e63 6f72 652e 6461 7461  xarray.core.data
-0000ffe0: 7365 7420 696d 706f 7274 2044 6174 6173  set import Datas
-0000fff0: 6574 0a0a 2020 2020 6966 206b 6565 705f  et..    if keep_
-00010000: 6174 7472 7320 6973 204e 6f6e 653a 0a20  attrs is None:. 
-00010010: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
-00010020: 7320 3d20 5f67 6574 5f6b 6565 705f 6174  s = _get_keep_at
-00010030: 7472 7328 6465 6661 756c 743d 4661 6c73  trs(default=Fals
-00010040: 6529 0a0a 2020 2020 2320 616c 6967 6e6d  e)..    # alignm
-00010050: 656e 7420 666f 7220 7468 7265 6520 6172  ent for three ar
-00010060: 6775 6d65 6e74 7320 6973 2063 6f6d 706c  guments is compl
-00010070: 6963 6174 6564 2c20 736f 2064 6f6e 2774  icated, so don't
-00010080: 2073 7570 706f 7274 2069 7420 7965 740a   support it yet.
-00010090: 2020 2020 7265 7375 6c74 203d 2061 7070      result = app
-000100a0: 6c79 5f75 6675 6e63 280a 2020 2020 2020  ly_ufunc(.      
-000100b0: 2020 6475 636b 5f61 7272 6179 5f6f 7073    duck_array_ops
-000100c0: 2e77 6865 7265 2c0a 2020 2020 2020 2020  .where,.        
-000100d0: 636f 6e64 2c0a 2020 2020 2020 2020 782c  cond,.        x,
-000100e0: 0a20 2020 2020 2020 2079 2c0a 2020 2020  .        y,.    
-000100f0: 2020 2020 6a6f 696e 3d22 6578 6163 7422      join="exact"
-00010100: 2c0a 2020 2020 2020 2020 6461 7461 7365  ,.        datase
-00010110: 745f 6a6f 696e 3d22 6578 6163 7422 2c0a  t_join="exact",.
-00010120: 2020 2020 2020 2020 6461 736b 3d22 616c          dask="al
-00010130: 6c6f 7765 6422 2c0a 2020 2020 2020 2020  lowed",.        
-00010140: 6b65 6570 5f61 7474 7273 3d6b 6565 705f  keep_attrs=keep_
-00010150: 6174 7472 732c 0a20 2020 2029 0a0a 2020  attrs,.    )..  
-00010160: 2020 2320 6b65 6570 2074 6865 2061 7474    # keep the att
-00010170: 7269 6275 7465 7320 6f66 2078 2c20 7468  ributes of x, th
-00010180: 6520 7365 636f 6e64 2070 6172 616d 6574  e second paramet
-00010190: 6572 2c20 6279 2064 6566 6175 6c74 2074  er, by default t
-000101a0: 6f0a 2020 2020 2320 6265 2063 6f6e 7369  o.    # be consi
-000101b0: 7374 656e 7420 7769 7468 2074 6865 2060  stent with the `
-000101c0: 7768 6572 6560 206d 6574 686f 6420 6f66  where` method of
-000101d0: 2060 4461 7461 4172 7261 7960 2061 6e64   `DataArray` and
-000101e0: 2060 4461 7461 7365 7460 0a20 2020 2023   `Dataset`.    #
-000101f0: 2072 6562 7569 6c64 2074 6865 2061 7474   rebuild the att
-00010200: 7273 2066 726f 6d20 7820 6174 2065 6163  rs from x at eac
-00010210: 6820 6c65 7665 6c20 6f66 2074 6865 206f  h level of the o
-00010220: 7574 7075 742c 2077 6869 6368 2063 6f75  utput, which cou
-00010230: 6c64 2062 650a 2020 2020 2320 4461 7461  ld be.    # Data
-00010240: 7365 742c 2044 6174 6141 7272 6179 2c20  set, DataArray, 
-00010250: 6f72 2056 6172 6961 626c 652c 2061 6e64  or Variable, and
-00010260: 2061 6c73 6f20 6861 6e64 6c65 2063 6f6f   also handle coo
-00010270: 7264 730a 2020 2020 6966 206b 6565 705f  rds.    if keep_
-00010280: 6174 7472 7320 6973 2054 7275 6520 616e  attrs is True an
-00010290: 6420 6861 7361 7474 7228 7265 7375 6c74  d hasattr(result
-000102a0: 2c20 2261 7474 7273 2229 3a0a 2020 2020  , "attrs"):.    
-000102b0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000102c0: 6528 792c 2044 6174 6173 6574 2920 616e  e(y, Dataset) an
-000102d0: 6420 6e6f 7420 6973 696e 7374 616e 6365  d not isinstance
-000102e0: 2878 2c20 4461 7461 7365 7429 3a0a 2020  (x, Dataset):.  
-000102f0: 2020 2020 2020 2020 2020 2320 6861 6e64            # hand
-00010300: 6c65 2073 7065 6369 616c 2063 6173 6520  le special case 
-00010310: 7768 6572 6520 7820 6765 7473 2070 726f  where x gets pro
-00010320: 6d6f 7465 6420 746f 2044 6174 6173 6574  moted to Dataset
-00010330: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00010340: 756c 742e 6174 7472 7320 3d20 7b7d 0a20  ult.attrs = {}. 
-00010350: 2020 2020 2020 2020 2020 2069 6620 6765             if ge
-00010360: 7461 7474 7228 782c 2022 6e61 6d65 222c  tattr(x, "name",
-00010370: 204e 6f6e 6529 2069 6e20 7265 7375 6c74   None) in result
-00010380: 2e64 6174 615f 7661 7273 3a0a 2020 2020  .data_vars:.    
-00010390: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000103a0: 6c74 5b78 2e6e 616d 655d 2e61 7474 7273  lt[x.name].attrs
-000103b0: 203d 2067 6574 6174 7472 2878 2c20 2261   = getattr(x, "a
-000103c0: 7474 7273 222c 207b 7d29 0a20 2020 2020  ttrs", {}).     
-000103d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000103e0: 2020 2020 2023 206f 7468 6572 7769 7365       # otherwise
-000103f0: 2c20 6669 6c6c 2069 6e20 676c 6f62 616c  , fill in global
-00010400: 2061 7474 7273 2061 6e64 2076 6172 6961   attrs and varia
-00010410: 626c 6520 6174 7472 7320 2869 6620 7468  ble attrs (if th
-00010420: 6579 2065 7869 7374 290a 2020 2020 2020  ey exist).      
-00010430: 2020 2020 2020 7265 7375 6c74 2e61 7474        result.att
-00010440: 7273 203d 2067 6574 6174 7472 2878 2c20  rs = getattr(x, 
-00010450: 2261 7474 7273 222c 207b 7d29 0a20 2020  "attrs", {}).   
-00010460: 2020 2020 2020 2020 2066 6f72 2076 2069           for v i
-00010470: 6e20 6765 7461 7474 7228 7265 7375 6c74  n getattr(result
-00010480: 2c20 2264 6174 615f 7661 7273 222c 205b  , "data_vars", [
-00010490: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-000104a0: 2020 2020 7265 7375 6c74 5b76 5d2e 6174      result[v].at
-000104b0: 7472 7320 3d20 6765 7461 7474 7228 6765  trs = getattr(ge
-000104c0: 7461 7474 7228 782c 2076 2c20 4e6f 6e65  tattr(x, v, None
-000104d0: 292c 2022 6174 7472 7322 2c20 7b7d 290a  ), "attrs", {}).
-000104e0: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
-000104f0: 2067 6574 6174 7472 2872 6573 756c 742c   getattr(result,
-00010500: 2022 636f 6f72 6473 222c 205b 5d29 3a0a   "coords", []):.
-00010510: 2020 2020 2020 2020 2020 2020 2320 616c              # al
-00010520: 7761 7973 2066 696c 6c20 636f 6f72 6420  ways fill coord 
-00010530: 6174 7472 7320 6f66 2078 0a20 2020 2020  attrs of x.     
-00010540: 2020 2020 2020 2072 6573 756c 745b 635d         result[c]
-00010550: 2e61 7474 7273 203d 2067 6574 6174 7472  .attrs = getattr
-00010560: 2867 6574 6174 7472 2878 2c20 632c 204e  (getattr(x, c, N
-00010570: 6f6e 6529 2c20 2261 7474 7273 222c 207b  one), "attrs", {
-00010580: 7d29 0a0a 2020 2020 7265 7475 726e 2072  })..    return r
-00010590: 6573 756c 740a 0a0a 406f 7665 726c 6f61  esult...@overloa
-000105a0: 640a 6465 6620 706f 6c79 7661 6c28 0a20  d.def polyval(. 
-000105b0: 2020 2063 6f6f 7264 3a20 4461 7461 4172     coord: DataAr
-000105c0: 7261 792c 2063 6f65 6666 733a 2044 6174  ray, coeffs: Dat
-000105d0: 6141 7272 6179 2c20 6465 6772 6565 5f64  aArray, degree_d
-000105e0: 696d 3a20 4861 7368 6162 6c65 203d 2022  im: Hashable = "
-000105f0: 6465 6772 6565 220a 2920 2d3e 2044 6174  degree".) -> Dat
-00010600: 6141 7272 6179 3a0a 2020 2020 2e2e 2e0a  aArray:.    ....
-00010610: 0a0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
-00010620: 706f 6c79 7661 6c28 0a20 2020 2063 6f6f  polyval(.    coo
-00010630: 7264 3a20 4461 7461 4172 7261 792c 2063  rd: DataArray, c
-00010640: 6f65 6666 733a 2044 6174 6173 6574 2c20  oeffs: Dataset, 
-00010650: 6465 6772 6565 5f64 696d 3a20 4861 7368  degree_dim: Hash
-00010660: 6162 6c65 203d 2022 6465 6772 6565 220a  able = "degree".
-00010670: 2920 2d3e 2044 6174 6173 6574 3a0a 2020  ) -> Dataset:.  
-00010680: 2020 2e2e 2e0a 0a0a 406f 7665 726c 6f61    ......@overloa
-00010690: 640a 6465 6620 706f 6c79 7661 6c28 0a20  d.def polyval(. 
-000106a0: 2020 2063 6f6f 7264 3a20 4461 7461 7365     coord: Datase
-000106b0: 742c 2063 6f65 6666 733a 2044 6174 6141  t, coeffs: DataA
-000106c0: 7272 6179 2c20 6465 6772 6565 5f64 696d  rray, degree_dim
-000106d0: 3a20 4861 7368 6162 6c65 203d 2022 6465  : Hashable = "de
-000106e0: 6772 6565 220a 2920 2d3e 2044 6174 6173  gree".) -> Datas
-000106f0: 6574 3a0a 2020 2020 2e2e 2e0a 0a0a 406f  et:.    ......@o
-00010700: 7665 726c 6f61 640a 6465 6620 706f 6c79  verload.def poly
-00010710: 7661 6c28 0a20 2020 2063 6f6f 7264 3a20  val(.    coord: 
-00010720: 4461 7461 7365 742c 2063 6f65 6666 733a  Dataset, coeffs:
-00010730: 2044 6174 6173 6574 2c20 6465 6772 6565   Dataset, degree
-00010740: 5f64 696d 3a20 4861 7368 6162 6c65 203d  _dim: Hashable =
-00010750: 2022 6465 6772 6565 220a 2920 2d3e 2044   "degree".) -> D
-00010760: 6174 6173 6574 3a0a 2020 2020 2e2e 2e0a  ataset:.    ....
-00010770: 0a0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
-00010780: 706f 6c79 7661 6c28 0a20 2020 2063 6f6f  polyval(.    coo
-00010790: 7264 3a20 4461 7461 7365 7420 7c20 4461  rd: Dataset | Da
-000107a0: 7461 4172 7261 792c 0a20 2020 2063 6f65  taArray,.    coe
-000107b0: 6666 733a 2044 6174 6173 6574 207c 2044  ffs: Dataset | D
-000107c0: 6174 6141 7272 6179 2c0a 2020 2020 6465  ataArray,.    de
-000107d0: 6772 6565 5f64 696d 3a20 4861 7368 6162  gree_dim: Hashab
-000107e0: 6c65 203d 2022 6465 6772 6565 222c 0a29  le = "degree",.)
-000107f0: 202d 3e20 4461 7461 7365 7420 7c20 4461   -> Dataset | Da
-00010800: 7461 4172 7261 793a 0a20 2020 202e 2e2e  taArray:.    ...
-00010810: 0a0a 0a64 6566 2070 6f6c 7976 616c 280a  ...def polyval(.
-00010820: 2020 2020 636f 6f72 643a 2044 6174 6173      coord: Datas
-00010830: 6574 207c 2044 6174 6141 7272 6179 2c0a  et | DataArray,.
-00010840: 2020 2020 636f 6566 6673 3a20 4461 7461      coeffs: Data
-00010850: 7365 7420 7c20 4461 7461 4172 7261 792c  set | DataArray,
-00010860: 0a20 2020 2064 6567 7265 655f 6469 6d3a  .    degree_dim:
-00010870: 2048 6173 6861 626c 6520 3d20 2264 6567   Hashable = "deg
-00010880: 7265 6522 2c0a 2920 2d3e 2044 6174 6173  ree",.) -> Datas
-00010890: 6574 207c 2044 6174 6141 7272 6179 3a0a  et | DataArray:.
-000108a0: 2020 2020 2222 2245 7661 6c75 6174 6520      """Evaluate 
-000108b0: 6120 706f 6c79 6e6f 6d69 616c 2061 7420  a polynomial at 
-000108c0: 7370 6563 6966 6963 2076 616c 7565 730a  specific values.
-000108d0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-000108e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000108f0: 2020 2063 6f6f 7264 203a 2044 6174 6141     coord : DataA
-00010900: 7272 6179 206f 7220 4461 7461 7365 740a  rray or Dataset.
-00010910: 2020 2020 2020 2020 5661 6c75 6573 2061          Values a
-00010920: 7420 7768 6963 6820 746f 2065 7661 6c75  t which to evalu
-00010930: 6174 6520 7468 6520 706f 6c79 6e6f 6d69  ate the polynomi
-00010940: 616c 2e0a 2020 2020 636f 6566 6673 203a  al..    coeffs :
-00010950: 2044 6174 6141 7272 6179 206f 7220 4461   DataArray or Da
-00010960: 7461 7365 740a 2020 2020 2020 2020 436f  taset.        Co
-00010970: 6566 6669 6369 656e 7473 206f 6620 7468  efficients of th
-00010980: 6520 706f 6c79 6e6f 6d69 616c 2e0a 2020  e polynomial..  
-00010990: 2020 6465 6772 6565 5f64 696d 203a 2048    degree_dim : H
-000109a0: 6173 6861 626c 652c 2064 6566 6175 6c74  ashable, default
-000109b0: 3a20 2264 6567 7265 6522 0a20 2020 2020  : "degree".     
-000109c0: 2020 204e 616d 6520 6f66 2074 6865 2070     Name of the p
-000109d0: 6f6c 796e 6f6d 6961 6c20 6465 6772 6565  olynomial degree
-000109e0: 2064 696d 656e 7369 6f6e 2069 6e20 6063   dimension in `c
-000109f0: 6f65 6666 7360 2e0a 0a20 2020 2052 6574  oeffs`...    Ret
-00010a00: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00010a10: 0a20 2020 2044 6174 6141 7272 6179 206f  .    DataArray o
-00010a20: 7220 4461 7461 7365 740a 2020 2020 2020  r Dataset.      
-00010a30: 2020 4576 616c 7561 7465 6420 706f 6c79    Evaluated poly
-00010a40: 6e6f 6d69 616c 2e0a 0a20 2020 2053 6565  nomial...    See
-00010a50: 2041 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d   Also.    ------
-00010a60: 2d2d 0a20 2020 2078 6172 7261 792e 4461  --.    xarray.Da
-00010a70: 7461 4172 7261 792e 706f 6c79 6669 740a  taArray.polyfit.
-00010a80: 2020 2020 6e75 6d70 792e 706f 6c79 6e6f      numpy.polyno
-00010a90: 6d69 616c 2e70 6f6c 796e 6f6d 6961 6c2e  mial.polynomial.
-00010aa0: 706f 6c79 7661 6c0a 2020 2020 2222 220a  polyval.    """.
-00010ab0: 0a20 2020 2069 6620 6465 6772 6565 5f64  .    if degree_d
-00010ac0: 696d 206e 6f74 2069 6e20 636f 6566 6673  im not in coeffs
-00010ad0: 2e5f 696e 6465 7865 733a 0a20 2020 2020  ._indexes:.     
-00010ae0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00010af0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00010b00: 2066 2244 696d 656e 7369 6f6e 2060 7b64   f"Dimension `{d
-00010b10: 6567 7265 655f 6469 6d7d 6020 7368 6f75  egree_dim}` shou
-00010b20: 6c64 2062 6520 6120 636f 6f72 6469 6e61  ld be a coordina
-00010b30: 7465 2076 6172 6961 626c 6520 7769 7468  te variable with
-00010b40: 206c 6162 656c 732e 220a 2020 2020 2020   labels.".      
-00010b50: 2020 290a 2020 2020 6966 206e 6f74 206e    ).    if not n
-00010b60: 702e 6973 7375 6264 7479 7065 2863 6f65  p.issubdtype(coe
-00010b70: 6666 735b 6465 6772 6565 5f64 696d 5d2e  ffs[degree_dim].
-00010b80: 6474 7970 652c 206e 702e 696e 7465 6765  dtype, np.intege
-00010b90: 7229 3a0a 2020 2020 2020 2020 7261 6973  r):.        rais
-00010ba0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-00010bb0: 2020 2020 2020 2020 2020 6622 4469 6d65            f"Dime
-00010bc0: 6e73 696f 6e20 607b 6465 6772 6565 5f64  nsion `{degree_d
-00010bd0: 696d 7d60 2073 686f 756c 6420 6265 206f  im}` should be o
-00010be0: 6620 696e 7465 6765 7220 6474 7970 652e  f integer dtype.
-00010bf0: 2052 6563 6569 7665 6420 7b63 6f65 6666   Received {coeff
-00010c00: 735b 6465 6772 6565 5f64 696d 5d2e 6474  s[degree_dim].dt
-00010c10: 7970 657d 2069 6e73 7465 6164 2e22 0a20  ype} instead.". 
-00010c20: 2020 2020 2020 2029 0a20 2020 206d 6178         ).    max
-00010c30: 5f64 6567 203d 2063 6f65 6666 735b 6465  _deg = coeffs[de
-00010c40: 6772 6565 5f64 696d 5d2e 6d61 7828 292e  gree_dim].max().
-00010c50: 6974 656d 2829 0a20 2020 2063 6f65 6666  item().    coeff
-00010c60: 7320 3d20 636f 6566 6673 2e72 6569 6e64  s = coeffs.reind
-00010c70: 6578 280a 2020 2020 2020 2020 7b64 6567  ex(.        {deg
-00010c80: 7265 655f 6469 6d3a 206e 702e 6172 616e  ree_dim: np.aran
-00010c90: 6765 286d 6178 5f64 6567 202b 2031 297d  ge(max_deg + 1)}
-00010ca0: 2c20 6669 6c6c 5f76 616c 7565 3d30 2c20  , fill_value=0, 
-00010cb0: 636f 7079 3d46 616c 7365 0a20 2020 2029  copy=False.    )
-00010cc0: 0a20 2020 2063 6f6f 7264 203d 205f 656e  .    coord = _en
-00010cd0: 7375 7265 5f6e 756d 6572 6963 2863 6f6f  sure_numeric(coo
-00010ce0: 7264 290a 0a20 2020 2023 2075 7369 6e67  rd)..    # using
-00010cf0: 2048 6f72 6e65 7227 7320 6d65 7468 6f64   Horner's method
-00010d00: 0a20 2020 2023 2068 7474 7073 3a2f 2f65  .    # https://e
-00010d10: 6e2e 7769 6b69 7065 6469 612e 6f72 672f  n.wikipedia.org/
-00010d20: 7769 6b69 2f48 6f72 6e65 7225 3237 735f  wiki/Horner%27s_
-00010d30: 6d65 7468 6f64 0a20 2020 2072 6573 203d  method.    res =
-00010d40: 207a 6572 6f73 5f6c 696b 6528 636f 6f72   zeros_like(coor
-00010d50: 6429 202b 2063 6f65 6666 732e 6973 656c  d) + coeffs.isel
-00010d60: 287b 6465 6772 6565 5f64 696d 3a20 6d61  ({degree_dim: ma
-00010d70: 785f 6465 677d 2c20 6472 6f70 3d54 7275  x_deg}, drop=Tru
-00010d80: 6529 0a20 2020 2066 6f72 2064 6567 2069  e).    for deg i
-00010d90: 6e20 7261 6e67 6528 6d61 785f 6465 6720  n range(max_deg 
-00010da0: 2d20 312c 202d 312c 202d 3129 3a0a 2020  - 1, -1, -1):.  
-00010db0: 2020 2020 2020 7265 7320 2a3d 2063 6f6f        res *= coo
-00010dc0: 7264 0a20 2020 2020 2020 2072 6573 202b  rd.        res +
-00010dd0: 3d20 636f 6566 6673 2e69 7365 6c28 7b64  = coeffs.isel({d
-00010de0: 6567 7265 655f 6469 6d3a 2064 6567 7d2c  egree_dim: deg},
-00010df0: 2064 726f 703d 5472 7565 290a 0a20 2020   drop=True)..   
-00010e00: 2072 6574 7572 6e20 7265 730a 0a0a 6465   return res...de
-00010e10: 6620 5f65 6e73 7572 655f 6e75 6d65 7269  f _ensure_numeri
-00010e20: 6328 6461 7461 3a20 4461 7461 7365 7420  c(data: Dataset 
-00010e30: 7c20 4461 7461 4172 7261 7929 202d 3e20  | DataArray) -> 
-00010e40: 4461 7461 7365 7420 7c20 4461 7461 4172  Dataset | DataAr
-00010e50: 7261 793a 0a20 2020 2022 2222 436f 6e76  ray:.    """Conv
-00010e60: 6572 7473 2061 6c6c 2064 6174 6574 696d  erts all datetim
-00010e70: 6536 3420 7661 7269 6162 6c65 7320 746f  e64 variables to
-00010e80: 2066 6c6f 6174 3634 0a0a 2020 2020 5061   float64..    Pa
-00010e90: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-00010ea0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6461 7461  -------.    data
-00010eb0: 203a 2044 6174 6141 7272 6179 206f 7220   : DataArray or 
-00010ec0: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
-00010ed0: 5661 7269 6162 6c65 7320 7769 7468 2070  Variables with p
-00010ee0: 6f73 7369 626c 6520 6461 7465 7469 6d65  ossible datetime
-00010ef0: 2064 7479 7065 732e 0a0a 2020 2020 5265   dtypes...    Re
-00010f00: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00010f10: 2d0a 2020 2020 4461 7461 4172 7261 7920  -.    DataArray 
-00010f20: 6f72 2044 6174 6173 6574 0a20 2020 2020  or Dataset.     
-00010f30: 2020 2056 6172 6961 626c 6573 2077 6974     Variables wit
-00010f40: 6820 6461 7465 7469 6d65 3634 2064 7479  h datetime64 dty
-00010f50: 7065 7320 636f 6e76 6572 7465 6420 746f  pes converted to
-00010f60: 2066 6c6f 6174 3634 2e0a 2020 2020 2222   float64..    ""
-00010f70: 220a 2020 2020 6672 6f6d 2078 6172 7261  ".    from xarra
-00010f80: 792e 636f 7265 2e64 6174 6173 6574 2069  y.core.dataset i
-00010f90: 6d70 6f72 7420 4461 7461 7365 740a 0a20  mport Dataset.. 
-00010fa0: 2020 2064 6566 205f 6366 6f66 6673 6574     def _cfoffset
-00010fb0: 2878 3a20 4461 7461 4172 7261 7929 202d  (x: DataArray) -
-00010fc0: 3e20 416e 793a 0a20 2020 2020 2020 2073  > Any:.        s
-00010fd0: 6361 6c61 7220 3d20 782e 636f 6d70 7574  calar = x.comput
-00010fe0: 6528 292e 6461 7461 5b30 5d0a 2020 2020  e().data[0].    
-00010ff0: 2020 2020 6966 206e 6f74 2069 735f 7363      if not is_sc
-00011000: 616c 6172 2873 6361 6c61 7229 3a0a 2020  alar(scalar):.  
-00011010: 2020 2020 2020 2020 2020 2320 7765 2064            # we d
-00011020: 6f20 6e6f 7420 6765 7420 6120 7363 616c  o not get a scal
-00011030: 6172 2062 6163 6b20 6f6e 2064 6173 6b20  ar back on dask 
-00011040: 3d3d 2032 3032 312e 3034 2e31 0a20 2020  == 2021.04.1.   
-00011050: 2020 2020 2020 2020 2073 6361 6c61 7220           scalar 
-00011060: 3d20 7363 616c 6172 2e69 7465 6d28 290a  = scalar.item().
-00011070: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00011080: 7970 6528 7363 616c 6172 2928 3139 3730  ype(scalar)(1970
-00011090: 2c20 312c 2031 290a 0a20 2020 2064 6566  , 1, 1)..    def
-000110a0: 2074 6f5f 666c 6f61 7461 626c 6528 783a   to_floatable(x:
-000110b0: 2044 6174 6141 7272 6179 2920 2d3e 2044   DataArray) -> D
-000110c0: 6174 6141 7272 6179 3a0a 2020 2020 2020  ataArray:.      
-000110d0: 2020 6966 2078 2e64 7479 7065 2e6b 696e    if x.dtype.kin
-000110e0: 6420 696e 2022 4d4f 223a 0a20 2020 2020  d in "MO":.     
-000110f0: 2020 2020 2020 2023 2064 6174 6574 696d         # datetim
-00011100: 6573 2028 4346 496e 6465 7865 7320 6172  es (CFIndexes ar
-00011110: 6520 6f62 6a65 6374 2074 7970 6529 0a20  e object type). 
-00011120: 2020 2020 2020 2020 2020 206f 6666 7365             offse
-00011130: 7420 3d20 280a 2020 2020 2020 2020 2020  t = (.          
-00011140: 2020 2020 2020 6e70 2e64 6174 6574 696d        np.datetim
-00011150: 6536 3428 2231 3937 302d 3031 2d30 3122  e64("1970-01-01"
-00011160: 2920 6966 2078 2e64 7479 7065 2e6b 696e  ) if x.dtype.kin
-00011170: 6420 3d3d 2022 4d22 2065 6c73 6520 5f63  d == "M" else _c
-00011180: 666f 6666 7365 7428 7829 0a20 2020 2020  foffset(x).     
-00011190: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000111a0: 2020 2020 2072 6574 7572 6e20 782e 636f       return x.co
-000111b0: 7079 280a 2020 2020 2020 2020 2020 2020  py(.            
-000111c0: 2020 2020 6461 7461 3d64 6174 6574 696d      data=datetim
-000111d0: 655f 746f 5f6e 756d 6572 6963 2878 2e64  e_to_numeric(x.d
-000111e0: 6174 612c 206f 6666 7365 743d 6f66 6673  ata, offset=offs
-000111f0: 6574 2c20 6461 7465 7469 6d65 5f75 6e69  et, datetime_uni
-00011200: 743d 226e 7322 292c 0a20 2020 2020 2020  t="ns"),.       
-00011210: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-00011220: 6c69 6620 782e 6474 7970 652e 6b69 6e64  lif x.dtype.kind
-00011230: 203d 3d20 226d 223a 0a20 2020 2020 2020   == "m":.       
-00011240: 2020 2020 2023 2074 696d 6564 656c 7461       # timedelta
-00011250: 730a 2020 2020 2020 2020 2020 2020 7265  s.            re
-00011260: 7475 726e 2078 2e61 7374 7970 6528 666c  turn x.astype(fl
-00011270: 6f61 7429 0a20 2020 2020 2020 2072 6574  oat).        ret
-00011280: 7572 6e20 780a 0a20 2020 2069 6620 6973  urn x..    if is
-00011290: 696e 7374 616e 6365 2864 6174 612c 2044  instance(data, D
-000112a0: 6174 6173 6574 293a 0a20 2020 2020 2020  ataset):.       
-000112b0: 2072 6574 7572 6e20 6461 7461 2e6d 6170   return data.map
-000112c0: 2874 6f5f 666c 6f61 7461 626c 6529 0a20  (to_floatable). 
-000112d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000112e0: 2072 6574 7572 6e20 746f 5f66 6c6f 6174   return to_float
-000112f0: 6162 6c65 2864 6174 6129 0a0a 0a64 6566  able(data)...def
-00011300: 205f 6361 6c63 5f69 6478 6d69 6e6d 6178   _calc_idxminmax
-00011310: 280a 2020 2020 2a2c 0a20 2020 2061 7272  (.    *,.    arr
-00011320: 6179 2c0a 2020 2020 6675 6e63 3a20 4361  ay,.    func: Ca
-00011330: 6c6c 6162 6c65 2c0a 2020 2020 6469 6d3a  llable,.    dim:
-00011340: 2048 6173 6861 626c 6520 7c20 4e6f 6e65   Hashable | None
-00011350: 203d 204e 6f6e 652c 0a20 2020 2073 6b69   = None,.    ski
-00011360: 706e 613a 2062 6f6f 6c20 7c20 4e6f 6e65  pna: bool | None
-00011370: 203d 204e 6f6e 652c 0a20 2020 2066 696c   = None,.    fil
-00011380: 6c5f 7661 6c75 653a 2041 6e79 203d 2064  l_value: Any = d
-00011390: 7479 7065 732e 4e41 2c0a 2020 2020 6b65  types.NA,.    ke
-000113a0: 6570 5f61 7474 7273 3a20 626f 6f6c 207c  ep_attrs: bool |
-000113b0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 293a   None = None,.):
-000113c0: 0a20 2020 2022 2222 4170 706c 7920 636f  .    """Apply co
-000113d0: 6d6d 6f6e 206f 7065 7261 7469 6f6e 7320  mmon operations 
-000113e0: 666f 7220 6964 786d 696e 2061 6e64 2069  for idxmin and i
-000113f0: 6478 6d61 782e 2222 220a 2020 2020 2320  dxmax.""".    # 
-00011400: 5468 6973 2066 756e 6374 696f 6e20 646f  This function do
-00011410: 6573 6e27 7420 6d61 6b65 2073 656e 7365  esn't make sense
-00011420: 2066 6f72 2073 6361 6c61 7273 2073 6f20   for scalars so 
-00011430: 646f 6e27 7420 7472 790a 2020 2020 6966  don't try.    if
-00011440: 206e 6f74 2061 7272 6179 2e6e 6469 6d3a   not array.ndim:
-00011450: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-00011460: 616c 7565 4572 726f 7228 2254 6869 7320  alueError("This 
-00011470: 6675 6e63 7469 6f6e 2064 6f65 7320 6e6f  function does no
-00011480: 7420 6170 706c 7920 666f 7220 7363 616c  t apply for scal
-00011490: 6172 7322 290a 0a20 2020 2069 6620 6469  ars")..    if di
-000114a0: 6d20 6973 206e 6f74 204e 6f6e 653a 0a20  m is not None:. 
-000114b0: 2020 2020 2020 2070 6173 7320 2023 2055         pass  # U
-000114c0: 7365 2074 6865 2064 696d 2069 6620 6176  se the dim if av
-000114d0: 6169 6c61 626c 650a 2020 2020 656c 6966  ailable.    elif
-000114e0: 2061 7272 6179 2e6e 6469 6d20 3d3d 2031   array.ndim == 1
-000114f0: 3a0a 2020 2020 2020 2020 2320 6974 2069  :.        # it i
-00011500: 7320 6f6b 6179 2074 6f20 6775 6573 7320  s okay to guess 
-00011510: 7468 6520 6469 6d20 6966 2074 6865 7265  the dim if there
-00011520: 2069 7320 6f6e 6c79 2031 0a20 2020 2020   is only 1.     
-00011530: 2020 2064 696d 203d 2061 7272 6179 2e64     dim = array.d
-00011540: 696d 735b 305d 0a20 2020 2065 6c73 653a  ims[0].    else:
-00011550: 0a20 2020 2020 2020 2023 2054 6865 2064  .        # The d
-00011560: 696d 2069 7320 6e6f 7420 7370 6563 6966  im is not specif
-00011570: 6965 6420 616e 6420 616d 6269 6775 6f75  ied and ambiguou
-00011580: 732e 2020 446f 6e27 7420 6775 6573 732e  s.  Don't guess.
-00011590: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-000115a0: 616c 7565 4572 726f 7228 224d 7573 7420  alueError("Must 
-000115b0: 7375 7070 6c79 2027 6469 6d27 2061 7267  supply 'dim' arg
-000115c0: 756d 656e 7420 666f 7220 6d75 6c74 6964  ument for multid
-000115d0: 696d 656e 7369 6f6e 616c 2061 7272 6179  imensional array
-000115e0: 7322 290a 0a20 2020 2069 6620 6469 6d20  s")..    if dim 
-000115f0: 6e6f 7420 696e 2061 7272 6179 2e64 696d  not in array.dim
-00011600: 733a 0a20 2020 2020 2020 2072 6169 7365  s:.        raise
-00011610: 204b 6579 4572 726f 7228 6627 4469 6d65   KeyError(f'Dime
-00011620: 6e73 696f 6e20 227b 6469 6d7d 2220 6e6f  nsion "{dim}" no
-00011630: 7420 696e 2064 696d 656e 7369 6f6e 2729  t in dimension')
-00011640: 0a20 2020 2069 6620 6469 6d20 6e6f 7420  .    if dim not 
-00011650: 696e 2061 7272 6179 2e63 6f6f 7264 733a  in array.coords:
-00011660: 0a20 2020 2020 2020 2072 6169 7365 204b  .        raise K
-00011670: 6579 4572 726f 7228 6627 4469 6d65 6e73  eyError(f'Dimens
-00011680: 696f 6e20 227b 6469 6d7d 2220 646f 6573  ion "{dim}" does
-00011690: 206e 6f74 2068 6176 6520 636f 6f72 6469   not have coordi
-000116a0: 6e61 7465 7327 290a 0a20 2020 2023 2054  nates')..    # T
-000116b0: 6865 7365 2061 7265 2064 7479 7065 7320  hese are dtypes 
-000116c0: 7769 7468 204e 614e 2076 616c 7565 7320  with NaN values 
-000116d0: 6172 676d 696e 2061 6e64 2061 7267 6d61  argmin and argma
-000116e0: 7820 6361 6e20 6861 6e64 6c65 0a20 2020  x can handle.   
-000116f0: 206e 615f 6474 7970 6573 203d 2022 6366   na_dtypes = "cf
-00011700: 4f22 0a0a 2020 2020 6966 2073 6b69 706e  O"..    if skipn
-00011710: 6120 6f72 2028 736b 6970 6e61 2069 7320  a or (skipna is 
-00011720: 4e6f 6e65 2061 6e64 2061 7272 6179 2e64  None and array.d
-00011730: 7479 7065 2e6b 696e 6420 696e 206e 615f  type.kind in na_
-00011740: 6474 7970 6573 293a 0a20 2020 2020 2020  dtypes):.       
-00011750: 2023 204e 6565 6420 746f 2073 6b69 7020   # Need to skip 
-00011760: 4e61 4e20 7661 6c75 6573 2073 696e 6365  NaN values since
-00011770: 2061 7267 6d69 6e20 616e 6420 6172 676d   argmin and argm
-00011780: 6178 2063 616e 2774 2068 616e 646c 6520  ax can't handle 
-00011790: 7468 656d 0a20 2020 2020 2020 2061 6c6c  them.        all
-000117a0: 6e61 203d 2061 7272 6179 2e69 736e 756c  na = array.isnul
-000117b0: 6c28 292e 616c 6c28 6469 6d29 0a20 2020  l().all(dim).   
-000117c0: 2020 2020 2061 7272 6179 203d 2061 7272       array = arr
-000117d0: 6179 2e77 6865 7265 287e 616c 6c6e 612c  ay.where(~allna,
-000117e0: 2030 290a 0a20 2020 2023 2054 6869 7320   0)..    # This 
-000117f0: 7769 6c6c 2072 756e 2061 7267 6d69 6e20  will run argmin 
-00011800: 6f72 2061 7267 6d61 782e 0a20 2020 2069  or argmax..    i
-00011810: 6e64 7820 3d20 6675 6e63 2861 7272 6179  ndx = func(array
-00011820: 2c20 6469 6d3d 6469 6d2c 2061 7869 733d  , dim=dim, axis=
-00011830: 4e6f 6e65 2c20 6b65 6570 5f61 7474 7273  None, keep_attrs
-00011840: 3d6b 6565 705f 6174 7472 732c 2073 6b69  =keep_attrs, ski
-00011850: 706e 613d 736b 6970 6e61 290a 0a20 2020  pna=skipna)..   
-00011860: 2023 2048 616e 646c 6520 6461 736b 2061   # Handle dask a
-00011870: 7272 6179 732e 0a20 2020 2069 6620 6973  rrays..    if is
-00011880: 5f64 7563 6b5f 6461 736b 5f61 7272 6179  _duck_dask_array
-00011890: 2861 7272 6179 2e64 6174 6129 3a0a 2020  (array.data):.  
-000118a0: 2020 2020 2020 696d 706f 7274 2064 6173        import das
-000118b0: 6b2e 6172 7261 790a 0a20 2020 2020 2020  k.array..       
-000118c0: 2063 6875 6e6b 7320 3d20 6469 6374 287a   chunks = dict(z
-000118d0: 6970 2861 7272 6179 2e64 696d 732c 2061  ip(array.dims, a
-000118e0: 7272 6179 2e63 6875 6e6b 7329 290a 2020  rray.chunks)).  
-000118f0: 2020 2020 2020 6461 736b 5f63 6f6f 7264        dask_coord
-00011900: 203d 2064 6173 6b2e 6172 7261 792e 6672   = dask.array.fr
-00011910: 6f6d 5f61 7272 6179 2861 7272 6179 5b64  om_array(array[d
-00011920: 696d 5d2e 6461 7461 2c20 6368 756e 6b73  im].data, chunks
-00011930: 3d63 6875 6e6b 735b 6469 6d5d 290a 2020  =chunks[dim]).  
-00011940: 2020 2020 2020 7265 7320 3d20 696e 6478        res = indx
-00011950: 2e63 6f70 7928 6461 7461 3d64 6173 6b5f  .copy(data=dask_
-00011960: 636f 6f72 645b 696e 6478 2e64 6174 612e  coord[indx.data.
-00011970: 7261 7665 6c28 295d 2e72 6573 6861 7065  ravel()].reshape
-00011980: 2869 6e64 782e 7368 6170 6529 290a 2020  (indx.shape)).  
-00011990: 2020 2020 2020 2320 7765 206e 6565 6420        # we need 
-000119a0: 746f 2061 7474 6163 6820 6261 636b 2074  to attach back t
-000119b0: 6865 2064 696d 206e 616d 650a 2020 2020  he dim name.    
-000119c0: 2020 2020 7265 732e 6e61 6d65 203d 2064      res.name = d
-000119d0: 696d 0a20 2020 2065 6c73 653a 0a20 2020  im.    else:.   
-000119e0: 2020 2020 2072 6573 203d 2061 7272 6179       res = array
-000119f0: 5b64 696d 5d5b 2869 6e64 782c 295d 0a20  [dim][(indx,)]. 
-00011a00: 2020 2020 2020 2023 2054 6865 2064 696d         # The dim
-00011a10: 2069 7320 676f 6e65 2062 7574 2077 6520   is gone but we 
-00011a20: 6e65 6564 2074 6f20 7265 6d6f 7665 2074  need to remove t
-00011a30: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
-00011a40: 2063 6f6f 7264 696e 6174 652e 0a20 2020   coordinate..   
-00011a50: 2020 2020 2064 656c 2072 6573 2e63 6f6f       del res.coo
-00011a60: 7264 735b 6469 6d5d 0a0a 2020 2020 6966  rds[dim]..    if
-00011a70: 2073 6b69 706e 6120 6f72 2028 736b 6970   skipna or (skip
-00011a80: 6e61 2069 7320 4e6f 6e65 2061 6e64 2061  na is None and a
-00011a90: 7272 6179 2e64 7479 7065 2e6b 696e 6420  rray.dtype.kind 
-00011aa0: 696e 206e 615f 6474 7970 6573 293a 0a20  in na_dtypes):. 
-00011ab0: 2020 2020 2020 2023 2050 7574 2074 6865         # Put the
-00011ac0: 204e 614e 2076 616c 7565 7320 6261 636b   NaN values back
-00011ad0: 2069 6e20 6166 7465 7220 7265 6d6f 7669   in after removi
-00011ae0: 6e67 2074 6865 6d0a 2020 2020 2020 2020  ng them.        
-00011af0: 7265 7320 3d20 7265 732e 7768 6572 6528  res = res.where(
-00011b00: 7e61 6c6c 6e61 2c20 6669 6c6c 5f76 616c  ~allna, fill_val
-00011b10: 7565 290a 0a20 2020 2023 2043 6f70 7920  ue)..    # Copy 
-00011b20: 6174 7472 6962 7574 6573 2066 726f 6d20  attributes from 
-00011b30: 6172 676d 696e 2f61 7267 6d61 782c 2069  argmin/argmax, i
-00011b40: 6620 616e 790a 2020 2020 7265 732e 6174  f any.    res.at
-00011b50: 7472 7320 3d20 696e 6478 2e61 7474 7273  trs = indx.attrs
-00011b60: 0a0a 2020 2020 7265 7475 726e 2072 6573  ..    return res
-00011b70: 0a0a 0a5f 5420 3d20 5479 7065 5661 7228  ..._T = TypeVar(
-00011b80: 225f 5422 2c20 626f 756e 643d 556e 696f  "_T", bound=Unio
-00011b90: 6e5b 2244 6174 6173 6574 222c 2022 4461  n["Dataset", "Da
-00011ba0: 7461 4172 7261 7922 5d29 0a5f 5520 3d20  taArray"])._U = 
-00011bb0: 5479 7065 5661 7228 225f 5522 2c20 626f  TypeVar("_U", bo
-00011bc0: 756e 643d 556e 696f 6e5b 2244 6174 6173  und=Union["Datas
-00011bd0: 6574 222c 2022 4461 7461 4172 7261 7922  et", "DataArray"
-00011be0: 5d29 0a5f 5620 3d20 5479 7065 5661 7228  ])._V = TypeVar(
-00011bf0: 225f 5622 2c20 626f 756e 643d 556e 696f  "_V", bound=Unio
-00011c00: 6e5b 2244 6174 6173 6574 222c 2022 4461  n["Dataset", "Da
-00011c10: 7461 4172 7261 7922 5d29 0a0a 0a40 6f76  taArray"])...@ov
-00011c20: 6572 6c6f 6164 0a64 6566 2075 6e69 6679  erload.def unify
-00011c30: 5f63 6875 6e6b 7328 5f5f 6f62 6a3a 205f  _chunks(__obj: _
-00011c40: 5429 202d 3e20 7475 706c 655b 5f54 5d3a  T) -> tuple[_T]:
-00011c50: 0a20 2020 202e 2e2e 0a0a 0a40 6f76 6572  .    ......@over
-00011c60: 6c6f 6164 0a64 6566 2075 6e69 6679 5f63  load.def unify_c
-00011c70: 6875 6e6b 7328 5f5f 6f62 6a31 3a20 5f54  hunks(__obj1: _T
-00011c80: 2c20 5f5f 6f62 6a32 3a20 5f55 2920 2d3e  , __obj2: _U) ->
-00011c90: 2074 7570 6c65 5b5f 542c 205f 555d 3a0a   tuple[_T, _U]:.
-00011ca0: 2020 2020 2e2e 2e0a 0a0a 406f 7665 726c      ......@overl
-00011cb0: 6f61 640a 6465 6620 756e 6966 795f 6368  oad.def unify_ch
-00011cc0: 756e 6b73 285f 5f6f 626a 313a 205f 542c  unks(__obj1: _T,
-00011cd0: 205f 5f6f 626a 323a 205f 552c 205f 5f6f   __obj2: _U, __o
-00011ce0: 626a 333a 205f 5629 202d 3e20 7475 706c  bj3: _V) -> tupl
-00011cf0: 655b 5f54 2c20 5f55 2c20 5f56 5d3a 0a20  e[_T, _U, _V]:. 
-00011d00: 2020 202e 2e2e 0a0a 0a40 6f76 6572 6c6f     ......@overlo
-00011d10: 6164 0a64 6566 2075 6e69 6679 5f63 6875  ad.def unify_chu
-00011d20: 6e6b 7328 2a6f 626a 6563 7473 3a20 4461  nks(*objects: Da
-00011d30: 7461 7365 7420 7c20 4461 7461 4172 7261  taset | DataArra
-00011d40: 7929 202d 3e20 7475 706c 655b 4461 7461  y) -> tuple[Data
-00011d50: 7365 7420 7c20 4461 7461 4172 7261 792c  set | DataArray,
-00011d60: 202e 2e2e 5d3a 0a20 2020 202e 2e2e 0a0a   ...]:.    .....
-00011d70: 0a64 6566 2075 6e69 6679 5f63 6875 6e6b  .def unify_chunk
-00011d80: 7328 2a6f 626a 6563 7473 3a20 4461 7461  s(*objects: Data
-00011d90: 7365 7420 7c20 4461 7461 4172 7261 7929  set | DataArray)
-00011da0: 202d 3e20 7475 706c 655b 4461 7461 7365   -> tuple[Datase
-00011db0: 7420 7c20 4461 7461 4172 7261 792c 202e  t | DataArray, .
-00011dc0: 2e2e 5d3a 0a20 2020 2022 2222 0a20 2020  ..]:.    """.   
-00011dd0: 2047 6976 656e 2061 6e79 206e 756d 6265   Given any numbe
-00011de0: 7220 6f66 2044 6174 6173 6574 2061 6e64  r of Dataset and
-00011df0: 2f6f 7220 4461 7461 4172 7261 7920 6f62  /or DataArray ob
-00011e00: 6a65 6374 732c 2072 6574 7572 6e73 0a20  jects, returns. 
-00011e10: 2020 206e 6577 206f 626a 6563 7473 2077     new objects w
-00011e20: 6974 6820 756e 6966 6965 6420 6368 756e  ith unified chun
-00011e30: 6b20 7369 7a65 2061 6c6f 6e67 2061 6c6c  k size along all
-00011e40: 2063 6875 6e6b 6564 2064 696d 656e 7369   chunked dimensi
-00011e50: 6f6e 732e 0a0a 2020 2020 5265 7475 726e  ons...    Return
-00011e60: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00011e70: 2020 756e 6966 6965 6420 2844 6174 6141    unified (DataA
-00011e80: 7272 6179 206f 7220 4461 7461 7365 7429  rray or Dataset)
-00011e90: 20e2 8093 2054 7570 6c65 206f 6620 6f62   ... Tuple of ob
-00011ea0: 6a65 6374 7320 7769 7468 2074 6865 2073  jects with the s
-00011eb0: 616d 6520 7479 7065 2061 730a 2020 2020  ame type as.    
-00011ec0: 2a6f 626a 6563 7473 2077 6974 6820 636f  *objects with co
-00011ed0: 6e73 6973 7465 6e74 2063 6875 6e6b 2073  nsistent chunk s
-00011ee0: 697a 6573 2066 6f72 2061 6c6c 2064 6173  izes for all das
-00011ef0: 6b2d 6172 7261 7920 7661 7269 6162 6c65  k-array variable
-00011f00: 730a 0a20 2020 2053 6565 2041 6c73 6f0a  s..    See Also.
-00011f10: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00011f20: 2064 6173 6b2e 6172 7261 792e 636f 7265   dask.array.core
-00011f30: 2e75 6e69 6679 5f63 6875 6e6b 730a 2020  .unify_chunks.  
-00011f40: 2020 2222 220a 2020 2020 6672 6f6d 2078    """.    from x
-00011f50: 6172 7261 792e 636f 7265 2e64 6174 6161  array.core.dataa
-00011f60: 7272 6179 2069 6d70 6f72 7420 4461 7461  rray import Data
-00011f70: 4172 7261 790a 0a20 2020 2023 2043 6f6e  Array..    # Con
-00011f80: 7665 7274 2061 6c6c 206f 626a 6563 7473  vert all objects
-00011f90: 2074 6f20 6461 7461 7365 7473 0a20 2020   to datasets.   
-00011fa0: 2064 6174 6173 6574 7320 3d20 5b0a 2020   datasets = [.  
-00011fb0: 2020 2020 2020 6f62 6a2e 5f74 6f5f 7465        obj._to_te
-00011fc0: 6d70 5f64 6174 6173 6574 2829 2069 6620  mp_dataset() if 
-00011fd0: 6973 696e 7374 616e 6365 286f 626a 2c20  isinstance(obj, 
-00011fe0: 4461 7461 4172 7261 7929 2065 6c73 6520  DataArray) else 
-00011ff0: 6f62 6a2e 636f 7079 2829 0a20 2020 2020  obj.copy().     
-00012000: 2020 2066 6f72 206f 626a 2069 6e20 6f62     for obj in ob
-00012010: 6a65 6374 730a 2020 2020 5d0a 0a20 2020  jects.    ]..   
-00012020: 2023 2047 6574 2061 7267 756d 656e 7473   # Get arguments
-00012030: 2074 6f20 7061 7373 2069 6e74 6f20 6461   to pass into da
-00012040: 736b 2e61 7272 6179 2e63 6f72 652e 756e  sk.array.core.un
-00012050: 6966 795f 6368 756e 6b73 0a20 2020 2075  ify_chunks.    u
-00012060: 6e69 6679 5f63 6875 6e6b 735f 6172 6773  nify_chunks_args
-00012070: 203d 205b 5d0a 2020 2020 7369 7a65 733a   = [].    sizes:
-00012080: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00012090: 696e 745d 203d 207b 7d0a 2020 2020 666f  int] = {}.    fo
-000120a0: 7220 6473 2069 6e20 6461 7461 7365 7473  r ds in datasets
-000120b0: 3a0a 2020 2020 2020 2020 666f 7220 7620  :.        for v 
-000120c0: 696e 2064 732e 5f76 6172 6961 626c 6573  in ds._variables
-000120d0: 2e76 616c 7565 7328 293a 0a20 2020 2020  .values():.     
-000120e0: 2020 2020 2020 2069 6620 762e 6368 756e         if v.chun
-000120f0: 6b73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ks is not None:.
-00012100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012110: 2320 4368 6563 6b20 7468 6174 2073 697a  # Check that siz
-00012120: 6573 206d 6174 6368 2061 6372 6f73 7320  es match across 
-00012130: 6469 6666 6572 656e 7420 6461 7461 7365  different datase
-00012140: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-00012150: 2020 2066 6f72 2064 696d 2c20 7369 7a65     for dim, size
-00012160: 2069 6e20 762e 7369 7a65 732e 6974 656d   in v.sizes.item
-00012170: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00012180: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121a0: 2020 2020 2020 6966 2073 697a 6573 5b64        if sizes[d
-000121b0: 696d 5d20 213d 2073 697a 653a 0a20 2020  im] != size:.   
-000121c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121d0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000121e0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-000121f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012200: 2020 2020 2020 2020 2020 2066 2244 696d             f"Dim
-00012210: 656e 7369 6f6e 207b 6469 6d21 727d 2073  ension {dim!r} s
-00012220: 697a 6520 6d69 736d 6174 6368 3a20 7b73  ize mismatch: {s
-00012230: 697a 6573 5b64 696d 5d7d 2021 3d20 7b73  izes[dim]} != {s
-00012240: 697a 657d 220a 2020 2020 2020 2020 2020  ize}".          
-00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012260: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00012270: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-00012280: 6579 4572 726f 723a 0a20 2020 2020 2020  eyError:.       
-00012290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122a0: 2073 697a 6573 5b64 696d 5d20 3d20 7369   sizes[dim] = si
-000122b0: 7a65 0a20 2020 2020 2020 2020 2020 2020  ze.             
-000122c0: 2020 2075 6e69 6679 5f63 6875 6e6b 735f     unify_chunks_
-000122d0: 6172 6773 202b 3d20 5b76 2e5f 6461 7461  args += [v._data
-000122e0: 2c20 762e 5f64 696d 735d 0a0a 2020 2020  , v._dims]..    
-000122f0: 2320 4e6f 2064 6173 6b20 6172 7261 7973  # No dask arrays
-00012300: 3a20 5265 7475 726e 2069 6e70 7574 730a  : Return inputs.
-00012310: 2020 2020 6966 206e 6f74 2075 6e69 6679      if not unify
-00012320: 5f63 6875 6e6b 735f 6172 6773 3a0a 2020  _chunks_args:.  
-00012330: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
-00012340: 6563 7473 0a0a 2020 2020 2320 5275 6e20  ects..    # Run 
-00012350: 6461 736b 2e61 7272 6179 2e63 6f72 652e  dask.array.core.
-00012360: 756e 6966 795f 6368 756e 6b73 0a20 2020  unify_chunks.   
-00012370: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
-00012380: 2e63 6f72 6520 696d 706f 7274 2075 6e69  .core import uni
-00012390: 6679 5f63 6875 6e6b 730a 0a20 2020 205f  fy_chunks..    _
-000123a0: 2c20 6461 736b 5f64 6174 6120 3d20 756e  , dask_data = un
-000123b0: 6966 795f 6368 756e 6b73 282a 756e 6966  ify_chunks(*unif
-000123c0: 795f 6368 756e 6b73 5f61 7267 7329 0a20  y_chunks_args). 
-000123d0: 2020 2064 6173 6b5f 6461 7461 5f69 7465     dask_data_ite
-000123e0: 7220 3d20 6974 6572 2864 6173 6b5f 6461  r = iter(dask_da
-000123f0: 7461 290a 2020 2020 6f75 743a 206c 6973  ta).    out: lis
-00012400: 745b 4461 7461 7365 7420 7c20 4461 7461  t[Dataset | Data
-00012410: 4172 7261 795d 203d 205b 5d0a 2020 2020  Array] = [].    
-00012420: 666f 7220 6f62 6a2c 2064 7320 696e 207a  for obj, ds in z
-00012430: 6970 286f 626a 6563 7473 2c20 6461 7461  ip(objects, data
-00012440: 7365 7473 293a 0a20 2020 2020 2020 2066  sets):.        f
-00012450: 6f72 206b 2c20 7620 696e 2064 732e 5f76  or k, v in ds._v
-00012460: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
-00012470: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00012480: 2076 2e63 6875 6e6b 7320 6973 206e 6f74   v.chunks is not
-00012490: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000124a0: 2020 2020 2020 2064 732e 5f76 6172 6961         ds._varia
-000124b0: 626c 6573 5b6b 5d20 3d20 762e 636f 7079  bles[k] = v.copy
-000124c0: 2864 6174 613d 6e65 7874 2864 6173 6b5f  (data=next(dask_
-000124d0: 6461 7461 5f69 7465 7229 290a 2020 2020  data_iter)).    
-000124e0: 2020 2020 6f75 742e 6170 7065 6e64 286f      out.append(o
-000124f0: 626a 2e5f 6672 6f6d 5f74 656d 705f 6461  bj._from_temp_da
-00012500: 7461 7365 7428 6473 2920 6966 2069 7369  taset(ds) if isi
-00012510: 6e73 7461 6e63 6528 6f62 6a2c 2044 6174  nstance(obj, Dat
-00012520: 6141 7272 6179 2920 656c 7365 2064 7329  aArray) else ds)
-00012530: 0a0a 2020 2020 7265 7475 726e 2074 7570  ..    return tup
-00012540: 6c65 286f 7574 290a                      le(out).
+00006290: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+000062a0: 2064 6566 2066 756e 6328 2a61 7272 6179   def func(*array
+000062b0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+000062c0: 2020 2020 7265 7320 3d20 6368 756e 6b6d      res = chunkm
+000062d0: 616e 6167 6572 2e61 7070 6c79 5f67 7566  anager.apply_guf
+000062e0: 756e 6328 0a20 2020 2020 2020 2020 2020  unc(.           
+000062f0: 2020 2020 2020 2020 206e 756d 7079 5f66           numpy_f
+00006300: 756e 632c 0a20 2020 2020 2020 2020 2020  unc,.           
+00006310: 2020 2020 2020 2020 2073 6967 6e61 7475           signatu
+00006320: 7265 2e74 6f5f 6775 6675 6e63 5f73 7472  re.to_gufunc_str
+00006330: 696e 6728 6578 636c 7564 655f 6469 6d73  ing(exclude_dims
+00006340: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00006350: 2020 2020 2020 202a 6172 7261 7973 2c0a         *arrays,.
+00006360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006370: 2020 2020 7665 6374 6f72 697a 653d 7665      vectorize=ve
+00006380: 6374 6f72 697a 652c 0a20 2020 2020 2020  ctorize,.       
+00006390: 2020 2020 2020 2020 2020 2020 206f 7574               out
+000063a0: 7075 745f 6474 7970 6573 3d6f 7574 7075  put_dtypes=outpu
+000063b0: 745f 6474 7970 6573 2c0a 2020 2020 2020  t_dtypes,.      
+000063c0: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
+000063d0: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
+000063e0: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
+000063f0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00006400: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00006410: 730a 0a20 2020 2020 2020 2065 6c69 6620  s..        elif 
+00006420: 6461 736b 203d 3d20 2261 6c6c 6f77 6564  dask == "allowed
+00006430: 223a 0a20 2020 2020 2020 2020 2020 2070  ":.            p
+00006440: 6173 730a 2020 2020 2020 2020 656c 7365  ass.        else
+00006450: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00006460: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00006470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006480: 2275 6e6b 6e6f 776e 2073 6574 7469 6e67  "unknown setting
+00006490: 2066 6f72 2063 6875 6e6b 6564 2061 7272   for chunked arr
+000064a0: 6179 2068 616e 646c 696e 6720 696e 2022  ay handling in "
+000064b0: 2066 2261 7070 6c79 5f75 6675 6e63 3a20   f"apply_ufunc: 
+000064c0: 7b64 6173 6b7d 220a 2020 2020 2020 2020  {dask}".        
+000064d0: 2020 2020 290a 2020 2020 656c 7365 3a0a      ).    else:.
+000064e0: 2020 2020 2020 2020 6966 2076 6563 746f          if vecto
+000064f0: 7269 7a65 3a0a 2020 2020 2020 2020 2020  rize:.          
+00006500: 2020 6675 6e63 203d 205f 7665 6374 6f72    func = _vector
+00006510: 697a 6528 0a20 2020 2020 2020 2020 2020  ize(.           
+00006520: 2020 2020 2066 756e 632c 2073 6967 6e61       func, signa
+00006530: 7475 7265 2c20 6f75 7470 7574 5f64 7479  ture, output_dty
+00006540: 7065 733d 6f75 7470 7574 5f64 7479 7065  pes=output_dtype
+00006550: 732c 2065 7863 6c75 6465 5f64 696d 733d  s, exclude_dims=
+00006560: 6578 636c 7564 655f 6469 6d73 0a20 2020  exclude_dims.   
+00006570: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00006580: 7265 7375 6c74 5f64 6174 6120 3d20 6675  result_data = fu
+00006590: 6e63 282a 696e 7075 745f 6461 7461 290a  nc(*input_data).
+000065a0: 0a20 2020 2069 6620 7369 676e 6174 7572  .    if signatur
+000065b0: 652e 6e75 6d5f 6f75 7470 7574 7320 3d3d  e.num_outputs ==
+000065c0: 2031 3a0a 2020 2020 2020 2020 7265 7375   1:.        resu
+000065d0: 6c74 5f64 6174 6120 3d20 2872 6573 756c  lt_data = (resul
+000065e0: 745f 6461 7461 2c29 0a20 2020 2065 6c69  t_data,).    eli
+000065f0: 6620 280a 2020 2020 2020 2020 6e6f 7420  f (.        not 
+00006600: 6973 696e 7374 616e 6365 2872 6573 756c  isinstance(resul
+00006610: 745f 6461 7461 2c20 7475 706c 6529 206f  t_data, tuple) o
+00006620: 7220 6c65 6e28 7265 7375 6c74 5f64 6174  r len(result_dat
+00006630: 6129 2021 3d20 7369 676e 6174 7572 652e  a) != signature.
+00006640: 6e75 6d5f 6f75 7470 7574 730a 2020 2020  num_outputs.    
+00006650: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
+00006660: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00006670: 2020 2020 2020 2020 2022 6170 706c 6965           "applie
+00006680: 6420 6675 6e63 7469 6f6e 2064 6f65 7320  d function does 
+00006690: 6e6f 7420 6861 7665 2074 6865 206e 756d  not have the num
+000066a0: 6265 7220 6f66 2022 0a20 2020 2020 2020  ber of ".       
+000066b0: 2020 2020 2022 6f75 7470 7574 7320 7370       "outputs sp
+000066c0: 6563 6966 6965 6420 696e 2074 6865 2075  ecified in the u
+000066d0: 6675 6e63 2073 6967 6e61 7475 7265 2e20  func signature. 
+000066e0: 220a 2020 2020 2020 2020 2020 2020 2252  ".            "R
+000066f0: 6573 756c 7420 6973 206e 6f74 2061 2074  esult is not a t
+00006700: 7570 6c65 206f 6620 7b7d 2065 6c65 6d65  uple of {} eleme
+00006710: 6e74 733a 207b 2172 7d22 2e66 6f72 6d61  nts: {!r}".forma
+00006720: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00006730: 2020 2073 6967 6e61 7475 7265 2e6e 756d     signature.num
+00006740: 5f6f 7574 7075 7473 2c20 7265 7375 6c74  _outputs, result
+00006750: 5f64 6174 610a 2020 2020 2020 2020 2020  _data.          
+00006760: 2020 290a 2020 2020 2020 2020 290a 0a20    ).        ).. 
+00006770: 2020 206f 626a 7320 3d20 5f61 6c6c 5f6f     objs = _all_o
+00006780: 665f 7479 7065 2861 7267 732c 2056 6172  f_type(args, Var
+00006790: 6961 626c 6529 0a20 2020 2061 7474 7273  iable).    attrs
+000067a0: 203d 206d 6572 6765 5f61 7474 7273 280a   = merge_attrs(.
+000067b0: 2020 2020 2020 2020 5b6f 626a 2e61 7474          [obj.att
+000067c0: 7273 2066 6f72 206f 626a 2069 6e20 6f62  rs for obj in ob
+000067d0: 6a73 5d2c 0a20 2020 2020 2020 2063 6f6d  js],.        com
+000067e0: 6269 6e65 5f61 7474 7273 3d6b 6565 705f  bine_attrs=keep_
+000067f0: 6174 7472 732c 0a20 2020 2029 0a0a 2020  attrs,.    )..  
+00006800: 2020 6f75 7470 7574 3a20 6c69 7374 5b56    output: list[V
+00006810: 6172 6961 626c 655d 203d 205b 5d0a 2020  ariable] = [].  
+00006820: 2020 666f 7220 6469 6d73 2c20 6461 7461    for dims, data
+00006830: 2069 6e20 7a69 7028 6f75 7470 7574 5f64   in zip(output_d
+00006840: 696d 732c 2072 6573 756c 745f 6461 7461  ims, result_data
+00006850: 293a 0a20 2020 2020 2020 2064 6174 6120  ):.        data 
+00006860: 3d20 6173 5f63 6f6d 7061 7469 626c 655f  = as_compatible_
+00006870: 6461 7461 2864 6174 6129 0a20 2020 2020  data(data).     
+00006880: 2020 2069 6620 6461 7461 2e6e 6469 6d20     if data.ndim 
+00006890: 213d 206c 656e 2864 696d 7329 3a0a 2020  != len(dims):.  
+000068a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000068b0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000068c0: 2020 2020 2020 2020 2020 2020 2261 7070              "app
+000068d0: 6c69 6564 2066 756e 6374 696f 6e20 7265  lied function re
+000068e0: 7475 726e 6564 2064 6174 6120 7769 7468  turned data with
+000068f0: 2075 6e65 7870 6563 7465 6420 220a 2020   unexpected ".  
+00006900: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00006910: 6e75 6d62 6572 206f 6620 6469 6d65 6e73  number of dimens
+00006920: 696f 6e73 2e20 5265 6365 6976 6564 207b  ions. Received {
+00006930: 6461 7461 2e6e 6469 6d7d 2064 696d 656e  data.ndim} dimen
+00006940: 7369 6f6e 2873 2920 6275 7420 220a 2020  sion(s) but ".  
+00006950: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00006960: 6578 7065 6374 6564 207b 6c65 6e28 6469  expected {len(di
+00006970: 6d73 297d 2064 696d 656e 7369 6f6e 7320  ms)} dimensions 
+00006980: 7769 7468 206e 616d 6573 3a20 7b64 696d  with names: {dim
+00006990: 7321 727d 220a 2020 2020 2020 2020 2020  s!r}".          
+000069a0: 2020 290a 0a20 2020 2020 2020 2076 6172    )..        var
+000069b0: 203d 2056 6172 6961 626c 6528 6469 6d73   = Variable(dims
+000069c0: 2c20 6461 7461 2c20 6661 7374 7061 7468  , data, fastpath
+000069d0: 3d54 7275 6529 0a20 2020 2020 2020 2066  =True).        f
+000069e0: 6f72 2064 696d 2c20 6e65 775f 7369 7a65  or dim, new_size
+000069f0: 2069 6e20 7661 722e 7369 7a65 732e 6974   in var.sizes.it
+00006a00: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00006a10: 2020 2069 6620 6469 6d20 696e 2064 696d     if dim in dim
+00006a20: 5f73 697a 6573 2061 6e64 206e 6577 5f73  _sizes and new_s
+00006a30: 697a 6520 213d 2064 696d 5f73 697a 6573  ize != dim_sizes
+00006a40: 5b64 696d 5d3a 0a20 2020 2020 2020 2020  [dim]:.         
+00006a50: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00006a60: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00006a70: 2020 2020 2020 2020 2020 2020 2022 7369               "si
+00006a80: 7a65 206f 6620 6469 6d65 6e73 696f 6e20  ze of dimension 
+00006a90: 7b21 727d 206f 6e20 696e 7075 7473 2077  {!r} on inputs w
+00006aa0: 6173 2075 6e65 7870 6563 7465 646c 7920  as unexpectedly 
+00006ab0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00006ac0: 2020 2020 2020 2263 6861 6e67 6564 2062        "changed b
+00006ad0: 7920 6170 706c 6965 6420 6675 6e63 7469  y applied functi
+00006ae0: 6f6e 2066 726f 6d20 7b7d 2074 6f20 7b7d  on from {} to {}
+00006af0: 2e20 4f6e 6c79 2022 0a20 2020 2020 2020  . Only ".       
+00006b00: 2020 2020 2020 2020 2020 2020 2022 6469               "di
+00006b10: 6d65 6e73 696f 6e73 2073 7065 6369 6669  mensions specifi
+00006b20: 6564 2069 6e20 6060 6578 636c 7564 655f  ed in ``exclude_
+00006b30: 6469 6d73 6060 2077 6974 6820 220a 2020  dims`` with ".  
+00006b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b50: 2020 2278 6172 7261 792e 6170 706c 795f    "xarray.apply_
+00006b60: 7566 756e 6320 6172 6520 616c 6c6f 7765  ufunc are allowe
+00006b70: 6420 746f 2063 6861 6e67 6520 7369 7a65  d to change size
+00006b80: 2e22 2e66 6f72 6d61 7428 0a20 2020 2020  .".format(.     
+00006b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ba0: 2020 2064 696d 2c20 6469 6d5f 7369 7a65     dim, dim_size
+00006bb0: 735b 6469 6d5d 2c20 6e65 775f 7369 7a65  s[dim], new_size
+00006bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006bd0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00006be0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00006bf0: 2020 7661 722e 6174 7472 7320 3d20 6174    var.attrs = at
+00006c00: 7472 730a 2020 2020 2020 2020 6f75 7470  trs.        outp
+00006c10: 7574 2e61 7070 656e 6428 7661 7229 0a0a  ut.append(var)..
+00006c20: 2020 2020 6966 2073 6967 6e61 7475 7265      if signature
+00006c30: 2e6e 756d 5f6f 7574 7075 7473 203d 3d20  .num_outputs == 
+00006c40: 313a 0a20 2020 2020 2020 2072 6574 7572  1:.        retur
+00006c50: 6e20 6f75 7470 7574 5b30 5d0a 2020 2020  n output[0].    
+00006c60: 656c 7365 3a0a 2020 2020 2020 2020 7265  else:.        re
+00006c70: 7475 726e 2074 7570 6c65 286f 7574 7075  turn tuple(outpu
+00006c80: 7429 0a0a 0a64 6566 2061 7070 6c79 5f61  t)...def apply_a
+00006c90: 7272 6179 5f75 6675 6e63 2866 756e 632c  rray_ufunc(func,
+00006ca0: 202a 6172 6773 2c20 6461 736b 3d22 666f   *args, dask="fo
+00006cb0: 7262 6964 6465 6e22 293a 0a20 2020 2022  rbidden"):.    "
+00006cc0: 2222 4170 706c 7920 6120 6e64 6172 7261  ""Apply a ndarra
+00006cd0: 7920 6c65 7665 6c20 6675 6e63 7469 6f6e  y level function
+00006ce0: 206f 7665 7220 6e64 6172 7261 7920 6f62   over ndarray ob
+00006cf0: 6a65 6374 732e 2222 220a 2020 2020 6966  jects.""".    if
+00006d00: 2061 6e79 2869 735f 6368 756e 6b65 645f   any(is_chunked_
+00006d10: 6172 7261 7928 6172 6729 2066 6f72 2061  array(arg) for a
+00006d20: 7267 2069 6e20 6172 6773 293a 0a20 2020  rg in args):.   
+00006d30: 2020 2020 2069 6620 6461 736b 203d 3d20       if dask == 
+00006d40: 2266 6f72 6269 6464 656e 223a 0a20 2020  "forbidden":.   
+00006d50: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00006d60: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00006d70: 2020 2020 2020 2020 2020 2022 6170 706c             "appl
+00006d80: 795f 7566 756e 6320 656e 636f 756e 7465  y_ufunc encounte
+00006d90: 7265 6420 6120 6461 736b 2061 7272 6179  red a dask array
+00006da0: 206f 6e20 616e 2022 0a20 2020 2020 2020   on an ".       
+00006db0: 2020 2020 2020 2020 2022 6172 6775 6d65           "argume
+00006dc0: 6e74 2c20 6275 7420 6861 6e64 6c69 6e67  nt, but handling
+00006dd0: 2066 6f72 2064 6173 6b20 6172 7261 7973   for dask arrays
+00006de0: 2068 6173 206e 6f74 2022 0a20 2020 2020   has not ".     
+00006df0: 2020 2020 2020 2020 2020 2022 6265 656e             "been
+00006e00: 2065 6e61 626c 6564 2e20 4569 7468 6572   enabled. Either
+00006e10: 2073 6574 2074 6865 2060 6064 6173 6b60   set the ``dask`
+00006e20: 6020 6172 6775 6d65 6e74 2022 0a20 2020  ` argument ".   
+00006e30: 2020 2020 2020 2020 2020 2020 2022 6f72               "or
+00006e40: 206c 6f61 6420 796f 7572 2064 6174 6120   load your data 
+00006e50: 696e 746f 206d 656d 6f72 7920 6669 7273  into memory firs
+00006e60: 7420 7769 7468 2022 0a20 2020 2020 2020  t with ".       
+00006e70: 2020 2020 2020 2020 2022 6060 2e6c 6f61           "``.loa
+00006e80: 6428 2960 6020 6f72 2060 602e 636f 6d70  d()`` or ``.comp
+00006e90: 7574 6528 2960 6022 0a20 2020 2020 2020  ute()``".       
+00006ea0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00006eb0: 6c69 6620 6461 736b 203d 3d20 2270 6172  lif dask == "par
+00006ec0: 616c 6c65 6c69 7a65 6422 3a0a 2020 2020  allelized":.    
+00006ed0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00006ee0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00006ef0: 2020 2020 2020 2020 2020 2263 616e 6e6f            "canno
+00006f00: 7420 7573 6520 6461 736b 3d27 7061 7261  t use dask='para
+00006f10: 6c6c 656c 697a 6564 2720 666f 7220 6170  llelized' for ap
+00006f20: 706c 795f 7566 756e 6320 220a 2020 2020  ply_ufunc ".    
+00006f30: 2020 2020 2020 2020 2020 2020 2275 6e6c              "unl
+00006f40: 6573 7320 6174 206c 6561 7374 206f 6e65  ess at least one
+00006f50: 2069 6e70 7574 2069 7320 616e 2078 6172   input is an xar
+00006f60: 7261 7920 6f62 6a65 6374 220a 2020 2020  ray object".    
+00006f70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00006f80: 2020 656c 6966 2064 6173 6b20 3d3d 2022    elif dask == "
+00006f90: 616c 6c6f 7765 6422 3a0a 2020 2020 2020  allowed":.      
+00006fa0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00006fb0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00006fc0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00006fd0: 4572 726f 7228 6622 756e 6b6e 6f77 6e20  Error(f"unknown 
+00006fe0: 7365 7474 696e 6720 666f 7220 6461 736b  setting for dask
+00006ff0: 2061 7272 6179 2068 616e 646c 696e 673a   array handling:
+00007000: 207b 6461 736b 7d22 290a 2020 2020 7265   {dask}").    re
+00007010: 7475 726e 2066 756e 6328 2a61 7267 7329  turn func(*args)
+00007020: 0a0a 0a64 6566 2061 7070 6c79 5f75 6675  ...def apply_ufu
+00007030: 6e63 280a 2020 2020 6675 6e63 3a20 4361  nc(.    func: Ca
+00007040: 6c6c 6162 6c65 2c0a 2020 2020 2a61 7267  llable,.    *arg
+00007050: 733a 2041 6e79 2c0a 2020 2020 696e 7075  s: Any,.    inpu
+00007060: 745f 636f 7265 5f64 696d 733a 2053 6571  t_core_dims: Seq
+00007070: 7565 6e63 655b 5365 7175 656e 6365 5d20  uence[Sequence] 
+00007080: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00007090: 2020 206f 7574 7075 745f 636f 7265 5f64     output_core_d
+000070a0: 696d 733a 2053 6571 7565 6e63 655b 5365  ims: Sequence[Se
+000070b0: 7175 656e 6365 5d20 7c20 4e6f 6e65 203d  quence] | None =
+000070c0: 2028 2829 2c29 2c0a 2020 2020 6578 636c   ((),),.    excl
+000070d0: 7564 655f 6469 6d73 3a20 5365 7420 3d20  ude_dims: Set = 
+000070e0: 6672 6f7a 656e 7365 7428 292c 0a20 2020  frozenset(),.   
+000070f0: 2076 6563 746f 7269 7a65 3a20 626f 6f6c   vectorize: bool
+00007100: 203d 2046 616c 7365 2c0a 2020 2020 6a6f   = False,.    jo
+00007110: 696e 3a20 4a6f 696e 4f70 7469 6f6e 7320  in: JoinOptions 
+00007120: 3d20 2265 7861 6374 222c 0a20 2020 2064  = "exact",.    d
+00007130: 6174 6173 6574 5f6a 6f69 6e3a 2073 7472  ataset_join: str
+00007140: 203d 2022 6578 6163 7422 2c0a 2020 2020   = "exact",.    
+00007150: 6461 7461 7365 745f 6669 6c6c 5f76 616c  dataset_fill_val
+00007160: 7565 3a20 6f62 6a65 6374 203d 205f 4e4f  ue: object = _NO
+00007170: 5f46 494c 4c5f 5641 4c55 452c 0a20 2020  _FILL_VALUE,.   
+00007180: 206b 6565 705f 6174 7472 733a 2062 6f6f   keep_attrs: boo
+00007190: 6c20 7c20 7374 7220 7c20 4e6f 6e65 203d  l | str | None =
+000071a0: 204e 6f6e 652c 0a20 2020 206b 7761 7267   None,.    kwarg
+000071b0: 733a 204d 6170 7069 6e67 207c 204e 6f6e  s: Mapping | Non
+000071c0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 6461  e = None,.    da
+000071d0: 736b 3a20 7374 7220 3d20 2266 6f72 6269  sk: str = "forbi
+000071e0: 6464 656e 222c 0a20 2020 206f 7574 7075  dden",.    outpu
+000071f0: 745f 6474 7970 6573 3a20 5365 7175 656e  t_dtypes: Sequen
+00007200: 6365 207c 204e 6f6e 6520 3d20 4e6f 6e65  ce | None = None
+00007210: 2c0a 2020 2020 6f75 7470 7574 5f73 697a  ,.    output_siz
+00007220: 6573 3a20 4d61 7070 696e 675b 416e 792c  es: Mapping[Any,
+00007230: 2069 6e74 5d20 7c20 4e6f 6e65 203d 204e   int] | None = N
+00007240: 6f6e 652c 0a20 2020 206d 6574 613a 2041  one,.    meta: A
+00007250: 6e79 203d 204e 6f6e 652c 0a20 2020 2064  ny = None,.    d
+00007260: 6173 6b5f 6775 6675 6e63 5f6b 7761 7267  ask_gufunc_kwarg
+00007270: 733a 2064 6963 745b 7374 722c 2041 6e79  s: dict[str, Any
+00007280: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+00007290: 0a29 202d 3e20 416e 793a 0a20 2020 2022  .) -> Any:.    "
+000072a0: 2222 4170 706c 7920 6120 7665 6374 6f72  ""Apply a vector
+000072b0: 697a 6564 2066 756e 6374 696f 6e20 666f  ized function fo
+000072c0: 7220 756e 6c61 6265 6c65 6420 6172 7261  r unlabeled arra
+000072d0: 7973 206f 6e20 7861 7272 6179 206f 626a  ys on xarray obj
+000072e0: 6563 7473 2e0a 0a20 2020 2054 6865 2066  ects...    The f
+000072f0: 756e 6374 696f 6e20 7769 6c6c 2062 6520  unction will be 
+00007300: 6d61 7070 6564 206f 7665 7220 7468 6520  mapped over the 
+00007310: 6461 7461 2076 6172 6961 626c 6528 7329  data variable(s)
+00007320: 206f 6620 7468 6520 696e 7075 740a 2020   of the input.  
+00007330: 2020 6172 6775 6d65 6e74 7320 7573 696e    arguments usin
+00007340: 6720 7861 7272 6179 2773 2073 7461 6e64  g xarray's stand
+00007350: 6172 6420 7275 6c65 7320 666f 7220 6c61  ard rules for la
+00007360: 6265 6c65 6420 636f 6d70 7574 6174 696f  beled computatio
+00007370: 6e2c 2069 6e63 6c75 6469 6e67 0a20 2020  n, including.   
+00007380: 2061 6c69 676e 6d65 6e74 2c20 6272 6f61   alignment, broa
+00007390: 6463 6173 7469 6e67 2c20 6c6f 6f70 696e  dcasting, loopin
+000073a0: 6720 6f76 6572 2047 726f 7570 4279 2f44  g over GroupBy/D
+000073b0: 6174 6173 6574 2076 6172 6961 626c 6573  ataset variables
+000073c0: 2c20 616e 640a 2020 2020 6d65 7267 696e  , and.    mergin
+000073d0: 6720 6f66 2063 6f6f 7264 696e 6174 6573  g of coordinates
+000073e0: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+000073f0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00007400: 0a20 2020 2066 756e 6320 3a20 6361 6c6c  .    func : call
+00007410: 6162 6c65 0a20 2020 2020 2020 2046 756e  able.        Fun
+00007420: 6374 696f 6e20 746f 2063 616c 6c20 6c69  ction to call li
+00007430: 6b65 2060 6066 756e 6328 2a61 7267 732c  ke ``func(*args,
+00007440: 202a 2a6b 7761 7267 7329 6060 206f 6e20   **kwargs)`` on 
+00007450: 756e 6c61 6265 6c65 6420 6172 7261 7973  unlabeled arrays
+00007460: 0a20 2020 2020 2020 2028 6060 2e64 6174  .        (``.dat
+00007470: 6160 6029 2074 6861 7420 7265 7475 726e  a``) that return
+00007480: 7320 616e 2061 7272 6179 206f 7220 7475  s an array or tu
+00007490: 706c 6520 6f66 2061 7272 6179 732e 2049  ple of arrays. I
+000074a0: 6620 6d75 6c74 6970 6c65 0a20 2020 2020  f multiple.     
+000074b0: 2020 2061 7267 756d 656e 7473 2077 6974     arguments wit
+000074c0: 6820 6e6f 6e2d 6d61 7463 6869 6e67 2064  h non-matching d
+000074d0: 696d 656e 7369 6f6e 7320 6172 6520 7375  imensions are su
+000074e0: 7070 6c69 6564 2c20 7468 6973 2066 756e  pplied, this fun
+000074f0: 6374 696f 6e20 6973 0a20 2020 2020 2020  ction is.       
+00007500: 2065 7870 6563 7465 6420 746f 2076 6563   expected to vec
+00007510: 746f 7269 7a65 2028 6272 6f61 6463 6173  torize (broadcas
+00007520: 7429 206f 7665 7220 6178 6573 206f 6620  t) over axes of 
+00007530: 706f 7369 7469 6f6e 616c 2061 7267 756d  positional argum
+00007540: 656e 7473 2069 6e0a 2020 2020 2020 2020  ents in.        
+00007550: 7468 6520 7374 796c 6520 6f66 204e 756d  the style of Num
+00007560: 5079 2075 6e69 7665 7273 616c 2066 756e  Py universal fun
+00007570: 6374 696f 6e73 205b 315d 5f20 2869 6620  ctions [1]_ (if 
+00007580: 7468 6973 2069 7320 6e6f 7420 7468 6520  this is not the 
+00007590: 6361 7365 2c0a 2020 2020 2020 2020 7365  case,.        se
+000075a0: 7420 6060 7665 6374 6f72 697a 653d 5472  t ``vectorize=Tr
+000075b0: 7565 6060 292e 2049 6620 7468 6973 2066  ue``). If this f
+000075c0: 756e 6374 696f 6e20 7265 7475 726e 7320  unction returns 
+000075d0: 6d75 6c74 6970 6c65 206f 7574 7075 7473  multiple outputs
+000075e0: 2c20 796f 750a 2020 2020 2020 2020 6d75  , you.        mu
+000075f0: 7374 2073 6574 2060 606f 7574 7075 745f  st set ``output_
+00007600: 636f 7265 5f64 696d 7360 6020 6173 2077  core_dims`` as w
+00007610: 656c 6c2e 0a20 2020 202a 6172 6773 203a  ell..    *args :
+00007620: 2044 6174 6173 6574 2c20 4461 7461 4172   Dataset, DataAr
+00007630: 7261 792c 2044 6174 6141 7272 6179 4772  ray, DataArrayGr
+00007640: 6f75 7042 792c 2044 6174 6173 6574 4772  oupBy, DatasetGr
+00007650: 6f75 7042 792c 2056 6172 6961 626c 652c  oupBy, Variable,
+00007660: 205c 0a20 2020 2020 2020 206e 756d 7079   \.        numpy
+00007670: 2e6e 6461 7272 6179 2c20 6461 736b 2e61  .ndarray, dask.a
+00007680: 7272 6179 2e41 7272 6179 206f 7220 7363  rray.Array or sc
+00007690: 616c 6172 0a20 2020 2020 2020 204d 6978  alar.        Mix
+000076a0: 206f 6620 6c61 6265 6c65 6420 616e 642f   of labeled and/
+000076b0: 6f72 2075 6e6c 6162 656c 6564 2061 7272  or unlabeled arr
+000076c0: 6179 7320 746f 2077 6869 6368 2074 6f20  ays to which to 
+000076d0: 6170 706c 7920 7468 6520 6675 6e63 7469  apply the functi
+000076e0: 6f6e 2e0a 2020 2020 696e 7075 745f 636f  on..    input_co
+000076f0: 7265 5f64 696d 7320 3a20 7365 7175 656e  re_dims : sequen
+00007700: 6365 206f 6620 7365 7175 656e 6365 2c20  ce of sequence, 
+00007710: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00007720: 204c 6973 7420 6f66 2074 6865 2073 616d   List of the sam
+00007730: 6520 6c65 6e67 7468 2061 7320 6060 6172  e length as ``ar
+00007740: 6773 6060 2067 6976 696e 6720 7468 6520  gs`` giving the 
+00007750: 6c69 7374 206f 6620 636f 7265 2064 696d  list of core dim
+00007760: 656e 7369 6f6e 730a 2020 2020 2020 2020  ensions.        
+00007770: 6f6e 2065 6163 6820 696e 7075 7420 6172  on each input ar
+00007780: 6775 6d65 6e74 2074 6861 7420 7368 6f75  gument that shou
+00007790: 6c64 206e 6f74 2062 6520 6272 6f61 6463  ld not be broadc
+000077a0: 6173 742e 2042 7920 6465 6661 756c 742c  ast. By default,
+000077b0: 2077 650a 2020 2020 2020 2020 6173 7375   we.        assu
+000077c0: 6d65 2074 6865 7265 2061 7265 206e 6f20  me there are no 
+000077d0: 636f 7265 2064 696d 656e 7369 6f6e 7320  core dimensions 
+000077e0: 6f6e 2061 6e79 2069 6e70 7574 2061 7267  on any input arg
+000077f0: 756d 656e 7473 2e0a 0a20 2020 2020 2020  uments...       
+00007800: 2046 6f72 2065 7861 6d70 6c65 2c20 6060   For example, ``
+00007810: 696e 7075 745f 636f 7265 5f64 696d 733d  input_core_dims=
+00007820: 5b5b 5d2c 205b 2774 696d 6527 5d5d 6060  [[], ['time']]``
+00007830: 2069 6e64 6963 6174 6573 2074 6861 7420   indicates that 
+00007840: 616c 6c0a 2020 2020 2020 2020 6469 6d65  all.        dime
+00007850: 6e73 696f 6e73 206f 6e20 7468 6520 6669  nsions on the fi
+00007860: 7273 7420 6172 6775 6d65 6e74 2061 6e64  rst argument and
+00007870: 2061 6c6c 2064 696d 656e 7369 6f6e 7320   all dimensions 
+00007880: 6f74 6865 7220 7468 616e 2027 7469 6d65  other than 'time
+00007890: 270a 2020 2020 2020 2020 6f6e 2074 6865  '.        on the
+000078a0: 2073 6563 6f6e 6420 6172 6775 6d65 6e74   second argument
+000078b0: 2073 686f 756c 6420 6265 2062 726f 6164   should be broad
+000078c0: 6361 7374 2e0a 0a20 2020 2020 2020 2043  cast...        C
+000078d0: 6f72 6520 6469 6d65 6e73 696f 6e73 2061  ore dimensions a
+000078e0: 7265 2061 7574 6f6d 6174 6963 616c 6c79  re automatically
+000078f0: 206d 6f76 6564 2074 6f20 7468 6520 6c61   moved to the la
+00007900: 7374 2061 7865 7320 6f66 2069 6e70 7574  st axes of input
+00007910: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+00007920: 6573 2062 6566 6f72 6520 6170 706c 7969  es before applyi
+00007930: 6e67 2060 6066 756e 6360 602c 2077 6869  ng ``func``, whi
+00007940: 6368 2066 6163 696c 6974 6174 6573 2075  ch facilitates u
+00007950: 7369 6e67 204e 756d 5079 2073 7479 6c65  sing NumPy style
+00007960: 0a20 2020 2020 2020 2067 656e 6572 616c  .        general
+00007970: 697a 6564 2075 6675 6e63 7320 5b32 5d5f  ized ufuncs [2]_
+00007980: 2e0a 2020 2020 6f75 7470 7574 5f63 6f72  ..    output_cor
+00007990: 655f 6469 6d73 203a 206c 6973 7420 6f66  e_dims : list of
+000079a0: 2074 7570 6c65 2c20 6f70 7469 6f6e 616c   tuple, optional
+000079b0: 0a20 2020 2020 2020 204c 6973 7420 6f66  .        List of
+000079c0: 2074 6865 2073 616d 6520 6c65 6e67 7468   the same length
+000079d0: 2061 7320 7468 6520 6e75 6d62 6572 206f   as the number o
+000079e0: 6620 6f75 7470 7574 2061 7267 756d 656e  f output argumen
+000079f0: 7473 2066 726f 6d0a 2020 2020 2020 2020  ts from.        
+00007a00: 6060 6675 6e63 6060 2c20 6769 7669 6e67  ``func``, giving
+00007a10: 2074 6865 206c 6973 7420 6f66 2063 6f72   the list of cor
+00007a20: 6520 6469 6d65 6e73 696f 6e73 206f 6e20  e dimensions on 
+00007a30: 6561 6368 206f 7574 7075 7420 7468 6174  each output that
+00007a40: 2077 6572 650a 2020 2020 2020 2020 6e6f   were.        no
+00007a50: 7420 6272 6f61 6463 6173 7420 6f6e 2074  t broadcast on t
+00007a60: 6865 2069 6e70 7574 732e 2042 7920 6465  he inputs. By de
+00007a70: 6661 756c 742c 2077 6520 6173 7375 6d65  fault, we assume
+00007a80: 2074 6861 7420 6060 6675 6e63 6060 0a20   that ``func``. 
+00007a90: 2020 2020 2020 206f 7574 7075 7473 2065         outputs e
+00007aa0: 7861 6374 6c79 206f 6e65 2061 7272 6179  xactly one array
+00007ab0: 2c20 7769 7468 2061 7865 7320 636f 7272  , with axes corr
+00007ac0: 6573 706f 6e64 696e 6720 746f 2065 6163  esponding to eac
+00007ad0: 6820 6272 6f61 6463 6173 740a 2020 2020  h broadcast.    
+00007ae0: 2020 2020 6469 6d65 6e73 696f 6e2e 0a0a      dimension...
+00007af0: 2020 2020 2020 2020 436f 7265 2064 696d          Core dim
+00007b00: 656e 7369 6f6e 7320 6172 6520 6173 7375  ensions are assu
+00007b10: 6d65 6420 746f 2061 7070 6561 7220 6173  med to appear as
+00007b20: 2074 6865 206c 6173 7420 6469 6d65 6e73   the last dimens
+00007b30: 696f 6e73 206f 6620 6561 6368 0a20 2020  ions of each.   
+00007b40: 2020 2020 206f 7574 7075 7420 696e 2074       output in t
+00007b50: 6865 2070 726f 7669 6465 6420 6f72 6465  he provided orde
+00007b60: 722e 0a20 2020 2065 7863 6c75 6465 5f64  r..    exclude_d
+00007b70: 696d 7320 3a20 7365 742c 206f 7074 696f  ims : set, optio
+00007b80: 6e61 6c0a 2020 2020 2020 2020 436f 7265  nal.        Core
+00007b90: 2064 696d 656e 7369 6f6e 7320 6f6e 2074   dimensions on t
+00007ba0: 6865 2069 6e70 7574 7320 746f 2065 7863  he inputs to exc
+00007bb0: 6c75 6465 2066 726f 6d20 616c 6967 6e6d  lude from alignm
+00007bc0: 656e 7420 616e 640a 2020 2020 2020 2020  ent and.        
+00007bd0: 6272 6f61 6463 6173 7469 6e67 2065 6e74  broadcasting ent
+00007be0: 6972 656c 792e 2041 6e79 2069 6e70 7574  irely. Any input
+00007bf0: 2063 6f6f 7264 696e 6174 6573 2061 6c6f   coordinates alo
+00007c00: 6e67 2074 6865 7365 2064 696d 656e 7369  ng these dimensi
+00007c10: 6f6e 730a 2020 2020 2020 2020 7769 6c6c  ons.        will
+00007c20: 2062 6520 6472 6f70 7065 642e 2045 6163   be dropped. Eac
+00007c30: 6820 6578 636c 7564 6564 2064 696d 656e  h excluded dimen
+00007c40: 7369 6f6e 206d 7573 7420 616c 736f 2061  sion must also a
+00007c50: 7070 6561 7220 696e 0a20 2020 2020 2020  ppear in.       
+00007c60: 2060 6069 6e70 7574 5f63 6f72 655f 6469   ``input_core_di
+00007c70: 6d73 6060 2066 6f72 2061 7420 6c65 6173  ms`` for at leas
+00007c80: 7420 6f6e 6520 6172 6775 6d65 6e74 2e20  t one argument. 
+00007c90: 4f6e 6c79 2064 696d 656e 7369 6f6e 7320  Only dimensions 
+00007ca0: 6c69 7374 6564 0a20 2020 2020 2020 2068  listed.        h
+00007cb0: 6572 6520 6172 6520 616c 6c6f 7765 6420  ere are allowed 
+00007cc0: 746f 2063 6861 6e67 6520 7369 7a65 2062  to change size b
+00007cd0: 6574 7765 656e 2069 6e70 7574 2061 6e64  etween input and
+00007ce0: 206f 7574 7075 7420 6f62 6a65 6374 732e   output objects.
+00007cf0: 0a20 2020 2076 6563 746f 7269 7a65 203a  .    vectorize :
+00007d00: 2062 6f6f 6c2c 206f 7074 696f 6e61 6c0a   bool, optional.
+00007d10: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00007d20: 2074 6865 6e20 6173 7375 6d65 2060 6066   then assume ``f
+00007d30: 756e 6360 6020 6f6e 6c79 2074 616b 6573  unc`` only takes
+00007d40: 2061 7272 6179 7320 6465 6669 6e65 6420   arrays defined 
+00007d50: 6f76 6572 2063 6f72 650a 2020 2020 2020  over core.      
+00007d60: 2020 6469 6d65 6e73 696f 6e73 2061 7320    dimensions as 
+00007d70: 696e 7075 7420 616e 6420 7665 6374 6f72  input and vector
+00007d80: 697a 6520 6974 2061 7574 6f6d 6174 6963  ize it automatic
+00007d90: 616c 6c79 2077 6974 680a 2020 2020 2020  ally with.      
+00007da0: 2020 3a70 793a 6675 6e63 3a60 6e75 6d70    :py:func:`nump
+00007db0: 792e 7665 6374 6f72 697a 6560 2e20 5468  y.vectorize`. Th
+00007dc0: 6973 206f 7074 696f 6e20 6578 6973 7473  is option exists
+00007dd0: 2066 6f72 2063 6f6e 7665 6e69 656e 6365   for convenience
+00007de0: 2c20 6275 7420 6973 0a20 2020 2020 2020  , but is.       
+00007df0: 2061 6c6d 6f73 7420 616c 7761 7973 2073   almost always s
+00007e00: 6c6f 7765 7220 7468 616e 2073 7570 706c  lower than suppl
+00007e10: 7969 6e67 2061 2070 7265 2d76 6563 746f  ying a pre-vecto
+00007e20: 7269 7a65 6420 6675 6e63 7469 6f6e 2e0a  rized function..
+00007e30: 2020 2020 6a6f 696e 203a 207b 226f 7574      join : {"out
+00007e40: 6572 222c 2022 696e 6e65 7222 2c20 226c  er", "inner", "l
+00007e50: 6566 7422 2c20 2272 6967 6874 222c 2022  eft", "right", "
+00007e60: 6578 6163 7422 7d2c 2064 6566 6175 6c74  exact"}, default
+00007e70: 3a20 2265 7861 6374 220a 2020 2020 2020  : "exact".      
+00007e80: 2020 4d65 7468 6f64 2066 6f72 206a 6f69    Method for joi
+00007e90: 6e69 6e67 2074 6865 2069 6e64 6578 6573  ning the indexes
+00007ea0: 206f 6620 7468 6520 7061 7373 6564 206f   of the passed o
+00007eb0: 626a 6563 7473 2061 6c6f 6e67 2065 6163  bjects along eac
+00007ec0: 680a 2020 2020 2020 2020 6469 6d65 6e73  h.        dimens
+00007ed0: 696f 6e2c 2061 6e64 2074 6865 2076 6172  ion, and the var
+00007ee0: 6961 626c 6573 206f 6620 4461 7461 7365  iables of Datase
+00007ef0: 7420 6f62 6a65 6374 7320 7769 7468 206d  t objects with m
+00007f00: 6973 6d61 7463 6865 640a 2020 2020 2020  ismatched.      
+00007f10: 2020 6461 7461 2076 6172 6961 626c 6573    data variables
+00007f20: 3a0a 0a20 2020 2020 2020 202d 2027 6f75  :..        - 'ou
+00007f30: 7465 7227 3a20 7573 6520 7468 6520 756e  ter': use the un
+00007f40: 696f 6e20 6f66 206f 626a 6563 7420 696e  ion of object in
+00007f50: 6465 7865 730a 2020 2020 2020 2020 2d20  dexes.        - 
+00007f60: 2769 6e6e 6572 273a 2075 7365 2074 6865  'inner': use the
+00007f70: 2069 6e74 6572 7365 6374 696f 6e20 6f66   intersection of
+00007f80: 206f 626a 6563 7420 696e 6465 7865 730a   object indexes.
+00007f90: 2020 2020 2020 2020 2d20 276c 6566 7427          - 'left'
+00007fa0: 3a20 7573 6520 696e 6465 7865 7320 6672  : use indexes fr
+00007fb0: 6f6d 2074 6865 2066 6972 7374 206f 626a  om the first obj
+00007fc0: 6563 7420 7769 7468 2065 6163 6820 6469  ect with each di
+00007fd0: 6d65 6e73 696f 6e0a 2020 2020 2020 2020  mension.        
+00007fe0: 2d20 2772 6967 6874 273a 2075 7365 2069  - 'right': use i
+00007ff0: 6e64 6578 6573 2066 726f 6d20 7468 6520  ndexes from the 
+00008000: 6c61 7374 206f 626a 6563 7420 7769 7468  last object with
+00008010: 2065 6163 6820 6469 6d65 6e73 696f 6e0a   each dimension.
+00008020: 2020 2020 2020 2020 2d20 2765 7861 6374          - 'exact
+00008030: 273a 2072 6169 7365 2060 5661 6c75 6545  ': raise `ValueE
+00008040: 7272 6f72 6020 696e 7374 6561 6420 6f66  rror` instead of
+00008050: 2061 6c69 676e 696e 6720 7768 656e 2069   aligning when i
+00008060: 6e64 6578 6573 2074 6f20 6265 0a20 2020  ndexes to be.   
+00008070: 2020 2020 2020 2061 6c69 676e 6564 2061         aligned a
+00008080: 7265 206e 6f74 2065 7175 616c 0a20 2020  re not equal.   
+00008090: 2064 6174 6173 6574 5f6a 6f69 6e20 3a20   dataset_join : 
+000080a0: 7b22 6f75 7465 7222 2c20 2269 6e6e 6572  {"outer", "inner
+000080b0: 222c 2022 6c65 6674 222c 2022 7269 6768  ", "left", "righ
+000080c0: 7422 2c20 2265 7861 6374 227d 2c20 6465  t", "exact"}, de
+000080d0: 6661 756c 743a 2022 6578 6163 7422 0a20  fault: "exact". 
+000080e0: 2020 2020 2020 204d 6574 686f 6420 666f         Method fo
+000080f0: 7220 6a6f 696e 696e 6720 7661 7269 6162  r joining variab
+00008100: 6c65 7320 6f66 2044 6174 6173 6574 206f  les of Dataset o
+00008110: 626a 6563 7473 2077 6974 6820 6d69 736d  bjects with mism
+00008120: 6174 6368 6564 0a20 2020 2020 2020 2064  atched.        d
+00008130: 6174 6120 7661 7269 6162 6c65 732e 0a0a  ata variables...
+00008140: 2020 2020 2020 2020 2d20 276f 7574 6572          - 'outer
+00008150: 273a 2074 616b 6520 7661 7269 6162 6c65  ': take variable
+00008160: 7320 6672 6f6d 2062 6f74 6820 4461 7461  s from both Data
+00008170: 7365 7420 6f62 6a65 6374 730a 2020 2020  set objects.    
+00008180: 2020 2020 2d20 2769 6e6e 6572 273a 2074      - 'inner': t
+00008190: 616b 6520 6f6e 6c79 206f 7665 726c 6170  ake only overlap
+000081a0: 7065 6420 7661 7269 6162 6c65 730a 2020  ped variables.  
+000081b0: 2020 2020 2020 2d20 276c 6566 7427 3a20        - 'left': 
+000081c0: 7461 6b65 206f 6e6c 7920 7661 7269 6162  take only variab
+000081d0: 6c65 7320 6672 6f6d 2074 6865 2066 6972  les from the fir
+000081e0: 7374 206f 626a 6563 740a 2020 2020 2020  st object.      
+000081f0: 2020 2d20 2772 6967 6874 273a 2074 616b    - 'right': tak
+00008200: 6520 6f6e 6c79 2076 6172 6961 626c 6573  e only variables
+00008210: 2066 726f 6d20 7468 6520 6c61 7374 206f   from the last o
+00008220: 626a 6563 740a 2020 2020 2020 2020 2d20  bject.        - 
+00008230: 2765 7861 6374 273a 2064 6174 6120 7661  'exact': data va
+00008240: 7269 6162 6c65 7320 6f6e 2061 6c6c 2044  riables on all D
+00008250: 6174 6173 6574 206f 626a 6563 7473 206d  ataset objects m
+00008260: 7573 7420 6d61 7463 6820 6578 6163 746c  ust match exactl
+00008270: 790a 2020 2020 6461 7461 7365 745f 6669  y.    dataset_fi
+00008280: 6c6c 5f76 616c 7565 203a 206f 7074 696f  ll_value : optio
+00008290: 6e61 6c0a 2020 2020 2020 2020 5661 6c75  nal.        Valu
+000082a0: 6520 7573 6564 2069 6e20 706c 6163 6520  e used in place 
+000082b0: 6f66 206d 6973 7369 6e67 2076 6172 6961  of missing varia
+000082c0: 626c 6573 206f 6e20 4461 7461 7365 7420  bles on Dataset 
+000082d0: 696e 7075 7473 2077 6865 6e20 7468 650a  inputs when the.
+000082e0: 2020 2020 2020 2020 6461 7461 7365 7473          datasets
+000082f0: 2064 6f20 6e6f 7420 7368 6172 6520 7468   do not share th
+00008300: 6520 6578 6163 7420 7361 6d65 2060 6064  e exact same ``d
+00008310: 6174 615f 7661 7273 6060 2e20 5265 7175  ata_vars``. Requ
+00008320: 6972 6564 2069 660a 2020 2020 2020 2020  ired if.        
+00008330: 6060 6461 7461 7365 745f 6a6f 696e 206e  ``dataset_join n
+00008340: 6f74 2069 6e20 7b27 696e 6e65 7227 2c20  ot in {'inner', 
+00008350: 2765 7861 6374 277d 6060 2c20 6f74 6865  'exact'}``, othe
+00008360: 7277 6973 6520 6967 6e6f 7265 642e 0a20  rwise ignored.. 
+00008370: 2020 206b 6565 705f 6174 7472 7320 3a20     keep_attrs : 
+00008380: 7b22 6472 6f70 222c 2022 6964 656e 7469  {"drop", "identi
+00008390: 6361 6c22 2c20 226e 6f5f 636f 6e66 6c69  cal", "no_confli
+000083a0: 6374 7322 2c20 2264 726f 705f 636f 6e66  cts", "drop_conf
+000083b0: 6c69 6374 7322 2c20 226f 7665 7272 6964  licts", "overrid
+000083c0: 6522 7d20 6f72 2062 6f6f 6c2c 206f 7074  e"} or bool, opt
+000083d0: 696f 6e61 6c0a 2020 2020 2020 2020 2d20  ional.        - 
+000083e0: 2764 726f 7027 206f 7220 4661 6c73 653a  'drop' or False:
+000083f0: 2065 6d70 7479 2061 7474 7273 206f 6e20   empty attrs on 
+00008400: 7265 7475 726e 6564 2078 6172 7261 7920  returned xarray 
+00008410: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
+00008420: 2d20 2769 6465 6e74 6963 616c 273a 2061  - 'identical': a
+00008430: 6c6c 2061 7474 7273 206d 7573 7420 6265  ll attrs must be
+00008440: 2074 6865 2073 616d 6520 6f6e 2065 7665   the same on eve
+00008450: 7279 206f 626a 6563 742e 0a20 2020 2020  ry object..     
+00008460: 2020 202d 2027 6e6f 5f63 6f6e 666c 6963     - 'no_conflic
+00008470: 7473 273a 2061 7474 7273 2066 726f 6d20  ts': attrs from 
+00008480: 616c 6c20 6f62 6a65 6374 7320 6172 6520  all objects are 
+00008490: 636f 6d62 696e 6564 2c20 616e 7920 7468  combined, any th
+000084a0: 6174 2068 6176 6520 7468 6520 7361 6d65  at have the same
+000084b0: 206e 616d 6520 6d75 7374 2061 6c73 6f20   name must also 
+000084c0: 6861 7665 2074 6865 2073 616d 6520 7661  have the same va
+000084d0: 6c75 652e 0a20 2020 2020 2020 202d 2027  lue..        - '
+000084e0: 6472 6f70 5f63 6f6e 666c 6963 7473 273a  drop_conflicts':
+000084f0: 2061 7474 7273 2066 726f 6d20 616c 6c20   attrs from all 
+00008500: 6f62 6a65 6374 7320 6172 6520 636f 6d62  objects are comb
+00008510: 696e 6564 2c20 616e 7920 7468 6174 2068  ined, any that h
+00008520: 6176 6520 7468 6520 7361 6d65 206e 616d  ave the same nam
+00008530: 6520 6275 7420 6469 6666 6572 656e 7420  e but different 
+00008540: 7661 6c75 6573 2061 7265 2064 726f 7070  values are dropp
+00008550: 6564 2e0a 2020 2020 2020 2020 2d20 276f  ed..        - 'o
+00008560: 7665 7272 6964 6527 206f 7220 5472 7565  verride' or True
+00008570: 3a20 736b 6970 2063 6f6d 7061 7269 6e67  : skip comparing
+00008580: 2061 6e64 2063 6f70 7920 6174 7472 7320   and copy attrs 
+00008590: 6672 6f6d 2074 6865 2066 6972 7374 206f  from the first o
+000085a0: 626a 6563 7420 746f 2074 6865 2072 6573  bject to the res
+000085b0: 756c 742e 0a20 2020 206b 7761 7267 7320  ult..    kwargs 
+000085c0: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
+000085d0: 0a20 2020 2020 2020 204f 7074 696f 6e61  .        Optiona
+000085e0: 6c20 6b65 7977 6f72 6420 6172 6775 6d65  l keyword argume
+000085f0: 6e74 7320 7061 7373 6564 2064 6972 6563  nts passed direc
+00008600: 746c 7920 6f6e 2074 6f20 6361 6c6c 2060  tly on to call `
+00008610: 6066 756e 6360 602e 0a20 2020 2064 6173  `func``..    das
+00008620: 6b20 3a20 7b22 666f 7262 6964 6465 6e22  k : {"forbidden"
+00008630: 2c20 2261 6c6c 6f77 6564 222c 2022 7061  , "allowed", "pa
+00008640: 7261 6c6c 656c 697a 6564 227d 2c20 6465  rallelized"}, de
+00008650: 6661 756c 743a 2022 666f 7262 6964 6465  fault: "forbidde
+00008660: 6e22 0a20 2020 2020 2020 2048 6f77 2074  n".        How t
+00008670: 6f20 6861 6e64 6c65 2061 7070 6c79 696e  o handle applyin
+00008680: 6720 746f 206f 626a 6563 7473 2063 6f6e  g to objects con
+00008690: 7461 696e 696e 6720 6c61 7a79 2064 6174  taining lazy dat
+000086a0: 6120 696e 2074 6865 2066 6f72 6d20 6f66  a in the form of
+000086b0: 0a20 2020 2020 2020 2064 6173 6b20 6172  .        dask ar
+000086c0: 7261 7973 3a0a 0a20 2020 2020 2020 202d  rays:..        -
+000086d0: 2027 666f 7262 6964 6465 6e27 2028 6465   'forbidden' (de
+000086e0: 6661 756c 7429 3a20 7261 6973 6520 616e  fault): raise an
+000086f0: 2065 7272 6f72 2069 6620 6120 6461 736b   error if a dask
+00008700: 2061 7272 6179 2069 7320 656e 636f 756e   array is encoun
+00008710: 7465 7265 642e 0a20 2020 2020 2020 202d  tered..        -
+00008720: 2027 616c 6c6f 7765 6427 3a20 7061 7373   'allowed': pass
+00008730: 2064 6173 6b20 6172 7261 7973 2064 6972   dask arrays dir
+00008740: 6563 746c 7920 6f6e 2074 6f20 6060 6675  ectly on to ``fu
+00008750: 6e63 6060 2e20 5072 6566 6572 2074 6869  nc``. Prefer thi
+00008760: 7320 6f70 7469 6f6e 2069 660a 2020 2020  s option if.    
+00008770: 2020 2020 2020 6060 6675 6e63 6060 206e        ``func`` n
+00008780: 6174 6976 656c 7920 7375 7070 6f72 7473  atively supports
+00008790: 2064 6173 6b20 6172 7261 7973 2e0a 2020   dask arrays..  
+000087a0: 2020 2020 2020 2d20 2770 6172 616c 6c65        - 'paralle
+000087b0: 6c69 7a65 6427 3a20 6175 746f 6d61 7469  lized': automati
+000087c0: 6361 6c6c 7920 7061 7261 6c6c 656c 697a  cally paralleliz
+000087d0: 6520 6060 6675 6e63 6060 2069 6620 616e  e ``func`` if an
+000087e0: 7920 6f66 2074 6865 0a20 2020 2020 2020  y of the.       
+000087f0: 2020 2069 6e70 7574 7320 6172 6520 6120     inputs are a 
+00008800: 6461 736b 2061 7272 6179 2062 7920 7573  dask array by us
+00008810: 696e 6720 3a70 793a 6675 6e63 3a60 6461  ing :py:func:`da
+00008820: 736b 2e61 7272 6179 2e61 7070 6c79 5f67  sk.array.apply_g
+00008830: 7566 756e 6360 2e20 4d75 6c74 6970 6c65  ufunc`. Multiple
+00008840: 206f 7574 7075 740a 2020 2020 2020 2020   output.        
+00008850: 2020 6172 6775 6d65 6e74 7320 6172 6520    arguments are 
+00008860: 7375 7070 6f72 7465 642e 204f 6e6c 7920  supported. Only 
+00008870: 7573 6520 7468 6973 206f 7074 696f 6e20  use this option 
+00008880: 6966 2060 6066 756e 6360 6020 646f 6573  if ``func`` does
+00008890: 206e 6f74 206e 6174 6976 656c 790a 2020   not natively.  
+000088a0: 2020 2020 2020 2020 7375 7070 6f72 7420          support 
+000088b0: 6461 736b 2061 7272 6179 7320 2865 2e67  dask arrays (e.g
+000088c0: 2e20 636f 6e76 6572 7473 2074 6865 6d20  . converts them 
+000088d0: 746f 206e 756d 7079 2061 7272 6179 7329  to numpy arrays)
+000088e0: 2e0a 2020 2020 6461 736b 5f67 7566 756e  ..    dask_gufun
+000088f0: 635f 6b77 6172 6773 203a 2064 6963 742c  c_kwargs : dict,
+00008900: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00008910: 2020 4f70 7469 6f6e 616c 206b 6579 776f    Optional keywo
+00008920: 7264 2061 7267 756d 656e 7473 2070 6173  rd arguments pas
+00008930: 7365 6420 746f 203a 7079 3a66 756e 633a  sed to :py:func:
+00008940: 6064 6173 6b2e 6172 7261 792e 6170 706c  `dask.array.appl
+00008950: 795f 6775 6675 6e63 6020 6966 0a20 2020  y_gufunc` if.   
+00008960: 2020 2020 2064 6173 6b3d 2770 6172 616c       dask='paral
+00008970: 6c65 6c69 7a65 6427 2e20 506f 7373 6962  lelized'. Possib
+00008980: 6c65 206b 6579 776f 7264 7320 6172 6520  le keywords are 
+00008990: 6060 6f75 7470 7574 5f73 697a 6573 6060  ``output_sizes``
+000089a0: 2c20 6060 616c 6c6f 775f 7265 6368 756e  , ``allow_rechun
+000089b0: 6b60 600a 2020 2020 2020 2020 616e 6420  k``.        and 
+000089c0: 6060 6d65 7461 6060 2e0a 2020 2020 6f75  ``meta``..    ou
+000089d0: 7470 7574 5f64 7479 7065 7320 3a20 6c69  tput_dtypes : li
+000089e0: 7374 206f 6620 6474 7970 652c 206f 7074  st of dtype, opt
+000089f0: 696f 6e61 6c0a 2020 2020 2020 2020 4f70  ional.        Op
+00008a00: 7469 6f6e 616c 206c 6973 7420 6f66 206f  tional list of o
+00008a10: 7574 7075 7420 6474 7970 6573 2e20 4f6e  utput dtypes. On
+00008a20: 6c79 2075 7365 6420 6966 2060 6064 6173  ly used if ``das
+00008a30: 6b3d 2770 6172 616c 6c65 6c69 7a65 6427  k='parallelized'
+00008a40: 6060 206f 720a 2020 2020 2020 2020 6060  `` or.        ``
+00008a50: 7665 6374 6f72 697a 653d 5472 7565 6060  vectorize=True``
+00008a60: 2e0a 2020 2020 6f75 7470 7574 5f73 697a  ..    output_siz
+00008a70: 6573 203a 2064 6963 742c 206f 7074 696f  es : dict, optio
+00008a80: 6e61 6c0a 2020 2020 2020 2020 4f70 7469  nal.        Opti
+00008a90: 6f6e 616c 206d 6170 7069 6e67 2066 726f  onal mapping fro
+00008aa0: 6d20 6469 6d65 6e73 696f 6e20 6e61 6d65  m dimension name
+00008ab0: 7320 746f 2073 697a 6573 2066 6f72 206f  s to sizes for o
+00008ac0: 7574 7075 7473 2e20 4f6e 6c79 2075 7365  utputs. Only use
+00008ad0: 640a 2020 2020 2020 2020 6966 2064 6173  d.        if das
+00008ae0: 6b3d 2770 6172 616c 6c65 6c69 7a65 6427  k='parallelized'
+00008af0: 2061 6e64 206e 6577 2064 696d 656e 7369   and new dimensi
+00008b00: 6f6e 7320 286e 6f74 2066 6f75 6e64 206f  ons (not found o
+00008b10: 6e20 696e 7075 7473 2920 6170 7065 6172  n inputs) appear
+00008b20: 0a20 2020 2020 2020 206f 6e20 6f75 7470  .        on outp
+00008b30: 7574 732e 2060 606f 7574 7075 745f 7369  uts. ``output_si
+00008b40: 7a65 7360 6020 7368 6f75 6c64 2062 6520  zes`` should be 
+00008b50: 6769 7665 6e20 696e 2074 6865 2060 6064  given in the ``d
+00008b60: 6173 6b5f 6775 6675 6e63 5f6b 7761 7267  ask_gufunc_kwarg
+00008b70: 7360 600a 2020 2020 2020 2020 7061 7261  s``.        para
+00008b80: 6d65 7465 722e 2049 7420 7769 6c6c 2062  meter. It will b
+00008b90: 6520 7265 6d6f 7665 6420 6173 2064 6972  e removed as dir
+00008ba0: 6563 7420 7061 7261 6d65 7465 7220 696e  ect parameter in
+00008bb0: 2061 2066 7574 7572 6520 7665 7273 696f   a future versio
+00008bc0: 6e2e 0a20 2020 206d 6574 6120 3a20 6f70  n..    meta : op
+00008bd0: 7469 6f6e 616c 0a20 2020 2020 2020 2053  tional.        S
+00008be0: 697a 652d 3020 6f62 6a65 6374 2072 6570  ize-0 object rep
+00008bf0: 7265 7365 6e74 696e 6720 7468 6520 7479  resenting the ty
+00008c00: 7065 206f 6620 6172 7261 7920 7772 6170  pe of array wrap
+00008c10: 7065 6420 6279 2064 6173 6b20 6172 7261  ped by dask arra
+00008c20: 792e 2050 6173 7365 6420 6f6e 2074 6f0a  y. Passed on to.
+00008c30: 2020 2020 2020 2020 3a70 793a 6675 6e63          :py:func
+00008c40: 3a60 6461 736b 2e61 7272 6179 2e61 7070  :`dask.array.app
+00008c50: 6c79 5f67 7566 756e 6360 2e20 6060 6d65  ly_gufunc`. ``me
+00008c60: 7461 6060 2073 686f 756c 6420 6265 2067  ta`` should be g
+00008c70: 6976 656e 2069 6e20 7468 650a 2020 2020  iven in the.    
+00008c80: 2020 2020 6060 6461 736b 5f67 7566 756e      ``dask_gufun
+00008c90: 635f 6b77 6172 6773 6060 2070 6172 616d  c_kwargs`` param
+00008ca0: 6574 6572 202e 2049 7420 7769 6c6c 2062  eter . It will b
+00008cb0: 6520 7265 6d6f 7665 6420 6173 2064 6972  e removed as dir
+00008cc0: 6563 7420 7061 7261 6d65 7465 720a 2020  ect parameter.  
+00008cd0: 2020 2020 2020 6120 6675 7475 7265 2076        a future v
+00008ce0: 6572 7369 6f6e 2e0a 0a20 2020 2052 6574  ersion...    Ret
+00008cf0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+00008d00: 0a20 2020 2053 696e 676c 6520 7661 6c75  .    Single valu
+00008d10: 6520 6f72 2074 7570 6c65 206f 6620 4461  e or tuple of Da
+00008d20: 7461 7365 742c 2044 6174 6141 7272 6179  taset, DataArray
+00008d30: 2c20 5661 7269 6162 6c65 2c20 6461 736b  , Variable, dask
+00008d40: 2e61 7272 6179 2e41 7272 6179 206f 720a  .array.Array or.
+00008d50: 2020 2020 6e75 6d70 792e 6e64 6172 7261      numpy.ndarra
+00008d60: 792c 2074 6865 2066 6972 7374 2074 7970  y, the first typ
+00008d70: 6520 6f6e 2074 6861 7420 6c69 7374 2074  e on that list t
+00008d80: 6f20 6170 7065 6172 206f 6e20 616e 2069  o appear on an i
+00008d90: 6e70 7574 2e0a 0a20 2020 204e 6f74 6573  nput...    Notes
+00008da0: 0a20 2020 202d 2d2d 2d2d 0a20 2020 2054  .    -----.    T
+00008db0: 6869 7320 6675 6e63 7469 6f6e 2069 7320  his function is 
+00008dc0: 6465 7369 676e 6564 2066 6f72 2074 6865  designed for the
+00008dd0: 206d 6f72 6520 636f 6d6d 6f6e 2063 6173   more common cas
+00008de0: 6520 7768 6572 6520 6060 6675 6e63 6060  e where ``func``
+00008df0: 2063 616e 2077 6f72 6b20 6f6e 206e 756d   can work on num
+00008e00: 7079 0a20 2020 2061 7272 6179 732e 2049  py.    arrays. I
+00008e10: 6620 6060 6675 6e63 6060 206e 6565 6473  f ``func`` needs
+00008e20: 2074 6f20 6d61 6e69 7075 6c61 7465 2061   to manipulate a
+00008e30: 2077 686f 6c65 2078 6172 7261 7920 6f62   whole xarray ob
+00008e40: 6a65 6374 2073 7562 7365 7420 746f 2065  ject subset to e
+00008e50: 6163 6820 626c 6f63 6b0a 2020 2020 6974  ach block.    it
+00008e60: 2069 7320 706f 7373 6962 6c65 2074 6f20   is possible to 
+00008e70: 7573 6520 3a70 793a 6675 6e63 3a60 7861  use :py:func:`xa
+00008e80: 7272 6179 2e6d 6170 5f62 6c6f 636b 7360  rray.map_blocks`
+00008e90: 2e0a 0a20 2020 204e 6f74 6520 7468 6174  ...    Note that
+00008ea0: 2064 7565 2074 6f20 7468 6520 6f76 6572   due to the over
+00008eb0: 6865 6164 203a 7079 3a66 756e 633a 6078  head :py:func:`x
+00008ec0: 6172 7261 792e 6d61 705f 626c 6f63 6b73  array.map_blocks
+00008ed0: 6020 6973 2063 6f6e 7369 6465 7261 626c  ` is considerabl
+00008ee0: 7920 736c 6f77 6572 2074 6861 6e20 6060  y slower than ``
+00008ef0: 6170 706c 795f 7566 756e 6360 602e 0a0a  apply_ufunc``...
+00008f00: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
+00008f10: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 4361   --------.    Ca
+00008f20: 6c63 756c 6174 6520 7468 6520 7665 6374  lculate the vect
+00008f30: 6f72 206d 6167 6e69 7475 6465 206f 6620  or magnitude of 
+00008f40: 7477 6f20 6172 6775 6d65 6e74 733a 0a0a  two arguments:..
+00008f50: 2020 2020 3e3e 3e20 6465 6620 6d61 676e      >>> def magn
+00008f60: 6974 7564 6528 612c 2062 293a 0a20 2020  itude(a, b):.   
+00008f70: 202e 2e2e 2020 2020 2066 756e 6320 3d20   ...     func = 
+00008f80: 6c61 6d62 6461 2078 2c20 793a 206e 702e  lambda x, y: np.
+00008f90: 7371 7274 2878 2a2a 3220 2b20 792a 2a32  sqrt(x**2 + y**2
+00008fa0: 290a 2020 2020 2e2e 2e20 2020 2020 7265  ).    ...     re
+00008fb0: 7475 726e 2078 722e 6170 706c 795f 7566  turn xr.apply_uf
+00008fc0: 756e 6328 6675 6e63 2c20 612c 2062 290a  unc(func, a, b).
+00008fd0: 2020 2020 2e2e 2e0a 0a20 2020 2059 6f75      .....    You
+00008fe0: 2063 616e 206e 6f77 2061 7070 6c79 2060   can now apply `
+00008ff0: 606d 6167 6e69 7475 6465 2829 6060 2074  `magnitude()`` t
+00009000: 6f20 3a70 793a 636c 6173 733a 6044 6174  o :py:class:`Dat
+00009010: 6141 7272 6179 6020 616e 6420 3a70 793a  aArray` and :py:
+00009020: 636c 6173 733a 6044 6174 6173 6574 600a  class:`Dataset`.
+00009030: 2020 2020 6f62 6a65 6374 732c 2077 6974      objects, wit
+00009040: 6820 6175 746f 6d61 7469 6361 6c6c 7920  h automatically 
+00009050: 7072 6573 6572 7665 6420 6469 6d65 6e73  preserved dimens
+00009060: 696f 6e73 2061 6e64 2063 6f6f 7264 696e  ions and coordin
+00009070: 6174 6573 2c20 652e 672e 2c0a 0a20 2020  ates, e.g.,..   
+00009080: 203e 3e3e 2061 7272 6179 203d 2078 722e   >>> array = xr.
+00009090: 4461 7461 4172 7261 7928 5b31 2c20 322c  DataArray([1, 2,
+000090a0: 2033 5d2c 2063 6f6f 7264 733d 5b28 2278   3], coords=[("x
+000090b0: 222c 205b 302e 312c 2030 2e32 2c20 302e  ", [0.1, 0.2, 0.
+000090c0: 335d 295d 290a 2020 2020 3e3e 3e20 6d61  3])]).    >>> ma
+000090d0: 676e 6974 7564 6528 6172 7261 792c 202d  gnitude(array, -
+000090e0: 6172 7261 7929 0a20 2020 203c 7861 7272  array).    <xarr
+000090f0: 6179 2e44 6174 6141 7272 6179 2028 783a  ay.DataArray (x:
+00009100: 2033 293e 0a20 2020 2061 7272 6179 285b   3)>.    array([
+00009110: 312e 3431 3432 3133 3536 2c20 322e 3832  1.41421356, 2.82
+00009120: 3834 3237 3132 2c20 342e 3234 3236 3430  842712, 4.242640
+00009130: 3639 5d29 0a20 2020 2043 6f6f 7264 696e  69]).    Coordin
+00009140: 6174 6573 3a0a 2020 2020 2020 2a20 7820  ates:.      * x 
+00009150: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+00009160: 3634 2030 2e31 2030 2e32 2030 2e33 0a0a  64 0.1 0.2 0.3..
+00009170: 2020 2020 506c 6169 6e20 7363 616c 6172      Plain scalar
+00009180: 732c 206e 756d 7079 2061 7272 6179 7320  s, numpy arrays 
+00009190: 616e 6420 6120 6d69 7820 6f66 2074 6865  and a mix of the
+000091a0: 7365 2077 6974 6820 7861 7272 6179 206f  se with xarray o
+000091b0: 626a 6563 7473 2069 7320 616c 736f 0a20  bjects is also. 
+000091c0: 2020 2073 7570 706f 7274 6564 3a0a 0a20     supported:.. 
+000091d0: 2020 203e 3e3e 206d 6167 6e69 7475 6465     >>> magnitude
+000091e0: 2833 2c20 3429 0a20 2020 2035 2e30 0a20  (3, 4).    5.0. 
+000091f0: 2020 203e 3e3e 206d 6167 6e69 7475 6465     >>> magnitude
+00009200: 2833 2c20 6e70 2e61 7272 6179 285b 302c  (3, np.array([0,
+00009210: 2034 5d29 290a 2020 2020 6172 7261 7928   4])).    array(
+00009220: 5b33 2e2c 2035 2e5d 290a 2020 2020 3e3e  [3., 5.]).    >>
+00009230: 3e20 6d61 676e 6974 7564 6528 6172 7261  > magnitude(arra
+00009240: 792c 2030 290a 2020 2020 3c78 6172 7261  y, 0).    <xarra
+00009250: 792e 4461 7461 4172 7261 7920 2878 3a20  y.DataArray (x: 
+00009260: 3329 3e0a 2020 2020 6172 7261 7928 5b31  3)>.    array([1
+00009270: 2e2c 2032 2e2c 2033 2e5d 290a 2020 2020  ., 2., 3.]).    
+00009280: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+00009290: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
+000092a0: 2920 666c 6f61 7436 3420 302e 3120 302e  ) float64 0.1 0.
+000092b0: 3220 302e 330a 0a20 2020 204f 7468 6572  2 0.3..    Other
+000092c0: 2065 7861 6d70 6c65 7320 6f66 2068 6f77   examples of how
+000092d0: 2079 6f75 2063 6f75 6c64 2075 7365 2060   you could use `
+000092e0: 6061 7070 6c79 5f75 6675 6e63 6060 2074  `apply_ufunc`` t
+000092f0: 6f20 7772 6974 6520 6675 6e63 7469 6f6e  o write function
+00009300: 7320 746f 0a20 2020 2028 7665 7279 206e  s to.    (very n
+00009310: 6561 726c 7929 2072 6570 6c69 6361 7465  early) replicate
+00009320: 2065 7869 7374 696e 6720 7861 7272 6179   existing xarray
+00009330: 2066 756e 6374 696f 6e61 6c69 7479 3a0a   functionality:.
+00009340: 0a20 2020 2043 6f6d 7075 7465 2074 6865  .    Compute the
+00009350: 206d 6561 6e20 2860 602e 6d65 616e 6060   mean (``.mean``
+00009360: 2920 6f76 6572 206f 6e65 2064 696d 656e  ) over one dimen
+00009370: 7369 6f6e 3a0a 0a20 2020 203e 3e3e 2064  sion:..    >>> d
+00009380: 6566 206d 6561 6e28 6f62 6a2c 2064 696d  ef mean(obj, dim
+00009390: 293a 0a20 2020 202e 2e2e 2020 2020 2023  ):.    ...     #
+000093a0: 206e 6f74 653a 2061 7070 6c79 2061 6c77   note: apply alw
+000093b0: 6179 7320 6d6f 7665 7320 636f 7265 2064  ays moves core d
+000093c0: 696d 656e 7369 6f6e 7320 746f 2074 6865  imensions to the
+000093d0: 2065 6e64 0a20 2020 202e 2e2e 2020 2020   end.    ...    
+000093e0: 2072 6574 7572 6e20 6170 706c 795f 7566   return apply_uf
+000093f0: 756e 6328 0a20 2020 202e 2e2e 2020 2020  unc(.    ...    
+00009400: 2020 2020 206e 702e 6d65 616e 2c20 6f62       np.mean, ob
+00009410: 6a2c 2069 6e70 7574 5f63 6f72 655f 6469  j, input_core_di
+00009420: 6d73 3d5b 5b64 696d 5d5d 2c20 6b77 6172  ms=[[dim]], kwar
+00009430: 6773 3d7b 2261 7869 7322 3a20 2d31 7d0a  gs={"axis": -1}.
+00009440: 2020 2020 2e2e 2e20 2020 2020 290a 2020      ...     ).  
+00009450: 2020 2e2e 2e0a 0a20 2020 2049 6e6e 6572    .....    Inner
+00009460: 2070 726f 6475 6374 206f 7665 7220 6120   product over a 
+00009470: 7370 6563 6966 6963 2064 696d 656e 7369  specific dimensi
+00009480: 6f6e 2028 6c69 6b65 203a 7079 3a66 756e  on (like :py:fun
+00009490: 633a 6064 6f74 6029 3a0a 0a20 2020 203e  c:`dot`):..    >
+000094a0: 3e3e 2064 6566 205f 696e 6e65 7228 782c  >> def _inner(x,
+000094b0: 2079 293a 0a20 2020 202e 2e2e 2020 2020   y):.    ...    
+000094c0: 2072 6573 756c 7420 3d20 6e70 2e6d 6174   result = np.mat
+000094d0: 6d75 6c28 785b 2e2e 2e2c 206e 702e 6e65  mul(x[..., np.ne
+000094e0: 7761 7869 732c 203a 5d2c 2079 5b2e 2e2e  waxis, :], y[...
+000094f0: 2c20 3a2c 206e 702e 6e65 7761 7869 735d  , :, np.newaxis]
+00009500: 290a 2020 2020 2e2e 2e20 2020 2020 7265  ).    ...     re
+00009510: 7475 726e 2072 6573 756c 745b 2e2e 2e2c  turn result[...,
+00009520: 2030 2c20 305d 0a20 2020 202e 2e2e 0a20   0, 0].    .... 
+00009530: 2020 203e 3e3e 2064 6566 2069 6e6e 6572     >>> def inner
+00009540: 5f70 726f 6475 6374 2861 2c20 622c 2064  _product(a, b, d
+00009550: 696d 293a 0a20 2020 202e 2e2e 2020 2020  im):.    ...    
+00009560: 2072 6574 7572 6e20 6170 706c 795f 7566   return apply_uf
+00009570: 756e 6328 5f69 6e6e 6572 2c20 612c 2062  unc(_inner, a, b
+00009580: 2c20 696e 7075 745f 636f 7265 5f64 696d  , input_core_dim
+00009590: 733d 5b5b 6469 6d5d 2c20 5b64 696d 5d5d  s=[[dim], [dim]]
+000095a0: 290a 2020 2020 2e2e 2e0a 0a20 2020 2053  ).    .....    S
+000095b0: 7461 636b 206f 626a 6563 7473 2061 6c6f  tack objects alo
+000095c0: 6e67 2061 206e 6577 2064 696d 656e 7369  ng a new dimensi
+000095d0: 6f6e 2028 6c69 6b65 203a 7079 3a66 756e  on (like :py:fun
+000095e0: 633a 6063 6f6e 6361 7460 293a 0a0a 2020  c:`concat`):..  
+000095f0: 2020 3e3e 3e20 6465 6620 7374 6163 6b28    >>> def stack(
+00009600: 6f62 6a65 6374 732c 2064 696d 2c20 6e65  objects, dim, ne
+00009610: 775f 636f 6f72 6429 3a0a 2020 2020 2e2e  w_coord):.    ..
+00009620: 2e20 2020 2020 2320 6e6f 7465 3a20 7468  .     # note: th
+00009630: 6973 2076 6572 7369 6f6e 2064 6f65 7320  is version does 
+00009640: 6e6f 7420 7374 6163 6b20 636f 6f72 6469  not stack coordi
+00009650: 6e61 7465 730a 2020 2020 2e2e 2e20 2020  nates.    ...   
+00009660: 2020 6675 6e63 203d 206c 616d 6264 6120    func = lambda 
+00009670: 2a78 3a20 6e70 2e73 7461 636b 2878 2c20  *x: np.stack(x, 
+00009680: 6178 6973 3d2d 3129 0a20 2020 202e 2e2e  axis=-1).    ...
+00009690: 2020 2020 2072 6573 756c 7420 3d20 6170       result = ap
+000096a0: 706c 795f 7566 756e 6328 0a20 2020 202e  ply_ufunc(.    .
+000096b0: 2e2e 2020 2020 2020 2020 2066 756e 632c  ..         func,
+000096c0: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
+000096d0: 202a 6f62 6a65 6374 732c 0a20 2020 202e   *objects,.    .
+000096e0: 2e2e 2020 2020 2020 2020 206f 7574 7075  ..         outpu
+000096f0: 745f 636f 7265 5f64 696d 733d 5b5b 6469  t_core_dims=[[di
+00009700: 6d5d 5d2c 0a20 2020 202e 2e2e 2020 2020  m]],.    ...    
+00009710: 2020 2020 206a 6f69 6e3d 226f 7574 6572       join="outer
+00009720: 222c 0a20 2020 202e 2e2e 2020 2020 2020  ",.    ...      
+00009730: 2020 2064 6174 6173 6574 5f66 696c 6c5f     dataset_fill_
+00009740: 7661 6c75 653d 6e70 2e6e 616e 0a20 2020  value=np.nan.   
+00009750: 202e 2e2e 2020 2020 2029 0a20 2020 202e   ...     ).    .
+00009760: 2e2e 2020 2020 2072 6573 756c 745b 6469  ..     result[di
+00009770: 6d5d 203d 206e 6577 5f63 6f6f 7264 0a20  m] = new_coord. 
+00009780: 2020 202e 2e2e 2020 2020 2072 6574 7572     ...     retur
+00009790: 6e20 7265 7375 6c74 0a20 2020 202e 2e2e  n result.    ...
+000097a0: 0a0a 2020 2020 4966 2079 6f75 7220 6675  ..    If your fu
+000097b0: 6e63 7469 6f6e 2069 7320 6e6f 7420 7665  nction is not ve
+000097c0: 6374 6f72 697a 6564 2062 7574 2063 616e  ctorized but can
+000097d0: 2062 6520 6170 706c 6965 6420 6f6e 6c79   be applied only
+000097e0: 2074 6f20 636f 7265 0a20 2020 2064 696d   to core.    dim
+000097f0: 656e 7369 6f6e 732c 2079 6f75 2063 616e  ensions, you can
+00009800: 2075 7365 2060 6076 6563 746f 7269 7a65   use ``vectorize
+00009810: 3d54 7275 6560 6020 746f 2074 7572 6e20  =True`` to turn 
+00009820: 696e 746f 2061 2076 6563 746f 7269 7a65  into a vectorize
+00009830: 640a 2020 2020 6675 6e63 7469 6f6e 2e20  d.    function. 
+00009840: 5468 6973 2077 7261 7073 203a 7079 3a66  This wraps :py:f
+00009850: 756e 633a 606e 756d 7079 2e76 6563 746f  unc:`numpy.vecto
+00009860: 7269 7a65 602c 2073 6f20 7468 6520 6f70  rize`, so the op
+00009870: 6572 6174 696f 6e20 6973 6e27 740a 2020  eration isn't.  
+00009880: 2020 7465 7272 6962 6c79 2066 6173 742e    terribly fast.
+00009890: 2048 6572 6520 7765 276c 6c20 7573 6520   Here we'll use 
+000098a0: 6974 2074 6f20 6361 6c63 756c 6174 6520  it to calculate 
+000098b0: 7468 6520 6469 7374 616e 6365 2062 6574  the distance bet
+000098c0: 7765 656e 0a20 2020 2065 6d70 6972 6963  ween.    empiric
+000098d0: 616c 2073 616d 706c 6573 2066 726f 6d20  al samples from 
+000098e0: 7477 6f20 7072 6f62 6162 696c 6974 7920  two probability 
+000098f0: 6469 7374 7269 6275 7469 6f6e 732c 2075  distributions, u
+00009900: 7369 6e67 2061 2073 6369 7079 0a20 2020  sing a scipy.   
+00009910: 2066 756e 6374 696f 6e20 7468 6174 206e   function that n
+00009920: 6565 6473 2074 6f20 6265 2061 7070 6c69  eeds to be appli
+00009930: 6564 2074 6f20 7665 6374 6f72 733a 0a0a  ed to vectors:..
+00009940: 2020 2020 3e3e 3e20 696d 706f 7274 2073      >>> import s
+00009950: 6369 7079 2e73 7461 7473 0a20 2020 203e  cipy.stats.    >
+00009960: 3e3e 2064 6566 2065 6172 7468 5f6d 6f76  >> def earth_mov
+00009970: 6572 5f64 6973 7461 6e63 6528 6669 7273  er_distance(firs
+00009980: 745f 7361 6d70 6c65 732c 2073 6563 6f6e  t_samples, secon
+00009990: 645f 7361 6d70 6c65 732c 2064 696d 3d22  d_samples, dim="
+000099a0: 656e 7365 6d62 6c65 2229 3a0a 2020 2020  ensemble"):.    
+000099b0: 2e2e 2e20 2020 2020 7265 7475 726e 2061  ...     return a
+000099c0: 7070 6c79 5f75 6675 6e63 280a 2020 2020  pply_ufunc(.    
+000099d0: 2e2e 2e20 2020 2020 2020 2020 7363 6970  ...         scip
+000099e0: 792e 7374 6174 732e 7761 7373 6572 7374  y.stats.wasserst
+000099f0: 6569 6e5f 6469 7374 616e 6365 2c0a 2020  ein_distance,.  
+00009a00: 2020 2e2e 2e20 2020 2020 2020 2020 6669    ...         fi
+00009a10: 7273 745f 7361 6d70 6c65 732c 0a20 2020  rst_samples,.   
+00009a20: 202e 2e2e 2020 2020 2020 2020 2073 6563   ...         sec
+00009a30: 6f6e 645f 7361 6d70 6c65 732c 0a20 2020  ond_samples,.   
+00009a40: 202e 2e2e 2020 2020 2020 2020 2069 6e70   ...         inp
+00009a50: 7574 5f63 6f72 655f 6469 6d73 3d5b 5b64  ut_core_dims=[[d
+00009a60: 696d 5d2c 205b 6469 6d5d 5d2c 0a20 2020  im], [dim]],.   
+00009a70: 202e 2e2e 2020 2020 2020 2020 2076 6563   ...         vec
+00009a80: 746f 7269 7a65 3d54 7275 652c 0a20 2020  torize=True,.   
+00009a90: 202e 2e2e 2020 2020 2029 0a20 2020 202e   ...     ).    .
+00009aa0: 2e2e 0a0a 2020 2020 4d6f 7374 206f 6620  ....    Most of 
+00009ab0: 4e75 6d50 7927 7320 6275 696c 7469 6e20  NumPy's builtin 
+00009ac0: 6675 6e63 7469 6f6e 7320 616c 7265 6164  functions alread
+00009ad0: 7920 6272 6f61 6463 6173 7420 7468 6569  y broadcast thei
+00009ae0: 7220 696e 7075 7473 0a20 2020 2061 7070  r inputs.    app
+00009af0: 726f 7072 6961 7465 6c79 2066 6f72 2075  ropriately for u
+00009b00: 7365 2069 6e20 6060 6170 706c 795f 7566  se in ``apply_uf
+00009b10: 756e 6360 602e 2059 6f75 206d 6179 2066  unc``. You may f
+00009b20: 696e 6420 6865 6c70 6572 2066 756e 6374  ind helper funct
+00009b30: 696f 6e73 2073 7563 6820 6173 0a20 2020  ions such as.   
+00009b40: 203a 7079 3a66 756e 633a 606e 756d 7079   :py:func:`numpy
+00009b50: 2e62 726f 6164 6361 7374 5f61 7272 6179  .broadcast_array
+00009b60: 7360 2068 656c 7066 756c 2069 6e20 7772  s` helpful in wr
+00009b70: 6974 696e 6720 796f 7572 2066 756e 6374  iting your funct
+00009b80: 696f 6e2e 2060 6061 7070 6c79 5f75 6675  ion. ``apply_ufu
+00009b90: 6e63 6060 2061 6c73 6f0a 2020 2020 776f  nc`` also.    wo
+00009ba0: 726b 7320 7765 6c6c 2077 6974 6820 3a70  rks well with :p
+00009bb0: 793a 6675 6e63 3a60 6e75 6d62 612e 7665  y:func:`numba.ve
+00009bc0: 6374 6f72 697a 6560 2061 6e64 203a 7079  ctorize` and :py
+00009bd0: 3a66 756e 633a 606e 756d 6261 2e67 7576  :func:`numba.guv
+00009be0: 6563 746f 7269 7a65 602e 0a0a 2020 2020  ectorize`...    
+00009bf0: 5365 6520 416c 736f 0a20 2020 202d 2d2d  See Also.    ---
+00009c00: 2d2d 2d2d 2d0a 2020 2020 6e75 6d70 792e  -----.    numpy.
+00009c10: 6272 6f61 6463 6173 745f 6172 7261 7973  broadcast_arrays
+00009c20: 0a20 2020 206e 756d 6261 2e76 6563 746f  .    numba.vecto
+00009c30: 7269 7a65 0a20 2020 206e 756d 6261 2e67  rize.    numba.g
+00009c40: 7576 6563 746f 7269 7a65 0a20 2020 2064  uvectorize.    d
+00009c50: 6173 6b2e 6172 7261 792e 6170 706c 795f  ask.array.apply_
+00009c60: 6775 6675 6e63 0a20 2020 2078 6172 7261  gufunc.    xarra
+00009c70: 792e 6d61 705f 626c 6f63 6b73 0a20 2020  y.map_blocks.   
+00009c80: 203a 7265 663a 6064 6173 6b2e 6175 746f   :ref:`dask.auto
+00009c90: 6d61 7469 632d 7061 7261 6c6c 656c 697a  matic-paralleliz
+00009ca0: 6174 696f 6e60 0a20 2020 2020 2020 2055  ation`.        U
+00009cb0: 7365 7220 6775 6964 6520 6465 7363 7269  ser guide descri
+00009cc0: 6269 6e67 203a 7079 3a66 756e 633a 6061  bing :py:func:`a
+00009cd0: 7070 6c79 5f75 6675 6e63 6020 616e 6420  pply_ufunc` and 
+00009ce0: 3a70 793a 6675 6e63 3a60 6d61 705f 626c  :py:func:`map_bl
+00009cf0: 6f63 6b73 602e 0a0a 2020 2020 5265 6665  ocks`...    Refe
+00009d00: 7265 6e63 6573 0a20 2020 202d 2d2d 2d2d  rences.    -----
+00009d10: 2d2d 2d2d 2d0a 2020 2020 2e2e 205b 315d  -----.    .. [1]
+00009d20: 2068 7474 7073 3a2f 2f6e 756d 7079 2e6f   https://numpy.o
+00009d30: 7267 2f64 6f63 2f73 7461 626c 652f 7265  rg/doc/stable/re
+00009d40: 6665 7265 6e63 652f 7566 756e 6373 2e68  ference/ufuncs.h
+00009d50: 746d 6c0a 2020 2020 2e2e 205b 325d 2068  tml.    .. [2] h
+00009d60: 7474 7073 3a2f 2f6e 756d 7079 2e6f 7267  ttps://numpy.org
+00009d70: 2f64 6f63 2f73 7461 626c 652f 7265 6665  /doc/stable/refe
+00009d80: 7265 6e63 652f 632d 6170 692f 6765 6e65  rence/c-api/gene
+00009d90: 7261 6c69 7a65 642d 7566 756e 6373 2e68  ralized-ufuncs.h
+00009da0: 746d 6c0a 2020 2020 2222 220a 2020 2020  tml.    """.    
+00009db0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+00009dc0: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
+00009dd0: 7420 4461 7461 4172 7261 790a 2020 2020  t DataArray.    
+00009de0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+00009df0: 2e67 726f 7570 6279 2069 6d70 6f72 7420  .groupby import 
+00009e00: 4772 6f75 7042 790a 2020 2020 6672 6f6d  GroupBy.    from
+00009e10: 2078 6172 7261 792e 636f 7265 2e76 6172   xarray.core.var
+00009e20: 6961 626c 6520 696d 706f 7274 2056 6172  iable import Var
+00009e30: 6961 626c 650a 0a20 2020 2069 6620 696e  iable..    if in
+00009e40: 7075 745f 636f 7265 5f64 696d 7320 6973  put_core_dims is
+00009e50: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
+00009e60: 6e70 7574 5f63 6f72 655f 6469 6d73 203d  nput_core_dims =
+00009e70: 2028 2829 2c29 202a 2028 6c65 6e28 6172   ((),) * (len(ar
+00009e80: 6773 2929 0a20 2020 2065 6c69 6620 6c65  gs)).    elif le
+00009e90: 6e28 696e 7075 745f 636f 7265 5f64 696d  n(input_core_dim
+00009ea0: 7329 2021 3d20 6c65 6e28 6172 6773 293a  s) != len(args):
+00009eb0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+00009ec0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00009ed0: 2020 2020 2020 2066 2269 6e70 7574 5f63         f"input_c
+00009ee0: 6f72 655f 6469 6d73 206d 7573 7420 6265  ore_dims must be
+00009ef0: 204e 6f6e 6520 6f72 2061 2074 7570 6c65   None or a tuple
+00009f00: 2077 6974 6820 7468 6520 6c65 6e67 7468   with the length
+00009f10: 2073 616d 6520 746f 2022 0a20 2020 2020   same to ".     
+00009f20: 2020 2020 2020 2066 2274 6865 206e 756d         f"the num
+00009f30: 6265 7220 6f66 2061 7267 756d 656e 7473  ber of arguments
+00009f40: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+00009f50: 6622 4769 7665 6e20 7b6c 656e 2869 6e70  f"Given {len(inp
+00009f60: 7574 5f63 6f72 655f 6469 6d73 297d 2069  ut_core_dims)} i
+00009f70: 6e70 7574 5f63 6f72 655f 6469 6d73 3a20  nput_core_dims: 
+00009f80: 7b69 6e70 7574 5f63 6f72 655f 6469 6d73  {input_core_dims
+00009f90: 7d2c 2022 0a20 2020 2020 2020 2020 2020  }, ".           
+00009fa0: 2066 2220 6275 7420 6e75 6d62 6572 206f   f" but number o
+00009fb0: 6620 6172 6773 2069 7320 7b6c 656e 2861  f args is {len(a
+00009fc0: 7267 7329 7d2e 220a 2020 2020 2020 2020  rgs)}.".        
+00009fd0: 290a 0a20 2020 2069 6620 6b77 6172 6773  )..    if kwargs
+00009fe0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00009ff0: 2020 6b77 6172 6773 203d 207b 7d0a 0a20    kwargs = {}.. 
+0000a000: 2020 2073 6967 6e61 7475 7265 203d 205f     signature = _
+0000a010: 5546 756e 6353 6967 6e61 7475 7265 2869  UFuncSignature(i
+0000a020: 6e70 7574 5f63 6f72 655f 6469 6d73 2c20  nput_core_dims, 
+0000a030: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+0000a040: 290a 0a20 2020 2069 6620 6578 636c 7564  )..    if exclud
+0000a050: 655f 6469 6d73 3a0a 2020 2020 2020 2020  e_dims:.        
+0000a060: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+0000a070: 6528 6578 636c 7564 655f 6469 6d73 2c20  e(exclude_dims, 
+0000a080: 7365 7429 3a0a 2020 2020 2020 2020 2020  set):.          
+0000a090: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+0000a0a0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000a0b0: 2020 2066 2245 7870 6563 7465 6420 6578     f"Expected ex
+0000a0c0: 636c 7564 655f 6469 6d73 2074 6f20 6265  clude_dims to be
+0000a0d0: 2061 2027 7365 7427 2e20 5265 6365 6976   a 'set'. Receiv
+0000a0e0: 6564 2027 7b74 7970 6528 6578 636c 7564  ed '{type(exclud
+0000a0f0: 655f 6469 6d73 292e 5f5f 6e61 6d65 5f5f  e_dims).__name__
+0000a100: 7d27 2069 6e73 7465 6164 2e22 0a20 2020  }' instead.".   
+0000a110: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000a120: 2020 2069 6620 6e6f 7420 6578 636c 7564     if not exclud
+0000a130: 655f 6469 6d73 203c 3d20 7369 676e 6174  e_dims <= signat
+0000a140: 7572 652e 616c 6c5f 636f 7265 5f64 696d  ure.all_core_dim
+0000a150: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+0000a160: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0000a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a180: 2066 2265 6163 6820 6469 6d65 6e73 696f   f"each dimensio
+0000a190: 6e20 696e 2060 6578 636c 7564 655f 6469  n in `exclude_di
+0000a1a0: 6d73 6020 6d75 7374 2061 6c73 6f20 6265  ms` must also be
+0000a1b0: 2061 2022 0a20 2020 2020 2020 2020 2020   a ".           
+0000a1c0: 2020 2020 2066 2263 6f72 6520 6469 6d65       f"core dime
+0000a1d0: 6e73 696f 6e20 696e 2074 6865 2066 756e  nsion in the fun
+0000a1e0: 6374 696f 6e20 7369 676e 6174 7572 652e  ction signature.
+0000a1f0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000a200: 2020 2066 2250 6c65 6173 6520 6d61 6b65     f"Please make
+0000a210: 207b 2865 7863 6c75 6465 5f64 696d 7320   {(exclude_dims 
+0000a220: 2d20 7369 676e 6174 7572 652e 616c 6c5f  - signature.all_
+0000a230: 636f 7265 5f64 696d 7329 7d20 6120 636f  core_dims)} a co
+0000a240: 7265 2064 696d 656e 7369 6f6e 220a 2020  re dimension".  
+0000a250: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000a260: 2023 2068 616e 646c 6520 6461 736b 5f67   # handle dask_g
+0000a270: 7566 756e 635f 6b77 6172 6773 0a20 2020  ufunc_kwargs.   
+0000a280: 2069 6620 6461 736b 203d 3d20 2270 6172   if dask == "par
+0000a290: 616c 6c65 6c69 7a65 6422 3a0a 2020 2020  allelized":.    
+0000a2a0: 2020 2020 6966 2064 6173 6b5f 6775 6675      if dask_gufu
+0000a2b0: 6e63 5f6b 7761 7267 7320 6973 204e 6f6e  nc_kwargs is Non
+0000a2c0: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+0000a2d0: 6173 6b5f 6775 6675 6e63 5f6b 7761 7267  ask_gufunc_kwarg
+0000a2e0: 7320 3d20 7b7d 0a20 2020 2020 2020 2065  s = {}.        e
+0000a2f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000a300: 2064 6173 6b5f 6775 6675 6e63 5f6b 7761   dask_gufunc_kwa
+0000a310: 7267 7320 3d20 6461 736b 5f67 7566 756e  rgs = dask_gufun
+0000a320: 635f 6b77 6172 6773 2e63 6f70 7928 290a  c_kwargs.copy().
+0000a330: 2020 2020 2020 2020 2320 746f 646f 3a20          # todo: 
+0000a340: 7265 6d6f 7665 2077 6172 6e69 6e67 7320  remove warnings 
+0000a350: 6166 7465 7220 6465 7072 6563 6174 696f  after deprecatio
+0000a360: 6e20 6379 636c 650a 2020 2020 2020 2020  n cycle.        
+0000a370: 6966 206d 6574 6120 6973 206e 6f74 204e  if meta is not N
+0000a380: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000a390: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
+0000a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3b0: 2260 606d 6574 6160 6020 7368 6f75 6c64  "``meta`` should
+0000a3c0: 2062 6520 6769 7665 6e20 696e 2074 6865   be given in the
+0000a3d0: 2060 6064 6173 6b5f 6775 6675 6e63 5f6b   ``dask_gufunc_k
+0000a3e0: 7761 7267 7360 6020 7061 7261 6d65 7465  wargs`` paramete
+0000a3f0: 722e 220a 2020 2020 2020 2020 2020 2020  r.".            
+0000a400: 2020 2020 2220 4974 2077 696c 6c20 6265      " It will be
+0000a410: 2072 656d 6f76 6564 2061 7320 6469 7265   removed as dire
+0000a420: 6374 2070 6172 616d 6574 6572 2069 6e20  ct parameter in 
+0000a430: 6120 6675 7475 7265 2076 6572 7369 6f6e  a future version
+0000a440: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+0000a450: 2020 2020 4675 7475 7265 5761 726e 696e      FutureWarnin
+0000a460: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+0000a470: 2020 2073 7461 636b 6c65 7665 6c3d 322c     stacklevel=2,
+0000a480: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000a490: 2020 2020 2020 2020 2020 2064 6173 6b5f             dask_
+0000a4a0: 6775 6675 6e63 5f6b 7761 7267 732e 7365  gufunc_kwargs.se
+0000a4b0: 7464 6566 6175 6c74 2822 6d65 7461 222c  tdefault("meta",
+0000a4c0: 206d 6574 6129 0a20 2020 2020 2020 2069   meta).        i
+0000a4d0: 6620 6f75 7470 7574 5f73 697a 6573 2069  f output_sizes i
+0000a4e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000a4f0: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+0000a500: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+0000a510: 2020 2020 2020 2022 6060 6f75 7470 7574         "``output
+0000a520: 5f73 697a 6573 6060 2073 686f 756c 6420  _sizes`` should 
+0000a530: 6265 2067 6976 656e 2069 6e20 7468 6520  be given in the 
+0000a540: 6060 6461 736b 5f67 7566 756e 635f 6b77  ``dask_gufunc_kw
+0000a550: 6172 6773 6060 2022 0a20 2020 2020 2020  args`` ".       
+0000a560: 2020 2020 2020 2020 2022 7061 7261 6d65           "parame
+0000a570: 7465 722e 2049 7420 7769 6c6c 2062 6520  ter. It will be 
+0000a580: 7265 6d6f 7665 6420 6173 2064 6972 6563  removed as direc
+0000a590: 7420 7061 7261 6d65 7465 7220 696e 2061  t parameter in a
+0000a5a0: 2066 7574 7572 6520 220a 2020 2020 2020   future ".      
+0000a5b0: 2020 2020 2020 2020 2020 2276 6572 7369            "versi
+0000a5c0: 6f6e 2e22 2c0a 2020 2020 2020 2020 2020  on.",.          
+0000a5d0: 2020 2020 2020 4675 7475 7265 5761 726e        FutureWarn
+0000a5e0: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
+0000a5f0: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
+0000a600: 322c 0a20 2020 2020 2020 2020 2020 2029  2,.            )
+0000a610: 0a20 2020 2020 2020 2020 2020 2064 6173  .            das
+0000a620: 6b5f 6775 6675 6e63 5f6b 7761 7267 732e  k_gufunc_kwargs.
+0000a630: 7365 7464 6566 6175 6c74 2822 6f75 7470  setdefault("outp
+0000a640: 7574 5f73 697a 6573 222c 206f 7574 7075  ut_sizes", outpu
+0000a650: 745f 7369 7a65 7329 0a0a 2020 2020 6966  t_sizes)..    if
+0000a660: 206b 7761 7267 733a 0a20 2020 2020 2020   kwargs:.       
+0000a670: 2066 756e 6320 3d20 6675 6e63 746f 6f6c   func = functool
+0000a680: 732e 7061 7274 6961 6c28 6675 6e63 2c20  s.partial(func, 
+0000a690: 2a2a 6b77 6172 6773 290a 0a20 2020 2069  **kwargs)..    i
+0000a6a0: 6620 6b65 6570 5f61 7474 7273 2069 7320  f keep_attrs is 
+0000a6b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6b65  None:.        ke
+0000a6c0: 6570 5f61 7474 7273 203d 205f 6765 745f  ep_attrs = _get_
+0000a6d0: 6b65 6570 5f61 7474 7273 2864 6566 6175  keep_attrs(defau
+0000a6e0: 6c74 3d46 616c 7365 290a 0a20 2020 2069  lt=False)..    i
+0000a6f0: 6620 6973 696e 7374 616e 6365 286b 6565  f isinstance(kee
+0000a700: 705f 6174 7472 732c 2062 6f6f 6c29 3a0a  p_attrs, bool):.
+0000a710: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+0000a720: 7273 203d 2022 6f76 6572 7269 6465 2220  rs = "override" 
+0000a730: 6966 206b 6565 705f 6174 7472 7320 656c  if keep_attrs el
+0000a740: 7365 2022 6472 6f70 220a 0a20 2020 2076  se "drop"..    v
+0000a750: 6172 6961 626c 6573 5f76 6675 6e63 203d  ariables_vfunc =
+0000a760: 2066 756e 6374 6f6f 6c73 2e70 6172 7469   functools.parti
+0000a770: 616c 280a 2020 2020 2020 2020 6170 706c  al(.        appl
+0000a780: 795f 7661 7269 6162 6c65 5f75 6675 6e63  y_variable_ufunc
+0000a790: 2c0a 2020 2020 2020 2020 6675 6e63 2c0a  ,.        func,.
+0000a7a0: 2020 2020 2020 2020 7369 676e 6174 7572          signatur
+0000a7b0: 653d 7369 676e 6174 7572 652c 0a20 2020  e=signature,.   
+0000a7c0: 2020 2020 2065 7863 6c75 6465 5f64 696d       exclude_dim
+0000a7d0: 733d 6578 636c 7564 655f 6469 6d73 2c0a  s=exclude_dims,.
+0000a7e0: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+0000a7f0: 7273 3d6b 6565 705f 6174 7472 732c 0a20  rs=keep_attrs,. 
+0000a800: 2020 2020 2020 2064 6173 6b3d 6461 736b         dask=dask
+0000a810: 2c0a 2020 2020 2020 2020 7665 6374 6f72  ,.        vector
+0000a820: 697a 653d 7665 6374 6f72 697a 652c 0a20  ize=vectorize,. 
+0000a830: 2020 2020 2020 206f 7574 7075 745f 6474         output_dt
+0000a840: 7970 6573 3d6f 7574 7075 745f 6474 7970  ypes=output_dtyp
+0000a850: 6573 2c0a 2020 2020 2020 2020 6461 736b  es,.        dask
+0000a860: 5f67 7566 756e 635f 6b77 6172 6773 3d64  _gufunc_kwargs=d
+0000a870: 6173 6b5f 6775 6675 6e63 5f6b 7761 7267  ask_gufunc_kwarg
+0000a880: 732c 0a20 2020 2029 0a0a 2020 2020 2320  s,.    )..    # 
+0000a890: 6665 6564 2067 726f 7570 6279 2d61 7070  feed groupby-app
+0000a8a0: 6c79 5f75 6675 6e63 2074 6872 6f75 6768  ly_ufunc through
+0000a8b0: 2061 7070 6c79 5f67 726f 7570 6279 5f66   apply_groupby_f
+0000a8c0: 756e 630a 2020 2020 6966 2061 6e79 2869  unc.    if any(i
+0000a8d0: 7369 6e73 7461 6e63 6528 612c 2047 726f  sinstance(a, Gro
+0000a8e0: 7570 4279 2920 666f 7220 6120 696e 2061  upBy) for a in a
+0000a8f0: 7267 7329 3a0a 2020 2020 2020 2020 7468  rgs):.        th
+0000a900: 6973 5f61 7070 6c79 203d 2066 756e 6374  is_apply = funct
+0000a910: 6f6f 6c73 2e70 6172 7469 616c 280a 2020  ools.partial(.  
+0000a920: 2020 2020 2020 2020 2020 6170 706c 795f            apply_
+0000a930: 7566 756e 632c 0a20 2020 2020 2020 2020  ufunc,.         
+0000a940: 2020 2066 756e 632c 0a20 2020 2020 2020     func,.       
+0000a950: 2020 2020 2069 6e70 7574 5f63 6f72 655f       input_core_
+0000a960: 6469 6d73 3d69 6e70 7574 5f63 6f72 655f  dims=input_core_
+0000a970: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
+0000a980: 2020 6f75 7470 7574 5f63 6f72 655f 6469    output_core_di
+0000a990: 6d73 3d6f 7574 7075 745f 636f 7265 5f64  ms=output_core_d
+0000a9a0: 696d 732c 0a20 2020 2020 2020 2020 2020  ims,.           
+0000a9b0: 2065 7863 6c75 6465 5f64 696d 733d 6578   exclude_dims=ex
+0000a9c0: 636c 7564 655f 6469 6d73 2c0a 2020 2020  clude_dims,.    
+0000a9d0: 2020 2020 2020 2020 6a6f 696e 3d6a 6f69          join=joi
+0000a9e0: 6e2c 0a20 2020 2020 2020 2020 2020 2064  n,.            d
+0000a9f0: 6174 6173 6574 5f6a 6f69 6e3d 6461 7461  ataset_join=data
+0000aa00: 7365 745f 6a6f 696e 2c0a 2020 2020 2020  set_join,.      
+0000aa10: 2020 2020 2020 6461 7461 7365 745f 6669        dataset_fi
+0000aa20: 6c6c 5f76 616c 7565 3d64 6174 6173 6574  ll_value=dataset
+0000aa30: 5f66 696c 6c5f 7661 6c75 652c 0a20 2020  _fill_value,.   
+0000aa40: 2020 2020 2020 2020 206b 6565 705f 6174           keep_at
+0000aa50: 7472 733d 6b65 6570 5f61 7474 7273 2c0a  trs=keep_attrs,.
+0000aa60: 2020 2020 2020 2020 2020 2020 6461 736b              dask
+0000aa70: 3d64 6173 6b2c 0a20 2020 2020 2020 2020  =dask,.         
+0000aa80: 2020 2076 6563 746f 7269 7a65 3d76 6563     vectorize=vec
+0000aa90: 746f 7269 7a65 2c0a 2020 2020 2020 2020  torize,.        
+0000aaa0: 2020 2020 6f75 7470 7574 5f64 7479 7065      output_dtype
+0000aab0: 733d 6f75 7470 7574 5f64 7479 7065 732c  s=output_dtypes,
+0000aac0: 0a20 2020 2020 2020 2020 2020 2064 6173  .            das
+0000aad0: 6b5f 6775 6675 6e63 5f6b 7761 7267 733d  k_gufunc_kwargs=
+0000aae0: 6461 736b 5f67 7566 756e 635f 6b77 6172  dask_gufunc_kwar
+0000aaf0: 6773 2c0a 2020 2020 2020 2020 290a 2020  gs,.        ).  
+0000ab00: 2020 2020 2020 7265 7475 726e 2061 7070        return app
+0000ab10: 6c79 5f67 726f 7570 6279 5f66 756e 6328  ly_groupby_func(
+0000ab20: 7468 6973 5f61 7070 6c79 2c20 2a61 7267  this_apply, *arg
+0000ab30: 7329 0a20 2020 2023 2066 6565 6420 6461  s).    # feed da
+0000ab40: 7461 7365 7473 2061 7070 6c79 5f76 6172  tasets apply_var
+0000ab50: 6961 626c 655f 7566 756e 6320 7468 726f  iable_ufunc thro
+0000ab60: 7567 6820 6170 706c 795f 6461 7461 7365  ugh apply_datase
+0000ab70: 745f 7666 756e 630a 2020 2020 656c 6966  t_vfunc.    elif
+0000ab80: 2061 6e79 2869 735f 6469 6374 5f6c 696b   any(is_dict_lik
+0000ab90: 6528 6129 2066 6f72 2061 2069 6e20 6172  e(a) for a in ar
+0000aba0: 6773 293a 0a20 2020 2020 2020 2072 6574  gs):.        ret
+0000abb0: 7572 6e20 6170 706c 795f 6461 7461 7365  urn apply_datase
+0000abc0: 745f 7666 756e 6328 0a20 2020 2020 2020  t_vfunc(.       
+0000abd0: 2020 2020 2076 6172 6961 626c 6573 5f76       variables_v
+0000abe0: 6675 6e63 2c0a 2020 2020 2020 2020 2020  func,.          
+0000abf0: 2020 2a61 7267 732c 0a20 2020 2020 2020    *args,.       
+0000ac00: 2020 2020 2073 6967 6e61 7475 7265 3d73       signature=s
+0000ac10: 6967 6e61 7475 7265 2c0a 2020 2020 2020  ignature,.      
+0000ac20: 2020 2020 2020 6a6f 696e 3d6a 6f69 6e2c        join=join,
+0000ac30: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0000ac40: 6c75 6465 5f64 696d 733d 6578 636c 7564  lude_dims=exclud
+0000ac50: 655f 6469 6d73 2c0a 2020 2020 2020 2020  e_dims,.        
+0000ac60: 2020 2020 6461 7461 7365 745f 6a6f 696e      dataset_join
+0000ac70: 3d64 6174 6173 6574 5f6a 6f69 6e2c 0a20  =dataset_join,. 
+0000ac80: 2020 2020 2020 2020 2020 2066 696c 6c5f             fill_
+0000ac90: 7661 6c75 653d 6461 7461 7365 745f 6669  value=dataset_fi
+0000aca0: 6c6c 5f76 616c 7565 2c0a 2020 2020 2020  ll_value,.      
+0000acb0: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
+0000acc0: 3d6b 6565 705f 6174 7472 732c 0a20 2020  =keep_attrs,.   
+0000acd0: 2020 2020 2029 0a20 2020 2023 2066 6565       ).    # fee
+0000ace0: 6420 4461 7461 4172 7261 7920 6170 706c  d DataArray appl
+0000acf0: 795f 7661 7269 6162 6c65 5f75 6675 6e63  y_variable_ufunc
+0000ad00: 2074 6872 6f75 6768 2061 7070 6c79 5f64   through apply_d
+0000ad10: 6174 6161 7272 6179 5f76 6675 6e63 0a20  ataarray_vfunc. 
+0000ad20: 2020 2065 6c69 6620 616e 7928 6973 696e     elif any(isin
+0000ad30: 7374 616e 6365 2861 2c20 4461 7461 4172  stance(a, DataAr
+0000ad40: 7261 7929 2066 6f72 2061 2069 6e20 6172  ray) for a in ar
+0000ad50: 6773 293a 0a20 2020 2020 2020 2072 6574  gs):.        ret
+0000ad60: 7572 6e20 6170 706c 795f 6461 7461 6172  urn apply_dataar
+0000ad70: 7261 795f 7666 756e 6328 0a20 2020 2020  ray_vfunc(.     
+0000ad80: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0000ad90: 5f76 6675 6e63 2c0a 2020 2020 2020 2020  _vfunc,.        
+0000ada0: 2020 2020 2a61 7267 732c 0a20 2020 2020      *args,.     
+0000adb0: 2020 2020 2020 2073 6967 6e61 7475 7265         signature
+0000adc0: 3d73 6967 6e61 7475 7265 2c0a 2020 2020  =signature,.    
+0000add0: 2020 2020 2020 2020 6a6f 696e 3d6a 6f69          join=joi
+0000ade0: 6e2c 0a20 2020 2020 2020 2020 2020 2065  n,.            e
+0000adf0: 7863 6c75 6465 5f64 696d 733d 6578 636c  xclude_dims=excl
+0000ae00: 7564 655f 6469 6d73 2c0a 2020 2020 2020  ude_dims,.      
+0000ae10: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
+0000ae20: 3d6b 6565 705f 6174 7472 732c 0a20 2020  =keep_attrs,.   
+0000ae30: 2020 2020 2029 0a20 2020 2023 2066 6565       ).    # fee
+0000ae40: 6420 5661 7269 6162 6c65 7320 6469 7265  d Variables dire
+0000ae50: 6374 6c79 2074 6872 6f75 6768 2061 7070  ctly through app
+0000ae60: 6c79 5f76 6172 6961 626c 655f 7566 756e  ly_variable_ufun
+0000ae70: 630a 2020 2020 656c 6966 2061 6e79 2869  c.    elif any(i
+0000ae80: 7369 6e73 7461 6e63 6528 612c 2056 6172  sinstance(a, Var
+0000ae90: 6961 626c 6529 2066 6f72 2061 2069 6e20  iable) for a in 
+0000aea0: 6172 6773 293a 0a20 2020 2020 2020 2072  args):.        r
+0000aeb0: 6574 7572 6e20 7661 7269 6162 6c65 735f  eturn variables_
+0000aec0: 7666 756e 6328 2a61 7267 7329 0a20 2020  vfunc(*args).   
+0000aed0: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
+0000aee0: 2066 6565 6420 616e 7974 6869 6e67 2065   feed anything e
+0000aef0: 6c73 6520 7468 726f 7567 6820 6170 706c  lse through appl
+0000af00: 795f 6172 7261 795f 7566 756e 630a 2020  y_array_ufunc.  
+0000af10: 2020 2020 2020 7265 7475 726e 2061 7070        return app
+0000af20: 6c79 5f61 7272 6179 5f75 6675 6e63 2866  ly_array_ufunc(f
+0000af30: 756e 632c 202a 6172 6773 2c20 6461 736b  unc, *args, dask
+0000af40: 3d64 6173 6b29 0a0a 0a64 6566 2063 6f76  =dask)...def cov
+0000af50: 280a 2020 2020 6461 5f61 3a20 545f 4461  (.    da_a: T_Da
+0000af60: 7461 4172 7261 792c 2064 615f 623a 2054  taArray, da_b: T
+0000af70: 5f44 6174 6141 7272 6179 2c20 6469 6d3a  _DataArray, dim:
+0000af80: 2044 696d 7320 3d20 4e6f 6e65 2c20 6464   Dims = None, dd
+0000af90: 6f66 3a20 696e 7420 3d20 310a 2920 2d3e  of: int = 1.) ->
+0000afa0: 2054 5f44 6174 6141 7272 6179 3a0a 2020   T_DataArray:.  
+0000afb0: 2020 2222 220a 2020 2020 436f 6d70 7574    """.    Comput
+0000afc0: 6520 636f 7661 7269 616e 6365 2062 6574  e covariance bet
+0000afd0: 7765 656e 2074 776f 2044 6174 6141 7272  ween two DataArr
+0000afe0: 6179 206f 626a 6563 7473 2061 6c6f 6e67  ay objects along
+0000aff0: 2061 2073 6861 7265 6420 6469 6d65 6e73   a shared dimens
+0000b000: 696f 6e2e 0a0a 2020 2020 5061 7261 6d65  ion...    Parame
+0000b010: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+0000b020: 2d2d 2d0a 2020 2020 6461 5f61 203a 2044  ---.    da_a : D
+0000b030: 6174 6141 7272 6179 0a20 2020 2020 2020  ataArray.       
+0000b040: 2041 7272 6179 2074 6f20 636f 6d70 7574   Array to comput
+0000b050: 652e 0a20 2020 2064 615f 6220 3a20 4461  e..    da_b : Da
+0000b060: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
+0000b070: 4172 7261 7920 746f 2063 6f6d 7075 7465  Array to compute
+0000b080: 2e0a 2020 2020 6469 6d20 3a20 7374 722c  ..    dim : str,
+0000b090: 2069 7465 7261 626c 6520 6f66 2068 6173   iterable of has
+0000b0a0: 6861 626c 652c 2022 2e2e 2e22 206f 7220  hable, "..." or 
+0000b0b0: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0a20  None, optional. 
+0000b0c0: 2020 2020 2020 2054 6865 2064 696d 656e         The dimen
+0000b0d0: 7369 6f6e 2061 6c6f 6e67 2077 6869 6368  sion along which
+0000b0e0: 2074 6865 2063 6f76 6172 6961 6e63 6520   the covariance 
+0000b0f0: 7769 6c6c 2062 6520 636f 6d70 7574 6564  will be computed
+0000b100: 0a20 2020 2064 646f 6620 3a20 696e 742c  .    ddof : int,
+0000b110: 2064 6566 6175 6c74 3a20 310a 2020 2020   default: 1.    
+0000b120: 2020 2020 4966 2064 646f 663d 312c 2063      If ddof=1, c
+0000b130: 6f76 6172 6961 6e63 6520 6973 206e 6f72  ovariance is nor
+0000b140: 6d61 6c69 7a65 6420 6279 204e 2d31 2c20  malized by N-1, 
+0000b150: 6769 7669 6e67 2061 6e20 756e 6269 6173  giving an unbias
+0000b160: 6564 2065 7374 696d 6174 652c 0a20 2020  ed estimate,.   
+0000b170: 2020 2020 2065 6c73 6520 6e6f 726d 616c       else normal
+0000b180: 697a 6174 696f 6e20 6973 2062 7920 4e2e  ization is by N.
+0000b190: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
+0000b1a0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 636f    -------.    co
+0000b1b0: 7661 7269 616e 6365 203a 2044 6174 6141  variance : DataA
+0000b1c0: 7272 6179 0a0a 2020 2020 5365 6520 416c  rray..    See Al
+0000b1d0: 736f 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  so.    --------.
+0000b1e0: 2020 2020 7061 6e64 6173 2e53 6572 6965      pandas.Serie
+0000b1f0: 732e 636f 7620 3a20 636f 7272 6573 706f  s.cov : correspo
+0000b200: 6e64 696e 6720 7061 6e64 6173 2066 756e  nding pandas fun
+0000b210: 6374 696f 6e0a 2020 2020 7861 7272 6179  ction.    xarray
+0000b220: 2e63 6f72 7220 3a20 7265 7370 6563 7469  .corr : respecti
+0000b230: 7665 2066 756e 6374 696f 6e20 746f 2063  ve function to c
+0000b240: 616c 6375 6c61 7465 2063 6f72 7265 6c61  alculate correla
+0000b250: 7469 6f6e 0a0a 2020 2020 4578 616d 706c  tion..    Exampl
+0000b260: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
+0000b270: 2020 2020 3e3e 3e20 6672 6f6d 2078 6172      >>> from xar
+0000b280: 7261 7920 696d 706f 7274 2044 6174 6141  ray import DataA
+0000b290: 7272 6179 0a20 2020 203e 3e3e 2064 615f  rray.    >>> da_
+0000b2a0: 6120 3d20 4461 7461 4172 7261 7928 0a20  a = DataArray(. 
+0000b2b0: 2020 202e 2e2e 2020 2020 206e 702e 6172     ...     np.ar
+0000b2c0: 7261 7928 5b5b 312c 2032 2c20 335d 2c20  ray([[1, 2, 3], 
+0000b2d0: 5b30 2e31 2c20 302e 322c 2030 2e33 5d2c  [0.1, 0.2, 0.3],
+0000b2e0: 205b 332e 322c 2030 2e36 2c20 312e 385d   [3.2, 0.6, 1.8]
+0000b2f0: 5d29 2c0a 2020 2020 2e2e 2e20 2020 2020  ]),.    ...     
+0000b300: 6469 6d73 3d28 2273 7061 6365 222c 2022  dims=("space", "
+0000b310: 7469 6d65 2229 2c0a 2020 2020 2e2e 2e20  time"),.    ... 
+0000b320: 2020 2020 636f 6f72 6473 3d5b 0a20 2020      coords=[.   
+0000b330: 202e 2e2e 2020 2020 2020 2020 2028 2273   ...         ("s
+0000b340: 7061 6365 222c 205b 2249 4122 2c20 2249  pace", ["IA", "I
+0000b350: 4c22 2c20 2249 4e22 5d29 2c0a 2020 2020  L", "IN"]),.    
+0000b360: 2e2e 2e20 2020 2020 2020 2020 2822 7469  ...         ("ti
+0000b370: 6d65 222c 2070 642e 6461 7465 5f72 616e  me", pd.date_ran
+0000b380: 6765 2822 3230 3030 2d30 312d 3031 222c  ge("2000-01-01",
+0000b390: 2066 7265 713d 2231 4422 2c20 7065 7269   freq="1D", peri
+0000b3a0: 6f64 733d 3329 292c 0a20 2020 202e 2e2e  ods=3)),.    ...
+0000b3b0: 2020 2020 205d 2c0a 2020 2020 2e2e 2e20       ],.    ... 
+0000b3c0: 290a 2020 2020 3e3e 3e20 6461 5f61 0a20  ).    >>> da_a. 
+0000b3d0: 2020 203c 7861 7272 6179 2e44 6174 6141     <xarray.DataA
+0000b3e0: 7272 6179 2028 7370 6163 653a 2033 2c20  rray (space: 3, 
+0000b3f0: 7469 6d65 3a20 3329 3e0a 2020 2020 6172  time: 3)>.    ar
+0000b400: 7261 7928 5b5b 312e 202c 2032 2e20 2c20  ray([[1. , 2. , 
+0000b410: 332e 205d 2c0a 2020 2020 2020 2020 2020  3. ],.          
+0000b420: 205b 302e 312c 2030 2e32 2c20 302e 335d   [0.1, 0.2, 0.3]
+0000b430: 2c0a 2020 2020 2020 2020 2020 205b 332e  ,.           [3.
+0000b440: 322c 2030 2e36 2c20 312e 385d 5d29 0a20  2, 0.6, 1.8]]). 
+0000b450: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+0000b460: 2020 2020 2020 2a20 7370 6163 6520 2020        * space   
+0000b470: 2028 7370 6163 6529 203c 5532 2027 4941   (space) <U2 'IA
+0000b480: 2720 2749 4c27 2027 494e 270a 2020 2020  ' 'IL' 'IN'.    
+0000b490: 2020 2a20 7469 6d65 2020 2020 2028 7469    * time     (ti
+0000b4a0: 6d65 2920 6461 7465 7469 6d65 3634 5b6e  me) datetime64[n
+0000b4b0: 735d 2032 3030 302d 3031 2d30 3120 3230  s] 2000-01-01 20
+0000b4c0: 3030 2d30 312d 3032 2032 3030 302d 3031  00-01-02 2000-01
+0000b4d0: 2d30 330a 2020 2020 3e3e 3e20 6461 5f62  -03.    >>> da_b
+0000b4e0: 203d 2044 6174 6141 7272 6179 280a 2020   = DataArray(.  
+0000b4f0: 2020 2e2e 2e20 2020 2020 6e70 2e61 7272    ...     np.arr
+0000b500: 6179 285b 5b30 2e32 2c20 302e 342c 2030  ay([[0.2, 0.4, 0
+0000b510: 2e36 5d2c 205b 3135 2c20 3130 2c20 355d  .6], [15, 10, 5]
+0000b520: 2c20 5b33 2e32 2c20 302e 362c 2031 2e38  , [3.2, 0.6, 1.8
+0000b530: 5d5d 292c 0a20 2020 202e 2e2e 2020 2020  ]]),.    ...    
+0000b540: 2064 696d 733d 2822 7370 6163 6522 2c20   dims=("space", 
+0000b550: 2274 696d 6522 292c 0a20 2020 202e 2e2e  "time"),.    ...
+0000b560: 2020 2020 2063 6f6f 7264 733d 5b0a 2020       coords=[.  
+0000b570: 2020 2e2e 2e20 2020 2020 2020 2020 2822    ...         ("
+0000b580: 7370 6163 6522 2c20 5b22 4941 222c 2022  space", ["IA", "
+0000b590: 494c 222c 2022 494e 225d 292c 0a20 2020  IL", "IN"]),.   
+0000b5a0: 202e 2e2e 2020 2020 2020 2020 2028 2274   ...         ("t
+0000b5b0: 696d 6522 2c20 7064 2e64 6174 655f 7261  ime", pd.date_ra
+0000b5c0: 6e67 6528 2232 3030 302d 3031 2d30 3122  nge("2000-01-01"
+0000b5d0: 2c20 6672 6571 3d22 3144 222c 2070 6572  , freq="1D", per
+0000b5e0: 696f 6473 3d33 2929 2c0a 2020 2020 2e2e  iods=3)),.    ..
+0000b5f0: 2e20 2020 2020 5d2c 0a20 2020 202e 2e2e  .     ],.    ...
+0000b600: 2029 0a20 2020 203e 3e3e 2064 615f 620a   ).    >>> da_b.
+0000b610: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+0000b620: 4172 7261 7920 2873 7061 6365 3a20 332c  Array (space: 3,
+0000b630: 2074 696d 653a 2033 293e 0a20 2020 2061   time: 3)>.    a
+0000b640: 7272 6179 285b 5b20 302e 322c 2020 302e  rray([[ 0.2,  0.
+0000b650: 342c 2020 302e 365d 2c0a 2020 2020 2020  4,  0.6],.      
+0000b660: 2020 2020 205b 3135 2e20 2c20 3130 2e20       [15. , 10. 
+0000b670: 2c20 2035 2e20 5d2c 0a20 2020 2020 2020  ,  5. ],.       
+0000b680: 2020 2020 5b20 332e 322c 2020 302e 362c      [ 3.2,  0.6,
+0000b690: 2020 312e 385d 5d29 0a20 2020 2043 6f6f    1.8]]).    Coo
+0000b6a0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+0000b6b0: 2a20 7370 6163 6520 2020 2028 7370 6163  * space    (spac
+0000b6c0: 6529 203c 5532 2027 4941 2720 2749 4c27  e) <U2 'IA' 'IL'
+0000b6d0: 2027 494e 270a 2020 2020 2020 2a20 7469   'IN'.      * ti
+0000b6e0: 6d65 2020 2020 2028 7469 6d65 2920 6461  me     (time) da
+0000b6f0: 7465 7469 6d65 3634 5b6e 735d 2032 3030  tetime64[ns] 200
+0000b700: 302d 3031 2d30 3120 3230 3030 2d30 312d  0-01-01 2000-01-
+0000b710: 3032 2032 3030 302d 3031 2d30 330a 2020  02 2000-01-03.  
+0000b720: 2020 3e3e 3e20 7872 2e63 6f76 2864 615f    >>> xr.cov(da_
+0000b730: 612c 2064 615f 6229 0a20 2020 203c 7861  a, da_b).    <xa
+0000b740: 7272 6179 2e44 6174 6141 7272 6179 2028  rray.DataArray (
+0000b750: 293e 0a20 2020 2061 7272 6179 282d 332e  )>.    array(-3.
+0000b760: 3533 3035 3535 3536 290a 2020 2020 3e3e  53055556).    >>
+0000b770: 3e20 7872 2e63 6f76 2864 615f 612c 2064  > xr.cov(da_a, d
+0000b780: 615f 622c 2064 696d 3d22 7469 6d65 2229  a_b, dim="time")
+0000b790: 0a20 2020 203c 7861 7272 6179 2e44 6174  .    <xarray.Dat
+0000b7a0: 6141 7272 6179 2028 7370 6163 653a 2033  aArray (space: 3
+0000b7b0: 293e 0a20 2020 2061 7272 6179 285b 2030  )>.    array([ 0
+0000b7c0: 2e32 2020 2020 2020 202c 202d 302e 3520  .2       , -0.5 
+0000b7d0: 2020 2020 2020 2c20 2031 2e36 3933 3333        ,  1.69333
+0000b7e0: 3333 335d 290a 2020 2020 436f 6f72 6469  333]).    Coordi
+0000b7f0: 6e61 7465 733a 0a20 2020 2020 202a 2073  nates:.      * s
+0000b800: 7061 6365 2020 2020 2873 7061 6365 2920  pace    (space) 
+0000b810: 3c55 3220 2749 4127 2027 494c 2720 2749  <U2 'IA' 'IL' 'I
+0000b820: 4e27 0a20 2020 2022 2222 0a20 2020 2066  N'.    """.    f
+0000b830: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+0000b840: 6461 7461 6172 7261 7920 696d 706f 7274  dataarray import
+0000b850: 2044 6174 6141 7272 6179 0a0a 2020 2020   DataArray..    
+0000b860: 6966 2061 6e79 286e 6f74 2069 7369 6e73  if any(not isins
+0000b870: 7461 6e63 6528 6172 722c 2044 6174 6141  tance(arr, DataA
+0000b880: 7272 6179 2920 666f 7220 6172 7220 696e  rray) for arr in
+0000b890: 205b 6461 5f61 2c20 6461 5f62 5d29 3a0a   [da_a, da_b]):.
+0000b8a0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+0000b8b0: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
+0000b8c0: 2020 2020 2022 4f6e 6c79 2078 722e 4461       "Only xr.Da
+0000b8d0: 7461 4172 7261 7920 6973 2073 7570 706f  taArray is suppo
+0000b8e0: 7274 6564 2e22 0a20 2020 2020 2020 2020  rted.".         
+0000b8f0: 2020 2022 4769 7665 6e20 7b7d 2e22 2e66     "Given {}.".f
+0000b900: 6f72 6d61 7428 5b74 7970 6528 6172 7229  ormat([type(arr)
+0000b910: 2066 6f72 2061 7272 2069 6e20 5b64 615f   for arr in [da_
+0000b920: 612c 2064 615f 625d 5d29 0a20 2020 2020  a, da_b]]).     
+0000b930: 2020 2029 0a0a 2020 2020 7265 7475 726e     )..    return
+0000b940: 205f 636f 765f 636f 7272 2864 615f 612c   _cov_corr(da_a,
+0000b950: 2064 615f 622c 2064 696d 3d64 696d 2c20   da_b, dim=dim, 
+0000b960: 6464 6f66 3d64 646f 662c 206d 6574 686f  ddof=ddof, metho
+0000b970: 643d 2263 6f76 2229 0a0a 0a64 6566 2063  d="cov")...def c
+0000b980: 6f72 7228 6461 5f61 3a20 545f 4461 7461  orr(da_a: T_Data
+0000b990: 4172 7261 792c 2064 615f 623a 2054 5f44  Array, da_b: T_D
+0000b9a0: 6174 6141 7272 6179 2c20 6469 6d3a 2044  ataArray, dim: D
+0000b9b0: 696d 7320 3d20 4e6f 6e65 2920 2d3e 2054  ims = None) -> T
+0000b9c0: 5f44 6174 6141 7272 6179 3a0a 2020 2020  _DataArray:.    
+0000b9d0: 2222 220a 2020 2020 436f 6d70 7574 6520  """.    Compute 
+0000b9e0: 7468 6520 5065 6172 736f 6e20 636f 7272  the Pearson corr
+0000b9f0: 656c 6174 696f 6e20 636f 6566 6669 6369  elation coeffici
+0000ba00: 656e 7420 6265 7477 6565 6e0a 2020 2020  ent between.    
+0000ba10: 7477 6f20 4461 7461 4172 7261 7920 6f62  two DataArray ob
+0000ba20: 6a65 6374 7320 616c 6f6e 6720 6120 7368  jects along a sh
+0000ba30: 6172 6564 2064 696d 656e 7369 6f6e 2e0a  ared dimension..
+0000ba40: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+0000ba50: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+0000ba60: 2020 2064 615f 6120 3a20 4461 7461 4172     da_a : DataAr
+0000ba70: 7261 790a 2020 2020 2020 2020 4172 7261  ray.        Arra
+0000ba80: 7920 746f 2063 6f6d 7075 7465 2e0a 2020  y to compute..  
+0000ba90: 2020 6461 5f62 203a 2044 6174 6141 7272    da_b : DataArr
+0000baa0: 6179 0a20 2020 2020 2020 2041 7272 6179  ay.        Array
+0000bab0: 2074 6f20 636f 6d70 7574 652e 0a20 2020   to compute..   
+0000bac0: 2064 696d 203a 2073 7472 2c20 6974 6572   dim : str, iter
+0000bad0: 6162 6c65 206f 6620 6861 7368 6162 6c65  able of hashable
+0000bae0: 2c20 222e 2e2e 2220 6f72 204e 6f6e 652c  , "..." or None,
+0000baf0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0000bb00: 2020 5468 6520 6469 6d65 6e73 696f 6e20    The dimension 
+0000bb10: 616c 6f6e 6720 7768 6963 6820 7468 6520  along which the 
+0000bb20: 636f 7272 656c 6174 696f 6e20 7769 6c6c  correlation will
+0000bb30: 2062 6520 636f 6d70 7574 6564 0a0a 2020   be computed..  
+0000bb40: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+0000bb50: 2d2d 2d2d 2d0a 2020 2020 636f 7272 656c  -----.    correl
+0000bb60: 6174 696f 6e3a 2044 6174 6141 7272 6179  ation: DataArray
+0000bb70: 0a0a 2020 2020 5365 6520 416c 736f 0a20  ..    See Also. 
+0000bb80: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0000bb90: 7061 6e64 6173 2e53 6572 6965 732e 636f  pandas.Series.co
+0000bba0: 7272 203a 2063 6f72 7265 7370 6f6e 6469  rr : correspondi
+0000bbb0: 6e67 2070 616e 6461 7320 6675 6e63 7469  ng pandas functi
+0000bbc0: 6f6e 0a20 2020 2078 6172 7261 792e 636f  on.    xarray.co
+0000bbd0: 7620 3a20 756e 6465 726c 7969 6e67 2063  v : underlying c
+0000bbe0: 6f76 6172 6961 6e63 6520 6675 6e63 7469  ovariance functi
+0000bbf0: 6f6e 0a0a 2020 2020 4578 616d 706c 6573  on..    Examples
+0000bc00: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+0000bc10: 2020 3e3e 3e20 6672 6f6d 2078 6172 7261    >>> from xarra
+0000bc20: 7920 696d 706f 7274 2044 6174 6141 7272  y import DataArr
+0000bc30: 6179 0a20 2020 203e 3e3e 2064 615f 6120  ay.    >>> da_a 
+0000bc40: 3d20 4461 7461 4172 7261 7928 0a20 2020  = DataArray(.   
+0000bc50: 202e 2e2e 2020 2020 206e 702e 6172 7261   ...     np.arra
+0000bc60: 7928 5b5b 312c 2032 2c20 335d 2c20 5b30  y([[1, 2, 3], [0
+0000bc70: 2e31 2c20 302e 322c 2030 2e33 5d2c 205b  .1, 0.2, 0.3], [
+0000bc80: 332e 322c 2030 2e36 2c20 312e 385d 5d29  3.2, 0.6, 1.8]])
+0000bc90: 2c0a 2020 2020 2e2e 2e20 2020 2020 6469  ,.    ...     di
+0000bca0: 6d73 3d28 2273 7061 6365 222c 2022 7469  ms=("space", "ti
+0000bcb0: 6d65 2229 2c0a 2020 2020 2e2e 2e20 2020  me"),.    ...   
+0000bcc0: 2020 636f 6f72 6473 3d5b 0a20 2020 202e    coords=[.    .
+0000bcd0: 2e2e 2020 2020 2020 2020 2028 2273 7061  ..         ("spa
+0000bce0: 6365 222c 205b 2249 4122 2c20 2249 4c22  ce", ["IA", "IL"
+0000bcf0: 2c20 2249 4e22 5d29 2c0a 2020 2020 2e2e  , "IN"]),.    ..
+0000bd00: 2e20 2020 2020 2020 2020 2822 7469 6d65  .         ("time
+0000bd10: 222c 2070 642e 6461 7465 5f72 616e 6765  ", pd.date_range
+0000bd20: 2822 3230 3030 2d30 312d 3031 222c 2066  ("2000-01-01", f
+0000bd30: 7265 713d 2231 4422 2c20 7065 7269 6f64  req="1D", period
+0000bd40: 733d 3329 292c 0a20 2020 202e 2e2e 2020  s=3)),.    ...  
+0000bd50: 2020 205d 2c0a 2020 2020 2e2e 2e20 290a     ],.    ... ).
+0000bd60: 2020 2020 3e3e 3e20 6461 5f61 0a20 2020      >>> da_a.   
+0000bd70: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
+0000bd80: 6179 2028 7370 6163 653a 2033 2c20 7469  ay (space: 3, ti
+0000bd90: 6d65 3a20 3329 3e0a 2020 2020 6172 7261  me: 3)>.    arra
+0000bda0: 7928 5b5b 312e 202c 2032 2e20 2c20 332e  y([[1. , 2. , 3.
+0000bdb0: 205d 2c0a 2020 2020 2020 2020 2020 205b   ],.           [
+0000bdc0: 302e 312c 2030 2e32 2c20 302e 335d 2c0a  0.1, 0.2, 0.3],.
+0000bdd0: 2020 2020 2020 2020 2020 205b 332e 322c             [3.2,
+0000bde0: 2030 2e36 2c20 312e 385d 5d29 0a20 2020   0.6, 1.8]]).   
+0000bdf0: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+0000be00: 2020 2020 2a20 7370 6163 6520 2020 2028      * space    (
+0000be10: 7370 6163 6529 203c 5532 2027 4941 2720  space) <U2 'IA' 
+0000be20: 2749 4c27 2027 494e 270a 2020 2020 2020  'IL' 'IN'.      
+0000be30: 2a20 7469 6d65 2020 2020 2028 7469 6d65  * time     (time
+0000be40: 2920 6461 7465 7469 6d65 3634 5b6e 735d  ) datetime64[ns]
+0000be50: 2032 3030 302d 3031 2d30 3120 3230 3030   2000-01-01 2000
+0000be60: 2d30 312d 3032 2032 3030 302d 3031 2d30  -01-02 2000-01-0
+0000be70: 330a 2020 2020 3e3e 3e20 6461 5f62 203d  3.    >>> da_b =
+0000be80: 2044 6174 6141 7272 6179 280a 2020 2020   DataArray(.    
+0000be90: 2e2e 2e20 2020 2020 6e70 2e61 7272 6179  ...     np.array
+0000bea0: 285b 5b30 2e32 2c20 302e 342c 2030 2e36  ([[0.2, 0.4, 0.6
+0000beb0: 5d2c 205b 3135 2c20 3130 2c20 355d 2c20  ], [15, 10, 5], 
+0000bec0: 5b33 2e32 2c20 302e 362c 2031 2e38 5d5d  [3.2, 0.6, 1.8]]
+0000bed0: 292c 0a20 2020 202e 2e2e 2020 2020 2064  ),.    ...     d
+0000bee0: 696d 733d 2822 7370 6163 6522 2c20 2274  ims=("space", "t
+0000bef0: 696d 6522 292c 0a20 2020 202e 2e2e 2020  ime"),.    ...  
+0000bf00: 2020 2063 6f6f 7264 733d 5b0a 2020 2020     coords=[.    
+0000bf10: 2e2e 2e20 2020 2020 2020 2020 2822 7370  ...         ("sp
+0000bf20: 6163 6522 2c20 5b22 4941 222c 2022 494c  ace", ["IA", "IL
+0000bf30: 222c 2022 494e 225d 292c 0a20 2020 202e  ", "IN"]),.    .
+0000bf40: 2e2e 2020 2020 2020 2020 2028 2274 696d  ..         ("tim
+0000bf50: 6522 2c20 7064 2e64 6174 655f 7261 6e67  e", pd.date_rang
+0000bf60: 6528 2232 3030 302d 3031 2d30 3122 2c20  e("2000-01-01", 
+0000bf70: 6672 6571 3d22 3144 222c 2070 6572 696f  freq="1D", perio
+0000bf80: 6473 3d33 2929 2c0a 2020 2020 2e2e 2e20  ds=3)),.    ... 
+0000bf90: 2020 2020 5d2c 0a20 2020 202e 2e2e 2029      ],.    ... )
+0000bfa0: 0a20 2020 203e 3e3e 2064 615f 620a 2020  .    >>> da_b.  
+0000bfb0: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
+0000bfc0: 7261 7920 2873 7061 6365 3a20 332c 2074  ray (space: 3, t
+0000bfd0: 696d 653a 2033 293e 0a20 2020 2061 7272  ime: 3)>.    arr
+0000bfe0: 6179 285b 5b20 302e 322c 2020 302e 342c  ay([[ 0.2,  0.4,
+0000bff0: 2020 302e 365d 2c0a 2020 2020 2020 2020    0.6],.        
+0000c000: 2020 205b 3135 2e20 2c20 3130 2e20 2c20     [15. , 10. , 
+0000c010: 2035 2e20 5d2c 0a20 2020 2020 2020 2020   5. ],.         
+0000c020: 2020 5b20 332e 322c 2020 302e 362c 2020    [ 3.2,  0.6,  
+0000c030: 312e 385d 5d29 0a20 2020 2043 6f6f 7264  1.8]]).    Coord
+0000c040: 696e 6174 6573 3a0a 2020 2020 2020 2a20  inates:.      * 
+0000c050: 7370 6163 6520 2020 2028 7370 6163 6529  space    (space)
+0000c060: 203c 5532 2027 4941 2720 2749 4c27 2027   <U2 'IA' 'IL' '
+0000c070: 494e 270a 2020 2020 2020 2a20 7469 6d65  IN'.      * time
+0000c080: 2020 2020 2028 7469 6d65 2920 6461 7465       (time) date
+0000c090: 7469 6d65 3634 5b6e 735d 2032 3030 302d  time64[ns] 2000-
+0000c0a0: 3031 2d30 3120 3230 3030 2d30 312d 3032  01-01 2000-01-02
+0000c0b0: 2032 3030 302d 3031 2d30 330a 2020 2020   2000-01-03.    
+0000c0c0: 3e3e 3e20 7872 2e63 6f72 7228 6461 5f61  >>> xr.corr(da_a
+0000c0d0: 2c20 6461 5f62 290a 2020 2020 3c78 6172  , da_b).    <xar
+0000c0e0: 7261 792e 4461 7461 4172 7261 7920 2829  ray.DataArray ()
+0000c0f0: 3e0a 2020 2020 6172 7261 7928 2d30 2e35  >.    array(-0.5
+0000c100: 3730 3837 3737 3729 0a20 2020 203e 3e3e  7087777).    >>>
+0000c110: 2078 722e 636f 7272 2864 615f 612c 2064   xr.corr(da_a, d
+0000c120: 615f 622c 2064 696d 3d22 7469 6d65 2229  a_b, dim="time")
+0000c130: 0a20 2020 203c 7861 7272 6179 2e44 6174  .    <xarray.Dat
+0000c140: 6141 7272 6179 2028 7370 6163 653a 2033  aArray (space: 3
+0000c150: 293e 0a20 2020 2061 7272 6179 285b 2031  )>.    array([ 1
+0000c160: 2e2c 202d 312e 2c20 2031 2e5d 290a 2020  ., -1.,  1.]).  
+0000c170: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0000c180: 2020 2020 202a 2073 7061 6365 2020 2020       * space    
+0000c190: 2873 7061 6365 2920 3c55 3220 2749 4127  (space) <U2 'IA'
+0000c1a0: 2027 494c 2720 2749 4e27 0a20 2020 2022   'IL' 'IN'.    "
+0000c1b0: 2222 0a20 2020 2066 726f 6d20 7861 7272  "".    from xarr
+0000c1c0: 6179 2e63 6f72 652e 6461 7461 6172 7261  ay.core.dataarra
+0000c1d0: 7920 696d 706f 7274 2044 6174 6141 7272  y import DataArr
+0000c1e0: 6179 0a0a 2020 2020 6966 2061 6e79 286e  ay..    if any(n
+0000c1f0: 6f74 2069 7369 6e73 7461 6e63 6528 6172  ot isinstance(ar
+0000c200: 722c 2044 6174 6141 7272 6179 2920 666f  r, DataArray) fo
+0000c210: 7220 6172 7220 696e 205b 6461 5f61 2c20  r arr in [da_a, 
+0000c220: 6461 5f62 5d29 3a0a 2020 2020 2020 2020  da_b]):.        
+0000c230: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+0000c240: 0a20 2020 2020 2020 2020 2020 2022 4f6e  .            "On
+0000c250: 6c79 2078 722e 4461 7461 4172 7261 7920  ly xr.DataArray 
+0000c260: 6973 2073 7570 706f 7274 6564 2e22 0a20  is supported.". 
+0000c270: 2020 2020 2020 2020 2020 2022 4769 7665             "Give
+0000c280: 6e20 7b7d 2e22 2e66 6f72 6d61 7428 5b74  n {}.".format([t
+0000c290: 7970 6528 6172 7229 2066 6f72 2061 7272  ype(arr) for arr
+0000c2a0: 2069 6e20 5b64 615f 612c 2064 615f 625d   in [da_a, da_b]
+0000c2b0: 5d29 0a20 2020 2020 2020 2029 0a0a 2020  ]).        )..  
+0000c2c0: 2020 7265 7475 726e 205f 636f 765f 636f    return _cov_co
+0000c2d0: 7272 2864 615f 612c 2064 615f 622c 2064  rr(da_a, da_b, d
+0000c2e0: 696d 3d64 696d 2c20 6d65 7468 6f64 3d22  im=dim, method="
+0000c2f0: 636f 7272 2229 0a0a 0a64 6566 205f 636f  corr")...def _co
+0000c300: 765f 636f 7272 280a 2020 2020 6461 5f61  v_corr(.    da_a
+0000c310: 3a20 545f 4461 7461 4172 7261 792c 0a20  : T_DataArray,. 
+0000c320: 2020 2064 615f 623a 2054 5f44 6174 6141     da_b: T_DataA
+0000c330: 7272 6179 2c0a 2020 2020 6469 6d3a 2044  rray,.    dim: D
+0000c340: 696d 7320 3d20 4e6f 6e65 2c0a 2020 2020  ims = None,.    
+0000c350: 6464 6f66 3a20 696e 7420 3d20 302c 0a20  ddof: int = 0,. 
+0000c360: 2020 206d 6574 686f 643a 204c 6974 6572     method: Liter
+0000c370: 616c 5b22 636f 7622 2c20 2263 6f72 7222  al["cov", "corr"
+0000c380: 2c20 4e6f 6e65 5d20 3d20 4e6f 6e65 2c0a  , None] = None,.
+0000c390: 2920 2d3e 2054 5f44 6174 6141 7272 6179  ) -> T_DataArray
+0000c3a0: 3a0a 2020 2020 2222 220a 2020 2020 496e  :.    """.    In
+0000c3b0: 7465 726e 616c 206d 6574 686f 6420 666f  ternal method fo
+0000c3c0: 7220 7872 2e63 6f76 2829 2061 6e64 2078  r xr.cov() and x
+0000c3d0: 722e 636f 7272 2829 2073 6f20 6f6e 6c79  r.corr() so only
+0000c3e0: 2068 6176 6520 746f 0a20 2020 2073 616e   have to.    san
+0000c3f0: 6974 697a 6520 7468 6520 696e 7075 7420  itize the input 
+0000c400: 6172 7261 7973 206f 6e63 6520 616e 6420  arrays once and 
+0000c410: 7765 2064 6f6e 2774 2072 6570 6561 7420  we don't repeat 
+0000c420: 636f 6465 2e0a 2020 2020 2222 220a 2020  code..    """.  
+0000c430: 2020 2320 312e 2042 726f 6164 6361 7374    # 1. Broadcast
+0000c440: 2074 6865 2074 776f 2061 7272 6179 730a   the two arrays.
+0000c450: 2020 2020 6461 5f61 2c20 6461 5f62 203d      da_a, da_b =
+0000c460: 2061 6c69 676e 2864 615f 612c 2064 615f   align(da_a, da_
+0000c470: 622c 206a 6f69 6e3d 2269 6e6e 6572 222c  b, join="inner",
+0000c480: 2063 6f70 793d 4661 6c73 6529 0a0a 2020   copy=False)..  
+0000c490: 2020 2320 322e 2049 676e 6f72 6520 7468    # 2. Ignore th
+0000c4a0: 6520 6e61 6e73 0a20 2020 2076 616c 6964  e nans.    valid
+0000c4b0: 5f76 616c 7565 7320 3d20 6461 5f61 2e6e  _values = da_a.n
+0000c4c0: 6f74 6e75 6c6c 2829 2026 2064 615f 622e  otnull() & da_b.
+0000c4d0: 6e6f 746e 756c 6c28 290a 2020 2020 6461  notnull().    da
+0000c4e0: 5f61 203d 2064 615f 612e 7768 6572 6528  _a = da_a.where(
+0000c4f0: 7661 6c69 645f 7661 6c75 6573 290a 2020  valid_values).  
+0000c500: 2020 6461 5f62 203d 2064 615f 622e 7768    da_b = da_b.wh
+0000c510: 6572 6528 7661 6c69 645f 7661 6c75 6573  ere(valid_values
+0000c520: 290a 2020 2020 7661 6c69 645f 636f 756e  ).    valid_coun
+0000c530: 7420 3d20 7661 6c69 645f 7661 6c75 6573  t = valid_values
+0000c540: 2e73 756d 2864 696d 2920 2d20 6464 6f66  .sum(dim) - ddof
+0000c550: 0a0a 2020 2020 2320 332e 2044 6574 7265  ..    # 3. Detre
+0000c560: 6e64 2061 6c6f 6e67 2074 6865 2067 6976  nd along the giv
+0000c570: 656e 2064 696d 0a20 2020 2064 656d 6561  en dim.    demea
+0000c580: 6e65 645f 6461 5f61 203d 2064 615f 6120  ned_da_a = da_a 
+0000c590: 2d20 6461 5f61 2e6d 6561 6e28 6469 6d3d  - da_a.mean(dim=
+0000c5a0: 6469 6d29 0a20 2020 2064 656d 6561 6e65  dim).    demeane
+0000c5b0: 645f 6461 5f62 203d 2064 615f 6220 2d20  d_da_b = da_b - 
+0000c5c0: 6461 5f62 2e6d 6561 6e28 6469 6d3d 6469  da_b.mean(dim=di
+0000c5d0: 6d29 0a0a 2020 2020 2320 342e 2043 6f6d  m)..    # 4. Com
+0000c5e0: 7075 7465 2063 6f76 6172 6961 6e63 6520  pute covariance 
+0000c5f0: 616c 6f6e 6720 7468 6520 6769 7665 6e20  along the given 
+0000c600: 6469 6d0a 2020 2020 2320 4e2e 422e 2060  dim.    # N.B. `
+0000c610: 736b 6970 6e61 3d54 7275 6560 2069 7320  skipna=True` is 
+0000c620: 7265 7175 6972 6564 206f 7220 6175 746f  required or auto
+0000c630: 2d63 6f76 6172 6961 6e63 6520 6973 2063  -covariance is c
+0000c640: 6f6d 7075 7465 6420 696e 636f 7272 6563  omputed incorrec
+0000c650: 746c 792e 2045 2e67 2e0a 2020 2020 2320  tly. E.g..    # 
+0000c660: 5472 7920 7872 2e63 6f76 2864 612c 6461  Try xr.cov(da,da
+0000c670: 2920 666f 7220 6461 203d 2078 722e 4461  ) for da = xr.Da
+0000c680: 7461 4172 7261 7928 5b5b 312c 2032 5d2c  taArray([[1, 2],
+0000c690: 205b 312c 206e 702e 6e61 6e5d 5d2c 2064   [1, np.nan]], d
+0000c6a0: 696d 733d 5b22 7822 2c20 2274 696d 6522  ims=["x", "time"
+0000c6b0: 5d29 0a20 2020 2063 6f76 203d 2028 6465  ]).    cov = (de
+0000c6c0: 6d65 616e 6564 5f64 615f 612e 636f 6e6a  meaned_da_a.conj
+0000c6d0: 2829 202a 2064 656d 6561 6e65 645f 6461  () * demeaned_da
+0000c6e0: 5f62 292e 7375 6d28 0a20 2020 2020 2020  _b).sum(.       
+0000c6f0: 2064 696d 3d64 696d 2c20 736b 6970 6e61   dim=dim, skipna
+0000c700: 3d54 7275 652c 206d 696e 5f63 6f75 6e74  =True, min_count
+0000c710: 3d31 0a20 2020 2029 202f 2028 7661 6c69  =1.    ) / (vali
+0000c720: 645f 636f 756e 7429 0a0a 2020 2020 6966  d_count)..    if
+0000c730: 206d 6574 686f 6420 3d3d 2022 636f 7622   method == "cov"
+0000c740: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000c750: 2063 6f76 2020 2320 7479 7065 3a20 6967   cov  # type: ig
+0000c760: 6e6f 7265 5b72 6574 7572 6e2d 7661 6c75  nore[return-valu
+0000c770: 655d 0a0a 2020 2020 656c 7365 3a0a 2020  e]..    else:.  
+0000c780: 2020 2020 2020 2320 636f 6d70 7574 6520        # compute 
+0000c790: 7374 6420 2b20 636f 7272 0a20 2020 2020  std + corr.     
+0000c7a0: 2020 2064 615f 615f 7374 6420 3d20 6461     da_a_std = da
+0000c7b0: 5f61 2e73 7464 2864 696d 3d64 696d 290a  _a.std(dim=dim).
+0000c7c0: 2020 2020 2020 2020 6461 5f62 5f73 7464          da_b_std
+0000c7d0: 203d 2064 615f 622e 7374 6428 6469 6d3d   = da_b.std(dim=
+0000c7e0: 6469 6d29 0a20 2020 2020 2020 2063 6f72  dim).        cor
+0000c7f0: 7220 3d20 636f 7620 2f20 2864 615f 615f  r = cov / (da_a_
+0000c800: 7374 6420 2a20 6461 5f62 5f73 7464 290a  std * da_b_std).
+0000c810: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0000c820: 6f72 7220 2023 2074 7970 653a 2069 676e  orr  # type: ign
+0000c830: 6f72 655b 7265 7475 726e 2d76 616c 7565  ore[return-value
+0000c840: 5d0a 0a0a 6465 6620 6372 6f73 7328 0a20  ]...def cross(. 
+0000c850: 2020 2061 3a20 4461 7461 4172 7261 7920     a: DataArray 
+0000c860: 7c20 5661 7269 6162 6c65 2c20 623a 2044  | Variable, b: D
+0000c870: 6174 6141 7272 6179 207c 2056 6172 6961  ataArray | Varia
+0000c880: 626c 652c 202a 2c20 6469 6d3a 2048 6173  ble, *, dim: Has
+0000c890: 6861 626c 650a 2920 2d3e 2044 6174 6141  hable.) -> DataA
+0000c8a0: 7272 6179 207c 2056 6172 6961 626c 653a  rray | Variable:
+0000c8b0: 0a20 2020 2022 2222 0a20 2020 2043 6f6d  .    """.    Com
+0000c8c0: 7075 7465 2074 6865 2063 726f 7373 2070  pute the cross p
+0000c8d0: 726f 6475 6374 206f 6620 7477 6f20 2861  roduct of two (a
+0000c8e0: 7272 6179 7320 6f66 2920 7665 6374 6f72  rrays of) vector
+0000c8f0: 732e 0a0a 2020 2020 5468 6520 6372 6f73  s...    The cros
+0000c900: 7320 7072 6f64 7563 7420 6f66 2060 6160  s product of `a`
+0000c910: 2061 6e64 2060 6260 2069 6e20 3a6d 6174   and `b` in :mat
+0000c920: 683a 6052 5e33 6020 6973 2061 2076 6563  h:`R^3` is a vec
+0000c930: 746f 720a 2020 2020 7065 7270 656e 6469  tor.    perpendi
+0000c940: 6375 6c61 7220 746f 2062 6f74 6820 6061  cular to both `a
+0000c950: 6020 616e 6420 6062 602e 2054 6865 2076  ` and `b`. The v
+0000c960: 6563 746f 7273 2069 6e20 6061 6020 616e  ectors in `a` an
+0000c970: 6420 6062 6020 6172 650a 2020 2020 6465  d `b` are.    de
+0000c980: 6669 6e65 6420 6279 2074 6865 2076 616c  fined by the val
+0000c990: 7565 7320 616c 6f6e 6720 7468 6520 6469  ues along the di
+0000c9a0: 6d65 6e73 696f 6e20 6064 696d 6020 616e  mension `dim` an
+0000c9b0: 6420 6361 6e20 6861 7665 2073 697a 6573  d can have sizes
+0000c9c0: 0a20 2020 2031 2c20 3220 6f72 2033 2e20  .    1, 2 or 3. 
+0000c9d0: 5768 6572 6520 7468 6520 7369 7a65 206f  Where the size o
+0000c9e0: 6620 6569 7468 6572 2060 6160 206f 7220  f either `a` or 
+0000c9f0: 6062 6020 6973 0a20 2020 2031 206f 7220  `b` is.    1 or 
+0000ca00: 322c 2074 6865 2072 656d 6169 6e69 6e67  2, the remaining
+0000ca10: 2063 6f6d 706f 6e65 6e74 7320 6f66 2074   components of t
+0000ca20: 6865 2069 6e70 7574 2076 6563 746f 7220  he input vector 
+0000ca30: 6973 2061 7373 756d 6564 2074 6f0a 2020  is assumed to.  
+0000ca40: 2020 6265 207a 6572 6f20 616e 6420 7468    be zero and th
+0000ca50: 6520 6372 6f73 7320 7072 6f64 7563 7420  e cross product 
+0000ca60: 6361 6c63 756c 6174 6564 2061 6363 6f72  calculated accor
+0000ca70: 6469 6e67 6c79 2e20 496e 2063 6173 6573  dingly. In cases
+0000ca80: 2077 6865 7265 0a20 2020 2062 6f74 6820   where.    both 
+0000ca90: 696e 7075 7420 7665 6374 6f72 7320 6861  input vectors ha
+0000caa0: 7665 2064 696d 656e 7369 6f6e 2032 2c20  ve dimension 2, 
+0000cab0: 7468 6520 7a2d 636f 6d70 6f6e 656e 7420  the z-component 
+0000cac0: 6f66 2074 6865 2063 726f 7373 0a20 2020  of the cross.   
+0000cad0: 2070 726f 6475 6374 2069 7320 7265 7475   product is retu
+0000cae0: 726e 6564 2e0a 0a20 2020 2050 6172 616d  rned...    Param
+0000caf0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+0000cb00: 2d2d 2d2d 0a20 2020 2061 2c20 6220 3a20  ----.    a, b : 
+0000cb10: 4461 7461 4172 7261 7920 6f72 2056 6172  DataArray or Var
+0000cb20: 6961 626c 650a 2020 2020 2020 2020 436f  iable.        Co
+0000cb30: 6d70 6f6e 656e 7473 206f 6620 7468 6520  mponents of the 
+0000cb40: 6669 7273 7420 616e 6420 7365 636f 6e64  first and second
+0000cb50: 2076 6563 746f 7228 7329 2e0a 2020 2020   vector(s)..    
+0000cb60: 6469 6d20 3a20 6861 7368 6162 6c65 0a20  dim : hashable. 
+0000cb70: 2020 2020 2020 2054 6865 2064 696d 656e         The dimen
+0000cb80: 7369 6f6e 2061 6c6f 6e67 2077 6869 6368  sion along which
+0000cb90: 2074 6865 2063 726f 7373 2070 726f 6475   the cross produ
+0000cba0: 6374 2077 696c 6c20 6265 2063 6f6d 7075  ct will be compu
+0000cbb0: 7465 642e 0a20 2020 2020 2020 204d 7573  ted..        Mus
+0000cbc0: 7420 6265 2061 7661 696c 6162 6c65 2069  t be available i
+0000cbd0: 6e20 626f 7468 2076 6563 746f 7273 2e0a  n both vectors..
+0000cbe0: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+0000cbf0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2056    --------.    V
+0000cc00: 6563 746f 7220 6372 6f73 732d 7072 6f64  ector cross-prod
+0000cc10: 7563 7420 7769 7468 2033 2064 696d 656e  uct with 3 dimen
+0000cc20: 7369 6f6e 733a 0a0a 2020 2020 3e3e 3e20  sions:..    >>> 
+0000cc30: 6120 3d20 7872 2e44 6174 6141 7272 6179  a = xr.DataArray
+0000cc40: 285b 312c 2032 2c20 335d 290a 2020 2020  ([1, 2, 3]).    
+0000cc50: 3e3e 3e20 6220 3d20 7872 2e44 6174 6141  >>> b = xr.DataA
+0000cc60: 7272 6179 285b 342c 2035 2c20 365d 290a  rray([4, 5, 6]).
+0000cc70: 2020 2020 3e3e 3e20 7872 2e63 726f 7373      >>> xr.cross
+0000cc80: 2861 2c20 622c 2064 696d 3d22 6469 6d5f  (a, b, dim="dim_
+0000cc90: 3022 290a 2020 2020 3c78 6172 7261 792e  0").    <xarray.
+0000cca0: 4461 7461 4172 7261 7920 2864 696d 5f30  DataArray (dim_0
+0000ccb0: 3a20 3329 3e0a 2020 2020 6172 7261 7928  : 3)>.    array(
+0000ccc0: 5b2d 332c 2020 362c 202d 335d 290a 2020  [-3,  6, -3]).  
+0000ccd0: 2020 4469 6d65 6e73 696f 6e73 2077 6974    Dimensions wit
+0000cce0: 686f 7574 2063 6f6f 7264 696e 6174 6573  hout coordinates
+0000ccf0: 3a20 6469 6d5f 300a 0a20 2020 2056 6563  : dim_0..    Vec
+0000cd00: 746f 7220 6372 6f73 732d 7072 6f64 7563  tor cross-produc
+0000cd10: 7420 7769 7468 2032 2064 696d 656e 7369  t with 2 dimensi
+0000cd20: 6f6e 732c 2072 6574 7572 6e73 2069 6e20  ons, returns in 
+0000cd30: 7468 6520 7065 7270 656e 6469 6375 6c61  the perpendicula
+0000cd40: 720a 2020 2020 6469 7265 6374 696f 6e3a  r.    direction:
+0000cd50: 0a0a 2020 2020 3e3e 3e20 6120 3d20 7872  ..    >>> a = xr
+0000cd60: 2e44 6174 6141 7272 6179 285b 312c 2032  .DataArray([1, 2
+0000cd70: 5d29 0a20 2020 203e 3e3e 2062 203d 2078  ]).    >>> b = x
+0000cd80: 722e 4461 7461 4172 7261 7928 5b34 2c20  r.DataArray([4, 
+0000cd90: 355d 290a 2020 2020 3e3e 3e20 7872 2e63  5]).    >>> xr.c
+0000cda0: 726f 7373 2861 2c20 622c 2064 696d 3d22  ross(a, b, dim="
+0000cdb0: 6469 6d5f 3022 290a 2020 2020 3c78 6172  dim_0").    <xar
+0000cdc0: 7261 792e 4461 7461 4172 7261 7920 2829  ray.DataArray ()
+0000cdd0: 3e0a 2020 2020 6172 7261 7928 2d33 290a  >.    array(-3).
+0000cde0: 0a20 2020 2056 6563 746f 7220 6372 6f73  .    Vector cros
+0000cdf0: 732d 7072 6f64 7563 7420 7769 7468 2033  s-product with 3
+0000ce00: 2064 696d 656e 7369 6f6e 7320 6275 7420   dimensions but 
+0000ce10: 7a65 726f 7320 6174 2074 6865 206c 6173  zeros at the las
+0000ce20: 7420 6178 6973 0a20 2020 2079 6965 6c64  t axis.    yield
+0000ce30: 7320 7468 6520 7361 6d65 2072 6573 756c  s the same resul
+0000ce40: 7473 2061 7320 7769 7468 2032 2064 696d  ts as with 2 dim
+0000ce50: 656e 7369 6f6e 733a 0a0a 2020 2020 3e3e  ensions:..    >>
+0000ce60: 3e20 6120 3d20 7872 2e44 6174 6141 7272  > a = xr.DataArr
+0000ce70: 6179 285b 312c 2032 2c20 305d 290a 2020  ay([1, 2, 0]).  
+0000ce80: 2020 3e3e 3e20 6220 3d20 7872 2e44 6174    >>> b = xr.Dat
+0000ce90: 6141 7272 6179 285b 342c 2035 2c20 305d  aArray([4, 5, 0]
+0000cea0: 290a 2020 2020 3e3e 3e20 7872 2e63 726f  ).    >>> xr.cro
+0000ceb0: 7373 2861 2c20 622c 2064 696d 3d22 6469  ss(a, b, dim="di
+0000cec0: 6d5f 3022 290a 2020 2020 3c78 6172 7261  m_0").    <xarra
+0000ced0: 792e 4461 7461 4172 7261 7920 2864 696d  y.DataArray (dim
+0000cee0: 5f30 3a20 3329 3e0a 2020 2020 6172 7261  _0: 3)>.    arra
+0000cef0: 7928 5b20 302c 2020 302c 202d 335d 290a  y([ 0,  0, -3]).
+0000cf00: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
+0000cf10: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
+0000cf20: 6573 3a20 6469 6d5f 300a 0a20 2020 204f  es: dim_0..    O
+0000cf30: 6e65 2076 6563 746f 7220 7769 7468 2064  ne vector with d
+0000cf40: 696d 656e 7369 6f6e 2032 3a0a 0a20 2020  imension 2:..   
+0000cf50: 203e 3e3e 2061 203d 2078 722e 4461 7461   >>> a = xr.Data
+0000cf60: 4172 7261 7928 0a20 2020 202e 2e2e 2020  Array(.    ...  
+0000cf70: 2020 205b 312c 2032 5d2c 0a20 2020 202e     [1, 2],.    .
+0000cf80: 2e2e 2020 2020 2064 696d 733d 5b22 6361  ..     dims=["ca
+0000cf90: 7274 6573 6961 6e22 5d2c 0a20 2020 202e  rtesian"],.    .
+0000cfa0: 2e2e 2020 2020 2063 6f6f 7264 733d 6469  ..     coords=di
+0000cfb0: 6374 2863 6172 7465 7369 616e 3d28 5b22  ct(cartesian=(["
+0000cfc0: 6361 7274 6573 6961 6e22 5d2c 205b 2278  cartesian"], ["x
+0000cfd0: 222c 2022 7922 5d29 292c 0a20 2020 202e  ", "y"])),.    .
+0000cfe0: 2e2e 2029 0a20 2020 203e 3e3e 2062 203d  .. ).    >>> b =
+0000cff0: 2078 722e 4461 7461 4172 7261 7928 0a20   xr.DataArray(. 
+0000d000: 2020 202e 2e2e 2020 2020 205b 342c 2035     ...     [4, 5
+0000d010: 2c20 365d 2c0a 2020 2020 2e2e 2e20 2020  , 6],.    ...   
+0000d020: 2020 6469 6d73 3d5b 2263 6172 7465 7369    dims=["cartesi
+0000d030: 616e 225d 2c0a 2020 2020 2e2e 2e20 2020  an"],.    ...   
+0000d040: 2020 636f 6f72 6473 3d64 6963 7428 6361    coords=dict(ca
+0000d050: 7274 6573 6961 6e3d 285b 2263 6172 7465  rtesian=(["carte
+0000d060: 7369 616e 225d 2c20 5b22 7822 2c20 2279  sian"], ["x", "y
+0000d070: 222c 2022 7a22 5d29 292c 0a20 2020 202e  ", "z"])),.    .
+0000d080: 2e2e 2029 0a20 2020 203e 3e3e 2078 722e  .. ).    >>> xr.
+0000d090: 6372 6f73 7328 612c 2062 2c20 6469 6d3d  cross(a, b, dim=
+0000d0a0: 2263 6172 7465 7369 616e 2229 0a20 2020  "cartesian").   
+0000d0b0: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
+0000d0c0: 6179 2028 6361 7274 6573 6961 6e3a 2033  ay (cartesian: 3
+0000d0d0: 293e 0a20 2020 2061 7272 6179 285b 3132  )>.    array([12
+0000d0e0: 2c20 2d36 2c20 2d33 5d29 0a20 2020 2043  , -6, -3]).    C
+0000d0f0: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+0000d100: 2020 2a20 6361 7274 6573 6961 6e20 2028    * cartesian  (
+0000d110: 6361 7274 6573 6961 6e29 203c 5531 2027  cartesian) <U1 '
+0000d120: 7827 2027 7927 2027 7a27 0a0a 2020 2020  x' 'y' 'z'..    
+0000d130: 4f6e 6520 7665 6374 6f72 2077 6974 6820  One vector with 
+0000d140: 6469 6d65 6e73 696f 6e20 3220 6275 7420  dimension 2 but 
+0000d150: 636f 6f72 6473 2069 6e20 6f74 6865 7220  coords in other 
+0000d160: 706f 7369 7469 6f6e 733a 0a0a 2020 2020  positions:..    
+0000d170: 3e3e 3e20 6120 3d20 7872 2e44 6174 6141  >>> a = xr.DataA
+0000d180: 7272 6179 280a 2020 2020 2e2e 2e20 2020  rray(.    ...   
+0000d190: 2020 5b31 2c20 325d 2c0a 2020 2020 2e2e    [1, 2],.    ..
+0000d1a0: 2e20 2020 2020 6469 6d73 3d5b 2263 6172  .     dims=["car
+0000d1b0: 7465 7369 616e 225d 2c0a 2020 2020 2e2e  tesian"],.    ..
+0000d1c0: 2e20 2020 2020 636f 6f72 6473 3d64 6963  .     coords=dic
+0000d1d0: 7428 6361 7274 6573 6961 6e3d 285b 2263  t(cartesian=(["c
+0000d1e0: 6172 7465 7369 616e 225d 2c20 5b22 7822  artesian"], ["x"
+0000d1f0: 2c20 227a 225d 2929 2c0a 2020 2020 2e2e  , "z"])),.    ..
+0000d200: 2e20 290a 2020 2020 3e3e 3e20 6220 3d20  . ).    >>> b = 
+0000d210: 7872 2e44 6174 6141 7272 6179 280a 2020  xr.DataArray(.  
+0000d220: 2020 2e2e 2e20 2020 2020 5b34 2c20 352c    ...     [4, 5,
+0000d230: 2036 5d2c 0a20 2020 202e 2e2e 2020 2020   6],.    ...    
+0000d240: 2064 696d 733d 5b22 6361 7274 6573 6961   dims=["cartesia
+0000d250: 6e22 5d2c 0a20 2020 202e 2e2e 2020 2020  n"],.    ...    
+0000d260: 2063 6f6f 7264 733d 6469 6374 2863 6172   coords=dict(car
+0000d270: 7465 7369 616e 3d28 5b22 6361 7274 6573  tesian=(["cartes
+0000d280: 6961 6e22 5d2c 205b 2278 222c 2022 7922  ian"], ["x", "y"
+0000d290: 2c20 227a 225d 2929 2c0a 2020 2020 2e2e  , "z"])),.    ..
+0000d2a0: 2e20 290a 2020 2020 3e3e 3e20 7872 2e63  . ).    >>> xr.c
+0000d2b0: 726f 7373 2861 2c20 622c 2064 696d 3d22  ross(a, b, dim="
+0000d2c0: 6361 7274 6573 6961 6e22 290a 2020 2020  cartesian").    
+0000d2d0: 3c78 6172 7261 792e 4461 7461 4172 7261  <xarray.DataArra
+0000d2e0: 7920 2863 6172 7465 7369 616e 3a20 3329  y (cartesian: 3)
+0000d2f0: 3e0a 2020 2020 6172 7261 7928 5b2d 3130  >.    array([-10
+0000d300: 2c20 2020 322c 2020 2035 5d29 0a20 2020  ,   2,   5]).   
+0000d310: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+0000d320: 2020 2020 2a20 6361 7274 6573 6961 6e20      * cartesian 
+0000d330: 2028 6361 7274 6573 6961 6e29 203c 5531   (cartesian) <U1
+0000d340: 2027 7827 2027 7927 2027 7a27 0a0a 2020   'x' 'y' 'z'..  
+0000d350: 2020 4d75 6c74 6970 6c65 2076 6563 746f    Multiple vecto
+0000d360: 7220 6372 6f73 732d 7072 6f64 7563 7473  r cross-products
+0000d370: 2e20 4e6f 7465 2074 6861 7420 7468 6520  . Note that the 
+0000d380: 6469 7265 6374 696f 6e20 6f66 2074 6865  direction of the
+0000d390: 0a20 2020 2063 726f 7373 2070 726f 6475  .    cross produ
+0000d3a0: 6374 2076 6563 746f 7220 6973 2064 6566  ct vector is def
+0000d3b0: 696e 6564 2062 7920 7468 6520 7269 6768  ined by the righ
+0000d3c0: 742d 6861 6e64 2072 756c 653a 0a0a 2020  t-hand rule:..  
+0000d3d0: 2020 3e3e 3e20 6120 3d20 7872 2e44 6174    >>> a = xr.Dat
+0000d3e0: 6141 7272 6179 280a 2020 2020 2e2e 2e20  aArray(.    ... 
+0000d3f0: 2020 2020 5b5b 312c 2032 2c20 335d 2c20      [[1, 2, 3], 
+0000d400: 5b34 2c20 352c 2036 5d5d 2c0a 2020 2020  [4, 5, 6]],.    
+0000d410: 2e2e 2e20 2020 2020 6469 6d73 3d28 2274  ...     dims=("t
+0000d420: 696d 6522 2c20 2263 6172 7465 7369 616e  ime", "cartesian
+0000d430: 2229 2c0a 2020 2020 2e2e 2e20 2020 2020  "),.    ...     
+0000d440: 636f 6f72 6473 3d64 6963 7428 0a20 2020  coords=dict(.   
+0000d450: 202e 2e2e 2020 2020 2020 2020 2074 696d   ...         tim
+0000d460: 653d 285b 2274 696d 6522 5d2c 205b 302c  e=(["time"], [0,
+0000d470: 2031 5d29 2c0a 2020 2020 2e2e 2e20 2020   1]),.    ...   
+0000d480: 2020 2020 2020 6361 7274 6573 6961 6e3d        cartesian=
+0000d490: 285b 2263 6172 7465 7369 616e 225d 2c20  (["cartesian"], 
+0000d4a0: 5b22 7822 2c20 2279 222c 2022 7a22 5d29  ["x", "y", "z"])
+0000d4b0: 2c0a 2020 2020 2e2e 2e20 2020 2020 292c  ,.    ...     ),
+0000d4c0: 0a20 2020 202e 2e2e 2029 0a20 2020 203e  .    ... ).    >
+0000d4d0: 3e3e 2062 203d 2078 722e 4461 7461 4172  >> b = xr.DataAr
+0000d4e0: 7261 7928 0a20 2020 202e 2e2e 2020 2020  ray(.    ...    
+0000d4f0: 205b 5b34 2c20 352c 2036 5d2c 205b 312c   [[4, 5, 6], [1,
+0000d500: 2032 2c20 335d 5d2c 0a20 2020 202e 2e2e   2, 3]],.    ...
+0000d510: 2020 2020 2064 696d 733d 2822 7469 6d65       dims=("time
+0000d520: 222c 2022 6361 7274 6573 6961 6e22 292c  ", "cartesian"),
+0000d530: 0a20 2020 202e 2e2e 2020 2020 2063 6f6f  .    ...     coo
+0000d540: 7264 733d 6469 6374 280a 2020 2020 2e2e  rds=dict(.    ..
+0000d550: 2e20 2020 2020 2020 2020 7469 6d65 3d28  .         time=(
+0000d560: 5b22 7469 6d65 225d 2c20 5b30 2c20 315d  ["time"], [0, 1]
+0000d570: 292c 0a20 2020 202e 2e2e 2020 2020 2020  ),.    ...      
+0000d580: 2020 2063 6172 7465 7369 616e 3d28 5b22     cartesian=(["
+0000d590: 6361 7274 6573 6961 6e22 5d2c 205b 2278  cartesian"], ["x
+0000d5a0: 222c 2022 7922 2c20 227a 225d 292c 0a20  ", "y", "z"]),. 
+0000d5b0: 2020 202e 2e2e 2020 2020 2029 2c0a 2020     ...     ),.  
+0000d5c0: 2020 2e2e 2e20 290a 2020 2020 3e3e 3e20    ... ).    >>> 
+0000d5d0: 7872 2e63 726f 7373 2861 2c20 622c 2064  xr.cross(a, b, d
+0000d5e0: 696d 3d22 6361 7274 6573 6961 6e22 290a  im="cartesian").
+0000d5f0: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+0000d600: 4172 7261 7920 2874 696d 653a 2032 2c20  Array (time: 2, 
+0000d610: 6361 7274 6573 6961 6e3a 2033 293e 0a20  cartesian: 3)>. 
+0000d620: 2020 2061 7272 6179 285b 5b2d 332c 2020     array([[-3,  
+0000d630: 362c 202d 335d 2c0a 2020 2020 2020 2020  6, -3],.        
+0000d640: 2020 205b 2033 2c20 2d36 2c20 2033 5d5d     [ 3, -6,  3]]
+0000d650: 290a 2020 2020 436f 6f72 6469 6e61 7465  ).    Coordinate
+0000d660: 733a 0a20 2020 2020 202a 2074 696d 6520  s:.      * time 
+0000d670: 2020 2020 2020 2874 696d 6529 2069 6e74        (time) int
+0000d680: 3634 2030 2031 0a20 2020 2020 202a 2063  64 0 1.      * c
+0000d690: 6172 7465 7369 616e 2020 2863 6172 7465  artesian  (carte
+0000d6a0: 7369 616e 2920 3c55 3120 2778 2720 2779  sian) <U1 'x' 'y
+0000d6b0: 2720 277a 270a 0a20 2020 2043 726f 7373  ' 'z'..    Cross
+0000d6c0: 2063 616e 2062 6520 6361 6c6c 6564 206f   can be called o
+0000d6d0: 6e20 4461 7461 7365 7473 2062 7920 636f  n Datasets by co
+0000d6e0: 6e76 6572 7469 6e67 2074 6f20 4461 7461  nverting to Data
+0000d6f0: 4172 7261 7973 2061 6e64 206c 6174 6572  Arrays and later
+0000d700: 0a20 2020 2062 6163 6b20 746f 2061 2044  .    back to a D
+0000d710: 6174 6173 6574 3a0a 0a20 2020 203e 3e3e  ataset:..    >>>
+0000d720: 2064 735f 6120 3d20 7872 2e44 6174 6173   ds_a = xr.Datas
+0000d730: 6574 2864 6963 7428 783d 2822 6469 6d5f  et(dict(x=("dim_
+0000d740: 3022 2c20 5b31 5d29 2c20 793d 2822 6469  0", [1]), y=("di
+0000d750: 6d5f 3022 2c20 5b32 5d29 2c20 7a3d 2822  m_0", [2]), z=("
+0000d760: 6469 6d5f 3022 2c20 5b33 5d29 2929 0a20  dim_0", [3]))). 
+0000d770: 2020 203e 3e3e 2064 735f 6220 3d20 7872     >>> ds_b = xr
+0000d780: 2e44 6174 6173 6574 2864 6963 7428 783d  .Dataset(dict(x=
+0000d790: 2822 6469 6d5f 3022 2c20 5b34 5d29 2c20  ("dim_0", [4]), 
+0000d7a0: 793d 2822 6469 6d5f 3022 2c20 5b35 5d29  y=("dim_0", [5])
+0000d7b0: 2c20 7a3d 2822 6469 6d5f 3022 2c20 5b36  , z=("dim_0", [6
+0000d7c0: 5d29 2929 0a20 2020 203e 3e3e 2063 203d  ]))).    >>> c =
+0000d7d0: 2078 722e 6372 6f73 7328 0a20 2020 202e   xr.cross(.    .
+0000d7e0: 2e2e 2020 2020 2064 735f 612e 746f 5f61  ..     ds_a.to_a
+0000d7f0: 7272 6179 2822 6361 7274 6573 6961 6e22  rray("cartesian"
+0000d800: 292c 2064 735f 622e 746f 5f61 7272 6179  ), ds_b.to_array
+0000d810: 2822 6361 7274 6573 6961 6e22 292c 2064  ("cartesian"), d
+0000d820: 696d 3d22 6361 7274 6573 6961 6e22 0a20  im="cartesian". 
+0000d830: 2020 202e 2e2e 2029 0a20 2020 203e 3e3e     ... ).    >>>
+0000d840: 2063 2e74 6f5f 6461 7461 7365 7428 6469   c.to_dataset(di
+0000d850: 6d3d 2263 6172 7465 7369 616e 2229 0a20  m="cartesian"). 
+0000d860: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+0000d870: 6574 3e0a 2020 2020 4469 6d65 6e73 696f  et>.    Dimensio
+0000d880: 6e73 3a20 2028 6469 6d5f 303a 2031 290a  ns:  (dim_0: 1).
+0000d890: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
+0000d8a0: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
+0000d8b0: 6573 3a20 6469 6d5f 300a 2020 2020 4461  es: dim_0.    Da
+0000d8c0: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+0000d8d0: 2020 2020 2020 7820 2020 2020 2020 2028        x        (
+0000d8e0: 6469 6d5f 3029 2069 6e74 3634 202d 330a  dim_0) int64 -3.
+0000d8f0: 2020 2020 2020 2020 7920 2020 2020 2020          y       
+0000d900: 2028 6469 6d5f 3029 2069 6e74 3634 2036   (dim_0) int64 6
+0000d910: 0a20 2020 2020 2020 207a 2020 2020 2020  .        z      
+0000d920: 2020 2864 696d 5f30 2920 696e 7436 3420    (dim_0) int64 
+0000d930: 2d33 0a0a 2020 2020 5365 6520 416c 736f  -3..    See Also
+0000d940: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+0000d950: 2020 6e75 6d70 792e 6372 6f73 7320 3a20    numpy.cross : 
+0000d960: 436f 7272 6573 706f 6e64 696e 6720 6e75  Corresponding nu
+0000d970: 6d70 7920 6675 6e63 7469 6f6e 0a20 2020  mpy function.   
+0000d980: 2022 2222 0a0a 2020 2020 6966 2064 696d   """..    if dim
+0000d990: 206e 6f74 2069 6e20 612e 6469 6d73 3a0a   not in a.dims:.
+0000d9a0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000d9b0: 6c75 6545 7272 6f72 2866 2244 696d 656e  lueError(f"Dimen
+0000d9c0: 7369 6f6e 207b 6469 6d21 727d 206e 6f74  sion {dim!r} not
+0000d9d0: 206f 6e20 6122 290a 2020 2020 656c 6966   on a").    elif
+0000d9e0: 2064 696d 206e 6f74 2069 6e20 622e 6469   dim not in b.di
+0000d9f0: 6d73 3a0a 2020 2020 2020 2020 7261 6973  ms:.        rais
+0000da00: 6520 5661 6c75 6545 7272 6f72 2866 2244  e ValueError(f"D
+0000da10: 696d 656e 7369 6f6e 207b 6469 6d21 727d  imension {dim!r}
+0000da20: 206e 6f74 206f 6e20 6222 290a 0a20 2020   not on b")..   
+0000da30: 2069 6620 6e6f 7420 3120 3c3d 2061 2e73   if not 1 <= a.s
+0000da40: 697a 6573 5b64 696d 5d20 3c3d 2033 3a0a  izes[dim] <= 3:.
+0000da50: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000da60: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+0000da70: 2020 2020 2020 6622 5468 6520 7369 7a65        f"The size
+0000da80: 206f 6620 7b64 696d 2172 7d20 6f6e 2061   of {dim!r} on a
+0000da90: 206d 7573 7420 6265 2031 2c20 322c 206f   must be 1, 2, o
+0000daa0: 7220 3320 746f 2062 6520 220a 2020 2020  r 3 to be ".    
+0000dab0: 2020 2020 2020 2020 6622 636f 6d70 6174          f"compat
+0000dac0: 6962 6c65 2077 6974 6820 6120 6372 6f73  ible with a cros
+0000dad0: 7320 7072 6f64 7563 7420 6275 7420 6973  s product but is
+0000dae0: 207b 612e 7369 7a65 735b 6469 6d5d 7d22   {a.sizes[dim]}"
+0000daf0: 0a20 2020 2020 2020 2029 0a20 2020 2065  .        ).    e
+0000db00: 6c69 6620 6e6f 7420 3120 3c3d 2062 2e73  lif not 1 <= b.s
+0000db10: 697a 6573 5b64 696d 5d20 3c3d 2033 3a0a  izes[dim] <= 3:.
+0000db20: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000db30: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+0000db40: 2020 2020 2020 6622 5468 6520 7369 7a65        f"The size
+0000db50: 206f 6620 7b64 696d 2172 7d20 6f6e 2062   of {dim!r} on b
+0000db60: 206d 7573 7420 6265 2031 2c20 322c 206f   must be 1, 2, o
+0000db70: 7220 3320 746f 2062 6520 220a 2020 2020  r 3 to be ".    
+0000db80: 2020 2020 2020 2020 6622 636f 6d70 6174          f"compat
+0000db90: 6962 6c65 2077 6974 6820 6120 6372 6f73  ible with a cros
+0000dba0: 7320 7072 6f64 7563 7420 6275 7420 6973  s product but is
+0000dbb0: 207b 622e 7369 7a65 735b 6469 6d5d 7d22   {b.sizes[dim]}"
+0000dbc0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000dbd0: 616c 6c5f 6469 6d73 203d 206c 6973 7428  all_dims = list(
+0000dbe0: 6469 6374 2e66 726f 6d6b 6579 7328 612e  dict.fromkeys(a.
+0000dbf0: 6469 6d73 202b 2062 2e64 696d 7329 290a  dims + b.dims)).
+0000dc00: 0a20 2020 2069 6620 612e 7369 7a65 735b  .    if a.sizes[
+0000dc10: 6469 6d5d 2021 3d20 622e 7369 7a65 735b  dim] != b.sizes[
+0000dc20: 6469 6d5d 3a0a 2020 2020 2020 2020 2320  dim]:.        # 
+0000dc30: 4172 7261 7973 2068 6176 6520 6469 6666  Arrays have diff
+0000dc40: 6572 656e 7420 7369 7a65 732e 2041 7070  erent sizes. App
+0000dc50: 656e 6420 7a65 726f 7320 7768 6572 6520  end zeros where 
+0000dc60: 7468 6520 736d 616c 6c65 720a 2020 2020  the smaller.    
+0000dc70: 2020 2020 2320 6172 7261 7920 6973 206d      # array is m
+0000dc80: 6973 7369 6e67 2061 2076 616c 7565 2c20  issing a value, 
+0000dc90: 7a65 726f 7320 7769 6c6c 206e 6f74 2061  zeros will not a
+0000dca0: 6666 6563 7420 6e70 2e63 726f 7373 3a0a  ffect np.cross:.
+0000dcb0: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
+0000dcc0: 2020 2020 2020 2020 2020 6e6f 7420 6973            not is
+0000dcd0: 696e 7374 616e 6365 2861 2c20 5661 7269  instance(a, Vari
+0000dce0: 6162 6c65 2920 2023 204f 6e6c 7920 7573  able)  # Only us
+0000dcf0: 6564 2074 6f20 6d61 6b65 206d 7970 7920  ed to make mypy 
+0000dd00: 6861 7070 792e 0a20 2020 2020 2020 2020  happy..         
+0000dd10: 2020 2061 6e64 2064 696d 2069 6e20 6765     and dim in ge
+0000dd20: 7461 7474 7228 612c 2022 636f 6f72 6473  tattr(a, "coords
+0000dd30: 222c 207b 7d29 0a20 2020 2020 2020 2020  ", {}).         
+0000dd40: 2020 2061 6e64 206e 6f74 2069 7369 6e73     and not isins
+0000dd50: 7461 6e63 6528 622c 2056 6172 6961 626c  tance(b, Variabl
+0000dd60: 6529 2020 2320 4f6e 6c79 2075 7365 6420  e)  # Only used 
+0000dd70: 746f 206d 616b 6520 6d79 7079 2068 6170  to make mypy hap
+0000dd80: 7079 2e0a 2020 2020 2020 2020 2020 2020  py..            
+0000dd90: 616e 6420 6469 6d20 696e 2067 6574 6174  and dim in getat
+0000dda0: 7472 2862 2c20 2263 6f6f 7264 7322 2c20  tr(b, "coords", 
+0000ddb0: 7b7d 290a 2020 2020 2020 2020 293a 0a20  {}).        ):. 
+0000ddc0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0000ddd0: 7468 6520 6172 7261 7973 2068 6176 6520  the arrays have 
+0000dde0: 636f 6f72 6473 2077 6520 6b6e 6f77 2077  coords we know w
+0000ddf0: 6869 6368 2069 6e64 6578 6573 2074 6f20  hich indexes to 
+0000de00: 6669 6c6c 0a20 2020 2020 2020 2020 2020  fill.           
+0000de10: 2023 2077 6974 6820 7a65 726f 733a 0a20   # with zeros:. 
+0000de20: 2020 2020 2020 2020 2020 2061 2c20 6220             a, b 
+0000de30: 3d20 616c 6967 6e28 0a20 2020 2020 2020  = align(.       
+0000de40: 2020 2020 2020 2020 2061 2c0a 2020 2020           a,.    
+0000de50: 2020 2020 2020 2020 2020 2020 622c 0a20              b,. 
+0000de60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000de70: 696c 6c5f 7661 6c75 653d 302c 0a20 2020  ill_value=0,.   
+0000de80: 2020 2020 2020 2020 2020 2020 206a 6f69               joi
+0000de90: 6e3d 226f 7574 6572 222c 0a20 2020 2020  n="outer",.     
+0000dea0: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+0000deb0: 6465 3d73 6574 2861 6c6c 5f64 696d 7329  de=set(all_dims)
+0000dec0: 202d 207b 6469 6d7d 2c0a 2020 2020 2020   - {dim},.      
+0000ded0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000dee0: 656c 6966 206d 696e 2861 2e73 697a 6573  elif min(a.sizes
+0000def0: 5b64 696d 5d2c 2062 2e73 697a 6573 5b64  [dim], b.sizes[d
+0000df00: 696d 5d29 203d 3d20 323a 0a20 2020 2020  im]) == 2:.     
+0000df10: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+0000df20: 6172 7261 7920 646f 6573 6e27 7420 6861  array doesn't ha
+0000df30: 7665 2063 6f6f 7264 7320 7765 2063 616e  ve coords we can
+0000df40: 206f 6e6c 7920 696e 6665 720a 2020 2020   only infer.    
+0000df50: 2020 2020 2020 2020 2320 7468 6174 2069          # that i
+0000df60: 7420 6861 7320 636f 6d70 6f73 6974 6520  t has composite 
+0000df70: 7661 6c75 6573 2069 6620 7468 6520 7369  values if the si
+0000df80: 7a65 2069 7320 6174 206c 6561 7374 2032  ze is at least 2
+0000df90: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000dfa0: 4f6e 6365 2070 6164 6465 642c 2072 6563  Once padded, rec
+0000dfb0: 6875 6e6b 2074 6865 2070 6164 6465 6420  hunk the padded 
+0000dfc0: 6172 7261 7920 6265 6361 7573 6520 6170  array because ap
+0000dfd0: 706c 795f 7566 756e 630a 2020 2020 2020  ply_ufunc.      
+0000dfe0: 2020 2020 2020 2320 7265 7175 6972 6573        # requires
+0000dff0: 2063 6f72 6520 6469 6d65 6e73 696f 6e73   core dimensions
+0000e000: 206e 6f74 2074 6f20 6265 2063 6875 6e6b   not to be chunk
+0000e010: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+0000e020: 6966 2061 2e73 697a 6573 5b64 696d 5d20  if a.sizes[dim] 
+0000e030: 3c20 622e 7369 7a65 735b 6469 6d5d 3a0a  < b.sizes[dim]:.
+0000e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e050: 6120 3d20 612e 7061 6428 7b64 696d 3a20  a = a.pad({dim: 
+0000e060: 2830 2c20 3129 7d2c 2063 6f6e 7374 616e  (0, 1)}, constan
+0000e070: 745f 7661 6c75 6573 3d30 290a 2020 2020  t_values=0).    
+0000e080: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
+0000e090: 444f 3a20 5368 6f75 6c64 2070 6164 206f  DO: Should pad o
+0000e0a0: 7220 6170 706c 795f 7566 756e 6320 6861  r apply_ufunc ha
+0000e0b0: 6e64 6c65 2063 6f72 7265 6374 2063 6875  ndle correct chu
+0000e0c0: 6e6b 696e 673f 0a20 2020 2020 2020 2020  nking?.         
+0000e0d0: 2020 2020 2020 2061 203d 2061 2e63 6875         a = a.chu
+0000e0e0: 6e6b 287b 6469 6d3a 202d 317d 2920 6966  nk({dim: -1}) if
+0000e0f0: 2069 735f 6475 636b 5f64 6173 6b5f 6172   is_duck_dask_ar
+0000e100: 7261 7928 612e 6461 7461 2920 656c 7365  ray(a.data) else
+0000e110: 2061 0a20 2020 2020 2020 2020 2020 2065   a.            e
+0000e120: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000e130: 2020 2020 2062 203d 2062 2e70 6164 287b       b = b.pad({
+0000e140: 6469 6d3a 2028 302c 2031 297d 2c20 636f  dim: (0, 1)}, co
+0000e150: 6e73 7461 6e74 5f76 616c 7565 733d 3029  nstant_values=0)
+0000e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e170: 2023 2054 4f44 4f3a 2053 686f 756c 6420   # TODO: Should 
+0000e180: 7061 6420 6f72 2061 7070 6c79 5f75 6675  pad or apply_ufu
+0000e190: 6e63 2068 616e 646c 6520 636f 7272 6563  nc handle correc
+0000e1a0: 7420 6368 756e 6b69 6e67 3f0a 2020 2020  t chunking?.    
+0000e1b0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+0000e1c0: 622e 6368 756e 6b28 7b64 696d 3a20 2d31  b.chunk({dim: -1
+0000e1d0: 7d29 2069 6620 6973 5f64 7563 6b5f 6461  }) if is_duck_da
+0000e1e0: 736b 5f61 7272 6179 2862 2e64 6174 6129  sk_array(b.data)
+0000e1f0: 2065 6c73 6520 620a 2020 2020 2020 2020   else b.        
+0000e200: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000e210: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000e220: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000e230: 2020 2020 6622 7b64 696d 2172 7d20 6f6e      f"{dim!r} on
+0000e240: 207b 2761 2720 6966 2061 2e73 697a 6573   {'a' if a.sizes
+0000e250: 5b64 696d 5d20 3d3d 2031 2065 6c73 6520  [dim] == 1 else 
+0000e260: 2762 277d 2069 7320 696e 636f 6d70 6174  'b'} is incompat
+0000e270: 6962 6c65 3a22 0a20 2020 2020 2020 2020  ible:".         
+0000e280: 2020 2020 2020 2022 2064 696d 656e 7369         " dimensi
+0000e290: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
+0000e2a0: 6469 6e61 7465 7320 6d75 7374 2068 6176  dinates must hav
+0000e2b0: 6520 6861 7665 2061 206c 656e 6774 6820  e have a length 
+0000e2c0: 6f66 2032 206f 7220 3322 0a20 2020 2020  of 2 or 3".     
+0000e2d0: 2020 2020 2020 2029 0a0a 2020 2020 6320         )..    c 
+0000e2e0: 3d20 6170 706c 795f 7566 756e 6328 0a20  = apply_ufunc(. 
+0000e2f0: 2020 2020 2020 206e 702e 6372 6f73 732c         np.cross,
+0000e300: 0a20 2020 2020 2020 2061 2c0a 2020 2020  .        a,.    
+0000e310: 2020 2020 622c 0a20 2020 2020 2020 2069      b,.        i
+0000e320: 6e70 7574 5f63 6f72 655f 6469 6d73 3d5b  nput_core_dims=[
+0000e330: 5b64 696d 5d2c 205b 6469 6d5d 5d2c 0a20  [dim], [dim]],. 
+0000e340: 2020 2020 2020 206f 7574 7075 745f 636f         output_co
+0000e350: 7265 5f64 696d 733d 5b5b 6469 6d5d 2069  re_dims=[[dim] i
+0000e360: 6620 612e 7369 7a65 735b 6469 6d5d 203d  f a.sizes[dim] =
+0000e370: 3d20 3320 656c 7365 205b 5d5d 2c0a 2020  = 3 else []],.  
+0000e380: 2020 2020 2020 6461 736b 3d22 7061 7261        dask="para
+0000e390: 6c6c 656c 697a 6564 222c 0a20 2020 2020  llelized",.     
+0000e3a0: 2020 206f 7574 7075 745f 6474 7970 6573     output_dtypes
+0000e3b0: 3d5b 6e70 2e72 6573 756c 745f 7479 7065  =[np.result_type
+0000e3c0: 2861 2c20 6229 5d2c 0a20 2020 2029 0a20  (a, b)],.    ). 
+0000e3d0: 2020 2063 203d 2063 2e74 7261 6e73 706f     c = c.transpo
+0000e3e0: 7365 282a 616c 6c5f 6469 6d73 2c20 6d69  se(*all_dims, mi
+0000e3f0: 7373 696e 675f 6469 6d73 3d22 6967 6e6f  ssing_dims="igno
+0000e400: 7265 2229 0a0a 2020 2020 7265 7475 726e  re")..    return
+0000e410: 2063 0a0a 0a64 6566 2064 6f74 280a 2020   c...def dot(.  
+0000e420: 2020 2a61 7272 6179 732c 0a20 2020 2064    *arrays,.    d
+0000e430: 696d 733a 2044 696d 7320 3d20 4e6f 6e65  ims: Dims = None
+0000e440: 2c0a 2020 2020 2a2a 6b77 6172 6773 3a20  ,.    **kwargs: 
+0000e450: 416e 792c 0a29 3a0a 2020 2020 2222 2247  Any,.):.    """G
+0000e460: 656e 6572 616c 697a 6564 2064 6f74 2070  eneralized dot p
+0000e470: 726f 6475 6374 2066 6f72 2078 6172 7261  roduct for xarra
+0000e480: 7920 6f62 6a65 6374 732e 204c 696b 6520  y objects. Like 
+0000e490: 6e70 2e65 696e 7375 6d2c 2062 7574 0a20  np.einsum, but. 
+0000e4a0: 2020 2070 726f 7669 6465 7320 6120 7369     provides a si
+0000e4b0: 6d70 6c65 7220 696e 7465 7266 6163 6520  mpler interface 
+0000e4c0: 6261 7365 6420 6f6e 2061 7272 6179 2064  based on array d
+0000e4d0: 696d 656e 7369 6f6e 732e 0a0a 2020 2020  imensions...    
+0000e4e0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+0000e4f0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2a61  ---------.    *a
+0000e500: 7272 6179 7320 3a20 4461 7461 4172 7261  rrays : DataArra
+0000e510: 7920 6f72 2056 6172 6961 626c 650a 2020  y or Variable.  
+0000e520: 2020 2020 2020 4172 7261 7973 2074 6f20        Arrays to 
+0000e530: 636f 6d70 7574 652e 0a20 2020 2064 696d  compute..    dim
+0000e540: 7320 3a20 7374 722c 2069 7465 7261 626c  s : str, iterabl
+0000e550: 6520 6f66 2068 6173 6861 626c 652c 2022  e of hashable, "
+0000e560: 2e2e 2e22 206f 7220 4e6f 6e65 2c20 6f70  ..." or None, op
+0000e570: 7469 6f6e 616c 0a20 2020 2020 2020 2057  tional.        W
+0000e580: 6869 6368 2064 696d 656e 7369 6f6e 7320  hich dimensions 
+0000e590: 746f 2073 756d 206f 7665 722e 2045 6c6c  to sum over. Ell
+0000e5a0: 6970 7369 7320 2827 2e2e 2e27 2920 7375  ipsis ('...') su
+0000e5b0: 6d73 206f 7665 7220 616c 6c20 6469 6d65  ms over all dime
+0000e5c0: 6e73 696f 6e73 2e0a 2020 2020 2020 2020  nsions..        
+0000e5d0: 4966 206e 6f74 2073 7065 6369 6669 6564  If not specified
+0000e5e0: 2c20 7468 656e 2061 6c6c 2074 6865 2063  , then all the c
+0000e5f0: 6f6d 6d6f 6e20 6469 6d65 6e73 696f 6e73  ommon dimensions
+0000e600: 2061 7265 2073 756d 6d65 6420 6f76 6572   are summed over
+0000e610: 2e0a 2020 2020 2a2a 6b77 6172 6773 203a  ..    **kwargs :
+0000e620: 2064 6963 740a 2020 2020 2020 2020 4164   dict.        Ad
+0000e630: 6469 7469 6f6e 616c 206b 6579 776f 7264  ditional keyword
+0000e640: 2061 7267 756d 656e 7473 2070 6173 7365   arguments passe
+0000e650: 6420 746f 206e 756d 7079 2e65 696e 7375  d to numpy.einsu
+0000e660: 6d20 6f72 0a20 2020 2020 2020 2064 6173  m or.        das
+0000e670: 6b2e 6172 7261 792e 6569 6e73 756d 0a0a  k.array.einsum..
+0000e680: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+0000e690: 2d2d 2d2d 2d2d 2d0a 2020 2020 4461 7461  -------.    Data
+0000e6a0: 4172 7261 790a 0a20 2020 2045 7861 6d70  Array..    Examp
+0000e6b0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
+0000e6c0: 0a20 2020 203e 3e3e 2064 615f 6120 3d20  .    >>> da_a = 
+0000e6d0: 7872 2e44 6174 6141 7272 6179 286e 702e  xr.DataArray(np.
+0000e6e0: 6172 616e 6765 2833 202a 2032 292e 7265  arange(3 * 2).re
+0000e6f0: 7368 6170 6528 332c 2032 292c 2064 696d  shape(3, 2), dim
+0000e700: 733d 5b22 6122 2c20 2262 225d 290a 2020  s=["a", "b"]).  
+0000e710: 2020 3e3e 3e20 6461 5f62 203d 2078 722e    >>> da_b = xr.
+0000e720: 4461 7461 4172 7261 7928 6e70 2e61 7261  DataArray(np.ara
+0000e730: 6e67 6528 3320 2a20 3220 2a20 3229 2e72  nge(3 * 2 * 2).r
+0000e740: 6573 6861 7065 2833 2c20 322c 2032 292c  eshape(3, 2, 2),
+0000e750: 2064 696d 733d 5b22 6122 2c20 2262 222c   dims=["a", "b",
+0000e760: 2022 6322 5d29 0a20 2020 203e 3e3e 2064   "c"]).    >>> d
+0000e770: 615f 6320 3d20 7872 2e44 6174 6141 7272  a_c = xr.DataArr
+0000e780: 6179 286e 702e 6172 616e 6765 2832 202a  ay(np.arange(2 *
+0000e790: 2033 292e 7265 7368 6170 6528 322c 2033   3).reshape(2, 3
+0000e7a0: 292c 2064 696d 733d 5b22 6322 2c20 2264  ), dims=["c", "d
+0000e7b0: 225d 290a 0a20 2020 203e 3e3e 2064 615f  "])..    >>> da_
+0000e7c0: 610a 2020 2020 3c78 6172 7261 792e 4461  a.    <xarray.Da
+0000e7d0: 7461 4172 7261 7920 2861 3a20 332c 2062  taArray (a: 3, b
+0000e7e0: 3a20 3229 3e0a 2020 2020 6172 7261 7928  : 2)>.    array(
+0000e7f0: 5b5b 302c 2031 5d2c 0a20 2020 2020 2020  [[0, 1],.       
+0000e800: 2020 2020 5b32 2c20 335d 2c0a 2020 2020      [2, 3],.    
+0000e810: 2020 2020 2020 205b 342c 2035 5d5d 290a         [4, 5]]).
+0000e820: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
+0000e830: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
+0000e840: 6573 3a20 612c 2062 0a0a 2020 2020 3e3e  es: a, b..    >>
+0000e850: 3e20 6461 5f62 0a20 2020 203c 7861 7272  > da_b.    <xarr
+0000e860: 6179 2e44 6174 6141 7272 6179 2028 613a  ay.DataArray (a:
+0000e870: 2033 2c20 623a 2032 2c20 633a 2032 293e   3, b: 2, c: 2)>
+0000e880: 0a20 2020 2061 7272 6179 285b 5b5b 2030  .    array([[[ 0
+0000e890: 2c20 2031 5d2c 0a20 2020 2020 2020 2020  ,  1],.         
+0000e8a0: 2020 205b 2032 2c20 2033 5d5d 2c0a 2020     [ 2,  3]],.  
+0000e8b0: 2020 3c42 4c41 4e4b 4c49 4e45 3e0a 2020    <BLANKLINE>.  
+0000e8c0: 2020 2020 2020 2020 205b 5b20 342c 2020           [[ 4,  
+0000e8d0: 355d 2c0a 2020 2020 2020 2020 2020 2020  5],.            
+0000e8e0: 5b20 362c 2020 375d 5d2c 0a20 2020 203c  [ 6,  7]],.    <
+0000e8f0: 424c 414e 4b4c 494e 453e 0a20 2020 2020  BLANKLINE>.     
+0000e900: 2020 2020 2020 5b5b 2038 2c20 2039 5d2c        [[ 8,  9],
+0000e910: 0a20 2020 2020 2020 2020 2020 205b 3130  .            [10
+0000e920: 2c20 3131 5d5d 5d29 0a20 2020 2044 696d  , 11]]]).    Dim
+0000e930: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
+0000e940: 636f 6f72 6469 6e61 7465 733a 2061 2c20  coordinates: a, 
+0000e950: 622c 2063 0a0a 2020 2020 3e3e 3e20 6461  b, c..    >>> da
+0000e960: 5f63 0a20 2020 203c 7861 7272 6179 2e44  _c.    <xarray.D
+0000e970: 6174 6141 7272 6179 2028 633a 2032 2c20  ataArray (c: 2, 
+0000e980: 643a 2033 293e 0a20 2020 2061 7272 6179  d: 3)>.    array
+0000e990: 285b 5b30 2c20 312c 2032 5d2c 0a20 2020  ([[0, 1, 2],.   
+0000e9a0: 2020 2020 2020 2020 5b33 2c20 342c 2035          [3, 4, 5
+0000e9b0: 5d5d 290a 2020 2020 4469 6d65 6e73 696f  ]]).    Dimensio
+0000e9c0: 6e73 2077 6974 686f 7574 2063 6f6f 7264  ns without coord
+0000e9d0: 696e 6174 6573 3a20 632c 2064 0a0a 2020  inates: c, d..  
+0000e9e0: 2020 3e3e 3e20 7872 2e64 6f74 2864 615f    >>> xr.dot(da_
+0000e9f0: 612c 2064 615f 622c 2064 696d 733d 5b22  a, da_b, dims=["
+0000ea00: 6122 2c20 2262 225d 290a 2020 2020 3c78  a", "b"]).    <x
+0000ea10: 6172 7261 792e 4461 7461 4172 7261 7920  array.DataArray 
+0000ea20: 2863 3a20 3229 3e0a 2020 2020 6172 7261  (c: 2)>.    arra
+0000ea30: 7928 5b31 3130 2c20 3132 355d 290a 2020  y([110, 125]).  
+0000ea40: 2020 4469 6d65 6e73 696f 6e73 2077 6974    Dimensions wit
+0000ea50: 686f 7574 2063 6f6f 7264 696e 6174 6573  hout coordinates
+0000ea60: 3a20 630a 0a20 2020 203e 3e3e 2078 722e  : c..    >>> xr.
+0000ea70: 646f 7428 6461 5f61 2c20 6461 5f62 2c20  dot(da_a, da_b, 
+0000ea80: 6469 6d73 3d5b 2261 225d 290a 2020 2020  dims=["a"]).    
+0000ea90: 3c78 6172 7261 792e 4461 7461 4172 7261  <xarray.DataArra
+0000eaa0: 7920 2862 3a20 322c 2063 3a20 3229 3e0a  y (b: 2, c: 2)>.
+0000eab0: 2020 2020 6172 7261 7928 5b5b 3430 2c20      array([[40, 
+0000eac0: 3436 5d2c 0a20 2020 2020 2020 2020 2020  46],.           
+0000ead0: 5b37 302c 2037 395d 5d29 0a20 2020 2044  [70, 79]]).    D
+0000eae0: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
+0000eaf0: 7420 636f 6f72 6469 6e61 7465 733a 2062  t coordinates: b
+0000eb00: 2c20 630a 0a20 2020 203e 3e3e 2078 722e  , c..    >>> xr.
+0000eb10: 646f 7428 6461 5f61 2c20 6461 5f62 2c20  dot(da_a, da_b, 
+0000eb20: 6461 5f63 2c20 6469 6d73 3d5b 2262 222c  da_c, dims=["b",
+0000eb30: 2022 6322 5d29 0a20 2020 203c 7861 7272   "c"]).    <xarr
+0000eb40: 6179 2e44 6174 6141 7272 6179 2028 613a  ay.DataArray (a:
+0000eb50: 2033 2c20 643a 2033 293e 0a20 2020 2061   3, d: 3)>.    a
+0000eb60: 7272 6179 285b 5b20 2039 2c20 2031 342c  rray([[  9,  14,
+0000eb70: 2020 3139 5d2c 0a20 2020 2020 2020 2020    19],.         
+0000eb80: 2020 5b20 3933 2c20 3135 302c 2032 3037    [ 93, 150, 207
+0000eb90: 5d2c 0a20 2020 2020 2020 2020 2020 5b32  ],.           [2
+0000eba0: 3733 2c20 3434 362c 2036 3139 5d5d 290a  73, 446, 619]]).
+0000ebb0: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
+0000ebc0: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
+0000ebd0: 6573 3a20 612c 2064 0a0a 2020 2020 3e3e  es: a, d..    >>
+0000ebe0: 3e20 7872 2e64 6f74 2864 615f 612c 2064  > xr.dot(da_a, d
+0000ebf0: 615f 6229 0a20 2020 203c 7861 7272 6179  a_b).    <xarray
+0000ec00: 2e44 6174 6141 7272 6179 2028 633a 2032  .DataArray (c: 2
+0000ec10: 293e 0a20 2020 2061 7272 6179 285b 3131  )>.    array([11
+0000ec20: 302c 2031 3235 5d29 0a20 2020 2044 696d  0, 125]).    Dim
+0000ec30: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
+0000ec40: 636f 6f72 6469 6e61 7465 733a 2063 0a0a  coordinates: c..
+0000ec50: 2020 2020 3e3e 3e20 7872 2e64 6f74 2864      >>> xr.dot(d
+0000ec60: 615f 612c 2064 615f 622c 2064 696d 733d  a_a, da_b, dims=
+0000ec70: 2e2e 2e29 0a20 2020 203c 7861 7272 6179  ...).    <xarray
+0000ec80: 2e44 6174 6141 7272 6179 2028 293e 0a20  .DataArray ()>. 
+0000ec90: 2020 2061 7272 6179 2832 3335 290a 2020     array(235).  
+0000eca0: 2020 2222 220a 2020 2020 6672 6f6d 2078    """.    from x
+0000ecb0: 6172 7261 792e 636f 7265 2e64 6174 6161  array.core.dataa
+0000ecc0: 7272 6179 2069 6d70 6f72 7420 4461 7461  rray import Data
+0000ecd0: 4172 7261 790a 2020 2020 6672 6f6d 2078  Array.    from x
+0000ece0: 6172 7261 792e 636f 7265 2e76 6172 6961  array.core.varia
+0000ecf0: 626c 6520 696d 706f 7274 2056 6172 6961  ble import Varia
+0000ed00: 626c 650a 0a20 2020 2069 6620 616e 7928  ble..    if any(
+0000ed10: 6e6f 7420 6973 696e 7374 616e 6365 2861  not isinstance(a
+0000ed20: 7272 2c20 2856 6172 6961 626c 652c 2044  rr, (Variable, D
+0000ed30: 6174 6141 7272 6179 2929 2066 6f72 2061  ataArray)) for a
+0000ed40: 7272 2069 6e20 6172 7261 7973 293a 0a20  rr in arrays):. 
+0000ed50: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0000ed60: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0000ed70: 2020 2020 224f 6e6c 7920 7872 2e44 6174      "Only xr.Dat
+0000ed80: 6141 7272 6179 2061 6e64 2078 722e 5661  aArray and xr.Va
+0000ed90: 7269 6162 6c65 2061 7265 2073 7570 706f  riable are suppo
+0000eda0: 7274 6564 2e22 0a20 2020 2020 2020 2020  rted.".         
+0000edb0: 2020 2022 4769 7665 6e20 7b7d 2e22 2e66     "Given {}.".f
+0000edc0: 6f72 6d61 7428 5b74 7970 6528 6172 7229  ormat([type(arr)
+0000edd0: 2066 6f72 2061 7272 2069 6e20 6172 7261   for arr in arra
+0000ede0: 7973 5d29 0a20 2020 2020 2020 2029 0a0a  ys]).        )..
+0000edf0: 2020 2020 6966 206c 656e 2861 7272 6179      if len(array
+0000ee00: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+0000ee10: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0000ee20: 2822 4174 206c 6561 7374 206f 6e65 2061  ("At least one a
+0000ee30: 7272 6179 2073 686f 756c 6420 6265 2067  rray should be g
+0000ee40: 6976 656e 2e22 290a 0a20 2020 2063 6f6d  iven.")..    com
+0000ee50: 6d6f 6e5f 6469 6d73 3a20 7365 745b 4861  mon_dims: set[Ha
+0000ee60: 7368 6162 6c65 5d20 3d20 7365 742e 696e  shable] = set.in
+0000ee70: 7465 7273 6563 7469 6f6e 282a 2873 6574  tersection(*(set
+0000ee80: 2861 7272 2e64 696d 7329 2066 6f72 2061  (arr.dims) for a
+0000ee90: 7272 2069 6e20 6172 7261 7973 2929 0a20  rr in arrays)). 
+0000eea0: 2020 2061 6c6c 5f64 696d 7320 3d20 5b5d     all_dims = []
+0000eeb0: 0a20 2020 2066 6f72 2061 7272 2069 6e20  .    for arr in 
+0000eec0: 6172 7261 7973 3a0a 2020 2020 2020 2020  arrays:.        
+0000eed0: 616c 6c5f 6469 6d73 202b 3d20 5b64 2066  all_dims += [d f
+0000eee0: 6f72 2064 2069 6e20 6172 722e 6469 6d73  or d in arr.dims
+0000eef0: 2069 6620 6420 6e6f 7420 696e 2061 6c6c   if d not in all
+0000ef00: 5f64 696d 735d 0a0a 2020 2020 6569 6e73  _dims]..    eins
+0000ef10: 756d 5f61 7865 7320 3d20 2261 6263 6465  um_axes = "abcde
+0000ef20: 6667 6869 6a6b 6c6d 6e6f 7071 7273 7475  fghijklmnopqrstu
+0000ef30: 7677 7879 7a22 0a20 2020 2064 696d 5f6d  vwxyz".    dim_m
+0000ef40: 6170 203d 207b 643a 2065 696e 7375 6d5f  ap = {d: einsum_
+0000ef50: 6178 6573 5b69 5d20 666f 7220 692c 2064  axes[i] for i, d
+0000ef60: 2069 6e20 656e 756d 6572 6174 6528 616c   in enumerate(al
+0000ef70: 6c5f 6469 6d73 297d 0a0a 2020 2020 6966  l_dims)}..    if
+0000ef80: 2064 696d 7320 6973 202e 2e2e 3a0a 2020   dims is ...:.  
+0000ef90: 2020 2020 2020 6469 6d73 203d 2061 6c6c        dims = all
+0000efa0: 5f64 696d 730a 2020 2020 656c 6966 2069  _dims.    elif i
+0000efb0: 7369 6e73 7461 6e63 6528 6469 6d73 2c20  sinstance(dims, 
+0000efc0: 7374 7229 3a0a 2020 2020 2020 2020 6469  str):.        di
+0000efd0: 6d73 203d 2028 6469 6d73 2c29 0a20 2020  ms = (dims,).   
+0000efe0: 2065 6c69 6620 6469 6d73 2069 7320 4e6f   elif dims is No
+0000eff0: 6e65 3a0a 2020 2020 2020 2020 2320 6669  ne:.        # fi
+0000f000: 6e64 2064 696d 656e 7369 6f6e 7320 7468  nd dimensions th
+0000f010: 6174 206f 6363 7572 206d 6f72 6520 7468  at occur more th
+0000f020: 616e 206f 6e65 2074 696d 6573 0a20 2020  an one times.   
+0000f030: 2020 2020 2064 696d 5f63 6f75 6e74 733a       dim_counts:
+0000f040: 2043 6f75 6e74 6572 203d 2043 6f75 6e74   Counter = Count
+0000f050: 6572 2829 0a20 2020 2020 2020 2066 6f72  er().        for
+0000f060: 2061 7272 2069 6e20 6172 7261 7973 3a0a   arr in arrays:.
+0000f070: 2020 2020 2020 2020 2020 2020 6469 6d5f              dim_
+0000f080: 636f 756e 7473 2e75 7064 6174 6528 6172  counts.update(ar
+0000f090: 722e 6469 6d73 290a 2020 2020 2020 2020  r.dims).        
+0000f0a0: 6469 6d73 203d 2074 7570 6c65 2864 2066  dims = tuple(d f
+0000f0b0: 6f72 2064 2c20 6320 696e 2064 696d 5f63  or d, c in dim_c
+0000f0c0: 6f75 6e74 732e 6974 656d 7328 2920 6966  ounts.items() if
+0000f0d0: 2063 203e 2031 290a 0a20 2020 2064 6f74   c > 1)..    dot
+0000f0e0: 5f64 696d 733a 2073 6574 5b48 6173 6861  _dims: set[Hasha
+0000f0f0: 626c 655d 203d 2073 6574 2864 696d 7329  ble] = set(dims)
+0000f100: 0a0a 2020 2020 2320 6469 6d65 6e73 696f  ..    # dimensio
+0000f110: 6e73 2074 6f20 6265 2070 6172 616c 6c65  ns to be paralle
+0000f120: 6c69 7a65 640a 2020 2020 6272 6f61 6463  lized.    broadc
+0000f130: 6173 745f 6469 6d73 203d 2063 6f6d 6d6f  ast_dims = commo
+0000f140: 6e5f 6469 6d73 202d 2064 6f74 5f64 696d  n_dims - dot_dim
+0000f150: 730a 2020 2020 696e 7075 745f 636f 7265  s.    input_core
+0000f160: 5f64 696d 7320 3d20 5b0a 2020 2020 2020  _dims = [.      
+0000f170: 2020 5b64 2066 6f72 2064 2069 6e20 6172    [d for d in ar
+0000f180: 722e 6469 6d73 2069 6620 6420 6e6f 7420  r.dims if d not 
+0000f190: 696e 2062 726f 6164 6361 7374 5f64 696d  in broadcast_dim
+0000f1a0: 735d 2066 6f72 2061 7272 2069 6e20 6172  s] for arr in ar
+0000f1b0: 7261 7973 0a20 2020 205d 0a20 2020 206f  rays.    ].    o
+0000f1c0: 7574 7075 745f 636f 7265 5f64 696d 7320  utput_core_dims 
+0000f1d0: 3d20 5b0a 2020 2020 2020 2020 5b64 2066  = [.        [d f
+0000f1e0: 6f72 2064 2069 6e20 616c 6c5f 6469 6d73  or d in all_dims
+0000f1f0: 2069 6620 6420 6e6f 7420 696e 2064 6f74   if d not in dot
+0000f200: 5f64 696d 7320 616e 6420 6420 6e6f 7420  _dims and d not 
+0000f210: 696e 2062 726f 6164 6361 7374 5f64 696d  in broadcast_dim
+0000f220: 735d 0a20 2020 205d 0a0a 2020 2020 2320  s].    ]..    # 
+0000f230: 636f 6e73 7472 7563 7420 6569 6e73 756d  construct einsum
+0000f240: 2073 7562 7363 7269 7074 732c 2073 7563   subscripts, suc
+0000f250: 6820 6173 2027 2e2e 2e61 6263 2c2e 2e2e  h as '...abc,...
+0000f260: 6162 2d3e 2e2e 2e63 270a 2020 2020 2320  ab->...c'.    # 
+0000f270: 4e6f 7465 3a20 696e 7075 745f 636f 7265  Note: input_core
+0000f280: 5f64 696d 7320 6172 6520 616c 7761 7973  _dims are always
+0000f290: 206d 6f76 6564 2074 6f20 7468 6520 6c61   moved to the la
+0000f2a0: 7374 2070 6f73 6974 696f 6e0a 2020 2020  st position.    
+0000f2b0: 7375 6273 6372 6970 7473 5f6c 6973 7420  subscripts_list 
+0000f2c0: 3d20 5b0a 2020 2020 2020 2020 222e 2e2e  = [.        "...
+0000f2d0: 2220 2b20 2222 2e6a 6f69 6e28 6469 6d5f  " + "".join(dim_
+0000f2e0: 6d61 705b 645d 2066 6f72 2064 2069 6e20  map[d] for d in 
+0000f2f0: 6473 2920 666f 7220 6473 2069 6e20 696e  ds) for ds in in
+0000f300: 7075 745f 636f 7265 5f64 696d 730a 2020  put_core_dims.  
+0000f310: 2020 5d0a 2020 2020 7375 6273 6372 6970    ].    subscrip
+0000f320: 7473 203d 2022 2c22 2e6a 6f69 6e28 7375  ts = ",".join(su
+0000f330: 6273 6372 6970 7473 5f6c 6973 7429 0a20  bscripts_list). 
+0000f340: 2020 2073 7562 7363 7269 7074 7320 2b3d     subscripts +=
+0000f350: 2022 2d3e 2e2e 2e22 202b 2022 222e 6a6f   "->..." + "".jo
+0000f360: 696e 2864 696d 5f6d 6170 5b64 5d20 666f  in(dim_map[d] fo
+0000f370: 7220 6420 696e 206f 7574 7075 745f 636f  r d in output_co
+0000f380: 7265 5f64 696d 735b 305d 290a 0a20 2020  re_dims[0])..   
+0000f390: 206a 6f69 6e20 3d20 4f50 5449 4f4e 535b   join = OPTIONS[
+0000f3a0: 2261 7269 7468 6d65 7469 635f 6a6f 696e  "arithmetic_join
+0000f3b0: 225d 0a20 2020 2023 2075 7369 6e67 2022  "].    # using "
+0000f3c0: 696e 6e65 7222 2065 6d75 6c61 7465 7320  inner" emulates 
+0000f3d0: 6028 6120 2a20 6229 2e73 756d 2829 6020  `(a * b).sum()` 
+0000f3e0: 666f 7220 616c 6c20 6a6f 696e 7320 2865  for all joins (e
+0000f3f0: 7863 6570 7420 2265 7861 6374 2229 0a20  xcept "exact"). 
+0000f400: 2020 2069 6620 6a6f 696e 2021 3d20 2265     if join != "e
+0000f410: 7861 6374 223a 0a20 2020 2020 2020 206a  xact":.        j
+0000f420: 6f69 6e20 3d20 2269 6e6e 6572 220a 0a20  oin = "inner".. 
+0000f430: 2020 2023 2073 7562 7363 7269 7074 7320     # subscripts 
+0000f440: 7368 6f75 6c64 2062 6520 7061 7373 6564  should be passed
+0000f450: 2074 6f20 6e70 2e65 696e 7375 6d20 6173   to np.einsum as
+0000f460: 2061 7267 2c20 6e6f 7420 6173 206b 7761   arg, not as kwa
+0000f470: 7267 732e 2057 6520 6e65 6564 0a20 2020  rgs. We need.   
+0000f480: 2023 2074 6f20 636f 6e73 7472 7563 7420   # to construct 
+0000f490: 6120 7061 7274 6961 6c20 6675 6e63 7469  a partial functi
+0000f4a0: 6f6e 2066 6f72 2061 7070 6c79 5f75 6675  on for apply_ufu
+0000f4b0: 6e63 2074 6f20 776f 726b 2e0a 2020 2020  nc to work..    
+0000f4c0: 6675 6e63 203d 2066 756e 6374 6f6f 6c73  func = functools
+0000f4d0: 2e70 6172 7469 616c 2864 7563 6b5f 6172  .partial(duck_ar
+0000f4e0: 7261 795f 6f70 732e 6569 6e73 756d 2c20  ray_ops.einsum, 
+0000f4f0: 7375 6273 6372 6970 7473 2c20 2a2a 6b77  subscripts, **kw
+0000f500: 6172 6773 290a 2020 2020 7265 7375 6c74  args).    result
+0000f510: 203d 2061 7070 6c79 5f75 6675 6e63 280a   = apply_ufunc(.
+0000f520: 2020 2020 2020 2020 6675 6e63 2c0a 2020          func,.  
+0000f530: 2020 2020 2020 2a61 7272 6179 732c 0a20        *arrays,. 
+0000f540: 2020 2020 2020 2069 6e70 7574 5f63 6f72         input_cor
+0000f550: 655f 6469 6d73 3d69 6e70 7574 5f63 6f72  e_dims=input_cor
+0000f560: 655f 6469 6d73 2c0a 2020 2020 2020 2020  e_dims,.        
+0000f570: 6f75 7470 7574 5f63 6f72 655f 6469 6d73  output_core_dims
+0000f580: 3d6f 7574 7075 745f 636f 7265 5f64 696d  =output_core_dim
+0000f590: 732c 0a20 2020 2020 2020 206a 6f69 6e3d  s,.        join=
+0000f5a0: 6a6f 696e 2c0a 2020 2020 2020 2020 6461  join,.        da
+0000f5b0: 736b 3d22 616c 6c6f 7765 6422 2c0a 2020  sk="allowed",.  
+0000f5c0: 2020 290a 2020 2020 7265 7475 726e 2072    ).    return r
+0000f5d0: 6573 756c 742e 7472 616e 7370 6f73 6528  esult.transpose(
+0000f5e0: 2a61 6c6c 5f64 696d 732c 206d 6973 7369  *all_dims, missi
+0000f5f0: 6e67 5f64 696d 733d 2269 676e 6f72 6522  ng_dims="ignore"
+0000f600: 290a 0a0a 6465 6620 7768 6572 6528 636f  )...def where(co
+0000f610: 6e64 2c20 782c 2079 2c20 6b65 6570 5f61  nd, x, y, keep_a
+0000f620: 7474 7273 3d4e 6f6e 6529 3a0a 2020 2020  ttrs=None):.    
+0000f630: 2222 2252 6574 7572 6e20 656c 656d 656e  """Return elemen
+0000f640: 7473 2066 726f 6d20 6078 6020 6f72 2060  ts from `x` or `
+0000f650: 7960 2064 6570 656e 6469 6e67 206f 6e20  y` depending on 
+0000f660: 6063 6f6e 6460 2e0a 0a20 2020 2050 6572  `cond`...    Per
+0000f670: 666f 726d 7320 7861 7272 6179 2d6c 696b  forms xarray-lik
+0000f680: 6520 6272 6f61 6463 6173 7469 6e67 2061  e broadcasting a
+0000f690: 6372 6f73 7320 696e 7075 7420 6172 6775  cross input argu
+0000f6a0: 6d65 6e74 732e 0a0a 2020 2020 416c 6c20  ments...    All 
+0000f6b0: 6469 6d65 6e73 696f 6e20 636f 6f72 6469  dimension coordi
+0000f6c0: 6e61 7465 7320 6f6e 2060 7860 2061 6e64  nates on `x` and
+0000f6d0: 2060 7960 2020 6d75 7374 2062 6520 616c   `y`  must be al
+0000f6e0: 6967 6e65 6420 7769 7468 2065 6163 680a  igned with each.
+0000f6f0: 2020 2020 6f74 6865 7220 616e 6420 7769      other and wi
+0000f700: 7468 2060 636f 6e64 602e 0a0a 2020 2020  th `cond`...    
+0000f710: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+0000f720: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 636f  ---------.    co
+0000f730: 6e64 203a 2073 6361 6c61 722c 2061 7272  nd : scalar, arr
+0000f740: 6179 2c20 5661 7269 6162 6c65 2c20 4461  ay, Variable, Da
+0000f750: 7461 4172 7261 7920 6f72 2044 6174 6173  taArray or Datas
+0000f760: 6574 0a20 2020 2020 2020 2057 6865 6e20  et.        When 
+0000f770: 5472 7565 2c20 7265 7475 726e 2076 616c  True, return val
+0000f780: 7565 7320 6672 6f6d 2060 7860 2c20 6f74  ues from `x`, ot
+0000f790: 6865 7277 6973 6520 7265 7475 726e 7320  herwise returns 
+0000f7a0: 7661 6c75 6573 2066 726f 6d20 6079 602e  values from `y`.
+0000f7b0: 0a20 2020 2078 203a 2073 6361 6c61 722c  .    x : scalar,
+0000f7c0: 2061 7272 6179 2c20 5661 7269 6162 6c65   array, Variable
+0000f7d0: 2c20 4461 7461 4172 7261 7920 6f72 2044  , DataArray or D
+0000f7e0: 6174 6173 6574 0a20 2020 2020 2020 2076  ataset.        v
+0000f7f0: 616c 7565 7320 746f 2063 686f 6f73 6520  alues to choose 
+0000f800: 6672 6f6d 2077 6865 7265 2060 636f 6e64  from where `cond
+0000f810: 6020 6973 2054 7275 650a 2020 2020 7920  ` is True.    y 
+0000f820: 3a20 7363 616c 6172 2c20 6172 7261 792c  : scalar, array,
+0000f830: 2056 6172 6961 626c 652c 2044 6174 6141   Variable, DataA
+0000f840: 7272 6179 206f 7220 4461 7461 7365 740a  rray or Dataset.
+0000f850: 2020 2020 2020 2020 7661 6c75 6573 2074          values t
+0000f860: 6f20 6368 6f6f 7365 2066 726f 6d20 7768  o choose from wh
+0000f870: 6572 6520 6063 6f6e 6460 2069 7320 4661  ere `cond` is Fa
+0000f880: 6c73 650a 2020 2020 6b65 6570 5f61 7474  lse.    keep_att
+0000f890: 7273 203a 2062 6f6f 6c20 6f72 2073 7472  rs : bool or str
+0000f8a0: 206f 7220 6361 6c6c 6162 6c65 2c20 6f70   or callable, op
+0000f8b0: 7469 6f6e 616c 0a20 2020 2020 2020 2048  tional.        H
+0000f8c0: 6f77 2074 6f20 7472 6561 7420 6174 7472  ow to treat attr
+0000f8d0: 732e 2049 6620 5472 7565 2c20 6b65 6570  s. If True, keep
+0000f8e0: 2074 6865 2061 7474 7273 206f 6620 6078   the attrs of `x
+0000f8f0: 602e 0a0a 2020 2020 5265 7475 726e 730a  `...    Returns.
+0000f900: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+0000f910: 4461 7461 7365 742c 2044 6174 6141 7272  Dataset, DataArr
+0000f920: 6179 2c20 5661 7269 6162 6c65 206f 7220  ay, Variable or 
+0000f930: 6172 7261 790a 2020 2020 2020 2020 496e  array.        In
+0000f940: 2070 7269 6f72 6974 7920 6f72 6465 723a   priority order:
+0000f950: 2044 6174 6173 6574 2c20 4461 7461 4172   Dataset, DataAr
+0000f960: 7261 792c 2056 6172 6961 626c 6520 6f72  ray, Variable or
+0000f970: 2061 7272 6179 2c20 7768 6963 6865 7665   array, whicheve
+0000f980: 720a 2020 2020 2020 2020 7479 7065 2061  r.        type a
+0000f990: 7070 6561 7273 2061 7320 616e 2069 6e70  ppears as an inp
+0000f9a0: 7574 2061 7267 756d 656e 742e 0a0a 2020  ut argument...  
+0000f9b0: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+0000f9c0: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+0000f9d0: 7820 3d20 7872 2e44 6174 6141 7272 6179  x = xr.DataArray
+0000f9e0: 280a 2020 2020 2e2e 2e20 2020 2020 302e  (.    ...     0.
+0000f9f0: 3120 2a20 6e70 2e61 7261 6e67 6528 3130  1 * np.arange(10
+0000fa00: 292c 0a20 2020 202e 2e2e 2020 2020 2064  ),.    ...     d
+0000fa10: 696d 733d 5b22 6c61 7422 5d2c 0a20 2020  ims=["lat"],.   
+0000fa20: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
+0000fa30: 7b22 6c61 7422 3a20 6e70 2e61 7261 6e67  {"lat": np.arang
+0000fa40: 6528 3130 297d 2c0a 2020 2020 2e2e 2e20  e(10)},.    ... 
+0000fa50: 2020 2020 6e61 6d65 3d22 7373 7422 2c0a      name="sst",.
+0000fa60: 2020 2020 2e2e 2e20 290a 2020 2020 3e3e      ... ).    >>
+0000fa70: 3e20 780a 2020 2020 3c78 6172 7261 792e  > x.    <xarray.
+0000fa80: 4461 7461 4172 7261 7920 2773 7374 2720  DataArray 'sst' 
+0000fa90: 286c 6174 3a20 3130 293e 0a20 2020 2061  (lat: 10)>.    a
+0000faa0: 7272 6179 285b 302e 202c 2030 2e31 2c20  rray([0. , 0.1, 
+0000fab0: 302e 322c 2030 2e33 2c20 302e 342c 2030  0.2, 0.3, 0.4, 0
+0000fac0: 2e35 2c20 302e 362c 2030 2e37 2c20 302e  .5, 0.6, 0.7, 0.
+0000fad0: 382c 2030 2e39 5d29 0a20 2020 2043 6f6f  8, 0.9]).    Coo
+0000fae0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+0000faf0: 2a20 6c61 7420 2020 2020 2028 6c61 7429  * lat      (lat)
+0000fb00: 2069 6e74 3634 2030 2031 2032 2033 2034   int64 0 1 2 3 4
+0000fb10: 2035 2036 2037 2038 2039 0a0a 2020 2020   5 6 7 8 9..    
+0000fb20: 3e3e 3e20 7872 2e77 6865 7265 2878 203c  >>> xr.where(x <
+0000fb30: 2030 2e35 2c20 782c 2078 202a 2031 3030   0.5, x, x * 100
+0000fb40: 290a 2020 2020 3c78 6172 7261 792e 4461  ).    <xarray.Da
+0000fb50: 7461 4172 7261 7920 2773 7374 2720 286c  taArray 'sst' (l
+0000fb60: 6174 3a20 3130 293e 0a20 2020 2061 7272  at: 10)>.    arr
+0000fb70: 6179 285b 2030 2e20 2c20 2030 2e31 2c20  ay([ 0. ,  0.1, 
+0000fb80: 2030 2e32 2c20 2030 2e33 2c20 2030 2e34   0.2,  0.3,  0.4
+0000fb90: 2c20 3530 2e20 2c20 3630 2e20 2c20 3730  , 50. , 60. , 70
+0000fba0: 2e20 2c20 3830 2e20 2c20 3930 2e20 5d29  . , 80. , 90. ])
+0000fbb0: 0a20 2020 2043 6f6f 7264 696e 6174 6573  .    Coordinates
+0000fbc0: 3a0a 2020 2020 2020 2a20 6c61 7420 2020  :.      * lat   
+0000fbd0: 2020 2028 6c61 7429 2069 6e74 3634 2030     (lat) int64 0
+0000fbe0: 2031 2032 2033 2034 2035 2036 2037 2038   1 2 3 4 5 6 7 8
+0000fbf0: 2039 0a0a 2020 2020 3e3e 3e20 7920 3d20   9..    >>> y = 
+0000fc00: 7872 2e44 6174 6141 7272 6179 280a 2020  xr.DataArray(.  
+0000fc10: 2020 2e2e 2e20 2020 2020 302e 3120 2a20    ...     0.1 * 
+0000fc20: 6e70 2e61 7261 6e67 6528 3929 2e72 6573  np.arange(9).res
+0000fc30: 6861 7065 2833 2c20 3329 2c0a 2020 2020  hape(3, 3),.    
+0000fc40: 2e2e 2e20 2020 2020 6469 6d73 3d5b 226c  ...     dims=["l
+0000fc50: 6174 222c 2022 6c6f 6e22 5d2c 0a20 2020  at", "lon"],.   
+0000fc60: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
+0000fc70: 7b22 6c61 7422 3a20 6e70 2e61 7261 6e67  {"lat": np.arang
+0000fc80: 6528 3329 2c20 226c 6f6e 223a 2031 3020  e(3), "lon": 10 
+0000fc90: 2b20 6e70 2e61 7261 6e67 6528 3329 7d2c  + np.arange(3)},
+0000fca0: 0a20 2020 202e 2e2e 2020 2020 206e 616d  .    ...     nam
+0000fcb0: 653d 2273 7374 222c 0a20 2020 202e 2e2e  e="sst",.    ...
+0000fcc0: 2029 0a20 2020 203e 3e3e 2079 0a20 2020   ).    >>> y.   
+0000fcd0: 203c 7861 7272 6179 2e44 6174 6141 7272   <xarray.DataArr
+0000fce0: 6179 2027 7373 7427 2028 6c61 743a 2033  ay 'sst' (lat: 3
+0000fcf0: 2c20 6c6f 6e3a 2033 293e 0a20 2020 2061  , lon: 3)>.    a
+0000fd00: 7272 6179 285b 5b30 2e20 2c20 302e 312c  rray([[0. , 0.1,
+0000fd10: 2030 2e32 5d2c 0a20 2020 2020 2020 2020   0.2],.         
+0000fd20: 2020 5b30 2e33 2c20 302e 342c 2030 2e35    [0.3, 0.4, 0.5
+0000fd30: 5d2c 0a20 2020 2020 2020 2020 2020 5b30  ],.           [0
+0000fd40: 2e36 2c20 302e 372c 2030 2e38 5d5d 290a  .6, 0.7, 0.8]]).
+0000fd50: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+0000fd60: 0a20 2020 2020 202a 206c 6174 2020 2020  .      * lat    
+0000fd70: 2020 286c 6174 2920 696e 7436 3420 3020    (lat) int64 0 
+0000fd80: 3120 320a 2020 2020 2020 2a20 6c6f 6e20  1 2.      * lon 
+0000fd90: 2020 2020 2028 6c6f 6e29 2069 6e74 3634       (lon) int64
+0000fda0: 2031 3020 3131 2031 320a 0a20 2020 203e   10 11 12..    >
+0000fdb0: 3e3e 2078 722e 7768 6572 6528 792e 6c61  >> xr.where(y.la
+0000fdc0: 7420 3c20 312c 2079 2c20 2d31 290a 2020  t < 1, y, -1).  
+0000fdd0: 2020 3c78 6172 7261 792e 4461 7461 4172    <xarray.DataAr
+0000fde0: 7261 7920 286c 6174 3a20 332c 206c 6f6e  ray (lat: 3, lon
+0000fdf0: 3a20 3329 3e0a 2020 2020 6172 7261 7928  : 3)>.    array(
+0000fe00: 5b5b 2030 2e20 2c20 2030 2e31 2c20 2030  [[ 0. ,  0.1,  0
+0000fe10: 2e32 5d2c 0a20 2020 2020 2020 2020 2020  .2],.           
+0000fe20: 5b2d 312e 202c 202d 312e 202c 202d 312e  [-1. , -1. , -1.
+0000fe30: 205d 2c0a 2020 2020 2020 2020 2020 205b   ],.           [
+0000fe40: 2d31 2e20 2c20 2d31 2e20 2c20 2d31 2e20  -1. , -1. , -1. 
+0000fe50: 5d5d 290a 2020 2020 436f 6f72 6469 6e61  ]]).    Coordina
+0000fe60: 7465 733a 0a20 2020 2020 202a 206c 6174  tes:.      * lat
+0000fe70: 2020 2020 2020 286c 6174 2920 696e 7436        (lat) int6
+0000fe80: 3420 3020 3120 320a 2020 2020 2020 2a20  4 0 1 2.      * 
+0000fe90: 6c6f 6e20 2020 2020 2028 6c6f 6e29 2069  lon      (lon) i
+0000fea0: 6e74 3634 2031 3020 3131 2031 320a 0a20  nt64 10 11 12.. 
+0000feb0: 2020 203e 3e3e 2063 6f6e 6420 3d20 7872     >>> cond = xr
+0000fec0: 2e44 6174 6141 7272 6179 285b 5472 7565  .DataArray([True
+0000fed0: 2c20 4661 6c73 655d 2c20 6469 6d73 3d5b  , False], dims=[
+0000fee0: 2278 225d 290a 2020 2020 3e3e 3e20 7820  "x"]).    >>> x 
+0000fef0: 3d20 7872 2e44 6174 6141 7272 6179 285b  = xr.DataArray([
+0000ff00: 312c 2032 5d2c 2064 696d 733d 5b22 7922  1, 2], dims=["y"
+0000ff10: 5d29 0a20 2020 203e 3e3e 2078 722e 7768  ]).    >>> xr.wh
+0000ff20: 6572 6528 636f 6e64 2c20 782c 2030 290a  ere(cond, x, 0).
+0000ff30: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+0000ff40: 4172 7261 7920 2878 3a20 322c 2079 3a20  Array (x: 2, y: 
+0000ff50: 3229 3e0a 2020 2020 6172 7261 7928 5b5b  2)>.    array([[
+0000ff60: 312c 2032 5d2c 0a20 2020 2020 2020 2020  1, 2],.         
+0000ff70: 2020 5b30 2c20 305d 5d29 0a20 2020 2044    [0, 0]]).    D
+0000ff80: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
+0000ff90: 7420 636f 6f72 6469 6e61 7465 733a 2078  t coordinates: x
+0000ffa0: 2c20 790a 0a20 2020 2053 6565 2041 6c73  , y..    See Als
+0000ffb0: 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  o.    --------. 
+0000ffc0: 2020 206e 756d 7079 2e77 6865 7265 203a     numpy.where :
+0000ffd0: 2063 6f72 7265 7370 6f6e 6469 6e67 206e   corresponding n
+0000ffe0: 756d 7079 2066 756e 6374 696f 6e0a 2020  umpy function.  
+0000fff0: 2020 4461 7461 7365 742e 7768 6572 652c    Dataset.where,
+00010000: 2044 6174 6141 7272 6179 2e77 6865 7265   DataArray.where
+00010010: 203a 0a20 2020 2020 2020 2065 7175 6976   :.        equiv
+00010020: 616c 656e 7420 6d65 7468 6f64 730a 2020  alent methods.  
+00010030: 2020 2222 220a 2020 2020 6672 6f6d 2078    """.    from x
+00010040: 6172 7261 792e 636f 7265 2e64 6174 6173  array.core.datas
+00010050: 6574 2069 6d70 6f72 7420 4461 7461 7365  et import Datase
+00010060: 740a 0a20 2020 2069 6620 6b65 6570 5f61  t..    if keep_a
+00010070: 7474 7273 2069 7320 4e6f 6e65 3a0a 2020  ttrs is None:.  
+00010080: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
+00010090: 203d 205f 6765 745f 6b65 6570 5f61 7474   = _get_keep_att
+000100a0: 7273 2864 6566 6175 6c74 3d46 616c 7365  rs(default=False
+000100b0: 290a 0a20 2020 2023 2061 6c69 676e 6d65  )..    # alignme
+000100c0: 6e74 2066 6f72 2074 6872 6565 2061 7267  nt for three arg
+000100d0: 756d 656e 7473 2069 7320 636f 6d70 6c69  uments is compli
+000100e0: 6361 7465 642c 2073 6f20 646f 6e27 7420  cated, so don't 
+000100f0: 7375 7070 6f72 7420 6974 2079 6574 0a20  support it yet. 
+00010100: 2020 2072 6573 756c 7420 3d20 6170 706c     result = appl
+00010110: 795f 7566 756e 6328 0a20 2020 2020 2020  y_ufunc(.       
+00010120: 2064 7563 6b5f 6172 7261 795f 6f70 732e   duck_array_ops.
+00010130: 7768 6572 652c 0a20 2020 2020 2020 2063  where,.        c
+00010140: 6f6e 642c 0a20 2020 2020 2020 2078 2c0a  ond,.        x,.
+00010150: 2020 2020 2020 2020 792c 0a20 2020 2020          y,.     
+00010160: 2020 206a 6f69 6e3d 2265 7861 6374 222c     join="exact",
+00010170: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+00010180: 5f6a 6f69 6e3d 2265 7861 6374 222c 0a20  _join="exact",. 
+00010190: 2020 2020 2020 2064 6173 6b3d 2261 6c6c         dask="all
+000101a0: 6f77 6564 222c 0a20 2020 2020 2020 206b  owed",.        k
+000101b0: 6565 705f 6174 7472 733d 6b65 6570 5f61  eep_attrs=keep_a
+000101c0: 7474 7273 2c0a 2020 2020 290a 0a20 2020  ttrs,.    )..   
+000101d0: 2023 206b 6565 7020 7468 6520 6174 7472   # keep the attr
+000101e0: 6962 7574 6573 206f 6620 782c 2074 6865  ibutes of x, the
+000101f0: 2073 6563 6f6e 6420 7061 7261 6d65 7465   second paramete
+00010200: 722c 2062 7920 6465 6661 756c 7420 746f  r, by default to
+00010210: 0a20 2020 2023 2062 6520 636f 6e73 6973  .    # be consis
+00010220: 7465 6e74 2077 6974 6820 7468 6520 6077  tent with the `w
+00010230: 6865 7265 6020 6d65 7468 6f64 206f 6620  here` method of 
+00010240: 6044 6174 6141 7272 6179 6020 616e 6420  `DataArray` and 
+00010250: 6044 6174 6173 6574 600a 2020 2020 2320  `Dataset`.    # 
+00010260: 7265 6275 696c 6420 7468 6520 6174 7472  rebuild the attr
+00010270: 7320 6672 6f6d 2078 2061 7420 6561 6368  s from x at each
+00010280: 206c 6576 656c 206f 6620 7468 6520 6f75   level of the ou
+00010290: 7470 7574 2c20 7768 6963 6820 636f 756c  tput, which coul
+000102a0: 6420 6265 0a20 2020 2023 2044 6174 6173  d be.    # Datas
+000102b0: 6574 2c20 4461 7461 4172 7261 792c 206f  et, DataArray, o
+000102c0: 7220 5661 7269 6162 6c65 2c20 616e 6420  r Variable, and 
+000102d0: 616c 736f 2068 616e 646c 6520 636f 6f72  also handle coor
+000102e0: 6473 0a20 2020 2069 6620 6b65 6570 5f61  ds.    if keep_a
+000102f0: 7474 7273 2069 7320 5472 7565 2061 6e64  ttrs is True and
+00010300: 2068 6173 6174 7472 2872 6573 756c 742c   hasattr(result,
+00010310: 2022 6174 7472 7322 293a 0a20 2020 2020   "attrs"):.     
+00010320: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00010330: 2879 2c20 4461 7461 7365 7429 2061 6e64  (y, Dataset) and
+00010340: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00010350: 782c 2044 6174 6173 6574 293a 0a20 2020  x, Dataset):.   
+00010360: 2020 2020 2020 2020 2023 2068 616e 646c           # handl
+00010370: 6520 7370 6563 6961 6c20 6361 7365 2077  e special case w
+00010380: 6865 7265 2078 2067 6574 7320 7072 6f6d  here x gets prom
+00010390: 6f74 6564 2074 6f20 4461 7461 7365 740a  oted to Dataset.
+000103a0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+000103b0: 6c74 2e61 7474 7273 203d 207b 7d0a 2020  lt.attrs = {}.  
+000103c0: 2020 2020 2020 2020 2020 6966 2067 6574            if get
+000103d0: 6174 7472 2878 2c20 226e 616d 6522 2c20  attr(x, "name", 
+000103e0: 4e6f 6e65 2920 696e 2072 6573 756c 742e  None) in result.
+000103f0: 6461 7461 5f76 6172 733a 0a20 2020 2020  data_vars:.     
+00010400: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00010410: 745b 782e 6e61 6d65 5d2e 6174 7472 7320  t[x.name].attrs 
+00010420: 3d20 6765 7461 7474 7228 782c 2022 6174  = getattr(x, "at
+00010430: 7472 7322 2c20 7b7d 290a 2020 2020 2020  trs", {}).      
+00010440: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00010450: 2020 2020 2320 6f74 6865 7277 6973 652c      # otherwise,
+00010460: 2066 696c 6c20 696e 2067 6c6f 6261 6c20   fill in global 
+00010470: 6174 7472 7320 616e 6420 7661 7269 6162  attrs and variab
+00010480: 6c65 2061 7474 7273 2028 6966 2074 6865  le attrs (if the
+00010490: 7920 6578 6973 7429 0a20 2020 2020 2020  y exist).       
+000104a0: 2020 2020 2072 6573 756c 742e 6174 7472       result.attr
+000104b0: 7320 3d20 6765 7461 7474 7228 782c 2022  s = getattr(x, "
+000104c0: 6174 7472 7322 2c20 7b7d 290a 2020 2020  attrs", {}).    
+000104d0: 2020 2020 2020 2020 666f 7220 7620 696e          for v in
+000104e0: 2067 6574 6174 7472 2872 6573 756c 742c   getattr(result,
+000104f0: 2022 6461 7461 5f76 6172 7322 2c20 5b5d   "data_vars", []
+00010500: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00010510: 2020 2072 6573 756c 745b 765d 2e61 7474     result[v].att
+00010520: 7273 203d 2067 6574 6174 7472 2867 6574  rs = getattr(get
+00010530: 6174 7472 2878 2c20 762c 204e 6f6e 6529  attr(x, v, None)
+00010540: 2c20 2261 7474 7273 222c 207b 7d29 0a20  , "attrs", {}). 
+00010550: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
+00010560: 6765 7461 7474 7228 7265 7375 6c74 2c20  getattr(result, 
+00010570: 2263 6f6f 7264 7322 2c20 5b5d 293a 0a20  "coords", []):. 
+00010580: 2020 2020 2020 2020 2020 2023 2061 6c77             # alw
+00010590: 6179 7320 6669 6c6c 2063 6f6f 7264 2061  ays fill coord a
+000105a0: 7474 7273 206f 6620 780a 2020 2020 2020  ttrs of x.      
+000105b0: 2020 2020 2020 7265 7375 6c74 5b63 5d2e        result[c].
+000105c0: 6174 7472 7320 3d20 6765 7461 7474 7228  attrs = getattr(
+000105d0: 6765 7461 7474 7228 782c 2063 2c20 4e6f  getattr(x, c, No
+000105e0: 6e65 292c 2022 6174 7472 7322 2c20 7b7d  ne), "attrs", {}
+000105f0: 290a 0a20 2020 2072 6574 7572 6e20 7265  )..    return re
+00010600: 7375 6c74 0a0a 0a40 6f76 6572 6c6f 6164  sult...@overload
+00010610: 0a64 6566 2070 6f6c 7976 616c 280a 2020  .def polyval(.  
+00010620: 2020 636f 6f72 643a 2044 6174 6141 7272    coord: DataArr
+00010630: 6179 2c20 636f 6566 6673 3a20 4461 7461  ay, coeffs: Data
+00010640: 4172 7261 792c 2064 6567 7265 655f 6469  Array, degree_di
+00010650: 6d3a 2048 6173 6861 626c 6520 3d20 2264  m: Hashable = "d
+00010660: 6567 7265 6522 0a29 202d 3e20 4461 7461  egree".) -> Data
+00010670: 4172 7261 793a 0a20 2020 202e 2e2e 0a0a  Array:.    .....
+00010680: 0a40 6f76 6572 6c6f 6164 0a64 6566 2070  .@overload.def p
+00010690: 6f6c 7976 616c 280a 2020 2020 636f 6f72  olyval(.    coor
+000106a0: 643a 2044 6174 6141 7272 6179 2c20 636f  d: DataArray, co
+000106b0: 6566 6673 3a20 4461 7461 7365 742c 2064  effs: Dataset, d
+000106c0: 6567 7265 655f 6469 6d3a 2048 6173 6861  egree_dim: Hasha
+000106d0: 626c 6520 3d20 2264 6567 7265 6522 0a29  ble = "degree".)
+000106e0: 202d 3e20 4461 7461 7365 743a 0a20 2020   -> Dataset:.   
+000106f0: 202e 2e2e 0a0a 0a40 6f76 6572 6c6f 6164   ......@overload
+00010700: 0a64 6566 2070 6f6c 7976 616c 280a 2020  .def polyval(.  
+00010710: 2020 636f 6f72 643a 2044 6174 6173 6574    coord: Dataset
+00010720: 2c20 636f 6566 6673 3a20 4461 7461 4172  , coeffs: DataAr
+00010730: 7261 792c 2064 6567 7265 655f 6469 6d3a  ray, degree_dim:
+00010740: 2048 6173 6861 626c 6520 3d20 2264 6567   Hashable = "deg
+00010750: 7265 6522 0a29 202d 3e20 4461 7461 7365  ree".) -> Datase
+00010760: 743a 0a20 2020 202e 2e2e 0a0a 0a40 6f76  t:.    ......@ov
+00010770: 6572 6c6f 6164 0a64 6566 2070 6f6c 7976  erload.def polyv
+00010780: 616c 280a 2020 2020 636f 6f72 643a 2044  al(.    coord: D
+00010790: 6174 6173 6574 2c20 636f 6566 6673 3a20  ataset, coeffs: 
+000107a0: 4461 7461 7365 742c 2064 6567 7265 655f  Dataset, degree_
+000107b0: 6469 6d3a 2048 6173 6861 626c 6520 3d20  dim: Hashable = 
+000107c0: 2264 6567 7265 6522 0a29 202d 3e20 4461  "degree".) -> Da
+000107d0: 7461 7365 743a 0a20 2020 202e 2e2e 0a0a  taset:.    .....
+000107e0: 0a40 6f76 6572 6c6f 6164 0a64 6566 2070  .@overload.def p
+000107f0: 6f6c 7976 616c 280a 2020 2020 636f 6f72  olyval(.    coor
+00010800: 643a 2044 6174 6173 6574 207c 2044 6174  d: Dataset | Dat
+00010810: 6141 7272 6179 2c0a 2020 2020 636f 6566  aArray,.    coef
+00010820: 6673 3a20 4461 7461 7365 7420 7c20 4461  fs: Dataset | Da
+00010830: 7461 4172 7261 792c 0a20 2020 2064 6567  taArray,.    deg
+00010840: 7265 655f 6469 6d3a 2048 6173 6861 626c  ree_dim: Hashabl
+00010850: 6520 3d20 2264 6567 7265 6522 2c0a 2920  e = "degree",.) 
+00010860: 2d3e 2044 6174 6173 6574 207c 2044 6174  -> Dataset | Dat
+00010870: 6141 7272 6179 3a0a 2020 2020 2e2e 2e0a  aArray:.    ....
+00010880: 0a0a 6465 6620 706f 6c79 7661 6c28 0a20  ..def polyval(. 
+00010890: 2020 2063 6f6f 7264 3a20 4461 7461 7365     coord: Datase
+000108a0: 7420 7c20 4461 7461 4172 7261 792c 0a20  t | DataArray,. 
+000108b0: 2020 2063 6f65 6666 733a 2044 6174 6173     coeffs: Datas
+000108c0: 6574 207c 2044 6174 6141 7272 6179 2c0a  et | DataArray,.
+000108d0: 2020 2020 6465 6772 6565 5f64 696d 3a20      degree_dim: 
+000108e0: 4861 7368 6162 6c65 203d 2022 6465 6772  Hashable = "degr
+000108f0: 6565 222c 0a29 202d 3e20 4461 7461 7365  ee",.) -> Datase
+00010900: 7420 7c20 4461 7461 4172 7261 793a 0a20  t | DataArray:. 
+00010910: 2020 2022 2222 4576 616c 7561 7465 2061     """Evaluate a
+00010920: 2070 6f6c 796e 6f6d 6961 6c20 6174 2073   polynomial at s
+00010930: 7065 6369 6669 6320 7661 6c75 6573 0a0a  pecific values..
+00010940: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00010950: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00010960: 2020 636f 6f72 6420 3a20 4461 7461 4172    coord : DataAr
+00010970: 7261 7920 6f72 2044 6174 6173 6574 0a20  ray or Dataset. 
+00010980: 2020 2020 2020 2056 616c 7565 7320 6174         Values at
+00010990: 2077 6869 6368 2074 6f20 6576 616c 7561   which to evalua
+000109a0: 7465 2074 6865 2070 6f6c 796e 6f6d 6961  te the polynomia
+000109b0: 6c2e 0a20 2020 2063 6f65 6666 7320 3a20  l..    coeffs : 
+000109c0: 4461 7461 4172 7261 7920 6f72 2044 6174  DataArray or Dat
+000109d0: 6173 6574 0a20 2020 2020 2020 2043 6f65  aset.        Coe
+000109e0: 6666 6963 6965 6e74 7320 6f66 2074 6865  fficients of the
+000109f0: 2070 6f6c 796e 6f6d 6961 6c2e 0a20 2020   polynomial..   
+00010a00: 2064 6567 7265 655f 6469 6d20 3a20 4861   degree_dim : Ha
+00010a10: 7368 6162 6c65 2c20 6465 6661 756c 743a  shable, default:
+00010a20: 2022 6465 6772 6565 220a 2020 2020 2020   "degree".      
+00010a30: 2020 4e61 6d65 206f 6620 7468 6520 706f    Name of the po
+00010a40: 6c79 6e6f 6d69 616c 2064 6567 7265 6520  lynomial degree 
+00010a50: 6469 6d65 6e73 696f 6e20 696e 2060 636f  dimension in `co
+00010a60: 6566 6673 602e 0a0a 2020 2020 5265 7475  effs`...    Retu
+00010a70: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+00010a80: 2020 2020 4461 7461 4172 7261 7920 6f72      DataArray or
+00010a90: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
+00010aa0: 2045 7661 6c75 6174 6564 2070 6f6c 796e   Evaluated polyn
+00010ab0: 6f6d 6961 6c2e 0a0a 2020 2020 5365 6520  omial...    See 
+00010ac0: 416c 736f 0a20 2020 202d 2d2d 2d2d 2d2d  Also.    -------
+00010ad0: 2d0a 2020 2020 7861 7272 6179 2e44 6174  -.    xarray.Dat
+00010ae0: 6141 7272 6179 2e70 6f6c 7966 6974 0a20  aArray.polyfit. 
+00010af0: 2020 206e 756d 7079 2e70 6f6c 796e 6f6d     numpy.polynom
+00010b00: 6961 6c2e 706f 6c79 6e6f 6d69 616c 2e70  ial.polynomial.p
+00010b10: 6f6c 7976 616c 0a20 2020 2022 2222 0a0a  olyval.    """..
+00010b20: 2020 2020 6966 2064 6567 7265 655f 6469      if degree_di
+00010b30: 6d20 6e6f 7420 696e 2063 6f65 6666 732e  m not in coeffs.
+00010b40: 5f69 6e64 6578 6573 3a0a 2020 2020 2020  _indexes:.      
+00010b50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00010b60: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00010b70: 6622 4469 6d65 6e73 696f 6e20 607b 6465  f"Dimension `{de
+00010b80: 6772 6565 5f64 696d 7d60 2073 686f 756c  gree_dim}` shoul
+00010b90: 6420 6265 2061 2063 6f6f 7264 696e 6174  d be a coordinat
+00010ba0: 6520 7661 7269 6162 6c65 2077 6974 6820  e variable with 
+00010bb0: 6c61 6265 6c73 2e22 0a20 2020 2020 2020  labels.".       
+00010bc0: 2029 0a20 2020 2069 6620 6e6f 7420 6e70   ).    if not np
+00010bd0: 2e69 7373 7562 6474 7970 6528 636f 6566  .issubdtype(coef
+00010be0: 6673 5b64 6567 7265 655f 6469 6d5d 2e64  fs[degree_dim].d
+00010bf0: 7479 7065 2c20 6e70 2e69 6e74 6567 6572  type, np.integer
+00010c00: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
+00010c10: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00010c20: 2020 2020 2020 2020 2066 2244 696d 656e           f"Dimen
+00010c30: 7369 6f6e 2060 7b64 6567 7265 655f 6469  sion `{degree_di
+00010c40: 6d7d 6020 7368 6f75 6c64 2062 6520 6f66  m}` should be of
+00010c50: 2069 6e74 6567 6572 2064 7479 7065 2e20   integer dtype. 
+00010c60: 5265 6365 6976 6564 207b 636f 6566 6673  Received {coeffs
+00010c70: 5b64 6567 7265 655f 6469 6d5d 2e64 7479  [degree_dim].dty
+00010c80: 7065 7d20 696e 7374 6561 642e 220a 2020  pe} instead.".  
+00010c90: 2020 2020 2020 290a 2020 2020 6d61 785f        ).    max_
+00010ca0: 6465 6720 3d20 636f 6566 6673 5b64 6567  deg = coeffs[deg
+00010cb0: 7265 655f 6469 6d5d 2e6d 6178 2829 2e69  ree_dim].max().i
+00010cc0: 7465 6d28 290a 2020 2020 636f 6566 6673  tem().    coeffs
+00010cd0: 203d 2063 6f65 6666 732e 7265 696e 6465   = coeffs.reinde
+00010ce0: 7828 0a20 2020 2020 2020 207b 6465 6772  x(.        {degr
+00010cf0: 6565 5f64 696d 3a20 6e70 2e61 7261 6e67  ee_dim: np.arang
+00010d00: 6528 6d61 785f 6465 6720 2b20 3129 7d2c  e(max_deg + 1)},
+00010d10: 2066 696c 6c5f 7661 6c75 653d 302c 2063   fill_value=0, c
+00010d20: 6f70 793d 4661 6c73 650a 2020 2020 290a  opy=False.    ).
+00010d30: 2020 2020 636f 6f72 6420 3d20 5f65 6e73      coord = _ens
+00010d40: 7572 655f 6e75 6d65 7269 6328 636f 6f72  ure_numeric(coor
+00010d50: 6429 0a0a 2020 2020 2320 7573 696e 6720  d)..    # using 
+00010d60: 486f 726e 6572 2773 206d 6574 686f 640a  Horner's method.
+00010d70: 2020 2020 2320 6874 7470 733a 2f2f 656e      # https://en
+00010d80: 2e77 696b 6970 6564 6961 2e6f 7267 2f77  .wikipedia.org/w
+00010d90: 696b 692f 486f 726e 6572 2532 3773 5f6d  iki/Horner%27s_m
+00010da0: 6574 686f 640a 2020 2020 7265 7320 3d20  ethod.    res = 
+00010db0: 7a65 726f 735f 6c69 6b65 2863 6f6f 7264  zeros_like(coord
+00010dc0: 2920 2b20 636f 6566 6673 2e69 7365 6c28  ) + coeffs.isel(
+00010dd0: 7b64 6567 7265 655f 6469 6d3a 206d 6178  {degree_dim: max
+00010de0: 5f64 6567 7d2c 2064 726f 703d 5472 7565  _deg}, drop=True
+00010df0: 290a 2020 2020 666f 7220 6465 6720 696e  ).    for deg in
+00010e00: 2072 616e 6765 286d 6178 5f64 6567 202d   range(max_deg -
+00010e10: 2031 2c20 2d31 2c20 2d31 293a 0a20 2020   1, -1, -1):.   
+00010e20: 2020 2020 2072 6573 202a 3d20 636f 6f72       res *= coor
+00010e30: 640a 2020 2020 2020 2020 7265 7320 2b3d  d.        res +=
+00010e40: 2063 6f65 6666 732e 6973 656c 287b 6465   coeffs.isel({de
+00010e50: 6772 6565 5f64 696d 3a20 6465 677d 2c20  gree_dim: deg}, 
+00010e60: 6472 6f70 3d54 7275 6529 0a0a 2020 2020  drop=True)..    
+00010e70: 7265 7475 726e 2072 6573 0a0a 0a64 6566  return res...def
+00010e80: 205f 656e 7375 7265 5f6e 756d 6572 6963   _ensure_numeric
+00010e90: 2864 6174 613a 2044 6174 6173 6574 207c  (data: Dataset |
+00010ea0: 2044 6174 6141 7272 6179 2920 2d3e 2044   DataArray) -> D
+00010eb0: 6174 6173 6574 207c 2044 6174 6141 7272  ataset | DataArr
+00010ec0: 6179 3a0a 2020 2020 2222 2243 6f6e 7665  ay:.    """Conve
+00010ed0: 7274 7320 616c 6c20 6461 7465 7469 6d65  rts all datetime
+00010ee0: 3634 2076 6172 6961 626c 6573 2074 6f20  64 variables to 
+00010ef0: 666c 6f61 7436 340a 0a20 2020 2050 6172  float64..    Par
+00010f00: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00010f10: 2d2d 2d2d 2d2d 0a20 2020 2064 6174 6120  ------.    data 
+00010f20: 3a20 4461 7461 4172 7261 7920 6f72 2044  : DataArray or D
+00010f30: 6174 6173 6574 0a20 2020 2020 2020 2056  ataset.        V
+00010f40: 6172 6961 626c 6573 2077 6974 6820 706f  ariables with po
+00010f50: 7373 6962 6c65 2064 6174 6574 696d 6520  ssible datetime 
+00010f60: 6474 7970 6573 2e0a 0a20 2020 2052 6574  dtypes...    Ret
+00010f70: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+00010f80: 0a20 2020 2044 6174 6141 7272 6179 206f  .    DataArray o
+00010f90: 7220 4461 7461 7365 740a 2020 2020 2020  r Dataset.      
+00010fa0: 2020 5661 7269 6162 6c65 7320 7769 7468    Variables with
+00010fb0: 2064 6174 6574 696d 6536 3420 6474 7970   datetime64 dtyp
+00010fc0: 6573 2063 6f6e 7665 7274 6564 2074 6f20  es converted to 
+00010fd0: 666c 6f61 7436 342e 0a20 2020 2022 2222  float64..    """
+00010fe0: 0a20 2020 2066 726f 6d20 7861 7272 6179  .    from xarray
+00010ff0: 2e63 6f72 652e 6461 7461 7365 7420 696d  .core.dataset im
+00011000: 706f 7274 2044 6174 6173 6574 0a0a 2020  port Dataset..  
+00011010: 2020 6465 6620 5f63 666f 6666 7365 7428    def _cfoffset(
+00011020: 783a 2044 6174 6141 7272 6179 2920 2d3e  x: DataArray) ->
+00011030: 2041 6e79 3a0a 2020 2020 2020 2020 7363   Any:.        sc
+00011040: 616c 6172 203d 2078 2e63 6f6d 7075 7465  alar = x.compute
+00011050: 2829 2e64 6174 615b 305d 0a20 2020 2020  ().data[0].     
+00011060: 2020 2069 6620 6e6f 7420 6973 5f73 6361     if not is_sca
+00011070: 6c61 7228 7363 616c 6172 293a 0a20 2020  lar(scalar):.   
+00011080: 2020 2020 2020 2020 2023 2077 6520 646f           # we do
+00011090: 206e 6f74 2067 6574 2061 2073 6361 6c61   not get a scala
+000110a0: 7220 6261 636b 206f 6e20 6461 736b 203d  r back on dask =
+000110b0: 3d20 3230 3231 2e30 342e 310a 2020 2020  = 2021.04.1.    
+000110c0: 2020 2020 2020 2020 7363 616c 6172 203d          scalar =
+000110d0: 2073 6361 6c61 722e 6974 656d 2829 0a20   scalar.item(). 
+000110e0: 2020 2020 2020 2072 6574 7572 6e20 7479         return ty
+000110f0: 7065 2873 6361 6c61 7229 2831 3937 302c  pe(scalar)(1970,
+00011100: 2031 2c20 3129 0a0a 2020 2020 6465 6620   1, 1)..    def 
+00011110: 746f 5f66 6c6f 6174 6162 6c65 2878 3a20  to_floatable(x: 
+00011120: 4461 7461 4172 7261 7929 202d 3e20 4461  DataArray) -> Da
+00011130: 7461 4172 7261 793a 0a20 2020 2020 2020  taArray:.       
+00011140: 2069 6620 782e 6474 7970 652e 6b69 6e64   if x.dtype.kind
+00011150: 2069 6e20 224d 4f22 3a0a 2020 2020 2020   in "MO":.      
+00011160: 2020 2020 2020 2320 6461 7465 7469 6d65        # datetime
+00011170: 7320 2843 4649 6e64 6578 6573 2061 7265  s (CFIndexes are
+00011180: 206f 626a 6563 7420 7479 7065 290a 2020   object type).  
+00011190: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
+000111a0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+000111b0: 2020 2020 206e 702e 6461 7465 7469 6d65       np.datetime
+000111c0: 3634 2822 3139 3730 2d30 312d 3031 2229  64("1970-01-01")
+000111d0: 2069 6620 782e 6474 7970 652e 6b69 6e64   if x.dtype.kind
+000111e0: 203d 3d20 224d 2220 656c 7365 205f 6366   == "M" else _cf
+000111f0: 6f66 6673 6574 2878 290a 2020 2020 2020  offset(x).      
+00011200: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011210: 2020 2020 7265 7475 726e 2078 2e63 6f70      return x.cop
+00011220: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
+00011230: 2020 2064 6174 613d 6461 7465 7469 6d65     data=datetime
+00011240: 5f74 6f5f 6e75 6d65 7269 6328 782e 6461  _to_numeric(x.da
+00011250: 7461 2c20 6f66 6673 6574 3d6f 6666 7365  ta, offset=offse
+00011260: 742c 2064 6174 6574 696d 655f 756e 6974  t, datetime_unit
+00011270: 3d22 6e73 2229 2c0a 2020 2020 2020 2020  ="ns"),.        
+00011280: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+00011290: 6966 2078 2e64 7479 7065 2e6b 696e 6420  if x.dtype.kind 
+000112a0: 3d3d 2022 6d22 3a0a 2020 2020 2020 2020  == "m":.        
+000112b0: 2020 2020 2320 7469 6d65 6465 6c74 6173      # timedeltas
+000112c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000112d0: 7572 6e20 6475 636b 5f61 7272 6179 5f6f  urn duck_array_o
+000112e0: 7073 2e61 7374 7970 6528 782c 2064 7479  ps.astype(x, dty
+000112f0: 7065 3d66 6c6f 6174 290a 2020 2020 2020  pe=float).      
+00011300: 2020 7265 7475 726e 2078 0a0a 2020 2020    return x..    
+00011310: 6966 2069 7369 6e73 7461 6e63 6528 6461  if isinstance(da
+00011320: 7461 2c20 4461 7461 7365 7429 3a0a 2020  ta, Dataset):.  
+00011330: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
+00011340: 612e 6d61 7028 746f 5f66 6c6f 6174 6162  a.map(to_floatab
+00011350: 6c65 290a 2020 2020 656c 7365 3a0a 2020  le).    else:.  
+00011360: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
+00011370: 666c 6f61 7461 626c 6528 6461 7461 290a  floatable(data).
+00011380: 0a0a 6465 6620 5f63 616c 635f 6964 786d  ..def _calc_idxm
+00011390: 696e 6d61 7828 0a20 2020 202a 2c0a 2020  inmax(.    *,.  
+000113a0: 2020 6172 7261 792c 0a20 2020 2066 756e    array,.    fun
+000113b0: 633a 2043 616c 6c61 626c 652c 0a20 2020  c: Callable,.   
+000113c0: 2064 696d 3a20 4861 7368 6162 6c65 207c   dim: Hashable |
+000113d0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+000113e0: 2020 736b 6970 6e61 3a20 626f 6f6c 207c    skipna: bool |
+000113f0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00011400: 2020 6669 6c6c 5f76 616c 7565 3a20 416e    fill_value: An
+00011410: 7920 3d20 6474 7970 6573 2e4e 412c 0a20  y = dtypes.NA,. 
+00011420: 2020 206b 6565 705f 6174 7472 733a 2062     keep_attrs: b
+00011430: 6f6f 6c20 7c20 4e6f 6e65 203d 204e 6f6e  ool | None = Non
+00011440: 652c 0a29 3a0a 2020 2020 2222 2241 7070  e,.):.    """App
+00011450: 6c79 2063 6f6d 6d6f 6e20 6f70 6572 6174  ly common operat
+00011460: 696f 6e73 2066 6f72 2069 6478 6d69 6e20  ions for idxmin 
+00011470: 616e 6420 6964 786d 6178 2e22 2222 0a20  and idxmax.""". 
+00011480: 2020 2023 2054 6869 7320 6675 6e63 7469     # This functi
+00011490: 6f6e 2064 6f65 736e 2774 206d 616b 6520  on doesn't make 
+000114a0: 7365 6e73 6520 666f 7220 7363 616c 6172  sense for scalar
+000114b0: 7320 736f 2064 6f6e 2774 2074 7279 0a20  s so don't try. 
+000114c0: 2020 2069 6620 6e6f 7420 6172 7261 792e     if not array.
+000114d0: 6e64 696d 3a0a 2020 2020 2020 2020 7261  ndim:.        ra
+000114e0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+000114f0: 5468 6973 2066 756e 6374 696f 6e20 646f  This function do
+00011500: 6573 206e 6f74 2061 7070 6c79 2066 6f72  es not apply for
+00011510: 2073 6361 6c61 7273 2229 0a0a 2020 2020   scalars")..    
+00011520: 6966 2064 696d 2069 7320 6e6f 7420 4e6f  if dim is not No
+00011530: 6e65 3a0a 2020 2020 2020 2020 7061 7373  ne:.        pass
+00011540: 2020 2320 5573 6520 7468 6520 6469 6d20    # Use the dim 
+00011550: 6966 2061 7661 696c 6162 6c65 0a20 2020  if available.   
+00011560: 2065 6c69 6620 6172 7261 792e 6e64 696d   elif array.ndim
+00011570: 203d 3d20 313a 0a20 2020 2020 2020 2023   == 1:.        #
+00011580: 2069 7420 6973 206f 6b61 7920 746f 2067   it is okay to g
+00011590: 7565 7373 2074 6865 2064 696d 2069 6620  uess the dim if 
+000115a0: 7468 6572 6520 6973 206f 6e6c 7920 310a  there is only 1.
+000115b0: 2020 2020 2020 2020 6469 6d20 3d20 6172          dim = ar
+000115c0: 7261 792e 6469 6d73 5b30 5d0a 2020 2020  ray.dims[0].    
+000115d0: 656c 7365 3a0a 2020 2020 2020 2020 2320  else:.        # 
+000115e0: 5468 6520 6469 6d20 6973 206e 6f74 2073  The dim is not s
+000115f0: 7065 6369 6669 6564 2061 6e64 2061 6d62  pecified and amb
+00011600: 6967 756f 7573 2e20 2044 6f6e 2774 2067  iguous.  Don't g
+00011610: 7565 7373 2e0a 2020 2020 2020 2020 7261  uess..        ra
+00011620: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00011630: 4d75 7374 2073 7570 706c 7920 2764 696d  Must supply 'dim
+00011640: 2720 6172 6775 6d65 6e74 2066 6f72 206d  ' argument for m
+00011650: 756c 7469 6469 6d65 6e73 696f 6e61 6c20  ultidimensional 
+00011660: 6172 7261 7973 2229 0a0a 2020 2020 6966  arrays")..    if
+00011670: 2064 696d 206e 6f74 2069 6e20 6172 7261   dim not in arra
+00011680: 792e 6469 6d73 3a0a 2020 2020 2020 2020  y.dims:.        
+00011690: 7261 6973 6520 4b65 7945 7272 6f72 2866  raise KeyError(f
+000116a0: 2744 696d 656e 7369 6f6e 2022 7b64 696d  'Dimension "{dim
+000116b0: 7d22 206e 6f74 2069 6e20 6469 6d65 6e73  }" not in dimens
+000116c0: 696f 6e27 290a 2020 2020 6966 2064 696d  ion').    if dim
+000116d0: 206e 6f74 2069 6e20 6172 7261 792e 636f   not in array.co
+000116e0: 6f72 6473 3a0a 2020 2020 2020 2020 7261  ords:.        ra
+000116f0: 6973 6520 4b65 7945 7272 6f72 2866 2744  ise KeyError(f'D
+00011700: 696d 656e 7369 6f6e 2022 7b64 696d 7d22  imension "{dim}"
+00011710: 2064 6f65 7320 6e6f 7420 6861 7665 2063   does not have c
+00011720: 6f6f 7264 696e 6174 6573 2729 0a0a 2020  oordinates')..  
+00011730: 2020 2320 5468 6573 6520 6172 6520 6474    # These are dt
+00011740: 7970 6573 2077 6974 6820 4e61 4e20 7661  ypes with NaN va
+00011750: 6c75 6573 2061 7267 6d69 6e20 616e 6420  lues argmin and 
+00011760: 6172 676d 6178 2063 616e 2068 616e 646c  argmax can handl
+00011770: 650a 2020 2020 6e61 5f64 7479 7065 7320  e.    na_dtypes 
+00011780: 3d20 2263 664f 220a 0a20 2020 2069 6620  = "cfO"..    if 
+00011790: 736b 6970 6e61 206f 7220 2873 6b69 706e  skipna or (skipn
+000117a0: 6120 6973 204e 6f6e 6520 616e 6420 6172  a is None and ar
+000117b0: 7261 792e 6474 7970 652e 6b69 6e64 2069  ray.dtype.kind i
+000117c0: 6e20 6e61 5f64 7479 7065 7329 3a0a 2020  n na_dtypes):.  
+000117d0: 2020 2020 2020 2320 4e65 6564 2074 6f20        # Need to 
+000117e0: 736b 6970 204e 614e 2076 616c 7565 7320  skip NaN values 
+000117f0: 7369 6e63 6520 6172 676d 696e 2061 6e64  since argmin and
+00011800: 2061 7267 6d61 7820 6361 6e27 7420 6861   argmax can't ha
+00011810: 6e64 6c65 2074 6865 6d0a 2020 2020 2020  ndle them.      
+00011820: 2020 616c 6c6e 6120 3d20 6172 7261 792e    allna = array.
+00011830: 6973 6e75 6c6c 2829 2e61 6c6c 2864 696d  isnull().all(dim
+00011840: 290a 2020 2020 2020 2020 6172 7261 7920  ).        array 
+00011850: 3d20 6172 7261 792e 7768 6572 6528 7e61  = array.where(~a
+00011860: 6c6c 6e61 2c20 3029 0a0a 2020 2020 2320  llna, 0)..    # 
+00011870: 5468 6973 2077 696c 6c20 7275 6e20 6172  This will run ar
+00011880: 676d 696e 206f 7220 6172 676d 6178 2e0a  gmin or argmax..
+00011890: 2020 2020 696e 6478 203d 2066 756e 6328      indx = func(
+000118a0: 6172 7261 792c 2064 696d 3d64 696d 2c20  array, dim=dim, 
+000118b0: 6178 6973 3d4e 6f6e 652c 206b 6565 705f  axis=None, keep_
+000118c0: 6174 7472 733d 6b65 6570 5f61 7474 7273  attrs=keep_attrs
+000118d0: 2c20 736b 6970 6e61 3d73 6b69 706e 6129  , skipna=skipna)
+000118e0: 0a0a 2020 2020 2320 4861 6e64 6c65 2063  ..    # Handle c
+000118f0: 6875 6e6b 6564 2061 7272 6179 7320 2865  hunked arrays (e
+00011900: 2e67 2e20 6461 736b 292e 0a20 2020 2069  .g. dask)..    i
+00011910: 6620 6973 5f63 6875 6e6b 6564 5f61 7272  f is_chunked_arr
+00011920: 6179 2861 7272 6179 2e64 6174 6129 3a0a  ay(array.data):.
+00011930: 2020 2020 2020 2020 6368 756e 6b6d 616e          chunkman
+00011940: 6167 6572 203d 2067 6574 5f63 6875 6e6b  ager = get_chunk
+00011950: 6564 5f61 7272 6179 5f74 7970 6528 6172  ed_array_type(ar
+00011960: 7261 792e 6461 7461 290a 2020 2020 2020  ray.data).      
+00011970: 2020 6368 756e 6b73 203d 2064 6963 7428    chunks = dict(
+00011980: 7a69 7028 6172 7261 792e 6469 6d73 2c20  zip(array.dims, 
+00011990: 6172 7261 792e 6368 756e 6b73 2929 0a20  array.chunks)). 
+000119a0: 2020 2020 2020 2064 6173 6b5f 636f 6f72         dask_coor
+000119b0: 6420 3d20 6368 756e 6b6d 616e 6167 6572  d = chunkmanager
+000119c0: 2e66 726f 6d5f 6172 7261 7928 6172 7261  .from_array(arra
+000119d0: 795b 6469 6d5d 2e64 6174 612c 2063 6875  y[dim].data, chu
+000119e0: 6e6b 733d 6368 756e 6b73 5b64 696d 5d29  nks=chunks[dim])
+000119f0: 0a20 2020 2020 2020 2072 6573 203d 2069  .        res = i
+00011a00: 6e64 782e 636f 7079 2864 6174 613d 6461  ndx.copy(data=da
+00011a10: 736b 5f63 6f6f 7264 5b69 6e64 782e 6461  sk_coord[indx.da
+00011a20: 7461 2e72 6176 656c 2829 5d2e 7265 7368  ta.ravel()].resh
+00011a30: 6170 6528 696e 6478 2e73 6861 7065 2929  ape(indx.shape))
+00011a40: 0a20 2020 2020 2020 2023 2077 6520 6e65  .        # we ne
+00011a50: 6564 2074 6f20 6174 7461 6368 2062 6163  ed to attach bac
+00011a60: 6b20 7468 6520 6469 6d20 6e61 6d65 0a20  k the dim name. 
+00011a70: 2020 2020 2020 2072 6573 2e6e 616d 6520         res.name 
+00011a80: 3d20 6469 6d0a 2020 2020 656c 7365 3a0a  = dim.    else:.
+00011a90: 2020 2020 2020 2020 7265 7320 3d20 6172          res = ar
+00011aa0: 7261 795b 6469 6d5d 5b28 696e 6478 2c29  ray[dim][(indx,)
+00011ab0: 5d0a 2020 2020 2020 2020 2320 5468 6520  ].        # The 
+00011ac0: 6469 6d20 6973 2067 6f6e 6520 6275 7420  dim is gone but 
+00011ad0: 7765 206e 6565 6420 746f 2072 656d 6f76  we need to remov
+00011ae0: 6520 7468 6520 636f 7272 6573 706f 6e64  e the correspond
+00011af0: 696e 6720 636f 6f72 6469 6e61 7465 2e0a  ing coordinate..
+00011b00: 2020 2020 2020 2020 6465 6c20 7265 732e          del res.
+00011b10: 636f 6f72 6473 5b64 696d 5d0a 0a20 2020  coords[dim]..   
+00011b20: 2069 6620 736b 6970 6e61 206f 7220 2873   if skipna or (s
+00011b30: 6b69 706e 6120 6973 204e 6f6e 6520 616e  kipna is None an
+00011b40: 6420 6172 7261 792e 6474 7970 652e 6b69  d array.dtype.ki
+00011b50: 6e64 2069 6e20 6e61 5f64 7479 7065 7329  nd in na_dtypes)
+00011b60: 3a0a 2020 2020 2020 2020 2320 5075 7420  :.        # Put 
+00011b70: 7468 6520 4e61 4e20 7661 6c75 6573 2062  the NaN values b
+00011b80: 6163 6b20 696e 2061 6674 6572 2072 656d  ack in after rem
+00011b90: 6f76 696e 6720 7468 656d 0a20 2020 2020  oving them.     
+00011ba0: 2020 2072 6573 203d 2072 6573 2e77 6865     res = res.whe
+00011bb0: 7265 287e 616c 6c6e 612c 2066 696c 6c5f  re(~allna, fill_
+00011bc0: 7661 6c75 6529 0a0a 2020 2020 2320 436f  value)..    # Co
+00011bd0: 7079 2061 7474 7269 6275 7465 7320 6672  py attributes fr
+00011be0: 6f6d 2061 7267 6d69 6e2f 6172 676d 6178  om argmin/argmax
+00011bf0: 2c20 6966 2061 6e79 0a20 2020 2072 6573  , if any.    res
+00011c00: 2e61 7474 7273 203d 2069 6e64 782e 6174  .attrs = indx.at
+00011c10: 7472 730a 0a20 2020 2072 6574 7572 6e20  trs..    return 
+00011c20: 7265 730a 0a0a 5f54 203d 2054 7970 6556  res..._T = TypeV
+00011c30: 6172 2822 5f54 222c 2062 6f75 6e64 3d55  ar("_T", bound=U
+00011c40: 6e69 6f6e 5b22 4461 7461 7365 7422 2c20  nion["Dataset", 
+00011c50: 2244 6174 6141 7272 6179 225d 290a 5f55  "DataArray"])._U
+00011c60: 203d 2054 7970 6556 6172 2822 5f55 222c   = TypeVar("_U",
+00011c70: 2062 6f75 6e64 3d55 6e69 6f6e 5b22 4461   bound=Union["Da
+00011c80: 7461 7365 7422 2c20 2244 6174 6141 7272  taset", "DataArr
+00011c90: 6179 225d 290a 5f56 203d 2054 7970 6556  ay"])._V = TypeV
+00011ca0: 6172 2822 5f56 222c 2062 6f75 6e64 3d55  ar("_V", bound=U
+00011cb0: 6e69 6f6e 5b22 4461 7461 7365 7422 2c20  nion["Dataset", 
+00011cc0: 2244 6174 6141 7272 6179 225d 290a 0a0a  "DataArray"])...
+00011cd0: 406f 7665 726c 6f61 640a 6465 6620 756e  @overload.def un
+00011ce0: 6966 795f 6368 756e 6b73 285f 5f6f 626a  ify_chunks(__obj
+00011cf0: 3a20 5f54 2920 2d3e 2074 7570 6c65 5b5f  : _T) -> tuple[_
+00011d00: 545d 3a0a 2020 2020 2e2e 2e0a 0a0a 406f  T]:.    ......@o
+00011d10: 7665 726c 6f61 640a 6465 6620 756e 6966  verload.def unif
+00011d20: 795f 6368 756e 6b73 285f 5f6f 626a 313a  y_chunks(__obj1:
+00011d30: 205f 542c 205f 5f6f 626a 323a 205f 5529   _T, __obj2: _U)
+00011d40: 202d 3e20 7475 706c 655b 5f54 2c20 5f55   -> tuple[_T, _U
+00011d50: 5d3a 0a20 2020 202e 2e2e 0a0a 0a40 6f76  ]:.    ......@ov
+00011d60: 6572 6c6f 6164 0a64 6566 2075 6e69 6679  erload.def unify
+00011d70: 5f63 6875 6e6b 7328 5f5f 6f62 6a31 3a20  _chunks(__obj1: 
+00011d80: 5f54 2c20 5f5f 6f62 6a32 3a20 5f55 2c20  _T, __obj2: _U, 
+00011d90: 5f5f 6f62 6a33 3a20 5f56 2920 2d3e 2074  __obj3: _V) -> t
+00011da0: 7570 6c65 5b5f 542c 205f 552c 205f 565d  uple[_T, _U, _V]
+00011db0: 3a0a 2020 2020 2e2e 2e0a 0a0a 406f 7665  :.    ......@ove
+00011dc0: 726c 6f61 640a 6465 6620 756e 6966 795f  rload.def unify_
+00011dd0: 6368 756e 6b73 282a 6f62 6a65 6374 733a  chunks(*objects:
+00011de0: 2044 6174 6173 6574 207c 2044 6174 6141   Dataset | DataA
+00011df0: 7272 6179 2920 2d3e 2074 7570 6c65 5b44  rray) -> tuple[D
+00011e00: 6174 6173 6574 207c 2044 6174 6141 7272  ataset | DataArr
+00011e10: 6179 2c20 2e2e 2e5d 3a0a 2020 2020 2e2e  ay, ...]:.    ..
+00011e20: 2e0a 0a0a 6465 6620 756e 6966 795f 6368  ....def unify_ch
+00011e30: 756e 6b73 282a 6f62 6a65 6374 733a 2044  unks(*objects: D
+00011e40: 6174 6173 6574 207c 2044 6174 6141 7272  ataset | DataArr
+00011e50: 6179 2920 2d3e 2074 7570 6c65 5b44 6174  ay) -> tuple[Dat
+00011e60: 6173 6574 207c 2044 6174 6141 7272 6179  aset | DataArray
+00011e70: 2c20 2e2e 2e5d 3a0a 2020 2020 2222 220a  , ...]:.    """.
+00011e80: 2020 2020 4769 7665 6e20 616e 7920 6e75      Given any nu
+00011e90: 6d62 6572 206f 6620 4461 7461 7365 7420  mber of Dataset 
+00011ea0: 616e 642f 6f72 2044 6174 6141 7272 6179  and/or DataArray
+00011eb0: 206f 626a 6563 7473 2c20 7265 7475 726e   objects, return
+00011ec0: 730a 2020 2020 6e65 7720 6f62 6a65 6374  s.    new object
+00011ed0: 7320 7769 7468 2075 6e69 6669 6564 2063  s with unified c
+00011ee0: 6875 6e6b 2073 697a 6520 616c 6f6e 6720  hunk size along 
+00011ef0: 616c 6c20 6368 756e 6b65 6420 6469 6d65  all chunked dime
+00011f00: 6e73 696f 6e73 2e0a 0a20 2020 2052 6574  nsions...    Ret
+00011f10: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+00011f20: 0a20 2020 2075 6e69 6669 6564 2028 4461  .    unified (Da
+00011f30: 7461 4172 7261 7920 6f72 2044 6174 6173  taArray or Datas
+00011f40: 6574 2920 e280 9320 5475 706c 6520 6f66  et) ... Tuple of
+00011f50: 206f 626a 6563 7473 2077 6974 6820 7468   objects with th
+00011f60: 6520 7361 6d65 2074 7970 6520 6173 0a20  e same type as. 
+00011f70: 2020 202a 6f62 6a65 6374 7320 7769 7468     *objects with
+00011f80: 2063 6f6e 7369 7374 656e 7420 6368 756e   consistent chun
+00011f90: 6b20 7369 7a65 7320 666f 7220 616c 6c20  k sizes for all 
+00011fa0: 6461 736b 2d61 7272 6179 2076 6172 6961  dask-array varia
+00011fb0: 626c 6573 0a0a 2020 2020 5365 6520 416c  bles..    See Al
+00011fc0: 736f 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  so.    --------.
+00011fd0: 2020 2020 6461 736b 2e61 7272 6179 2e63      dask.array.c
+00011fe0: 6f72 652e 756e 6966 795f 6368 756e 6b73  ore.unify_chunks
+00011ff0: 0a20 2020 2022 2222 0a20 2020 2066 726f  .    """.    fro
+00012000: 6d20 7861 7272 6179 2e63 6f72 652e 6461  m xarray.core.da
+00012010: 7461 6172 7261 7920 696d 706f 7274 2044  taarray import D
+00012020: 6174 6141 7272 6179 0a0a 2020 2020 2320  ataArray..    # 
+00012030: 436f 6e76 6572 7420 616c 6c20 6f62 6a65  Convert all obje
+00012040: 6374 7320 746f 2064 6174 6173 6574 730a  cts to datasets.
+00012050: 2020 2020 6461 7461 7365 7473 203d 205b      datasets = [
+00012060: 0a20 2020 2020 2020 206f 626a 2e5f 746f  .        obj._to
+00012070: 5f74 656d 705f 6461 7461 7365 7428 2920  _temp_dataset() 
+00012080: 6966 2069 7369 6e73 7461 6e63 6528 6f62  if isinstance(ob
+00012090: 6a2c 2044 6174 6141 7272 6179 2920 656c  j, DataArray) el
+000120a0: 7365 206f 626a 2e63 6f70 7928 290a 2020  se obj.copy().  
+000120b0: 2020 2020 2020 666f 7220 6f62 6a20 696e        for obj in
+000120c0: 206f 626a 6563 7473 0a20 2020 205d 0a0a   objects.    ]..
+000120d0: 2020 2020 2320 4765 7420 6172 6775 6d65      # Get argume
+000120e0: 6e74 7320 746f 2070 6173 7320 696e 746f  nts to pass into
+000120f0: 2064 6173 6b2e 6172 7261 792e 636f 7265   dask.array.core
+00012100: 2e75 6e69 6679 5f63 6875 6e6b 730a 2020  .unify_chunks.  
+00012110: 2020 756e 6966 795f 6368 756e 6b73 5f61    unify_chunks_a
+00012120: 7267 7320 3d20 5b5d 0a20 2020 2073 697a  rgs = [].    siz
+00012130: 6573 3a20 6469 6374 5b48 6173 6861 626c  es: dict[Hashabl
+00012140: 652c 2069 6e74 5d20 3d20 7b7d 0a20 2020  e, int] = {}.   
+00012150: 2066 6f72 2064 7320 696e 2064 6174 6173   for ds in datas
+00012160: 6574 733a 0a20 2020 2020 2020 2066 6f72  ets:.        for
+00012170: 2076 2069 6e20 6473 2e5f 7661 7269 6162   v in ds._variab
+00012180: 6c65 732e 7661 6c75 6573 2829 3a0a 2020  les.values():.  
+00012190: 2020 2020 2020 2020 2020 6966 2076 2e63            if v.c
+000121a0: 6875 6e6b 7320 6973 206e 6f74 204e 6f6e  hunks is not Non
+000121b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000121c0: 2020 2023 2043 6865 636b 2074 6861 7420     # Check that 
+000121d0: 7369 7a65 7320 6d61 7463 6820 6163 726f  sizes match acro
+000121e0: 7373 2064 6966 6665 7265 6e74 2064 6174  ss different dat
+000121f0: 6173 6574 730a 2020 2020 2020 2020 2020  asets.          
+00012200: 2020 2020 2020 666f 7220 6469 6d2c 2073        for dim, s
+00012210: 697a 6520 696e 2076 2e73 697a 6573 2e69  ize in v.sizes.i
+00012220: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00012230: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00012240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012250: 2020 2020 2020 2020 2069 6620 7369 7a65           if size
+00012260: 735b 6469 6d5d 2021 3d20 7369 7a65 3a0a  s[dim] != size:.
+00012270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012280: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00012290: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+000122a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122b0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+000122c0: 4469 6d65 6e73 696f 6e20 7b64 696d 2172  Dimension {dim!r
+000122d0: 7d20 7369 7a65 206d 6973 6d61 7463 683a  } size mismatch:
+000122e0: 207b 7369 7a65 735b 6469 6d5d 7d20 213d   {sizes[dim]} !=
+000122f0: 207b 7369 7a65 7d22 0a20 2020 2020 2020   {size}".       
+00012300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012310: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00012320: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00012330: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
+00012340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012350: 2020 2020 7369 7a65 735b 6469 6d5d 203d      sizes[dim] =
+00012360: 2073 697a 650a 2020 2020 2020 2020 2020   size.          
+00012370: 2020 2020 2020 756e 6966 795f 6368 756e        unify_chun
+00012380: 6b73 5f61 7267 7320 2b3d 205b 762e 5f64  ks_args += [v._d
+00012390: 6174 612c 2076 2e5f 6469 6d73 5d0a 0a20  ata, v._dims].. 
+000123a0: 2020 2023 204e 6f20 6461 736b 2061 7272     # No dask arr
+000123b0: 6179 733a 2052 6574 7572 6e20 696e 7075  ays: Return inpu
+000123c0: 7473 0a20 2020 2069 6620 6e6f 7420 756e  ts.    if not un
+000123d0: 6966 795f 6368 756e 6b73 5f61 7267 733a  ify_chunks_args:
+000123e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000123f0: 6f62 6a65 6374 730a 0a20 2020 2063 6875  objects..    chu
+00012400: 6e6b 6d61 6e61 6765 7220 3d20 6765 745f  nkmanager = get_
+00012410: 6368 756e 6b65 645f 6172 7261 795f 7479  chunked_array_ty
+00012420: 7065 282a 5b61 7267 2066 6f72 2061 7267  pe(*[arg for arg
+00012430: 2069 6e20 756e 6966 795f 6368 756e 6b73   in unify_chunks
+00012440: 5f61 7267 735d 290a 2020 2020 5f2c 2063  _args]).    _, c
+00012450: 6875 6e6b 6564 5f64 6174 6120 3d20 6368  hunked_data = ch
+00012460: 756e 6b6d 616e 6167 6572 2e75 6e69 6679  unkmanager.unify
+00012470: 5f63 6875 6e6b 7328 2a75 6e69 6679 5f63  _chunks(*unify_c
+00012480: 6875 6e6b 735f 6172 6773 290a 2020 2020  hunks_args).    
+00012490: 6368 756e 6b65 645f 6461 7461 5f69 7465  chunked_data_ite
+000124a0: 7220 3d20 6974 6572 2863 6875 6e6b 6564  r = iter(chunked
+000124b0: 5f64 6174 6129 0a20 2020 206f 7574 3a20  _data).    out: 
+000124c0: 6c69 7374 5b44 6174 6173 6574 207c 2044  list[Dataset | D
+000124d0: 6174 6141 7272 6179 5d20 3d20 5b5d 0a20  ataArray] = []. 
+000124e0: 2020 2066 6f72 206f 626a 2c20 6473 2069     for obj, ds i
+000124f0: 6e20 7a69 7028 6f62 6a65 6374 732c 2064  n zip(objects, d
+00012500: 6174 6173 6574 7329 3a0a 2020 2020 2020  atasets):.      
+00012510: 2020 666f 7220 6b2c 2076 2069 6e20 6473    for k, v in ds
+00012520: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
+00012530: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00012540: 2069 6620 762e 6368 756e 6b73 2069 7320   if v.chunks is 
+00012550: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00012560: 2020 2020 2020 2020 2020 6473 2e5f 7661            ds._va
+00012570: 7269 6162 6c65 735b 6b5d 203d 2076 2e63  riables[k] = v.c
+00012580: 6f70 7928 6461 7461 3d6e 6578 7428 6368  opy(data=next(ch
+00012590: 756e 6b65 645f 6461 7461 5f69 7465 7229  unked_data_iter)
+000125a0: 290a 2020 2020 2020 2020 6f75 742e 6170  ).        out.ap
+000125b0: 7065 6e64 286f 626a 2e5f 6672 6f6d 5f74  pend(obj._from_t
+000125c0: 656d 705f 6461 7461 7365 7428 6473 2920  emp_dataset(ds) 
+000125d0: 6966 2069 7369 6e73 7461 6e63 6528 6f62  if isinstance(ob
+000125e0: 6a2c 2044 6174 6141 7272 6179 2920 656c  j, DataArray) el
+000125f0: 7365 2064 7329 0a0a 2020 2020 7265 7475  se ds)..    retu
+00012600: 726e 2074 7570 6c65 286f 7574 290a       rn tuple(out).
```

### Comparing `xarray-2023.4.2/xarray/core/concat.py` & `xarray-2023.5.0/xarray/core/concat.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/coordinates.py` & `xarray-2023.5.0/xarray/core/coordinates.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/dataarray.py` & `xarray-2023.5.0/xarray/core/dataarray.py`

 * *Files 1% similar despite different names*

```diff
@@ -54,14 +54,18 @@
 
 if TYPE_CHECKING:
     from typing import TypeVar, Union
 
     from numpy.typing import ArrayLike
 
     try:
+        from dask.dataframe import DataFrame as DaskDataFrame
+    except ImportError:
+        DaskDataFrame = None  # type: ignore
+    try:
         from dask.delayed import Delayed
     except ImportError:
         Delayed = None  # type: ignore
     try:
         from cdms2 import Variable as cdms2_Variable
     except ImportError:
         cdms2_Variable = None
@@ -69,14 +73,15 @@
         from iris.cube import Cube as iris_Cube
     except ImportError:
         iris_Cube = None
 
     from xarray.backends import ZarrStore
     from xarray.backends.api import T_NetcdfEngine, T_NetcdfTypes
     from xarray.core.groupby import DataArrayGroupBy
+    from xarray.core.parallelcompat import ChunkManagerEntrypoint
     from xarray.core.resample import DataArrayResample
     from xarray.core.rolling import DataArrayCoarsen, DataArrayRolling
     from xarray.core.types import (
         CoarsenBoundaryOptions,
         DatetimeLike,
         DatetimeUnitOptions,
         Dims,
@@ -1256,14 +1261,16 @@
             | tuple[tuple[int, ...], ...]
             | Mapping[Any, None | int | tuple[int, ...]]
         ) = {},  # {} even though it's technically unsafe, is being used intentionally here (#4667)
         name_prefix: str = "xarray-",
         token: str | None = None,
         lock: bool = False,
         inline_array: bool = False,
+        chunked_array_type: str | ChunkManagerEntrypoint | None = None,
+        from_array_kwargs=None,
         **chunks_kwargs: Any,
     ) -> T_DataArray:
         """Coerce this array's data into a dask arrays with the given chunks.
 
         If this variable is a non-dask array, it will be converted to dask
         array. If it's a dask array, it will be rechunked to the given chunk
         sizes.
@@ -1277,20 +1284,29 @@
         chunks : int, "auto", tuple of int or mapping of Hashable to int, optional
             Chunk sizes along each dimension, e.g., ``5``, ``"auto"``, ``(5, 5)`` or
             ``{"x": 5, "y": 5}``.
         name_prefix : str, optional
             Prefix for the name of the new dask array.
         token : str, optional
             Token uniquely identifying this array.
-        lock : optional
+        lock : bool, default: False
             Passed on to :py:func:`dask.array.from_array`, if the array is not
             already as dask array.
-        inline_array: optional
+        inline_array: bool, default: False
             Passed on to :py:func:`dask.array.from_array`, if the array is not
             already as dask array.
+        chunked_array_type: str, optional
+            Which chunked array type to coerce the underlying data array to.
+            Defaults to 'dask' if installed, else whatever is registered via the `ChunkManagerEntryPoint` system.
+            Experimental API that should not be relied upon.
+        from_array_kwargs: dict, optional
+            Additional keyword arguments passed on to the `ChunkManagerEntrypoint.from_array` method used to create
+            chunked arrays, via whichever chunk manager is specified through the `chunked_array_type` kwarg.
+            For example, with dask as the default chunked array type, this method would pass additional kwargs
+            to :py:func:`dask.array.from_array`. Experimental API that should not be relied upon.
         **chunks_kwargs : {dim: chunks, ...}, optional
             The keyword arguments form of ``chunks``.
             One of chunks or chunks_kwargs must be provided.
 
         Returns
         -------
         chunked : xarray.DataArray
@@ -1320,14 +1336,16 @@
 
         ds = self._to_temp_dataset().chunk(
             chunks,
             name_prefix=name_prefix,
             token=token,
             lock=lock,
             inline_array=inline_array,
+            chunked_array_type=chunked_array_type,
+            from_array_kwargs=from_array_kwargs,
         )
         return self._from_temp_dataset(ds)
 
     def isel(
         self: T_DataArray,
         indexers: Mapping[Any, Any] | None = None,
         drop: bool = False,
@@ -4170,28 +4188,35 @@
             append_dim=append_dim,
             region=region,
             safe_chunks=safe_chunks,
             storage_options=storage_options,
             zarr_version=zarr_version,
         )
 
-    def to_dict(self, data: bool = True, encoding: bool = False) -> dict[str, Any]:
+    def to_dict(
+        self, data: bool | Literal["list", "array"] = "list", encoding: bool = False
+    ) -> dict[str, Any]:
         """
         Convert this xarray.DataArray into a dictionary following xarray
         naming conventions.
 
         Converts all variables and attributes to native Python objects.
         Useful for converting to json. To avoid datetime incompatibility
         use decode_times=False kwarg in xarray.open_dataset.
 
         Parameters
         ----------
-        data : bool, default: True
+        data : bool or {"list", "array"}, default: "list"
             Whether to include the actual data in the dictionary. When set to
-            False, returns just the schema.
+            False, returns just the schema. If set to "array", returns data as
+            underlying array type. If set to "list" (or True for backwards
+            compatibility), returns data in lists of Python data types. Note
+            that for obtaining the "list" output efficiently, use
+            `da.compute().to_dict(data="list")`.
+
         encoding : bool, default: False
             Whether to include the Dataset's encoding in the dictionary.
 
         Returns
         -------
         dict: dict
 
@@ -6463,29 +6488,28 @@
         :ref:`groupby`
             Users guide explanation of how to group and bin data.
         DataArray.groupby_bins
         Dataset.groupby
         core.groupby.DataArrayGroupBy
         pandas.DataFrame.groupby
         """
-        from xarray.core.groupby import DataArrayGroupBy
-
-        # While we don't generally check the type of every arg, passing
-        # multiple dimensions as multiple arguments is common enough, and the
-        # consequences hidden enough (strings evaluate as true) to warrant
-        # checking here.
-        # A future version could make squeeze kwarg only, but would face
-        # backward-compat issues.
-        if not isinstance(squeeze, bool):
-            raise TypeError(
-                f"`squeeze` must be True or False, but {squeeze} was supplied"
-            )
+        from xarray.core.groupby import (
+            DataArrayGroupBy,
+            ResolvedUniqueGrouper,
+            UniqueGrouper,
+            _validate_groupby_squeeze,
+        )
 
+        _validate_groupby_squeeze(squeeze)
+        rgrouper = ResolvedUniqueGrouper(UniqueGrouper(), group, self)
         return DataArrayGroupBy(
-            self, group, squeeze=squeeze, restore_coord_dims=restore_coord_dims
+            self,
+            (rgrouper,),
+            squeeze=squeeze,
+            restore_coord_dims=restore_coord_dims,
         )
 
     def groupby_bins(
         self,
         group: Hashable | DataArray | IndexVariable,
         bins: ArrayLike,
         right: bool = True,
@@ -6548,29 +6572,39 @@
         core.groupby.DataArrayGroupBy
         pandas.DataFrame.groupby
 
         References
         ----------
         .. [1] http://pandas.pydata.org/pandas-docs/stable/generated/pandas.cut.html
         """
-        from xarray.core.groupby import DataArrayGroupBy
+        from xarray.core.groupby import (
+            BinGrouper,
+            DataArrayGroupBy,
+            ResolvedBinGrouper,
+            _validate_groupby_squeeze,
+        )
 
-        return DataArrayGroupBy(
-            self,
-            group,
-            squeeze=squeeze,
+        _validate_groupby_squeeze(squeeze)
+        grouper = BinGrouper(
             bins=bins,
-            restore_coord_dims=restore_coord_dims,
             cut_kwargs={
                 "right": right,
                 "labels": labels,
                 "precision": precision,
                 "include_lowest": include_lowest,
             },
         )
+        rgrouper = ResolvedBinGrouper(grouper, group, self)
+
+        return DataArrayGroupBy(
+            self,
+            (rgrouper,),
+            squeeze=squeeze,
+            restore_coord_dims=restore_coord_dims,
+        )
 
     def weighted(self, weights: DataArray) -> DataArrayWeighted:
         """
         Weighted DataArray operations.
 
         Parameters
         ----------
@@ -6877,10 +6911,75 @@
             origin=origin,
             keep_attrs=keep_attrs,
             loffset=loffset,
             restore_coord_dims=restore_coord_dims,
             **indexer_kwargs,
         )
 
+    def to_dask_dataframe(
+        self,
+        dim_order: Sequence[Hashable] | None = None,
+        set_index: bool = False,
+    ) -> DaskDataFrame:
+        """Convert this array into a dask.dataframe.DataFrame.
+
+        Parameters
+        ----------
+        dim_order : Sequence of Hashable or None , optional
+            Hierarchical dimension order for the resulting dataframe.
+            Array content is transposed to this order and then written out as flat
+            vectors in contiguous order, so the last dimension in this list
+            will be contiguous in the resulting DataFrame. This has a major influence
+            on which operations are efficient on the resulting dask dataframe.
+        set_index : bool, default: False
+            If set_index=True, the dask DataFrame is indexed by this dataset's
+            coordinate. Since dask DataFrames do not support multi-indexes,
+            set_index only works if the dataset only contains one dimension.
+
+        Returns
+        -------
+        dask.dataframe.DataFrame
+
+        Examples
+        --------
+        >>> da = xr.DataArray(
+        ...     np.arange(4 * 2 * 2).reshape(4, 2, 2),
+        ...     dims=("time", "lat", "lon"),
+        ...     coords={
+        ...         "time": np.arange(4),
+        ...         "lat": [-30, -20],
+        ...         "lon": [120, 130],
+        ...     },
+        ...     name="eg_dataarray",
+        ...     attrs={"units": "Celsius", "description": "Random temperature data"},
+        ... )
+        >>> da.to_dask_dataframe(["lat", "lon", "time"]).compute()
+            lat  lon  time  eg_dataarray
+        0   -30  120     0             0
+        1   -30  120     1             4
+        2   -30  120     2             8
+        3   -30  120     3            12
+        4   -30  130     0             1
+        5   -30  130     1             5
+        6   -30  130     2             9
+        7   -30  130     3            13
+        8   -20  120     0             2
+        9   -20  120     1             6
+        10  -20  120     2            10
+        11  -20  120     3            14
+        12  -20  130     0             3
+        13  -20  130     1             7
+        14  -20  130     2            11
+        15  -20  130     3            15
+        """
+        if self.name is None:
+            raise ValueError(
+                "Cannot convert an unnamed DataArray to a "
+                "dask dataframe : use the ``.rename`` method to assign a name."
+            )
+        name = self.name
+        ds = self._to_dataset_whole(name, shallow_copy=False)
+        return ds.to_dask_dataframe(dim_order, set_index)
+
     # this needs to be at the end, or mypy will confuse with `str`
     # https://mypy.readthedocs.io/en/latest/common_issues.html#dealing-with-conflicting-names
     str = utils.UncachedAccessor(StringAccessor["DataArray"])
```

### Comparing `xarray-2023.4.2/xarray/core/dataset.py` & `xarray-2023.5.0/xarray/core/dataset.py`

 * *Files 1% similar despite different names*

```diff
@@ -78,22057 +78,22262 @@
 000004d0: 6f72 7420 756e 6966 795f 6368 756e 6b73  ort unify_chunks
 000004e0: 0a66 726f 6d20 7861 7272 6179 2e63 6f72  .from xarray.cor
 000004f0: 652e 636f 6f72 6469 6e61 7465 7320 696d  e.coordinates im
 00000500: 706f 7274 2044 6174 6173 6574 436f 6f72  port DatasetCoor
 00000510: 6469 6e61 7465 732c 2061 7373 6572 745f  dinates, assert_
 00000520: 636f 6f72 6469 6e61 7465 5f63 6f6e 7369  coordinate_consi
 00000530: 7374 656e 740a 6672 6f6d 2078 6172 7261  stent.from xarra
-00000540: 792e 636f 7265 2e64 7563 6b5f 6172 7261  y.core.duck_arra
-00000550: 795f 6f70 7320 696d 706f 7274 2064 6174  y_ops import dat
-00000560: 6574 696d 655f 746f 5f6e 756d 6572 6963  etime_to_numeric
-00000570: 0a66 726f 6d20 7861 7272 6179 2e63 6f72  .from xarray.cor
-00000580: 652e 696e 6465 7865 7320 696d 706f 7274  e.indexes import
-00000590: 2028 0a20 2020 2049 6e64 6578 2c0a 2020   (.    Index,.  
-000005a0: 2020 496e 6465 7865 732c 0a20 2020 2050    Indexes,.    P
-000005b0: 616e 6461 7349 6e64 6578 2c0a 2020 2020  andasIndex,.    
-000005c0: 5061 6e64 6173 4d75 6c74 6949 6e64 6578  PandasMultiIndex
-000005d0: 2c0a 2020 2020 6173 7365 7274 5f6e 6f5f  ,.    assert_no_
-000005e0: 696e 6465 785f 636f 7272 7570 7465 642c  index_corrupted,
-000005f0: 0a20 2020 2063 7265 6174 655f 6465 6661  .    create_defa
-00000600: 756c 745f 696e 6465 785f 696d 706c 6963  ult_index_implic
-00000610: 6974 2c0a 2020 2020 6669 6c74 6572 5f69  it,.    filter_i
-00000620: 6e64 6578 6573 5f66 726f 6d5f 636f 6f72  ndexes_from_coor
-00000630: 6473 2c0a 2020 2020 6973 656c 5f69 6e64  ds,.    isel_ind
-00000640: 6578 6573 2c0a 2020 2020 7265 6d6f 7665  exes,.    remove
-00000650: 5f75 6e75 7365 645f 6c65 7665 6c73 5f63  _unused_levels_c
-00000660: 6174 6567 6f72 6965 732c 0a20 2020 2072  ategories,.    r
-00000670: 6f6c 6c5f 696e 6465 7865 732c 0a29 0a66  oll_indexes,.).f
-00000680: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
-00000690: 696e 6465 7869 6e67 2069 6d70 6f72 7420  indexing import 
-000006a0: 6973 5f66 616e 6379 5f69 6e64 6578 6572  is_fancy_indexer
-000006b0: 2c20 6d61 705f 696e 6465 785f 7175 6572  , map_index_quer
-000006c0: 6965 730a 6672 6f6d 2078 6172 7261 792e  ies.from xarray.
-000006d0: 636f 7265 2e6d 6572 6765 2069 6d70 6f72  core.merge impor
-000006e0: 7420 280a 2020 2020 6461 7461 7365 745f  t (.    dataset_
-000006f0: 6d65 7267 655f 6d65 7468 6f64 2c0a 2020  merge_method,.  
-00000700: 2020 6461 7461 7365 745f 7570 6461 7465    dataset_update
-00000710: 5f6d 6574 686f 642c 0a20 2020 206d 6572  _method,.    mer
-00000720: 6765 5f63 6f6f 7264 696e 6174 6573 5f77  ge_coordinates_w
-00000730: 6974 686f 7574 5f61 6c69 676e 2c0a 2020  ithout_align,.  
-00000740: 2020 6d65 7267 655f 6461 7461 5f61 6e64    merge_data_and
-00000750: 5f63 6f6f 7264 732c 0a29 0a66 726f 6d20  _coords,.).from 
-00000760: 7861 7272 6179 2e63 6f72 652e 6d69 7373  xarray.core.miss
-00000770: 696e 6720 696d 706f 7274 2067 6574 5f63  ing import get_c
-00000780: 6c65 616e 5f69 6e74 6572 705f 696e 6465  lean_interp_inde
-00000790: 780a 6672 6f6d 2078 6172 7261 792e 636f  x.from xarray.co
-000007a0: 7265 2e6f 7074 696f 6e73 2069 6d70 6f72  re.options impor
-000007b0: 7420 4f50 5449 4f4e 532c 205f 6765 745f  t OPTIONS, _get_
-000007c0: 6b65 6570 5f61 7474 7273 0a66 726f 6d20  keep_attrs.from 
-000007d0: 7861 7272 6179 2e63 6f72 652e 7079 636f  xarray.core.pyco
-000007e0: 6d70 6174 2069 6d70 6f72 7420 6172 7261  mpat import arra
-000007f0: 795f 7479 7065 2c20 6973 5f64 7563 6b5f  y_type, is_duck_
-00000800: 6172 7261 792c 2069 735f 6475 636b 5f64  array, is_duck_d
-00000810: 6173 6b5f 6172 7261 790a 6672 6f6d 2078  ask_array.from x
-00000820: 6172 7261 792e 636f 7265 2e74 7970 6573  array.core.types
-00000830: 2069 6d70 6f72 7420 5175 616e 7469 6c65   import Quantile
-00000840: 4d65 7468 6f64 732c 2054 5f44 6174 6173  Methods, T_Datas
-00000850: 6574 0a66 726f 6d20 7861 7272 6179 2e63  et.from xarray.c
-00000860: 6f72 652e 7574 696c 7320 696d 706f 7274  ore.utils import
-00000870: 2028 0a20 2020 2044 6566 6175 6c74 2c0a   (.    Default,.
-00000880: 2020 2020 4672 6f7a 656e 2c0a 2020 2020      Frozen,.    
-00000890: 4879 6272 6964 4d61 7070 696e 6750 726f  HybridMappingPro
-000008a0: 7879 2c0a 2020 2020 4f72 6465 7265 6453  xy,.    OrderedS
-000008b0: 6574 2c0a 2020 2020 5f64 6566 6175 6c74  et,.    _default
-000008c0: 2c0a 2020 2020 6465 636f 6465 5f6e 756d  ,.    decode_num
-000008d0: 7079 5f64 6963 745f 7661 6c75 6573 2c0a  py_dict_values,.
-000008e0: 2020 2020 6472 6f70 5f64 696d 735f 6672      drop_dims_fr
-000008f0: 6f6d 5f69 6e64 6578 6572 732c 0a20 2020  om_indexers,.   
-00000900: 2065 6974 6865 725f 6469 6374 5f6f 725f   either_dict_or_
-00000910: 6b77 6172 6773 2c0a 2020 2020 696e 6669  kwargs,.    infi
-00000920: 785f 6469 6d73 2c0a 2020 2020 6973 5f64  x_dims,.    is_d
-00000930: 6963 745f 6c69 6b65 2c0a 2020 2020 6973  ict_like,.    is
-00000940: 5f73 6361 6c61 722c 0a20 2020 206d 6179  _scalar,.    may
-00000950: 6265 5f77 7261 705f 6172 7261 792c 0a29  be_wrap_array,.)
-00000960: 0a66 726f 6d20 7861 7272 6179 2e63 6f72  .from xarray.cor
-00000970: 652e 7661 7269 6162 6c65 2069 6d70 6f72  e.variable impor
-00000980: 7420 280a 2020 2020 496e 6465 7856 6172  t (.    IndexVar
-00000990: 6961 626c 652c 0a20 2020 2056 6172 6961  iable,.    Varia
-000009a0: 626c 652c 0a20 2020 2061 735f 7661 7269  ble,.    as_vari
-000009b0: 6162 6c65 2c0a 2020 2020 6272 6f61 6463  able,.    broadc
-000009c0: 6173 745f 7661 7269 6162 6c65 732c 0a20  ast_variables,. 
-000009d0: 2020 2063 616c 6375 6c61 7465 5f64 696d     calculate_dim
-000009e0: 656e 7369 6f6e 732c 0a29 0a66 726f 6d20  ensions,.).from 
-000009f0: 7861 7272 6179 2e70 6c6f 742e 6163 6365  xarray.plot.acce
-00000a00: 7373 6f72 2069 6d70 6f72 7420 4461 7461  ssor import Data
-00000a10: 7365 7450 6c6f 7441 6363 6573 736f 720a  setPlotAccessor.
-00000a20: 0a69 6620 5459 5045 5f43 4845 434b 494e  .if TYPE_CHECKIN
-00000a30: 473a 0a20 2020 2066 726f 6d20 6e75 6d70  G:.    from nump
-00000a40: 792e 7479 7069 6e67 2069 6d70 6f72 7420  y.typing import 
-00000a50: 4172 7261 794c 696b 650a 0a20 2020 2066  ArrayLike..    f
-00000a60: 726f 6d20 7861 7272 6179 2e62 6163 6b65  rom xarray.backe
-00000a70: 6e64 7320 696d 706f 7274 2041 6273 7472  nds import Abstr
-00000a80: 6163 7444 6174 6153 746f 7265 2c20 5a61  actDataStore, Za
-00000a90: 7272 5374 6f72 650a 2020 2020 6672 6f6d  rrStore.    from
-00000aa0: 2078 6172 7261 792e 6261 636b 656e 6473   xarray.backends
-00000ab0: 2e61 7069 2069 6d70 6f72 7420 545f 4e65  .api import T_Ne
-00000ac0: 7463 6466 456e 6769 6e65 2c20 545f 4e65  tcdfEngine, T_Ne
-00000ad0: 7463 6466 5479 7065 730a 2020 2020 6672  tcdfTypes.    fr
-00000ae0: 6f6d 2078 6172 7261 792e 636f 7265 2e63  om xarray.core.c
-00000af0: 6f6f 7264 696e 6174 6573 2069 6d70 6f72  oordinates impor
-00000b00: 7420 436f 6f72 6469 6e61 7465 730a 2020  t Coordinates.  
-00000b10: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00000b20: 7265 2e64 6174 6161 7272 6179 2069 6d70  re.dataarray imp
-00000b30: 6f72 7420 4461 7461 4172 7261 790a 2020  ort DataArray.  
-00000b40: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00000b50: 7265 2e67 726f 7570 6279 2069 6d70 6f72  re.groupby impor
-00000b60: 7420 4461 7461 7365 7447 726f 7570 4279  t DatasetGroupBy
-00000b70: 0a20 2020 2066 726f 6d20 7861 7272 6179  .    from xarray
-00000b80: 2e63 6f72 652e 6d65 7267 6520 696d 706f  .core.merge impo
-00000b90: 7274 2043 6f65 7263 6962 6c65 4d61 7070  rt CoercibleMapp
-00000ba0: 696e 670a 2020 2020 6672 6f6d 2078 6172  ing.    from xar
-00000bb0: 7261 792e 636f 7265 2e72 6573 616d 706c  ray.core.resampl
-00000bc0: 6520 696d 706f 7274 2044 6174 6173 6574  e import Dataset
-00000bd0: 5265 7361 6d70 6c65 0a20 2020 2066 726f  Resample.    fro
-00000be0: 6d20 7861 7272 6179 2e63 6f72 652e 726f  m xarray.core.ro
-00000bf0: 6c6c 696e 6720 696d 706f 7274 2044 6174  lling import Dat
-00000c00: 6173 6574 436f 6172 7365 6e2c 2044 6174  asetCoarsen, Dat
-00000c10: 6173 6574 526f 6c6c 696e 670a 2020 2020  asetRolling.    
-00000c20: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-00000c30: 2e74 7970 6573 2069 6d70 6f72 7420 280a  .types import (.
-00000c40: 2020 2020 2020 2020 4346 4361 6c65 6e64          CFCalend
-00000c50: 6172 2c0a 2020 2020 2020 2020 436f 6172  ar,.        Coar
-00000c60: 7365 6e42 6f75 6e64 6172 794f 7074 696f  senBoundaryOptio
-00000c70: 6e73 2c0a 2020 2020 2020 2020 436f 6d62  ns,.        Comb
-00000c80: 696e 6541 7474 7273 4f70 7469 6f6e 732c  ineAttrsOptions,
-00000c90: 0a20 2020 2020 2020 2043 6f6d 7061 744f  .        CompatO
-00000ca0: 7074 696f 6e73 2c0a 2020 2020 2020 2020  ptions,.        
-00000cb0: 4461 7465 7469 6d65 4c69 6b65 2c0a 2020  DatetimeLike,.  
-00000cc0: 2020 2020 2020 4461 7465 7469 6d65 556e        DatetimeUn
-00000cd0: 6974 4f70 7469 6f6e 732c 0a20 2020 2020  itOptions,.     
-00000ce0: 2020 2044 696d 732c 0a20 2020 2020 2020     Dims,.       
-00000cf0: 2045 7272 6f72 4f70 7469 6f6e 732c 0a20   ErrorOptions,. 
-00000d00: 2020 2020 2020 2045 7272 6f72 4f70 7469         ErrorOpti
-00000d10: 6f6e 7357 6974 6857 6172 6e2c 0a20 2020  onsWithWarn,.   
-00000d20: 2020 2020 2049 6e74 6572 704f 7074 696f       InterpOptio
-00000d30: 6e73 2c0a 2020 2020 2020 2020 4a6f 696e  ns,.        Join
-00000d40: 4f70 7469 6f6e 732c 0a20 2020 2020 2020  Options,.       
-00000d50: 2050 6164 4d6f 6465 4f70 7469 6f6e 732c   PadModeOptions,
-00000d60: 0a20 2020 2020 2020 2050 6164 5265 666c  .        PadRefl
-00000d70: 6563 744f 7074 696f 6e73 2c0a 2020 2020  ectOptions,.    
-00000d80: 2020 2020 5175 6572 7945 6e67 696e 654f      QueryEngineO
-00000d90: 7074 696f 6e73 2c0a 2020 2020 2020 2020  ptions,.        
-00000da0: 5175 6572 7950 6172 7365 724f 7074 696f  QueryParserOptio
-00000db0: 6e73 2c0a 2020 2020 2020 2020 5265 696e  ns,.        Rein
-00000dc0: 6465 784d 6574 686f 644f 7074 696f 6e73  dexMethodOptions
-00000dd0: 2c0a 2020 2020 2020 2020 5369 6465 4f70  ,.        SideOp
-00000de0: 7469 6f6e 732c 0a20 2020 2020 2020 2054  tions,.        T
-00000df0: 5f58 6172 7261 792c 0a20 2020 2029 0a20  _Xarray,.    ). 
-00000e00: 2020 2066 726f 6d20 7861 7272 6179 2e63     from xarray.c
-00000e10: 6f72 652e 7765 6967 6874 6564 2069 6d70  ore.weighted imp
-00000e20: 6f72 7420 4461 7461 7365 7457 6569 6768  ort DatasetWeigh
-00000e30: 7465 640a 0a20 2020 2074 7279 3a0a 2020  ted..    try:.  
-00000e40: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00000e50: 6465 6c61 7965 6420 696d 706f 7274 2044  delayed import D
-00000e60: 656c 6179 6564 0a20 2020 2065 7863 6570  elayed.    excep
-00000e70: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
-00000e80: 2020 2020 2020 2044 656c 6179 6564 203d         Delayed =
-00000e90: 204e 6f6e 6520 2023 2074 7970 653a 2069   None  # type: i
-00000ea0: 676e 6f72 650a 2020 2020 7472 793a 0a20  gnore.    try:. 
-00000eb0: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
-00000ec0: 2e64 6174 6166 7261 6d65 2069 6d70 6f72  .dataframe impor
-00000ed0: 7420 4461 7461 4672 616d 6520 6173 2044  t DataFrame as D
-00000ee0: 6173 6b44 6174 6146 7261 6d65 0a20 2020  askDataFrame.   
-00000ef0: 2065 7863 6570 7420 496d 706f 7274 4572   except ImportEr
-00000f00: 726f 723a 0a20 2020 2020 2020 2044 6173  ror:.        Das
-00000f10: 6b44 6174 6146 7261 6d65 203d 204e 6f6e  kDataFrame = Non
-00000f20: 6520 2023 2074 7970 653a 2069 676e 6f72  e  # type: ignor
-00000f30: 650a 0a0a 2320 6c69 7374 206f 6620 6174  e...# list of at
-00000f40: 7472 6962 7574 6573 206f 6620 7064 2e44  tributes of pd.D
-00000f50: 6174 6574 696d 6549 6e64 6578 2074 6861  atetimeIndex tha
-00000f60: 7420 6172 6520 6e64 6172 7261 7973 206f  t are ndarrays o
-00000f70: 6620 7469 6d65 2069 6e66 6f0a 5f44 4154  f time info._DAT
-00000f80: 4554 494d 4549 4e44 4558 5f43 4f4d 504f  ETIMEINDEX_COMPO
-00000f90: 4e45 4e54 5320 3d20 5b0a 2020 2020 2279  NENTS = [.    "y
-00000fa0: 6561 7222 2c0a 2020 2020 226d 6f6e 7468  ear",.    "month
-00000fb0: 222c 0a20 2020 2022 6461 7922 2c0a 2020  ",.    "day",.  
-00000fc0: 2020 2268 6f75 7222 2c0a 2020 2020 226d    "hour",.    "m
-00000fd0: 696e 7574 6522 2c0a 2020 2020 2273 6563  inute",.    "sec
-00000fe0: 6f6e 6422 2c0a 2020 2020 226d 6963 726f  ond",.    "micro
-00000ff0: 7365 636f 6e64 222c 0a20 2020 2022 6e61  second",.    "na
-00001000: 6e6f 7365 636f 6e64 222c 0a20 2020 2022  nosecond",.    "
-00001010: 6461 7465 222c 0a20 2020 2022 7469 6d65  date",.    "time
-00001020: 222c 0a20 2020 2022 6461 796f 6679 6561  ",.    "dayofyea
-00001030: 7222 2c0a 2020 2020 2277 6565 6b6f 6679  r",.    "weekofy
-00001040: 6561 7222 2c0a 2020 2020 2264 6179 6f66  ear",.    "dayof
-00001050: 7765 656b 222c 0a20 2020 2022 7175 6172  week",.    "quar
-00001060: 7465 7222 2c0a 5d0a 0a0a 6465 6620 5f67  ter",.]...def _g
-00001070: 6574 5f76 6972 7475 616c 5f76 6172 6961  et_virtual_varia
-00001080: 626c 6528 0a20 2020 2076 6172 6961 626c  ble(.    variabl
-00001090: 6573 2c20 6b65 793a 2048 6173 6861 626c  es, key: Hashabl
-000010a0: 652c 2064 696d 5f73 697a 6573 3a20 4d61  e, dim_sizes: Ma
-000010b0: 7070 696e 6720 7c20 4e6f 6e65 203d 204e  pping | None = N
-000010c0: 6f6e 650a 2920 2d3e 2074 7570 6c65 5b48  one.) -> tuple[H
-000010d0: 6173 6861 626c 652c 2048 6173 6861 626c  ashable, Hashabl
-000010e0: 652c 2056 6172 6961 626c 655d 3a0a 2020  e, Variable]:.  
-000010f0: 2020 2222 2247 6574 2061 2076 6972 7475    """Get a virtu
-00001100: 616c 2076 6172 6961 626c 6520 2865 2e67  al variable (e.g
-00001110: 2e2c 2027 7469 6d65 2e79 6561 7227 2920  ., 'time.year') 
-00001120: 6672 6f6d 2061 2064 6963 7420 6f66 2078  from a dict of x
-00001130: 6172 7261 792e 5661 7269 6162 6c65 0a20  array.Variable. 
-00001140: 2020 206f 626a 6563 7473 2028 6966 2070     objects (if p
-00001150: 6f73 7369 626c 6529 0a0a 2020 2020 2222  ossible)..    ""
-00001160: 220a 2020 2020 6672 6f6d 2078 6172 7261  ".    from xarra
-00001170: 792e 636f 7265 2e64 6174 6161 7272 6179  y.core.dataarray
-00001180: 2069 6d70 6f72 7420 4461 7461 4172 7261   import DataArra
-00001190: 790a 0a20 2020 2069 6620 6469 6d5f 7369  y..    if dim_si
-000011a0: 7a65 7320 6973 204e 6f6e 653a 0a20 2020  zes is None:.   
-000011b0: 2020 2020 2064 696d 5f73 697a 6573 203d       dim_sizes =
-000011c0: 207b 7d0a 0a20 2020 2069 6620 6b65 7920   {}..    if key 
-000011d0: 696e 2064 696d 5f73 697a 6573 3a0a 2020  in dim_sizes:.  
-000011e0: 2020 2020 2020 6461 7461 203d 2070 642e        data = pd.
-000011f0: 496e 6465 7828 7261 6e67 6528 6469 6d5f  Index(range(dim_
-00001200: 7369 7a65 735b 6b65 795d 292c 206e 616d  sizes[key]), nam
-00001210: 653d 6b65 7929 0a20 2020 2020 2020 2076  e=key).        v
-00001220: 6172 6961 626c 6520 3d20 496e 6465 7856  ariable = IndexV
-00001230: 6172 6961 626c 6528 286b 6579 2c29 2c20  ariable((key,), 
-00001240: 6461 7461 290a 2020 2020 2020 2020 7265  data).        re
-00001250: 7475 726e 206b 6579 2c20 6b65 792c 2076  turn key, key, v
-00001260: 6172 6961 626c 650a 0a20 2020 2069 6620  ariable..    if 
-00001270: 6e6f 7420 6973 696e 7374 616e 6365 286b  not isinstance(k
-00001280: 6579 2c20 7374 7229 3a0a 2020 2020 2020  ey, str):.      
-00001290: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
-000012a0: 286b 6579 290a 0a20 2020 2073 706c 6974  (key)..    split
-000012b0: 5f6b 6579 203d 206b 6579 2e73 706c 6974  _key = key.split
-000012c0: 2822 2e22 2c20 3129 0a20 2020 2069 6620  (".", 1).    if 
-000012d0: 6c65 6e28 7370 6c69 745f 6b65 7929 2021  len(split_key) !
-000012e0: 3d20 323a 0a20 2020 2020 2020 2072 6169  = 2:.        rai
-000012f0: 7365 204b 6579 4572 726f 7228 6b65 7929  se KeyError(key)
-00001300: 0a0a 2020 2020 7265 665f 6e61 6d65 2c20  ..    ref_name, 
-00001310: 7661 725f 6e61 6d65 203d 2073 706c 6974  var_name = split
-00001320: 5f6b 6579 0a20 2020 2072 6566 5f76 6172  _key.    ref_var
-00001330: 203d 2076 6172 6961 626c 6573 5b72 6566   = variables[ref
-00001340: 5f6e 616d 655d 0a0a 2020 2020 6966 205f  _name]..    if _
-00001350: 636f 6e74 6169 6e73 5f64 6174 6574 696d  contains_datetim
-00001360: 655f 6c69 6b65 5f6f 626a 6563 7473 2872  e_like_objects(r
-00001370: 6566 5f76 6172 293a 0a20 2020 2020 2020  ef_var):.       
-00001380: 2072 6566 5f76 6172 203d 2044 6174 6141   ref_var = DataA
-00001390: 7272 6179 2872 6566 5f76 6172 290a 2020  rray(ref_var).  
-000013a0: 2020 2020 2020 6461 7461 203d 2067 6574        data = get
-000013b0: 6174 7472 2872 6566 5f76 6172 2e64 742c  attr(ref_var.dt,
-000013c0: 2076 6172 5f6e 616d 6529 2e64 6174 610a   var_name).data.
-000013d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000013e0: 2020 6461 7461 203d 2067 6574 6174 7472    data = getattr
-000013f0: 2872 6566 5f76 6172 2c20 7661 725f 6e61  (ref_var, var_na
-00001400: 6d65 292e 6461 7461 0a20 2020 2076 6972  me).data.    vir
-00001410: 7475 616c 5f76 6172 203d 2056 6172 6961  tual_var = Varia
-00001420: 626c 6528 7265 665f 7661 722e 6469 6d73  ble(ref_var.dims
-00001430: 2c20 6461 7461 290a 0a20 2020 2072 6574  , data)..    ret
-00001440: 7572 6e20 7265 665f 6e61 6d65 2c20 7661  urn ref_name, va
-00001450: 725f 6e61 6d65 2c20 7669 7274 7561 6c5f  r_name, virtual_
-00001460: 7661 720a 0a0a 6465 6620 5f61 7373 6572  var...def _asser
-00001470: 745f 656d 7074 7928 6172 6773 3a20 7475  t_empty(args: tu
-00001480: 706c 652c 206d 7367 3a20 7374 7220 3d20  ple, msg: str = 
-00001490: 2225 7322 2920 2d3e 204e 6f6e 653a 0a20  "%s") -> None:. 
-000014a0: 2020 2069 6620 6172 6773 3a0a 2020 2020     if args:.    
-000014b0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000014c0: 7272 6f72 286d 7367 2025 2061 7267 7329  rror(msg % args)
-000014d0: 0a0a 0a64 6566 205f 6765 745f 6368 756e  ...def _get_chun
-000014e0: 6b28 7661 722c 2063 6875 6e6b 7329 3a0a  k(var, chunks):.
-000014f0: 2020 2020 2222 220a 2020 2020 5265 7475      """.    Retu
-00001500: 726e 206d 6170 2066 726f 6d20 6561 6368  rn map from each
-00001510: 2064 696d 2074 6f20 6368 756e 6b20 7369   dim to chunk si
-00001520: 7a65 732c 2061 6363 6f75 6e74 696e 6720  zes, accounting 
-00001530: 666f 7220 6261 636b 656e 6427 7320 7072  for backend's pr
-00001540: 6566 6572 7265 6420 6368 756e 6b73 2e0a  eferred chunks..
-00001550: 2020 2020 2222 220a 0a20 2020 2069 6d70      """..    imp
-00001560: 6f72 7420 6461 736b 2e61 7272 6179 2061  ort dask.array a
-00001570: 7320 6461 0a0a 2020 2020 6966 2069 7369  s da..    if isi
-00001580: 6e73 7461 6e63 6528 7661 722c 2049 6e64  nstance(var, Ind
-00001590: 6578 5661 7269 6162 6c65 293a 0a20 2020  exVariable):.   
-000015a0: 2020 2020 2072 6574 7572 6e20 7b7d 0a20       return {}. 
-000015b0: 2020 2064 696d 7320 3d20 7661 722e 6469     dims = var.di
-000015c0: 6d73 0a20 2020 2073 6861 7065 203d 2076  ms.    shape = v
-000015d0: 6172 2e73 6861 7065 0a0a 2020 2020 2320  ar.shape..    # 
-000015e0: 4465 7465 726d 696e 6520 7468 6520 6578  Determine the ex
-000015f0: 706c 6963 6974 2072 6571 7565 7374 6564  plicit requested
-00001600: 2063 6875 6e6b 732e 0a20 2020 2070 7265   chunks..    pre
-00001610: 6665 7272 6564 5f63 6875 6e6b 7320 3d20  ferred_chunks = 
-00001620: 7661 722e 656e 636f 6469 6e67 2e67 6574  var.encoding.get
-00001630: 2822 7072 6566 6572 7265 645f 6368 756e  ("preferred_chun
-00001640: 6b73 222c 207b 7d29 0a20 2020 2070 7265  ks", {}).    pre
-00001650: 6665 7272 6564 5f63 6875 6e6b 5f73 6861  ferred_chunk_sha
-00001660: 7065 203d 2074 7570 6c65 280a 2020 2020  pe = tuple(.    
-00001670: 2020 2020 7072 6566 6572 7265 645f 6368      preferred_ch
-00001680: 756e 6b73 2e67 6574 2864 696d 2c20 7369  unks.get(dim, si
-00001690: 7a65 2920 666f 7220 6469 6d2c 2073 697a  ze) for dim, siz
-000016a0: 6520 696e 207a 6970 2864 696d 732c 2073  e in zip(dims, s
-000016b0: 6861 7065 290a 2020 2020 290a 2020 2020  hape).    ).    
-000016c0: 6966 2069 7369 6e73 7461 6e63 6528 6368  if isinstance(ch
-000016d0: 756e 6b73 2c20 4e75 6d62 6572 2920 6f72  unks, Number) or
-000016e0: 2028 6368 756e 6b73 203d 3d20 2261 7574   (chunks == "aut
-000016f0: 6f22 293a 0a20 2020 2020 2020 2063 6875  o"):.        chu
-00001700: 6e6b 7320 3d20 6469 6374 2e66 726f 6d6b  nks = dict.fromk
-00001710: 6579 7328 6469 6d73 2c20 6368 756e 6b73  eys(dims, chunks
-00001720: 290a 2020 2020 6368 756e 6b5f 7368 6170  ).    chunk_shap
-00001730: 6520 3d20 7475 706c 6528 0a20 2020 2020  e = tuple(.     
-00001740: 2020 2063 6875 6e6b 732e 6765 7428 6469     chunks.get(di
-00001750: 6d2c 204e 6f6e 6529 206f 7220 7072 6566  m, None) or pref
-00001760: 6572 7265 645f 6368 756e 6b5f 7369 7a65  erred_chunk_size
-00001770: 730a 2020 2020 2020 2020 666f 7220 6469  s.        for di
-00001780: 6d2c 2070 7265 6665 7272 6564 5f63 6875  m, preferred_chu
-00001790: 6e6b 5f73 697a 6573 2069 6e20 7a69 7028  nk_sizes in zip(
-000017a0: 6469 6d73 2c20 7072 6566 6572 7265 645f  dims, preferred_
-000017b0: 6368 756e 6b5f 7368 6170 6529 0a20 2020  chunk_shape).   
-000017c0: 2029 0a20 2020 2063 6875 6e6b 5f73 6861   ).    chunk_sha
-000017d0: 7065 203d 2064 612e 636f 7265 2e6e 6f72  pe = da.core.nor
-000017e0: 6d61 6c69 7a65 5f63 6875 6e6b 7328 0a20  malize_chunks(. 
-000017f0: 2020 2020 2020 2063 6875 6e6b 5f73 6861         chunk_sha
-00001800: 7065 2c20 7368 6170 653d 7368 6170 652c  pe, shape=shape,
-00001810: 2064 7479 7065 3d76 6172 2e64 7479 7065   dtype=var.dtype
-00001820: 2c20 7072 6576 696f 7573 5f63 6875 6e6b  , previous_chunk
-00001830: 733d 7072 6566 6572 7265 645f 6368 756e  s=preferred_chun
-00001840: 6b5f 7368 6170 650a 2020 2020 290a 0a20  k_shape.    ).. 
-00001850: 2020 2023 2057 6172 6e20 7768 6572 6520     # Warn where 
-00001860: 7265 7175 6573 7465 6420 6368 756e 6b73  requested chunks
-00001870: 2062 7265 616b 2070 7265 6665 7272 6564   break preferred
-00001880: 2063 6875 6e6b 732c 2070 726f 7669 6465   chunks, provide
-00001890: 6420 7468 6174 2074 6865 2076 6172 6961  d that the varia
-000018a0: 626c 650a 2020 2020 2320 636f 6e74 6169  ble.    # contai
-000018b0: 6e73 2064 6174 612e 0a20 2020 2069 6620  ns data..    if 
-000018c0: 7661 722e 7369 7a65 3a0a 2020 2020 2020  var.size:.      
-000018d0: 2020 666f 7220 6469 6d2c 2073 697a 652c    for dim, size,
-000018e0: 2063 6875 6e6b 5f73 697a 6573 2069 6e20   chunk_sizes in 
-000018f0: 7a69 7028 6469 6d73 2c20 7368 6170 652c  zip(dims, shape,
-00001900: 2063 6875 6e6b 5f73 6861 7065 293a 0a20   chunk_shape):. 
-00001910: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00001920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001930: 7072 6566 6572 7265 645f 6368 756e 6b5f  preferred_chunk_
-00001940: 7369 7a65 7320 3d20 7072 6566 6572 7265  sizes = preferre
-00001950: 645f 6368 756e 6b73 5b64 696d 5d0a 2020  d_chunks[dim].  
-00001960: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00001970: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
-00001980: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00001990: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-000019a0: 2320 4465 7465 726d 696e 6520 7468 6520  # Determine the 
-000019b0: 7374 6f70 2069 6e64 6963 6573 206f 6620  stop indices of 
-000019c0: 7468 6520 7072 6566 6572 7265 6420 6368  the preferred ch
-000019d0: 756e 6b73 2c20 6275 7420 6f6d 6974 2074  unks, but omit t
-000019e0: 6865 206c 6173 7420 7374 6f70 0a20 2020  he last stop.   
-000019f0: 2020 2020 2020 2020 2023 2028 6571 7561           # (equa
-00001a00: 6c20 746f 2074 6865 2064 696d 2073 697a  l to the dim siz
-00001a10: 6529 2e20 2049 6e20 7061 7274 6963 756c  e).  In particul
-00001a20: 6172 2c20 6173 7375 6d65 2074 6861 7420  ar, assume that 
-00001a30: 7768 656e 2061 2073 6571 7565 6e63 650a  when a sequence.
-00001a40: 2020 2020 2020 2020 2020 2020 2320 6578              # ex
-00001a50: 7072 6573 7365 7320 7468 6520 7072 6566  presses the pref
-00001a60: 6572 7265 6420 6368 756e 6b73 2c20 7468  erred chunks, th
-00001a70: 6520 7365 7175 656e 6365 2073 756d 7320  e sequence sums 
-00001a80: 746f 2074 6865 2073 697a 652e 0a20 2020  to the size..   
-00001a90: 2020 2020 2020 2020 2070 7265 6665 7272           preferr
-00001aa0: 6564 5f73 746f 7073 203d 2028 0a20 2020  ed_stops = (.   
-00001ab0: 2020 2020 2020 2020 2020 2020 2072 616e               ran
-00001ac0: 6765 2870 7265 6665 7272 6564 5f63 6875  ge(preferred_chu
-00001ad0: 6e6b 5f73 697a 6573 2c20 7369 7a65 2c20  nk_sizes, size, 
-00001ae0: 7072 6566 6572 7265 645f 6368 756e 6b5f  preferred_chunk_
-00001af0: 7369 7a65 7329 0a20 2020 2020 2020 2020  sizes).         
-00001b00: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00001b10: 616e 6365 2870 7265 6665 7272 6564 5f63  ance(preferred_c
-00001b20: 6875 6e6b 5f73 697a 6573 2c20 4e75 6d62  hunk_sizes, Numb
-00001b30: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-00001b40: 2020 2020 656c 7365 2069 7465 7274 6f6f      else itertoo
-00001b50: 6c73 2e61 6363 756d 756c 6174 6528 7072  ls.accumulate(pr
-00001b60: 6566 6572 7265 645f 6368 756e 6b5f 7369  eferred_chunk_si
-00001b70: 7a65 735b 3a2d 315d 290a 2020 2020 2020  zes[:-1]).      
-00001b80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00001b90: 2020 2020 2320 4761 7468 6572 2061 6e79      # Gather any
-00001ba0: 2073 746f 7020 696e 6469 6365 7320 6f66   stop indices of
-00001bb0: 2074 6865 2073 7065 6369 6669 6564 2063   the specified c
-00001bc0: 6875 6e6b 7320 7468 6174 2061 7265 206e  hunks that are n
-00001bd0: 6f74 2061 2073 746f 7020 696e 6465 780a  ot a stop index.
-00001be0: 2020 2020 2020 2020 2020 2020 2320 6f66              # of
-00001bf0: 2061 2070 7265 6665 7272 6564 2063 6875   a preferred chu
-00001c00: 6e6b 2e20 2041 6761 696e 2c20 6f6d 6974  nk.  Again, omit
-00001c10: 2074 6865 206c 6173 7420 7374 6f70 2c20   the last stop, 
-00001c20: 6173 7375 6d69 6e67 2074 6861 7420 6974  assuming that it
-00001c30: 2065 7175 616c 730a 2020 2020 2020 2020   equals.        
-00001c40: 2020 2020 2320 7468 6520 6469 6d20 7369      # the dim si
-00001c50: 7a65 2e0a 2020 2020 2020 2020 2020 2020  ze..            
-00001c60: 6272 6561 6b73 203d 2073 6574 2869 7465  breaks = set(ite
-00001c70: 7274 6f6f 6c73 2e61 6363 756d 756c 6174  rtools.accumulat
-00001c80: 6528 6368 756e 6b5f 7369 7a65 735b 3a2d  e(chunk_sizes[:-
-00001c90: 315d 2929 2e64 6966 6665 7265 6e63 6528  1])).difference(
-00001ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001cb0: 2070 7265 6665 7272 6564 5f73 746f 7073   preferred_stops
-00001cc0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00001cd0: 2020 2020 2020 2020 2020 2069 6620 6272             if br
-00001ce0: 6561 6b73 3a0a 2020 2020 2020 2020 2020  eaks:.          
-00001cf0: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
-00001d00: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
-00001d10: 2020 2020 2020 2020 2022 5468 6520 7370           "The sp
-00001d20: 6563 6966 6965 6420 4461 736b 2063 6875  ecified Dask chu
-00001d30: 6e6b 7320 7365 7061 7261 7465 2074 6865  nks separate the
-00001d40: 2073 746f 7265 6420 6368 756e 6b73 2061   stored chunks a
-00001d50: 6c6f 6e67 2022 0a20 2020 2020 2020 2020  long ".         
-00001d60: 2020 2020 2020 2020 2020 2066 2764 696d             f'dim
-00001d70: 656e 7369 6f6e 2022 7b64 696d 7d22 2073  ension "{dim}" s
-00001d80: 7461 7274 696e 6720 6174 2069 6e64 6578  tarting at index
-00001d90: 207b 6d69 6e28 6272 6561 6b73 297d 2e20   {min(breaks)}. 
-00001da0: 5468 6973 2063 6f75 6c64 2027 0a20 2020  This could '.   
-00001db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001dc0: 2022 6465 6772 6164 6520 7065 7266 6f72   "degrade perfor
-00001dd0: 6d61 6e63 652e 2049 6e73 7465 6164 2c20  mance. Instead, 
-00001de0: 636f 6e73 6964 6572 2072 6563 6875 6e6b  consider rechunk
-00001df0: 696e 6720 6166 7465 7220 6c6f 6164 696e  ing after loadin
-00001e00: 672e 220a 2020 2020 2020 2020 2020 2020  g.".            
-00001e10: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
-00001e20: 6e20 6469 6374 287a 6970 2864 696d 732c  n dict(zip(dims,
-00001e30: 2063 6875 6e6b 5f73 6861 7065 2929 0a0a   chunk_shape))..
-00001e40: 0a64 6566 205f 6d61 7962 655f 6368 756e  .def _maybe_chun
-00001e50: 6b28 0a20 2020 206e 616d 652c 0a20 2020  k(.    name,.   
-00001e60: 2076 6172 2c0a 2020 2020 6368 756e 6b73   var,.    chunks
-00001e70: 2c0a 2020 2020 746f 6b65 6e3d 4e6f 6e65  ,.    token=None
-00001e80: 2c0a 2020 2020 6c6f 636b 3d4e 6f6e 652c  ,.    lock=None,
-00001e90: 0a20 2020 206e 616d 655f 7072 6566 6978  .    name_prefix
-00001ea0: 3d22 7861 7272 6179 2d22 2c0a 2020 2020  ="xarray-",.    
-00001eb0: 6f76 6572 7772 6974 655f 656e 636f 6465  overwrite_encode
-00001ec0: 645f 6368 756e 6b73 3d46 616c 7365 2c0a  d_chunks=False,.
-00001ed0: 2020 2020 696e 6c69 6e65 5f61 7272 6179      inline_array
-00001ee0: 3d46 616c 7365 2c0a 293a 0a20 2020 2066  =False,.):.    f
-00001ef0: 726f 6d20 6461 736b 2e62 6173 6520 696d  rom dask.base im
-00001f00: 706f 7274 2074 6f6b 656e 697a 650a 0a20  port tokenize.. 
-00001f10: 2020 2069 6620 6368 756e 6b73 2069 7320     if chunks is 
-00001f20: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00001f30: 2020 6368 756e 6b73 203d 207b 6469 6d3a    chunks = {dim:
-00001f40: 2063 6875 6e6b 735b 6469 6d5d 2066 6f72   chunks[dim] for
-00001f50: 2064 696d 2069 6e20 7661 722e 6469 6d73   dim in var.dims
-00001f60: 2069 6620 6469 6d20 696e 2063 6875 6e6b   if dim in chunk
-00001f70: 737d 0a20 2020 2069 6620 7661 722e 6e64  s}.    if var.nd
-00001f80: 696d 3a0a 2020 2020 2020 2020 2320 7768  im:.        # wh
-00001f90: 656e 2072 6563 6875 6e6b 696e 6720 6279  en rechunking by
-00001fa0: 2064 6966 6665 7265 6e74 2061 6d6f 756e   different amoun
-00001fb0: 7473 2c20 6d61 6b65 2073 7572 6520 6461  ts, make sure da
-00001fc0: 736b 206e 616d 6573 2063 6861 6e67 650a  sk names change.
-00001fd0: 2020 2020 2020 2020 2320 6279 2070 726f          # by pro
-00001fe0: 7669 6e64 696e 6720 6368 756e 6b73 2061  vinding chunks a
-00001ff0: 7320 616e 2069 6e70 7574 2074 6f20 746f  s an input to to
-00002000: 6b65 6e69 7a65 2e0a 2020 2020 2020 2020  kenize..        
-00002010: 2320 7375 6274 6c65 2062 7567 7320 7265  # subtle bugs re
-00002020: 7375 6c74 206f 7468 6572 7769 7365 2e20  sult otherwise. 
-00002030: 7365 6520 4748 3333 3530 0a20 2020 2020  see GH3350.     
-00002040: 2020 2074 6f6b 656e 3220 3d20 746f 6b65     token2 = toke
-00002050: 6e69 7a65 286e 616d 652c 2074 6f6b 656e  nize(name, token
-00002060: 2069 6620 746f 6b65 6e20 656c 7365 2076   if token else v
-00002070: 6172 2e5f 6461 7461 2c20 6368 756e 6b73  ar._data, chunks
-00002080: 290a 2020 2020 2020 2020 6e61 6d65 3220  ).        name2 
-00002090: 3d20 6622 7b6e 616d 655f 7072 6566 6978  = f"{name_prefix
-000020a0: 7d7b 6e61 6d65 7d2d 7b74 6f6b 656e 327d  }{name}-{token2}
-000020b0: 220a 2020 2020 2020 2020 7661 7220 3d20  ".        var = 
-000020c0: 7661 722e 6368 756e 6b28 6368 756e 6b73  var.chunk(chunks
-000020d0: 2c20 6e61 6d65 3d6e 616d 6532 2c20 6c6f  , name=name2, lo
-000020e0: 636b 3d6c 6f63 6b2c 2069 6e6c 696e 655f  ck=lock, inline_
-000020f0: 6172 7261 793d 696e 6c69 6e65 5f61 7272  array=inline_arr
-00002100: 6179 290a 0a20 2020 2020 2020 2069 6620  ay)..        if 
-00002110: 6f76 6572 7772 6974 655f 656e 636f 6465  overwrite_encode
-00002120: 645f 6368 756e 6b73 2061 6e64 2076 6172  d_chunks and var
-00002130: 2e63 6875 6e6b 7320 6973 206e 6f74 204e  .chunks is not N
-00002140: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00002150: 2076 6172 2e65 6e63 6f64 696e 675b 2263   var.encoding["c
-00002160: 6875 6e6b 7322 5d20 3d20 7475 706c 6528  hunks"] = tuple(
-00002170: 785b 305d 2066 6f72 2078 2069 6e20 7661  x[0] for x in va
-00002180: 722e 6368 756e 6b73 290a 2020 2020 2020  r.chunks).      
-00002190: 2020 7265 7475 726e 2076 6172 0a20 2020    return var.   
-000021a0: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-000021b0: 6574 7572 6e20 7661 720a 0a0a 6465 6620  eturn var...def 
-000021c0: 6173 5f64 6174 6173 6574 286f 626a 3a20  as_dataset(obj: 
-000021d0: 416e 7929 202d 3e20 4461 7461 7365 743a  Any) -> Dataset:
-000021e0: 0a20 2020 2022 2222 4361 7374 2074 6865  .    """Cast the
-000021f0: 2067 6976 656e 206f 626a 6563 7420 746f   given object to
-00002200: 2061 2044 6174 6173 6574 2e0a 0a20 2020   a Dataset...   
-00002210: 2048 616e 646c 6573 2044 6174 6173 6574   Handles Dataset
-00002220: 732c 2044 6174 6141 7272 6179 7320 616e  s, DataArrays an
-00002230: 6420 6469 6374 696f 6e61 7269 6573 206f  d dictionaries o
-00002240: 6620 7661 7269 6162 6c65 732e 2041 206e  f variables. A n
-00002250: 6577 2044 6174 6173 6574 0a20 2020 206f  ew Dataset.    o
-00002260: 626a 6563 7420 6973 206f 6e6c 7920 6372  bject is only cr
-00002270: 6561 7465 6420 6966 2074 6865 2070 726f  eated if the pro
-00002280: 7669 6465 6420 6f62 6a65 6374 2069 7320  vided object is 
-00002290: 6e6f 7420 616c 7265 6164 7920 6f6e 652e  not already one.
-000022a0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-000022b0: 6861 7361 7474 7228 6f62 6a2c 2022 746f  hasattr(obj, "to
-000022c0: 5f64 6174 6173 6574 2229 3a0a 2020 2020  _dataset"):.    
-000022d0: 2020 2020 6f62 6a20 3d20 6f62 6a2e 746f      obj = obj.to
-000022e0: 5f64 6174 6173 6574 2829 0a20 2020 2069  _dataset().    i
-000022f0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00002300: 286f 626a 2c20 4461 7461 7365 7429 3a0a  (obj, Dataset):.
-00002310: 2020 2020 2020 2020 6f62 6a20 3d20 4461          obj = Da
-00002320: 7461 7365 7428 6f62 6a29 0a20 2020 2072  taset(obj).    r
-00002330: 6574 7572 6e20 6f62 6a0a 0a0a 6465 6620  eturn obj...def 
-00002340: 5f67 6574 5f66 756e 635f 6172 6773 2866  _get_func_args(f
-00002350: 756e 632c 2070 6172 616d 5f6e 616d 6573  unc, param_names
-00002360: 293a 0a20 2020 2022 2222 5573 6520 6069  ):.    """Use `i
-00002370: 6e73 7065 6374 2e73 6967 6e61 7475 7265  nspect.signature
-00002380: 6020 746f 2074 7279 2061 6363 6573 7369  ` to try accessi
-00002390: 6e67 2060 6675 6e63 6020 6172 6773 2e20  ng `func` args. 
-000023a0: 4f74 6865 7277 6973 652c 2065 6e73 7572  Otherwise, ensur
-000023b0: 650a 2020 2020 7468 6579 2061 7265 2070  e.    they are p
-000023c0: 726f 7669 6465 6420 6279 2075 7365 722e  rovided by user.
-000023d0: 0a20 2020 2022 2222 0a20 2020 2074 7279  .    """.    try
-000023e0: 3a0a 2020 2020 2020 2020 6675 6e63 5f61  :.        func_a
-000023f0: 7267 7320 3d20 696e 7370 6563 742e 7369  rgs = inspect.si
-00002400: 676e 6174 7572 6528 6675 6e63 292e 7061  gnature(func).pa
-00002410: 7261 6d65 7465 7273 0a20 2020 2065 7863  rameters.    exc
-00002420: 6570 7420 5661 6c75 6545 7272 6f72 3a0a  ept ValueError:.
-00002430: 2020 2020 2020 2020 6675 6e63 5f61 7267          func_arg
-00002440: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
-00002450: 6620 6e6f 7420 7061 7261 6d5f 6e61 6d65  f not param_name
-00002460: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-00002470: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00002480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002490: 2022 556e 6162 6c65 2074 6f20 696e 7370   "Unable to insp
-000024a0: 6563 7420 6066 756e 6360 2073 6967 6e61  ect `func` signa
-000024b0: 7475 7265 2c20 616e 6420 6070 6172 616d  ture, and `param
-000024c0: 5f6e 616d 6573 6020 7761 7320 6e6f 7420  _names` was not 
-000024d0: 7072 6f76 6964 6564 2e22 0a20 2020 2020  provided.".     
-000024e0: 2020 2020 2020 2029 0a20 2020 2069 6620         ).    if 
-000024f0: 7061 7261 6d5f 6e61 6d65 733a 0a20 2020  param_names:.   
-00002500: 2020 2020 2070 6172 616d 7320 3d20 7061       params = pa
-00002510: 7261 6d5f 6e61 6d65 730a 2020 2020 656c  ram_names.    el
-00002520: 7365 3a0a 2020 2020 2020 2020 7061 7261  se:.        para
-00002530: 6d73 203d 206c 6973 7428 6675 6e63 5f61  ms = list(func_a
-00002540: 7267 7329 5b31 3a5d 0a20 2020 2020 2020  rgs)[1:].       
-00002550: 2069 6620 616e 7928 0a20 2020 2020 2020   if any(.       
-00002560: 2020 2020 205b 2870 2e6b 696e 6420 696e       [(p.kind in
-00002570: 205b 702e 5641 525f 504f 5349 5449 4f4e   [p.VAR_POSITION
-00002580: 414c 2c20 702e 5641 525f 4b45 5957 4f52  AL, p.VAR_KEYWOR
-00002590: 445d 2920 666f 7220 7020 696e 2066 756e  D]) for p in fun
-000025a0: 635f 6172 6773 2e76 616c 7565 7328 295d  c_args.values()]
-000025b0: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
-000025c0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000025d0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-000025e0: 2020 2020 2020 2020 2020 2260 7061 7261            "`para
-000025f0: 6d5f 6e61 6d65 7360 206d 7573 7420 6265  m_names` must be
-00002600: 2070 726f 7669 6465 6420 6265 6361 7573   provided becaus
-00002610: 6520 6066 756e 6360 2074 616b 6573 2076  e `func` takes v
-00002620: 6172 6961 626c 6520 6c65 6e67 7468 2061  ariable length a
-00002630: 7267 756d 656e 7473 2e22 0a20 2020 2020  rguments.".     
-00002640: 2020 2020 2020 2029 0a20 2020 2072 6574         ).    ret
-00002650: 7572 6e20 7061 7261 6d73 2c20 6675 6e63  urn params, func
-00002660: 5f61 7267 730a 0a0a 6465 6620 5f69 6e69  _args...def _ini
-00002670: 7469 616c 697a 655f 6375 7276 6566 6974  tialize_curvefit
-00002680: 5f70 6172 616d 7328 7061 7261 6d73 2c20  _params(params, 
-00002690: 7030 2c20 626f 756e 6473 2c20 6675 6e63  p0, bounds, func
-000026a0: 5f61 7267 7329 3a0a 2020 2020 2222 2253  _args):.    """S
-000026b0: 6574 2069 6e69 7469 616c 2067 7565 7373  et initial guess
-000026c0: 2061 6e64 2062 6f75 6e64 7320 666f 7220   and bounds for 
-000026d0: 6375 7276 6566 6974 2e0a 2020 2020 5072  curvefit..    Pr
-000026e0: 696f 7269 7479 3a20 3129 2070 6173 7365  iority: 1) passe
-000026f0: 6420 6172 6773 2032 2920 6675 6e63 2073  d args 2) func s
-00002700: 6967 6e61 7475 7265 2033 2920 7363 6970  ignature 3) scip
-00002710: 7920 6465 6661 756c 7473 0a20 2020 2022  y defaults.    "
-00002720: 2222 0a0a 2020 2020 6465 6620 5f69 6e69  ""..    def _ini
-00002730: 7469 616c 697a 655f 6665 6173 6962 6c65  tialize_feasible
-00002740: 286c 622c 2075 6229 3a0a 2020 2020 2020  (lb, ub):.      
-00002750: 2020 2320 4d69 6d69 6373 2066 756e 6374    # Mimics funct
-00002760: 696f 6e61 6c69 7479 206f 6620 7363 6970  ionality of scip
-00002770: 792e 6f70 7469 6d69 7a65 2e6d 696e 7061  y.optimize.minpa
-00002780: 636b 2e5f 696e 6974 6961 6c69 7a65 5f66  ck._initialize_f
-00002790: 6561 7369 626c 650a 2020 2020 2020 2020  easible.        
-000027a0: 6c62 5f66 696e 6974 6520 3d20 6e70 2e69  lb_finite = np.i
-000027b0: 7366 696e 6974 6528 6c62 290a 2020 2020  sfinite(lb).    
-000027c0: 2020 2020 7562 5f66 696e 6974 6520 3d20      ub_finite = 
-000027d0: 6e70 2e69 7366 696e 6974 6528 7562 290a  np.isfinite(ub).
-000027e0: 2020 2020 2020 2020 7030 203d 206e 702e          p0 = np.
-000027f0: 6e61 6e73 756d 280a 2020 2020 2020 2020  nansum(.        
-00002800: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
-00002810: 2020 2020 2020 302e 3520 2a20 286c 6220        0.5 * (lb 
-00002820: 2b20 7562 2920 2a20 696e 7428 6c62 5f66  + ub) * int(lb_f
-00002830: 696e 6974 6520 2620 7562 5f66 696e 6974  inite & ub_finit
-00002840: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00002850: 2020 2020 286c 6220 2b20 3129 202a 2069      (lb + 1) * i
-00002860: 6e74 286c 625f 6669 6e69 7465 2026 207e  nt(lb_finite & ~
-00002870: 7562 5f66 696e 6974 6529 2c0a 2020 2020  ub_finite),.    
-00002880: 2020 2020 2020 2020 2020 2020 2875 6220              (ub 
-00002890: 2d20 3129 202a 2069 6e74 287e 6c62 5f66  - 1) * int(~lb_f
-000028a0: 696e 6974 6520 2620 7562 5f66 696e 6974  inite & ub_finit
-000028b0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-000028c0: 5d0a 2020 2020 2020 2020 290a 2020 2020  ].        ).    
-000028d0: 2020 2020 7265 7475 726e 2070 300a 0a20      return p0.. 
-000028e0: 2020 2070 6172 616d 5f64 6566 6175 6c74     param_default
-000028f0: 7320 3d20 7b70 3a20 3120 666f 7220 7020  s = {p: 1 for p 
-00002900: 696e 2070 6172 616d 737d 0a20 2020 2062  in params}.    b
-00002910: 6f75 6e64 735f 6465 6661 756c 7473 203d  ounds_defaults =
-00002920: 207b 703a 2028 2d6e 702e 696e 662c 206e   {p: (-np.inf, n
-00002930: 702e 696e 6629 2066 6f72 2070 2069 6e20  p.inf) for p in 
-00002940: 7061 7261 6d73 7d0a 2020 2020 666f 7220  params}.    for 
-00002950: 7020 696e 2070 6172 616d 733a 0a20 2020  p in params:.   
-00002960: 2020 2020 2069 6620 7020 696e 2066 756e       if p in fun
-00002970: 635f 6172 6773 2061 6e64 2066 756e 635f  c_args and func_
-00002980: 6172 6773 5b70 5d2e 6465 6661 756c 7420  args[p].default 
-00002990: 6973 206e 6f74 2066 756e 635f 6172 6773  is not func_args
-000029a0: 5b70 5d2e 656d 7074 793a 0a20 2020 2020  [p].empty:.     
-000029b0: 2020 2020 2020 2070 6172 616d 5f64 6566         param_def
-000029c0: 6175 6c74 735b 705d 203d 2066 756e 635f  aults[p] = func_
-000029d0: 6172 6773 5b70 5d2e 6465 6661 756c 740a  args[p].default.
-000029e0: 2020 2020 2020 2020 6966 2070 2069 6e20          if p in 
-000029f0: 626f 756e 6473 3a0a 2020 2020 2020 2020  bounds:.        
-00002a00: 2020 2020 626f 756e 6473 5f64 6566 6175      bounds_defau
-00002a10: 6c74 735b 705d 203d 2074 7570 6c65 2862  lts[p] = tuple(b
-00002a20: 6f75 6e64 735b 705d 290a 2020 2020 2020  ounds[p]).      
-00002a30: 2020 2020 2020 6966 2070 6172 616d 5f64        if param_d
-00002a40: 6566 6175 6c74 735b 705d 203c 2062 6f75  efaults[p] < bou
-00002a50: 6e64 735b 705d 5b30 5d20 6f72 2070 6172  nds[p][0] or par
-00002a60: 616d 5f64 6566 6175 6c74 735b 705d 203e  am_defaults[p] >
-00002a70: 2062 6f75 6e64 735b 705d 5b31 5d3a 0a20   bounds[p][1]:. 
-00002a80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00002a90: 6172 616d 5f64 6566 6175 6c74 735b 705d  aram_defaults[p]
-00002aa0: 203d 205f 696e 6974 6961 6c69 7a65 5f66   = _initialize_f
-00002ab0: 6561 7369 626c 6528 626f 756e 6473 5b70  easible(bounds[p
-00002ac0: 5d5b 305d 2c20 626f 756e 6473 5b70 5d5b  ][0], bounds[p][
-00002ad0: 315d 290a 2020 2020 2020 2020 6966 2070  1]).        if p
-00002ae0: 2069 6e20 7030 3a0a 2020 2020 2020 2020   in p0:.        
-00002af0: 2020 2020 7061 7261 6d5f 6465 6661 756c      param_defaul
-00002b00: 7473 5b70 5d20 3d20 7030 5b70 5d0a 2020  ts[p] = p0[p].  
-00002b10: 2020 7265 7475 726e 2070 6172 616d 5f64    return param_d
-00002b20: 6566 6175 6c74 732c 2062 6f75 6e64 735f  efaults, bounds_
-00002b30: 6465 6661 756c 7473 0a0a 0a63 6c61 7373  defaults...class
-00002b40: 2044 6174 6156 6172 6961 626c 6573 284d   DataVariables(M
-00002b50: 6170 7069 6e67 5b41 6e79 2c20 2244 6174  apping[Any, "Dat
-00002b60: 6141 7272 6179 225d 293a 0a20 2020 205f  aArray"]):.    _
-00002b70: 5f73 6c6f 7473 5f5f 203d 2028 225f 6461  _slots__ = ("_da
-00002b80: 7461 7365 7422 2c29 0a0a 2020 2020 6465  taset",)..    de
-00002b90: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00002ba0: 2064 6174 6173 6574 3a20 4461 7461 7365   dataset: Datase
-00002bb0: 7429 3a0a 2020 2020 2020 2020 7365 6c66  t):.        self
-00002bc0: 2e5f 6461 7461 7365 7420 3d20 6461 7461  ._dataset = data
-00002bd0: 7365 740a 0a20 2020 2064 6566 205f 5f69  set..    def __i
-00002be0: 7465 725f 5f28 7365 6c66 2920 2d3e 2049  ter__(self) -> I
-00002bf0: 7465 7261 746f 725b 4861 7368 6162 6c65  terator[Hashable
-00002c00: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
-00002c10: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-00002c20: 6b65 790a 2020 2020 2020 2020 2020 2020  key.            
-00002c30: 666f 7220 6b65 7920 696e 2073 656c 662e  for key in self.
-00002c40: 5f64 6174 6173 6574 2e5f 7661 7269 6162  _dataset._variab
-00002c50: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
-00002c60: 6966 206b 6579 206e 6f74 2069 6e20 7365  if key not in se
-00002c70: 6c66 2e5f 6461 7461 7365 742e 5f63 6f6f  lf._dataset._coo
-00002c80: 7264 5f6e 616d 6573 0a20 2020 2020 2020  rd_names.       
-00002c90: 2029 0a0a 2020 2020 6465 6620 5f5f 6c65   )..    def __le
-00002ca0: 6e5f 5f28 7365 6c66 2920 2d3e 2069 6e74  n__(self) -> int
-00002cb0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00002cc0: 206c 656e 2873 656c 662e 5f64 6174 6173   len(self._datas
-00002cd0: 6574 2e5f 7661 7269 6162 6c65 7329 202d  et._variables) -
-00002ce0: 206c 656e 2873 656c 662e 5f64 6174 6173   len(self._datas
-00002cf0: 6574 2e5f 636f 6f72 645f 6e61 6d65 7329  et._coord_names)
-00002d00: 0a0a 2020 2020 6465 6620 5f5f 636f 6e74  ..    def __cont
-00002d10: 6169 6e73 5f5f 2873 656c 662c 206b 6579  ains__(self, key
-00002d20: 3a20 4861 7368 6162 6c65 2920 2d3e 2062  : Hashable) -> b
-00002d30: 6f6f 6c3a 0a20 2020 2020 2020 2072 6574  ool:.        ret
-00002d40: 7572 6e20 6b65 7920 696e 2073 656c 662e  urn key in self.
-00002d50: 5f64 6174 6173 6574 2e5f 7661 7269 6162  _dataset._variab
-00002d60: 6c65 7320 616e 6420 6b65 7920 6e6f 7420  les and key not 
-00002d70: 696e 2073 656c 662e 5f64 6174 6173 6574  in self._dataset
-00002d80: 2e5f 636f 6f72 645f 6e61 6d65 730a 0a20  ._coord_names.. 
-00002d90: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
-00002da0: 5f5f 2873 656c 662c 206b 6579 3a20 4861  __(self, key: Ha
-00002db0: 7368 6162 6c65 2920 2d3e 2044 6174 6141  shable) -> DataA
-00002dc0: 7272 6179 3a0a 2020 2020 2020 2020 6966  rray:.        if
-00002dd0: 206b 6579 206e 6f74 2069 6e20 7365 6c66   key not in self
-00002de0: 2e5f 6461 7461 7365 742e 5f63 6f6f 7264  ._dataset._coord
-00002df0: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
-00002e00: 2020 2020 7265 7475 726e 2063 6173 7428      return cast(
-00002e10: 2244 6174 6141 7272 6179 222c 2073 656c  "DataArray", sel
-00002e20: 662e 5f64 6174 6173 6574 5b6b 6579 5d29  f._dataset[key])
-00002e30: 0a20 2020 2020 2020 2072 6169 7365 204b  .        raise K
-00002e40: 6579 4572 726f 7228 6b65 7929 0a0a 2020  eyError(key)..  
-00002e50: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
-00002e60: 656c 6629 202d 3e20 7374 723a 0a20 2020  elf) -> str:.   
-00002e70: 2020 2020 2072 6574 7572 6e20 666f 726d       return form
-00002e80: 6174 7469 6e67 2e64 6174 615f 7661 7273  atting.data_vars
-00002e90: 5f72 6570 7228 7365 6c66 290a 0a20 2020  _repr(self)..   
-00002ea0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00002eb0: 6566 2076 6172 6961 626c 6573 2873 656c  ef variables(sel
-00002ec0: 6629 202d 3e20 4d61 7070 696e 675b 4861  f) -> Mapping[Ha
-00002ed0: 7368 6162 6c65 2c20 5661 7269 6162 6c65  shable, Variable
-00002ee0: 5d3a 0a20 2020 2020 2020 2061 6c6c 5f76  ]:.        all_v
-00002ef0: 6172 6961 626c 6573 203d 2073 656c 662e  ariables = self.
-00002f00: 5f64 6174 6173 6574 2e76 6172 6961 626c  _dataset.variabl
-00002f10: 6573 0a20 2020 2020 2020 2072 6574 7572  es.        retur
-00002f20: 6e20 4672 6f7a 656e 287b 6b3a 2061 6c6c  n Frozen({k: all
-00002f30: 5f76 6172 6961 626c 6573 5b6b 5d20 666f  _variables[k] fo
-00002f40: 7220 6b20 696e 2073 656c 667d 290a 0a20  r k in self}).. 
-00002f50: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00002f60: 2064 6566 2064 7479 7065 7328 7365 6c66   def dtypes(self
-00002f70: 2920 2d3e 2046 726f 7a65 6e5b 4861 7368  ) -> Frozen[Hash
-00002f80: 6162 6c65 2c20 6e70 2e64 7479 7065 5d3a  able, np.dtype]:
-00002f90: 0a20 2020 2020 2020 2022 2222 4d61 7070  .        """Mapp
-00002fa0: 696e 6720 6672 6f6d 2064 6174 6120 7661  ing from data va
-00002fb0: 7269 6162 6c65 206e 616d 6573 2074 6f20  riable names to 
-00002fc0: 6474 7970 6573 2e0a 0a20 2020 2020 2020  dtypes...       
-00002fd0: 2043 616e 6e6f 7420 6265 206d 6f64 6966   Cannot be modif
-00002fe0: 6965 6420 6469 7265 6374 6c79 2c20 6275  ied directly, bu
-00002ff0: 7420 6973 2075 7064 6174 6564 2077 6865  t is updated whe
-00003000: 6e20 6164 6469 6e67 206e 6577 2076 6172  n adding new var
-00003010: 6961 626c 6573 2e0a 0a20 2020 2020 2020  iables...       
-00003020: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-00003030: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00003040: 2020 2044 6174 6173 6574 2e64 7479 7065     Dataset.dtype
-00003050: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00003060: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00003070: 2e5f 6461 7461 7365 742e 6474 7970 6573  ._dataset.dtypes
-00003080: 0a0a 2020 2020 6465 6620 5f69 7079 7468  ..    def _ipyth
-00003090: 6f6e 5f6b 6579 5f63 6f6d 706c 6574 696f  on_key_completio
-000030a0: 6e73 5f28 7365 6c66 293a 0a20 2020 2020  ns_(self):.     
-000030b0: 2020 2022 2222 5072 6f76 6964 6520 6d65     """Provide me
-000030c0: 7468 6f64 2066 6f72 2074 6865 206b 6579  thod for the key
-000030d0: 2d61 7574 6f63 6f6d 706c 6574 696f 6e73  -autocompletions
-000030e0: 2069 6e20 4950 7974 686f 6e2e 2222 220a   in IPython.""".
-000030f0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00003100: 0a20 2020 2020 2020 2020 2020 206b 6579  .            key
-00003110: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00003120: 206b 6579 2069 6e20 7365 6c66 2e5f 6461   key in self._da
-00003130: 7461 7365 742e 5f69 7079 7468 6f6e 5f6b  taset._ipython_k
-00003140: 6579 5f63 6f6d 706c 6574 696f 6e73 5f28  ey_completions_(
-00003150: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00003160: 206b 6579 206e 6f74 2069 6e20 7365 6c66   key not in self
-00003170: 2e5f 6461 7461 7365 742e 5f63 6f6f 7264  ._dataset._coord
-00003180: 5f6e 616d 6573 0a20 2020 2020 2020 205d  _names.        ]
-00003190: 0a0a 0a63 6c61 7373 205f 4c6f 6349 6e64  ...class _LocInd
-000031a0: 6578 6572 2847 656e 6572 6963 5b54 5f44  exer(Generic[T_D
-000031b0: 6174 6173 6574 5d29 3a0a 2020 2020 5f5f  ataset]):.    __
-000031c0: 736c 6f74 735f 5f20 3d20 2822 6461 7461  slots__ = ("data
-000031d0: 7365 7422 2c29 0a0a 2020 2020 6465 6620  set",)..    def 
-000031e0: 5f5f 696e 6974 5f5f 2873 656c 662c 2064  __init__(self, d
-000031f0: 6174 6173 6574 3a20 545f 4461 7461 7365  ataset: T_Datase
-00003200: 7429 3a0a 2020 2020 2020 2020 7365 6c66  t):.        self
-00003210: 2e64 6174 6173 6574 203d 2064 6174 6173  .dataset = datas
-00003220: 6574 0a0a 2020 2020 6465 6620 5f5f 6765  et..    def __ge
-00003230: 7469 7465 6d5f 5f28 7365 6c66 2c20 6b65  titem__(self, ke
-00003240: 793a 204d 6170 7069 6e67 5b41 6e79 2c20  y: Mapping[Any, 
-00003250: 416e 795d 2920 2d3e 2054 5f44 6174 6173  Any]) -> T_Datas
-00003260: 6574 3a0a 2020 2020 2020 2020 6966 206e  et:.        if n
-00003270: 6f74 2075 7469 6c73 2e69 735f 6469 6374  ot utils.is_dict
-00003280: 5f6c 696b 6528 6b65 7929 3a0a 2020 2020  _like(key):.    
-00003290: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-000032a0: 7065 4572 726f 7228 2263 616e 206f 6e6c  peError("can onl
-000032b0: 7920 6c6f 6f6b 7570 2064 6963 7469 6f6e  y lookup diction
-000032c0: 6172 6965 7320 6672 6f6d 2044 6174 6173  aries from Datas
-000032d0: 6574 2e6c 6f63 2229 0a20 2020 2020 2020  et.loc").       
-000032e0: 2072 6574 7572 6e20 7365 6c66 2e64 6174   return self.dat
-000032f0: 6173 6574 2e73 656c 286b 6579 290a 0a20  aset.sel(key).. 
-00003300: 2020 2064 6566 205f 5f73 6574 6974 656d     def __setitem
-00003310: 5f5f 2873 656c 662c 206b 6579 2c20 7661  __(self, key, va
-00003320: 6c75 6529 202d 3e20 4e6f 6e65 3a0a 2020  lue) -> None:.  
-00003330: 2020 2020 2020 6966 206e 6f74 2075 7469        if not uti
-00003340: 6c73 2e69 735f 6469 6374 5f6c 696b 6528  ls.is_dict_like(
-00003350: 6b65 7929 3a0a 2020 2020 2020 2020 2020  key):.          
-00003360: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-00003370: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00003380: 2020 2022 6361 6e20 6f6e 6c79 2073 6574     "can only set
-00003390: 206c 6f63 6174 696f 6e73 2064 6566 696e   locations defin
-000033a0: 6564 2062 7920 6469 6374 696f 6e61 7269  ed by dictionari
-000033b0: 6573 2066 726f 6d20 4461 7461 7365 742e  es from Dataset.
-000033c0: 6c6f 632e 220a 2020 2020 2020 2020 2020  loc.".          
-000033d0: 2020 2020 2020 6622 2047 6f74 3a20 7b6b        f" Got: {k
-000033e0: 6579 7d22 0a20 2020 2020 2020 2020 2020  ey}".           
-000033f0: 2029 0a0a 2020 2020 2020 2020 2320 7365   )..        # se
-00003400: 7420 6e65 7720 7661 6c75 6573 0a20 2020  t new values.   
-00003410: 2020 2020 2064 696d 5f69 6e64 6578 6572       dim_indexer
-00003420: 7320 3d20 6d61 705f 696e 6465 785f 7175  s = map_index_qu
-00003430: 6572 6965 7328 7365 6c66 2e64 6174 6173  eries(self.datas
-00003440: 6574 2c20 6b65 7929 2e64 696d 5f69 6e64  et, key).dim_ind
-00003450: 6578 6572 730a 2020 2020 2020 2020 7365  exers.        se
-00003460: 6c66 2e64 6174 6173 6574 5b64 696d 5f69  lf.dataset[dim_i
-00003470: 6e64 6578 6572 735d 203d 2076 616c 7565  ndexers] = value
-00003480: 0a0a 0a63 6c61 7373 2044 6174 6173 6574  ...class Dataset
-00003490: 280a 2020 2020 4461 7461 5769 7468 436f  (.    DataWithCo
-000034a0: 6f72 6473 2c0a 2020 2020 4461 7461 7365  ords,.    Datase
-000034b0: 7441 6767 7265 6761 7469 6f6e 732c 0a20  tAggregations,. 
-000034c0: 2020 2044 6174 6173 6574 4172 6974 686d     DatasetArithm
-000034d0: 6574 6963 2c0a 2020 2020 4d61 7070 696e  etic,.    Mappin
-000034e0: 675b 4861 7368 6162 6c65 2c20 2244 6174  g[Hashable, "Dat
-000034f0: 6141 7272 6179 225d 2c0a 293a 0a20 2020  aArray"],.):.   
-00003500: 2022 2222 4120 6d75 6c74 692d 6469 6d65   """A multi-dime
-00003510: 6e73 696f 6e61 6c2c 2069 6e20 6d65 6d6f  nsional, in memo
-00003520: 7279 2c20 6172 7261 7920 6461 7461 6261  ry, array databa
-00003530: 7365 2e0a 0a20 2020 2041 2064 6174 6173  se...    A datas
-00003540: 6574 2072 6573 656d 626c 6573 2061 6e20  et resembles an 
-00003550: 696e 2d6d 656d 6f72 7920 7265 7072 6573  in-memory repres
-00003560: 656e 7461 7469 6f6e 206f 6620 6120 4e65  entation of a Ne
-00003570: 7443 4446 2066 696c 652c 0a20 2020 2061  tCDF file,.    a
-00003580: 6e64 2063 6f6e 7369 7374 7320 6f66 2076  nd consists of v
-00003590: 6172 6961 626c 6573 2c20 636f 6f72 6469  ariables, coordi
-000035a0: 6e61 7465 7320 616e 6420 6174 7472 6962  nates and attrib
-000035b0: 7574 6573 2077 6869 6368 0a20 2020 2074  utes which.    t
-000035c0: 6f67 6574 6865 7220 666f 726d 2061 2073  ogether form a s
-000035d0: 656c 6620 6465 7363 7269 6269 6e67 2064  elf describing d
-000035e0: 6174 6173 6574 2e0a 0a20 2020 2044 6174  ataset...    Dat
-000035f0: 6173 6574 2069 6d70 6c65 6d65 6e74 7320  aset implements 
-00003600: 7468 6520 6d61 7070 696e 6720 696e 7465  the mapping inte
-00003610: 7266 6163 6520 7769 7468 206b 6579 7320  rface with keys 
-00003620: 6769 7665 6e20 6279 2076 6172 6961 626c  given by variabl
-00003630: 650a 2020 2020 6e61 6d65 7320 616e 6420  e.    names and 
-00003640: 7661 6c75 6573 2067 6976 656e 2062 7920  values given by 
-00003650: 4461 7461 4172 7261 7920 6f62 6a65 6374  DataArray object
-00003660: 7320 666f 7220 6561 6368 2076 6172 6961  s for each varia
-00003670: 626c 6520 6e61 6d65 2e0a 0a20 2020 204f  ble name...    O
-00003680: 6e65 2064 696d 656e 7369 6f6e 616c 2076  ne dimensional v
-00003690: 6172 6961 626c 6573 2077 6974 6820 6e61  ariables with na
-000036a0: 6d65 2065 7175 616c 2074 6f20 7468 6569  me equal to thei
-000036b0: 7220 6469 6d65 6e73 696f 6e20 6172 650a  r dimension are.
-000036c0: 2020 2020 696e 6465 7820 636f 6f72 6469      index coordi
-000036d0: 6e61 7465 7320 7573 6564 2066 6f72 206c  nates used for l
-000036e0: 6162 656c 2062 6173 6564 2069 6e64 6578  abel based index
-000036f0: 696e 672e 0a0a 2020 2020 546f 206c 6f61  ing...    To loa
-00003700: 6420 6461 7461 2066 726f 6d20 6120 6669  d data from a fi
-00003710: 6c65 206f 7220 6669 6c65 2d6c 696b 6520  le or file-like 
-00003720: 6f62 6a65 6374 2c20 7573 6520 7468 6520  object, use the 
-00003730: 606f 7065 6e5f 6461 7461 7365 7460 0a20  `open_dataset`. 
-00003740: 2020 2066 756e 6374 696f 6e2e 0a0a 2020     function...  
-00003750: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00003760: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00003770: 6461 7461 5f76 6172 7320 3a20 6469 6374  data_vars : dict
-00003780: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
-00003790: 2020 2020 2020 2020 4120 6d61 7070 696e          A mappin
-000037a0: 6720 6672 6f6d 2076 6172 6961 626c 6520  g from variable 
-000037b0: 6e61 6d65 7320 746f 203a 7079 3a63 6c61  names to :py:cla
-000037c0: 7373 3a60 7e78 6172 7261 792e 4461 7461  ss:`~xarray.Data
-000037d0: 4172 7261 7960 0a20 2020 2020 2020 206f  Array`.        o
-000037e0: 626a 6563 7473 2c20 3a70 793a 636c 6173  bjects, :py:clas
-000037f0: 733a 607e 7861 7272 6179 2e56 6172 6961  s:`~xarray.Varia
-00003800: 626c 6560 206f 626a 6563 7473 206f 7220  ble` objects or 
-00003810: 746f 2074 7570 6c65 7320 6f66 0a20 2020  to tuples of.   
-00003820: 2020 2020 2074 6865 2066 6f72 6d20 6060       the form ``
-00003830: 2864 696d 732c 2064 6174 615b 2c20 6174  (dims, data[, at
-00003840: 7472 735d 2960 6020 7768 6963 6820 6361  trs])`` which ca
-00003850: 6e20 6265 2075 7365 6420 6173 0a20 2020  n be used as.   
-00003860: 2020 2020 2061 7267 756d 656e 7473 2074       arguments t
-00003870: 6f20 6372 6561 7465 2061 206e 6577 2060  o create a new `
-00003880: 6056 6172 6961 626c 6560 602e 2045 6163  `Variable``. Eac
-00003890: 6820 6469 6d65 6e73 696f 6e20 6d75 7374  h dimension must
-000038a0: 0a20 2020 2020 2020 2068 6176 6520 7468  .        have th
-000038b0: 6520 7361 6d65 206c 656e 6774 6820 696e  e same length in
-000038c0: 2061 6c6c 2076 6172 6961 626c 6573 2069   all variables i
-000038d0: 6e20 7768 6963 6820 6974 2061 7070 6561  n which it appea
-000038e0: 7273 2e0a 0a20 2020 2020 2020 2054 6865  rs...        The
-000038f0: 2066 6f6c 6c6f 7769 6e67 206e 6f74 6174   following notat
-00003900: 696f 6e73 2061 7265 2061 6363 6570 7465  ions are accepte
-00003910: 643a 0a0a 2020 2020 2020 2020 2d20 6d61  d:..        - ma
-00003920: 7070 696e 6720 7b76 6172 206e 616d 653a  pping {var name:
-00003930: 2044 6174 6141 7272 6179 7d0a 2020 2020   DataArray}.    
-00003940: 2020 2020 2d20 6d61 7070 696e 6720 7b76      - mapping {v
-00003950: 6172 206e 616d 653a 2056 6172 6961 626c  ar name: Variabl
-00003960: 657d 0a20 2020 2020 2020 202d 206d 6170  e}.        - map
-00003970: 7069 6e67 207b 7661 7220 6e61 6d65 3a20  ping {var name: 
-00003980: 2864 696d 656e 7369 6f6e 206e 616d 652c  (dimension name,
-00003990: 2061 7272 6179 2d6c 696b 6529 7d0a 2020   array-like)}.  
-000039a0: 2020 2020 2020 2d20 6d61 7070 696e 6720        - mapping 
-000039b0: 7b76 6172 206e 616d 653a 2028 7475 706c  {var name: (tupl
-000039c0: 6520 6f66 2064 696d 656e 7369 6f6e 206e  e of dimension n
-000039d0: 616d 6573 2c20 6172 7261 792d 6c69 6b65  ames, array-like
-000039e0: 297d 0a20 2020 2020 2020 202d 206d 6170  )}.        - map
-000039f0: 7069 6e67 207b 6469 6d65 6e73 696f 6e20  ping {dimension 
-00003a00: 6e61 6d65 3a20 6172 7261 792d 6c69 6b65  name: array-like
-00003a10: 7d0a 2020 2020 2020 2020 2020 2869 7420  }.          (it 
-00003a20: 7769 6c6c 2062 6520 6175 746f 6d61 7469  will be automati
-00003a30: 6361 6c6c 7920 6d6f 7665 6420 746f 2063  cally moved to c
-00003a40: 6f6f 7264 732c 2073 6565 2062 656c 6f77  oords, see below
-00003a50: 290a 0a20 2020 2020 2020 2045 6163 6820  )..        Each 
-00003a60: 6469 6d65 6e73 696f 6e20 6d75 7374 2068  dimension must h
-00003a70: 6176 6520 7468 6520 7361 6d65 206c 656e  ave the same len
-00003a80: 6774 6820 696e 2061 6c6c 2076 6172 6961  gth in all varia
-00003a90: 626c 6573 2069 6e0a 2020 2020 2020 2020  bles in.        
-00003aa0: 7768 6963 6820 6974 2061 7070 6561 7273  which it appears
-00003ab0: 2e0a 2020 2020 636f 6f72 6473 203a 2064  ..    coords : d
-00003ac0: 6963 742d 6c69 6b65 2c20 6f70 7469 6f6e  ict-like, option
-00003ad0: 616c 0a20 2020 2020 2020 2041 6e6f 7468  al.        Anoth
-00003ae0: 6572 206d 6170 7069 6e67 2069 6e20 7369  er mapping in si
-00003af0: 6d69 6c61 7220 666f 726d 2061 7320 7468  milar form as th
-00003b00: 6520 6064 6174 615f 7661 7273 6020 6172  e `data_vars` ar
-00003b10: 6775 6d65 6e74 2c0a 2020 2020 2020 2020  gument,.        
-00003b20: 6578 6365 7074 2074 6865 2065 6163 6820  except the each 
-00003b30: 6974 656d 2069 7320 7361 7665 6420 6f6e  item is saved on
-00003b40: 2074 6865 2064 6174 6173 6574 2061 7320   the dataset as 
-00003b50: 6120 2263 6f6f 7264 696e 6174 6522 2e0a  a "coordinate"..
-00003b60: 2020 2020 2020 2020 5468 6573 6520 7661          These va
-00003b70: 7269 6162 6c65 7320 6861 7665 2061 6e20  riables have an 
-00003b80: 6173 736f 6369 6174 6564 206d 6561 6e69  associated meani
-00003b90: 6e67 3a20 7468 6579 2064 6573 6372 6962  ng: they describ
-00003ba0: 650a 2020 2020 2020 2020 636f 6e73 7461  e.        consta
-00003bb0: 6e74 2f66 6978 6564 2f69 6e64 6570 656e  nt/fixed/indepen
-00003bc0: 6465 6e74 2071 7561 6e74 6974 6965 732c  dent quantities,
-00003bd0: 2075 6e6c 696b 6520 7468 650a 2020 2020   unlike the.    
-00003be0: 2020 2020 7661 7279 696e 672f 6d65 6173      varying/meas
-00003bf0: 7572 6564 2f64 6570 656e 6465 6e74 2071  ured/dependent q
-00003c00: 7561 6e74 6974 6965 7320 7468 6174 2062  uantities that b
-00003c10: 656c 6f6e 6720 696e 0a20 2020 2020 2020  elong in.       
-00003c20: 2060 7661 7269 6162 6c65 7360 2e20 436f   `variables`. Co
-00003c30: 6f72 6469 6e61 7465 7320 7661 6c75 6573  ordinates values
-00003c40: 206d 6179 2062 6520 6769 7665 6e20 6279   may be given by
-00003c50: 2031 2d64 696d 656e 7369 6f6e 616c 0a20   1-dimensional. 
-00003c60: 2020 2020 2020 2061 7272 6179 7320 6f72         arrays or
-00003c70: 2073 6361 6c61 7273 2c20 696e 2077 6869   scalars, in whi
-00003c80: 6368 2063 6173 6520 6064 696d 7360 2064  ch case `dims` d
-00003c90: 6f20 6e6f 7420 6e65 6564 2074 6f20 6265  o not need to be
-00003ca0: 0a20 2020 2020 2020 2073 7570 706c 6965  .        supplie
-00003cb0: 643a 2031 4420 6172 7261 7973 2077 696c  d: 1D arrays wil
-00003cc0: 6c20 6265 2061 7373 756d 6564 2074 6f20  l be assumed to 
-00003cd0: 6769 7665 2069 6e64 6578 2076 616c 7565  give index value
-00003ce0: 7320 616c 6f6e 670a 2020 2020 2020 2020  s along.        
-00003cf0: 7468 6520 6469 6d65 6e73 696f 6e20 7769  the dimension wi
-00003d00: 7468 2074 6865 2073 616d 6520 6e61 6d65  th the same name
-00003d10: 2e0a 0a20 2020 2020 2020 2054 6865 2066  ...        The f
-00003d20: 6f6c 6c6f 7769 6e67 206e 6f74 6174 696f  ollowing notatio
-00003d30: 6e73 2061 7265 2061 6363 6570 7465 643a  ns are accepted:
-00003d40: 0a0a 2020 2020 2020 2020 2d20 6d61 7070  ..        - mapp
-00003d50: 696e 6720 7b63 6f6f 7264 206e 616d 653a  ing {coord name:
-00003d60: 2044 6174 6141 7272 6179 7d0a 2020 2020   DataArray}.    
-00003d70: 2020 2020 2d20 6d61 7070 696e 6720 7b63      - mapping {c
-00003d80: 6f6f 7264 206e 616d 653a 2056 6172 6961  oord name: Varia
-00003d90: 626c 657d 0a20 2020 2020 2020 202d 206d  ble}.        - m
-00003da0: 6170 7069 6e67 207b 636f 6f72 6420 6e61  apping {coord na
-00003db0: 6d65 3a20 2864 696d 656e 7369 6f6e 206e  me: (dimension n
-00003dc0: 616d 652c 2061 7272 6179 2d6c 696b 6529  ame, array-like)
-00003dd0: 7d0a 2020 2020 2020 2020 2d20 6d61 7070  }.        - mapp
-00003de0: 696e 6720 7b63 6f6f 7264 206e 616d 653a  ing {coord name:
-00003df0: 2028 7475 706c 6520 6f66 2064 696d 656e   (tuple of dimen
-00003e00: 7369 6f6e 206e 616d 6573 2c20 6172 7261  sion names, arra
-00003e10: 792d 6c69 6b65 297d 0a20 2020 2020 2020  y-like)}.       
-00003e20: 202d 206d 6170 7069 6e67 207b 6469 6d65   - mapping {dime
-00003e30: 6e73 696f 6e20 6e61 6d65 3a20 6172 7261  nsion name: arra
-00003e40: 792d 6c69 6b65 7d0a 2020 2020 2020 2020  y-like}.        
-00003e50: 2020 2874 6865 2064 696d 656e 7369 6f6e    (the dimension
-00003e60: 206e 616d 6520 6973 2069 6d70 6c69 6369   name is implici
-00003e70: 746c 7920 7365 7420 746f 2062 6520 7468  tly set to be th
-00003e80: 6520 7361 6d65 2061 7320 7468 650a 2020  e same as the.  
-00003e90: 2020 2020 2020 2020 636f 6f72 6420 6e61          coord na
-00003ea0: 6d65 290a 0a20 2020 2020 2020 2054 6865  me)..        The
-00003eb0: 206c 6173 7420 6e6f 7461 7469 6f6e 2069   last notation i
-00003ec0: 6d70 6c69 6573 2074 6861 7420 7468 6520  mplies that the 
-00003ed0: 636f 6f72 6420 6e61 6d65 2069 7320 7468  coord name is th
-00003ee0: 6520 7361 6d65 2061 730a 2020 2020 2020  e same as.      
-00003ef0: 2020 7468 6520 6469 6d65 6e73 696f 6e20    the dimension 
-00003f00: 6e61 6d65 2e0a 0a20 2020 2061 7474 7273  name...    attrs
-00003f10: 203a 2064 6963 742d 6c69 6b65 2c20 6f70   : dict-like, op
-00003f20: 7469 6f6e 616c 0a20 2020 2020 2020 2047  tional.        G
-00003f30: 6c6f 6261 6c20 6174 7472 6962 7574 6573  lobal attributes
-00003f40: 2074 6f20 7361 7665 206f 6e20 7468 6973   to save on this
-00003f50: 2064 6174 6173 6574 2e0a 0a20 2020 2045   dataset...    E
-00003f60: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
-00003f70: 2d2d 2d2d 0a20 2020 2043 7265 6174 6520  ----.    Create 
-00003f80: 6461 7461 3a0a 0a20 2020 203e 3e3e 206e  data:..    >>> n
-00003f90: 702e 7261 6e64 6f6d 2e73 6565 6428 3029  p.random.seed(0)
-00003fa0: 0a20 2020 203e 3e3e 2074 656d 7065 7261  .    >>> tempera
-00003fb0: 7475 7265 203d 2031 3520 2b20 3820 2a20  ture = 15 + 8 * 
-00003fc0: 6e70 2e72 616e 646f 6d2e 7261 6e64 6e28  np.random.randn(
-00003fd0: 322c 2032 2c20 3329 0a20 2020 203e 3e3e  2, 2, 3).    >>>
-00003fe0: 2070 7265 6369 7069 7461 7469 6f6e 203d   precipitation =
-00003ff0: 2031 3020 2a20 6e70 2e72 616e 646f 6d2e   10 * np.random.
-00004000: 7261 6e64 2832 2c20 322c 2033 290a 2020  rand(2, 2, 3).  
-00004010: 2020 3e3e 3e20 6c6f 6e20 3d20 5b5b 2d39    >>> lon = [[-9
-00004020: 392e 3833 2c20 2d39 392e 3332 5d2c 205b  9.83, -99.32], [
-00004030: 2d39 392e 3739 2c20 2d39 392e 3233 5d5d  -99.79, -99.23]]
-00004040: 0a20 2020 203e 3e3e 206c 6174 203d 205b  .    >>> lat = [
-00004050: 5b34 322e 3235 2c20 3432 2e32 315d 2c20  [42.25, 42.21], 
-00004060: 5b34 322e 3633 2c20 3432 2e35 395d 5d0a  [42.63, 42.59]].
-00004070: 2020 2020 3e3e 3e20 7469 6d65 203d 2070      >>> time = p
-00004080: 642e 6461 7465 5f72 616e 6765 2822 3230  d.date_range("20
-00004090: 3134 2d30 392d 3036 222c 2070 6572 696f  14-09-06", perio
-000040a0: 6473 3d33 290a 2020 2020 3e3e 3e20 7265  ds=3).    >>> re
-000040b0: 6665 7265 6e63 655f 7469 6d65 203d 2070  ference_time = p
-000040c0: 642e 5469 6d65 7374 616d 7028 2232 3031  d.Timestamp("201
-000040d0: 342d 3039 2d30 3522 290a 0a20 2020 2049  4-09-05")..    I
-000040e0: 6e69 7469 616c 697a 6520 6120 6461 7461  nitialize a data
-000040f0: 7365 7420 7769 7468 206d 756c 7469 706c  set with multipl
-00004100: 6520 6469 6d65 6e73 696f 6e73 3a0a 0a20  e dimensions:.. 
-00004110: 2020 203e 3e3e 2064 7320 3d20 7872 2e44     >>> ds = xr.D
-00004120: 6174 6173 6574 280a 2020 2020 2e2e 2e20  ataset(.    ... 
-00004130: 2020 2020 6461 7461 5f76 6172 733d 6469      data_vars=di
-00004140: 6374 280a 2020 2020 2e2e 2e20 2020 2020  ct(.    ...     
-00004150: 2020 2020 7465 6d70 6572 6174 7572 653d      temperature=
-00004160: 285b 2278 222c 2022 7922 2c20 2274 696d  (["x", "y", "tim
-00004170: 6522 5d2c 2074 656d 7065 7261 7475 7265  e"], temperature
-00004180: 292c 0a20 2020 202e 2e2e 2020 2020 2020  ),.    ...      
-00004190: 2020 2070 7265 6369 7069 7461 7469 6f6e     precipitation
-000041a0: 3d28 5b22 7822 2c20 2279 222c 2022 7469  =(["x", "y", "ti
-000041b0: 6d65 225d 2c20 7072 6563 6970 6974 6174  me"], precipitat
-000041c0: 696f 6e29 2c0a 2020 2020 2e2e 2e20 2020  ion),.    ...   
-000041d0: 2020 292c 0a20 2020 202e 2e2e 2020 2020    ),.    ...    
-000041e0: 2063 6f6f 7264 733d 6469 6374 280a 2020   coords=dict(.  
-000041f0: 2020 2e2e 2e20 2020 2020 2020 2020 6c6f    ...         lo
-00004200: 6e3d 285b 2278 222c 2022 7922 5d2c 206c  n=(["x", "y"], l
-00004210: 6f6e 292c 0a20 2020 202e 2e2e 2020 2020  on),.    ...    
-00004220: 2020 2020 206c 6174 3d28 5b22 7822 2c20       lat=(["x", 
-00004230: 2279 225d 2c20 6c61 7429 2c0a 2020 2020  "y"], lat),.    
-00004240: 2e2e 2e20 2020 2020 2020 2020 7469 6d65  ...         time
-00004250: 3d74 696d 652c 0a20 2020 202e 2e2e 2020  =time,.    ...  
-00004260: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00004270: 5f74 696d 653d 7265 6665 7265 6e63 655f  _time=reference_
-00004280: 7469 6d65 2c0a 2020 2020 2e2e 2e20 2020  time,.    ...   
-00004290: 2020 292c 0a20 2020 202e 2e2e 2020 2020    ),.    ...    
-000042a0: 2061 7474 7273 3d64 6963 7428 6465 7363   attrs=dict(desc
-000042b0: 7269 7074 696f 6e3d 2257 6561 7468 6572  ription="Weather
-000042c0: 2072 656c 6174 6564 2064 6174 612e 2229   related data.")
-000042d0: 2c0a 2020 2020 2e2e 2e20 290a 2020 2020  ,.    ... ).    
-000042e0: 3e3e 3e20 6473 0a20 2020 203c 7861 7272  >>> ds.    <xarr
-000042f0: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
-00004300: 4469 6d65 6e73 696f 6e73 3a20 2020 2020  Dimensions:     
-00004310: 2020 2020 2878 3a20 322c 2079 3a20 322c      (x: 2, y: 2,
-00004320: 2074 696d 653a 2033 290a 2020 2020 436f   time: 3).    Co
-00004330: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-00004340: 2020 206c 6f6e 2020 2020 2020 2020 2020     lon          
-00004350: 2020 2028 782c 2079 2920 666c 6f61 7436     (x, y) float6
-00004360: 3420 2d39 392e 3833 202d 3939 2e33 3220  4 -99.83 -99.32 
-00004370: 2d39 392e 3739 202d 3939 2e32 330a 2020  -99.79 -99.23.  
-00004380: 2020 2020 2020 6c61 7420 2020 2020 2020        lat       
-00004390: 2020 2020 2020 2878 2c20 7929 2066 6c6f        (x, y) flo
-000043a0: 6174 3634 2034 322e 3235 2034 322e 3231  at64 42.25 42.21
-000043b0: 2034 322e 3633 2034 322e 3539 0a20 2020   42.63 42.59.   
-000043c0: 2020 202a 2074 696d 6520 2020 2020 2020     * time       
-000043d0: 2020 2020 2028 7469 6d65 2920 6461 7465       (time) date
-000043e0: 7469 6d65 3634 5b6e 735d 2032 3031 342d  time64[ns] 2014-
-000043f0: 3039 2d30 3620 3230 3134 2d30 392d 3037  09-06 2014-09-07
-00004400: 2032 3031 342d 3039 2d30 380a 2020 2020   2014-09-08.    
-00004410: 2020 2020 7265 6665 7265 6e63 655f 7469      reference_ti
-00004420: 6d65 2020 6461 7465 7469 6d65 3634 5b6e  me  datetime64[n
-00004430: 735d 2032 3031 342d 3039 2d30 350a 2020  s] 2014-09-05.  
-00004440: 2020 4469 6d65 6e73 696f 6e73 2077 6974    Dimensions wit
-00004450: 686f 7574 2063 6f6f 7264 696e 6174 6573  hout coordinates
-00004460: 3a20 782c 2079 0a20 2020 2044 6174 6120  : x, y.    Data 
-00004470: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-00004480: 2020 2074 656d 7065 7261 7475 7265 2020     temperature  
-00004490: 2020 2028 782c 2079 2c20 7469 6d65 2920     (x, y, time) 
-000044a0: 666c 6f61 7436 3420 3239 2e31 3120 3138  float64 29.11 18
-000044b0: 2e32 2032 322e 3833 202e 2e2e 2031 382e  .2 22.83 ... 18.
-000044c0: 3238 2031 362e 3135 2032 362e 3633 0a20  28 16.15 26.63. 
-000044d0: 2020 2020 2020 2070 7265 6369 7069 7461         precipita
-000044e0: 7469 6f6e 2020 2028 782c 2079 2c20 7469  tion   (x, y, ti
-000044f0: 6d65 2920 666c 6f61 7436 3420 352e 3638  me) float64 5.68
-00004500: 2039 2e32 3536 2030 2e37 3130 3420 2e2e   9.256 0.7104 ..
-00004510: 2e20 372e 3939 3220 342e 3631 3520 372e  . 7.992 4.615 7.
-00004520: 3830 350a 2020 2020 4174 7472 6962 7574  805.    Attribut
-00004530: 6573 3a0a 2020 2020 2020 2020 6465 7363  es:.        desc
-00004540: 7269 7074 696f 6e3a 2020 5765 6174 6865  ription:  Weathe
-00004550: 7220 7265 6c61 7465 6420 6461 7461 2e0a  r related data..
-00004560: 0a20 2020 2046 696e 6420 6f75 7420 7768  .    Find out wh
-00004570: 6572 6520 7468 6520 636f 6c64 6573 7420  ere the coldest 
-00004580: 7465 6d70 6572 6174 7572 6520 7761 7320  temperature was 
-00004590: 616e 6420 7768 6174 2076 616c 7565 7320  and what values 
-000045a0: 7468 650a 2020 2020 6f74 6865 7220 7661  the.    other va
-000045b0: 7269 6162 6c65 7320 6861 643a 0a0a 2020  riables had:..  
-000045c0: 2020 3e3e 3e20 6473 2e69 7365 6c28 6473    >>> ds.isel(ds
-000045d0: 2e74 656d 7065 7261 7475 7265 2e61 7267  .temperature.arg
-000045e0: 6d69 6e28 2e2e 2e29 290a 2020 2020 3c78  min(...)).    <x
-000045f0: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-00004600: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-00004610: 2020 2020 2020 2028 290a 2020 2020 436f         ().    Co
-00004620: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-00004630: 2020 206c 6f6e 2020 2020 2020 2020 2020     lon          
-00004640: 2020 2066 6c6f 6174 3634 202d 3939 2e33     float64 -99.3
-00004650: 320a 2020 2020 2020 2020 6c61 7420 2020  2.        lat   
-00004660: 2020 2020 2020 2020 2020 666c 6f61 7436            float6
-00004670: 3420 3432 2e32 310a 2020 2020 2020 2020  4 42.21.        
-00004680: 7469 6d65 2020 2020 2020 2020 2020 2020  time            
-00004690: 6461 7465 7469 6d65 3634 5b6e 735d 2032  datetime64[ns] 2
-000046a0: 3031 342d 3039 2d30 380a 2020 2020 2020  014-09-08.      
-000046b0: 2020 7265 6665 7265 6e63 655f 7469 6d65    reference_time
-000046c0: 2020 6461 7465 7469 6d65 3634 5b6e 735d    datetime64[ns]
-000046d0: 2032 3031 342d 3039 2d30 350a 2020 2020   2014-09-05.    
-000046e0: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-000046f0: 2020 2020 2020 2020 7465 6d70 6572 6174          temperat
-00004700: 7572 6520 2020 2020 666c 6f61 7436 3420  ure     float64 
-00004710: 372e 3138 320a 2020 2020 2020 2020 7072  7.182.        pr
-00004720: 6563 6970 6974 6174 696f 6e20 2020 666c  ecipitation   fl
-00004730: 6f61 7436 3420 382e 3332 360a 2020 2020  oat64 8.326.    
-00004740: 4174 7472 6962 7574 6573 3a0a 2020 2020  Attributes:.    
-00004750: 2020 2020 6465 7363 7269 7074 696f 6e3a      description:
-00004760: 2020 5765 6174 6865 7220 7265 6c61 7465    Weather relate
-00004770: 6420 6461 7461 2e0a 2020 2020 2222 220a  d data..    """.
-00004780: 0a20 2020 205f 6174 7472 733a 2064 6963  .    _attrs: dic
-00004790: 745b 4861 7368 6162 6c65 2c20 416e 795d  t[Hashable, Any]
-000047a0: 207c 204e 6f6e 650a 2020 2020 5f63 6163   | None.    _cac
-000047b0: 6865 3a20 6469 6374 5b73 7472 2c20 416e  he: dict[str, An
-000047c0: 795d 0a20 2020 205f 636f 6f72 645f 6e61  y].    _coord_na
-000047d0: 6d65 733a 2073 6574 5b48 6173 6861 626c  mes: set[Hashabl
-000047e0: 655d 0a20 2020 205f 6469 6d73 3a20 6469  e].    _dims: di
-000047f0: 6374 5b48 6173 6861 626c 652c 2069 6e74  ct[Hashable, int
-00004800: 5d0a 2020 2020 5f65 6e63 6f64 696e 673a  ].    _encoding:
-00004810: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00004820: 416e 795d 207c 204e 6f6e 650a 2020 2020  Any] | None.    
-00004830: 5f63 6c6f 7365 3a20 4361 6c6c 6162 6c65  _close: Callable
-00004840: 5b5b 5d2c 204e 6f6e 655d 207c 204e 6f6e  [[], None] | Non
-00004850: 650a 2020 2020 5f69 6e64 6578 6573 3a20  e.    _indexes: 
-00004860: 6469 6374 5b48 6173 6861 626c 652c 2049  dict[Hashable, I
-00004870: 6e64 6578 5d0a 2020 2020 5f76 6172 6961  ndex].    _varia
-00004880: 626c 6573 3a20 6469 6374 5b48 6173 6861  bles: dict[Hasha
-00004890: 626c 652c 2056 6172 6961 626c 655d 0a0a  ble, Variable]..
-000048a0: 2020 2020 5f5f 736c 6f74 735f 5f20 3d20      __slots__ = 
-000048b0: 280a 2020 2020 2020 2020 225f 6174 7472  (.        "_attr
-000048c0: 7322 2c0a 2020 2020 2020 2020 225f 6361  s",.        "_ca
-000048d0: 6368 6522 2c0a 2020 2020 2020 2020 225f  che",.        "_
-000048e0: 636f 6f72 645f 6e61 6d65 7322 2c0a 2020  coord_names",.  
-000048f0: 2020 2020 2020 225f 6469 6d73 222c 0a20        "_dims",. 
-00004900: 2020 2020 2020 2022 5f65 6e63 6f64 696e         "_encodin
-00004910: 6722 2c0a 2020 2020 2020 2020 225f 636c  g",.        "_cl
-00004920: 6f73 6522 2c0a 2020 2020 2020 2020 225f  ose",.        "_
-00004930: 696e 6465 7865 7322 2c0a 2020 2020 2020  indexes",.      
-00004940: 2020 225f 7661 7269 6162 6c65 7322 2c0a    "_variables",.
-00004950: 2020 2020 2020 2020 225f 5f77 6561 6b72          "__weakr
-00004960: 6566 5f5f 222c 0a20 2020 2029 0a0a 2020  ef__",.    )..  
-00004970: 2020 6465 6620 5f5f 696e 6974 5f5f 280a    def __init__(.
-00004980: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00004990: 2020 2020 2020 2320 636f 756c 6420 6d61        # could ma
-000049a0: 6b65 2061 2056 6172 6961 626c 6541 7267  ke a VariableArg
-000049b0: 7320 746f 2075 7365 206d 6f72 6520 6765  s to use more ge
-000049c0: 6e65 7261 6c6c 792c 2061 6e64 2072 6566  nerally, and ref
-000049d0: 696e 6520 7468 6573 650a 2020 2020 2020  ine these.      
-000049e0: 2020 2320 6361 7465 676f 7269 6573 0a20    # categories. 
-000049f0: 2020 2020 2020 2064 6174 615f 7661 7273         data_vars
-00004a00: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
-00004a10: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
-00004a20: 652c 0a20 2020 2020 2020 2063 6f6f 7264  e,.        coord
-00004a30: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
-00004a40: 416e 795d 207c 204e 6f6e 6520 3d20 4e6f  Any] | None = No
-00004a50: 6e65 2c0a 2020 2020 2020 2020 6174 7472  ne,.        attr
-00004a60: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
-00004a70: 416e 795d 207c 204e 6f6e 6520 3d20 4e6f  Any] | None = No
-00004a80: 6e65 2c0a 2020 2020 2920 2d3e 204e 6f6e  ne,.    ) -> Non
-00004a90: 653a 0a20 2020 2020 2020 2023 2054 4f44  e:.        # TOD
-00004aa0: 4f28 7368 6f79 6572 293a 2065 7870 6f73  O(shoyer): expos
-00004ab0: 6520 696e 6465 7865 7320 6173 2061 2070  e indexes as a p
-00004ac0: 7562 6c69 6320 6172 6775 6d65 6e74 2069  ublic argument i
-00004ad0: 6e20 5f5f 696e 6974 5f5f 0a0a 2020 2020  n __init__..    
-00004ae0: 2020 2020 6966 2064 6174 615f 7661 7273      if data_vars
-00004af0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00004b00: 2020 2020 2020 6461 7461 5f76 6172 7320        data_vars 
-00004b10: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
-00004b20: 636f 6f72 6473 2069 7320 4e6f 6e65 3a0a  coords is None:.
-00004b30: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
-00004b40: 6473 203d 207b 7d0a 0a20 2020 2020 2020  ds = {}..       
-00004b50: 2062 6f74 685f 6461 7461 5f61 6e64 5f63   both_data_and_c
-00004b60: 6f6f 7264 7320 3d20 7365 7428 6461 7461  oords = set(data
-00004b70: 5f76 6172 7329 2026 2073 6574 2863 6f6f  _vars) & set(coo
-00004b80: 7264 7329 0a20 2020 2020 2020 2069 6620  rds).        if 
-00004b90: 626f 7468 5f64 6174 615f 616e 645f 636f  both_data_and_co
-00004ba0: 6f72 6473 3a0a 2020 2020 2020 2020 2020  ords:.          
-00004bb0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00004bc0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00004bd0: 2020 2020 6622 7661 7269 6162 6c65 7320      f"variables 
-00004be0: 7b62 6f74 685f 6461 7461 5f61 6e64 5f63  {both_data_and_c
-00004bf0: 6f6f 7264 7321 727d 2061 7265 2066 6f75  oords!r} are fou
-00004c00: 6e64 2069 6e20 626f 7468 2064 6174 615f  nd in both data_
-00004c10: 7661 7273 2061 6e64 2063 6f6f 7264 7322  vars and coords"
-00004c20: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00004c30: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00004c40: 7461 6e63 6528 636f 6f72 6473 2c20 4461  tance(coords, Da
-00004c50: 7461 7365 7429 3a0a 2020 2020 2020 2020  taset):.        
-00004c60: 2020 2020 636f 6f72 6473 203d 2063 6f6f      coords = coo
-00004c70: 7264 732e 7661 7269 6162 6c65 730a 0a20  rds.variables.. 
-00004c80: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-00004c90: 2c20 636f 6f72 645f 6e61 6d65 732c 2064  , coord_names, d
-00004ca0: 696d 732c 2069 6e64 6578 6573 2c20 5f20  ims, indexes, _ 
-00004cb0: 3d20 6d65 7267 655f 6461 7461 5f61 6e64  = merge_data_and
-00004cc0: 5f63 6f6f 7264 7328 0a20 2020 2020 2020  _coords(.       
-00004cd0: 2020 2020 2064 6174 615f 7661 7273 2c20       data_vars, 
-00004ce0: 636f 6f72 6473 2c20 636f 6d70 6174 3d22  coords, compat="
-00004cf0: 6272 6f61 6463 6173 745f 6571 7561 6c73  broadcast_equals
-00004d00: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
-00004d10: 2020 2020 2073 656c 662e 5f61 7474 7273       self._attrs
-00004d20: 203d 2064 6963 7428 6174 7472 7329 2069   = dict(attrs) i
-00004d30: 6620 6174 7472 7320 6973 206e 6f74 204e  f attrs is not N
-00004d40: 6f6e 6520 656c 7365 204e 6f6e 650a 2020  one else None.  
-00004d50: 2020 2020 2020 7365 6c66 2e5f 636c 6f73        self._clos
-00004d60: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
-00004d70: 2073 656c 662e 5f65 6e63 6f64 696e 6720   self._encoding 
-00004d80: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-00004d90: 656c 662e 5f76 6172 6961 626c 6573 203d  elf._variables =
-00004da0: 2076 6172 6961 626c 6573 0a20 2020 2020   variables.     
-00004db0: 2020 2073 656c 662e 5f63 6f6f 7264 5f6e     self._coord_n
-00004dc0: 616d 6573 203d 2063 6f6f 7264 5f6e 616d  ames = coord_nam
-00004dd0: 6573 0a20 2020 2020 2020 2073 656c 662e  es.        self.
-00004de0: 5f64 696d 7320 3d20 6469 6d73 0a20 2020  _dims = dims.   
-00004df0: 2020 2020 2073 656c 662e 5f69 6e64 6578       self._index
-00004e00: 6573 203d 2069 6e64 6578 6573 0a0a 2020  es = indexes..  
-00004e10: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00004e20: 2020 2064 6566 206c 6f61 645f 7374 6f72     def load_stor
-00004e30: 6528 636c 733a 2074 7970 655b 545f 4461  e(cls: type[T_Da
-00004e40: 7461 7365 745d 2c20 7374 6f72 652c 2064  taset], store, d
-00004e50: 6563 6f64 6572 3d4e 6f6e 6529 202d 3e20  ecoder=None) -> 
-00004e60: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
-00004e70: 2020 2022 2222 4372 6561 7465 2061 206e     """Create a n
-00004e80: 6577 2064 6174 6173 6574 2066 726f 6d20  ew dataset from 
-00004e90: 7468 6520 636f 6e74 656e 7473 206f 6620  the contents of 
-00004ea0: 6120 6261 636b 656e 6473 2e2a 4461 7461  a backends.*Data
-00004eb0: 5374 6f72 650a 2020 2020 2020 2020 6f62  Store.        ob
-00004ec0: 6a65 6374 0a20 2020 2020 2020 2022 2222  ject.        """
-00004ed0: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-00004ee0: 6573 2c20 6174 7472 6962 7574 6573 203d  es, attributes =
-00004ef0: 2073 746f 7265 2e6c 6f61 6428 290a 2020   store.load().  
-00004f00: 2020 2020 2020 6966 2064 6563 6f64 6572        if decoder
-00004f10: 3a0a 2020 2020 2020 2020 2020 2020 7661  :.            va
-00004f20: 7269 6162 6c65 732c 2061 7474 7269 6275  riables, attribu
-00004f30: 7465 7320 3d20 6465 636f 6465 7228 7661  tes = decoder(va
-00004f40: 7269 6162 6c65 732c 2061 7474 7269 6275  riables, attribu
-00004f50: 7465 7329 0a20 2020 2020 2020 206f 626a  tes).        obj
-00004f60: 203d 2063 6c73 2876 6172 6961 626c 6573   = cls(variables
-00004f70: 2c20 6174 7472 733d 6174 7472 6962 7574  , attrs=attribut
-00004f80: 6573 290a 2020 2020 2020 2020 6f62 6a2e  es).        obj.
-00004f90: 7365 745f 636c 6f73 6528 7374 6f72 652e  set_close(store.
-00004fa0: 636c 6f73 6529 0a20 2020 2020 2020 2072  close).        r
-00004fb0: 6574 7572 6e20 6f62 6a0a 0a20 2020 2040  eturn obj..    @
-00004fc0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00004fd0: 2076 6172 6961 626c 6573 2873 656c 6629   variables(self)
-00004fe0: 202d 3e20 4672 6f7a 656e 5b48 6173 6861   -> Frozen[Hasha
-00004ff0: 626c 652c 2056 6172 6961 626c 655d 3a0a  ble, Variable]:.
-00005000: 2020 2020 2020 2020 2222 224c 6f77 206c          """Low l
-00005010: 6576 656c 2069 6e74 6572 6661 6365 2074  evel interface t
-00005020: 6f20 4461 7461 7365 7420 636f 6e74 656e  o Dataset conten
-00005030: 7473 2061 7320 6469 6374 206f 6620 5661  ts as dict of Va
-00005040: 7269 6162 6c65 206f 626a 6563 7473 2e0a  riable objects..
-00005050: 0a20 2020 2020 2020 2054 6869 7320 6f72  .        This or
-00005060: 6465 7265 6420 6469 6374 696f 6e61 7279  dered dictionary
-00005070: 2069 7320 6672 6f7a 656e 2074 6f20 7072   is frozen to pr
-00005080: 6576 656e 7420 6d75 7461 7469 6f6e 2074  event mutation t
-00005090: 6861 7420 636f 756c 640a 2020 2020 2020  hat could.      
-000050a0: 2020 7669 6f6c 6174 6520 4461 7461 7365    violate Datase
-000050b0: 7420 696e 7661 7269 616e 7473 2e20 4974  t invariants. It
-000050c0: 2063 6f6e 7461 696e 7320 616c 6c20 7661   contains all va
-000050d0: 7269 6162 6c65 206f 626a 6563 7473 0a20  riable objects. 
-000050e0: 2020 2020 2020 2063 6f6e 7374 6974 7574         constitut
-000050f0: 696e 6720 7468 6520 4461 7461 7365 742c  ing the Dataset,
-00005100: 2069 6e63 6c75 6469 6e67 2062 6f74 6820   including both 
-00005110: 6461 7461 2076 6172 6961 626c 6573 2061  data variables a
-00005120: 6e64 0a20 2020 2020 2020 2063 6f6f 7264  nd.        coord
-00005130: 696e 6174 6573 2e0a 2020 2020 2020 2020  inates..        
-00005140: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00005150: 726e 2046 726f 7a65 6e28 7365 6c66 2e5f  rn Frozen(self._
-00005160: 7661 7269 6162 6c65 7329 0a0a 2020 2020  variables)..    
-00005170: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00005180: 6620 6174 7472 7328 7365 6c66 2920 2d3e  f attrs(self) ->
-00005190: 2064 6963 745b 416e 792c 2041 6e79 5d3a   dict[Any, Any]:
-000051a0: 0a20 2020 2020 2020 2022 2222 4469 6374  .        """Dict
-000051b0: 696f 6e61 7279 206f 6620 676c 6f62 616c  ionary of global
-000051c0: 2061 7474 7269 6275 7465 7320 6f6e 2074   attributes on t
-000051d0: 6869 7320 6461 7461 7365 7422 2222 0a20  his dataset""". 
-000051e0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-000051f0: 6174 7472 7320 6973 204e 6f6e 653a 0a20  attrs is None:. 
-00005200: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005210: 5f61 7474 7273 203d 207b 7d0a 2020 2020  _attrs = {}.    
-00005220: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00005230: 5f61 7474 7273 0a0a 2020 2020 4061 7474  _attrs..    @att
-00005240: 7273 2e73 6574 7465 720a 2020 2020 6465  rs.setter.    de
-00005250: 6620 6174 7472 7328 7365 6c66 2c20 7661  f attrs(self, va
-00005260: 6c75 653a 204d 6170 7069 6e67 5b41 6e79  lue: Mapping[Any
-00005270: 2c20 416e 795d 2920 2d3e 204e 6f6e 653a  , Any]) -> None:
-00005280: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
-00005290: 7474 7273 203d 2064 6963 7428 7661 6c75  ttrs = dict(valu
-000052a0: 6529 0a0a 2020 2020 4070 726f 7065 7274  e)..    @propert
-000052b0: 790a 2020 2020 6465 6620 656e 636f 6469  y.    def encodi
-000052c0: 6e67 2873 656c 6629 202d 3e20 6469 6374  ng(self) -> dict
-000052d0: 5b41 6e79 2c20 416e 795d 3a0a 2020 2020  [Any, Any]:.    
-000052e0: 2020 2020 2222 2244 6963 7469 6f6e 6172      """Dictionar
-000052f0: 7920 6f66 2067 6c6f 6261 6c20 656e 636f  y of global enco
-00005300: 6469 6e67 2061 7474 7269 6275 7465 7320  ding attributes 
-00005310: 6f6e 2074 6869 7320 6461 7461 7365 7422  on this dataset"
-00005320: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-00005330: 6c66 2e5f 656e 636f 6469 6e67 2069 7320  lf._encoding is 
-00005340: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00005350: 2020 7365 6c66 2e5f 656e 636f 6469 6e67    self._encoding
-00005360: 203d 207b 7d0a 2020 2020 2020 2020 7265   = {}.        re
-00005370: 7475 726e 2073 656c 662e 5f65 6e63 6f64  turn self._encod
-00005380: 696e 670a 0a20 2020 2040 656e 636f 6469  ing..    @encodi
-00005390: 6e67 2e73 6574 7465 720a 2020 2020 6465  ng.setter.    de
-000053a0: 6620 656e 636f 6469 6e67 2873 656c 662c  f encoding(self,
-000053b0: 2076 616c 7565 3a20 4d61 7070 696e 675b   value: Mapping[
-000053c0: 416e 792c 2041 6e79 5d29 202d 3e20 4e6f  Any, Any]) -> No
-000053d0: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
-000053e0: 2e5f 656e 636f 6469 6e67 203d 2064 6963  ._encoding = dic
-000053f0: 7428 7661 6c75 6529 0a0a 2020 2020 6465  t(value)..    de
-00005400: 6620 7265 7365 745f 656e 636f 6469 6e67  f reset_encoding
-00005410: 2873 656c 663a 2054 5f44 6174 6173 6574  (self: T_Dataset
-00005420: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-00005430: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00005440: 6e20 6120 6e65 7720 4461 7461 7365 7420  n a new Dataset 
-00005450: 7769 7468 6f75 7420 656e 636f 6469 6e67  without encoding
-00005460: 206f 6e20 7468 6520 6461 7461 7365 7420   on the dataset 
-00005470: 6f72 2061 6e79 206f 6620 6974 730a 2020  or any of its.  
-00005480: 2020 2020 2020 7661 7269 6162 6c65 732f        variables/
-00005490: 636f 6f72 6473 2e22 2222 0a20 2020 2020  coords.""".     
-000054a0: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
-000054b0: 6b3a 2076 2e72 6573 6574 5f65 6e63 6f64  k: v.reset_encod
-000054c0: 696e 6728 2920 666f 7220 6b2c 2076 2069  ing() for k, v i
-000054d0: 6e20 7365 6c66 2e76 6172 6961 626c 6573  n self.variables
-000054e0: 2e69 7465 6d73 2829 7d0a 2020 2020 2020  .items()}.      
-000054f0: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-00005500: 6570 6c61 6365 2876 6172 6961 626c 6573  eplace(variables
-00005510: 3d76 6172 6961 626c 6573 2c20 656e 636f  =variables, enco
-00005520: 6469 6e67 3d7b 7d29 0a0a 2020 2020 4070  ding={})..    @p
-00005530: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00005540: 6469 6d73 2873 656c 6629 202d 3e20 4672  dims(self) -> Fr
-00005550: 6f7a 656e 5b48 6173 6861 626c 652c 2069  ozen[Hashable, i
-00005560: 6e74 5d3a 0a20 2020 2020 2020 2022 2222  nt]:.        """
-00005570: 4d61 7070 696e 6720 6672 6f6d 2064 696d  Mapping from dim
-00005580: 656e 7369 6f6e 206e 616d 6573 2074 6f20  ension names to 
-00005590: 6c65 6e67 7468 732e 0a0a 2020 2020 2020  lengths...      
-000055a0: 2020 4361 6e6e 6f74 2062 6520 6d6f 6469    Cannot be modi
-000055b0: 6669 6564 2064 6972 6563 746c 792c 2062  fied directly, b
-000055c0: 7574 2069 7320 7570 6461 7465 6420 7768  ut is updated wh
-000055d0: 656e 2061 6464 696e 6720 6e65 7720 7661  en adding new va
-000055e0: 7269 6162 6c65 732e 0a0a 2020 2020 2020  riables...      
-000055f0: 2020 4e6f 7465 2074 6861 7420 7479 7065    Note that type
-00005600: 206f 6620 7468 6973 206f 626a 6563 7420   of this object 
-00005610: 6469 6666 6572 7320 6672 6f6d 2060 4461  differs from `Da
-00005620: 7461 4172 7261 792e 6469 6d73 602e 0a20  taArray.dims`.. 
-00005630: 2020 2020 2020 2053 6565 2060 4461 7461         See `Data
-00005640: 7365 742e 7369 7a65 7360 2061 6e64 2060  set.sizes` and `
-00005650: 4461 7461 4172 7261 792e 7369 7a65 7360  DataArray.sizes`
-00005660: 2066 6f72 2063 6f6e 7369 7374 656e 746c   for consistentl
-00005670: 7920 6e61 6d65 640a 2020 2020 2020 2020  y named.        
-00005680: 7072 6f70 6572 7469 6573 2e0a 0a20 2020  properties...   
-00005690: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
-000056a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-000056b0: 2020 2020 2020 2044 6174 6173 6574 2e73         Dataset.s
-000056c0: 697a 6573 0a20 2020 2020 2020 2044 6174  izes.        Dat
-000056d0: 6141 7272 6179 2e64 696d 730a 2020 2020  aArray.dims.    
-000056e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000056f0: 7265 7475 726e 2046 726f 7a65 6e28 7365  return Frozen(se
-00005700: 6c66 2e5f 6469 6d73 290a 0a20 2020 2040  lf._dims)..    @
-00005710: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00005720: 2073 697a 6573 2873 656c 6629 202d 3e20   sizes(self) -> 
-00005730: 4672 6f7a 656e 5b48 6173 6861 626c 652c  Frozen[Hashable,
-00005740: 2069 6e74 5d3a 0a20 2020 2020 2020 2022   int]:.        "
-00005750: 2222 4d61 7070 696e 6720 6672 6f6d 2064  ""Mapping from d
-00005760: 696d 656e 7369 6f6e 206e 616d 6573 2074  imension names t
-00005770: 6f20 6c65 6e67 7468 732e 0a0a 2020 2020  o lengths...    
-00005780: 2020 2020 4361 6e6e 6f74 2062 6520 6d6f      Cannot be mo
-00005790: 6469 6669 6564 2064 6972 6563 746c 792c  dified directly,
-000057a0: 2062 7574 2069 7320 7570 6461 7465 6420   but is updated 
-000057b0: 7768 656e 2061 6464 696e 6720 6e65 7720  when adding new 
-000057c0: 7661 7269 6162 6c65 732e 0a0a 2020 2020  variables...    
-000057d0: 2020 2020 5468 6973 2069 7320 616e 2061      This is an a
-000057e0: 6c69 6173 2066 6f72 2060 4461 7461 7365  lias for `Datase
-000057f0: 742e 6469 6d73 6020 7072 6f76 6964 6564  t.dims` provided
-00005800: 2066 6f72 2074 6865 2062 656e 6566 6974   for the benefit
-00005810: 206f 660a 2020 2020 2020 2020 636f 6e73   of.        cons
-00005820: 6973 7465 6e63 7920 7769 7468 2060 4461  istency with `Da
-00005830: 7461 4172 7261 792e 7369 7a65 7360 2e0a  taArray.sizes`..
-00005840: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00005850: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00005860: 2d2d 0a20 2020 2020 2020 2044 6174 6141  --.        DataA
-00005870: 7272 6179 2e73 697a 6573 0a20 2020 2020  rray.sizes.     
-00005880: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00005890: 6574 7572 6e20 7365 6c66 2e64 696d 730a  eturn self.dims.
-000058a0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-000058b0: 2020 2064 6566 2064 7479 7065 7328 7365     def dtypes(se
-000058c0: 6c66 2920 2d3e 2046 726f 7a65 6e5b 4861  lf) -> Frozen[Ha
-000058d0: 7368 6162 6c65 2c20 6e70 2e64 7479 7065  shable, np.dtype
-000058e0: 5d3a 0a20 2020 2020 2020 2022 2222 4d61  ]:.        """Ma
-000058f0: 7070 696e 6720 6672 6f6d 2064 6174 6120  pping from data 
-00005900: 7661 7269 6162 6c65 206e 616d 6573 2074  variable names t
-00005910: 6f20 6474 7970 6573 2e0a 0a20 2020 2020  o dtypes...     
-00005920: 2020 2043 616e 6e6f 7420 6265 206d 6f64     Cannot be mod
-00005930: 6966 6965 6420 6469 7265 6374 6c79 2c20  ified directly, 
-00005940: 6275 7420 6973 2075 7064 6174 6564 2077  but is updated w
-00005950: 6865 6e20 6164 6469 6e67 206e 6577 2076  hen adding new v
-00005960: 6172 6961 626c 6573 2e0a 0a20 2020 2020  ariables...     
-00005970: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-00005980: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00005990: 2020 2020 2044 6174 6141 7272 6179 2e64       DataArray.d
-000059a0: 7479 7065 0a20 2020 2020 2020 2022 2222  type.        """
-000059b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000059c0: 4672 6f7a 656e 280a 2020 2020 2020 2020  Frozen(.        
-000059d0: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-000059e0: 2020 2020 2020 6e3a 2076 2e64 7479 7065        n: v.dtype
-000059f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005a00: 2066 6f72 206e 2c20 7620 696e 2073 656c   for n, v in sel
-00005a10: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
-00005a20: 6d73 2829 0a20 2020 2020 2020 2020 2020  ms().           
-00005a30: 2020 2020 2069 6620 6e20 6e6f 7420 696e       if n not in
-00005a40: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-00005a50: 6573 0a20 2020 2020 2020 2020 2020 207d  es.            }
-00005a60: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00005a70: 6465 6620 6c6f 6164 2873 656c 663a 2054  def load(self: T
-00005a80: 5f44 6174 6173 6574 2c20 2a2a 6b77 6172  _Dataset, **kwar
-00005a90: 6773 2920 2d3e 2054 5f44 6174 6173 6574  gs) -> T_Dataset
-00005aa0: 3a0a 2020 2020 2020 2020 2222 224d 616e  :.        """Man
-00005ab0: 7561 6c6c 7920 7472 6967 6765 7220 6c6f  ually trigger lo
-00005ac0: 6164 696e 6720 616e 642f 6f72 2063 6f6d  ading and/or com
-00005ad0: 7075 7461 7469 6f6e 206f 6620 7468 6973  putation of this
-00005ae0: 2064 6174 6173 6574 2773 2064 6174 610a   dataset's data.
-00005af0: 2020 2020 2020 2020 6672 6f6d 2064 6973          from dis
-00005b00: 6b20 6f72 2061 2072 656d 6f74 6520 736f  k or a remote so
-00005b10: 7572 6365 2069 6e74 6f20 6d65 6d6f 7279  urce into memory
-00005b20: 2061 6e64 2072 6574 7572 6e20 7468 6973   and return this
-00005b30: 2064 6174 6173 6574 2e0a 2020 2020 2020   dataset..      
-00005b40: 2020 556e 6c69 6b65 2063 6f6d 7075 7465    Unlike compute
-00005b50: 2c20 7468 6520 6f72 6967 696e 616c 2064  , the original d
-00005b60: 6174 6173 6574 2069 7320 6d6f 6469 6669  ataset is modifi
-00005b70: 6564 2061 6e64 2072 6574 7572 6e65 642e  ed and returned.
-00005b80: 0a0a 2020 2020 2020 2020 4e6f 726d 616c  ..        Normal
-00005b90: 6c79 2c20 6974 2073 686f 756c 6420 6e6f  ly, it should no
-00005ba0: 7420 6265 206e 6563 6573 7361 7279 2074  t be necessary t
-00005bb0: 6f20 6361 6c6c 2074 6869 7320 6d65 7468  o call this meth
-00005bc0: 6f64 2069 6e20 7573 6572 2063 6f64 652c  od in user code,
-00005bd0: 0a20 2020 2020 2020 2062 6563 6175 7365  .        because
-00005be0: 2061 6c6c 2078 6172 7261 7920 6675 6e63   all xarray func
-00005bf0: 7469 6f6e 7320 7368 6f75 6c64 2065 6974  tions should eit
-00005c00: 6865 7220 776f 726b 206f 6e20 6465 6665  her work on defe
-00005c10: 7272 6564 2064 6174 6120 6f72 0a20 2020  rred data or.   
-00005c20: 2020 2020 206c 6f61 6420 6461 7461 2061       load data a
-00005c30: 7574 6f6d 6174 6963 616c 6c79 2e20 486f  utomatically. Ho
-00005c40: 7765 7665 722c 2074 6869 7320 6d65 7468  wever, this meth
-00005c50: 6f64 2063 616e 2062 6520 6e65 6365 7373  od can be necess
-00005c60: 6172 7920 7768 656e 0a20 2020 2020 2020  ary when.       
-00005c70: 2077 6f72 6b69 6e67 2077 6974 6820 6d61   working with ma
-00005c80: 6e79 2066 696c 6520 6f62 6a65 6374 7320  ny file objects 
-00005c90: 6f6e 2064 6973 6b2e 0a0a 2020 2020 2020  on disk...      
-00005ca0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00005cb0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00005cc0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00005cd0: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
-00005ce0: 2020 2020 4164 6469 7469 6f6e 616c 206b      Additional k
-00005cf0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-00005d00: 2070 6173 7365 6420 6f6e 2074 6f20 6060   passed on to ``
-00005d10: 6461 736b 2e63 6f6d 7075 7465 6060 2e0a  dask.compute``..
-00005d20: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00005d30: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00005d40: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
-00005d50: 636f 6d70 7574 650a 2020 2020 2020 2020  compute.        
-00005d60: 2222 220a 2020 2020 2020 2020 2320 6163  """.        # ac
-00005d70: 6365 7373 202e 6461 7461 2074 6f20 636f  cess .data to co
-00005d80: 6572 6365 2065 7665 7279 7468 696e 6720  erce everything 
-00005d90: 746f 206e 756d 7079 206f 7220 6461 736b  to numpy or dask
-00005da0: 2061 7272 6179 730a 2020 2020 2020 2020   arrays.        
-00005db0: 6c61 7a79 5f64 6174 6120 3d20 7b0a 2020  lazy_data = {.  
-00005dc0: 2020 2020 2020 2020 2020 6b3a 2076 2e5f            k: v._
-00005dd0: 6461 7461 2066 6f72 206b 2c20 7620 696e  data for k, v in
-00005de0: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
-00005df0: 6974 656d 7328 2920 6966 2069 735f 6475  items() if is_du
-00005e00: 636b 5f64 6173 6b5f 6172 7261 7928 762e  ck_dask_array(v.
-00005e10: 5f64 6174 6129 0a20 2020 2020 2020 207d  _data).        }
-00005e20: 0a20 2020 2020 2020 2069 6620 6c61 7a79  .        if lazy
-00005e30: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
-00005e40: 2020 2069 6d70 6f72 7420 6461 736b 2e61     import dask.a
-00005e50: 7272 6179 2061 7320 6461 0a0a 2020 2020  rray as da..    
-00005e60: 2020 2020 2020 2020 2320 6576 616c 7561          # evalua
-00005e70: 7465 2061 6c6c 2074 6865 2064 6173 6b20  te all the dask 
-00005e80: 6172 7261 7973 2073 696d 756c 7461 6e65  arrays simultane
-00005e90: 6f75 736c 790a 2020 2020 2020 2020 2020  ously.          
-00005ea0: 2020 6576 616c 7561 7465 645f 6461 7461    evaluated_data
-00005eb0: 203d 2064 612e 636f 6d70 7574 6528 2a6c   = da.compute(*l
-00005ec0: 617a 795f 6461 7461 2e76 616c 7565 7328  azy_data.values(
-00005ed0: 292c 202a 2a6b 7761 7267 7329 0a0a 2020  ), **kwargs)..  
-00005ee0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
-00005ef0: 2064 6174 6120 696e 207a 6970 286c 617a   data in zip(laz
-00005f00: 795f 6461 7461 2c20 6576 616c 7561 7465  y_data, evaluate
-00005f10: 645f 6461 7461 293a 0a20 2020 2020 2020  d_data):.       
-00005f20: 2020 2020 2020 2020 2073 656c 662e 7661           self.va
-00005f30: 7269 6162 6c65 735b 6b5d 2e64 6174 6120  riables[k].data 
-00005f40: 3d20 6461 7461 0a0a 2020 2020 2020 2020  = data..        
-00005f50: 2320 6c6f 6164 2065 7665 7279 7468 696e  # load everythin
-00005f60: 6720 656c 7365 2073 6571 7565 6e74 6961  g else sequentia
-00005f70: 6c6c 790a 2020 2020 2020 2020 666f 7220  lly.        for 
-00005f80: 6b2c 2076 2069 6e20 7365 6c66 2e76 6172  k, v in self.var
-00005f90: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
-00005fa0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00005fb0: 206e 6f74 2069 6e20 6c61 7a79 5f64 6174   not in lazy_dat
-00005fc0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-00005fd0: 2020 2076 2e6c 6f61 6428 290a 0a20 2020     v.load()..   
-00005fe0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00005ff0: 0a0a 2020 2020 6465 6620 5f5f 6461 736b  ..    def __dask
-00006000: 5f74 6f6b 656e 697a 655f 5f28 7365 6c66  _tokenize__(self
-00006010: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
-00006020: 6461 736b 2e62 6173 6520 696d 706f 7274  dask.base import
-00006030: 206e 6f72 6d61 6c69 7a65 5f74 6f6b 656e   normalize_token
-00006040: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00006050: 206e 6f72 6d61 6c69 7a65 5f74 6f6b 656e   normalize_token
-00006060: 280a 2020 2020 2020 2020 2020 2020 2874  (.            (t
-00006070: 7970 6528 7365 6c66 292c 2073 656c 662e  ype(self), self.
-00006080: 5f76 6172 6961 626c 6573 2c20 7365 6c66  _variables, self
-00006090: 2e5f 636f 6f72 645f 6e61 6d65 732c 2073  ._coord_names, s
-000060a0: 656c 662e 5f61 7474 7273 290a 2020 2020  elf._attrs).    
-000060b0: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-000060c0: 5f64 6173 6b5f 6772 6170 685f 5f28 7365  _dask_graph__(se
-000060d0: 6c66 293a 0a20 2020 2020 2020 2067 7261  lf):.        gra
-000060e0: 7068 7320 3d20 7b6b 3a20 762e 5f5f 6461  phs = {k: v.__da
-000060f0: 736b 5f67 7261 7068 5f5f 2829 2066 6f72  sk_graph__() for
-00006100: 206b 2c20 7620 696e 2073 656c 662e 7661   k, v in self.va
-00006110: 7269 6162 6c65 732e 6974 656d 7328 297d  riables.items()}
-00006120: 0a20 2020 2020 2020 2067 7261 7068 7320  .        graphs 
-00006130: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-00006140: 2069 6e20 6772 6170 6873 2e69 7465 6d73   in graphs.items
-00006150: 2829 2069 6620 7620 6973 206e 6f74 204e  () if v is not N
-00006160: 6f6e 657d 0a20 2020 2020 2020 2069 6620  one}.        if 
-00006170: 6e6f 7420 6772 6170 6873 3a0a 2020 2020  not graphs:.    
-00006180: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00006190: 6f6e 650a 2020 2020 2020 2020 656c 7365  one.        else
-000061a0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-000061b0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000061c0: 2020 2066 726f 6d20 6461 736b 2e68 6967     from dask.hig
-000061d0: 686c 6576 656c 6772 6170 6820 696d 706f  hlevelgraph impo
-000061e0: 7274 2048 6967 684c 6576 656c 4772 6170  rt HighLevelGrap
-000061f0: 680a 0a20 2020 2020 2020 2020 2020 2020  h..             
-00006200: 2020 2072 6574 7572 6e20 4869 6768 4c65     return HighLe
-00006210: 7665 6c47 7261 7068 2e6d 6572 6765 282a  velGraph.merge(*
-00006220: 6772 6170 6873 2e76 616c 7565 7328 2929  graphs.values())
-00006230: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00006240: 6570 7420 496d 706f 7274 4572 726f 723a  ept ImportError:
-00006250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006260: 2066 726f 6d20 6461 736b 2069 6d70 6f72   from dask impor
-00006270: 7420 7368 6172 6564 6963 740a 0a20 2020  t sharedict..   
-00006280: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00006290: 7572 6e20 7368 6172 6564 6963 742e 6d65  urn sharedict.me
-000062a0: 7267 6528 2a67 7261 7068 732e 7661 6c75  rge(*graphs.valu
-000062b0: 6573 2829 290a 0a20 2020 2064 6566 205f  es())..    def _
-000062c0: 5f64 6173 6b5f 6b65 7973 5f5f 2873 656c  _dask_keys__(sel
-000062d0: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
-000062e0: 7274 2064 6173 6b0a 0a20 2020 2020 2020  rt dask..       
-000062f0: 2072 6574 7572 6e20 5b0a 2020 2020 2020   return [.      
-00006300: 2020 2020 2020 762e 5f5f 6461 736b 5f6b        v.__dask_k
-00006310: 6579 735f 5f28 290a 2020 2020 2020 2020  eys__().        
-00006320: 2020 2020 666f 7220 7620 696e 2073 656c      for v in sel
-00006330: 662e 7661 7269 6162 6c65 732e 7661 6c75  f.variables.valu
-00006340: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
-00006350: 2069 6620 6461 736b 2e69 735f 6461 736b   if dask.is_dask
-00006360: 5f63 6f6c 6c65 6374 696f 6e28 7629 0a20  _collection(v). 
-00006370: 2020 2020 2020 205d 0a0a 2020 2020 6465         ]..    de
-00006380: 6620 5f5f 6461 736b 5f6c 6179 6572 735f  f __dask_layers_
-00006390: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-000063a0: 2069 6d70 6f72 7420 6461 736b 0a0a 2020   import dask..  
-000063b0: 2020 2020 2020 7265 7475 726e 2073 756d        return sum
-000063c0: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
-000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063e0: 762e 5f5f 6461 736b 5f6c 6179 6572 735f  v.__dask_layers_
-000063f0: 5f28 290a 2020 2020 2020 2020 2020 2020  _().            
-00006400: 2020 2020 666f 7220 7620 696e 2073 656c      for v in sel
-00006410: 662e 7661 7269 6162 6c65 732e 7661 6c75  f.variables.valu
-00006420: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
-00006430: 2020 2020 2069 6620 6461 736b 2e69 735f       if dask.is_
-00006440: 6461 736b 5f63 6f6c 6c65 6374 696f 6e28  dask_collection(
-00006450: 7629 0a20 2020 2020 2020 2020 2020 2029  v).            )
-00006460: 2c0a 2020 2020 2020 2020 2020 2020 2829  ,.            ()
-00006470: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00006480: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00006490: 6566 205f 5f64 6173 6b5f 6f70 7469 6d69  ef __dask_optimi
-000064a0: 7a65 5f5f 2873 656c 6629 3a0a 2020 2020  ze__(self):.    
-000064b0: 2020 2020 696d 706f 7274 2064 6173 6b2e      import dask.
-000064c0: 6172 7261 7920 6173 2064 610a 0a20 2020  array as da..   
-000064d0: 2020 2020 2072 6574 7572 6e20 6461 2e41       return da.A
-000064e0: 7272 6179 2e5f 5f64 6173 6b5f 6f70 7469  rray.__dask_opti
-000064f0: 6d69 7a65 5f5f 0a0a 2020 2020 4070 726f  mize__..    @pro
-00006500: 7065 7274 790a 2020 2020 6465 6620 5f5f  perty.    def __
-00006510: 6461 736b 5f73 6368 6564 756c 6572 5f5f  dask_scheduler__
-00006520: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00006530: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
-00006540: 7920 6173 2064 610a 0a20 2020 2020 2020  y as da..       
-00006550: 2072 6574 7572 6e20 6461 2e41 7272 6179   return da.Array
-00006560: 2e5f 5f64 6173 6b5f 7363 6865 6475 6c65  .__dask_schedule
-00006570: 725f 5f0a 0a20 2020 2064 6566 205f 5f64  r__..    def __d
-00006580: 6173 6b5f 706f 7374 636f 6d70 7574 655f  ask_postcompute_
-00006590: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-000065a0: 2072 6574 7572 6e20 7365 6c66 2e5f 6461   return self._da
-000065b0: 736b 5f70 6f73 7463 6f6d 7075 7465 2c20  sk_postcompute, 
-000065c0: 2829 0a0a 2020 2020 6465 6620 5f5f 6461  ()..    def __da
-000065d0: 736b 5f70 6f73 7470 6572 7369 7374 5f5f  sk_postpersist__
-000065e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000065f0: 7265 7475 726e 2073 656c 662e 5f64 6173  return self._das
-00006600: 6b5f 706f 7374 7065 7273 6973 742c 2028  k_postpersist, (
-00006610: 290a 0a20 2020 2064 6566 205f 6461 736b  )..    def _dask
-00006620: 5f70 6f73 7463 6f6d 7075 7465 2873 656c  _postcompute(sel
-00006630: 663a 2054 5f44 6174 6173 6574 2c20 7265  f: T_Dataset, re
-00006640: 7375 6c74 733a 2049 7465 7261 626c 655b  sults: Iterable[
-00006650: 5661 7269 6162 6c65 5d29 202d 3e20 545f  Variable]) -> T_
-00006660: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-00006670: 2069 6d70 6f72 7420 6461 736b 0a0a 2020   import dask..  
-00006680: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
-00006690: 3d20 7b7d 0a20 2020 2020 2020 2072 6573  = {}.        res
-000066a0: 756c 7473 5f69 7465 7220 3d20 6974 6572  ults_iter = iter
-000066b0: 2872 6573 756c 7473 290a 0a20 2020 2020  (results)..     
-000066c0: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
-000066d0: 656c 662e 5f76 6172 6961 626c 6573 2e69  elf._variables.i
-000066e0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-000066f0: 2020 2020 6966 2064 6173 6b2e 6973 5f64      if dask.is_d
-00006700: 6173 6b5f 636f 6c6c 6563 7469 6f6e 2876  ask_collection(v
-00006710: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00006720: 2020 2072 6562 7569 6c64 2c20 6172 6773     rebuild, args
-00006730: 203d 2076 2e5f 5f64 6173 6b5f 706f 7374   = v.__dask_post
-00006740: 636f 6d70 7574 655f 5f28 290a 2020 2020  compute__().    
-00006750: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
-00006760: 7265 6275 696c 6428 6e65 7874 2872 6573  rebuild(next(res
-00006770: 756c 7473 5f69 7465 7229 2c20 2a61 7267  ults_iter), *arg
-00006780: 7329 0a20 2020 2020 2020 2020 2020 2076  s).            v
-00006790: 6172 6961 626c 6573 5b6b 5d20 3d20 760a  ariables[k] = v.
-000067a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000067b0: 7479 7065 2873 656c 6629 2e5f 636f 6e73  type(self)._cons
-000067c0: 7472 7563 745f 6469 7265 6374 280a 2020  truct_direct(.  
-000067d0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-000067e0: 6c65 732c 0a20 2020 2020 2020 2020 2020  les,.           
-000067f0: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-00006800: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-00006810: 7365 6c66 2e5f 6469 6d73 2c0a 2020 2020  self._dims,.    
-00006820: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
-00006830: 7472 732c 0a20 2020 2020 2020 2020 2020  trs,.           
-00006840: 2073 656c 662e 5f69 6e64 6578 6573 2c0a   self._indexes,.
-00006850: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006860: 2e5f 656e 636f 6469 6e67 2c0a 2020 2020  ._encoding,.    
-00006870: 2020 2020 2020 2020 7365 6c66 2e5f 636c          self._cl
-00006880: 6f73 652c 0a20 2020 2020 2020 2029 0a0a  ose,.        )..
-00006890: 2020 2020 6465 6620 5f64 6173 6b5f 706f      def _dask_po
-000068a0: 7374 7065 7273 6973 7428 0a20 2020 2020  stpersist(.     
-000068b0: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-000068c0: 6574 2c20 6473 6b3a 204d 6170 7069 6e67  et, dsk: Mapping
-000068d0: 2c20 2a2c 2072 656e 616d 653a 204d 6170  , *, rename: Map
-000068e0: 7069 6e67 5b73 7472 2c20 7374 725d 207c  ping[str, str] |
-000068f0: 204e 6f6e 6520 3d20 4e6f 6e65 0a20 2020   None = None.   
-00006900: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-00006910: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00006920: 736b 2069 6d70 6f72 7420 6973 5f64 6173  sk import is_das
-00006930: 6b5f 636f 6c6c 6563 7469 6f6e 0a20 2020  k_collection.   
-00006940: 2020 2020 2066 726f 6d20 6461 736b 2e68       from dask.h
-00006950: 6967 686c 6576 656c 6772 6170 6820 696d  ighlevelgraph im
-00006960: 706f 7274 2048 6967 684c 6576 656c 4772  port HighLevelGr
-00006970: 6170 680a 2020 2020 2020 2020 6672 6f6d  aph.        from
-00006980: 2064 6173 6b2e 6f70 7469 6d69 7a61 7469   dask.optimizati
-00006990: 6f6e 2069 6d70 6f72 7420 6375 6c6c 0a0a  on import cull..
-000069a0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-000069b0: 7320 3d20 7b7d 0a0a 2020 2020 2020 2020  s = {}..        
-000069c0: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-000069d0: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
-000069e0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-000069f0: 2069 6620 6e6f 7420 6973 5f64 6173 6b5f   if not is_dask_
-00006a00: 636f 6c6c 6563 7469 6f6e 2876 293a 0a20  collection(v):. 
-00006a10: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00006a20: 6172 6961 626c 6573 5b6b 5d20 3d20 760a  ariables[k] = v.
-00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a40: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-00006a50: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00006a60: 6e63 6528 6473 6b2c 2048 6967 684c 6576  nce(dsk, HighLev
-00006a70: 656c 4772 6170 6829 3a0a 2020 2020 2020  elGraph):.      
-00006a80: 2020 2020 2020 2020 2020 2320 6461 736b            # dask
-00006a90: 203e 3d20 3230 3231 2e33 0a20 2020 2020   >= 2021.3.     
-00006aa0: 2020 2020 2020 2020 2020 2023 205f 5f64             # __d
-00006ab0: 6173 6b5f 706f 7374 7065 7273 6973 745f  ask_postpersist_
-00006ac0: 5f28 2920 7761 7320 6361 6c6c 6564 2062  _() was called b
-00006ad0: 7920 6461 736b 2e68 6967 686c 6576 656c  y dask.highlevel
-00006ae0: 6772 6170 682e 0a20 2020 2020 2020 2020  graph..         
-00006af0: 2020 2020 2020 2023 2044 6f6e 2774 2075         # Don't u
-00006b00: 7365 2064 736b 2e63 756c 6c28 292c 2061  se dsk.cull(), a
-00006b10: 7320 7765 206e 6565 6420 746f 2070 7265  s we need to pre
-00006b20: 7665 6e74 2070 6172 7469 616c 206c 6179  vent partial lay
-00006b30: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
-00006b40: 2020 2020 2023 2068 7474 7073 3a2f 2f67       # https://g
-00006b50: 6974 6875 622e 636f 6d2f 6461 736b 2f64  ithub.com/dask/d
-00006b60: 6173 6b2f 6973 7375 6573 2f37 3133 370a  ask/issues/7137.
-00006b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b80: 6c61 7965 7273 203d 2076 2e5f 5f64 6173  layers = v.__das
-00006b90: 6b5f 6c61 7965 7273 5f5f 2829 0a20 2020  k_layers__().   
-00006ba0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00006bb0: 7265 6e61 6d65 3a0a 2020 2020 2020 2020  rename:.        
-00006bc0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00006bd0: 7273 203d 205b 7265 6e61 6d65 2e67 6574  rs = [rename.get
-00006be0: 286b 2c20 6b29 2066 6f72 206b 2069 6e20  (k, k) for k in 
-00006bf0: 6c61 7965 7273 5d0a 2020 2020 2020 2020  layers].        
-00006c00: 2020 2020 2020 2020 6473 6b32 203d 2064          dsk2 = d
-00006c10: 736b 2e63 756c 6c5f 6c61 7965 7273 286c  sk.cull_layers(l
-00006c20: 6179 6572 7329 0a20 2020 2020 2020 2020  ayers).         
-00006c30: 2020 2065 6c69 6620 7265 6e61 6d65 3a20     elif rename: 
-00006c40: 2023 2070 7261 676d 613a 206e 6f63 6f76   # pragma: nocov
-00006c50: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-00006c60: 2020 2023 2041 7420 7468 6520 6d6f 6d65     # At the mome
-00006c70: 6e74 206f 6620 7772 6974 696e 672c 2074  nt of writing, t
-00006c80: 6869 7320 6973 206f 6e6c 7920 666f 7220  his is only for 
-00006c90: 666f 7277 6172 6420 636f 6d70 6174 6962  forward compatib
-00006ca0: 696c 6974 792e 0a20 2020 2020 2020 2020  ility..         
-00006cb0: 2020 2020 2020 2023 2072 6570 6c61 6365         # replace
-00006cc0: 5f6e 616d 655f 696e 5f6b 6579 2072 6571  _name_in_key req
-00006cd0: 7569 7265 7320 6461 736b 203e 3d20 3230  uires dask >= 20
-00006ce0: 3231 2e33 2e0a 2020 2020 2020 2020 2020  21.3..          
-00006cf0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00006d00: 6261 7365 2069 6d70 6f72 7420 666c 6174  base import flat
-00006d10: 7465 6e2c 2072 6570 6c61 6365 5f6e 616d  ten, replace_nam
-00006d20: 655f 696e 5f6b 6579 0a0a 2020 2020 2020  e_in_key..      
-00006d30: 2020 2020 2020 2020 2020 6b65 7973 203d            keys =
-00006d40: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-00006d50: 2020 2020 2020 2072 6570 6c61 6365 5f6e         replace_n
-00006d60: 616d 655f 696e 5f6b 6579 286b 2c20 7265  ame_in_key(k, re
-00006d70: 6e61 6d65 2920 666f 7220 6b20 696e 2066  name) for k in f
-00006d80: 6c61 7474 656e 2876 2e5f 5f64 6173 6b5f  latten(v.__dask_
-00006d90: 6b65 7973 5f5f 2829 290a 2020 2020 2020  keys__()).      
-00006da0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-00006db0: 2020 2020 2020 2020 2020 2020 6473 6b32              dsk2
-00006dc0: 2c20 5f20 3d20 6375 6c6c 2864 736b 2c20  , _ = cull(dsk, 
-00006dd0: 6b65 7973 290a 2020 2020 2020 2020 2020  keys).          
-00006de0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00006df0: 2020 2020 2020 2020 2320 5f5f 6461 736b          # __dask
-00006e00: 5f70 6f73 7470 6572 7369 7374 5f5f 2829  _postpersist__()
-00006e10: 2077 6173 2063 616c 6c65 6420 6279 2064   was called by d
-00006e20: 6173 6b2e 6f70 7469 6d69 7a65 206f 7220  ask.optimize or 
-00006e30: 6461 736b 2e70 6572 7369 7374 0a20 2020  dask.persist.   
-00006e40: 2020 2020 2020 2020 2020 2020 2064 736b               dsk
-00006e50: 322c 205f 203d 2063 756c 6c28 6473 6b2c  2, _ = cull(dsk,
-00006e60: 2076 2e5f 5f64 6173 6b5f 6b65 7973 5f5f   v.__dask_keys__
-00006e70: 2829 290a 0a20 2020 2020 2020 2020 2020  ())..           
-00006e80: 2072 6562 7569 6c64 2c20 6172 6773 203d   rebuild, args =
-00006e90: 2076 2e5f 5f64 6173 6b5f 706f 7374 7065   v.__dask_postpe
-00006ea0: 7273 6973 745f 5f28 290a 2020 2020 2020  rsist__().      
-00006eb0: 2020 2020 2020 2320 7265 6e61 6d65 2077        # rename w
-00006ec0: 6173 2061 6464 6564 2069 6e20 6461 736b  as added in dask
-00006ed0: 2032 3032 312e 330a 2020 2020 2020 2020   2021.3.        
-00006ee0: 2020 2020 6b77 6172 6773 203d 207b 2272      kwargs = {"r
-00006ef0: 656e 616d 6522 3a20 7265 6e61 6d65 7d20  ename": rename} 
-00006f00: 6966 2072 656e 616d 6520 656c 7365 207b  if rename else {
-00006f10: 7d0a 2020 2020 2020 2020 2020 2020 7661  }.            va
-00006f20: 7269 6162 6c65 735b 6b5d 203d 2072 6562  riables[k] = reb
-00006f30: 7569 6c64 2864 736b 322c 202a 6172 6773  uild(dsk2, *args
-00006f40: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-00006f50: 2020 2020 2072 6574 7572 6e20 7479 7065       return type
-00006f60: 2873 656c 6629 2e5f 636f 6e73 7472 7563  (self)._construc
-00006f70: 745f 6469 7265 6374 280a 2020 2020 2020  t_direct(.      
-00006f80: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
-00006f90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006fa0: 662e 5f63 6f6f 7264 5f6e 616d 6573 2c0a  f._coord_names,.
-00006fb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006fc0: 2e5f 6469 6d73 2c0a 2020 2020 2020 2020  ._dims,.        
-00006fd0: 2020 2020 7365 6c66 2e5f 6174 7472 732c      self._attrs,
-00006fe0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006ff0: 662e 5f69 6e64 6578 6573 2c0a 2020 2020  f._indexes,.    
-00007000: 2020 2020 2020 2020 7365 6c66 2e5f 656e          self._en
-00007010: 636f 6469 6e67 2c0a 2020 2020 2020 2020  coding,.        
-00007020: 2020 2020 7365 6c66 2e5f 636c 6f73 652c      self._close,
-00007030: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00007040: 6465 6620 636f 6d70 7574 6528 7365 6c66  def compute(self
-00007050: 3a20 545f 4461 7461 7365 742c 202a 2a6b  : T_Dataset, **k
-00007060: 7761 7267 7329 202d 3e20 545f 4461 7461  wargs) -> T_Data
-00007070: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-00007080: 4d61 6e75 616c 6c79 2074 7269 6767 6572  Manually trigger
-00007090: 206c 6f61 6469 6e67 2061 6e64 2f6f 7220   loading and/or 
-000070a0: 636f 6d70 7574 6174 696f 6e20 6f66 2074  computation of t
-000070b0: 6869 7320 6461 7461 7365 7427 7320 6461  his dataset's da
-000070c0: 7461 0a20 2020 2020 2020 2066 726f 6d20  ta.        from 
-000070d0: 6469 736b 206f 7220 6120 7265 6d6f 7465  disk or a remote
-000070e0: 2073 6f75 7263 6520 696e 746f 206d 656d   source into mem
-000070f0: 6f72 7920 616e 6420 7265 7475 726e 2061  ory and return a
-00007100: 206e 6577 2064 6174 6173 6574 2e0a 2020   new dataset..  
-00007110: 2020 2020 2020 556e 6c69 6b65 206c 6f61        Unlike loa
-00007120: 642c 2074 6865 206f 7269 6769 6e61 6c20  d, the original 
-00007130: 6461 7461 7365 7420 6973 206c 6566 7420  dataset is left 
-00007140: 756e 616c 7465 7265 642e 0a0a 2020 2020  unaltered...    
-00007150: 2020 2020 4e6f 726d 616c 6c79 2c20 6974      Normally, it
-00007160: 2073 686f 756c 6420 6e6f 7420 6265 206e   should not be n
-00007170: 6563 6573 7361 7279 2074 6f20 6361 6c6c  ecessary to call
-00007180: 2074 6869 7320 6d65 7468 6f64 2069 6e20   this method in 
-00007190: 7573 6572 2063 6f64 652c 0a20 2020 2020  user code,.     
-000071a0: 2020 2062 6563 6175 7365 2061 6c6c 2078     because all x
-000071b0: 6172 7261 7920 6675 6e63 7469 6f6e 7320  array functions 
-000071c0: 7368 6f75 6c64 2065 6974 6865 7220 776f  should either wo
-000071d0: 726b 206f 6e20 6465 6665 7272 6564 2064  rk on deferred d
-000071e0: 6174 6120 6f72 0a20 2020 2020 2020 206c  ata or.        l
-000071f0: 6f61 6420 6461 7461 2061 7574 6f6d 6174  oad data automat
-00007200: 6963 616c 6c79 2e20 486f 7765 7665 722c  ically. However,
-00007210: 2074 6869 7320 6d65 7468 6f64 2063 616e   this method can
-00007220: 2062 6520 6e65 6365 7373 6172 7920 7768   be necessary wh
-00007230: 656e 0a20 2020 2020 2020 2077 6f72 6b69  en.        worki
-00007240: 6e67 2077 6974 6820 6d61 6e79 2066 696c  ng with many fil
-00007250: 6520 6f62 6a65 6374 7320 6f6e 2064 6973  e objects on dis
-00007260: 6b2e 0a0a 2020 2020 2020 2020 5061 7261  k...        Para
-00007270: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00007280: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00007290: 2020 2a2a 6b77 6172 6773 203a 2064 6963    **kwargs : dic
-000072a0: 740a 2020 2020 2020 2020 2020 2020 4164  t.            Ad
-000072b0: 6469 7469 6f6e 616c 206b 6579 776f 7264  ditional keyword
-000072c0: 2061 7267 756d 656e 7473 2070 6173 7365   arguments passe
-000072d0: 6420 6f6e 2074 6f20 6060 6461 736b 2e63  d on to ``dask.c
-000072e0: 6f6d 7075 7465 6060 2e0a 0a20 2020 2020  ompute``...     
-000072f0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-00007300: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00007310: 2020 2020 2064 6173 6b2e 636f 6d70 7574       dask.comput
-00007320: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-00007330: 2020 2020 2020 6e65 7720 3d20 7365 6c66        new = self
-00007340: 2e63 6f70 7928 6465 6570 3d46 616c 7365  .copy(deep=False
-00007350: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00007360: 206e 6577 2e6c 6f61 6428 2a2a 6b77 6172   new.load(**kwar
-00007370: 6773 290a 0a20 2020 2064 6566 205f 7065  gs)..    def _pe
-00007380: 7273 6973 745f 696e 706c 6163 6528 7365  rsist_inplace(se
-00007390: 6c66 3a20 545f 4461 7461 7365 742c 202a  lf: T_Dataset, *
-000073a0: 2a6b 7761 7267 7329 202d 3e20 545f 4461  *kwargs) -> T_Da
-000073b0: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-000073c0: 2222 5065 7273 6973 7420 616c 6c20 4461  ""Persist all Da
-000073d0: 736b 2061 7272 6179 7320 696e 206d 656d  sk arrays in mem
-000073e0: 6f72 7922 2222 0a20 2020 2020 2020 2023  ory""".        #
-000073f0: 2061 6363 6573 7320 2e64 6174 6120 746f   access .data to
-00007400: 2063 6f65 7263 6520 6576 6572 7974 6869   coerce everythi
-00007410: 6e67 2074 6f20 6e75 6d70 7920 6f72 2064  ng to numpy or d
-00007420: 6173 6b20 6172 7261 7973 0a20 2020 2020  ask arrays.     
-00007430: 2020 206c 617a 795f 6461 7461 203d 207b     lazy_data = {
-00007440: 0a20 2020 2020 2020 2020 2020 206b 3a20  .            k: 
-00007450: 762e 5f64 6174 6120 666f 7220 6b2c 2076  v._data for k, v
-00007460: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
-00007470: 6573 2e69 7465 6d73 2829 2069 6620 6973  es.items() if is
-00007480: 5f64 7563 6b5f 6461 736b 5f61 7272 6179  _duck_dask_array
-00007490: 2876 2e5f 6461 7461 290a 2020 2020 2020  (v._data).      
-000074a0: 2020 7d0a 2020 2020 2020 2020 6966 206c    }.        if l
-000074b0: 617a 795f 6461 7461 3a0a 2020 2020 2020  azy_data:.      
-000074c0: 2020 2020 2020 696d 706f 7274 2064 6173        import das
-000074d0: 6b0a 0a20 2020 2020 2020 2020 2020 2023  k..            #
-000074e0: 2065 7661 6c75 6174 6520 616c 6c20 7468   evaluate all th
-000074f0: 6520 6461 736b 2061 7272 6179 7320 7369  e dask arrays si
-00007500: 6d75 6c74 616e 656f 7573 6c79 0a20 2020  multaneously.   
-00007510: 2020 2020 2020 2020 2065 7661 6c75 6174           evaluat
-00007520: 6564 5f64 6174 6120 3d20 6461 736b 2e70  ed_data = dask.p
-00007530: 6572 7369 7374 282a 6c61 7a79 5f64 6174  ersist(*lazy_dat
-00007540: 612e 7661 6c75 6573 2829 2c20 2a2a 6b77  a.values(), **kw
-00007550: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
-00007560: 2020 2066 6f72 206b 2c20 6461 7461 2069     for k, data i
-00007570: 6e20 7a69 7028 6c61 7a79 5f64 6174 612c  n zip(lazy_data,
-00007580: 2065 7661 6c75 6174 6564 5f64 6174 6129   evaluated_data)
-00007590: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000075a0: 2020 7365 6c66 2e76 6172 6961 626c 6573    self.variables
-000075b0: 5b6b 5d2e 6461 7461 203d 2064 6174 610a  [k].data = data.
-000075c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000075d0: 7365 6c66 0a0a 2020 2020 6465 6620 7065  self..    def pe
-000075e0: 7273 6973 7428 7365 6c66 3a20 545f 4461  rsist(self: T_Da
-000075f0: 7461 7365 742c 202a 2a6b 7761 7267 7329  taset, **kwargs)
-00007600: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
-00007610: 2020 2020 2020 2022 2222 5472 6967 6765         """Trigge
-00007620: 7220 636f 6d70 7574 6174 696f 6e2c 206b  r computation, k
-00007630: 6565 7069 6e67 2064 6174 6120 6173 2064  eeping data as d
-00007640: 6173 6b20 6172 7261 7973 0a0a 2020 2020  ask arrays..    
-00007650: 2020 2020 5468 6973 206f 7065 7261 7469      This operati
-00007660: 6f6e 2063 616e 2062 6520 7573 6564 2074  on can be used t
-00007670: 6f20 7472 6967 6765 7220 636f 6d70 7574  o trigger comput
-00007680: 6174 696f 6e20 6f6e 2075 6e64 6572 6c79  ation on underly
-00007690: 696e 6720 6461 736b 0a20 2020 2020 2020  ing dask.       
-000076a0: 2061 7272 6179 732c 2073 696d 696c 6172   arrays, similar
-000076b0: 2074 6f20 6060 2e63 6f6d 7075 7465 2829   to ``.compute()
-000076c0: 6060 206f 7220 6060 2e6c 6f61 6428 2960  `` or ``.load()`
-000076d0: 602e 2020 486f 7765 7665 7220 7468 6973  `.  However this
-000076e0: 0a20 2020 2020 2020 206f 7065 7261 7469  .        operati
-000076f0: 6f6e 206b 6565 7073 2074 6865 2064 6174  on keeps the dat
-00007700: 6120 6173 2064 6173 6b20 6172 7261 7973  a as dask arrays
-00007710: 2e20 5468 6973 2069 7320 7061 7274 6963  . This is partic
-00007720: 756c 6172 6c79 2075 7365 6675 6c0a 2020  ularly useful.  
-00007730: 2020 2020 2020 7768 656e 2075 7369 6e67        when using
-00007740: 2074 6865 2064 6173 6b2e 6469 7374 7269   the dask.distri
-00007750: 6275 7465 6420 7363 6865 6475 6c65 7220  buted scheduler 
-00007760: 616e 6420 796f 7520 7761 6e74 2074 6f20  and you want to 
-00007770: 6c6f 6164 2061 206c 6172 6765 0a20 2020  load a large.   
-00007780: 2020 2020 2061 6d6f 756e 7420 6f66 2064       amount of d
-00007790: 6174 6120 696e 746f 2064 6973 7472 6962  ata into distrib
-000077a0: 7574 6564 206d 656d 6f72 792e 0a0a 2020  uted memory...  
-000077b0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-000077c0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000077d0: 2d2d 2d0a 2020 2020 2020 2020 2a2a 6b77  ---.        **kw
-000077e0: 6172 6773 203a 2064 6963 740a 2020 2020  args : dict.    
-000077f0: 2020 2020 2020 2020 4164 6469 7469 6f6e          Addition
-00007800: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
-00007810: 656e 7473 2070 6173 7365 6420 6f6e 2074  ents passed on t
-00007820: 6f20 6060 6461 736b 2e70 6572 7369 7374  o ``dask.persist
-00007830: 6060 2e0a 0a20 2020 2020 2020 2053 6565  ``...        See
-00007840: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00007850: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00007860: 6173 6b2e 7065 7273 6973 740a 2020 2020  ask.persist.    
-00007870: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007880: 6e65 7720 3d20 7365 6c66 2e63 6f70 7928  new = self.copy(
-00007890: 6465 6570 3d46 616c 7365 290a 2020 2020  deep=False).    
-000078a0: 2020 2020 7265 7475 726e 206e 6577 2e5f      return new._
-000078b0: 7065 7273 6973 745f 696e 706c 6163 6528  persist_inplace(
-000078c0: 2a2a 6b77 6172 6773 290a 0a20 2020 2040  **kwargs)..    @
-000078d0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000078e0: 6465 6620 5f63 6f6e 7374 7275 6374 5f64  def _construct_d
-000078f0: 6972 6563 7428 0a20 2020 2020 2020 2063  irect(.        c
-00007900: 6c73 3a20 7479 7065 5b54 5f44 6174 6173  ls: type[T_Datas
-00007910: 6574 5d2c 0a20 2020 2020 2020 2076 6172  et],.        var
-00007920: 6961 626c 6573 3a20 6469 6374 5b41 6e79  iables: dict[Any
-00007930: 2c20 5661 7269 6162 6c65 5d2c 0a20 2020  , Variable],.   
-00007940: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
-00007950: 3a20 7365 745b 4861 7368 6162 6c65 5d2c  : set[Hashable],
-00007960: 0a20 2020 2020 2020 2064 696d 733a 2064  .        dims: d
-00007970: 6963 745b 416e 792c 2069 6e74 5d20 7c20  ict[Any, int] | 
-00007980: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00007990: 2020 2020 2061 7474 7273 3a20 6469 6374       attrs: dict
-000079a0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000079b0: 2020 2020 2020 2020 696e 6465 7865 733a          indexes:
-000079c0: 2064 6963 745b 416e 792c 2049 6e64 6578   dict[Any, Index
-000079d0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-000079e0: 0a20 2020 2020 2020 2065 6e63 6f64 696e  .        encodin
-000079f0: 673a 2064 6963 7420 7c20 4e6f 6e65 203d  g: dict | None =
-00007a00: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-00007a10: 6c6f 7365 3a20 4361 6c6c 6162 6c65 5b5b  lose: Callable[[
-00007a20: 5d2c 204e 6f6e 655d 207c 204e 6f6e 6520  ], None] | None 
-00007a30: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
-00007a40: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00007a50: 2020 2020 2222 2253 686f 7274 6375 7420      """Shortcut 
-00007a60: 6172 6f75 6e64 205f 5f69 6e69 745f 5f20  around __init__ 
-00007a70: 666f 7220 696e 7465 726e 616c 2075 7365  for internal use
-00007a80: 2077 6865 6e20 7765 2077 616e 7420 746f   when we want to
-00007a90: 2073 6b69 700a 2020 2020 2020 2020 636f   skip.        co
-00007aa0: 7374 6c79 2076 616c 6964 6174 696f 6e0a  stly validation.
-00007ab0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00007ac0: 2020 2020 6966 2064 696d 7320 6973 204e      if dims is N
-00007ad0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00007ae0: 2064 696d 7320 3d20 6361 6c63 756c 6174   dims = calculat
-00007af0: 655f 6469 6d65 6e73 696f 6e73 2876 6172  e_dimensions(var
-00007b00: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
-00007b10: 6966 2069 6e64 6578 6573 2069 7320 4e6f  if indexes is No
-00007b20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007b30: 696e 6465 7865 7320 3d20 7b7d 0a20 2020  indexes = {}.   
-00007b40: 2020 2020 206f 626a 203d 206f 626a 6563       obj = objec
-00007b50: 742e 5f5f 6e65 775f 5f28 636c 7329 0a20  t.__new__(cls). 
-00007b60: 2020 2020 2020 206f 626a 2e5f 7661 7269         obj._vari
-00007b70: 6162 6c65 7320 3d20 7661 7269 6162 6c65  ables = variable
-00007b80: 730a 2020 2020 2020 2020 6f62 6a2e 5f63  s.        obj._c
-00007b90: 6f6f 7264 5f6e 616d 6573 203d 2063 6f6f  oord_names = coo
-00007ba0: 7264 5f6e 616d 6573 0a20 2020 2020 2020  rd_names.       
-00007bb0: 206f 626a 2e5f 6469 6d73 203d 2064 696d   obj._dims = dim
-00007bc0: 730a 2020 2020 2020 2020 6f62 6a2e 5f69  s.        obj._i
-00007bd0: 6e64 6578 6573 203d 2069 6e64 6578 6573  ndexes = indexes
-00007be0: 0a20 2020 2020 2020 206f 626a 2e5f 6174  .        obj._at
-00007bf0: 7472 7320 3d20 6174 7472 730a 2020 2020  trs = attrs.    
-00007c00: 2020 2020 6f62 6a2e 5f63 6c6f 7365 203d      obj._close =
-00007c10: 2063 6c6f 7365 0a20 2020 2020 2020 206f   close.        o
-00007c20: 626a 2e5f 656e 636f 6469 6e67 203d 2065  bj._encoding = e
-00007c30: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
-00007c40: 7265 7475 726e 206f 626a 0a0a 2020 2020  return obj..    
-00007c50: 6465 6620 5f72 6570 6c61 6365 280a 2020  def _replace(.  
-00007c60: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
-00007c70: 7461 7365 742c 0a20 2020 2020 2020 2076  taset,.        v
-00007c80: 6172 6961 626c 6573 3a20 6469 6374 5b48  ariables: dict[H
-00007c90: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
-00007ca0: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
-00007cb0: 2c0a 2020 2020 2020 2020 636f 6f72 645f  ,.        coord_
-00007cc0: 6e61 6d65 733a 2073 6574 5b48 6173 6861  names: set[Hasha
-00007cd0: 626c 655d 207c 204e 6f6e 6520 3d20 4e6f  ble] | None = No
-00007ce0: 6e65 2c0a 2020 2020 2020 2020 6469 6d73  ne,.        dims
-00007cf0: 3a20 6469 6374 5b41 6e79 2c20 696e 745d  : dict[Any, int]
-00007d00: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00007d10: 2020 2020 2020 2020 6174 7472 733a 2064          attrs: d
-00007d20: 6963 745b 4861 7368 6162 6c65 2c20 416e  ict[Hashable, An
-00007d30: 795d 207c 204e 6f6e 6520 7c20 4465 6661  y] | None | Defa
-00007d40: 756c 7420 3d20 5f64 6566 6175 6c74 2c0a  ult = _default,.
-00007d50: 2020 2020 2020 2020 696e 6465 7865 733a          indexes:
-00007d60: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00007d70: 496e 6465 785d 207c 204e 6f6e 6520 3d20  Index] | None = 
-00007d80: 4e6f 6e65 2c0a 2020 2020 2020 2020 656e  None,.        en
-00007d90: 636f 6469 6e67 3a20 6469 6374 207c 204e  coding: dict | N
-00007da0: 6f6e 6520 7c20 4465 6661 756c 7420 3d20  one | Default = 
-00007db0: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
-00007dc0: 2020 696e 706c 6163 653a 2062 6f6f 6c20    inplace: bool 
-00007dd0: 3d20 4661 6c73 652c 0a20 2020 2029 202d  = False,.    ) -
-00007de0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00007df0: 2020 2020 2022 2222 4661 7374 7061 7468       """Fastpath
-00007e00: 2063 6f6e 7374 7275 6374 6f72 2066 6f72   constructor for
-00007e10: 2069 6e74 6572 6e61 6c20 7573 652e 0a0a   internal use...
-00007e20: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
-00007e30: 616e 206f 626a 6563 7420 7769 7468 206f  an object with o
-00007e40: 7074 696f 6e61 6c6c 7920 7769 7468 2072  ptionally with r
-00007e50: 6570 6c61 6365 6420 6174 7472 6962 7574  eplaced attribut
-00007e60: 6573 2e0a 0a20 2020 2020 2020 2045 7870  es...        Exp
-00007e70: 6c69 6369 746c 7920 7061 7373 6564 2061  licitly passed a
-00007e80: 7267 756d 656e 7473 2061 7265 202a 6e6f  rguments are *no
-00007e90: 742a 2063 6f70 6965 6420 7768 656e 2070  t* copied when p
-00007ea0: 6c61 6365 6420 6f6e 2074 6865 206e 6577  laced on the new
-00007eb0: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-00007ec0: 2e20 4974 2069 7320 7570 2074 6f20 7468  . It is up to th
-00007ed0: 6520 6361 6c6c 6572 2074 6f20 656e 7375  e caller to ensu
-00007ee0: 7265 2074 6861 7420 7468 6579 2068 6176  re that they hav
-00007ef0: 6520 7468 6520 7269 6768 7420 7479 7065  e the right type
-00007f00: 0a20 2020 2020 2020 2061 6e64 2061 7265  .        and are
-00007f10: 206e 6f74 2075 7365 6420 656c 7365 7768   not used elsewh
-00007f20: 6572 652e 0a20 2020 2020 2020 2022 2222  ere..        """
-00007f30: 0a20 2020 2020 2020 2069 6620 696e 706c  .        if inpl
-00007f40: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
-00007f50: 2069 6620 7661 7269 6162 6c65 7320 6973   if variables is
-00007f60: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00007f70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007f80: 5f76 6172 6961 626c 6573 203d 2076 6172  _variables = var
-00007f90: 6961 626c 6573 0a20 2020 2020 2020 2020  iables.         
-00007fa0: 2020 2069 6620 636f 6f72 645f 6e61 6d65     if coord_name
-00007fb0: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
-00007fc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00007fd0: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
-00007fe0: 203d 2063 6f6f 7264 5f6e 616d 6573 0a20   = coord_names. 
-00007ff0: 2020 2020 2020 2020 2020 2069 6620 6469             if di
-00008000: 6d73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ms is not None:.
-00008010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008020: 7365 6c66 2e5f 6469 6d73 203d 2064 696d  self._dims = dim
-00008030: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-00008040: 2061 7474 7273 2069 7320 6e6f 7420 5f64   attrs is not _d
-00008050: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-00008060: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
-00008070: 7472 7320 3d20 6174 7472 730a 2020 2020  trs = attrs.    
-00008080: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
-00008090: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
-000080a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080b0: 7365 6c66 2e5f 696e 6465 7865 7320 3d20  self._indexes = 
-000080c0: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
-000080d0: 2020 2020 6966 2065 6e63 6f64 696e 6720      if encoding 
-000080e0: 6973 206e 6f74 205f 6465 6661 756c 743a  is not _default:
-000080f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008100: 2073 656c 662e 5f65 6e63 6f64 696e 6720   self._encoding 
-00008110: 3d20 656e 636f 6469 6e67 0a20 2020 2020  = encoding.     
-00008120: 2020 2020 2020 206f 626a 203d 2073 656c         obj = sel
-00008130: 660a 2020 2020 2020 2020 656c 7365 3a0a  f.        else:.
-00008140: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00008150: 6172 6961 626c 6573 2069 7320 4e6f 6e65  ariables is None
-00008160: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008170: 2020 7661 7269 6162 6c65 7320 3d20 7365    variables = se
-00008180: 6c66 2e5f 7661 7269 6162 6c65 732e 636f  lf._variables.co
-00008190: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
-000081a0: 2069 6620 636f 6f72 645f 6e61 6d65 7320   if coord_names 
-000081b0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000081c0: 2020 2020 2020 2020 2063 6f6f 7264 5f6e           coord_n
-000081d0: 616d 6573 203d 2073 656c 662e 5f63 6f6f  ames = self._coo
-000081e0: 7264 5f6e 616d 6573 2e63 6f70 7928 290a  rd_names.copy().
-000081f0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00008200: 696d 7320 6973 204e 6f6e 653a 0a20 2020  ims is None:.   
-00008210: 2020 2020 2020 2020 2020 2020 2064 696d               dim
-00008220: 7320 3d20 7365 6c66 2e5f 6469 6d73 2e63  s = self._dims.c
-00008230: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00008240: 2020 6966 2061 7474 7273 2069 7320 5f64    if attrs is _d
-00008250: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-00008260: 2020 2020 2020 2020 6174 7472 7320 3d20          attrs = 
-00008270: 636f 7079 2e63 6f70 7928 7365 6c66 2e5f  copy.copy(self._
-00008280: 6174 7472 7329 0a20 2020 2020 2020 2020  attrs).         
-00008290: 2020 2069 6620 696e 6465 7865 7320 6973     if indexes is
-000082a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000082b0: 2020 2020 2020 2069 6e64 6578 6573 203d         indexes =
-000082c0: 2073 656c 662e 5f69 6e64 6578 6573 2e63   self._indexes.c
-000082d0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-000082e0: 2020 6966 2065 6e63 6f64 696e 6720 6973    if encoding is
-000082f0: 205f 6465 6661 756c 743a 0a20 2020 2020   _default:.     
-00008300: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-00008310: 696e 6720 3d20 636f 7079 2e63 6f70 7928  ing = copy.copy(
-00008320: 7365 6c66 2e5f 656e 636f 6469 6e67 290a  self._encoding).
-00008330: 2020 2020 2020 2020 2020 2020 6f62 6a20              obj 
-00008340: 3d20 7365 6c66 2e5f 636f 6e73 7472 7563  = self._construc
-00008350: 745f 6469 7265 6374 280a 2020 2020 2020  t_direct(.      
-00008360: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-00008370: 6c65 732c 2063 6f6f 7264 5f6e 616d 6573  les, coord_names
-00008380: 2c20 6469 6d73 2c20 6174 7472 732c 2069  , dims, attrs, i
-00008390: 6e64 6578 6573 2c20 656e 636f 6469 6e67  ndexes, encoding
-000083a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000083b0: 2020 2020 2020 2072 6574 7572 6e20 6f62         return ob
-000083c0: 6a0a 0a20 2020 2064 6566 205f 7265 706c  j..    def _repl
-000083d0: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
-000083e0: 7328 0a20 2020 2020 2020 2073 656c 663a  s(.        self:
-000083f0: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
-00008400: 2020 2020 7661 7269 6162 6c65 733a 2064      variables: d
-00008410: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
-00008420: 7269 6162 6c65 5d2c 0a20 2020 2020 2020  riable],.       
-00008430: 2063 6f6f 7264 5f6e 616d 6573 3a20 7365   coord_names: se
-00008440: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
-00008450: 0a20 2020 2020 2020 2061 7474 7273 3a20  .        attrs: 
-00008460: 6469 6374 5b48 6173 6861 626c 652c 2041  dict[Hashable, A
-00008470: 6e79 5d20 7c20 4e6f 6e65 207c 2044 6566  ny] | None | Def
-00008480: 6175 6c74 203d 205f 6465 6661 756c 742c  ault = _default,
-00008490: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-000084a0: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
-000084b0: 2049 6e64 6578 5d20 7c20 4e6f 6e65 203d   Index] | None =
-000084c0: 204e 6f6e 652c 0a20 2020 2020 2020 2069   None,.        i
-000084d0: 6e70 6c61 6365 3a20 626f 6f6c 203d 2046  nplace: bool = F
-000084e0: 616c 7365 2c0a 2020 2020 2920 2d3e 2054  alse,.    ) -> T
-000084f0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00008500: 2020 2222 2252 6570 6c61 6365 2076 6172    """Replace var
-00008510: 6961 626c 6573 2077 6974 6820 7265 6361  iables with reca
-00008520: 6c63 756c 6174 6564 2064 696d 656e 7369  lculated dimensi
-00008530: 6f6e 732e 2222 220a 2020 2020 2020 2020  ons.""".        
-00008540: 6469 6d73 203d 2063 616c 6375 6c61 7465  dims = calculate
-00008550: 5f64 696d 656e 7369 6f6e 7328 7661 7269  _dimensions(vari
-00008560: 6162 6c65 7329 0a20 2020 2020 2020 2072  ables).        r
-00008570: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
-00008580: 6163 6528 0a20 2020 2020 2020 2020 2020  ace(.           
-00008590: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
-000085a0: 645f 6e61 6d65 732c 2064 696d 732c 2061  d_names, dims, a
-000085b0: 7474 7273 2c20 696e 6465 7865 732c 2069  ttrs, indexes, i
-000085c0: 6e70 6c61 6365 3d69 6e70 6c61 6365 0a20  nplace=inplace. 
-000085d0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000085e0: 6620 5f72 6570 6c61 6365 5f76 6172 735f  f _replace_vars_
-000085f0: 616e 645f 6469 6d73 280a 2020 2020 2020  and_dims(.      
-00008600: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
-00008610: 742c 0a20 2020 2020 2020 2076 6172 6961  t,.        varia
-00008620: 626c 6573 3a20 6469 6374 5b48 6173 6861  bles: dict[Hasha
-00008630: 626c 652c 2056 6172 6961 626c 655d 2c0a  ble, Variable],.
-00008640: 2020 2020 2020 2020 636f 6f72 645f 6e61          coord_na
-00008650: 6d65 733a 2073 6574 207c 204e 6f6e 6520  mes: set | None 
-00008660: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00008670: 6469 6d73 3a20 6469 6374 5b48 6173 6861  dims: dict[Hasha
-00008680: 626c 652c 2069 6e74 5d20 7c20 4e6f 6e65  ble, int] | None
-00008690: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-000086a0: 2061 7474 7273 3a20 6469 6374 5b48 6173   attrs: dict[Has
-000086b0: 6861 626c 652c 2041 6e79 5d20 7c20 4e6f  hable, Any] | No
-000086c0: 6e65 207c 2044 6566 6175 6c74 203d 205f  ne | Default = _
-000086d0: 6465 6661 756c 742c 0a20 2020 2020 2020  default,.       
-000086e0: 2069 6e70 6c61 6365 3a20 626f 6f6c 203d   inplace: bool =
-000086f0: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
-00008700: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00008710: 2020 2020 2222 2244 6570 7265 6361 7465      """Deprecate
-00008720: 6420 7665 7273 696f 6e20 6f66 205f 7265  d version of _re
-00008730: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
-00008740: 696d 7328 292e 0a0a 2020 2020 2020 2020  ims()...        
-00008750: 556e 6c69 6b65 205f 7265 706c 6163 655f  Unlike _replace_
-00008760: 7769 7468 5f6e 6577 5f64 696d 7328 292c  with_new_dims(),
-00008770: 2074 6869 7320 6d65 7468 6f64 2061 6c77   this method alw
-00008780: 6179 7320 7265 6361 6c63 756c 6174 6573  ays recalculates
-00008790: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-000087a0: 2066 726f 6d20 7661 7269 6162 6c65 732e   from variables.
-000087b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000087c0: 2020 2020 2069 6620 6469 6d73 2069 7320       if dims is 
-000087d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000087e0: 2020 6469 6d73 203d 2063 616c 6375 6c61    dims = calcula
-000087f0: 7465 5f64 696d 656e 7369 6f6e 7328 7661  te_dimensions(va
-00008800: 7269 6162 6c65 7329 0a20 2020 2020 2020  riables).       
-00008810: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-00008820: 706c 6163 6528 0a20 2020 2020 2020 2020  place(.         
-00008830: 2020 2076 6172 6961 626c 6573 2c20 636f     variables, co
-00008840: 6f72 645f 6e61 6d65 732c 2064 696d 732c  ord_names, dims,
-00008850: 2061 7474 7273 2c20 696e 6465 7865 733d   attrs, indexes=
-00008860: 4e6f 6e65 2c20 696e 706c 6163 653d 696e  None, inplace=in
-00008870: 706c 6163 650a 2020 2020 2020 2020 290a  place.        ).
-00008880: 0a20 2020 2064 6566 205f 6f76 6572 7772  .    def _overwr
-00008890: 6974 655f 696e 6465 7865 7328 0a20 2020  ite_indexes(.   
-000088a0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-000088b0: 6173 6574 2c0a 2020 2020 2020 2020 696e  aset,.        in
-000088c0: 6465 7865 733a 204d 6170 7069 6e67 5b48  dexes: Mapping[H
-000088d0: 6173 6861 626c 652c 2049 6e64 6578 5d2c  ashable, Index],
-000088e0: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-000088f0: 6573 3a20 4d61 7070 696e 675b 4861 7368  es: Mapping[Hash
-00008900: 6162 6c65 2c20 5661 7269 6162 6c65 5d20  able, Variable] 
-00008910: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-00008920: 2020 2020 2020 2064 726f 705f 7661 7269         drop_vari
-00008930: 6162 6c65 733a 206c 6973 745b 4861 7368  ables: list[Hash
-00008940: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
-00008950: 6f6e 652c 0a20 2020 2020 2020 2064 726f  one,.        dro
-00008960: 705f 696e 6465 7865 733a 206c 6973 745b  p_indexes: list[
-00008970: 4861 7368 6162 6c65 5d20 7c20 4e6f 6e65  Hashable] | None
-00008980: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00008990: 2072 656e 616d 655f 6469 6d73 3a20 4d61   rename_dims: Ma
-000089a0: 7070 696e 675b 4861 7368 6162 6c65 2c20  pping[Hashable, 
-000089b0: 4861 7368 6162 6c65 5d20 7c20 4e6f 6e65  Hashable] | None
-000089c0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-000089d0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-000089e0: 2020 2020 2022 2222 4d61 7962 6520 7265       """Maybe re
-000089f0: 706c 6163 6520 696e 6465 7865 732e 0a0a  place indexes...
-00008a00: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
-00008a10: 6374 696f 6e20 6d61 7920 646f 2061 206c  ction may do a l
-00008a20: 6f74 206d 6f72 6520 6465 7065 6e64 696e  ot more dependin
-00008a30: 6720 6f6e 2069 6e64 6578 2071 7565 7279  g on index query
-00008a40: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
-00008a50: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
-00008a60: 2020 2020 2020 2069 6620 6e6f 7420 696e         if not in
-00008a70: 6465 7865 733a 0a20 2020 2020 2020 2020  dexes:.         
-00008a80: 2020 2072 6574 7572 6e20 7365 6c66 0a0a     return self..
-00008a90: 2020 2020 2020 2020 6966 2076 6172 6961          if varia
-00008aa0: 626c 6573 2069 7320 4e6f 6e65 3a0a 2020  bles is None:.  
-00008ab0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-00008ac0: 6c65 7320 3d20 7b7d 0a20 2020 2020 2020  les = {}.       
-00008ad0: 2069 6620 6472 6f70 5f76 6172 6961 626c   if drop_variabl
-00008ae0: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00008af0: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
-00008b00: 6961 626c 6573 203d 205b 5d0a 2020 2020  iables = [].    
-00008b10: 2020 2020 6966 2064 726f 705f 696e 6465      if drop_inde
-00008b20: 7865 7320 6973 204e 6f6e 653a 0a20 2020  xes is None:.   
-00008b30: 2020 2020 2020 2020 2064 726f 705f 696e           drop_in
-00008b40: 6465 7865 7320 3d20 5b5d 0a0a 2020 2020  dexes = []..    
-00008b50: 2020 2020 6e65 775f 7661 7269 6162 6c65      new_variable
-00008b60: 7320 3d20 7365 6c66 2e5f 7661 7269 6162  s = self._variab
-00008b70: 6c65 732e 636f 7079 2829 0a20 2020 2020  les.copy().     
-00008b80: 2020 206e 6577 5f63 6f6f 7264 5f6e 616d     new_coord_nam
-00008b90: 6573 203d 2073 656c 662e 5f63 6f6f 7264  es = self._coord
-00008ba0: 5f6e 616d 6573 2e63 6f70 7928 290a 2020  _names.copy().  
-00008bb0: 2020 2020 2020 6e65 775f 696e 6465 7865        new_indexe
-00008bc0: 7320 3d20 6469 6374 2873 656c 662e 5f69  s = dict(self._i
-00008bd0: 6e64 6578 6573 290a 0a20 2020 2020 2020  ndexes)..       
-00008be0: 2069 6e64 6578 5f76 6172 6961 626c 6573   index_variables
-00008bf0: 203d 207b 7d0a 2020 2020 2020 2020 6e6f   = {}.        no
-00008c00: 5f69 6e64 6578 5f76 6172 6961 626c 6573  _index_variables
-00008c10: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
-00008c20: 7220 6e61 6d65 2c20 7661 7220 696e 2076  r name, var in v
-00008c30: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
-00008c40: 3a0a 2020 2020 2020 2020 2020 2020 6f6c  :.            ol
-00008c50: 645f 7661 7220 3d20 7365 6c66 2e5f 7661  d_var = self._va
-00008c60: 7269 6162 6c65 732e 6765 7428 6e61 6d65  riables.get(name
-00008c70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00008c80: 206f 6c64 5f76 6172 2069 7320 6e6f 7420   old_var is not 
-00008c90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00008ca0: 2020 2020 2020 7661 722e 6174 7472 732e        var.attrs.
-00008cb0: 7570 6461 7465 286f 6c64 5f76 6172 2e61  update(old_var.a
-00008cc0: 7474 7273 290a 2020 2020 2020 2020 2020  ttrs).          
-00008cd0: 2020 2020 2020 7661 722e 656e 636f 6469        var.encodi
-00008ce0: 6e67 2e75 7064 6174 6528 6f6c 645f 7661  ng.update(old_va
-00008cf0: 722e 656e 636f 6469 6e67 290a 2020 2020  r.encoding).    
-00008d00: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-00008d10: 696e 2069 6e64 6578 6573 3a0a 2020 2020  in indexes:.    
-00008d20: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00008d30: 785f 7661 7269 6162 6c65 735b 6e61 6d65  x_variables[name
-00008d40: 5d20 3d20 7661 720a 2020 2020 2020 2020  ] = var.        
-00008d50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00008d60: 2020 2020 2020 2020 2020 6e6f 5f69 6e64            no_ind
-00008d70: 6578 5f76 6172 6961 626c 6573 5b6e 616d  ex_variables[nam
-00008d80: 655d 203d 2076 6172 0a0a 2020 2020 2020  e] = var..      
-00008d90: 2020 666f 7220 6e61 6d65 2069 6e20 696e    for name in in
-00008da0: 6465 7865 733a 0a20 2020 2020 2020 2020  dexes:.         
-00008db0: 2020 206e 6577 5f69 6e64 6578 6573 5b6e     new_indexes[n
-00008dc0: 616d 655d 203d 2069 6e64 6578 6573 5b6e  ame] = indexes[n
-00008dd0: 616d 655d 0a0a 2020 2020 2020 2020 666f  ame]..        fo
-00008de0: 7220 6e61 6d65 2c20 7661 7220 696e 2069  r name, var in i
-00008df0: 6e64 6578 5f76 6172 6961 626c 6573 2e69  ndex_variables.i
-00008e00: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-00008e10: 2020 2020 6e65 775f 636f 6f72 645f 6e61      new_coord_na
-00008e20: 6d65 732e 6164 6428 6e61 6d65 290a 2020  mes.add(name).  
-00008e30: 2020 2020 2020 2020 2020 6e65 775f 7661            new_va
-00008e40: 7269 6162 6c65 735b 6e61 6d65 5d20 3d20  riables[name] = 
-00008e50: 7661 720a 0a20 2020 2020 2020 2023 2061  var..        # a
-00008e60: 7070 656e 6420 6e6f 2d69 6e64 6578 2076  ppend no-index v
-00008e70: 6172 6961 626c 6573 2061 7420 7468 6520  ariables at the 
-00008e80: 656e 640a 2020 2020 2020 2020 666f 7220  end.        for 
-00008e90: 6b20 696e 206e 6f5f 696e 6465 785f 7661  k in no_index_va
-00008ea0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00008eb0: 2020 2020 206e 6577 5f76 6172 6961 626c       new_variabl
-00008ec0: 6573 2e70 6f70 286b 290a 2020 2020 2020  es.pop(k).      
-00008ed0: 2020 6e65 775f 7661 7269 6162 6c65 732e    new_variables.
-00008ee0: 7570 6461 7465 286e 6f5f 696e 6465 785f  update(no_index_
-00008ef0: 7661 7269 6162 6c65 7329 0a0a 2020 2020  variables)..    
-00008f00: 2020 2020 666f 7220 6e61 6d65 2069 6e20      for name in 
-00008f10: 6472 6f70 5f69 6e64 6578 6573 3a0a 2020  drop_indexes:.  
-00008f20: 2020 2020 2020 2020 2020 6e65 775f 696e            new_in
-00008f30: 6465 7865 732e 706f 7028 6e61 6d65 290a  dexes.pop(name).
-00008f40: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-00008f50: 6520 696e 2064 726f 705f 7661 7269 6162  e in drop_variab
-00008f60: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00008f70: 206e 6577 5f76 6172 6961 626c 6573 2e70   new_variables.p
-00008f80: 6f70 286e 616d 6529 0a20 2020 2020 2020  op(name).       
-00008f90: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
-00008fa0: 2e70 6f70 286e 616d 652c 204e 6f6e 6529  .pop(name, None)
-00008fb0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00008fc0: 5f63 6f6f 7264 5f6e 616d 6573 2e72 656d  _coord_names.rem
-00008fd0: 6f76 6528 6e61 6d65 290a 0a20 2020 2020  ove(name)..     
-00008fe0: 2020 2072 6570 6c61 6365 6420 3d20 7365     replaced = se
-00008ff0: 6c66 2e5f 7265 706c 6163 6528 0a20 2020  lf._replace(.   
-00009000: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00009010: 6573 3d6e 6577 5f76 6172 6961 626c 6573  es=new_variables
-00009020: 2c20 636f 6f72 645f 6e61 6d65 733d 6e65  , coord_names=ne
-00009030: 775f 636f 6f72 645f 6e61 6d65 732c 2069  w_coord_names, i
-00009040: 6e64 6578 6573 3d6e 6577 5f69 6e64 6578  ndexes=new_index
-00009050: 6573 0a20 2020 2020 2020 2029 0a0a 2020  es.        )..  
-00009060: 2020 2020 2020 6966 2072 656e 616d 655f        if rename_
-00009070: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-00009080: 2020 2320 736b 6970 2072 656e 616d 6520    # skip rename 
-00009090: 696e 6465 7865 733a 2074 6865 7920 7368  indexes: they sh
-000090a0: 6f75 6c64 2061 6c72 6561 6479 2068 6176  ould already hav
-000090b0: 6520 7468 6520 7269 6768 7420 6e61 6d65  e the right name
-000090c0: 2873 290a 2020 2020 2020 2020 2020 2020  (s).            
-000090d0: 6469 6d73 203d 2072 6570 6c61 6365 642e  dims = replaced.
-000090e0: 5f72 656e 616d 655f 6469 6d73 2872 656e  _rename_dims(ren
-000090f0: 616d 655f 6469 6d73 290a 2020 2020 2020  ame_dims).      
-00009100: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
-00009110: 6c65 732c 206e 6577 5f63 6f6f 7264 5f6e  les, new_coord_n
-00009120: 616d 6573 203d 2072 6570 6c61 6365 642e  ames = replaced.
-00009130: 5f72 656e 616d 655f 7661 7273 287b 7d2c  _rename_vars({},
-00009140: 2072 656e 616d 655f 6469 6d73 290a 2020   rename_dims).  
-00009150: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009160: 2072 6570 6c61 6365 642e 5f72 6570 6c61   replaced._repla
-00009170: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-00009180: 2020 2020 7661 7269 6162 6c65 733d 6e65      variables=ne
-00009190: 775f 7661 7269 6162 6c65 732c 2063 6f6f  w_variables, coo
-000091a0: 7264 5f6e 616d 6573 3d6e 6577 5f63 6f6f  rd_names=new_coo
-000091b0: 7264 5f6e 616d 6573 2c20 6469 6d73 3d64  rd_names, dims=d
-000091c0: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
-000091d0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-000091e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000091f0: 726e 2072 6570 6c61 6365 640a 0a20 2020  rn replaced..   
-00009200: 2064 6566 2063 6f70 7928 0a20 2020 2020   def copy(.     
-00009210: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-00009220: 6574 2c20 6465 6570 3a20 626f 6f6c 203d  et, deep: bool =
-00009230: 2046 616c 7365 2c20 6461 7461 3a20 4d61   False, data: Ma
-00009240: 7070 696e 675b 416e 792c 2041 7272 6179  pping[Any, Array
-00009250: 4c69 6b65 5d20 7c20 4e6f 6e65 203d 204e  Like] | None = N
-00009260: 6f6e 650a 2020 2020 2920 2d3e 2054 5f44  one.    ) -> T_D
-00009270: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-00009280: 2222 2252 6574 7572 6e73 2061 2063 6f70  """Returns a cop
-00009290: 7920 6f66 2074 6869 7320 6461 7461 7365  y of this datase
-000092a0: 742e 0a0a 2020 2020 2020 2020 4966 2060  t...        If `
-000092b0: 6465 6570 3d54 7275 6560 2c20 6120 6465  deep=True`, a de
-000092c0: 6570 2063 6f70 7920 6973 206d 6164 6520  ep copy is made 
-000092d0: 6f66 2065 6163 6820 6f66 2074 6865 2063  of each of the c
-000092e0: 6f6d 706f 6e65 6e74 2076 6172 6961 626c  omponent variabl
-000092f0: 6573 2e0a 2020 2020 2020 2020 4f74 6865  es..        Othe
-00009300: 7277 6973 652c 2061 2073 6861 6c6c 6f77  rwise, a shallow
-00009310: 2063 6f70 7920 6f66 2065 6163 6820 6f66   copy of each of
-00009320: 2074 6865 2063 6f6d 706f 6e65 6e74 2076   the component v
-00009330: 6172 6961 626c 6520 6973 206d 6164 652c  ariable is made,
-00009340: 2073 6f0a 2020 2020 2020 2020 7468 6174   so.        that
-00009350: 2074 6865 2075 6e64 6572 6c79 696e 6720   the underlying 
-00009360: 6d65 6d6f 7279 2072 6567 696f 6e20 6f66  memory region of
-00009370: 2074 6865 206e 6577 2064 6174 6173 6574   the new dataset
-00009380: 2069 7320 7468 6520 7361 6d65 2061 7320   is the same as 
-00009390: 696e 0a20 2020 2020 2020 2074 6865 206f  in.        the o
-000093a0: 7269 6769 6e61 6c20 6461 7461 7365 742e  riginal dataset.
-000093b0: 0a0a 2020 2020 2020 2020 5573 6520 6064  ..        Use `d
-000093c0: 6174 6160 2074 6f20 6372 6561 7465 2061  ata` to create a
-000093d0: 206e 6577 206f 626a 6563 7420 7769 7468   new object with
-000093e0: 2074 6865 2073 616d 6520 7374 7275 6374   the same struct
-000093f0: 7572 6520 6173 0a20 2020 2020 2020 206f  ure as.        o
-00009400: 7269 6769 6e61 6c20 6275 7420 656e 7469  riginal but enti
-00009410: 7265 6c79 206e 6577 2064 6174 612e 0a0a  rely new data...
-00009420: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00009430: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00009440: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6465  -----.        de
-00009450: 6570 203a 2062 6f6f 6c2c 2064 6566 6175  ep : bool, defau
-00009460: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
-00009470: 2020 2020 2020 5768 6574 6865 7220 6561        Whether ea
-00009480: 6368 2063 6f6d 706f 6e65 6e74 2076 6172  ch component var
-00009490: 6961 626c 6520 6973 206c 6f61 6465 6420  iable is loaded 
-000094a0: 696e 746f 206d 656d 6f72 7920 616e 6420  into memory and 
-000094b0: 636f 7069 6564 206f 6e74 6f0a 2020 2020  copied onto.    
-000094c0: 2020 2020 2020 2020 7468 6520 6e65 7720          the new 
-000094d0: 6f62 6a65 6374 2e20 4465 6661 756c 7420  object. Default 
-000094e0: 6973 2046 616c 7365 2e0a 2020 2020 2020  is False..      
-000094f0: 2020 6461 7461 203a 2064 6963 742d 6c69    data : dict-li
-00009500: 6b65 206f 7220 4e6f 6e65 2c20 6f70 7469  ke or None, opti
-00009510: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00009520: 2044 6174 6120 746f 2075 7365 2069 6e20   Data to use in 
-00009530: 7468 6520 6e65 7720 6f62 6a65 6374 2e20  the new object. 
-00009540: 4561 6368 2069 7465 6d20 696e 2060 6461  Each item in `da
-00009550: 7461 6020 6d75 7374 2068 6176 6520 7361  ta` must have sa
-00009560: 6d65 0a20 2020 2020 2020 2020 2020 2073  me.            s
-00009570: 6861 7065 2061 7320 636f 7272 6573 706f  hape as correspo
-00009580: 6e64 696e 6720 6461 7461 2076 6172 6961  nding data varia
-00009590: 626c 6520 696e 206f 7269 6769 6e61 6c2e  ble in original.
-000095a0: 2057 6865 6e20 6064 6174 6160 2069 730a   When `data` is.
-000095b0: 2020 2020 2020 2020 2020 2020 7573 6564              used
-000095c0: 2c20 6064 6565 7060 2069 7320 6967 6e6f  , `deep` is igno
-000095d0: 7265 6420 666f 7220 7468 6520 6461 7461  red for the data
-000095e0: 2076 6172 6961 626c 6573 2061 6e64 206f   variables and o
-000095f0: 6e6c 7920 7573 6564 2066 6f72 0a20 2020  nly used for.   
-00009600: 2020 2020 2020 2020 2063 6f6f 7264 732e           coords.
-00009610: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00009620: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00009630: 2d0a 2020 2020 2020 2020 6f62 6a65 6374  -.        object
-00009640: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
-00009650: 2020 2020 2020 204e 6577 206f 626a 6563         New objec
-00009660: 7420 7769 7468 2064 696d 656e 7369 6f6e  t with dimension
-00009670: 732c 2061 7474 7269 6275 7465 732c 2063  s, attributes, c
-00009680: 6f6f 7264 696e 6174 6573 2c20 6e61 6d65  oordinates, name
-00009690: 2c20 656e 636f 6469 6e67 2c0a 2020 2020  , encoding,.    
-000096a0: 2020 2020 2020 2020 616e 6420 6f70 7469          and opti
-000096b0: 6f6e 616c 6c79 2064 6174 6120 636f 7069  onally data copi
-000096c0: 6564 2066 726f 6d20 6f72 6967 696e 616c  ed from original
-000096d0: 2e0a 0a20 2020 2020 2020 2045 7861 6d70  ...        Examp
-000096e0: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
-000096f0: 2d2d 2d2d 0a20 2020 2020 2020 2053 6861  ----.        Sha
-00009700: 6c6c 6f77 2063 6f70 7920 7665 7273 7573  llow copy versus
-00009710: 2064 6565 7020 636f 7079 0a0a 2020 2020   deep copy..    
-00009720: 2020 2020 3e3e 3e20 6461 203d 2078 722e      >>> da = xr.
-00009730: 4461 7461 4172 7261 7928 6e70 2e72 616e  DataArray(np.ran
-00009740: 646f 6d2e 7261 6e64 6e28 322c 2033 2929  dom.randn(2, 3))
-00009750: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-00009760: 3d20 7872 2e44 6174 6173 6574 280a 2020  = xr.Dataset(.  
-00009770: 2020 2020 2020 2e2e 2e20 2020 2020 7b22        ...     {"
-00009780: 666f 6f22 3a20 6461 2c20 2262 6172 223a  foo": da, "bar":
-00009790: 2028 2278 222c 205b 2d31 2c20 325d 297d   ("x", [-1, 2])}
-000097a0: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-000097b0: 2020 636f 6f72 6473 3d7b 2278 223a 205b    coords={"x": [
-000097c0: 226f 6e65 222c 2022 7477 6f22 5d7d 2c0a  "one", "two"]},.
-000097d0: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
-000097e0: 2020 2020 2020 3e3e 3e20 6473 2e63 6f70        >>> ds.cop
-000097f0: 7928 290a 2020 2020 2020 2020 3c78 6172  y().        <xar
-00009800: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
-00009810: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
-00009820: 2020 2864 696d 5f30 3a20 322c 2064 696d    (dim_0: 2, dim
-00009830: 5f31 3a20 332c 2078 3a20 3229 0a20 2020  _1: 3, x: 2).   
-00009840: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
-00009850: 3a0a 2020 2020 2020 2020 2020 2a20 7820  :.          * x 
-00009860: 2020 2020 2020 2028 7829 203c 5533 2027         (x) <U3 '
-00009870: 6f6e 6527 2027 7477 6f27 0a20 2020 2020  one' 'two'.     
-00009880: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
-00009890: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
-000098a0: 733a 2064 696d 5f30 2c20 6469 6d5f 310a  s: dim_0, dim_1.
-000098b0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-000098c0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-000098d0: 2020 2020 666f 6f20 2020 2020 2028 6469      foo      (di
-000098e0: 6d5f 302c 2064 696d 5f31 2920 666c 6f61  m_0, dim_1) floa
-000098f0: 7436 3420 312e 3736 3420 302e 3430 3032  t64 1.764 0.4002
-00009900: 2030 2e39 3738 3720 322e 3234 3120 312e   0.9787 2.241 1.
-00009910: 3836 3820 2d30 2e39 3737 330a 2020 2020  868 -0.9773.    
-00009920: 2020 2020 2020 2020 6261 7220 2020 2020          bar     
-00009930: 2028 7829 2069 6e74 3634 202d 3120 320a   (x) int64 -1 2.
-00009940: 0a20 2020 2020 2020 203e 3e3e 2064 735f  .        >>> ds_
-00009950: 3020 3d20 6473 2e63 6f70 7928 6465 6570  0 = ds.copy(deep
-00009960: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-00009970: 3e3e 3e20 6473 5f30 5b22 666f 6f22 5d5b  >>> ds_0["foo"][
-00009980: 302c 2030 5d20 3d20 370a 2020 2020 2020  0, 0] = 7.      
-00009990: 2020 3e3e 3e20 6473 5f30 0a20 2020 2020    >>> ds_0.     
-000099a0: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-000099b0: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-000099c0: 6e73 696f 6e73 3a20 2028 6469 6d5f 303a  nsions:  (dim_0:
-000099d0: 2032 2c20 6469 6d5f 313a 2033 2c20 783a   2, dim_1: 3, x:
-000099e0: 2032 290a 2020 2020 2020 2020 436f 6f72   2).        Coor
-000099f0: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-00009a00: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-00009a10: 2920 3c55 3320 276f 6e65 2720 2774 776f  ) <U3 'one' 'two
-00009a20: 270a 2020 2020 2020 2020 4469 6d65 6e73  '.        Dimens
-00009a30: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
-00009a40: 7264 696e 6174 6573 3a20 6469 6d5f 302c  rdinates: dim_0,
-00009a50: 2064 696d 5f31 0a20 2020 2020 2020 2044   dim_1.        D
-00009a60: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-00009a70: 2020 2020 2020 2020 2020 2066 6f6f 2020             foo  
-00009a80: 2020 2020 2864 696d 5f30 2c20 6469 6d5f      (dim_0, dim_
-00009a90: 3129 2066 6c6f 6174 3634 2037 2e30 2030  1) float64 7.0 0
-00009aa0: 2e34 3030 3220 302e 3937 3837 2032 2e32  .4002 0.9787 2.2
-00009ab0: 3431 2031 2e38 3638 202d 302e 3937 3733  41 1.868 -0.9773
-00009ac0: 0a20 2020 2020 2020 2020 2020 2062 6172  .            bar
-00009ad0: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-00009ae0: 2d31 2032 0a0a 2020 2020 2020 2020 3e3e  -1 2..        >>
-00009af0: 3e20 6473 0a20 2020 2020 2020 203c 7861  > ds.        <xa
-00009b00: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-00009b10: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-00009b20: 3a20 2028 6469 6d5f 303a 2032 2c20 6469  :  (dim_0: 2, di
-00009b30: 6d5f 313a 2033 2c20 783a 2032 290a 2020  m_1: 3, x: 2).  
-00009b40: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-00009b50: 733a 0a20 2020 2020 2020 2020 202a 2078  s:.          * x
-00009b60: 2020 2020 2020 2020 2878 2920 3c55 3320          (x) <U3 
-00009b70: 276f 6e65 2720 2774 776f 270a 2020 2020  'one' 'two'.    
-00009b80: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
-00009b90: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
-00009ba0: 6573 3a20 6469 6d5f 302c 2064 696d 5f31  es: dim_0, dim_1
-00009bb0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-00009bc0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00009bd0: 2020 2020 2066 6f6f 2020 2020 2020 2864       foo      (d
-00009be0: 696d 5f30 2c20 6469 6d5f 3129 2066 6c6f  im_0, dim_1) flo
-00009bf0: 6174 3634 2037 2e30 2030 2e34 3030 3220  at64 7.0 0.4002 
-00009c00: 302e 3937 3837 2032 2e32 3431 2031 2e38  0.9787 2.241 1.8
-00009c10: 3638 202d 302e 3937 3733 0a20 2020 2020  68 -0.9773.     
-00009c20: 2020 2020 2020 2062 6172 2020 2020 2020         bar      
-00009c30: 2878 2920 696e 7436 3420 2d31 2032 0a0a  (x) int64 -1 2..
-00009c40: 2020 2020 2020 2020 4368 616e 6769 6e67          Changing
-00009c50: 2074 6865 2064 6174 6120 7573 696e 6720   the data using 
-00009c60: 7468 6520 6060 6461 7461 6060 2061 7267  the ``data`` arg
-00009c70: 756d 656e 7420 6d61 696e 7461 696e 7320  ument maintains 
-00009c80: 7468 650a 2020 2020 2020 2020 7374 7275  the.        stru
-00009c90: 6374 7572 6520 6f66 2074 6865 206f 7269  cture of the ori
-00009ca0: 6769 6e61 6c20 6f62 6a65 6374 2c20 6275  ginal object, bu
-00009cb0: 7420 7769 7468 2074 6865 206e 6577 2064  t with the new d
-00009cc0: 6174 612e 204f 7269 6769 6e61 6c0a 2020  ata. Original.  
-00009cd0: 2020 2020 2020 6f62 6a65 6374 2069 7320        object is 
-00009ce0: 756e 6166 6665 6374 6564 2e0a 0a20 2020  unaffected...   
-00009cf0: 2020 2020 203e 3e3e 2064 732e 636f 7079       >>> ds.copy
-00009d00: 2864 6174 613d 7b22 666f 6f22 3a20 6e70  (data={"foo": np
-00009d10: 2e61 7261 6e67 6528 3629 2e72 6573 6861  .arange(6).resha
-00009d20: 7065 2832 2c20 3329 2c20 2262 6172 223a  pe(2, 3), "bar":
-00009d30: 205b 2261 222c 2022 6222 5d7d 290a 2020   ["a", "b"]}).  
-00009d40: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-00009d50: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-00009d60: 696d 656e 7369 6f6e 733a 2020 2864 696d  imensions:  (dim
-00009d70: 5f30 3a20 322c 2064 696d 5f31 3a20 332c  _0: 2, dim_1: 3,
-00009d80: 2078 3a20 3229 0a20 2020 2020 2020 2043   x: 2).        C
-00009d90: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-00009da0: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
-00009db0: 2028 7829 203c 5533 2027 6f6e 6527 2027   (x) <U3 'one' '
-00009dc0: 7477 6f27 0a20 2020 2020 2020 2044 696d  two'.        Dim
-00009dd0: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
-00009de0: 636f 6f72 6469 6e61 7465 733a 2064 696d  coordinates: dim
-00009df0: 5f30 2c20 6469 6d5f 310a 2020 2020 2020  _0, dim_1.      
-00009e00: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-00009e10: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00009e20: 6f20 2020 2020 2028 6469 6d5f 302c 2064  o      (dim_0, d
-00009e30: 696d 5f31 2920 696e 7436 3420 3020 3120  im_1) int64 0 1 
-00009e40: 3220 3320 3420 350a 2020 2020 2020 2020  2 3 4 5.        
-00009e50: 2020 2020 6261 7220 2020 2020 2028 7829      bar      (x)
-00009e60: 203c 5531 2027 6127 2027 6227 0a0a 2020   <U1 'a' 'b'..  
-00009e70: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
-00009e80: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-00009e90: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
-00009ea0: 6d65 6e73 696f 6e73 3a20 2028 6469 6d5f  mensions:  (dim_
-00009eb0: 303a 2032 2c20 6469 6d5f 313a 2033 2c20  0: 2, dim_1: 3, 
-00009ec0: 783a 2032 290a 2020 2020 2020 2020 436f  x: 2).        Co
-00009ed0: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-00009ee0: 2020 2020 202a 2078 2020 2020 2020 2020       * x        
-00009ef0: 2878 2920 3c55 3320 276f 6e65 2720 2774  (x) <U3 'one' 't
-00009f00: 776f 270a 2020 2020 2020 2020 4469 6d65  wo'.        Dime
-00009f10: 6e73 696f 6e73 2077 6974 686f 7574 2063  nsions without c
-00009f20: 6f6f 7264 696e 6174 6573 3a20 6469 6d5f  oordinates: dim_
-00009f30: 302c 2064 696d 5f31 0a20 2020 2020 2020  0, dim_1.       
-00009f40: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-00009f50: 0a20 2020 2020 2020 2020 2020 2066 6f6f  .            foo
-00009f60: 2020 2020 2020 2864 696d 5f30 2c20 6469        (dim_0, di
-00009f70: 6d5f 3129 2066 6c6f 6174 3634 2037 2e30  m_1) float64 7.0
-00009f80: 2030 2e34 3030 3220 302e 3937 3837 2032   0.4002 0.9787 2
-00009f90: 2e32 3431 2031 2e38 3638 202d 302e 3937  .241 1.868 -0.97
-00009fa0: 3733 0a20 2020 2020 2020 2020 2020 2062  73.            b
-00009fb0: 6172 2020 2020 2020 2878 2920 696e 7436  ar      (x) int6
-00009fc0: 3420 2d31 2032 0a0a 2020 2020 2020 2020  4 -1 2..        
-00009fd0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00009fe0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00009ff0: 2020 7061 6e64 6173 2e44 6174 6146 7261    pandas.DataFra
-0000a000: 6d65 2e63 6f70 790a 2020 2020 2020 2020  me.copy.        
-0000a010: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000a020: 726e 2073 656c 662e 5f63 6f70 7928 6465  rn self._copy(de
-0000a030: 6570 3d64 6565 702c 2064 6174 613d 6461  ep=deep, data=da
-0000a040: 7461 290a 0a20 2020 2064 6566 205f 636f  ta)..    def _co
-0000a050: 7079 280a 2020 2020 2020 2020 7365 6c66  py(.        self
-0000a060: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-0000a070: 2020 2020 2064 6565 703a 2062 6f6f 6c20       deep: bool 
-0000a080: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0000a090: 2064 6174 613a 204d 6170 7069 6e67 5b41   data: Mapping[A
-0000a0a0: 6e79 2c20 4172 7261 794c 696b 655d 207c  ny, ArrayLike] |
-0000a0b0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-0000a0c0: 2020 2020 2020 6d65 6d6f 3a20 6469 6374        memo: dict
-0000a0d0: 5b69 6e74 2c20 416e 795d 207c 204e 6f6e  [int, Any] | Non
-0000a0e0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
-0000a0f0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-0000a100: 2020 2020 2020 6966 2064 6174 6120 6973        if data is
-0000a110: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000a120: 2020 2064 6174 6120 3d20 7b7d 0a20 2020     data = {}.   
-0000a130: 2020 2020 2065 6c69 6620 6e6f 7420 7574       elif not ut
-0000a140: 696c 732e 6973 5f64 6963 745f 6c69 6b65  ils.is_dict_like
-0000a150: 2864 6174 6129 3a0a 2020 2020 2020 2020  (data):.        
-0000a160: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000a170: 7272 6f72 2822 4461 7461 206d 7573 7420  rror("Data must 
-0000a180: 6265 2064 6963 742d 6c69 6b65 2229 0a0a  be dict-like")..
-0000a190: 2020 2020 2020 2020 6966 2064 6174 613a          if data:
-0000a1a0: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-0000a1b0: 5f6b 6579 7320 3d20 7365 7428 7365 6c66  _keys = set(self
-0000a1c0: 2e64 6174 615f 7661 7273 2e6b 6579 7328  .data_vars.keys(
-0000a1d0: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
-0000a1e0: 6174 615f 6b65 7973 203d 2073 6574 2864  ata_keys = set(d
-0000a1f0: 6174 612e 6b65 7973 2829 290a 2020 2020  ata.keys()).    
-0000a200: 2020 2020 2020 2020 6b65 7973 5f6e 6f74          keys_not
-0000a210: 5f69 6e5f 7661 7273 203d 2064 6174 615f  _in_vars = data_
-0000a220: 6b65 7973 202d 2076 6172 5f6b 6579 730a  keys - var_keys.
-0000a230: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-0000a240: 6579 735f 6e6f 745f 696e 5f76 6172 733a  eys_not_in_vars:
-0000a250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a260: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000a270: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000a280: 2020 2020 2020 2022 4461 7461 206d 7573         "Data mus
-0000a290: 7420 6f6e 6c79 2063 6f6e 7461 696e 2076  t only contain v
-0000a2a0: 6172 6961 626c 6573 2069 6e20 6f72 6967  ariables in orig
-0000a2b0: 696e 616c 2022 0a20 2020 2020 2020 2020  inal ".         
-0000a2c0: 2020 2020 2020 2020 2020 2022 6461 7461             "data
-0000a2d0: 7365 742e 2045 7874 7261 2076 6172 6961  set. Extra varia
-0000a2e0: 626c 6573 3a20 7b7d 222e 666f 726d 6174  bles: {}".format
-0000a2f0: 286b 6579 735f 6e6f 745f 696e 5f76 6172  (keys_not_in_var
-0000a300: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0000a310: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000a320: 206b 6579 735f 6d69 7373 696e 675f 6672   keys_missing_fr
-0000a330: 6f6d 5f64 6174 6120 3d20 7661 725f 6b65  om_data = var_ke
-0000a340: 7973 202d 2064 6174 615f 6b65 7973 0a20  ys - data_keys. 
-0000a350: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-0000a360: 7973 5f6d 6973 7369 6e67 5f66 726f 6d5f  ys_missing_from_
-0000a370: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-0000a380: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000a390: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0000a3a0: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
-0000a3b0: 6120 6d75 7374 2063 6f6e 7461 696e 2061  a must contain a
-0000a3c0: 6c6c 2076 6172 6961 626c 6573 2069 6e20  ll variables in 
-0000a3d0: 6f72 6967 696e 616c 2022 0a20 2020 2020  original ".     
-0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000a3f0: 6461 7461 7365 742e 2044 6174 6120 6973  dataset. Data is
-0000a400: 206d 6973 7369 6e67 207b 7d22 2e66 6f72   missing {}".for
-0000a410: 6d61 7428 6b65 7973 5f6d 6973 7369 6e67  mat(keys_missing
-0000a420: 5f66 726f 6d5f 6461 7461 290a 2020 2020  _from_data).    
-0000a430: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000a440: 2020 2020 2020 2069 6e64 6578 6573 2c20         indexes, 
-0000a450: 696e 6465 785f 7661 7273 203d 2073 656c  index_vars = sel
-0000a460: 662e 7869 6e64 6578 6573 2e63 6f70 795f  f.xindexes.copy_
-0000a470: 696e 6465 7865 7328 6465 6570 3d64 6565  indexes(deep=dee
-0000a480: 7029 0a0a 2020 2020 2020 2020 7661 7269  p)..        vari
-0000a490: 6162 6c65 7320 3d20 7b7d 0a20 2020 2020  ables = {}.     
-0000a4a0: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
-0000a4b0: 656c 662e 5f76 6172 6961 626c 6573 2e69  elf._variables.i
-0000a4c0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0000a4d0: 2020 2020 6966 206b 2069 6e20 696e 6465      if k in inde
-0000a4e0: 785f 7661 7273 3a0a 2020 2020 2020 2020  x_vars:.        
-0000a4f0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0000a500: 735b 6b5d 203d 2069 6e64 6578 5f76 6172  s[k] = index_var
-0000a510: 735b 6b5d 0a20 2020 2020 2020 2020 2020  s[k].           
-0000a520: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a530: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0000a540: 5b6b 5d20 3d20 762e 5f63 6f70 7928 6465  [k] = v._copy(de
-0000a550: 6570 3d64 6565 702c 2064 6174 613d 6461  ep=deep, data=da
-0000a560: 7461 2e67 6574 286b 292c 206d 656d 6f3d  ta.get(k), memo=
-0000a570: 6d65 6d6f 290a 0a20 2020 2020 2020 2061  memo)..        a
-0000a580: 7474 7273 203d 2063 6f70 792e 6465 6570  ttrs = copy.deep
-0000a590: 636f 7079 2873 656c 662e 5f61 7474 7273  copy(self._attrs
-0000a5a0: 2c20 6d65 6d6f 2920 6966 2064 6565 7020  , memo) if deep 
-0000a5b0: 656c 7365 2063 6f70 792e 636f 7079 2873  else copy.copy(s
-0000a5c0: 656c 662e 5f61 7474 7273 290a 2020 2020  elf._attrs).    
-0000a5d0: 2020 2020 656e 636f 6469 6e67 203d 2028      encoding = (
-0000a5e0: 0a20 2020 2020 2020 2020 2020 2063 6f70  .            cop
-0000a5f0: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-0000a600: 5f65 6e63 6f64 696e 672c 206d 656d 6f29  _encoding, memo)
-0000a610: 2069 6620 6465 6570 2065 6c73 6520 636f   if deep else co
-0000a620: 7079 2e63 6f70 7928 7365 6c66 2e5f 656e  py.copy(self._en
-0000a630: 636f 6469 6e67 290a 2020 2020 2020 2020  coding).        
-0000a640: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000a650: 6e20 7365 6c66 2e5f 7265 706c 6163 6528  n self._replace(
-0000a660: 7661 7269 6162 6c65 732c 2069 6e64 6578  variables, index
-0000a670: 6573 3d69 6e64 6578 6573 2c20 6174 7472  es=indexes, attr
-0000a680: 733d 6174 7472 732c 2065 6e63 6f64 696e  s=attrs, encodin
-0000a690: 673d 656e 636f 6469 6e67 290a 0a20 2020  g=encoding)..   
-0000a6a0: 2064 6566 205f 5f63 6f70 795f 5f28 7365   def __copy__(se
-0000a6b0: 6c66 3a20 545f 4461 7461 7365 7429 202d  lf: T_Dataset) -
-0000a6c0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-0000a6d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000a6e0: 2e5f 636f 7079 2864 6565 703d 4661 6c73  ._copy(deep=Fals
-0000a6f0: 6529 0a0a 2020 2020 6465 6620 5f5f 6465  e)..    def __de
-0000a700: 6570 636f 7079 5f5f 2873 656c 663a 2054  epcopy__(self: T
-0000a710: 5f44 6174 6173 6574 2c20 6d65 6d6f 3a20  _Dataset, memo: 
-0000a720: 6469 6374 5b69 6e74 2c20 416e 795d 207c  dict[int, Any] |
-0000a730: 204e 6f6e 6520 3d20 4e6f 6e65 2920 2d3e   None = None) ->
-0000a740: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-0000a750: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000a760: 5f63 6f70 7928 6465 6570 3d54 7275 652c  _copy(deep=True,
-0000a770: 206d 656d 6f3d 6d65 6d6f 290a 0a20 2020   memo=memo)..   
-0000a780: 2064 6566 2061 735f 6e75 6d70 7928 7365   def as_numpy(se
-0000a790: 6c66 3a20 545f 4461 7461 7365 7429 202d  lf: T_Dataset) -
-0000a7a0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-0000a7b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000a7c0: 2043 6f65 7263 6573 2077 7261 7070 6564   Coerces wrapped
-0000a7d0: 2064 6174 6120 616e 6420 636f 6f72 6469   data and coordi
-0000a7e0: 6e61 7465 7320 696e 746f 206e 756d 7079  nates into numpy
-0000a7f0: 2061 7272 6179 732c 2072 6574 7572 6e69   arrays, returni
-0000a800: 6e67 2061 2044 6174 6173 6574 2e0a 0a20  ng a Dataset... 
-0000a810: 2020 2020 2020 2053 6565 2061 6c73 6f0a         See also.
-0000a820: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0000a830: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-0000a840: 6179 2e61 735f 6e75 6d70 790a 2020 2020  ay.as_numpy.    
-0000a850: 2020 2020 4461 7461 4172 7261 792e 746f      DataArray.to
-0000a860: 5f6e 756d 7079 203a 2052 6574 7572 6e73  _numpy : Returns
-0000a870: 206f 6e6c 7920 7468 6520 6461 7461 2061   only the data a
-0000a880: 7320 6120 6e75 6d70 792e 6e64 6172 7261  s a numpy.ndarra
-0000a890: 7920 6f62 6a65 6374 2e0a 2020 2020 2020  y object..      
-0000a8a0: 2020 2222 220a 2020 2020 2020 2020 6e75    """.        nu
-0000a8b0: 6d70 795f 7661 7269 6162 6c65 7320 3d20  mpy_variables = 
-0000a8c0: 7b6b 3a20 762e 6173 5f6e 756d 7079 2829  {k: v.as_numpy()
-0000a8d0: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-0000a8e0: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
-0000a8f0: 7328 297d 0a20 2020 2020 2020 2072 6574  s()}.        ret
-0000a900: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
-0000a910: 6528 7661 7269 6162 6c65 733d 6e75 6d70  e(variables=nump
-0000a920: 795f 7661 7269 6162 6c65 7329 0a0a 2020  y_variables)..  
-0000a930: 2020 6465 6620 5f63 6f70 795f 6c69 7374    def _copy_list
-0000a940: 6564 2873 656c 663a 2054 5f44 6174 6173  ed(self: T_Datas
-0000a950: 6574 2c20 6e61 6d65 733a 2049 7465 7261  et, names: Itera
-0000a960: 626c 655b 4861 7368 6162 6c65 5d29 202d  ble[Hashable]) -
-0000a970: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-0000a980: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
-0000a990: 206e 6577 2044 6174 6173 6574 2077 6974   new Dataset wit
-0000a9a0: 6820 7468 6520 6c69 7374 6564 2076 6172  h the listed var
-0000a9b0: 6961 626c 6573 2066 726f 6d20 7468 6973  iables from this
-0000a9c0: 2064 6174 6173 6574 2061 6e64 0a20 2020   dataset and.   
-0000a9d0: 2020 2020 2074 6865 2061 6c6c 2072 656c       the all rel
-0000a9e0: 6576 616e 7420 636f 6f72 6469 6e61 7465  evant coordinate
-0000a9f0: 732e 2053 6b69 7073 2061 6c6c 2076 616c  s. Skips all val
-0000aa00: 6964 6174 696f 6e2e 0a20 2020 2020 2020  idation..       
-0000aa10: 2022 2222 0a20 2020 2020 2020 2076 6172   """.        var
-0000aa20: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
-0000aa30: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-0000aa40: 203d 207b 7d0a 2020 2020 2020 2020 636f   = {}.        co
-0000aa50: 6f72 645f 6e61 6d65 7320 3d20 7365 7428  ord_names = set(
-0000aa60: 290a 2020 2020 2020 2020 696e 6465 7865  ).        indexe
-0000aa70: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
-0000aa80: 2c20 496e 6465 785d 203d 207b 7d0a 0a20  , Index] = {}.. 
-0000aa90: 2020 2020 2020 2066 6f72 206e 616d 6520         for name 
-0000aaa0: 696e 206e 616d 6573 3a0a 2020 2020 2020  in names:.      
-0000aab0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000aac0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0000aad0: 626c 6573 5b6e 616d 655d 203d 2073 656c  bles[name] = sel
-0000aae0: 662e 5f76 6172 6961 626c 6573 5b6e 616d  f._variables[nam
-0000aaf0: 655d 0a20 2020 2020 2020 2020 2020 2065  e].            e
-0000ab00: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
-0000ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab20: 7265 665f 6e61 6d65 2c20 7661 725f 6e61  ref_name, var_na
-0000ab30: 6d65 2c20 7661 7220 3d20 5f67 6574 5f76  me, var = _get_v
-0000ab40: 6972 7475 616c 5f76 6172 6961 626c 6528  irtual_variable(
-0000ab50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ab60: 2020 2020 2073 656c 662e 5f76 6172 6961       self._varia
-0000ab70: 626c 6573 2c20 6e61 6d65 2c20 7365 6c66  bles, name, self
-0000ab80: 2e64 696d 730a 2020 2020 2020 2020 2020  .dims.          
-0000ab90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000aba0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0000abb0: 735b 7661 725f 6e61 6d65 5d20 3d20 7661  s[var_name] = va
-0000abc0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0000abd0: 2020 6966 2072 6566 5f6e 616d 6520 696e    if ref_name in
-0000abe0: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-0000abf0: 6573 206f 7220 7265 665f 6e61 6d65 2069  es or ref_name i
-0000ac00: 6e20 7365 6c66 2e64 696d 733a 0a20 2020  n self.dims:.   
-0000ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac20: 2063 6f6f 7264 5f6e 616d 6573 2e61 6464   coord_names.add
-0000ac30: 2876 6172 5f6e 616d 6529 0a20 2020 2020  (var_name).     
-0000ac40: 2020 2020 2020 2020 2020 2069 6620 2876             if (v
-0000ac50: 6172 5f6e 616d 652c 2920 3d3d 2076 6172  ar_name,) == var
-0000ac60: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
-0000ac70: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-0000ac80: 2c20 696e 6465 785f 7661 7273 203d 2063  , index_vars = c
-0000ac90: 7265 6174 655f 6465 6661 756c 745f 696e  reate_default_in
-0000aca0: 6465 785f 696d 706c 6963 6974 2876 6172  dex_implicit(var
-0000acb0: 2c20 6e61 6d65 7329 0a20 2020 2020 2020  , names).       
-0000acc0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-0000acd0: 6578 6573 2e75 7064 6174 6528 7b6b 3a20  exes.update({k: 
-0000ace0: 696e 6465 7820 666f 7220 6b20 696e 2069  index for k in i
-0000acf0: 6e64 6578 5f76 6172 737d 290a 2020 2020  ndex_vars}).    
-0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad10: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
-0000ad20: 2869 6e64 6578 5f76 6172 7329 0a20 2020  (index_vars).   
-0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad40: 2063 6f6f 7264 5f6e 616d 6573 2e75 7064   coord_names.upd
-0000ad50: 6174 6528 696e 6465 785f 7661 7273 290a  ate(index_vars).
-0000ad60: 0a20 2020 2020 2020 206e 6565 6465 645f  .        needed_
-0000ad70: 6469 6d73 3a20 4f72 6465 7265 6453 6574  dims: OrderedSet
-0000ad80: 5b48 6173 6861 626c 655d 203d 204f 7264  [Hashable] = Ord
-0000ad90: 6572 6564 5365 7428 290a 2020 2020 2020  eredSet().      
-0000ada0: 2020 666f 7220 7620 696e 2076 6172 6961    for v in varia
-0000adb0: 626c 6573 2e76 616c 7565 7328 293a 0a20  bles.values():. 
-0000adc0: 2020 2020 2020 2020 2020 206e 6565 6465             neede
-0000add0: 645f 6469 6d73 2e75 7064 6174 6528 762e  d_dims.update(v.
-0000ade0: 6469 6d73 290a 0a20 2020 2020 2020 2064  dims)..        d
-0000adf0: 696d 7320 3d20 7b6b 3a20 7365 6c66 2e64  ims = {k: self.d
-0000ae00: 696d 735b 6b5d 2066 6f72 206b 2069 6e20  ims[k] for k in 
-0000ae10: 6e65 6564 6564 5f64 696d 737d 0a0a 2020  needed_dims}..  
-0000ae20: 2020 2020 2020 2320 7072 6573 6572 7665        # preserve
-0000ae30: 7320 6f72 6465 7269 6e67 206f 6620 636f  s ordering of co
-0000ae40: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
-0000ae50: 2020 666f 7220 6b20 696e 2073 656c 662e    for k in self.
-0000ae60: 5f76 6172 6961 626c 6573 3a0a 2020 2020  _variables:.    
-0000ae70: 2020 2020 2020 2020 6966 206b 206e 6f74          if k not
-0000ae80: 2069 6e20 7365 6c66 2e5f 636f 6f72 645f   in self._coord_
-0000ae90: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
-0000aea0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0000aeb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000aec0: 7365 7428 7365 6c66 2e76 6172 6961 626c  set(self.variabl
-0000aed0: 6573 5b6b 5d2e 6469 6d73 2920 3c3d 206e  es[k].dims) <= n
-0000aee0: 6565 6465 645f 6469 6d73 3a0a 2020 2020  eeded_dims:.    
-0000aef0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-0000af00: 6162 6c65 735b 6b5d 203d 2073 656c 662e  ables[k] = self.
-0000af10: 5f76 6172 6961 626c 6573 5b6b 5d0a 2020  _variables[k].  
-0000af20: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000af30: 6f72 645f 6e61 6d65 732e 6164 6428 6b29  ord_names.add(k)
-0000af40: 0a0a 2020 2020 2020 2020 696e 6465 7865  ..        indexe
-0000af50: 732e 7570 6461 7465 2866 696c 7465 725f  s.update(filter_
-0000af60: 696e 6465 7865 735f 6672 6f6d 5f63 6f6f  indexes_from_coo
-0000af70: 7264 7328 7365 6c66 2e5f 696e 6465 7865  rds(self._indexe
-0000af80: 732c 2063 6f6f 7264 5f6e 616d 6573 2929  s, coord_names))
-0000af90: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000afa0: 2073 656c 662e 5f72 6570 6c61 6365 2876   self._replace(v
-0000afb0: 6172 6961 626c 6573 2c20 636f 6f72 645f  ariables, coord_
-0000afc0: 6e61 6d65 732c 2064 696d 732c 2069 6e64  names, dims, ind
-0000afd0: 6578 6573 3d69 6e64 6578 6573 290a 0a20  exes=indexes).. 
-0000afe0: 2020 2064 6566 205f 636f 6e73 7472 7563     def _construc
-0000aff0: 745f 6461 7461 6172 7261 7928 7365 6c66  t_dataarray(self
-0000b000: 2c20 6e61 6d65 3a20 4861 7368 6162 6c65  , name: Hashable
-0000b010: 2920 2d3e 2044 6174 6141 7272 6179 3a0a  ) -> DataArray:.
-0000b020: 2020 2020 2020 2020 2222 2243 6f6e 7374          """Const
-0000b030: 7275 6374 2061 2044 6174 6141 7272 6179  ruct a DataArray
-0000b040: 2062 7920 696e 6465 7869 6e67 2074 6869   by indexing thi
-0000b050: 7320 6461 7461 7365 7422 2222 0a20 2020  s dataset""".   
-0000b060: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
-0000b070: 2e63 6f72 652e 6461 7461 6172 7261 7920  .core.dataarray 
-0000b080: 696d 706f 7274 2044 6174 6141 7272 6179  import DataArray
-0000b090: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-0000b0a0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0000b0b0: 626c 6520 3d20 7365 6c66 2e5f 7661 7269  ble = self._vari
-0000b0c0: 6162 6c65 735b 6e61 6d65 5d0a 2020 2020  ables[name].    
-0000b0d0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-0000b0e0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0000b0f0: 205f 2c20 6e61 6d65 2c20 7661 7269 6162   _, name, variab
-0000b100: 6c65 203d 205f 6765 745f 7669 7274 7561  le = _get_virtua
-0000b110: 6c5f 7661 7269 6162 6c65 2873 656c 662e  l_variable(self.
-0000b120: 5f76 6172 6961 626c 6573 2c20 6e61 6d65  _variables, name
-0000b130: 2c20 7365 6c66 2e64 696d 7329 0a0a 2020  , self.dims)..  
-0000b140: 2020 2020 2020 6e65 6564 6564 5f64 696d        needed_dim
-0000b150: 7320 3d20 7365 7428 7661 7269 6162 6c65  s = set(variable
-0000b160: 2e64 696d 7329 0a0a 2020 2020 2020 2020  .dims)..        
-0000b170: 636f 6f72 6473 3a20 6469 6374 5b48 6173  coords: dict[Has
-0000b180: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-0000b190: 203d 207b 7d0a 2020 2020 2020 2020 2320   = {}.        # 
-0000b1a0: 7072 6573 6572 7665 206f 7264 6572 696e  preserve orderin
-0000b1b0: 670a 2020 2020 2020 2020 666f 7220 6b20  g.        for k 
-0000b1c0: 696e 2073 656c 662e 5f76 6172 6961 626c  in self._variabl
-0000b1d0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000b1e0: 6966 206b 2069 6e20 7365 6c66 2e5f 636f  if k in self._co
-0000b1f0: 6f72 645f 6e61 6d65 7320 616e 6420 7365  ord_names and se
-0000b200: 7428 7365 6c66 2e76 6172 6961 626c 6573  t(self.variables
-0000b210: 5b6b 5d2e 6469 6d73 2920 3c3d 206e 6565  [k].dims) <= nee
-0000b220: 6465 645f 6469 6d73 3a0a 2020 2020 2020  ded_dims:.      
-0000b230: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
-0000b240: 5b6b 5d20 3d20 7365 6c66 2e76 6172 6961  [k] = self.varia
-0000b250: 626c 6573 5b6b 5d0a 0a20 2020 2020 2020  bles[k]..       
-0000b260: 2069 6e64 6578 6573 203d 2066 696c 7465   indexes = filte
-0000b270: 725f 696e 6465 7865 735f 6672 6f6d 5f63  r_indexes_from_c
-0000b280: 6f6f 7264 7328 7365 6c66 2e5f 696e 6465  oords(self._inde
-0000b290: 7865 732c 2073 6574 2863 6f6f 7264 7329  xes, set(coords)
-0000b2a0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000b2b0: 6e20 4461 7461 4172 7261 7928 7661 7269  n DataArray(vari
-0000b2c0: 6162 6c65 2c20 636f 6f72 6473 2c20 6e61  able, coords, na
-0000b2d0: 6d65 3d6e 616d 652c 2069 6e64 6578 6573  me=name, indexes
-0000b2e0: 3d69 6e64 6578 6573 2c20 6661 7374 7061  =indexes, fastpa
-0000b2f0: 7468 3d54 7275 6529 0a0a 2020 2020 4070  th=True)..    @p
-0000b300: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0000b310: 5f61 7474 725f 736f 7572 6365 7328 7365  _attr_sources(se
-0000b320: 6c66 2920 2d3e 2049 7465 7261 626c 655b  lf) -> Iterable[
-0000b330: 4d61 7070 696e 675b 4861 7368 6162 6c65  Mapping[Hashable
-0000b340: 2c20 416e 795d 5d3a 0a20 2020 2020 2020  , Any]]:.       
-0000b350: 2022 2222 506c 6163 6573 2074 6f20 6c6f   """Places to lo
-0000b360: 6f6b 2d75 7020 6974 656d 7320 666f 7220  ok-up items for 
-0000b370: 6174 7472 6962 7574 652d 7374 796c 6520  attribute-style 
-0000b380: 6163 6365 7373 2222 220a 2020 2020 2020  access""".      
-0000b390: 2020 7969 656c 6420 6672 6f6d 2073 656c    yield from sel
-0000b3a0: 662e 5f69 7465 6d5f 736f 7572 6365 730a  f._item_sources.
-0000b3b0: 2020 2020 2020 2020 7969 656c 6420 7365          yield se
-0000b3c0: 6c66 2e61 7474 7273 0a0a 2020 2020 4070  lf.attrs..    @p
-0000b3d0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0000b3e0: 5f69 7465 6d5f 736f 7572 6365 7328 7365  _item_sources(se
-0000b3f0: 6c66 2920 2d3e 2049 7465 7261 626c 655b  lf) -> Iterable[
-0000b400: 4d61 7070 696e 675b 4861 7368 6162 6c65  Mapping[Hashable
-0000b410: 2c20 416e 795d 5d3a 0a20 2020 2020 2020  , Any]]:.       
-0000b420: 2022 2222 506c 6163 6573 2074 6f20 6c6f   """Places to lo
-0000b430: 6f6b 2d75 7020 6974 656d 7320 666f 7220  ok-up items for 
-0000b440: 6b65 792d 636f 6d70 6c65 7469 6f6e 2222  key-completion""
-0000b450: 220a 2020 2020 2020 2020 7969 656c 6420  ".        yield 
-0000b460: 7365 6c66 2e64 6174 615f 7661 7273 0a20  self.data_vars. 
-0000b470: 2020 2020 2020 2079 6965 6c64 2048 7962         yield Hyb
-0000b480: 7269 644d 6170 7069 6e67 5072 6f78 7928  ridMappingProxy(
-0000b490: 6b65 7973 3d73 656c 662e 5f63 6f6f 7264  keys=self._coord
-0000b4a0: 5f6e 616d 6573 2c20 6d61 7070 696e 673d  _names, mapping=
-0000b4b0: 7365 6c66 2e63 6f6f 7264 7329 0a0a 2020  self.coords)..  
-0000b4c0: 2020 2020 2020 2320 7669 7274 7561 6c20        # virtual 
-0000b4d0: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
-0000b4e0: 2020 2020 7969 656c 6420 4879 6272 6964      yield Hybrid
-0000b4f0: 4d61 7070 696e 6750 726f 7879 286b 6579  MappingProxy(key
-0000b500: 733d 7365 6c66 2e64 696d 732c 206d 6170  s=self.dims, map
-0000b510: 7069 6e67 3d73 656c 6629 0a0a 2020 2020  ping=self)..    
-0000b520: 6465 6620 5f5f 636f 6e74 6169 6e73 5f5f  def __contains__
-0000b530: 2873 656c 662c 206b 6579 3a20 6f62 6a65  (self, key: obje
-0000b540: 6374 2920 2d3e 2062 6f6f 6c3a 0a20 2020  ct) -> bool:.   
-0000b550: 2020 2020 2022 2222 5468 6520 2769 6e27       """The 'in'
-0000b560: 206f 7065 7261 746f 7220 7769 6c6c 2072   operator will r
-0000b570: 6574 7572 6e20 7472 7565 206f 7220 6661  eturn true or fa
-0000b580: 6c73 6520 6465 7065 6e64 696e 6720 6f6e  lse depending on
-0000b590: 2077 6865 7468 6572 0a20 2020 2020 2020   whether.       
-0000b5a0: 2027 6b65 7927 2069 7320 616e 2061 7272   'key' is an arr
-0000b5b0: 6179 2069 6e20 7468 6520 6461 7461 7365  ay in the datase
-0000b5c0: 7420 6f72 206e 6f74 2e0a 2020 2020 2020  t or not..      
-0000b5d0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-0000b5e0: 7475 726e 206b 6579 2069 6e20 7365 6c66  turn key in self
-0000b5f0: 2e5f 7661 7269 6162 6c65 730a 0a20 2020  ._variables..   
-0000b600: 2064 6566 205f 5f6c 656e 5f5f 2873 656c   def __len__(sel
-0000b610: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-0000b620: 2020 2072 6574 7572 6e20 6c65 6e28 7365     return len(se
-0000b630: 6c66 2e64 6174 615f 7661 7273 290a 0a20  lf.data_vars).. 
-0000b640: 2020 2064 6566 205f 5f62 6f6f 6c5f 5f28     def __bool__(
-0000b650: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
-0000b660: 2020 2020 2020 2072 6574 7572 6e20 626f         return bo
-0000b670: 6f6c 2873 656c 662e 6461 7461 5f76 6172  ol(self.data_var
-0000b680: 7329 0a0a 2020 2020 6465 6620 5f5f 6974  s)..    def __it
-0000b690: 6572 5f5f 2873 656c 6629 202d 3e20 4974  er__(self) -> It
-0000b6a0: 6572 6174 6f72 5b48 6173 6861 626c 655d  erator[Hashable]
-0000b6b0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000b6c0: 2069 7465 7228 7365 6c66 2e64 6174 615f   iter(self.data_
-0000b6d0: 7661 7273 290a 0a20 2020 2064 6566 205f  vars)..    def _
-0000b6e0: 5f61 7272 6179 5f5f 2873 656c 662c 2064  _array__(self, d
-0000b6f0: 7479 7065 3d4e 6f6e 6529 3a0a 2020 2020  type=None):.    
-0000b700: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-0000b710: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0000b720: 2022 6361 6e6e 6f74 2064 6972 6563 746c   "cannot directl
-0000b730: 7920 636f 6e76 6572 7420 616e 2078 6172  y convert an xar
-0000b740: 7261 792e 4461 7461 7365 7420 696e 746f  ray.Dataset into
-0000b750: 2061 2022 0a20 2020 2020 2020 2020 2020   a ".           
-0000b760: 2022 6e75 6d70 7920 6172 7261 792e 2049   "numpy array. I
-0000b770: 6e73 7465 6164 2c20 6372 6561 7465 2061  nstead, create a
-0000b780: 6e20 7861 7272 6179 2e44 6174 6141 7272  n xarray.DataArr
-0000b790: 6179 2022 0a20 2020 2020 2020 2020 2020  ay ".           
-0000b7a0: 2022 6669 7273 742c 2065 6974 6865 7220   "first, either 
-0000b7b0: 7769 7468 2069 6e64 6578 696e 6720 6f6e  with indexing on
-0000b7c0: 2074 6865 2044 6174 6173 6574 206f 7220   the Dataset or 
-0000b7d0: 6279 2022 0a20 2020 2020 2020 2020 2020  by ".           
-0000b7e0: 2022 696e 766f 6b69 6e67 2074 6865 2060   "invoking the `
-0000b7f0: 746f 5f61 7272 6179 2829 6020 6d65 7468  to_array()` meth
-0000b800: 6f64 2e22 0a20 2020 2020 2020 2029 0a0a  od.".        )..
-0000b810: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-0000b820: 2020 6465 6620 6e62 7974 6573 2873 656c    def nbytes(sel
-0000b830: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-0000b840: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-0000b850: 6f74 616c 2062 7974 6573 2063 6f6e 7375  otal bytes consu
-0000b860: 6d65 6420 6279 2074 6865 2064 6174 6120  med by the data 
-0000b870: 6172 7261 7973 206f 6620 616c 6c20 7661  arrays of all va
-0000b880: 7269 6162 6c65 7320 696e 2074 6869 7320  riables in this 
-0000b890: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
-0000b8a0: 2020 4966 2074 6865 2062 6163 6b65 6e64    If the backend
-0000b8b0: 2061 7272 6179 2066 6f72 2061 6e79 2076   array for any v
-0000b8c0: 6172 6961 626c 6520 646f 6573 206e 6f74  ariable does not
-0000b8d0: 2069 6e63 6c75 6465 2060 606e 6279 7465   include ``nbyte
-0000b8e0: 7360 602c 2065 7374 696d 6174 6573 0a20  s``, estimates. 
-0000b8f0: 2020 2020 2020 2074 6865 2074 6f74 616c         the total
-0000b900: 2062 7974 6573 2066 6f72 2074 6861 7420   bytes for that 
-0000b910: 6172 7261 7920 6261 7365 6420 6f6e 2074  array based on t
-0000b920: 6865 2060 6073 697a 6560 6020 616e 6420  he ``size`` and 
-0000b930: 6060 6474 7970 6560 602e 0a20 2020 2020  ``dtype``..     
-0000b940: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0000b950: 6574 7572 6e20 7375 6d28 762e 6e62 7974  eturn sum(v.nbyt
-0000b960: 6573 2066 6f72 2076 2069 6e20 7365 6c66  es for v in self
-0000b970: 2e76 6172 6961 626c 6573 2e76 616c 7565  .variables.value
-0000b980: 7328 2929 0a0a 2020 2020 4070 726f 7065  s())..    @prope
-0000b990: 7274 790a 2020 2020 6465 6620 6c6f 6328  rty.    def loc(
-0000b9a0: 7365 6c66 3a20 545f 4461 7461 7365 7429  self: T_Dataset)
-0000b9b0: 202d 3e20 5f4c 6f63 496e 6465 7865 725b   -> _LocIndexer[
-0000b9c0: 545f 4461 7461 7365 745d 3a0a 2020 2020  T_Dataset]:.    
-0000b9d0: 2020 2020 2222 2241 7474 7269 6275 7465      """Attribute
-0000b9e0: 2066 6f72 206c 6f63 6174 696f 6e20 6261   for location ba
-0000b9f0: 7365 6420 696e 6465 7869 6e67 2e20 4f6e  sed indexing. On
-0000ba00: 6c79 2073 7570 706f 7274 7320 5f5f 6765  ly supports __ge
-0000ba10: 7469 7465 6d5f 5f2c 0a20 2020 2020 2020  titem__,.       
-0000ba20: 2061 6e64 206f 6e6c 7920 7768 656e 2074   and only when t
-0000ba30: 6865 206b 6579 2069 7320 6120 6469 6374  he key is a dict
-0000ba40: 206f 6620 7468 6520 666f 726d 207b 6469   of the form {di
-0000ba50: 6d3a 206c 6162 656c 737d 2e0a 2020 2020  m: labels}..    
-0000ba60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ba70: 7265 7475 726e 205f 4c6f 6349 6e64 6578  return _LocIndex
-0000ba80: 6572 2873 656c 6629 0a0a 2020 2020 406f  er(self)..    @o
-0000ba90: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
-0000baa0: 5f5f 6765 7469 7465 6d5f 5f28 7365 6c66  __getitem__(self
-0000bab0: 2c20 6b65 793a 2048 6173 6861 626c 6529  , key: Hashable)
-0000bac0: 202d 3e20 4461 7461 4172 7261 793a 0a20   -> DataArray:. 
-0000bad0: 2020 2020 2020 202e 2e2e 0a0a 2020 2020         .....    
-0000bae0: 2320 4d61 7070 696e 6720 6973 2049 7465  # Mapping is Ite
-0000baf0: 7261 626c 650a 2020 2020 406f 7665 726c  rable.    @overl
-0000bb00: 6f61 640a 2020 2020 6465 6620 5f5f 6765  oad.    def __ge
-0000bb10: 7469 7465 6d5f 5f28 7365 6c66 3a20 545f  titem__(self: T_
-0000bb20: 4461 7461 7365 742c 206b 6579 3a20 4974  Dataset, key: It
-0000bb30: 6572 6162 6c65 5b48 6173 6861 626c 655d  erable[Hashable]
-0000bb40: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-0000bb50: 2020 2020 2020 2020 2e2e 2e0a 0a20 2020          .....   
-0000bb60: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
-0000bb70: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
-0000bb80: 545f 4461 7461 7365 742c 206b 6579 3a20  T_Dataset, key: 
-0000bb90: 4d61 7070 696e 675b 416e 792c 2041 6e79  Mapping[Any, Any
-0000bba0: 5d20 7c20 4861 7368 6162 6c65 207c 2049  ] | Hashable | I
-0000bbb0: 7465 7261 626c 655b 4861 7368 6162 6c65  terable[Hashable
-0000bbc0: 5d0a 2020 2020 2920 2d3e 2054 5f44 6174  ].    ) -> T_Dat
-0000bbd0: 6173 6574 207c 2044 6174 6141 7272 6179  aset | DataArray
-0000bbe0: 3a0a 2020 2020 2020 2020 2222 2241 6363  :.        """Acc
-0000bbf0: 6573 7320 7661 7269 6162 6c65 7320 6f72  ess variables or
-0000bc00: 2063 6f6f 7264 696e 6174 6573 206f 6620   coordinates of 
-0000bc10: 7468 6973 2064 6174 6173 6574 2061 7320  this dataset as 
-0000bc20: 610a 2020 2020 2020 2020 3a70 793a 636c  a.        :py:cl
-0000bc30: 6173 733a 607e 7861 7272 6179 2e44 6174  ass:`~xarray.Dat
-0000bc40: 6141 7272 6179 6020 6f72 2061 2073 7562  aArray` or a sub
-0000bc50: 7365 7420 6f66 2076 6172 6961 626c 6573  set of variables
-0000bc60: 206f 7220 6120 696e 6465 7865 6420 6461   or a indexed da
-0000bc70: 7461 7365 742e 0a0a 2020 2020 2020 2020  taset...        
-0000bc80: 496e 6465 7869 6e67 2077 6974 6820 6120  Indexing with a 
-0000bc90: 6c69 7374 206f 6620 6e61 6d65 7320 7769  list of names wi
-0000bca0: 6c6c 2072 6574 7572 6e20 6120 6e65 7720  ll return a new 
-0000bcb0: 6060 4461 7461 7365 7460 6020 6f62 6a65  ``Dataset`` obje
-0000bcc0: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
-0000bcd0: 2020 2020 2020 2020 6966 2075 7469 6c73          if utils
-0000bce0: 2e69 735f 6469 6374 5f6c 696b 6528 6b65  .is_dict_like(ke
-0000bcf0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
-0000bd00: 7265 7475 726e 2073 656c 662e 6973 656c  return self.isel
-0000bd10: 282a 2a6b 6579 290a 2020 2020 2020 2020  (**key).        
-0000bd20: 6966 2075 7469 6c73 2e68 6173 6861 626c  if utils.hashabl
-0000bd30: 6528 6b65 7929 3a0a 2020 2020 2020 2020  e(key):.        
-0000bd40: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000bd50: 5f63 6f6e 7374 7275 6374 5f64 6174 6161  _construct_dataa
-0000bd60: 7272 6179 286b 6579 290a 2020 2020 2020  rray(key).      
-0000bd70: 2020 6966 2075 7469 6c73 2e69 7465 7261    if utils.itera
-0000bd80: 626c 655f 6f66 5f68 6173 6861 626c 6528  ble_of_hashable(
-0000bd90: 6b65 7929 3a0a 2020 2020 2020 2020 2020  key):.          
-0000bda0: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
-0000bdb0: 6f70 795f 6c69 7374 6564 286b 6579 290a  opy_listed(key).
-0000bdc0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000bdd0: 6c75 6545 7272 6f72 2866 2255 6e73 7570  lueError(f"Unsup
-0000bde0: 706f 7274 6564 206b 6579 2d74 7970 6520  ported key-type 
-0000bdf0: 7b74 7970 6528 6b65 7929 7d22 290a 0a20  {type(key)}").. 
-0000be00: 2020 2064 6566 205f 5f73 6574 6974 656d     def __setitem
-0000be10: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
-0000be20: 2c20 6b65 793a 2048 6173 6861 626c 6520  , key: Hashable 
-0000be30: 7c20 4974 6572 6162 6c65 5b48 6173 6861  | Iterable[Hasha
-0000be40: 626c 655d 207c 204d 6170 7069 6e67 2c20  ble] | Mapping, 
-0000be50: 7661 6c75 653a 2041 6e79 0a20 2020 2029  value: Any.    )
-0000be60: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000be70: 2020 2222 2241 6464 2061 6e20 6172 7261    """Add an arra
-0000be80: 7920 746f 2074 6869 7320 6461 7461 7365  y to this datase
-0000be90: 742e 0a20 2020 2020 2020 204d 756c 7469  t..        Multi
-0000bea0: 706c 6520 6172 7261 7973 2063 616e 2062  ple arrays can b
-0000beb0: 6520 6164 6465 6420 6174 2074 6865 2073  e added at the s
-0000bec0: 616d 6520 7469 6d65 2c20 696e 2077 6869  ame time, in whi
-0000bed0: 6368 2063 6173 6520 6561 6368 206f 660a  ch case each of.
-0000bee0: 2020 2020 2020 2020 7468 6520 666f 6c6c          the foll
-0000bef0: 6f77 696e 6720 6f70 6572 6174 696f 6e73  owing operations
-0000bf00: 2069 7320 6170 706c 6965 6420 746f 2074   is applied to t
-0000bf10: 6865 2072 6573 7065 6374 6976 6520 7661  he respective va
-0000bf20: 6c75 652e 0a0a 2020 2020 2020 2020 4966  lue...        If
-0000bf30: 206b 6579 2069 7320 6469 6374 2d6c 696b   key is dict-lik
-0000bf40: 652c 2075 7064 6174 6520 616c 6c20 7661  e, update all va
-0000bf50: 7269 6162 6c65 7320 696e 2074 6865 2064  riables in the d
-0000bf60: 6174 6173 6574 0a20 2020 2020 2020 206f  ataset.        o
-0000bf70: 6e65 2062 7920 6f6e 6520 7769 7468 2074  ne by one with t
-0000bf80: 6865 2067 6976 656e 2076 616c 7565 2061  he given value a
-0000bf90: 7420 7468 6520 6769 7665 6e20 6c6f 6361  t the given loca
-0000bfa0: 7469 6f6e 2e0a 2020 2020 2020 2020 4966  tion..        If
-0000bfb0: 2074 6865 2067 6976 656e 2076 616c 7565   the given value
-0000bfc0: 2069 7320 616c 736f 2061 2064 6174 6173   is also a datas
-0000bfd0: 6574 2c20 7365 6c65 6374 2063 6f72 7265  et, select corre
-0000bfe0: 7370 6f6e 6469 6e67 2076 6172 6961 626c  sponding variabl
-0000bff0: 6573 0a20 2020 2020 2020 2069 6e20 7468  es.        in th
-0000c000: 6520 6769 7665 6e20 7661 6c75 6520 616e  e given value an
-0000c010: 6420 696e 2074 6865 2064 6174 6173 6574  d in the dataset
-0000c020: 2074 6f20 6265 2063 6861 6e67 6564 2e0a   to be changed..
-0000c030: 0a20 2020 2020 2020 2049 6620 7661 6c75  .        If valu
-0000c040: 6520 6973 2061 2060 0a20 2020 2020 2020  e is a `.       
-0000c050: 2066 726f 6d20 2e64 6174 6161 7272 6179   from .dataarray
-0000c060: 2069 6d70 6f72 7420 4461 7461 4172 7261   import DataArra
-0000c070: 7960 2c20 6361 6c6c 2069 7473 2060 7365  y`, call its `se
-0000c080: 6c65 6374 5f76 6172 7328 2960 206d 6574  lect_vars()` met
-0000c090: 686f 642c 2072 656e 616d 6520 6974 0a20  hod, rename it. 
-0000c0a0: 2020 2020 2020 2074 6f20 606b 6579 6020         to `key` 
-0000c0b0: 616e 6420 6d65 7267 6520 7468 6520 636f  and merge the co
-0000c0c0: 6e74 656e 7473 206f 6620 7468 6520 7265  ntents of the re
-0000c0d0: 7375 6c74 696e 6720 6461 7461 7365 7420  sulting dataset 
-0000c0e0: 696e 746f 2074 6869 730a 2020 2020 2020  into this.      
-0000c0f0: 2020 6461 7461 7365 742e 0a0a 2020 2020    dataset...    
-0000c100: 2020 2020 4966 2076 616c 7565 2069 7320      If value is 
-0000c110: 6120 6056 6172 6961 626c 6560 206f 626a  a `Variable` obj
-0000c120: 6563 7420 286f 7220 7475 706c 6520 6f66  ect (or tuple of
-0000c130: 2066 6f72 6d0a 2020 2020 2020 2020 6060   form.        ``
-0000c140: 2864 696d 732c 2064 6174 615b 2c20 6174  (dims, data[, at
-0000c150: 7472 735d 2960 6029 2c20 6164 6420 6974  trs])``), add it
-0000c160: 2074 6f20 7468 6973 2064 6174 6173 6574   to this dataset
-0000c170: 2061 7320 6120 6e65 770a 2020 2020 2020   as a new.      
-0000c180: 2020 7661 7269 6162 6c65 2e0a 2020 2020    variable..    
-0000c190: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000c1a0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-0000c1b0: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
-0000c1c0: 7420 4461 7461 4172 7261 790a 0a20 2020  t DataArray..   
-0000c1d0: 2020 2020 2069 6620 7574 696c 732e 6973       if utils.is
-0000c1e0: 5f64 6963 745f 6c69 6b65 286b 6579 293a  _dict_like(key):
-0000c1f0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0000c200: 6865 636b 2066 6f72 2063 6f6e 7369 7374  heck for consist
-0000c210: 656e 6379 2061 6e64 2063 6f6e 7665 7274  ency and convert
-0000c220: 2076 616c 7565 2074 6f20 6461 7461 7365   value to datase
-0000c230: 740a 2020 2020 2020 2020 2020 2020 7661  t.            va
-0000c240: 6c75 6520 3d20 7365 6c66 2e5f 7365 7469  lue = self._seti
-0000c250: 7465 6d5f 6368 6563 6b28 6b65 792c 2076  tem_check(key, v
-0000c260: 616c 7565 290a 2020 2020 2020 2020 2020  alue).          
-0000c270: 2020 2320 6c6f 6f70 206f 7665 7220 6461    # loop over da
-0000c280: 7461 7365 7420 7661 7269 6162 6c65 7320  taset variables 
-0000c290: 616e 6420 7365 7420 6e65 7720 7661 6c75  and set new valu
-0000c2a0: 6573 0a20 2020 2020 2020 2020 2020 2070  es.            p
-0000c2b0: 726f 6365 7373 6564 203d 205b 5d0a 2020  rocessed = [].  
-0000c2c0: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
-0000c2d0: 6d65 2c20 7661 7220 696e 2073 656c 662e  me, var in self.
-0000c2e0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0000c2f0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c310: 2020 7661 725b 6b65 795d 203d 2076 616c    var[key] = val
-0000c320: 7565 5b6e 616d 655d 0a20 2020 2020 2020  ue[name].       
-0000c330: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0000c340: 6365 7373 6564 2e61 7070 656e 6428 6e61  cessed.append(na
-0000c350: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000c360: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0000c370: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-0000c380: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c390: 6620 7072 6f63 6573 7365 643a 0a20 2020  f processed:.   
-0000c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3b0: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-0000c3c0: 6d65 4572 726f 7228 0a20 2020 2020 2020  meError(.       
-0000c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3e0: 2020 2020 2022 416e 2065 7272 6f72 206f       "An error o
-0000c3f0: 6363 7572 7265 6420 7768 696c 6520 7365  ccurred while se
-0000c400: 7474 696e 6720 7661 6c75 6573 206f 6620  tting values of 
-0000c410: 7468 6522 0a20 2020 2020 2020 2020 2020  the".           
-0000c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c430: 2066 2220 7661 7269 6162 6c65 2027 7b6e   f" variable '{n
-0000c440: 616d 657d 272e 2054 6865 2066 6f6c 6c6f  ame}'. The follo
-0000c450: 7769 6e67 2076 6172 6961 626c 6573 2068  wing variables h
-0000c460: 6176 6522 0a20 2020 2020 2020 2020 2020  ave".           
-0000c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c480: 2066 2220 6265 656e 2073 7563 6365 7373   f" been success
-0000c490: 6675 6c6c 7920 7570 6461 7465 643a 5c6e  fully updated:\n
-0000c4a0: 7b70 726f 6365 7373 6564 7d22 0a20 2020  {processed}".   
-0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4c0: 2020 2020 2029 2066 726f 6d20 650a 2020       ) from e.  
-0000c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c500: 7261 6973 6520 650a 0a20 2020 2020 2020  raise e..       
-0000c510: 2065 6c69 6620 7574 696c 732e 6861 7368   elif utils.hash
-0000c520: 6162 6c65 286b 6579 293a 0a20 2020 2020  able(key):.     
-0000c530: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000c540: 616e 6365 2876 616c 7565 2c20 4461 7461  ance(value, Data
-0000c550: 7365 7429 3a0a 2020 2020 2020 2020 2020  set):.          
-0000c560: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-0000c570: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000c580: 2020 2020 2020 2020 2020 2022 4361 6e6e             "Cann
-0000c590: 6f74 2061 7373 6967 6e20 6120 4461 7461  ot assign a Data
-0000c5a0: 7365 7420 746f 2061 2073 696e 676c 6520  set to a single 
-0000c5b0: 6b65 7920 2d20 6f6e 6c79 2061 2044 6174  key - only a Dat
-0000c5c0: 6141 7272 6179 206f 7220 5661 7269 6162  aArray or Variab
-0000c5d0: 6c65 2022 0a20 2020 2020 2020 2020 2020  le ".           
-0000c5e0: 2020 2020 2020 2020 2022 6f62 6a65 6374           "object
-0000c5f0: 2063 616e 2062 6520 7374 6f72 6564 2075   can be stored u
-0000c600: 6e64 6572 2061 2073 696e 676c 6520 6b65  nder a single ke
-0000c610: 792e 220a 2020 2020 2020 2020 2020 2020  y.".            
-0000c620: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000c630: 2020 7365 6c66 2e75 7064 6174 6528 7b6b    self.update({k
-0000c640: 6579 3a20 7661 6c75 657d 290a 0a20 2020  ey: value})..   
-0000c650: 2020 2020 2065 6c69 6620 7574 696c 732e       elif utils.
-0000c660: 6974 6572 6162 6c65 5f6f 665f 6861 7368  iterable_of_hash
-0000c670: 6162 6c65 286b 6579 293a 0a20 2020 2020  able(key):.     
-0000c680: 2020 2020 2020 206b 6579 6c69 7374 203d         keylist =
-0000c690: 206c 6973 7428 6b65 7929 0a20 2020 2020   list(key).     
-0000c6a0: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
-0000c6b0: 796c 6973 7429 203d 3d20 303a 0a20 2020  ylist) == 0:.   
-0000c6c0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000c6d0: 7365 2056 616c 7565 4572 726f 7228 2245  se ValueError("E
-0000c6e0: 6d70 7479 206c 6973 7420 6f66 2076 6172  mpty list of var
-0000c6f0: 6961 626c 6573 2074 6f20 6265 2073 6574  iables to be set
-0000c700: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-0000c710: 6620 6c65 6e28 6b65 796c 6973 7429 203d  f len(keylist) =
-0000c720: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0000c730: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-0000c740: 287b 6b65 796c 6973 745b 305d 3a20 7661  ({keylist[0]: va
-0000c750: 6c75 657d 290a 2020 2020 2020 2020 2020  lue}).          
-0000c760: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c770: 2020 2020 2020 2020 6966 206c 656e 286b          if len(k
-0000c780: 6579 6c69 7374 2920 213d 206c 656e 2876  eylist) != len(v
-0000c790: 616c 7565 293a 0a20 2020 2020 2020 2020  alue):.         
-0000c7a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000c7b0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0000c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7d0: 2020 2020 2066 2244 6966 6665 7265 6e74       f"Different
-0000c7e0: 206c 656e 6774 6873 206f 6620 7661 7269   lengths of vari
-0000c7f0: 6162 6c65 7320 746f 2062 6520 7365 7420  ables to be set 
+00000540: 792e 636f 7265 2e64 6173 6b6d 616e 6167  y.core.daskmanag
+00000550: 6572 2069 6d70 6f72 7420 4461 736b 4d61  er import DaskMa
+00000560: 6e61 6765 720a 6672 6f6d 2078 6172 7261  nager.from xarra
+00000570: 792e 636f 7265 2e64 7563 6b5f 6172 7261  y.core.duck_arra
+00000580: 795f 6f70 7320 696d 706f 7274 2064 6174  y_ops import dat
+00000590: 6574 696d 655f 746f 5f6e 756d 6572 6963  etime_to_numeric
+000005a0: 0a66 726f 6d20 7861 7272 6179 2e63 6f72  .from xarray.cor
+000005b0: 652e 696e 6465 7865 7320 696d 706f 7274  e.indexes import
+000005c0: 2028 0a20 2020 2049 6e64 6578 2c0a 2020   (.    Index,.  
+000005d0: 2020 496e 6465 7865 732c 0a20 2020 2050    Indexes,.    P
+000005e0: 616e 6461 7349 6e64 6578 2c0a 2020 2020  andasIndex,.    
+000005f0: 5061 6e64 6173 4d75 6c74 6949 6e64 6578  PandasMultiIndex
+00000600: 2c0a 2020 2020 6173 7365 7274 5f6e 6f5f  ,.    assert_no_
+00000610: 696e 6465 785f 636f 7272 7570 7465 642c  index_corrupted,
+00000620: 0a20 2020 2063 7265 6174 655f 6465 6661  .    create_defa
+00000630: 756c 745f 696e 6465 785f 696d 706c 6963  ult_index_implic
+00000640: 6974 2c0a 2020 2020 6669 6c74 6572 5f69  it,.    filter_i
+00000650: 6e64 6578 6573 5f66 726f 6d5f 636f 6f72  ndexes_from_coor
+00000660: 6473 2c0a 2020 2020 6973 656c 5f69 6e64  ds,.    isel_ind
+00000670: 6578 6573 2c0a 2020 2020 7265 6d6f 7665  exes,.    remove
+00000680: 5f75 6e75 7365 645f 6c65 7665 6c73 5f63  _unused_levels_c
+00000690: 6174 6567 6f72 6965 732c 0a20 2020 2072  ategories,.    r
+000006a0: 6f6c 6c5f 696e 6465 7865 732c 0a29 0a66  oll_indexes,.).f
+000006b0: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+000006c0: 696e 6465 7869 6e67 2069 6d70 6f72 7420  indexing import 
+000006d0: 6973 5f66 616e 6379 5f69 6e64 6578 6572  is_fancy_indexer
+000006e0: 2c20 6d61 705f 696e 6465 785f 7175 6572  , map_index_quer
+000006f0: 6965 730a 6672 6f6d 2078 6172 7261 792e  ies.from xarray.
+00000700: 636f 7265 2e6d 6572 6765 2069 6d70 6f72  core.merge impor
+00000710: 7420 280a 2020 2020 6461 7461 7365 745f  t (.    dataset_
+00000720: 6d65 7267 655f 6d65 7468 6f64 2c0a 2020  merge_method,.  
+00000730: 2020 6461 7461 7365 745f 7570 6461 7465    dataset_update
+00000740: 5f6d 6574 686f 642c 0a20 2020 206d 6572  _method,.    mer
+00000750: 6765 5f63 6f6f 7264 696e 6174 6573 5f77  ge_coordinates_w
+00000760: 6974 686f 7574 5f61 6c69 676e 2c0a 2020  ithout_align,.  
+00000770: 2020 6d65 7267 655f 6461 7461 5f61 6e64    merge_data_and
+00000780: 5f63 6f6f 7264 732c 0a29 0a66 726f 6d20  _coords,.).from 
+00000790: 7861 7272 6179 2e63 6f72 652e 6d69 7373  xarray.core.miss
+000007a0: 696e 6720 696d 706f 7274 2067 6574 5f63  ing import get_c
+000007b0: 6c65 616e 5f69 6e74 6572 705f 696e 6465  lean_interp_inde
+000007c0: 780a 6672 6f6d 2078 6172 7261 792e 636f  x.from xarray.co
+000007d0: 7265 2e6f 7074 696f 6e73 2069 6d70 6f72  re.options impor
+000007e0: 7420 4f50 5449 4f4e 532c 205f 6765 745f  t OPTIONS, _get_
+000007f0: 6b65 6570 5f61 7474 7273 0a66 726f 6d20  keep_attrs.from 
+00000800: 7861 7272 6179 2e63 6f72 652e 7061 7261  xarray.core.para
+00000810: 6c6c 656c 636f 6d70 6174 2069 6d70 6f72  llelcompat impor
+00000820: 7420 280a 2020 2020 6765 745f 6368 756e  t (.    get_chun
+00000830: 6b65 645f 6172 7261 795f 7479 7065 2c0a  ked_array_type,.
+00000840: 2020 2020 6775 6573 735f 6368 756e 6b6d      guess_chunkm
+00000850: 616e 6167 6572 2c0a 290a 6672 6f6d 2078  anager,.).from x
+00000860: 6172 7261 792e 636f 7265 2e70 7963 6f6d  array.core.pycom
+00000870: 7061 7420 696d 706f 7274 2028 0a20 2020  pat import (.   
+00000880: 2061 7272 6179 5f74 7970 652c 0a20 2020   array_type,.   
+00000890: 2069 735f 6368 756e 6b65 645f 6172 7261   is_chunked_arra
+000008a0: 792c 0a20 2020 2069 735f 6475 636b 5f61  y,.    is_duck_a
+000008b0: 7272 6179 2c0a 2020 2020 6973 5f64 7563  rray,.    is_duc
+000008c0: 6b5f 6461 736b 5f61 7272 6179 2c0a 290a  k_dask_array,.).
+000008d0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+000008e0: 2e74 7970 6573 2069 6d70 6f72 7420 5175  .types import Qu
+000008f0: 616e 7469 6c65 4d65 7468 6f64 732c 2054  antileMethods, T
+00000900: 5f44 6174 6173 6574 0a66 726f 6d20 7861  _Dataset.from xa
+00000910: 7272 6179 2e63 6f72 652e 7574 696c 7320  rray.core.utils 
+00000920: 696d 706f 7274 2028 0a20 2020 2044 6566  import (.    Def
+00000930: 6175 6c74 2c0a 2020 2020 4672 6f7a 656e  ault,.    Frozen
+00000940: 2c0a 2020 2020 4879 6272 6964 4d61 7070  ,.    HybridMapp
+00000950: 696e 6750 726f 7879 2c0a 2020 2020 4f72  ingProxy,.    Or
+00000960: 6465 7265 6453 6574 2c0a 2020 2020 5f64  deredSet,.    _d
+00000970: 6566 6175 6c74 2c0a 2020 2020 6465 636f  efault,.    deco
+00000980: 6465 5f6e 756d 7079 5f64 6963 745f 7661  de_numpy_dict_va
+00000990: 6c75 6573 2c0a 2020 2020 6472 6f70 5f64  lues,.    drop_d
+000009a0: 696d 735f 6672 6f6d 5f69 6e64 6578 6572  ims_from_indexer
+000009b0: 732c 0a20 2020 2065 6974 6865 725f 6469  s,.    either_di
+000009c0: 6374 5f6f 725f 6b77 6172 6773 2c0a 2020  ct_or_kwargs,.  
+000009d0: 2020 696e 6669 785f 6469 6d73 2c0a 2020    infix_dims,.  
+000009e0: 2020 6973 5f64 6963 745f 6c69 6b65 2c0a    is_dict_like,.
+000009f0: 2020 2020 6973 5f73 6361 6c61 722c 0a20      is_scalar,. 
+00000a00: 2020 206d 6179 6265 5f77 7261 705f 6172     maybe_wrap_ar
+00000a10: 7261 792c 0a29 0a66 726f 6d20 7861 7272  ray,.).from xarr
+00000a20: 6179 2e63 6f72 652e 7661 7269 6162 6c65  ay.core.variable
+00000a30: 2069 6d70 6f72 7420 280a 2020 2020 496e   import (.    In
+00000a40: 6465 7856 6172 6961 626c 652c 0a20 2020  dexVariable,.   
+00000a50: 2056 6172 6961 626c 652c 0a20 2020 2061   Variable,.    a
+00000a60: 735f 7661 7269 6162 6c65 2c0a 2020 2020  s_variable,.    
+00000a70: 6272 6f61 6463 6173 745f 7661 7269 6162  broadcast_variab
+00000a80: 6c65 732c 0a20 2020 2063 616c 6375 6c61  les,.    calcula
+00000a90: 7465 5f64 696d 656e 7369 6f6e 732c 0a29  te_dimensions,.)
+00000aa0: 0a66 726f 6d20 7861 7272 6179 2e70 6c6f  .from xarray.plo
+00000ab0: 742e 6163 6365 7373 6f72 2069 6d70 6f72  t.accessor impor
+00000ac0: 7420 4461 7461 7365 7450 6c6f 7441 6363  t DatasetPlotAcc
+00000ad0: 6573 736f 720a 0a69 6620 5459 5045 5f43  essor..if TYPE_C
+00000ae0: 4845 434b 494e 473a 0a20 2020 2066 726f  HECKING:.    fro
+00000af0: 6d20 6e75 6d70 792e 7479 7069 6e67 2069  m numpy.typing i
+00000b00: 6d70 6f72 7420 4172 7261 794c 696b 650a  mport ArrayLike.
+00000b10: 0a20 2020 2066 726f 6d20 7861 7272 6179  .    from xarray
+00000b20: 2e62 6163 6b65 6e64 7320 696d 706f 7274  .backends import
+00000b30: 2041 6273 7472 6163 7444 6174 6153 746f   AbstractDataSto
+00000b40: 7265 2c20 5a61 7272 5374 6f72 650a 2020  re, ZarrStore.  
+00000b50: 2020 6672 6f6d 2078 6172 7261 792e 6261    from xarray.ba
+00000b60: 636b 656e 6473 2e61 7069 2069 6d70 6f72  ckends.api impor
+00000b70: 7420 545f 4e65 7463 6466 456e 6769 6e65  t T_NetcdfEngine
+00000b80: 2c20 545f 4e65 7463 6466 5479 7065 730a  , T_NetcdfTypes.
+00000b90: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
+00000ba0: 636f 7265 2e63 6f6f 7264 696e 6174 6573  core.coordinates
+00000bb0: 2069 6d70 6f72 7420 436f 6f72 6469 6e61   import Coordina
+00000bc0: 7465 730a 2020 2020 6672 6f6d 2078 6172  tes.    from xar
+00000bd0: 7261 792e 636f 7265 2e64 6174 6161 7272  ray.core.dataarr
+00000be0: 6179 2069 6d70 6f72 7420 4461 7461 4172  ay import DataAr
+00000bf0: 7261 790a 2020 2020 6672 6f6d 2078 6172  ray.    from xar
+00000c00: 7261 792e 636f 7265 2e67 726f 7570 6279  ray.core.groupby
+00000c10: 2069 6d70 6f72 7420 4461 7461 7365 7447   import DatasetG
+00000c20: 726f 7570 4279 0a20 2020 2066 726f 6d20  roupBy.    from 
+00000c30: 7861 7272 6179 2e63 6f72 652e 6d65 7267  xarray.core.merg
+00000c40: 6520 696d 706f 7274 2043 6f65 7263 6962  e import Coercib
+00000c50: 6c65 4d61 7070 696e 670a 2020 2020 6672  leMapping.    fr
+00000c60: 6f6d 2078 6172 7261 792e 636f 7265 2e70  om xarray.core.p
+00000c70: 6172 616c 6c65 6c63 6f6d 7061 7420 696d  arallelcompat im
+00000c80: 706f 7274 2043 6875 6e6b 4d61 6e61 6765  port ChunkManage
+00000c90: 7245 6e74 7279 706f 696e 740a 2020 2020  rEntrypoint.    
+00000ca0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
+00000cb0: 2e72 6573 616d 706c 6520 696d 706f 7274  .resample import
+00000cc0: 2044 6174 6173 6574 5265 7361 6d70 6c65   DatasetResample
+00000cd0: 0a20 2020 2066 726f 6d20 7861 7272 6179  .    from xarray
+00000ce0: 2e63 6f72 652e 726f 6c6c 696e 6720 696d  .core.rolling im
+00000cf0: 706f 7274 2044 6174 6173 6574 436f 6172  port DatasetCoar
+00000d00: 7365 6e2c 2044 6174 6173 6574 526f 6c6c  sen, DatasetRoll
+00000d10: 696e 670a 2020 2020 6672 6f6d 2078 6172  ing.    from xar
+00000d20: 7261 792e 636f 7265 2e74 7970 6573 2069  ray.core.types i
+00000d30: 6d70 6f72 7420 280a 2020 2020 2020 2020  mport (.        
+00000d40: 4346 4361 6c65 6e64 6172 2c0a 2020 2020  CFCalendar,.    
+00000d50: 2020 2020 436f 6172 7365 6e42 6f75 6e64      CoarsenBound
+00000d60: 6172 794f 7074 696f 6e73 2c0a 2020 2020  aryOptions,.    
+00000d70: 2020 2020 436f 6d62 696e 6541 7474 7273      CombineAttrs
+00000d80: 4f70 7469 6f6e 732c 0a20 2020 2020 2020  Options,.       
+00000d90: 2043 6f6d 7061 744f 7074 696f 6e73 2c0a   CompatOptions,.
+00000da0: 2020 2020 2020 2020 4461 7465 7469 6d65          Datetime
+00000db0: 4c69 6b65 2c0a 2020 2020 2020 2020 4461  Like,.        Da
+00000dc0: 7465 7469 6d65 556e 6974 4f70 7469 6f6e  tetimeUnitOption
+00000dd0: 732c 0a20 2020 2020 2020 2044 696d 732c  s,.        Dims,
+00000de0: 0a20 2020 2020 2020 2045 7272 6f72 4f70  .        ErrorOp
+00000df0: 7469 6f6e 732c 0a20 2020 2020 2020 2045  tions,.        E
+00000e00: 7272 6f72 4f70 7469 6f6e 7357 6974 6857  rrorOptionsWithW
+00000e10: 6172 6e2c 0a20 2020 2020 2020 2049 6e74  arn,.        Int
+00000e20: 6572 704f 7074 696f 6e73 2c0a 2020 2020  erpOptions,.    
+00000e30: 2020 2020 4a6f 696e 4f70 7469 6f6e 732c      JoinOptions,
+00000e40: 0a20 2020 2020 2020 2050 6164 4d6f 6465  .        PadMode
+00000e50: 4f70 7469 6f6e 732c 0a20 2020 2020 2020  Options,.       
+00000e60: 2050 6164 5265 666c 6563 744f 7074 696f   PadReflectOptio
+00000e70: 6e73 2c0a 2020 2020 2020 2020 5175 6572  ns,.        Quer
+00000e80: 7945 6e67 696e 654f 7074 696f 6e73 2c0a  yEngineOptions,.
+00000e90: 2020 2020 2020 2020 5175 6572 7950 6172          QueryPar
+00000ea0: 7365 724f 7074 696f 6e73 2c0a 2020 2020  serOptions,.    
+00000eb0: 2020 2020 5265 696e 6465 784d 6574 686f      ReindexMetho
+00000ec0: 644f 7074 696f 6e73 2c0a 2020 2020 2020  dOptions,.      
+00000ed0: 2020 5369 6465 4f70 7469 6f6e 732c 0a20    SideOptions,. 
+00000ee0: 2020 2020 2020 2054 5f58 6172 7261 792c         T_Xarray,
+00000ef0: 0a20 2020 2029 0a20 2020 2066 726f 6d20  .    ).    from 
+00000f00: 7861 7272 6179 2e63 6f72 652e 7765 6967  xarray.core.weig
+00000f10: 6874 6564 2069 6d70 6f72 7420 4461 7461  hted import Data
+00000f20: 7365 7457 6569 6768 7465 640a 0a20 2020  setWeighted..   
+00000f30: 2074 7279 3a0a 2020 2020 2020 2020 6672   try:.        fr
+00000f40: 6f6d 2064 6173 6b2e 6465 6c61 7965 6420  om dask.delayed 
+00000f50: 696d 706f 7274 2044 656c 6179 6564 0a20  import Delayed. 
+00000f60: 2020 2065 7863 6570 7420 496d 706f 7274     except Import
+00000f70: 4572 726f 723a 0a20 2020 2020 2020 2044  Error:.        D
+00000f80: 656c 6179 6564 203d 204e 6f6e 6520 2023  elayed = None  #
+00000f90: 2074 7970 653a 2069 676e 6f72 650a 2020   type: ignore.  
+00000fa0: 2020 7472 793a 0a20 2020 2020 2020 2066    try:.        f
+00000fb0: 726f 6d20 6461 736b 2e64 6174 6166 7261  rom dask.datafra
+00000fc0: 6d65 2069 6d70 6f72 7420 4461 7461 4672  me import DataFr
+00000fd0: 616d 6520 6173 2044 6173 6b44 6174 6146  ame as DaskDataF
+00000fe0: 7261 6d65 0a20 2020 2065 7863 6570 7420  rame.    except 
+00000ff0: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
+00001000: 2020 2020 2044 6173 6b44 6174 6146 7261       DaskDataFra
+00001010: 6d65 203d 204e 6f6e 6520 2023 2074 7970  me = None  # typ
+00001020: 653a 2069 676e 6f72 650a 0a0a 2320 6c69  e: ignore...# li
+00001030: 7374 206f 6620 6174 7472 6962 7574 6573  st of attributes
+00001040: 206f 6620 7064 2e44 6174 6574 696d 6549   of pd.DatetimeI
+00001050: 6e64 6578 2074 6861 7420 6172 6520 6e64  ndex that are nd
+00001060: 6172 7261 7973 206f 6620 7469 6d65 2069  arrays of time i
+00001070: 6e66 6f0a 5f44 4154 4554 494d 4549 4e44  nfo._DATETIMEIND
+00001080: 4558 5f43 4f4d 504f 4e45 4e54 5320 3d20  EX_COMPONENTS = 
+00001090: 5b0a 2020 2020 2279 6561 7222 2c0a 2020  [.    "year",.  
+000010a0: 2020 226d 6f6e 7468 222c 0a20 2020 2022    "month",.    "
+000010b0: 6461 7922 2c0a 2020 2020 2268 6f75 7222  day",.    "hour"
+000010c0: 2c0a 2020 2020 226d 696e 7574 6522 2c0a  ,.    "minute",.
+000010d0: 2020 2020 2273 6563 6f6e 6422 2c0a 2020      "second",.  
+000010e0: 2020 226d 6963 726f 7365 636f 6e64 222c    "microsecond",
+000010f0: 0a20 2020 2022 6e61 6e6f 7365 636f 6e64  .    "nanosecond
+00001100: 222c 0a20 2020 2022 6461 7465 222c 0a20  ",.    "date",. 
+00001110: 2020 2022 7469 6d65 222c 0a20 2020 2022     "time",.    "
+00001120: 6461 796f 6679 6561 7222 2c0a 2020 2020  dayofyear",.    
+00001130: 2277 6565 6b6f 6679 6561 7222 2c0a 2020  "weekofyear",.  
+00001140: 2020 2264 6179 6f66 7765 656b 222c 0a20    "dayofweek",. 
+00001150: 2020 2022 7175 6172 7465 7222 2c0a 5d0a     "quarter",.].
+00001160: 0a0a 6465 6620 5f67 6574 5f76 6972 7475  ..def _get_virtu
+00001170: 616c 5f76 6172 6961 626c 6528 0a20 2020  al_variable(.   
+00001180: 2076 6172 6961 626c 6573 2c20 6b65 793a   variables, key:
+00001190: 2048 6173 6861 626c 652c 2064 696d 5f73   Hashable, dim_s
+000011a0: 697a 6573 3a20 4d61 7070 696e 6720 7c20  izes: Mapping | 
+000011b0: 4e6f 6e65 203d 204e 6f6e 650a 2920 2d3e  None = None.) ->
+000011c0: 2074 7570 6c65 5b48 6173 6861 626c 652c   tuple[Hashable,
+000011d0: 2048 6173 6861 626c 652c 2056 6172 6961   Hashable, Varia
+000011e0: 626c 655d 3a0a 2020 2020 2222 2247 6574  ble]:.    """Get
+000011f0: 2061 2076 6972 7475 616c 2076 6172 6961   a virtual varia
+00001200: 626c 6520 2865 2e67 2e2c 2027 7469 6d65  ble (e.g., 'time
+00001210: 2e79 6561 7227 2920 6672 6f6d 2061 2064  .year') from a d
+00001220: 6963 7420 6f66 2078 6172 7261 792e 5661  ict of xarray.Va
+00001230: 7269 6162 6c65 0a20 2020 206f 626a 6563  riable.    objec
+00001240: 7473 2028 6966 2070 6f73 7369 626c 6529  ts (if possible)
+00001250: 0a0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
+00001260: 6f6d 2078 6172 7261 792e 636f 7265 2e64  om xarray.core.d
+00001270: 6174 6161 7272 6179 2069 6d70 6f72 7420  ataarray import 
+00001280: 4461 7461 4172 7261 790a 0a20 2020 2069  DataArray..    i
+00001290: 6620 6469 6d5f 7369 7a65 7320 6973 204e  f dim_sizes is N
+000012a0: 6f6e 653a 0a20 2020 2020 2020 2064 696d  one:.        dim
+000012b0: 5f73 697a 6573 203d 207b 7d0a 0a20 2020  _sizes = {}..   
+000012c0: 2069 6620 6b65 7920 696e 2064 696d 5f73   if key in dim_s
+000012d0: 697a 6573 3a0a 2020 2020 2020 2020 6461  izes:.        da
+000012e0: 7461 203d 2070 642e 496e 6465 7828 7261  ta = pd.Index(ra
+000012f0: 6e67 6528 6469 6d5f 7369 7a65 735b 6b65  nge(dim_sizes[ke
+00001300: 795d 292c 206e 616d 653d 6b65 7929 0a20  y]), name=key). 
+00001310: 2020 2020 2020 2076 6172 6961 626c 6520         variable 
+00001320: 3d20 496e 6465 7856 6172 6961 626c 6528  = IndexVariable(
+00001330: 286b 6579 2c29 2c20 6461 7461 290a 2020  (key,), data).  
+00001340: 2020 2020 2020 7265 7475 726e 206b 6579        return key
+00001350: 2c20 6b65 792c 2076 6172 6961 626c 650a  , key, variable.
+00001360: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
+00001370: 7374 616e 6365 286b 6579 2c20 7374 7229  stance(key, str)
+00001380: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00001390: 4b65 7945 7272 6f72 286b 6579 290a 0a20  KeyError(key).. 
+000013a0: 2020 2073 706c 6974 5f6b 6579 203d 206b     split_key = k
+000013b0: 6579 2e73 706c 6974 2822 2e22 2c20 3129  ey.split(".", 1)
+000013c0: 0a20 2020 2069 6620 6c65 6e28 7370 6c69  .    if len(spli
+000013d0: 745f 6b65 7929 2021 3d20 323a 0a20 2020  t_key) != 2:.   
+000013e0: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
+000013f0: 726f 7228 6b65 7929 0a0a 2020 2020 7265  ror(key)..    re
+00001400: 665f 6e61 6d65 2c20 7661 725f 6e61 6d65  f_name, var_name
+00001410: 203d 2073 706c 6974 5f6b 6579 0a20 2020   = split_key.   
+00001420: 2072 6566 5f76 6172 203d 2076 6172 6961   ref_var = varia
+00001430: 626c 6573 5b72 6566 5f6e 616d 655d 0a0a  bles[ref_name]..
+00001440: 2020 2020 6966 205f 636f 6e74 6169 6e73      if _contains
+00001450: 5f64 6174 6574 696d 655f 6c69 6b65 5f6f  _datetime_like_o
+00001460: 626a 6563 7473 2872 6566 5f76 6172 293a  bjects(ref_var):
+00001470: 0a20 2020 2020 2020 2072 6566 5f76 6172  .        ref_var
+00001480: 203d 2044 6174 6141 7272 6179 2872 6566   = DataArray(ref
+00001490: 5f76 6172 290a 2020 2020 2020 2020 6461  _var).        da
+000014a0: 7461 203d 2067 6574 6174 7472 2872 6566  ta = getattr(ref
+000014b0: 5f76 6172 2e64 742c 2076 6172 5f6e 616d  _var.dt, var_nam
+000014c0: 6529 2e64 6174 610a 2020 2020 656c 7365  e).data.    else
+000014d0: 3a0a 2020 2020 2020 2020 6461 7461 203d  :.        data =
+000014e0: 2067 6574 6174 7472 2872 6566 5f76 6172   getattr(ref_var
+000014f0: 2c20 7661 725f 6e61 6d65 292e 6461 7461  , var_name).data
+00001500: 0a20 2020 2076 6972 7475 616c 5f76 6172  .    virtual_var
+00001510: 203d 2056 6172 6961 626c 6528 7265 665f   = Variable(ref_
+00001520: 7661 722e 6469 6d73 2c20 6461 7461 290a  var.dims, data).
+00001530: 0a20 2020 2072 6574 7572 6e20 7265 665f  .    return ref_
+00001540: 6e61 6d65 2c20 7661 725f 6e61 6d65 2c20  name, var_name, 
+00001550: 7669 7274 7561 6c5f 7661 720a 0a0a 6465  virtual_var...de
+00001560: 6620 5f61 7373 6572 745f 656d 7074 7928  f _assert_empty(
+00001570: 6172 6773 3a20 7475 706c 652c 206d 7367  args: tuple, msg
+00001580: 3a20 7374 7220 3d20 2225 7322 2920 2d3e  : str = "%s") ->
+00001590: 204e 6f6e 653a 0a20 2020 2069 6620 6172   None:.    if ar
+000015a0: 6773 3a0a 2020 2020 2020 2020 7261 6973  gs:.        rais
+000015b0: 6520 5661 6c75 6545 7272 6f72 286d 7367  e ValueError(msg
+000015c0: 2025 2061 7267 7329 0a0a 0a64 6566 205f   % args)...def _
+000015d0: 6765 745f 6368 756e 6b28 7661 723a 2056  get_chunk(var: V
+000015e0: 6172 6961 626c 652c 2063 6875 6e6b 732c  ariable, chunks,
+000015f0: 2063 6875 6e6b 6d61 6e61 6765 723a 2043   chunkmanager: C
+00001600: 6875 6e6b 4d61 6e61 6765 7245 6e74 7279  hunkManagerEntry
+00001610: 706f 696e 7429 3a0a 2020 2020 2222 220a  point):.    """.
+00001620: 2020 2020 5265 7475 726e 206d 6170 2066      Return map f
+00001630: 726f 6d20 6561 6368 2064 696d 2074 6f20  rom each dim to 
+00001640: 6368 756e 6b20 7369 7a65 732c 2061 6363  chunk sizes, acc
+00001650: 6f75 6e74 696e 6720 666f 7220 6261 636b  ounting for back
+00001660: 656e 6427 7320 7072 6566 6572 7265 6420  end's preferred 
+00001670: 6368 756e 6b73 2e0a 2020 2020 2222 220a  chunks..    """.
+00001680: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00001690: 6365 2876 6172 2c20 496e 6465 7856 6172  ce(var, IndexVar
+000016a0: 6961 626c 6529 3a0a 2020 2020 2020 2020  iable):.        
+000016b0: 7265 7475 726e 207b 7d0a 2020 2020 6469  return {}.    di
+000016c0: 6d73 203d 2076 6172 2e64 696d 730a 2020  ms = var.dims.  
+000016d0: 2020 7368 6170 6520 3d20 7661 722e 7368    shape = var.sh
+000016e0: 6170 650a 0a20 2020 2023 2044 6574 6572  ape..    # Deter
+000016f0: 6d69 6e65 2074 6865 2065 7870 6c69 6369  mine the explici
+00001700: 7420 7265 7175 6573 7465 6420 6368 756e  t requested chun
+00001710: 6b73 2e0a 2020 2020 7072 6566 6572 7265  ks..    preferre
+00001720: 645f 6368 756e 6b73 203d 2076 6172 2e65  d_chunks = var.e
+00001730: 6e63 6f64 696e 672e 6765 7428 2270 7265  ncoding.get("pre
+00001740: 6665 7272 6564 5f63 6875 6e6b 7322 2c20  ferred_chunks", 
+00001750: 7b7d 290a 2020 2020 7072 6566 6572 7265  {}).    preferre
+00001760: 645f 6368 756e 6b5f 7368 6170 6520 3d20  d_chunk_shape = 
+00001770: 7475 706c 6528 0a20 2020 2020 2020 2070  tuple(.        p
+00001780: 7265 6665 7272 6564 5f63 6875 6e6b 732e  referred_chunks.
+00001790: 6765 7428 6469 6d2c 2073 697a 6529 2066  get(dim, size) f
+000017a0: 6f72 2064 696d 2c20 7369 7a65 2069 6e20  or dim, size in 
+000017b0: 7a69 7028 6469 6d73 2c20 7368 6170 6529  zip(dims, shape)
+000017c0: 0a20 2020 2029 0a20 2020 2069 6620 6973  .    ).    if is
+000017d0: 696e 7374 616e 6365 2863 6875 6e6b 732c  instance(chunks,
+000017e0: 204e 756d 6265 7229 206f 7220 2863 6875   Number) or (chu
+000017f0: 6e6b 7320 3d3d 2022 6175 746f 2229 3a0a  nks == "auto"):.
+00001800: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
+00001810: 2064 6963 742e 6672 6f6d 6b65 7973 2864   dict.fromkeys(d
+00001820: 696d 732c 2063 6875 6e6b 7329 0a20 2020  ims, chunks).   
+00001830: 2063 6875 6e6b 5f73 6861 7065 203d 2074   chunk_shape = t
+00001840: 7570 6c65 280a 2020 2020 2020 2020 6368  uple(.        ch
+00001850: 756e 6b73 2e67 6574 2864 696d 2c20 4e6f  unks.get(dim, No
+00001860: 6e65 2920 6f72 2070 7265 6665 7272 6564  ne) or preferred
+00001870: 5f63 6875 6e6b 5f73 697a 6573 0a20 2020  _chunk_sizes.   
+00001880: 2020 2020 2066 6f72 2064 696d 2c20 7072       for dim, pr
+00001890: 6566 6572 7265 645f 6368 756e 6b5f 7369  eferred_chunk_si
+000018a0: 7a65 7320 696e 207a 6970 2864 696d 732c  zes in zip(dims,
+000018b0: 2070 7265 6665 7272 6564 5f63 6875 6e6b   preferred_chunk
+000018c0: 5f73 6861 7065 290a 2020 2020 290a 0a20  _shape).    ).. 
+000018d0: 2020 2063 6875 6e6b 5f73 6861 7065 203d     chunk_shape =
+000018e0: 2063 6875 6e6b 6d61 6e61 6765 722e 6e6f   chunkmanager.no
+000018f0: 726d 616c 697a 655f 6368 756e 6b73 280a  rmalize_chunks(.
+00001900: 2020 2020 2020 2020 6368 756e 6b5f 7368          chunk_sh
+00001910: 6170 652c 2073 6861 7065 3d73 6861 7065  ape, shape=shape
+00001920: 2c20 6474 7970 653d 7661 722e 6474 7970  , dtype=var.dtyp
+00001930: 652c 2070 7265 7669 6f75 735f 6368 756e  e, previous_chun
+00001940: 6b73 3d70 7265 6665 7272 6564 5f63 6875  ks=preferred_chu
+00001950: 6e6b 5f73 6861 7065 0a20 2020 2029 0a0a  nk_shape.    )..
+00001960: 2020 2020 2320 5761 726e 2077 6865 7265      # Warn where
+00001970: 2072 6571 7565 7374 6564 2063 6875 6e6b   requested chunk
+00001980: 7320 6272 6561 6b20 7072 6566 6572 7265  s break preferre
+00001990: 6420 6368 756e 6b73 2c20 7072 6f76 6964  d chunks, provid
+000019a0: 6564 2074 6861 7420 7468 6520 7661 7269  ed that the vari
+000019b0: 6162 6c65 0a20 2020 2023 2063 6f6e 7461  able.    # conta
+000019c0: 696e 7320 6461 7461 2e0a 2020 2020 6966  ins data..    if
+000019d0: 2076 6172 2e73 697a 653a 0a20 2020 2020   var.size:.     
+000019e0: 2020 2066 6f72 2064 696d 2c20 7369 7a65     for dim, size
+000019f0: 2c20 6368 756e 6b5f 7369 7a65 7320 696e  , chunk_sizes in
+00001a00: 207a 6970 2864 696d 732c 2073 6861 7065   zip(dims, shape
+00001a10: 2c20 6368 756e 6b5f 7368 6170 6529 3a0a  , chunk_shape):.
+00001a20: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00001a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001a40: 2070 7265 6665 7272 6564 5f63 6875 6e6b   preferred_chunk
+00001a50: 5f73 697a 6573 203d 2070 7265 6665 7272  _sizes = preferr
+00001a60: 6564 5f63 6875 6e6b 735b 6469 6d5d 0a20  ed_chunks[dim]. 
+00001a70: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00001a80: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
+00001a90: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00001aa0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00001ab0: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
+00001ac0: 2073 746f 7020 696e 6469 6365 7320 6f66   stop indices of
+00001ad0: 2074 6865 2070 7265 6665 7272 6564 2063   the preferred c
+00001ae0: 6875 6e6b 732c 2062 7574 206f 6d69 7420  hunks, but omit 
+00001af0: 7468 6520 6c61 7374 2073 746f 700a 2020  the last stop.  
+00001b00: 2020 2020 2020 2020 2020 2320 2865 7175            # (equ
+00001b10: 616c 2074 6f20 7468 6520 6469 6d20 7369  al to the dim si
+00001b20: 7a65 292e 2020 496e 2070 6172 7469 6375  ze).  In particu
+00001b30: 6c61 722c 2061 7373 756d 6520 7468 6174  lar, assume that
+00001b40: 2077 6865 6e20 6120 7365 7175 656e 6365   when a sequence
+00001b50: 0a20 2020 2020 2020 2020 2020 2023 2065  .            # e
+00001b60: 7870 7265 7373 6573 2074 6865 2070 7265  xpresses the pre
+00001b70: 6665 7272 6564 2063 6875 6e6b 732c 2074  ferred chunks, t
+00001b80: 6865 2073 6571 7565 6e63 6520 7375 6d73  he sequence sums
+00001b90: 2074 6f20 7468 6520 7369 7a65 2e0a 2020   to the size..  
+00001ba0: 2020 2020 2020 2020 2020 7072 6566 6572            prefer
+00001bb0: 7265 645f 7374 6f70 7320 3d20 280a 2020  red_stops = (.  
+00001bc0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00001bd0: 6e67 6528 7072 6566 6572 7265 645f 6368  nge(preferred_ch
+00001be0: 756e 6b5f 7369 7a65 732c 2073 697a 652c  unk_sizes, size,
+00001bf0: 2070 7265 6665 7272 6564 5f63 6875 6e6b   preferred_chunk
+00001c00: 5f73 697a 6573 290a 2020 2020 2020 2020  _sizes).        
+00001c10: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00001c20: 7461 6e63 6528 7072 6566 6572 7265 645f  tance(preferred_
+00001c30: 6368 756e 6b5f 7369 7a65 732c 2069 6e74  chunk_sizes, int
+00001c40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00001c50: 2020 656c 7365 2069 7465 7274 6f6f 6c73    else itertools
+00001c60: 2e61 6363 756d 756c 6174 6528 7072 6566  .accumulate(pref
+00001c70: 6572 7265 645f 6368 756e 6b5f 7369 7a65  erred_chunk_size
+00001c80: 735b 3a2d 315d 290a 2020 2020 2020 2020  s[:-1]).        
+00001c90: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00001ca0: 2020 2320 4761 7468 6572 2061 6e79 2073    # Gather any s
+00001cb0: 746f 7020 696e 6469 6365 7320 6f66 2074  top indices of t
+00001cc0: 6865 2073 7065 6369 6669 6564 2063 6875  he specified chu
+00001cd0: 6e6b 7320 7468 6174 2061 7265 206e 6f74  nks that are not
+00001ce0: 2061 2073 746f 7020 696e 6465 780a 2020   a stop index.  
+00001cf0: 2020 2020 2020 2020 2020 2320 6f66 2061            # of a
+00001d00: 2070 7265 6665 7272 6564 2063 6875 6e6b   preferred chunk
+00001d10: 2e20 2041 6761 696e 2c20 6f6d 6974 2074  .  Again, omit t
+00001d20: 6865 206c 6173 7420 7374 6f70 2c20 6173  he last stop, as
+00001d30: 7375 6d69 6e67 2074 6861 7420 6974 2065  suming that it e
+00001d40: 7175 616c 730a 2020 2020 2020 2020 2020  quals.          
+00001d50: 2020 2320 7468 6520 6469 6d20 7369 7a65    # the dim size
+00001d60: 2e0a 2020 2020 2020 2020 2020 2020 6272  ..            br
+00001d70: 6561 6b73 203d 2073 6574 2869 7465 7274  eaks = set(itert
+00001d80: 6f6f 6c73 2e61 6363 756d 756c 6174 6528  ools.accumulate(
+00001d90: 6368 756e 6b5f 7369 7a65 735b 3a2d 315d  chunk_sizes[:-1]
+00001da0: 2929 2e64 6966 6665 7265 6e63 6528 0a20  )).difference(. 
+00001db0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00001dc0: 7265 6665 7272 6564 5f73 746f 7073 0a20  referred_stops. 
+00001dd0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00001de0: 2020 2020 2020 2020 2069 6620 6272 6561           if brea
+00001df0: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+00001e00: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+00001e10: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00001e20: 2020 2020 2020 2022 5468 6520 7370 6563         "The spec
+00001e30: 6966 6965 6420 6368 756e 6b73 2073 6570  ified chunks sep
+00001e40: 6172 6174 6520 7468 6520 7374 6f72 6564  arate the stored
+00001e50: 2063 6875 6e6b 7320 616c 6f6e 6720 220a   chunks along ".
+00001e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001e70: 2020 2020 6627 6469 6d65 6e73 696f 6e20      f'dimension 
+00001e80: 227b 6469 6d7d 2220 7374 6172 7469 6e67  "{dim}" starting
+00001e90: 2061 7420 696e 6465 7820 7b6d 696e 2862   at index {min(b
+00001ea0: 7265 616b 7329 7d2e 2054 6869 7320 636f  reaks)}. This co
+00001eb0: 756c 6420 270a 2020 2020 2020 2020 2020  uld '.          
+00001ec0: 2020 2020 2020 2020 2020 2264 6567 7261            "degra
+00001ed0: 6465 2070 6572 666f 726d 616e 6365 2e20  de performance. 
+00001ee0: 496e 7374 6561 642c 2063 6f6e 7369 6465  Instead, conside
+00001ef0: 7220 7265 6368 756e 6b69 6e67 2061 6674  r rechunking aft
+00001f00: 6572 206c 6f61 6469 6e67 2e22 0a20 2020  er loading.".   
+00001f10: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00001f20: 2020 2020 7265 7475 726e 2064 6963 7428      return dict(
+00001f30: 7a69 7028 6469 6d73 2c20 6368 756e 6b5f  zip(dims, chunk_
+00001f40: 7368 6170 6529 290a 0a0a 6465 6620 5f6d  shape))...def _m
+00001f50: 6179 6265 5f63 6875 6e6b 280a 2020 2020  aybe_chunk(.    
+00001f60: 6e61 6d65 2c0a 2020 2020 7661 722c 0a20  name,.    var,. 
+00001f70: 2020 2063 6875 6e6b 732c 0a20 2020 2074     chunks,.    t
+00001f80: 6f6b 656e 3d4e 6f6e 652c 0a20 2020 206c  oken=None,.    l
+00001f90: 6f63 6b3d 4e6f 6e65 2c0a 2020 2020 6e61  ock=None,.    na
+00001fa0: 6d65 5f70 7265 6669 783d 2278 6172 7261  me_prefix="xarra
+00001fb0: 792d 222c 0a20 2020 206f 7665 7277 7269  y-",.    overwri
+00001fc0: 7465 5f65 6e63 6f64 6564 5f63 6875 6e6b  te_encoded_chunk
+00001fd0: 733d 4661 6c73 652c 0a20 2020 2069 6e6c  s=False,.    inl
+00001fe0: 696e 655f 6172 7261 793d 4661 6c73 652c  ine_array=False,
+00001ff0: 0a20 2020 2063 6875 6e6b 6564 5f61 7272  .    chunked_arr
+00002000: 6179 5f74 7970 653a 2073 7472 207c 2043  ay_type: str | C
+00002010: 6875 6e6b 4d61 6e61 6765 7245 6e74 7279  hunkManagerEntry
+00002020: 706f 696e 7420 7c20 4e6f 6e65 203d 204e  point | None = N
+00002030: 6f6e 652c 0a20 2020 2066 726f 6d5f 6172  one,.    from_ar
+00002040: 7261 795f 6b77 6172 6773 3d4e 6f6e 652c  ray_kwargs=None,
+00002050: 0a29 3a0a 2020 2020 6966 2063 6875 6e6b  .):.    if chunk
+00002060: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00002070: 2020 2020 2020 2063 6875 6e6b 7320 3d20         chunks = 
+00002080: 7b64 696d 3a20 6368 756e 6b73 5b64 696d  {dim: chunks[dim
+00002090: 5d20 666f 7220 6469 6d20 696e 2076 6172  ] for dim in var
+000020a0: 2e64 696d 7320 6966 2064 696d 2069 6e20  .dims if dim in 
+000020b0: 6368 756e 6b73 7d0a 0a20 2020 2069 6620  chunks}..    if 
+000020c0: 7661 722e 6e64 696d 3a0a 2020 2020 2020  var.ndim:.      
+000020d0: 2020 6368 756e 6b65 645f 6172 7261 795f    chunked_array_
+000020e0: 7479 7065 203d 2067 7565 7373 5f63 6875  type = guess_chu
+000020f0: 6e6b 6d61 6e61 6765 7228 0a20 2020 2020  nkmanager(.     
+00002100: 2020 2020 2020 2063 6875 6e6b 6564 5f61         chunked_a
+00002110: 7272 6179 5f74 7970 650a 2020 2020 2020  rray_type.      
+00002120: 2020 2920 2023 2063 6f65 7263 6520 7374    )  # coerce st
+00002130: 7269 6e67 2074 6f20 4368 756e 6b4d 616e  ring to ChunkMan
+00002140: 6167 6572 456e 7472 7970 6f69 6e74 2074  agerEntrypoint t
+00002150: 7970 650a 2020 2020 2020 2020 6966 2069  ype.        if i
+00002160: 7369 6e73 7461 6e63 6528 6368 756e 6b65  sinstance(chunke
+00002170: 645f 6172 7261 795f 7479 7065 2c20 4461  d_array_type, Da
+00002180: 736b 4d61 6e61 6765 7229 3a0a 2020 2020  skManager):.    
+00002190: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+000021a0: 6b2e 6261 7365 2069 6d70 6f72 7420 746f  k.base import to
+000021b0: 6b65 6e69 7a65 0a0a 2020 2020 2020 2020  kenize..        
+000021c0: 2020 2020 2320 7768 656e 2072 6563 6875      # when rechu
+000021d0: 6e6b 696e 6720 6279 2064 6966 6665 7265  nking by differe
+000021e0: 6e74 2061 6d6f 756e 7473 2c20 6d61 6b65  nt amounts, make
+000021f0: 2073 7572 6520 6461 736b 206e 616d 6573   sure dask names
+00002200: 2063 6861 6e67 650a 2020 2020 2020 2020   change.        
+00002210: 2020 2020 2320 6279 2070 726f 7669 6469      # by providi
+00002220: 6e67 2063 6875 6e6b 7320 6173 2061 6e20  ng chunks as an 
+00002230: 696e 7075 7420 746f 2074 6f6b 656e 697a  input to tokeniz
+00002240: 652e 0a20 2020 2020 2020 2020 2020 2023  e..            #
+00002250: 2073 7562 746c 6520 6275 6773 2072 6573   subtle bugs res
+00002260: 756c 7420 6f74 6865 7277 6973 652e 2073  ult otherwise. s
+00002270: 6565 2047 4833 3335 300a 2020 2020 2020  ee GH3350.      
+00002280: 2020 2020 2020 746f 6b65 6e32 203d 2074        token2 = t
+00002290: 6f6b 656e 697a 6528 6e61 6d65 2c20 746f  okenize(name, to
+000022a0: 6b65 6e20 6966 2074 6f6b 656e 2065 6c73  ken if token els
+000022b0: 6520 7661 722e 5f64 6174 612c 2063 6875  e var._data, chu
+000022c0: 6e6b 7329 0a20 2020 2020 2020 2020 2020  nks).           
+000022d0: 206e 616d 6532 203d 2066 227b 6e61 6d65   name2 = f"{name
+000022e0: 5f70 7265 6669 787d 7b6e 616d 657d 2d7b  _prefix}{name}-{
+000022f0: 746f 6b65 6e32 7d22 0a0a 2020 2020 2020  token2}"..      
+00002300: 2020 2020 2020 6672 6f6d 5f61 7272 6179        from_array
+00002310: 5f6b 7761 7267 7320 3d20 7574 696c 732e  _kwargs = utils.
+00002320: 636f 6e73 6f6c 6964 6174 655f 6461 736b  consolidate_dask
+00002330: 5f66 726f 6d5f 6172 7261 795f 6b77 6172  _from_array_kwar
+00002340: 6773 280a 2020 2020 2020 2020 2020 2020  gs(.            
+00002350: 2020 2020 6672 6f6d 5f61 7272 6179 5f6b      from_array_k
+00002360: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+00002370: 2020 2020 2020 206e 616d 653d 6e61 6d65         name=name
+00002380: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+00002390: 2020 206c 6f63 6b3d 6c6f 636b 2c0a 2020     lock=lock,.  
+000023a0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000023b0: 6c69 6e65 5f61 7272 6179 3d69 6e6c 696e  line_array=inlin
+000023c0: 655f 6172 7261 792c 0a20 2020 2020 2020  e_array,.       
+000023d0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+000023e0: 7661 7220 3d20 7661 722e 6368 756e 6b28  var = var.chunk(
+000023f0: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
+00002400: 6e6b 732c 0a20 2020 2020 2020 2020 2020  nks,.           
+00002410: 2063 6875 6e6b 6564 5f61 7272 6179 5f74   chunked_array_t
+00002420: 7970 653d 6368 756e 6b65 645f 6172 7261  ype=chunked_arra
+00002430: 795f 7479 7065 2c0a 2020 2020 2020 2020  y_type,.        
+00002440: 2020 2020 6672 6f6d 5f61 7272 6179 5f6b      from_array_k
+00002450: 7761 7267 733d 6672 6f6d 5f61 7272 6179  wargs=from_array
+00002460: 5f6b 7761 7267 732c 0a20 2020 2020 2020  _kwargs,.       
+00002470: 2029 0a0a 2020 2020 2020 2020 6966 206f   )..        if o
+00002480: 7665 7277 7269 7465 5f65 6e63 6f64 6564  verwrite_encoded
+00002490: 5f63 6875 6e6b 7320 616e 6420 7661 722e  _chunks and var.
+000024a0: 6368 756e 6b73 2069 7320 6e6f 7420 4e6f  chunks is not No
+000024b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000024c0: 7661 722e 656e 636f 6469 6e67 5b22 6368  var.encoding["ch
+000024d0: 756e 6b73 225d 203d 2074 7570 6c65 2878  unks"] = tuple(x
+000024e0: 5b30 5d20 666f 7220 7820 696e 2076 6172  [0] for x in var
+000024f0: 2e63 6875 6e6b 7329 0a20 2020 2020 2020  .chunks).       
+00002500: 2072 6574 7572 6e20 7661 720a 2020 2020   return var.    
+00002510: 656c 7365 3a0a 2020 2020 2020 2020 7265  else:.        re
+00002520: 7475 726e 2076 6172 0a0a 0a64 6566 2061  turn var...def a
+00002530: 735f 6461 7461 7365 7428 6f62 6a3a 2041  s_dataset(obj: A
+00002540: 6e79 2920 2d3e 2044 6174 6173 6574 3a0a  ny) -> Dataset:.
+00002550: 2020 2020 2222 2243 6173 7420 7468 6520      """Cast the 
+00002560: 6769 7665 6e20 6f62 6a65 6374 2074 6f20  given object to 
+00002570: 6120 4461 7461 7365 742e 0a0a 2020 2020  a Dataset...    
+00002580: 4861 6e64 6c65 7320 4461 7461 7365 7473  Handles Datasets
+00002590: 2c20 4461 7461 4172 7261 7973 2061 6e64  , DataArrays and
+000025a0: 2064 6963 7469 6f6e 6172 6965 7320 6f66   dictionaries of
+000025b0: 2076 6172 6961 626c 6573 2e20 4120 6e65   variables. A ne
+000025c0: 7720 4461 7461 7365 740a 2020 2020 6f62  w Dataset.    ob
+000025d0: 6a65 6374 2069 7320 6f6e 6c79 2063 7265  ject is only cre
+000025e0: 6174 6564 2069 6620 7468 6520 7072 6f76  ated if the prov
+000025f0: 6964 6564 206f 626a 6563 7420 6973 206e  ided object is n
+00002600: 6f74 2061 6c72 6561 6479 206f 6e65 2e0a  ot already one..
+00002610: 2020 2020 2222 220a 2020 2020 6966 2068      """.    if h
+00002620: 6173 6174 7472 286f 626a 2c20 2274 6f5f  asattr(obj, "to_
+00002630: 6461 7461 7365 7422 293a 0a20 2020 2020  dataset"):.     
+00002640: 2020 206f 626a 203d 206f 626a 2e74 6f5f     obj = obj.to_
+00002650: 6461 7461 7365 7428 290a 2020 2020 6966  dataset().    if
+00002660: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00002670: 6f62 6a2c 2044 6174 6173 6574 293a 0a20  obj, Dataset):. 
+00002680: 2020 2020 2020 206f 626a 203d 2044 6174         obj = Dat
+00002690: 6173 6574 286f 626a 290a 2020 2020 7265  aset(obj).    re
+000026a0: 7475 726e 206f 626a 0a0a 0a64 6566 205f  turn obj...def _
+000026b0: 6765 745f 6675 6e63 5f61 7267 7328 6675  get_func_args(fu
+000026c0: 6e63 2c20 7061 7261 6d5f 6e61 6d65 7329  nc, param_names)
+000026d0: 3a0a 2020 2020 2222 2255 7365 2060 696e  :.    """Use `in
+000026e0: 7370 6563 742e 7369 676e 6174 7572 6560  spect.signature`
+000026f0: 2074 6f20 7472 7920 6163 6365 7373 696e   to try accessin
+00002700: 6720 6066 756e 6360 2061 7267 732e 204f  g `func` args. O
+00002710: 7468 6572 7769 7365 2c20 656e 7375 7265  therwise, ensure
+00002720: 0a20 2020 2074 6865 7920 6172 6520 7072  .    they are pr
+00002730: 6f76 6964 6564 2062 7920 7573 6572 2e0a  ovided by user..
+00002740: 2020 2020 2222 220a 2020 2020 7472 793a      """.    try:
+00002750: 0a20 2020 2020 2020 2066 756e 635f 6172  .        func_ar
+00002760: 6773 203d 2069 6e73 7065 6374 2e73 6967  gs = inspect.sig
+00002770: 6e61 7475 7265 2866 756e 6329 2e70 6172  nature(func).par
+00002780: 616d 6574 6572 730a 2020 2020 6578 6365  ameters.    exce
+00002790: 7074 2056 616c 7565 4572 726f 723a 0a20  pt ValueError:. 
+000027a0: 2020 2020 2020 2066 756e 635f 6172 6773         func_args
+000027b0: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
+000027c0: 206e 6f74 2070 6172 616d 5f6e 616d 6573   not param_names
+000027d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000027e0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+000027f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002800: 2255 6e61 626c 6520 746f 2069 6e73 7065  "Unable to inspe
+00002810: 6374 2060 6675 6e63 6020 7369 676e 6174  ct `func` signat
+00002820: 7572 652c 2061 6e64 2060 7061 7261 6d5f  ure, and `param_
+00002830: 6e61 6d65 7360 2077 6173 206e 6f74 2070  names` was not p
+00002840: 726f 7669 6465 642e 220a 2020 2020 2020  rovided.".      
+00002850: 2020 2020 2020 290a 2020 2020 6966 2070        ).    if p
+00002860: 6172 616d 5f6e 616d 6573 3a0a 2020 2020  aram_names:.    
+00002870: 2020 2020 7061 7261 6d73 203d 2070 6172      params = par
+00002880: 616d 5f6e 616d 6573 0a20 2020 2065 6c73  am_names.    els
+00002890: 653a 0a20 2020 2020 2020 2070 6172 616d  e:.        param
+000028a0: 7320 3d20 6c69 7374 2866 756e 635f 6172  s = list(func_ar
+000028b0: 6773 295b 313a 5d0a 2020 2020 2020 2020  gs)[1:].        
+000028c0: 6966 2061 6e79 280a 2020 2020 2020 2020  if any(.        
+000028d0: 2020 2020 5b28 702e 6b69 6e64 2069 6e20      [(p.kind in 
+000028e0: 5b70 2e56 4152 5f50 4f53 4954 494f 4e41  [p.VAR_POSITIONA
+000028f0: 4c2c 2070 2e56 4152 5f4b 4559 574f 5244  L, p.VAR_KEYWORD
+00002900: 5d29 2066 6f72 2070 2069 6e20 6675 6e63  ]) for p in func
+00002910: 5f61 7267 732e 7661 6c75 6573 2829 5d0a  _args.values()].
+00002920: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00002930: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00002940: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00002950: 2020 2020 2020 2020 2022 6070 6172 616d           "`param
+00002960: 5f6e 616d 6573 6020 6d75 7374 2062 6520  _names` must be 
+00002970: 7072 6f76 6964 6564 2062 6563 6175 7365  provided because
+00002980: 2060 6675 6e63 6020 7461 6b65 7320 7661   `func` takes va
+00002990: 7269 6162 6c65 206c 656e 6774 6820 6172  riable length ar
+000029a0: 6775 6d65 6e74 732e 220a 2020 2020 2020  guments.".      
+000029b0: 2020 2020 2020 290a 2020 2020 7265 7475        ).    retu
+000029c0: 726e 2070 6172 616d 732c 2066 756e 635f  rn params, func_
+000029d0: 6172 6773 0a0a 0a64 6566 205f 696e 6974  args...def _init
+000029e0: 6961 6c69 7a65 5f63 7572 7665 6669 745f  ialize_curvefit_
+000029f0: 7061 7261 6d73 2870 6172 616d 732c 2070  params(params, p
+00002a00: 302c 2062 6f75 6e64 732c 2066 756e 635f  0, bounds, func_
+00002a10: 6172 6773 293a 0a20 2020 2022 2222 5365  args):.    """Se
+00002a20: 7420 696e 6974 6961 6c20 6775 6573 7320  t initial guess 
+00002a30: 616e 6420 626f 756e 6473 2066 6f72 2063  and bounds for c
+00002a40: 7572 7665 6669 742e 0a20 2020 2050 7269  urvefit..    Pri
+00002a50: 6f72 6974 793a 2031 2920 7061 7373 6564  ority: 1) passed
+00002a60: 2061 7267 7320 3229 2066 756e 6320 7369   args 2) func si
+00002a70: 676e 6174 7572 6520 3329 2073 6369 7079  gnature 3) scipy
+00002a80: 2064 6566 6175 6c74 730a 2020 2020 2222   defaults.    ""
+00002a90: 220a 0a20 2020 2064 6566 205f 696e 6974  "..    def _init
+00002aa0: 6961 6c69 7a65 5f66 6561 7369 626c 6528  ialize_feasible(
+00002ab0: 6c62 2c20 7562 293a 0a20 2020 2020 2020  lb, ub):.       
+00002ac0: 2023 204d 696d 6963 7320 6675 6e63 7469   # Mimics functi
+00002ad0: 6f6e 616c 6974 7920 6f66 2073 6369 7079  onality of scipy
+00002ae0: 2e6f 7074 696d 697a 652e 6d69 6e70 6163  .optimize.minpac
+00002af0: 6b2e 5f69 6e69 7469 616c 697a 655f 6665  k._initialize_fe
+00002b00: 6173 6962 6c65 0a20 2020 2020 2020 206c  asible.        l
+00002b10: 625f 6669 6e69 7465 203d 206e 702e 6973  b_finite = np.is
+00002b20: 6669 6e69 7465 286c 6229 0a20 2020 2020  finite(lb).     
+00002b30: 2020 2075 625f 6669 6e69 7465 203d 206e     ub_finite = n
+00002b40: 702e 6973 6669 6e69 7465 2875 6229 0a20  p.isfinite(ub). 
+00002b50: 2020 2020 2020 2070 3020 3d20 6e70 2e6e         p0 = np.n
+00002b60: 616e 7375 6d28 0a20 2020 2020 2020 2020  ansum(.         
+00002b70: 2020 205b 0a20 2020 2020 2020 2020 2020     [.           
+00002b80: 2020 2020 2030 2e35 202a 2028 6c62 202b       0.5 * (lb +
+00002b90: 2075 6229 202a 2069 6e74 286c 625f 6669   ub) * int(lb_fi
+00002ba0: 6e69 7465 2026 2075 625f 6669 6e69 7465  nite & ub_finite
+00002bb0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00002bc0: 2020 2028 6c62 202b 2031 2920 2a20 696e     (lb + 1) * in
+00002bd0: 7428 6c62 5f66 696e 6974 6520 2620 7e75  t(lb_finite & ~u
+00002be0: 625f 6669 6e69 7465 292c 0a20 2020 2020  b_finite),.     
+00002bf0: 2020 2020 2020 2020 2020 2028 7562 202d             (ub -
+00002c00: 2031 2920 2a20 696e 7428 7e6c 625f 6669   1) * int(~lb_fi
+00002c10: 6e69 7465 2026 2075 625f 6669 6e69 7465  nite & ub_finite
+00002c20: 292c 0a20 2020 2020 2020 2020 2020 205d  ),.            ]
+00002c30: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00002c40: 2020 2072 6574 7572 6e20 7030 0a0a 2020     return p0..  
+00002c50: 2020 7061 7261 6d5f 6465 6661 756c 7473    param_defaults
+00002c60: 203d 207b 703a 2031 2066 6f72 2070 2069   = {p: 1 for p i
+00002c70: 6e20 7061 7261 6d73 7d0a 2020 2020 626f  n params}.    bo
+00002c80: 756e 6473 5f64 6566 6175 6c74 7320 3d20  unds_defaults = 
+00002c90: 7b70 3a20 282d 6e70 2e69 6e66 2c20 6e70  {p: (-np.inf, np
+00002ca0: 2e69 6e66 2920 666f 7220 7020 696e 2070  .inf) for p in p
+00002cb0: 6172 616d 737d 0a20 2020 2066 6f72 2070  arams}.    for p
+00002cc0: 2069 6e20 7061 7261 6d73 3a0a 2020 2020   in params:.    
+00002cd0: 2020 2020 6966 2070 2069 6e20 6675 6e63      if p in func
+00002ce0: 5f61 7267 7320 616e 6420 6675 6e63 5f61  _args and func_a
+00002cf0: 7267 735b 705d 2e64 6566 6175 6c74 2069  rgs[p].default i
+00002d00: 7320 6e6f 7420 6675 6e63 5f61 7267 735b  s not func_args[
+00002d10: 705d 2e65 6d70 7479 3a0a 2020 2020 2020  p].empty:.      
+00002d20: 2020 2020 2020 7061 7261 6d5f 6465 6661        param_defa
+00002d30: 756c 7473 5b70 5d20 3d20 6675 6e63 5f61  ults[p] = func_a
+00002d40: 7267 735b 705d 2e64 6566 6175 6c74 0a20  rgs[p].default. 
+00002d50: 2020 2020 2020 2069 6620 7020 696e 2062         if p in b
+00002d60: 6f75 6e64 733a 0a20 2020 2020 2020 2020  ounds:.         
+00002d70: 2020 2062 6f75 6e64 735f 6465 6661 756c     bounds_defaul
+00002d80: 7473 5b70 5d20 3d20 7475 706c 6528 626f  ts[p] = tuple(bo
+00002d90: 756e 6473 5b70 5d29 0a20 2020 2020 2020  unds[p]).       
+00002da0: 2020 2020 2069 6620 7061 7261 6d5f 6465       if param_de
+00002db0: 6661 756c 7473 5b70 5d20 3c20 626f 756e  faults[p] < boun
+00002dc0: 6473 5b70 5d5b 305d 206f 7220 7061 7261  ds[p][0] or para
+00002dd0: 6d5f 6465 6661 756c 7473 5b70 5d20 3e20  m_defaults[p] > 
+00002de0: 626f 756e 6473 5b70 5d5b 315d 3a0a 2020  bounds[p][1]:.  
+00002df0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00002e00: 7261 6d5f 6465 6661 756c 7473 5b70 5d20  ram_defaults[p] 
+00002e10: 3d20 5f69 6e69 7469 616c 697a 655f 6665  = _initialize_fe
+00002e20: 6173 6962 6c65 2862 6f75 6e64 735b 705d  asible(bounds[p]
+00002e30: 5b30 5d2c 2062 6f75 6e64 735b 705d 5b31  [0], bounds[p][1
+00002e40: 5d29 0a20 2020 2020 2020 2069 6620 7020  ]).        if p 
+00002e50: 696e 2070 303a 0a20 2020 2020 2020 2020  in p0:.         
+00002e60: 2020 2070 6172 616d 5f64 6566 6175 6c74     param_default
+00002e70: 735b 705d 203d 2070 305b 705d 0a20 2020  s[p] = p0[p].   
+00002e80: 2072 6574 7572 6e20 7061 7261 6d5f 6465   return param_de
+00002e90: 6661 756c 7473 2c20 626f 756e 6473 5f64  faults, bounds_d
+00002ea0: 6566 6175 6c74 730a 0a0a 636c 6173 7320  efaults...class 
+00002eb0: 4461 7461 5661 7269 6162 6c65 7328 4d61  DataVariables(Ma
+00002ec0: 7070 696e 675b 416e 792c 2022 4461 7461  pping[Any, "Data
+00002ed0: 4172 7261 7922 5d29 3a0a 2020 2020 5f5f  Array"]):.    __
+00002ee0: 736c 6f74 735f 5f20 3d20 2822 5f64 6174  slots__ = ("_dat
+00002ef0: 6173 6574 222c 290a 0a20 2020 2064 6566  aset",)..    def
+00002f00: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00002f10: 6461 7461 7365 743a 2044 6174 6173 6574  dataset: Dataset
+00002f20: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00002f30: 5f64 6174 6173 6574 203d 2064 6174 6173  _dataset = datas
+00002f40: 6574 0a0a 2020 2020 6465 6620 5f5f 6974  et..    def __it
+00002f50: 6572 5f5f 2873 656c 6629 202d 3e20 4974  er__(self) -> It
+00002f60: 6572 6174 6f72 5b48 6173 6861 626c 655d  erator[Hashable]
+00002f70: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00002f80: 2028 0a20 2020 2020 2020 2020 2020 206b   (.            k
+00002f90: 6579 0a20 2020 2020 2020 2020 2020 2066  ey.            f
+00002fa0: 6f72 206b 6579 2069 6e20 7365 6c66 2e5f  or key in self._
+00002fb0: 6461 7461 7365 742e 5f76 6172 6961 626c  dataset._variabl
+00002fc0: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
+00002fd0: 6620 6b65 7920 6e6f 7420 696e 2073 656c  f key not in sel
+00002fe0: 662e 5f64 6174 6173 6574 2e5f 636f 6f72  f._dataset._coor
+00002ff0: 645f 6e61 6d65 730a 2020 2020 2020 2020  d_names.        
+00003000: 290a 0a20 2020 2064 6566 205f 5f6c 656e  )..    def __len
+00003010: 5f5f 2873 656c 6629 202d 3e20 696e 743a  __(self) -> int:
+00003020: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003030: 6c65 6e28 7365 6c66 2e5f 6461 7461 7365  len(self._datase
+00003040: 742e 5f76 6172 6961 626c 6573 2920 2d20  t._variables) - 
+00003050: 6c65 6e28 7365 6c66 2e5f 6461 7461 7365  len(self._datase
+00003060: 742e 5f63 6f6f 7264 5f6e 616d 6573 290a  t._coord_names).
+00003070: 0a20 2020 2064 6566 205f 5f63 6f6e 7461  .    def __conta
+00003080: 696e 735f 5f28 7365 6c66 2c20 6b65 793a  ins__(self, key:
+00003090: 2048 6173 6861 626c 6529 202d 3e20 626f   Hashable) -> bo
+000030a0: 6f6c 3a0a 2020 2020 2020 2020 7265 7475  ol:.        retu
+000030b0: 726e 206b 6579 2069 6e20 7365 6c66 2e5f  rn key in self._
+000030c0: 6461 7461 7365 742e 5f76 6172 6961 626c  dataset._variabl
+000030d0: 6573 2061 6e64 206b 6579 206e 6f74 2069  es and key not i
+000030e0: 6e20 7365 6c66 2e5f 6461 7461 7365 742e  n self._dataset.
+000030f0: 5f63 6f6f 7264 5f6e 616d 6573 0a0a 2020  _coord_names..  
+00003100: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
+00003110: 5f28 7365 6c66 2c20 6b65 793a 2048 6173  _(self, key: Has
+00003120: 6861 626c 6529 202d 3e20 4461 7461 4172  hable) -> DataAr
+00003130: 7261 793a 0a20 2020 2020 2020 2069 6620  ray:.        if 
+00003140: 6b65 7920 6e6f 7420 696e 2073 656c 662e  key not in self.
+00003150: 5f64 6174 6173 6574 2e5f 636f 6f72 645f  _dataset._coord_
+00003160: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+00003170: 2020 2072 6574 7572 6e20 6361 7374 2822     return cast("
+00003180: 4461 7461 4172 7261 7922 2c20 7365 6c66  DataArray", self
+00003190: 2e5f 6461 7461 7365 745b 6b65 795d 290a  ._dataset[key]).
+000031a0: 2020 2020 2020 2020 7261 6973 6520 4b65          raise Ke
+000031b0: 7945 7272 6f72 286b 6579 290a 0a20 2020  yError(key)..   
+000031c0: 2064 6566 205f 5f72 6570 725f 5f28 7365   def __repr__(se
+000031d0: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
+000031e0: 2020 2020 7265 7475 726e 2066 6f72 6d61      return forma
+000031f0: 7474 696e 672e 6461 7461 5f76 6172 735f  tting.data_vars_
+00003200: 7265 7072 2873 656c 6629 0a0a 2020 2020  repr(self)..    
+00003210: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00003220: 6620 7661 7269 6162 6c65 7328 7365 6c66  f variables(self
+00003230: 2920 2d3e 204d 6170 7069 6e67 5b48 6173  ) -> Mapping[Has
+00003240: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
+00003250: 3a0a 2020 2020 2020 2020 616c 6c5f 7661  :.        all_va
+00003260: 7269 6162 6c65 7320 3d20 7365 6c66 2e5f  riables = self._
+00003270: 6461 7461 7365 742e 7661 7269 6162 6c65  dataset.variable
+00003280: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+00003290: 2046 726f 7a65 6e28 7b6b 3a20 616c 6c5f   Frozen({k: all_
+000032a0: 7661 7269 6162 6c65 735b 6b5d 2066 6f72  variables[k] for
+000032b0: 206b 2069 6e20 7365 6c66 7d29 0a0a 2020   k in self})..  
+000032c0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+000032d0: 6465 6620 6474 7970 6573 2873 656c 6629  def dtypes(self)
+000032e0: 202d 3e20 4672 6f7a 656e 5b48 6173 6861   -> Frozen[Hasha
+000032f0: 626c 652c 206e 702e 6474 7970 655d 3a0a  ble, np.dtype]:.
+00003300: 2020 2020 2020 2020 2222 224d 6170 7069          """Mappi
+00003310: 6e67 2066 726f 6d20 6461 7461 2076 6172  ng from data var
+00003320: 6961 626c 6520 6e61 6d65 7320 746f 2064  iable names to d
+00003330: 7479 7065 732e 0a0a 2020 2020 2020 2020  types...        
+00003340: 4361 6e6e 6f74 2062 6520 6d6f 6469 6669  Cannot be modifi
+00003350: 6564 2064 6972 6563 746c 792c 2062 7574  ed directly, but
+00003360: 2069 7320 7570 6461 7465 6420 7768 656e   is updated when
+00003370: 2061 6464 696e 6720 6e65 7720 7661 7269   adding new vari
+00003380: 6162 6c65 732e 0a0a 2020 2020 2020 2020  ables...        
+00003390: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+000033a0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+000033b0: 2020 4461 7461 7365 742e 6474 7970 650a    Dataset.dtype.
+000033c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000033d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000033e0: 5f64 6174 6173 6574 2e64 7479 7065 730a  _dataset.dtypes.
+000033f0: 0a20 2020 2064 6566 205f 6970 7974 686f  .    def _ipytho
+00003400: 6e5f 6b65 795f 636f 6d70 6c65 7469 6f6e  n_key_completion
+00003410: 735f 2873 656c 6629 3a0a 2020 2020 2020  s_(self):.      
+00003420: 2020 2222 2250 726f 7669 6465 206d 6574    """Provide met
+00003430: 686f 6420 666f 7220 7468 6520 6b65 792d  hod for the key-
+00003440: 6175 746f 636f 6d70 6c65 7469 6f6e 7320  autocompletions 
+00003450: 696e 2049 5079 7468 6f6e 2e22 2222 0a20  in IPython.""". 
+00003460: 2020 2020 2020 2072 6574 7572 6e20 5b0a         return [.
+00003470: 2020 2020 2020 2020 2020 2020 6b65 790a              key.
+00003480: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00003490: 6b65 7920 696e 2073 656c 662e 5f64 6174  key in self._dat
+000034a0: 6173 6574 2e5f 6970 7974 686f 6e5f 6b65  aset._ipython_ke
+000034b0: 795f 636f 6d70 6c65 7469 6f6e 735f 2829  y_completions_()
+000034c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000034d0: 6b65 7920 6e6f 7420 696e 2073 656c 662e  key not in self.
+000034e0: 5f64 6174 6173 6574 2e5f 636f 6f72 645f  _dataset._coord_
+000034f0: 6e61 6d65 730a 2020 2020 2020 2020 5d0a  names.        ].
+00003500: 0a0a 636c 6173 7320 5f4c 6f63 496e 6465  ..class _LocInde
+00003510: 7865 7228 4765 6e65 7269 635b 545f 4461  xer(Generic[T_Da
+00003520: 7461 7365 745d 293a 0a20 2020 205f 5f73  taset]):.    __s
+00003530: 6c6f 7473 5f5f 203d 2028 2264 6174 6173  lots__ = ("datas
+00003540: 6574 222c 290a 0a20 2020 2064 6566 205f  et",)..    def _
+00003550: 5f69 6e69 745f 5f28 7365 6c66 2c20 6461  _init__(self, da
+00003560: 7461 7365 743a 2054 5f44 6174 6173 6574  taset: T_Dataset
+00003570: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00003580: 6461 7461 7365 7420 3d20 6461 7461 7365  dataset = datase
+00003590: 740a 0a20 2020 2064 6566 205f 5f67 6574  t..    def __get
+000035a0: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
+000035b0: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
+000035c0: 6e79 5d29 202d 3e20 545f 4461 7461 7365  ny]) -> T_Datase
+000035d0: 743a 0a20 2020 2020 2020 2069 6620 6e6f  t:.        if no
+000035e0: 7420 7574 696c 732e 6973 5f64 6963 745f  t utils.is_dict_
+000035f0: 6c69 6b65 286b 6579 293a 0a20 2020 2020  like(key):.     
+00003600: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00003610: 6545 7272 6f72 2822 6361 6e20 6f6e 6c79  eError("can only
+00003620: 206c 6f6f 6b75 7020 6469 6374 696f 6e61   lookup dictiona
+00003630: 7269 6573 2066 726f 6d20 4461 7461 7365  ries from Datase
+00003640: 742e 6c6f 6322 290a 2020 2020 2020 2020  t.loc").        
+00003650: 7265 7475 726e 2073 656c 662e 6461 7461  return self.data
+00003660: 7365 742e 7365 6c28 6b65 7929 0a0a 2020  set.sel(key)..  
+00003670: 2020 6465 6620 5f5f 7365 7469 7465 6d5f    def __setitem_
+00003680: 5f28 7365 6c66 2c20 6b65 792c 2076 616c  _(self, key, val
+00003690: 7565 2920 2d3e 204e 6f6e 653a 0a20 2020  ue) -> None:.   
+000036a0: 2020 2020 2069 6620 6e6f 7420 7574 696c       if not util
+000036b0: 732e 6973 5f64 6963 745f 6c69 6b65 286b  s.is_dict_like(k
+000036c0: 6579 293a 0a20 2020 2020 2020 2020 2020  ey):.           
+000036d0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+000036e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000036f0: 2020 2263 616e 206f 6e6c 7920 7365 7420    "can only set 
+00003700: 6c6f 6361 7469 6f6e 7320 6465 6669 6e65  locations define
+00003710: 6420 6279 2064 6963 7469 6f6e 6172 6965  d by dictionarie
+00003720: 7320 6672 6f6d 2044 6174 6173 6574 2e6c  s from Dataset.l
+00003730: 6f63 2e22 0a20 2020 2020 2020 2020 2020  oc.".           
+00003740: 2020 2020 2066 2220 476f 743a 207b 6b65       f" Got: {ke
+00003750: 797d 220a 2020 2020 2020 2020 2020 2020  y}".            
+00003760: 290a 0a20 2020 2020 2020 2023 2073 6574  )..        # set
+00003770: 206e 6577 2076 616c 7565 730a 2020 2020   new values.    
+00003780: 2020 2020 6469 6d5f 696e 6465 7865 7273      dim_indexers
+00003790: 203d 206d 6170 5f69 6e64 6578 5f71 7565   = map_index_que
+000037a0: 7269 6573 2873 656c 662e 6461 7461 7365  ries(self.datase
+000037b0: 742c 206b 6579 292e 6469 6d5f 696e 6465  t, key).dim_inde
+000037c0: 7865 7273 0a20 2020 2020 2020 2073 656c  xers.        sel
+000037d0: 662e 6461 7461 7365 745b 6469 6d5f 696e  f.dataset[dim_in
+000037e0: 6465 7865 7273 5d20 3d20 7661 6c75 650a  dexers] = value.
+000037f0: 0a0a 636c 6173 7320 4461 7461 7365 7428  ..class Dataset(
+00003800: 0a20 2020 2044 6174 6157 6974 6843 6f6f  .    DataWithCoo
+00003810: 7264 732c 0a20 2020 2044 6174 6173 6574  rds,.    Dataset
+00003820: 4167 6772 6567 6174 696f 6e73 2c0a 2020  Aggregations,.  
+00003830: 2020 4461 7461 7365 7441 7269 7468 6d65    DatasetArithme
+00003840: 7469 632c 0a20 2020 204d 6170 7069 6e67  tic,.    Mapping
+00003850: 5b48 6173 6861 626c 652c 2022 4461 7461  [Hashable, "Data
+00003860: 4172 7261 7922 5d2c 0a29 3a0a 2020 2020  Array"],.):.    
+00003870: 2222 2241 206d 756c 7469 2d64 696d 656e  """A multi-dimen
+00003880: 7369 6f6e 616c 2c20 696e 206d 656d 6f72  sional, in memor
+00003890: 792c 2061 7272 6179 2064 6174 6162 6173  y, array databas
+000038a0: 652e 0a0a 2020 2020 4120 6461 7461 7365  e...    A datase
+000038b0: 7420 7265 7365 6d62 6c65 7320 616e 2069  t resembles an i
+000038c0: 6e2d 6d65 6d6f 7279 2072 6570 7265 7365  n-memory represe
+000038d0: 6e74 6174 696f 6e20 6f66 2061 204e 6574  ntation of a Net
+000038e0: 4344 4620 6669 6c65 2c0a 2020 2020 616e  CDF file,.    an
+000038f0: 6420 636f 6e73 6973 7473 206f 6620 7661  d consists of va
+00003900: 7269 6162 6c65 732c 2063 6f6f 7264 696e  riables, coordin
+00003910: 6174 6573 2061 6e64 2061 7474 7269 6275  ates and attribu
+00003920: 7465 7320 7768 6963 680a 2020 2020 746f  tes which.    to
+00003930: 6765 7468 6572 2066 6f72 6d20 6120 7365  gether form a se
+00003940: 6c66 2064 6573 6372 6962 696e 6720 6461  lf describing da
+00003950: 7461 7365 742e 0a0a 2020 2020 4461 7461  taset...    Data
+00003960: 7365 7420 696d 706c 656d 656e 7473 2074  set implements t
+00003970: 6865 206d 6170 7069 6e67 2069 6e74 6572  he mapping inter
+00003980: 6661 6365 2077 6974 6820 6b65 7973 2067  face with keys g
+00003990: 6976 656e 2062 7920 7661 7269 6162 6c65  iven by variable
+000039a0: 0a20 2020 206e 616d 6573 2061 6e64 2076  .    names and v
+000039b0: 616c 7565 7320 6769 7665 6e20 6279 2044  alues given by D
+000039c0: 6174 6141 7272 6179 206f 626a 6563 7473  ataArray objects
+000039d0: 2066 6f72 2065 6163 6820 7661 7269 6162   for each variab
+000039e0: 6c65 206e 616d 652e 0a0a 2020 2020 4f6e  le name...    On
+000039f0: 6520 6469 6d65 6e73 696f 6e61 6c20 7661  e dimensional va
+00003a00: 7269 6162 6c65 7320 7769 7468 206e 616d  riables with nam
+00003a10: 6520 6571 7561 6c20 746f 2074 6865 6972  e equal to their
+00003a20: 2064 696d 656e 7369 6f6e 2061 7265 0a20   dimension are. 
+00003a30: 2020 2069 6e64 6578 2063 6f6f 7264 696e     index coordin
+00003a40: 6174 6573 2075 7365 6420 666f 7220 6c61  ates used for la
+00003a50: 6265 6c20 6261 7365 6420 696e 6465 7869  bel based indexi
+00003a60: 6e67 2e0a 0a20 2020 2054 6f20 6c6f 6164  ng...    To load
+00003a70: 2064 6174 6120 6672 6f6d 2061 2066 696c   data from a fil
+00003a80: 6520 6f72 2066 696c 652d 6c69 6b65 206f  e or file-like o
+00003a90: 626a 6563 742c 2075 7365 2074 6865 2060  bject, use the `
+00003aa0: 6f70 656e 5f64 6174 6173 6574 600a 2020  open_dataset`.  
+00003ab0: 2020 6675 6e63 7469 6f6e 2e0a 0a20 2020    function...   
+00003ac0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00003ad0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064  ----------.    d
+00003ae0: 6174 615f 7661 7273 203a 2064 6963 742d  ata_vars : dict-
+00003af0: 6c69 6b65 2c20 6f70 7469 6f6e 616c 0a20  like, optional. 
+00003b00: 2020 2020 2020 2041 206d 6170 7069 6e67         A mapping
+00003b10: 2066 726f 6d20 7661 7269 6162 6c65 206e   from variable n
+00003b20: 616d 6573 2074 6f20 3a70 793a 636c 6173  ames to :py:clas
+00003b30: 733a 607e 7861 7272 6179 2e44 6174 6141  s:`~xarray.DataA
+00003b40: 7272 6179 600a 2020 2020 2020 2020 6f62  rray`.        ob
+00003b50: 6a65 6374 732c 203a 7079 3a63 6c61 7373  jects, :py:class
+00003b60: 3a60 7e78 6172 7261 792e 5661 7269 6162  :`~xarray.Variab
+00003b70: 6c65 6020 6f62 6a65 6374 7320 6f72 2074  le` objects or t
+00003b80: 6f20 7475 706c 6573 206f 660a 2020 2020  o tuples of.    
+00003b90: 2020 2020 7468 6520 666f 726d 2060 6028      the form ``(
+00003ba0: 6469 6d73 2c20 6461 7461 5b2c 2061 7474  dims, data[, att
+00003bb0: 7273 5d29 6060 2077 6869 6368 2063 616e  rs])`` which can
+00003bc0: 2062 6520 7573 6564 2061 730a 2020 2020   be used as.    
+00003bd0: 2020 2020 6172 6775 6d65 6e74 7320 746f      arguments to
+00003be0: 2063 7265 6174 6520 6120 6e65 7720 6060   create a new ``
+00003bf0: 5661 7269 6162 6c65 6060 2e20 4561 6368  Variable``. Each
+00003c00: 2064 696d 656e 7369 6f6e 206d 7573 740a   dimension must.
+00003c10: 2020 2020 2020 2020 6861 7665 2074 6865          have the
+00003c20: 2073 616d 6520 6c65 6e67 7468 2069 6e20   same length in 
+00003c30: 616c 6c20 7661 7269 6162 6c65 7320 696e  all variables in
+00003c40: 2077 6869 6368 2069 7420 6170 7065 6172   which it appear
+00003c50: 732e 0a0a 2020 2020 2020 2020 5468 6520  s...        The 
+00003c60: 666f 6c6c 6f77 696e 6720 6e6f 7461 7469  following notati
+00003c70: 6f6e 7320 6172 6520 6163 6365 7074 6564  ons are accepted
+00003c80: 3a0a 0a20 2020 2020 2020 202d 206d 6170  :..        - map
+00003c90: 7069 6e67 207b 7661 7220 6e61 6d65 3a20  ping {var name: 
+00003ca0: 4461 7461 4172 7261 797d 0a20 2020 2020  DataArray}.     
+00003cb0: 2020 202d 206d 6170 7069 6e67 207b 7661     - mapping {va
+00003cc0: 7220 6e61 6d65 3a20 5661 7269 6162 6c65  r name: Variable
+00003cd0: 7d0a 2020 2020 2020 2020 2d20 6d61 7070  }.        - mapp
+00003ce0: 696e 6720 7b76 6172 206e 616d 653a 2028  ing {var name: (
+00003cf0: 6469 6d65 6e73 696f 6e20 6e61 6d65 2c20  dimension name, 
+00003d00: 6172 7261 792d 6c69 6b65 297d 0a20 2020  array-like)}.   
+00003d10: 2020 2020 202d 206d 6170 7069 6e67 207b       - mapping {
+00003d20: 7661 7220 6e61 6d65 3a20 2874 7570 6c65  var name: (tuple
+00003d30: 206f 6620 6469 6d65 6e73 696f 6e20 6e61   of dimension na
+00003d40: 6d65 732c 2061 7272 6179 2d6c 696b 6529  mes, array-like)
+00003d50: 7d0a 2020 2020 2020 2020 2d20 6d61 7070  }.        - mapp
+00003d60: 696e 6720 7b64 696d 656e 7369 6f6e 206e  ing {dimension n
+00003d70: 616d 653a 2061 7272 6179 2d6c 696b 657d  ame: array-like}
+00003d80: 0a20 2020 2020 2020 2020 2028 6974 2077  .          (it w
+00003d90: 696c 6c20 6265 2061 7574 6f6d 6174 6963  ill be automatic
+00003da0: 616c 6c79 206d 6f76 6564 2074 6f20 636f  ally moved to co
+00003db0: 6f72 6473 2c20 7365 6520 6265 6c6f 7729  ords, see below)
+00003dc0: 0a0a 2020 2020 2020 2020 4561 6368 2064  ..        Each d
+00003dd0: 696d 656e 7369 6f6e 206d 7573 7420 6861  imension must ha
+00003de0: 7665 2074 6865 2073 616d 6520 6c65 6e67  ve the same leng
+00003df0: 7468 2069 6e20 616c 6c20 7661 7269 6162  th in all variab
+00003e00: 6c65 7320 696e 0a20 2020 2020 2020 2077  les in.        w
+00003e10: 6869 6368 2069 7420 6170 7065 6172 732e  hich it appears.
+00003e20: 0a20 2020 2063 6f6f 7264 7320 3a20 6469  .    coords : di
+00003e30: 6374 2d6c 696b 652c 206f 7074 696f 6e61  ct-like, optiona
+00003e40: 6c0a 2020 2020 2020 2020 416e 6f74 6865  l.        Anothe
+00003e50: 7220 6d61 7070 696e 6720 696e 2073 696d  r mapping in sim
+00003e60: 696c 6172 2066 6f72 6d20 6173 2074 6865  ilar form as the
+00003e70: 2060 6461 7461 5f76 6172 7360 2061 7267   `data_vars` arg
+00003e80: 756d 656e 742c 0a20 2020 2020 2020 2065  ument,.        e
+00003e90: 7863 6570 7420 7468 6520 6561 6368 2069  xcept the each i
+00003ea0: 7465 6d20 6973 2073 6176 6564 206f 6e20  tem is saved on 
+00003eb0: 7468 6520 6461 7461 7365 7420 6173 2061  the dataset as a
+00003ec0: 2022 636f 6f72 6469 6e61 7465 222e 0a20   "coordinate".. 
+00003ed0: 2020 2020 2020 2054 6865 7365 2076 6172         These var
+00003ee0: 6961 626c 6573 2068 6176 6520 616e 2061  iables have an a
+00003ef0: 7373 6f63 6961 7465 6420 6d65 616e 696e  ssociated meanin
+00003f00: 673a 2074 6865 7920 6465 7363 7269 6265  g: they describe
+00003f10: 0a20 2020 2020 2020 2063 6f6e 7374 616e  .        constan
+00003f20: 742f 6669 7865 642f 696e 6465 7065 6e64  t/fixed/independ
+00003f30: 656e 7420 7175 616e 7469 7469 6573 2c20  ent quantities, 
+00003f40: 756e 6c69 6b65 2074 6865 0a20 2020 2020  unlike the.     
+00003f50: 2020 2076 6172 7969 6e67 2f6d 6561 7375     varying/measu
+00003f60: 7265 642f 6465 7065 6e64 656e 7420 7175  red/dependent qu
+00003f70: 616e 7469 7469 6573 2074 6861 7420 6265  antities that be
+00003f80: 6c6f 6e67 2069 6e0a 2020 2020 2020 2020  long in.        
+00003f90: 6076 6172 6961 626c 6573 602e 2043 6f6f  `variables`. Coo
+00003fa0: 7264 696e 6174 6573 2076 616c 7565 7320  rdinates values 
+00003fb0: 6d61 7920 6265 2067 6976 656e 2062 7920  may be given by 
+00003fc0: 312d 6469 6d65 6e73 696f 6e61 6c0a 2020  1-dimensional.  
+00003fd0: 2020 2020 2020 6172 7261 7973 206f 7220        arrays or 
+00003fe0: 7363 616c 6172 732c 2069 6e20 7768 6963  scalars, in whic
+00003ff0: 6820 6361 7365 2060 6469 6d73 6020 646f  h case `dims` do
+00004000: 206e 6f74 206e 6565 6420 746f 2062 650a   not need to be.
+00004010: 2020 2020 2020 2020 7375 7070 6c69 6564          supplied
+00004020: 3a20 3144 2061 7272 6179 7320 7769 6c6c  : 1D arrays will
+00004030: 2062 6520 6173 7375 6d65 6420 746f 2067   be assumed to g
+00004040: 6976 6520 696e 6465 7820 7661 6c75 6573  ive index values
+00004050: 2061 6c6f 6e67 0a20 2020 2020 2020 2074   along.        t
+00004060: 6865 2064 696d 656e 7369 6f6e 2077 6974  he dimension wit
+00004070: 6820 7468 6520 7361 6d65 206e 616d 652e  h the same name.
+00004080: 0a0a 2020 2020 2020 2020 5468 6520 666f  ..        The fo
+00004090: 6c6c 6f77 696e 6720 6e6f 7461 7469 6f6e  llowing notation
+000040a0: 7320 6172 6520 6163 6365 7074 6564 3a0a  s are accepted:.
+000040b0: 0a20 2020 2020 2020 202d 206d 6170 7069  .        - mappi
+000040c0: 6e67 207b 636f 6f72 6420 6e61 6d65 3a20  ng {coord name: 
+000040d0: 4461 7461 4172 7261 797d 0a20 2020 2020  DataArray}.     
+000040e0: 2020 202d 206d 6170 7069 6e67 207b 636f     - mapping {co
+000040f0: 6f72 6420 6e61 6d65 3a20 5661 7269 6162  ord name: Variab
+00004100: 6c65 7d0a 2020 2020 2020 2020 2d20 6d61  le}.        - ma
+00004110: 7070 696e 6720 7b63 6f6f 7264 206e 616d  pping {coord nam
+00004120: 653a 2028 6469 6d65 6e73 696f 6e20 6e61  e: (dimension na
+00004130: 6d65 2c20 6172 7261 792d 6c69 6b65 297d  me, array-like)}
+00004140: 0a20 2020 2020 2020 202d 206d 6170 7069  .        - mappi
+00004150: 6e67 207b 636f 6f72 6420 6e61 6d65 3a20  ng {coord name: 
+00004160: 2874 7570 6c65 206f 6620 6469 6d65 6e73  (tuple of dimens
+00004170: 696f 6e20 6e61 6d65 732c 2061 7272 6179  ion names, array
+00004180: 2d6c 696b 6529 7d0a 2020 2020 2020 2020  -like)}.        
+00004190: 2d20 6d61 7070 696e 6720 7b64 696d 656e  - mapping {dimen
+000041a0: 7369 6f6e 206e 616d 653a 2061 7272 6179  sion name: array
+000041b0: 2d6c 696b 657d 0a20 2020 2020 2020 2020  -like}.         
+000041c0: 2028 7468 6520 6469 6d65 6e73 696f 6e20   (the dimension 
+000041d0: 6e61 6d65 2069 7320 696d 706c 6963 6974  name is implicit
+000041e0: 6c79 2073 6574 2074 6f20 6265 2074 6865  ly set to be the
+000041f0: 2073 616d 6520 6173 2074 6865 0a20 2020   same as the.   
+00004200: 2020 2020 2020 2063 6f6f 7264 206e 616d         coord nam
+00004210: 6529 0a0a 2020 2020 2020 2020 5468 6520  e)..        The 
+00004220: 6c61 7374 206e 6f74 6174 696f 6e20 696d  last notation im
+00004230: 706c 6965 7320 7468 6174 2074 6865 2063  plies that the c
+00004240: 6f6f 7264 206e 616d 6520 6973 2074 6865  oord name is the
+00004250: 2073 616d 6520 6173 0a20 2020 2020 2020   same as.       
+00004260: 2074 6865 2064 696d 656e 7369 6f6e 206e   the dimension n
+00004270: 616d 652e 0a0a 2020 2020 6174 7472 7320  ame...    attrs 
+00004280: 3a20 6469 6374 2d6c 696b 652c 206f 7074  : dict-like, opt
+00004290: 696f 6e61 6c0a 2020 2020 2020 2020 476c  ional.        Gl
+000042a0: 6f62 616c 2061 7474 7269 6275 7465 7320  obal attributes 
+000042b0: 746f 2073 6176 6520 6f6e 2074 6869 7320  to save on this 
+000042c0: 6461 7461 7365 742e 0a0a 2020 2020 4578  dataset...    Ex
+000042d0: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
+000042e0: 2d2d 2d0a 2020 2020 4372 6561 7465 2064  ---.    Create d
+000042f0: 6174 613a 0a0a 2020 2020 3e3e 3e20 6e70  ata:..    >>> np
+00004300: 2e72 616e 646f 6d2e 7365 6564 2830 290a  .random.seed(0).
+00004310: 2020 2020 3e3e 3e20 7465 6d70 6572 6174      >>> temperat
+00004320: 7572 6520 3d20 3135 202b 2038 202a 206e  ure = 15 + 8 * n
+00004330: 702e 7261 6e64 6f6d 2e72 616e 646e 2832  p.random.randn(2
+00004340: 2c20 322c 2033 290a 2020 2020 3e3e 3e20  , 2, 3).    >>> 
+00004350: 7072 6563 6970 6974 6174 696f 6e20 3d20  precipitation = 
+00004360: 3130 202a 206e 702e 7261 6e64 6f6d 2e72  10 * np.random.r
+00004370: 616e 6428 322c 2032 2c20 3329 0a20 2020  and(2, 2, 3).   
+00004380: 203e 3e3e 206c 6f6e 203d 205b 5b2d 3939   >>> lon = [[-99
+00004390: 2e38 332c 202d 3939 2e33 325d 2c20 5b2d  .83, -99.32], [-
+000043a0: 3939 2e37 392c 202d 3939 2e32 335d 5d0a  99.79, -99.23]].
+000043b0: 2020 2020 3e3e 3e20 6c61 7420 3d20 5b5b      >>> lat = [[
+000043c0: 3432 2e32 352c 2034 322e 3231 5d2c 205b  42.25, 42.21], [
+000043d0: 3432 2e36 332c 2034 322e 3539 5d5d 0a20  42.63, 42.59]]. 
+000043e0: 2020 203e 3e3e 2074 696d 6520 3d20 7064     >>> time = pd
+000043f0: 2e64 6174 655f 7261 6e67 6528 2232 3031  .date_range("201
+00004400: 342d 3039 2d30 3622 2c20 7065 7269 6f64  4-09-06", period
+00004410: 733d 3329 0a20 2020 203e 3e3e 2072 6566  s=3).    >>> ref
+00004420: 6572 656e 6365 5f74 696d 6520 3d20 7064  erence_time = pd
+00004430: 2e54 696d 6573 7461 6d70 2822 3230 3134  .Timestamp("2014
+00004440: 2d30 392d 3035 2229 0a0a 2020 2020 496e  -09-05")..    In
+00004450: 6974 6961 6c69 7a65 2061 2064 6174 6173  itialize a datas
+00004460: 6574 2077 6974 6820 6d75 6c74 6970 6c65  et with multiple
+00004470: 2064 696d 656e 7369 6f6e 733a 0a0a 2020   dimensions:..  
+00004480: 2020 3e3e 3e20 6473 203d 2078 722e 4461    >>> ds = xr.Da
+00004490: 7461 7365 7428 0a20 2020 202e 2e2e 2020  taset(.    ...  
+000044a0: 2020 2064 6174 615f 7661 7273 3d64 6963     data_vars=dic
+000044b0: 7428 0a20 2020 202e 2e2e 2020 2020 2020  t(.    ...      
+000044c0: 2020 2074 656d 7065 7261 7475 7265 3d28     temperature=(
+000044d0: 5b22 7822 2c20 2279 222c 2022 7469 6d65  ["x", "y", "time
+000044e0: 225d 2c20 7465 6d70 6572 6174 7572 6529  "], temperature)
+000044f0: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
+00004500: 2020 7072 6563 6970 6974 6174 696f 6e3d    precipitation=
+00004510: 285b 2278 222c 2022 7922 2c20 2274 696d  (["x", "y", "tim
+00004520: 6522 5d2c 2070 7265 6369 7069 7461 7469  e"], precipitati
+00004530: 6f6e 292c 0a20 2020 202e 2e2e 2020 2020  on),.    ...    
+00004540: 2029 2c0a 2020 2020 2e2e 2e20 2020 2020   ),.    ...     
+00004550: 636f 6f72 6473 3d64 6963 7428 0a20 2020  coords=dict(.   
+00004560: 202e 2e2e 2020 2020 2020 2020 206c 6f6e   ...         lon
+00004570: 3d28 5b22 7822 2c20 2279 225d 2c20 6c6f  =(["x", "y"], lo
+00004580: 6e29 2c0a 2020 2020 2e2e 2e20 2020 2020  n),.    ...     
+00004590: 2020 2020 6c61 743d 285b 2278 222c 2022      lat=(["x", "
+000045a0: 7922 5d2c 206c 6174 292c 0a20 2020 202e  y"], lat),.    .
+000045b0: 2e2e 2020 2020 2020 2020 2074 696d 653d  ..         time=
+000045c0: 7469 6d65 2c0a 2020 2020 2e2e 2e20 2020  time,.    ...   
+000045d0: 2020 2020 2020 7265 6665 7265 6e63 655f        reference_
+000045e0: 7469 6d65 3d72 6566 6572 656e 6365 5f74  time=reference_t
+000045f0: 696d 652c 0a20 2020 202e 2e2e 2020 2020  ime,.    ...    
+00004600: 2029 2c0a 2020 2020 2e2e 2e20 2020 2020   ),.    ...     
+00004610: 6174 7472 733d 6469 6374 2864 6573 6372  attrs=dict(descr
+00004620: 6970 7469 6f6e 3d22 5765 6174 6865 7220  iption="Weather 
+00004630: 7265 6c61 7465 6420 6461 7461 2e22 292c  related data."),
+00004640: 0a20 2020 202e 2e2e 2029 0a20 2020 203e  .    ... ).    >
+00004650: 3e3e 2064 730a 2020 2020 3c78 6172 7261  >> ds.    <xarra
+00004660: 792e 4461 7461 7365 743e 0a20 2020 2044  y.Dataset>.    D
+00004670: 696d 656e 7369 6f6e 733a 2020 2020 2020  imensions:      
+00004680: 2020 2028 783a 2032 2c20 793a 2032 2c20     (x: 2, y: 2, 
+00004690: 7469 6d65 3a20 3329 0a20 2020 2043 6f6f  time: 3).    Coo
+000046a0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+000046b0: 2020 6c6f 6e20 2020 2020 2020 2020 2020    lon           
+000046c0: 2020 2878 2c20 7929 2066 6c6f 6174 3634    (x, y) float64
+000046d0: 202d 3939 2e38 3320 2d39 392e 3332 202d   -99.83 -99.32 -
+000046e0: 3939 2e37 3920 2d39 392e 3233 0a20 2020  99.79 -99.23.   
+000046f0: 2020 2020 206c 6174 2020 2020 2020 2020       lat        
+00004700: 2020 2020 2028 782c 2079 2920 666c 6f61       (x, y) floa
+00004710: 7436 3420 3432 2e32 3520 3432 2e32 3120  t64 42.25 42.21 
+00004720: 3432 2e36 3320 3432 2e35 390a 2020 2020  42.63 42.59.    
+00004730: 2020 2a20 7469 6d65 2020 2020 2020 2020    * time        
+00004740: 2020 2020 2874 696d 6529 2064 6174 6574      (time) datet
+00004750: 696d 6536 345b 6e73 5d20 3230 3134 2d30  ime64[ns] 2014-0
+00004760: 392d 3036 2032 3031 342d 3039 2d30 3720  9-06 2014-09-07 
+00004770: 3230 3134 2d30 392d 3038 0a20 2020 2020  2014-09-08.     
+00004780: 2020 2072 6566 6572 656e 6365 5f74 696d     reference_tim
+00004790: 6520 2064 6174 6574 696d 6536 345b 6e73  e  datetime64[ns
+000047a0: 5d20 3230 3134 2d30 392d 3035 0a20 2020  ] 2014-09-05.   
+000047b0: 2044 696d 656e 7369 6f6e 7320 7769 7468   Dimensions with
+000047c0: 6f75 7420 636f 6f72 6469 6e61 7465 733a  out coordinates:
+000047d0: 2078 2c20 790a 2020 2020 4461 7461 2076   x, y.    Data v
+000047e0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+000047f0: 2020 7465 6d70 6572 6174 7572 6520 2020    temperature   
+00004800: 2020 2878 2c20 792c 2074 696d 6529 2066    (x, y, time) f
+00004810: 6c6f 6174 3634 2032 392e 3131 2031 382e  loat64 29.11 18.
+00004820: 3220 3232 2e38 3320 2e2e 2e20 3138 2e32  2 22.83 ... 18.2
+00004830: 3820 3136 2e31 3520 3236 2e36 330a 2020  8 16.15 26.63.  
+00004840: 2020 2020 2020 7072 6563 6970 6974 6174        precipitat
+00004850: 696f 6e20 2020 2878 2c20 792c 2074 696d  ion   (x, y, tim
+00004860: 6529 2066 6c6f 6174 3634 2035 2e36 3820  e) float64 5.68 
+00004870: 392e 3235 3620 302e 3731 3034 202e 2e2e  9.256 0.7104 ...
+00004880: 2037 2e39 3932 2034 2e36 3135 2037 2e38   7.992 4.615 7.8
+00004890: 3035 0a20 2020 2041 7474 7269 6275 7465  05.    Attribute
+000048a0: 733a 0a20 2020 2020 2020 2064 6573 6372  s:.        descr
+000048b0: 6970 7469 6f6e 3a20 2057 6561 7468 6572  iption:  Weather
+000048c0: 2072 656c 6174 6564 2064 6174 612e 0a0a   related data...
+000048d0: 2020 2020 4669 6e64 206f 7574 2077 6865      Find out whe
+000048e0: 7265 2074 6865 2063 6f6c 6465 7374 2074  re the coldest t
+000048f0: 656d 7065 7261 7475 7265 2077 6173 2061  emperature was a
+00004900: 6e64 2077 6861 7420 7661 6c75 6573 2074  nd what values t
+00004910: 6865 0a20 2020 206f 7468 6572 2076 6172  he.    other var
+00004920: 6961 626c 6573 2068 6164 3a0a 0a20 2020  iables had:..   
+00004930: 203e 3e3e 2064 732e 6973 656c 2864 732e   >>> ds.isel(ds.
+00004940: 7465 6d70 6572 6174 7572 652e 6172 676d  temperature.argm
+00004950: 696e 282e 2e2e 2929 0a20 2020 203c 7861  in(...)).    <xa
+00004960: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+00004970: 2020 4469 6d65 6e73 696f 6e73 3a20 2020    Dimensions:   
+00004980: 2020 2020 2020 2829 0a20 2020 2043 6f6f        ().    Coo
+00004990: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+000049a0: 2020 6c6f 6e20 2020 2020 2020 2020 2020    lon           
+000049b0: 2020 666c 6f61 7436 3420 2d39 392e 3332    float64 -99.32
+000049c0: 0a20 2020 2020 2020 206c 6174 2020 2020  .        lat    
+000049d0: 2020 2020 2020 2020 2066 6c6f 6174 3634           float64
+000049e0: 2034 322e 3231 0a20 2020 2020 2020 2074   42.21.        t
+000049f0: 696d 6520 2020 2020 2020 2020 2020 2064  ime            d
+00004a00: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
+00004a10: 3134 2d30 392d 3038 0a20 2020 2020 2020  14-09-08.       
+00004a20: 2072 6566 6572 656e 6365 5f74 696d 6520   reference_time 
+00004a30: 2064 6174 6574 696d 6536 345b 6e73 5d20   datetime64[ns] 
+00004a40: 3230 3134 2d30 392d 3035 0a20 2020 2044  2014-09-05.    D
+00004a50: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+00004a60: 2020 2020 2020 2074 656d 7065 7261 7475         temperatu
+00004a70: 7265 2020 2020 2066 6c6f 6174 3634 2037  re     float64 7
+00004a80: 2e31 3832 0a20 2020 2020 2020 2070 7265  .182.        pre
+00004a90: 6369 7069 7461 7469 6f6e 2020 2066 6c6f  cipitation   flo
+00004aa0: 6174 3634 2038 2e33 3236 0a20 2020 2041  at64 8.326.    A
+00004ab0: 7474 7269 6275 7465 733a 0a20 2020 2020  ttributes:.     
+00004ac0: 2020 2064 6573 6372 6970 7469 6f6e 3a20     description: 
+00004ad0: 2057 6561 7468 6572 2072 656c 6174 6564   Weather related
+00004ae0: 2064 6174 612e 0a20 2020 2022 2222 0a0a   data..    """..
+00004af0: 2020 2020 5f61 7474 7273 3a20 6469 6374      _attrs: dict
+00004b00: 5b48 6173 6861 626c 652c 2041 6e79 5d20  [Hashable, Any] 
+00004b10: 7c20 4e6f 6e65 0a20 2020 205f 6361 6368  | None.    _cach
+00004b20: 653a 2064 6963 745b 7374 722c 2041 6e79  e: dict[str, Any
+00004b30: 5d0a 2020 2020 5f63 6f6f 7264 5f6e 616d  ].    _coord_nam
+00004b40: 6573 3a20 7365 745b 4861 7368 6162 6c65  es: set[Hashable
+00004b50: 5d0a 2020 2020 5f64 696d 733a 2064 6963  ].    _dims: dic
+00004b60: 745b 4861 7368 6162 6c65 2c20 696e 745d  t[Hashable, int]
+00004b70: 0a20 2020 205f 656e 636f 6469 6e67 3a20  .    _encoding: 
+00004b80: 6469 6374 5b48 6173 6861 626c 652c 2041  dict[Hashable, A
+00004b90: 6e79 5d20 7c20 4e6f 6e65 0a20 2020 205f  ny] | None.    _
+00004ba0: 636c 6f73 653a 2043 616c 6c61 626c 655b  close: Callable[
+00004bb0: 5b5d 2c20 4e6f 6e65 5d20 7c20 4e6f 6e65  [], None] | None
+00004bc0: 0a20 2020 205f 696e 6465 7865 733a 2064  .    _indexes: d
+00004bd0: 6963 745b 4861 7368 6162 6c65 2c20 496e  ict[Hashable, In
+00004be0: 6465 785d 0a20 2020 205f 7661 7269 6162  dex].    _variab
+00004bf0: 6c65 733a 2064 6963 745b 4861 7368 6162  les: dict[Hashab
+00004c00: 6c65 2c20 5661 7269 6162 6c65 5d0a 0a20  le, Variable].. 
+00004c10: 2020 205f 5f73 6c6f 7473 5f5f 203d 2028     __slots__ = (
+00004c20: 0a20 2020 2020 2020 2022 5f61 7474 7273  .        "_attrs
+00004c30: 222c 0a20 2020 2020 2020 2022 5f63 6163  ",.        "_cac
+00004c40: 6865 222c 0a20 2020 2020 2020 2022 5f63  he",.        "_c
+00004c50: 6f6f 7264 5f6e 616d 6573 222c 0a20 2020  oord_names",.   
+00004c60: 2020 2020 2022 5f64 696d 7322 2c0a 2020       "_dims",.  
+00004c70: 2020 2020 2020 225f 656e 636f 6469 6e67        "_encoding
+00004c80: 222c 0a20 2020 2020 2020 2022 5f63 6c6f  ",.        "_clo
+00004c90: 7365 222c 0a20 2020 2020 2020 2022 5f69  se",.        "_i
+00004ca0: 6e64 6578 6573 222c 0a20 2020 2020 2020  ndexes",.       
+00004cb0: 2022 5f76 6172 6961 626c 6573 222c 0a20   "_variables",. 
+00004cc0: 2020 2020 2020 2022 5f5f 7765 616b 7265         "__weakre
+00004cd0: 665f 5f22 2c0a 2020 2020 290a 0a20 2020  f__",.    )..   
+00004ce0: 2064 6566 205f 5f69 6e69 745f 5f28 0a20   def __init__(. 
+00004cf0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00004d00: 2020 2020 2023 2063 6f75 6c64 206d 616b       # could mak
+00004d10: 6520 6120 5661 7269 6162 6c65 4172 6773  e a VariableArgs
+00004d20: 2074 6f20 7573 6520 6d6f 7265 2067 656e   to use more gen
+00004d30: 6572 616c 6c79 2c20 616e 6420 7265 6669  erally, and refi
+00004d40: 6e65 2074 6865 7365 0a20 2020 2020 2020  ne these.       
+00004d50: 2023 2063 6174 6567 6f72 6965 730a 2020   # categories.  
+00004d60: 2020 2020 2020 6461 7461 5f76 6172 733a        data_vars:
+00004d70: 204d 6170 7069 6e67 5b41 6e79 2c20 416e   Mapping[Any, An
+00004d80: 795d 207c 204e 6f6e 6520 3d20 4e6f 6e65  y] | None = None
+00004d90: 2c0a 2020 2020 2020 2020 636f 6f72 6473  ,.        coords
+00004da0: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
+00004db0: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
+00004dc0: 652c 0a20 2020 2020 2020 2061 7474 7273  e,.        attrs
+00004dd0: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
+00004de0: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
+00004df0: 652c 0a20 2020 2029 202d 3e20 4e6f 6e65  e,.    ) -> None
+00004e00: 3a0a 2020 2020 2020 2020 2320 544f 444f  :.        # TODO
+00004e10: 2873 686f 7965 7229 3a20 6578 706f 7365  (shoyer): expose
+00004e20: 2069 6e64 6578 6573 2061 7320 6120 7075   indexes as a pu
+00004e30: 626c 6963 2061 7267 756d 656e 7420 696e  blic argument in
+00004e40: 205f 5f69 6e69 745f 5f0a 0a20 2020 2020   __init__..     
+00004e50: 2020 2069 6620 6461 7461 5f76 6172 7320     if data_vars 
+00004e60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00004e70: 2020 2020 2064 6174 615f 7661 7273 203d       data_vars =
+00004e80: 207b 7d0a 2020 2020 2020 2020 6966 2063   {}.        if c
+00004e90: 6f6f 7264 7320 6973 204e 6f6e 653a 0a20  oords is None:. 
+00004ea0: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
+00004eb0: 7320 3d20 7b7d 0a0a 2020 2020 2020 2020  s = {}..        
+00004ec0: 626f 7468 5f64 6174 615f 616e 645f 636f  both_data_and_co
+00004ed0: 6f72 6473 203d 2073 6574 2864 6174 615f  ords = set(data_
+00004ee0: 7661 7273 2920 2620 7365 7428 636f 6f72  vars) & set(coor
+00004ef0: 6473 290a 2020 2020 2020 2020 6966 2062  ds).        if b
+00004f00: 6f74 685f 6461 7461 5f61 6e64 5f63 6f6f  oth_data_and_coo
+00004f10: 7264 733a 0a20 2020 2020 2020 2020 2020  rds:.           
+00004f20: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00004f30: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00004f40: 2020 2066 2276 6172 6961 626c 6573 207b     f"variables {
+00004f50: 626f 7468 5f64 6174 615f 616e 645f 636f  both_data_and_co
+00004f60: 6f72 6473 2172 7d20 6172 6520 666f 756e  ords!r} are foun
+00004f70: 6420 696e 2062 6f74 6820 6461 7461 5f76  d in both data_v
+00004f80: 6172 7320 616e 6420 636f 6f72 6473 220a  ars and coords".
+00004f90: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00004fa0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00004fb0: 616e 6365 2863 6f6f 7264 732c 2044 6174  ance(coords, Dat
+00004fc0: 6173 6574 293a 0a20 2020 2020 2020 2020  aset):.         
+00004fd0: 2020 2063 6f6f 7264 7320 3d20 636f 6f72     coords = coor
+00004fe0: 6473 2e76 6172 6961 626c 6573 0a0a 2020  ds.variables..  
+00004ff0: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
+00005000: 2063 6f6f 7264 5f6e 616d 6573 2c20 6469   coord_names, di
+00005010: 6d73 2c20 696e 6465 7865 732c 205f 203d  ms, indexes, _ =
+00005020: 206d 6572 6765 5f64 6174 615f 616e 645f   merge_data_and_
+00005030: 636f 6f72 6473 280a 2020 2020 2020 2020  coords(.        
+00005040: 2020 2020 6461 7461 5f76 6172 732c 2063      data_vars, c
+00005050: 6f6f 7264 732c 2063 6f6d 7061 743d 2262  oords, compat="b
+00005060: 726f 6164 6361 7374 5f65 7175 616c 7322  roadcast_equals"
+00005070: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00005080: 2020 2020 7365 6c66 2e5f 6174 7472 7320      self._attrs 
+00005090: 3d20 6469 6374 2861 7474 7273 2920 6966  = dict(attrs) if
+000050a0: 2061 7474 7273 2069 7320 6e6f 7420 4e6f   attrs is not No
+000050b0: 6e65 2065 6c73 6520 4e6f 6e65 0a20 2020  ne else None.   
+000050c0: 2020 2020 2073 656c 662e 5f63 6c6f 7365       self._close
+000050d0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000050e0: 7365 6c66 2e5f 656e 636f 6469 6e67 203d  self._encoding =
+000050f0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00005100: 6c66 2e5f 7661 7269 6162 6c65 7320 3d20  lf._variables = 
+00005110: 7661 7269 6162 6c65 730a 2020 2020 2020  variables.      
+00005120: 2020 7365 6c66 2e5f 636f 6f72 645f 6e61    self._coord_na
+00005130: 6d65 7320 3d20 636f 6f72 645f 6e61 6d65  mes = coord_name
+00005140: 730a 2020 2020 2020 2020 7365 6c66 2e5f  s.        self._
+00005150: 6469 6d73 203d 2064 696d 730a 2020 2020  dims = dims.    
+00005160: 2020 2020 7365 6c66 2e5f 696e 6465 7865      self._indexe
+00005170: 7320 3d20 696e 6465 7865 730a 0a20 2020  s = indexes..   
+00005180: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00005190: 2020 6465 6620 6c6f 6164 5f73 746f 7265    def load_store
+000051a0: 2863 6c73 3a20 7479 7065 5b54 5f44 6174  (cls: type[T_Dat
+000051b0: 6173 6574 5d2c 2073 746f 7265 2c20 6465  aset], store, de
+000051c0: 636f 6465 723d 4e6f 6e65 2920 2d3e 2054  coder=None) -> T
+000051d0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+000051e0: 2020 2222 2243 7265 6174 6520 6120 6e65    """Create a ne
+000051f0: 7720 6461 7461 7365 7420 6672 6f6d 2074  w dataset from t
+00005200: 6865 2063 6f6e 7465 6e74 7320 6f66 2061  he contents of a
+00005210: 2062 6163 6b65 6e64 732e 2a44 6174 6153   backends.*DataS
+00005220: 746f 7265 0a20 2020 2020 2020 206f 626a  tore.        obj
+00005230: 6563 740a 2020 2020 2020 2020 2222 220a  ect.        """.
+00005240: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00005250: 732c 2061 7474 7269 6275 7465 7320 3d20  s, attributes = 
+00005260: 7374 6f72 652e 6c6f 6164 2829 0a20 2020  store.load().   
+00005270: 2020 2020 2069 6620 6465 636f 6465 723a       if decoder:
+00005280: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
+00005290: 6961 626c 6573 2c20 6174 7472 6962 7574  iables, attribut
+000052a0: 6573 203d 2064 6563 6f64 6572 2876 6172  es = decoder(var
+000052b0: 6961 626c 6573 2c20 6174 7472 6962 7574  iables, attribut
+000052c0: 6573 290a 2020 2020 2020 2020 6f62 6a20  es).        obj 
+000052d0: 3d20 636c 7328 7661 7269 6162 6c65 732c  = cls(variables,
+000052e0: 2061 7474 7273 3d61 7474 7269 6275 7465   attrs=attribute
+000052f0: 7329 0a20 2020 2020 2020 206f 626a 2e73  s).        obj.s
+00005300: 6574 5f63 6c6f 7365 2873 746f 7265 2e63  et_close(store.c
+00005310: 6c6f 7365 290a 2020 2020 2020 2020 7265  lose).        re
+00005320: 7475 726e 206f 626a 0a0a 2020 2020 4070  turn obj..    @p
+00005330: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00005340: 7661 7269 6162 6c65 7328 7365 6c66 2920  variables(self) 
+00005350: 2d3e 2046 726f 7a65 6e5b 4861 7368 6162  -> Frozen[Hashab
+00005360: 6c65 2c20 5661 7269 6162 6c65 5d3a 0a20  le, Variable]:. 
+00005370: 2020 2020 2020 2022 2222 4c6f 7720 6c65         """Low le
+00005380: 7665 6c20 696e 7465 7266 6163 6520 746f  vel interface to
+00005390: 2044 6174 6173 6574 2063 6f6e 7465 6e74   Dataset content
+000053a0: 7320 6173 2064 6963 7420 6f66 2056 6172  s as dict of Var
+000053b0: 6961 626c 6520 6f62 6a65 6374 732e 0a0a  iable objects...
+000053c0: 2020 2020 2020 2020 5468 6973 206f 7264          This ord
+000053d0: 6572 6564 2064 6963 7469 6f6e 6172 7920  ered dictionary 
+000053e0: 6973 2066 726f 7a65 6e20 746f 2070 7265  is frozen to pre
+000053f0: 7665 6e74 206d 7574 6174 696f 6e20 7468  vent mutation th
+00005400: 6174 2063 6f75 6c64 0a20 2020 2020 2020  at could.       
+00005410: 2076 696f 6c61 7465 2044 6174 6173 6574   violate Dataset
+00005420: 2069 6e76 6172 6961 6e74 732e 2049 7420   invariants. It 
+00005430: 636f 6e74 6169 6e73 2061 6c6c 2076 6172  contains all var
+00005440: 6961 626c 6520 6f62 6a65 6374 730a 2020  iable objects.  
+00005450: 2020 2020 2020 636f 6e73 7469 7475 7469        constituti
+00005460: 6e67 2074 6865 2044 6174 6173 6574 2c20  ng the Dataset, 
+00005470: 696e 636c 7564 696e 6720 626f 7468 2064  including both d
+00005480: 6174 6120 7661 7269 6162 6c65 7320 616e  ata variables an
+00005490: 640a 2020 2020 2020 2020 636f 6f72 6469  d.        coordi
+000054a0: 6e61 7465 732e 0a20 2020 2020 2020 2022  nates..        "
+000054b0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+000054c0: 6e20 4672 6f7a 656e 2873 656c 662e 5f76  n Frozen(self._v
+000054d0: 6172 6961 626c 6573 290a 0a20 2020 2040  ariables)..    @
+000054e0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+000054f0: 2061 7474 7273 2873 656c 6629 202d 3e20   attrs(self) -> 
+00005500: 6469 6374 5b41 6e79 2c20 416e 795d 3a0a  dict[Any, Any]:.
+00005510: 2020 2020 2020 2020 2222 2244 6963 7469          """Dicti
+00005520: 6f6e 6172 7920 6f66 2067 6c6f 6261 6c20  onary of global 
+00005530: 6174 7472 6962 7574 6573 206f 6e20 7468  attributes on th
+00005540: 6973 2064 6174 6173 6574 2222 220a 2020  is dataset""".  
+00005550: 2020 2020 2020 6966 2073 656c 662e 5f61        if self._a
+00005560: 7474 7273 2069 7320 4e6f 6e65 3a0a 2020  ttrs is None:.  
+00005570: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00005580: 6174 7472 7320 3d20 7b7d 0a20 2020 2020  attrs = {}.     
+00005590: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000055a0: 6174 7472 730a 0a20 2020 2040 6174 7472  attrs..    @attr
+000055b0: 732e 7365 7474 6572 0a20 2020 2064 6566  s.setter.    def
+000055c0: 2061 7474 7273 2873 656c 662c 2076 616c   attrs(self, val
+000055d0: 7565 3a20 4d61 7070 696e 675b 416e 792c  ue: Mapping[Any,
+000055e0: 2041 6e79 5d29 202d 3e20 4e6f 6e65 3a0a   Any]) -> None:.
+000055f0: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
+00005600: 7472 7320 3d20 6469 6374 2876 616c 7565  trs = dict(value
+00005610: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+00005620: 0a20 2020 2064 6566 2065 6e63 6f64 696e  .    def encodin
+00005630: 6728 7365 6c66 2920 2d3e 2064 6963 745b  g(self) -> dict[
+00005640: 416e 792c 2041 6e79 5d3a 0a20 2020 2020  Any, Any]:.     
+00005650: 2020 2022 2222 4469 6374 696f 6e61 7279     """Dictionary
+00005660: 206f 6620 676c 6f62 616c 2065 6e63 6f64   of global encod
+00005670: 696e 6720 6174 7472 6962 7574 6573 206f  ing attributes o
+00005680: 6e20 7468 6973 2064 6174 6173 6574 2222  n this dataset""
+00005690: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
+000056a0: 662e 5f65 6e63 6f64 696e 6720 6973 204e  f._encoding is N
+000056b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000056c0: 2073 656c 662e 5f65 6e63 6f64 696e 6720   self._encoding 
+000056d0: 3d20 7b7d 0a20 2020 2020 2020 2072 6574  = {}.        ret
+000056e0: 7572 6e20 7365 6c66 2e5f 656e 636f 6469  urn self._encodi
+000056f0: 6e67 0a0a 2020 2020 4065 6e63 6f64 696e  ng..    @encodin
+00005700: 672e 7365 7474 6572 0a20 2020 2064 6566  g.setter.    def
+00005710: 2065 6e63 6f64 696e 6728 7365 6c66 2c20   encoding(self, 
+00005720: 7661 6c75 653a 204d 6170 7069 6e67 5b41  value: Mapping[A
+00005730: 6e79 2c20 416e 795d 2920 2d3e 204e 6f6e  ny, Any]) -> Non
+00005740: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
+00005750: 5f65 6e63 6f64 696e 6720 3d20 6469 6374  _encoding = dict
+00005760: 2876 616c 7565 290a 0a20 2020 2064 6566  (value)..    def
+00005770: 2072 6573 6574 5f65 6e63 6f64 696e 6728   reset_encoding(
+00005780: 7365 6c66 3a20 545f 4461 7461 7365 7429  self: T_Dataset)
+00005790: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+000057a0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+000057b0: 2061 206e 6577 2044 6174 6173 6574 2077   a new Dataset w
+000057c0: 6974 686f 7574 2065 6e63 6f64 696e 6720  ithout encoding 
+000057d0: 6f6e 2074 6865 2064 6174 6173 6574 206f  on the dataset o
+000057e0: 7220 616e 7920 6f66 2069 7473 0a20 2020  r any of its.   
+000057f0: 2020 2020 2076 6172 6961 626c 6573 2f63       variables/c
+00005800: 6f6f 7264 732e 2222 220a 2020 2020 2020  oords.""".      
+00005810: 2020 7661 7269 6162 6c65 7320 3d20 7b6b    variables = {k
+00005820: 3a20 762e 7265 7365 745f 656e 636f 6469  : v.reset_encodi
+00005830: 6e67 2829 2066 6f72 206b 2c20 7620 696e  ng() for k, v in
+00005840: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
+00005850: 6974 656d 7328 297d 0a20 2020 2020 2020  items()}.       
+00005860: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+00005870: 706c 6163 6528 7661 7269 6162 6c65 733d  place(variables=
+00005880: 7661 7269 6162 6c65 732c 2065 6e63 6f64  variables, encod
+00005890: 696e 673d 7b7d 290a 0a20 2020 2040 7072  ing={})..    @pr
+000058a0: 6f70 6572 7479 0a20 2020 2064 6566 2064  operty.    def d
+000058b0: 696d 7328 7365 6c66 2920 2d3e 2046 726f  ims(self) -> Fro
+000058c0: 7a65 6e5b 4861 7368 6162 6c65 2c20 696e  zen[Hashable, in
+000058d0: 745d 3a0a 2020 2020 2020 2020 2222 224d  t]:.        """M
+000058e0: 6170 7069 6e67 2066 726f 6d20 6469 6d65  apping from dime
+000058f0: 6e73 696f 6e20 6e61 6d65 7320 746f 206c  nsion names to l
+00005900: 656e 6774 6873 2e0a 0a20 2020 2020 2020  engths...       
+00005910: 2043 616e 6e6f 7420 6265 206d 6f64 6966   Cannot be modif
+00005920: 6965 6420 6469 7265 6374 6c79 2c20 6275  ied directly, bu
+00005930: 7420 6973 2075 7064 6174 6564 2077 6865  t is updated whe
+00005940: 6e20 6164 6469 6e67 206e 6577 2076 6172  n adding new var
+00005950: 6961 626c 6573 2e0a 0a20 2020 2020 2020  iables...       
+00005960: 204e 6f74 6520 7468 6174 2074 7970 6520   Note that type 
+00005970: 6f66 2074 6869 7320 6f62 6a65 6374 2064  of this object d
+00005980: 6966 6665 7273 2066 726f 6d20 6044 6174  iffers from `Dat
+00005990: 6141 7272 6179 2e64 696d 7360 2e0a 2020  aArray.dims`..  
+000059a0: 2020 2020 2020 5365 6520 6044 6174 6173        See `Datas
+000059b0: 6574 2e73 697a 6573 6020 616e 6420 6044  et.sizes` and `D
+000059c0: 6174 6141 7272 6179 2e73 697a 6573 6020  ataArray.sizes` 
+000059d0: 666f 7220 636f 6e73 6973 7465 6e74 6c79  for consistently
+000059e0: 206e 616d 6564 0a20 2020 2020 2020 2070   named.        p
+000059f0: 726f 7065 7274 6965 732e 0a0a 2020 2020  roperties...    
+00005a00: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+00005a10: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+00005a20: 2020 2020 2020 4461 7461 7365 742e 7369        Dataset.si
+00005a30: 7a65 730a 2020 2020 2020 2020 4461 7461  zes.        Data
+00005a40: 4172 7261 792e 6469 6d73 0a20 2020 2020  Array.dims.     
+00005a50: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00005a60: 6574 7572 6e20 4672 6f7a 656e 2873 656c  eturn Frozen(sel
+00005a70: 662e 5f64 696d 7329 0a0a 2020 2020 4070  f._dims)..    @p
+00005a80: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00005a90: 7369 7a65 7328 7365 6c66 2920 2d3e 2046  sizes(self) -> F
+00005aa0: 726f 7a65 6e5b 4861 7368 6162 6c65 2c20  rozen[Hashable, 
+00005ab0: 696e 745d 3a0a 2020 2020 2020 2020 2222  int]:.        ""
+00005ac0: 224d 6170 7069 6e67 2066 726f 6d20 6469  "Mapping from di
+00005ad0: 6d65 6e73 696f 6e20 6e61 6d65 7320 746f  mension names to
+00005ae0: 206c 656e 6774 6873 2e0a 0a20 2020 2020   lengths...     
+00005af0: 2020 2043 616e 6e6f 7420 6265 206d 6f64     Cannot be mod
+00005b00: 6966 6965 6420 6469 7265 6374 6c79 2c20  ified directly, 
+00005b10: 6275 7420 6973 2075 7064 6174 6564 2077  but is updated w
+00005b20: 6865 6e20 6164 6469 6e67 206e 6577 2076  hen adding new v
+00005b30: 6172 6961 626c 6573 2e0a 0a20 2020 2020  ariables...     
+00005b40: 2020 2054 6869 7320 6973 2061 6e20 616c     This is an al
+00005b50: 6961 7320 666f 7220 6044 6174 6173 6574  ias for `Dataset
+00005b60: 2e64 696d 7360 2070 726f 7669 6465 6420  .dims` provided 
+00005b70: 666f 7220 7468 6520 6265 6e65 6669 7420  for the benefit 
+00005b80: 6f66 0a20 2020 2020 2020 2063 6f6e 7369  of.        consi
+00005b90: 7374 656e 6379 2077 6974 6820 6044 6174  stency with `Dat
+00005ba0: 6141 7272 6179 2e73 697a 6573 602e 0a0a  aArray.sizes`...
+00005bb0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+00005bc0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00005bd0: 2d0a 2020 2020 2020 2020 4461 7461 4172  -.        DataAr
+00005be0: 7261 792e 7369 7a65 730a 2020 2020 2020  ray.sizes.      
+00005bf0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00005c00: 7475 726e 2073 656c 662e 6469 6d73 0a0a  turn self.dims..
+00005c10: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00005c20: 2020 6465 6620 6474 7970 6573 2873 656c    def dtypes(sel
+00005c30: 6629 202d 3e20 4672 6f7a 656e 5b48 6173  f) -> Frozen[Has
+00005c40: 6861 626c 652c 206e 702e 6474 7970 655d  hable, np.dtype]
+00005c50: 3a0a 2020 2020 2020 2020 2222 224d 6170  :.        """Map
+00005c60: 7069 6e67 2066 726f 6d20 6461 7461 2076  ping from data v
+00005c70: 6172 6961 626c 6520 6e61 6d65 7320 746f  ariable names to
+00005c80: 2064 7479 7065 732e 0a0a 2020 2020 2020   dtypes...      
+00005c90: 2020 4361 6e6e 6f74 2062 6520 6d6f 6469    Cannot be modi
+00005ca0: 6669 6564 2064 6972 6563 746c 792c 2062  fied directly, b
+00005cb0: 7574 2069 7320 7570 6461 7465 6420 7768  ut is updated wh
+00005cc0: 656e 2061 6464 696e 6720 6e65 7720 7661  en adding new va
+00005cd0: 7269 6162 6c65 732e 0a0a 2020 2020 2020  riables...      
+00005ce0: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00005cf0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00005d00: 2020 2020 4461 7461 4172 7261 792e 6474      DataArray.dt
+00005d10: 7970 650a 2020 2020 2020 2020 2222 220a  ype.        """.
+00005d20: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00005d30: 726f 7a65 6e28 0a20 2020 2020 2020 2020  rozen(.         
+00005d40: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00005d50: 2020 2020 206e 3a20 762e 6474 7970 650a       n: v.dtype.
+00005d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d70: 666f 7220 6e2c 2076 2069 6e20 7365 6c66  for n, v in self
+00005d80: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
+00005d90: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00005da0: 2020 2020 6966 206e 206e 6f74 2069 6e20      if n not in 
+00005db0: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
+00005dc0: 730a 2020 2020 2020 2020 2020 2020 7d0a  s.            }.
+00005dd0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00005de0: 6566 206c 6f61 6428 7365 6c66 3a20 545f  ef load(self: T_
+00005df0: 4461 7461 7365 742c 202a 2a6b 7761 7267  Dataset, **kwarg
+00005e00: 7329 202d 3e20 545f 4461 7461 7365 743a  s) -> T_Dataset:
+00005e10: 0a20 2020 2020 2020 2022 2222 4d61 6e75  .        """Manu
+00005e20: 616c 6c79 2074 7269 6767 6572 206c 6f61  ally trigger loa
+00005e30: 6469 6e67 2061 6e64 2f6f 7220 636f 6d70  ding and/or comp
+00005e40: 7574 6174 696f 6e20 6f66 2074 6869 7320  utation of this 
+00005e50: 6461 7461 7365 7427 7320 6461 7461 0a20  dataset's data. 
+00005e60: 2020 2020 2020 2066 726f 6d20 6469 736b         from disk
+00005e70: 206f 7220 6120 7265 6d6f 7465 2073 6f75   or a remote sou
+00005e80: 7263 6520 696e 746f 206d 656d 6f72 7920  rce into memory 
+00005e90: 616e 6420 7265 7475 726e 2074 6869 7320  and return this 
+00005ea0: 6461 7461 7365 742e 0a20 2020 2020 2020  dataset..       
+00005eb0: 2055 6e6c 696b 6520 636f 6d70 7574 652c   Unlike compute,
+00005ec0: 2074 6865 206f 7269 6769 6e61 6c20 6461   the original da
+00005ed0: 7461 7365 7420 6973 206d 6f64 6966 6965  taset is modifie
+00005ee0: 6420 616e 6420 7265 7475 726e 6564 2e0a  d and returned..
+00005ef0: 0a20 2020 2020 2020 204e 6f72 6d61 6c6c  .        Normall
+00005f00: 792c 2069 7420 7368 6f75 6c64 206e 6f74  y, it should not
+00005f10: 2062 6520 6e65 6365 7373 6172 7920 746f   be necessary to
+00005f20: 2063 616c 6c20 7468 6973 206d 6574 686f   call this metho
+00005f30: 6420 696e 2075 7365 7220 636f 6465 2c0a  d in user code,.
+00005f40: 2020 2020 2020 2020 6265 6361 7573 6520          because 
+00005f50: 616c 6c20 7861 7272 6179 2066 756e 6374  all xarray funct
+00005f60: 696f 6e73 2073 686f 756c 6420 6569 7468  ions should eith
+00005f70: 6572 2077 6f72 6b20 6f6e 2064 6566 6572  er work on defer
+00005f80: 7265 6420 6461 7461 206f 720a 2020 2020  red data or.    
+00005f90: 2020 2020 6c6f 6164 2064 6174 6120 6175      load data au
+00005fa0: 746f 6d61 7469 6361 6c6c 792e 2048 6f77  tomatically. How
+00005fb0: 6576 6572 2c20 7468 6973 206d 6574 686f  ever, this metho
+00005fc0: 6420 6361 6e20 6265 206e 6563 6573 7361  d can be necessa
+00005fd0: 7279 2077 6865 6e0a 2020 2020 2020 2020  ry when.        
+00005fe0: 776f 726b 696e 6720 7769 7468 206d 616e  working with man
+00005ff0: 7920 6669 6c65 206f 626a 6563 7473 206f  y file objects o
+00006000: 6e20 6469 736b 2e0a 0a20 2020 2020 2020  n disk...       
+00006010: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00006020: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00006030: 2020 2020 2020 202a 2a6b 7761 7267 7320         **kwargs 
+00006040: 3a20 6469 6374 0a20 2020 2020 2020 2020  : dict.         
+00006050: 2020 2041 6464 6974 696f 6e61 6c20 6b65     Additional ke
+00006060: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
+00006070: 7061 7373 6564 206f 6e20 746f 2060 6064  passed on to ``d
+00006080: 6173 6b2e 636f 6d70 7574 6560 602e 0a0a  ask.compute``...
+00006090: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+000060a0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000060b0: 2d0a 2020 2020 2020 2020 6461 736b 2e63  -.        dask.c
+000060c0: 6f6d 7075 7465 0a20 2020 2020 2020 2022  ompute.        "
+000060d0: 2222 0a20 2020 2020 2020 2023 2061 6363  "".        # acc
+000060e0: 6573 7320 2e64 6174 6120 746f 2063 6f65  ess .data to coe
+000060f0: 7263 6520 6576 6572 7974 6869 6e67 2074  rce everything t
+00006100: 6f20 6e75 6d70 7920 6f72 2064 6173 6b20  o numpy or dask 
+00006110: 6172 7261 7973 0a20 2020 2020 2020 206c  arrays.        l
+00006120: 617a 795f 6461 7461 203d 207b 0a20 2020  azy_data = {.   
+00006130: 2020 2020 2020 2020 206b 3a20 762e 5f64           k: v._d
+00006140: 6174 6120 666f 7220 6b2c 2076 2069 6e20  ata for k, v in 
+00006150: 7365 6c66 2e76 6172 6961 626c 6573 2e69  self.variables.i
+00006160: 7465 6d73 2829 2069 6620 6973 5f63 6875  tems() if is_chu
+00006170: 6e6b 6564 5f61 7272 6179 2876 2e5f 6461  nked_array(v._da
+00006180: 7461 290a 2020 2020 2020 2020 7d0a 2020  ta).        }.  
+00006190: 2020 2020 2020 6966 206c 617a 795f 6461        if lazy_da
+000061a0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+000061b0: 6368 756e 6b6d 616e 6167 6572 203d 2067  chunkmanager = g
+000061c0: 6574 5f63 6875 6e6b 6564 5f61 7272 6179  et_chunked_array
+000061d0: 5f74 7970 6528 2a6c 617a 795f 6461 7461  _type(*lazy_data
+000061e0: 2e76 616c 7565 7328 2929 0a0a 2020 2020  .values())..    
+000061f0: 2020 2020 2020 2020 2320 6576 616c 7561          # evalua
+00006200: 7465 2061 6c6c 2074 6865 2063 6875 6e6b  te all the chunk
+00006210: 6564 2061 7272 6179 7320 7369 6d75 6c74  ed arrays simult
+00006220: 616e 656f 7573 6c79 0a20 2020 2020 2020  aneously.       
+00006230: 2020 2020 2065 7661 6c75 6174 6564 5f64       evaluated_d
+00006240: 6174 6120 3d20 6368 756e 6b6d 616e 6167  ata = chunkmanag
+00006250: 6572 2e63 6f6d 7075 7465 282a 6c61 7a79  er.compute(*lazy
+00006260: 5f64 6174 612e 7661 6c75 6573 2829 2c20  _data.values(), 
+00006270: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+00006280: 2020 2020 2020 2066 6f72 206b 2c20 6461         for k, da
+00006290: 7461 2069 6e20 7a69 7028 6c61 7a79 5f64  ta in zip(lazy_d
+000062a0: 6174 612c 2065 7661 6c75 6174 6564 5f64  ata, evaluated_d
+000062b0: 6174 6129 3a0a 2020 2020 2020 2020 2020  ata):.          
+000062c0: 2020 2020 2020 7365 6c66 2e76 6172 6961        self.varia
+000062d0: 626c 6573 5b6b 5d2e 6461 7461 203d 2064  bles[k].data = d
+000062e0: 6174 610a 0a20 2020 2020 2020 2023 206c  ata..        # l
+000062f0: 6f61 6420 6576 6572 7974 6869 6e67 2065  oad everything e
+00006300: 6c73 6520 7365 7175 656e 7469 616c 6c79  lse sequentially
+00006310: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+00006320: 7620 696e 2073 656c 662e 7661 7269 6162  v in self.variab
+00006330: 6c65 732e 6974 656d 7328 293a 0a20 2020  les.items():.   
+00006340: 2020 2020 2020 2020 2069 6620 6b20 6e6f           if k no
+00006350: 7420 696e 206c 617a 795f 6461 7461 3a0a  t in lazy_data:.
+00006360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006370: 762e 6c6f 6164 2829 0a0a 2020 2020 2020  v.load()..      
+00006380: 2020 7265 7475 726e 2073 656c 660a 0a20    return self.. 
+00006390: 2020 2064 6566 205f 5f64 6173 6b5f 746f     def __dask_to
+000063a0: 6b65 6e69 7a65 5f5f 2873 656c 6629 3a0a  kenize__(self):.
+000063b0: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+000063c0: 6b2e 6261 7365 2069 6d70 6f72 7420 6e6f  k.base import no
+000063d0: 726d 616c 697a 655f 746f 6b65 6e0a 0a20  rmalize_token.. 
+000063e0: 2020 2020 2020 2072 6574 7572 6e20 6e6f         return no
+000063f0: 726d 616c 697a 655f 746f 6b65 6e28 0a20  rmalize_token(. 
+00006400: 2020 2020 2020 2020 2020 2028 7479 7065             (type
+00006410: 2873 656c 6629 2c20 7365 6c66 2e5f 7661  (self), self._va
+00006420: 7269 6162 6c65 732c 2073 656c 662e 5f63  riables, self._c
+00006430: 6f6f 7264 5f6e 616d 6573 2c20 7365 6c66  oord_names, self
+00006440: 2e5f 6174 7472 7329 0a20 2020 2020 2020  ._attrs).       
+00006450: 2029 0a0a 2020 2020 6465 6620 5f5f 6461   )..    def __da
+00006460: 736b 5f67 7261 7068 5f5f 2873 656c 6629  sk_graph__(self)
+00006470: 3a0a 2020 2020 2020 2020 6772 6170 6873  :.        graphs
+00006480: 203d 207b 6b3a 2076 2e5f 5f64 6173 6b5f   = {k: v.__dask_
+00006490: 6772 6170 685f 5f28 2920 666f 7220 6b2c  graph__() for k,
+000064a0: 2076 2069 6e20 7365 6c66 2e76 6172 6961   v in self.varia
+000064b0: 626c 6573 2e69 7465 6d73 2829 7d0a 2020  bles.items()}.  
+000064c0: 2020 2020 2020 6772 6170 6873 203d 207b        graphs = {
+000064d0: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+000064e0: 2067 7261 7068 732e 6974 656d 7328 2920   graphs.items() 
+000064f0: 6966 2076 2069 7320 6e6f 7420 4e6f 6e65  if v is not None
+00006500: 7d0a 2020 2020 2020 2020 6966 206e 6f74  }.        if not
+00006510: 2067 7261 7068 733a 0a20 2020 2020 2020   graphs:.       
+00006520: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00006530: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00006540: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00006550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006560: 6672 6f6d 2064 6173 6b2e 6869 6768 6c65  from dask.highle
+00006570: 7665 6c67 7261 7068 2069 6d70 6f72 7420  velgraph import 
+00006580: 4869 6768 4c65 7665 6c47 7261 7068 0a0a  HighLevelGraph..
+00006590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065a0: 7265 7475 726e 2048 6967 684c 6576 656c  return HighLevel
+000065b0: 4772 6170 682e 6d65 7267 6528 2a67 7261  Graph.merge(*gra
+000065c0: 7068 732e 7661 6c75 6573 2829 290a 2020  phs.values()).  
+000065d0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+000065e0: 2049 6d70 6f72 7445 7272 6f72 3a0a 2020   ImportError:.  
+000065f0: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+00006600: 6f6d 2064 6173 6b20 696d 706f 7274 2073  om dask import s
+00006610: 6861 7265 6469 6374 0a0a 2020 2020 2020  haredict..      
+00006620: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00006630: 2073 6861 7265 6469 6374 2e6d 6572 6765   sharedict.merge
+00006640: 282a 6772 6170 6873 2e76 616c 7565 7328  (*graphs.values(
+00006650: 2929 0a0a 2020 2020 6465 6620 5f5f 6461  ))..    def __da
+00006660: 736b 5f6b 6579 735f 5f28 7365 6c66 293a  sk_keys__(self):
+00006670: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00006680: 6461 736b 0a0a 2020 2020 2020 2020 7265  dask..        re
+00006690: 7475 726e 205b 0a20 2020 2020 2020 2020  turn [.         
+000066a0: 2020 2076 2e5f 5f64 6173 6b5f 6b65 7973     v.__dask_keys
+000066b0: 5f5f 2829 0a20 2020 2020 2020 2020 2020  __().           
+000066c0: 2066 6f72 2076 2069 6e20 7365 6c66 2e76   for v in self.v
+000066d0: 6172 6961 626c 6573 2e76 616c 7565 7328  ariables.values(
+000066e0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000066f0: 2064 6173 6b2e 6973 5f64 6173 6b5f 636f   dask.is_dask_co
+00006700: 6c6c 6563 7469 6f6e 2876 290a 2020 2020  llection(v).    
+00006710: 2020 2020 5d0a 0a20 2020 2064 6566 205f      ]..    def _
+00006720: 5f64 6173 6b5f 6c61 7965 7273 5f5f 2873  _dask_layers__(s
+00006730: 656c 6629 3a0a 2020 2020 2020 2020 696d  elf):.        im
+00006740: 706f 7274 2064 6173 6b0a 0a20 2020 2020  port dask..     
+00006750: 2020 2072 6574 7572 6e20 7375 6d28 0a20     return sum(. 
+00006760: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
+00006770: 2020 2020 2020 2020 2020 2020 2076 2e5f               v._
+00006780: 5f64 6173 6b5f 6c61 7965 7273 5f5f 2829  _dask_layers__()
+00006790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000067a0: 2066 6f72 2076 2069 6e20 7365 6c66 2e76   for v in self.v
+000067b0: 6172 6961 626c 6573 2e76 616c 7565 7328  ariables.values(
+000067c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000067d0: 2020 6966 2064 6173 6b2e 6973 5f64 6173    if dask.is_das
+000067e0: 6b5f 636f 6c6c 6563 7469 6f6e 2876 290a  k_collection(v).
+000067f0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+00006800: 2020 2020 2020 2020 2020 2028 292c 0a20             (),. 
+00006810: 2020 2020 2020 2029 0a0a 2020 2020 4070         )..    @p
+00006820: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00006830: 5f5f 6461 736b 5f6f 7074 696d 697a 655f  __dask_optimize_
+00006840: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00006850: 2069 6d70 6f72 7420 6461 736b 2e61 7272   import dask.arr
+00006860: 6179 2061 7320 6461 0a0a 2020 2020 2020  ay as da..      
+00006870: 2020 7265 7475 726e 2064 612e 4172 7261    return da.Arra
+00006880: 792e 5f5f 6461 736b 5f6f 7074 696d 697a  y.__dask_optimiz
+00006890: 655f 5f0a 0a20 2020 2040 7072 6f70 6572  e__..    @proper
+000068a0: 7479 0a20 2020 2064 6566 205f 5f64 6173  ty.    def __das
+000068b0: 6b5f 7363 6865 6475 6c65 725f 5f28 7365  k_scheduler__(se
+000068c0: 6c66 293a 0a20 2020 2020 2020 2069 6d70  lf):.        imp
+000068d0: 6f72 7420 6461 736b 2e61 7272 6179 2061  ort dask.array a
+000068e0: 7320 6461 0a0a 2020 2020 2020 2020 7265  s da..        re
+000068f0: 7475 726e 2064 612e 4172 7261 792e 5f5f  turn da.Array.__
+00006900: 6461 736b 5f73 6368 6564 756c 6572 5f5f  dask_scheduler__
+00006910: 0a0a 2020 2020 6465 6620 5f5f 6461 736b  ..    def __dask
+00006920: 5f70 6f73 7463 6f6d 7075 7465 5f5f 2873  _postcompute__(s
+00006930: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00006940: 7475 726e 2073 656c 662e 5f64 6173 6b5f  turn self._dask_
+00006950: 706f 7374 636f 6d70 7574 652c 2028 290a  postcompute, ().
+00006960: 0a20 2020 2064 6566 205f 5f64 6173 6b5f  .    def __dask_
+00006970: 706f 7374 7065 7273 6973 745f 5f28 7365  postpersist__(se
+00006980: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+00006990: 7572 6e20 7365 6c66 2e5f 6461 736b 5f70  urn self._dask_p
+000069a0: 6f73 7470 6572 7369 7374 2c20 2829 0a0a  ostpersist, ()..
+000069b0: 2020 2020 6465 6620 5f64 6173 6b5f 706f      def _dask_po
+000069c0: 7374 636f 6d70 7574 6528 7365 6c66 3a20  stcompute(self: 
+000069d0: 545f 4461 7461 7365 742c 2072 6573 756c  T_Dataset, resul
+000069e0: 7473 3a20 4974 6572 6162 6c65 5b56 6172  ts: Iterable[Var
+000069f0: 6961 626c 655d 2920 2d3e 2054 5f44 6174  iable]) -> T_Dat
+00006a00: 6173 6574 3a0a 2020 2020 2020 2020 696d  aset:.        im
+00006a10: 706f 7274 2064 6173 6b0a 0a20 2020 2020  port dask..     
+00006a20: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
+00006a30: 7d0a 2020 2020 2020 2020 7265 7375 6c74  }.        result
+00006a40: 735f 6974 6572 203d 2069 7465 7228 7265  s_iter = iter(re
+00006a50: 7375 6c74 7329 0a0a 2020 2020 2020 2020  sults)..        
+00006a60: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+00006a70: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
+00006a80: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00006a90: 2069 6620 6461 736b 2e69 735f 6461 736b   if dask.is_dask
+00006aa0: 5f63 6f6c 6c65 6374 696f 6e28 7629 3a0a  _collection(v):.
+00006ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ac0: 7265 6275 696c 642c 2061 7267 7320 3d20  rebuild, args = 
+00006ad0: 762e 5f5f 6461 736b 5f70 6f73 7463 6f6d  v.__dask_postcom
+00006ae0: 7075 7465 5f5f 2829 0a20 2020 2020 2020  pute__().       
+00006af0: 2020 2020 2020 2020 2076 203d 2072 6562           v = reb
+00006b00: 7569 6c64 286e 6578 7428 7265 7375 6c74  uild(next(result
+00006b10: 735f 6974 6572 292c 202a 6172 6773 290a  s_iter), *args).
+00006b20: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+00006b30: 6162 6c65 735b 6b5d 203d 2076 0a0a 2020  ables[k] = v..  
+00006b40: 2020 2020 2020 7265 7475 726e 2074 7970        return typ
+00006b50: 6528 7365 6c66 292e 5f63 6f6e 7374 7275  e(self)._constru
+00006b60: 6374 5f64 6972 6563 7428 0a20 2020 2020  ct_direct(.     
+00006b70: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00006b80: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+00006b90: 6c66 2e5f 636f 6f72 645f 6e61 6d65 732c  lf._coord_names,
+00006ba0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006bb0: 662e 5f64 696d 732c 0a20 2020 2020 2020  f._dims,.       
+00006bc0: 2020 2020 2073 656c 662e 5f61 7474 7273       self._attrs
+00006bd0: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+00006be0: 6c66 2e5f 696e 6465 7865 732c 0a20 2020  lf._indexes,.   
+00006bf0: 2020 2020 2020 2020 2073 656c 662e 5f65           self._e
+00006c00: 6e63 6f64 696e 672c 0a20 2020 2020 2020  ncoding,.       
+00006c10: 2020 2020 2073 656c 662e 5f63 6c6f 7365       self._close
+00006c20: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00006c30: 2064 6566 205f 6461 736b 5f70 6f73 7470   def _dask_postp
+00006c40: 6572 7369 7374 280a 2020 2020 2020 2020  ersist(.        
+00006c50: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+00006c60: 2064 736b 3a20 4d61 7070 696e 672c 202a   dsk: Mapping, *
+00006c70: 2c20 7265 6e61 6d65 3a20 4d61 7070 696e  , rename: Mappin
+00006c80: 675b 7374 722c 2073 7472 5d20 7c20 4e6f  g[str, str] | No
+00006c90: 6e65 203d 204e 6f6e 650a 2020 2020 2920  ne = None.    ) 
+00006ca0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+00006cb0: 2020 2020 2020 6672 6f6d 2064 6173 6b20        from dask 
+00006cc0: 696d 706f 7274 2069 735f 6461 736b 5f63  import is_dask_c
+00006cd0: 6f6c 6c65 6374 696f 6e0a 2020 2020 2020  ollection.      
+00006ce0: 2020 6672 6f6d 2064 6173 6b2e 6869 6768    from dask.high
+00006cf0: 6c65 7665 6c67 7261 7068 2069 6d70 6f72  levelgraph impor
+00006d00: 7420 4869 6768 4c65 7665 6c47 7261 7068  t HighLevelGraph
+00006d10: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+00006d20: 736b 2e6f 7074 696d 697a 6174 696f 6e20  sk.optimization 
+00006d30: 696d 706f 7274 2063 756c 6c0a 0a20 2020  import cull..   
+00006d40: 2020 2020 2076 6172 6961 626c 6573 203d       variables =
+00006d50: 207b 7d0a 0a20 2020 2020 2020 2066 6f72   {}..        for
+00006d60: 206b 2c20 7620 696e 2073 656c 662e 5f76   k, v in self._v
+00006d70: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
+00006d80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00006d90: 206e 6f74 2069 735f 6461 736b 5f63 6f6c   not is_dask_col
+00006da0: 6c65 6374 696f 6e28 7629 3a0a 2020 2020  lection(v):.    
+00006db0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+00006dc0: 6162 6c65 735b 6b5d 203d 2076 0a20 2020  ables[k] = v.   
+00006dd0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00006de0: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
+00006df0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00006e00: 2864 736b 2c20 4869 6768 4c65 7665 6c47  (dsk, HighLevelG
+00006e10: 7261 7068 293a 0a20 2020 2020 2020 2020  raph):.         
+00006e20: 2020 2020 2020 2023 2064 6173 6b20 3e3d         # dask >=
+00006e30: 2032 3032 312e 330a 2020 2020 2020 2020   2021.3.        
+00006e40: 2020 2020 2020 2020 2320 5f5f 6461 736b          # __dask
+00006e50: 5f70 6f73 7470 6572 7369 7374 5f5f 2829  _postpersist__()
+00006e60: 2077 6173 2063 616c 6c65 6420 6279 2064   was called by d
+00006e70: 6173 6b2e 6869 6768 6c65 7665 6c67 7261  ask.highlevelgra
+00006e80: 7068 2e0a 2020 2020 2020 2020 2020 2020  ph..            
+00006e90: 2020 2020 2320 446f 6e27 7420 7573 6520      # Don't use 
+00006ea0: 6473 6b2e 6375 6c6c 2829 2c20 6173 2077  dsk.cull(), as w
+00006eb0: 6520 6e65 6564 2074 6f20 7072 6576 656e  e need to preven
+00006ec0: 7420 7061 7274 6961 6c20 6c61 7965 7273  t partial layers
+00006ed0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006ee0: 2020 2320 6874 7470 733a 2f2f 6769 7468    # https://gith
+00006ef0: 7562 2e63 6f6d 2f64 6173 6b2f 6461 736b  ub.com/dask/dask
+00006f00: 2f69 7373 7565 732f 3731 3337 0a20 2020  /issues/7137.   
+00006f10: 2020 2020 2020 2020 2020 2020 206c 6179               lay
+00006f20: 6572 7320 3d20 762e 5f5f 6461 736b 5f6c  ers = v.__dask_l
+00006f30: 6179 6572 735f 5f28 290a 2020 2020 2020  ayers__().      
+00006f40: 2020 2020 2020 2020 2020 6966 2072 656e            if ren
+00006f50: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
+00006f60: 2020 2020 2020 2020 206c 6179 6572 7320           layers 
+00006f70: 3d20 5b72 656e 616d 652e 6765 7428 6b2c  = [rename.get(k,
+00006f80: 206b 2920 666f 7220 6b20 696e 206c 6179   k) for k in lay
+00006f90: 6572 735d 0a20 2020 2020 2020 2020 2020  ers].           
+00006fa0: 2020 2020 2064 736b 3220 3d20 6473 6b2e       dsk2 = dsk.
+00006fb0: 6375 6c6c 5f6c 6179 6572 7328 6c61 7965  cull_layers(laye
+00006fc0: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+00006fd0: 656c 6966 2072 656e 616d 653a 2020 2320  elif rename:  # 
+00006fe0: 7072 6167 6d61 3a20 6e6f 636f 7665 720a  pragma: nocover.
+00006ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007000: 2320 4174 2074 6865 206d 6f6d 656e 7420  # At the moment 
+00007010: 6f66 2077 7269 7469 6e67 2c20 7468 6973  of writing, this
+00007020: 2069 7320 6f6e 6c79 2066 6f72 2066 6f72   is only for for
+00007030: 7761 7264 2063 6f6d 7061 7469 6269 6c69  ward compatibili
+00007040: 7479 2e0a 2020 2020 2020 2020 2020 2020  ty..            
+00007050: 2020 2020 2320 7265 706c 6163 655f 6e61      # replace_na
+00007060: 6d65 5f69 6e5f 6b65 7920 7265 7175 6972  me_in_key requir
+00007070: 6573 2064 6173 6b20 3e3d 2032 3032 312e  es dask >= 2021.
+00007080: 332e 0a20 2020 2020 2020 2020 2020 2020  3..             
+00007090: 2020 2066 726f 6d20 6461 736b 2e62 6173     from dask.bas
+000070a0: 6520 696d 706f 7274 2066 6c61 7474 656e  e import flatten
+000070b0: 2c20 7265 706c 6163 655f 6e61 6d65 5f69  , replace_name_i
+000070c0: 6e5f 6b65 790a 0a20 2020 2020 2020 2020  n_key..         
+000070d0: 2020 2020 2020 206b 6579 7320 3d20 5b0a         keys = [.
+000070e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000070f0: 2020 2020 7265 706c 6163 655f 6e61 6d65      replace_name
+00007100: 5f69 6e5f 6b65 7928 6b2c 2072 656e 616d  _in_key(k, renam
+00007110: 6529 2066 6f72 206b 2069 6e20 666c 6174  e) for k in flat
+00007120: 7465 6e28 762e 5f5f 6461 736b 5f6b 6579  ten(v.__dask_key
+00007130: 735f 5f28 2929 0a20 2020 2020 2020 2020  s__()).         
+00007140: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00007150: 2020 2020 2020 2020 2064 736b 322c 205f           dsk2, _
+00007160: 203d 2063 756c 6c28 6473 6b2c 206b 6579   = cull(dsk, key
+00007170: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
+00007180: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00007190: 2020 2020 2023 205f 5f64 6173 6b5f 706f       # __dask_po
+000071a0: 7374 7065 7273 6973 745f 5f28 2920 7761  stpersist__() wa
+000071b0: 7320 6361 6c6c 6564 2062 7920 6461 736b  s called by dask
+000071c0: 2e6f 7074 696d 697a 6520 6f72 2064 6173  .optimize or das
+000071d0: 6b2e 7065 7273 6973 740a 2020 2020 2020  k.persist.      
+000071e0: 2020 2020 2020 2020 2020 6473 6b32 2c20            dsk2, 
+000071f0: 5f20 3d20 6375 6c6c 2864 736b 2c20 762e  _ = cull(dsk, v.
+00007200: 5f5f 6461 736b 5f6b 6579 735f 5f28 2929  __dask_keys__())
+00007210: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00007220: 6275 696c 642c 2061 7267 7320 3d20 762e  build, args = v.
+00007230: 5f5f 6461 736b 5f70 6f73 7470 6572 7369  __dask_postpersi
+00007240: 7374 5f5f 2829 0a20 2020 2020 2020 2020  st__().         
+00007250: 2020 2023 2072 656e 616d 6520 7761 7320     # rename was 
+00007260: 6164 6465 6420 696e 2064 6173 6b20 3230  added in dask 20
+00007270: 3231 2e33 0a20 2020 2020 2020 2020 2020  21.3.           
+00007280: 206b 7761 7267 7320 3d20 7b22 7265 6e61   kwargs = {"rena
+00007290: 6d65 223a 2072 656e 616d 657d 2069 6620  me": rename} if 
+000072a0: 7265 6e61 6d65 2065 6c73 6520 7b7d 0a20  rename else {}. 
+000072b0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+000072c0: 626c 6573 5b6b 5d20 3d20 7265 6275 696c  bles[k] = rebuil
+000072d0: 6428 6473 6b32 2c20 2a61 7267 732c 202a  d(dsk2, *args, *
+000072e0: 2a6b 7761 7267 7329 0a0a 2020 2020 2020  *kwargs)..      
+000072f0: 2020 7265 7475 726e 2074 7970 6528 7365    return type(se
+00007300: 6c66 292e 5f63 6f6e 7374 7275 6374 5f64  lf)._construct_d
+00007310: 6972 6563 7428 0a20 2020 2020 2020 2020  irect(.         
+00007320: 2020 2076 6172 6961 626c 6573 2c0a 2020     variables,.  
+00007330: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00007340: 636f 6f72 645f 6e61 6d65 732c 0a20 2020  coord_names,.   
+00007350: 2020 2020 2020 2020 2073 656c 662e 5f64           self._d
+00007360: 696d 732c 0a20 2020 2020 2020 2020 2020  ims,.           
+00007370: 2073 656c 662e 5f61 7474 7273 2c0a 2020   self._attrs,.  
+00007380: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00007390: 696e 6465 7865 732c 0a20 2020 2020 2020  indexes,.       
+000073a0: 2020 2020 2073 656c 662e 5f65 6e63 6f64       self._encod
+000073b0: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
+000073c0: 2073 656c 662e 5f63 6c6f 7365 2c0a 2020   self._close,.  
+000073d0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+000073e0: 2063 6f6d 7075 7465 2873 656c 663a 2054   compute(self: T
+000073f0: 5f44 6174 6173 6574 2c20 2a2a 6b77 6172  _Dataset, **kwar
+00007400: 6773 2920 2d3e 2054 5f44 6174 6173 6574  gs) -> T_Dataset
+00007410: 3a0a 2020 2020 2020 2020 2222 224d 616e  :.        """Man
+00007420: 7561 6c6c 7920 7472 6967 6765 7220 6c6f  ually trigger lo
+00007430: 6164 696e 6720 616e 642f 6f72 2063 6f6d  ading and/or com
+00007440: 7075 7461 7469 6f6e 206f 6620 7468 6973  putation of this
+00007450: 2064 6174 6173 6574 2773 2064 6174 610a   dataset's data.
+00007460: 2020 2020 2020 2020 6672 6f6d 2064 6973          from dis
+00007470: 6b20 6f72 2061 2072 656d 6f74 6520 736f  k or a remote so
+00007480: 7572 6365 2069 6e74 6f20 6d65 6d6f 7279  urce into memory
+00007490: 2061 6e64 2072 6574 7572 6e20 6120 6e65   and return a ne
+000074a0: 7720 6461 7461 7365 742e 0a20 2020 2020  w dataset..     
+000074b0: 2020 2055 6e6c 696b 6520 6c6f 6164 2c20     Unlike load, 
+000074c0: 7468 6520 6f72 6967 696e 616c 2064 6174  the original dat
+000074d0: 6173 6574 2069 7320 6c65 6674 2075 6e61  aset is left una
+000074e0: 6c74 6572 6564 2e0a 0a20 2020 2020 2020  ltered...       
+000074f0: 204e 6f72 6d61 6c6c 792c 2069 7420 7368   Normally, it sh
+00007500: 6f75 6c64 206e 6f74 2062 6520 6e65 6365  ould not be nece
+00007510: 7373 6172 7920 746f 2063 616c 6c20 7468  ssary to call th
+00007520: 6973 206d 6574 686f 6420 696e 2075 7365  is method in use
+00007530: 7220 636f 6465 2c0a 2020 2020 2020 2020  r code,.        
+00007540: 6265 6361 7573 6520 616c 6c20 7861 7272  because all xarr
+00007550: 6179 2066 756e 6374 696f 6e73 2073 686f  ay functions sho
+00007560: 756c 6420 6569 7468 6572 2077 6f72 6b20  uld either work 
+00007570: 6f6e 2064 6566 6572 7265 6420 6461 7461  on deferred data
+00007580: 206f 720a 2020 2020 2020 2020 6c6f 6164   or.        load
+00007590: 2064 6174 6120 6175 746f 6d61 7469 6361   data automatica
+000075a0: 6c6c 792e 2048 6f77 6576 6572 2c20 7468  lly. However, th
+000075b0: 6973 206d 6574 686f 6420 6361 6e20 6265  is method can be
+000075c0: 206e 6563 6573 7361 7279 2077 6865 6e0a   necessary when.
+000075d0: 2020 2020 2020 2020 776f 726b 696e 6720          working 
+000075e0: 7769 7468 206d 616e 7920 6669 6c65 206f  with many file o
+000075f0: 626a 6563 7473 206f 6e20 6469 736b 2e0a  bjects on disk..
+00007600: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00007610: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00007620: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 202a  ------.        *
+00007630: 2a6b 7761 7267 7320 3a20 6469 6374 0a20  *kwargs : dict. 
+00007640: 2020 2020 2020 2020 2020 2041 6464 6974             Addit
+00007650: 696f 6e61 6c20 6b65 7977 6f72 6420 6172  ional keyword ar
+00007660: 6775 6d65 6e74 7320 7061 7373 6564 206f  guments passed o
+00007670: 6e20 746f 2060 6064 6173 6b2e 636f 6d70  n to ``dask.comp
+00007680: 7574 6560 602e 0a0a 2020 2020 2020 2020  ute``...        
+00007690: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+000076a0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+000076b0: 2020 6461 736b 2e63 6f6d 7075 7465 0a20    dask.compute. 
+000076c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000076d0: 2020 206e 6577 203d 2073 656c 662e 636f     new = self.co
+000076e0: 7079 2864 6565 703d 4661 6c73 6529 0a20  py(deep=False). 
+000076f0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
+00007700: 772e 6c6f 6164 282a 2a6b 7761 7267 7329  w.load(**kwargs)
+00007710: 0a0a 2020 2020 6465 6620 5f70 6572 7369  ..    def _persi
+00007720: 7374 5f69 6e70 6c61 6365 2873 656c 663a  st_inplace(self:
+00007730: 2054 5f44 6174 6173 6574 2c20 2a2a 6b77   T_Dataset, **kw
+00007740: 6172 6773 2920 2d3e 2054 5f44 6174 6173  args) -> T_Datas
+00007750: 6574 3a0a 2020 2020 2020 2020 2222 2250  et:.        """P
+00007760: 6572 7369 7374 2061 6c6c 2044 6173 6b20  ersist all Dask 
+00007770: 6172 7261 7973 2069 6e20 6d65 6d6f 7279  arrays in memory
+00007780: 2222 220a 2020 2020 2020 2020 2320 6163  """.        # ac
+00007790: 6365 7373 202e 6461 7461 2074 6f20 636f  cess .data to co
+000077a0: 6572 6365 2065 7665 7279 7468 696e 6720  erce everything 
+000077b0: 746f 206e 756d 7079 206f 7220 6461 736b  to numpy or dask
+000077c0: 2061 7272 6179 730a 2020 2020 2020 2020   arrays.        
+000077d0: 6c61 7a79 5f64 6174 6120 3d20 7b0a 2020  lazy_data = {.  
+000077e0: 2020 2020 2020 2020 2020 6b3a 2076 2e5f            k: v._
+000077f0: 6461 7461 2066 6f72 206b 2c20 7620 696e  data for k, v in
+00007800: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
+00007810: 6974 656d 7328 2920 6966 2069 735f 6475  items() if is_du
+00007820: 636b 5f64 6173 6b5f 6172 7261 7928 762e  ck_dask_array(v.
+00007830: 5f64 6174 6129 0a20 2020 2020 2020 207d  _data).        }
+00007840: 0a20 2020 2020 2020 2069 6620 6c61 7a79  .        if lazy
+00007850: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
+00007860: 2020 2069 6d70 6f72 7420 6461 736b 0a0a     import dask..
+00007870: 2020 2020 2020 2020 2020 2020 2320 6576              # ev
+00007880: 616c 7561 7465 2061 6c6c 2074 6865 2064  aluate all the d
+00007890: 6173 6b20 6172 7261 7973 2073 696d 756c  ask arrays simul
+000078a0: 7461 6e65 6f75 736c 790a 2020 2020 2020  taneously.      
+000078b0: 2020 2020 2020 6576 616c 7561 7465 645f        evaluated_
+000078c0: 6461 7461 203d 2064 6173 6b2e 7065 7273  data = dask.pers
+000078d0: 6973 7428 2a6c 617a 795f 6461 7461 2e76  ist(*lazy_data.v
+000078e0: 616c 7565 7328 292c 202a 2a6b 7761 7267  alues(), **kwarg
+000078f0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00007900: 666f 7220 6b2c 2064 6174 6120 696e 207a  for k, data in z
+00007910: 6970 286c 617a 795f 6461 7461 2c20 6576  ip(lazy_data, ev
+00007920: 616c 7561 7465 645f 6461 7461 293a 0a20  aluated_data):. 
+00007930: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007940: 656c 662e 7661 7269 6162 6c65 735b 6b5d  elf.variables[k]
+00007950: 2e64 6174 6120 3d20 6461 7461 0a0a 2020  .data = data..  
+00007960: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00007970: 660a 0a20 2020 2064 6566 2070 6572 7369  f..    def persi
+00007980: 7374 2873 656c 663a 2054 5f44 6174 6173  st(self: T_Datas
+00007990: 6574 2c20 2a2a 6b77 6172 6773 2920 2d3e  et, **kwargs) ->
+000079a0: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+000079b0: 2020 2020 2222 2254 7269 6767 6572 2063      """Trigger c
+000079c0: 6f6d 7075 7461 7469 6f6e 2c20 6b65 6570  omputation, keep
+000079d0: 696e 6720 6461 7461 2061 7320 6461 736b  ing data as dask
+000079e0: 2061 7272 6179 730a 0a20 2020 2020 2020   arrays..       
+000079f0: 2054 6869 7320 6f70 6572 6174 696f 6e20   This operation 
+00007a00: 6361 6e20 6265 2075 7365 6420 746f 2074  can be used to t
+00007a10: 7269 6767 6572 2063 6f6d 7075 7461 7469  rigger computati
+00007a20: 6f6e 206f 6e20 756e 6465 726c 7969 6e67  on on underlying
+00007a30: 2064 6173 6b0a 2020 2020 2020 2020 6172   dask.        ar
+00007a40: 7261 7973 2c20 7369 6d69 6c61 7220 746f  rays, similar to
+00007a50: 2060 602e 636f 6d70 7574 6528 2960 6020   ``.compute()`` 
+00007a60: 6f72 2060 602e 6c6f 6164 2829 6060 2e20  or ``.load()``. 
+00007a70: 2048 6f77 6576 6572 2074 6869 730a 2020   However this.  
+00007a80: 2020 2020 2020 6f70 6572 6174 696f 6e20        operation 
+00007a90: 6b65 6570 7320 7468 6520 6461 7461 2061  keeps the data a
+00007aa0: 7320 6461 736b 2061 7272 6179 732e 2054  s dask arrays. T
+00007ab0: 6869 7320 6973 2070 6172 7469 6375 6c61  his is particula
+00007ac0: 726c 7920 7573 6566 756c 0a20 2020 2020  rly useful.     
+00007ad0: 2020 2077 6865 6e20 7573 696e 6720 7468     when using th
+00007ae0: 6520 6461 736b 2e64 6973 7472 6962 7574  e dask.distribut
+00007af0: 6564 2073 6368 6564 756c 6572 2061 6e64  ed scheduler and
+00007b00: 2079 6f75 2077 616e 7420 746f 206c 6f61   you want to loa
+00007b10: 6420 6120 6c61 7267 650a 2020 2020 2020  d a large.      
+00007b20: 2020 616d 6f75 6e74 206f 6620 6461 7461    amount of data
+00007b30: 2069 6e74 6f20 6469 7374 7269 6275 7465   into distribute
+00007b40: 6420 6d65 6d6f 7279 2e0a 0a20 2020 2020  d memory...     
+00007b50: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00007b60: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00007b70: 0a20 2020 2020 2020 202a 2a6b 7761 7267  .        **kwarg
+00007b80: 7320 3a20 6469 6374 0a20 2020 2020 2020  s : dict.       
+00007b90: 2020 2020 2041 6464 6974 696f 6e61 6c20       Additional 
+00007ba0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
+00007bb0: 7320 7061 7373 6564 206f 6e20 746f 2060  s passed on to `
+00007bc0: 6064 6173 6b2e 7065 7273 6973 7460 602e  `dask.persist``.
+00007bd0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+00007be0: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+00007bf0: 2d2d 2d0a 2020 2020 2020 2020 6461 736b  ---.        dask
+00007c00: 2e70 6572 7369 7374 0a20 2020 2020 2020  .persist.       
+00007c10: 2022 2222 0a20 2020 2020 2020 206e 6577   """.        new
+00007c20: 203d 2073 656c 662e 636f 7079 2864 6565   = self.copy(dee
+00007c30: 703d 4661 6c73 6529 0a20 2020 2020 2020  p=False).       
+00007c40: 2072 6574 7572 6e20 6e65 772e 5f70 6572   return new._per
+00007c50: 7369 7374 5f69 6e70 6c61 6365 282a 2a6b  sist_inplace(**k
+00007c60: 7761 7267 7329 0a0a 2020 2020 4063 6c61  wargs)..    @cla
+00007c70: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00007c80: 205f 636f 6e73 7472 7563 745f 6469 7265   _construct_dire
+00007c90: 6374 280a 2020 2020 2020 2020 636c 733a  ct(.        cls:
+00007ca0: 2074 7970 655b 545f 4461 7461 7365 745d   type[T_Dataset]
+00007cb0: 2c0a 2020 2020 2020 2020 7661 7269 6162  ,.        variab
+00007cc0: 6c65 733a 2064 6963 745b 416e 792c 2056  les: dict[Any, V
+00007cd0: 6172 6961 626c 655d 2c0a 2020 2020 2020  ariable],.      
+00007ce0: 2020 636f 6f72 645f 6e61 6d65 733a 2073    coord_names: s
+00007cf0: 6574 5b48 6173 6861 626c 655d 2c0a 2020  et[Hashable],.  
+00007d00: 2020 2020 2020 6469 6d73 3a20 6469 6374        dims: dict
+00007d10: 5b41 6e79 2c20 696e 745d 207c 204e 6f6e  [Any, int] | Non
+00007d20: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00007d30: 2020 6174 7472 733a 2064 6963 7420 7c20    attrs: dict | 
+00007d40: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+00007d50: 2020 2020 2069 6e64 6578 6573 3a20 6469       indexes: di
+00007d60: 6374 5b41 6e79 2c20 496e 6465 785d 207c  ct[Any, Index] |
+00007d70: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00007d80: 2020 2020 2020 656e 636f 6469 6e67 3a20        encoding: 
+00007d90: 6469 6374 207c 204e 6f6e 6520 3d20 4e6f  dict | None = No
+00007da0: 6e65 2c0a 2020 2020 2020 2020 636c 6f73  ne,.        clos
+00007db0: 653a 2043 616c 6c61 626c 655b 5b5d 2c20  e: Callable[[], 
+00007dc0: 4e6f 6e65 5d20 7c20 4e6f 6e65 203d 204e  None] | None = N
+00007dd0: 6f6e 652c 0a20 2020 2029 202d 3e20 545f  one,.    ) -> T_
+00007de0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+00007df0: 2022 2222 5368 6f72 7463 7574 2061 726f   """Shortcut aro
+00007e00: 756e 6420 5f5f 696e 6974 5f5f 2066 6f72  und __init__ for
+00007e10: 2069 6e74 6572 6e61 6c20 7573 6520 7768   internal use wh
+00007e20: 656e 2077 6520 7761 6e74 2074 6f20 736b  en we want to sk
+00007e30: 6970 0a20 2020 2020 2020 2063 6f73 746c  ip.        costl
+00007e40: 7920 7661 6c69 6461 7469 6f6e 0a20 2020  y validation.   
+00007e50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007e60: 2069 6620 6469 6d73 2069 7320 4e6f 6e65   if dims is None
+00007e70: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+00007e80: 6d73 203d 2063 616c 6375 6c61 7465 5f64  ms = calculate_d
+00007e90: 696d 656e 7369 6f6e 7328 7661 7269 6162  imensions(variab
+00007ea0: 6c65 7329 0a20 2020 2020 2020 2069 6620  les).        if 
+00007eb0: 696e 6465 7865 7320 6973 204e 6f6e 653a  indexes is None:
+00007ec0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+00007ed0: 6578 6573 203d 207b 7d0a 2020 2020 2020  exes = {}.      
+00007ee0: 2020 6f62 6a20 3d20 6f62 6a65 6374 2e5f    obj = object._
+00007ef0: 5f6e 6577 5f5f 2863 6c73 290a 2020 2020  _new__(cls).    
+00007f00: 2020 2020 6f62 6a2e 5f76 6172 6961 626c      obj._variabl
+00007f10: 6573 203d 2076 6172 6961 626c 6573 0a20  es = variables. 
+00007f20: 2020 2020 2020 206f 626a 2e5f 636f 6f72         obj._coor
+00007f30: 645f 6e61 6d65 7320 3d20 636f 6f72 645f  d_names = coord_
+00007f40: 6e61 6d65 730a 2020 2020 2020 2020 6f62  names.        ob
+00007f50: 6a2e 5f64 696d 7320 3d20 6469 6d73 0a20  j._dims = dims. 
+00007f60: 2020 2020 2020 206f 626a 2e5f 696e 6465         obj._inde
+00007f70: 7865 7320 3d20 696e 6465 7865 730a 2020  xes = indexes.  
+00007f80: 2020 2020 2020 6f62 6a2e 5f61 7474 7273        obj._attrs
+00007f90: 203d 2061 7474 7273 0a20 2020 2020 2020   = attrs.       
+00007fa0: 206f 626a 2e5f 636c 6f73 6520 3d20 636c   obj._close = cl
+00007fb0: 6f73 650a 2020 2020 2020 2020 6f62 6a2e  ose.        obj.
+00007fc0: 5f65 6e63 6f64 696e 6720 3d20 656e 636f  _encoding = enco
+00007fd0: 6469 6e67 0a20 2020 2020 2020 2072 6574  ding.        ret
+00007fe0: 7572 6e20 6f62 6a0a 0a20 2020 2064 6566  urn obj..    def
+00007ff0: 205f 7265 706c 6163 6528 0a20 2020 2020   _replace(.     
+00008000: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+00008010: 6574 2c0a 2020 2020 2020 2020 7661 7269  et,.        vari
+00008020: 6162 6c65 733a 2064 6963 745b 4861 7368  ables: dict[Hash
+00008030: 6162 6c65 2c20 5661 7269 6162 6c65 5d20  able, Variable] 
+00008040: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00008050: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
+00008060: 6573 3a20 7365 745b 4861 7368 6162 6c65  es: set[Hashable
+00008070: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+00008080: 0a20 2020 2020 2020 2064 696d 733a 2064  .        dims: d
+00008090: 6963 745b 416e 792c 2069 6e74 5d20 7c20  ict[Any, int] | 
+000080a0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+000080b0: 2020 2020 2061 7474 7273 3a20 6469 6374       attrs: dict
+000080c0: 5b48 6173 6861 626c 652c 2041 6e79 5d20  [Hashable, Any] 
+000080d0: 7c20 4e6f 6e65 207c 2044 6566 6175 6c74  | None | Default
+000080e0: 203d 205f 6465 6661 756c 742c 0a20 2020   = _default,.   
+000080f0: 2020 2020 2069 6e64 6578 6573 3a20 6469       indexes: di
+00008100: 6374 5b48 6173 6861 626c 652c 2049 6e64  ct[Hashable, Ind
+00008110: 6578 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ex] | None = Non
+00008120: 652c 0a20 2020 2020 2020 2065 6e63 6f64  e,.        encod
+00008130: 696e 673a 2064 6963 7420 7c20 4e6f 6e65  ing: dict | None
+00008140: 207c 2044 6566 6175 6c74 203d 205f 6465   | Default = _de
+00008150: 6661 756c 742c 0a20 2020 2020 2020 2069  fault,.        i
+00008160: 6e70 6c61 6365 3a20 626f 6f6c 203d 2046  nplace: bool = F
+00008170: 616c 7365 2c0a 2020 2020 2920 2d3e 2054  alse,.    ) -> T
+00008180: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+00008190: 2020 2222 2246 6173 7470 6174 6820 636f    """Fastpath co
+000081a0: 6e73 7472 7563 746f 7220 666f 7220 696e  nstructor for in
+000081b0: 7465 726e 616c 2075 7365 2e0a 0a20 2020  ternal use...   
+000081c0: 2020 2020 2052 6574 7572 6e73 2061 6e20       Returns an 
+000081d0: 6f62 6a65 6374 2077 6974 6820 6f70 7469  object with opti
+000081e0: 6f6e 616c 6c79 2077 6974 6820 7265 706c  onally with repl
+000081f0: 6163 6564 2061 7474 7269 6275 7465 732e  aced attributes.
+00008200: 0a0a 2020 2020 2020 2020 4578 706c 6963  ..        Explic
+00008210: 6974 6c79 2070 6173 7365 6420 6172 6775  itly passed argu
+00008220: 6d65 6e74 7320 6172 6520 2a6e 6f74 2a20  ments are *not* 
+00008230: 636f 7069 6564 2077 6865 6e20 706c 6163  copied when plac
+00008240: 6564 206f 6e20 7468 6520 6e65 770a 2020  ed on the new.  
+00008250: 2020 2020 2020 6461 7461 7365 742e 2049        dataset. I
+00008260: 7420 6973 2075 7020 746f 2074 6865 2063  t is up to the c
+00008270: 616c 6c65 7220 746f 2065 6e73 7572 6520  aller to ensure 
+00008280: 7468 6174 2074 6865 7920 6861 7665 2074  that they have t
+00008290: 6865 2072 6967 6874 2074 7970 650a 2020  he right type.  
+000082a0: 2020 2020 2020 616e 6420 6172 6520 6e6f        and are no
+000082b0: 7420 7573 6564 2065 6c73 6577 6865 7265  t used elsewhere
+000082c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000082d0: 2020 2020 2020 6966 2069 6e70 6c61 6365        if inplace
+000082e0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000082f0: 2076 6172 6961 626c 6573 2069 7320 6e6f   variables is no
+00008300: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00008310: 2020 2020 2020 2020 7365 6c66 2e5f 7661          self._va
+00008320: 7269 6162 6c65 7320 3d20 7661 7269 6162  riables = variab
+00008330: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
+00008340: 6966 2063 6f6f 7264 5f6e 616d 6573 2069  if coord_names i
+00008350: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00008360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008370: 2e5f 636f 6f72 645f 6e61 6d65 7320 3d20  ._coord_names = 
+00008380: 636f 6f72 645f 6e61 6d65 730a 2020 2020  coord_names.    
+00008390: 2020 2020 2020 2020 6966 2064 696d 7320          if dims 
+000083a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000083b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000083c0: 662e 5f64 696d 7320 3d20 6469 6d73 0a20  f._dims = dims. 
+000083d0: 2020 2020 2020 2020 2020 2069 6620 6174             if at
+000083e0: 7472 7320 6973 206e 6f74 205f 6465 6661  trs is not _defa
+000083f0: 756c 743a 0a20 2020 2020 2020 2020 2020  ult:.           
+00008400: 2020 2020 2073 656c 662e 5f61 7474 7273       self._attrs
+00008410: 203d 2061 7474 7273 0a20 2020 2020 2020   = attrs.       
+00008420: 2020 2020 2069 6620 696e 6465 7865 7320       if indexes 
+00008430: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00008440: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00008450: 662e 5f69 6e64 6578 6573 203d 2069 6e64  f._indexes = ind
+00008460: 6578 6573 0a20 2020 2020 2020 2020 2020  exes.           
+00008470: 2069 6620 656e 636f 6469 6e67 2069 7320   if encoding is 
+00008480: 6e6f 7420 5f64 6566 6175 6c74 3a0a 2020  not _default:.  
+00008490: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000084a0: 6c66 2e5f 656e 636f 6469 6e67 203d 2065  lf._encoding = e
+000084b0: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
+000084c0: 2020 2020 6f62 6a20 3d20 7365 6c66 0a20      obj = self. 
+000084d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000084e0: 2020 2020 2020 2020 2069 6620 7661 7269           if vari
+000084f0: 6162 6c65 7320 6973 204e 6f6e 653a 0a20  ables is None:. 
+00008500: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00008510: 6172 6961 626c 6573 203d 2073 656c 662e  ariables = self.
+00008520: 5f76 6172 6961 626c 6573 2e63 6f70 7928  _variables.copy(
+00008530: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00008540: 2063 6f6f 7264 5f6e 616d 6573 2069 7320   coord_names is 
+00008550: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00008560: 2020 2020 2020 636f 6f72 645f 6e61 6d65        coord_name
+00008570: 7320 3d20 7365 6c66 2e5f 636f 6f72 645f  s = self._coord_
+00008580: 6e61 6d65 732e 636f 7079 2829 0a20 2020  names.copy().   
+00008590: 2020 2020 2020 2020 2069 6620 6469 6d73           if dims
+000085a0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000085b0: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
+000085c0: 2073 656c 662e 5f64 696d 732e 636f 7079   self._dims.copy
+000085d0: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
+000085e0: 6620 6174 7472 7320 6973 205f 6465 6661  f attrs is _defa
+000085f0: 756c 743a 0a20 2020 2020 2020 2020 2020  ult:.           
+00008600: 2020 2020 2061 7474 7273 203d 2063 6f70       attrs = cop
+00008610: 792e 636f 7079 2873 656c 662e 5f61 7474  y.copy(self._att
+00008620: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+00008630: 6966 2069 6e64 6578 6573 2069 7320 4e6f  if indexes is No
+00008640: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00008650: 2020 2020 696e 6465 7865 7320 3d20 7365      indexes = se
+00008660: 6c66 2e5f 696e 6465 7865 732e 636f 7079  lf._indexes.copy
+00008670: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
+00008680: 6620 656e 636f 6469 6e67 2069 7320 5f64  f encoding is _d
+00008690: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
+000086a0: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
+000086b0: 203d 2063 6f70 792e 636f 7079 2873 656c   = copy.copy(sel
+000086c0: 662e 5f65 6e63 6f64 696e 6729 0a20 2020  f._encoding).   
+000086d0: 2020 2020 2020 2020 206f 626a 203d 2073           obj = s
+000086e0: 656c 662e 5f63 6f6e 7374 7275 6374 5f64  elf._construct_d
+000086f0: 6972 6563 7428 0a20 2020 2020 2020 2020  irect(.         
+00008700: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00008710: 2c20 636f 6f72 645f 6e61 6d65 732c 2064  , coord_names, d
+00008720: 696d 732c 2061 7474 7273 2c20 696e 6465  ims, attrs, inde
+00008730: 7865 732c 2065 6e63 6f64 696e 670a 2020  xes, encoding.  
+00008740: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00008750: 2020 2020 7265 7475 726e 206f 626a 0a0a      return obj..
+00008760: 2020 2020 6465 6620 5f72 6570 6c61 6365      def _replace
+00008770: 5f77 6974 685f 6e65 775f 6469 6d73 280a  _with_new_dims(.
+00008780: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
+00008790: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
+000087a0: 2076 6172 6961 626c 6573 3a20 6469 6374   variables: dict
+000087b0: 5b48 6173 6861 626c 652c 2056 6172 6961  [Hashable, Varia
+000087c0: 626c 655d 2c0a 2020 2020 2020 2020 636f  ble],.        co
+000087d0: 6f72 645f 6e61 6d65 733a 2073 6574 207c  ord_names: set |
+000087e0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+000087f0: 2020 2020 2020 6174 7472 733a 2064 6963        attrs: dic
+00008800: 745b 4861 7368 6162 6c65 2c20 416e 795d  t[Hashable, Any]
+00008810: 207c 204e 6f6e 6520 7c20 4465 6661 756c   | None | Defaul
+00008820: 7420 3d20 5f64 6566 6175 6c74 2c0a 2020  t = _default,.  
+00008830: 2020 2020 2020 696e 6465 7865 733a 2064        indexes: d
+00008840: 6963 745b 4861 7368 6162 6c65 2c20 496e  ict[Hashable, In
+00008850: 6465 785d 207c 204e 6f6e 6520 3d20 4e6f  dex] | None = No
+00008860: 6e65 2c0a 2020 2020 2020 2020 696e 706c  ne,.        inpl
+00008870: 6163 653a 2062 6f6f 6c20 3d20 4661 6c73  ace: bool = Fals
+00008880: 652c 0a20 2020 2029 202d 3e20 545f 4461  e,.    ) -> T_Da
+00008890: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+000088a0: 2222 5265 706c 6163 6520 7661 7269 6162  ""Replace variab
+000088b0: 6c65 7320 7769 7468 2072 6563 616c 6375  les with recalcu
+000088c0: 6c61 7465 6420 6469 6d65 6e73 696f 6e73  lated dimensions
+000088d0: 2e22 2222 0a20 2020 2020 2020 2064 696d  .""".        dim
+000088e0: 7320 3d20 6361 6c63 756c 6174 655f 6469  s = calculate_di
+000088f0: 6d65 6e73 696f 6e73 2876 6172 6961 626c  mensions(variabl
+00008900: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
+00008910: 726e 2073 656c 662e 5f72 6570 6c61 6365  rn self._replace
+00008920: 280a 2020 2020 2020 2020 2020 2020 7661  (.            va
+00008930: 7269 6162 6c65 732c 2063 6f6f 7264 5f6e  riables, coord_n
+00008940: 616d 6573 2c20 6469 6d73 2c20 6174 7472  ames, dims, attr
+00008950: 732c 2069 6e64 6578 6573 2c20 696e 706c  s, indexes, inpl
+00008960: 6163 653d 696e 706c 6163 650a 2020 2020  ace=inplace.    
+00008970: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
+00008980: 7265 706c 6163 655f 7661 7273 5f61 6e64  replace_vars_and
+00008990: 5f64 696d 7328 0a20 2020 2020 2020 2073  _dims(.        s
+000089a0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
+000089b0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+000089c0: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
+000089d0: 2c20 5661 7269 6162 6c65 5d2c 0a20 2020  , Variable],.   
+000089e0: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
+000089f0: 3a20 7365 7420 7c20 4e6f 6e65 203d 204e  : set | None = N
+00008a00: 6f6e 652c 0a20 2020 2020 2020 2064 696d  one,.        dim
+00008a10: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
+00008a20: 2c20 696e 745d 207c 204e 6f6e 6520 3d20  , int] | None = 
+00008a30: 4e6f 6e65 2c0a 2020 2020 2020 2020 6174  None,.        at
+00008a40: 7472 733a 2064 6963 745b 4861 7368 6162  trs: dict[Hashab
+00008a50: 6c65 2c20 416e 795d 207c 204e 6f6e 6520  le, Any] | None 
+00008a60: 7c20 4465 6661 756c 7420 3d20 5f64 6566  | Default = _def
+00008a70: 6175 6c74 2c0a 2020 2020 2020 2020 696e  ault,.        in
+00008a80: 706c 6163 653a 2062 6f6f 6c20 3d20 4661  place: bool = Fa
+00008a90: 6c73 652c 0a20 2020 2029 202d 3e20 545f  lse,.    ) -> T_
+00008aa0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+00008ab0: 2022 2222 4465 7072 6563 6174 6564 2076   """Deprecated v
+00008ac0: 6572 7369 6f6e 206f 6620 5f72 6570 6c61  ersion of _repla
+00008ad0: 6365 5f77 6974 685f 6e65 775f 6469 6d73  ce_with_new_dims
+00008ae0: 2829 2e0a 0a20 2020 2020 2020 2055 6e6c  ()...        Unl
+00008af0: 696b 6520 5f72 6570 6c61 6365 5f77 6974  ike _replace_wit
+00008b00: 685f 6e65 775f 6469 6d73 2829 2c20 7468  h_new_dims(), th
+00008b10: 6973 206d 6574 686f 6420 616c 7761 7973  is method always
+00008b20: 2072 6563 616c 6375 6c61 7465 730a 2020   recalculates.  
+00008b30: 2020 2020 2020 696e 6465 7865 7320 6672        indexes fr
+00008b40: 6f6d 2076 6172 6961 626c 6573 2e0a 2020  om variables..  
+00008b50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00008b60: 2020 6966 2064 696d 7320 6973 204e 6f6e    if dims is Non
+00008b70: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+00008b80: 696d 7320 3d20 6361 6c63 756c 6174 655f  ims = calculate_
+00008b90: 6469 6d65 6e73 696f 6e73 2876 6172 6961  dimensions(varia
+00008ba0: 626c 6573 290a 2020 2020 2020 2020 7265  bles).        re
+00008bb0: 7475 726e 2073 656c 662e 5f72 6570 6c61  turn self._repla
+00008bc0: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+00008bd0: 7661 7269 6162 6c65 732c 2063 6f6f 7264  variables, coord
+00008be0: 5f6e 616d 6573 2c20 6469 6d73 2c20 6174  _names, dims, at
+00008bf0: 7472 732c 2069 6e64 6578 6573 3d4e 6f6e  trs, indexes=Non
+00008c00: 652c 2069 6e70 6c61 6365 3d69 6e70 6c61  e, inplace=inpla
+00008c10: 6365 0a20 2020 2020 2020 2029 0a0a 2020  ce.        )..  
+00008c20: 2020 6465 6620 5f6f 7665 7277 7269 7465    def _overwrite
+00008c30: 5f69 6e64 6578 6573 280a 2020 2020 2020  _indexes(.      
+00008c40: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
+00008c50: 742c 0a20 2020 2020 2020 2069 6e64 6578  t,.        index
+00008c60: 6573 3a20 4d61 7070 696e 675b 4861 7368  es: Mapping[Hash
+00008c70: 6162 6c65 2c20 496e 6465 785d 2c0a 2020  able, Index],.  
+00008c80: 2020 2020 2020 7661 7269 6162 6c65 733a        variables:
+00008c90: 204d 6170 7069 6e67 5b48 6173 6861 626c   Mapping[Hashabl
+00008ca0: 652c 2056 6172 6961 626c 655d 207c 204e  e, Variable] | N
+00008cb0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00008cc0: 2020 2020 6472 6f70 5f76 6172 6961 626c      drop_variabl
+00008cd0: 6573 3a20 6c69 7374 5b48 6173 6861 626c  es: list[Hashabl
+00008ce0: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
+00008cf0: 2c0a 2020 2020 2020 2020 6472 6f70 5f69  ,.        drop_i
+00008d00: 6e64 6578 6573 3a20 6c69 7374 5b48 6173  ndexes: list[Has
+00008d10: 6861 626c 655d 207c 204e 6f6e 6520 3d20  hable] | None = 
+00008d20: 4e6f 6e65 2c0a 2020 2020 2020 2020 7265  None,.        re
+00008d30: 6e61 6d65 5f64 696d 733a 204d 6170 7069  name_dims: Mappi
+00008d40: 6e67 5b48 6173 6861 626c 652c 2048 6173  ng[Hashable, Has
+00008d50: 6861 626c 655d 207c 204e 6f6e 6520 3d20  hable] | None = 
+00008d60: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2054  None,.    ) -> T
+00008d70: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+00008d80: 2020 2222 224d 6179 6265 2072 6570 6c61    """Maybe repla
+00008d90: 6365 2069 6e64 6578 6573 2e0a 0a20 2020  ce indexes...   
+00008da0: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
+00008db0: 6f6e 206d 6179 2064 6f20 6120 6c6f 7420  on may do a lot 
+00008dc0: 6d6f 7265 2064 6570 656e 6469 6e67 206f  more depending o
+00008dd0: 6e20 696e 6465 7820 7175 6572 790a 2020  n index query.  
+00008de0: 2020 2020 2020 7265 7375 6c74 732e 0a0a        results...
+00008df0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00008e00: 2020 2020 6966 206e 6f74 2069 6e64 6578      if not index
+00008e10: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00008e20: 7265 7475 726e 2073 656c 660a 0a20 2020  return self..   
+00008e30: 2020 2020 2069 6620 7661 7269 6162 6c65       if variable
+00008e40: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00008e50: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00008e60: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
+00008e70: 2064 726f 705f 7661 7269 6162 6c65 7320   drop_variables 
+00008e80: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00008e90: 2020 2020 2064 726f 705f 7661 7269 6162       drop_variab
+00008ea0: 6c65 7320 3d20 5b5d 0a20 2020 2020 2020  les = [].       
+00008eb0: 2069 6620 6472 6f70 5f69 6e64 6578 6573   if drop_indexes
+00008ec0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00008ed0: 2020 2020 2020 6472 6f70 5f69 6e64 6578        drop_index
+00008ee0: 6573 203d 205b 5d0a 0a20 2020 2020 2020  es = []..       
+00008ef0: 206e 6577 5f76 6172 6961 626c 6573 203d   new_variables =
+00008f00: 2073 656c 662e 5f76 6172 6961 626c 6573   self._variables
+00008f10: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+00008f20: 6e65 775f 636f 6f72 645f 6e61 6d65 7320  new_coord_names 
+00008f30: 3d20 7365 6c66 2e5f 636f 6f72 645f 6e61  = self._coord_na
+00008f40: 6d65 732e 636f 7079 2829 0a20 2020 2020  mes.copy().     
+00008f50: 2020 206e 6577 5f69 6e64 6578 6573 203d     new_indexes =
+00008f60: 2064 6963 7428 7365 6c66 2e5f 696e 6465   dict(self._inde
+00008f70: 7865 7329 0a0a 2020 2020 2020 2020 696e  xes)..        in
+00008f80: 6465 785f 7661 7269 6162 6c65 7320 3d20  dex_variables = 
+00008f90: 7b7d 0a20 2020 2020 2020 206e 6f5f 696e  {}.        no_in
+00008fa0: 6465 785f 7661 7269 6162 6c65 7320 3d20  dex_variables = 
+00008fb0: 7b7d 0a20 2020 2020 2020 2066 6f72 206e  {}.        for n
+00008fc0: 616d 652c 2076 6172 2069 6e20 7661 7269  ame, var in vari
+00008fd0: 6162 6c65 732e 6974 656d 7328 293a 0a20  ables.items():. 
+00008fe0: 2020 2020 2020 2020 2020 206f 6c64 5f76             old_v
+00008ff0: 6172 203d 2073 656c 662e 5f76 6172 6961  ar = self._varia
+00009000: 626c 6573 2e67 6574 286e 616d 6529 0a20  bles.get(name). 
+00009010: 2020 2020 2020 2020 2020 2069 6620 6f6c             if ol
+00009020: 645f 7661 7220 6973 206e 6f74 204e 6f6e  d_var is not Non
+00009030: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00009040: 2020 2076 6172 2e61 7474 7273 2e75 7064     var.attrs.upd
+00009050: 6174 6528 6f6c 645f 7661 722e 6174 7472  ate(old_var.attr
+00009060: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00009070: 2020 2076 6172 2e65 6e63 6f64 696e 672e     var.encoding.
+00009080: 7570 6461 7465 286f 6c64 5f76 6172 2e65  update(old_var.e
+00009090: 6e63 6f64 696e 6729 0a20 2020 2020 2020  ncoding).       
+000090a0: 2020 2020 2069 6620 6e61 6d65 2069 6e20       if name in 
+000090b0: 696e 6465 7865 733a 0a20 2020 2020 2020  indexes:.       
+000090c0: 2020 2020 2020 2020 2069 6e64 6578 5f76           index_v
+000090d0: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
+000090e0: 2076 6172 0a20 2020 2020 2020 2020 2020   var.           
+000090f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00009100: 2020 2020 2020 206e 6f5f 696e 6465 785f         no_index_
+00009110: 7661 7269 6162 6c65 735b 6e61 6d65 5d20  variables[name] 
+00009120: 3d20 7661 720a 0a20 2020 2020 2020 2066  = var..        f
+00009130: 6f72 206e 616d 6520 696e 2069 6e64 6578  or name in index
+00009140: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00009150: 6e65 775f 696e 6465 7865 735b 6e61 6d65  new_indexes[name
+00009160: 5d20 3d20 696e 6465 7865 735b 6e61 6d65  ] = indexes[name
+00009170: 5d0a 0a20 2020 2020 2020 2066 6f72 206e  ]..        for n
+00009180: 616d 652c 2076 6172 2069 6e20 696e 6465  ame, var in inde
+00009190: 785f 7661 7269 6162 6c65 732e 6974 656d  x_variables.item
+000091a0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000091b0: 206e 6577 5f63 6f6f 7264 5f6e 616d 6573   new_coord_names
+000091c0: 2e61 6464 286e 616d 6529 0a20 2020 2020  .add(name).     
+000091d0: 2020 2020 2020 206e 6577 5f76 6172 6961         new_varia
+000091e0: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
+000091f0: 0a0a 2020 2020 2020 2020 2320 6170 7065  ..        # appe
+00009200: 6e64 206e 6f2d 696e 6465 7820 7661 7269  nd no-index vari
+00009210: 6162 6c65 7320 6174 2074 6865 2065 6e64  ables at the end
+00009220: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
+00009230: 6e20 6e6f 5f69 6e64 6578 5f76 6172 6961  n no_index_varia
+00009240: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+00009250: 2020 6e65 775f 7661 7269 6162 6c65 732e    new_variables.
+00009260: 706f 7028 6b29 0a20 2020 2020 2020 206e  pop(k).        n
+00009270: 6577 5f76 6172 6961 626c 6573 2e75 7064  ew_variables.upd
+00009280: 6174 6528 6e6f 5f69 6e64 6578 5f76 6172  ate(no_index_var
+00009290: 6961 626c 6573 290a 0a20 2020 2020 2020  iables)..       
+000092a0: 2066 6f72 206e 616d 6520 696e 2064 726f   for name in dro
+000092b0: 705f 696e 6465 7865 733a 0a20 2020 2020  p_indexes:.     
+000092c0: 2020 2020 2020 206e 6577 5f69 6e64 6578         new_index
+000092d0: 6573 2e70 6f70 286e 616d 6529 0a0a 2020  es.pop(name)..  
+000092e0: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
+000092f0: 6e20 6472 6f70 5f76 6172 6961 626c 6573  n drop_variables
+00009300: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
+00009310: 775f 7661 7269 6162 6c65 732e 706f 7028  w_variables.pop(
+00009320: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00009330: 2020 6e65 775f 696e 6465 7865 732e 706f    new_indexes.po
+00009340: 7028 6e61 6d65 2c20 4e6f 6e65 290a 2020  p(name, None).  
+00009350: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
+00009360: 6f72 645f 6e61 6d65 732e 7265 6d6f 7665  ord_names.remove
+00009370: 286e 616d 6529 0a0a 2020 2020 2020 2020  (name)..        
+00009380: 7265 706c 6163 6564 203d 2073 656c 662e  replaced = self.
+00009390: 5f72 6570 6c61 6365 280a 2020 2020 2020  _replace(.      
+000093a0: 2020 2020 2020 7661 7269 6162 6c65 733d        variables=
+000093b0: 6e65 775f 7661 7269 6162 6c65 732c 2063  new_variables, c
+000093c0: 6f6f 7264 5f6e 616d 6573 3d6e 6577 5f63  oord_names=new_c
+000093d0: 6f6f 7264 5f6e 616d 6573 2c20 696e 6465  oord_names, inde
+000093e0: 7865 733d 6e65 775f 696e 6465 7865 730a  xes=new_indexes.
+000093f0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00009400: 2020 2069 6620 7265 6e61 6d65 5f64 696d     if rename_dim
+00009410: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
+00009420: 2073 6b69 7020 7265 6e61 6d65 2069 6e64   skip rename ind
+00009430: 6578 6573 3a20 7468 6579 2073 686f 756c  exes: they shoul
+00009440: 6420 616c 7265 6164 7920 6861 7665 2074  d already have t
+00009450: 6865 2072 6967 6874 206e 616d 6528 7329  he right name(s)
+00009460: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00009470: 7320 3d20 7265 706c 6163 6564 2e5f 7265  s = replaced._re
+00009480: 6e61 6d65 5f64 696d 7328 7265 6e61 6d65  name_dims(rename
+00009490: 5f64 696d 7329 0a20 2020 2020 2020 2020  _dims).         
+000094a0: 2020 206e 6577 5f76 6172 6961 626c 6573     new_variables
+000094b0: 2c20 6e65 775f 636f 6f72 645f 6e61 6d65  , new_coord_name
+000094c0: 7320 3d20 7265 706c 6163 6564 2e5f 7265  s = replaced._re
+000094d0: 6e61 6d65 5f76 6172 7328 7b7d 2c20 7265  name_vars({}, re
+000094e0: 6e61 6d65 5f64 696d 7329 0a20 2020 2020  name_dims).     
+000094f0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00009500: 706c 6163 6564 2e5f 7265 706c 6163 6528  placed._replace(
+00009510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009520: 2076 6172 6961 626c 6573 3d6e 6577 5f76   variables=new_v
+00009530: 6172 6961 626c 6573 2c20 636f 6f72 645f  ariables, coord_
+00009540: 6e61 6d65 733d 6e65 775f 636f 6f72 645f  names=new_coord_
+00009550: 6e61 6d65 732c 2064 696d 733d 6469 6d73  names, dims=dims
+00009560: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00009570: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00009580: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00009590: 7265 706c 6163 6564 0a0a 2020 2020 6465  replaced..    de
+000095a0: 6620 636f 7079 280a 2020 2020 2020 2020  f copy(.        
+000095b0: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+000095c0: 2064 6565 703a 2062 6f6f 6c20 3d20 4661   deep: bool = Fa
+000095d0: 6c73 652c 2064 6174 613a 204d 6170 7069  lse, data: Mappi
+000095e0: 6e67 5b41 6e79 2c20 4172 7261 794c 696b  ng[Any, ArrayLik
+000095f0: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
+00009600: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
+00009610: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
+00009620: 5265 7475 726e 7320 6120 636f 7079 206f  Returns a copy o
+00009630: 6620 7468 6973 2064 6174 6173 6574 2e0a  f this dataset..
+00009640: 0a20 2020 2020 2020 2049 6620 6064 6565  .        If `dee
+00009650: 703d 5472 7565 602c 2061 2064 6565 7020  p=True`, a deep 
+00009660: 636f 7079 2069 7320 6d61 6465 206f 6620  copy is made of 
+00009670: 6561 6368 206f 6620 7468 6520 636f 6d70  each of the comp
+00009680: 6f6e 656e 7420 7661 7269 6162 6c65 732e  onent variables.
+00009690: 0a20 2020 2020 2020 204f 7468 6572 7769  .        Otherwi
+000096a0: 7365 2c20 6120 7368 616c 6c6f 7720 636f  se, a shallow co
+000096b0: 7079 206f 6620 6561 6368 206f 6620 7468  py of each of th
+000096c0: 6520 636f 6d70 6f6e 656e 7420 7661 7269  e component vari
+000096d0: 6162 6c65 2069 7320 6d61 6465 2c20 736f  able is made, so
+000096e0: 0a20 2020 2020 2020 2074 6861 7420 7468  .        that th
+000096f0: 6520 756e 6465 726c 7969 6e67 206d 656d  e underlying mem
+00009700: 6f72 7920 7265 6769 6f6e 206f 6620 7468  ory region of th
+00009710: 6520 6e65 7720 6461 7461 7365 7420 6973  e new dataset is
+00009720: 2074 6865 2073 616d 6520 6173 2069 6e0a   the same as in.
+00009730: 2020 2020 2020 2020 7468 6520 6f72 6967          the orig
+00009740: 696e 616c 2064 6174 6173 6574 2e0a 0a20  inal dataset... 
+00009750: 2020 2020 2020 2055 7365 2060 6461 7461         Use `data
+00009760: 6020 746f 2063 7265 6174 6520 6120 6e65  ` to create a ne
+00009770: 7720 6f62 6a65 6374 2077 6974 6820 7468  w object with th
+00009780: 6520 7361 6d65 2073 7472 7563 7475 7265  e same structure
+00009790: 2061 730a 2020 2020 2020 2020 6f72 6967   as.        orig
+000097a0: 696e 616c 2062 7574 2065 6e74 6972 656c  inal but entirel
+000097b0: 7920 6e65 7720 6461 7461 2e0a 0a20 2020  y new data...   
+000097c0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+000097d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000097e0: 2d2d 0a20 2020 2020 2020 2064 6565 7020  --.        deep 
+000097f0: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
+00009800: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+00009810: 2020 2057 6865 7468 6572 2065 6163 6820     Whether each 
+00009820: 636f 6d70 6f6e 656e 7420 7661 7269 6162  component variab
+00009830: 6c65 2069 7320 6c6f 6164 6564 2069 6e74  le is loaded int
+00009840: 6f20 6d65 6d6f 7279 2061 6e64 2063 6f70  o memory and cop
+00009850: 6965 6420 6f6e 746f 0a20 2020 2020 2020  ied onto.       
+00009860: 2020 2020 2074 6865 206e 6577 206f 626a       the new obj
+00009870: 6563 742e 2044 6566 6175 6c74 2069 7320  ect. Default is 
+00009880: 4661 6c73 652e 0a20 2020 2020 2020 2064  False..        d
+00009890: 6174 6120 3a20 6469 6374 2d6c 696b 6520  ata : dict-like 
+000098a0: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
+000098b0: 6c0a 2020 2020 2020 2020 2020 2020 4461  l.            Da
+000098c0: 7461 2074 6f20 7573 6520 696e 2074 6865  ta to use in the
+000098d0: 206e 6577 206f 626a 6563 742e 2045 6163   new object. Eac
+000098e0: 6820 6974 656d 2069 6e20 6064 6174 6160  h item in `data`
+000098f0: 206d 7573 7420 6861 7665 2073 616d 650a   must have same.
+00009900: 2020 2020 2020 2020 2020 2020 7368 6170              shap
+00009910: 6520 6173 2063 6f72 7265 7370 6f6e 6469  e as correspondi
+00009920: 6e67 2064 6174 6120 7661 7269 6162 6c65  ng data variable
+00009930: 2069 6e20 6f72 6967 696e 616c 2e20 5768   in original. Wh
+00009940: 656e 2060 6461 7461 6020 6973 0a20 2020  en `data` is.   
+00009950: 2020 2020 2020 2020 2075 7365 642c 2060           used, `
+00009960: 6465 6570 6020 6973 2069 676e 6f72 6564  deep` is ignored
+00009970: 2066 6f72 2074 6865 2064 6174 6120 7661   for the data va
+00009980: 7269 6162 6c65 7320 616e 6420 6f6e 6c79  riables and only
+00009990: 2075 7365 6420 666f 720a 2020 2020 2020   used for.      
+000099a0: 2020 2020 2020 636f 6f72 6473 2e0a 0a20        coords... 
+000099b0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+000099c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+000099d0: 2020 2020 2020 206f 626a 6563 7420 3a20         object : 
+000099e0: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
+000099f0: 2020 2020 4e65 7720 6f62 6a65 6374 2077      New object w
+00009a00: 6974 6820 6469 6d65 6e73 696f 6e73 2c20  ith dimensions, 
+00009a10: 6174 7472 6962 7574 6573 2c20 636f 6f72  attributes, coor
+00009a20: 6469 6e61 7465 732c 206e 616d 652c 2065  dinates, name, e
+00009a30: 6e63 6f64 696e 672c 0a20 2020 2020 2020  ncoding,.       
+00009a40: 2020 2020 2061 6e64 206f 7074 696f 6e61       and optiona
+00009a50: 6c6c 7920 6461 7461 2063 6f70 6965 6420  lly data copied 
+00009a60: 6672 6f6d 206f 7269 6769 6e61 6c2e 0a0a  from original...
+00009a70: 2020 2020 2020 2020 4578 616d 706c 6573          Examples
+00009a80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00009a90: 2d0a 2020 2020 2020 2020 5368 616c 6c6f  -.        Shallo
+00009aa0: 7720 636f 7079 2076 6572 7375 7320 6465  w copy versus de
+00009ab0: 6570 2063 6f70 790a 0a20 2020 2020 2020  ep copy..       
+00009ac0: 203e 3e3e 2064 6120 3d20 7872 2e44 6174   >>> da = xr.Dat
+00009ad0: 6141 7272 6179 286e 702e 7261 6e64 6f6d  aArray(np.random
+00009ae0: 2e72 616e 646e 2832 2c20 3329 290a 2020  .randn(2, 3)).  
+00009af0: 2020 2020 2020 3e3e 3e20 6473 203d 2078        >>> ds = x
+00009b00: 722e 4461 7461 7365 7428 0a20 2020 2020  r.Dataset(.     
+00009b10: 2020 202e 2e2e 2020 2020 207b 2266 6f6f     ...     {"foo
+00009b20: 223a 2064 612c 2022 6261 7222 3a20 2822  ": da, "bar": ("
+00009b30: 7822 2c20 5b2d 312c 2032 5d29 7d2c 0a20  x", [-1, 2])},. 
+00009b40: 2020 2020 2020 202e 2e2e 2020 2020 2063         ...     c
+00009b50: 6f6f 7264 733d 7b22 7822 3a20 5b22 6f6e  oords={"x": ["on
+00009b60: 6522 2c20 2274 776f 225d 7d2c 0a20 2020  e", "two"]},.   
+00009b70: 2020 2020 202e 2e2e 2029 0a20 2020 2020       ... ).     
+00009b80: 2020 203e 3e3e 2064 732e 636f 7079 2829     >>> ds.copy()
+00009b90: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+00009ba0: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
+00009bb0: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
+00009bc0: 6469 6d5f 303a 2032 2c20 6469 6d5f 313a  dim_0: 2, dim_1:
+00009bd0: 2033 2c20 783a 2032 290a 2020 2020 2020   3, x: 2).      
+00009be0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+00009bf0: 2020 2020 2020 2020 202a 2078 2020 2020           * x    
+00009c00: 2020 2020 2878 2920 3c55 3320 276f 6e65      (x) <U3 'one
+00009c10: 2720 2774 776f 270a 2020 2020 2020 2020  ' 'two'.        
+00009c20: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
+00009c30: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
+00009c40: 6469 6d5f 302c 2064 696d 5f31 0a20 2020  dim_0, dim_1.   
+00009c50: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+00009c60: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00009c70: 2066 6f6f 2020 2020 2020 2864 696d 5f30   foo      (dim_0
+00009c80: 2c20 6469 6d5f 3129 2066 6c6f 6174 3634  , dim_1) float64
+00009c90: 2031 2e37 3634 2030 2e34 3030 3220 302e   1.764 0.4002 0.
+00009ca0: 3937 3837 2032 2e32 3431 2031 2e38 3638  9787 2.241 1.868
+00009cb0: 202d 302e 3937 3733 0a20 2020 2020 2020   -0.9773.       
+00009cc0: 2020 2020 2062 6172 2020 2020 2020 2878       bar      (x
+00009cd0: 2920 696e 7436 3420 2d31 2032 0a0a 2020  ) int64 -1 2..  
+00009ce0: 2020 2020 2020 3e3e 3e20 6473 5f30 203d        >>> ds_0 =
+00009cf0: 2064 732e 636f 7079 2864 6565 703d 4661   ds.copy(deep=Fa
+00009d00: 6c73 6529 0a20 2020 2020 2020 203e 3e3e  lse).        >>>
+00009d10: 2064 735f 305b 2266 6f6f 225d 5b30 2c20   ds_0["foo"][0, 
+00009d20: 305d 203d 2037 0a20 2020 2020 2020 203e  0] = 7.        >
+00009d30: 3e3e 2064 735f 300a 2020 2020 2020 2020  >> ds_0.        
+00009d40: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
+00009d50: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00009d60: 6f6e 733a 2020 2864 696d 5f30 3a20 322c  ons:  (dim_0: 2,
+00009d70: 2064 696d 5f31 3a20 332c 2078 3a20 3229   dim_1: 3, x: 2)
+00009d80: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
+00009d90: 6174 6573 3a0a 2020 2020 2020 2020 2020  ates:.          
+00009da0: 2a20 7820 2020 2020 2020 2028 7829 203c  * x        (x) <
+00009db0: 5533 2027 6f6e 6527 2027 7477 6f27 0a20  U3 'one' 'two'. 
+00009dc0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+00009dd0: 7320 7769 7468 6f75 7420 636f 6f72 6469  s without coordi
+00009de0: 6e61 7465 733a 2064 696d 5f30 2c20 6469  nates: dim_0, di
+00009df0: 6d5f 310a 2020 2020 2020 2020 4461 7461  m_1.        Data
+00009e00: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+00009e10: 2020 2020 2020 2020 666f 6f20 2020 2020          foo     
+00009e20: 2028 6469 6d5f 302c 2064 696d 5f31 2920   (dim_0, dim_1) 
+00009e30: 666c 6f61 7436 3420 372e 3020 302e 3430  float64 7.0 0.40
+00009e40: 3032 2030 2e39 3738 3720 322e 3234 3120  02 0.9787 2.241 
+00009e50: 312e 3836 3820 2d30 2e39 3737 330a 2020  1.868 -0.9773.  
+00009e60: 2020 2020 2020 2020 2020 6261 7220 2020            bar   
+00009e70: 2020 2028 7829 2069 6e74 3634 202d 3120     (x) int64 -1 
+00009e80: 320a 0a20 2020 2020 2020 203e 3e3e 2064  2..        >>> d
+00009e90: 730a 2020 2020 2020 2020 3c78 6172 7261  s.        <xarra
+00009ea0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+00009eb0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+00009ec0: 2864 696d 5f30 3a20 322c 2064 696d 5f31  (dim_0: 2, dim_1
+00009ed0: 3a20 332c 2078 3a20 3229 0a20 2020 2020  : 3, x: 2).     
+00009ee0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+00009ef0: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+00009f00: 2020 2020 2028 7829 203c 5533 2027 6f6e       (x) <U3 'on
+00009f10: 6527 2027 7477 6f27 0a20 2020 2020 2020  e' 'two'.       
+00009f20: 2044 696d 656e 7369 6f6e 7320 7769 7468   Dimensions with
+00009f30: 6f75 7420 636f 6f72 6469 6e61 7465 733a  out coordinates:
+00009f40: 2064 696d 5f30 2c20 6469 6d5f 310a 2020   dim_0, dim_1.  
+00009f50: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+00009f60: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+00009f70: 2020 666f 6f20 2020 2020 2028 6469 6d5f    foo      (dim_
+00009f80: 302c 2064 696d 5f31 2920 666c 6f61 7436  0, dim_1) float6
+00009f90: 3420 372e 3020 302e 3430 3032 2030 2e39  4 7.0 0.4002 0.9
+00009fa0: 3738 3720 322e 3234 3120 312e 3836 3820  787 2.241 1.868 
+00009fb0: 2d30 2e39 3737 330a 2020 2020 2020 2020  -0.9773.        
+00009fc0: 2020 2020 6261 7220 2020 2020 2028 7829      bar      (x)
+00009fd0: 2069 6e74 3634 202d 3120 320a 0a20 2020   int64 -1 2..   
+00009fe0: 2020 2020 2043 6861 6e67 696e 6720 7468       Changing th
+00009ff0: 6520 6461 7461 2075 7369 6e67 2074 6865  e data using the
+0000a000: 2060 6064 6174 6160 6020 6172 6775 6d65   ``data`` argume
+0000a010: 6e74 206d 6169 6e74 6169 6e73 2074 6865  nt maintains the
+0000a020: 0a20 2020 2020 2020 2073 7472 7563 7475  .        structu
+0000a030: 7265 206f 6620 7468 6520 6f72 6967 696e  re of the origin
+0000a040: 616c 206f 626a 6563 742c 2062 7574 2077  al object, but w
+0000a050: 6974 6820 7468 6520 6e65 7720 6461 7461  ith the new data
+0000a060: 2e20 4f72 6967 696e 616c 0a20 2020 2020  . Original.     
+0000a070: 2020 206f 626a 6563 7420 6973 2075 6e61     object is una
+0000a080: 6666 6563 7465 642e 0a0a 2020 2020 2020  ffected...      
+0000a090: 2020 3e3e 3e20 6473 2e63 6f70 7928 6461    >>> ds.copy(da
+0000a0a0: 7461 3d7b 2266 6f6f 223a 206e 702e 6172  ta={"foo": np.ar
+0000a0b0: 616e 6765 2836 292e 7265 7368 6170 6528  ange(6).reshape(
+0000a0c0: 322c 2033 292c 2022 6261 7222 3a20 5b22  2, 3), "bar": ["
+0000a0d0: 6122 2c20 2262 225d 7d29 0a20 2020 2020  a", "b"]}).     
+0000a0e0: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+0000a0f0: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+0000a100: 6e73 696f 6e73 3a20 2028 6469 6d5f 303a  nsions:  (dim_0:
+0000a110: 2032 2c20 6469 6d5f 313a 2033 2c20 783a   2, dim_1: 3, x:
+0000a120: 2032 290a 2020 2020 2020 2020 436f 6f72   2).        Coor
+0000a130: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
+0000a140: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
+0000a150: 2920 3c55 3320 276f 6e65 2720 2774 776f  ) <U3 'one' 'two
+0000a160: 270a 2020 2020 2020 2020 4469 6d65 6e73  '.        Dimens
+0000a170: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
+0000a180: 7264 696e 6174 6573 3a20 6469 6d5f 302c  rdinates: dim_0,
+0000a190: 2064 696d 5f31 0a20 2020 2020 2020 2044   dim_1.        D
+0000a1a0: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+0000a1b0: 2020 2020 2020 2020 2020 2066 6f6f 2020             foo  
+0000a1c0: 2020 2020 2864 696d 5f30 2c20 6469 6d5f      (dim_0, dim_
+0000a1d0: 3129 2069 6e74 3634 2030 2031 2032 2033  1) int64 0 1 2 3
+0000a1e0: 2034 2035 0a20 2020 2020 2020 2020 2020   4 5.           
+0000a1f0: 2062 6172 2020 2020 2020 2878 2920 3c55   bar      (x) <U
+0000a200: 3120 2761 2720 2762 270a 0a20 2020 2020  1 'a' 'b'..     
+0000a210: 2020 203e 3e3e 2064 730a 2020 2020 2020     >>> ds.      
+0000a220: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
+0000a230: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
+0000a240: 7369 6f6e 733a 2020 2864 696d 5f30 3a20  sions:  (dim_0: 
+0000a250: 322c 2064 696d 5f31 3a20 332c 2078 3a20  2, dim_1: 3, x: 
+0000a260: 3229 0a20 2020 2020 2020 2043 6f6f 7264  2).        Coord
+0000a270: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
+0000a280: 2020 2a20 7820 2020 2020 2020 2028 7829    * x        (x)
+0000a290: 203c 5533 2027 6f6e 6527 2027 7477 6f27   <U3 'one' 'two'
+0000a2a0: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+0000a2b0: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
+0000a2c0: 6469 6e61 7465 733a 2064 696d 5f30 2c20  dinates: dim_0, 
+0000a2d0: 6469 6d5f 310a 2020 2020 2020 2020 4461  dim_1.        Da
+0000a2e0: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+0000a2f0: 2020 2020 2020 2020 2020 666f 6f20 2020            foo   
+0000a300: 2020 2028 6469 6d5f 302c 2064 696d 5f31     (dim_0, dim_1
+0000a310: 2920 666c 6f61 7436 3420 372e 3020 302e  ) float64 7.0 0.
+0000a320: 3430 3032 2030 2e39 3738 3720 322e 3234  4002 0.9787 2.24
+0000a330: 3120 312e 3836 3820 2d30 2e39 3737 330a  1 1.868 -0.9773.
+0000a340: 2020 2020 2020 2020 2020 2020 6261 7220              bar 
+0000a350: 2020 2020 2028 7829 2069 6e74 3634 202d       (x) int64 -
+0000a360: 3120 320a 0a20 2020 2020 2020 2053 6565  1 2..        See
+0000a370: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+0000a380: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
+0000a390: 616e 6461 732e 4461 7461 4672 616d 652e  andas.DataFrame.
+0000a3a0: 636f 7079 0a20 2020 2020 2020 2022 2222  copy.        """
+0000a3b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000a3c0: 7365 6c66 2e5f 636f 7079 2864 6565 703d  self._copy(deep=
+0000a3d0: 6465 6570 2c20 6461 7461 3d64 6174 6129  deep, data=data)
+0000a3e0: 0a0a 2020 2020 6465 6620 5f63 6f70 7928  ..    def _copy(
+0000a3f0: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
+0000a400: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
+0000a410: 2020 6465 6570 3a20 626f 6f6c 203d 2046    deep: bool = F
+0000a420: 616c 7365 2c0a 2020 2020 2020 2020 6461  alse,.        da
+0000a430: 7461 3a20 4d61 7070 696e 675b 416e 792c  ta: Mapping[Any,
+0000a440: 2041 7272 6179 4c69 6b65 5d20 7c20 4e6f   ArrayLike] | No
+0000a450: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+0000a460: 2020 206d 656d 6f3a 2064 6963 745b 696e     memo: dict[in
+0000a470: 742c 2041 6e79 5d20 7c20 4e6f 6e65 203d  t, Any] | None =
+0000a480: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+0000a490: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+0000a4a0: 2020 2069 6620 6461 7461 2069 7320 4e6f     if data is No
+0000a4b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000a4c0: 6461 7461 203d 207b 7d0a 2020 2020 2020  data = {}.      
+0000a4d0: 2020 656c 6966 206e 6f74 2075 7469 6c73    elif not utils
+0000a4e0: 2e69 735f 6469 6374 5f6c 696b 6528 6461  .is_dict_like(da
+0000a4f0: 7461 293a 0a20 2020 2020 2020 2020 2020  ta):.           
+0000a500: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000a510: 7228 2244 6174 6120 6d75 7374 2062 6520  r("Data must be 
+0000a520: 6469 6374 2d6c 696b 6522 290a 0a20 2020  dict-like")..   
+0000a530: 2020 2020 2069 6620 6461 7461 3a0a 2020       if data:.  
+0000a540: 2020 2020 2020 2020 2020 7661 725f 6b65            var_ke
+0000a550: 7973 203d 2073 6574 2873 656c 662e 6461  ys = set(self.da
+0000a560: 7461 5f76 6172 732e 6b65 7973 2829 290a  ta_vars.keys()).
+0000a570: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0000a580: 5f6b 6579 7320 3d20 7365 7428 6461 7461  _keys = set(data
+0000a590: 2e6b 6579 7328 2929 0a20 2020 2020 2020  .keys()).       
+0000a5a0: 2020 2020 206b 6579 735f 6e6f 745f 696e       keys_not_in
+0000a5b0: 5f76 6172 7320 3d20 6461 7461 5f6b 6579  _vars = data_key
+0000a5c0: 7320 2d20 7661 725f 6b65 7973 0a20 2020  s - var_keys.   
+0000a5d0: 2020 2020 2020 2020 2069 6620 6b65 7973           if keys
+0000a5e0: 5f6e 6f74 5f69 6e5f 7661 7273 3a0a 2020  _not_in_vars:.  
+0000a5f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000a600: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0000a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a620: 2020 2020 2244 6174 6120 6d75 7374 206f      "Data must o
+0000a630: 6e6c 7920 636f 6e74 6169 6e20 7661 7269  nly contain vari
+0000a640: 6162 6c65 7320 696e 206f 7269 6769 6e61  ables in origina
+0000a650: 6c20 220a 2020 2020 2020 2020 2020 2020  l ".            
+0000a660: 2020 2020 2020 2020 2264 6174 6173 6574          "dataset
+0000a670: 2e20 4578 7472 6120 7661 7269 6162 6c65  . Extra variable
+0000a680: 733a 207b 7d22 2e66 6f72 6d61 7428 6b65  s: {}".format(ke
+0000a690: 7973 5f6e 6f74 5f69 6e5f 7661 7273 290a  ys_not_in_vars).
+0000a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6b0: 290a 2020 2020 2020 2020 2020 2020 6b65  ).            ke
+0000a6c0: 7973 5f6d 6973 7369 6e67 5f66 726f 6d5f  ys_missing_from_
+0000a6d0: 6461 7461 203d 2076 6172 5f6b 6579 7320  data = var_keys 
+0000a6e0: 2d20 6461 7461 5f6b 6579 730a 2020 2020  - data_keys.    
+0000a6f0: 2020 2020 2020 2020 6966 206b 6579 735f          if keys_
+0000a700: 6d69 7373 696e 675f 6672 6f6d 5f64 6174  missing_from_dat
+0000a710: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+0000a720: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000a730: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000a740: 2020 2020 2020 2020 2022 4461 7461 206d           "Data m
+0000a750: 7573 7420 636f 6e74 6169 6e20 616c 6c20  ust contain all 
+0000a760: 7661 7269 6162 6c65 7320 696e 206f 7269  variables in ori
+0000a770: 6769 6e61 6c20 220a 2020 2020 2020 2020  ginal ".        
+0000a780: 2020 2020 2020 2020 2020 2020 2264 6174              "dat
+0000a790: 6173 6574 2e20 4461 7461 2069 7320 6d69  aset. Data is mi
+0000a7a0: 7373 696e 6720 7b7d 222e 666f 726d 6174  ssing {}".format
+0000a7b0: 286b 6579 735f 6d69 7373 696e 675f 6672  (keys_missing_fr
+0000a7c0: 6f6d 5f64 6174 6129 0a20 2020 2020 2020  om_data).       
+0000a7d0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000a7e0: 2020 2020 696e 6465 7865 732c 2069 6e64      indexes, ind
+0000a7f0: 6578 5f76 6172 7320 3d20 7365 6c66 2e78  ex_vars = self.x
+0000a800: 696e 6465 7865 732e 636f 7079 5f69 6e64  indexes.copy_ind
+0000a810: 6578 6573 2864 6565 703d 6465 6570 290a  exes(deep=deep).
+0000a820: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+0000a830: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+0000a840: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+0000a850: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
+0000a860: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0000a870: 2069 6620 6b20 696e 2069 6e64 6578 5f76   if k in index_v
+0000a880: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
+0000a890: 2020 2020 2076 6172 6961 626c 6573 5b6b       variables[k
+0000a8a0: 5d20 3d20 696e 6465 785f 7661 7273 5b6b  ] = index_vars[k
+0000a8b0: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+0000a8c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000a8d0: 2020 2020 7661 7269 6162 6c65 735b 6b5d      variables[k]
+0000a8e0: 203d 2076 2e5f 636f 7079 2864 6565 703d   = v._copy(deep=
+0000a8f0: 6465 6570 2c20 6461 7461 3d64 6174 612e  deep, data=data.
+0000a900: 6765 7428 6b29 2c20 6d65 6d6f 3d6d 656d  get(k), memo=mem
+0000a910: 6f29 0a0a 2020 2020 2020 2020 6174 7472  o)..        attr
+0000a920: 7320 3d20 636f 7079 2e64 6565 7063 6f70  s = copy.deepcop
+0000a930: 7928 7365 6c66 2e5f 6174 7472 732c 206d  y(self._attrs, m
+0000a940: 656d 6f29 2069 6620 6465 6570 2065 6c73  emo) if deep els
+0000a950: 6520 636f 7079 2e63 6f70 7928 7365 6c66  e copy.copy(self
+0000a960: 2e5f 6174 7472 7329 0a20 2020 2020 2020  ._attrs).       
+0000a970: 2065 6e63 6f64 696e 6720 3d20 280a 2020   encoding = (.  
+0000a980: 2020 2020 2020 2020 2020 636f 7079 2e64            copy.d
+0000a990: 6565 7063 6f70 7928 7365 6c66 2e5f 656e  eepcopy(self._en
+0000a9a0: 636f 6469 6e67 2c20 6d65 6d6f 2920 6966  coding, memo) if
+0000a9b0: 2064 6565 7020 656c 7365 2063 6f70 792e   deep else copy.
+0000a9c0: 636f 7079 2873 656c 662e 5f65 6e63 6f64  copy(self._encod
+0000a9d0: 696e 6729 0a20 2020 2020 2020 2029 0a0a  ing).        )..
+0000a9e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000a9f0: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
+0000aa00: 6961 626c 6573 2c20 696e 6465 7865 733d  iables, indexes=
+0000aa10: 696e 6465 7865 732c 2061 7474 7273 3d61  indexes, attrs=a
+0000aa20: 7474 7273 2c20 656e 636f 6469 6e67 3d65  ttrs, encoding=e
+0000aa30: 6e63 6f64 696e 6729 0a0a 2020 2020 6465  ncoding)..    de
+0000aa40: 6620 5f5f 636f 7079 5f5f 2873 656c 663a  f __copy__(self:
+0000aa50: 2054 5f44 6174 6173 6574 2920 2d3e 2054   T_Dataset) -> T
+0000aa60: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+0000aa70: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+0000aa80: 6f70 7928 6465 6570 3d46 616c 7365 290a  opy(deep=False).
+0000aa90: 0a20 2020 2064 6566 205f 5f64 6565 7063  .    def __deepc
+0000aaa0: 6f70 795f 5f28 7365 6c66 3a20 545f 4461  opy__(self: T_Da
+0000aab0: 7461 7365 742c 206d 656d 6f3a 2064 6963  taset, memo: dic
+0000aac0: 745b 696e 742c 2041 6e79 5d20 7c20 4e6f  t[int, Any] | No
+0000aad0: 6e65 203d 204e 6f6e 6529 202d 3e20 545f  ne = None) -> T_
+0000aae0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0000aaf0: 2072 6574 7572 6e20 7365 6c66 2e5f 636f   return self._co
+0000ab00: 7079 2864 6565 703d 5472 7565 2c20 6d65  py(deep=True, me
+0000ab10: 6d6f 3d6d 656d 6f29 0a0a 2020 2020 6465  mo=memo)..    de
+0000ab20: 6620 6173 5f6e 756d 7079 2873 656c 663a  f as_numpy(self:
+0000ab30: 2054 5f44 6174 6173 6574 2920 2d3e 2054   T_Dataset) -> T
+0000ab40: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+0000ab50: 2020 2222 220a 2020 2020 2020 2020 436f    """.        Co
+0000ab60: 6572 6365 7320 7772 6170 7065 6420 6461  erces wrapped da
+0000ab70: 7461 2061 6e64 2063 6f6f 7264 696e 6174  ta and coordinat
+0000ab80: 6573 2069 6e74 6f20 6e75 6d70 7920 6172  es into numpy ar
+0000ab90: 7261 7973 2c20 7265 7475 726e 696e 6720  rays, returning 
+0000aba0: 6120 4461 7461 7365 742e 0a0a 2020 2020  a Dataset...    
+0000abb0: 2020 2020 5365 6520 616c 736f 0a20 2020      See also.   
+0000abc0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+0000abd0: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
+0000abe0: 6173 5f6e 756d 7079 0a20 2020 2020 2020  as_numpy.       
+0000abf0: 2044 6174 6141 7272 6179 2e74 6f5f 6e75   DataArray.to_nu
+0000ac00: 6d70 7920 3a20 5265 7475 726e 7320 6f6e  mpy : Returns on
+0000ac10: 6c79 2074 6865 2064 6174 6120 6173 2061  ly the data as a
+0000ac20: 206e 756d 7079 2e6e 6461 7272 6179 206f   numpy.ndarray o
+0000ac30: 626a 6563 742e 0a20 2020 2020 2020 2022  bject..        "
+0000ac40: 2222 0a20 2020 2020 2020 206e 756d 7079  "".        numpy
+0000ac50: 5f76 6172 6961 626c 6573 203d 207b 6b3a  _variables = {k:
+0000ac60: 2076 2e61 735f 6e75 6d70 7928 2920 666f   v.as_numpy() fo
+0000ac70: 7220 6b2c 2076 2069 6e20 7365 6c66 2e76  r k, v in self.v
+0000ac80: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
+0000ac90: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
+0000aca0: 2073 656c 662e 5f72 6570 6c61 6365 2876   self._replace(v
+0000acb0: 6172 6961 626c 6573 3d6e 756d 7079 5f76  ariables=numpy_v
+0000acc0: 6172 6961 626c 6573 290a 0a20 2020 2064  ariables)..    d
+0000acd0: 6566 205f 636f 7079 5f6c 6973 7465 6428  ef _copy_listed(
+0000ace0: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+0000acf0: 206e 616d 6573 3a20 4974 6572 6162 6c65   names: Iterable
+0000ad00: 5b48 6173 6861 626c 655d 2920 2d3e 2054  [Hashable]) -> T
+0000ad10: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+0000ad20: 2020 2222 2243 7265 6174 6520 6120 6e65    """Create a ne
+0000ad30: 7720 4461 7461 7365 7420 7769 7468 2074  w Dataset with t
+0000ad40: 6865 206c 6973 7465 6420 7661 7269 6162  he listed variab
+0000ad50: 6c65 7320 6672 6f6d 2074 6869 7320 6461  les from this da
+0000ad60: 7461 7365 7420 616e 640a 2020 2020 2020  taset and.      
+0000ad70: 2020 7468 6520 616c 6c20 7265 6c65 7661    the all releva
+0000ad80: 6e74 2063 6f6f 7264 696e 6174 6573 2e20  nt coordinates. 
+0000ad90: 536b 6970 7320 616c 6c20 7661 6c69 6461  Skips all valida
+0000ada0: 7469 6f6e 2e0a 2020 2020 2020 2020 2222  tion..        ""
+0000adb0: 220a 2020 2020 2020 2020 7661 7269 6162  ".        variab
+0000adc0: 6c65 733a 2064 6963 745b 4861 7368 6162  les: dict[Hashab
+0000add0: 6c65 2c20 5661 7269 6162 6c65 5d20 3d20  le, Variable] = 
+0000ade0: 7b7d 0a20 2020 2020 2020 2063 6f6f 7264  {}.        coord
+0000adf0: 5f6e 616d 6573 203d 2073 6574 2829 0a20  _names = set(). 
+0000ae00: 2020 2020 2020 2069 6e64 6578 6573 3a20         indexes: 
+0000ae10: 6469 6374 5b48 6173 6861 626c 652c 2049  dict[Hashable, I
+0000ae20: 6e64 6578 5d20 3d20 7b7d 0a0a 2020 2020  ndex] = {}..    
+0000ae30: 2020 2020 666f 7220 6e61 6d65 2069 6e20      for name in 
+0000ae40: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+0000ae50: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000ae60: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0000ae70: 735b 6e61 6d65 5d20 3d20 7365 6c66 2e5f  s[name] = self._
+0000ae80: 7661 7269 6162 6c65 735b 6e61 6d65 5d0a  variables[name].
+0000ae90: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000aea0: 7074 204b 6579 4572 726f 723a 0a20 2020  pt KeyError:.   
+0000aeb0: 2020 2020 2020 2020 2020 2020 2072 6566               ref
+0000aec0: 5f6e 616d 652c 2076 6172 5f6e 616d 652c  _name, var_name,
+0000aed0: 2076 6172 203d 205f 6765 745f 7669 7274   var = _get_virt
+0000aee0: 7561 6c5f 7661 7269 6162 6c65 280a 2020  ual_variable(.  
+0000aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af00: 2020 7365 6c66 2e5f 7661 7269 6162 6c65    self._variable
+0000af10: 732c 206e 616d 652c 2073 656c 662e 6469  s, name, self.di
+0000af20: 6d73 0a20 2020 2020 2020 2020 2020 2020  ms.             
+0000af30: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000af40: 2020 2020 2076 6172 6961 626c 6573 5b76       variables[v
+0000af50: 6172 5f6e 616d 655d 203d 2076 6172 0a20  ar_name] = var. 
+0000af60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000af70: 6620 7265 665f 6e61 6d65 2069 6e20 7365  f ref_name in se
+0000af80: 6c66 2e5f 636f 6f72 645f 6e61 6d65 7320  lf._coord_names 
+0000af90: 6f72 2072 6566 5f6e 616d 6520 696e 2073  or ref_name in s
+0000afa0: 656c 662e 6469 6d73 3a0a 2020 2020 2020  elf.dims:.      
+0000afb0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000afc0: 6f72 645f 6e61 6d65 732e 6164 6428 7661  ord_names.add(va
+0000afd0: 725f 6e61 6d65 290a 2020 2020 2020 2020  r_name).        
+0000afe0: 2020 2020 2020 2020 6966 2028 7661 725f          if (var_
+0000aff0: 6e61 6d65 2c29 203d 3d20 7661 722e 6469  name,) == var.di
+0000b000: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0000b010: 2020 2020 2020 2020 696e 6465 782c 2069          index, i
+0000b020: 6e64 6578 5f76 6172 7320 3d20 6372 6561  ndex_vars = crea
+0000b030: 7465 5f64 6566 6175 6c74 5f69 6e64 6578  te_default_index
+0000b040: 5f69 6d70 6c69 6369 7428 7661 722c 206e  _implicit(var, n
+0000b050: 616d 6573 290a 2020 2020 2020 2020 2020  ames).          
+0000b060: 2020 2020 2020 2020 2020 696e 6465 7865            indexe
+0000b070: 732e 7570 6461 7465 287b 6b3a 2069 6e64  s.update({k: ind
+0000b080: 6578 2066 6f72 206b 2069 6e20 696e 6465  ex for k in inde
+0000b090: 785f 7661 7273 7d29 0a20 2020 2020 2020  x_vars}).       
+0000b0a0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0000b0b0: 6961 626c 6573 2e75 7064 6174 6528 696e  iables.update(in
+0000b0c0: 6465 785f 7661 7273 290a 2020 2020 2020  dex_vars).      
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000b0e0: 6f72 645f 6e61 6d65 732e 7570 6461 7465  ord_names.update
+0000b0f0: 2869 6e64 6578 5f76 6172 7329 0a0a 2020  (index_vars)..  
+0000b100: 2020 2020 2020 6e65 6564 6564 5f64 696d        needed_dim
+0000b110: 733a 204f 7264 6572 6564 5365 745b 4861  s: OrderedSet[Ha
+0000b120: 7368 6162 6c65 5d20 3d20 4f72 6465 7265  shable] = Ordere
+0000b130: 6453 6574 2829 0a20 2020 2020 2020 2066  dSet().        f
+0000b140: 6f72 2076 2069 6e20 7661 7269 6162 6c65  or v in variable
+0000b150: 732e 7661 6c75 6573 2829 3a0a 2020 2020  s.values():.    
+0000b160: 2020 2020 2020 2020 6e65 6564 6564 5f64          needed_d
+0000b170: 696d 732e 7570 6461 7465 2876 2e64 696d  ims.update(v.dim
+0000b180: 7329 0a0a 2020 2020 2020 2020 6469 6d73  s)..        dims
+0000b190: 203d 207b 6b3a 2073 656c 662e 6469 6d73   = {k: self.dims
+0000b1a0: 5b6b 5d20 666f 7220 6b20 696e 206e 6565  [k] for k in nee
+0000b1b0: 6465 645f 6469 6d73 7d0a 0a20 2020 2020  ded_dims}..     
+0000b1c0: 2020 2023 2070 7265 7365 7276 6573 206f     # preserves o
+0000b1d0: 7264 6572 696e 6720 6f66 2063 6f6f 7264  rdering of coord
+0000b1e0: 696e 6174 6573 0a20 2020 2020 2020 2066  inates.        f
+0000b1f0: 6f72 206b 2069 6e20 7365 6c66 2e5f 7661  or k in self._va
+0000b200: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+0000b210: 2020 2020 2069 6620 6b20 6e6f 7420 696e       if k not in
+0000b220: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
+0000b230: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0000b240: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+0000b250: 2020 2020 2020 2020 2020 6966 2073 6574            if set
+0000b260: 2873 656c 662e 7661 7269 6162 6c65 735b  (self.variables[
+0000b270: 6b5d 2e64 696d 7329 203c 3d20 6e65 6564  k].dims) <= need
+0000b280: 6564 5f64 696d 733a 0a20 2020 2020 2020  ed_dims:.       
+0000b290: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0000b2a0: 6573 5b6b 5d20 3d20 7365 6c66 2e5f 7661  es[k] = self._va
+0000b2b0: 7269 6162 6c65 735b 6b5d 0a20 2020 2020  riables[k].     
+0000b2c0: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
+0000b2d0: 5f6e 616d 6573 2e61 6464 286b 290a 0a20  _names.add(k).. 
+0000b2e0: 2020 2020 2020 2069 6e64 6578 6573 2e75         indexes.u
+0000b2f0: 7064 6174 6528 6669 6c74 6572 5f69 6e64  pdate(filter_ind
+0000b300: 6578 6573 5f66 726f 6d5f 636f 6f72 6473  exes_from_coords
+0000b310: 2873 656c 662e 5f69 6e64 6578 6573 2c20  (self._indexes, 
+0000b320: 636f 6f72 645f 6e61 6d65 7329 290a 0a20  coord_names)).. 
+0000b330: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000b340: 6c66 2e5f 7265 706c 6163 6528 7661 7269  lf._replace(vari
+0000b350: 6162 6c65 732c 2063 6f6f 7264 5f6e 616d  ables, coord_nam
+0000b360: 6573 2c20 6469 6d73 2c20 696e 6465 7865  es, dims, indexe
+0000b370: 733d 696e 6465 7865 7329 0a0a 2020 2020  s=indexes)..    
+0000b380: 6465 6620 5f63 6f6e 7374 7275 6374 5f64  def _construct_d
+0000b390: 6174 6161 7272 6179 2873 656c 662c 206e  ataarray(self, n
+0000b3a0: 616d 653a 2048 6173 6861 626c 6529 202d  ame: Hashable) -
+0000b3b0: 3e20 4461 7461 4172 7261 793a 0a20 2020  > DataArray:.   
+0000b3c0: 2020 2020 2022 2222 436f 6e73 7472 7563       """Construc
+0000b3d0: 7420 6120 4461 7461 4172 7261 7920 6279  t a DataArray by
+0000b3e0: 2069 6e64 6578 696e 6720 7468 6973 2064   indexing this d
+0000b3f0: 6174 6173 6574 2222 220a 2020 2020 2020  ataset""".      
+0000b400: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
+0000b410: 7265 2e64 6174 6161 7272 6179 2069 6d70  re.dataarray imp
+0000b420: 6f72 7420 4461 7461 4172 7261 790a 0a20  ort DataArray.. 
+0000b430: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000b440: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0000b450: 203d 2073 656c 662e 5f76 6172 6961 626c   = self._variabl
+0000b460: 6573 5b6e 616d 655d 0a20 2020 2020 2020  es[name].       
+0000b470: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+0000b480: 3a0a 2020 2020 2020 2020 2020 2020 5f2c  :.            _,
+0000b490: 206e 616d 652c 2076 6172 6961 626c 6520   name, variable 
+0000b4a0: 3d20 5f67 6574 5f76 6972 7475 616c 5f76  = _get_virtual_v
+0000b4b0: 6172 6961 626c 6528 7365 6c66 2e5f 7661  ariable(self._va
+0000b4c0: 7269 6162 6c65 732c 206e 616d 652c 2073  riables, name, s
+0000b4d0: 656c 662e 6469 6d73 290a 0a20 2020 2020  elf.dims)..     
+0000b4e0: 2020 206e 6565 6465 645f 6469 6d73 203d     needed_dims =
+0000b4f0: 2073 6574 2876 6172 6961 626c 652e 6469   set(variable.di
+0000b500: 6d73 290a 0a20 2020 2020 2020 2063 6f6f  ms)..        coo
+0000b510: 7264 733a 2064 6963 745b 4861 7368 6162  rds: dict[Hashab
+0000b520: 6c65 2c20 5661 7269 6162 6c65 5d20 3d20  le, Variable] = 
+0000b530: 7b7d 0a20 2020 2020 2020 2023 2070 7265  {}.        # pre
+0000b540: 7365 7276 6520 6f72 6465 7269 6e67 0a20  serve ordering. 
+0000b550: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
+0000b560: 7365 6c66 2e5f 7661 7269 6162 6c65 733a  self._variables:
+0000b570: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000b580: 6b20 696e 2073 656c 662e 5f63 6f6f 7264  k in self._coord
+0000b590: 5f6e 616d 6573 2061 6e64 2073 6574 2873  _names and set(s
+0000b5a0: 656c 662e 7661 7269 6162 6c65 735b 6b5d  elf.variables[k]
+0000b5b0: 2e64 696d 7329 203c 3d20 6e65 6564 6564  .dims) <= needed
+0000b5c0: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
+0000b5d0: 2020 2020 2020 2063 6f6f 7264 735b 6b5d         coords[k]
+0000b5e0: 203d 2073 656c 662e 7661 7269 6162 6c65   = self.variable
+0000b5f0: 735b 6b5d 0a0a 2020 2020 2020 2020 696e  s[k]..        in
+0000b600: 6465 7865 7320 3d20 6669 6c74 6572 5f69  dexes = filter_i
+0000b610: 6e64 6578 6573 5f66 726f 6d5f 636f 6f72  ndexes_from_coor
+0000b620: 6473 2873 656c 662e 5f69 6e64 6578 6573  ds(self._indexes
+0000b630: 2c20 7365 7428 636f 6f72 6473 2929 0a0a  , set(coords))..
+0000b640: 2020 2020 2020 2020 7265 7475 726e 2044          return D
+0000b650: 6174 6141 7272 6179 2876 6172 6961 626c  ataArray(variabl
+0000b660: 652c 2063 6f6f 7264 732c 206e 616d 653d  e, coords, name=
+0000b670: 6e61 6d65 2c20 696e 6465 7865 733d 696e  name, indexes=in
+0000b680: 6465 7865 732c 2066 6173 7470 6174 683d  dexes, fastpath=
+0000b690: 5472 7565 290a 0a20 2020 2040 7072 6f70  True)..    @prop
+0000b6a0: 6572 7479 0a20 2020 2064 6566 205f 6174  erty.    def _at
+0000b6b0: 7472 5f73 6f75 7263 6573 2873 656c 6629  tr_sources(self)
+0000b6c0: 202d 3e20 4974 6572 6162 6c65 5b4d 6170   -> Iterable[Map
+0000b6d0: 7069 6e67 5b48 6173 6861 626c 652c 2041  ping[Hashable, A
+0000b6e0: 6e79 5d5d 3a0a 2020 2020 2020 2020 2222  ny]]:.        ""
+0000b6f0: 2250 6c61 6365 7320 746f 206c 6f6f 6b2d  "Places to look-
+0000b700: 7570 2069 7465 6d73 2066 6f72 2061 7474  up items for att
+0000b710: 7269 6275 7465 2d73 7479 6c65 2061 6363  ribute-style acc
+0000b720: 6573 7322 2222 0a20 2020 2020 2020 2079  ess""".        y
+0000b730: 6965 6c64 2066 726f 6d20 7365 6c66 2e5f  ield from self._
+0000b740: 6974 656d 5f73 6f75 7263 6573 0a20 2020  item_sources.   
+0000b750: 2020 2020 2079 6965 6c64 2073 656c 662e       yield self.
+0000b760: 6174 7472 730a 0a20 2020 2040 7072 6f70  attrs..    @prop
+0000b770: 6572 7479 0a20 2020 2064 6566 205f 6974  erty.    def _it
+0000b780: 656d 5f73 6f75 7263 6573 2873 656c 6629  em_sources(self)
+0000b790: 202d 3e20 4974 6572 6162 6c65 5b4d 6170   -> Iterable[Map
+0000b7a0: 7069 6e67 5b48 6173 6861 626c 652c 2041  ping[Hashable, A
+0000b7b0: 6e79 5d5d 3a0a 2020 2020 2020 2020 2222  ny]]:.        ""
+0000b7c0: 2250 6c61 6365 7320 746f 206c 6f6f 6b2d  "Places to look-
+0000b7d0: 7570 2069 7465 6d73 2066 6f72 206b 6579  up items for key
+0000b7e0: 2d63 6f6d 706c 6574 696f 6e22 2222 0a20  -completion""". 
+0000b7f0: 2020 2020 2020 2079 6965 6c64 2073 656c         yield sel
+0000b800: 662e 6461 7461 5f76 6172 730a 2020 2020  f.data_vars.    
+0000b810: 2020 2020 7969 656c 6420 4879 6272 6964      yield Hybrid
+0000b820: 4d61 7070 696e 6750 726f 7879 286b 6579  MappingProxy(key
+0000b830: 733d 7365 6c66 2e5f 636f 6f72 645f 6e61  s=self._coord_na
+0000b840: 6d65 732c 206d 6170 7069 6e67 3d73 656c  mes, mapping=sel
+0000b850: 662e 636f 6f72 6473 290a 0a20 2020 2020  f.coords)..     
+0000b860: 2020 2023 2076 6972 7475 616c 2063 6f6f     # virtual coo
+0000b870: 7264 696e 6174 6573 0a20 2020 2020 2020  rdinates.       
+0000b880: 2079 6965 6c64 2048 7962 7269 644d 6170   yield HybridMap
+0000b890: 7069 6e67 5072 6f78 7928 6b65 7973 3d73  pingProxy(keys=s
+0000b8a0: 656c 662e 6469 6d73 2c20 6d61 7070 696e  elf.dims, mappin
+0000b8b0: 673d 7365 6c66 290a 0a20 2020 2064 6566  g=self)..    def
+0000b8c0: 205f 5f63 6f6e 7461 696e 735f 5f28 7365   __contains__(se
+0000b8d0: 6c66 2c20 6b65 793a 206f 626a 6563 7429  lf, key: object)
+0000b8e0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+0000b8f0: 2020 2222 2254 6865 2027 696e 2720 6f70    """The 'in' op
+0000b900: 6572 6174 6f72 2077 696c 6c20 7265 7475  erator will retu
+0000b910: 726e 2074 7275 6520 6f72 2066 616c 7365  rn true or false
+0000b920: 2064 6570 656e 6469 6e67 206f 6e20 7768   depending on wh
+0000b930: 6574 6865 720a 2020 2020 2020 2020 276b  ether.        'k
+0000b940: 6579 2720 6973 2061 6e20 6172 7261 7920  ey' is an array 
+0000b950: 696e 2074 6865 2064 6174 6173 6574 206f  in the dataset o
+0000b960: 7220 6e6f 742e 0a20 2020 2020 2020 2022  r not..        "
+0000b970: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000b980: 6e20 6b65 7920 696e 2073 656c 662e 5f76  n key in self._v
+0000b990: 6172 6961 626c 6573 0a0a 2020 2020 6465  ariables..    de
+0000b9a0: 6620 5f5f 6c65 6e5f 5f28 7365 6c66 2920  f __len__(self) 
+0000b9b0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
+0000b9c0: 7265 7475 726e 206c 656e 2873 656c 662e  return len(self.
+0000b9d0: 6461 7461 5f76 6172 7329 0a0a 2020 2020  data_vars)..    
+0000b9e0: 6465 6620 5f5f 626f 6f6c 5f5f 2873 656c  def __bool__(sel
+0000b9f0: 6629 202d 3e20 626f 6f6c 3a0a 2020 2020  f) -> bool:.    
+0000ba00: 2020 2020 7265 7475 726e 2062 6f6f 6c28      return bool(
+0000ba10: 7365 6c66 2e64 6174 615f 7661 7273 290a  self.data_vars).
+0000ba20: 0a20 2020 2064 6566 205f 5f69 7465 725f  .    def __iter_
+0000ba30: 5f28 7365 6c66 2920 2d3e 2049 7465 7261  _(self) -> Itera
+0000ba40: 746f 725b 4861 7368 6162 6c65 5d3a 0a20  tor[Hashable]:. 
+0000ba50: 2020 2020 2020 2072 6574 7572 6e20 6974         return it
+0000ba60: 6572 2873 656c 662e 6461 7461 5f76 6172  er(self.data_var
+0000ba70: 7329 0a0a 2020 2020 6465 6620 5f5f 6172  s)..    def __ar
+0000ba80: 7261 795f 5f28 7365 6c66 2c20 6474 7970  ray__(self, dtyp
+0000ba90: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+0000baa0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0000bab0: 280a 2020 2020 2020 2020 2020 2020 2263  (.            "c
+0000bac0: 616e 6e6f 7420 6469 7265 6374 6c79 2063  annot directly c
+0000bad0: 6f6e 7665 7274 2061 6e20 7861 7272 6179  onvert an xarray
+0000bae0: 2e44 6174 6173 6574 2069 6e74 6f20 6120  .Dataset into a 
+0000baf0: 220a 2020 2020 2020 2020 2020 2020 226e  ".            "n
+0000bb00: 756d 7079 2061 7272 6179 2e20 496e 7374  umpy array. Inst
+0000bb10: 6561 642c 2063 7265 6174 6520 616e 2078  ead, create an x
+0000bb20: 6172 7261 792e 4461 7461 4172 7261 7920  array.DataArray 
+0000bb30: 220a 2020 2020 2020 2020 2020 2020 2266  ".            "f
+0000bb40: 6972 7374 2c20 6569 7468 6572 2077 6974  irst, either wit
+0000bb50: 6820 696e 6465 7869 6e67 206f 6e20 7468  h indexing on th
+0000bb60: 6520 4461 7461 7365 7420 6f72 2062 7920  e Dataset or by 
+0000bb70: 220a 2020 2020 2020 2020 2020 2020 2269  ".            "i
+0000bb80: 6e76 6f6b 696e 6720 7468 6520 6074 6f5f  nvoking the `to_
+0000bb90: 6172 7261 7928 2960 206d 6574 686f 642e  array()` method.
+0000bba0: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+0000bbb0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+0000bbc0: 6566 206e 6279 7465 7328 7365 6c66 2920  ef nbytes(self) 
+0000bbd0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
+0000bbe0: 2222 220a 2020 2020 2020 2020 546f 7461  """.        Tota
+0000bbf0: 6c20 6279 7465 7320 636f 6e73 756d 6564  l bytes consumed
+0000bc00: 2062 7920 7468 6520 6461 7461 2061 7272   by the data arr
+0000bc10: 6179 7320 6f66 2061 6c6c 2076 6172 6961  ays of all varia
+0000bc20: 626c 6573 2069 6e20 7468 6973 2064 6174  bles in this dat
+0000bc30: 6173 6574 2e0a 0a20 2020 2020 2020 2049  aset...        I
+0000bc40: 6620 7468 6520 6261 636b 656e 6420 6172  f the backend ar
+0000bc50: 7261 7920 666f 7220 616e 7920 7661 7269  ray for any vari
+0000bc60: 6162 6c65 2064 6f65 7320 6e6f 7420 696e  able does not in
+0000bc70: 636c 7564 6520 6060 6e62 7974 6573 6060  clude ``nbytes``
+0000bc80: 2c20 6573 7469 6d61 7465 730a 2020 2020  , estimates.    
+0000bc90: 2020 2020 7468 6520 746f 7461 6c20 6279      the total by
+0000bca0: 7465 7320 666f 7220 7468 6174 2061 7272  tes for that arr
+0000bcb0: 6179 2062 6173 6564 206f 6e20 7468 6520  ay based on the 
+0000bcc0: 6060 7369 7a65 6060 2061 6e64 2060 6064  ``size`` and ``d
+0000bcd0: 7479 7065 6060 2e0a 2020 2020 2020 2020  type``..        
+0000bce0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000bcf0: 726e 2073 756d 2876 2e6e 6279 7465 7320  rn sum(v.nbytes 
+0000bd00: 666f 7220 7620 696e 2073 656c 662e 7661  for v in self.va
+0000bd10: 7269 6162 6c65 732e 7661 6c75 6573 2829  riables.values()
+0000bd20: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+0000bd30: 0a20 2020 2064 6566 206c 6f63 2873 656c  .    def loc(sel
+0000bd40: 663a 2054 5f44 6174 6173 6574 2920 2d3e  f: T_Dataset) ->
+0000bd50: 205f 4c6f 6349 6e64 6578 6572 5b54 5f44   _LocIndexer[T_D
+0000bd60: 6174 6173 6574 5d3a 0a20 2020 2020 2020  ataset]:.       
+0000bd70: 2022 2222 4174 7472 6962 7574 6520 666f   """Attribute fo
+0000bd80: 7220 6c6f 6361 7469 6f6e 2062 6173 6564  r location based
+0000bd90: 2069 6e64 6578 696e 672e 204f 6e6c 7920   indexing. Only 
+0000bda0: 7375 7070 6f72 7473 205f 5f67 6574 6974  supports __getit
+0000bdb0: 656d 5f5f 2c0a 2020 2020 2020 2020 616e  em__,.        an
+0000bdc0: 6420 6f6e 6c79 2077 6865 6e20 7468 6520  d only when the 
+0000bdd0: 6b65 7920 6973 2061 2064 6963 7420 6f66  key is a dict of
+0000bde0: 2074 6865 2066 6f72 6d20 7b64 696d 3a20   the form {dim: 
+0000bdf0: 6c61 6265 6c73 7d2e 0a20 2020 2020 2020  labels}..       
+0000be00: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+0000be10: 7572 6e20 5f4c 6f63 496e 6465 7865 7228  urn _LocIndexer(
+0000be20: 7365 6c66 290a 0a20 2020 2040 6f76 6572  self)..    @over
+0000be30: 6c6f 6164 0a20 2020 2064 6566 205f 5f67  load.    def __g
+0000be40: 6574 6974 656d 5f5f 2873 656c 662c 206b  etitem__(self, k
+0000be50: 6579 3a20 4861 7368 6162 6c65 2920 2d3e  ey: Hashable) ->
+0000be60: 2044 6174 6141 7272 6179 3a0a 2020 2020   DataArray:.    
+0000be70: 2020 2020 2e2e 2e0a 0a20 2020 2023 204d      .....    # M
+0000be80: 6170 7069 6e67 2069 7320 4974 6572 6162  apping is Iterab
+0000be90: 6c65 0a20 2020 2040 6f76 6572 6c6f 6164  le.    @overload
+0000bea0: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
+0000beb0: 656d 5f5f 2873 656c 663a 2054 5f44 6174  em__(self: T_Dat
+0000bec0: 6173 6574 2c20 6b65 793a 2049 7465 7261  aset, key: Itera
+0000bed0: 626c 655b 4861 7368 6162 6c65 5d29 202d  ble[Hashable]) -
+0000bee0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+0000bef0: 2020 2020 202e 2e2e 0a0a 2020 2020 6465       .....    de
+0000bf00: 6620 5f5f 6765 7469 7465 6d5f 5f28 0a20  f __getitem__(. 
+0000bf10: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+0000bf20: 6174 6173 6574 2c20 6b65 793a 204d 6170  ataset, key: Map
+0000bf30: 7069 6e67 5b41 6e79 2c20 416e 795d 207c  ping[Any, Any] |
+0000bf40: 2048 6173 6861 626c 6520 7c20 4974 6572   Hashable | Iter
+0000bf50: 6162 6c65 5b48 6173 6861 626c 655d 0a20  able[Hashable]. 
+0000bf60: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
+0000bf70: 7420 7c20 4461 7461 4172 7261 793a 0a20  t | DataArray:. 
+0000bf80: 2020 2020 2020 2022 2222 4163 6365 7373         """Access
+0000bf90: 2076 6172 6961 626c 6573 206f 7220 636f   variables or co
+0000bfa0: 6f72 6469 6e61 7465 7320 6f66 2074 6869  ordinates of thi
+0000bfb0: 7320 6461 7461 7365 7420 6173 2061 0a20  s dataset as a. 
+0000bfc0: 2020 2020 2020 203a 7079 3a63 6c61 7373         :py:class
+0000bfd0: 3a60 7e78 6172 7261 792e 4461 7461 4172  :`~xarray.DataAr
+0000bfe0: 7261 7960 206f 7220 6120 7375 6273 6574  ray` or a subset
+0000bff0: 206f 6620 7661 7269 6162 6c65 7320 6f72   of variables or
+0000c000: 2061 2069 6e64 6578 6564 2064 6174 6173   a indexed datas
+0000c010: 6574 2e0a 0a20 2020 2020 2020 2049 6e64  et...        Ind
+0000c020: 6578 696e 6720 7769 7468 2061 206c 6973  exing with a lis
+0000c030: 7420 6f66 206e 616d 6573 2077 696c 6c20  t of names will 
+0000c040: 7265 7475 726e 2061 206e 6577 2060 6044  return a new ``D
+0000c050: 6174 6173 6574 6060 206f 626a 6563 742e  ataset`` object.
+0000c060: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000c070: 2020 2020 2069 6620 7574 696c 732e 6973       if utils.is
+0000c080: 5f64 6963 745f 6c69 6b65 286b 6579 293a  _dict_like(key):
+0000c090: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000c0a0: 7572 6e20 7365 6c66 2e69 7365 6c28 2a2a  urn self.isel(**
+0000c0b0: 6b65 7929 0a20 2020 2020 2020 2069 6620  key).        if 
+0000c0c0: 7574 696c 732e 6861 7368 6162 6c65 286b  utils.hashable(k
+0000c0d0: 6579 293a 0a20 2020 2020 2020 2020 2020  ey):.           
+0000c0e0: 2072 6574 7572 6e20 7365 6c66 2e5f 636f   return self._co
+0000c0f0: 6e73 7472 7563 745f 6461 7461 6172 7261  nstruct_dataarra
+0000c100: 7928 6b65 7929 0a20 2020 2020 2020 2069  y(key).        i
+0000c110: 6620 7574 696c 732e 6974 6572 6162 6c65  f utils.iterable
+0000c120: 5f6f 665f 6861 7368 6162 6c65 286b 6579  _of_hashable(key
+0000c130: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000c140: 6574 7572 6e20 7365 6c66 2e5f 636f 7079  eturn self._copy
+0000c150: 5f6c 6973 7465 6428 6b65 7929 0a20 2020  _listed(key).   
+0000c160: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000c170: 4572 726f 7228 6622 556e 7375 7070 6f72  Error(f"Unsuppor
+0000c180: 7465 6420 6b65 792d 7479 7065 207b 7479  ted key-type {ty
+0000c190: 7065 286b 6579 297d 2229 0a0a 2020 2020  pe(key)}")..    
+0000c1a0: 6465 6620 5f5f 7365 7469 7465 6d5f 5f28  def __setitem__(
+0000c1b0: 0a20 2020 2020 2020 2073 656c 662c 206b  .        self, k
+0000c1c0: 6579 3a20 4861 7368 6162 6c65 207c 2049  ey: Hashable | I
+0000c1d0: 7465 7261 626c 655b 4861 7368 6162 6c65  terable[Hashable
+0000c1e0: 5d20 7c20 4d61 7070 696e 672c 2076 616c  ] | Mapping, val
+0000c1f0: 7565 3a20 416e 790a 2020 2020 2920 2d3e  ue: Any.    ) ->
+0000c200: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0000c210: 2222 4164 6420 616e 2061 7272 6179 2074  ""Add an array t
+0000c220: 6f20 7468 6973 2064 6174 6173 6574 2e0a  o this dataset..
+0000c230: 2020 2020 2020 2020 4d75 6c74 6970 6c65          Multiple
+0000c240: 2061 7272 6179 7320 6361 6e20 6265 2061   arrays can be a
+0000c250: 6464 6564 2061 7420 7468 6520 7361 6d65  dded at the same
+0000c260: 2074 696d 652c 2069 6e20 7768 6963 6820   time, in which 
+0000c270: 6361 7365 2065 6163 6820 6f66 0a20 2020  case each of.   
+0000c280: 2020 2020 2074 6865 2066 6f6c 6c6f 7769       the followi
+0000c290: 6e67 206f 7065 7261 7469 6f6e 7320 6973  ng operations is
+0000c2a0: 2061 7070 6c69 6564 2074 6f20 7468 6520   applied to the 
+0000c2b0: 7265 7370 6563 7469 7665 2076 616c 7565  respective value
+0000c2c0: 2e0a 0a20 2020 2020 2020 2049 6620 6b65  ...        If ke
+0000c2d0: 7920 6973 2064 6963 742d 6c69 6b65 2c20  y is dict-like, 
+0000c2e0: 7570 6461 7465 2061 6c6c 2076 6172 6961  update all varia
+0000c2f0: 626c 6573 2069 6e20 7468 6520 6461 7461  bles in the data
+0000c300: 7365 740a 2020 2020 2020 2020 6f6e 6520  set.        one 
+0000c310: 6279 206f 6e65 2077 6974 6820 7468 6520  by one with the 
+0000c320: 6769 7665 6e20 7661 6c75 6520 6174 2074  given value at t
+0000c330: 6865 2067 6976 656e 206c 6f63 6174 696f  he given locatio
+0000c340: 6e2e 0a20 2020 2020 2020 2049 6620 7468  n..        If th
+0000c350: 6520 6769 7665 6e20 7661 6c75 6520 6973  e given value is
+0000c360: 2061 6c73 6f20 6120 6461 7461 7365 742c   also a dataset,
+0000c370: 2073 656c 6563 7420 636f 7272 6573 706f   select correspo
+0000c380: 6e64 696e 6720 7661 7269 6162 6c65 730a  nding variables.
+0000c390: 2020 2020 2020 2020 696e 2074 6865 2067          in the g
+0000c3a0: 6976 656e 2076 616c 7565 2061 6e64 2069  iven value and i
+0000c3b0: 6e20 7468 6520 6461 7461 7365 7420 746f  n the dataset to
+0000c3c0: 2062 6520 6368 616e 6765 642e 0a0a 2020   be changed...  
+0000c3d0: 2020 2020 2020 4966 2076 616c 7565 2069        If value i
+0000c3e0: 7320 6120 600a 2020 2020 2020 2020 6672  s a `.        fr
+0000c3f0: 6f6d 202e 6461 7461 6172 7261 7920 696d  om .dataarray im
+0000c400: 706f 7274 2044 6174 6141 7272 6179 602c  port DataArray`,
+0000c410: 2063 616c 6c20 6974 7320 6073 656c 6563   call its `selec
+0000c420: 745f 7661 7273 2829 6020 6d65 7468 6f64  t_vars()` method
+0000c430: 2c20 7265 6e61 6d65 2069 740a 2020 2020  , rename it.    
+0000c440: 2020 2020 746f 2060 6b65 7960 2061 6e64      to `key` and
+0000c450: 206d 6572 6765 2074 6865 2063 6f6e 7465   merge the conte
+0000c460: 6e74 7320 6f66 2074 6865 2072 6573 756c  nts of the resul
+0000c470: 7469 6e67 2064 6174 6173 6574 2069 6e74  ting dataset int
+0000c480: 6f20 7468 6973 0a20 2020 2020 2020 2064  o this.        d
+0000c490: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
+0000c4a0: 2049 6620 7661 6c75 6520 6973 2061 2060   If value is a `
+0000c4b0: 5661 7269 6162 6c65 6020 6f62 6a65 6374  Variable` object
+0000c4c0: 2028 6f72 2074 7570 6c65 206f 6620 666f   (or tuple of fo
+0000c4d0: 726d 0a20 2020 2020 2020 2060 6028 6469  rm.        ``(di
+0000c4e0: 6d73 2c20 6461 7461 5b2c 2061 7474 7273  ms, data[, attrs
+0000c4f0: 5d29 6060 292c 2061 6464 2069 7420 746f  ])``), add it to
+0000c500: 2074 6869 7320 6461 7461 7365 7420 6173   this dataset as
+0000c510: 2061 206e 6577 0a20 2020 2020 2020 2076   a new.        v
+0000c520: 6172 6961 626c 652e 0a20 2020 2020 2020  ariable..       
+0000c530: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+0000c540: 6d20 7861 7272 6179 2e63 6f72 652e 6461  m xarray.core.da
+0000c550: 7461 6172 7261 7920 696d 706f 7274 2044  taarray import D
+0000c560: 6174 6141 7272 6179 0a0a 2020 2020 2020  ataArray..      
+0000c570: 2020 6966 2075 7469 6c73 2e69 735f 6469    if utils.is_di
+0000c580: 6374 5f6c 696b 6528 6b65 7929 3a0a 2020  ct_like(key):.  
+0000c590: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
+0000c5a0: 6b20 666f 7220 636f 6e73 6973 7465 6e63  k for consistenc
+0000c5b0: 7920 616e 6420 636f 6e76 6572 7420 7661  y and convert va
+0000c5c0: 6c75 6520 746f 2064 6174 6173 6574 0a20  lue to dataset. 
+0000c5d0: 2020 2020 2020 2020 2020 2076 616c 7565             value
+0000c5e0: 203d 2073 656c 662e 5f73 6574 6974 656d   = self._setitem
+0000c5f0: 5f63 6865 636b 286b 6579 2c20 7661 6c75  _check(key, valu
+0000c600: 6529 0a20 2020 2020 2020 2020 2020 2023  e).            #
+0000c610: 206c 6f6f 7020 6f76 6572 2064 6174 6173   loop over datas
+0000c620: 6574 2076 6172 6961 626c 6573 2061 6e64  et variables and
+0000c630: 2073 6574 206e 6577 2076 616c 7565 730a   set new values.
+0000c640: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+0000c650: 6573 7365 6420 3d20 5b5d 0a20 2020 2020  essed = [].     
+0000c660: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
+0000c670: 2076 6172 2069 6e20 7365 6c66 2e69 7465   var in self.ite
+0000c680: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0000c690: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000c6a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000c6b0: 6172 5b6b 6579 5d20 3d20 7661 6c75 655b  ar[key] = value[
+0000c6c0: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
+0000c6d0: 2020 2020 2020 2020 2020 7072 6f63 6573            proces
+0000c6e0: 7365 642e 6170 7065 6e64 286e 616d 6529  sed.append(name)
+0000c6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c700: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0000c710: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+0000c720: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0000c730: 726f 6365 7373 6564 3a0a 2020 2020 2020  rocessed:.      
+0000c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c750: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
+0000c760: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c780: 2020 2241 6e20 6572 726f 7220 6f63 6375    "An error occu
+0000c790: 7272 6564 2077 6869 6c65 2073 6574 7469  rred while setti
+0000c7a0: 6e67 2076 616c 7565 7320 6f66 2074 6865  ng values of the
+0000c7b0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000c7c0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0000c7d0: 2076 6172 6961 626c 6520 277b 6e61 6d65   variable '{name
+0000c7e0: 7d27 2e20 5468 6520 666f 6c6c 6f77 696e  }'. The followin
+0000c7f0: 6720 7661 7269 6162 6c65 7320 6861 7665  g variables have
 0000c800: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000c810: 2020 2020 2020 2020 2020 6622 287b 6c65            f"({le
-0000c820: 6e28 6b65 796c 6973 7429 7d29 2061 6e64  n(keylist)}) and
-0000c830: 2064 6174 6120 7573 6564 2061 7320 696e   data used as in
-0000c840: 7075 7420 666f 7220 220a 2020 2020 2020  put for ".      
+0000c810: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0000c820: 2062 6565 6e20 7375 6363 6573 7366 756c   been successful
+0000c830: 6c79 2075 7064 6174 6564 3a5c 6e7b 7072  ly updated:\n{pr
+0000c840: 6f63 6573 7365 647d 220a 2020 2020 2020  ocessed}".      
 0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c860: 2020 6622 7365 7474 696e 6720 287b 6c65    f"setting ({le
-0000c870: 6e28 7661 6c75 6529 7d29 220a 2020 2020  n(value)})".    
-0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c8a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000c8b0: 7661 6c75 652c 2044 6174 6173 6574 293a  value, Dataset):
-0000c8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c8d0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-0000c8e0: 2864 6963 7428 7a69 7028 6b65 796c 6973  (dict(zip(keylis
-0000c8f0: 742c 2076 616c 7565 2e64 6174 615f 7661  t, value.data_va
-0000c900: 7273 2e76 616c 7565 7328 2929 2929 0a20  rs.values()))). 
-0000c910: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000c920: 6c69 6620 6973 696e 7374 616e 6365 2876  lif isinstance(v
-0000c930: 616c 7565 2c20 4461 7461 4172 7261 7929  alue, DataArray)
-0000c940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c950: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000c960: 6545 7272 6f72 2822 4361 6e6e 6f74 2061  eError("Cannot a
-0000c970: 7373 6967 6e20 7369 6e67 6c65 2044 6174  ssign single Dat
-0000c980: 6141 7272 6179 2074 6f20 6d75 6c74 6970  aArray to multip
-0000c990: 6c65 206b 6579 7322 290a 2020 2020 2020  le keys").      
-0000c9a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9c0: 2020 2020 7365 6c66 2e75 7064 6174 6528      self.update(
-0000c9d0: 6469 6374 287a 6970 286b 6579 6c69 7374  dict(zip(keylist
-0000c9e0: 2c20 7661 6c75 6529 2929 0a0a 2020 2020  , value)))..    
-0000c9f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000ca00: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000ca10: 6545 7272 6f72 2866 2255 6e73 7570 706f  eError(f"Unsuppo
-0000ca20: 7274 6564 206b 6579 2d74 7970 6520 7b74  rted key-type {t
-0000ca30: 7970 6528 6b65 7929 7d22 290a 0a20 2020  ype(key)}")..   
-0000ca40: 2064 6566 205f 7365 7469 7465 6d5f 6368   def _setitem_ch
-0000ca50: 6563 6b28 7365 6c66 2c20 6b65 792c 2076  eck(self, key, v
-0000ca60: 616c 7565 293a 0a20 2020 2020 2020 2022  alue):.        "
-0000ca70: 2222 436f 6e73 6973 7465 6e63 7920 6368  ""Consistency ch
-0000ca80: 6563 6b20 666f 7220 5f5f 7365 7469 7465  eck for __setite
-0000ca90: 6d5f 5f0a 0a20 2020 2020 2020 2057 6865  m__..        Whe
-0000caa0: 6e20 6173 7369 676e 696e 6720 7661 6c75  n assigning valu
-0000cab0: 6573 2074 6f20 6120 7375 6273 6574 206f  es to a subset o
-0000cac0: 6620 6120 4461 7461 7365 742c 2064 6f20  f a Dataset, do 
-0000cad0: 636f 6e73 6973 7465 6e63 7920 6368 6563  consistency chec
-0000cae0: 6b20 6265 666f 7265 6861 6e64 0a20 2020  k beforehand.   
-0000caf0: 2020 2020 2074 6f20 6176 6f69 6420 6c65       to avoid le
-0000cb00: 6176 696e 6720 7468 6520 6461 7461 7365  aving the datase
-0000cb10: 7420 696e 2061 2070 6172 7469 616c 6c79  t in a partially
-0000cb20: 2075 7064 6174 6564 2073 7461 7465 2077   updated state w
-0000cb30: 6865 6e20 616e 2065 7272 6f72 206f 6363  hen an error occ
-0000cb40: 7572 732e 0a20 2020 2020 2020 2022 2222  urs..        """
-0000cb50: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
-0000cb60: 7272 6179 2e63 6f72 652e 616c 6967 6e6d  rray.core.alignm
-0000cb70: 656e 7420 696d 706f 7274 2061 6c69 676e  ent import align
-0000cb80: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
-0000cb90: 7272 6179 2e63 6f72 652e 6461 7461 6172  rray.core.dataar
-0000cba0: 7261 7920 696d 706f 7274 2044 6174 6141  ray import DataA
-0000cbb0: 7272 6179 0a0a 2020 2020 2020 2020 6966  rray..        if
-0000cbc0: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-0000cbd0: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
-0000cbe0: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
-0000cbf0: 5f76 6172 7320 3d20 5b0a 2020 2020 2020  _vars = [.      
-0000cc00: 2020 2020 2020 2020 2020 6e61 6d65 2066            name f
-0000cc10: 6f72 206e 616d 6520 696e 2076 616c 7565  or name in value
-0000cc20: 2e64 6174 615f 7661 7273 2069 6620 6e61  .data_vars if na
-0000cc30: 6d65 206e 6f74 2069 6e20 7365 6c66 2e64  me not in self.d
-0000cc40: 6174 615f 7661 7273 0a20 2020 2020 2020  ata_vars.       
-0000cc50: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
-0000cc60: 2020 2069 6620 6d69 7373 696e 675f 7661     if missing_va
-0000cc70: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-0000cc80: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000cc90: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000cca0: 2020 2020 2020 2020 2020 6622 5661 7269            f"Vari
-0000ccb0: 6162 6c65 7320 7b6d 6973 7369 6e67 5f76  ables {missing_v
-0000ccc0: 6172 737d 2069 6e20 6e65 7720 7661 6c75  ars} in new valu
-0000ccd0: 6573 220a 2020 2020 2020 2020 2020 2020  es".            
-0000cce0: 2020 2020 2020 2020 6622 206e 6f74 2061          f" not a
-0000ccf0: 7661 696c 6162 6c65 2069 6e20 6f72 6967  vailable in orig
-0000cd00: 696e 616c 2064 6174 6173 6574 3a5c 6e7b  inal dataset:\n{
-0000cd10: 7365 6c66 7d22 0a20 2020 2020 2020 2020  self}".         
-0000cd20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000cd30: 2065 6c69 6620 6e6f 7420 616e 7928 5b69   elif not any([i
-0000cd40: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
-0000cd50: 2074 2920 666f 7220 7420 696e 205b 4461   t) for t in [Da
-0000cd60: 7461 4172 7261 792c 204e 756d 6265 722c  taArray, Number,
-0000cd70: 2073 7472 5d5d 293a 0a20 2020 2020 2020   str]]):.       
-0000cd80: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-0000cd90: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000cda0: 2020 2020 2020 2244 6174 6173 6574 2061        "Dataset a
-0000cdb0: 7373 6967 6e6d 656e 7420 6f6e 6c79 2061  ssignment only a
-0000cdc0: 6363 6570 7473 2044 6174 6141 7272 6179  ccepts DataArray
-0000cdd0: 732c 2044 6174 6173 6574 732c 2061 6e64  s, Datasets, and
-0000cde0: 2073 6361 6c61 7273 2e22 0a20 2020 2020   scalars.".     
-0000cdf0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000ce00: 2020 6e65 775f 7661 6c75 6520 3d20 4461    new_value = Da
-0000ce10: 7461 7365 7428 290a 2020 2020 2020 2020  taset().        
-0000ce20: 666f 7220 6e61 6d65 2c20 7661 7220 696e  for name, var in
-0000ce30: 2073 656c 662e 6974 656d 7328 293a 0a20   self.items():. 
-0000ce40: 2020 2020 2020 2020 2020 2023 2074 6573             # tes
-0000ce50: 7420 696e 6465 7869 6e67 0a20 2020 2020  t indexing.     
-0000ce60: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000ce70: 2020 2020 2020 2020 2020 2020 7661 725f              var_
-0000ce80: 6b20 3d20 7661 725b 6b65 795d 0a20 2020  k = var[key].   
-0000ce90: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000cea0: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cec0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000ced0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000cee0: 2020 2020 2020 6622 5661 7269 6162 6c65        f"Variable
-0000cef0: 2027 7b6e 616d 657d 273a 2069 6e64 6578   '{name}': index
-0000cf00: 6572 207b 6b65 797d 206e 6f74 2061 7661  er {key} not ava
-0000cf10: 696c 6162 6c65 220a 2020 2020 2020 2020  ilable".        
-0000cf20: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
-0000cf30: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000cf40: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-0000cf50: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
-0000cf60: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0000cf70: 203d 2076 616c 7565 5b6e 616d 655d 0a20   = value[name]. 
-0000cf80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000cf90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cfa0: 2076 616c 203d 2076 616c 7565 0a0a 2020   val = value..  
-0000cfb0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-0000cfc0: 6e73 7461 6e63 6528 7661 6c2c 2044 6174  nstance(val, Dat
-0000cfd0: 6141 7272 6179 293a 0a20 2020 2020 2020  aArray):.       
-0000cfe0: 2020 2020 2020 2020 2023 2063 6865 636b           # check
-0000cff0: 2063 6f6e 7369 7374 656e 6379 206f 6620   consistency of 
-0000d000: 6469 6d65 6e73 696f 6e73 0a20 2020 2020  dimensions.     
-0000d010: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-0000d020: 696d 2069 6e20 7661 6c2e 6469 6d73 3a0a  im in val.dims:.
-0000d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d040: 2020 2020 6966 2064 696d 206e 6f74 2069      if dim not i
-0000d050: 6e20 7661 725f 6b2e 6469 6d73 3a0a 2020  n var_k.dims:.  
-0000d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d070: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
-0000d080: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0a0: 2020 6622 5661 7269 6162 6c65 2027 7b6e    f"Variable '{n
-0000d0b0: 616d 657d 273a 2064 696d 656e 7369 6f6e  ame}': dimension
-0000d0c0: 2027 7b64 696d 7d27 2061 7070 6561 7273   '{dim}' appears
-0000d0d0: 2069 6e20 6e65 7720 7661 6c75 6573 2022   in new values "
-0000d0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d0f0: 2020 2020 2020 2020 2020 2020 2066 2262               f"b
-0000d100: 7574 206e 6f74 2069 6e20 7468 6520 696e  ut not in the in
-0000d110: 6465 7865 6420 6f72 6967 696e 616c 2064  dexed original d
-0000d120: 6174 6122 0a20 2020 2020 2020 2020 2020  ata".           
-0000d130: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000d140: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000d150: 696d 7320 3d20 7475 706c 6528 6469 6d20  ims = tuple(dim 
-0000d160: 666f 7220 6469 6d20 696e 2076 6172 5f6b  for dim in var_k
-0000d170: 2e64 696d 7320 6966 2064 696d 2069 6e20  .dims if dim in 
-0000d180: 7661 6c2e 6469 6d73 290a 2020 2020 2020  val.dims).      
-0000d190: 2020 2020 2020 2020 2020 6966 2064 696d            if dim
-0000d1a0: 7320 213d 2076 616c 2e64 696d 733a 0a20  s != val.dims:. 
-0000d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1c0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000d1d0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0000d1e0: 2020 2020 2020 2020 2020 2020 2066 2256               f"V
-0000d1f0: 6172 6961 626c 6520 277b 6e61 6d65 7d27  ariable '{name}'
-0000d200: 3a20 6469 6d65 6e73 696f 6e20 6f72 6465  : dimension orde
-0000d210: 7220 6469 6666 6572 7320 6265 7477 6565  r differs betwee
-0000d220: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-0000d230: 2020 2020 2020 2020 2020 2066 2220 6f72             f" or
-0000d240: 6967 696e 616c 2061 6e64 206e 6577 2064  iginal and new d
-0000d250: 6174 613a 5c6e 7b64 696d 737d 5c6e 7673  ata:\n{dims}\nvs
-0000d260: 2e5c 6e7b 7661 6c2e 6469 6d73 7d22 0a20  .\n{val.dims}". 
+0000c860: 2020 2920 6672 6f6d 2065 0a20 2020 2020    ) from e.     
+0000c870: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c880: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000c890: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000c8a0: 7365 2065 0a0a 2020 2020 2020 2020 656c  se e..        el
+0000c8b0: 6966 2075 7469 6c73 2e68 6173 6861 626c  if utils.hashabl
+0000c8c0: 6528 6b65 7929 3a0a 2020 2020 2020 2020  e(key):.        
+0000c8d0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000c8e0: 6528 7661 6c75 652c 2044 6174 6173 6574  e(value, Dataset
+0000c8f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000c900: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+0000c910: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000c920: 2020 2020 2020 2020 2243 616e 6e6f 7420          "Cannot 
+0000c930: 6173 7369 676e 2061 2044 6174 6173 6574  assign a Dataset
+0000c940: 2074 6f20 6120 7369 6e67 6c65 206b 6579   to a single key
+0000c950: 202d 206f 6e6c 7920 6120 4461 7461 4172   - only a DataAr
+0000c960: 7261 7920 6f72 2056 6172 6961 626c 6520  ray or Variable 
+0000c970: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000c980: 2020 2020 2020 226f 626a 6563 7420 6361        "object ca
+0000c990: 6e20 6265 2073 746f 7265 6420 756e 6465  n be stored unde
+0000c9a0: 7220 6120 7369 6e67 6c65 206b 6579 2e22  r a single key."
+0000c9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c9c0: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+0000c9d0: 656c 662e 7570 6461 7465 287b 6b65 793a  elf.update({key:
+0000c9e0: 2076 616c 7565 7d29 0a0a 2020 2020 2020   value})..      
+0000c9f0: 2020 656c 6966 2075 7469 6c73 2e69 7465    elif utils.ite
+0000ca00: 7261 626c 655f 6f66 5f68 6173 6861 626c  rable_of_hashabl
+0000ca10: 6528 6b65 7929 3a0a 2020 2020 2020 2020  e(key):.        
+0000ca20: 2020 2020 6b65 796c 6973 7420 3d20 6c69      keylist = li
+0000ca30: 7374 286b 6579 290a 2020 2020 2020 2020  st(key).        
+0000ca40: 2020 2020 6966 206c 656e 286b 6579 6c69      if len(keyli
+0000ca50: 7374 2920 3d3d 2030 3a0a 2020 2020 2020  st) == 0:.      
+0000ca60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000ca70: 5661 6c75 6545 7272 6f72 2822 456d 7074  ValueError("Empt
+0000ca80: 7920 6c69 7374 206f 6620 7661 7269 6162  y list of variab
+0000ca90: 6c65 7320 746f 2062 6520 7365 7422 290a  les to be set").
+0000caa0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000cab0: 656e 286b 6579 6c69 7374 2920 3d3d 2031  en(keylist) == 1
+0000cac0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000cad0: 2020 7365 6c66 2e75 7064 6174 6528 7b6b    self.update({k
+0000cae0: 6579 6c69 7374 5b30 5d3a 2076 616c 7565  eylist[0]: value
+0000caf0: 7d29 0a20 2020 2020 2020 2020 2020 2065  }).            e
+0000cb00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000cb10: 2020 2020 2069 6620 6c65 6e28 6b65 796c       if len(keyl
+0000cb20: 6973 7429 2021 3d20 6c65 6e28 7661 6c75  ist) != len(valu
+0000cb30: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0000cb40: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000cb50: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+0000cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb70: 2020 6622 4469 6666 6572 656e 7420 6c65    f"Different le
+0000cb80: 6e67 7468 7320 6f66 2076 6172 6961 626c  ngths of variabl
+0000cb90: 6573 2074 6f20 6265 2073 6574 2022 0a20  es to be set ". 
+0000cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbb0: 2020 2020 2020 2066 2228 7b6c 656e 286b         f"({len(k
+0000cbc0: 6579 6c69 7374 297d 2920 616e 6420 6461  eylist)}) and da
+0000cbd0: 7461 2075 7365 6420 6173 2069 6e70 7574  ta used as input
+0000cbe0: 2066 6f72 2022 0a20 2020 2020 2020 2020   for ".         
+0000cbf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000cc00: 2273 6574 7469 6e67 2028 7b6c 656e 2876  "setting ({len(v
+0000cc10: 616c 7565 297d 2922 0a20 2020 2020 2020  alue)})".       
+0000cc20: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000cc30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000cc40: 6620 6973 696e 7374 616e 6365 2876 616c  f isinstance(val
+0000cc50: 7565 2c20 4461 7461 7365 7429 3a0a 2020  ue, Dataset):.  
+0000cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc70: 2020 7365 6c66 2e75 7064 6174 6528 6469    self.update(di
+0000cc80: 6374 287a 6970 286b 6579 6c69 7374 2c20  ct(zip(keylist, 
+0000cc90: 7661 6c75 652e 6461 7461 5f76 6172 732e  value.data_vars.
+0000cca0: 7661 6c75 6573 2829 2929 290a 2020 2020  values()))).    
+0000ccb0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000ccc0: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+0000ccd0: 652c 2044 6174 6141 7272 6179 293a 0a20  e, DataArray):. 
+0000cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccf0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000cd00: 726f 7228 2243 616e 6e6f 7420 6173 7369  ror("Cannot assi
+0000cd10: 676e 2073 696e 676c 6520 4461 7461 4172  gn single DataAr
+0000cd20: 7261 7920 746f 206d 756c 7469 706c 6520  ray to multiple 
+0000cd30: 6b65 7973 2229 0a20 2020 2020 2020 2020  keys").         
+0000cd40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd60: 2073 656c 662e 7570 6461 7465 2864 6963   self.update(dic
+0000cd70: 7428 7a69 7028 6b65 796c 6973 742c 2076  t(zip(keylist, v
+0000cd80: 616c 7565 2929 290a 0a20 2020 2020 2020  alue)))..       
+0000cd90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000cda0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000cdb0: 726f 7228 6622 556e 7375 7070 6f72 7465  ror(f"Unsupporte
+0000cdc0: 6420 6b65 792d 7479 7065 207b 7479 7065  d key-type {type
+0000cdd0: 286b 6579 297d 2229 0a0a 2020 2020 6465  (key)}")..    de
+0000cde0: 6620 5f73 6574 6974 656d 5f63 6865 636b  f _setitem_check
+0000cdf0: 2873 656c 662c 206b 6579 2c20 7661 6c75  (self, key, valu
+0000ce00: 6529 3a0a 2020 2020 2020 2020 2222 2243  e):.        """C
+0000ce10: 6f6e 7369 7374 656e 6379 2063 6865 636b  onsistency check
+0000ce20: 2066 6f72 205f 5f73 6574 6974 656d 5f5f   for __setitem__
+0000ce30: 0a0a 2020 2020 2020 2020 5768 656e 2061  ..        When a
+0000ce40: 7373 6967 6e69 6e67 2076 616c 7565 7320  ssigning values 
+0000ce50: 746f 2061 2073 7562 7365 7420 6f66 2061  to a subset of a
+0000ce60: 2044 6174 6173 6574 2c20 646f 2063 6f6e   Dataset, do con
+0000ce70: 7369 7374 656e 6379 2063 6865 636b 2062  sistency check b
+0000ce80: 6566 6f72 6568 616e 640a 2020 2020 2020  eforehand.      
+0000ce90: 2020 746f 2061 766f 6964 206c 6561 7669    to avoid leavi
+0000cea0: 6e67 2074 6865 2064 6174 6173 6574 2069  ng the dataset i
+0000ceb0: 6e20 6120 7061 7274 6961 6c6c 7920 7570  n a partially up
+0000cec0: 6461 7465 6420 7374 6174 6520 7768 656e  dated state when
+0000ced0: 2061 6e20 6572 726f 7220 6f63 6375 7273   an error occurs
+0000cee0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000cef0: 2020 2020 2020 6672 6f6d 2078 6172 7261        from xarra
+0000cf00: 792e 636f 7265 2e61 6c69 676e 6d65 6e74  y.core.alignment
+0000cf10: 2069 6d70 6f72 7420 616c 6967 6e0a 2020   import align.  
+0000cf20: 2020 2020 2020 6672 6f6d 2078 6172 7261        from xarra
+0000cf30: 792e 636f 7265 2e64 6174 6161 7272 6179  y.core.dataarray
+0000cf40: 2069 6d70 6f72 7420 4461 7461 4172 7261   import DataArra
+0000cf50: 790a 0a20 2020 2020 2020 2069 6620 6973  y..        if is
+0000cf60: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
+0000cf70: 4461 7461 7365 7429 3a0a 2020 2020 2020  Dataset):.      
+0000cf80: 2020 2020 2020 6d69 7373 696e 675f 7661        missing_va
+0000cf90: 7273 203d 205b 0a20 2020 2020 2020 2020  rs = [.         
+0000cfa0: 2020 2020 2020 206e 616d 6520 666f 7220         name for 
+0000cfb0: 6e61 6d65 2069 6e20 7661 6c75 652e 6461  name in value.da
+0000cfc0: 7461 5f76 6172 7320 6966 206e 616d 6520  ta_vars if name 
+0000cfd0: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
+0000cfe0: 5f76 6172 730a 2020 2020 2020 2020 2020  _vars.          
+0000cff0: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
+0000d000: 6966 206d 6973 7369 6e67 5f76 6172 733a  if missing_vars:
+0000d010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d020: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000d030: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000d040: 2020 2020 2020 2066 2256 6172 6961 626c         f"Variabl
+0000d050: 6573 207b 6d69 7373 696e 675f 7661 7273  es {missing_vars
+0000d060: 7d20 696e 206e 6577 2076 616c 7565 7322  } in new values"
+0000d070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d080: 2020 2020 2066 2220 6e6f 7420 6176 6169       f" not avai
+0000d090: 6c61 626c 6520 696e 206f 7269 6769 6e61  lable in origina
+0000d0a0: 6c20 6461 7461 7365 743a 5c6e 7b73 656c  l dataset:\n{sel
+0000d0b0: 667d 220a 2020 2020 2020 2020 2020 2020  f}".            
+0000d0c0: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+0000d0d0: 6966 206e 6f74 2061 6e79 285b 6973 696e  if not any([isin
+0000d0e0: 7374 616e 6365 2876 616c 7565 2c20 7429  stance(value, t)
+0000d0f0: 2066 6f72 2074 2069 6e20 5b44 6174 6141   for t in [DataA
+0000d100: 7272 6179 2c20 4e75 6d62 6572 2c20 7374  rray, Number, st
+0000d110: 725d 5d29 3a0a 2020 2020 2020 2020 2020  r]]):.          
+0000d120: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+0000d130: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000d140: 2020 2022 4461 7461 7365 7420 6173 7369     "Dataset assi
+0000d150: 676e 6d65 6e74 206f 6e6c 7920 6163 6365  gnment only acce
+0000d160: 7074 7320 4461 7461 4172 7261 7973 2c20  pts DataArrays, 
+0000d170: 4461 7461 7365 7473 2c20 616e 6420 7363  Datasets, and sc
+0000d180: 616c 6172 732e 220a 2020 2020 2020 2020  alars.".        
+0000d190: 2020 2020 290a 0a20 2020 2020 2020 206e      )..        n
+0000d1a0: 6577 5f76 616c 7565 203d 2044 6174 6173  ew_value = Datas
+0000d1b0: 6574 2829 0a20 2020 2020 2020 2066 6f72  et().        for
+0000d1c0: 206e 616d 652c 2076 6172 2069 6e20 7365   name, var in se
+0000d1d0: 6c66 2e69 7465 6d73 2829 3a0a 2020 2020  lf.items():.    
+0000d1e0: 2020 2020 2020 2020 2320 7465 7374 2069          # test i
+0000d1f0: 6e64 6578 696e 670a 2020 2020 2020 2020  ndexing.        
+0000d200: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000d210: 2020 2020 2020 2020 2076 6172 5f6b 203d           var_k =
+0000d220: 2076 6172 5b6b 6579 5d0a 2020 2020 2020   var[key].      
+0000d230: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0000d240: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+0000d250: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000d260: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
 0000d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d280: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000d290: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000d2a0: 2020 2020 2020 2076 616c 203d 206e 702e         val = np.
-0000d2b0: 6172 7261 7928 7661 6c29 0a0a 2020 2020  array(val)..    
-0000d2c0: 2020 2020 2020 2020 2320 7479 7065 2063          # type c
-0000d2d0: 6f6e 7665 7273 696f 6e0a 2020 2020 2020  onversion.      
-0000d2e0: 2020 2020 2020 6e65 775f 7661 6c75 655b        new_value[
-0000d2f0: 6e61 6d65 5d20 3d20 7661 6c2e 6173 7479  name] = val.asty
-0000d300: 7065 2876 6172 5f6b 2e64 7479 7065 2c20  pe(var_k.dtype, 
-0000d310: 636f 7079 3d46 616c 7365 290a 0a20 2020  copy=False)..   
-0000d320: 2020 2020 2023 2063 6865 636b 2063 6f6e       # check con
-0000d330: 7369 7374 656e 6379 206f 6620 6469 6d65  sistency of dime
-0000d340: 6e73 696f 6e20 7369 7a65 7320 616e 6420  nsion sizes and 
-0000d350: 6469 6d65 6e73 696f 6e20 636f 6f72 6469  dimension coordi
-0000d360: 6e61 7465 730a 2020 2020 2020 2020 6966  nates.        if
-0000d370: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-0000d380: 652c 2044 6174 6141 7272 6179 2920 6f72  e, DataArray) or
-0000d390: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-0000d3a0: 652c 2044 6174 6173 6574 293a 0a20 2020  e, Dataset):.   
-0000d3b0: 2020 2020 2020 2020 2061 6c69 676e 2873           align(s
-0000d3c0: 656c 665b 6b65 795d 2c20 7661 6c75 652c  elf[key], value,
-0000d3d0: 206a 6f69 6e3d 2265 7861 6374 222c 2063   join="exact", c
-0000d3e0: 6f70 793d 4661 6c73 6529 0a0a 2020 2020  opy=False)..    
-0000d3f0: 2020 2020 7265 7475 726e 206e 6577 5f76      return new_v
-0000d400: 616c 7565 0a0a 2020 2020 6465 6620 5f5f  alue..    def __
-0000d410: 6465 6c69 7465 6d5f 5f28 7365 6c66 2c20  delitem__(self, 
-0000d420: 6b65 793a 2048 6173 6861 626c 6529 202d  key: Hashable) -
-0000d430: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000d440: 2222 2252 656d 6f76 6520 6120 7661 7269  """Remove a vari
-0000d450: 6162 6c65 2066 726f 6d20 7468 6973 2064  able from this d
-0000d460: 6174 6173 6574 2e22 2222 0a20 2020 2020  ataset.""".     
-0000d470: 2020 2061 7373 6572 745f 6e6f 5f69 6e64     assert_no_ind
-0000d480: 6578 5f63 6f72 7275 7074 6564 2873 656c  ex_corrupted(sel
-0000d490: 662e 7869 6e64 6578 6573 2c20 7b6b 6579  f.xindexes, {key
-0000d4a0: 7d29 0a0a 2020 2020 2020 2020 6966 206b  })..        if k
-0000d4b0: 6579 2069 6e20 7365 6c66 2e5f 696e 6465  ey in self._inde
-0000d4c0: 7865 733a 0a20 2020 2020 2020 2020 2020  xes:.           
-0000d4d0: 2064 656c 2073 656c 662e 5f69 6e64 6578   del self._index
-0000d4e0: 6573 5b6b 6579 5d0a 2020 2020 2020 2020  es[key].        
-0000d4f0: 6465 6c20 7365 6c66 2e5f 7661 7269 6162  del self._variab
-0000d500: 6c65 735b 6b65 795d 0a20 2020 2020 2020  les[key].       
-0000d510: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-0000d520: 6573 2e64 6973 6361 7264 286b 6579 290a  es.discard(key).
-0000d530: 2020 2020 2020 2020 7365 6c66 2e5f 6469          self._di
-0000d540: 6d73 203d 2063 616c 6375 6c61 7465 5f64  ms = calculate_d
-0000d550: 696d 656e 7369 6f6e 7328 7365 6c66 2e5f  imensions(self._
-0000d560: 7661 7269 6162 6c65 7329 0a0a 2020 2020  variables)..    
-0000d570: 2320 6d75 7461 626c 6520 6f62 6a65 6374  # mutable object
-0000d580: 7320 7368 6f75 6c64 206e 6f74 2062 6520  s should not be 
-0000d590: 6861 7368 6162 6c65 0a20 2020 2023 2068  hashable.    # h
-0000d5a0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-0000d5b0: 6d2f 7079 7468 6f6e 2f6d 7970 792f 6973  m/python/mypy/is
-0000d5c0: 7375 6573 2f34 3236 360a 2020 2020 5f5f  sues/4266.    __
-0000d5d0: 6861 7368 5f5f 203d 204e 6f6e 6520 2023  hash__ = None  #
-0000d5e0: 2074 7970 653a 2069 676e 6f72 655b 6173   type: ignore[as
-0000d5f0: 7369 676e 6d65 6e74 5d0a 0a20 2020 2064  signment]..    d
-0000d600: 6566 205f 616c 6c5f 636f 6d70 6174 2873  ef _all_compat(s
-0000d610: 656c 662c 206f 7468 6572 3a20 4461 7461  elf, other: Data
-0000d620: 7365 742c 2063 6f6d 7061 745f 7374 723a  set, compat_str:
-0000d630: 2073 7472 2920 2d3e 2062 6f6f 6c3a 0a20   str) -> bool:. 
-0000d640: 2020 2020 2020 2022 2222 4865 6c70 6572         """Helper
-0000d650: 2066 756e 6374 696f 6e20 666f 7220 6571   function for eq
-0000d660: 7561 6c73 2061 6e64 2069 6465 6e74 6963  uals and identic
-0000d670: 616c 2222 220a 0a20 2020 2020 2020 2023  al"""..        #
-0000d680: 2073 6f6d 6520 7374 6f72 6573 2028 652e   some stores (e.
-0000d690: 672e 2c20 7363 6970 7929 2064 6f20 6e6f  g., scipy) do no
-0000d6a0: 7420 7365 656d 2074 6f20 7072 6573 6572  t seem to preser
-0000d6b0: 7665 206f 7264 6572 2c20 736f 2064 6f6e  ve order, so don
-0000d6c0: 2774 0a20 2020 2020 2020 2023 2072 6571  't.        # req
-0000d6d0: 7569 7265 206d 6174 6368 696e 6720 6f72  uire matching or
-0000d6e0: 6465 7220 666f 7220 6571 7561 6c69 7479  der for equality
-0000d6f0: 0a20 2020 2020 2020 2064 6566 2063 6f6d  .        def com
-0000d700: 7061 7428 783a 2056 6172 6961 626c 652c  pat(x: Variable,
-0000d710: 2079 3a20 5661 7269 6162 6c65 2920 2d3e   y: Variable) ->
-0000d720: 2062 6f6f 6c3a 0a20 2020 2020 2020 2020   bool:.         
-0000d730: 2020 2072 6574 7572 6e20 6765 7461 7474     return getatt
-0000d740: 7228 782c 2063 6f6d 7061 745f 7374 7229  r(x, compat_str)
-0000d750: 2879 290a 0a20 2020 2020 2020 2072 6574  (y)..        ret
-0000d760: 7572 6e20 7365 6c66 2e5f 636f 6f72 645f  urn self._coord_
-0000d770: 6e61 6d65 7320 3d3d 206f 7468 6572 2e5f  names == other._
-0000d780: 636f 6f72 645f 6e61 6d65 7320 616e 6420  coord_names and 
-0000d790: 7574 696c 732e 6469 6374 5f65 7175 6976  utils.dict_equiv
-0000d7a0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0000d7b0: 6c66 2e5f 7661 7269 6162 6c65 732c 206f  lf._variables, o
-0000d7c0: 7468 6572 2e5f 7661 7269 6162 6c65 732c  ther._variables,
-0000d7d0: 2063 6f6d 7061 743d 636f 6d70 6174 0a20   compat=compat. 
-0000d7e0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0000d7f0: 6620 6272 6f61 6463 6173 745f 6571 7561  f broadcast_equa
-0000d800: 6c73 2873 656c 662c 206f 7468 6572 3a20  ls(self, other: 
-0000d810: 4461 7461 7365 7429 202d 3e20 626f 6f6c  Dataset) -> bool
-0000d820: 3a0a 2020 2020 2020 2020 2222 2254 776f  :.        """Two
-0000d830: 2044 6174 6173 6574 7320 6172 6520 6272   Datasets are br
-0000d840: 6f61 6463 6173 7420 6571 7561 6c20 6966  oadcast equal if
-0000d850: 2074 6865 7920 6172 6520 6571 7561 6c20   they are equal 
-0000d860: 6166 7465 720a 2020 2020 2020 2020 6272  after.        br
-0000d870: 6f61 6463 6173 7469 6e67 2061 6c6c 2076  oadcasting all v
-0000d880: 6172 6961 626c 6573 2061 6761 696e 7374  ariables against
-0000d890: 2065 6163 6820 6f74 6865 722e 0a0a 2020   each other...  
-0000d8a0: 2020 2020 2020 466f 7220 6578 616d 706c        For exampl
-0000d8b0: 652c 2076 6172 6961 626c 6573 2074 6861  e, variables tha
-0000d8c0: 7420 6172 6520 7363 616c 6172 2069 6e20  t are scalar in 
-0000d8d0: 6f6e 6520 6461 7461 7365 7420 6275 7420  one dataset but 
-0000d8e0: 6e6f 6e2d 7363 616c 6172 2069 6e0a 2020  non-scalar in.  
-0000d8f0: 2020 2020 2020 7468 6520 6f74 6865 7220        the other 
-0000d900: 6461 7461 7365 7420 6361 6e20 7374 696c  dataset can stil
-0000d910: 6c20 6265 2062 726f 6164 6361 7374 2065  l be broadcast e
-0000d920: 7175 616c 2069 6620 7468 6520 7468 6520  qual if the the 
-0000d930: 6e6f 6e2d 7363 616c 6172 0a20 2020 2020  non-scalar.     
-0000d940: 2020 2076 6172 6961 626c 6520 6973 2061     variable is a
-0000d950: 2063 6f6e 7374 616e 742e 0a0a 2020 2020   constant...    
-0000d960: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-0000d970: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-0000d980: 2020 2020 2020 4461 7461 7365 742e 6571        Dataset.eq
-0000d990: 7561 6c73 0a20 2020 2020 2020 2044 6174  uals.        Dat
-0000d9a0: 6173 6574 2e69 6465 6e74 6963 616c 0a20  aset.identical. 
-0000d9b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d9c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000d9d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000d9e0: 5f61 6c6c 5f63 6f6d 7061 7428 6f74 6865  _all_compat(othe
-0000d9f0: 722c 2022 6272 6f61 6463 6173 745f 6571  r, "broadcast_eq
-0000da00: 7561 6c73 2229 0a20 2020 2020 2020 2065  uals").        e
-0000da10: 7863 6570 7420 2854 7970 6545 7272 6f72  xcept (TypeError
-0000da20: 2c20 4174 7472 6962 7574 6545 7272 6f72  , AttributeError
-0000da30: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000da40: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-0000da50: 2064 6566 2065 7175 616c 7328 7365 6c66   def equals(self
-0000da60: 2c20 6f74 6865 723a 2044 6174 6173 6574  , other: Dataset
-0000da70: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-0000da80: 2020 2022 2222 5477 6f20 4461 7461 7365     """Two Datase
-0000da90: 7473 2061 7265 2065 7175 616c 2069 6620  ts are equal if 
-0000daa0: 7468 6579 2068 6176 6520 6d61 7463 6869  they have matchi
-0000dab0: 6e67 2076 6172 6961 626c 6573 2061 6e64  ng variables and
-0000dac0: 0a20 2020 2020 2020 2063 6f6f 7264 696e  .        coordin
-0000dad0: 6174 6573 2c20 616c 6c20 6f66 2077 6869  ates, all of whi
-0000dae0: 6368 2061 7265 2065 7175 616c 2e0a 0a20  ch are equal... 
-0000daf0: 2020 2020 2020 2044 6174 6173 6574 7320         Datasets 
-0000db00: 6361 6e20 7374 696c 6c20 6265 2065 7175  can still be equ
-0000db10: 616c 2028 6c69 6b65 2070 616e 6461 7320  al (like pandas 
-0000db20: 6f62 6a65 6374 7329 2069 6620 7468 6579  objects) if they
-0000db30: 2068 6176 6520 4e61 4e0a 2020 2020 2020   have NaN.      
-0000db40: 2020 7661 6c75 6573 2069 6e20 7468 6520    values in the 
-0000db50: 7361 6d65 206c 6f63 6174 696f 6e73 2e0a  same locations..
-0000db60: 0a20 2020 2020 2020 2054 6869 7320 6d65  .        This me
-0000db70: 7468 6f64 2069 7320 6e65 6365 7373 6172  thod is necessar
-0000db80: 7920 6265 6361 7573 6520 6076 3120 3d3d  y because `v1 ==
-0000db90: 2076 3260 2066 6f72 2060 6044 6174 6173   v2` for ``Datas
-0000dba0: 6574 6060 0a20 2020 2020 2020 2064 6f65  et``.        doe
-0000dbb0: 7320 656c 656d 656e 742d 7769 7365 2063  s element-wise c
-0000dbc0: 6f6d 7061 7269 736f 6e73 2028 6c69 6b65  omparisons (like
-0000dbd0: 206e 756d 7079 2e6e 6461 7272 6179 7329   numpy.ndarrays)
-0000dbe0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-0000dbf0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-0000dc00: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
-0000dc10: 6173 6574 2e62 726f 6164 6361 7374 5f65  aset.broadcast_e
-0000dc20: 7175 616c 730a 2020 2020 2020 2020 4461  quals.        Da
-0000dc30: 7461 7365 742e 6964 656e 7469 6361 6c0a  taset.identical.
-0000dc40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000dc50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000dc60: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000dc70: 2e5f 616c 6c5f 636f 6d70 6174 286f 7468  ._all_compat(oth
-0000dc80: 6572 2c20 2265 7175 616c 7322 290a 2020  er, "equals").  
-0000dc90: 2020 2020 2020 6578 6365 7074 2028 5479        except (Ty
-0000dca0: 7065 4572 726f 722c 2041 7474 7269 6275  peError, Attribu
-0000dcb0: 7465 4572 726f 7229 3a0a 2020 2020 2020  teError):.      
-0000dcc0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0000dcd0: 7365 0a0a 2020 2020 6465 6620 6964 656e  se..    def iden
-0000dce0: 7469 6361 6c28 7365 6c66 2c20 6f74 6865  tical(self, othe
-0000dcf0: 723a 2044 6174 6173 6574 2920 2d3e 2062  r: Dataset) -> b
-0000dd00: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-0000dd10: 4c69 6b65 2065 7175 616c 732c 2062 7574  Like equals, but
-0000dd20: 2061 6c73 6f20 6368 6563 6b73 2061 6c6c   also checks all
-0000dd30: 2064 6174 6173 6574 2061 7474 7269 6275   dataset attribu
-0000dd40: 7465 7320 616e 6420 7468 650a 2020 2020  tes and the.    
-0000dd50: 2020 2020 6174 7472 6962 7574 6573 206f      attributes o
-0000dd60: 6e20 616c 6c20 7661 7269 6162 6c65 7320  n all variables 
-0000dd70: 616e 6420 636f 6f72 6469 6e61 7465 732e  and coordinates.
-0000dd80: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-0000dd90: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-0000dda0: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
-0000ddb0: 7365 742e 6272 6f61 6463 6173 745f 6571  set.broadcast_eq
-0000ddc0: 7561 6c73 0a20 2020 2020 2020 2044 6174  uals.        Dat
-0000ddd0: 6173 6574 2e65 7175 616c 730a 2020 2020  aset.equals.    
-0000dde0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ddf0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000de00: 2072 6574 7572 6e20 7574 696c 732e 6469   return utils.di
-0000de10: 6374 5f65 7175 6976 2873 656c 662e 6174  ct_equiv(self.at
-0000de20: 7472 732c 206f 7468 6572 2e61 7474 7273  trs, other.attrs
-0000de30: 2920 616e 6420 7365 6c66 2e5f 616c 6c5f  ) and self._all_
-0000de40: 636f 6d70 6174 280a 2020 2020 2020 2020  compat(.        
-0000de50: 2020 2020 2020 2020 6f74 6865 722c 2022          other, "
-0000de60: 6964 656e 7469 6361 6c22 0a20 2020 2020  identical".     
-0000de70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000de80: 2065 7863 6570 7420 2854 7970 6545 7272   except (TypeErr
-0000de90: 6f72 2c20 4174 7472 6962 7574 6545 7272  or, AttributeErr
-0000dea0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-0000deb0: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
-0000dec0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0000ded0: 2064 6566 2069 6e64 6578 6573 2873 656c   def indexes(sel
-0000dee0: 6629 202d 3e20 496e 6465 7865 735b 7064  f) -> Indexes[pd
-0000def0: 2e49 6e64 6578 5d3a 0a20 2020 2020 2020  .Index]:.       
-0000df00: 2022 2222 4d61 7070 696e 6720 6f66 2070   """Mapping of p
-0000df10: 616e 6461 732e 496e 6465 7820 6f62 6a65  andas.Index obje
-0000df20: 6374 7320 7573 6564 2066 6f72 206c 6162  cts used for lab
-0000df30: 656c 2062 6173 6564 2069 6e64 6578 696e  el based indexin
-0000df40: 672e 0a0a 2020 2020 2020 2020 5261 6973  g...        Rais
-0000df50: 6573 2061 6e20 6572 726f 7220 6966 2074  es an error if t
-0000df60: 6869 7320 4461 7461 7365 7420 6861 7320  his Dataset has 
-0000df70: 696e 6465 7865 7320 7468 6174 2063 616e  indexes that can
-0000df80: 6e6f 7420 6265 2063 6f65 7263 6564 0a20  not be coerced. 
-0000df90: 2020 2020 2020 2074 6f20 7061 6e64 6173         to pandas
-0000dfa0: 2e49 6e64 6578 206f 626a 6563 7473 2e0a  .Index objects..
-0000dfb0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-0000dfc0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-0000dfd0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
-0000dfe0: 6574 2e78 696e 6465 7865 730a 0a20 2020  et.xindexes..   
-0000dff0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e000: 2072 6574 7572 6e20 7365 6c66 2e78 696e   return self.xin
-0000e010: 6465 7865 732e 746f 5f70 616e 6461 735f  dexes.to_pandas_
-0000e020: 696e 6465 7865 7328 290a 0a20 2020 2040  indexes()..    @
-0000e030: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0000e040: 2078 696e 6465 7865 7328 7365 6c66 2920   xindexes(self) 
-0000e050: 2d3e 2049 6e64 6578 6573 5b49 6e64 6578  -> Indexes[Index
-0000e060: 5d3a 0a20 2020 2020 2020 2022 2222 4d61  ]:.        """Ma
-0000e070: 7070 696e 6720 6f66 2078 6172 7261 7920  pping of xarray 
-0000e080: 496e 6465 7820 6f62 6a65 6374 7320 7573  Index objects us
-0000e090: 6564 2066 6f72 206c 6162 656c 2062 6173  ed for label bas
-0000e0a0: 6564 2069 6e64 6578 696e 672e 2222 220a  ed indexing.""".
-0000e0b0: 2020 2020 2020 2020 7265 7475 726e 2049          return I
-0000e0c0: 6e64 6578 6573 2873 656c 662e 5f69 6e64  ndexes(self._ind
-0000e0d0: 6578 6573 2c20 7b6b 3a20 7365 6c66 2e5f  exes, {k: self._
-0000e0e0: 7661 7269 6162 6c65 735b 6b5d 2066 6f72  variables[k] for
-0000e0f0: 206b 2069 6e20 7365 6c66 2e5f 696e 6465   k in self._inde
-0000e100: 7865 737d 290a 0a20 2020 2040 7072 6f70  xes})..    @prop
-0000e110: 6572 7479 0a20 2020 2064 6566 2063 6f6f  erty.    def coo
-0000e120: 7264 7328 7365 6c66 2920 2d3e 2044 6174  rds(self) -> Dat
-0000e130: 6173 6574 436f 6f72 6469 6e61 7465 733a  asetCoordinates:
-0000e140: 0a20 2020 2020 2020 2022 2222 4469 6374  .        """Dict
-0000e150: 696f 6e61 7279 206f 6620 7861 7272 6179  ionary of xarray
-0000e160: 2e44 6174 6141 7272 6179 206f 626a 6563  .DataArray objec
-0000e170: 7473 2063 6f72 7265 7370 6f6e 6469 6e67  ts corresponding
-0000e180: 2074 6f20 636f 6f72 6469 6e61 7465 0a20   to coordinate. 
-0000e190: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0000e1a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000e1b0: 2020 2020 2072 6574 7572 6e20 4461 7461       return Data
-0000e1c0: 7365 7443 6f6f 7264 696e 6174 6573 2873  setCoordinates(s
-0000e1d0: 656c 6629 0a0a 2020 2020 4070 726f 7065  elf)..    @prope
-0000e1e0: 7274 790a 2020 2020 6465 6620 6461 7461  rty.    def data
-0000e1f0: 5f76 6172 7328 7365 6c66 2920 2d3e 2044  _vars(self) -> D
-0000e200: 6174 6156 6172 6961 626c 6573 3a0a 2020  ataVariables:.  
-0000e210: 2020 2020 2020 2222 2244 6963 7469 6f6e        """Diction
-0000e220: 6172 7920 6f66 2044 6174 6141 7272 6179  ary of DataArray
-0000e230: 206f 626a 6563 7473 2063 6f72 7265 7370   objects corresp
-0000e240: 6f6e 6469 6e67 2074 6f20 6461 7461 2076  onding to data v
-0000e250: 6172 6961 626c 6573 2222 220a 2020 2020  ariables""".    
-0000e260: 2020 2020 7265 7475 726e 2044 6174 6156      return DataV
-0000e270: 6172 6961 626c 6573 2873 656c 6629 0a0a  ariables(self)..
-0000e280: 2020 2020 6465 6620 7365 745f 636f 6f72      def set_coor
-0000e290: 6473 2873 656c 663a 2054 5f44 6174 6173  ds(self: T_Datas
-0000e2a0: 6574 2c20 6e61 6d65 733a 2048 6173 6861  et, names: Hasha
-0000e2b0: 626c 6520 7c20 4974 6572 6162 6c65 5b48  ble | Iterable[H
-0000e2c0: 6173 6861 626c 655d 2920 2d3e 2054 5f44  ashable]) -> T_D
-0000e2d0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-0000e2e0: 2222 2247 6976 656e 206e 616d 6573 206f  """Given names o
-0000e2f0: 6620 6f6e 6520 6f72 206d 6f72 6520 7661  f one or more va
-0000e300: 7269 6162 6c65 732c 2073 6574 2074 6865  riables, set the
-0000e310: 6d20 6173 2063 6f6f 7264 696e 6174 6573  m as coordinates
-0000e320: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0000e330: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0000e340: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0000e350: 6e61 6d65 7320 3a20 6861 7368 6162 6c65  names : hashable
-0000e360: 206f 7220 6974 6572 6162 6c65 206f 6620   or iterable of 
-0000e370: 6861 7368 6162 6c65 0a20 2020 2020 2020  hashable.       
-0000e380: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
-0000e390: 7661 7269 6162 6c65 7320 696e 2074 6869  variables in thi
-0000e3a0: 7320 6461 7461 7365 7420 746f 2063 6f6e  s dataset to con
-0000e3b0: 7665 7274 2069 6e74 6f20 636f 6f72 6469  vert into coordi
-0000e3c0: 6e61 7465 732e 0a0a 2020 2020 2020 2020  nates...        
-0000e3d0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-0000e3e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0000e3f0: 4461 7461 7365 740a 0a20 2020 2020 2020  Dataset..       
-0000e400: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-0000e410: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-0000e420: 2020 2044 6174 6173 6574 2e73 7761 705f     Dataset.swap_
-0000e430: 6469 6d73 0a20 2020 2020 2020 2044 6174  dims.        Dat
-0000e440: 6173 6574 2e61 7373 6967 6e5f 636f 6f72  aset.assign_coor
-0000e450: 6473 0a20 2020 2020 2020 2022 2222 0a20  ds.        """. 
-0000e460: 2020 2020 2020 2023 2054 4f44 4f3a 2061         # TODO: a
-0000e470: 6c6c 6f77 2069 6e73 6572 7469 6e67 206e  llow inserting n
-0000e480: 6577 2063 6f6f 7264 696e 6174 6573 2077  ew coordinates w
-0000e490: 6974 6820 7468 6973 206d 6574 686f 642c  ith this method,
-0000e4a0: 206c 696b 650a 2020 2020 2020 2020 2320   like.        # 
-0000e4b0: 4461 7461 4672 616d 652e 7365 745f 696e  DataFrame.set_in
-0000e4c0: 6465 783f 0a20 2020 2020 2020 2023 206e  dex?.        # n
-0000e4d0: 622e 2063 6865 636b 2069 6e20 7365 6c66  b. check in self
-0000e4e0: 2e5f 7661 7269 6162 6c65 732c 206e 6f74  ._variables, not
-0000e4f0: 2073 656c 662e 6461 7461 5f76 6172 7320   self.data_vars 
-0000e500: 746f 2069 6e73 7572 6520 7468 6174 2074  to insure that t
-0000e510: 6865 0a20 2020 2020 2020 2023 206f 7065  he.        # ope
-0000e520: 7261 7469 6f6e 2069 7320 6964 656d 706f  ration is idempo
-0000e530: 7465 6e74 0a20 2020 2020 2020 2069 6620  tent.        if 
-0000e540: 6973 696e 7374 616e 6365 286e 616d 6573  isinstance(names
-0000e550: 2c20 7374 7229 206f 7220 6e6f 7420 6973  , str) or not is
-0000e560: 696e 7374 616e 6365 286e 616d 6573 2c20  instance(names, 
-0000e570: 4974 6572 6162 6c65 293a 0a20 2020 2020  Iterable):.     
-0000e580: 2020 2020 2020 206e 616d 6573 203d 205b         names = [
-0000e590: 6e61 6d65 735d 0a20 2020 2020 2020 2065  names].        e
-0000e5a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000e5b0: 206e 616d 6573 203d 206c 6973 7428 6e61   names = list(na
-0000e5c0: 6d65 7329 0a20 2020 2020 2020 2073 656c  mes).        sel
-0000e5d0: 662e 5f61 7373 6572 745f 616c 6c5f 696e  f._assert_all_in
-0000e5e0: 5f64 6174 6173 6574 286e 616d 6573 290a  _dataset(names).
-0000e5f0: 2020 2020 2020 2020 6f62 6a20 3d20 7365          obj = se
-0000e600: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
-0000e610: 2020 6f62 6a2e 5f63 6f6f 7264 5f6e 616d    obj._coord_nam
-0000e620: 6573 2e75 7064 6174 6528 6e61 6d65 7329  es.update(names)
-0000e630: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000e640: 6f62 6a0a 0a20 2020 2064 6566 2072 6573  obj..    def res
-0000e650: 6574 5f63 6f6f 7264 7328 0a20 2020 2020  et_coords(.     
-0000e660: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-0000e670: 6574 2c0a 2020 2020 2020 2020 6e61 6d65  et,.        name
-0000e680: 733a 2044 696d 7320 3d20 4e6f 6e65 2c0a  s: Dims = None,.
-0000e690: 2020 2020 2020 2020 6472 6f70 3a20 626f          drop: bo
-0000e6a0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000e6b0: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-0000e6c0: 2020 2020 2020 2020 2222 2247 6976 656e          """Given
-0000e6d0: 206e 616d 6573 206f 6620 636f 6f72 6469   names of coordi
-0000e6e0: 6e61 7465 732c 2072 6573 6574 2074 6865  nates, reset the
-0000e6f0: 6d20 746f 2062 6563 6f6d 6520 7661 7269  m to become vari
-0000e700: 6162 6c65 730a 0a20 2020 2020 2020 2050  ables..        P
-0000e710: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0000e720: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0000e730: 2020 2020 206e 616d 6573 203a 2073 7472       names : str
-0000e740: 2c20 4974 6572 6162 6c65 206f 6620 4861  , Iterable of Ha
-0000e750: 7368 6162 6c65 206f 7220 4e6f 6e65 2c20  shable or None, 
-0000e760: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0000e770: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
-0000e780: 6e6f 6e2d 696e 6465 7820 636f 6f72 6469  non-index coordi
-0000e790: 6e61 7465 7320 696e 2074 6869 7320 6461  nates in this da
-0000e7a0: 7461 7365 7420 746f 2072 6573 6574 2069  taset to reset i
-0000e7b0: 6e74 6f0a 2020 2020 2020 2020 2020 2020  nto.            
-0000e7c0: 7661 7269 6162 6c65 732e 2042 7920 6465  variables. By de
-0000e7d0: 6661 756c 742c 2061 6c6c 206e 6f6e 2d69  fault, all non-i
-0000e7e0: 6e64 6578 2063 6f6f 7264 696e 6174 6573  ndex coordinates
-0000e7f0: 2061 7265 2072 6573 6574 2e0a 2020 2020   are reset..    
-0000e800: 2020 2020 6472 6f70 203a 2062 6f6f 6c2c      drop : bool,
-0000e810: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
-0000e820: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-0000e830: 7275 652c 2072 656d 6f76 6520 636f 6f72  rue, remove coor
-0000e840: 6469 6e61 7465 7320 696e 7374 6561 6420  dinates instead 
-0000e850: 6f66 2063 6f6e 7665 7274 696e 6720 7468  of converting th
-0000e860: 656d 2069 6e74 6f0a 2020 2020 2020 2020  em into.        
-0000e870: 2020 2020 7661 7269 6162 6c65 732e 0a0a      variables...
-0000e880: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0000e890: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-0000e8a0: 2020 2020 2020 2020 4461 7461 7365 740a          Dataset.
-0000e8b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000e8c0: 2020 2020 6966 206e 616d 6573 2069 7320      if names is 
-0000e8d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000e8e0: 2020 6e61 6d65 7320 3d20 7365 6c66 2e5f    names = self._
-0000e8f0: 636f 6f72 645f 6e61 6d65 7320 2d20 7365  coord_names - se
-0000e900: 7428 7365 6c66 2e5f 696e 6465 7865 7329  t(self._indexes)
-0000e910: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000e920: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0000e930: 696e 7374 616e 6365 286e 616d 6573 2c20  instance(names, 
-0000e940: 7374 7229 206f 7220 6e6f 7420 6973 696e  str) or not isin
-0000e950: 7374 616e 6365 286e 616d 6573 2c20 4974  stance(names, It
-0000e960: 6572 6162 6c65 293a 0a20 2020 2020 2020  erable):.       
-0000e970: 2020 2020 2020 2020 206e 616d 6573 203d           names =
-0000e980: 205b 6e61 6d65 735d 0a20 2020 2020 2020   [names].       
-0000e990: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000e9a0: 2020 2020 2020 2020 2020 206e 616d 6573             names
-0000e9b0: 203d 206c 6973 7428 6e61 6d65 7329 0a20   = list(names). 
-0000e9c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000e9d0: 5f61 7373 6572 745f 616c 6c5f 696e 5f64  _assert_all_in_d
-0000e9e0: 6174 6173 6574 286e 616d 6573 290a 2020  ataset(names).  
-0000e9f0: 2020 2020 2020 2020 2020 6261 645f 636f            bad_co
-0000ea00: 6f72 6473 203d 2073 6574 286e 616d 6573  ords = set(names
-0000ea10: 2920 2620 7365 7428 7365 6c66 2e5f 696e  ) & set(self._in
-0000ea20: 6465 7865 7329 0a20 2020 2020 2020 2020  dexes).         
-0000ea30: 2020 2069 6620 6261 645f 636f 6f72 6473     if bad_coords
-0000ea40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ea50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000ea60: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000ea70: 2020 2020 2020 2020 6622 6361 6e6e 6f74          f"cannot
-0000ea80: 2072 656d 6f76 6520 696e 6465 7820 636f   remove index co
-0000ea90: 6f72 6469 6e61 7465 7320 7769 7468 2072  ordinates with r
-0000eaa0: 6573 6574 5f63 6f6f 7264 733a 207b 6261  eset_coords: {ba
-0000eab0: 645f 636f 6f72 6473 7d22 0a20 2020 2020  d_coords}".     
-0000eac0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000ead0: 2020 2020 206f 626a 203d 2073 656c 662e       obj = self.
-0000eae0: 636f 7079 2829 0a20 2020 2020 2020 206f  copy().        o
-0000eaf0: 626a 2e5f 636f 6f72 645f 6e61 6d65 732e  bj._coord_names.
-0000eb00: 6469 6666 6572 656e 6365 5f75 7064 6174  difference_updat
-0000eb10: 6528 6e61 6d65 7329 0a20 2020 2020 2020  e(names).       
-0000eb20: 2069 6620 6472 6f70 3a0a 2020 2020 2020   if drop:.      
-0000eb30: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
-0000eb40: 6e20 6e61 6d65 733a 0a20 2020 2020 2020  n names:.       
-0000eb50: 2020 2020 2020 2020 2064 656c 206f 626a           del obj
-0000eb60: 2e5f 7661 7269 6162 6c65 735b 6e61 6d65  ._variables[name
-0000eb70: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-0000eb80: 206f 626a 0a0a 2020 2020 6465 6620 6475   obj..    def du
-0000eb90: 6d70 5f74 6f5f 7374 6f72 6528 7365 6c66  mp_to_store(self
-0000eba0: 2c20 7374 6f72 653a 2041 6273 7472 6163  , store: Abstrac
-0000ebb0: 7444 6174 6153 746f 7265 2c20 2a2a 6b77  tDataStore, **kw
-0000ebc0: 6172 6773 2920 2d3e 204e 6f6e 653a 0a20  args) -> None:. 
-0000ebd0: 2020 2020 2020 2022 2222 5374 6f72 6520         """Store 
-0000ebe0: 6461 7461 7365 7420 636f 6e74 656e 7473  dataset contents
-0000ebf0: 2074 6f20 6120 6261 636b 656e 6473 2e2a   to a backends.*
-0000ec00: 4461 7461 5374 6f72 6520 6f62 6a65 6374  DataStore object
-0000ec10: 2e22 2222 0a20 2020 2020 2020 2066 726f  .""".        fro
-0000ec20: 6d20 7861 7272 6179 2e62 6163 6b65 6e64  m xarray.backend
-0000ec30: 732e 6170 6920 696d 706f 7274 2064 756d  s.api import dum
-0000ec40: 705f 746f 5f73 746f 7265 0a0a 2020 2020  p_to_store..    
-0000ec50: 2020 2020 2320 544f 444f 3a20 7265 6e61      # TODO: rena
-0000ec60: 6d65 2061 6e64 2f6f 7220 636c 6561 6e75  me and/or cleanu
-0000ec70: 7020 7468 6973 206d 6574 686f 6420 746f  p this method to
-0000ec80: 206d 616b 6520 6974 206d 6f72 6520 636f   make it more co
-0000ec90: 6e73 6973 7465 6e74 0a20 2020 2020 2020  nsistent.       
-0000eca0: 2023 2077 6974 6820 746f 5f6e 6574 6364   # with to_netcd
-0000ecb0: 6628 290a 2020 2020 2020 2020 6475 6d70  f().        dump
-0000ecc0: 5f74 6f5f 7374 6f72 6528 7365 6c66 2c20  _to_store(self, 
-0000ecd0: 7374 6f72 652c 202a 2a6b 7761 7267 7329  store, **kwargs)
-0000ece0: 0a0a 2020 2020 2320 7061 7468 3d4e 6f6e  ..    # path=Non
-0000ecf0: 6520 7772 6974 6573 2074 6f20 6279 7465  e writes to byte
-0000ed00: 730a 2020 2020 406f 7665 726c 6f61 640a  s.    @overload.
-0000ed10: 2020 2020 6465 6620 746f 5f6e 6574 6364      def to_netcd
-0000ed20: 6628 0a20 2020 2020 2020 2073 656c 662c  f(.        self,
-0000ed30: 0a20 2020 2020 2020 2070 6174 683a 204e  .        path: N
-0000ed40: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-0000ed50: 2020 2020 6d6f 6465 3a20 4c69 7465 7261      mode: Litera
-0000ed60: 6c5b 2277 222c 2022 6122 5d20 3d20 2277  l["w", "a"] = "w
-0000ed70: 222c 0a20 2020 2020 2020 2066 6f72 6d61  ",.        forma
-0000ed80: 743a 2054 5f4e 6574 6364 6654 7970 6573  t: T_NetcdfTypes
-0000ed90: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0000eda0: 2020 2020 2020 2020 6772 6f75 703a 2073          group: s
-0000edb0: 7472 207c 204e 6f6e 6520 3d20 4e6f 6e65  tr | None = None
-0000edc0: 2c0a 2020 2020 2020 2020 656e 6769 6e65  ,.        engine
-0000edd0: 3a20 545f 4e65 7463 6466 456e 6769 6e65  : T_NetcdfEngine
-0000ede0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0000edf0: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
-0000ee00: 3a20 4d61 7070 696e 675b 416e 792c 204d  : Mapping[Any, M
-0000ee10: 6170 7069 6e67 5b73 7472 2c20 416e 795d  apping[str, Any]
-0000ee20: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-0000ee30: 0a20 2020 2020 2020 2075 6e6c 696d 6974  .        unlimit
-0000ee40: 6564 5f64 696d 733a 2049 7465 7261 626c  ed_dims: Iterabl
-0000ee50: 655b 4861 7368 6162 6c65 5d20 7c20 4e6f  e[Hashable] | No
-0000ee60: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-0000ee70: 2020 2063 6f6d 7075 7465 3a20 626f 6f6c     compute: bool
-0000ee80: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-0000ee90: 2069 6e76 616c 6964 5f6e 6574 6364 663a   invalid_netcdf:
-0000eea0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0000eeb0: 2020 2029 202d 3e20 6279 7465 733a 0a20     ) -> bytes:. 
-0000eec0: 2020 2020 2020 202e 2e2e 0a0a 2020 2020         .....    
-0000eed0: 2320 6465 6661 756c 7420 7265 7475 726e  # default return
-0000eee0: 204e 6f6e 650a 2020 2020 406f 7665 726c   None.    @overl
-0000eef0: 6f61 640a 2020 2020 6465 6620 746f 5f6e  oad.    def to_n
-0000ef00: 6574 6364 6628 0a20 2020 2020 2020 2073  etcdf(.        s
-0000ef10: 656c 662c 0a20 2020 2020 2020 2070 6174  elf,.        pat
-0000ef20: 683a 2073 7472 207c 2050 6174 684c 696b  h: str | PathLik
-0000ef30: 652c 0a20 2020 2020 2020 206d 6f64 653a  e,.        mode:
-0000ef40: 204c 6974 6572 616c 5b22 7722 2c20 2261   Literal["w", "a
-0000ef50: 225d 203d 2022 7722 2c0a 2020 2020 2020  "] = "w",.      
-0000ef60: 2020 666f 726d 6174 3a20 545f 4e65 7463    format: T_Netc
-0000ef70: 6466 5479 7065 7320 7c20 4e6f 6e65 203d  dfTypes | None =
-0000ef80: 204e 6f6e 652c 0a20 2020 2020 2020 2067   None,.        g
-0000ef90: 726f 7570 3a20 7374 7220 7c20 4e6f 6e65  roup: str | None
-0000efa0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000efb0: 2065 6e67 696e 653a 2054 5f4e 6574 6364   engine: T_Netcd
-0000efc0: 6645 6e67 696e 6520 7c20 4e6f 6e65 203d  fEngine | None =
-0000efd0: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
-0000efe0: 6e63 6f64 696e 673a 204d 6170 7069 6e67  ncoding: Mapping
-0000eff0: 5b41 6e79 2c20 4d61 7070 696e 675b 7374  [Any, Mapping[st
-0000f000: 722c 2041 6e79 5d5d 207c 204e 6f6e 6520  r, Any]] | None 
-0000f010: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0000f020: 756e 6c69 6d69 7465 645f 6469 6d73 3a20  unlimited_dims: 
-0000f030: 4974 6572 6162 6c65 5b48 6173 6861 626c  Iterable[Hashabl
-0000f040: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
-0000f050: 2c0a 2020 2020 2020 2020 636f 6d70 7574  ,.        comput
-0000f060: 653a 204c 6974 6572 616c 5b54 7275 655d  e: Literal[True]
-0000f070: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-0000f080: 2069 6e76 616c 6964 5f6e 6574 6364 663a   invalid_netcdf:
-0000f090: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0000f0a0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-0000f0b0: 2020 2020 2020 2e2e 2e0a 0a20 2020 2023        .....    #
-0000f0c0: 2063 6f6d 7075 7465 3d46 616c 7365 2072   compute=False r
-0000f0d0: 6574 7572 6e73 2064 6173 6b2e 4465 6c61  eturns dask.Dela
-0000f0e0: 7965 640a 2020 2020 406f 7665 726c 6f61  yed.    @overloa
-0000f0f0: 640a 2020 2020 6465 6620 746f 5f6e 6574  d.    def to_net
-0000f100: 6364 6628 0a20 2020 2020 2020 2073 656c  cdf(.        sel
-0000f110: 662c 0a20 2020 2020 2020 2070 6174 683a  f,.        path:
-0000f120: 2073 7472 207c 2050 6174 684c 696b 652c   str | PathLike,
-0000f130: 0a20 2020 2020 2020 206d 6f64 653a 204c  .        mode: L
-0000f140: 6974 6572 616c 5b22 7722 2c20 2261 225d  iteral["w", "a"]
-0000f150: 203d 2022 7722 2c0a 2020 2020 2020 2020   = "w",.        
-0000f160: 666f 726d 6174 3a20 545f 4e65 7463 6466  format: T_Netcdf
-0000f170: 5479 7065 7320 7c20 4e6f 6e65 203d 204e  Types | None = N
-0000f180: 6f6e 652c 0a20 2020 2020 2020 2067 726f  one,.        gro
-0000f190: 7570 3a20 7374 7220 7c20 4e6f 6e65 203d  up: str | None =
-0000f1a0: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
-0000f1b0: 6e67 696e 653a 2054 5f4e 6574 6364 6645  ngine: T_NetcdfE
-0000f1c0: 6e67 696e 6520 7c20 4e6f 6e65 203d 204e  ngine | None = N
-0000f1d0: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
-0000f1e0: 6f64 696e 673a 204d 6170 7069 6e67 5b41  oding: Mapping[A
-0000f1f0: 6e79 2c20 4d61 7070 696e 675b 7374 722c  ny, Mapping[str,
-0000f200: 2041 6e79 5d5d 207c 204e 6f6e 6520 3d20   Any]] | None = 
-0000f210: 4e6f 6e65 2c0a 2020 2020 2020 2020 756e  None,.        un
-0000f220: 6c69 6d69 7465 645f 6469 6d73 3a20 4974  limited_dims: It
-0000f230: 6572 6162 6c65 5b48 6173 6861 626c 655d  erable[Hashable]
-0000f240: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0000f250: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
-0000f260: 2020 2063 6f6d 7075 7465 3a20 4c69 7465     compute: Lite
-0000f270: 7261 6c5b 4661 6c73 655d 2c0a 2020 2020  ral[False],.    
-0000f280: 2020 2020 696e 7661 6c69 645f 6e65 7463      invalid_netc
-0000f290: 6466 3a20 626f 6f6c 203d 2046 616c 7365  df: bool = False
-0000f2a0: 2c0a 2020 2020 2920 2d3e 2044 656c 6179  ,.    ) -> Delay
-0000f2b0: 6564 3a0a 2020 2020 2020 2020 2e2e 2e0a  ed:.        ....
-0000f2c0: 0a20 2020 2064 6566 2074 6f5f 6e65 7463  .    def to_netc
-0000f2d0: 6466 280a 2020 2020 2020 2020 7365 6c66  df(.        self
-0000f2e0: 2c0a 2020 2020 2020 2020 7061 7468 3a20  ,.        path: 
-0000f2f0: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
-0000f300: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-0000f310: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
-0000f320: 7261 6c5b 2277 222c 2022 6122 5d20 3d20  ral["w", "a"] = 
-0000f330: 2277 222c 0a20 2020 2020 2020 2066 6f72  "w",.        for
-0000f340: 6d61 743a 2054 5f4e 6574 6364 6654 7970  mat: T_NetcdfTyp
-0000f350: 6573 207c 204e 6f6e 6520 3d20 4e6f 6e65  es | None = None
-0000f360: 2c0a 2020 2020 2020 2020 6772 6f75 703a  ,.        group:
-0000f370: 2073 7472 207c 204e 6f6e 6520 3d20 4e6f   str | None = No
-0000f380: 6e65 2c0a 2020 2020 2020 2020 656e 6769  ne,.        engi
-0000f390: 6e65 3a20 545f 4e65 7463 6466 456e 6769  ne: T_NetcdfEngi
-0000f3a0: 6e65 207c 204e 6f6e 6520 3d20 4e6f 6e65  ne | None = None
-0000f3b0: 2c0a 2020 2020 2020 2020 656e 636f 6469  ,.        encodi
-0000f3c0: 6e67 3a20 4d61 7070 696e 675b 416e 792c  ng: Mapping[Any,
-0000f3d0: 204d 6170 7069 6e67 5b73 7472 2c20 416e   Mapping[str, An
-0000f3e0: 795d 5d20 7c20 4e6f 6e65 203d 204e 6f6e  y]] | None = Non
-0000f3f0: 652c 0a20 2020 2020 2020 2075 6e6c 696d  e,.        unlim
-0000f400: 6974 6564 5f64 696d 733a 2049 7465 7261  ited_dims: Itera
-0000f410: 626c 655b 4861 7368 6162 6c65 5d20 7c20  ble[Hashable] | 
-0000f420: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-0000f430: 2020 2020 2063 6f6d 7075 7465 3a20 626f       compute: bo
-0000f440: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
-0000f450: 2020 2069 6e76 616c 6964 5f6e 6574 6364     invalid_netcd
-0000f460: 663a 2062 6f6f 6c20 3d20 4661 6c73 652c  f: bool = False,
-0000f470: 0a20 2020 2029 202d 3e20 6279 7465 7320  .    ) -> bytes 
-0000f480: 7c20 4465 6c61 7965 6420 7c20 4e6f 6e65  | Delayed | None
-0000f490: 3a0a 2020 2020 2020 2020 2222 2257 7269  :.        """Wri
-0000f4a0: 7465 2064 6174 6173 6574 2063 6f6e 7465  te dataset conte
-0000f4b0: 6e74 7320 746f 2061 206e 6574 4344 4620  nts to a netCDF 
-0000f4c0: 6669 6c65 2e0a 0a20 2020 2020 2020 2050  file...        P
-0000f4d0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0000f4e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0000f4f0: 2020 2020 2070 6174 6820 3a20 7374 722c       path : str,
-0000f500: 2070 6174 682d 6c69 6b65 206f 7220 6669   path-like or fi
-0000f510: 6c65 2d6c 696b 652c 206f 7074 696f 6e61  le-like, optiona
-0000f520: 6c0a 2020 2020 2020 2020 2020 2020 5061  l.            Pa
-0000f530: 7468 2074 6f20 7768 6963 6820 746f 2073  th to which to s
-0000f540: 6176 6520 7468 6973 2064 6174 6173 6574  ave this dataset
-0000f550: 2e20 4669 6c65 2d6c 696b 6520 6f62 6a65  . File-like obje
-0000f560: 6374 7320 6172 6520 6f6e 6c79 0a20 2020  cts are only.   
-0000f570: 2020 2020 2020 2020 2073 7570 706f 7274           support
-0000f580: 6564 2062 7920 7468 6520 7363 6970 7920  ed by the scipy 
-0000f590: 656e 6769 6e65 2e20 4966 206e 6f20 7061  engine. If no pa
-0000f5a0: 7468 2069 7320 7072 6f76 6964 6564 2c20  th is provided, 
-0000f5b0: 7468 6973 0a20 2020 2020 2020 2020 2020  this.           
-0000f5c0: 2066 756e 6374 696f 6e20 7265 7475 726e   function return
-0000f5d0: 7320 7468 6520 7265 7375 6c74 696e 6720  s the resulting 
-0000f5e0: 6e65 7443 4446 2066 696c 6520 6173 2062  netCDF file as b
-0000f5f0: 7974 6573 3b20 696e 2074 6869 7320 6361  ytes; in this ca
-0000f600: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-0000f610: 7765 206e 6565 6420 746f 2075 7365 2073  we need to use s
-0000f620: 6369 7079 2c20 7768 6963 6820 646f 6573  cipy, which does
-0000f630: 206e 6f74 2073 7570 706f 7274 206e 6574   not support net
-0000f640: 4344 4620 7665 7273 696f 6e20 3420 2874  CDF version 4 (t
-0000f650: 6865 0a20 2020 2020 2020 2020 2020 2064  he.            d
-0000f660: 6566 6175 6c74 2066 6f72 6d61 7420 6265  efault format be
-0000f670: 636f 6d65 7320 4e45 5443 4446 335f 3634  comes NETCDF3_64
-0000f680: 4249 5429 2e0a 2020 2020 2020 2020 6d6f  BIT)..        mo
-0000f690: 6465 203a 207b 2277 222c 2022 6122 7d2c  de : {"w", "a"},
-0000f6a0: 2064 6566 6175 6c74 3a20 2277 220a 2020   default: "w".  
-0000f6b0: 2020 2020 2020 2020 2020 5772 6974 6520            Write 
-0000f6c0: 2827 7727 2920 6f72 2061 7070 656e 6420  ('w') or append 
-0000f6d0: 2827 6127 2920 6d6f 6465 2e20 4966 206d  ('a') mode. If m
-0000f6e0: 6f64 653d 2777 272c 2061 6e79 2065 7869  ode='w', any exi
-0000f6f0: 7374 696e 6720 6669 6c65 2061 740a 2020  sting file at.  
-0000f700: 2020 2020 2020 2020 2020 7468 6973 206c            this l
-0000f710: 6f63 6174 696f 6e20 7769 6c6c 2062 6520  ocation will be 
-0000f720: 6f76 6572 7772 6974 7465 6e2e 2049 6620  overwritten. If 
-0000f730: 6d6f 6465 3d27 6127 2c20 6578 6973 7469  mode='a', existi
-0000f740: 6e67 2076 6172 6961 626c 6573 0a20 2020  ng variables.   
-0000f750: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
-0000f760: 206f 7665 7277 7269 7474 656e 2e0a 2020   overwritten..  
-0000f770: 2020 2020 2020 666f 726d 6174 203a 207b        format : {
-0000f780: 224e 4554 4344 4634 222c 2022 4e45 5443  "NETCDF4", "NETC
-0000f790: 4446 345f 434c 4153 5349 4322 2c20 224e  DF4_CLASSIC", "N
-0000f7a0: 4554 4344 4633 5f36 3442 4954 222c 205c  ETCDF3_64BIT", \
-0000f7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f7c0: 2020 2022 4e45 5443 4446 335f 434c 4153     "NETCDF3_CLAS
-0000f7d0: 5349 4322 7d2c 206f 7074 696f 6e61 6c0a  SIC"}, optional.
-0000f7e0: 2020 2020 2020 2020 2020 2020 4669 6c65              File
-0000f7f0: 2066 6f72 6d61 7420 666f 7220 7468 6520   format for the 
-0000f800: 7265 7375 6c74 696e 6720 6e65 7443 4446  resulting netCDF
-0000f810: 2066 696c 653a 0a0a 2020 2020 2020 2020   file:..        
-0000f820: 2020 2020 2a20 4e45 5443 4446 343a 2044      * NETCDF4: D
-0000f830: 6174 6120 6973 2073 746f 7265 6420 696e  ata is stored in
-0000f840: 2061 6e20 4844 4635 2066 696c 652c 2075   an HDF5 file, u
-0000f850: 7369 6e67 206e 6574 4344 4634 2041 5049  sing netCDF4 API
-0000f860: 0a20 2020 2020 2020 2020 2020 2020 2066  .              f
-0000f870: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
-0000f880: 2020 2020 202a 204e 4554 4344 4634 5f43       * NETCDF4_C
-0000f890: 4c41 5353 4943 3a20 4461 7461 2069 7320  LASSIC: Data is 
-0000f8a0: 7374 6f72 6564 2069 6e20 616e 2048 4446  stored in an HDF
-0000f8b0: 3520 6669 6c65 2c20 7573 696e 6720 6f6e  5 file, using on
-0000f8c0: 6c79 0a20 2020 2020 2020 2020 2020 2020  ly.             
-0000f8d0: 206e 6574 4344 4620 3320 636f 6d70 6174   netCDF 3 compat
-0000f8e0: 6962 6c65 2041 5049 2066 6561 7475 7265  ible API feature
-0000f8f0: 732e 0a20 2020 2020 2020 2020 2020 202a  s..            *
-0000f900: 204e 4554 4344 4633 5f36 3442 4954 3a20   NETCDF3_64BIT: 
-0000f910: 3634 2d62 6974 206f 6666 7365 7420 7665  64-bit offset ve
-0000f920: 7273 696f 6e20 6f66 2074 6865 206e 6574  rsion of the net
-0000f930: 4344 4620 3320 6669 6c65 2066 6f72 6d61  CDF 3 file forma
-0000f940: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0000f950: 2077 6869 6368 2066 756c 6c79 2073 7570   which fully sup
-0000f960: 706f 7274 7320 322b 2047 4220 6669 6c65  ports 2+ GB file
-0000f970: 732c 2062 7574 2069 7320 6f6e 6c79 2063  s, but is only c
-0000f980: 6f6d 7061 7469 626c 6520 7769 7468 0a20  ompatible with. 
-0000f990: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
-0000f9a0: 656e 7473 206c 696e 6b65 6420 6167 6169  ents linked agai
-0000f9b0: 6e73 7420 6e65 7443 4446 2076 6572 7369  nst netCDF versi
-0000f9c0: 6f6e 2033 2e36 2e30 206f 7220 6c61 7465  on 3.6.0 or late
-0000f9d0: 722e 0a20 2020 2020 2020 2020 2020 202a  r..            *
-0000f9e0: 204e 4554 4344 4633 5f43 4c41 5353 4943   NETCDF3_CLASSIC
-0000f9f0: 3a20 5468 6520 636c 6173 7369 6320 6e65  : The classic ne
-0000fa00: 7443 4446 2033 2066 696c 6520 666f 726d  tCDF 3 file form
-0000fa10: 6174 2e20 4974 2064 6f65 7320 6e6f 740a  at. It does not.
-0000fa20: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-0000fa30: 6e64 6c65 2032 2b20 4742 2066 696c 6573  ndle 2+ GB files
-0000fa40: 2076 6572 7920 7765 6c6c 2e0a 0a20 2020   very well...   
-0000fa50: 2020 2020 2020 2020 2041 6c6c 2066 6f72           All for
-0000fa60: 6d61 7473 2061 7265 2073 7570 706f 7274  mats are support
-0000fa70: 6564 2062 7920 7468 6520 6e65 7443 4446  ed by the netCDF
-0000fa80: 342d 7079 7468 6f6e 206c 6962 7261 7279  4-python library
-0000fa90: 2e0a 2020 2020 2020 2020 2020 2020 7363  ..            sc
-0000faa0: 6970 792e 696f 2e6e 6574 6364 6620 6f6e  ipy.io.netcdf on
-0000fab0: 6c79 2073 7570 706f 7274 7320 7468 6520  ly supports the 
-0000fac0: 6c61 7374 2074 776f 2066 6f72 6d61 7473  last two formats
-0000fad0: 2e0a 0a20 2020 2020 2020 2020 2020 2054  ...            T
-0000fae0: 6865 2064 6566 6175 6c74 2066 6f72 6d61  he default forma
-0000faf0: 7420 6973 204e 4554 4344 4634 2069 6620  t is NETCDF4 if 
-0000fb00: 796f 7520 6172 6520 7361 7669 6e67 2061  you are saving a
-0000fb10: 2066 696c 6520 746f 2064 6973 6b20 616e   file to disk an
-0000fb20: 640a 2020 2020 2020 2020 2020 2020 6861  d.            ha
-0000fb30: 7665 2074 6865 206e 6574 4344 4634 2d70  ve the netCDF4-p
-0000fb40: 7974 686f 6e20 6c69 6272 6172 7920 6176  ython library av
-0000fb50: 6169 6c61 626c 652e 204f 7468 6572 7769  ailable. Otherwi
-0000fb60: 7365 2c20 7861 7272 6179 2066 616c 6c73  se, xarray falls
-0000fb70: 0a20 2020 2020 2020 2020 2020 2062 6163  .            bac
-0000fb80: 6b20 746f 2075 7369 6e67 2073 6369 7079  k to using scipy
-0000fb90: 2074 6f20 7772 6974 6520 6e65 7443 4446   to write netCDF
-0000fba0: 2066 696c 6573 2061 6e64 2064 6566 6175   files and defau
-0000fbb0: 6c74 7320 746f 2074 6865 0a20 2020 2020  lts to the.     
-0000fbc0: 2020 2020 2020 204e 4554 4344 4633 5f36         NETCDF3_6
-0000fbd0: 3442 4954 2066 6f72 6d61 7420 2873 6369  4BIT format (sci
-0000fbe0: 7079 2064 6f65 7320 6e6f 7420 7375 7070  py does not supp
-0000fbf0: 6f72 7420 6e65 7443 4446 3429 2e0a 2020  ort netCDF4)..  
-0000fc00: 2020 2020 2020 6772 6f75 7020 3a20 7374        group : st
-0000fc10: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
-0000fc20: 2020 2020 2020 2020 5061 7468 2074 6f20          Path to 
-0000fc30: 7468 6520 6e65 7443 4446 3420 6772 6f75  the netCDF4 grou
-0000fc40: 7020 696e 2074 6865 2067 6976 656e 2066  p in the given f
-0000fc50: 696c 6520 746f 206f 7065 6e20 286f 6e6c  ile to open (onl
-0000fc60: 7920 776f 726b 7320 666f 720a 2020 2020  y works for.    
-0000fc70: 2020 2020 2020 2020 666f 726d 6174 3d27          format='
-0000fc80: 4e45 5443 4446 3427 292e 2054 6865 2067  NETCDF4'). The g
-0000fc90: 726f 7570 2873 2920 7769 6c6c 2062 6520  roup(s) will be 
-0000fca0: 6372 6561 7465 6420 6966 206e 6563 6573  created if neces
-0000fcb0: 7361 7279 2e0a 2020 2020 2020 2020 656e  sary..        en
-0000fcc0: 6769 6e65 203a 207b 226e 6574 6364 6634  gine : {"netcdf4
-0000fcd0: 222c 2022 7363 6970 7922 2c20 2268 356e  ", "scipy", "h5n
-0000fce0: 6574 6364 6622 7d2c 206f 7074 696f 6e61  etcdf"}, optiona
-0000fcf0: 6c0a 2020 2020 2020 2020 2020 2020 456e  l.            En
-0000fd00: 6769 6e65 2074 6f20 7573 6520 7768 656e  gine to use when
-0000fd10: 2077 7269 7469 6e67 206e 6574 4344 4620   writing netCDF 
-0000fd20: 6669 6c65 732e 2049 6620 6e6f 7420 7072  files. If not pr
-0000fd30: 6f76 6964 6564 2c20 7468 650a 2020 2020  ovided, the.    
-0000fd40: 2020 2020 2020 2020 6465 6661 756c 7420          default 
-0000fd50: 656e 6769 6e65 2069 7320 6368 6f73 656e  engine is chosen
-0000fd60: 2062 6173 6564 206f 6e20 6176 6169 6c61   based on availa
-0000fd70: 626c 6520 6465 7065 6e64 656e 6369 6573  ble dependencies
-0000fd80: 2c20 7769 7468 2061 0a20 2020 2020 2020  , with a.       
-0000fd90: 2020 2020 2070 7265 6665 7265 6e63 6520       preference 
-0000fda0: 666f 7220 276e 6574 6364 6634 2720 6966  for 'netcdf4' if
-0000fdb0: 2077 7269 7469 6e67 2074 6f20 6120 6669   writing to a fi
-0000fdc0: 6c65 206f 6e20 6469 736b 2e0a 2020 2020  le on disk..    
-0000fdd0: 2020 2020 656e 636f 6469 6e67 203a 2064      encoding : d
-0000fde0: 6963 742c 206f 7074 696f 6e61 6c0a 2020  ict, optional.  
-0000fdf0: 2020 2020 2020 2020 2020 4e65 7374 6564            Nested
-0000fe00: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
-0000fe10: 2076 6172 6961 626c 6520 6e61 6d65 7320   variable names 
-0000fe20: 6173 206b 6579 7320 616e 6420 6469 6374  as keys and dict
-0000fe30: 696f 6e61 7269 6573 206f 660a 2020 2020  ionaries of.    
-0000fe40: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0000fe50: 2073 7065 6369 6669 6320 656e 636f 6469   specific encodi
-0000fe60: 6e67 7320 6173 2076 616c 7565 732c 2065  ngs as values, e
-0000fe70: 2e67 2e2c 0a20 2020 2020 2020 2020 2020  .g.,.           
-0000fe80: 2060 607b 226d 795f 7661 7269 6162 6c65   ``{"my_variable
-0000fe90: 223a 207b 2264 7479 7065 223a 2022 696e  ": {"dtype": "in
-0000fea0: 7431 3622 2c20 2273 6361 6c65 5f66 6163  t16", "scale_fac
-0000feb0: 746f 7222 3a20 302e 312c 0a20 2020 2020  tor": 0.1,.     
-0000fec0: 2020 2020 2020 2022 7a6c 6962 223a 2054         "zlib": T
-0000fed0: 7275 657d 2c20 2e2e 2e7d 6060 0a0a 2020  rue}, ...}``..  
-0000fee0: 2020 2020 2020 2020 2020 5468 6520 6068            The `h
-0000fef0: 356e 6574 6364 6660 2065 6e67 696e 6520  5netcdf` engine 
-0000ff00: 7375 7070 6f72 7473 2062 6f74 6820 7468  supports both th
-0000ff10: 6520 4e65 7443 4446 342d 7374 796c 6520  e NetCDF4-style 
-0000ff20: 636f 6d70 7265 7373 696f 6e0a 2020 2020  compression.    
-0000ff30: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
-0000ff40: 2070 6172 616d 6574 6572 7320 6060 7b22   parameters ``{"
-0000ff50: 7a6c 6962 223a 2054 7275 652c 2022 636f  zlib": True, "co
-0000ff60: 6d70 6c65 7665 6c22 3a20 397d 6060 2061  mplevel": 9}`` a
-0000ff70: 6e64 2074 6865 2068 3570 790a 2020 2020  nd the h5py.    
-0000ff80: 2020 2020 2020 2020 6f6e 6573 2060 607b          ones ``{
-0000ff90: 2263 6f6d 7072 6573 7369 6f6e 223a 2022  "compression": "
-0000ffa0: 677a 6970 222c 2022 636f 6d70 7265 7373  gzip", "compress
-0000ffb0: 696f 6e5f 6f70 7473 223a 2039 7d60 602e  ion_opts": 9}``.
-0000ffc0: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
-0000ffd0: 7320 616c 6c6f 7773 2075 7369 6e67 2061  s allows using a
-0000ffe0: 6e79 2063 6f6d 7072 6573 7369 6f6e 2070  ny compression p
-0000fff0: 6c75 6769 6e20 696e 7374 616c 6c65 6420  lugin installed 
-00010000: 696e 2074 6865 2048 4446 350a 2020 2020  in the HDF5.    
-00010010: 2020 2020 2020 2020 6c69 6272 6172 792c          library,
-00010020: 2065 2e67 2e20 4c5a 462e 0a0a 2020 2020   e.g. LZF...    
-00010030: 2020 2020 756e 6c69 6d69 7465 645f 6469      unlimited_di
-00010040: 6d73 203a 2069 7465 7261 626c 6520 6f66  ms : iterable of
-00010050: 2068 6173 6861 626c 652c 206f 7074 696f   hashable, optio
-00010060: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00010070: 4469 6d65 6e73 696f 6e28 7329 2074 6861  Dimension(s) tha
-00010080: 7420 7368 6f75 6c64 2062 6520 7365 7269  t should be seri
-00010090: 616c 697a 6564 2061 7320 756e 6c69 6d69  alized as unlimi
-000100a0: 7465 6420 6469 6d65 6e73 696f 6e73 2e0a  ted dimensions..
-000100b0: 2020 2020 2020 2020 2020 2020 4279 2064              By d
-000100c0: 6566 6175 6c74 2c20 6e6f 2064 696d 656e  efault, no dimen
-000100d0: 7369 6f6e 7320 6172 6520 7472 6561 7465  sions are treate
-000100e0: 6420 6173 2075 6e6c 696d 6974 6564 2064  d as unlimited d
-000100f0: 696d 656e 7369 6f6e 732e 0a20 2020 2020  imensions..     
-00010100: 2020 2020 2020 204e 6f74 6520 7468 6174         Note that
-00010110: 2075 6e6c 696d 6974 6564 5f64 696d 7320   unlimited_dims 
-00010120: 6d61 7920 616c 736f 2062 6520 7365 7420  may also be set 
-00010130: 7669 610a 2020 2020 2020 2020 2020 2020  via.            
-00010140: 6060 6461 7461 7365 742e 656e 636f 6469  ``dataset.encodi
-00010150: 6e67 5b22 756e 6c69 6d69 7465 645f 6469  ng["unlimited_di
-00010160: 6d73 225d 6060 2e0a 2020 2020 2020 2020  ms"]``..        
-00010170: 636f 6d70 7574 653a 2062 6f6f 6c2c 2064  compute: bool, d
-00010180: 6566 6175 6c74 3a20 5472 7565 0a20 2020  efault: True.   
-00010190: 2020 2020 2020 2020 2049 6620 7472 7565           If true
-000101a0: 2063 6f6d 7075 7465 2069 6d6d 6564 6961   compute immedia
-000101b0: 7465 6c79 2c20 6f74 6865 7277 6973 6520  tely, otherwise 
-000101c0: 7265 7475 726e 2061 0a20 2020 2020 2020  return a.       
-000101d0: 2020 2020 2060 6064 6173 6b2e 6465 6c61       ``dask.dela
-000101e0: 7965 642e 4465 6c61 7965 6460 6020 6f62  yed.Delayed`` ob
-000101f0: 6a65 6374 2074 6861 7420 6361 6e20 6265  ject that can be
-00010200: 2063 6f6d 7075 7465 6420 6c61 7465 722e   computed later.
-00010210: 0a20 2020 2020 2020 2069 6e76 616c 6964  .        invalid
-00010220: 5f6e 6574 6364 663a 2062 6f6f 6c2c 2064  _netcdf: bool, d
-00010230: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
-00010240: 2020 2020 2020 2020 2020 4f6e 6c79 2076            Only v
-00010250: 616c 6964 2061 6c6f 6e67 2077 6974 6820  alid along with 
-00010260: 6060 656e 6769 6e65 3d22 6835 6e65 7463  ``engine="h5netc
-00010270: 6466 2260 602e 2049 6620 5472 7565 2c20  df"``. If True, 
-00010280: 616c 6c6f 7720 7772 6974 696e 670a 2020  allow writing.  
-00010290: 2020 2020 2020 2020 2020 6864 6635 2066            hdf5 f
-000102a0: 696c 6573 2077 6869 6368 2061 7265 2069  iles which are i
-000102b0: 6e76 616c 6964 206e 6574 6364 6620 6173  nvalid netcdf as
-000102c0: 2064 6573 6372 6962 6564 2069 6e0a 2020   described in.  
-000102d0: 2020 2020 2020 2020 2020 6874 7470 733a            https:
-000102e0: 2f2f 6769 7468 7562 2e63 6f6d 2f68 356e  //github.com/h5n
-000102f0: 6574 6364 662f 6835 6e65 7463 6466 2e0a  etcdf/h5netcdf..
-00010300: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00010310: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00010320: 0a20 2020 2020 2020 2020 2020 202a 2060  .            * `
-00010330: 6062 7974 6573 6060 2069 6620 7061 7468  `bytes`` if path
-00010340: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
-00010350: 2020 2020 202a 2060 6064 6173 6b2e 6465       * ``dask.de
-00010360: 6c61 7965 642e 4465 6c61 7965 6460 6020  layed.Delayed`` 
-00010370: 6966 2063 6f6d 7075 7465 2069 7320 4661  if compute is Fa
-00010380: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00010390: 2a20 4e6f 6e65 206f 7468 6572 7769 7365  * None otherwise
-000103a0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-000103b0: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-000103c0: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
-000103d0: 4172 7261 792e 746f 5f6e 6574 6364 660a  Array.to_netcdf.
-000103e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000103f0: 2020 2020 6966 2065 6e63 6f64 696e 6720      if encoding 
-00010400: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00010410: 2020 2020 2065 6e63 6f64 696e 6720 3d20       encoding = 
-00010420: 7b7d 0a20 2020 2020 2020 2066 726f 6d20  {}.        from 
-00010430: 7861 7272 6179 2e62 6163 6b65 6e64 732e  xarray.backends.
-00010440: 6170 6920 696d 706f 7274 2074 6f5f 6e65  api import to_ne
-00010450: 7463 6466 0a0a 2020 2020 2020 2020 7265  tcdf..        re
-00010460: 7475 726e 2074 6f5f 6e65 7463 6466 2820  turn to_netcdf( 
-00010470: 2023 2074 7970 653a 2069 676e 6f72 6520   # type: ignore 
-00010480: 2023 206d 7970 7920 6361 6e6e 6f74 2072   # mypy cannot r
-00010490: 6573 6f6c 7665 2074 6865 206f 7665 726c  esolve the overl
-000104a0: 6f61 6473 3a28 0a20 2020 2020 2020 2020  oads:(.         
-000104b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000104c0: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
-000104d0: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
-000104e0: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
-000104f0: 726d 6174 3d66 6f72 6d61 742c 0a20 2020  rmat=format,.   
-00010500: 2020 2020 2020 2020 2067 726f 7570 3d67           group=g
-00010510: 726f 7570 2c0a 2020 2020 2020 2020 2020  roup,.          
-00010520: 2020 656e 6769 6e65 3d65 6e67 696e 652c    engine=engine,
-00010530: 0a20 2020 2020 2020 2020 2020 2065 6e63  .            enc
-00010540: 6f64 696e 673d 656e 636f 6469 6e67 2c0a  oding=encoding,.
-00010550: 2020 2020 2020 2020 2020 2020 756e 6c69              unli
-00010560: 6d69 7465 645f 6469 6d73 3d75 6e6c 696d  mited_dims=unlim
-00010570: 6974 6564 5f64 696d 732c 0a20 2020 2020  ited_dims,.     
-00010580: 2020 2020 2020 2063 6f6d 7075 7465 3d63         compute=c
-00010590: 6f6d 7075 7465 2c0a 2020 2020 2020 2020  ompute,.        
-000105a0: 2020 2020 6d75 6c74 6966 696c 653d 4661      multifile=Fa
-000105b0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-000105c0: 2069 6e76 616c 6964 5f6e 6574 6364 663d   invalid_netcdf=
-000105d0: 696e 7661 6c69 645f 6e65 7463 6466 2c0a  invalid_netcdf,.
-000105e0: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
-000105f0: 2063 6f6d 7075 7465 3d54 7275 6520 2864   compute=True (d
-00010600: 6566 6175 6c74 2920 7265 7475 726e 7320  efault) returns 
-00010610: 5a61 7272 5374 6f72 650a 2020 2020 406f  ZarrStore.    @o
-00010620: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
-00010630: 746f 5f7a 6172 7228 0a20 2020 2020 2020  to_zarr(.       
-00010640: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
-00010650: 746f 7265 3a20 4d75 7461 626c 654d 6170  tore: MutableMap
-00010660: 7069 6e67 207c 2073 7472 207c 2050 6174  ping | str | Pat
-00010670: 684c 696b 655b 7374 725d 207c 204e 6f6e  hLike[str] | Non
-00010680: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00010690: 2020 6368 756e 6b5f 7374 6f72 653a 204d    chunk_store: M
-000106a0: 7574 6162 6c65 4d61 7070 696e 6720 7c20  utableMapping | 
-000106b0: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
-000106c0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-000106d0: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
-000106e0: 7261 6c5b 2277 222c 2022 772d 222c 2022  ral["w", "w-", "
-000106f0: 6122 2c20 2272 2b22 2c20 4e6f 6e65 5d20  a", "r+", None] 
-00010700: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00010710: 7379 6e63 6872 6f6e 697a 6572 3d4e 6f6e  synchronizer=Non
-00010720: 652c 0a20 2020 2020 2020 2067 726f 7570  e,.        group
-00010730: 3a20 7374 7220 7c20 4e6f 6e65 203d 204e  : str | None = N
-00010740: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
-00010750: 6f64 696e 673a 204d 6170 7069 6e67 207c  oding: Mapping |
-00010760: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00010770: 2020 2020 2020 636f 6d70 7574 653a 204c        compute: L
-00010780: 6974 6572 616c 5b54 7275 655d 203d 2054  iteral[True] = T
-00010790: 7275 652c 0a20 2020 2020 2020 2063 6f6e  rue,.        con
-000107a0: 736f 6c69 6461 7465 643a 2062 6f6f 6c20  solidated: bool 
-000107b0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-000107c0: 2020 2020 2020 2061 7070 656e 645f 6469         append_di
-000107d0: 6d3a 2048 6173 6861 626c 6520 7c20 4e6f  m: Hashable | No
-000107e0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-000107f0: 2020 2072 6567 696f 6e3a 204d 6170 7069     region: Mappi
-00010800: 6e67 5b73 7472 2c20 736c 6963 655d 207c  ng[str, slice] |
-00010810: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00010820: 2020 2020 2020 7361 6665 5f63 6875 6e6b        safe_chunk
-00010830: 733a 2062 6f6f 6c20 3d20 5472 7565 2c0a  s: bool = True,.
-00010840: 2020 2020 2020 2020 7374 6f72 6167 655f          storage_
-00010850: 6f70 7469 6f6e 733a 2064 6963 745b 7374  options: dict[st
-00010860: 722c 2073 7472 5d20 7c20 4e6f 6e65 203d  r, str] | None =
-00010870: 204e 6f6e 652c 0a20 2020 2020 2020 207a   None,.        z
-00010880: 6172 725f 7665 7273 696f 6e3a 2069 6e74  arr_version: int
-00010890: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000108a0: 2020 2020 2920 2d3e 205a 6172 7253 746f      ) -> ZarrSto
-000108b0: 7265 3a0a 2020 2020 2020 2020 2e2e 2e0a  re:.        ....
-000108c0: 0a20 2020 2023 2063 6f6d 7075 7465 3d46  .    # compute=F
-000108d0: 616c 7365 2072 6574 7572 6e73 2064 6173  alse returns das
-000108e0: 6b2e 4465 6c61 7965 640a 2020 2020 406f  k.Delayed.    @o
-000108f0: 7665 726c 6f61 640a 2020 2020 6465 6620  verload.    def 
-00010900: 746f 5f7a 6172 7228 0a20 2020 2020 2020  to_zarr(.       
-00010910: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
-00010920: 746f 7265 3a20 4d75 7461 626c 654d 6170  tore: MutableMap
-00010930: 7069 6e67 207c 2073 7472 207c 2050 6174  ping | str | Pat
-00010940: 684c 696b 655b 7374 725d 207c 204e 6f6e  hLike[str] | Non
-00010950: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00010960: 2020 6368 756e 6b5f 7374 6f72 653a 204d    chunk_store: M
-00010970: 7574 6162 6c65 4d61 7070 696e 6720 7c20  utableMapping | 
-00010980: 7374 7220 7c20 5061 7468 4c69 6b65 207c  str | PathLike |
-00010990: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-000109a0: 2020 2020 2020 6d6f 6465 3a20 4c69 7465        mode: Lite
-000109b0: 7261 6c5b 2277 222c 2022 772d 222c 2022  ral["w", "w-", "
-000109c0: 6122 2c20 2272 2b22 2c20 4e6f 6e65 5d20  a", "r+", None] 
-000109d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000109e0: 7379 6e63 6872 6f6e 697a 6572 3d4e 6f6e  synchronizer=Non
-000109f0: 652c 0a20 2020 2020 2020 2067 726f 7570  e,.        group
-00010a00: 3a20 7374 7220 7c20 4e6f 6e65 203d 204e  : str | None = N
-00010a10: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
-00010a20: 6f64 696e 673a 204d 6170 7069 6e67 207c  oding: Mapping |
-00010a30: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00010a40: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
-00010a50: 2063 6f6d 7075 7465 3a20 4c69 7465 7261   compute: Litera
-00010a60: 6c5b 4661 6c73 655d 2c0a 2020 2020 2020  l[False],.      
-00010a70: 2020 636f 6e73 6f6c 6964 6174 6564 3a20    consolidated: 
-00010a80: 626f 6f6c 207c 204e 6f6e 6520 3d20 4e6f  bool | None = No
-00010a90: 6e65 2c0a 2020 2020 2020 2020 6170 7065  ne,.        appe
-00010aa0: 6e64 5f64 696d 3a20 4861 7368 6162 6c65  nd_dim: Hashable
-00010ab0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00010ac0: 2020 2020 2020 2020 7265 6769 6f6e 3a20          region: 
-00010ad0: 4d61 7070 696e 675b 7374 722c 2073 6c69  Mapping[str, sli
-00010ae0: 6365 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ce] | None = Non
-00010af0: 652c 0a20 2020 2020 2020 2073 6166 655f  e,.        safe_
-00010b00: 6368 756e 6b73 3a20 626f 6f6c 203d 2054  chunks: bool = T
-00010b10: 7275 652c 0a20 2020 2020 2020 2073 746f  rue,.        sto
-00010b20: 7261 6765 5f6f 7074 696f 6e73 3a20 6469  rage_options: di
-00010b30: 6374 5b73 7472 2c20 7374 725d 207c 204e  ct[str, str] | N
-00010b40: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00010b50: 2020 2020 7a61 7272 5f76 6572 7369 6f6e      zarr_version
-00010b60: 3a20 696e 7420 7c20 4e6f 6e65 203d 204e  : int | None = N
-00010b70: 6f6e 652c 0a20 2020 2029 202d 3e20 4465  one,.    ) -> De
-00010b80: 6c61 7965 643a 0a20 2020 2020 2020 202e  layed:.        .
-00010b90: 2e2e 0a0a 2020 2020 6465 6620 746f 5f7a  ....    def to_z
-00010ba0: 6172 7228 0a20 2020 2020 2020 2073 656c  arr(.        sel
-00010bb0: 662c 0a20 2020 2020 2020 2073 746f 7265  f,.        store
-00010bc0: 3a20 4d75 7461 626c 654d 6170 7069 6e67  : MutableMapping
-00010bd0: 207c 2073 7472 207c 2050 6174 684c 696b   | str | PathLik
-00010be0: 655b 7374 725d 207c 204e 6f6e 6520 3d20  e[str] | None = 
-00010bf0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6368  None,.        ch
-00010c00: 756e 6b5f 7374 6f72 653a 204d 7574 6162  unk_store: Mutab
-00010c10: 6c65 4d61 7070 696e 6720 7c20 7374 7220  leMapping | str 
-00010c20: 7c20 5061 7468 4c69 6b65 207c 204e 6f6e  | PathLike | Non
-00010c30: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00010c40: 2020 6d6f 6465 3a20 4c69 7465 7261 6c5b    mode: Literal[
-00010c50: 2277 222c 2022 772d 222c 2022 6122 2c20  "w", "w-", "a", 
-00010c60: 2272 2b22 2c20 4e6f 6e65 5d20 3d20 4e6f  "r+", None] = No
-00010c70: 6e65 2c0a 2020 2020 2020 2020 7379 6e63  ne,.        sync
-00010c80: 6872 6f6e 697a 6572 3d4e 6f6e 652c 0a20  hronizer=None,. 
-00010c90: 2020 2020 2020 2067 726f 7570 3a20 7374         group: st
-00010ca0: 7220 7c20 4e6f 6e65 203d 204e 6f6e 652c  r | None = None,
-00010cb0: 0a20 2020 2020 2020 2065 6e63 6f64 696e  .        encodin
-00010cc0: 673a 204d 6170 7069 6e67 207c 204e 6f6e  g: Mapping | Non
-00010cd0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00010ce0: 2020 636f 6d70 7574 653a 2062 6f6f 6c20    compute: bool 
-00010cf0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-00010d00: 636f 6e73 6f6c 6964 6174 6564 3a20 626f  consolidated: bo
-00010d10: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
-00010d20: 2c0a 2020 2020 2020 2020 6170 7065 6e64  ,.        append
-00010d30: 5f64 696d 3a20 4861 7368 6162 6c65 207c  _dim: Hashable |
+0000d280: 2020 2066 2256 6172 6961 626c 6520 277b     f"Variable '{
+0000d290: 6e61 6d65 7d27 3a20 696e 6465 7865 7220  name}': indexer 
+0000d2a0: 7b6b 6579 7d20 6e6f 7420 6176 6169 6c61  {key} not availa
+0000d2b0: 626c 6522 0a20 2020 2020 2020 2020 2020  ble".           
+0000d2c0: 2020 2020 2029 2066 726f 6d20 650a 0a20       ) from e.. 
+0000d2d0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0000d2e0: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
+0000d2f0: 4461 7461 7365 7429 3a0a 2020 2020 2020  Dataset):.      
+0000d300: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
+0000d310: 7661 6c75 655b 6e61 6d65 5d0a 2020 2020  value[name].    
+0000d320: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000d330: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000d340: 6c20 3d20 7661 6c75 650a 0a20 2020 2020  l = value..     
+0000d350: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000d360: 616e 6365 2876 616c 2c20 4461 7461 4172  ance(val, DataAr
+0000d370: 7261 7929 3a0a 2020 2020 2020 2020 2020  ray):.          
+0000d380: 2020 2020 2020 2320 6368 6563 6b20 636f        # check co
+0000d390: 6e73 6973 7465 6e63 7920 6f66 2064 696d  nsistency of dim
+0000d3a0: 656e 7369 6f6e 730a 2020 2020 2020 2020  ensions.        
+0000d3b0: 2020 2020 2020 2020 666f 7220 6469 6d20          for dim 
+0000d3c0: 696e 2076 616c 2e64 696d 733a 0a20 2020  in val.dims:.   
+0000d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3e0: 2069 6620 6469 6d20 6e6f 7420 696e 2076   if dim not in v
+0000d3f0: 6172 5f6b 2e64 696d 733a 0a20 2020 2020  ar_k.dims:.     
+0000d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d410: 2020 2072 6169 7365 204b 6579 4572 726f     raise KeyErro
+0000d420: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000d430: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000d440: 2256 6172 6961 626c 6520 277b 6e61 6d65  "Variable '{name
+0000d450: 7d27 3a20 6469 6d65 6e73 696f 6e20 277b  }': dimension '{
+0000d460: 6469 6d7d 2720 6170 7065 6172 7320 696e  dim}' appears in
+0000d470: 206e 6577 2076 616c 7565 7320 220a 2020   new values ".  
+0000d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d490: 2020 2020 2020 2020 2020 6622 6275 7420            f"but 
+0000d4a0: 6e6f 7420 696e 2074 6865 2069 6e64 6578  not in the index
+0000d4b0: 6564 206f 7269 6769 6e61 6c20 6461 7461  ed original data
+0000d4c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000d4d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d4e0: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
+0000d4f0: 203d 2074 7570 6c65 2864 696d 2066 6f72   = tuple(dim for
+0000d500: 2064 696d 2069 6e20 7661 725f 6b2e 6469   dim in var_k.di
+0000d510: 6d73 2069 6620 6469 6d20 696e 2076 616c  ms if dim in val
+0000d520: 2e64 696d 7329 0a20 2020 2020 2020 2020  .dims).         
+0000d530: 2020 2020 2020 2069 6620 6469 6d73 2021         if dims !
+0000d540: 3d20 7661 6c2e 6469 6d73 3a0a 2020 2020  = val.dims:.    
+0000d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d560: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0000d570: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d580: 2020 2020 2020 2020 2020 6622 5661 7269            f"Vari
+0000d590: 6162 6c65 2027 7b6e 616d 657d 273a 2064  able '{name}': d
+0000d5a0: 696d 656e 7369 6f6e 206f 7264 6572 2064  imension order d
+0000d5b0: 6966 6665 7273 2062 6574 7765 656e 220a  iffers between".
+0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5d0: 2020 2020 2020 2020 6622 206f 7269 6769          f" origi
+0000d5e0: 6e61 6c20 616e 6420 6e65 7720 6461 7461  nal and new data
+0000d5f0: 3a5c 6e7b 6469 6d73 7d5c 6e76 732e 5c6e  :\n{dims}\nvs.\n
+0000d600: 7b76 616c 2e64 696d 737d 220a 2020 2020  {val.dims}".    
+0000d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d620: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000d630: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d640: 2020 2020 7661 6c20 3d20 6e70 2e61 7272      val = np.arr
+0000d650: 6179 2876 616c 290a 0a20 2020 2020 2020  ay(val)..       
+0000d660: 2020 2020 2023 2074 7970 6520 636f 6e76       # type conv
+0000d670: 6572 7369 6f6e 0a20 2020 2020 2020 2020  ersion.         
+0000d680: 2020 206e 6577 5f76 616c 7565 5b6e 616d     new_value[nam
+0000d690: 655d 203d 2064 7563 6b5f 6172 7261 795f  e] = duck_array_
+0000d6a0: 6f70 732e 6173 7479 7065 2876 616c 2c20  ops.astype(val, 
+0000d6b0: 6474 7970 653d 7661 725f 6b2e 6474 7970  dtype=var_k.dtyp
+0000d6c0: 652c 2063 6f70 793d 4661 6c73 6529 0a0a  e, copy=False)..
+0000d6d0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+0000d6e0: 636f 6e73 6973 7465 6e63 7920 6f66 2064  consistency of d
+0000d6f0: 696d 656e 7369 6f6e 2073 697a 6573 2061  imension sizes a
+0000d700: 6e64 2064 696d 656e 7369 6f6e 2063 6f6f  nd dimension coo
+0000d710: 7264 696e 6174 6573 0a20 2020 2020 2020  rdinates.       
+0000d720: 2069 6620 6973 696e 7374 616e 6365 2876   if isinstance(v
+0000d730: 616c 7565 2c20 4461 7461 4172 7261 7929  alue, DataArray)
+0000d740: 206f 7220 6973 696e 7374 616e 6365 2876   or isinstance(v
+0000d750: 616c 7565 2c20 4461 7461 7365 7429 3a0a  alue, Dataset):.
+0000d760: 2020 2020 2020 2020 2020 2020 616c 6967              alig
+0000d770: 6e28 7365 6c66 5b6b 6579 5d2c 2076 616c  n(self[key], val
+0000d780: 7565 2c20 6a6f 696e 3d22 6578 6163 7422  ue, join="exact"
+0000d790: 2c20 636f 7079 3d46 616c 7365 290a 0a20  , copy=False).. 
+0000d7a0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
+0000d7b0: 775f 7661 6c75 650a 0a20 2020 2064 6566  w_value..    def
+0000d7c0: 205f 5f64 656c 6974 656d 5f5f 2873 656c   __delitem__(sel
+0000d7d0: 662c 206b 6579 3a20 4861 7368 6162 6c65  f, key: Hashable
+0000d7e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000d7f0: 2020 2022 2222 5265 6d6f 7665 2061 2076     """Remove a v
+0000d800: 6172 6961 626c 6520 6672 6f6d 2074 6869  ariable from thi
+0000d810: 7320 6461 7461 7365 742e 2222 220a 2020  s dataset.""".  
+0000d820: 2020 2020 2020 6173 7365 7274 5f6e 6f5f        assert_no_
+0000d830: 696e 6465 785f 636f 7272 7570 7465 6428  index_corrupted(
+0000d840: 7365 6c66 2e78 696e 6465 7865 732c 207b  self.xindexes, {
+0000d850: 6b65 797d 290a 0a20 2020 2020 2020 2069  key})..        i
+0000d860: 6620 6b65 7920 696e 2073 656c 662e 5f69  f key in self._i
+0000d870: 6e64 6578 6573 3a0a 2020 2020 2020 2020  ndexes:.        
+0000d880: 2020 2020 6465 6c20 7365 6c66 2e5f 696e      del self._in
+0000d890: 6465 7865 735b 6b65 795d 0a20 2020 2020  dexes[key].     
+0000d8a0: 2020 2064 656c 2073 656c 662e 5f76 6172     del self._var
+0000d8b0: 6961 626c 6573 5b6b 6579 5d0a 2020 2020  iables[key].    
+0000d8c0: 2020 2020 7365 6c66 2e5f 636f 6f72 645f      self._coord_
+0000d8d0: 6e61 6d65 732e 6469 7363 6172 6428 6b65  names.discard(ke
+0000d8e0: 7929 0a20 2020 2020 2020 2073 656c 662e  y).        self.
+0000d8f0: 5f64 696d 7320 3d20 6361 6c63 756c 6174  _dims = calculat
+0000d900: 655f 6469 6d65 6e73 696f 6e73 2873 656c  e_dimensions(sel
+0000d910: 662e 5f76 6172 6961 626c 6573 290a 0a20  f._variables).. 
+0000d920: 2020 2023 206d 7574 6162 6c65 206f 626a     # mutable obj
+0000d930: 6563 7473 2073 686f 756c 6420 6e6f 7420  ects should not 
+0000d940: 6265 2068 6173 6861 626c 650a 2020 2020  be hashable.    
+0000d950: 2320 6874 7470 733a 2f2f 6769 7468 7562  # https://github
+0000d960: 2e63 6f6d 2f70 7974 686f 6e2f 6d79 7079  .com/python/mypy
+0000d970: 2f69 7373 7565 732f 3432 3636 0a20 2020  /issues/4266.   
+0000d980: 205f 5f68 6173 685f 5f20 3d20 4e6f 6e65   __hash__ = None
+0000d990: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
+0000d9a0: 5b61 7373 6967 6e6d 656e 745d 0a0a 2020  [assignment]..  
+0000d9b0: 2020 6465 6620 5f61 6c6c 5f63 6f6d 7061    def _all_compa
+0000d9c0: 7428 7365 6c66 2c20 6f74 6865 723a 2044  t(self, other: D
+0000d9d0: 6174 6173 6574 2c20 636f 6d70 6174 5f73  ataset, compat_s
+0000d9e0: 7472 3a20 7374 7229 202d 3e20 626f 6f6c  tr: str) -> bool
+0000d9f0: 3a0a 2020 2020 2020 2020 2222 2248 656c  :.        """Hel
+0000da00: 7065 7220 6675 6e63 7469 6f6e 2066 6f72  per function for
+0000da10: 2065 7175 616c 7320 616e 6420 6964 656e   equals and iden
+0000da20: 7469 6361 6c22 2222 0a0a 2020 2020 2020  tical"""..      
+0000da30: 2020 2320 736f 6d65 2073 746f 7265 7320    # some stores 
+0000da40: 2865 2e67 2e2c 2073 6369 7079 2920 646f  (e.g., scipy) do
+0000da50: 206e 6f74 2073 6565 6d20 746f 2070 7265   not seem to pre
+0000da60: 7365 7276 6520 6f72 6465 722c 2073 6f20  serve order, so 
+0000da70: 646f 6e27 740a 2020 2020 2020 2020 2320  don't.        # 
+0000da80: 7265 7175 6972 6520 6d61 7463 6869 6e67  require matching
+0000da90: 206f 7264 6572 2066 6f72 2065 7175 616c   order for equal
+0000daa0: 6974 790a 2020 2020 2020 2020 6465 6620  ity.        def 
+0000dab0: 636f 6d70 6174 2878 3a20 5661 7269 6162  compat(x: Variab
+0000dac0: 6c65 2c20 793a 2056 6172 6961 626c 6529  le, y: Variable)
+0000dad0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+0000dae0: 2020 2020 2020 7265 7475 726e 2067 6574        return get
+0000daf0: 6174 7472 2878 2c20 636f 6d70 6174 5f73  attr(x, compat_s
+0000db00: 7472 2928 7929 0a0a 2020 2020 2020 2020  tr)(y)..        
+0000db10: 7265 7475 726e 2073 656c 662e 5f63 6f6f  return self._coo
+0000db20: 7264 5f6e 616d 6573 203d 3d20 6f74 6865  rd_names == othe
+0000db30: 722e 5f63 6f6f 7264 5f6e 616d 6573 2061  r._coord_names a
+0000db40: 6e64 2075 7469 6c73 2e64 6963 745f 6571  nd utils.dict_eq
+0000db50: 7569 7628 0a20 2020 2020 2020 2020 2020  uiv(.           
+0000db60: 2073 656c 662e 5f76 6172 6961 626c 6573   self._variables
+0000db70: 2c20 6f74 6865 722e 5f76 6172 6961 626c  , other._variabl
+0000db80: 6573 2c20 636f 6d70 6174 3d63 6f6d 7061  es, compat=compa
+0000db90: 740a 2020 2020 2020 2020 290a 0a20 2020  t.        )..   
+0000dba0: 2064 6566 2062 726f 6164 6361 7374 5f65   def broadcast_e
+0000dbb0: 7175 616c 7328 7365 6c66 2c20 6f74 6865  quals(self, othe
+0000dbc0: 723a 2044 6174 6173 6574 2920 2d3e 2062  r: Dataset) -> b
+0000dbd0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+0000dbe0: 5477 6f20 4461 7461 7365 7473 2061 7265  Two Datasets are
+0000dbf0: 2062 726f 6164 6361 7374 2065 7175 616c   broadcast equal
+0000dc00: 2069 6620 7468 6579 2061 7265 2065 7175   if they are equ
+0000dc10: 616c 2061 6674 6572 0a20 2020 2020 2020  al after.       
+0000dc20: 2062 726f 6164 6361 7374 696e 6720 616c   broadcasting al
+0000dc30: 6c20 7661 7269 6162 6c65 7320 6167 6169  l variables agai
+0000dc40: 6e73 7420 6561 6368 206f 7468 6572 2e0a  nst each other..
+0000dc50: 0a20 2020 2020 2020 2046 6f72 2065 7861  .        For exa
+0000dc60: 6d70 6c65 2c20 7661 7269 6162 6c65 7320  mple, variables 
+0000dc70: 7468 6174 2061 7265 2073 6361 6c61 7220  that are scalar 
+0000dc80: 696e 206f 6e65 2064 6174 6173 6574 2062  in one dataset b
+0000dc90: 7574 206e 6f6e 2d73 6361 6c61 7220 696e  ut non-scalar in
+0000dca0: 0a20 2020 2020 2020 2074 6865 206f 7468  .        the oth
+0000dcb0: 6572 2064 6174 6173 6574 2063 616e 2073  er dataset can s
+0000dcc0: 7469 6c6c 2062 6520 6272 6f61 6463 6173  till be broadcas
+0000dcd0: 7420 6571 7561 6c20 6966 2074 6865 2074  t equal if the t
+0000dce0: 6865 206e 6f6e 2d73 6361 6c61 720a 2020  he non-scalar.  
+0000dcf0: 2020 2020 2020 7661 7269 6162 6c65 2069        variable i
+0000dd00: 7320 6120 636f 6e73 7461 6e74 2e0a 0a20  s a constant... 
+0000dd10: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+0000dd20: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000dd30: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+0000dd40: 2e65 7175 616c 730a 2020 2020 2020 2020  .equals.        
+0000dd50: 4461 7461 7365 742e 6964 656e 7469 6361  Dataset.identica
+0000dd60: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+0000dd70: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000dd80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000dd90: 6c66 2e5f 616c 6c5f 636f 6d70 6174 286f  lf._all_compat(o
+0000dda0: 7468 6572 2c20 2262 726f 6164 6361 7374  ther, "broadcast
+0000ddb0: 5f65 7175 616c 7322 290a 2020 2020 2020  _equals").      
+0000ddc0: 2020 6578 6365 7074 2028 5479 7065 4572    except (TypeEr
+0000ddd0: 726f 722c 2041 7474 7269 6275 7465 4572  ror, AttributeEr
+0000dde0: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
+0000ddf0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+0000de00: 2020 2020 6465 6620 6571 7561 6c73 2873      def equals(s
+0000de10: 656c 662c 206f 7468 6572 3a20 4461 7461  elf, other: Data
+0000de20: 7365 7429 202d 3e20 626f 6f6c 3a0a 2020  set) -> bool:.  
+0000de30: 2020 2020 2020 2222 2254 776f 2044 6174        """Two Dat
+0000de40: 6173 6574 7320 6172 6520 6571 7561 6c20  asets are equal 
+0000de50: 6966 2074 6865 7920 6861 7665 206d 6174  if they have mat
+0000de60: 6368 696e 6720 7661 7269 6162 6c65 7320  ching variables 
+0000de70: 616e 640a 2020 2020 2020 2020 636f 6f72  and.        coor
+0000de80: 6469 6e61 7465 732c 2061 6c6c 206f 6620  dinates, all of 
+0000de90: 7768 6963 6820 6172 6520 6571 7561 6c2e  which are equal.
+0000dea0: 0a0a 2020 2020 2020 2020 4461 7461 7365  ..        Datase
+0000deb0: 7473 2063 616e 2073 7469 6c6c 2062 6520  ts can still be 
+0000dec0: 6571 7561 6c20 286c 696b 6520 7061 6e64  equal (like pand
+0000ded0: 6173 206f 626a 6563 7473 2920 6966 2074  as objects) if t
+0000dee0: 6865 7920 6861 7665 204e 614e 0a20 2020  hey have NaN.   
+0000def0: 2020 2020 2076 616c 7565 7320 696e 2074       values in t
+0000df00: 6865 2073 616d 6520 6c6f 6361 7469 6f6e  he same location
+0000df10: 732e 0a0a 2020 2020 2020 2020 5468 6973  s...        This
+0000df20: 206d 6574 686f 6420 6973 206e 6563 6573   method is neces
+0000df30: 7361 7279 2062 6563 6175 7365 2060 7631  sary because `v1
+0000df40: 203d 3d20 7632 6020 666f 7220 6060 4461   == v2` for ``Da
+0000df50: 7461 7365 7460 600a 2020 2020 2020 2020  taset``.        
+0000df60: 646f 6573 2065 6c65 6d65 6e74 2d77 6973  does element-wis
+0000df70: 6520 636f 6d70 6172 6973 6f6e 7320 286c  e comparisons (l
+0000df80: 696b 6520 6e75 6d70 792e 6e64 6172 7261  ike numpy.ndarra
+0000df90: 7973 292e 0a0a 2020 2020 2020 2020 5365  ys)...        Se
+0000dfa0: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+0000dfb0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0000dfc0: 4461 7461 7365 742e 6272 6f61 6463 6173  Dataset.broadcas
+0000dfd0: 745f 6571 7561 6c73 0a20 2020 2020 2020  t_equals.       
+0000dfe0: 2044 6174 6173 6574 2e69 6465 6e74 6963   Dataset.identic
+0000dff0: 616c 0a20 2020 2020 2020 2022 2222 0a20  al.        """. 
+0000e000: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000e010: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000e020: 656c 662e 5f61 6c6c 5f63 6f6d 7061 7428  elf._all_compat(
+0000e030: 6f74 6865 722c 2022 6571 7561 6c73 2229  other, "equals")
+0000e040: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000e050: 2854 7970 6545 7272 6f72 2c20 4174 7472  (TypeError, Attr
+0000e060: 6962 7574 6545 7272 6f72 293a 0a20 2020  ibuteError):.   
+0000e070: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e080: 4661 6c73 650a 0a20 2020 2064 6566 2069  False..    def i
+0000e090: 6465 6e74 6963 616c 2873 656c 662c 206f  dentical(self, o
+0000e0a0: 7468 6572 3a20 4461 7461 7365 7429 202d  ther: Dataset) -
+0000e0b0: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
+0000e0c0: 2222 224c 696b 6520 6571 7561 6c73 2c20  """Like equals, 
+0000e0d0: 6275 7420 616c 736f 2063 6865 636b 7320  but also checks 
+0000e0e0: 616c 6c20 6461 7461 7365 7420 6174 7472  all dataset attr
+0000e0f0: 6962 7574 6573 2061 6e64 2074 6865 0a20  ibutes and the. 
+0000e100: 2020 2020 2020 2061 7474 7269 6275 7465         attribute
+0000e110: 7320 6f6e 2061 6c6c 2076 6172 6961 626c  s on all variabl
+0000e120: 6573 2061 6e64 2063 6f6f 7264 696e 6174  es and coordinat
+0000e130: 6573 2e0a 0a20 2020 2020 2020 2053 6565  es...        See
+0000e140: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+0000e150: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+0000e160: 6174 6173 6574 2e62 726f 6164 6361 7374  ataset.broadcast
+0000e170: 5f65 7175 616c 730a 2020 2020 2020 2020  _equals.        
+0000e180: 4461 7461 7365 742e 6571 7561 6c73 0a20  Dataset.equals. 
+0000e190: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000e1a0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000e1b0: 2020 2020 7265 7475 726e 2075 7469 6c73      return utils
+0000e1c0: 2e64 6963 745f 6571 7569 7628 7365 6c66  .dict_equiv(self
+0000e1d0: 2e61 7474 7273 2c20 6f74 6865 722e 6174  .attrs, other.at
+0000e1e0: 7472 7329 2061 6e64 2073 656c 662e 5f61  trs) and self._a
+0000e1f0: 6c6c 5f63 6f6d 7061 7428 0a20 2020 2020  ll_compat(.     
+0000e200: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0000e210: 2c20 2269 6465 6e74 6963 616c 220a 2020  , "identical".  
+0000e220: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000e230: 2020 2020 6578 6365 7074 2028 5479 7065      except (Type
+0000e240: 4572 726f 722c 2041 7474 7269 6275 7465  Error, Attribute
+0000e250: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+0000e260: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000e270: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+0000e280: 2020 2020 6465 6620 696e 6465 7865 7328      def indexes(
+0000e290: 7365 6c66 2920 2d3e 2049 6e64 6578 6573  self) -> Indexes
+0000e2a0: 5b70 642e 496e 6465 785d 3a0a 2020 2020  [pd.Index]:.    
+0000e2b0: 2020 2020 2222 224d 6170 7069 6e67 206f      """Mapping o
+0000e2c0: 6620 7061 6e64 6173 2e49 6e64 6578 206f  f pandas.Index o
+0000e2d0: 626a 6563 7473 2075 7365 6420 666f 7220  bjects used for 
+0000e2e0: 6c61 6265 6c20 6261 7365 6420 696e 6465  label based inde
+0000e2f0: 7869 6e67 2e0a 0a20 2020 2020 2020 2052  xing...        R
+0000e300: 6169 7365 7320 616e 2065 7272 6f72 2069  aises an error i
+0000e310: 6620 7468 6973 2044 6174 6173 6574 2068  f this Dataset h
+0000e320: 6173 2069 6e64 6578 6573 2074 6861 7420  as indexes that 
+0000e330: 6361 6e6e 6f74 2062 6520 636f 6572 6365  cannot be coerce
+0000e340: 640a 2020 2020 2020 2020 746f 2070 616e  d.        to pan
+0000e350: 6461 732e 496e 6465 7820 6f62 6a65 6374  das.Index object
+0000e360: 732e 0a0a 2020 2020 2020 2020 5365 6520  s...        See 
+0000e370: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+0000e380: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
+0000e390: 7461 7365 742e 7869 6e64 6578 6573 0a0a  taset.xindexes..
+0000e3a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e3b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000e3c0: 7869 6e64 6578 6573 2e74 6f5f 7061 6e64  xindexes.to_pand
+0000e3d0: 6173 5f69 6e64 6578 6573 2829 0a0a 2020  as_indexes()..  
+0000e3e0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+0000e3f0: 6465 6620 7869 6e64 6578 6573 2873 656c  def xindexes(sel
+0000e400: 6629 202d 3e20 496e 6465 7865 735b 496e  f) -> Indexes[In
+0000e410: 6465 785d 3a0a 2020 2020 2020 2020 2222  dex]:.        ""
+0000e420: 224d 6170 7069 6e67 206f 6620 7861 7272  "Mapping of xarr
+0000e430: 6179 2049 6e64 6578 206f 626a 6563 7473  ay Index objects
+0000e440: 2075 7365 6420 666f 7220 6c61 6265 6c20   used for label 
+0000e450: 6261 7365 6420 696e 6465 7869 6e67 2e22  based indexing."
+0000e460: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000e470: 6e20 496e 6465 7865 7328 7365 6c66 2e5f  n Indexes(self._
+0000e480: 696e 6465 7865 732c 207b 6b3a 2073 656c  indexes, {k: sel
+0000e490: 662e 5f76 6172 6961 626c 6573 5b6b 5d20  f._variables[k] 
+0000e4a0: 666f 7220 6b20 696e 2073 656c 662e 5f69  for k in self._i
+0000e4b0: 6e64 6578 6573 7d29 0a0a 2020 2020 4070  ndexes})..    @p
+0000e4c0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000e4d0: 636f 6f72 6473 2873 656c 6629 202d 3e20  coords(self) -> 
+0000e4e0: 4461 7461 7365 7443 6f6f 7264 696e 6174  DatasetCoordinat
+0000e4f0: 6573 3a0a 2020 2020 2020 2020 2222 2244  es:.        """D
+0000e500: 6963 7469 6f6e 6172 7920 6f66 2078 6172  ictionary of xar
+0000e510: 7261 792e 4461 7461 4172 7261 7920 6f62  ray.DataArray ob
+0000e520: 6a65 6374 7320 636f 7272 6573 706f 6e64  jects correspond
+0000e530: 696e 6720 746f 2063 6f6f 7264 696e 6174  ing to coordinat
+0000e540: 650a 2020 2020 2020 2020 7661 7269 6162  e.        variab
+0000e550: 6c65 730a 2020 2020 2020 2020 2222 220a  les.        """.
+0000e560: 2020 2020 2020 2020 7265 7475 726e 2044          return D
+0000e570: 6174 6173 6574 436f 6f72 6469 6e61 7465  atasetCoordinate
+0000e580: 7328 7365 6c66 290a 0a20 2020 2040 7072  s(self)..    @pr
+0000e590: 6f70 6572 7479 0a20 2020 2064 6566 2064  operty.    def d
+0000e5a0: 6174 615f 7661 7273 2873 656c 6629 202d  ata_vars(self) -
+0000e5b0: 3e20 4461 7461 5661 7269 6162 6c65 733a  > DataVariables:
+0000e5c0: 0a20 2020 2020 2020 2022 2222 4469 6374  .        """Dict
+0000e5d0: 696f 6e61 7279 206f 6620 4461 7461 4172  ionary of DataAr
+0000e5e0: 7261 7920 6f62 6a65 6374 7320 636f 7272  ray objects corr
+0000e5f0: 6573 706f 6e64 696e 6720 746f 2064 6174  esponding to dat
+0000e600: 6120 7661 7269 6162 6c65 7322 2222 0a20  a variables""". 
+0000e610: 2020 2020 2020 2072 6574 7572 6e20 4461         return Da
+0000e620: 7461 5661 7269 6162 6c65 7328 7365 6c66  taVariables(self
+0000e630: 290a 0a20 2020 2064 6566 2073 6574 5f63  )..    def set_c
+0000e640: 6f6f 7264 7328 7365 6c66 3a20 545f 4461  oords(self: T_Da
+0000e650: 7461 7365 742c 206e 616d 6573 3a20 4861  taset, names: Ha
+0000e660: 7368 6162 6c65 207c 2049 7465 7261 626c  shable | Iterabl
+0000e670: 655b 4861 7368 6162 6c65 5d29 202d 3e20  e[Hashable]) -> 
+0000e680: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+0000e690: 2020 2022 2222 4769 7665 6e20 6e61 6d65     """Given name
+0000e6a0: 7320 6f66 206f 6e65 206f 7220 6d6f 7265  s of one or more
+0000e6b0: 2076 6172 6961 626c 6573 2c20 7365 7420   variables, set 
+0000e6c0: 7468 656d 2061 7320 636f 6f72 6469 6e61  them as coordina
+0000e6d0: 7465 730a 0a20 2020 2020 2020 2050 6172  tes..        Par
+0000e6e0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+0000e6f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+0000e700: 2020 206e 616d 6573 203a 2068 6173 6861     names : hasha
+0000e710: 626c 6520 6f72 2069 7465 7261 626c 6520  ble or iterable 
+0000e720: 6f66 2068 6173 6861 626c 650a 2020 2020  of hashable.    
+0000e730: 2020 2020 2020 2020 4e61 6d65 2873 2920          Name(s) 
+0000e740: 6f66 2076 6172 6961 626c 6573 2069 6e20  of variables in 
+0000e750: 7468 6973 2064 6174 6173 6574 2074 6f20  this dataset to 
+0000e760: 636f 6e76 6572 7420 696e 746f 2063 6f6f  convert into coo
+0000e770: 7264 696e 6174 6573 2e0a 0a20 2020 2020  rdinates...     
+0000e780: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+0000e790: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+0000e7a0: 2020 2044 6174 6173 6574 0a0a 2020 2020     Dataset..    
+0000e7b0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+0000e7c0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+0000e7d0: 2020 2020 2020 4461 7461 7365 742e 7377        Dataset.sw
+0000e7e0: 6170 5f64 696d 730a 2020 2020 2020 2020  ap_dims.        
+0000e7f0: 4461 7461 7365 742e 6173 7369 676e 5f63  Dataset.assign_c
+0000e800: 6f6f 7264 730a 2020 2020 2020 2020 2222  oords.        ""
+0000e810: 220a 2020 2020 2020 2020 2320 544f 444f  ".        # TODO
+0000e820: 3a20 616c 6c6f 7720 696e 7365 7274 696e  : allow insertin
+0000e830: 6720 6e65 7720 636f 6f72 6469 6e61 7465  g new coordinate
+0000e840: 7320 7769 7468 2074 6869 7320 6d65 7468  s with this meth
+0000e850: 6f64 2c20 6c69 6b65 0a20 2020 2020 2020  od, like.       
+0000e860: 2023 2044 6174 6146 7261 6d65 2e73 6574   # DataFrame.set
+0000e870: 5f69 6e64 6578 3f0a 2020 2020 2020 2020  _index?.        
+0000e880: 2320 6e62 2e20 6368 6563 6b20 696e 2073  # nb. check in s
+0000e890: 656c 662e 5f76 6172 6961 626c 6573 2c20  elf._variables, 
+0000e8a0: 6e6f 7420 7365 6c66 2e64 6174 615f 7661  not self.data_va
+0000e8b0: 7273 2074 6f20 696e 7375 7265 2074 6861  rs to insure tha
+0000e8c0: 7420 7468 650a 2020 2020 2020 2020 2320  t the.        # 
+0000e8d0: 6f70 6572 6174 696f 6e20 6973 2069 6465  operation is ide
+0000e8e0: 6d70 6f74 656e 740a 2020 2020 2020 2020  mpotent.        
+0000e8f0: 6966 2069 7369 6e73 7461 6e63 6528 6e61  if isinstance(na
+0000e900: 6d65 732c 2073 7472 2920 6f72 206e 6f74  mes, str) or not
+0000e910: 2069 7369 6e73 7461 6e63 6528 6e61 6d65   isinstance(name
+0000e920: 732c 2049 7465 7261 626c 6529 3a0a 2020  s, Iterable):.  
+0000e930: 2020 2020 2020 2020 2020 6e61 6d65 7320            names 
+0000e940: 3d20 5b6e 616d 6573 5d0a 2020 2020 2020  = [names].      
+0000e950: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000e960: 2020 2020 6e61 6d65 7320 3d20 6c69 7374      names = list
+0000e970: 286e 616d 6573 290a 2020 2020 2020 2020  (names).        
+0000e980: 7365 6c66 2e5f 6173 7365 7274 5f61 6c6c  self._assert_all
+0000e990: 5f69 6e5f 6461 7461 7365 7428 6e61 6d65  _in_dataset(name
+0000e9a0: 7329 0a20 2020 2020 2020 206f 626a 203d  s).        obj =
+0000e9b0: 2073 656c 662e 636f 7079 2829 0a20 2020   self.copy().   
+0000e9c0: 2020 2020 206f 626a 2e5f 636f 6f72 645f       obj._coord_
+0000e9d0: 6e61 6d65 732e 7570 6461 7465 286e 616d  names.update(nam
+0000e9e0: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
+0000e9f0: 726e 206f 626a 0a0a 2020 2020 6465 6620  rn obj..    def 
+0000ea00: 7265 7365 745f 636f 6f72 6473 280a 2020  reset_coords(.  
+0000ea10: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+0000ea20: 7461 7365 742c 0a20 2020 2020 2020 206e  taset,.        n
+0000ea30: 616d 6573 3a20 4469 6d73 203d 204e 6f6e  ames: Dims = Non
+0000ea40: 652c 0a20 2020 2020 2020 2064 726f 703a  e,.        drop:
+0000ea50: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0000ea60: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
+0000ea70: 743a 0a20 2020 2020 2020 2022 2222 4769  t:.        """Gi
+0000ea80: 7665 6e20 6e61 6d65 7320 6f66 2063 6f6f  ven names of coo
+0000ea90: 7264 696e 6174 6573 2c20 7265 7365 7420  rdinates, reset 
+0000eaa0: 7468 656d 2074 6f20 6265 636f 6d65 2076  them to become v
+0000eab0: 6172 6961 626c 6573 0a0a 2020 2020 2020  ariables..      
+0000eac0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000ead0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0000eae0: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
+0000eaf0: 7374 722c 2049 7465 7261 626c 6520 6f66  str, Iterable of
+0000eb00: 2048 6173 6861 626c 6520 6f72 204e 6f6e   Hashable or Non
+0000eb10: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+0000eb20: 2020 2020 2020 2020 4e61 6d65 2873 2920          Name(s) 
+0000eb30: 6f66 206e 6f6e 2d69 6e64 6578 2063 6f6f  of non-index coo
+0000eb40: 7264 696e 6174 6573 2069 6e20 7468 6973  rdinates in this
+0000eb50: 2064 6174 6173 6574 2074 6f20 7265 7365   dataset to rese
+0000eb60: 7420 696e 746f 0a20 2020 2020 2020 2020  t into.         
+0000eb70: 2020 2076 6172 6961 626c 6573 2e20 4279     variables. By
+0000eb80: 2064 6566 6175 6c74 2c20 616c 6c20 6e6f   default, all no
+0000eb90: 6e2d 696e 6465 7820 636f 6f72 6469 6e61  n-index coordina
+0000eba0: 7465 7320 6172 6520 7265 7365 742e 0a20  tes are reset.. 
+0000ebb0: 2020 2020 2020 2064 726f 7020 3a20 626f         drop : bo
+0000ebc0: 6f6c 2c20 6465 6661 756c 743a 2046 616c  ol, default: Fal
+0000ebd0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
+0000ebe0: 6620 5472 7565 2c20 7265 6d6f 7665 2063  f True, remove c
+0000ebf0: 6f6f 7264 696e 6174 6573 2069 6e73 7465  oordinates inste
+0000ec00: 6164 206f 6620 636f 6e76 6572 7469 6e67  ad of converting
+0000ec10: 2074 6865 6d20 696e 746f 0a20 2020 2020   them into.     
+0000ec20: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0000ec30: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+0000ec40: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+0000ec50: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
+0000ec60: 6574 0a20 2020 2020 2020 2022 2222 0a20  et.        """. 
+0000ec70: 2020 2020 2020 2069 6620 6e61 6d65 7320         if names 
+0000ec80: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000ec90: 2020 2020 206e 616d 6573 203d 2073 656c       names = sel
+0000eca0: 662e 5f63 6f6f 7264 5f6e 616d 6573 202d  f._coord_names -
+0000ecb0: 2073 6574 2873 656c 662e 5f69 6e64 6578   set(self._index
+0000ecc0: 6573 290a 2020 2020 2020 2020 656c 7365  es).        else
+0000ecd0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000ece0: 2069 7369 6e73 7461 6e63 6528 6e61 6d65   isinstance(name
+0000ecf0: 732c 2073 7472 2920 6f72 206e 6f74 2069  s, str) or not i
+0000ed00: 7369 6e73 7461 6e63 6528 6e61 6d65 732c  sinstance(names,
+0000ed10: 2049 7465 7261 626c 6529 3a0a 2020 2020   Iterable):.    
+0000ed20: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0000ed30: 7320 3d20 5b6e 616d 6573 5d0a 2020 2020  s = [names].    
+0000ed40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000ed50: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+0000ed60: 6d65 7320 3d20 6c69 7374 286e 616d 6573  mes = list(names
+0000ed70: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000ed80: 6c66 2e5f 6173 7365 7274 5f61 6c6c 5f69  lf._assert_all_i
+0000ed90: 6e5f 6461 7461 7365 7428 6e61 6d65 7329  n_dataset(names)
+0000eda0: 0a20 2020 2020 2020 2020 2020 2062 6164  .            bad
+0000edb0: 5f63 6f6f 7264 7320 3d20 7365 7428 6e61  _coords = set(na
+0000edc0: 6d65 7329 2026 2073 6574 2873 656c 662e  mes) & set(self.
+0000edd0: 5f69 6e64 6578 6573 290a 2020 2020 2020  _indexes).      
+0000ede0: 2020 2020 2020 6966 2062 6164 5f63 6f6f        if bad_coo
+0000edf0: 7264 733a 0a20 2020 2020 2020 2020 2020  rds:.           
+0000ee00: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000ee10: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0000ee20: 2020 2020 2020 2020 2020 2066 2263 616e             f"can
+0000ee30: 6e6f 7420 7265 6d6f 7665 2069 6e64 6578  not remove index
+0000ee40: 2063 6f6f 7264 696e 6174 6573 2077 6974   coordinates wit
+0000ee50: 6820 7265 7365 745f 636f 6f72 6473 3a20  h reset_coords: 
+0000ee60: 7b62 6164 5f63 6f6f 7264 737d 220a 2020  {bad_coords}".  
+0000ee70: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000ee80: 2020 2020 2020 2020 6f62 6a20 3d20 7365          obj = se
+0000ee90: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
+0000eea0: 2020 6f62 6a2e 5f63 6f6f 7264 5f6e 616d    obj._coord_nam
+0000eeb0: 6573 2e64 6966 6665 7265 6e63 655f 7570  es.difference_up
+0000eec0: 6461 7465 286e 616d 6573 290a 2020 2020  date(names).    
+0000eed0: 2020 2020 6966 2064 726f 703a 0a20 2020      if drop:.   
+0000eee0: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
+0000eef0: 6520 696e 206e 616d 6573 3a0a 2020 2020  e in names:.    
+0000ef00: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+0000ef10: 6f62 6a2e 5f76 6172 6961 626c 6573 5b6e  obj._variables[n
+0000ef20: 616d 655d 0a20 2020 2020 2020 2072 6574  ame].        ret
+0000ef30: 7572 6e20 6f62 6a0a 0a20 2020 2064 6566  urn obj..    def
+0000ef40: 2064 756d 705f 746f 5f73 746f 7265 2873   dump_to_store(s
+0000ef50: 656c 662c 2073 746f 7265 3a20 4162 7374  elf, store: Abst
+0000ef60: 7261 6374 4461 7461 5374 6f72 652c 202a  ractDataStore, *
+0000ef70: 2a6b 7761 7267 7329 202d 3e20 4e6f 6e65  *kwargs) -> None
+0000ef80: 3a0a 2020 2020 2020 2020 2222 2253 746f  :.        """Sto
+0000ef90: 7265 2064 6174 6173 6574 2063 6f6e 7465  re dataset conte
+0000efa0: 6e74 7320 746f 2061 2062 6163 6b65 6e64  nts to a backend
+0000efb0: 732e 2a44 6174 6153 746f 7265 206f 626a  s.*DataStore obj
+0000efc0: 6563 742e 2222 220a 2020 2020 2020 2020  ect.""".        
+0000efd0: 6672 6f6d 2078 6172 7261 792e 6261 636b  from xarray.back
+0000efe0: 656e 6473 2e61 7069 2069 6d70 6f72 7420  ends.api import 
+0000eff0: 6475 6d70 5f74 6f5f 7374 6f72 650a 0a20  dump_to_store.. 
+0000f000: 2020 2020 2020 2023 2054 4f44 4f3a 2072         # TODO: r
+0000f010: 656e 616d 6520 616e 642f 6f72 2063 6c65  ename and/or cle
+0000f020: 616e 7570 2074 6869 7320 6d65 7468 6f64  anup this method
+0000f030: 2074 6f20 6d61 6b65 2069 7420 6d6f 7265   to make it more
+0000f040: 2063 6f6e 7369 7374 656e 740a 2020 2020   consistent.    
+0000f050: 2020 2020 2320 7769 7468 2074 6f5f 6e65      # with to_ne
+0000f060: 7463 6466 2829 0a20 2020 2020 2020 2064  tcdf().        d
+0000f070: 756d 705f 746f 5f73 746f 7265 2873 656c  ump_to_store(sel
+0000f080: 662c 2073 746f 7265 2c20 2a2a 6b77 6172  f, store, **kwar
+0000f090: 6773 290a 0a20 2020 2023 2070 6174 683d  gs)..    # path=
+0000f0a0: 4e6f 6e65 2077 7269 7465 7320 746f 2062  None writes to b
+0000f0b0: 7974 6573 0a20 2020 2040 6f76 6572 6c6f  ytes.    @overlo
+0000f0c0: 6164 0a20 2020 2064 6566 2074 6f5f 6e65  ad.    def to_ne
+0000f0d0: 7463 6466 280a 2020 2020 2020 2020 7365  tcdf(.        se
+0000f0e0: 6c66 2c0a 2020 2020 2020 2020 7061 7468  lf,.        path
+0000f0f0: 3a20 4e6f 6e65 203d 204e 6f6e 652c 0a20  : None = None,. 
+0000f100: 2020 2020 2020 206d 6f64 653a 204c 6974         mode: Lit
+0000f110: 6572 616c 5b22 7722 2c20 2261 225d 203d  eral["w", "a"] =
+0000f120: 2022 7722 2c0a 2020 2020 2020 2020 666f   "w",.        fo
+0000f130: 726d 6174 3a20 545f 4e65 7463 6466 5479  rmat: T_NetcdfTy
+0000f140: 7065 7320 7c20 4e6f 6e65 203d 204e 6f6e  pes | None = Non
+0000f150: 652c 0a20 2020 2020 2020 2067 726f 7570  e,.        group
+0000f160: 3a20 7374 7220 7c20 4e6f 6e65 203d 204e  : str | None = N
+0000f170: 6f6e 652c 0a20 2020 2020 2020 2065 6e67  one,.        eng
+0000f180: 696e 653a 2054 5f4e 6574 6364 6645 6e67  ine: T_NetcdfEng
+0000f190: 696e 6520 7c20 4e6f 6e65 203d 204e 6f6e  ine | None = Non
+0000f1a0: 652c 0a20 2020 2020 2020 2065 6e63 6f64  e,.        encod
+0000f1b0: 696e 673a 204d 6170 7069 6e67 5b41 6e79  ing: Mapping[Any
+0000f1c0: 2c20 4d61 7070 696e 675b 7374 722c 2041  , Mapping[str, A
+0000f1d0: 6e79 5d5d 207c 204e 6f6e 6520 3d20 4e6f  ny]] | None = No
+0000f1e0: 6e65 2c0a 2020 2020 2020 2020 756e 6c69  ne,.        unli
+0000f1f0: 6d69 7465 645f 6469 6d73 3a20 4974 6572  mited_dims: Iter
+0000f200: 6162 6c65 5b48 6173 6861 626c 655d 207c  able[Hashable] |
+0000f210: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+0000f220: 2020 2020 2020 636f 6d70 7574 653a 2062        compute: b
+0000f230: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
+0000f240: 2020 2020 696e 7661 6c69 645f 6e65 7463      invalid_netc
+0000f250: 6466 3a20 626f 6f6c 203d 2046 616c 7365  df: bool = False
+0000f260: 2c0a 2020 2020 2920 2d3e 2062 7974 6573  ,.    ) -> bytes
+0000f270: 3a0a 2020 2020 2020 2020 2e2e 2e0a 0a20  :.        ..... 
+0000f280: 2020 2023 2064 6566 6175 6c74 2072 6574     # default ret
+0000f290: 7572 6e20 4e6f 6e65 0a20 2020 2040 6f76  urn None.    @ov
+0000f2a0: 6572 6c6f 6164 0a20 2020 2064 6566 2074  erload.    def t
+0000f2b0: 6f5f 6e65 7463 6466 280a 2020 2020 2020  o_netcdf(.      
+0000f2c0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000f2d0: 7061 7468 3a20 7374 7220 7c20 5061 7468  path: str | Path
+0000f2e0: 4c69 6b65 2c0a 2020 2020 2020 2020 6d6f  Like,.        mo
+0000f2f0: 6465 3a20 4c69 7465 7261 6c5b 2277 222c  de: Literal["w",
+0000f300: 2022 6122 5d20 3d20 2277 222c 0a20 2020   "a"] = "w",.   
+0000f310: 2020 2020 2066 6f72 6d61 743a 2054 5f4e       format: T_N
+0000f320: 6574 6364 6654 7970 6573 207c 204e 6f6e  etcdfTypes | Non
+0000f330: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0000f340: 2020 6772 6f75 703a 2073 7472 207c 204e    group: str | N
+0000f350: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+0000f360: 2020 2020 656e 6769 6e65 3a20 545f 4e65      engine: T_Ne
+0000f370: 7463 6466 456e 6769 6e65 207c 204e 6f6e  tcdfEngine | Non
+0000f380: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0000f390: 2020 656e 636f 6469 6e67 3a20 4d61 7070    encoding: Mapp
+0000f3a0: 696e 675b 416e 792c 204d 6170 7069 6e67  ing[Any, Mapping
+0000f3b0: 5b73 7472 2c20 416e 795d 5d20 7c20 4e6f  [str, Any]] | No
+0000f3c0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+0000f3d0: 2020 2075 6e6c 696d 6974 6564 5f64 696d     unlimited_dim
+0000f3e0: 733a 2049 7465 7261 626c 655b 4861 7368  s: Iterable[Hash
+0000f3f0: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
+0000f400: 6f6e 652c 0a20 2020 2020 2020 2063 6f6d  one,.        com
+0000f410: 7075 7465 3a20 4c69 7465 7261 6c5b 5472  pute: Literal[Tr
+0000f420: 7565 5d20 3d20 5472 7565 2c0a 2020 2020  ue] = True,.    
+0000f430: 2020 2020 696e 7661 6c69 645f 6e65 7463      invalid_netc
+0000f440: 6466 3a20 626f 6f6c 203d 2046 616c 7365  df: bool = False
+0000f450: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
+0000f460: 0a20 2020 2020 2020 202e 2e2e 0a0a 2020  .        .....  
+0000f470: 2020 2320 636f 6d70 7574 653d 4661 6c73    # compute=Fals
+0000f480: 6520 7265 7475 726e 7320 6461 736b 2e44  e returns dask.D
+0000f490: 656c 6179 6564 0a20 2020 2040 6f76 6572  elayed.    @over
+0000f4a0: 6c6f 6164 0a20 2020 2064 6566 2074 6f5f  load.    def to_
+0000f4b0: 6e65 7463 6466 280a 2020 2020 2020 2020  netcdf(.        
+0000f4c0: 7365 6c66 2c0a 2020 2020 2020 2020 7061  self,.        pa
+0000f4d0: 7468 3a20 7374 7220 7c20 5061 7468 4c69  th: str | PathLi
+0000f4e0: 6b65 2c0a 2020 2020 2020 2020 6d6f 6465  ke,.        mode
+0000f4f0: 3a20 4c69 7465 7261 6c5b 2277 222c 2022  : Literal["w", "
+0000f500: 6122 5d20 3d20 2277 222c 0a20 2020 2020  a"] = "w",.     
+0000f510: 2020 2066 6f72 6d61 743a 2054 5f4e 6574     format: T_Net
+0000f520: 6364 6654 7970 6573 207c 204e 6f6e 6520  cdfTypes | None 
+0000f530: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000f540: 6772 6f75 703a 2073 7472 207c 204e 6f6e  group: str | Non
+0000f550: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0000f560: 2020 656e 6769 6e65 3a20 545f 4e65 7463    engine: T_Netc
+0000f570: 6466 456e 6769 6e65 207c 204e 6f6e 6520  dfEngine | None 
+0000f580: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000f590: 656e 636f 6469 6e67 3a20 4d61 7070 696e  encoding: Mappin
+0000f5a0: 675b 416e 792c 204d 6170 7069 6e67 5b73  g[Any, Mapping[s
+0000f5b0: 7472 2c20 416e 795d 5d20 7c20 4e6f 6e65  tr, Any]] | None
+0000f5c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000f5d0: 2075 6e6c 696d 6974 6564 5f64 696d 733a   unlimited_dims:
+0000f5e0: 2049 7465 7261 626c 655b 4861 7368 6162   Iterable[Hashab
+0000f5f0: 6c65 5d20 7c20 4e6f 6e65 203d 204e 6f6e  le] | None = Non
+0000f600: 652c 0a20 2020 2020 2020 202a 2c0a 2020  e,.        *,.  
+0000f610: 2020 2020 2020 636f 6d70 7574 653a 204c        compute: L
+0000f620: 6974 6572 616c 5b46 616c 7365 5d2c 0a20  iteral[False],. 
+0000f630: 2020 2020 2020 2069 6e76 616c 6964 5f6e         invalid_n
+0000f640: 6574 6364 663a 2062 6f6f 6c20 3d20 4661  etcdf: bool = Fa
+0000f650: 6c73 652c 0a20 2020 2029 202d 3e20 4465  lse,.    ) -> De
+0000f660: 6c61 7965 643a 0a20 2020 2020 2020 202e  layed:.        .
+0000f670: 2e2e 0a0a 2020 2020 6465 6620 746f 5f6e  ....    def to_n
+0000f680: 6574 6364 6628 0a20 2020 2020 2020 2073  etcdf(.        s
+0000f690: 656c 662c 0a20 2020 2020 2020 2070 6174  elf,.        pat
+0000f6a0: 683a 2073 7472 207c 2050 6174 684c 696b  h: str | PathLik
+0000f6b0: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
+0000f6c0: 0a20 2020 2020 2020 206d 6f64 653a 204c  .        mode: L
+0000f6d0: 6974 6572 616c 5b22 7722 2c20 2261 225d  iteral["w", "a"]
+0000f6e0: 203d 2022 7722 2c0a 2020 2020 2020 2020   = "w",.        
+0000f6f0: 666f 726d 6174 3a20 545f 4e65 7463 6466  format: T_Netcdf
+0000f700: 5479 7065 7320 7c20 4e6f 6e65 203d 204e  Types | None = N
+0000f710: 6f6e 652c 0a20 2020 2020 2020 2067 726f  one,.        gro
+0000f720: 7570 3a20 7374 7220 7c20 4e6f 6e65 203d  up: str | None =
+0000f730: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
+0000f740: 6e67 696e 653a 2054 5f4e 6574 6364 6645  ngine: T_NetcdfE
+0000f750: 6e67 696e 6520 7c20 4e6f 6e65 203d 204e  ngine | None = N
+0000f760: 6f6e 652c 0a20 2020 2020 2020 2065 6e63  one,.        enc
+0000f770: 6f64 696e 673a 204d 6170 7069 6e67 5b41  oding: Mapping[A
+0000f780: 6e79 2c20 4d61 7070 696e 675b 7374 722c  ny, Mapping[str,
+0000f790: 2041 6e79 5d5d 207c 204e 6f6e 6520 3d20   Any]] | None = 
+0000f7a0: 4e6f 6e65 2c0a 2020 2020 2020 2020 756e  None,.        un
+0000f7b0: 6c69 6d69 7465 645f 6469 6d73 3a20 4974  limited_dims: It
+0000f7c0: 6572 6162 6c65 5b48 6173 6861 626c 655d  erable[Hashable]
+0000f7d0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+0000f7e0: 2020 2020 2020 2020 636f 6d70 7574 653a          compute:
+0000f7f0: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+0000f800: 2020 2020 2020 696e 7661 6c69 645f 6e65        invalid_ne
+0000f810: 7463 6466 3a20 626f 6f6c 203d 2046 616c  tcdf: bool = Fal
+0000f820: 7365 2c0a 2020 2020 2920 2d3e 2062 7974  se,.    ) -> byt
+0000f830: 6573 207c 2044 656c 6179 6564 207c 204e  es | Delayed | N
+0000f840: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000f850: 5772 6974 6520 6461 7461 7365 7420 636f  Write dataset co
+0000f860: 6e74 656e 7473 2074 6f20 6120 6e65 7443  ntents to a netC
+0000f870: 4446 2066 696c 652e 0a0a 2020 2020 2020  DF file...      
+0000f880: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000f890: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0000f8a0: 2020 2020 2020 2020 7061 7468 203a 2073          path : s
+0000f8b0: 7472 2c20 7061 7468 2d6c 696b 6520 6f72  tr, path-like or
+0000f8c0: 2066 696c 652d 6c69 6b65 2c20 6f70 7469   file-like, opti
+0000f8d0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+0000f8e0: 2050 6174 6820 746f 2077 6869 6368 2074   Path to which t
+0000f8f0: 6f20 7361 7665 2074 6869 7320 6461 7461  o save this data
+0000f900: 7365 742e 2046 696c 652d 6c69 6b65 206f  set. File-like o
+0000f910: 626a 6563 7473 2061 7265 206f 6e6c 790a  bjects are only.
+0000f920: 2020 2020 2020 2020 2020 2020 7375 7070              supp
+0000f930: 6f72 7465 6420 6279 2074 6865 2073 6369  orted by the sci
+0000f940: 7079 2065 6e67 696e 652e 2049 6620 6e6f  py engine. If no
+0000f950: 2070 6174 6820 6973 2070 726f 7669 6465   path is provide
+0000f960: 642c 2074 6869 730a 2020 2020 2020 2020  d, this.        
+0000f970: 2020 2020 6675 6e63 7469 6f6e 2072 6574      function ret
+0000f980: 7572 6e73 2074 6865 2072 6573 756c 7469  urns the resulti
+0000f990: 6e67 206e 6574 4344 4620 6669 6c65 2061  ng netCDF file a
+0000f9a0: 7320 6279 7465 733b 2069 6e20 7468 6973  s bytes; in this
+0000f9b0: 2063 6173 652c 0a20 2020 2020 2020 2020   case,.         
+0000f9c0: 2020 2077 6520 6e65 6564 2074 6f20 7573     we need to us
+0000f9d0: 6520 7363 6970 792c 2077 6869 6368 2064  e scipy, which d
+0000f9e0: 6f65 7320 6e6f 7420 7375 7070 6f72 7420  oes not support 
+0000f9f0: 6e65 7443 4446 2076 6572 7369 6f6e 2034  netCDF version 4
+0000fa00: 2028 7468 650a 2020 2020 2020 2020 2020   (the.          
+0000fa10: 2020 6465 6661 756c 7420 666f 726d 6174    default format
+0000fa20: 2062 6563 6f6d 6573 204e 4554 4344 4633   becomes NETCDF3
+0000fa30: 5f36 3442 4954 292e 0a20 2020 2020 2020  _64BIT)..       
+0000fa40: 206d 6f64 6520 3a20 7b22 7722 2c20 2261   mode : {"w", "a
+0000fa50: 227d 2c20 6465 6661 756c 743a 2022 7722  "}, default: "w"
+0000fa60: 0a20 2020 2020 2020 2020 2020 2057 7269  .            Wri
+0000fa70: 7465 2028 2777 2729 206f 7220 6170 7065  te ('w') or appe
+0000fa80: 6e64 2028 2761 2729 206d 6f64 652e 2049  nd ('a') mode. I
+0000fa90: 6620 6d6f 6465 3d27 7727 2c20 616e 7920  f mode='w', any 
+0000faa0: 6578 6973 7469 6e67 2066 696c 6520 6174  existing file at
+0000fab0: 0a20 2020 2020 2020 2020 2020 2074 6869  .            thi
+0000fac0: 7320 6c6f 6361 7469 6f6e 2077 696c 6c20  s location will 
+0000fad0: 6265 206f 7665 7277 7269 7474 656e 2e20  be overwritten. 
+0000fae0: 4966 206d 6f64 653d 2761 272c 2065 7869  If mode='a', exi
+0000faf0: 7374 696e 6720 7661 7269 6162 6c65 730a  sting variables.
+0000fb00: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+0000fb10: 2062 6520 6f76 6572 7772 6974 7465 6e2e   be overwritten.
+0000fb20: 0a20 2020 2020 2020 2066 6f72 6d61 7420  .        format 
+0000fb30: 3a20 7b22 4e45 5443 4446 3422 2c20 224e  : {"NETCDF4", "N
+0000fb40: 4554 4344 4634 5f43 4c41 5353 4943 222c  ETCDF4_CLASSIC",
+0000fb50: 2022 4e45 5443 4446 335f 3634 4249 5422   "NETCDF3_64BIT"
+0000fb60: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+0000fb70: 2020 2020 2020 224e 4554 4344 4633 5f43        "NETCDF3_C
+0000fb80: 4c41 5353 4943 227d 2c20 6f70 7469 6f6e  LASSIC"}, option
+0000fb90: 616c 0a20 2020 2020 2020 2020 2020 2046  al.            F
+0000fba0: 696c 6520 666f 726d 6174 2066 6f72 2074  ile format for t
+0000fbb0: 6865 2072 6573 756c 7469 6e67 206e 6574  he resulting net
+0000fbc0: 4344 4620 6669 6c65 3a0a 0a20 2020 2020  CDF file:..     
+0000fbd0: 2020 2020 2020 202a 204e 4554 4344 4634         * NETCDF4
+0000fbe0: 3a20 4461 7461 2069 7320 7374 6f72 6564  : Data is stored
+0000fbf0: 2069 6e20 616e 2048 4446 3520 6669 6c65   in an HDF5 file
+0000fc00: 2c20 7573 696e 6720 6e65 7443 4446 3420  , using netCDF4 
+0000fc10: 4150 490a 2020 2020 2020 2020 2020 2020  API.            
+0000fc20: 2020 6665 6174 7572 6573 2e0a 2020 2020    features..    
+0000fc30: 2020 2020 2020 2020 2a20 4e45 5443 4446          * NETCDF
+0000fc40: 345f 434c 4153 5349 433a 2044 6174 6120  4_CLASSIC: Data 
+0000fc50: 6973 2073 746f 7265 6420 696e 2061 6e20  is stored in an 
+0000fc60: 4844 4635 2066 696c 652c 2075 7369 6e67  HDF5 file, using
+0000fc70: 206f 6e6c 790a 2020 2020 2020 2020 2020   only.          
+0000fc80: 2020 2020 6e65 7443 4446 2033 2063 6f6d      netCDF 3 com
+0000fc90: 7061 7469 626c 6520 4150 4920 6665 6174  patible API feat
+0000fca0: 7572 6573 2e0a 2020 2020 2020 2020 2020  ures..          
+0000fcb0: 2020 2a20 4e45 5443 4446 335f 3634 4249    * NETCDF3_64BI
+0000fcc0: 543a 2036 342d 6269 7420 6f66 6673 6574  T: 64-bit offset
+0000fcd0: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
+0000fce0: 6e65 7443 4446 2033 2066 696c 6520 666f  netCDF 3 file fo
+0000fcf0: 726d 6174 2c0a 2020 2020 2020 2020 2020  rmat,.          
+0000fd00: 2020 2020 7768 6963 6820 6675 6c6c 7920      which fully 
+0000fd10: 7375 7070 6f72 7473 2032 2b20 4742 2066  supports 2+ GB f
+0000fd20: 696c 6573 2c20 6275 7420 6973 206f 6e6c  iles, but is onl
+0000fd30: 7920 636f 6d70 6174 6962 6c65 2077 6974  y compatible wit
+0000fd40: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+0000fd50: 636c 6965 6e74 7320 6c69 6e6b 6564 2061  clients linked a
+0000fd60: 6761 696e 7374 206e 6574 4344 4620 7665  gainst netCDF ve
+0000fd70: 7273 696f 6e20 332e 362e 3020 6f72 206c  rsion 3.6.0 or l
+0000fd80: 6174 6572 2e0a 2020 2020 2020 2020 2020  ater..          
+0000fd90: 2020 2a20 4e45 5443 4446 335f 434c 4153    * NETCDF3_CLAS
+0000fda0: 5349 433a 2054 6865 2063 6c61 7373 6963  SIC: The classic
+0000fdb0: 206e 6574 4344 4620 3320 6669 6c65 2066   netCDF 3 file f
+0000fdc0: 6f72 6d61 742e 2049 7420 646f 6573 206e  ormat. It does n
+0000fdd0: 6f74 0a20 2020 2020 2020 2020 2020 2020  ot.             
+0000fde0: 2068 616e 646c 6520 322b 2047 4220 6669   handle 2+ GB fi
+0000fdf0: 6c65 7320 7665 7279 2077 656c 6c2e 0a0a  les very well...
+0000fe00: 2020 2020 2020 2020 2020 2020 416c 6c20              All 
+0000fe10: 666f 726d 6174 7320 6172 6520 7375 7070  formats are supp
+0000fe20: 6f72 7465 6420 6279 2074 6865 206e 6574  orted by the net
+0000fe30: 4344 4634 2d70 7974 686f 6e20 6c69 6272  CDF4-python libr
+0000fe40: 6172 792e 0a20 2020 2020 2020 2020 2020  ary..           
+0000fe50: 2073 6369 7079 2e69 6f2e 6e65 7463 6466   scipy.io.netcdf
+0000fe60: 206f 6e6c 7920 7375 7070 6f72 7473 2074   only supports t
+0000fe70: 6865 206c 6173 7420 7477 6f20 666f 726d  he last two form
+0000fe80: 6174 732e 0a0a 2020 2020 2020 2020 2020  ats...          
+0000fe90: 2020 5468 6520 6465 6661 756c 7420 666f    The default fo
+0000fea0: 726d 6174 2069 7320 4e45 5443 4446 3420  rmat is NETCDF4 
+0000feb0: 6966 2079 6f75 2061 7265 2073 6176 696e  if you are savin
+0000fec0: 6720 6120 6669 6c65 2074 6f20 6469 736b  g a file to disk
+0000fed0: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+0000fee0: 2068 6176 6520 7468 6520 6e65 7443 4446   have the netCDF
+0000fef0: 342d 7079 7468 6f6e 206c 6962 7261 7279  4-python library
+0000ff00: 2061 7661 696c 6162 6c65 2e20 4f74 6865   available. Othe
+0000ff10: 7277 6973 652c 2078 6172 7261 7920 6661  rwise, xarray fa
+0000ff20: 6c6c 730a 2020 2020 2020 2020 2020 2020  lls.            
+0000ff30: 6261 636b 2074 6f20 7573 696e 6720 7363  back to using sc
+0000ff40: 6970 7920 746f 2077 7269 7465 206e 6574  ipy to write net
+0000ff50: 4344 4620 6669 6c65 7320 616e 6420 6465  CDF files and de
+0000ff60: 6661 756c 7473 2074 6f20 7468 650a 2020  faults to the.  
+0000ff70: 2020 2020 2020 2020 2020 4e45 5443 4446            NETCDF
+0000ff80: 335f 3634 4249 5420 666f 726d 6174 2028  3_64BIT format (
+0000ff90: 7363 6970 7920 646f 6573 206e 6f74 2073  scipy does not s
+0000ffa0: 7570 706f 7274 206e 6574 4344 4634 292e  upport netCDF4).
+0000ffb0: 0a20 2020 2020 2020 2067 726f 7570 203a  .        group :
+0000ffc0: 2073 7472 2c20 6f70 7469 6f6e 616c 0a20   str, optional. 
+0000ffd0: 2020 2020 2020 2020 2020 2050 6174 6820             Path 
+0000ffe0: 746f 2074 6865 206e 6574 4344 4634 2067  to the netCDF4 g
+0000fff0: 726f 7570 2069 6e20 7468 6520 6769 7665  roup in the give
+00010000: 6e20 6669 6c65 2074 6f20 6f70 656e 2028  n file to open (
+00010010: 6f6e 6c79 2077 6f72 6b73 2066 6f72 0a20  only works for. 
+00010020: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+00010030: 743d 274e 4554 4344 4634 2729 2e20 5468  t='NETCDF4'). Th
+00010040: 6520 6772 6f75 7028 7329 2077 696c 6c20  e group(s) will 
+00010050: 6265 2063 7265 6174 6564 2069 6620 6e65  be created if ne
+00010060: 6365 7373 6172 792e 0a20 2020 2020 2020  cessary..       
+00010070: 2065 6e67 696e 6520 3a20 7b22 6e65 7463   engine : {"netc
+00010080: 6466 3422 2c20 2273 6369 7079 222c 2022  df4", "scipy", "
+00010090: 6835 6e65 7463 6466 227d 2c20 6f70 7469  h5netcdf"}, opti
+000100a0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+000100b0: 2045 6e67 696e 6520 746f 2075 7365 2077   Engine to use w
+000100c0: 6865 6e20 7772 6974 696e 6720 6e65 7443  hen writing netC
+000100d0: 4446 2066 696c 6573 2e20 4966 206e 6f74  DF files. If not
+000100e0: 2070 726f 7669 6465 642c 2074 6865 0a20   provided, the. 
+000100f0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00010100: 6c74 2065 6e67 696e 6520 6973 2063 686f  lt engine is cho
+00010110: 7365 6e20 6261 7365 6420 6f6e 2061 7661  sen based on ava
+00010120: 696c 6162 6c65 2064 6570 656e 6465 6e63  ilable dependenc
+00010130: 6965 732c 2077 6974 6820 610a 2020 2020  ies, with a.    
+00010140: 2020 2020 2020 2020 7072 6566 6572 656e          preferen
+00010150: 6365 2066 6f72 2027 6e65 7463 6466 3427  ce for 'netcdf4'
+00010160: 2069 6620 7772 6974 696e 6720 746f 2061   if writing to a
+00010170: 2066 696c 6520 6f6e 2064 6973 6b2e 0a20   file on disk.. 
+00010180: 2020 2020 2020 2065 6e63 6f64 696e 6720         encoding 
+00010190: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
+000101a0: 0a20 2020 2020 2020 2020 2020 204e 6573  .            Nes
+000101b0: 7465 6420 6469 6374 696f 6e61 7279 2077  ted dictionary w
+000101c0: 6974 6820 7661 7269 6162 6c65 206e 616d  ith variable nam
+000101d0: 6573 2061 7320 6b65 7973 2061 6e64 2064  es as keys and d
+000101e0: 6963 7469 6f6e 6172 6965 7320 6f66 0a20  ictionaries of. 
+000101f0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+00010200: 626c 6520 7370 6563 6966 6963 2065 6e63  ble specific enc
+00010210: 6f64 696e 6773 2061 7320 7661 6c75 6573  odings as values
+00010220: 2c20 652e 672e 2c0a 2020 2020 2020 2020  , e.g.,.        
+00010230: 2020 2020 6060 7b22 6d79 5f76 6172 6961      ``{"my_varia
+00010240: 626c 6522 3a20 7b22 6474 7970 6522 3a20  ble": {"dtype": 
+00010250: 2269 6e74 3136 222c 2022 7363 616c 655f  "int16", "scale_
+00010260: 6661 6374 6f72 223a 2030 2e31 2c0a 2020  factor": 0.1,.  
+00010270: 2020 2020 2020 2020 2020 227a 6c69 6222            "zlib"
+00010280: 3a20 5472 7565 7d2c 202e 2e2e 7d60 600a  : True}, ...}``.
+00010290: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+000102a0: 2060 6835 6e65 7463 6466 6020 656e 6769   `h5netcdf` engi
+000102b0: 6e65 2073 7570 706f 7274 7320 626f 7468  ne supports both
+000102c0: 2074 6865 204e 6574 4344 4634 2d73 7479   the NetCDF4-sty
+000102d0: 6c65 2063 6f6d 7072 6573 7369 6f6e 0a20  le compression. 
+000102e0: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
+000102f0: 696e 6720 7061 7261 6d65 7465 7273 2060  ing parameters `
+00010300: 607b 227a 6c69 6222 3a20 5472 7565 2c20  `{"zlib": True, 
+00010310: 2263 6f6d 706c 6576 656c 223a 2039 7d60  "complevel": 9}`
+00010320: 6020 616e 6420 7468 6520 6835 7079 0a20  ` and the h5py. 
+00010330: 2020 2020 2020 2020 2020 206f 6e65 7320             ones 
+00010340: 6060 7b22 636f 6d70 7265 7373 696f 6e22  ``{"compression"
+00010350: 3a20 2267 7a69 7022 2c20 2263 6f6d 7072  : "gzip", "compr
+00010360: 6573 7369 6f6e 5f6f 7074 7322 3a20 397d  ession_opts": 9}
+00010370: 6060 2e0a 2020 2020 2020 2020 2020 2020  ``..            
+00010380: 5468 6973 2061 6c6c 6f77 7320 7573 696e  This allows usin
+00010390: 6720 616e 7920 636f 6d70 7265 7373 696f  g any compressio
+000103a0: 6e20 706c 7567 696e 2069 6e73 7461 6c6c  n plugin install
+000103b0: 6564 2069 6e20 7468 6520 4844 4635 0a20  ed in the HDF5. 
+000103c0: 2020 2020 2020 2020 2020 206c 6962 7261             libra
+000103d0: 7279 2c20 652e 672e 204c 5a46 2e0a 0a20  ry, e.g. LZF... 
+000103e0: 2020 2020 2020 2075 6e6c 696d 6974 6564         unlimited
+000103f0: 5f64 696d 7320 3a20 6974 6572 6162 6c65  _dims : iterable
+00010400: 206f 6620 6861 7368 6162 6c65 2c20 6f70   of hashable, op
+00010410: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00010420: 2020 2044 696d 656e 7369 6f6e 2873 2920     Dimension(s) 
+00010430: 7468 6174 2073 686f 756c 6420 6265 2073  that should be s
+00010440: 6572 6961 6c69 7a65 6420 6173 2075 6e6c  erialized as unl
+00010450: 696d 6974 6564 2064 696d 656e 7369 6f6e  imited dimension
+00010460: 732e 0a20 2020 2020 2020 2020 2020 2042  s..            B
+00010470: 7920 6465 6661 756c 742c 206e 6f20 6469  y default, no di
+00010480: 6d65 6e73 696f 6e73 2061 7265 2074 7265  mensions are tre
+00010490: 6174 6564 2061 7320 756e 6c69 6d69 7465  ated as unlimite
+000104a0: 6420 6469 6d65 6e73 696f 6e73 2e0a 2020  d dimensions..  
+000104b0: 2020 2020 2020 2020 2020 4e6f 7465 2074            Note t
+000104c0: 6861 7420 756e 6c69 6d69 7465 645f 6469  hat unlimited_di
+000104d0: 6d73 206d 6179 2061 6c73 6f20 6265 2073  ms may also be s
+000104e0: 6574 2076 6961 0a20 2020 2020 2020 2020  et via.         
+000104f0: 2020 2060 6064 6174 6173 6574 2e65 6e63     ``dataset.enc
+00010500: 6f64 696e 675b 2275 6e6c 696d 6974 6564  oding["unlimited
+00010510: 5f64 696d 7322 5d60 602e 0a20 2020 2020  _dims"]``..     
+00010520: 2020 2063 6f6d 7075 7465 3a20 626f 6f6c     compute: bool
+00010530: 2c20 6465 6661 756c 743a 2054 7275 650a  , default: True.
+00010540: 2020 2020 2020 2020 2020 2020 4966 2074              If t
+00010550: 7275 6520 636f 6d70 7574 6520 696d 6d65  rue compute imme
+00010560: 6469 6174 656c 792c 206f 7468 6572 7769  diately, otherwi
+00010570: 7365 2072 6574 7572 6e20 610a 2020 2020  se return a.    
+00010580: 2020 2020 2020 2020 6060 6461 736b 2e64          ``dask.d
+00010590: 656c 6179 6564 2e44 656c 6179 6564 6060  elayed.Delayed``
+000105a0: 206f 626a 6563 7420 7468 6174 2063 616e   object that can
+000105b0: 2062 6520 636f 6d70 7574 6564 206c 6174   be computed lat
+000105c0: 6572 2e0a 2020 2020 2020 2020 696e 7661  er..        inva
+000105d0: 6c69 645f 6e65 7463 6466 3a20 626f 6f6c  lid_netcdf: bool
+000105e0: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
+000105f0: 0a20 2020 2020 2020 2020 2020 204f 6e6c  .            Onl
+00010600: 7920 7661 6c69 6420 616c 6f6e 6720 7769  y valid along wi
+00010610: 7468 2060 6065 6e67 696e 653d 2268 356e  th ``engine="h5n
+00010620: 6574 6364 6622 6060 2e20 4966 2054 7275  etcdf"``. If Tru
+00010630: 652c 2061 6c6c 6f77 2077 7269 7469 6e67  e, allow writing
+00010640: 0a20 2020 2020 2020 2020 2020 2068 6466  .            hdf
+00010650: 3520 6669 6c65 7320 7768 6963 6820 6172  5 files which ar
+00010660: 6520 696e 7661 6c69 6420 6e65 7463 6466  e invalid netcdf
+00010670: 2061 7320 6465 7363 7269 6265 6420 696e   as described in
+00010680: 0a20 2020 2020 2020 2020 2020 2068 7474  .            htt
+00010690: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+000106a0: 6835 6e65 7463 6466 2f68 356e 6574 6364  h5netcdf/h5netcd
+000106b0: 662e 0a0a 2020 2020 2020 2020 5265 7475  f...        Retu
+000106c0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+000106d0: 2d2d 2d0a 2020 2020 2020 2020 2020 2020  ---.            
+000106e0: 2a20 6060 6279 7465 7360 6020 6966 2070  * ``bytes`` if p
+000106f0: 6174 6820 6973 204e 6f6e 650a 2020 2020  ath is None.    
+00010700: 2020 2020 2020 2020 2a20 6060 6461 736b          * ``dask
+00010710: 2e64 656c 6179 6564 2e44 656c 6179 6564  .delayed.Delayed
+00010720: 6060 2069 6620 636f 6d70 7574 6520 6973  `` if compute is
+00010730: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+00010740: 2020 202a 204e 6f6e 6520 6f74 6865 7277     * None otherw
+00010750: 6973 650a 0a20 2020 2020 2020 2053 6565  ise..        See
+00010760: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00010770: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+00010780: 6174 6141 7272 6179 2e74 6f5f 6e65 7463  ataArray.to_netc
+00010790: 6466 0a20 2020 2020 2020 2022 2222 0a20  df.        """. 
+000107a0: 2020 2020 2020 2069 6620 656e 636f 6469         if encodi
+000107b0: 6e67 2069 7320 4e6f 6e65 3a0a 2020 2020  ng is None:.    
+000107c0: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
+000107d0: 203d 207b 7d0a 2020 2020 2020 2020 6672   = {}.        fr
+000107e0: 6f6d 2078 6172 7261 792e 6261 636b 656e  om xarray.backen
+000107f0: 6473 2e61 7069 2069 6d70 6f72 7420 746f  ds.api import to
+00010800: 5f6e 6574 6364 660a 0a20 2020 2020 2020  _netcdf..       
+00010810: 2072 6574 7572 6e20 746f 5f6e 6574 6364   return to_netcd
+00010820: 6628 2020 2320 7479 7065 3a20 6967 6e6f  f(  # type: igno
+00010830: 7265 2020 2320 6d79 7079 2063 616e 6e6f  re  # mypy canno
+00010840: 7420 7265 736f 6c76 6520 7468 6520 6f76  t resolve the ov
+00010850: 6572 6c6f 6164 733a 280a 2020 2020 2020  erloads:(.      
+00010860: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00010870: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
+00010880: 2020 2020 2020 2020 2020 6d6f 6465 3d6d            mode=m
+00010890: 6f64 652c 0a20 2020 2020 2020 2020 2020  ode,.           
+000108a0: 2066 6f72 6d61 743d 666f 726d 6174 2c0a   format=format,.
+000108b0: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+000108c0: 703d 6772 6f75 702c 0a20 2020 2020 2020  p=group,.       
+000108d0: 2020 2020 2065 6e67 696e 653d 656e 6769       engine=engi
+000108e0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+000108f0: 656e 636f 6469 6e67 3d65 6e63 6f64 696e  encoding=encodin
+00010900: 672c 0a20 2020 2020 2020 2020 2020 2075  g,.            u
+00010910: 6e6c 696d 6974 6564 5f64 696d 733d 756e  nlimited_dims=un
+00010920: 6c69 6d69 7465 645f 6469 6d73 2c0a 2020  limited_dims,.  
+00010930: 2020 2020 2020 2020 2020 636f 6d70 7574            comput
+00010940: 653d 636f 6d70 7574 652c 0a20 2020 2020  e=compute,.     
+00010950: 2020 2020 2020 206d 756c 7469 6669 6c65         multifile
+00010960: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00010970: 2020 2020 696e 7661 6c69 645f 6e65 7463      invalid_netc
+00010980: 6466 3d69 6e76 616c 6964 5f6e 6574 6364  df=invalid_netcd
+00010990: 662c 0a20 2020 2020 2020 2029 0a0a 2020  f,.        )..  
+000109a0: 2020 2320 636f 6d70 7574 653d 5472 7565    # compute=True
+000109b0: 2028 6465 6661 756c 7429 2072 6574 7572   (default) retur
+000109c0: 6e73 205a 6172 7253 746f 7265 0a20 2020  ns ZarrStore.   
+000109d0: 2040 6f76 6572 6c6f 6164 0a20 2020 2064   @overload.    d
+000109e0: 6566 2074 6f5f 7a61 7272 280a 2020 2020  ef to_zarr(.    
+000109f0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00010a00: 2020 7374 6f72 653a 204d 7574 6162 6c65    store: Mutable
+00010a10: 4d61 7070 696e 6720 7c20 7374 7220 7c20  Mapping | str | 
+00010a20: 5061 7468 4c69 6b65 5b73 7472 5d20 7c20  PathLike[str] | 
+00010a30: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+00010a40: 2020 2020 2063 6875 6e6b 5f73 746f 7265       chunk_store
+00010a50: 3a20 4d75 7461 626c 654d 6170 7069 6e67  : MutableMapping
+00010a60: 207c 2073 7472 207c 2050 6174 684c 696b   | str | PathLik
+00010a70: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
+00010a80: 0a20 2020 2020 2020 206d 6f64 653a 204c  .        mode: L
+00010a90: 6974 6572 616c 5b22 7722 2c20 2277 2d22  iteral["w", "w-"
+00010aa0: 2c20 2261 222c 2022 722b 222c 204e 6f6e  , "a", "r+", Non
+00010ab0: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
+00010ac0: 2020 2073 796e 6368 726f 6e69 7a65 723d     synchronizer=
+00010ad0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6772  None,.        gr
+00010ae0: 6f75 703a 2073 7472 207c 204e 6f6e 6520  oup: str | None 
+00010af0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00010b00: 656e 636f 6469 6e67 3a20 4d61 7070 696e  encoding: Mappin
+00010b10: 6720 7c20 4e6f 6e65 203d 204e 6f6e 652c  g | None = None,
+00010b20: 0a20 2020 2020 2020 2063 6f6d 7075 7465  .        compute
+00010b30: 3a20 4c69 7465 7261 6c5b 5472 7565 5d20  : Literal[True] 
+00010b40: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00010b50: 636f 6e73 6f6c 6964 6174 6564 3a20 626f  consolidated: bo
+00010b60: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
+00010b70: 2c0a 2020 2020 2020 2020 6170 7065 6e64  ,.        append
+00010b80: 5f64 696d 3a20 4861 7368 6162 6c65 207c  _dim: Hashable |
+00010b90: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00010ba0: 2020 2020 2020 7265 6769 6f6e 3a20 4d61        region: Ma
+00010bb0: 7070 696e 675b 7374 722c 2073 6c69 6365  pping[str, slice
+00010bc0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+00010bd0: 0a20 2020 2020 2020 2073 6166 655f 6368  .        safe_ch
+00010be0: 756e 6b73 3a20 626f 6f6c 203d 2054 7275  unks: bool = Tru
+00010bf0: 652c 0a20 2020 2020 2020 2073 746f 7261  e,.        stora
+00010c00: 6765 5f6f 7074 696f 6e73 3a20 6469 6374  ge_options: dict
+00010c10: 5b73 7472 2c20 7374 725d 207c 204e 6f6e  [str, str] | Non
+00010c20: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00010c30: 2020 7a61 7272 5f76 6572 7369 6f6e 3a20    zarr_version: 
+00010c40: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
+00010c50: 652c 0a20 2020 2020 2020 2063 6875 6e6b  e,.        chunk
+00010c60: 6d61 6e61 6765 725f 7374 6f72 655f 6b77  manager_store_kw
+00010c70: 6172 6773 3a20 6469 6374 5b73 7472 2c20  args: dict[str, 
+00010c80: 416e 795d 207c 204e 6f6e 6520 3d20 4e6f  Any] | None = No
+00010c90: 6e65 2c0a 2020 2020 2920 2d3e 205a 6172  ne,.    ) -> Zar
+00010ca0: 7253 746f 7265 3a0a 2020 2020 2020 2020  rStore:.        
+00010cb0: 2e2e 2e0a 0a20 2020 2023 2063 6f6d 7075  .....    # compu
+00010cc0: 7465 3d46 616c 7365 2072 6574 7572 6e73  te=False returns
+00010cd0: 2064 6173 6b2e 4465 6c61 7965 640a 2020   dask.Delayed.  
+00010ce0: 2020 406f 7665 726c 6f61 640a 2020 2020    @overload.    
+00010cf0: 6465 6620 746f 5f7a 6172 7228 0a20 2020  def to_zarr(.   
+00010d00: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00010d10: 2020 2073 746f 7265 3a20 4d75 7461 626c     store: Mutabl
+00010d20: 654d 6170 7069 6e67 207c 2073 7472 207c  eMapping | str |
+00010d30: 2050 6174 684c 696b 655b 7374 725d 207c   PathLike[str] |
 00010d40: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00010d50: 2020 2020 2020 7265 6769 6f6e 3a20 4d61        region: Ma
-00010d60: 7070 696e 675b 7374 722c 2073 6c69 6365  pping[str, slice
-00010d70: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-00010d80: 0a20 2020 2020 2020 2073 6166 655f 6368  .        safe_ch
-00010d90: 756e 6b73 3a20 626f 6f6c 203d 2054 7275  unks: bool = Tru
-00010da0: 652c 0a20 2020 2020 2020 2073 746f 7261  e,.        stora
-00010db0: 6765 5f6f 7074 696f 6e73 3a20 6469 6374  ge_options: dict
-00010dc0: 5b73 7472 2c20 7374 725d 207c 204e 6f6e  [str, str] | Non
-00010dd0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00010de0: 2020 7a61 7272 5f76 6572 7369 6f6e 3a20    zarr_version: 
-00010df0: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
-00010e00: 652c 0a20 2020 2029 202d 3e20 5a61 7272  e,.    ) -> Zarr
-00010e10: 5374 6f72 6520 7c20 4465 6c61 7965 643a  Store | Delayed:
-00010e20: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
-00010e30: 6520 6461 7461 7365 7420 636f 6e74 656e  e dataset conten
-00010e40: 7473 2074 6f20 6120 7a61 7272 2067 726f  ts to a zarr gro
-00010e50: 7570 2e0a 0a20 2020 2020 2020 205a 6172  up...        Zar
-00010e60: 7220 6368 756e 6b73 2061 7265 2064 6574  r chunks are det
-00010e70: 6572 6d69 6e65 6420 696e 2074 6865 2066  ermined in the f
-00010e80: 6f6c 6c6f 7769 6e67 2077 6179 3a0a 0a20  ollowing way:.. 
-00010e90: 2020 2020 2020 202d 2046 726f 6d20 7468         - From th
-00010ea0: 6520 6060 6368 756e 6b73 6060 2061 7474  e ``chunks`` att
-00010eb0: 7269 6275 7465 2069 6e20 6561 6368 2076  ribute in each v
-00010ec0: 6172 6961 626c 6527 7320 6060 656e 636f  ariable's ``enco
-00010ed0: 6469 6e67 6060 0a20 2020 2020 2020 2020  ding``.         
-00010ee0: 2028 6361 6e20 6265 2073 6574 2076 6961   (can be set via
-00010ef0: 2060 4461 7461 7365 742e 6368 756e 6b60   `Dataset.chunk`
-00010f00: 292e 0a20 2020 2020 2020 202d 2049 6620  )..        - If 
-00010f10: 7468 6520 7661 7269 6162 6c65 2069 7320  the variable is 
-00010f20: 6120 4461 736b 2061 7272 6179 2c20 6672  a Dask array, fr
-00010f30: 6f6d 2074 6865 2064 6173 6b20 6368 756e  om the dask chun
-00010f40: 6b73 0a20 2020 2020 2020 202d 2049 6620  ks.        - If 
-00010f50: 6e65 6974 6865 7220 4461 736b 2063 6875  neither Dask chu
-00010f60: 6e6b 7320 6e6f 7220 656e 636f 6469 6e67  nks nor encoding
-00010f70: 2063 6875 6e6b 7320 6172 6520 7072 6573   chunks are pres
-00010f80: 656e 742c 2063 6875 6e6b 7320 7769 6c6c  ent, chunks will
-00010f90: 0a20 2020 2020 2020 2020 2062 6520 6465  .          be de
-00010fa0: 7465 726d 696e 6564 2061 7574 6f6d 6174  termined automat
-00010fb0: 6963 616c 6c79 2062 7920 5a61 7272 0a20  ically by Zarr. 
-00010fc0: 2020 2020 2020 202d 2049 6620 626f 7468         - If both
-00010fd0: 2044 6173 6b20 6368 756e 6b73 2061 6e64   Dask chunks and
-00010fe0: 2065 6e63 6f64 696e 6720 6368 756e 6b73   encoding chunks
-00010ff0: 2061 7265 2070 7265 7365 6e74 2c20 656e   are present, en
-00011000: 636f 6469 6e67 2063 6875 6e6b 730a 2020  coding chunks.  
-00011010: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-00011020: 7573 6564 2c20 7072 6f76 6964 6564 2074  used, provided t
-00011030: 6861 7420 7468 6572 6520 6973 2061 206d  hat there is a m
-00011040: 616e 792d 746f 2d6f 6e65 2072 656c 6174  any-to-one relat
-00011050: 696f 6e73 6869 7020 6265 7477 6565 6e0a  ionship between.
-00011060: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
-00011070: 6e67 2063 6875 6e6b 7320 616e 6420 6461  ng chunks and da
-00011080: 736b 2063 6875 6e6b 7320 2869 2e65 2e20  sk chunks (i.e. 
-00011090: 4461 736b 2063 6875 6e6b 7320 6172 6520  Dask chunks are 
-000110a0: 6269 6767 6572 2074 6861 6e20 616e 640a  bigger than and.
-000110b0: 2020 2020 2020 2020 2020 6576 656e 6c79            evenly
-000110c0: 2064 6976 6964 6520 656e 636f 6469 6e67   divide encoding
-000110d0: 2063 6875 6e6b 7329 3b20 6f74 6865 7277   chunks); otherw
-000110e0: 6973 6520 7261 6973 6520 6120 6060 5661  ise raise a ``Va
-000110f0: 6c75 6545 7272 6f72 6060 2e0a 2020 2020  lueError``..    
-00011100: 2020 2020 2020 5468 6973 2072 6573 7472        This restr
-00011110: 6963 7469 6f6e 2065 6e73 7572 6573 2074  iction ensures t
-00011120: 6861 7420 6e6f 2073 796e 6368 726f 6e69  hat no synchroni
-00011130: 7a61 7469 6f6e 202f 206c 6f63 6b73 2061  zation / locks a
-00011140: 7265 2072 6571 7569 7265 640a 2020 2020  re required.    
-00011150: 2020 2020 2020 7768 656e 2077 7269 7469        when writi
-00011160: 6e67 2e20 546f 2064 6973 6162 6c65 2074  ng. To disable t
-00011170: 6869 7320 7265 7374 7269 6374 696f 6e2c  his restriction,
-00011180: 2075 7365 2060 6073 6166 655f 6368 756e   use ``safe_chun
-00011190: 6b73 3d46 616c 7365 6060 2e0a 0a20 2020  ks=False``...   
-000111a0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-000111b0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000111c0: 2d2d 0a20 2020 2020 2020 2073 746f 7265  --.        store
-000111d0: 203a 204d 7574 6162 6c65 4d61 7070 696e   : MutableMappin
-000111e0: 672c 2073 7472 206f 7220 7061 7468 2d6c  g, str or path-l
-000111f0: 696b 652c 206f 7074 696f 6e61 6c0a 2020  ike, optional.  
-00011200: 2020 2020 2020 2020 2020 5374 6f72 6520            Store 
-00011210: 6f72 2070 6174 6820 746f 2064 6972 6563  or path to direc
-00011220: 746f 7279 2069 6e20 6c6f 6361 6c20 6f72  tory in local or
-00011230: 2072 656d 6f74 6520 6669 6c65 2073 7973   remote file sys
-00011240: 7465 6d2e 0a20 2020 2020 2020 2063 6875  tem..        chu
-00011250: 6e6b 5f73 746f 7265 203a 204d 7574 6162  nk_store : Mutab
-00011260: 6c65 4d61 7070 696e 672c 2073 7472 206f  leMapping, str o
-00011270: 7220 7061 7468 2d6c 696b 652c 206f 7074  r path-like, opt
-00011280: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-00011290: 2020 5374 6f72 6520 6f72 2070 6174 6820    Store or path 
-000112a0: 746f 2064 6972 6563 746f 7279 2069 6e20  to directory in 
-000112b0: 6c6f 6361 6c20 6f72 2072 656d 6f74 6520  local or remote 
-000112c0: 6669 6c65 2073 7973 7465 6d20 6f6e 6c79  file system only
-000112d0: 2066 6f72 205a 6172 720a 2020 2020 2020   for Zarr.      
-000112e0: 2020 2020 2020 6172 7261 7920 6368 756e        array chun
-000112f0: 6b73 2e20 5265 7175 6972 6573 207a 6172  ks. Requires zar
-00011300: 722d 7079 7468 6f6e 2076 322e 342e 3020  r-python v2.4.0 
-00011310: 6f72 206c 6174 6572 2e0a 2020 2020 2020  or later..      
-00011320: 2020 6d6f 6465 203a 207b 2277 222c 2022    mode : {"w", "
-00011330: 772d 222c 2022 6122 2c20 2272 2b22 2c20  w-", "a", "r+", 
-00011340: 4e6f 6e65 7d2c 206f 7074 696f 6e61 6c0a  None}, optional.
-00011350: 2020 2020 2020 2020 2020 2020 5065 7273              Pers
-00011360: 6973 7465 6e63 6520 6d6f 6465 3a20 2277  istence mode: "w
-00011370: 2220 6d65 616e 7320 6372 6561 7465 2028  " means create (
-00011380: 6f76 6572 7772 6974 6520 6966 2065 7869  overwrite if exi
-00011390: 7374 7329 3b0a 2020 2020 2020 2020 2020  sts);.          
-000113a0: 2020 2277 2d22 206d 6561 6e73 2063 7265    "w-" means cre
-000113b0: 6174 6520 2866 6169 6c20 6966 2065 7869  ate (fail if exi
-000113c0: 7374 7329 3b0a 2020 2020 2020 2020 2020  sts);.          
-000113d0: 2020 2261 2220 6d65 616e 7320 6f76 6572    "a" means over
-000113e0: 7269 6465 2065 7869 7374 696e 6720 7661  ride existing va
-000113f0: 7269 6162 6c65 7320 2863 7265 6174 6520  riables (create 
-00011400: 6966 2064 6f65 7320 6e6f 7420 6578 6973  if does not exis
-00011410: 7429 3b0a 2020 2020 2020 2020 2020 2020  t);.            
-00011420: 2272 2b22 206d 6561 6e73 206d 6f64 6966  "r+" means modif
-00011430: 7920 6578 6973 7469 6e67 2061 7272 6179  y existing array
-00011440: 202a 7661 6c75 6573 2a20 6f6e 6c79 2028   *values* only (
-00011450: 7261 6973 6520 616e 2065 7272 6f72 2069  raise an error i
-00011460: 660a 2020 2020 2020 2020 2020 2020 616e  f.            an
-00011470: 7920 6d65 7461 6461 7461 206f 7220 7368  y metadata or sh
-00011480: 6170 6573 2077 6f75 6c64 2063 6861 6e67  apes would chang
-00011490: 6529 2e0a 2020 2020 2020 2020 2020 2020  e)..            
-000114a0: 5468 6520 6465 6661 756c 7420 6d6f 6465  The default mode
-000114b0: 2069 7320 2261 2220 6966 2060 6061 7070   is "a" if ``app
-000114c0: 656e 645f 6469 6d60 6020 6973 2073 6574  end_dim`` is set
-000114d0: 2e20 4f74 6865 7277 6973 652c 2069 7420  . Otherwise, it 
-000114e0: 6973 0a20 2020 2020 2020 2020 2020 2022  is.            "
-000114f0: 722b 2220 6966 2060 6072 6567 696f 6e60  r+" if ``region`
-00011500: 6020 6973 2073 6574 2061 6e64 2060 6077  ` is set and ``w
-00011510: 2d60 6020 6f74 6865 7277 6973 652e 0a20  -`` otherwise.. 
-00011520: 2020 2020 2020 2073 796e 6368 726f 6e69         synchroni
-00011530: 7a65 7220 3a20 6f62 6a65 6374 2c20 6f70  zer : object, op
-00011540: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00011550: 2020 205a 6172 7220 6172 7261 7920 7379     Zarr array sy
-00011560: 6e63 6872 6f6e 697a 6572 2e0a 2020 2020  nchronizer..    
-00011570: 2020 2020 6772 6f75 7020 3a20 7374 722c      group : str,
-00011580: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00011590: 2020 2020 2020 4772 6f75 7020 7061 7468        Group path
-000115a0: 2e20 2861 2e6b 2e61 2e20 6070 6174 6860  . (a.k.a. `path`
-000115b0: 2069 6e20 7a61 7272 2074 6572 6d69 6e6f   in zarr termino
-000115c0: 6c6f 6779 2e29 0a20 2020 2020 2020 2065  logy.).        e
-000115d0: 6e63 6f64 696e 6720 3a20 6469 6374 2c20  ncoding : dict, 
-000115e0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-000115f0: 2020 2020 204e 6573 7465 6420 6469 6374       Nested dict
-00011600: 696f 6e61 7279 2077 6974 6820 7661 7269  ionary with vari
-00011610: 6162 6c65 206e 616d 6573 2061 7320 6b65  able names as ke
-00011620: 7973 2061 6e64 2064 6963 7469 6f6e 6172  ys and dictionar
-00011630: 6965 7320 6f66 0a20 2020 2020 2020 2020  ies of.         
-00011640: 2020 2076 6172 6961 626c 6520 7370 6563     variable spec
-00011650: 6966 6963 2065 6e63 6f64 696e 6773 2061  ific encodings a
-00011660: 7320 7661 6c75 6573 2c20 652e 672e 2c0a  s values, e.g.,.
-00011670: 2020 2020 2020 2020 2020 2020 6060 7b22              ``{"
-00011680: 6d79 5f76 6172 6961 626c 6522 3a20 7b22  my_variable": {"
-00011690: 6474 7970 6522 3a20 2269 6e74 3136 222c  dtype": "int16",
-000116a0: 2022 7363 616c 655f 6661 6374 6f72 223a   "scale_factor":
-000116b0: 2030 2e31 2c7d 2c20 2e2e 2e7d 6060 0a20   0.1,}, ...}``. 
-000116c0: 2020 2020 2020 2063 6f6d 7075 7465 203a         compute :
-000116d0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
-000116e0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000116f0: 2049 6620 5472 7565 2077 7269 7465 2061   If True write a
-00011700: 7272 6179 2064 6174 6120 696d 6d65 6469  rray data immedi
-00011710: 6174 656c 792c 206f 7468 6572 7769 7365  ately, otherwise
-00011720: 2072 6574 7572 6e20 610a 2020 2020 2020   return a.      
-00011730: 2020 2020 2020 6060 6461 736b 2e64 656c        ``dask.del
-00011740: 6179 6564 2e44 656c 6179 6564 6060 206f  ayed.Delayed`` o
-00011750: 626a 6563 7420 7468 6174 2063 616e 2062  bject that can b
-00011760: 6520 636f 6d70 7574 6564 2074 6f20 7772  e computed to wr
-00011770: 6974 650a 2020 2020 2020 2020 2020 2020  ite.            
-00011780: 6172 7261 7920 6461 7461 206c 6174 6572  array data later
-00011790: 2e20 4d65 7461 6461 7461 2069 7320 616c  . Metadata is al
-000117a0: 7761 7973 2075 7064 6174 6564 2065 6167  ways updated eag
-000117b0: 6572 6c79 2e0a 2020 2020 2020 2020 636f  erly..        co
-000117c0: 6e73 6f6c 6964 6174 6564 203a 2062 6f6f  nsolidated : boo
-000117d0: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
-000117e0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-000117f0: 2061 7070 6c79 207a 6172 7227 7320 6063   apply zarr's `c
-00011800: 6f6e 736f 6c69 6461 7465 5f6d 6574 6164  onsolidate_metad
-00011810: 6174 6160 2066 756e 6374 696f 6e20 746f  ata` function to
-00011820: 2074 6865 2073 746f 7265 0a20 2020 2020   the store.     
-00011830: 2020 2020 2020 2061 6674 6572 2077 7269         after wri
-00011840: 7469 6e67 206d 6574 6164 6174 6120 616e  ting metadata an
-00011850: 6420 7265 6164 2065 7869 7374 696e 6720  d read existing 
-00011860: 7374 6f72 6573 2077 6974 6820 636f 6e73  stores with cons
-00011870: 6f6c 6964 6174 6564 0a20 2020 2020 2020  olidated.       
-00011880: 2020 2020 206d 6574 6164 6174 613b 2069       metadata; i
-00011890: 6620 4661 6c73 652c 2064 6f20 6e6f 742e  f False, do not.
-000118a0: 2054 6865 2064 6566 6175 6c74 2028 6063   The default (`c
-000118b0: 6f6e 736f 6c69 6461 7465 643d 4e6f 6e65  onsolidated=None
-000118c0: 6029 206d 6561 6e73 0a20 2020 2020 2020  `) means.       
-000118d0: 2020 2020 2077 7269 7465 2063 6f6e 736f       write conso
-000118e0: 6c69 6461 7465 6420 6d65 7461 6461 7461  lidated metadata
-000118f0: 2061 6e64 2061 7474 656d 7074 2074 6f20   and attempt to 
-00011900: 7265 6164 2063 6f6e 736f 6c69 6461 7465  read consolidate
-00011910: 640a 2020 2020 2020 2020 2020 2020 6d65  d.            me
-00011920: 7461 6461 7461 2066 6f72 2065 7869 7374  tadata for exist
-00011930: 696e 6720 7374 6f72 6573 2028 6661 6c6c  ing stores (fall
-00011940: 696e 6720 6261 636b 2074 6f20 6e6f 6e2d  ing back to non-
-00011950: 636f 6e73 6f6c 6964 6174 6564 292e 0a0a  consolidated)...
-00011960: 2020 2020 2020 2020 2020 2020 5768 656e              When
-00011970: 2074 6865 2065 7870 6572 696d 656e 7461   the experimenta
-00011980: 6c20 6060 7a61 7272 5f76 6572 7369 6f6e  l ``zarr_version
-00011990: 3d33 6060 2c20 6060 636f 6e73 6f6c 6964  =3``, ``consolid
-000119a0: 6174 6564 6060 206d 7573 7420 6265 0a20  ated`` must be. 
-000119b0: 2020 2020 2020 2020 2020 2065 6974 6865             eithe
-000119c0: 7220 6265 2060 604e 6f6e 6560 6020 6f72  r be ``None`` or
-000119d0: 2060 6046 616c 7365 6060 2e0a 2020 2020   ``False``..    
-000119e0: 2020 2020 6170 7065 6e64 5f64 696d 203a      append_dim :
-000119f0: 2068 6173 6861 626c 652c 206f 7074 696f   hashable, optio
-00011a00: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00011a10: 4966 2073 6574 2c20 7468 6520 6469 6d65  If set, the dime
-00011a20: 6e73 696f 6e20 616c 6f6e 6720 7768 6963  nsion along whic
-00011a30: 6820 7468 6520 6461 7461 2077 696c 6c20  h the data will 
-00011a40: 6265 2061 7070 656e 6465 642e 2041 6c6c  be appended. All
-00011a50: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-00011a60: 6572 2064 696d 656e 7369 6f6e 7320 6f6e  er dimensions on
-00011a70: 206f 7665 7272 6964 6465 6e20 7661 7269   overridden vari
-00011a80: 6162 6c65 7320 6d75 7374 2072 656d 6169  ables must remai
-00011a90: 6e20 7468 6520 7361 6d65 2073 697a 652e  n the same size.
-00011aa0: 0a20 2020 2020 2020 2072 6567 696f 6e20  .        region 
-00011ab0: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
-00011ac0: 0a20 2020 2020 2020 2020 2020 204f 7074  .            Opt
-00011ad0: 696f 6e61 6c20 6d61 7070 696e 6720 6672  ional mapping fr
-00011ae0: 6f6d 2064 696d 656e 7369 6f6e 206e 616d  om dimension nam
-00011af0: 6573 2074 6f20 696e 7465 6765 7220 736c  es to integer sl
-00011b00: 6963 6573 2061 6c6f 6e67 0a20 2020 2020  ices along.     
-00011b10: 2020 2020 2020 2064 6174 6173 6574 2064         dataset d
-00011b20: 696d 656e 7369 6f6e 7320 746f 2069 6e64  imensions to ind
-00011b30: 6963 6174 6520 7468 6520 7265 6769 6f6e  icate the region
-00011b40: 206f 6620 6578 6973 7469 6e67 207a 6172   of existing zar
-00011b50: 7220 6172 7261 7928 7329 0a20 2020 2020  r array(s).     
-00011b60: 2020 2020 2020 2069 6e20 7768 6963 6820         in which 
-00011b70: 746f 2077 7269 7465 2074 6869 7320 6461  to write this da
-00011b80: 7461 7365 7427 7320 6461 7461 2e20 466f  taset's data. Fo
-00011b90: 7220 6578 616d 706c 652c 0a20 2020 2020  r example,.     
-00011ba0: 2020 2020 2020 2060 607b 2778 273a 2073         ``{'x': s
-00011bb0: 6c69 6365 2830 2c20 3130 3030 292c 2027  lice(0, 1000), '
-00011bc0: 7927 3a20 736c 6963 6528 3130 3030 302c  y': slice(10000,
-00011bd0: 2031 3130 3030 297d 6060 2077 6f75 6c64   11000)}`` would
-00011be0: 2069 6e64 6963 6174 650a 2020 2020 2020   indicate.      
-00011bf0: 2020 2020 2020 7468 6174 2076 616c 7565        that value
-00011c00: 7320 7368 6f75 6c64 2062 6520 7772 6974  s should be writ
-00011c10: 7465 6e20 746f 2074 6865 2072 6567 696f  ten to the regio
-00011c20: 6e20 6060 303a 3130 3030 6060 2061 6c6f  n ``0:1000`` alo
-00011c30: 6e67 2060 6078 6060 0a20 2020 2020 2020  ng ``x``.       
-00011c40: 2020 2020 2061 6e64 2060 6031 3030 3030       and ``10000
-00011c50: 3a31 3130 3030 6060 2061 6c6f 6e67 2060  :11000`` along `
-00011c60: 6079 6060 2e0a 0a20 2020 2020 2020 2020  `y``...         
-00011c70: 2020 2054 776f 2072 6573 7472 6963 7469     Two restricti
-00011c80: 6f6e 7320 6170 706c 7920 746f 2074 6865  ons apply to the
-00011c90: 2075 7365 206f 6620 6060 7265 6769 6f6e   use of ``region
-00011ca0: 6060 3a0a 0a20 2020 2020 2020 2020 2020  ``:..           
-00011cb0: 202d 2049 6620 6060 7265 6769 6f6e 6060   - If ``region``
-00011cc0: 2069 7320 7365 742c 205f 616c 6c5f 2076   is set, _all_ v
-00011cd0: 6172 6961 626c 6573 2069 6e20 6120 6461  ariables in a da
-00011ce0: 7461 7365 7420 6d75 7374 2068 6176 6520  taset must have 
-00011cf0: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-00011d00: 206c 6561 7374 206f 6e65 2064 696d 656e   least one dimen
-00011d10: 7369 6f6e 2069 6e20 636f 6d6d 6f6e 2077  sion in common w
-00011d20: 6974 6820 7468 6520 7265 6769 6f6e 2e20  ith the region. 
-00011d30: 4f74 6865 7220 7661 7269 6162 6c65 730a  Other variables.
-00011d40: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00011d50: 6f75 6c64 2062 6520 7772 6974 7465 6e20  ould be written 
-00011d60: 696e 2061 2073 6570 6172 6174 6520 6361  in a separate ca
-00011d70: 6c6c 2074 6f20 6060 746f 5f7a 6172 7228  ll to ``to_zarr(
-00011d80: 2960 602e 0a20 2020 2020 2020 2020 2020  )``..           
-00011d90: 202d 2044 696d 656e 7369 6f6e 7320 6361   - Dimensions ca
-00011da0: 6e6e 6f74 2062 6520 696e 636c 7564 6564  nnot be included
-00011db0: 2069 6e20 626f 7468 2060 6072 6567 696f   in both ``regio
-00011dc0: 6e60 6020 616e 640a 2020 2020 2020 2020  n`` and.        
-00011dd0: 2020 2020 2020 6060 6170 7065 6e64 5f64        ``append_d
-00011de0: 696d 6060 2061 7420 7468 6520 7361 6d65  im`` at the same
-00011df0: 2074 696d 652e 2054 6f20 6372 6561 7465   time. To create
-00011e00: 2065 6d70 7479 2061 7272 6179 7320 746f   empty arrays to
-00011e10: 2066 696c 6c0a 2020 2020 2020 2020 2020   fill.          
-00011e20: 2020 2020 696e 2077 6974 6820 6060 7265      in with ``re
-00011e30: 6769 6f6e 6060 2c20 7573 6520 6120 7365  gion``, use a se
-00011e40: 7061 7261 7465 2063 616c 6c20 746f 2060  parate call to `
-00011e50: 6074 6f5f 7a61 7272 2829 6060 2077 6974  `to_zarr()`` wit
-00011e60: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
-00011e70: 6060 636f 6d70 7574 653d 4661 6c73 6560  ``compute=False`
-00011e80: 602e 2053 6565 2022 4170 7065 6e64 696e  `. See "Appendin
-00011e90: 6720 746f 2065 7869 7374 696e 6720 5a61  g to existing Za
-00011ea0: 7272 2073 746f 7265 7322 2069 6e0a 2020  rr stores" in.  
-00011eb0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00011ec0: 7265 6665 7265 6e63 6520 646f 6375 6d65  reference docume
-00011ed0: 6e74 6174 696f 6e20 666f 7220 6675 6c6c  ntation for full
-00011ee0: 2064 6574 6169 6c73 2e0a 2020 2020 2020   details..      
-00011ef0: 2020 7361 6665 5f63 6875 6e6b 7320 3a20    safe_chunks : 
-00011f00: 626f 6f6c 2c20 6465 6661 756c 743a 2054  bool, default: T
-00011f10: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00011f20: 4966 2054 7275 652c 206f 6e6c 7920 616c  If True, only al
-00011f30: 6c6f 7720 7772 6974 6573 2074 6f20 7768  low writes to wh
-00011f40: 656e 2074 6865 7265 2069 7320 6120 6d61  en there is a ma
-00011f50: 6e79 2d74 6f2d 6f6e 6520 7265 6c61 7469  ny-to-one relati
-00011f60: 6f6e 7368 6970 0a20 2020 2020 2020 2020  onship.         
-00011f70: 2020 2062 6574 7765 656e 205a 6172 7220     between Zarr 
-00011f80: 6368 756e 6b73 2028 7370 6563 6966 6965  chunks (specifie
-00011f90: 6420 696e 2065 6e63 6f64 696e 6729 2061  d in encoding) a
-00011fa0: 6e64 2044 6173 6b20 6368 756e 6b73 2e0a  nd Dask chunks..
-00011fb0: 2020 2020 2020 2020 2020 2020 5365 7420              Set 
-00011fc0: 4661 6c73 6520 746f 206f 7665 7272 6964  False to overrid
-00011fd0: 6520 7468 6973 2072 6573 7472 6963 7469  e this restricti
-00011fe0: 6f6e 3b20 686f 7765 7665 722c 2064 6174  on; however, dat
-00011ff0: 6120 6d61 7920 6265 636f 6d65 2063 6f72  a may become cor
-00012000: 7275 7074 6564 0a20 2020 2020 2020 2020  rupted.         
-00012010: 2020 2069 6620 5a61 7272 2061 7272 6179     if Zarr array
-00012020: 7320 6172 6520 7772 6974 7465 6e20 696e  s are written in
-00012030: 2070 6172 616c 6c65 6c2e 2054 6869 7320   parallel. This 
-00012040: 6f70 7469 6f6e 206d 6179 2062 6520 7573  option may be us
-00012050: 6566 756c 2069 6e20 636f 6d62 696e 6174  eful in combinat
-00012060: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00012070: 7769 7468 2060 6063 6f6d 7075 7465 3d46  with ``compute=F
-00012080: 616c 7365 6060 2074 6f20 696e 6974 6961  alse`` to initia
-00012090: 6c69 7a65 2061 205a 6172 7220 6672 6f6d  lize a Zarr from
-000120a0: 2061 6e20 6578 6973 7469 6e67 0a20 2020   an existing.   
-000120b0: 2020 2020 2020 2020 2044 6174 6173 6574           Dataset
-000120c0: 2077 6974 6820 6172 6269 7472 6172 7920   with arbitrary 
-000120d0: 6368 756e 6b20 7374 7275 6374 7572 652e  chunk structure.
-000120e0: 0a20 2020 2020 2020 2073 746f 7261 6765  .        storage
-000120f0: 5f6f 7074 696f 6e73 203a 2064 6963 742c  _options : dict,
-00012100: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00012110: 2020 2020 2020 416e 7920 6164 6469 7469        Any additi
-00012120: 6f6e 616c 2070 6172 616d 6574 6572 7320  onal parameters 
-00012130: 666f 7220 7468 6520 7374 6f72 6167 6520  for the storage 
-00012140: 6261 636b 656e 6420 2869 676e 6f72 6564  backend (ignored
-00012150: 2066 6f72 206c 6f63 616c 0a20 2020 2020   for local.     
-00012160: 2020 2020 2020 2070 6174 6873 292e 0a20         paths).. 
-00012170: 2020 2020 2020 207a 6172 725f 7665 7273         zarr_vers
-00012180: 696f 6e20 3a20 696e 7420 6f72 204e 6f6e  ion : int or Non
-00012190: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-000121a0: 2020 2020 2020 2020 5468 6520 6465 7369          The desi
-000121b0: 7265 6420 7a61 7272 2073 7065 6320 7665  red zarr spec ve
-000121c0: 7273 696f 6e20 746f 2074 6172 6765 7420  rsion to target 
-000121d0: 2863 7572 7265 6e74 6c79 2032 206f 7220  (currently 2 or 
-000121e0: 3329 2e20 5468 650a 2020 2020 2020 2020  3). The.        
-000121f0: 2020 2020 6465 6661 756c 7420 6f66 204e      default of N
-00012200: 6f6e 6520 7769 6c6c 2061 7474 656d 7074  one will attempt
-00012210: 2074 6f20 6465 7465 726d 696e 6520 7468   to determine th
-00012220: 6520 7a61 7272 2076 6572 7369 6f6e 2066  e zarr version f
-00012230: 726f 6d0a 2020 2020 2020 2020 2020 2020  rom.            
-00012240: 6060 7374 6f72 6560 6020 7768 656e 2070  ``store`` when p
-00012250: 6f73 7369 626c 652c 206f 7468 6572 7769  ossible, otherwi
-00012260: 7365 2064 6566 6175 6c74 696e 6720 746f  se defaulting to
-00012270: 2032 2e0a 0a20 2020 2020 2020 2052 6574   2...        Ret
-00012280: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00012290: 2d2d 2d2d 0a20 2020 2020 2020 2020 2020  ----.           
-000122a0: 202a 2060 6064 6173 6b2e 6465 6c61 7965   * ``dask.delaye
-000122b0: 642e 4465 6c61 7965 6460 6020 6966 2063  d.Delayed`` if c
-000122c0: 6f6d 7075 7465 2069 7320 4661 6c73 650a  ompute is False.
-000122d0: 2020 2020 2020 2020 2020 2020 2a20 5a61              * Za
-000122e0: 7272 5374 6f72 6520 6f74 6865 7277 6973  rrStore otherwis
-000122f0: 650a 0a20 2020 2020 2020 2052 6566 6572  e..        Refer
-00012300: 656e 6365 730a 2020 2020 2020 2020 2d2d  ences.        --
-00012310: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00012320: 2068 7474 7073 3a2f 2f7a 6172 722e 7265   https://zarr.re
-00012330: 6164 7468 6564 6f63 732e 696f 2f0a 0a20  adthedocs.io/.. 
-00012340: 2020 2020 2020 204e 6f74 6573 0a20 2020         Notes.   
-00012350: 2020 2020 202d 2d2d 2d2d 0a20 2020 2020       -----.     
-00012360: 2020 205a 6172 7220 6368 756e 6b69 6e67     Zarr chunking
-00012370: 2062 6568 6176 696f 723a 0a20 2020 2020   behavior:.     
-00012380: 2020 2020 2020 2049 6620 6368 756e 6b73         If chunks
-00012390: 2061 7265 2066 6f75 6e64 2069 6e20 7468   are found in th
-000123a0: 6520 656e 636f 6469 6e67 2061 7267 756d  e encoding argum
-000123b0: 656e 7420 6f72 2061 7474 7269 6275 7465  ent or attribute
-000123c0: 0a20 2020 2020 2020 2020 2020 2063 6f72  .            cor
-000123d0: 7265 7370 6f6e 6469 6e67 2074 6f20 616e  responding to an
-000123e0: 7920 4461 7461 4172 7261 792c 2074 686f  y DataArray, tho
-000123f0: 7365 2063 6875 6e6b 7320 6172 6520 7573  se chunks are us
-00012400: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-00012410: 4966 2061 2044 6174 6141 7272 6179 2069  If a DataArray i
-00012420: 7320 6120 6461 736b 2061 7272 6179 2c20  s a dask array, 
-00012430: 6974 2069 7320 7772 6974 7465 6e20 7769  it is written wi
-00012440: 7468 2074 686f 7365 2063 6875 6e6b 732e  th those chunks.
-00012450: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00012460: 6e6f 7420 6f74 6865 7220 6368 756e 6b73  not other chunks
-00012470: 2061 7265 2066 6f75 6e64 2c20 5a61 7272   are found, Zarr
-00012480: 2075 7365 7320 6974 7320 6f77 6e20 6865   uses its own he
-00012490: 7572 6973 7469 6373 2074 6f0a 2020 2020  uristics to.    
-000124a0: 2020 2020 2020 2020 6368 6f6f 7365 2061          choose a
-000124b0: 7574 6f6d 6174 6963 2063 6875 6e6b 2073  utomatic chunk s
-000124c0: 697a 6573 2e0a 0a20 2020 2020 2020 2065  izes...        e
-000124d0: 6e63 6f64 696e 673a 0a20 2020 2020 2020  ncoding:.       
-000124e0: 2020 2020 2054 6865 2065 6e63 6f64 696e       The encodin
-000124f0: 6720 6174 7472 6962 7574 6520 2869 6620  g attribute (if 
-00012500: 6578 6973 7473 2920 6f66 2074 6865 2044  exists) of the D
-00012510: 6174 6141 7272 6179 2873 2920 7769 6c6c  ataArray(s) will
-00012520: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
-00012530: 7573 6564 2e20 4f76 6572 7269 6465 2061  used. Override a
-00012540: 6e79 2065 7869 7374 696e 6720 656e 636f  ny existing enco
-00012550: 6469 6e67 7320 6279 2070 726f 7669 6469  dings by providi
-00012560: 6e67 2074 6865 2060 6065 6e63 6f64 696e  ng the ``encodin
-00012570: 6760 6020 6b77 6172 672e 0a0a 2020 2020  g`` kwarg...    
-00012580: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00012590: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-000125a0: 2020 2020 2020 3a72 6566 3a60 696f 2e7a        :ref:`io.z
-000125b0: 6172 7260 0a20 2020 2020 2020 2020 2020  arr`.           
-000125c0: 2054 6865 2049 2f4f 2075 7365 7220 6775   The I/O user gu
-000125d0: 6964 652c 2077 6974 6820 6d6f 7265 2064  ide, with more d
-000125e0: 6574 6169 6c73 2061 6e64 2065 7861 6d70  etails and examp
-000125f0: 6c65 732e 0a20 2020 2020 2020 2022 2222  les..        """
-00012600: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
-00012610: 7272 6179 2e62 6163 6b65 6e64 732e 6170  rray.backends.ap
-00012620: 6920 696d 706f 7274 2074 6f5f 7a61 7272  i import to_zarr
-00012630: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00012640: 2074 6f5f 7a61 7272 2820 2023 2074 7970   to_zarr(  # typ
-00012650: 653a 2069 676e 6f72 655b 6361 6c6c 2d6f  e: ignore[call-o
-00012660: 7665 726c 6f61 642c 6d69 7363 5d0a 2020  verload,misc].  
-00012670: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
-00012680: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
-00012690: 653d 7374 6f72 652c 0a20 2020 2020 2020  e=store,.       
-000126a0: 2020 2020 2063 6875 6e6b 5f73 746f 7265       chunk_store
-000126b0: 3d63 6875 6e6b 5f73 746f 7265 2c0a 2020  =chunk_store,.  
-000126c0: 2020 2020 2020 2020 2020 7374 6f72 6167            storag
-000126d0: 655f 6f70 7469 6f6e 733d 7374 6f72 6167  e_options=storag
-000126e0: 655f 6f70 7469 6f6e 732c 0a20 2020 2020  e_options,.     
-000126f0: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
-00012700: 2c0a 2020 2020 2020 2020 2020 2020 7379  ,.            sy
-00012710: 6e63 6872 6f6e 697a 6572 3d73 796e 6368  nchronizer=synch
-00012720: 726f 6e69 7a65 722c 0a20 2020 2020 2020  ronizer,.       
-00012730: 2020 2020 2067 726f 7570 3d67 726f 7570       group=group
-00012740: 2c0a 2020 2020 2020 2020 2020 2020 656e  ,.            en
-00012750: 636f 6469 6e67 3d65 6e63 6f64 696e 672c  coding=encoding,
-00012760: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-00012770: 7075 7465 3d63 6f6d 7075 7465 2c0a 2020  pute=compute,.  
-00012780: 2020 2020 2020 2020 2020 636f 6e73 6f6c            consol
-00012790: 6964 6174 6564 3d63 6f6e 736f 6c69 6461  idated=consolida
-000127a0: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-000127b0: 2061 7070 656e 645f 6469 6d3d 6170 7065   append_dim=appe
-000127c0: 6e64 5f64 696d 2c0a 2020 2020 2020 2020  nd_dim,.        
-000127d0: 2020 2020 7265 6769 6f6e 3d72 6567 696f      region=regio
-000127e0: 6e2c 0a20 2020 2020 2020 2020 2020 2073  n,.            s
-000127f0: 6166 655f 6368 756e 6b73 3d73 6166 655f  afe_chunks=safe_
-00012800: 6368 756e 6b73 2c0a 2020 2020 2020 2020  chunks,.        
-00012810: 2020 2020 7a61 7272 5f76 6572 7369 6f6e      zarr_version
-00012820: 3d7a 6172 725f 7665 7273 696f 6e2c 0a20  =zarr_version,. 
-00012830: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00012840: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-00012850: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-00012860: 2072 6574 7572 6e20 666f 726d 6174 7469   return formatti
-00012870: 6e67 2e64 6174 6173 6574 5f72 6570 7228  ng.dataset_repr(
-00012880: 7365 6c66 290a 0a20 2020 2064 6566 205f  self)..    def _
-00012890: 7265 7072 5f68 746d 6c5f 2873 656c 6629  repr_html_(self)
-000128a0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-000128b0: 2069 6620 4f50 5449 4f4e 535b 2264 6973   if OPTIONS["dis
-000128c0: 706c 6179 5f73 7479 6c65 225d 203d 3d20  play_style"] == 
-000128d0: 2274 6578 7422 3a0a 2020 2020 2020 2020  "text":.        
-000128e0: 2020 2020 7265 7475 726e 2066 223c 7072      return f"<pr
-000128f0: 653e 7b65 7363 6170 6528 7265 7072 2873  e>{escape(repr(s
-00012900: 656c 6629 297d 3c2f 7072 653e 220a 2020  elf))}</pre>".  
-00012910: 2020 2020 2020 7265 7475 726e 2066 6f72        return for
-00012920: 6d61 7474 696e 675f 6874 6d6c 2e64 6174  matting_html.dat
-00012930: 6173 6574 5f72 6570 7228 7365 6c66 290a  aset_repr(self).
-00012940: 0a20 2020 2064 6566 2069 6e66 6f28 7365  .    def info(se
-00012950: 6c66 2c20 6275 663a 2049 4f20 7c20 4e6f  lf, buf: IO | No
-00012960: 6e65 203d 204e 6f6e 6529 202d 3e20 4e6f  ne = None) -> No
-00012970: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00012980: 2020 2020 2020 2020 436f 6e63 6973 6520          Concise 
-00012990: 7375 6d6d 6172 7920 6f66 2061 2044 6174  summary of a Dat
-000129a0: 6173 6574 2076 6172 6961 626c 6573 2061  aset variables a
-000129b0: 6e64 2061 7474 7269 6275 7465 732e 0a0a  nd attributes...
-000129c0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000129d0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-000129e0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6275  -----.        bu
-000129f0: 6620 3a20 6669 6c65 2d6c 696b 652c 2064  f : file-like, d
-00012a00: 6566 6175 6c74 3a20 7379 732e 7374 646f  efault: sys.stdo
-00012a10: 7574 0a20 2020 2020 2020 2020 2020 2077  ut.            w
-00012a20: 7269 7461 626c 6520 6275 6666 6572 0a0a  ritable buffer..
-00012a30: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-00012a40: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00012a50: 2d0a 2020 2020 2020 2020 7061 6e64 6173  -.        pandas
-00012a60: 2e44 6174 6146 7261 6d65 2e61 7373 6967  .DataFrame.assig
-00012a70: 6e0a 2020 2020 2020 2020 6e63 6475 6d70  n.        ncdump
-00012a80: 203a 206e 6574 4344 4627 7320 6e63 6475   : netCDF's ncdu
-00012a90: 6d70 0a20 2020 2020 2020 2022 2222 0a20  mp.        """. 
-00012aa0: 2020 2020 2020 2069 6620 6275 6620 6973         if buf is
-00012ab0: 204e 6f6e 653a 2020 2320 7072 6167 6d61   None:  # pragma
-00012ac0: 3a20 6e6f 2063 6f76 6572 0a20 2020 2020  : no cover.     
-00012ad0: 2020 2020 2020 2062 7566 203d 2073 7973         buf = sys
-00012ae0: 2e73 7464 6f75 740a 0a20 2020 2020 2020  .stdout..       
-00012af0: 206c 696e 6573 203d 205b 5d0a 2020 2020   lines = [].    
-00012b00: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
-00012b10: 2822 7861 7272 6179 2e44 6174 6173 6574  ("xarray.Dataset
-00012b20: 207b 2229 0a20 2020 2020 2020 206c 696e   {").        lin
-00012b30: 6573 2e61 7070 656e 6428 2264 696d 656e  es.append("dimen
-00012b40: 7369 6f6e 733a 2229 0a20 2020 2020 2020  sions:").       
-00012b50: 2066 6f72 206e 616d 652c 2073 697a 6520   for name, size 
-00012b60: 696e 2073 656c 662e 6469 6d73 2e69 7465  in self.dims.ite
-00012b70: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00012b80: 2020 6c69 6e65 732e 6170 7065 6e64 2866    lines.append(f
-00012b90: 225c 747b 6e61 6d65 7d20 3d20 7b73 697a  "\t{name} = {siz
-00012ba0: 657d 203b 2229 0a20 2020 2020 2020 206c  e} ;").        l
-00012bb0: 696e 6573 2e61 7070 656e 6428 225c 6e76  ines.append("\nv
-00012bc0: 6172 6961 626c 6573 3a22 290a 2020 2020  ariables:").    
-00012bd0: 2020 2020 666f 7220 6e61 6d65 2c20 6461      for name, da
-00012be0: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
-00012bf0: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-00012c00: 2020 2020 2020 2020 6469 6d73 203d 2022          dims = "
-00012c10: 2c20 222e 6a6f 696e 286d 6170 2873 7472  , ".join(map(str
-00012c20: 2c20 6461 2e64 696d 7329 290a 2020 2020  , da.dims)).    
-00012c30: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
-00012c40: 7065 6e64 2866 225c 747b 6461 2e64 7479  pend(f"\t{da.dty
-00012c50: 7065 7d20 7b6e 616d 657d 287b 6469 6d73  pe} {name}({dims
-00012c60: 7d29 203b 2229 0a20 2020 2020 2020 2020  }) ;").         
-00012c70: 2020 2066 6f72 206b 2c20 7620 696e 2064     for k, v in d
-00012c80: 612e 6174 7472 732e 6974 656d 7328 293a  a.attrs.items():
-00012c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ca0: 206c 696e 6573 2e61 7070 656e 6428 6622   lines.append(f"
-00012cb0: 5c74 5c74 7b6e 616d 657d 3a7b 6b7d 203d  \t\t{name}:{k} =
-00012cc0: 207b 767d 203b 2229 0a20 2020 2020 2020   {v} ;").       
-00012cd0: 206c 696e 6573 2e61 7070 656e 6428 225c   lines.append("\
-00012ce0: 6e2f 2f20 676c 6f62 616c 2061 7474 7269  n// global attri
-00012cf0: 6275 7465 733a 2229 0a20 2020 2020 2020  butes:").       
-00012d00: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-00012d10: 662e 6174 7472 732e 6974 656d 7328 293a  f.attrs.items():
-00012d20: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-00012d30: 6573 2e61 7070 656e 6428 6622 5c74 3a7b  es.append(f"\t:{
-00012d40: 6b7d 203d 207b 767d 203b 2229 0a20 2020  k} = {v} ;").   
-00012d50: 2020 2020 206c 696e 6573 2e61 7070 656e       lines.appen
-00012d60: 6428 227d 2229 0a0a 2020 2020 2020 2020  d("}")..        
-00012d70: 6275 662e 7772 6974 6528 225c 6e22 2e6a  buf.write("\n".j
-00012d80: 6f69 6e28 6c69 6e65 7329 290a 0a20 2020  oin(lines))..   
-00012d90: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00012da0: 6566 2063 6875 6e6b 7328 7365 6c66 2920  ef chunks(self) 
-00012db0: 2d3e 204d 6170 7069 6e67 5b48 6173 6861  -> Mapping[Hasha
-00012dc0: 626c 652c 2074 7570 6c65 5b69 6e74 2c20  ble, tuple[int, 
-00012dd0: 2e2e 2e5d 5d3a 0a20 2020 2020 2020 2022  ...]]:.        "
-00012de0: 2222 0a20 2020 2020 2020 204d 6170 7069  "".        Mappi
-00012df0: 6e67 2066 726f 6d20 6469 6d65 6e73 696f  ng from dimensio
-00012e00: 6e20 6e61 6d65 7320 746f 2062 6c6f 636b  n names to block
-00012e10: 206c 656e 6774 6873 2066 6f72 2074 6869   lengths for thi
-00012e20: 7320 6461 7461 7365 7427 7320 6461 7461  s dataset's data
-00012e30: 2c20 6f72 204e 6f6e 6520 6966 0a20 2020  , or None if.   
-00012e40: 2020 2020 2074 6865 2075 6e64 6572 6c79       the underly
-00012e50: 696e 6720 6461 7461 2069 7320 6e6f 7420  ing data is not 
-00012e60: 6120 6461 736b 2061 7272 6179 2e0a 2020  a dask array..  
-00012e70: 2020 2020 2020 4361 6e6e 6f74 2062 6520        Cannot be 
-00012e80: 6d6f 6469 6669 6564 2064 6972 6563 746c  modified directl
-00012e90: 792c 2062 7574 2063 616e 2062 6520 6d6f  y, but can be mo
-00012ea0: 6469 6669 6564 2062 7920 6361 6c6c 696e  dified by callin
-00012eb0: 6720 2e63 6875 6e6b 2829 2e0a 0a20 2020  g .chunk()...   
-00012ec0: 2020 2020 2053 616d 6520 6173 2044 6174       Same as Dat
-00012ed0: 6173 6574 2e63 6875 6e6b 7369 7a65 732c  aset.chunksizes,
-00012ee0: 2062 7574 206d 6169 6e74 6169 6e65 6420   but maintained 
-00012ef0: 666f 7220 6261 636b 7761 7264 7320 636f  for backwards co
-00012f00: 6d70 6174 6962 696c 6974 792e 0a0a 2020  mpatibility...  
-00012f10: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
-00012f20: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-00012f30: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
-00012f40: 6368 756e 6b0a 2020 2020 2020 2020 4461  chunk.        Da
-00012f50: 7461 7365 742e 6368 756e 6b73 697a 6573  taset.chunksizes
-00012f60: 0a20 2020 2020 2020 2078 6172 7261 792e  .        xarray.
-00012f70: 756e 6966 795f 6368 756e 6b73 0a20 2020  unify_chunks.   
-00012f80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00012f90: 2072 6574 7572 6e20 6765 745f 6368 756e   return get_chun
-00012fa0: 6b73 697a 6573 2873 656c 662e 7661 7269  ksizes(self.vari
-00012fb0: 6162 6c65 732e 7661 6c75 6573 2829 290a  ables.values()).
-00012fc0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00012fd0: 2020 2064 6566 2063 6875 6e6b 7369 7a65     def chunksize
-00012fe0: 7328 7365 6c66 2920 2d3e 204d 6170 7069  s(self) -> Mappi
-00012ff0: 6e67 5b48 6173 6861 626c 652c 2074 7570  ng[Hashable, tup
-00013000: 6c65 5b69 6e74 2c20 2e2e 2e5d 5d3a 0a20  le[int, ...]]:. 
-00013010: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013020: 2020 204d 6170 7069 6e67 2066 726f 6d20     Mapping from 
-00013030: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
-00013040: 746f 2062 6c6f 636b 206c 656e 6774 6873  to block lengths
-00013050: 2066 6f72 2074 6869 7320 6461 7461 7365   for this datase
-00013060: 7427 7320 6461 7461 2c20 6f72 204e 6f6e  t's data, or Non
-00013070: 6520 6966 0a20 2020 2020 2020 2074 6865  e if.        the
-00013080: 2075 6e64 6572 6c79 696e 6720 6461 7461   underlying data
-00013090: 2069 7320 6e6f 7420 6120 6461 736b 2061   is not a dask a
-000130a0: 7272 6179 2e0a 2020 2020 2020 2020 4361  rray..        Ca
-000130b0: 6e6e 6f74 2062 6520 6d6f 6469 6669 6564  nnot be modified
-000130c0: 2064 6972 6563 746c 792c 2062 7574 2063   directly, but c
-000130d0: 616e 2062 6520 6d6f 6469 6669 6564 2062  an be modified b
-000130e0: 7920 6361 6c6c 696e 6720 2e63 6875 6e6b  y calling .chunk
-000130f0: 2829 2e0a 0a20 2020 2020 2020 2053 616d  ()...        Sam
-00013100: 6520 6173 2044 6174 6173 6574 2e63 6875  e as Dataset.chu
-00013110: 6e6b 732e 0a0a 2020 2020 2020 2020 5365  nks...        Se
-00013120: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00013130: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00013140: 4461 7461 7365 742e 6368 756e 6b0a 2020  Dataset.chunk.  
-00013150: 2020 2020 2020 4461 7461 7365 742e 6368        Dataset.ch
-00013160: 756e 6b73 0a20 2020 2020 2020 2078 6172  unks.        xar
-00013170: 7261 792e 756e 6966 795f 6368 756e 6b73  ray.unify_chunks
-00013180: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013190: 2020 2020 2072 6574 7572 6e20 6765 745f       return get_
-000131a0: 6368 756e 6b73 697a 6573 2873 656c 662e  chunksizes(self.
-000131b0: 7661 7269 6162 6c65 732e 7661 6c75 6573  variables.values
-000131c0: 2829 290a 0a20 2020 2064 6566 2063 6875  ())..    def chu
-000131d0: 6e6b 280a 2020 2020 2020 2020 7365 6c66  nk(.        self
-000131e0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-000131f0: 2020 2020 2063 6875 6e6b 733a 2028 0a20       chunks: (. 
-00013200: 2020 2020 2020 2020 2020 2069 6e74 207c             int |
-00013210: 204c 6974 6572 616c 5b22 6175 746f 225d   Literal["auto"]
-00013220: 207c 204d 6170 7069 6e67 5b41 6e79 2c20   | Mapping[Any, 
-00013230: 4e6f 6e65 207c 2069 6e74 207c 2073 7472  None | int | str
-00013240: 207c 2074 7570 6c65 5b69 6e74 2c20 2e2e   | tuple[int, ..
-00013250: 2e5d 5d0a 2020 2020 2020 2020 2920 3d20  .]].        ) = 
-00013260: 7b7d 2c20 2023 207b 7d20 6576 656e 2074  {},  # {} even t
-00013270: 686f 7567 6820 6974 2773 2074 6563 686e  hough it's techn
-00013280: 6963 616c 6c79 2075 6e73 6166 652c 2069  ically unsafe, i
-00013290: 7320 6265 696e 6720 7573 6564 2069 6e74  s being used int
-000132a0: 656e 7469 6f6e 616c 6c79 2068 6572 6520  entionally here 
-000132b0: 2823 3436 3637 290a 2020 2020 2020 2020  (#4667).        
-000132c0: 6e61 6d65 5f70 7265 6669 783a 2073 7472  name_prefix: str
-000132d0: 203d 2022 7861 7272 6179 2d22 2c0a 2020   = "xarray-",.  
-000132e0: 2020 2020 2020 746f 6b65 6e3a 2073 7472        token: str
-000132f0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00013300: 2020 2020 2020 2020 6c6f 636b 3a20 626f          lock: bo
-00013310: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00013320: 2020 2020 696e 6c69 6e65 5f61 7272 6179      inline_array
-00013330: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00013340: 2020 2020 2020 2020 2a2a 6368 756e 6b73          **chunks
-00013350: 5f6b 7761 7267 733a 204e 6f6e 6520 7c20  _kwargs: None | 
-00013360: 696e 7420 7c20 7374 7220 7c20 7475 706c  int | str | tupl
-00013370: 655b 696e 742c 202e 2e2e 5d2c 0a20 2020  e[int, ...],.   
-00013380: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-00013390: 0a20 2020 2020 2020 2022 2222 436f 6572  .        """Coer
-000133a0: 6365 2061 6c6c 2061 7272 6179 7320 696e  ce all arrays in
-000133b0: 2074 6869 7320 6461 7461 7365 7420 696e   this dataset in
-000133c0: 746f 2064 6173 6b20 6172 7261 7973 2077  to dask arrays w
-000133d0: 6974 6820 7468 6520 6769 7665 6e0a 2020  ith the given.  
-000133e0: 2020 2020 2020 6368 756e 6b73 2e0a 0a20        chunks... 
-000133f0: 2020 2020 2020 204e 6f6e 2d64 6173 6b20         Non-dask 
-00013400: 6172 7261 7973 2069 6e20 7468 6973 2064  arrays in this d
-00013410: 6174 6173 6574 2077 696c 6c20 6265 2063  ataset will be c
-00013420: 6f6e 7665 7274 6564 2074 6f20 6461 736b  onverted to dask
-00013430: 2061 7272 6179 732e 2044 6173 6b0a 2020   arrays. Dask.  
-00013440: 2020 2020 2020 6172 7261 7973 2077 696c        arrays wil
-00013450: 6c20 6265 2072 6563 6875 6e6b 6564 2074  l be rechunked t
-00013460: 6f20 7468 6520 6769 7665 6e20 6368 756e  o the given chun
-00013470: 6b20 7369 7a65 732e 0a0a 2020 2020 2020  k sizes...      
-00013480: 2020 4966 206e 6569 7468 6572 2063 6875    If neither chu
-00013490: 6e6b 7320 6973 206e 6f74 2070 726f 7669  nks is not provi
-000134a0: 6465 6420 666f 7220 6f6e 6520 6f72 206d  ded for one or m
-000134b0: 6f72 6520 6469 6d65 6e73 696f 6e73 2c20  ore dimensions, 
-000134c0: 6368 756e 6b0a 2020 2020 2020 2020 7369  chunk.        si
-000134d0: 7a65 7320 616c 6f6e 6720 7468 6174 2064  zes along that d
-000134e0: 696d 656e 7369 6f6e 2077 696c 6c20 6e6f  imension will no
-000134f0: 7420 6265 2075 7064 6174 6564 3b20 6e6f  t be updated; no
-00013500: 6e2d 6461 736b 2061 7272 6179 7320 7769  n-dask arrays wi
-00013510: 6c6c 2062 650a 2020 2020 2020 2020 636f  ll be.        co
-00013520: 6e76 6572 7465 6420 696e 746f 2064 6173  nverted into das
-00013530: 6b20 6172 7261 7973 2077 6974 6820 6120  k arrays with a 
-00013540: 7369 6e67 6c65 2062 6c6f 636b 2e0a 0a20  single block... 
-00013550: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00013560: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00013570: 2d2d 2d2d 0a20 2020 2020 2020 2063 6875  ----.        chu
-00013580: 6e6b 7320 3a20 696e 742c 2074 7570 6c65  nks : int, tuple
-00013590: 206f 6620 696e 742c 2022 6175 746f 2220   of int, "auto" 
-000135a0: 6f72 206d 6170 7069 6e67 206f 6620 6861  or mapping of ha
-000135b0: 7368 6162 6c65 2074 6f20 696e 742c 206f  shable to int, o
-000135c0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-000135d0: 2020 2020 4368 756e 6b20 7369 7a65 7320      Chunk sizes 
-000135e0: 616c 6f6e 6720 6561 6368 2064 696d 656e  along each dimen
-000135f0: 7369 6f6e 2c20 652e 672e 2c20 6060 3560  sion, e.g., ``5`
-00013600: 602c 2060 6022 6175 746f 2260 602c 206f  `, ``"auto"``, o
-00013610: 720a 2020 2020 2020 2020 2020 2020 6060  r.            ``
-00013620: 7b22 7822 3a20 352c 2022 7922 3a20 357d  {"x": 5, "y": 5}
-00013630: 6060 2e0a 2020 2020 2020 2020 6e61 6d65  ``..        name
-00013640: 5f70 7265 6669 7820 3a20 7374 722c 2064  _prefix : str, d
-00013650: 6566 6175 6c74 3a20 2278 6172 7261 792d  efault: "xarray-
-00013660: 220a 2020 2020 2020 2020 2020 2020 5072  ".            Pr
-00013670: 6566 6978 2066 6f72 2074 6865 206e 616d  efix for the nam
-00013680: 6520 6f66 2061 6e79 206e 6577 2064 6173  e of any new das
-00013690: 6b20 6172 7261 7973 2e0a 2020 2020 2020  k arrays..      
-000136a0: 2020 746f 6b65 6e20 3a20 7374 722c 206f    token : str, o
-000136b0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-000136c0: 2020 2020 546f 6b65 6e20 756e 6971 7565      Token unique
-000136d0: 6c79 2069 6465 6e74 6966 7969 6e67 2074  ly identifying t
-000136e0: 6869 7320 6461 7461 7365 742e 0a20 2020  his dataset..   
-000136f0: 2020 2020 206c 6f63 6b20 3a20 626f 6f6c       lock : bool
-00013700: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
-00013710: 0a20 2020 2020 2020 2020 2020 2050 6173  .            Pas
-00013720: 7365 6420 6f6e 2074 6f20 3a70 793a 6675  sed on to :py:fu
-00013730: 6e63 3a60 6461 736b 2e61 7272 6179 2e66  nc:`dask.array.f
-00013740: 726f 6d5f 6172 7261 7960 2c20 6966 2074  rom_array`, if t
-00013750: 6865 2061 7272 6179 2069 7320 6e6f 740a  he array is not.
-00013760: 2020 2020 2020 2020 2020 2020 616c 7265              alre
-00013770: 6164 7920 6173 2064 6173 6b20 6172 7261  ady as dask arra
-00013780: 792e 0a20 2020 2020 2020 2069 6e6c 696e  y..        inlin
-00013790: 655f 6172 7261 793a 2062 6f6f 6c2c 2064  e_array: bool, d
-000137a0: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
-000137b0: 2020 2020 2020 2020 2020 5061 7373 6564            Passed
-000137c0: 206f 6e20 746f 203a 7079 3a66 756e 633a   on to :py:func:
-000137d0: 6064 6173 6b2e 6172 7261 792e 6672 6f6d  `dask.array.from
-000137e0: 5f61 7272 6179 602c 2069 6620 7468 6520  _array`, if the 
-000137f0: 6172 7261 7920 6973 206e 6f74 0a20 2020  array is not.   
-00013800: 2020 2020 2020 2020 2061 6c72 6561 6479           already
-00013810: 2061 7320 6461 736b 2061 7272 6179 2e0a   as dask array..
-00013820: 2020 2020 2020 2020 2a2a 6368 756e 6b73          **chunks
-00013830: 5f6b 7761 7267 7320 3a20 7b64 696d 3a20  _kwargs : {dim: 
-00013840: 6368 756e 6b73 2c20 2e2e 2e7d 2c20 6f70  chunks, ...}, op
-00013850: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00013860: 2020 2054 6865 206b 6579 776f 7264 2061     The keyword a
-00013870: 7267 756d 656e 7473 2066 6f72 6d20 6f66  rguments form of
-00013880: 2060 6063 6875 6e6b 7360 602e 0a20 2020   ``chunks``..   
-00013890: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
-000138a0: 6368 756e 6b73 206f 7220 6368 756e 6b73  chunks or chunks
-000138b0: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
-000138c0: 7072 6f76 6964 6564 0a0a 2020 2020 2020  provided..      
-000138d0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-000138e0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-000138f0: 2020 6368 756e 6b65 6420 3a20 7861 7272    chunked : xarr
-00013900: 6179 2e44 6174 6173 6574 0a0a 2020 2020  ay.Dataset..    
-00013910: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00013920: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00013930: 2020 2020 2020 4461 7461 7365 742e 6368        Dataset.ch
-00013940: 756e 6b73 0a20 2020 2020 2020 2044 6174  unks.        Dat
-00013950: 6173 6574 2e63 6875 6e6b 7369 7a65 730a  aset.chunksizes.
-00013960: 2020 2020 2020 2020 7861 7272 6179 2e75          xarray.u
-00013970: 6e69 6679 5f63 6875 6e6b 730a 2020 2020  nify_chunks.    
-00013980: 2020 2020 6461 736b 2e61 7272 6179 2e66      dask.array.f
-00013990: 726f 6d5f 6172 7261 790a 2020 2020 2020  rom_array.      
-000139a0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-000139b0: 2063 6875 6e6b 7320 6973 204e 6f6e 6520   chunks is None 
-000139c0: 616e 6420 6368 756e 6b73 5f6b 7761 7267  and chunks_kwarg
-000139d0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-000139e0: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
-000139f0: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
-00013a00: 2020 2020 2020 224e 6f6e 6520 7661 6c75        "None valu
-00013a10: 6520 666f 7220 2763 6875 6e6b 7327 2069  e for 'chunks' i
-00013a20: 7320 6465 7072 6563 6174 6564 2e20 220a  s deprecated. ".
-00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a40: 2249 7420 7769 6c6c 2072 6169 7365 2061  "It will raise a
-00013a50: 6e20 6572 726f 7220 696e 2074 6865 2066  n error in the f
-00013a60: 7574 7572 652e 2055 7365 2069 6e73 7465  uture. Use inste
-00013a70: 6164 2027 7b7d 2722 2c0a 2020 2020 2020  ad '{}'",.      
-00013a80: 2020 2020 2020 2020 2020 6361 7465 676f            catego
-00013a90: 7279 3d46 7574 7572 6557 6172 6e69 6e67  ry=FutureWarning
-00013aa0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00013ab0: 2020 2020 2020 2020 2020 2020 6368 756e              chun
-00013ac0: 6b73 203d 207b 7d0a 0a20 2020 2020 2020  ks = {}..       
-00013ad0: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
-00013ae0: 6875 6e6b 732c 2028 4e75 6d62 6572 2c20  hunks, (Number, 
-00013af0: 7374 722c 2069 6e74 2929 3a0a 2020 2020  str, int)):.    
-00013b00: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
-00013b10: 2064 6963 742e 6672 6f6d 6b65 7973 2873   dict.fromkeys(s
-00013b20: 656c 662e 6469 6d73 2c20 6368 756e 6b73  elf.dims, chunks
-00013b30: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00013b40: 2020 2020 2020 2020 2020 2020 6368 756e              chun
-00013b50: 6b73 203d 2065 6974 6865 725f 6469 6374  ks = either_dict
-00013b60: 5f6f 725f 6b77 6172 6773 2863 6875 6e6b  _or_kwargs(chunk
-00013b70: 732c 2063 6875 6e6b 735f 6b77 6172 6773  s, chunks_kwargs
-00013b80: 2c20 2263 6875 6e6b 2229 0a0a 2020 2020  , "chunk")..    
-00013b90: 2020 2020 6261 645f 6469 6d73 203d 2063      bad_dims = c
-00013ba0: 6875 6e6b 732e 6b65 7973 2829 202d 2073  hunks.keys() - s
-00013bb0: 656c 662e 6469 6d73 2e6b 6579 7328 290a  elf.dims.keys().
-00013bc0: 2020 2020 2020 2020 6966 2062 6164 5f64          if bad_d
-00013bd0: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
-00013be0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00013bf0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00013c00: 2020 2066 2273 6f6d 6520 6368 756e 6b73     f"some chunks
-00013c10: 206b 6579 7320 6172 6520 6e6f 7420 6469   keys are not di
-00013c20: 6d65 6e73 696f 6e73 206f 6e20 7468 6973  mensions on this
-00013c30: 206f 626a 6563 743a 207b 6261 645f 6469   object: {bad_di
-00013c40: 6d73 7d22 0a20 2020 2020 2020 2020 2020  ms}".           
-00013c50: 2029 0a0a 2020 2020 2020 2020 7661 7269   )..        vari
-00013c60: 6162 6c65 7320 3d20 7b0a 2020 2020 2020  ables = {.      
-00013c70: 2020 2020 2020 6b3a 205f 6d61 7962 655f        k: _maybe_
-00013c80: 6368 756e 6b28 6b2c 2076 2c20 6368 756e  chunk(k, v, chun
-00013c90: 6b73 2c20 746f 6b65 6e2c 206c 6f63 6b2c  ks, token, lock,
-00013ca0: 206e 616d 655f 7072 6566 6978 290a 2020   name_prefix).  
-00013cb0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
-00013cc0: 2076 2069 6e20 7365 6c66 2e76 6172 6961   v in self.varia
-00013cd0: 626c 6573 2e69 7465 6d73 2829 0a20 2020  bles.items().   
-00013ce0: 2020 2020 207d 0a20 2020 2020 2020 2072       }.        r
-00013cf0: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
-00013d00: 6163 6528 7661 7269 6162 6c65 7329 0a0a  ace(variables)..
-00013d10: 2020 2020 6465 6620 5f76 616c 6964 6174      def _validat
-00013d20: 655f 696e 6465 7865 7273 280a 2020 2020  e_indexers(.    
-00013d30: 2020 2020 7365 6c66 2c20 696e 6465 7865      self, indexe
-00013d40: 7273 3a20 4d61 7070 696e 675b 416e 792c  rs: Mapping[Any,
-00013d50: 2041 6e79 5d2c 206d 6973 7369 6e67 5f64   Any], missing_d
-00013d60: 696d 733a 2045 7272 6f72 4f70 7469 6f6e  ims: ErrorOption
-00013d70: 7357 6974 6857 6172 6e20 3d20 2272 6169  sWithWarn = "rai
-00013d80: 7365 220a 2020 2020 2920 2d3e 2049 7465  se".    ) -> Ite
-00013d90: 7261 746f 725b 7475 706c 655b 4861 7368  rator[tuple[Hash
-00013da0: 6162 6c65 2c20 696e 7420 7c20 736c 6963  able, int | slic
-00013db0: 6520 7c20 6e70 2e6e 6461 7272 6179 207c  e | np.ndarray |
-00013dc0: 2056 6172 6961 626c 655d 5d3a 0a20 2020   Variable]]:.   
-00013dd0: 2020 2020 2022 2222 4865 7265 2077 6520       """Here we 
-00013de0: 6d61 6b65 2073 7572 650a 2020 2020 2020  make sure.      
-00013df0: 2020 2b20 696e 6465 7865 7220 6861 7320    + indexer has 
-00013e00: 6120 7661 6c69 6420 6b65 7973 0a20 2020  a valid keys.   
-00013e10: 2020 2020 202b 2069 6e64 6578 6572 2069       + indexer i
-00013e20: 7320 696e 2061 2076 616c 6964 2064 6174  s in a valid dat
-00013e30: 6120 7479 7065 0a20 2020 2020 2020 202b  a type.        +
-00013e40: 2073 7472 696e 6720 696e 6465 7865 7273   string indexers
-00013e50: 2061 7265 2063 6173 7420 746f 2074 6865   are cast to the
-00013e60: 2061 7070 726f 7072 6961 7465 2064 6174   appropriate dat
-00013e70: 6520 7479 7065 2069 6620 7468 650a 2020  e type if the.  
-00013e80: 2020 2020 2020 2020 6173 736f 6369 6174          associat
-00013e90: 6564 2069 6e64 6578 2069 7320 6120 4461  ed index is a Da
-00013ea0: 7465 7469 6d65 496e 6465 7820 6f72 2043  tetimeIndex or C
-00013eb0: 4654 696d 6549 6e64 6578 0a20 2020 2020  FTimeIndex.     
-00013ec0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00013ed0: 726f 6d20 7861 7272 6179 2e63 6f64 696e  rom xarray.codin
-00013ee0: 672e 6366 7469 6d65 696e 6465 7820 696d  g.cftimeindex im
-00013ef0: 706f 7274 2043 4654 696d 6549 6e64 6578  port CFTimeIndex
-00013f00: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
-00013f10: 7272 6179 2e63 6f72 652e 6461 7461 6172  rray.core.dataar
-00013f20: 7261 7920 696d 706f 7274 2044 6174 6141  ray import DataA
-00013f30: 7272 6179 0a0a 2020 2020 2020 2020 696e  rray..        in
-00013f40: 6465 7865 7273 203d 2064 726f 705f 6469  dexers = drop_di
-00013f50: 6d73 5f66 726f 6d5f 696e 6465 7865 7273  ms_from_indexers
-00013f60: 2869 6e64 6578 6572 732c 2073 656c 662e  (indexers, self.
-00013f70: 6469 6d73 2c20 6d69 7373 696e 675f 6469  dims, missing_di
-00013f80: 6d73 290a 0a20 2020 2020 2020 2023 2061  ms)..        # a
-00013f90: 6c6c 2069 6e64 6578 6572 7320 7368 6f75  ll indexers shou
-00013fa0: 6c64 2062 6520 696e 742c 2073 6c69 6365  ld be int, slice
-00013fb0: 2c20 6e70 2e6e 6461 7272 6179 732c 206f  , np.ndarrays, o
-00013fc0: 7220 5661 7269 6162 6c65 0a20 2020 2020  r Variable.     
-00013fd0: 2020 2066 6f72 206b 2c20 7620 696e 2069     for k, v in i
-00013fe0: 6e64 6578 6572 732e 6974 656d 7328 293a  ndexers.items():
-00013ff0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00014000: 6973 696e 7374 616e 6365 2876 2c20 2869  isinstance(v, (i
-00014010: 6e74 2c20 736c 6963 652c 2056 6172 6961  nt, slice, Varia
-00014020: 626c 6529 293a 0a20 2020 2020 2020 2020  ble)):.         
-00014030: 2020 2020 2020 2079 6965 6c64 206b 2c20         yield k, 
-00014040: 760a 2020 2020 2020 2020 2020 2020 656c  v.            el
-00014050: 6966 2069 7369 6e73 7461 6e63 6528 762c  if isinstance(v,
-00014060: 2044 6174 6141 7272 6179 293a 0a20 2020   DataArray):.   
-00014070: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-00014080: 6c64 206b 2c20 762e 7661 7269 6162 6c65  ld k, v.variable
-00014090: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000140a0: 6620 6973 696e 7374 616e 6365 2876 2c20  f isinstance(v, 
-000140b0: 7475 706c 6529 3a0a 2020 2020 2020 2020  tuple):.        
-000140c0: 2020 2020 2020 2020 7969 656c 6420 6b2c          yield k,
-000140d0: 2061 735f 7661 7269 6162 6c65 2876 290a   as_variable(v).
-000140e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000140f0: 2069 7369 6e73 7461 6e63 6528 762c 2044   isinstance(v, D
-00014100: 6174 6173 6574 293a 0a20 2020 2020 2020  ataset):.       
-00014110: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-00014120: 7970 6545 7272 6f72 2822 6361 6e6e 6f74  ypeError("cannot
-00014130: 2075 7365 2061 2044 6174 6173 6574 2061   use a Dataset a
-00014140: 7320 616e 2069 6e64 6578 6572 2229 0a20  s an indexer"). 
-00014150: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00014160: 6973 696e 7374 616e 6365 2876 2c20 5365  isinstance(v, Se
-00014170: 7175 656e 6365 2920 616e 6420 6c65 6e28  quence) and len(
-00014180: 7629 203d 3d20 303a 0a20 2020 2020 2020  v) == 0:.       
-00014190: 2020 2020 2020 2020 2079 6965 6c64 206b           yield k
-000141a0: 2c20 6e70 2e65 6d70 7479 2828 302c 292c  , np.empty((0,),
-000141b0: 2064 7479 7065 3d22 696e 7436 3422 290a   dtype="int64").
-000141c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000141d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000141e0: 2020 6966 206e 6f74 2069 735f 6475 636b    if not is_duck
-000141f0: 5f61 7272 6179 2876 293a 0a20 2020 2020  _array(v):.     
-00014200: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00014210: 203d 206e 702e 6173 6172 7261 7928 7629   = np.asarray(v)
-00014220: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014230: 2020 6966 2076 2e64 7479 7065 2e6b 696e    if v.dtype.kin
-00014240: 6420 696e 2022 5553 223a 0a20 2020 2020  d in "US":.     
-00014250: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014260: 6e64 6578 203d 2073 656c 662e 5f69 6e64  ndex = self._ind
-00014270: 6578 6573 5b6b 5d2e 746f 5f70 616e 6461  exes[k].to_panda
-00014280: 735f 696e 6465 7828 290a 2020 2020 2020  s_index().      
-00014290: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000142a0: 2069 7369 6e73 7461 6e63 6528 696e 6465   isinstance(inde
-000142b0: 782c 2070 642e 4461 7465 7469 6d65 496e  x, pd.DatetimeIn
-000142c0: 6465 7829 3a0a 2020 2020 2020 2020 2020  dex):.          
-000142d0: 2020 2020 2020 2020 2020 2020 2020 7620                v 
-000142e0: 3d20 762e 6173 7479 7065 2822 6461 7465  = v.astype("date
-000142f0: 7469 6d65 3634 5b6e 735d 2229 0a20 2020  time64[ns]").   
-00014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014310: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00014320: 2869 6e64 6578 2c20 4346 5469 6d65 496e  (index, CFTimeIn
-00014330: 6465 7829 3a0a 2020 2020 2020 2020 2020  dex):.          
-00014340: 2020 2020 2020 2020 2020 2020 2020 7620                v 
-00014350: 3d20 5f70 6172 7365 5f61 7272 6179 5f6f  = _parse_array_o
-00014360: 665f 6366 7469 6d65 5f73 7472 696e 6773  f_cftime_strings
-00014370: 2876 2c20 696e 6465 782e 6461 7465 5f74  (v, index.date_t
-00014380: 7970 6529 0a0a 2020 2020 2020 2020 2020  ype)..          
-00014390: 2020 2020 2020 6966 2076 2e6e 6469 6d20        if v.ndim 
-000143a0: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
-000143b0: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
-000143c0: 6e64 6578 4572 726f 7228 0a20 2020 2020  ndexError(.     
-000143d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143e0: 2020 2022 556e 6c61 6265 6c65 6420 6d75     "Unlabeled mu
-000143f0: 6c74 692d 6469 6d65 6e73 696f 6e61 6c20  lti-dimensional 
-00014400: 6172 7261 7920 6361 6e6e 6f74 2062 6520  array cannot be 
-00014410: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00014420: 2020 2020 2020 2020 2020 2275 7365 6420            "used 
-00014430: 666f 7220 696e 6465 7869 6e67 3a20 7b7d  for indexing: {}
-00014440: 222e 666f 726d 6174 286b 290a 2020 2020  ".format(k).    
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014470: 2020 7969 656c 6420 6b2c 2076 0a0a 2020    yield k, v..  
-00014480: 2020 6465 6620 5f76 616c 6964 6174 655f    def _validate_
-00014490: 696e 7465 7270 5f69 6e64 6578 6572 7328  interp_indexers(
-000144a0: 0a20 2020 2020 2020 2073 656c 662c 2069  .        self, i
-000144b0: 6e64 6578 6572 733a 204d 6170 7069 6e67  ndexers: Mapping
-000144c0: 5b41 6e79 2c20 416e 795d 0a20 2020 2029  [Any, Any].    )
-000144d0: 202d 3e20 4974 6572 6174 6f72 5b74 7570   -> Iterator[tup
-000144e0: 6c65 5b48 6173 6861 626c 652c 2056 6172  le[Hashable, Var
-000144f0: 6961 626c 655d 5d3a 0a20 2020 2020 2020  iable]]:.       
-00014500: 2022 2222 5661 7269 616e 7420 6f66 205f   """Variant of _
-00014510: 7661 6c69 6461 7465 5f69 6e64 6578 6572  validate_indexer
-00014520: 7320 746f 2062 6520 7573 6564 2066 6f72  s to be used for
-00014530: 2069 6e74 6572 706f 6c61 7469 6f6e 2222   interpolation""
-00014540: 220a 2020 2020 2020 2020 666f 7220 6b2c  ".        for k,
-00014550: 2076 2069 6e20 7365 6c66 2e5f 7661 6c69   v in self._vali
-00014560: 6461 7465 5f69 6e64 6578 6572 7328 696e  date_indexers(in
-00014570: 6465 7865 7273 293a 0a20 2020 2020 2020  dexers):.       
-00014580: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00014590: 6365 2876 2c20 5661 7269 6162 6c65 293a  ce(v, Variable):
-000145a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000145b0: 2069 6620 762e 6e64 696d 203d 3d20 313a   if v.ndim == 1:
-000145c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000145d0: 2020 2020 2079 6965 6c64 206b 2c20 762e       yield k, v.
-000145e0: 746f 5f69 6e64 6578 5f76 6172 6961 626c  to_index_variabl
-000145f0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00014600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00014610: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-00014620: 656c 6420 6b2c 2076 0a20 2020 2020 2020  eld k, v.       
-00014630: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00014640: 616e 6365 2876 2c20 696e 7429 3a0a 2020  ance(v, int):.  
-00014650: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-00014660: 656c 6420 6b2c 2056 6172 6961 626c 6528  eld k, Variable(
-00014670: 2829 2c20 762c 2061 7474 7273 3d73 656c  (), v, attrs=sel
-00014680: 662e 636f 6f72 6473 5b6b 5d2e 6174 7472  f.coords[k].attr
-00014690: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
-000146a0: 6c69 6620 6973 696e 7374 616e 6365 2876  lif isinstance(v
-000146b0: 2c20 6e70 2e6e 6461 7272 6179 293a 0a20  , np.ndarray):. 
-000146c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000146d0: 6620 762e 6e64 696d 203d 3d20 303a 0a20  f v.ndim == 0:. 
-000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146f0: 2020 2079 6965 6c64 206b 2c20 5661 7269     yield k, Vari
-00014700: 6162 6c65 2828 292c 2076 2c20 6174 7472  able((), v, attr
-00014710: 733d 7365 6c66 2e63 6f6f 7264 735b 6b5d  s=self.coords[k]
-00014720: 2e61 7474 7273 290a 2020 2020 2020 2020  .attrs).        
-00014730: 2020 2020 2020 2020 656c 6966 2076 2e6e          elif v.n
-00014740: 6469 6d20 3d3d 2031 3a0a 2020 2020 2020  dim == 1:.      
-00014750: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-00014760: 656c 6420 6b2c 2049 6e64 6578 5661 7269  eld k, IndexVari
-00014770: 6162 6c65 2828 6b2c 292c 2076 2c20 6174  able((k,), v, at
-00014780: 7472 733d 7365 6c66 2e63 6f6f 7264 735b  trs=self.coords[
-00014790: 6b5d 2e61 7474 7273 290a 2020 2020 2020  k].attrs).      
-000147a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000147b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147c0: 2020 2020 7261 6973 6520 4173 7365 7274      raise Assert
-000147d0: 696f 6e45 7272 6f72 2829 2020 2320 416c  ionError()  # Al
-000147e0: 7265 6164 7920 7465 7374 6564 2062 7920  ready tested by 
-000147f0: 5f76 616c 6964 6174 655f 696e 6465 7865  _validate_indexe
-00014800: 7273 0a20 2020 2020 2020 2020 2020 2065  rs.            e
-00014810: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00014820: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00014830: 7272 6f72 2874 7970 6528 7629 290a 0a20  rror(type(v)).. 
-00014840: 2020 2064 6566 205f 6765 745f 696e 6465     def _get_inde
-00014850: 7865 7273 5f63 6f6f 7264 735f 616e 645f  xers_coords_and_
-00014860: 696e 6465 7865 7328 7365 6c66 2c20 696e  indexes(self, in
-00014870: 6465 7865 7273 293a 0a20 2020 2020 2020  dexers):.       
-00014880: 2022 2222 4578 7472 6163 7420 636f 6f72   """Extract coor
-00014890: 6469 6e61 7465 7320 616e 6420 696e 6465  dinates and inde
-000148a0: 7865 7320 6672 6f6d 2069 6e64 6578 6572  xes from indexer
-000148b0: 732e 0a0a 2020 2020 2020 2020 4f6e 6c79  s...        Only
-000148c0: 2063 6f6f 7264 696e 6174 6520 7769 7468   coordinate with
-000148d0: 2061 206e 616d 6520 6469 6666 6572 656e   a name differen
-000148e0: 7420 6672 6f6d 2061 6e79 206f 6620 7365  t from any of se
-000148f0: 6c66 2e76 6172 6961 626c 6573 2077 696c  lf.variables wil
-00014900: 6c0a 2020 2020 2020 2020 6265 2061 7474  l.        be att
-00014910: 6163 6865 642e 0a20 2020 2020 2020 2022  ached..        "
-00014920: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00014930: 7861 7272 6179 2e63 6f72 652e 6461 7461  xarray.core.data
-00014940: 6172 7261 7920 696d 706f 7274 2044 6174  array import Dat
-00014950: 6141 7272 6179 0a0a 2020 2020 2020 2020  aArray..        
-00014960: 636f 6f72 6473 5f6c 6973 7420 3d20 5b5d  coords_list = []
-00014970: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-00014980: 7620 696e 2069 6e64 6578 6572 732e 6974  v in indexers.it
-00014990: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-000149a0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-000149b0: 2876 2c20 4461 7461 4172 7261 7929 3a0a  (v, DataArray):.
-000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149d0: 6966 2076 2e64 7479 7065 2e6b 696e 6420  if v.dtype.kind 
-000149e0: 3d3d 2022 6222 3a0a 2020 2020 2020 2020  == "b":.        
-000149f0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00014a00: 2e6e 6469 6d20 213d 2031 3a20 2023 2077  .ndim != 1:  # w
-00014a10: 6520 6f6e 6c79 2073 7570 706f 7274 2031  e only support 1
-00014a20: 2d64 2062 6f6f 6c65 616e 2061 7272 6179  -d boolean array
-00014a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014a40: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00014a50: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00014a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a70: 2020 2020 2020 2022 7b3a 647d 642d 626f         "{:d}d-bo
-00014a80: 6f6c 6561 6e20 6172 7261 7920 6973 2075  olean array is u
-00014a90: 7365 6420 666f 7220 696e 6465 7869 6e67  sed for indexing
-00014aa0: 2061 6c6f 6e67 2022 0a20 2020 2020 2020   along ".       
-00014ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ac0: 2020 2020 2022 6469 6d65 6e73 696f 6e20       "dimension 
-00014ad0: 7b21 727d 2c20 6275 7420 6f6e 6c79 2031  {!r}, but only 1
-00014ae0: 6420 626f 6f6c 6561 6e20 6172 7261 7973  d boolean arrays
-00014af0: 2061 7265 2022 0a20 2020 2020 2020 2020   are ".         
-00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b10: 2020 2022 7375 7070 6f72 7465 642e 222e     "supported.".
-00014b20: 666f 726d 6174 2876 2e6e 6469 6d2c 206b  format(v.ndim, k
-00014b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014b40: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b60: 2320 4d61 6b65 2073 7572 6520 696e 2063  # Make sure in c
-00014b70: 6173 6520 6f66 2062 6f6f 6c65 616e 2044  ase of boolean D
-00014b80: 6174 6141 7272 6179 2c20 6974 730a 2020  ataArray, its.  
-00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ba0: 2020 2320 636f 6f72 6469 6e61 7465 2061    # coordinate a
-00014bb0: 6c73 6f20 7368 6f75 6c64 2062 6520 696e  lso should be in
-00014bc0: 6465 7865 642e 0a20 2020 2020 2020 2020  dexed..         
-00014bd0: 2020 2020 2020 2020 2020 2076 5f63 6f6f             v_coo
-00014be0: 7264 7320 3d20 765b 762e 7661 6c75 6573  rds = v[v.values
-00014bf0: 2e6e 6f6e 7a65 726f 2829 5b30 5d5d 2e63  .nonzero()[0]].c
-00014c00: 6f6f 7264 730a 2020 2020 2020 2020 2020  oords.          
-00014c10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c30: 765f 636f 6f72 6473 203d 2076 2e63 6f6f  v_coords = v.coo
-00014c40: 7264 730a 2020 2020 2020 2020 2020 2020  rds.            
-00014c50: 2020 2020 636f 6f72 6473 5f6c 6973 742e      coords_list.
-00014c60: 6170 7065 6e64 2876 5f63 6f6f 7264 7329  append(v_coords)
-00014c70: 0a0a 2020 2020 2020 2020 2320 7765 2064  ..        # we d
-00014c80: 6f6e 2774 206e 6565 6420 746f 2063 616c  on't need to cal
-00014c90: 6c20 616c 6967 6e28 2920 6578 706c 6963  l align() explic
-00014ca0: 6974 6c79 206f 7220 6368 6563 6b20 696e  itly or check in
-00014cb0: 6465 7865 7320 666f 720a 2020 2020 2020  dexes for.      
-00014cc0: 2020 2320 616c 6967 6e6d 656e 742c 2062    # alignment, b
-00014cd0: 6563 6175 7365 206d 6572 6765 5f76 6172  ecause merge_var
-00014ce0: 6961 626c 6573 2061 6c72 6561 6479 2063  iables already c
-00014cf0: 6865 636b 7320 666f 7220 6578 6163 7420  hecks for exact 
-00014d00: 616c 6967 6e6d 656e 740a 2020 2020 2020  alignment.      
-00014d10: 2020 2320 6265 7477 6565 6e20 6469 6d65    # between dime
-00014d20: 6e73 696f 6e20 636f 6f72 6469 6e61 7465  nsion coordinate
-00014d30: 730a 2020 2020 2020 2020 636f 6f72 6473  s.        coords
-00014d40: 2c20 696e 6465 7865 7320 3d20 6d65 7267  , indexes = merg
-00014d50: 655f 636f 6f72 6469 6e61 7465 735f 7769  e_coordinates_wi
-00014d60: 7468 6f75 745f 616c 6967 6e28 636f 6f72  thout_align(coor
-00014d70: 6473 5f6c 6973 7429 0a20 2020 2020 2020  ds_list).       
-00014d80: 2061 7373 6572 745f 636f 6f72 6469 6e61   assert_coordina
-00014d90: 7465 5f63 6f6e 7369 7374 656e 7428 7365  te_consistent(se
-00014da0: 6c66 2c20 636f 6f72 6473 290a 0a20 2020  lf, coords)..   
-00014db0: 2020 2020 2023 2073 696c 656e 746c 7920       # silently 
-00014dc0: 6472 6f70 2074 6865 2063 6f6e 666c 6963  drop the conflic
-00014dd0: 7465 6420 7661 7269 6162 6c65 732e 0a20  ted variables.. 
-00014de0: 2020 2020 2020 2061 7474 6163 6865 645f         attached_
-00014df0: 636f 6f72 6473 203d 207b 6b3a 2076 2066  coords = {k: v f
-00014e00: 6f72 206b 2c20 7620 696e 2063 6f6f 7264  or k, v in coord
-00014e10: 732e 6974 656d 7328 2920 6966 206b 206e  s.items() if k n
-00014e20: 6f74 2069 6e20 7365 6c66 2e5f 7661 7269  ot in self._vari
-00014e30: 6162 6c65 737d 0a20 2020 2020 2020 2061  ables}.        a
-00014e40: 7474 6163 6865 645f 696e 6465 7865 7320  ttached_indexes 
-00014e50: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00014e60: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
-00014e70: 2069 6e64 6578 6573 2e69 7465 6d73 2829   indexes.items()
-00014e80: 2069 6620 6b20 6e6f 7420 696e 2073 656c   if k not in sel
-00014e90: 662e 5f76 6172 6961 626c 6573 0a20 2020  f._variables.   
-00014ea0: 2020 2020 207d 0a20 2020 2020 2020 2072       }.        r
-00014eb0: 6574 7572 6e20 6174 7461 6368 6564 5f63  eturn attached_c
-00014ec0: 6f6f 7264 732c 2061 7474 6163 6865 645f  oords, attached_
-00014ed0: 696e 6465 7865 730a 0a20 2020 2064 6566  indexes..    def
-00014ee0: 2069 7365 6c28 0a20 2020 2020 2020 2073   isel(.        s
-00014ef0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-00014f00: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
-00014f10: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
-00014f20: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
-00014f30: 652c 0a20 2020 2020 2020 2064 726f 703a  e,.        drop:
-00014f40: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00014f50: 2020 2020 2020 206d 6973 7369 6e67 5f64         missing_d
-00014f60: 696d 733a 2045 7272 6f72 4f70 7469 6f6e  ims: ErrorOption
-00014f70: 7357 6974 6857 6172 6e20 3d20 2272 6169  sWithWarn = "rai
-00014f80: 7365 222c 0a20 2020 2020 2020 202a 2a69  se",.        **i
-00014f90: 6e64 6578 6572 735f 6b77 6172 6773 3a20  ndexers_kwargs: 
-00014fa0: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
-00014fb0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-00014fc0: 2022 2222 5265 7475 726e 7320 6120 6e65   """Returns a ne
-00014fd0: 7720 6461 7461 7365 7420 7769 7468 2065  w dataset with e
-00014fe0: 6163 6820 6172 7261 7920 696e 6465 7865  ach array indexe
-00014ff0: 6420 616c 6f6e 6720 7468 6520 7370 6563  d along the spec
-00015000: 6966 6965 640a 2020 2020 2020 2020 6469  ified.        di
-00015010: 6d65 6e73 696f 6e28 7329 2e0a 0a20 2020  mension(s)...   
-00015020: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
-00015030: 2073 656c 6563 7473 2076 616c 7565 7320   selects values 
-00015040: 6672 6f6d 2065 6163 6820 6172 7261 7920  from each array 
-00015050: 7573 696e 6720 6974 7320 605f 5f67 6574  using its `__get
-00015060: 6974 656d 5f5f 600a 2020 2020 2020 2020  item__`.        
-00015070: 6d65 7468 6f64 2c20 6578 6365 7074 2074  method, except t
-00015080: 6869 7320 6d65 7468 6f64 2064 6f65 7320  his method does 
-00015090: 6e6f 7420 7265 7175 6972 6520 6b6e 6f77  not require know
-000150a0: 696e 6720 7468 6520 6f72 6465 7220 6f66  ing the order of
-000150b0: 0a20 2020 2020 2020 2065 6163 6820 6172  .        each ar
-000150c0: 7261 7927 7320 6469 6d65 6e73 696f 6e73  ray's dimensions
-000150d0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-000150e0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-000150f0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00015100: 2069 6e64 6578 6572 7320 3a20 6469 6374   indexers : dict
-00015110: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00015120: 2020 2020 2020 2041 2064 6963 7420 7769         A dict wi
-00015130: 7468 206b 6579 7320 6d61 7463 6869 6e67  th keys matching
-00015140: 2064 696d 656e 7369 6f6e 7320 616e 6420   dimensions and 
-00015150: 7661 6c75 6573 2067 6976 656e 0a20 2020  values given.   
-00015160: 2020 2020 2020 2020 2062 7920 696e 7465           by inte
-00015170: 6765 7273 2c20 736c 6963 6520 6f62 6a65  gers, slice obje
-00015180: 6374 7320 6f72 2061 7272 6179 732e 0a20  cts or arrays.. 
-00015190: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-000151a0: 6572 2063 616e 2062 6520 6120 696e 7465  er can be a inte
-000151b0: 6765 722c 2073 6c69 6365 2c20 6172 7261  ger, slice, arra
-000151c0: 792d 6c69 6b65 206f 7220 4461 7461 4172  y-like or DataAr
-000151d0: 7261 792e 0a20 2020 2020 2020 2020 2020  ray..           
-000151e0: 2049 6620 4461 7461 4172 7261 7973 2061   If DataArrays a
-000151f0: 7265 2070 6173 7365 6420 6173 2069 6e64  re passed as ind
-00015200: 6578 6572 732c 2078 6172 7261 792d 7374  exers, xarray-st
-00015210: 796c 6520 696e 6465 7869 6e67 2077 696c  yle indexing wil
-00015220: 6c20 6265 0a20 2020 2020 2020 2020 2020  l be.           
-00015230: 2063 6172 7269 6564 206f 7574 2e20 5365   carried out. Se
-00015240: 6520 3a72 6566 3a60 696e 6465 7869 6e67  e :ref:`indexing
-00015250: 6020 666f 7220 7468 6520 6465 7461 696c  ` for the detail
-00015260: 732e 0a20 2020 2020 2020 2020 2020 204f  s..            O
-00015270: 6e65 206f 6620 696e 6465 7865 7273 206f  ne of indexers o
-00015280: 7220 696e 6465 7865 7273 5f6b 7761 7267  r indexers_kwarg
-00015290: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
-000152a0: 6564 2e0a 2020 2020 2020 2020 6472 6f70  ed..        drop
-000152b0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-000152c0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
-000152d0: 2020 2020 4966 2060 6064 726f 703d 5472      If ``drop=Tr
-000152e0: 7565 6060 2c20 6472 6f70 2063 6f6f 7264  ue``, drop coord
-000152f0: 696e 6174 6573 2076 6172 6961 626c 6573  inates variables
-00015300: 2069 6e64 6578 6564 2062 7920 696e 7465   indexed by inte
-00015310: 6765 7273 0a20 2020 2020 2020 2020 2020  gers.           
-00015320: 2069 6e73 7465 6164 206f 6620 6d61 6b69   instead of maki
-00015330: 6e67 2074 6865 6d20 7363 616c 6172 2e0a  ng them scalar..
-00015340: 2020 2020 2020 2020 6d69 7373 696e 675f          missing_
-00015350: 6469 6d73 203a 207b 2272 6169 7365 222c  dims : {"raise",
-00015360: 2022 7761 726e 222c 2022 6967 6e6f 7265   "warn", "ignore
-00015370: 227d 2c20 6465 6661 756c 743a 2022 7261  "}, default: "ra
-00015380: 6973 6522 0a20 2020 2020 2020 2020 2020  ise".           
-00015390: 2057 6861 7420 746f 2064 6f20 6966 2064   What to do if d
-000153a0: 696d 656e 7369 6f6e 7320 7468 6174 2073  imensions that s
-000153b0: 686f 756c 6420 6265 2073 656c 6563 7465  hould be selecte
-000153c0: 6420 6672 6f6d 2061 7265 206e 6f74 2070  d from are not p
-000153d0: 7265 7365 6e74 2069 6e20 7468 650a 2020  resent in the.  
-000153e0: 2020 2020 2020 2020 2020 4461 7461 7365            Datase
-000153f0: 743a 0a20 2020 2020 2020 2020 2020 202d  t:.            -
-00015400: 2022 7261 6973 6522 3a20 7261 6973 6520   "raise": raise 
-00015410: 616e 2065 7863 6570 7469 6f6e 0a20 2020  an exception.   
-00015420: 2020 2020 2020 2020 202d 2022 7761 726e           - "warn
-00015430: 223a 2072 6169 7365 2061 2077 6172 6e69  ": raise a warni
-00015440: 6e67 2c20 616e 6420 6967 6e6f 7265 2074  ng, and ignore t
-00015450: 6865 206d 6973 7369 6e67 2064 696d 656e  he missing dimen
-00015460: 7369 6f6e 730a 2020 2020 2020 2020 2020  sions.          
-00015470: 2020 2d20 2269 676e 6f72 6522 3a20 6967    - "ignore": ig
-00015480: 6e6f 7265 2074 6865 206d 6973 7369 6e67  nore the missing
-00015490: 2064 696d 656e 7369 6f6e 730a 0a20 2020   dimensions..   
-000154a0: 2020 2020 202a 2a69 6e64 6578 6572 735f       **indexers_
-000154b0: 6b77 6172 6773 203a 207b 6469 6d3a 2069  kwargs : {dim: i
-000154c0: 6e64 6578 6572 2c20 2e2e 2e7d 2c20 6f70  ndexer, ...}, op
-000154d0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-000154e0: 2020 2054 6865 206b 6579 776f 7264 2061     The keyword a
-000154f0: 7267 756d 656e 7473 2066 6f72 6d20 6f66  rguments form of
-00015500: 2060 6069 6e64 6578 6572 7360 602e 0a20   ``indexers``.. 
-00015510: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
-00015520: 6620 696e 6465 7865 7273 206f 7220 696e  f indexers or in
-00015530: 6465 7865 7273 5f6b 7761 7267 7320 6d75  dexers_kwargs mu
-00015540: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
-00015550: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00015560: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00015570: 0a20 2020 2020 2020 206f 626a 203a 2044  .        obj : D
-00015580: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
-00015590: 2020 2041 206e 6577 2044 6174 6173 6574     A new Dataset
-000155a0: 2077 6974 6820 7468 6520 7361 6d65 2063   with the same c
-000155b0: 6f6e 7465 6e74 7320 6173 2074 6869 7320  ontents as this 
-000155c0: 6461 7461 7365 742c 2065 7863 6570 7420  dataset, except 
-000155d0: 6561 6368 0a20 2020 2020 2020 2020 2020  each.           
-000155e0: 2061 7272 6179 2061 6e64 2064 696d 656e   array and dimen
-000155f0: 7369 6f6e 2069 7320 696e 6465 7865 6420  sion is indexed 
-00015600: 6279 2074 6865 2061 7070 726f 7072 6961  by the appropria
-00015610: 7465 2069 6e64 6578 6572 732e 0a20 2020  te indexers..   
-00015620: 2020 2020 2020 2020 2049 6620 696e 6465           If inde
-00015630: 7865 7220 4461 7461 4172 7261 7973 2068  xer DataArrays h
-00015640: 6176 6520 636f 6f72 6469 6e61 7465 7320  ave coordinates 
-00015650: 7468 6174 2064 6f20 6e6f 7420 636f 6e66  that do not conf
-00015660: 6c69 6374 2077 6974 680a 2020 2020 2020  lict with.      
-00015670: 2020 2020 2020 7468 6973 206f 626a 6563        this objec
-00015680: 742c 2074 6865 6e20 7468 6573 6520 636f  t, then these co
-00015690: 6f72 6469 6e61 7465 7320 7769 6c6c 2062  ordinates will b
-000156a0: 6520 6174 7461 6368 6564 2e0a 2020 2020  e attached..    
-000156b0: 2020 2020 2020 2020 496e 2067 656e 6572          In gener
-000156c0: 616c 2c20 6561 6368 2061 7272 6179 2773  al, each array's
-000156d0: 2064 6174 6120 7769 6c6c 2062 6520 6120   data will be a 
-000156e0: 7669 6577 206f 6620 7468 6520 6172 7261  view of the arra
-000156f0: 7927 7320 6461 7461 0a20 2020 2020 2020  y's data.       
-00015700: 2020 2020 2069 6e20 7468 6973 2064 6174       in this dat
-00015710: 6173 6574 2c20 756e 6c65 7373 2076 6563  aset, unless vec
-00015720: 746f 7269 7a65 6420 696e 6465 7869 6e67  torized indexing
-00015730: 2077 6173 2074 7269 6767 6572 6564 2062   was triggered b
-00015740: 7920 7573 696e 670a 2020 2020 2020 2020  y using.        
-00015750: 2020 2020 616e 2061 7272 6179 2069 6e64      an array ind
-00015760: 6578 6572 2c20 696e 2077 6869 6368 2063  exer, in which c
-00015770: 6173 6520 7468 6520 6461 7461 2077 696c  ase the data wil
-00015780: 6c20 6265 2061 2063 6f70 792e 0a0a 2020  l be a copy...  
-00015790: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
-000157a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-000157b0: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
-000157c0: 7365 6c0a 2020 2020 2020 2020 4461 7461  sel.        Data
-000157d0: 4172 7261 792e 6973 656c 0a20 2020 2020  Array.isel.     
-000157e0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000157f0: 6e64 6578 6572 7320 3d20 6569 7468 6572  ndexers = either
-00015800: 5f64 6963 745f 6f72 5f6b 7761 7267 7328  _dict_or_kwargs(
-00015810: 696e 6465 7865 7273 2c20 696e 6465 7865  indexers, indexe
-00015820: 7273 5f6b 7761 7267 732c 2022 6973 656c  rs_kwargs, "isel
-00015830: 2229 0a20 2020 2020 2020 2069 6620 616e  ").        if an
-00015840: 7928 6973 5f66 616e 6379 5f69 6e64 6578  y(is_fancy_index
-00015850: 6572 2869 6478 2920 666f 7220 6964 7820  er(idx) for idx 
-00015860: 696e 2069 6e64 6578 6572 732e 7661 6c75  in indexers.valu
-00015870: 6573 2829 293a 0a20 2020 2020 2020 2020  es()):.         
-00015880: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00015890: 6973 656c 5f66 616e 6379 2869 6e64 6578  isel_fancy(index
-000158a0: 6572 732c 2064 726f 703d 6472 6f70 2c20  ers, drop=drop, 
-000158b0: 6d69 7373 696e 675f 6469 6d73 3d6d 6973  missing_dims=mis
-000158c0: 7369 6e67 5f64 696d 7329 0a0a 2020 2020  sing_dims)..    
-000158d0: 2020 2020 2320 4d75 6368 2066 6173 7465      # Much faste
-000158e0: 7220 616c 676f 7269 7468 6d20 666f 7220  r algorithm for 
-000158f0: 7768 656e 2061 6c6c 2069 6e64 6578 6572  when all indexer
-00015900: 7320 6172 6520 696e 7473 2c20 736c 6963  s are ints, slic
-00015910: 6573 2c20 6f6e 652d 6469 6d65 6e73 696f  es, one-dimensio
-00015920: 6e61 6c0a 2020 2020 2020 2020 2320 6c69  nal.        # li
-00015930: 7374 732c 206f 7220 7a65 726f 206f 7220  sts, or zero or 
-00015940: 6f6e 652d 6469 6d65 6e73 696f 6e61 6c20  one-dimensional 
-00015950: 6e70 2e6e 6461 7272 6179 2773 0a20 2020  np.ndarray's.   
-00015960: 2020 2020 2069 6e64 6578 6572 7320 3d20       indexers = 
-00015970: 6472 6f70 5f64 696d 735f 6672 6f6d 5f69  drop_dims_from_i
-00015980: 6e64 6578 6572 7328 696e 6465 7865 7273  ndexers(indexers
-00015990: 2c20 7365 6c66 2e64 696d 732c 206d 6973  , self.dims, mis
-000159a0: 7369 6e67 5f64 696d 7329 0a0a 2020 2020  sing_dims)..    
-000159b0: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
-000159c0: 7b7d 0a20 2020 2020 2020 2064 696d 733a  {}.        dims:
-000159d0: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-000159e0: 696e 745d 203d 207b 7d0a 2020 2020 2020  int] = {}.      
-000159f0: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
-00015a00: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
-00015a10: 732e 636f 7079 2829 0a0a 2020 2020 2020  s.copy()..      
-00015a20: 2020 696e 6465 7865 732c 2069 6e64 6578    indexes, index
-00015a30: 5f76 6172 6961 626c 6573 203d 2069 7365  _variables = ise
-00015a40: 6c5f 696e 6465 7865 7328 7365 6c66 2e78  l_indexes(self.x
-00015a50: 696e 6465 7865 732c 2069 6e64 6578 6572  indexes, indexer
-00015a60: 7329 0a0a 2020 2020 2020 2020 666f 7220  s)..        for 
-00015a70: 6e61 6d65 2c20 7661 7220 696e 2073 656c  name, var in sel
-00015a80: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
-00015a90: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00015aa0: 2020 2320 7072 6573 6572 7665 2076 6172    # preserve var
-00015ab0: 6961 626c 6520 6f72 6465 720a 2020 2020  iable order.    
-00015ac0: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-00015ad0: 696e 2069 6e64 6578 5f76 6172 6961 626c  in index_variabl
-00015ae0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00015af0: 2020 2020 7661 7220 3d20 696e 6465 785f      var = index_
-00015b00: 7661 7269 6162 6c65 735b 6e61 6d65 5d0a  variables[name].
-00015b10: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00015b20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015b30: 2020 7661 725f 696e 6465 7865 7273 203d    var_indexers =
-00015b40: 207b 6b3a 2076 2066 6f72 206b 2c20 7620   {k: v for k, v 
-00015b50: 696e 2069 6e64 6578 6572 732e 6974 656d  in indexers.item
-00015b60: 7328 2920 6966 206b 2069 6e20 7661 722e  s() if k in var.
-00015b70: 6469 6d73 7d0a 2020 2020 2020 2020 2020  dims}.          
-00015b80: 2020 2020 2020 6966 2076 6172 5f69 6e64        if var_ind
-00015b90: 6578 6572 733a 0a20 2020 2020 2020 2020  exers:.         
-00015ba0: 2020 2020 2020 2020 2020 2076 6172 203d             var =
-00015bb0: 2076 6172 2e69 7365 6c28 7661 725f 696e   var.isel(var_in
-00015bc0: 6465 7865 7273 290a 2020 2020 2020 2020  dexers).        
-00015bd0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00015be0: 726f 7020 616e 6420 7661 722e 6e64 696d  rop and var.ndim
-00015bf0: 203d 3d20 3020 616e 6420 6e61 6d65 2069   == 0 and name i
-00015c00: 6e20 636f 6f72 645f 6e61 6d65 733a 0a20  n coord_names:. 
-00015c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c20: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
-00015c30: 6573 2e72 656d 6f76 6528 6e61 6d65 290a  es.remove(name).
-00015c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c50: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00015c60: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-00015c70: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
-00015c80: 6172 0a20 2020 2020 2020 2020 2020 2064  ar.            d
-00015c90: 696d 732e 7570 6461 7465 287a 6970 2876  ims.update(zip(v
-00015ca0: 6172 2e64 696d 732c 2076 6172 2e73 6861  ar.dims, var.sha
-00015cb0: 7065 2929 0a0a 2020 2020 2020 2020 7265  pe))..        re
-00015cc0: 7475 726e 2073 656c 662e 5f63 6f6e 7374  turn self._const
-00015cd0: 7275 6374 5f64 6972 6563 7428 0a20 2020  ruct_direct(.   
-00015ce0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00015cf0: 6573 3d76 6172 6961 626c 6573 2c0a 2020  es=variables,.  
-00015d00: 2020 2020 2020 2020 2020 636f 6f72 645f            coord_
-00015d10: 6e61 6d65 733d 636f 6f72 645f 6e61 6d65  names=coord_name
-00015d20: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
-00015d30: 696d 733d 6469 6d73 2c0a 2020 2020 2020  ims=dims,.      
-00015d40: 2020 2020 2020 6174 7472 733d 7365 6c66        attrs=self
-00015d50: 2e5f 6174 7472 732c 0a20 2020 2020 2020  ._attrs,.       
-00015d60: 2020 2020 2069 6e64 6578 6573 3d69 6e64       indexes=ind
-00015d70: 6578 6573 2c0a 2020 2020 2020 2020 2020  exes,.          
-00015d80: 2020 656e 636f 6469 6e67 3d73 656c 662e    encoding=self.
-00015d90: 5f65 6e63 6f64 696e 672c 0a20 2020 2020  _encoding,.     
-00015da0: 2020 2020 2020 2063 6c6f 7365 3d73 656c         close=sel
-00015db0: 662e 5f63 6c6f 7365 2c0a 2020 2020 2020  f._close,.      
-00015dc0: 2020 290a 0a20 2020 2064 6566 205f 6973    )..    def _is
-00015dd0: 656c 5f66 616e 6379 280a 2020 2020 2020  el_fancy(.      
-00015de0: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
-00015df0: 742c 0a20 2020 2020 2020 2069 6e64 6578  t,.        index
-00015e00: 6572 733a 204d 6170 7069 6e67 5b41 6e79  ers: Mapping[Any
-00015e10: 2c20 416e 795d 2c0a 2020 2020 2020 2020  , Any],.        
-00015e20: 2a2c 0a20 2020 2020 2020 2064 726f 703a  *,.        drop:
-00015e30: 2062 6f6f 6c2c 0a20 2020 2020 2020 206d   bool,.        m
-00015e40: 6973 7369 6e67 5f64 696d 733a 2045 7272  issing_dims: Err
-00015e50: 6f72 4f70 7469 6f6e 7357 6974 6857 6172  orOptionsWithWar
-00015e60: 6e20 3d20 2272 6169 7365 222c 0a20 2020  n = "raise",.   
-00015e70: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-00015e80: 0a20 2020 2020 2020 2076 616c 6964 5f69  .        valid_i
-00015e90: 6e64 6578 6572 7320 3d20 6469 6374 2873  ndexers = dict(s
-00015ea0: 656c 662e 5f76 616c 6964 6174 655f 696e  elf._validate_in
-00015eb0: 6465 7865 7273 2869 6e64 6578 6572 732c  dexers(indexers,
-00015ec0: 206d 6973 7369 6e67 5f64 696d 7329 290a   missing_dims)).
-00015ed0: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-00015ee0: 6573 3a20 6469 6374 5b48 6173 6861 626c  es: dict[Hashabl
-00015ef0: 652c 2056 6172 6961 626c 655d 203d 207b  e, Variable] = {
-00015f00: 7d0a 2020 2020 2020 2020 696e 6465 7865  }.        indexe
-00015f10: 732c 2069 6e64 6578 5f76 6172 6961 626c  s, index_variabl
-00015f20: 6573 203d 2069 7365 6c5f 696e 6465 7865  es = isel_indexe
-00015f30: 7328 7365 6c66 2e78 696e 6465 7865 732c  s(self.xindexes,
-00015f40: 2076 616c 6964 5f69 6e64 6578 6572 7329   valid_indexers)
-00015f50: 0a0a 2020 2020 2020 2020 666f 7220 6e61  ..        for na
-00015f60: 6d65 2c20 7661 7220 696e 2073 656c 662e  me, var in self.
-00015f70: 7661 7269 6162 6c65 732e 6974 656d 7328  variables.items(
-00015f80: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00015f90: 6620 6e61 6d65 2069 6e20 696e 6465 785f  f name in index_
-00015fa0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-00015fb0: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
-00015fc0: 6172 203d 2069 6e64 6578 5f76 6172 6961  ar = index_varia
-00015fd0: 626c 6573 5b6e 616d 655d 0a20 2020 2020  bles[name].     
-00015fe0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00015ff0: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00016000: 5f69 6e64 6578 6572 7320 3d20 7b0a 2020  _indexers = {.  
-00016010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016020: 2020 6b3a 2076 2066 6f72 206b 2c20 7620    k: v for k, v 
-00016030: 696e 2076 616c 6964 5f69 6e64 6578 6572  in valid_indexer
-00016040: 732e 6974 656d 7328 2920 6966 206b 2069  s.items() if k i
-00016050: 6e20 7661 722e 6469 6d73 0a20 2020 2020  n var.dims.     
-00016060: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00016070: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00016080: 7661 725f 696e 6465 7865 7273 3a0a 2020  var_indexers:.  
-00016090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160a0: 2020 6e65 775f 7661 7220 3d20 7661 722e    new_var = var.
-000160b0: 6973 656c 2869 6e64 6578 6572 733d 7661  isel(indexers=va
-000160c0: 725f 696e 6465 7865 7273 290a 2020 2020  r_indexers).    
-000160d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160e0: 2320 6472 6f70 2073 6361 6c61 7220 636f  # drop scalar co
-000160f0: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
-00016100: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00016110: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00016120: 6f6d 2f70 7964 6174 612f 7861 7272 6179  om/pydata/xarray
-00016130: 2f69 7373 7565 732f 3635 3534 0a20 2020  /issues/6554.   
-00016140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016150: 2069 6620 6e61 6d65 2069 6e20 7365 6c66   if name in self
-00016160: 2e63 6f6f 7264 7320 616e 6420 6472 6f70  .coords and drop
-00016170: 2061 6e64 206e 6577 5f76 6172 2e6e 6469   and new_var.ndi
-00016180: 6d20 3d3d 2030 3a0a 2020 2020 2020 2020  m == 0:.        
-00016190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161a0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-000161b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161d0: 2020 206e 6577 5f76 6172 203d 2076 6172     new_var = var
-000161e0: 2e63 6f70 7928 6465 6570 3d46 616c 7365  .copy(deep=False
-000161f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016200: 2020 6966 206e 616d 6520 6e6f 7420 696e    if name not in
-00016210: 2069 6e64 6578 6573 3a0a 2020 2020 2020   indexes:.      
-00016220: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00016230: 775f 7661 7220 3d20 6e65 775f 7661 722e  w_var = new_var.
-00016240: 746f 5f62 6173 655f 7661 7269 6162 6c65  to_base_variable
-00016250: 2829 0a20 2020 2020 2020 2020 2020 2076  ().            v
-00016260: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
-00016270: 206e 6577 5f76 6172 0a0a 2020 2020 2020   new_var..      
-00016280: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
-00016290: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
-000162a0: 7320 2620 7661 7269 6162 6c65 732e 6b65  s & variables.ke
-000162b0: 7973 2829 0a20 2020 2020 2020 2073 656c  ys().        sel
-000162c0: 6563 7465 6420 3d20 7365 6c66 2e5f 7265  ected = self._re
-000162d0: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
-000162e0: 696d 7328 7661 7269 6162 6c65 732c 2063  ims(variables, c
-000162f0: 6f6f 7264 5f6e 616d 6573 2c20 696e 6465  oord_names, inde
-00016300: 7865 7329 0a0a 2020 2020 2020 2020 2320  xes)..        # 
-00016310: 4578 7472 6163 7420 636f 6f72 6469 6e61  Extract coordina
-00016320: 7465 7320 6672 6f6d 2069 6e64 6578 6572  tes from indexer
-00016330: 730a 2020 2020 2020 2020 636f 6f72 645f  s.        coord_
-00016340: 7661 7273 2c20 6e65 775f 696e 6465 7865  vars, new_indexe
-00016350: 7320 3d20 7365 6c65 6374 6564 2e5f 6765  s = selected._ge
-00016360: 745f 696e 6465 7865 7273 5f63 6f6f 7264  t_indexers_coord
-00016370: 735f 616e 645f 696e 6465 7865 7328 696e  s_and_indexes(in
-00016380: 6465 7865 7273 290a 2020 2020 2020 2020  dexers).        
-00016390: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
-000163a0: 2863 6f6f 7264 5f76 6172 7329 0a20 2020  (coord_vars).   
-000163b0: 2020 2020 2069 6e64 6578 6573 2e75 7064       indexes.upd
-000163c0: 6174 6528 6e65 775f 696e 6465 7865 7329  ate(new_indexes)
-000163d0: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
-000163e0: 616d 6573 203d 2073 656c 662e 5f63 6f6f  ames = self._coo
-000163f0: 7264 5f6e 616d 6573 2026 2076 6172 6961  rd_names & varia
-00016400: 626c 6573 2e6b 6579 7328 2920 7c20 636f  bles.keys() | co
-00016410: 6f72 645f 7661 7273 2e6b 6579 7328 290a  ord_vars.keys().
-00016420: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00016430: 656c 662e 5f72 6570 6c61 6365 5f77 6974  elf._replace_wit
-00016440: 685f 6e65 775f 6469 6d73 2876 6172 6961  h_new_dims(varia
-00016450: 626c 6573 2c20 636f 6f72 645f 6e61 6d65  bles, coord_name
-00016460: 732c 2069 6e64 6578 6573 3d69 6e64 6578  s, indexes=index
-00016470: 6573 290a 0a20 2020 2064 6566 2073 656c  es)..    def sel
-00016480: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
-00016490: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
-000164a0: 2020 2069 6e64 6578 6572 733a 204d 6170     indexers: Map
-000164b0: 7069 6e67 5b41 6e79 2c20 416e 795d 207c  ping[Any, Any] |
-000164c0: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-000164d0: 2020 2020 2020 6d65 7468 6f64 3a20 7374        method: st
-000164e0: 7220 7c20 4e6f 6e65 203d 204e 6f6e 652c  r | None = None,
-000164f0: 0a20 2020 2020 2020 2074 6f6c 6572 616e  .        toleran
-00016500: 6365 3a20 696e 7420 7c20 666c 6f61 7420  ce: int | float 
-00016510: 7c20 4974 6572 6162 6c65 5b69 6e74 207c  | Iterable[int |
-00016520: 2066 6c6f 6174 5d20 7c20 4e6f 6e65 203d   float] | None =
-00016530: 204e 6f6e 652c 0a20 2020 2020 2020 2064   None,.        d
-00016540: 726f 703a 2062 6f6f 6c20 3d20 4661 6c73  rop: bool = Fals
-00016550: 652c 0a20 2020 2020 2020 202a 2a69 6e64  e,.        **ind
-00016560: 6578 6572 735f 6b77 6172 6773 3a20 416e  exers_kwargs: An
-00016570: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
-00016580: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-00016590: 2222 5265 7475 726e 7320 6120 6e65 7720  ""Returns a new 
-000165a0: 6461 7461 7365 7420 7769 7468 2065 6163  dataset with eac
-000165b0: 6820 6172 7261 7920 696e 6465 7865 6420  h array indexed 
-000165c0: 6279 2074 6963 6b20 6c61 6265 6c73 0a20  by tick labels. 
-000165d0: 2020 2020 2020 2061 6c6f 6e67 2074 6865         along the
-000165e0: 2073 7065 6369 6669 6564 2064 696d 656e   specified dimen
-000165f0: 7369 6f6e 2873 292e 0a0a 2020 2020 2020  sion(s)...      
-00016600: 2020 496e 2063 6f6e 7472 6173 7420 746f    In contrast to
-00016610: 2060 4461 7461 7365 742e 6973 656c 602c   `Dataset.isel`,
-00016620: 2069 6e64 6578 6572 7320 666f 7220 7468   indexers for th
-00016630: 6973 206d 6574 686f 6420 7368 6f75 6c64  is method should
-00016640: 2075 7365 0a20 2020 2020 2020 206c 6162   use.        lab
-00016650: 656c 7320 696e 7374 6561 6420 6f66 2069  els instead of i
-00016660: 6e74 6567 6572 732e 0a0a 2020 2020 2020  ntegers...      
-00016670: 2020 556e 6465 7220 7468 6520 686f 6f64    Under the hood
-00016680: 2c20 7468 6973 206d 6574 686f 6420 6973  , this method is
-00016690: 2070 6f77 6572 6564 2062 7920 7573 696e   powered by usin
-000166a0: 6720 7061 6e64 6173 2773 2070 6f77 6572  g pandas's power
-000166b0: 6675 6c20 496e 6465 780a 2020 2020 2020  ful Index.      
-000166c0: 2020 6f62 6a65 6374 732e 2054 6869 7320    objects. This 
-000166d0: 6d61 6b65 7320 6c61 6265 6c20 6261 7365  makes label base
-000166e0: 6420 696e 6465 7869 6e67 2065 7373 656e  d indexing essen
-000166f0: 7469 616c 6c79 206a 7573 7420 6173 2066  tially just as f
-00016700: 6173 7420 6173 0a20 2020 2020 2020 2075  ast as.        u
-00016710: 7369 6e67 2069 6e74 6567 6572 2069 6e64  sing integer ind
-00016720: 6578 696e 672e 0a0a 2020 2020 2020 2020  exing...        
-00016730: 4974 2061 6c73 6f20 6d65 616e 7320 7468  It also means th
-00016740: 6973 206d 6574 686f 6420 7573 6573 2070  is method uses p
-00016750: 616e 6461 7327 7320 2877 656c 6c20 646f  andas's (well do
-00016760: 6375 6d65 6e74 6564 2920 6c6f 6769 6320  cumented) logic 
-00016770: 666f 720a 2020 2020 2020 2020 696e 6465  for.        inde
-00016780: 7869 6e67 2e20 5468 6973 206d 6561 6e73  xing. This means
-00016790: 2079 6f75 2063 616e 2075 7365 2073 7472   you can use str
-000167a0: 696e 6720 7368 6f72 7463 7574 7320 666f  ing shortcuts fo
-000167b0: 7220 6461 7465 7469 6d65 2069 6e64 6578  r datetime index
-000167c0: 6573 0a20 2020 2020 2020 2028 652e 672e  es.        (e.g.
-000167d0: 2c20 2732 3030 302d 3031 2720 746f 2073  , '2000-01' to s
-000167e0: 656c 6563 7420 616c 6c20 7661 6c75 6573  elect all values
-000167f0: 2069 6e20 4a61 6e75 6172 7920 3230 3030   in January 2000
-00016800: 292e 2049 7420 616c 736f 206d 6561 6e73  ). It also means
-00016810: 0a20 2020 2020 2020 2074 6861 7420 736c  .        that sl
-00016820: 6963 6573 2061 7265 2074 7265 6174 6564  ices are treated
-00016830: 2061 7320 696e 636c 7573 6976 6520 6f66   as inclusive of
-00016840: 2062 6f74 6820 7468 6520 7374 6172 7420   both the start 
-00016850: 616e 6420 7374 6f70 2076 616c 7565 732c  and stop values,
-00016860: 0a20 2020 2020 2020 2075 6e6c 696b 6520  .        unlike 
-00016870: 6e6f 726d 616c 2050 7974 686f 6e20 696e  normal Python in
-00016880: 6465 7869 6e67 2e0a 0a20 2020 2020 2020  dexing...       
-00016890: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000168a0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000168b0: 2020 2020 2020 2069 6e64 6578 6572 7320         indexers 
-000168c0: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
-000168d0: 0a20 2020 2020 2020 2020 2020 2041 2064  .            A d
-000168e0: 6963 7420 7769 7468 206b 6579 7320 6d61  ict with keys ma
-000168f0: 7463 6869 6e67 2064 696d 656e 7369 6f6e  tching dimension
-00016900: 7320 616e 6420 7661 6c75 6573 2067 6976  s and values giv
-00016910: 656e 0a20 2020 2020 2020 2020 2020 2062  en.            b
-00016920: 7920 7363 616c 6172 732c 2073 6c69 6365  y scalars, slice
-00016930: 7320 6f72 2061 7272 6179 7320 6f66 2074  s or arrays of t
-00016940: 6963 6b20 6c61 6265 6c73 2e20 466f 7220  ick labels. For 
-00016950: 6469 6d65 6e73 696f 6e73 2077 6974 680a  dimensions with.
-00016960: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
-00016970: 692d 696e 6465 782c 2074 6865 2069 6e64  i-index, the ind
-00016980: 6578 6572 206d 6179 2061 6c73 6f20 6265  exer may also be
-00016990: 2061 2064 6963 742d 6c69 6b65 206f 626a   a dict-like obj
-000169a0: 6563 7420 7769 7468 206b 6579 730a 2020  ect with keys.  
-000169b0: 2020 2020 2020 2020 2020 6d61 7463 6869            matchi
-000169c0: 6e67 2069 6e64 6578 206c 6576 656c 206e  ng index level n
-000169d0: 616d 6573 2e0a 2020 2020 2020 2020 2020  ames..          
-000169e0: 2020 4966 2044 6174 6141 7272 6179 7320    If DataArrays 
-000169f0: 6172 6520 7061 7373 6564 2061 7320 696e  are passed as in
-00016a00: 6465 7865 7273 2c20 7861 7272 6179 2d73  dexers, xarray-s
-00016a10: 7479 6c65 2069 6e64 6578 696e 6720 7769  tyle indexing wi
-00016a20: 6c6c 2062 650a 2020 2020 2020 2020 2020  ll be.          
-00016a30: 2020 6361 7272 6965 6420 6f75 742e 2053    carried out. S
-00016a40: 6565 203a 7265 663a 6069 6e64 6578 696e  ee :ref:`indexin
-00016a50: 6760 2066 6f72 2074 6865 2064 6574 6169  g` for the detai
-00016a60: 6c73 2e0a 2020 2020 2020 2020 2020 2020  ls..            
-00016a70: 4f6e 6520 6f66 2069 6e64 6578 6572 7320  One of indexers 
-00016a80: 6f72 2069 6e64 6578 6572 735f 6b77 6172  or indexers_kwar
-00016a90: 6773 206d 7573 7420 6265 2070 726f 7669  gs must be provi
-00016aa0: 6465 642e 0a20 2020 2020 2020 206d 6574  ded..        met
-00016ab0: 686f 6420 3a20 7b4e 6f6e 652c 2022 6e65  hod : {None, "ne
-00016ac0: 6172 6573 7422 2c20 2270 6164 222c 2022  arest", "pad", "
-00016ad0: 6666 696c 6c22 2c20 2262 6163 6b66 696c  ffill", "backfil
-00016ae0: 6c22 2c20 2262 6669 6c6c 227d 2c20 6f70  l", "bfill"}, op
-00016af0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00016b00: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
-00016b10: 2066 6f72 2069 6e65 7861 6374 206d 6174   for inexact mat
-00016b20: 6368 6573 3a0a 0a20 2020 2020 2020 2020  ches:..         
-00016b30: 2020 202a 204e 6f6e 6520 2864 6566 6175     * None (defau
-00016b40: 6c74 293a 206f 6e6c 7920 6578 6163 7420  lt): only exact 
-00016b50: 6d61 7463 6865 730a 2020 2020 2020 2020  matches.        
-00016b60: 2020 2020 2a20 7061 6420 2f20 6666 696c      * pad / ffil
-00016b70: 6c3a 2070 726f 7061 6761 7465 206c 6173  l: propagate las
-00016b80: 7420 7661 6c69 6420 696e 6465 7820 7661  t valid index va
-00016b90: 6c75 6520 666f 7277 6172 640a 2020 2020  lue forward.    
-00016ba0: 2020 2020 2020 2020 2a20 6261 636b 6669          * backfi
-00016bb0: 6c6c 202f 2062 6669 6c6c 3a20 7072 6f70  ll / bfill: prop
-00016bc0: 6167 6174 6520 6e65 7874 2076 616c 6964  agate next valid
-00016bd0: 2069 6e64 6578 2076 616c 7565 2062 6163   index value bac
-00016be0: 6b77 6172 640a 2020 2020 2020 2020 2020  kward.          
-00016bf0: 2020 2a20 6e65 6172 6573 743a 2075 7365    * nearest: use
-00016c00: 206e 6561 7265 7374 2076 616c 6964 2069   nearest valid i
-00016c10: 6e64 6578 2076 616c 7565 0a20 2020 2020  ndex value.     
-00016c20: 2020 2074 6f6c 6572 616e 6365 203a 206f     tolerance : o
-00016c30: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00016c40: 2020 2020 4d61 7869 6d75 6d20 6469 7374      Maximum dist
-00016c50: 616e 6365 2062 6574 7765 656e 206f 7269  ance between ori
-00016c60: 6769 6e61 6c20 616e 6420 6e65 7720 6c61  ginal and new la
-00016c70: 6265 6c73 2066 6f72 2069 6e65 7861 6374  bels for inexact
-00016c80: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-00016c90: 6368 6573 2e20 5468 6520 7661 6c75 6573  ches. The values
-00016ca0: 206f 6620 7468 6520 696e 6465 7820 6174   of the index at
-00016cb0: 2074 6865 206d 6174 6368 696e 6720 6c6f   the matching lo
-00016cc0: 6361 7469 6f6e 7320 6d75 7374 0a20 2020  cations must.   
-00016cd0: 2020 2020 2020 2020 2073 6174 6973 6679           satisfy
-00016ce0: 2074 6865 2065 7175 6174 696f 6e20 6060   the equation ``
-00016cf0: 6162 7328 696e 6465 785b 696e 6465 7865  abs(index[indexe
-00016d00: 725d 202d 2074 6172 6765 7429 203c 3d20  r] - target) <= 
-00016d10: 746f 6c65 7261 6e63 6560 602e 0a20 2020  tolerance``..   
-00016d20: 2020 2020 2064 726f 7020 3a20 626f 6f6c       drop : bool
-00016d30: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00016d40: 2020 2020 2020 2049 6620 6060 6472 6f70         If ``drop
-00016d50: 3d54 7275 6560 602c 2064 726f 7020 636f  =True``, drop co
-00016d60: 6f72 6469 6e61 7465 7320 7661 7269 6162  ordinates variab
-00016d70: 6c65 7320 696e 2060 696e 6465 7865 7273  les in `indexers
-00016d80: 6020 696e 7374 6561 640a 2020 2020 2020  ` instead.      
-00016d90: 2020 2020 2020 6f66 206d 616b 696e 6720        of making 
-00016da0: 7468 656d 2073 6361 6c61 722e 0a20 2020  them scalar..   
-00016db0: 2020 2020 202a 2a69 6e64 6578 6572 735f       **indexers_
-00016dc0: 6b77 6172 6773 203a 207b 6469 6d3a 2069  kwargs : {dim: i
-00016dd0: 6e64 6578 6572 2c20 2e2e 2e7d 2c20 6f70  ndexer, ...}, op
-00016de0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00016df0: 2020 2054 6865 206b 6579 776f 7264 2061     The keyword a
-00016e00: 7267 756d 656e 7473 2066 6f72 6d20 6f66  rguments form of
-00016e10: 2060 6069 6e64 6578 6572 7360 602e 0a20   ``indexers``.. 
-00016e20: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
-00016e30: 6620 696e 6465 7865 7273 206f 7220 696e  f indexers or in
-00016e40: 6465 7865 7273 5f6b 7761 7267 7320 6d75  dexers_kwargs mu
-00016e50: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
-00016e60: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00016e70: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00016e80: 0a20 2020 2020 2020 206f 626a 203a 2044  .        obj : D
-00016e90: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
-00016ea0: 2020 2041 206e 6577 2044 6174 6173 6574     A new Dataset
-00016eb0: 2077 6974 6820 7468 6520 7361 6d65 2063   with the same c
-00016ec0: 6f6e 7465 6e74 7320 6173 2074 6869 7320  ontents as this 
-00016ed0: 6461 7461 7365 742c 2065 7863 6570 7420  dataset, except 
-00016ee0: 6561 6368 0a20 2020 2020 2020 2020 2020  each.           
-00016ef0: 2076 6172 6961 626c 6520 616e 6420 6469   variable and di
-00016f00: 6d65 6e73 696f 6e20 6973 2069 6e64 6578  mension is index
-00016f10: 6564 2062 7920 7468 6520 6170 7072 6f70  ed by the approp
-00016f20: 7269 6174 6520 696e 6465 7865 7273 2e0a  riate indexers..
-00016f30: 2020 2020 2020 2020 2020 2020 4966 2069              If i
-00016f40: 6e64 6578 6572 2044 6174 6141 7272 6179  ndexer DataArray
-00016f50: 7320 6861 7665 2063 6f6f 7264 696e 6174  s have coordinat
-00016f60: 6573 2074 6861 7420 646f 206e 6f74 2063  es that do not c
-00016f70: 6f6e 666c 6963 7420 7769 7468 0a20 2020  onflict with.   
-00016f80: 2020 2020 2020 2020 2074 6869 7320 6f62           this ob
-00016f90: 6a65 6374 2c20 7468 656e 2074 6865 7365  ject, then these
-00016fa0: 2063 6f6f 7264 696e 6174 6573 2077 696c   coordinates wil
-00016fb0: 6c20 6265 2061 7474 6163 6865 642e 0a20  l be attached.. 
-00016fc0: 2020 2020 2020 2020 2020 2049 6e20 6765             In ge
-00016fd0: 6e65 7261 6c2c 2065 6163 6820 6172 7261  neral, each arra
-00016fe0: 7927 7320 6461 7461 2077 696c 6c20 6265  y's data will be
-00016ff0: 2061 2076 6965 7720 6f66 2074 6865 2061   a view of the a
-00017000: 7272 6179 2773 2064 6174 610a 2020 2020  rray's data.    
-00017010: 2020 2020 2020 2020 696e 2074 6869 7320          in this 
-00017020: 6461 7461 7365 742c 2075 6e6c 6573 7320  dataset, unless 
-00017030: 7665 6374 6f72 697a 6564 2069 6e64 6578  vectorized index
-00017040: 696e 6720 7761 7320 7472 6967 6765 7265  ing was triggere
-00017050: 6420 6279 2075 7369 6e67 0a20 2020 2020  d by using.     
-00017060: 2020 2020 2020 2061 6e20 6172 7261 7920         an array 
-00017070: 696e 6465 7865 722c 2069 6e20 7768 6963  indexer, in whic
-00017080: 6820 6361 7365 2074 6865 2064 6174 6120  h case the data 
-00017090: 7769 6c6c 2062 6520 6120 636f 7079 2e0a  will be a copy..
-000170a0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-000170b0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-000170c0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
-000170d0: 6574 2e69 7365 6c0a 2020 2020 2020 2020  et.isel.        
-000170e0: 4461 7461 4172 7261 792e 7365 6c0a 2020  DataArray.sel.  
-000170f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00017100: 2020 696e 6465 7865 7273 203d 2065 6974    indexers = eit
-00017110: 6865 725f 6469 6374 5f6f 725f 6b77 6172  her_dict_or_kwar
-00017120: 6773 2869 6e64 6578 6572 732c 2069 6e64  gs(indexers, ind
-00017130: 6578 6572 735f 6b77 6172 6773 2c20 2273  exers_kwargs, "s
-00017140: 656c 2229 0a20 2020 2020 2020 2071 7565  el").        que
-00017150: 7279 5f72 6573 756c 7473 203d 206d 6170  ry_results = map
-00017160: 5f69 6e64 6578 5f71 7565 7269 6573 280a  _index_queries(.
-00017170: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00017180: 2c20 696e 6465 7865 7273 3d69 6e64 6578  , indexers=index
-00017190: 6572 732c 206d 6574 686f 643d 6d65 7468  ers, method=meth
-000171a0: 6f64 2c20 746f 6c65 7261 6e63 653d 746f  od, tolerance=to
-000171b0: 6c65 7261 6e63 650a 2020 2020 2020 2020  lerance.        
-000171c0: 290a 0a20 2020 2020 2020 2069 6620 6472  )..        if dr
-000171d0: 6f70 3a0a 2020 2020 2020 2020 2020 2020  op:.            
-000171e0: 6e6f 5f73 6361 6c61 725f 7661 7269 6162  no_scalar_variab
-000171f0: 6c65 7320 3d20 7b7d 0a20 2020 2020 2020  les = {}.       
-00017200: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
-00017210: 2071 7565 7279 5f72 6573 756c 7473 2e76   query_results.v
-00017220: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
-00017230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017240: 2020 6966 2076 2e64 696d 733a 0a20 2020    if v.dims:.   
-00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017260: 206e 6f5f 7363 616c 6172 5f76 6172 6961   no_scalar_varia
-00017270: 626c 6573 5b6b 5d20 3d20 760a 2020 2020  bles[k] = v.    
-00017280: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00017290: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000172a0: 2020 2020 2020 6966 206b 2069 6e20 7365        if k in se
-000172b0: 6c66 2e5f 636f 6f72 645f 6e61 6d65 733a  lf._coord_names:
-000172c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000172d0: 2020 2020 2020 2020 2071 7565 7279 5f72           query_r
-000172e0: 6573 756c 7473 2e64 726f 705f 636f 6f72  esults.drop_coor
-000172f0: 6473 2e61 7070 656e 6428 6b29 0a20 2020  ds.append(k).   
-00017300: 2020 2020 2020 2020 2071 7565 7279 5f72           query_r
-00017310: 6573 756c 7473 2e76 6172 6961 626c 6573  esults.variables
-00017320: 203d 206e 6f5f 7363 616c 6172 5f76 6172   = no_scalar_var
-00017330: 6961 626c 6573 0a0a 2020 2020 2020 2020  iables..        
-00017340: 7265 7375 6c74 203d 2073 656c 662e 6973  result = self.is
-00017350: 656c 2869 6e64 6578 6572 733d 7175 6572  el(indexers=quer
-00017360: 795f 7265 7375 6c74 732e 6469 6d5f 696e  y_results.dim_in
-00017370: 6465 7865 7273 2c20 6472 6f70 3d64 726f  dexers, drop=dro
-00017380: 7029 0a20 2020 2020 2020 2072 6574 7572  p).        retur
-00017390: 6e20 7265 7375 6c74 2e5f 6f76 6572 7772  n result._overwr
-000173a0: 6974 655f 696e 6465 7865 7328 2a71 7565  ite_indexes(*que
-000173b0: 7279 5f72 6573 756c 7473 2e61 735f 7475  ry_results.as_tu
-000173c0: 706c 6528 295b 313a 5d29 0a0a 2020 2020  ple()[1:])..    
-000173d0: 6465 6620 6865 6164 280a 2020 2020 2020  def head(.      
-000173e0: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
-000173f0: 742c 0a20 2020 2020 2020 2069 6e64 6578  t,.        index
-00017400: 6572 733a 204d 6170 7069 6e67 5b41 6e79  ers: Mapping[Any
-00017410: 2c20 696e 745d 207c 2069 6e74 207c 204e  , int] | int | N
-00017420: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00017430: 2020 2020 2a2a 696e 6465 7865 7273 5f6b      **indexers_k
-00017440: 7761 7267 733a 2041 6e79 2c0a 2020 2020  wargs: Any,.    
-00017450: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-00017460: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00017470: 6e73 2061 206e 6577 2064 6174 6173 6574  ns a new dataset
-00017480: 2077 6974 6820 7468 6520 6669 7273 7420   with the first 
-00017490: 606e 6020 7661 6c75 6573 206f 6620 6561  `n` values of ea
-000174a0: 6368 2061 7272 6179 0a20 2020 2020 2020  ch array.       
-000174b0: 2066 6f72 2074 6865 2073 7065 6369 6669   for the specifi
-000174c0: 6564 2064 696d 656e 7369 6f6e 2873 292e  ed dimension(s).
-000174d0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-000174e0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-000174f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00017500: 696e 6465 7865 7273 203a 2064 6963 7420  indexers : dict 
-00017510: 6f72 2069 6e74 2c20 6465 6661 756c 743a  or int, default:
-00017520: 2035 0a20 2020 2020 2020 2020 2020 2041   5.            A
-00017530: 2064 6963 7420 7769 7468 206b 6579 7320   dict with keys 
-00017540: 6d61 7463 6869 6e67 2064 696d 656e 7369  matching dimensi
-00017550: 6f6e 7320 616e 6420 696e 7465 6765 7220  ons and integer 
-00017560: 7661 6c75 6573 2060 6e60 0a20 2020 2020  values `n`.     
-00017570: 2020 2020 2020 206f 7220 6120 7369 6e67         or a sing
-00017580: 6c65 2069 6e74 6567 6572 2060 6e60 2061  le integer `n` a
-00017590: 7070 6c69 6564 206f 7665 7220 616c 6c20  pplied over all 
-000175a0: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
-000175b0: 2020 2020 2020 2020 4f6e 6520 6f66 2069          One of i
-000175c0: 6e64 6578 6572 7320 6f72 2069 6e64 6578  ndexers or index
-000175d0: 6572 735f 6b77 6172 6773 206d 7573 7420  ers_kwargs must 
-000175e0: 6265 2070 726f 7669 6465 642e 0a20 2020  be provided..   
-000175f0: 2020 2020 202a 2a69 6e64 6578 6572 735f       **indexers_
-00017600: 6b77 6172 6773 203a 207b 6469 6d3a 206e  kwargs : {dim: n
-00017610: 2c20 2e2e 2e7d 2c20 6f70 7469 6f6e 616c  , ...}, optional
-00017620: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00017630: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00017640: 7473 2066 6f72 6d20 6f66 2060 6069 6e64  ts form of ``ind
-00017650: 6578 6572 7360 602e 0a20 2020 2020 2020  exers``..       
-00017660: 2020 2020 204f 6e65 206f 6620 696e 6465       One of inde
-00017670: 7865 7273 206f 7220 696e 6465 7865 7273  xers or indexers
-00017680: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
-00017690: 7072 6f76 6964 6564 2e0a 0a20 2020 2020  provided...     
-000176a0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-000176b0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-000176c0: 2020 2020 2044 6174 6173 6574 2e74 6169       Dataset.tai
-000176d0: 6c0a 2020 2020 2020 2020 4461 7461 7365  l.        Datase
-000176e0: 742e 7468 696e 0a20 2020 2020 2020 2044  t.thin.        D
-000176f0: 6174 6141 7272 6179 2e68 6561 640a 2020  ataArray.head.  
-00017700: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00017710: 2020 6966 206e 6f74 2069 6e64 6578 6572    if not indexer
-00017720: 735f 6b77 6172 6773 3a0a 2020 2020 2020  s_kwargs:.      
-00017730: 2020 2020 2020 6966 2069 6e64 6578 6572        if indexer
-00017740: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00017750: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00017760: 6572 7320 3d20 350a 2020 2020 2020 2020  ers = 5.        
-00017770: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00017780: 7461 6e63 6528 696e 6465 7865 7273 2c20  tance(indexers, 
-00017790: 696e 7429 2061 6e64 206e 6f74 2069 735f  int) and not is_
-000177a0: 6469 6374 5f6c 696b 6528 696e 6465 7865  dict_like(indexe
-000177b0: 7273 293a 0a20 2020 2020 2020 2020 2020  rs):.           
-000177c0: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-000177d0: 7272 6f72 2822 696e 6465 7865 7273 206d  rror("indexers m
-000177e0: 7573 7420 6265 2065 6974 6865 7220 6469  ust be either di
-000177f0: 6374 2d6c 696b 6520 6f72 2061 2073 696e  ct-like or a sin
-00017800: 676c 6520 696e 7465 6765 7222 290a 2020  gle integer").  
-00017810: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00017820: 6e63 6528 696e 6465 7865 7273 2c20 696e  nce(indexers, in
-00017830: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00017840: 696e 6465 7865 7273 203d 207b 6469 6d3a  indexers = {dim:
-00017850: 2069 6e64 6578 6572 7320 666f 7220 6469   indexers for di
-00017860: 6d20 696e 2073 656c 662e 6469 6d73 7d0a  m in self.dims}.
-00017870: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
-00017880: 203d 2065 6974 6865 725f 6469 6374 5f6f   = either_dict_o
-00017890: 725f 6b77 6172 6773 2869 6e64 6578 6572  r_kwargs(indexer
-000178a0: 732c 2069 6e64 6578 6572 735f 6b77 6172  s, indexers_kwar
-000178b0: 6773 2c20 2268 6561 6422 290a 2020 2020  gs, "head").    
-000178c0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
-000178d0: 696e 6465 7865 7273 2e69 7465 6d73 2829  indexers.items()
-000178e0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000178f0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00017900: 762c 2069 6e74 293a 0a20 2020 2020 2020  v, int):.       
-00017910: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-00017920: 7970 6545 7272 6f72 280a 2020 2020 2020  ypeError(.      
-00017930: 2020 2020 2020 2020 2020 2020 2020 2265                "e
-00017940: 7870 6563 7465 6420 696e 7465 6765 7220  xpected integer 
-00017950: 7479 7065 2069 6e64 6578 6572 2066 6f72  type indexer for
-00017960: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00017970: 2020 2020 2020 2066 2264 696d 656e 7369         f"dimensi
-00017980: 6f6e 207b 6b21 727d 2c20 666f 756e 6420  on {k!r}, found 
-00017990: 7b74 7970 6528 7629 2172 7d22 0a20 2020  {type(v)!r}".   
-000179a0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-000179b0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000179c0: 7620 3c20 303a 0a20 2020 2020 2020 2020  v < 0:.         
-000179d0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000179e0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-000179f0: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
-00017a00: 7065 6374 6564 2070 6f73 6974 6976 6520  pected positive 
-00017a10: 696e 7465 6765 7220 6173 2069 6e64 6578  integer as index
-00017a20: 6572 2022 0a20 2020 2020 2020 2020 2020  er ".           
-00017a30: 2020 2020 2020 2020 2066 2266 6f72 2064           f"for d
-00017a40: 696d 656e 7369 6f6e 207b 6b21 727d 2c20  imension {k!r}, 
-00017a50: 666f 756e 6420 7b76 7d22 0a20 2020 2020  found {v}".     
-00017a60: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00017a70: 2020 2020 2069 6e64 6578 6572 735f 736c       indexers_sl
-00017a80: 6963 6573 203d 207b 6b3a 2073 6c69 6365  ices = {k: slice
-00017a90: 2876 616c 2920 666f 7220 6b2c 2076 616c  (val) for k, val
-00017aa0: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
-00017ab0: 6d73 2829 7d0a 2020 2020 2020 2020 7265  ms()}.        re
-00017ac0: 7475 726e 2073 656c 662e 6973 656c 2869  turn self.isel(i
-00017ad0: 6e64 6578 6572 735f 736c 6963 6573 290a  ndexers_slices).
-00017ae0: 0a20 2020 2064 6566 2074 6169 6c28 0a20  .    def tail(. 
-00017af0: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
-00017b00: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
-00017b10: 696e 6465 7865 7273 3a20 4d61 7070 696e  indexers: Mappin
-00017b20: 675b 416e 792c 2069 6e74 5d20 7c20 696e  g[Any, int] | in
-00017b30: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
-00017b40: 0a20 2020 2020 2020 202a 2a69 6e64 6578  .        **index
-00017b50: 6572 735f 6b77 6172 6773 3a20 416e 792c  ers_kwargs: Any,
-00017b60: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
-00017b70: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-00017b80: 5265 7475 726e 7320 6120 6e65 7720 6461  Returns a new da
-00017b90: 7461 7365 7420 7769 7468 2074 6865 206c  taset with the l
-00017ba0: 6173 7420 606e 6020 7661 6c75 6573 206f  ast `n` values o
-00017bb0: 6620 6561 6368 2061 7272 6179 0a20 2020  f each array.   
-00017bc0: 2020 2020 2066 6f72 2074 6865 2073 7065       for the spe
-00017bd0: 6369 6669 6564 2064 696d 656e 7369 6f6e  cified dimension
-00017be0: 2873 292e 0a0a 2020 2020 2020 2020 5061  (s)...        Pa
-00017bf0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00017c00: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00017c10: 2020 2020 696e 6465 7865 7273 203a 2064      indexers : d
-00017c20: 6963 7420 6f72 2069 6e74 2c20 6465 6661  ict or int, defa
-00017c30: 756c 743a 2035 0a20 2020 2020 2020 2020  ult: 5.         
-00017c40: 2020 2041 2064 6963 7420 7769 7468 206b     A dict with k
-00017c50: 6579 7320 6d61 7463 6869 6e67 2064 696d  eys matching dim
-00017c60: 656e 7369 6f6e 7320 616e 6420 696e 7465  ensions and inte
-00017c70: 6765 7220 7661 6c75 6573 2060 6e60 0a20  ger values `n`. 
-00017c80: 2020 2020 2020 2020 2020 206f 7220 6120             or a 
-00017c90: 7369 6e67 6c65 2069 6e74 6567 6572 2060  single integer `
-00017ca0: 6e60 2061 7070 6c69 6564 206f 7665 7220  n` applied over 
-00017cb0: 616c 6c20 6469 6d65 6e73 696f 6e73 2e0a  all dimensions..
-00017cc0: 2020 2020 2020 2020 2020 2020 4f6e 6520              One 
-00017cd0: 6f66 2069 6e64 6578 6572 7320 6f72 2069  of indexers or i
-00017ce0: 6e64 6578 6572 735f 6b77 6172 6773 206d  ndexers_kwargs m
-00017cf0: 7573 7420 6265 2070 726f 7669 6465 642e  ust be provided.
-00017d00: 0a20 2020 2020 2020 202a 2a69 6e64 6578  .        **index
-00017d10: 6572 735f 6b77 6172 6773 203a 207b 6469  ers_kwargs : {di
-00017d20: 6d3a 206e 2c20 2e2e 2e7d 2c20 6f70 7469  m: n, ...}, opti
-00017d30: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00017d40: 2054 6865 206b 6579 776f 7264 2061 7267   The keyword arg
-00017d50: 756d 656e 7473 2066 6f72 6d20 6f66 2060  uments form of `
-00017d60: 6069 6e64 6578 6572 7360 602e 0a20 2020  `indexers``..   
-00017d70: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
-00017d80: 696e 6465 7865 7273 206f 7220 696e 6465  indexers or inde
-00017d90: 7865 7273 5f6b 7761 7267 7320 6d75 7374  xers_kwargs must
-00017da0: 2062 6520 7072 6f76 6964 6564 2e0a 0a20   be provided... 
-00017db0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00017dc0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00017dd0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-00017de0: 2e68 6561 640a 2020 2020 2020 2020 4461  .head.        Da
-00017df0: 7461 7365 742e 7468 696e 0a20 2020 2020  taset.thin.     
-00017e00: 2020 2044 6174 6141 7272 6179 2e74 6169     DataArray.tai
-00017e10: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
-00017e20: 2020 2020 2020 6966 206e 6f74 2069 6e64        if not ind
-00017e30: 6578 6572 735f 6b77 6172 6773 3a0a 2020  exers_kwargs:.  
-00017e40: 2020 2020 2020 2020 2020 6966 2069 6e64            if ind
-00017e50: 6578 6572 7320 6973 204e 6f6e 653a 0a20  exers is None:. 
-00017e60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017e70: 6e64 6578 6572 7320 3d20 350a 2020 2020  ndexers = 5.    
-00017e80: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00017e90: 7369 6e73 7461 6e63 6528 696e 6465 7865  sinstance(indexe
-00017ea0: 7273 2c20 696e 7429 2061 6e64 206e 6f74  rs, int) and not
-00017eb0: 2069 735f 6469 6374 5f6c 696b 6528 696e   is_dict_like(in
-00017ec0: 6465 7865 7273 293a 0a20 2020 2020 2020  dexers):.       
-00017ed0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-00017ee0: 7970 6545 7272 6f72 2822 696e 6465 7865  ypeError("indexe
-00017ef0: 7273 206d 7573 7420 6265 2065 6974 6865  rs must be eithe
-00017f00: 7220 6469 6374 2d6c 696b 6520 6f72 2061  r dict-like or a
-00017f10: 2073 696e 676c 6520 696e 7465 6765 7222   single integer"
-00017f20: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
-00017f30: 6e73 7461 6e63 6528 696e 6465 7865 7273  nstance(indexers
-00017f40: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
-00017f50: 2020 2020 696e 6465 7865 7273 203d 207b      indexers = {
-00017f60: 6469 6d3a 2069 6e64 6578 6572 7320 666f  dim: indexers fo
-00017f70: 7220 6469 6d20 696e 2073 656c 662e 6469  r dim in self.di
-00017f80: 6d73 7d0a 2020 2020 2020 2020 696e 6465  ms}.        inde
-00017f90: 7865 7273 203d 2065 6974 6865 725f 6469  xers = either_di
-00017fa0: 6374 5f6f 725f 6b77 6172 6773 2869 6e64  ct_or_kwargs(ind
-00017fb0: 6578 6572 732c 2069 6e64 6578 6572 735f  exers, indexers_
-00017fc0: 6b77 6172 6773 2c20 2274 6169 6c22 290a  kwargs, "tail").
-00017fd0: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-00017fe0: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
-00017ff0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00018000: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00018010: 6e63 6528 762c 2069 6e74 293a 0a20 2020  nce(v, int):.   
-00018020: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00018030: 7365 2054 7970 6545 7272 6f72 280a 2020  se TypeError(.  
-00018040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018050: 2020 2265 7870 6563 7465 6420 696e 7465    "expected inte
-00018060: 6765 7220 7479 7065 2069 6e64 6578 6572  ger type indexer
-00018070: 2066 6f72 2022 0a20 2020 2020 2020 2020   for ".         
-00018080: 2020 2020 2020 2020 2020 2066 2264 696d             f"dim
-00018090: 656e 7369 6f6e 207b 6b21 727d 2c20 666f  ension {k!r}, fo
-000180a0: 756e 6420 7b74 7970 6528 7629 2172 7d22  und {type(v)!r}"
-000180b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000180c0: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
-000180d0: 6c69 6620 7620 3c20 303a 0a20 2020 2020  lif v < 0:.     
-000180e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000180f0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00018100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018110: 2022 6578 7065 6374 6564 2070 6f73 6974   "expected posit
-00018120: 6976 6520 696e 7465 6765 7220 6173 2069  ive integer as i
-00018130: 6e64 6578 6572 2022 0a20 2020 2020 2020  ndexer ".       
-00018140: 2020 2020 2020 2020 2020 2020 2066 2266               f"f
-00018150: 6f72 2064 696d 656e 7369 6f6e 207b 6b21  or dimension {k!
-00018160: 727d 2c20 666f 756e 6420 7b76 7d22 0a20  r}, found {v}". 
-00018170: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00018180: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
-00018190: 735f 736c 6963 6573 203d 207b 0a20 2020  s_slices = {.   
-000181a0: 2020 2020 2020 2020 206b 3a20 736c 6963           k: slic
-000181b0: 6528 2d76 616c 2c20 4e6f 6e65 2920 6966  e(-val, None) if
-000181c0: 2076 616c 2021 3d20 3020 656c 7365 2073   val != 0 else s
-000181d0: 6c69 6365 2876 616c 290a 2020 2020 2020  lice(val).      
-000181e0: 2020 2020 2020 666f 7220 6b2c 2076 616c        for k, val
-000181f0: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
-00018200: 6d73 2829 0a20 2020 2020 2020 207d 0a20  ms().        }. 
-00018210: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00018220: 6c66 2e69 7365 6c28 696e 6465 7865 7273  lf.isel(indexers
-00018230: 5f73 6c69 6365 7329 0a0a 2020 2020 6465  _slices)..    de
-00018240: 6620 7468 696e 280a 2020 2020 2020 2020  f thin(.        
-00018250: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-00018260: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
-00018270: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
-00018280: 696e 745d 207c 2069 6e74 207c 204e 6f6e  int] | int | Non
-00018290: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-000182a0: 2020 2a2a 696e 6465 7865 7273 5f6b 7761    **indexers_kwa
-000182b0: 7267 733a 2041 6e79 2c0a 2020 2020 2920  rgs: Any,.    ) 
-000182c0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-000182d0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-000182e0: 2061 206e 6577 2064 6174 6173 6574 2077   a new dataset w
-000182f0: 6974 6820 6561 6368 2061 7272 6179 2069  ith each array i
-00018300: 6e64 6578 6564 2061 6c6f 6e67 2065 7665  ndexed along eve
-00018310: 7279 2060 6e60 2d74 680a 2020 2020 2020  ry `n`-th.      
-00018320: 2020 7661 6c75 6520 666f 7220 7468 6520    value for the 
-00018330: 7370 6563 6966 6965 6420 6469 6d65 6e73  specified dimens
-00018340: 696f 6e28 7329 0a0a 2020 2020 2020 2020  ion(s)..        
-00018350: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00018360: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00018370: 2020 2020 2020 696e 6465 7865 7273 203a        indexers :
-00018380: 2064 6963 7420 6f72 2069 6e74 0a20 2020   dict or int.   
-00018390: 2020 2020 2020 2020 2041 2064 6963 7420           A dict 
-000183a0: 7769 7468 206b 6579 7320 6d61 7463 6869  with keys matchi
-000183b0: 6e67 2064 696d 656e 7369 6f6e 7320 616e  ng dimensions an
-000183c0: 6420 696e 7465 6765 7220 7661 6c75 6573  d integer values
-000183d0: 2060 6e60 0a20 2020 2020 2020 2020 2020   `n`.           
-000183e0: 206f 7220 6120 7369 6e67 6c65 2069 6e74   or a single int
-000183f0: 6567 6572 2060 6e60 2061 7070 6c69 6564  eger `n` applied
-00018400: 206f 7665 7220 616c 6c20 6469 6d65 6e73   over all dimens
-00018410: 696f 6e73 2e0a 2020 2020 2020 2020 2020  ions..          
-00018420: 2020 4f6e 6520 6f66 2069 6e64 6578 6572    One of indexer
-00018430: 7320 6f72 2069 6e64 6578 6572 735f 6b77  s or indexers_kw
-00018440: 6172 6773 206d 7573 7420 6265 2070 726f  args must be pro
-00018450: 7669 6465 642e 0a20 2020 2020 2020 202a  vided..        *
-00018460: 2a69 6e64 6578 6572 735f 6b77 6172 6773  *indexers_kwargs
-00018470: 203a 207b 6469 6d3a 206e 2c20 2e2e 2e7d   : {dim: n, ...}
-00018480: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00018490: 2020 2020 2020 2054 6865 206b 6579 776f         The keywo
-000184a0: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
-000184b0: 6d20 6f66 2060 6069 6e64 6578 6572 7360  m of ``indexers`
-000184c0: 602e 0a20 2020 2020 2020 2020 2020 204f  `..            O
-000184d0: 6e65 206f 6620 696e 6465 7865 7273 206f  ne of indexers o
-000184e0: 7220 696e 6465 7865 7273 5f6b 7761 7267  r indexers_kwarg
-000184f0: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
-00018500: 6564 2e0a 0a20 2020 2020 2020 2045 7861  ed...        Exa
-00018510: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
-00018520: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
-00018530: 3e3e 2078 5f61 7272 203d 206e 702e 6172  >> x_arr = np.ar
-00018540: 616e 6765 2830 2c20 3236 290a 2020 2020  ange(0, 26).    
-00018550: 2020 2020 3e3e 3e20 785f 6172 720a 2020      >>> x_arr.  
-00018560: 2020 2020 2020 6172 7261 7928 5b20 302c        array([ 0,
-00018570: 2020 312c 2020 322c 2020 332c 2020 342c    1,  2,  3,  4,
-00018580: 2020 352c 2020 362c 2020 372c 2020 382c    5,  6,  7,  8,
-00018590: 2020 392c 2031 302c 2031 312c 2031 322c    9, 10, 11, 12,
-000185a0: 2031 332c 2031 342c 2031 352c 2031 362c   13, 14, 15, 16,
-000185b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000185c0: 3137 2c20 3138 2c20 3139 2c20 3230 2c20  17, 18, 19, 20, 
-000185d0: 3231 2c20 3232 2c20 3233 2c20 3234 2c20  21, 22, 23, 24, 
-000185e0: 3235 5d29 0a20 2020 2020 2020 203e 3e3e  25]).        >>>
-000185f0: 2078 203d 2078 722e 4461 7461 4172 7261   x = xr.DataArra
-00018600: 7928 0a20 2020 2020 2020 202e 2e2e 2020  y(.        ...  
-00018610: 2020 206e 702e 7265 7368 6170 6528 785f     np.reshape(x_
-00018620: 6172 722c 2028 322c 2031 3329 292c 0a20  arr, (2, 13)),. 
-00018630: 2020 2020 2020 202e 2e2e 2020 2020 2064         ...     d
-00018640: 696d 733d 2822 7822 2c20 2279 2229 2c0a  ims=("x", "y"),.
-00018650: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00018660: 636f 6f72 6473 3d7b 2278 223a 205b 302c  coords={"x": [0,
-00018670: 2031 5d2c 2022 7922 3a20 6e70 2e61 7261   1], "y": np.ara
-00018680: 6e67 6528 302c 2031 3329 7d2c 0a20 2020  nge(0, 13)},.   
-00018690: 2020 2020 202e 2e2e 2029 0a20 2020 2020       ... ).     
-000186a0: 2020 203e 3e3e 2078 5f64 7320 3d20 7872     >>> x_ds = xr
-000186b0: 2e44 6174 6173 6574 287b 2266 6f6f 223a  .Dataset({"foo":
-000186c0: 2078 7d29 0a20 2020 2020 2020 203e 3e3e   x}).        >>>
-000186d0: 2078 5f64 730a 2020 2020 2020 2020 3c78   x_ds.        <x
-000186e0: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-000186f0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-00018700: 733a 2020 2878 3a20 322c 2079 3a20 3133  s:  (x: 2, y: 13
-00018710: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
-00018720: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
-00018730: 202a 2078 2020 2020 2020 2020 2878 2920   * x        (x) 
-00018740: 696e 7436 3420 3020 310a 2020 2020 2020  int64 0 1.      
-00018750: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
-00018760: 7929 2069 6e74 3634 2030 2031 2032 2033  y) int64 0 1 2 3
-00018770: 2034 2035 2036 2037 2038 2039 2031 3020   4 5 6 7 8 9 10 
-00018780: 3131 2031 320a 2020 2020 2020 2020 4461  11 12.        Da
-00018790: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
-000187a0: 2020 2020 2020 2020 2020 666f 6f20 2020            foo   
-000187b0: 2020 2028 782c 2079 2920 696e 7436 3420     (x, y) int64 
-000187c0: 3020 3120 3220 3320 3420 3520 3620 3720  0 1 2 3 4 5 6 7 
-000187d0: 3820 3920 2e2e 2e20 3136 2031 3720 3138  8 9 ... 16 17 18
-000187e0: 2031 3920 3230 2032 3120 3232 2032 3320   19 20 21 22 23 
-000187f0: 3234 2032 350a 0a20 2020 2020 2020 203e  24 25..        >
-00018800: 3e3e 2078 5f64 732e 7468 696e 2833 290a  >> x_ds.thin(3).
-00018810: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-00018820: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-00018830: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-00018840: 3a20 312c 2079 3a20 3529 0a20 2020 2020  : 1, y: 5).     
-00018850: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-00018860: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-00018870: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
-00018880: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
-00018890: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
-000188a0: 3020 3320 3620 3920 3132 0a20 2020 2020  0 3 6 9 12.     
-000188b0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-000188c0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-000188d0: 6f6f 2020 2020 2020 2878 2c20 7929 2069  oo      (x, y) i
-000188e0: 6e74 3634 2030 2033 2036 2039 2031 320a  nt64 0 3 6 9 12.
-000188f0: 2020 2020 2020 2020 3e3e 3e20 782e 7468          >>> x.th
-00018900: 696e 287b 2278 223a 2032 2c20 2279 223a  in({"x": 2, "y":
-00018910: 2035 7d29 0a20 2020 2020 2020 203c 7861   5}).        <xa
-00018920: 7272 6179 2e44 6174 6141 7272 6179 2028  rray.DataArray (
-00018930: 783a 2031 2c20 793a 2033 293e 0a20 2020  x: 1, y: 3)>.   
-00018940: 2020 2020 2061 7272 6179 285b 5b20 302c       array([[ 0,
-00018950: 2020 352c 2031 305d 5d29 0a20 2020 2020    5, 10]]).     
-00018960: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-00018970: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-00018980: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
-00018990: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
-000189a0: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
-000189b0: 3020 3520 3130 0a0a 2020 2020 2020 2020  0 5 10..        
-000189c0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-000189d0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-000189e0: 2020 4461 7461 7365 742e 6865 6164 0a20    Dataset.head. 
-000189f0: 2020 2020 2020 2044 6174 6173 6574 2e74         Dataset.t
-00018a00: 6169 6c0a 2020 2020 2020 2020 4461 7461  ail.        Data
-00018a10: 4172 7261 792e 7468 696e 0a20 2020 2020  Array.thin.     
-00018a20: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00018a30: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00018a40: 6e6f 7420 696e 6465 7865 7273 5f6b 7761  not indexers_kwa
-00018a50: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-00018a60: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
-00018a70: 6365 2869 6e64 6578 6572 732c 2069 6e74  ce(indexers, int
-00018a80: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
-00018a90: 6420 6e6f 7420 6973 5f64 6963 745f 6c69  d not is_dict_li
-00018aa0: 6b65 2869 6e64 6578 6572 7329 0a20 2020  ke(indexers).   
-00018ab0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00018ac0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-00018ad0: 726f 7228 2269 6e64 6578 6572 7320 6d75  ror("indexers mu
-00018ae0: 7374 2062 6520 6569 7468 6572 2064 6963  st be either dic
-00018af0: 742d 6c69 6b65 206f 7220 6120 7369 6e67  t-like or a sing
-00018b00: 6c65 2069 6e74 6567 6572 2229 0a20 2020  le integer").   
-00018b10: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00018b20: 6365 2869 6e64 6578 6572 732c 2069 6e74  ce(indexers, int
-00018b30: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00018b40: 6e64 6578 6572 7320 3d20 7b64 696d 3a20  ndexers = {dim: 
-00018b50: 696e 6465 7865 7273 2066 6f72 2064 696d  indexers for dim
-00018b60: 2069 6e20 7365 6c66 2e64 696d 737d 0a20   in self.dims}. 
-00018b70: 2020 2020 2020 2069 6e64 6578 6572 7320         indexers 
-00018b80: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
-00018b90: 5f6b 7761 7267 7328 696e 6465 7865 7273  _kwargs(indexers
-00018ba0: 2c20 696e 6465 7865 7273 5f6b 7761 7267  , indexers_kwarg
-00018bb0: 732c 2022 7468 696e 2229 0a20 2020 2020  s, "thin").     
-00018bc0: 2020 2066 6f72 206b 2c20 7620 696e 2069     for k, v in i
-00018bd0: 6e64 6578 6572 732e 6974 656d 7328 293a  ndexers.items():
-00018be0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00018bf0: 6e6f 7420 6973 696e 7374 616e 6365 2876  not isinstance(v
-00018c00: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
-00018c10: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00018c20: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
-00018c30: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
-00018c40: 7065 6374 6564 2069 6e74 6567 6572 2074  pected integer t
-00018c50: 7970 6520 696e 6465 7865 7220 666f 7220  ype indexer for 
-00018c60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00018c70: 2020 2020 2020 6622 6469 6d65 6e73 696f        f"dimensio
-00018c80: 6e20 7b6b 2172 7d2c 2066 6f75 6e64 207b  n {k!r}, found {
-00018c90: 7479 7065 2876 2921 727d 220a 2020 2020  type(v)!r}".    
-00018ca0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00018cb0: 2020 2020 2020 2020 2020 656c 6966 2076            elif v
-00018cc0: 203c 2030 3a0a 2020 2020 2020 2020 2020   < 0:.          
-00018cd0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00018ce0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00018cf0: 2020 2020 2020 2020 2020 2020 2265 7870              "exp
-00018d00: 6563 7465 6420 706f 7369 7469 7665 2069  ected positive i
-00018d10: 6e74 6567 6572 2061 7320 696e 6465 7865  nteger as indexe
-00018d20: 7220 220a 2020 2020 2020 2020 2020 2020  r ".            
-00018d30: 2020 2020 2020 2020 6622 666f 7220 6469          f"for di
-00018d40: 6d65 6e73 696f 6e20 7b6b 2172 7d2c 2066  mension {k!r}, f
-00018d50: 6f75 6e64 207b 767d 220a 2020 2020 2020  ound {v}".      
-00018d60: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00018d70: 2020 2020 2020 2020 656c 6966 2076 203d          elif v =
-00018d80: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00018d90: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00018da0: 4572 726f 7228 2273 7465 7020 6361 6e6e  Error("step cann
-00018db0: 6f74 2062 6520 7a65 726f 2229 0a20 2020  ot be zero").   
-00018dc0: 2020 2020 2069 6e64 6578 6572 735f 736c       indexers_sl
-00018dd0: 6963 6573 203d 207b 6b3a 2073 6c69 6365  ices = {k: slice
-00018de0: 284e 6f6e 652c 204e 6f6e 652c 2076 616c  (None, None, val
-00018df0: 2920 666f 7220 6b2c 2076 616c 2069 6e20  ) for k, val in 
-00018e00: 696e 6465 7865 7273 2e69 7465 6d73 2829  indexers.items()
-00018e10: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
-00018e20: 2073 656c 662e 6973 656c 2869 6e64 6578   self.isel(index
-00018e30: 6572 735f 736c 6963 6573 290a 0a20 2020  ers_slices)..   
-00018e40: 2064 6566 2062 726f 6164 6361 7374 5f6c   def broadcast_l
-00018e50: 696b 6528 0a20 2020 2020 2020 2073 656c  ike(.        sel
-00018e60: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
-00018e70: 2020 2020 2020 6f74 6865 723a 2044 6174        other: Dat
-00018e80: 6173 6574 207c 2044 6174 6141 7272 6179  aset | DataArray
-00018e90: 2c0a 2020 2020 2020 2020 6578 636c 7564  ,.        exclud
-00018ea0: 653a 2049 7465 7261 626c 655b 4861 7368  e: Iterable[Hash
-00018eb0: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
-00018ec0: 6f6e 652c 0a20 2020 2029 202d 3e20 545f  one,.    ) -> T_
-00018ed0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-00018ee0: 2022 2222 4272 6f61 6463 6173 7420 7468   """Broadcast th
-00018ef0: 6973 2044 6174 6141 7272 6179 2061 6761  is DataArray aga
-00018f00: 696e 7374 2061 6e6f 7468 6572 2044 6174  inst another Dat
-00018f10: 6173 6574 206f 7220 4461 7461 4172 7261  aset or DataArra
-00018f20: 792e 0a20 2020 2020 2020 2054 6869 7320  y..        This 
-00018f30: 6973 2065 7175 6976 616c 656e 7420 746f  is equivalent to
-00018f40: 2078 722e 6272 6f61 6463 6173 7428 6f74   xr.broadcast(ot
-00018f50: 6865 722c 2073 656c 6629 5b31 5d0a 0a20  her, self)[1].. 
-00018f60: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00018f70: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00018f80: 2d2d 2d2d 0a20 2020 2020 2020 206f 7468  ----.        oth
-00018f90: 6572 203a 2044 6174 6173 6574 206f 7220  er : Dataset or 
-00018fa0: 4461 7461 4172 7261 790a 2020 2020 2020  DataArray.      
-00018fb0: 2020 2020 2020 4f62 6a65 6374 2061 6761        Object aga
-00018fc0: 696e 7374 2077 6869 6368 2074 6f20 6272  inst which to br
-00018fd0: 6f61 6463 6173 7420 7468 6973 2061 7272  oadcast this arr
-00018fe0: 6179 2e0a 2020 2020 2020 2020 6578 636c  ay..        excl
-00018ff0: 7564 6520 3a20 6974 6572 6162 6c65 206f  ude : iterable o
-00019000: 6620 6861 7368 6162 6c65 2c20 6f70 7469  f hashable, opti
-00019010: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00019020: 2044 696d 656e 7369 6f6e 7320 7468 6174   Dimensions that
-00019030: 206d 7573 7420 6e6f 7420 6265 2062 726f   must not be bro
-00019040: 6164 6361 7374 6564 0a0a 2020 2020 2020  adcasted..      
-00019050: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00019060: 2065 7863 6c75 6465 2069 7320 4e6f 6e65   exclude is None
-00019070: 3a0a 2020 2020 2020 2020 2020 2020 6578  :.            ex
-00019080: 636c 7564 6520 3d20 7365 7428 290a 2020  clude = set().  
-00019090: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000190a0: 2020 2020 2020 2020 6578 636c 7564 6520          exclude 
-000190b0: 3d20 7365 7428 6578 636c 7564 6529 0a20  = set(exclude). 
-000190c0: 2020 2020 2020 2061 7267 7320 3d20 616c         args = al
-000190d0: 6967 6e28 6f74 6865 722c 2073 656c 662c  ign(other, self,
-000190e0: 206a 6f69 6e3d 226f 7574 6572 222c 2063   join="outer", c
-000190f0: 6f70 793d 4661 6c73 652c 2065 7863 6c75  opy=False, exclu
-00019100: 6465 3d65 7863 6c75 6465 290a 0a20 2020  de=exclude)..   
-00019110: 2020 2020 2064 696d 735f 6d61 702c 2063       dims_map, c
-00019120: 6f6d 6d6f 6e5f 636f 6f72 6473 203d 205f  ommon_coords = _
-00019130: 6765 745f 6272 6f61 6463 6173 745f 6469  get_broadcast_di
-00019140: 6d73 5f6d 6170 5f63 6f6d 6d6f 6e5f 636f  ms_map_common_co
-00019150: 6f72 6473 2861 7267 732c 2065 7863 6c75  ords(args, exclu
-00019160: 6465 290a 0a20 2020 2020 2020 2072 6574  de)..        ret
-00019170: 7572 6e20 5f62 726f 6164 6361 7374 5f68  urn _broadcast_h
-00019180: 656c 7065 7228 0a20 2020 2020 2020 2020  elper(.         
-00019190: 2020 2063 6173 7428 2254 5f44 6174 6173     cast("T_Datas
-000191a0: 6574 222c 2061 7267 735b 315d 292c 2065  et", args[1]), e
-000191b0: 7863 6c75 6465 2c20 6469 6d73 5f6d 6170  xclude, dims_map
-000191c0: 2c20 636f 6d6d 6f6e 5f63 6f6f 7264 730a  , common_coords.
-000191d0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-000191e0: 6566 205f 7265 696e 6465 785f 6361 6c6c  ef _reindex_call
-000191f0: 6261 636b 280a 2020 2020 2020 2020 7365  back(.        se
-00019200: 6c66 2c0a 2020 2020 2020 2020 616c 6967  lf,.        alig
-00019210: 6e65 723a 2061 6c69 676e 6d65 6e74 2e41  ner: alignment.A
-00019220: 6c69 676e 6572 2c0a 2020 2020 2020 2020  ligner,.        
-00019230: 6469 6d5f 706f 735f 696e 6465 7865 7273  dim_pos_indexers
-00019240: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
-00019250: 2041 6e79 5d2c 0a20 2020 2020 2020 2076   Any],.        v
-00019260: 6172 6961 626c 6573 3a20 6469 6374 5b48  ariables: dict[H
-00019270: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
-00019280: 655d 2c0a 2020 2020 2020 2020 696e 6465  e],.        inde
-00019290: 7865 733a 2064 6963 745b 4861 7368 6162  xes: dict[Hashab
-000192a0: 6c65 2c20 496e 6465 785d 2c0a 2020 2020  le, Index],.    
-000192b0: 2020 2020 6669 6c6c 5f76 616c 7565 3a20      fill_value: 
-000192c0: 416e 792c 0a20 2020 2020 2020 2065 7863  Any,.        exc
-000192d0: 6c75 6465 5f64 696d 733a 2066 726f 7a65  lude_dims: froze
-000192e0: 6e73 6574 5b48 6173 6861 626c 655d 2c0a  nset[Hashable],.
-000192f0: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
-00019300: 7661 7273 3a20 6672 6f7a 656e 7365 745b  vars: frozenset[
-00019310: 4861 7368 6162 6c65 5d2c 0a20 2020 2029  Hashable],.    )
-00019320: 202d 3e20 4461 7461 7365 743a 0a20 2020   -> Dataset:.   
-00019330: 2020 2020 2022 2222 4361 6c6c 6261 636b       """Callback
-00019340: 2063 616c 6c65 6420 6672 6f6d 2060 6041   called from ``A
-00019350: 6c69 676e 6572 6060 2074 6f20 6372 6561  ligner`` to crea
-00019360: 7465 2061 206e 6577 2072 6569 6e64 6578  te a new reindex
-00019370: 6564 2044 6174 6173 6574 2e22 2222 0a0a  ed Dataset."""..
-00019380: 2020 2020 2020 2020 6e65 775f 7661 7269          new_vari
-00019390: 6162 6c65 7320 3d20 7661 7269 6162 6c65  ables = variable
-000193a0: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
-000193b0: 206e 6577 5f69 6e64 6578 6573 203d 2069   new_indexes = i
-000193c0: 6e64 6578 6573 2e63 6f70 7928 290a 0a20  ndexes.copy().. 
-000193d0: 2020 2020 2020 2023 2072 652d 6173 7369         # re-assi
-000193e0: 676e 2076 6172 6961 626c 6520 6d65 7461  gn variable meta
-000193f0: 6461 7461 0a20 2020 2020 2020 2066 6f72  data.        for
-00019400: 206e 616d 652c 206e 6577 5f76 6172 2069   name, new_var i
-00019410: 6e20 6e65 775f 7661 7269 6162 6c65 732e  n new_variables.
-00019420: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00019430: 2020 2020 2076 6172 203d 2073 656c 662e       var = self.
-00019440: 5f76 6172 6961 626c 6573 2e67 6574 286e  _variables.get(n
-00019450: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00019460: 2069 6620 7661 7220 6973 206e 6f74 204e   if var is not N
-00019470: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00019480: 2020 2020 206e 6577 5f76 6172 2e61 7474       new_var.att
-00019490: 7273 203d 2076 6172 2e61 7474 7273 0a20  rs = var.attrs. 
-000194a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000194b0: 6577 5f76 6172 2e65 6e63 6f64 696e 6720  ew_var.encoding 
-000194c0: 3d20 7661 722e 656e 636f 6469 6e67 0a0a  = var.encoding..
-000194d0: 2020 2020 2020 2020 2320 7061 7373 2074          # pass t
-000194e0: 6872 6f75 6768 2069 6e64 6578 6573 2066  hrough indexes f
-000194f0: 726f 6d20 6578 636c 7564 6564 2064 696d  rom excluded dim
-00019500: 656e 7369 6f6e 730a 2020 2020 2020 2020  ensions.        
-00019510: 2320 6e6f 2065 7874 7261 2063 6865 636b  # no extra check
-00019520: 206e 6565 6465 6420 666f 7220 6d75 6c74   needed for mult
-00019530: 692d 636f 6f72 6469 6e61 7465 2069 6e64  i-coordinate ind
-00019540: 6578 6573 2c20 706f 7465 6e74 6961 6c20  exes, potential 
-00019550: 636f 6e66 6c69 6374 730a 2020 2020 2020  conflicts.      
-00019560: 2020 2320 7368 6f75 6c64 2061 6c72 6561    # should alrea
-00019570: 6479 2068 6176 6520 6265 656e 2064 6574  dy have been det
-00019580: 6563 7465 6420 7768 656e 2061 6c69 676e  ected when align
-00019590: 696e 6720 7468 6520 696e 6465 7865 730a  ing the indexes.
-000195a0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-000195b0: 2c20 6964 7820 696e 2073 656c 662e 5f69  , idx in self._i
-000195c0: 6e64 6578 6573 2e69 7465 6d73 2829 3a0a  ndexes.items():.
-000195d0: 2020 2020 2020 2020 2020 2020 7661 7220              var 
-000195e0: 3d20 7365 6c66 2e5f 7661 7269 6162 6c65  = self._variable
-000195f0: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
-00019600: 2020 2020 6966 2073 6574 2876 6172 2e64      if set(var.d
-00019610: 696d 7329 203c 3d20 6578 636c 7564 655f  ims) <= exclude_
-00019620: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-00019630: 2020 2020 2020 6e65 775f 696e 6465 7865        new_indexe
-00019640: 735b 6e61 6d65 5d20 3d20 6964 780a 2020  s[name] = idx.  
-00019650: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00019660: 775f 7661 7269 6162 6c65 735b 6e61 6d65  w_variables[name
-00019670: 5d20 3d20 7661 720a 0a20 2020 2020 2020  ] = var..       
-00019680: 2069 6620 6e6f 7420 6469 6d5f 706f 735f   if not dim_pos_
-00019690: 696e 6465 7865 7273 3a0a 2020 2020 2020  indexers:.      
-000196a0: 2020 2020 2020 2320 6661 7374 2070 6174        # fast pat
-000196b0: 6820 666f 7220 6e6f 2072 6569 6e64 6578  h for no reindex
-000196c0: 696e 6720 6e65 6365 7373 6172 790a 2020  ing necessary.  
-000196d0: 2020 2020 2020 2020 2020 6966 2073 6574            if set
-000196e0: 286e 6577 5f69 6e64 6578 6573 2920 2d20  (new_indexes) - 
-000196f0: 7365 7428 7365 6c66 2e5f 696e 6465 7865  set(self._indexe
-00019700: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00019710: 2020 2020 2320 7468 6973 206f 6e6c 7920      # this only 
-00019720: 6164 6473 206e 6577 2069 6e64 6578 6573  adds new indexes
-00019730: 2061 6e64 2074 6865 6972 2063 6f6f 7264   and their coord
-00019740: 696e 6174 6520 7661 7269 6162 6c65 730a  inate variables.
-00019750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019760: 7265 696e 6465 7865 6420 3d20 7365 6c66  reindexed = self
-00019770: 2e5f 6f76 6572 7772 6974 655f 696e 6465  ._overwrite_inde
-00019780: 7865 7328 6e65 775f 696e 6465 7865 732c  xes(new_indexes,
-00019790: 206e 6577 5f76 6172 6961 626c 6573 290a   new_variables).
-000197a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000197b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000197c0: 2020 7265 696e 6465 7865 6420 3d20 7365    reindexed = se
-000197d0: 6c66 2e63 6f70 7928 6465 6570 3d61 6c69  lf.copy(deep=ali
-000197e0: 676e 6572 2e63 6f70 7929 0a20 2020 2020  gner.copy).     
-000197f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00019800: 2020 2020 2074 6f5f 7265 696e 6465 7820       to_reindex 
-00019810: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00019820: 2020 2020 6b3a 2076 0a20 2020 2020 2020      k: v.       
-00019830: 2020 2020 2020 2020 2066 6f72 206b 2c20           for k, 
-00019840: 7620 696e 2073 656c 662e 7661 7269 6162  v in self.variab
-00019850: 6c65 732e 6974 656d 7328 290a 2020 2020  les.items().    
-00019860: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00019870: 206e 6f74 2069 6e20 7661 7269 6162 6c65   not in variable
-00019880: 7320 616e 6420 6b20 6e6f 7420 696e 2065  s and k not in e
-00019890: 7863 6c75 6465 5f76 6172 730a 2020 2020  xclude_vars.    
-000198a0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-000198b0: 2020 2020 2020 7265 696e 6465 7865 645f        reindexed_
-000198c0: 7661 7273 203d 2061 6c69 676e 6d65 6e74  vars = alignment
-000198d0: 2e72 6569 6e64 6578 5f76 6172 6961 626c  .reindex_variabl
-000198e0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-000198f0: 2020 2020 746f 5f72 6569 6e64 6578 2c0a      to_reindex,.
-00019900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019910: 6469 6d5f 706f 735f 696e 6465 7865 7273  dim_pos_indexers
-00019920: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019930: 2020 636f 7079 3d61 6c69 676e 6572 2e63    copy=aligner.c
-00019940: 6f70 792c 0a20 2020 2020 2020 2020 2020  opy,.           
-00019950: 2020 2020 2066 696c 6c5f 7661 6c75 653d       fill_value=
-00019960: 6669 6c6c 5f76 616c 7565 2c0a 2020 2020  fill_value,.    
-00019970: 2020 2020 2020 2020 2020 2020 7370 6172              spar
-00019980: 7365 3d61 6c69 676e 6572 2e73 7061 7273  se=aligner.spars
-00019990: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
-000199a0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-000199b0: 5f76 6172 6961 626c 6573 2e75 7064 6174  _variables.updat
-000199c0: 6528 7265 696e 6465 7865 645f 7661 7273  e(reindexed_vars
-000199d0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
-000199e0: 775f 636f 6f72 645f 6e61 6d65 7320 3d20  w_coord_names = 
-000199f0: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
-00019a00: 7320 7c20 7365 7428 6e65 775f 696e 6465  s | set(new_inde
-00019a10: 7865 7329 0a20 2020 2020 2020 2020 2020  xes).           
-00019a20: 2072 6569 6e64 6578 6564 203d 2073 656c   reindexed = sel
-00019a30: 662e 5f72 6570 6c61 6365 5f77 6974 685f  f._replace_with_
-00019a40: 6e65 775f 6469 6d73 280a 2020 2020 2020  new_dims(.      
-00019a50: 2020 2020 2020 2020 2020 6e65 775f 7661            new_va
-00019a60: 7269 6162 6c65 732c 206e 6577 5f63 6f6f  riables, new_coo
-00019a70: 7264 5f6e 616d 6573 2c20 696e 6465 7865  rd_names, indexe
-00019a80: 733d 6e65 775f 696e 6465 7865 730a 2020  s=new_indexes.  
-00019a90: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00019aa0: 2020 2020 2072 6574 7572 6e20 7265 696e       return rein
-00019ab0: 6465 7865 640a 0a20 2020 2064 6566 2072  dexed..    def r
-00019ac0: 6569 6e64 6578 5f6c 696b 6528 0a20 2020  eindex_like(.   
-00019ad0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-00019ae0: 6173 6574 2c0a 2020 2020 2020 2020 6f74  aset,.        ot
-00019af0: 6865 723a 2044 6174 6173 6574 207c 2044  her: Dataset | D
-00019b00: 6174 6141 7272 6179 2c0a 2020 2020 2020  ataArray,.      
-00019b10: 2020 6d65 7468 6f64 3a20 5265 696e 6465    method: Reinde
-00019b20: 784d 6574 686f 644f 7074 696f 6e73 203d  xMethodOptions =
-00019b30: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
-00019b40: 6f6c 6572 616e 6365 3a20 696e 7420 7c20  olerance: int | 
-00019b50: 666c 6f61 7420 7c20 4974 6572 6162 6c65  float | Iterable
-00019b60: 5b69 6e74 207c 2066 6c6f 6174 5d20 7c20  [int | float] | 
-00019b70: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00019b80: 2020 2020 2063 6f70 793a 2062 6f6f 6c20       copy: bool 
-00019b90: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-00019ba0: 6669 6c6c 5f76 616c 7565 3a20 416e 7920  fill_value: Any 
-00019bb0: 3d20 7872 6474 7970 6573 2e4e 412c 0a20  = xrdtypes.NA,. 
-00019bc0: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
-00019bd0: 743a 0a20 2020 2020 2020 2022 2222 436f  t:.        """Co
-00019be0: 6e66 6f72 6d20 7468 6973 206f 626a 6563  nform this objec
-00019bf0: 7420 6f6e 746f 2074 6865 2069 6e64 6578  t onto the index
-00019c00: 6573 206f 6620 616e 6f74 6865 7220 6f62  es of another ob
-00019c10: 6a65 6374 2c20 6669 6c6c 696e 6720 696e  ject, filling in
-00019c20: 0a20 2020 2020 2020 206d 6973 7369 6e67  .        missing
-00019c30: 2076 616c 7565 7320 7769 7468 2060 6066   values with ``f
-00019c40: 696c 6c5f 7661 6c75 6560 602e 2054 6865  ill_value``. The
-00019c50: 2064 6566 6175 6c74 2066 696c 6c20 7661   default fill va
-00019c60: 6c75 6520 6973 204e 614e 2e0a 0a20 2020  lue is NaN...   
-00019c70: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00019c80: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00019c90: 2d2d 0a20 2020 2020 2020 206f 7468 6572  --.        other
-00019ca0: 203a 2044 6174 6173 6574 206f 7220 4461   : Dataset or Da
-00019cb0: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
-00019cc0: 2020 2020 4f62 6a65 6374 2077 6974 6820      Object with 
-00019cd0: 616e 2027 696e 6465 7865 7327 2061 7474  an 'indexes' att
-00019ce0: 7269 6275 7465 2067 6976 696e 6720 6120  ribute giving a 
-00019cf0: 6d61 7070 696e 6720 6672 6f6d 2064 696d  mapping from dim
-00019d00: 656e 7369 6f6e 0a20 2020 2020 2020 2020  ension.         
-00019d10: 2020 206e 616d 6573 2074 6f20 7061 6e64     names to pand
-00019d20: 6173 2e49 6e64 6578 206f 626a 6563 7473  as.Index objects
-00019d30: 2c20 7768 6963 6820 7072 6f76 6964 6573  , which provides
-00019d40: 2063 6f6f 7264 696e 6174 6573 2075 706f   coordinates upo
-00019d50: 6e0a 2020 2020 2020 2020 2020 2020 7768  n.            wh
-00019d60: 6963 6820 746f 2069 6e64 6578 2074 6865  ich to index the
-00019d70: 2076 6172 6961 626c 6573 2069 6e20 7468   variables in th
-00019d80: 6973 2064 6174 6173 6574 2e20 5468 6520  is dataset. The 
-00019d90: 696e 6465 7865 7320 6f6e 2074 6869 730a  indexes on this.
-00019da0: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-00019db0: 7220 6f62 6a65 6374 206e 6565 6420 6e6f  r object need no
-00019dc0: 7420 6265 2074 6865 2073 616d 6520 6173  t be the same as
-00019dd0: 2074 6865 2069 6e64 6578 6573 206f 6e20   the indexes on 
-00019de0: 7468 6973 0a20 2020 2020 2020 2020 2020  this.           
-00019df0: 2064 6174 6173 6574 2e20 416e 7920 6d69   dataset. Any mi
-00019e00: 732d 6d61 7463 6865 6420 696e 6465 7820  s-matched index 
-00019e10: 7661 6c75 6573 2077 696c 6c20 6265 2066  values will be f
-00019e20: 696c 6c65 6420 696e 2077 6974 680a 2020  illed in with.  
-00019e30: 2020 2020 2020 2020 2020 4e61 4e2c 2061            NaN, a
-00019e40: 6e64 2061 6e79 206d 6973 2d6d 6174 6368  nd any mis-match
-00019e50: 6564 2064 696d 656e 7369 6f6e 206e 616d  ed dimension nam
-00019e60: 6573 2077 696c 6c20 7369 6d70 6c79 2062  es will simply b
-00019e70: 6520 6967 6e6f 7265 642e 0a20 2020 2020  e ignored..     
-00019e80: 2020 206d 6574 686f 6420 3a20 7b4e 6f6e     method : {Non
-00019e90: 652c 2022 6e65 6172 6573 7422 2c20 2270  e, "nearest", "p
-00019ea0: 6164 222c 2022 6666 696c 6c22 2c20 2262  ad", "ffill", "b
-00019eb0: 6163 6b66 696c 6c22 2c20 2262 6669 6c6c  ackfill", "bfill
-00019ec0: 222c 204e 6f6e 657d 2c20 6f70 7469 6f6e  ", None}, option
-00019ed0: 616c 0a20 2020 2020 2020 2020 2020 204d  al.            M
-00019ee0: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
-00019ef0: 2066 696c 6c69 6e67 2069 6e64 6578 2076   filling index v
-00019f00: 616c 7565 7320 6672 6f6d 206f 7468 6572  alues from other
-00019f10: 206e 6f74 2066 6f75 6e64 2069 6e20 7468   not found in th
-00019f20: 6973 0a20 2020 2020 2020 2020 2020 2064  is.            d
-00019f30: 6174 6173 6574 3a0a 0a20 2020 2020 2020  ataset:..       
-00019f40: 2020 2020 202d 204e 6f6e 6520 2864 6566       - None (def
-00019f50: 6175 6c74 293a 2064 6f6e 2774 2066 696c  ault): don't fil
-00019f60: 6c20 6761 7073 0a20 2020 2020 2020 2020  l gaps.         
-00019f70: 2020 202d 2022 7061 6422 202f 2022 6666     - "pad" / "ff
-00019f80: 696c 6c22 3a20 7072 6f70 6167 6174 6520  ill": propagate 
-00019f90: 6c61 7374 2076 616c 6964 2069 6e64 6578  last valid index
-00019fa0: 2076 616c 7565 2066 6f72 7761 7264 0a20   value forward. 
-00019fb0: 2020 2020 2020 2020 2020 202d 2022 6261             - "ba
-00019fc0: 636b 6669 6c6c 2220 2f20 2262 6669 6c6c  ckfill" / "bfill
-00019fd0: 223a 2070 726f 7061 6761 7465 206e 6578  ": propagate nex
-00019fe0: 7420 7661 6c69 6420 696e 6465 7820 7661  t valid index va
-00019ff0: 6c75 6520 6261 636b 7761 7264 0a20 2020  lue backward.   
-0001a000: 2020 2020 2020 2020 202d 2022 6e65 6172           - "near
-0001a010: 6573 7422 3a20 7573 6520 6e65 6172 6573  est": use neares
-0001a020: 7420 7661 6c69 6420 696e 6465 7820 7661  t valid index va
-0001a030: 6c75 650a 0a20 2020 2020 2020 2074 6f6c  lue..        tol
-0001a040: 6572 616e 6365 203a 206f 7074 696f 6e61  erance : optiona
-0001a050: 6c0a 2020 2020 2020 2020 2020 2020 4d61  l.            Ma
-0001a060: 7869 6d75 6d20 6469 7374 616e 6365 2062  ximum distance b
-0001a070: 6574 7765 656e 206f 7269 6769 6e61 6c20  etween original 
-0001a080: 616e 6420 6e65 7720 6c61 6265 6c73 2066  and new labels f
-0001a090: 6f72 2069 6e65 7861 6374 0a20 2020 2020  or inexact.     
-0001a0a0: 2020 2020 2020 206d 6174 6368 6573 2e20         matches. 
-0001a0b0: 5468 6520 7661 6c75 6573 206f 6620 7468  The values of th
-0001a0c0: 6520 696e 6465 7820 6174 2074 6865 206d  e index at the m
-0001a0d0: 6174 6368 696e 6720 6c6f 6361 7469 6f6e  atching location
-0001a0e0: 7320 6d75 7374 0a20 2020 2020 2020 2020  s must.         
-0001a0f0: 2020 2073 6174 6973 6679 2074 6865 2065     satisfy the e
-0001a100: 7175 6174 696f 6e20 6060 6162 7328 696e  quation ``abs(in
-0001a110: 6465 785b 696e 6465 7865 725d 202d 2074  dex[indexer] - t
-0001a120: 6172 6765 7429 203c 3d20 746f 6c65 7261  arget) <= tolera
-0001a130: 6e63 6560 602e 0a20 2020 2020 2020 2020  nce``..         
-0001a140: 2020 2054 6f6c 6572 616e 6365 206d 6179     Tolerance may
-0001a150: 2062 6520 6120 7363 616c 6172 2076 616c   be a scalar val
-0001a160: 7565 2c20 7768 6963 6820 6170 706c 6965  ue, which applie
-0001a170: 7320 7468 6520 7361 6d65 2074 6f6c 6572  s the same toler
-0001a180: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
-0001a190: 2074 6f20 616c 6c20 7661 6c75 6573 2c20   to all values, 
-0001a1a0: 6f72 206c 6973 742d 6c69 6b65 2c20 7768  or list-like, wh
-0001a1b0: 6963 6820 6170 706c 6965 7320 7661 7269  ich applies vari
-0001a1c0: 6162 6c65 2074 6f6c 6572 616e 6365 2070  able tolerance p
-0001a1d0: 6572 0a20 2020 2020 2020 2020 2020 2065  er.            e
-0001a1e0: 6c65 6d65 6e74 2e20 4c69 7374 2d6c 696b  lement. List-lik
-0001a1f0: 6520 6d75 7374 2062 6520 7468 6520 7361  e must be the sa
-0001a200: 6d65 2073 697a 6520 6173 2074 6865 2069  me size as the i
-0001a210: 6e64 6578 2061 6e64 2069 7473 2064 7479  ndex and its dty
-0001a220: 7065 0a20 2020 2020 2020 2020 2020 206d  pe.            m
-0001a230: 7573 7420 6578 6163 746c 7920 6d61 7463  ust exactly matc
-0001a240: 6820 7468 6520 696e 6465 78e2 8099 7320  h the index...s 
-0001a250: 7479 7065 2e0a 2020 2020 2020 2020 636f  type..        co
-0001a260: 7079 203a 2062 6f6f 6c2c 2064 6566 6175  py : bool, defau
-0001a270: 6c74 3a20 5472 7565 0a20 2020 2020 2020  lt: True.       
-0001a280: 2020 2020 2049 6620 6060 636f 7079 3d54       If ``copy=T
-0001a290: 7275 6560 602c 2064 6174 6120 696e 2074  rue``, data in t
-0001a2a0: 6865 2072 6574 7572 6e20 7661 6c75 6520  he return value 
-0001a2b0: 6973 2061 6c77 6179 7320 636f 7069 6564  is always copied
-0001a2c0: 2e20 4966 0a20 2020 2020 2020 2020 2020  . If.           
-0001a2d0: 2060 6063 6f70 793d 4661 6c73 6560 6020   ``copy=False`` 
-0001a2e0: 616e 6420 7265 696e 6465 7869 6e67 2069  and reindexing i
-0001a2f0: 7320 756e 6e65 6365 7373 6172 792c 206f  s unnecessary, o
-0001a300: 7220 6361 6e20 6265 2070 6572 666f 726d  r can be perform
-0001a310: 6564 0a20 2020 2020 2020 2020 2020 2077  ed.            w
-0001a320: 6974 6820 6f6e 6c79 2073 6c69 6365 206f  ith only slice o
-0001a330: 7065 7261 7469 6f6e 732c 2074 6865 6e20  perations, then 
-0001a340: 7468 6520 6f75 7470 7574 206d 6179 2073  the output may s
-0001a350: 6861 7265 206d 656d 6f72 7920 7769 7468  hare memory with
-0001a360: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-0001a370: 2069 6e70 7574 2e20 496e 2065 6974 6865   input. In eithe
-0001a380: 7220 6361 7365 2c20 6120 6e65 7720 7861  r case, a new xa
-0001a390: 7272 6179 206f 626a 6563 7420 6973 2061  rray object is a
-0001a3a0: 6c77 6179 7320 7265 7475 726e 6564 2e0a  lways returned..
-0001a3b0: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
-0001a3c0: 7565 203a 2073 6361 6c61 7220 6f72 2064  ue : scalar or d
-0001a3d0: 6963 742d 6c69 6b65 2c20 6f70 7469 6f6e  ict-like, option
-0001a3e0: 616c 0a20 2020 2020 2020 2020 2020 2056  al.            V
-0001a3f0: 616c 7565 2074 6f20 7573 6520 666f 7220  alue to use for 
-0001a400: 6e65 776c 7920 6d69 7373 696e 6720 7661  newly missing va
-0001a410: 6c75 6573 2e20 4966 2061 2064 6963 742d  lues. If a dict-
-0001a420: 6c69 6b65 206d 6170 730a 2020 2020 2020  like maps.      
-0001a430: 2020 2020 2020 7661 7269 6162 6c65 206e        variable n
-0001a440: 616d 6573 2074 6f20 6669 6c6c 2076 616c  ames to fill val
-0001a450: 7565 732e 0a0a 2020 2020 2020 2020 5265  ues...        Re
-0001a460: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-0001a470: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7265  -----.        re
-0001a480: 696e 6465 7865 6420 3a20 4461 7461 7365  indexed : Datase
-0001a490: 740a 2020 2020 2020 2020 2020 2020 416e  t.            An
-0001a4a0: 6f74 6865 7220 6461 7461 7365 742c 2077  other dataset, w
-0001a4b0: 6974 6820 7468 6973 2064 6174 6173 6574  ith this dataset
-0001a4c0: 2773 2064 6174 6120 6275 7420 636f 6f72  's data but coor
-0001a4d0: 6469 6e61 7465 7320 6672 6f6d 2074 6865  dinates from the
-0001a4e0: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-0001a4f0: 6572 206f 626a 6563 742e 0a0a 2020 2020  er object...    
-0001a500: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-0001a510: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-0001a520: 2020 2020 2020 4461 7461 7365 742e 7265        Dataset.re
-0001a530: 696e 6465 780a 2020 2020 2020 2020 616c  index.        al
-0001a540: 6967 6e0a 2020 2020 2020 2020 2222 220a  ign.        """.
-0001a550: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-0001a560: 6c69 676e 6d65 6e74 2e72 6569 6e64 6578  lignment.reindex
-0001a570: 5f6c 696b 6528 0a20 2020 2020 2020 2020  _like(.         
-0001a580: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0001a590: 2020 2020 206f 7468 6572 3d6f 7468 6572       other=other
-0001a5a0: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
-0001a5b0: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
-0001a5c0: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
-0001a5d0: 6365 3d74 6f6c 6572 616e 6365 2c0a 2020  ce=tolerance,.  
-0001a5e0: 2020 2020 2020 2020 2020 636f 7079 3d63            copy=c
-0001a5f0: 6f70 792c 0a20 2020 2020 2020 2020 2020  opy,.           
-0001a600: 2066 696c 6c5f 7661 6c75 653d 6669 6c6c   fill_value=fill
-0001a610: 5f76 616c 7565 2c0a 2020 2020 2020 2020  _value,.        
-0001a620: 290a 0a20 2020 2064 6566 2072 6569 6e64  )..    def reind
-0001a630: 6578 280a 2020 2020 2020 2020 7365 6c66  ex(.        self
-0001a640: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-0001a650: 2020 2020 2069 6e64 6578 6572 733a 204d       indexers: M
-0001a660: 6170 7069 6e67 5b41 6e79 2c20 416e 795d  apping[Any, Any]
-0001a670: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0001a680: 2020 2020 2020 2020 6d65 7468 6f64 3a20          method: 
-0001a690: 5265 696e 6465 784d 6574 686f 644f 7074  ReindexMethodOpt
-0001a6a0: 696f 6e73 203d 204e 6f6e 652c 0a20 2020  ions = None,.   
-0001a6b0: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
-0001a6c0: 696e 7420 7c20 666c 6f61 7420 7c20 4974  int | float | It
-0001a6d0: 6572 6162 6c65 5b69 6e74 207c 2066 6c6f  erable[int | flo
-0001a6e0: 6174 5d20 7c20 4e6f 6e65 203d 204e 6f6e  at] | None = Non
-0001a6f0: 652c 0a20 2020 2020 2020 2063 6f70 793a  e,.        copy:
-0001a700: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-0001a710: 2020 2020 2020 6669 6c6c 5f76 616c 7565        fill_value
-0001a720: 3a20 416e 7920 3d20 7872 6474 7970 6573  : Any = xrdtypes
-0001a730: 2e4e 412c 0a20 2020 2020 2020 202a 2a69  .NA,.        **i
-0001a740: 6e64 6578 6572 735f 6b77 6172 6773 3a20  ndexers_kwargs: 
-0001a750: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
-0001a760: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-0001a770: 2022 2222 436f 6e66 6f72 6d20 7468 6973   """Conform this
-0001a780: 206f 626a 6563 7420 6f6e 746f 2061 206e   object onto a n
-0001a790: 6577 2073 6574 206f 6620 696e 6465 7865  ew set of indexe
-0001a7a0: 732c 2066 696c 6c69 6e67 2069 6e0a 2020  s, filling in.  
-0001a7b0: 2020 2020 2020 6d69 7373 696e 6720 7661        missing va
-0001a7c0: 6c75 6573 2077 6974 6820 6060 6669 6c6c  lues with ``fill
-0001a7d0: 5f76 616c 7565 6060 2e20 5468 6520 6465  _value``. The de
-0001a7e0: 6661 756c 7420 6669 6c6c 2076 616c 7565  fault fill value
-0001a7f0: 2069 7320 4e61 4e2e 0a0a 2020 2020 2020   is NaN...      
-0001a800: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0001a810: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-0001a820: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
-0001a830: 203a 2064 6963 742c 206f 7074 696f 6e61   : dict, optiona
-0001a840: 6c0a 2020 2020 2020 2020 2020 2020 4469  l.            Di
-0001a850: 6374 696f 6e61 7279 2077 6974 6820 6b65  ctionary with ke
-0001a860: 7973 2067 6976 656e 2062 7920 6469 6d65  ys given by dime
-0001a870: 6e73 696f 6e20 6e61 6d65 7320 616e 6420  nsion names and 
-0001a880: 7661 6c75 6573 2067 6976 656e 2062 790a  values given by.
-0001a890: 2020 2020 2020 2020 2020 2020 6172 7261              arra
-0001a8a0: 7973 206f 6620 636f 6f72 6469 6e61 7465  ys of coordinate
-0001a8b0: 7320 7469 636b 206c 6162 656c 732e 2041  s tick labels. A
-0001a8c0: 6e79 206d 6973 2d6d 6174 6368 6564 2063  ny mis-matched c
-0001a8d0: 6f6f 7264 696e 6174 650a 2020 2020 2020  oordinate.      
-0001a8e0: 2020 2020 2020 7661 6c75 6573 2077 696c        values wil
-0001a8f0: 6c20 6265 2066 696c 6c65 6420 696e 2077  l be filled in w
-0001a900: 6974 6820 4e61 4e2c 2061 6e64 2061 6e79  ith NaN, and any
-0001a910: 206d 6973 2d6d 6174 6368 6564 2064 696d   mis-matched dim
-0001a920: 656e 7369 6f6e 0a20 2020 2020 2020 2020  ension.         
-0001a930: 2020 206e 616d 6573 2077 696c 6c20 7369     names will si
-0001a940: 6d70 6c79 2062 6520 6967 6e6f 7265 642e  mply be ignored.
-0001a950: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
-0001a960: 206f 6620 696e 6465 7865 7273 206f 7220   of indexers or 
-0001a970: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
-0001a980: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
-0001a990: 2e0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-0001a9a0: 203a 207b 4e6f 6e65 2c20 226e 6561 7265   : {None, "neare
-0001a9b0: 7374 222c 2022 7061 6422 2c20 2266 6669  st", "pad", "ffi
-0001a9c0: 6c6c 222c 2022 6261 636b 6669 6c6c 222c  ll", "backfill",
-0001a9d0: 2022 6266 696c 6c22 2c20 4e6f 6e65 7d2c   "bfill", None},
-0001a9e0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0001a9f0: 2020 2020 2020 4d65 7468 6f64 2074 6f20        Method to 
-0001aa00: 7573 6520 666f 7220 6669 6c6c 696e 6720  use for filling 
-0001aa10: 696e 6465 7820 7661 6c75 6573 2069 6e20  index values in 
-0001aa20: 6060 696e 6465 7865 7273 6060 206e 6f74  ``indexers`` not
-0001aa30: 2066 6f75 6e64 2069 6e0a 2020 2020 2020   found in.      
-0001aa40: 2020 2020 2020 7468 6973 2064 6174 6173        this datas
-0001aa50: 6574 3a0a 0a20 2020 2020 2020 2020 2020  et:..           
-0001aa60: 202d 204e 6f6e 6520 2864 6566 6175 6c74   - None (default
-0001aa70: 293a 2064 6f6e 2774 2066 696c 6c20 6761  ): don't fill ga
-0001aa80: 7073 0a20 2020 2020 2020 2020 2020 202d  ps.            -
-0001aa90: 2022 7061 6422 202f 2022 6666 696c 6c22   "pad" / "ffill"
-0001aaa0: 3a20 7072 6f70 6167 6174 6520 6c61 7374  : propagate last
-0001aab0: 2076 616c 6964 2069 6e64 6578 2076 616c   valid index val
-0001aac0: 7565 2066 6f72 7761 7264 0a20 2020 2020  ue forward.     
-0001aad0: 2020 2020 2020 202d 2022 6261 636b 6669         - "backfi
-0001aae0: 6c6c 2220 2f20 2262 6669 6c6c 223a 2070  ll" / "bfill": p
-0001aaf0: 726f 7061 6761 7465 206e 6578 7420 7661  ropagate next va
-0001ab00: 6c69 6420 696e 6465 7820 7661 6c75 6520  lid index value 
-0001ab10: 6261 636b 7761 7264 0a20 2020 2020 2020  backward.       
-0001ab20: 2020 2020 202d 2022 6e65 6172 6573 7422       - "nearest"
-0001ab30: 3a20 7573 6520 6e65 6172 6573 7420 7661  : use nearest va
-0001ab40: 6c69 6420 696e 6465 7820 7661 6c75 650a  lid index value.
-0001ab50: 0a20 2020 2020 2020 2074 6f6c 6572 616e  .        toleran
-0001ab60: 6365 203a 206f 7074 696f 6e61 6c0a 2020  ce : optional.  
-0001ab70: 2020 2020 2020 2020 2020 4d61 7869 6d75            Maximu
-0001ab80: 6d20 6469 7374 616e 6365 2062 6574 7765  m distance betwe
-0001ab90: 656e 206f 7269 6769 6e61 6c20 616e 6420  en original and 
-0001aba0: 6e65 7720 6c61 6265 6c73 2066 6f72 2069  new labels for i
-0001abb0: 6e65 7861 6374 0a20 2020 2020 2020 2020  nexact.         
-0001abc0: 2020 206d 6174 6368 6573 2e20 5468 6520     matches. The 
-0001abd0: 7661 6c75 6573 206f 6620 7468 6520 696e  values of the in
-0001abe0: 6465 7820 6174 2074 6865 206d 6174 6368  dex at the match
-0001abf0: 696e 6720 6c6f 6361 7469 6f6e 7320 6d75  ing locations mu
-0001ac00: 7374 0a20 2020 2020 2020 2020 2020 2073  st.            s
-0001ac10: 6174 6973 6679 2074 6865 2065 7175 6174  atisfy the equat
-0001ac20: 696f 6e20 6060 6162 7328 696e 6465 785b  ion ``abs(index[
-0001ac30: 696e 6465 7865 725d 202d 2074 6172 6765  indexer] - targe
-0001ac40: 7429 203c 3d20 746f 6c65 7261 6e63 6560  t) <= tolerance`
-0001ac50: 602e 0a20 2020 2020 2020 2020 2020 2054  `..            T
-0001ac60: 6f6c 6572 616e 6365 206d 6179 2062 6520  olerance may be 
-0001ac70: 6120 7363 616c 6172 2076 616c 7565 2c20  a scalar value, 
-0001ac80: 7768 6963 6820 6170 706c 6965 7320 7468  which applies th
-0001ac90: 6520 7361 6d65 2074 6f6c 6572 616e 6365  e same tolerance
-0001aca0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-0001acb0: 616c 6c20 7661 6c75 6573 2c20 6f72 206c  all values, or l
-0001acc0: 6973 742d 6c69 6b65 2c20 7768 6963 6820  ist-like, which 
-0001acd0: 6170 706c 6965 7320 7661 7269 6162 6c65  applies variable
-0001ace0: 2074 6f6c 6572 616e 6365 2070 6572 0a20   tolerance per. 
-0001acf0: 2020 2020 2020 2020 2020 2065 6c65 6d65             eleme
-0001ad00: 6e74 2e20 4c69 7374 2d6c 696b 6520 6d75  nt. List-like mu
-0001ad10: 7374 2062 6520 7468 6520 7361 6d65 2073  st be the same s
-0001ad20: 697a 6520 6173 2074 6865 2069 6e64 6578  ize as the index
-0001ad30: 2061 6e64 2069 7473 2064 7479 7065 0a20   and its dtype. 
-0001ad40: 2020 2020 2020 2020 2020 206d 7573 7420             must 
-0001ad50: 6578 6163 746c 7920 6d61 7463 6820 7468  exactly match th
-0001ad60: 6520 696e 6465 78e2 8099 7320 7479 7065  e index...s type
-0001ad70: 2e0a 2020 2020 2020 2020 636f 7079 203a  ..        copy :
-0001ad80: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
-0001ad90: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0001ada0: 2049 6620 6060 636f 7079 3d54 7275 6560   If ``copy=True`
-0001adb0: 602c 2064 6174 6120 696e 2074 6865 2072  `, data in the r
-0001adc0: 6574 7572 6e20 7661 6c75 6520 6973 2061  eturn value is a
-0001add0: 6c77 6179 7320 636f 7069 6564 2e20 4966  lways copied. If
-0001ade0: 0a20 2020 2020 2020 2020 2020 2060 6063  .            ``c
-0001adf0: 6f70 793d 4661 6c73 6560 6020 616e 6420  opy=False`` and 
-0001ae00: 7265 696e 6465 7869 6e67 2069 7320 756e  reindexing is un
-0001ae10: 6e65 6365 7373 6172 792c 206f 7220 6361  necessary, or ca
-0001ae20: 6e20 6265 2070 6572 666f 726d 6564 0a20  n be performed. 
-0001ae30: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0001ae40: 6f6e 6c79 2073 6c69 6365 206f 7065 7261  only slice opera
-0001ae50: 7469 6f6e 732c 2074 6865 6e20 7468 6520  tions, then the 
-0001ae60: 6f75 7470 7574 206d 6179 2073 6861 7265  output may share
-0001ae70: 206d 656d 6f72 7920 7769 7468 0a20 2020   memory with.   
-0001ae80: 2020 2020 2020 2020 2074 6865 2069 6e70           the inp
-0001ae90: 7574 2e20 496e 2065 6974 6865 7220 6361  ut. In either ca
-0001aea0: 7365 2c20 6120 6e65 7720 7861 7272 6179  se, a new xarray
-0001aeb0: 206f 626a 6563 7420 6973 2061 6c77 6179   object is alway
-0001aec0: 7320 7265 7475 726e 6564 2e0a 2020 2020  s returned..    
-0001aed0: 2020 2020 6669 6c6c 5f76 616c 7565 203a      fill_value :
-0001aee0: 2073 6361 6c61 7220 6f72 2064 6963 742d   scalar or dict-
-0001aef0: 6c69 6b65 2c20 6f70 7469 6f6e 616c 0a20  like, optional. 
-0001af00: 2020 2020 2020 2020 2020 2056 616c 7565             Value
-0001af10: 2074 6f20 7573 6520 666f 7220 6e65 776c   to use for newl
-0001af20: 7920 6d69 7373 696e 6720 7661 6c75 6573  y missing values
-0001af30: 2e20 4966 2061 2064 6963 742d 6c69 6b65  . If a dict-like
-0001af40: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
-0001af50: 7073 2076 6172 6961 626c 6520 6e61 6d65  ps variable name
-0001af60: 7320 2869 6e63 6c75 6469 6e67 2063 6f6f  s (including coo
-0001af70: 7264 696e 6174 6573 2920 746f 2066 696c  rdinates) to fil
-0001af80: 6c20 7661 6c75 6573 2e0a 2020 2020 2020  l values..      
-0001af90: 2020 7370 6172 7365 203a 2062 6f6f 6c2c    sparse : bool,
-0001afa0: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
-0001afb0: 2020 2020 2020 2020 2020 2020 7573 6520              use 
-0001afc0: 7370 6172 7365 2d61 7272 6179 2e0a 2020  sparse-array..  
-0001afd0: 2020 2020 2020 2a2a 696e 6465 7865 7273        **indexers
-0001afe0: 5f6b 7761 7267 7320 3a20 7b64 696d 3a20  _kwargs : {dim: 
-0001aff0: 696e 6465 7865 722c 202e 2e2e 7d2c 206f  indexer, ...}, o
-0001b000: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0001b010: 2020 2020 4b65 7977 6f72 6420 6172 6775      Keyword argu
-0001b020: 6d65 6e74 7320 696e 2074 6865 2073 616d  ments in the sam
-0001b030: 6520 666f 726d 2061 7320 6060 696e 6465  e form as ``inde
-0001b040: 7865 7273 6060 2e0a 2020 2020 2020 2020  xers``..        
-0001b050: 2020 2020 4f6e 6520 6f66 2069 6e64 6578      One of index
-0001b060: 6572 7320 6f72 2069 6e64 6578 6572 735f  ers or indexers_
-0001b070: 6b77 6172 6773 206d 7573 7420 6265 2070  kwargs must be p
-0001b080: 726f 7669 6465 642e 0a0a 2020 2020 2020  rovided...      
-0001b090: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0001b0a0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-0001b0b0: 2020 7265 696e 6465 7865 6420 3a20 4461    reindexed : Da
-0001b0c0: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
-0001b0d0: 2020 416e 6f74 6865 7220 6461 7461 7365    Another datase
-0001b0e0: 742c 2077 6974 6820 7468 6973 2064 6174  t, with this dat
-0001b0f0: 6173 6574 2773 2064 6174 6120 6275 7420  aset's data but 
-0001b100: 7265 706c 6163 6564 2063 6f6f 7264 696e  replaced coordin
-0001b110: 6174 6573 2e0a 0a20 2020 2020 2020 2053  ates...        S
-0001b120: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-0001b130: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0001b140: 2044 6174 6173 6574 2e72 6569 6e64 6578   Dataset.reindex
-0001b150: 5f6c 696b 650a 2020 2020 2020 2020 616c  _like.        al
-0001b160: 6967 6e0a 2020 2020 2020 2020 7061 6e64  ign.        pand
-0001b170: 6173 2e49 6e64 6578 2e67 6574 5f69 6e64  as.Index.get_ind
-0001b180: 6578 6572 0a0a 2020 2020 2020 2020 4578  exer..        Ex
-0001b190: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
-0001b1a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001b1b0: 4372 6561 7465 2061 2064 6174 6173 6574  Create a dataset
-0001b1c0: 2077 6974 6820 736f 6d65 2066 6963 7469   with some ficti
-0001b1d0: 6f6e 616c 2064 6174 612e 0a0a 2020 2020  onal data...    
-0001b1e0: 2020 2020 3e3e 3e20 7820 3d20 7872 2e44      >>> x = xr.D
-0001b1f0: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
-0001b200: 2e2e 2e20 2020 2020 7b0a 2020 2020 2020  ...     {.      
-0001b210: 2020 2e2e 2e20 2020 2020 2020 2020 2274    ...         "t
-0001b220: 656d 7065 7261 7475 7265 223a 2028 2273  emperature": ("s
-0001b230: 7461 7469 6f6e 222c 2032 3020 2a20 6e70  tation", 20 * np
-0001b240: 2e72 616e 646f 6d2e 7261 6e64 2834 2929  .random.rand(4))
-0001b250: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-0001b260: 2020 2020 2020 2270 7265 7373 7572 6522        "pressure"
-0001b270: 3a20 2822 7374 6174 696f 6e22 2c20 3530  : ("station", 50
-0001b280: 3020 2a20 6e70 2e72 616e 646f 6d2e 7261  0 * np.random.ra
-0001b290: 6e64 2834 2929 2c0a 2020 2020 2020 2020  nd(4)),.        
-0001b2a0: 2e2e 2e20 2020 2020 7d2c 0a20 2020 2020  ...     },.     
-0001b2b0: 2020 202e 2e2e 2020 2020 2063 6f6f 7264     ...     coord
-0001b2c0: 733d 7b22 7374 6174 696f 6e22 3a20 5b22  s={"station": ["
-0001b2d0: 626f 7374 6f6e 222c 2022 6e79 6322 2c20  boston", "nyc", 
-0001b2e0: 2273 6561 7474 6c65 222c 2022 6465 6e76  "seattle", "denv
-0001b2f0: 6572 225d 7d2c 0a20 2020 2020 2020 202e  er"]},.        .
-0001b300: 2e2e 2029 0a20 2020 2020 2020 203e 3e3e  .. ).        >>>
-0001b310: 2078 0a20 2020 2020 2020 203c 7861 7272   x.        <xarr
-0001b320: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
-0001b330: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
-0001b340: 2020 2020 2028 7374 6174 696f 6e3a 2034       (station: 4
-0001b350: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
-0001b360: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
-0001b370: 202a 2073 7461 7469 6f6e 2020 2020 2020   * station      
-0001b380: 2873 7461 7469 6f6e 2920 3c55 3720 2762  (station) <U7 'b
-0001b390: 6f73 746f 6e27 2027 6e79 6327 2027 7365  oston' 'nyc' 'se
-0001b3a0: 6174 746c 6527 2027 6465 6e76 6572 270a  attle' 'denver'.
-0001b3b0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-0001b3c0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-0001b3d0: 2020 2020 7465 6d70 6572 6174 7572 6520      temperature 
-0001b3e0: 2028 7374 6174 696f 6e29 2066 6c6f 6174   (station) float
-0001b3f0: 3634 2031 302e 3938 2031 342e 3320 3132  64 10.98 14.3 12
-0001b400: 2e30 3620 3130 2e39 0a20 2020 2020 2020  .06 10.9.       
-0001b410: 2020 2020 2070 7265 7373 7572 6520 2020       pressure   
-0001b420: 2020 2873 7461 7469 6f6e 2920 666c 6f61    (station) floa
-0001b430: 7436 3420 3231 312e 3820 3332 322e 3920  t64 211.8 322.9 
-0001b440: 3231 382e 3820 3434 352e 390a 2020 2020  218.8 445.9.    
-0001b450: 2020 2020 3e3e 3e20 782e 696e 6465 7865      >>> x.indexe
-0001b460: 730a 2020 2020 2020 2020 496e 6465 7865  s.        Indexe
-0001b470: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-0001b480: 7461 7469 6f6e 2020 496e 6465 7828 5b27  tation  Index(['
-0001b490: 626f 7374 6f6e 272c 2027 6e79 6327 2c20  boston', 'nyc', 
-0001b4a0: 2773 6561 7474 6c65 272c 2027 6465 6e76  'seattle', 'denv
-0001b4b0: 6572 275d 2c20 6474 7970 653d 276f 626a  er'], dtype='obj
-0001b4c0: 6563 7427 2c20 6e61 6d65 3d27 7374 6174  ect', name='stat
-0001b4d0: 696f 6e27 290a 0a20 2020 2020 2020 2043  ion')..        C
-0001b4e0: 7265 6174 6520 6120 6e65 7720 696e 6465  reate a new inde
-0001b4f0: 7820 616e 6420 7265 696e 6465 7820 7468  x and reindex th
-0001b500: 6520 6461 7461 7365 742e 2042 7920 6465  e dataset. By de
-0001b510: 6661 756c 7420 7661 6c75 6573 2069 6e20  fault values in 
-0001b520: 7468 6520 6e65 7720 696e 6465 7820 7468  the new index th
-0001b530: 6174 0a20 2020 2020 2020 2064 6f20 6e6f  at.        do no
-0001b540: 7420 6861 7665 2063 6f72 7265 7370 6f6e  t have correspon
-0001b550: 6469 6e67 2072 6563 6f72 6473 2069 6e20  ding records in 
-0001b560: 7468 6520 6461 7461 7365 7420 6172 6520  the dataset are 
-0001b570: 6173 7369 676e 6564 2060 4e61 4e60 2e0a  assigned `NaN`..
-0001b580: 0a20 2020 2020 2020 203e 3e3e 206e 6577  .        >>> new
-0001b590: 5f69 6e64 6578 203d 205b 2262 6f73 746f  _index = ["bosto
-0001b5a0: 6e22 2c20 2261 7573 7469 6e22 2c20 2273  n", "austin", "s
-0001b5b0: 6561 7474 6c65 222c 2022 6c69 6e63 6f6c  eattle", "lincol
-0001b5c0: 6e22 5d0a 2020 2020 2020 2020 3e3e 3e20  n"].        >>> 
-0001b5d0: 782e 7265 696e 6465 7828 7b22 7374 6174  x.reindex({"stat
-0001b5e0: 696f 6e22 3a20 6e65 775f 696e 6465 787d  ion": new_index}
-0001b5f0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-0001b600: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-0001b610: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-0001b620: 2020 2020 2873 7461 7469 6f6e 3a20 3429      (station: 4)
-0001b630: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
-0001b640: 6174 6573 3a0a 2020 2020 2020 2020 2020  ates:.          
-0001b650: 2a20 7374 6174 696f 6e20 2020 2020 2028  * station      (
-0001b660: 7374 6174 696f 6e29 203c 5537 2027 626f  station) <U7 'bo
-0001b670: 7374 6f6e 2720 2761 7573 7469 6e27 2027  ston' 'austin' '
-0001b680: 7365 6174 746c 6527 2027 6c69 6e63 6f6c  seattle' 'lincol
-0001b690: 6e27 0a20 2020 2020 2020 2044 6174 6120  n'.        Data 
-0001b6a0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-0001b6b0: 2020 2020 2020 2074 656d 7065 7261 7475         temperatu
-0001b6c0: 7265 2020 2873 7461 7469 6f6e 2920 666c  re  (station) fl
-0001b6d0: 6f61 7436 3420 3130 2e39 3820 6e61 6e20  oat64 10.98 nan 
-0001b6e0: 3132 2e30 3620 6e61 6e0a 2020 2020 2020  12.06 nan.      
-0001b6f0: 2020 2020 2020 7072 6573 7375 7265 2020        pressure  
-0001b700: 2020 2028 7374 6174 696f 6e29 2066 6c6f     (station) flo
-0001b710: 6174 3634 2032 3131 2e38 206e 616e 2032  at64 211.8 nan 2
-0001b720: 3138 2e38 206e 616e 0a0a 2020 2020 2020  18.8 nan..      
-0001b730: 2020 5765 2063 616e 2066 696c 6c20 696e    We can fill in
-0001b740: 2074 6865 206d 6973 7369 6e67 2076 616c   the missing val
-0001b750: 7565 7320 6279 2070 6173 7369 6e67 2061  ues by passing a
-0001b760: 2076 616c 7565 2074 6f20 7468 6520 6b65   value to the ke
-0001b770: 7977 6f72 6420 6066 696c 6c5f 7661 6c75  yword `fill_valu
-0001b780: 6560 2e0a 0a20 2020 2020 2020 203e 3e3e  e`...        >>>
-0001b790: 2078 2e72 6569 6e64 6578 287b 2273 7461   x.reindex({"sta
-0001b7a0: 7469 6f6e 223a 206e 6577 5f69 6e64 6578  tion": new_index
-0001b7b0: 7d2c 2066 696c 6c5f 7661 6c75 653d 3029  }, fill_value=0)
-0001b7c0: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
-0001b7d0: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
-0001b7e0: 2020 4469 6d65 6e73 696f 6e73 3a20 2020    Dimensions:   
-0001b7f0: 2020 2028 7374 6174 696f 6e3a 2034 290a     (station: 4).
-0001b800: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
-0001b810: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
-0001b820: 2073 7461 7469 6f6e 2020 2020 2020 2873   station      (s
-0001b830: 7461 7469 6f6e 2920 3c55 3720 2762 6f73  tation) <U7 'bos
-0001b840: 746f 6e27 2027 6175 7374 696e 2720 2773  ton' 'austin' 's
-0001b850: 6561 7474 6c65 2720 276c 696e 636f 6c6e  eattle' 'lincoln
-0001b860: 270a 2020 2020 2020 2020 4461 7461 2076  '.        Data v
-0001b870: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
-0001b880: 2020 2020 2020 7465 6d70 6572 6174 7572        temperatur
-0001b890: 6520 2028 7374 6174 696f 6e29 2066 6c6f  e  (station) flo
-0001b8a0: 6174 3634 2031 302e 3938 2030 2e30 2031  at64 10.98 0.0 1
-0001b8b0: 322e 3036 2030 2e30 0a20 2020 2020 2020  2.06 0.0.       
-0001b8c0: 2020 2020 2070 7265 7373 7572 6520 2020       pressure   
-0001b8d0: 2020 2873 7461 7469 6f6e 2920 666c 6f61    (station) floa
-0001b8e0: 7436 3420 3231 312e 3820 302e 3020 3231  t64 211.8 0.0 21
-0001b8f0: 382e 3820 302e 300a 0a20 2020 2020 2020  8.8 0.0..       
-0001b900: 2057 6520 6361 6e20 616c 736f 2075 7365   We can also use
-0001b910: 2064 6966 6665 7265 6e74 2066 696c 6c20   different fill 
-0001b920: 7661 6c75 6573 2066 6f72 2065 6163 6820  values for each 
-0001b930: 7661 7269 6162 6c65 2e0a 0a20 2020 2020  variable...     
-0001b940: 2020 203e 3e3e 2078 2e72 6569 6e64 6578     >>> x.reindex
-0001b950: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
-0001b960: 2020 7b22 7374 6174 696f 6e22 3a20 6e65    {"station": ne
-0001b970: 775f 696e 6465 787d 2c20 6669 6c6c 5f76  w_index}, fill_v
-0001b980: 616c 7565 3d7b 2274 656d 7065 7261 7475  alue={"temperatu
-0001b990: 7265 223a 2030 2c20 2270 7265 7373 7572  re": 0, "pressur
-0001b9a0: 6522 3a20 3130 307d 0a20 2020 2020 2020  e": 100}.       
-0001b9b0: 202e 2e2e 2029 0a20 2020 2020 2020 203c   ... ).        <
-0001b9c0: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
-0001b9d0: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-0001b9e0: 6e73 3a20 2020 2020 2028 7374 6174 696f  ns:      (statio
-0001b9f0: 6e3a 2034 290a 2020 2020 2020 2020 436f  n: 4).        Co
-0001ba00: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-0001ba10: 2020 2020 202a 2073 7461 7469 6f6e 2020       * station  
-0001ba20: 2020 2020 2873 7461 7469 6f6e 2920 3c55      (station) <U
-0001ba30: 3720 2762 6f73 746f 6e27 2027 6175 7374  7 'boston' 'aust
-0001ba40: 696e 2720 2773 6561 7474 6c65 2720 276c  in' 'seattle' 'l
-0001ba50: 696e 636f 6c6e 270a 2020 2020 2020 2020  incoln'.        
-0001ba60: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-0001ba70: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-0001ba80: 6572 6174 7572 6520 2028 7374 6174 696f  erature  (statio
-0001ba90: 6e29 2066 6c6f 6174 3634 2031 302e 3938  n) float64 10.98
-0001baa0: 2030 2e30 2031 322e 3036 2030 2e30 0a20   0.0 12.06 0.0. 
-0001bab0: 2020 2020 2020 2020 2020 2070 7265 7373             press
-0001bac0: 7572 6520 2020 2020 2873 7461 7469 6f6e  ure     (station
-0001bad0: 2920 666c 6f61 7436 3420 3231 312e 3820  ) float64 211.8 
-0001bae0: 3130 302e 3020 3231 382e 3820 3130 302e  100.0 218.8 100.
-0001baf0: 300a 0a20 2020 2020 2020 2042 6563 6175  0..        Becau
-0001bb00: 7365 2074 6865 2069 6e64 6578 2069 7320  se the index is 
-0001bb10: 6e6f 7420 6d6f 6e6f 746f 6e69 6361 6c6c  not monotonicall
-0001bb20: 7920 696e 6372 6561 7369 6e67 206f 7220  y increasing or 
-0001bb30: 6465 6372 6561 7369 6e67 2c20 7765 2063  decreasing, we c
-0001bb40: 616e 6e6f 7420 7573 6520 6172 6775 6d65  annot use argume
-0001bb50: 6e74 730a 2020 2020 2020 2020 746f 2074  nts.        to t
-0001bb60: 6865 206b 6579 776f 7264 206d 6574 686f  he keyword metho
-0001bb70: 6420 746f 2066 696c 6c20 7468 6520 604e  d to fill the `N
-0001bb80: 614e 6020 7661 6c75 6573 2e0a 0a20 2020  aN` values...   
-0001bb90: 2020 2020 203e 3e3e 2078 2e72 6569 6e64       >>> x.reind
-0001bba0: 6578 287b 2273 7461 7469 6f6e 223a 206e  ex({"station": n
-0001bbb0: 6577 5f69 6e64 6578 7d2c 206d 6574 686f  ew_index}, metho
-0001bbc0: 643d 226e 6561 7265 7374 2229 0a20 2020  d="nearest").   
-0001bbd0: 2020 2020 2054 7261 6365 6261 636b 2028       Traceback (
-0001bbe0: 6d6f 7374 2072 6563 656e 7420 6361 6c6c  most recent call
-0001bbf0: 206c 6173 7429 3a0a 2020 2020 2020 2020   last):.        
-0001bc00: 2e2e 2e0a 2020 2020 2020 2020 2020 2020  ....            
-0001bc10: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0001bc20: 2827 696e 6465 7820 6d75 7374 2062 6520  ('index must be 
-0001bc30: 6d6f 6e6f 746f 6e69 6320 696e 6372 6561  monotonic increa
-0001bc40: 7369 6e67 206f 7220 6465 6372 6561 7369  sing or decreasi
-0001bc50: 6e67 2729 0a20 2020 2020 2020 2056 616c  ng').        Val
-0001bc60: 7565 4572 726f 723a 2069 6e64 6578 206d  ueError: index m
-0001bc70: 7573 7420 6265 206d 6f6e 6f74 6f6e 6963  ust be monotonic
-0001bc80: 2069 6e63 7265 6173 696e 6720 6f72 2064   increasing or d
-0001bc90: 6563 7265 6173 696e 670a 0a20 2020 2020  ecreasing..     
-0001bca0: 2020 2054 6f20 6675 7274 6865 7220 696c     To further il
-0001bcb0: 6c75 7374 7261 7465 2074 6865 2066 696c  lustrate the fil
-0001bcc0: 6c69 6e67 2066 756e 6374 696f 6e61 6c69  ling functionali
-0001bcd0: 7479 2069 6e20 7265 696e 6465 782c 2077  ty in reindex, w
-0001bce0: 6520 7769 6c6c 2063 7265 6174 6520 610a  e will create a.
-0001bcf0: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
-0001bd00: 7769 7468 2061 206d 6f6e 6f74 6f6e 6963  with a monotonic
-0001bd10: 616c 6c79 2069 6e63 7265 6173 696e 6720  ally increasing 
-0001bd20: 696e 6465 7820 2866 6f72 2065 7861 6d70  index (for examp
-0001bd30: 6c65 2c20 6120 7365 7175 656e 6365 206f  le, a sequence o
-0001bd40: 6620 6461 7465 7329 2e0a 0a20 2020 2020  f dates)...     
-0001bd50: 2020 203e 3e3e 2078 3220 3d20 7872 2e44     >>> x2 = xr.D
-0001bd60: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
-0001bd70: 2e2e 2e20 2020 2020 7b0a 2020 2020 2020  ...     {.      
-0001bd80: 2020 2e2e 2e20 2020 2020 2020 2020 2274    ...         "t
-0001bd90: 656d 7065 7261 7475 7265 223a 2028 0a20  emperature": (. 
-0001bda0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-0001bdb0: 2020 2020 2020 2022 7469 6d65 222c 0a20         "time",. 
-0001bdc0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-0001bdd0: 2020 2020 2020 205b 3135 2e35 372c 2031         [15.57, 1
-0001bde0: 322e 3737 2c20 6e70 2e6e 616e 2c20 302e  2.77, np.nan, 0.
-0001bdf0: 3330 3831 2c20 3136 2e35 392c 2031 352e  3081, 16.59, 15.
-0001be00: 3132 5d2c 0a20 2020 2020 2020 202e 2e2e  12],.        ...
-0001be10: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-0001be20: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0001be30: 2270 7265 7373 7572 6522 3a20 2822 7469  "pressure": ("ti
-0001be40: 6d65 222c 2035 3030 202a 206e 702e 7261  me", 500 * np.ra
-0001be50: 6e64 6f6d 2e72 616e 6428 3629 292c 0a20  ndom.rand(6)),. 
-0001be60: 2020 2020 2020 202e 2e2e 2020 2020 207d         ...     }
-0001be70: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-0001be80: 2020 636f 6f72 6473 3d7b 2274 696d 6522    coords={"time"
-0001be90: 3a20 7064 2e64 6174 655f 7261 6e67 6528  : pd.date_range(
-0001bea0: 2230 312f 3031 2f32 3031 3922 2c20 7065  "01/01/2019", pe
-0001beb0: 7269 6f64 733d 362c 2066 7265 713d 2244  riods=6, freq="D
-0001bec0: 2229 7d2c 0a20 2020 2020 2020 202e 2e2e  ")},.        ...
-0001bed0: 2029 0a20 2020 2020 2020 203e 3e3e 2078   ).        >>> x
-0001bee0: 320a 2020 2020 2020 2020 3c78 6172 7261  2.        <xarra
-0001bef0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-0001bf00: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-0001bf10: 2020 2020 2874 696d 653a 2036 290a 2020      (time: 6).  
-0001bf20: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-0001bf30: 733a 0a20 2020 2020 2020 2020 202a 2074  s:.          * t
-0001bf40: 696d 6520 2020 2020 2020 2020 2874 696d  ime         (tim
-0001bf50: 6529 2064 6174 6574 696d 6536 345b 6e73  e) datetime64[ns
-0001bf60: 5d20 3230 3139 2d30 312d 3031 2032 3031  ] 2019-01-01 201
-0001bf70: 392d 3031 2d30 3220 2e2e 2e20 3230 3139  9-01-02 ... 2019
-0001bf80: 2d30 312d 3036 0a20 2020 2020 2020 2044  -01-06.        D
-0001bf90: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-0001bfa0: 2020 2020 2020 2020 2020 2074 656d 7065             tempe
-0001bfb0: 7261 7475 7265 2020 2874 696d 6529 2066  rature  (time) f
-0001bfc0: 6c6f 6174 3634 2031 352e 3537 2031 322e  loat64 15.57 12.
-0001bfd0: 3737 206e 616e 2030 2e33 3038 3120 3136  77 nan 0.3081 16
-0001bfe0: 2e35 3920 3135 2e31 320a 2020 2020 2020  .59 15.12.      
-0001bff0: 2020 2020 2020 7072 6573 7375 7265 2020        pressure  
-0001c000: 2020 2028 7469 6d65 2920 666c 6f61 7436     (time) float6
-0001c010: 3420 3438 312e 3820 3139 312e 3720 3339  4 481.8 191.7 39
-0001c020: 352e 3920 3236 342e 3420 3238 342e 3020  5.9 264.4 284.0 
-0001c030: 3436 322e 380a 0a20 2020 2020 2020 2053  462.8..        S
-0001c040: 7570 706f 7365 2077 6520 6465 6369 6465  uppose we decide
-0001c050: 2074 6f20 6578 7061 6e64 2074 6865 2064   to expand the d
-0001c060: 6174 6173 6574 2074 6f20 636f 7665 7220  ataset to cover 
-0001c070: 6120 7769 6465 7220 6461 7465 2072 616e  a wider date ran
-0001c080: 6765 2e0a 0a20 2020 2020 2020 203e 3e3e  ge...        >>>
-0001c090: 2074 696d 655f 696e 6465 7832 203d 2070   time_index2 = p
-0001c0a0: 642e 6461 7465 5f72 616e 6765 2822 3132  d.date_range("12
-0001c0b0: 2f32 392f 3230 3138 222c 2070 6572 696f  /29/2018", perio
-0001c0c0: 6473 3d31 302c 2066 7265 713d 2244 2229  ds=10, freq="D")
-0001c0d0: 0a20 2020 2020 2020 203e 3e3e 2078 322e  .        >>> x2.
-0001c0e0: 7265 696e 6465 7828 7b22 7469 6d65 223a  reindex({"time":
-0001c0f0: 2074 696d 655f 696e 6465 7832 7d29 0a20   time_index2}). 
-0001c100: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
-0001c110: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
-0001c120: 4469 6d65 6e73 696f 6e73 3a20 2020 2020  Dimensions:     
-0001c130: 2028 7469 6d65 3a20 3130 290a 2020 2020   (time: 10).    
-0001c140: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-0001c150: 0a20 2020 2020 2020 2020 202a 2074 696d  .          * tim
-0001c160: 6520 2020 2020 2020 2020 2874 696d 6529  e         (time)
-0001c170: 2064 6174 6574 696d 6536 345b 6e73 5d20   datetime64[ns] 
-0001c180: 3230 3138 2d31 322d 3239 2032 3031 382d  2018-12-29 2018-
-0001c190: 3132 2d33 3020 2e2e 2e20 3230 3139 2d30  12-30 ... 2019-0
-0001c1a0: 312d 3037 0a20 2020 2020 2020 2044 6174  1-07.        Dat
-0001c1b0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-0001c1c0: 2020 2020 2020 2020 2074 656d 7065 7261           tempera
-0001c1d0: 7475 7265 2020 2874 696d 6529 2066 6c6f  ture  (time) flo
-0001c1e0: 6174 3634 206e 616e 206e 616e 206e 616e  at64 nan nan nan
-0001c1f0: 2031 352e 3537 202e 2e2e 2030 2e33 3038   15.57 ... 0.308
-0001c200: 3120 3136 2e35 3920 3135 2e31 3220 6e61  1 16.59 15.12 na
-0001c210: 6e0a 2020 2020 2020 2020 2020 2020 7072  n.            pr
-0001c220: 6573 7375 7265 2020 2020 2028 7469 6d65  essure     (time
-0001c230: 2920 666c 6f61 7436 3420 6e61 6e20 6e61  ) float64 nan na
-0001c240: 6e20 6e61 6e20 3438 312e 3820 2e2e 2e20  n nan 481.8 ... 
-0001c250: 3236 342e 3420 3238 342e 3020 3436 322e  264.4 284.0 462.
-0001c260: 3820 6e61 6e0a 0a20 2020 2020 2020 2054  8 nan..        T
-0001c270: 6865 2069 6e64 6578 2065 6e74 7269 6573  he index entries
-0001c280: 2074 6861 7420 6469 6420 6e6f 7420 6861   that did not ha
-0001c290: 7665 2061 2076 616c 7565 2069 6e20 7468  ve a value in th
-0001c2a0: 6520 6f72 6967 696e 616c 2064 6174 6120  e original data 
-0001c2b0: 6672 616d 6520 2866 6f72 2065 7861 6d70  frame (for examp
-0001c2c0: 6c65 2c20 6032 3031 382d 3132 2d32 3960  le, `2018-12-29`
-0001c2d0: 290a 2020 2020 2020 2020 6172 6520 6279  ).        are by
-0001c2e0: 2064 6566 6175 6c74 2066 696c 6c65 6420   default filled 
-0001c2f0: 7769 7468 204e 614e 2e20 4966 2064 6573  with NaN. If des
-0001c300: 6972 6564 2c20 7765 2063 616e 2066 696c  ired, we can fil
-0001c310: 6c20 696e 2074 6865 206d 6973 7369 6e67  l in the missing
-0001c320: 2076 616c 7565 7320 7573 696e 6720 6f6e   values using on
-0001c330: 6520 6f66 2073 6576 6572 616c 206f 7074  e of several opt
-0001c340: 696f 6e73 2e0a 0a20 2020 2020 2020 2046  ions...        F
-0001c350: 6f72 2065 7861 6d70 6c65 2c20 746f 2062  or example, to b
-0001c360: 6163 6b2d 7072 6f70 6167 6174 6520 7468  ack-propagate th
-0001c370: 6520 6c61 7374 2076 616c 6964 2076 616c  e last valid val
-0001c380: 7565 2074 6f20 6669 6c6c 2074 6865 2060  ue to fill the `
-0001c390: 4e61 4e60 2076 616c 7565 732c 0a20 2020  NaN` values,.   
-0001c3a0: 2020 2020 2070 6173 7320 6062 6669 6c6c       pass `bfill
-0001c3b0: 6020 6173 2061 6e20 6172 6775 6d65 6e74  ` as an argument
-0001c3c0: 2074 6f20 7468 6520 606d 6574 686f 6460   to the `method`
-0001c3d0: 206b 6579 776f 7264 2e0a 0a20 2020 2020   keyword...     
-0001c3e0: 2020 203e 3e3e 2078 3320 3d20 7832 2e72     >>> x3 = x2.r
-0001c3f0: 6569 6e64 6578 287b 2274 696d 6522 3a20  eindex({"time": 
-0001c400: 7469 6d65 5f69 6e64 6578 327d 2c20 6d65  time_index2}, me
-0001c410: 7468 6f64 3d22 6266 696c 6c22 290a 2020  thod="bfill").  
-0001c420: 2020 2020 2020 3e3e 3e20 7833 0a20 2020        >>> x3.   
-0001c430: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-0001c440: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
-0001c450: 6d65 6e73 696f 6e73 3a20 2020 2020 2028  mensions:      (
-0001c460: 7469 6d65 3a20 3130 290a 2020 2020 2020  time: 10).      
-0001c470: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-0001c480: 2020 2020 2020 2020 202a 2074 696d 6520           * time 
-0001c490: 2020 2020 2020 2020 2874 696d 6529 2064          (time) d
-0001c4a0: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
-0001c4b0: 3138 2d31 322d 3239 2032 3031 382d 3132  18-12-29 2018-12
-0001c4c0: 2d33 3020 2e2e 2e20 3230 3139 2d30 312d  -30 ... 2019-01-
-0001c4d0: 3037 0a20 2020 2020 2020 2044 6174 6120  07.        Data 
-0001c4e0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-0001c4f0: 2020 2020 2020 2074 656d 7065 7261 7475         temperatu
-0001c500: 7265 2020 2874 696d 6529 2066 6c6f 6174  re  (time) float
-0001c510: 3634 2031 352e 3537 2031 352e 3537 2031  64 15.57 15.57 1
-0001c520: 352e 3537 2031 352e 3537 202e 2e2e 2031  5.57 15.57 ... 1
-0001c530: 362e 3539 2031 352e 3132 206e 616e 0a20  6.59 15.12 nan. 
-0001c540: 2020 2020 2020 2020 2020 2070 7265 7373             press
-0001c550: 7572 6520 2020 2020 2874 696d 6529 2066  ure     (time) f
-0001c560: 6c6f 6174 3634 2034 3831 2e38 2034 3831  loat64 481.8 481
-0001c570: 2e38 2034 3831 2e38 2034 3831 2e38 202e  .8 481.8 481.8 .
-0001c580: 2e2e 2032 3834 2e30 2034 3632 2e38 206e  .. 284.0 462.8 n
-0001c590: 616e 0a0a 2020 2020 2020 2020 506c 6561  an..        Plea
-0001c5a0: 7365 206e 6f74 6520 7468 6174 2074 6865  se note that the
-0001c5b0: 2060 4e61 4e60 2076 616c 7565 2070 7265   `NaN` value pre
-0001c5c0: 7365 6e74 2069 6e20 7468 6520 6f72 6967  sent in the orig
-0001c5d0: 696e 616c 2064 6174 6173 6574 2028 6174  inal dataset (at
-0001c5e0: 2069 6e64 6578 2076 616c 7565 2060 3230   index value `20
-0001c5f0: 3139 2d30 312d 3033 6029 0a20 2020 2020  19-01-03`).     
-0001c600: 2020 2077 696c 6c20 6e6f 7420 6265 2066     will not be f
-0001c610: 696c 6c65 6420 6279 2061 6e79 206f 6620  illed by any of 
-0001c620: 7468 6520 7661 6c75 6520 7072 6f70 6167  the value propag
-0001c630: 6174 696f 6e20 7363 6865 6d65 732e 0a0a  ation schemes...
-0001c640: 2020 2020 2020 2020 3e3e 3e20 7832 2e77          >>> x2.w
-0001c650: 6865 7265 2878 322e 7465 6d70 6572 6174  here(x2.temperat
-0001c660: 7572 652e 6973 6e75 6c6c 2829 2c20 6472  ure.isnull(), dr
-0001c670: 6f70 3d54 7275 6529 0a20 2020 2020 2020  op=True).       
-0001c680: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-0001c690: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-0001c6a0: 696f 6e73 3a20 2020 2020 2028 7469 6d65  ions:      (time
-0001c6b0: 3a20 3129 0a20 2020 2020 2020 2043 6f6f  : 1).        Coo
-0001c6c0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-0001c6d0: 2020 2020 2a20 7469 6d65 2020 2020 2020      * time      
-0001c6e0: 2020 2028 7469 6d65 2920 6461 7465 7469     (time) dateti
-0001c6f0: 6d65 3634 5b6e 735d 2032 3031 392d 3031  me64[ns] 2019-01
-0001c700: 2d30 330a 2020 2020 2020 2020 4461 7461  -03.        Data
-0001c710: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-0001c720: 2020 2020 2020 2020 7465 6d70 6572 6174          temperat
-0001c730: 7572 6520 2028 7469 6d65 2920 666c 6f61  ure  (time) floa
-0001c740: 7436 3420 6e61 6e0a 2020 2020 2020 2020  t64 nan.        
-0001c750: 2020 2020 7072 6573 7375 7265 2020 2020      pressure    
-0001c760: 2028 7469 6d65 2920 666c 6f61 7436 3420   (time) float64 
-0001c770: 3339 352e 390a 2020 2020 2020 2020 3e3e  395.9.        >>
-0001c780: 3e20 7833 2e77 6865 7265 2878 332e 7465  > x3.where(x3.te
-0001c790: 6d70 6572 6174 7572 652e 6973 6e75 6c6c  mperature.isnull
-0001c7a0: 2829 2c20 6472 6f70 3d54 7275 6529 0a20  (), drop=True). 
-0001c7b0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
-0001c7c0: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
-0001c7d0: 4469 6d65 6e73 696f 6e73 3a20 2020 2020  Dimensions:     
-0001c7e0: 2028 7469 6d65 3a20 3229 0a20 2020 2020   (time: 2).     
-0001c7f0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-0001c800: 2020 2020 2020 2020 2020 2a20 7469 6d65            * time
-0001c810: 2020 2020 2020 2020 2028 7469 6d65 2920           (time) 
-0001c820: 6461 7465 7469 6d65 3634 5b6e 735d 2032  datetime64[ns] 2
-0001c830: 3031 392d 3031 2d30 3320 3230 3139 2d30  019-01-03 2019-0
-0001c840: 312d 3037 0a20 2020 2020 2020 2044 6174  1-07.        Dat
-0001c850: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-0001c860: 2020 2020 2020 2020 2074 656d 7065 7261           tempera
-0001c870: 7475 7265 2020 2874 696d 6529 2066 6c6f  ture  (time) flo
-0001c880: 6174 3634 206e 616e 206e 616e 0a20 2020  at64 nan nan.   
-0001c890: 2020 2020 2020 2020 2070 7265 7373 7572           pressur
-0001c8a0: 6520 2020 2020 2874 696d 6529 2066 6c6f  e     (time) flo
-0001c8b0: 6174 3634 2033 3935 2e39 206e 616e 0a0a  at64 395.9 nan..
-0001c8c0: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
-0001c8d0: 6265 6361 7573 6520 6669 6c6c 696e 6720  because filling 
-0001c8e0: 7768 696c 6520 7265 696e 6465 7869 6e67  while reindexing
-0001c8f0: 2064 6f65 7320 6e6f 7420 6c6f 6f6b 2061   does not look a
-0001c900: 7420 6461 7461 7365 7420 7661 6c75 6573  t dataset values
-0001c910: 2c20 6275 7420 6f6e 6c79 2063 6f6d 7061  , but only compa
-0001c920: 7265 730a 2020 2020 2020 2020 7468 6520  res.        the 
-0001c930: 6f72 6967 696e 616c 2061 6e64 2064 6573  original and des
-0001c940: 6972 6564 2069 6e64 6578 6573 2e20 4966  ired indexes. If
-0001c950: 2079 6f75 2064 6f20 7761 6e74 2074 6f20   you do want to 
-0001c960: 6669 6c6c 2069 6e20 7468 6520 604e 614e  fill in the `NaN
-0001c970: 6020 7661 6c75 6573 2070 7265 7365 6e74  ` values present
-0001c980: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
-0001c990: 6f72 6967 696e 616c 2064 6174 6173 6574  original dataset
-0001c9a0: 2c20 7573 6520 7468 6520 3a70 793a 6d65  , use the :py:me
-0001c9b0: 7468 3a60 7e44 6174 6173 6574 2e66 696c  th:`~Dataset.fil
-0001c9c0: 6c6e 6128 2960 206d 6574 686f 642e 0a0a  lna()` method...
-0001c9d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c9e0: 2020 2020 696e 6465 7865 7273 203d 2075      indexers = u
-0001c9f0: 7469 6c73 2e65 6974 6865 725f 6469 6374  tils.either_dict
-0001ca00: 5f6f 725f 6b77 6172 6773 2869 6e64 6578  _or_kwargs(index
-0001ca10: 6572 732c 2069 6e64 6578 6572 735f 6b77  ers, indexers_kw
-0001ca20: 6172 6773 2c20 2272 6569 6e64 6578 2229  args, "reindex")
-0001ca30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001ca40: 616c 6967 6e6d 656e 742e 7265 696e 6465  alignment.reinde
-0001ca50: 7828 0a20 2020 2020 2020 2020 2020 2073  x(.            s
-0001ca60: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-0001ca70: 2069 6e64 6578 6572 733d 696e 6465 7865   indexers=indexe
-0001ca80: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-0001ca90: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
-0001caa0: 2020 2020 2020 2020 2020 2074 6f6c 6572             toler
-0001cab0: 616e 6365 3d74 6f6c 6572 616e 6365 2c0a  ance=tolerance,.
-0001cac0: 2020 2020 2020 2020 2020 2020 636f 7079              copy
-0001cad0: 3d63 6f70 792c 0a20 2020 2020 2020 2020  =copy,.         
-0001cae0: 2020 2066 696c 6c5f 7661 6c75 653d 6669     fill_value=fi
-0001caf0: 6c6c 5f76 616c 7565 2c0a 2020 2020 2020  ll_value,.      
-0001cb00: 2020 290a 0a20 2020 2064 6566 205f 7265    )..    def _re
-0001cb10: 696e 6465 7828 0a20 2020 2020 2020 2073  index(.        s
-0001cb20: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-0001cb30: 2020 2020 2020 2020 696e 6465 7865 7273          indexers
-0001cb40: 3a20 4d61 7070 696e 675b 416e 792c 2041  : Mapping[Any, A
-0001cb50: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
-0001cb60: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
-0001cb70: 643a 2073 7472 207c 204e 6f6e 6520 3d20  d: str | None = 
-0001cb80: 4e6f 6e65 2c0a 2020 2020 2020 2020 746f  None,.        to
-0001cb90: 6c65 7261 6e63 653a 2069 6e74 207c 2066  lerance: int | f
-0001cba0: 6c6f 6174 207c 2049 7465 7261 626c 655b  loat | Iterable[
-0001cbb0: 696e 7420 7c20 666c 6f61 745d 207c 204e  int | float] | N
-0001cbc0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-0001cbd0: 2020 2020 636f 7079 3a20 626f 6f6c 203d      copy: bool =
-0001cbe0: 2054 7275 652c 0a20 2020 2020 2020 2066   True,.        f
-0001cbf0: 696c 6c5f 7661 6c75 653a 2041 6e79 203d  ill_value: Any =
-0001cc00: 2078 7264 7479 7065 732e 4e41 2c0a 2020   xrdtypes.NA,.  
-0001cc10: 2020 2020 2020 7370 6172 7365 3a20 626f        sparse: bo
-0001cc20: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0001cc30: 2020 2020 2a2a 696e 6465 7865 7273 5f6b      **indexers_k
-0001cc40: 7761 7267 733a 2041 6e79 2c0a 2020 2020  wargs: Any,.    
-0001cc50: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-0001cc60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001cc70: 2020 2020 5361 6d65 2061 7320 7265 696e      Same as rein
-0001cc80: 6465 7820 6275 7420 7375 7070 6f72 7473  dex but supports
-0001cc90: 2073 7061 7273 6520 6f70 7469 6f6e 2e0a   sparse option..
-0001cca0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001ccb0: 2020 2020 696e 6465 7865 7273 203d 2075      indexers = u
-0001ccc0: 7469 6c73 2e65 6974 6865 725f 6469 6374  tils.either_dict
-0001ccd0: 5f6f 725f 6b77 6172 6773 2869 6e64 6578  _or_kwargs(index
-0001cce0: 6572 732c 2069 6e64 6578 6572 735f 6b77  ers, indexers_kw
-0001ccf0: 6172 6773 2c20 2272 6569 6e64 6578 2229  args, "reindex")
-0001cd00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001cd10: 616c 6967 6e6d 656e 742e 7265 696e 6465  alignment.reinde
-0001cd20: 7828 0a20 2020 2020 2020 2020 2020 2073  x(.            s
-0001cd30: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-0001cd40: 2069 6e64 6578 6572 733d 696e 6465 7865   indexers=indexe
-0001cd50: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-0001cd60: 6d65 7468 6f64 3d6d 6574 686f 642c 0a20  method=method,. 
-0001cd70: 2020 2020 2020 2020 2020 2074 6f6c 6572             toler
-0001cd80: 616e 6365 3d74 6f6c 6572 616e 6365 2c0a  ance=tolerance,.
-0001cd90: 2020 2020 2020 2020 2020 2020 636f 7079              copy
-0001cda0: 3d63 6f70 792c 0a20 2020 2020 2020 2020  =copy,.         
-0001cdb0: 2020 2066 696c 6c5f 7661 6c75 653d 6669     fill_value=fi
-0001cdc0: 6c6c 5f76 616c 7565 2c0a 2020 2020 2020  ll_value,.      
-0001cdd0: 2020 2020 2020 7370 6172 7365 3d73 7061        sparse=spa
-0001cde0: 7273 652c 0a20 2020 2020 2020 2029 0a0a  rse,.        )..
-0001cdf0: 2020 2020 6465 6620 696e 7465 7270 280a      def interp(.
-0001ce00: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
-0001ce10: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
-0001ce20: 2063 6f6f 7264 733a 204d 6170 7069 6e67   coords: Mapping
-0001ce30: 5b41 6e79 2c20 416e 795d 207c 204e 6f6e  [Any, Any] | Non
-0001ce40: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-0001ce50: 2020 6d65 7468 6f64 3a20 496e 7465 7270    method: Interp
-0001ce60: 4f70 7469 6f6e 7320 3d20 226c 696e 6561  Options = "linea
-0001ce70: 7222 2c0a 2020 2020 2020 2020 6173 7375  r",.        assu
-0001ce80: 6d65 5f73 6f72 7465 643a 2062 6f6f 6c20  me_sorted: bool 
-0001ce90: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0001cea0: 206b 7761 7267 733a 204d 6170 7069 6e67   kwargs: Mapping
-0001ceb0: 5b73 7472 2c20 416e 795d 207c 204e 6f6e  [str, Any] | Non
-0001cec0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-0001ced0: 2020 6d65 7468 6f64 5f6e 6f6e 5f6e 756d    method_non_num
-0001cee0: 6572 6963 3a20 7374 7220 3d20 226e 6561  eric: str = "nea
-0001cef0: 7265 7374 222c 0a20 2020 2020 2020 202a  rest",.        *
-0001cf00: 2a63 6f6f 7264 735f 6b77 6172 6773 3a20  *coords_kwargs: 
-0001cf10: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
-0001cf20: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-0001cf30: 2022 2222 496e 7465 7270 6f6c 6174 6520   """Interpolate 
-0001cf40: 6120 4461 7461 7365 7420 6f6e 746f 206e  a Dataset onto n
-0001cf50: 6577 2063 6f6f 7264 696e 6174 6573 0a0a  ew coordinates..
-0001cf60: 2020 2020 2020 2020 5065 7266 6f72 6d73          Performs
-0001cf70: 2075 6e69 7661 7269 6174 6520 6f72 206d   univariate or m
-0001cf80: 756c 7469 7661 7269 6174 6520 696e 7465  ultivariate inte
-0001cf90: 7270 6f6c 6174 696f 6e20 6f66 2061 2044  rpolation of a D
-0001cfa0: 6174 6173 6574 206f 6e74 6f0a 2020 2020  ataset onto.    
-0001cfb0: 2020 2020 6e65 7720 636f 6f72 6469 6e61      new coordina
-0001cfc0: 7465 7320 7573 696e 6720 7363 6970 7927  tes using scipy'
-0001cfd0: 7320 696e 7465 7270 6f6c 6174 696f 6e20  s interpolation 
-0001cfe0: 726f 7574 696e 6573 2e20 4966 2069 6e74  routines. If int
-0001cff0: 6572 706f 6c61 7469 6e67 0a20 2020 2020  erpolating.     
-0001d000: 2020 2061 6c6f 6e67 2061 6e20 6578 6973     along an exis
-0001d010: 7469 6e67 2064 696d 656e 7369 6f6e 2c20  ting dimension, 
-0001d020: 3a70 793a 636c 6173 733a 6073 6369 7079  :py:class:`scipy
-0001d030: 2e69 6e74 6572 706f 6c61 7465 2e69 6e74  .interpolate.int
-0001d040: 6572 7031 6460 2069 730a 2020 2020 2020  erp1d` is.      
-0001d050: 2020 6361 6c6c 6564 2e20 2057 6865 6e20    called.  When 
-0001d060: 696e 7465 7270 6f6c 6174 696e 6720 616c  interpolating al
-0001d070: 6f6e 6720 6d75 6c74 6970 6c65 2065 7869  ong multiple exi
-0001d080: 7374 696e 6720 6469 6d65 6e73 696f 6e73  sting dimensions
-0001d090: 2c20 616e 0a20 2020 2020 2020 2061 7474  , an.        att
-0001d0a0: 656d 7074 2069 7320 6d61 6465 2074 6f20  empt is made to 
-0001d0b0: 6465 636f 6d70 6f73 6520 7468 6520 696e  decompose the in
-0001d0c0: 7465 7270 6f6c 6174 696f 6e20 696e 746f  terpolation into
-0001d0d0: 206d 756c 7469 706c 650a 2020 2020 2020   multiple.      
-0001d0e0: 2020 312d 6469 6d65 6e73 696f 6e61 6c20    1-dimensional 
-0001d0f0: 696e 7465 7270 6f6c 6174 696f 6e73 2e20  interpolations. 
-0001d100: 4966 2074 6869 7320 6973 2070 6f73 7369  If this is possi
-0001d110: 626c 652c 0a20 2020 2020 2020 203a 7079  ble,.        :py
-0001d120: 3a63 6c61 7373 3a60 7363 6970 792e 696e  :class:`scipy.in
-0001d130: 7465 7270 6f6c 6174 652e 696e 7465 7270  terpolate.interp
-0001d140: 3164 6020 6973 2063 616c 6c65 642e 204f  1d` is called. O
-0001d150: 7468 6572 7769 7365 2c0a 2020 2020 2020  therwise,.      
-0001d160: 2020 3a70 793a 6675 6e63 3a60 7363 6970    :py:func:`scip
-0001d170: 792e 696e 7465 7270 6f6c 6174 652e 696e  y.interpolate.in
-0001d180: 7465 7270 6e60 2069 7320 6361 6c6c 6564  terpn` is called
-0001d190: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-0001d1a0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-0001d1b0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0001d1c0: 2063 6f6f 7264 7320 3a20 6469 6374 2c20   coords : dict, 
-0001d1d0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0001d1e0: 2020 2020 204d 6170 7069 6e67 2066 726f       Mapping fro
-0001d1f0: 6d20 6469 6d65 6e73 696f 6e20 6e61 6d65  m dimension name
-0001d200: 7320 746f 2074 6865 206e 6577 2063 6f6f  s to the new coo
-0001d210: 7264 696e 6174 6573 2e0a 2020 2020 2020  rdinates..      
-0001d220: 2020 2020 2020 4e65 7720 636f 6f72 6469        New coordi
-0001d230: 6e61 7465 2063 616e 2062 6520 6120 7363  nate can be a sc
-0001d240: 616c 6172 2c20 6172 7261 792d 6c69 6b65  alar, array-like
-0001d250: 206f 7220 4461 7461 4172 7261 792e 0a20   or DataArray.. 
-0001d260: 2020 2020 2020 2020 2020 2049 6620 4461             If Da
-0001d270: 7461 4172 7261 7973 2061 7265 2070 6173  taArrays are pas
-0001d280: 7365 6420 6173 206e 6577 2063 6f6f 7264  sed as new coord
-0001d290: 696e 6174 6573 2c20 7468 6569 7220 6469  inates, their di
-0001d2a0: 6d65 6e73 696f 6e73 2061 7265 0a20 2020  mensions are.   
-0001d2b0: 2020 2020 2020 2020 2075 7365 6420 666f           used fo
-0001d2c0: 7220 7468 6520 6272 6f61 6463 6173 7469  r the broadcasti
-0001d2d0: 6e67 2e20 4d69 7373 696e 6720 7661 6c75  ng. Missing valu
-0001d2e0: 6573 2061 7265 2073 6b69 7070 6564 2e0a  es are skipped..
-0001d2f0: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
-0001d300: 207b 226c 696e 6561 7222 2c20 226e 6561   {"linear", "nea
-0001d310: 7265 7374 222c 2022 7a65 726f 222c 2022  rest", "zero", "
-0001d320: 736c 696e 6561 7222 2c20 2271 7561 6472  slinear", "quadr
-0001d330: 6174 6963 222c 2022 6375 6269 6322 2c20  atic", "cubic", 
-0001d340: 2270 6f6c 796e 6f6d 6961 6c22 2c20 5c0a  "polynomial", \.
-0001d350: 2020 2020 2020 2020 2020 2020 2262 6172              "bar
-0001d360: 7963 656e 7472 6963 222c 2022 6b72 6f67  ycentric", "krog
-0001d370: 222c 2022 7063 6869 7022 2c20 2273 706c  ", "pchip", "spl
-0001d380: 696e 6522 2c20 2261 6b69 6d61 227d 2c20  ine", "akima"}, 
-0001d390: 6465 6661 756c 743a 2022 6c69 6e65 6172  default: "linear
-0001d3a0: 220a 2020 2020 2020 2020 2020 2020 5374  ".            St
-0001d3b0: 7269 6e67 2069 6e64 6963 6174 696e 6720  ring indicating 
-0001d3c0: 7768 6963 6820 6d65 7468 6f64 2074 6f20  which method to 
-0001d3d0: 7573 6520 666f 7220 696e 7465 7270 6f6c  use for interpol
-0001d3e0: 6174 696f 6e3a 0a0a 2020 2020 2020 2020  ation:..        
-0001d3f0: 2020 2020 2d20 276c 696e 6561 7227 3a20      - 'linear': 
-0001d400: 6c69 6e65 6172 2069 6e74 6572 706f 6c61  linear interpola
-0001d410: 7469 6f6e 2e20 4164 6469 7469 6f6e 616c  tion. Additional
-0001d420: 206b 6579 776f 7264 0a20 2020 2020 2020   keyword.       
-0001d430: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
-0001d440: 2061 7265 2070 6173 7365 6420 746f 203a   are passed to :
-0001d450: 7079 3a66 756e 633a 606e 756d 7079 2e69  py:func:`numpy.i
-0001d460: 6e74 6572 7060 0a20 2020 2020 2020 2020  nterp`.         
-0001d470: 2020 202d 2027 6e65 6172 6573 7427 2c20     - 'nearest', 
-0001d480: 277a 6572 6f27 2c20 2773 6c69 6e65 6172  'zero', 'slinear
-0001d490: 272c 2027 7175 6164 7261 7469 6327 2c20  ', 'quadratic', 
-0001d4a0: 2763 7562 6963 272c 2027 706f 6c79 6e6f  'cubic', 'polyno
-0001d4b0: 6d69 616c 273a 0a20 2020 2020 2020 2020  mial':.         
-0001d4c0: 2020 2020 2061 7265 2070 6173 7365 6420       are passed 
-0001d4d0: 746f 203a 7079 3a66 756e 633a 6073 6369  to :py:func:`sci
-0001d4e0: 7079 2e69 6e74 6572 706f 6c61 7465 2e69  py.interpolate.i
-0001d4f0: 6e74 6572 7031 6460 2e20 4966 0a20 2020  nterp1d`. If.   
-0001d500: 2020 2020 2020 2020 2020 2060 606d 6574             ``met
-0001d510: 686f 643d 2770 6f6c 796e 6f6d 6961 6c27  hod='polynomial'
-0001d520: 6060 2c20 7468 6520 6060 6f72 6465 7260  ``, the ``order`
-0001d530: 6020 6b65 7977 6f72 6420 6172 6775 6d65  ` keyword argume
-0001d540: 6e74 206d 7573 7420 616c 736f 2062 650a  nt must also be.
-0001d550: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001d560: 6f76 6964 6564 2e0a 2020 2020 2020 2020  ovided..        
-0001d570: 2020 2020 2d20 2762 6172 7963 656e 7472      - 'barycentr
-0001d580: 6963 272c 2027 6b72 6f67 272c 2027 7063  ic', 'krog', 'pc
-0001d590: 6869 7027 2c20 2773 706c 696e 6527 2c20  hip', 'spline', 
-0001d5a0: 2761 6b69 6d61 273a 2075 7365 2074 6865  'akima': use the
-0001d5b0: 6972 0a20 2020 2020 2020 2020 2020 2020  ir.             
-0001d5c0: 2072 6573 7065 6374 6976 6520 3a70 793a   respective :py:
-0001d5d0: 636c 6173 733a 6073 6369 7079 2e69 6e74  class:`scipy.int
-0001d5e0: 6572 706f 6c61 7465 6020 636c 6173 7365  erpolate` classe
-0001d5f0: 732e 0a0a 2020 2020 2020 2020 6173 7375  s...        assu
-0001d600: 6d65 5f73 6f72 7465 6420 3a20 626f 6f6c  me_sorted : bool
-0001d610: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
-0001d620: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0001d630: 4661 6c73 652c 2076 616c 7565 7320 6f66  False, values of
-0001d640: 2063 6f6f 7264 696e 6174 6573 2074 6861   coordinates tha
-0001d650: 7420 6172 6520 696e 7465 7270 6f6c 6174  t are interpolat
-0001d660: 6564 206f 7665 7220 6361 6e20 6265 0a20  ed over can be. 
-0001d670: 2020 2020 2020 2020 2020 2069 6e20 616e             in an
-0001d680: 7920 6f72 6465 7220 616e 6420 7468 6579  y order and they
-0001d690: 2061 7265 2073 6f72 7465 6420 6669 7273   are sorted firs
-0001d6a0: 742e 2049 6620 5472 7565 2c20 696e 7465  t. If True, inte
-0001d6b0: 7270 6f6c 6174 6564 0a20 2020 2020 2020  rpolated.       
-0001d6c0: 2020 2020 2063 6f6f 7264 696e 6174 6573       coordinates
-0001d6d0: 2061 7265 2061 7373 756d 6564 2074 6f20   are assumed to 
-0001d6e0: 6265 2061 6e20 6172 7261 7920 6f66 206d  be an array of m
-0001d6f0: 6f6e 6f74 6f6e 6963 616c 6c79 2069 6e63  onotonically inc
-0001d700: 7265 6173 696e 670a 2020 2020 2020 2020  reasing.        
-0001d710: 2020 2020 7661 6c75 6573 2e0a 2020 2020      values..    
-0001d720: 2020 2020 6b77 6172 6773 203a 2064 6963      kwargs : dic
-0001d730: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
-0001d740: 2020 2020 2020 2020 4164 6469 7469 6f6e          Addition
-0001d750: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
-0001d760: 656e 7473 2070 6173 7365 6420 746f 2073  ents passed to s
-0001d770: 6369 7079 2773 2069 6e74 6572 706f 6c61  cipy's interpola
-0001d780: 746f 722e 2056 616c 6964 0a20 2020 2020  tor. Valid.     
-0001d790: 2020 2020 2020 206f 7074 696f 6e73 2061         options a
-0001d7a0: 6e64 2074 6865 6972 2062 6568 6176 696f  nd their behavio
-0001d7b0: 7220 6465 7065 6e64 2077 6865 7468 6572  r depend whether
-0001d7c0: 2060 6069 6e74 6572 7031 6460 6020 6f72   ``interp1d`` or
-0001d7d0: 0a20 2020 2020 2020 2020 2020 2060 6069  .            ``i
-0001d7e0: 6e74 6572 706e 6060 2069 7320 7573 6564  nterpn`` is used
-0001d7f0: 2e0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-0001d800: 5f6e 6f6e 5f6e 756d 6572 6963 203a 207b  _non_numeric : {
-0001d810: 226e 6561 7265 7374 222c 2022 7061 6422  "nearest", "pad"
-0001d820: 2c20 2266 6669 6c6c 222c 2022 6261 636b  , "ffill", "back
-0001d830: 6669 6c6c 222c 2022 6266 696c 6c22 7d2c  fill", "bfill"},
-0001d840: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0001d850: 2020 2020 2020 4d65 7468 6f64 2066 6f72        Method for
-0001d860: 206e 6f6e 2d6e 756d 6572 6963 2074 7970   non-numeric typ
-0001d870: 6573 2e20 5061 7373 6564 206f 6e20 746f  es. Passed on to
-0001d880: 203a 7079 3a6d 6574 683a 6044 6174 6173   :py:meth:`Datas
-0001d890: 6574 2e72 6569 6e64 6578 602e 0a20 2020  et.reindex`..   
-0001d8a0: 2020 2020 2020 2020 2060 6022 6e65 6172           ``"near
-0001d8b0: 6573 7422 6060 2069 7320 7573 6564 2062  est"`` is used b
-0001d8c0: 7920 6465 6661 756c 742e 0a20 2020 2020  y default..     
-0001d8d0: 2020 202a 2a63 6f6f 7264 735f 6b77 6172     **coords_kwar
-0001d8e0: 6773 203a 207b 6469 6d3a 2063 6f6f 7264  gs : {dim: coord
-0001d8f0: 696e 6174 652c 202e 2e2e 7d2c 206f 7074  inate, ...}, opt
-0001d900: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-0001d910: 2020 5468 6520 6b65 7977 6f72 6420 6172    The keyword ar
-0001d920: 6775 6d65 6e74 7320 666f 726d 206f 6620  guments form of 
-0001d930: 6060 636f 6f72 6473 6060 2e0a 2020 2020  ``coords``..    
-0001d940: 2020 2020 2020 2020 4f6e 6520 6f66 2063          One of c
-0001d950: 6f6f 7264 7320 6f72 2063 6f6f 7264 735f  oords or coords_
-0001d960: 6b77 6172 6773 206d 7573 7420 6265 2070  kwargs must be p
-0001d970: 726f 7669 6465 642e 0a0a 2020 2020 2020  rovided...      
-0001d980: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0001d990: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-0001d9a0: 2020 696e 7465 7270 6f6c 6174 6564 203a    interpolated :
-0001d9b0: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
-0001d9c0: 2020 2020 204e 6577 2064 6174 6173 6574       New dataset
-0001d9d0: 206f 6e20 7468 6520 6e65 7720 636f 6f72   on the new coor
-0001d9e0: 6469 6e61 7465 732e 0a0a 2020 2020 2020  dinates...      
-0001d9f0: 2020 4e6f 7465 730a 2020 2020 2020 2020    Notes.        
-0001da00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7363  -----.        sc
-0001da10: 6970 7920 6973 2072 6571 7569 7265 642e  ipy is required.
-0001da20: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-0001da30: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-0001da40: 2d2d 2d0a 2020 2020 2020 2020 7363 6970  ---.        scip
-0001da50: 792e 696e 7465 7270 6f6c 6174 652e 696e  y.interpolate.in
-0001da60: 7465 7270 3164 0a20 2020 2020 2020 2073  terp1d.        s
-0001da70: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
-0001da80: 2e69 6e74 6572 706e 0a0a 2020 2020 2020  .interpn..      
-0001da90: 2020 4578 616d 706c 6573 0a20 2020 2020    Examples.     
-0001daa0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-0001dab0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
-0001dac0: 4461 7461 7365 7428 0a20 2020 2020 2020  Dataset(.       
-0001dad0: 202e 2e2e 2020 2020 2064 6174 615f 7661   ...     data_va
-0001dae0: 7273 3d7b 0a20 2020 2020 2020 202e 2e2e  rs={.        ...
-0001daf0: 2020 2020 2020 2020 2022 6122 3a20 2822           "a": ("
-0001db00: 7822 2c20 5b35 2c20 372c 2034 5d29 2c0a  x", [5, 7, 4]),.
-0001db10: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0001db20: 2020 2020 2262 223a 2028 0a20 2020 2020      "b": (.     
-0001db30: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
-0001db40: 2020 2028 2278 222c 2022 7922 292c 0a20     ("x", "y"),. 
-0001db50: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-0001db60: 2020 2020 2020 205b 5b31 2c20 342c 2032         [[1, 4, 2
-0001db70: 2c20 395d 2c20 5b32 2c20 372c 2036 2c20  , 9], [2, 7, 6, 
-0001db80: 6e70 2e6e 616e 5d2c 205b 362c 206e 702e  np.nan], [6, np.
-0001db90: 6e61 6e2c 2035 2c20 385d 5d2c 0a20 2020  nan, 5, 8]],.   
-0001dba0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
-0001dbb0: 2029 2c0a 2020 2020 2020 2020 2e2e 2e20   ),.        ... 
-0001dbc0: 2020 2020 7d2c 0a20 2020 2020 2020 202e      },.        .
-0001dbd0: 2e2e 2020 2020 2063 6f6f 7264 733d 7b22  ..     coords={"
-0001dbe0: 7822 3a20 5b30 2c20 312c 2032 5d2c 2022  x": [0, 1, 2], "
-0001dbf0: 7922 3a20 5b31 302c 2031 322c 2031 342c  y": [10, 12, 14,
-0001dc00: 2031 365d 7d2c 0a20 2020 2020 2020 202e   16]},.        .
-0001dc10: 2e2e 2029 0a20 2020 2020 2020 203e 3e3e  .. ).        >>>
-0001dc20: 2064 730a 2020 2020 2020 2020 3c78 6172   ds.        <xar
-0001dc30: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
-0001dc40: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
-0001dc50: 2020 2878 3a20 332c 2079 3a20 3429 0a20    (x: 3, y: 4). 
-0001dc60: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-0001dc70: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
-0001dc80: 7820 2020 2020 2020 2028 7829 2069 6e74  x        (x) int
-0001dc90: 3634 2030 2031 2032 0a20 2020 2020 2020  64 0 1 2.       
-0001dca0: 2020 202a 2079 2020 2020 2020 2020 2879     * y        (y
-0001dcb0: 2920 696e 7436 3420 3130 2031 3220 3134  ) int64 10 12 14
-0001dcc0: 2031 360a 2020 2020 2020 2020 4461 7461   16.        Data
-0001dcd0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-0001dce0: 2020 2020 2020 2020 6120 2020 2020 2020          a       
-0001dcf0: 2028 7829 2069 6e74 3634 2035 2037 2034   (x) int64 5 7 4
-0001dd00: 0a20 2020 2020 2020 2020 2020 2062 2020  .            b  
-0001dd10: 2020 2020 2020 2878 2c20 7929 2066 6c6f        (x, y) flo
-0001dd20: 6174 3634 2031 2e30 2034 2e30 2032 2e30  at64 1.0 4.0 2.0
-0001dd30: 2039 2e30 2032 2e30 2037 2e30 2036 2e30   9.0 2.0 7.0 6.0
-0001dd40: 206e 616e 2036 2e30 206e 616e 2035 2e30   nan 6.0 nan 5.0
-0001dd50: 2038 2e30 0a0a 2020 2020 2020 2020 3144   8.0..        1D
-0001dd60: 2069 6e74 6572 706f 6c61 7469 6f6e 2077   interpolation w
-0001dd70: 6974 6820 7468 6520 6465 6661 756c 7420  ith the default 
-0001dd80: 6d65 7468 6f64 2028 6c69 6e65 6172 293a  method (linear):
-0001dd90: 0a0a 2020 2020 2020 2020 3e3e 3e20 6473  ..        >>> ds
-0001dda0: 2e69 6e74 6572 7028 783d 5b30 2c20 302e  .interp(x=[0, 0.
-0001ddb0: 3735 2c20 312e 3235 2c20 312e 3735 5d29  75, 1.25, 1.75])
-0001ddc0: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
-0001ddd0: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
-0001dde0: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
-0001ddf0: 783a 2034 2c20 793a 2034 290a 2020 2020  x: 4, y: 4).    
-0001de00: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-0001de10: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
-0001de20: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
-0001de30: 3130 2031 3220 3134 2031 360a 2020 2020  10 12 14 16.    
-0001de40: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
-0001de50: 2028 7829 2066 6c6f 6174 3634 2030 2e30   (x) float64 0.0
-0001de60: 2030 2e37 3520 312e 3235 2031 2e37 350a   0.75 1.25 1.75.
-0001de70: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-0001de80: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-0001de90: 2020 2020 6120 2020 2020 2020 2028 7829      a        (x)
-0001dea0: 2066 6c6f 6174 3634 2035 2e30 2036 2e35   float64 5.0 6.5
-0001deb0: 2036 2e32 3520 342e 3735 0a20 2020 2020   6.25 4.75.     
-0001dec0: 2020 2020 2020 2062 2020 2020 2020 2020         b        
-0001ded0: 2878 2c20 7929 2066 6c6f 6174 3634 2031  (x, y) float64 1
-0001dee0: 2e30 2034 2e30 2032 2e30 206e 616e 2031  .0 4.0 2.0 nan 1
-0001def0: 2e37 3520 362e 3235 202e 2e2e 206e 616e  .75 6.25 ... nan
-0001df00: 2035 2e30 206e 616e 2035 2e32 3520 6e61   5.0 nan 5.25 na
-0001df10: 6e0a 0a20 2020 2020 2020 2031 4420 696e  n..        1D in
-0001df20: 7465 7270 6f6c 6174 696f 6e20 7769 7468  terpolation with
-0001df30: 2061 2064 6966 6665 7265 6e74 206d 6574   a different met
-0001df40: 686f 643a 0a0a 2020 2020 2020 2020 3e3e  hod:..        >>
-0001df50: 3e20 6473 2e69 6e74 6572 7028 783d 5b30  > ds.interp(x=[0
-0001df60: 2c20 302e 3735 2c20 312e 3235 2c20 312e  , 0.75, 1.25, 1.
-0001df70: 3735 5d2c 206d 6574 686f 643d 226e 6561  75], method="nea
-0001df80: 7265 7374 2229 0a20 2020 2020 2020 203c  rest").        <
-0001df90: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
-0001dfa0: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-0001dfb0: 6e73 3a20 2028 783a 2034 2c20 793a 2034  ns:  (x: 4, y: 4
-0001dfc0: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
-0001dfd0: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
-0001dfe0: 202a 2079 2020 2020 2020 2020 2879 2920   * y        (y) 
-0001dff0: 696e 7436 3420 3130 2031 3220 3134 2031  int64 10 12 14 1
-0001e000: 360a 2020 2020 2020 2020 2020 2a20 7820  6.          * x 
-0001e010: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
-0001e020: 3634 2030 2e30 2030 2e37 3520 312e 3235  64 0.0 0.75 1.25
-0001e030: 2031 2e37 350a 2020 2020 2020 2020 4461   1.75.        Da
-0001e040: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
-0001e050: 2020 2020 2020 2020 2020 6120 2020 2020            a     
-0001e060: 2020 2028 7829 2066 6c6f 6174 3634 2035     (x) float64 5
-0001e070: 2e30 2037 2e30 2037 2e30 2034 2e30 0a20  .0 7.0 7.0 4.0. 
-0001e080: 2020 2020 2020 2020 2020 2062 2020 2020             b    
-0001e090: 2020 2020 2878 2c20 7929 2066 6c6f 6174      (x, y) float
-0001e0a0: 3634 2031 2e30 2034 2e30 2032 2e30 2039  64 1.0 4.0 2.0 9
-0001e0b0: 2e30 2032 2e30 2037 2e30 202e 2e2e 2036  .0 2.0 7.0 ... 6
-0001e0c0: 2e30 206e 616e 2036 2e30 206e 616e 2035  .0 nan 6.0 nan 5
-0001e0d0: 2e30 2038 2e30 0a0a 2020 2020 2020 2020  .0 8.0..        
-0001e0e0: 3144 2065 7874 7261 706f 6c61 7469 6f6e  1D extrapolation
-0001e0f0: 3a0a 0a20 2020 2020 2020 203e 3e3e 2064  :..        >>> d
-0001e100: 732e 696e 7465 7270 280a 2020 2020 2020  s.interp(.      
-0001e110: 2020 2e2e 2e20 2020 2020 783d 5b31 2c20    ...     x=[1, 
-0001e120: 312e 352c 2032 2e35 2c20 332e 355d 2c0a  1.5, 2.5, 3.5],.
-0001e130: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0001e140: 6d65 7468 6f64 3d22 6c69 6e65 6172 222c  method="linear",
-0001e150: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0001e160: 206b 7761 7267 733d 7b22 6669 6c6c 5f76   kwargs={"fill_v
-0001e170: 616c 7565 223a 2022 6578 7472 6170 6f6c  alue": "extrapol
-0001e180: 6174 6522 7d2c 0a20 2020 2020 2020 202e  ate"},.        .
-0001e190: 2e2e 2029 0a20 2020 2020 2020 203c 7861  .. ).        <xa
-0001e1a0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-0001e1b0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-0001e1c0: 3a20 2028 783a 2034 2c20 793a 2034 290a  :  (x: 4, y: 4).
-0001e1d0: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
-0001e1e0: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
-0001e1f0: 2079 2020 2020 2020 2020 2879 2920 696e   y        (y) in
-0001e200: 7436 3420 3130 2031 3220 3134 2031 360a  t64 10 12 14 16.
-0001e210: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-0001e220: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
-0001e230: 2031 2e30 2031 2e35 2032 2e35 2033 2e35   1.0 1.5 2.5 3.5
-0001e240: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-0001e250: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-0001e260: 2020 2020 2061 2020 2020 2020 2020 2878       a        (x
-0001e270: 2920 666c 6f61 7436 3420 372e 3020 352e  ) float64 7.0 5.
-0001e280: 3520 322e 3520 2d30 2e35 0a20 2020 2020  5 2.5 -0.5.     
-0001e290: 2020 2020 2020 2062 2020 2020 2020 2020         b        
-0001e2a0: 2878 2c20 7929 2066 6c6f 6174 3634 2032  (x, y) float64 2
-0001e2b0: 2e30 2037 2e30 2036 2e30 206e 616e 2034  .0 7.0 6.0 nan 4
-0001e2c0: 2e30 206e 616e 202e 2e2e 2034 2e35 206e  .0 nan ... 4.5 n
-0001e2d0: 616e 2031 322e 3020 6e61 6e20 332e 3520  an 12.0 nan 3.5 
-0001e2e0: 6e61 6e0a 0a20 2020 2020 2020 2032 4420  nan..        2D 
-0001e2f0: 696e 7465 7270 6f6c 6174 696f 6e3a 0a0a  interpolation:..
-0001e300: 2020 2020 2020 2020 3e3e 3e20 6473 2e69          >>> ds.i
-0001e310: 6e74 6572 7028 783d 5b30 2c20 302e 3735  nterp(x=[0, 0.75
-0001e320: 2c20 312e 3235 2c20 312e 3735 5d2c 2079  , 1.25, 1.75], y
-0001e330: 3d5b 3131 2c20 3133 2c20 3135 5d2c 206d  =[11, 13, 15], m
-0001e340: 6574 686f 643d 226c 696e 6561 7222 290a  ethod="linear").
-0001e350: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-0001e360: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-0001e370: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-0001e380: 3a20 342c 2079 3a20 3329 0a20 2020 2020  : 4, y: 3).     
-0001e390: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-0001e3a0: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-0001e3b0: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
-0001e3c0: 2030 2e30 2030 2e37 3520 312e 3235 2031   0.0 0.75 1.25 1
-0001e3d0: 2e37 350a 2020 2020 2020 2020 2020 2a20  .75.          * 
-0001e3e0: 7920 2020 2020 2020 2028 7929 2069 6e74  y        (y) int
-0001e3f0: 3634 2031 3120 3133 2031 350a 2020 2020  64 11 13 15.    
-0001e400: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-0001e410: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001e420: 6120 2020 2020 2020 2028 7829 2066 6c6f  a        (x) flo
-0001e430: 6174 3634 2035 2e30 2036 2e35 2036 2e32  at64 5.0 6.5 6.2
-0001e440: 3520 342e 3735 0a20 2020 2020 2020 2020  5 4.75.         
-0001e450: 2020 2062 2020 2020 2020 2020 2878 2c20     b        (x, 
-0001e460: 7929 2066 6c6f 6174 3634 2032 2e35 2033  y) float64 2.5 3
-0001e470: 2e30 206e 616e 2034 2e30 2035 2e36 3235  .0 nan 4.0 5.625
-0001e480: 206e 616e 206e 616e 206e 616e 206e 616e   nan nan nan nan
-0001e490: 206e 616e 206e 616e 206e 616e 0a20 2020   nan nan nan.   
-0001e4a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001e4b0: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-0001e4c0: 6520 696d 706f 7274 206d 6973 7369 6e67  e import missing
-0001e4d0: 0a0a 2020 2020 2020 2020 6966 206b 7761  ..        if kwa
-0001e4e0: 7267 7320 6973 204e 6f6e 653a 0a20 2020  rgs is None:.   
-0001e4f0: 2020 2020 2020 2020 206b 7761 7267 7320           kwargs 
-0001e500: 3d20 7b7d 0a0a 2020 2020 2020 2020 636f  = {}..        co
-0001e510: 6f72 6473 203d 2065 6974 6865 725f 6469  ords = either_di
-0001e520: 6374 5f6f 725f 6b77 6172 6773 2863 6f6f  ct_or_kwargs(coo
-0001e530: 7264 732c 2063 6f6f 7264 735f 6b77 6172  rds, coords_kwar
-0001e540: 6773 2c20 2269 6e74 6572 7022 290a 2020  gs, "interp").  
-0001e550: 2020 2020 2020 696e 6465 7865 7273 203d        indexers =
-0001e560: 2064 6963 7428 7365 6c66 2e5f 7661 6c69   dict(self._vali
-0001e570: 6461 7465 5f69 6e74 6572 705f 696e 6465  date_interp_inde
-0001e580: 7865 7273 2863 6f6f 7264 7329 290a 0a20  xers(coords)).. 
-0001e590: 2020 2020 2020 2069 6620 636f 6f72 6473         if coords
-0001e5a0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001e5b0: 5468 6973 2061 766f 6964 7320 6272 6f61  This avoids broa
-0001e5c0: 6463 6173 7469 6e67 206f 7665 7220 636f  dcasting over co
-0001e5d0: 6f72 6469 6e61 7465 7320 7468 6174 2061  ordinates that a
-0001e5e0: 7265 2062 6f74 6820 696e 0a20 2020 2020  re both in.     
-0001e5f0: 2020 2020 2020 2023 2074 6865 206f 7269         # the ori
-0001e600: 6769 6e61 6c20 6172 7261 7920 414e 4420  ginal array AND 
-0001e610: 696e 2074 6865 2069 6e64 6578 696e 6720  in the indexing 
-0001e620: 6172 7261 792e 2049 7420 6573 7365 6e74  array. It essent
-0001e630: 6961 6c6c 790a 2020 2020 2020 2020 2020  ially.          
-0001e640: 2020 2320 666f 7263 6573 2069 6e74 6572    # forces inter
-0001e650: 706f 6c61 7469 6f6e 2061 6c6f 6e67 2074  polation along t
-0001e660: 6865 2073 6861 7265 6420 636f 6f72 6469  he shared coordi
-0001e670: 6e61 7465 732e 0a20 2020 2020 2020 2020  nates..         
-0001e680: 2020 2073 6469 6d73 203d 2028 0a20 2020     sdims = (.   
-0001e690: 2020 2020 2020 2020 2020 2020 2073 6574               set
-0001e6a0: 2873 656c 662e 6469 6d73 290a 2020 2020  (self.dims).    
-0001e6b0: 2020 2020 2020 2020 2020 2020 2e69 6e74              .int
-0001e6c0: 6572 7365 6374 696f 6e28 2a5b 7365 7428  ersection(*[set(
-0001e6d0: 6e78 2e64 696d 7329 2066 6f72 206e 7820  nx.dims) for nx 
-0001e6e0: 696e 2069 6e64 6578 6572 732e 7661 6c75  in indexers.valu
-0001e6f0: 6573 2829 5d29 0a20 2020 2020 2020 2020  es()]).         
-0001e700: 2020 2020 2020 202e 6469 6666 6572 656e         .differen
-0001e710: 6365 2863 6f6f 7264 732e 6b65 7973 2829  ce(coords.keys()
-0001e720: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0001e730: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-0001e740: 7865 7273 2e75 7064 6174 6528 7b64 3a20  xers.update({d: 
-0001e750: 7365 6c66 2e76 6172 6961 626c 6573 5b64  self.variables[d
-0001e760: 5d20 666f 7220 6420 696e 2073 6469 6d73  ] for d in sdims
-0001e770: 7d29 0a0a 2020 2020 2020 2020 6f62 6a20  })..        obj 
-0001e780: 3d20 7365 6c66 2069 6620 6173 7375 6d65  = self if assume
-0001e790: 5f73 6f72 7465 6420 656c 7365 2073 656c  _sorted else sel
-0001e7a0: 662e 736f 7274 6279 285b 6b20 666f 7220  f.sortby([k for 
-0001e7b0: 6b20 696e 2063 6f6f 7264 735d 290a 0a20  k in coords]).. 
-0001e7c0: 2020 2020 2020 2064 6566 206d 6179 6265         def maybe
-0001e7d0: 5f76 6172 6961 626c 6528 6f62 6a2c 206b  _variable(obj, k
-0001e7e0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-0001e7f0: 2077 6f72 6b61 726f 756e 6420 746f 2067   workaround to g
-0001e800: 6574 2076 6172 6961 626c 6520 666f 7220  et variable for 
-0001e810: 6469 6d65 6e73 696f 6e20 7769 7468 6f75  dimension withou
-0001e820: 7420 636f 6f72 6469 6e61 7465 2e0a 2020  t coordinate..  
-0001e830: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0001e840: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001e850: 6574 7572 6e20 6f62 6a2e 5f76 6172 6961  eturn obj._varia
-0001e860: 626c 6573 5b6b 5d0a 2020 2020 2020 2020  bles[k].        
-0001e870: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-0001e880: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0001e890: 2020 2020 2072 6574 7572 6e20 6173 5f76       return as_v
-0001e8a0: 6172 6961 626c 6528 286b 2c20 7261 6e67  ariable((k, rang
-0001e8b0: 6528 6f62 6a2e 6469 6d73 5b6b 5d29 2929  e(obj.dims[k])))
-0001e8c0: 0a0a 2020 2020 2020 2020 6465 6620 5f76  ..        def _v
-0001e8d0: 616c 6964 6174 655f 696e 7465 7270 5f69  alidate_interp_i
-0001e8e0: 6e64 6578 6572 2878 2c20 6e65 775f 7829  ndexer(x, new_x)
-0001e8f0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001e900: 496e 2074 6865 2063 6173 6520 6f66 2064  In the case of d
-0001e910: 6174 6574 696d 6573 2c20 7468 6520 7265  atetimes, the re
-0001e920: 7374 7269 6374 696f 6e73 2070 6c61 6365  strictions place
-0001e930: 6420 6f6e 2069 6e64 6578 6572 730a 2020  d on indexers.  
-0001e940: 2020 2020 2020 2020 2020 2320 7573 6564            # used
-0001e950: 2077 6974 6820 696e 7465 7270 2061 7265   with interp are
-0001e960: 2073 7472 6f6e 6765 7220 7468 616e 2074   stronger than t
-0001e970: 686f 7365 2077 6869 6368 2061 7265 2070  hose which are p
-0001e980: 6c61 6365 6420 6f6e 0a20 2020 2020 2020  laced on.       
-0001e990: 2020 2020 2023 2069 7365 6c2c 2073 6f20       # isel, so 
-0001e9a0: 7765 206e 6565 6420 616e 2061 6464 6974  we need an addit
-0001e9b0: 696f 6e61 6c20 6368 6563 6b20 6166 7465  ional check afte
-0001e9c0: 7220 5f76 616c 6964 6174 655f 696e 6465  r _validate_inde
-0001e9d0: 7865 7273 2e0a 2020 2020 2020 2020 2020  xers..          
-0001e9e0: 2020 6966 205f 636f 6e74 6169 6e73 5f64    if _contains_d
-0001e9f0: 6174 6574 696d 655f 6c69 6b65 5f6f 626a  atetime_like_obj
-0001ea00: 6563 7473 280a 2020 2020 2020 2020 2020  ects(.          
-0001ea10: 2020 2020 2020 780a 2020 2020 2020 2020        x.        
-0001ea20: 2020 2020 2920 616e 6420 6e6f 7420 5f63      ) and not _c
-0001ea30: 6f6e 7461 696e 735f 6461 7465 7469 6d65  ontains_datetime
-0001ea40: 5f6c 696b 655f 6f62 6a65 6374 7328 6e65  _like_objects(ne
-0001ea50: 775f 7829 3a0a 2020 2020 2020 2020 2020  w_x):.          
-0001ea60: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-0001ea70: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0001ea80: 2020 2020 2020 2020 2020 2022 5768 656e             "When
-0001ea90: 2069 6e74 6572 706f 6c61 7469 6e67 206f   interpolating o
-0001eaa0: 7665 7220 6120 6461 7465 7469 6d65 2d6c  ver a datetime-l
-0001eab0: 696b 6520 220a 2020 2020 2020 2020 2020  ike ".          
-0001eac0: 2020 2020 2020 2020 2020 2263 6f6f 7264            "coord
-0001ead0: 696e 6174 652c 2074 6865 2063 6f6f 7264  inate, the coord
-0001eae0: 696e 6174 6573 2074 6f20 220a 2020 2020  inates to ".    
-0001eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb00: 2269 6e74 6572 706f 6c61 7465 2074 6f20  "interpolate to 
-0001eb10: 6d75 7374 2062 6520 6569 7468 6572 2064  must be either d
-0001eb20: 6174 6574 696d 6520 220a 2020 2020 2020  atetime ".      
-0001eb30: 2020 2020 2020 2020 2020 2020 2020 2273                "s
-0001eb40: 7472 696e 6773 206f 7220 6461 7465 7469  trings or dateti
-0001eb50: 6d65 732e 2022 0a20 2020 2020 2020 2020  mes. ".         
-0001eb60: 2020 2020 2020 2020 2020 2022 496e 7374             "Inst
-0001eb70: 6561 6420 676f 745c 6e7b 7d22 2e66 6f72  ead got\n{}".for
-0001eb80: 6d61 7428 6e65 775f 7829 0a20 2020 2020  mat(new_x).     
-0001eb90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001eba0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001ebb0: 782c 206e 6577 5f78 0a0a 2020 2020 2020  x, new_x..      
-0001ebc0: 2020 7661 6c69 6461 7465 645f 696e 6465    validated_inde
-0001ebd0: 7865 7273 203d 207b 0a20 2020 2020 2020  xers = {.       
-0001ebe0: 2020 2020 206b 3a20 5f76 616c 6964 6174       k: _validat
-0001ebf0: 655f 696e 7465 7270 5f69 6e64 6578 6572  e_interp_indexer
-0001ec00: 286d 6179 6265 5f76 6172 6961 626c 6528  (maybe_variable(
-0001ec10: 6f62 6a2c 206b 292c 2076 290a 2020 2020  obj, k), v).    
-0001ec20: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-0001ec30: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
-0001ec40: 6d73 2829 0a20 2020 2020 2020 207d 0a0a  ms().        }..
-0001ec50: 2020 2020 2020 2020 2320 6f70 7469 6d69          # optimi
-0001ec60: 7a61 7469 6f6e 3a20 7375 6273 6574 2074  zation: subset t
-0001ec70: 6f20 636f 6f72 6469 6e61 7465 2072 616e  o coordinate ran
-0001ec80: 6765 206f 6620 7468 6520 7461 7267 6574  ge of the target
-0001ec90: 2069 6e64 6578 0a20 2020 2020 2020 2069   index.        i
-0001eca0: 6620 6d65 7468 6f64 2069 6e20 5b22 6c69  f method in ["li
-0001ecb0: 6e65 6172 222c 2022 6e65 6172 6573 7422  near", "nearest"
-0001ecc0: 5d3a 0a20 2020 2020 2020 2020 2020 2066  ]:.            f
-0001ecd0: 6f72 206b 2c20 7620 696e 2076 616c 6964  or k, v in valid
-0001ece0: 6174 6564 5f69 6e64 6578 6572 732e 6974  ated_indexers.it
-0001ecf0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-0001ed00: 2020 2020 2020 206f 626a 2c20 6e65 7769         obj, newi
-0001ed10: 6478 203d 206d 6973 7369 6e67 2e5f 6c6f  dx = missing._lo
-0001ed20: 6361 6c69 7a65 286f 626a 2c20 7b6b 3a20  calize(obj, {k: 
-0001ed30: 767d 290a 2020 2020 2020 2020 2020 2020  v}).            
-0001ed40: 2020 2020 7661 6c69 6461 7465 645f 696e      validated_in
-0001ed50: 6465 7865 7273 5b6b 5d20 3d20 6e65 7769  dexers[k] = newi
-0001ed60: 6478 5b6b 5d0a 0a20 2020 2020 2020 2023  dx[k]..        #
-0001ed70: 206f 7074 696d 697a 6174 696f 6e3a 2063   optimization: c
-0001ed80: 7265 6174 6520 6461 736b 2063 6f6f 7264  reate dask coord
-0001ed90: 696e 6174 6520 6172 7261 7973 206f 6e63  inate arrays onc
-0001eda0: 6520 7065 7220 4461 7461 7365 740a 2020  e per Dataset.  
-0001edb0: 2020 2020 2020 2320 7261 7468 6572 2074        # rather t
-0001edc0: 6861 6e20 6f6e 6365 2070 6572 2056 6172  han once per Var
-0001edd0: 6961 626c 6520 7768 656e 2064 6173 6b2e  iable when dask.
-0001ede0: 6172 7261 792e 756e 6966 795f 6368 756e  array.unify_chun
-0001edf0: 6b73 2069 7320 6361 6c6c 6564 206c 6174  ks is called lat
-0001ee00: 6572 0a20 2020 2020 2020 2023 2047 4834  er.        # GH4
-0001ee10: 3733 390a 2020 2020 2020 2020 6966 206f  739.        if o
-0001ee20: 626a 2e5f 5f64 6173 6b5f 6772 6170 685f  bj.__dask_graph_
-0001ee30: 5f28 293a 0a20 2020 2020 2020 2020 2020  _():.           
-0001ee40: 2064 6173 6b5f 696e 6465 7865 7273 203d   dask_indexers =
-0001ee50: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0001ee60: 2020 206b 3a20 2869 6e64 6578 2e74 6f5f     k: (index.to_
-0001ee70: 6261 7365 5f76 6172 6961 626c 6528 292e  base_variable().
-0001ee80: 6368 756e 6b28 292c 2064 6573 742e 746f  chunk(), dest.to
-0001ee90: 5f62 6173 655f 7661 7269 6162 6c65 2829  _base_variable()
-0001eea0: 2e63 6875 6e6b 2829 290a 2020 2020 2020  .chunk()).      
-0001eeb0: 2020 2020 2020 2020 2020 666f 7220 6b2c            for k,
-0001eec0: 2028 696e 6465 782c 2064 6573 7429 2069   (index, dest) i
-0001eed0: 6e20 7661 6c69 6461 7465 645f 696e 6465  n validated_inde
-0001eee0: 7865 7273 2e69 7465 6d73 2829 0a20 2020  xers.items().   
-0001eef0: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-0001ef00: 2020 2020 7661 7269 6162 6c65 733a 2064      variables: d
-0001ef10: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
-0001ef20: 7269 6162 6c65 5d20 3d20 7b7d 0a20 2020  riable] = {}.   
-0001ef30: 2020 2020 2072 6569 6e64 6578 3a20 626f       reindex: bo
-0001ef40: 6f6c 203d 2046 616c 7365 0a20 2020 2020  ol = False.     
-0001ef50: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
-0001ef60: 2069 6e20 6f62 6a2e 5f76 6172 6961 626c   in obj._variabl
-0001ef70: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-0001ef80: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-0001ef90: 696e 2069 6e64 6578 6572 733a 0a20 2020  in indexers:.   
-0001efa0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001efb0: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
-0001efc0: 2020 2069 6620 6973 5f64 7563 6b5f 6461     if is_duck_da
-0001efd0: 736b 5f61 7272 6179 2876 6172 2e64 6174  sk_array(var.dat
-0001efe0: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
-0001eff0: 2020 2020 7573 655f 696e 6465 7865 7273      use_indexers
-0001f000: 203d 2064 6173 6b5f 696e 6465 7865 7273   = dask_indexers
-0001f010: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0001f020: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001f030: 2020 2075 7365 5f69 6e64 6578 6572 7320     use_indexers 
-0001f040: 3d20 7661 6c69 6461 7465 645f 696e 6465  = validated_inde
-0001f050: 7865 7273 0a0a 2020 2020 2020 2020 2020  xers..          
-0001f060: 2020 6474 7970 655f 6b69 6e64 203d 2076    dtype_kind = v
-0001f070: 6172 2e64 7479 7065 2e6b 696e 640a 2020  ar.dtype.kind.  
-0001f080: 2020 2020 2020 2020 2020 6966 2064 7479            if dty
-0001f090: 7065 5f6b 696e 6420 696e 2022 7569 6663  pe_kind in "uifc
-0001f0a0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0001f0b0: 2020 2023 2046 6f72 206e 6f72 6d61 6c20     # For normal 
-0001f0c0: 6e75 6d62 6572 2074 7970 6573 2064 6f20  number types do 
-0001f0d0: 7468 6520 696e 7465 7270 6f6c 6174 696f  the interpolatio
-0001f0e0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0001f0f0: 2020 2076 6172 5f69 6e64 6578 6572 7320     var_indexers 
-0001f100: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-0001f110: 2069 6e20 7573 655f 696e 6465 7865 7273   in use_indexers
-0001f120: 2e69 7465 6d73 2829 2069 6620 6b20 696e  .items() if k in
-0001f130: 2076 6172 2e64 696d 737d 0a20 2020 2020   var.dims}.     
-0001f140: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0001f150: 626c 6573 5b6e 616d 655d 203d 206d 6973  bles[name] = mis
-0001f160: 7369 6e67 2e69 6e74 6572 7028 7661 722c  sing.interp(var,
-0001f170: 2076 6172 5f69 6e64 6578 6572 732c 206d   var_indexers, m
-0001f180: 6574 686f 642c 202a 2a6b 7761 7267 7329  ethod, **kwargs)
-0001f190: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0001f1a0: 6620 6474 7970 655f 6b69 6e64 2069 6e20  f dtype_kind in 
-0001f1b0: 224f 6255 2220 616e 6420 2875 7365 5f69  "ObU" and (use_i
-0001f1c0: 6e64 6578 6572 732e 6b65 7973 2829 2026  ndexers.keys() &
-0001f1d0: 2076 6172 2e64 696d 7329 3a0a 2020 2020   var.dims):.    
-0001f1e0: 2020 2020 2020 2020 2020 2020 2320 466f              # Fo
-0001f1f0: 7220 7479 7065 7320 7468 6174 2077 6520  r types that we 
-0001f200: 646f 206e 6f74 2075 6e64 6572 7374 616e  do not understan
-0001f210: 6420 646f 2073 7465 7077 6973 650a 2020  d do stepwise.  
-0001f220: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001f230: 696e 7465 7270 6f6c 6174 696f 6e20 746f  interpolation to
-0001f240: 2061 766f 6964 206d 6f64 6966 7969 6e67   avoid modifying
-0001f250: 2074 6865 2065 6c65 6d65 6e74 732e 0a20   the elements.. 
-0001f260: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001f270: 2072 6569 6e64 6578 2074 6865 2076 6172   reindex the var
-0001f280: 6961 626c 6520 696e 7374 6561 6420 6265  iable instead be
-0001f290: 6361 7573 6520 6974 2073 7570 706f 7274  cause it support
-0001f2a0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0001f2b0: 2020 2320 626f 6f6c 6561 6e73 2061 6e64    # booleans and
-0001f2c0: 206f 626a 6563 7473 2061 6e64 2072 6574   objects and ret
-0001f2d0: 6169 6e73 2074 6865 2064 7479 7065 2062  ains the dtype b
-0001f2e0: 7574 2069 6e73 6964 650a 2020 2020 2020  ut inside.      
-0001f2f0: 2020 2020 2020 2020 2020 2320 7468 6973            # this
-0001f300: 206c 6f6f 7020 7468 6572 6520 6d69 6768   loop there migh
-0001f310: 7420 6265 2073 6f6d 6520 6475 706c 6963  t be some duplic
-0001f320: 6174 6520 636f 6465 2074 6861 7420 736c  ate code that sl
-0001f330: 6f77 7320 6974 0a20 2020 2020 2020 2020  ows it.         
-0001f340: 2020 2020 2020 2023 2064 6f77 6e2c 2074         # down, t
-0001f350: 6865 7265 666f 7265 2063 6f6c 6c65 6374  herefore collect
-0001f360: 2074 6865 7365 2073 6967 6e61 6c73 2061   these signals a
-0001f370: 6e64 2072 756e 2069 7420 6c61 7465 723a  nd run it later:
-0001f380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f390: 2072 6569 6e64 6578 203d 2054 7275 650a   reindex = True.
-0001f3a0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0001f3b0: 2061 6c6c 2864 206e 6f74 2069 6e20 696e   all(d not in in
-0001f3c0: 6465 7865 7273 2066 6f72 2064 2069 6e20  dexers for d in 
-0001f3d0: 7661 722e 6469 6d73 293a 0a20 2020 2020  var.dims):.     
-0001f3e0: 2020 2020 2020 2020 2020 2023 2046 6f72             # For
-0001f3f0: 2061 6e79 7468 696e 6720 656c 7365 2077   anything else w
-0001f400: 6520 6361 6e20 6f6e 6c79 206b 6565 7020  e can only keep 
-0001f410: 7661 7269 6162 6c65 7320 6966 2074 6865  variables if the
-0001f420: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-0001f430: 2020 2320 6172 6520 6e6f 7420 6465 7065    # are not depe
-0001f440: 6e64 656e 7420 6f6e 2061 6e79 2063 6f6f  ndent on any coo
-0001f450: 7264 7320 7468 6174 2061 7265 2062 6569  rds that are bei
-0001f460: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
-0001f470: 2020 2023 2069 6e74 6572 706f 6c61 7465     # interpolate
-0001f480: 6420 616c 6f6e 673a 0a20 2020 2020 2020  d along:.       
-0001f490: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0001f4a0: 6573 5b6e 616d 655d 203d 2076 6172 0a0a  es[name] = var..
-0001f4b0: 2020 2020 2020 2020 6966 2072 6569 6e64          if reind
-0001f4c0: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
-0001f4d0: 7265 696e 6465 785f 696e 6465 7865 7273  reindex_indexers
-0001f4e0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-0001f4f0: 2020 2020 206b 3a20 7620 666f 7220 6b2c       k: v for k,
-0001f500: 2028 5f2c 2076 2920 696e 2076 616c 6964   (_, v) in valid
-0001f510: 6174 6564 5f69 6e64 6578 6572 732e 6974  ated_indexers.it
-0001f520: 656d 7328 2920 6966 2076 2e64 696d 7320  ems() if v.dims 
-0001f530: 3d3d 2028 6b2c 290a 2020 2020 2020 2020  == (k,).        
-0001f540: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-0001f550: 2020 7265 696e 6465 7865 6420 3d20 616c    reindexed = al
-0001f560: 6967 6e6d 656e 742e 7265 696e 6465 7828  ignment.reindex(
-0001f570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f580: 206f 626a 2c0a 2020 2020 2020 2020 2020   obj,.          
-0001f590: 2020 2020 2020 696e 6465 7865 7273 3d72        indexers=r
-0001f5a0: 6569 6e64 6578 5f69 6e64 6578 6572 732c  eindex_indexers,
-0001f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f5c0: 206d 6574 686f 643d 6d65 7468 6f64 5f6e   method=method_n
-0001f5d0: 6f6e 5f6e 756d 6572 6963 2c0a 2020 2020  on_numeric,.    
-0001f5e0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
-0001f5f0: 7564 655f 7661 7273 3d76 6172 6961 626c  ude_vars=variabl
-0001f600: 6573 2e6b 6579 7328 292c 0a20 2020 2020  es.keys(),.     
-0001f610: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001f620: 2020 2020 2069 6e64 6578 6573 203d 2064       indexes = d
-0001f630: 6963 7428 7265 696e 6465 7865 642e 5f69  ict(reindexed._i
-0001f640: 6e64 6578 6573 290a 2020 2020 2020 2020  ndexes).        
-0001f650: 2020 2020 7661 7269 6162 6c65 732e 7570      variables.up
-0001f660: 6461 7465 2872 6569 6e64 6578 6564 2e76  date(reindexed.v
-0001f670: 6172 6961 626c 6573 290a 2020 2020 2020  ariables).      
-0001f680: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001f690: 2020 2020 2320 4765 7420 7468 6520 696e      # Get the in
-0001f6a0: 6465 7865 7320 7468 6174 2061 7265 206e  dexes that are n
-0001f6b0: 6f74 2062 6569 6e67 2069 6e74 6572 706f  ot being interpo
-0001f6c0: 6c61 7465 6420 616c 6f6e 670a 2020 2020  lated along.    
-0001f6d0: 2020 2020 2020 2020 696e 6465 7865 7320          indexes 
-0001f6e0: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-0001f6f0: 2069 6e20 6f62 6a2e 5f69 6e64 6578 6573   in obj._indexes
-0001f700: 2e69 7465 6d73 2829 2069 6620 6b20 6e6f  .items() if k no
-0001f710: 7420 696e 2069 6e64 6578 6572 737d 0a0a  t in indexers}..
-0001f720: 2020 2020 2020 2020 2320 4765 7420 7468          # Get th
-0001f730: 6520 636f 6f72 6473 2074 6861 7420 616c  e coords that al
-0001f740: 736f 2065 7869 7374 2069 6e20 7468 6520  so exist in the 
-0001f750: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-0001f760: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
-0001f770: 206f 626a 2e5f 636f 6f72 645f 6e61 6d65   obj._coord_name
-0001f780: 7320 2620 7661 7269 6162 6c65 732e 6b65  s & variables.ke
-0001f790: 7973 2829 0a20 2020 2020 2020 2073 656c  ys().        sel
-0001f7a0: 6563 7465 6420 3d20 7365 6c66 2e5f 7265  ected = self._re
-0001f7b0: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
-0001f7c0: 696d 7328 0a20 2020 2020 2020 2020 2020  ims(.           
-0001f7d0: 2076 6172 6961 626c 6573 2e63 6f70 7928   variables.copy(
-0001f7e0: 292c 2063 6f6f 7264 5f6e 616d 6573 2c20  ), coord_names, 
-0001f7f0: 696e 6465 7865 733d 696e 6465 7865 730a  indexes=indexes.
-0001f800: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0001f810: 2020 2023 2041 7474 6163 6820 696e 6465     # Attach inde
-0001f820: 7865 7220 6173 2063 6f6f 7264 696e 6174  xer as coordinat
-0001f830: 650a 2020 2020 2020 2020 666f 7220 6b2c  e.        for k,
-0001f840: 2076 2069 6e20 696e 6465 7865 7273 2e69   v in indexers.i
-0001f850: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0001f860: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
-0001f870: 7461 6e63 6528 762c 2056 6172 6961 626c  tance(v, Variabl
-0001f880: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-0001f890: 6620 762e 6469 6d73 203d 3d20 286b 2c29  f v.dims == (k,)
-0001f8a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001f8b0: 2020 696e 6465 7820 3d20 5061 6e64 6173    index = Pandas
-0001f8c0: 496e 6465 7828 762c 206b 2c20 636f 6f72  Index(v, k, coor
-0001f8d0: 645f 6474 7970 653d 762e 6474 7970 6529  d_dtype=v.dtype)
-0001f8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f8f0: 2069 6e64 6578 5f76 6172 7320 3d20 696e   index_vars = in
-0001f900: 6465 782e 6372 6561 7465 5f76 6172 6961  dex.create_varia
-0001f910: 626c 6573 287b 6b3a 2076 7d29 0a20 2020  bles({k: v}).   
-0001f920: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-0001f930: 6578 6573 5b6b 5d20 3d20 696e 6465 780a  exes[k] = index.
-0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f950: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
-0001f960: 2869 6e64 6578 5f76 6172 7329 0a20 2020  (index_vars).   
-0001f970: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001f980: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001f990: 6172 6961 626c 6573 5b6b 5d20 3d20 760a  ariables[k] = v.
-0001f9a0: 0a20 2020 2020 2020 2023 2045 7874 7261  .        # Extra
-0001f9b0: 6374 2063 6f6f 7264 696e 6174 6573 2066  ct coordinates f
-0001f9c0: 726f 6d20 696e 6465 7865 7273 0a20 2020  rom indexers.   
-0001f9d0: 2020 2020 2063 6f6f 7264 5f76 6172 732c       coord_vars,
-0001f9e0: 206e 6577 5f69 6e64 6578 6573 203d 2073   new_indexes = s
-0001f9f0: 656c 6563 7465 642e 5f67 6574 5f69 6e64  elected._get_ind
-0001fa00: 6578 6572 735f 636f 6f72 6473 5f61 6e64  exers_coords_and
-0001fa10: 5f69 6e64 6578 6573 2863 6f6f 7264 7329  _indexes(coords)
-0001fa20: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-0001fa30: 6573 2e75 7064 6174 6528 636f 6f72 645f  es.update(coord_
-0001fa40: 7661 7273 290a 2020 2020 2020 2020 696e  vars).        in
-0001fa50: 6465 7865 732e 7570 6461 7465 286e 6577  dexes.update(new
-0001fa60: 5f69 6e64 6578 6573 290a 0a20 2020 2020  _indexes)..     
-0001fa70: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
-0001fa80: 206f 626a 2e5f 636f 6f72 645f 6e61 6d65   obj._coord_name
-0001fa90: 7320 2620 7661 7269 6162 6c65 732e 6b65  s & variables.ke
-0001faa0: 7973 2829 207c 2063 6f6f 7264 5f76 6172  ys() | coord_var
-0001fab0: 732e 6b65 7973 2829 0a20 2020 2020 2020  s.keys().       
-0001fac0: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-0001fad0: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
-0001fae0: 696d 7328 7661 7269 6162 6c65 732c 2063  ims(variables, c
-0001faf0: 6f6f 7264 5f6e 616d 6573 2c20 696e 6465  oord_names, inde
-0001fb00: 7865 733d 696e 6465 7865 7329 0a0a 2020  xes=indexes)..  
-0001fb10: 2020 6465 6620 696e 7465 7270 5f6c 696b    def interp_lik
-0001fb20: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0001fb30: 0a20 2020 2020 2020 206f 7468 6572 3a20  .        other: 
-0001fb40: 4461 7461 7365 7420 7c20 4461 7461 4172  Dataset | DataAr
-0001fb50: 7261 792c 0a20 2020 2020 2020 206d 6574  ray,.        met
-0001fb60: 686f 643a 2049 6e74 6572 704f 7074 696f  hod: InterpOptio
-0001fb70: 6e73 203d 2022 6c69 6e65 6172 222c 0a20  ns = "linear",. 
-0001fb80: 2020 2020 2020 2061 7373 756d 655f 736f         assume_so
-0001fb90: 7274 6564 3a20 626f 6f6c 203d 2046 616c  rted: bool = Fal
-0001fba0: 7365 2c0a 2020 2020 2020 2020 6b77 6172  se,.        kwar
-0001fbb0: 6773 3a20 4d61 7070 696e 675b 7374 722c  gs: Mapping[str,
-0001fbc0: 2041 6e79 5d20 7c20 4e6f 6e65 203d 204e   Any] | None = N
-0001fbd0: 6f6e 652c 0a20 2020 2020 2020 206d 6574  one,.        met
-0001fbe0: 686f 645f 6e6f 6e5f 6e75 6d65 7269 633a  hod_non_numeric:
-0001fbf0: 2073 7472 203d 2022 6e65 6172 6573 7422   str = "nearest"
-0001fc00: 2c0a 2020 2020 2920 2d3e 2044 6174 6173  ,.    ) -> Datas
-0001fc10: 6574 3a0a 2020 2020 2020 2020 2222 2249  et:.        """I
-0001fc20: 6e74 6572 706f 6c61 7465 2074 6869 7320  nterpolate this 
-0001fc30: 6f62 6a65 6374 206f 6e74 6f20 7468 6520  object onto the 
-0001fc40: 636f 6f72 6469 6e61 7465 7320 6f66 2061  coordinates of a
-0001fc50: 6e6f 7468 6572 206f 626a 6563 742c 0a20  nother object,. 
-0001fc60: 2020 2020 2020 2066 696c 6c69 6e67 2074         filling t
-0001fc70: 6865 206f 7574 206f 6620 7261 6e67 6520  he out of range 
-0001fc80: 7661 6c75 6573 2077 6974 6820 4e61 4e2e  values with NaN.
-0001fc90: 0a0a 2020 2020 2020 2020 4966 2069 6e74  ..        If int
-0001fca0: 6572 706f 6c61 7469 6e67 2061 6c6f 6e67  erpolating along
-0001fcb0: 2061 2073 696e 676c 6520 6578 6973 7469   a single existi
-0001fcc0: 6e67 2064 696d 656e 7369 6f6e 2c0a 2020  ng dimension,.  
-0001fcd0: 2020 2020 2020 3a70 793a 636c 6173 733a        :py:class:
-0001fce0: 6073 6369 7079 2e69 6e74 6572 706f 6c61  `scipy.interpola
-0001fcf0: 7465 2e69 6e74 6572 7031 6460 2069 7320  te.interp1d` is 
-0001fd00: 6361 6c6c 6564 2e20 5768 656e 2069 6e74  called. When int
-0001fd10: 6572 706f 6c61 7469 6e67 0a20 2020 2020  erpolating.     
-0001fd20: 2020 2061 6c6f 6e67 206d 756c 7469 706c     along multipl
-0001fd30: 6520 6578 6973 7469 6e67 2064 696d 656e  e existing dimen
-0001fd40: 7369 6f6e 732c 2061 6e20 6174 7465 6d70  sions, an attemp
-0001fd50: 7420 6973 206d 6164 6520 746f 2064 6563  t is made to dec
-0001fd60: 6f6d 706f 7365 2074 6865 0a20 2020 2020  ompose the.     
-0001fd70: 2020 2069 6e74 6572 706f 6c61 7469 6f6e     interpolation
-0001fd80: 2069 6e74 6f20 6d75 6c74 6970 6c65 2031   into multiple 1
-0001fd90: 2d64 696d 656e 7369 6f6e 616c 2069 6e74  -dimensional int
-0001fda0: 6572 706f 6c61 7469 6f6e 732e 2049 6620  erpolations. If 
-0001fdb0: 7468 6973 2069 730a 2020 2020 2020 2020  this is.        
-0001fdc0: 706f 7373 6962 6c65 2c20 3a70 793a 636c  possible, :py:cl
-0001fdd0: 6173 733a 6073 6369 7079 2e69 6e74 6572  ass:`scipy.inter
-0001fde0: 706f 6c61 7465 2e69 6e74 6572 7031 6460  polate.interp1d`
-0001fdf0: 2069 7320 6361 6c6c 6564 2e20 4f74 6865   is called. Othe
-0001fe00: 7277 6973 652c 0a20 2020 2020 2020 203a  rwise,.        :
-0001fe10: 7079 3a66 756e 633a 6073 6369 7079 2e69  py:func:`scipy.i
-0001fe20: 6e74 6572 706f 6c61 7465 2e69 6e74 6572  nterpolate.inter
-0001fe30: 706e 6020 6973 2063 616c 6c65 642e 0a0a  pn` is called...
-0001fe40: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-0001fe50: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-0001fe60: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6f74  -----.        ot
-0001fe70: 6865 7220 3a20 4461 7461 7365 7420 6f72  her : Dataset or
-0001fe80: 2044 6174 6141 7272 6179 0a20 2020 2020   DataArray.     
-0001fe90: 2020 2020 2020 204f 626a 6563 7420 7769         Object wi
-0001fea0: 7468 2061 6e20 2769 6e64 6578 6573 2720  th an 'indexes' 
-0001feb0: 6174 7472 6962 7574 6520 6769 7669 6e67  attribute giving
-0001fec0: 2061 206d 6170 7069 6e67 2066 726f 6d20   a mapping from 
-0001fed0: 6469 6d65 6e73 696f 6e0a 2020 2020 2020  dimension.      
-0001fee0: 2020 2020 2020 6e61 6d65 7320 746f 2061        names to a
-0001fef0: 6e20 3164 2061 7272 6179 2d6c 696b 652c  n 1d array-like,
-0001ff00: 2077 6869 6368 2070 726f 7669 6465 7320   which provides 
-0001ff10: 636f 6f72 6469 6e61 7465 7320 7570 6f6e  coordinates upon
-0001ff20: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
-0001ff30: 6368 2074 6f20 696e 6465 7820 7468 6520  ch to index the 
-0001ff40: 7661 7269 6162 6c65 7320 696e 2074 6869  variables in thi
-0001ff50: 7320 6461 7461 7365 742e 204d 6973 7369  s dataset. Missi
-0001ff60: 6e67 2076 616c 7565 7320 6172 6520 736b  ng values are sk
-0001ff70: 6970 7065 642e 0a20 2020 2020 2020 206d  ipped..        m
-0001ff80: 6574 686f 6420 3a20 7b22 6c69 6e65 6172  ethod : {"linear
-0001ff90: 222c 2022 6e65 6172 6573 7422 2c20 227a  ", "nearest", "z
-0001ffa0: 6572 6f22 2c20 2273 6c69 6e65 6172 222c  ero", "slinear",
-0001ffb0: 2022 7175 6164 7261 7469 6322 2c20 2263   "quadratic", "c
-0001ffc0: 7562 6963 222c 2022 706f 6c79 6e6f 6d69  ubic", "polynomi
-0001ffd0: 616c 222c 205c 0a20 2020 2020 2020 2020  al", \.         
-0001ffe0: 2020 2022 6261 7279 6365 6e74 7269 6322     "barycentric"
-0001fff0: 2c20 226b 726f 6722 2c20 2270 6368 6970  , "krog", "pchip
-00020000: 222c 2022 7370 6c69 6e65 222c 2022 616b  ", "spline", "ak
-00020010: 696d 6122 7d2c 2064 6566 6175 6c74 3a20  ima"}, default: 
-00020020: 226c 696e 6561 7222 0a20 2020 2020 2020  "linear".       
-00020030: 2020 2020 2053 7472 696e 6720 696e 6469       String indi
-00020040: 6361 7469 6e67 2077 6869 6368 206d 6574  cating which met
-00020050: 686f 6420 746f 2075 7365 2066 6f72 2069  hod to use for i
-00020060: 6e74 6572 706f 6c61 7469 6f6e 3a0a 0a20  nterpolation:.. 
-00020070: 2020 2020 2020 2020 2020 202d 2027 6c69             - 'li
-00020080: 6e65 6172 273a 206c 696e 6561 7220 696e  near': linear in
-00020090: 7465 7270 6f6c 6174 696f 6e2e 2041 6464  terpolation. Add
-000200a0: 6974 696f 6e61 6c20 6b65 7977 6f72 640a  itional keyword.
-000200b0: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-000200c0: 6775 6d65 6e74 7320 6172 6520 7061 7373  guments are pass
-000200d0: 6564 2074 6f20 3a70 793a 6675 6e63 3a60  ed to :py:func:`
-000200e0: 6e75 6d70 792e 696e 7465 7270 600a 2020  numpy.interp`.  
-000200f0: 2020 2020 2020 2020 2020 2d20 276e 6561            - 'nea
-00020100: 7265 7374 272c 2027 7a65 726f 272c 2027  rest', 'zero', '
-00020110: 736c 696e 6561 7227 2c20 2771 7561 6472  slinear', 'quadr
-00020120: 6174 6963 272c 2027 6375 6269 6327 2c20  atic', 'cubic', 
-00020130: 2770 6f6c 796e 6f6d 6961 6c27 3a0a 2020  'polynomial':.  
-00020140: 2020 2020 2020 2020 2020 2020 6172 6520              are 
-00020150: 7061 7373 6564 2074 6f20 3a70 793a 6675  passed to :py:fu
-00020160: 6e63 3a60 7363 6970 792e 696e 7465 7270  nc:`scipy.interp
-00020170: 6f6c 6174 652e 696e 7465 7270 3164 602e  olate.interp1d`.
-00020180: 2049 660a 2020 2020 2020 2020 2020 2020   If.            
-00020190: 2020 6060 6d65 7468 6f64 3d27 706f 6c79    ``method='poly
-000201a0: 6e6f 6d69 616c 2760 602c 2074 6865 2060  nomial'``, the `
-000201b0: 606f 7264 6572 6060 206b 6579 776f 7264  `order`` keyword
-000201c0: 2061 7267 756d 656e 7420 6d75 7374 2061   argument must a
-000201d0: 6c73 6f20 6265 0a20 2020 2020 2020 2020  lso be.         
-000201e0: 2020 2020 2070 726f 7669 6465 642e 0a20       provided.. 
-000201f0: 2020 2020 2020 2020 2020 202d 2027 6261             - 'ba
-00020200: 7279 6365 6e74 7269 6327 2c20 276b 726f  rycentric', 'kro
-00020210: 6727 2c20 2770 6368 6970 272c 2027 7370  g', 'pchip', 'sp
-00020220: 6c69 6e65 272c 2027 616b 696d 6127 3a20  line', 'akima': 
-00020230: 7573 6520 7468 6569 720a 2020 2020 2020  use their.      
-00020240: 2020 2020 2020 2020 7265 7370 6563 7469          respecti
-00020250: 7665 203a 7079 3a63 6c61 7373 3a60 7363  ve :py:class:`sc
-00020260: 6970 792e 696e 7465 7270 6f6c 6174 6560  ipy.interpolate`
-00020270: 2063 6c61 7373 6573 2e0a 0a20 2020 2020   classes...     
-00020280: 2020 2061 7373 756d 655f 736f 7274 6564     assume_sorted
-00020290: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-000202a0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
-000202b0: 2020 2020 4966 2046 616c 7365 2c20 7661      If False, va
-000202c0: 6c75 6573 206f 6620 636f 6f72 6469 6e61  lues of coordina
-000202d0: 7465 7320 7468 6174 2061 7265 2069 6e74  tes that are int
-000202e0: 6572 706f 6c61 7465 6420 6f76 6572 2063  erpolated over c
-000202f0: 616e 2062 650a 2020 2020 2020 2020 2020  an be.          
-00020300: 2020 696e 2061 6e79 206f 7264 6572 2061    in any order a
-00020310: 6e64 2074 6865 7920 6172 6520 736f 7274  nd they are sort
-00020320: 6564 2066 6972 7374 2e20 4966 2054 7275  ed first. If Tru
-00020330: 652c 2069 6e74 6572 706f 6c61 7465 640a  e, interpolated.
-00020340: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
-00020350: 6469 6e61 7465 7320 6172 6520 6173 7375  dinates are assu
-00020360: 6d65 6420 746f 2062 6520 616e 2061 7272  med to be an arr
-00020370: 6179 206f 6620 6d6f 6e6f 746f 6e69 6361  ay of monotonica
-00020380: 6c6c 7920 696e 6372 6561 7369 6e67 0a20  lly increasing. 
-00020390: 2020 2020 2020 2020 2020 2076 616c 7565             value
-000203a0: 732e 0a20 2020 2020 2020 206b 7761 7267  s..        kwarg
-000203b0: 7320 3a20 6469 6374 2c20 6f70 7469 6f6e  s : dict, option
-000203c0: 616c 0a20 2020 2020 2020 2020 2020 2041  al.            A
-000203d0: 6464 6974 696f 6e61 6c20 6b65 7977 6f72  dditional keywor
-000203e0: 6420 7061 7373 6564 2074 6f20 7363 6970  d passed to scip
-000203f0: 7927 7320 696e 7465 7270 6f6c 6174 6f72  y's interpolator
-00020400: 2e0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-00020410: 5f6e 6f6e 5f6e 756d 6572 6963 203a 207b  _non_numeric : {
-00020420: 226e 6561 7265 7374 222c 2022 7061 6422  "nearest", "pad"
-00020430: 2c20 2266 6669 6c6c 222c 2022 6261 636b  , "ffill", "back
-00020440: 6669 6c6c 222c 2022 6266 696c 6c22 7d2c  fill", "bfill"},
-00020450: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00020460: 2020 2020 2020 4d65 7468 6f64 2066 6f72        Method for
-00020470: 206e 6f6e 2d6e 756d 6572 6963 2074 7970   non-numeric typ
-00020480: 6573 2e20 5061 7373 6564 206f 6e20 746f  es. Passed on to
-00020490: 203a 7079 3a6d 6574 683a 6044 6174 6173   :py:meth:`Datas
-000204a0: 6574 2e72 6569 6e64 6578 602e 0a20 2020  et.reindex`..   
-000204b0: 2020 2020 2020 2020 2060 6022 6e65 6172           ``"near
-000204c0: 6573 7422 6060 2069 7320 7573 6564 2062  est"`` is used b
-000204d0: 7920 6465 6661 756c 742e 0a0a 2020 2020  y default...    
-000204e0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000204f0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00020500: 2020 2020 696e 7465 7270 6f6c 6174 6564      interpolated
-00020510: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
-00020520: 2020 2020 2020 2041 6e6f 7468 6572 2064         Another d
-00020530: 6174 6173 6574 2062 7920 696e 7465 7270  ataset by interp
-00020540: 6f6c 6174 696e 6720 7468 6973 2064 6174  olating this dat
-00020550: 6173 6574 2773 2064 6174 6120 616c 6f6e  aset's data alon
-00020560: 6720 7468 650a 2020 2020 2020 2020 2020  g the.          
-00020570: 2020 636f 6f72 6469 6e61 7465 7320 6f66    coordinates of
-00020580: 2074 6865 206f 7468 6572 206f 626a 6563   the other objec
-00020590: 742e 0a0a 2020 2020 2020 2020 4e6f 7465  t...        Note
-000205a0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d0a  s.        -----.
-000205b0: 2020 2020 2020 2020 7363 6970 7920 6973          scipy is
-000205c0: 2072 6571 7569 7265 642e 0a20 2020 2020   required..     
-000205d0: 2020 2049 6620 7468 6520 6461 7461 7365     If the datase
-000205e0: 7420 6861 7320 6f62 6a65 6374 2d74 7970  t has object-typ
-000205f0: 6520 636f 6f72 6469 6e61 7465 732c 2072  e coordinates, r
-00020600: 6569 6e64 6578 2069 7320 7573 6564 2066  eindex is used f
-00020610: 6f72 2074 6865 7365 0a20 2020 2020 2020  or these.       
-00020620: 2063 6f6f 7264 696e 6174 6573 2069 6e73   coordinates ins
-00020630: 7465 6164 206f 6620 7468 6520 696e 7465  tead of the inte
-00020640: 7270 6f6c 6174 696f 6e2e 0a0a 2020 2020  rpolation...    
-00020650: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00020660: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00020670: 2020 2020 2020 4461 7461 7365 742e 696e        Dataset.in
-00020680: 7465 7270 0a20 2020 2020 2020 2044 6174  terp.        Dat
-00020690: 6173 6574 2e72 6569 6e64 6578 5f6c 696b  aset.reindex_lik
-000206a0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-000206b0: 2020 2020 2020 6966 206b 7761 7267 7320        if kwargs 
-000206c0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000206d0: 2020 2020 206b 7761 7267 7320 3d20 7b7d       kwargs = {}
-000206e0: 0a0a 2020 2020 2020 2020 2320 7069 636b  ..        # pick
-000206f0: 206f 6e6c 7920 6469 6d65 6e73 696f 6e20   only dimension 
-00020700: 636f 6f72 6469 6e61 7465 7320 7769 7468  coordinates with
-00020710: 2061 2073 696e 676c 6520 696e 6465 780a   a single index.
-00020720: 2020 2020 2020 2020 636f 6f72 6473 203d          coords =
-00020730: 207b 7d0a 2020 2020 2020 2020 6f74 6865   {}.        othe
-00020740: 725f 696e 6465 7865 7320 3d20 6f74 6865  r_indexes = othe
-00020750: 722e 7869 6e64 6578 6573 0a20 2020 2020  r.xindexes.     
-00020760: 2020 2066 6f72 2064 696d 2069 6e20 7365     for dim in se
-00020770: 6c66 2e64 696d 733a 0a20 2020 2020 2020  lf.dims:.       
-00020780: 2020 2020 206f 7468 6572 5f64 696d 5f63       other_dim_c
-00020790: 6f6f 7264 7320 3d20 6f74 6865 725f 696e  oords = other_in
-000207a0: 6465 7865 732e 6765 745f 616c 6c5f 636f  dexes.get_all_co
-000207b0: 6f72 6473 2864 696d 2c20 6572 726f 7273  ords(dim, errors
-000207c0: 3d22 6967 6e6f 7265 2229 0a20 2020 2020  ="ignore").     
-000207d0: 2020 2020 2020 2069 6620 6c65 6e28 6f74         if len(ot
-000207e0: 6865 725f 6469 6d5f 636f 6f72 6473 2920  her_dim_coords) 
-000207f0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-00020800: 2020 2020 2020 636f 6f72 6473 5b64 696d        coords[dim
-00020810: 5d20 3d20 6f74 6865 725f 6469 6d5f 636f  ] = other_dim_co
-00020820: 6f72 6473 5b64 696d 5d0a 0a20 2020 2020  ords[dim]..     
-00020830: 2020 206e 756d 6572 6963 5f63 6f6f 7264     numeric_coord
-00020840: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
-00020850: 2c20 7064 2e49 6e64 6578 5d20 3d20 7b7d  , pd.Index] = {}
-00020860: 0a20 2020 2020 2020 206f 626a 6563 745f  .        object_
-00020870: 636f 6f72 6473 3a20 6469 6374 5b48 6173  coords: dict[Has
-00020880: 6861 626c 652c 2070 642e 496e 6465 785d  hable, pd.Index]
-00020890: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
-000208a0: 7220 6b2c 2076 2069 6e20 636f 6f72 6473  r k, v in coords
-000208b0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-000208c0: 2020 2020 2020 6966 2076 2e64 7479 7065        if v.dtype
-000208d0: 2e6b 696e 6420 696e 2022 7569 6663 4d6d  .kind in "uifcMm
-000208e0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-000208f0: 2020 206e 756d 6572 6963 5f63 6f6f 7264     numeric_coord
-00020900: 735b 6b5d 203d 2076 0a20 2020 2020 2020  s[k] = v.       
-00020910: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00020920: 2020 2020 2020 2020 2020 206f 626a 6563             objec
-00020930: 745f 636f 6f72 6473 5b6b 5d20 3d20 760a  t_coords[k] = v.
-00020940: 0a20 2020 2020 2020 2064 7320 3d20 7365  .        ds = se
-00020950: 6c66 0a20 2020 2020 2020 2069 6620 6f62  lf.        if ob
-00020960: 6a65 6374 5f63 6f6f 7264 733a 0a20 2020  ject_coords:.   
-00020970: 2020 2020 2020 2020 2023 2057 6520 646f           # We do
-00020980: 206e 6f74 2073 7570 706f 7274 2069 6e74   not support int
-00020990: 6572 706f 6c61 7469 6f6e 2061 6c6f 6e67  erpolation along
-000209a0: 206f 626a 6563 7420 636f 6f72 6469 6e61   object coordina
-000209b0: 7465 2e0a 2020 2020 2020 2020 2020 2020  te..            
-000209c0: 2320 7265 696e 6465 7820 696e 7374 6561  # reindex instea
-000209d0: 642e 0a20 2020 2020 2020 2020 2020 2064  d..            d
-000209e0: 7320 3d20 7365 6c66 2e72 6569 6e64 6578  s = self.reindex
-000209f0: 286f 626a 6563 745f 636f 6f72 6473 290a  (object_coords).
-00020a00: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00020a10: 732e 696e 7465 7270 280a 2020 2020 2020  s.interp(.      
-00020a20: 2020 2020 2020 636f 6f72 6473 3d6e 756d        coords=num
-00020a30: 6572 6963 5f63 6f6f 7264 732c 0a20 2020  eric_coords,.   
-00020a40: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-00020a50: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
-00020a60: 2020 2020 6173 7375 6d65 5f73 6f72 7465      assume_sorte
-00020a70: 643d 6173 7375 6d65 5f73 6f72 7465 642c  d=assume_sorted,
-00020a80: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
-00020a90: 7267 733d 6b77 6172 6773 2c0a 2020 2020  rgs=kwargs,.    
-00020aa0: 2020 2020 2020 2020 6d65 7468 6f64 5f6e          method_n
-00020ab0: 6f6e 5f6e 756d 6572 6963 3d6d 6574 686f  on_numeric=metho
-00020ac0: 645f 6e6f 6e5f 6e75 6d65 7269 632c 0a20  d_non_numeric,. 
-00020ad0: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
-00020ae0: 4865 6c70 6572 206d 6574 686f 6473 2066  Helper methods f
-00020af0: 6f72 2072 656e 616d 6528 290a 2020 2020  or rename().    
-00020b00: 6465 6620 5f72 656e 616d 655f 7661 7273  def _rename_vars
-00020b10: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-00020b20: 6e61 6d65 5f64 6963 742c 2064 696d 735f  name_dict, dims_
-00020b30: 6469 6374 0a20 2020 2029 202d 3e20 7475  dict.    ) -> tu
-00020b40: 706c 655b 6469 6374 5b48 6173 6861 626c  ple[dict[Hashabl
-00020b50: 652c 2056 6172 6961 626c 655d 2c20 7365  e, Variable], se
-00020b60: 745b 4861 7368 6162 6c65 5d5d 3a0a 2020  t[Hashable]]:.  
-00020b70: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
-00020b80: 3d20 7b7d 0a20 2020 2020 2020 2063 6f6f  = {}.        coo
-00020b90: 7264 5f6e 616d 6573 203d 2073 6574 2829  rd_names = set()
-00020ba0: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
-00020bb0: 7620 696e 2073 656c 662e 7661 7269 6162  v in self.variab
-00020bc0: 6c65 732e 6974 656d 7328 293a 0a20 2020  les.items():.   
-00020bd0: 2020 2020 2020 2020 2076 6172 203d 2076           var = v
-00020be0: 2e63 6f70 7928 6465 6570 3d46 616c 7365  .copy(deep=False
-00020bf0: 290a 2020 2020 2020 2020 2020 2020 7661  ).            va
-00020c00: 722e 6469 6d73 203d 2074 7570 6c65 2864  r.dims = tuple(d
-00020c10: 696d 735f 6469 6374 2e67 6574 2864 696d  ims_dict.get(dim
-00020c20: 2c20 6469 6d29 2066 6f72 2064 696d 2069  , dim) for dim i
-00020c30: 6e20 762e 6469 6d73 290a 2020 2020 2020  n v.dims).      
-00020c40: 2020 2020 2020 6e61 6d65 203d 206e 616d        name = nam
-00020c50: 655f 6469 6374 2e67 6574 286b 2c20 6b29  e_dict.get(k, k)
-00020c60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00020c70: 6e61 6d65 2069 6e20 7661 7269 6162 6c65  name in variable
-00020c80: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00020c90: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00020ca0: 726f 7228 6622 7468 6520 6e65 7720 6e61  ror(f"the new na
-00020cb0: 6d65 207b 6e61 6d65 2172 7d20 636f 6e66  me {name!r} conf
-00020cc0: 6c69 6374 7322 290a 2020 2020 2020 2020  licts").        
-00020cd0: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
-00020ce0: 6d65 5d20 3d20 7661 720a 2020 2020 2020  me] = var.      
-00020cf0: 2020 2020 2020 6966 206b 2069 6e20 7365        if k in se
-00020d00: 6c66 2e5f 636f 6f72 645f 6e61 6d65 733a  lf._coord_names:
-00020d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020d20: 2063 6f6f 7264 5f6e 616d 6573 2e61 6464   coord_names.add
-00020d30: 286e 616d 6529 0a20 2020 2020 2020 2072  (name).        r
-00020d40: 6574 7572 6e20 7661 7269 6162 6c65 732c  eturn variables,
-00020d50: 2063 6f6f 7264 5f6e 616d 6573 0a0a 2020   coord_names..  
-00020d60: 2020 6465 6620 5f72 656e 616d 655f 6469    def _rename_di
-00020d70: 6d73 2873 656c 662c 206e 616d 655f 6469  ms(self, name_di
-00020d80: 6374 3a20 4d61 7070 696e 675b 416e 792c  ct: Mapping[Any,
-00020d90: 2048 6173 6861 626c 655d 2920 2d3e 2064   Hashable]) -> d
-00020da0: 6963 745b 4861 7368 6162 6c65 2c20 696e  ict[Hashable, in
-00020db0: 745d 3a0a 2020 2020 2020 2020 7265 7475  t]:.        retu
-00020dc0: 726e 207b 6e61 6d65 5f64 6963 742e 6765  rn {name_dict.ge
-00020dd0: 7428 6b2c 206b 293a 2076 2066 6f72 206b  t(k, k): v for k
-00020de0: 2c20 7620 696e 2073 656c 662e 6469 6d73  , v in self.dims
-00020df0: 2e69 7465 6d73 2829 7d0a 0a20 2020 2064  .items()}..    d
-00020e00: 6566 205f 7265 6e61 6d65 5f69 6e64 6578  ef _rename_index
-00020e10: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
-00020e20: 2c20 6e61 6d65 5f64 6963 743a 204d 6170  , name_dict: Map
-00020e30: 7069 6e67 5b41 6e79 2c20 4861 7368 6162  ping[Any, Hashab
-00020e40: 6c65 5d2c 2064 696d 735f 6469 6374 3a20  le], dims_dict: 
-00020e50: 4d61 7070 696e 675b 416e 792c 2048 6173  Mapping[Any, Has
-00020e60: 6861 626c 655d 0a20 2020 2029 202d 3e20  hable].    ) -> 
-00020e70: 7475 706c 655b 6469 6374 5b48 6173 6861  tuple[dict[Hasha
-00020e80: 626c 652c 2049 6e64 6578 5d2c 2064 6963  ble, Index], dic
-00020e90: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
-00020ea0: 6162 6c65 5d5d 3a0a 2020 2020 2020 2020  able]]:.        
-00020eb0: 6966 206e 6f74 2073 656c 662e 5f69 6e64  if not self._ind
-00020ec0: 6578 6573 3a0a 2020 2020 2020 2020 2020  exes:.          
-00020ed0: 2020 7265 7475 726e 207b 7d2c 207b 7d0a    return {}, {}.
-00020ee0: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-00020ef0: 203d 207b 7d0a 2020 2020 2020 2020 7661   = {}.        va
-00020f00: 7269 6162 6c65 7320 3d20 7b7d 0a0a 2020  riables = {}..  
-00020f10: 2020 2020 2020 666f 7220 696e 6465 782c        for index,
-00020f20: 2063 6f6f 7264 5f6e 616d 6573 2069 6e20   coord_names in 
-00020f30: 7365 6c66 2e78 696e 6465 7865 732e 6772  self.xindexes.gr
-00020f40: 6f75 705f 6279 5f69 6e64 6578 2829 3a0a  oup_by_index():.
-00020f50: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00020f60: 696e 6465 7820 3d20 696e 6465 782e 7265  index = index.re
-00020f70: 6e61 6d65 286e 616d 655f 6469 6374 2c20  name(name_dict, 
-00020f80: 6469 6d73 5f64 6963 7429 0a20 2020 2020  dims_dict).     
-00020f90: 2020 2020 2020 206e 6577 5f63 6f6f 7264         new_coord
-00020fa0: 5f6e 616d 6573 203d 205b 6e61 6d65 5f64  _names = [name_d
-00020fb0: 6963 742e 6765 7428 6b2c 206b 2920 666f  ict.get(k, k) fo
-00020fc0: 7220 6b20 696e 2063 6f6f 7264 5f6e 616d  r k in coord_nam
-00020fd0: 6573 5d0a 2020 2020 2020 2020 2020 2020  es].            
-00020fe0: 696e 6465 7865 732e 7570 6461 7465 287b  indexes.update({
-00020ff0: 6b3a 206e 6577 5f69 6e64 6578 2066 6f72  k: new_index for
-00021000: 206b 2069 6e20 6e65 775f 636f 6f72 645f   k in new_coord_
-00021010: 6e61 6d65 737d 290a 2020 2020 2020 2020  names}).        
-00021020: 2020 2020 6e65 775f 696e 6465 785f 7661      new_index_va
-00021030: 7273 203d 206e 6577 5f69 6e64 6578 2e63  rs = new_index.c
-00021040: 7265 6174 655f 7661 7269 6162 6c65 7328  reate_variables(
-00021050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021060: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00021070: 2020 2020 2020 206e 6577 3a20 7365 6c66         new: self
-00021080: 2e5f 7661 7269 6162 6c65 735b 6f6c 645d  ._variables[old]
-00021090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000210a0: 2020 2020 2066 6f72 206f 6c64 2c20 6e65       for old, ne
-000210b0: 7720 696e 207a 6970 2863 6f6f 7264 5f6e  w in zip(coord_n
-000210c0: 616d 6573 2c20 6e65 775f 636f 6f72 645f  ames, new_coord_
-000210d0: 6e61 6d65 7329 0a20 2020 2020 2020 2020  names).         
-000210e0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000210f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00021100: 2020 2076 6172 6961 626c 6573 2e75 7064     variables.upd
-00021110: 6174 6528 6e65 775f 696e 6465 785f 7661  ate(new_index_va
-00021120: 7273 290a 0a20 2020 2020 2020 2072 6574  rs)..        ret
-00021130: 7572 6e20 696e 6465 7865 732c 2076 6172  urn indexes, var
-00021140: 6961 626c 6573 0a0a 2020 2020 6465 6620  iables..    def 
-00021150: 5f72 656e 616d 655f 616c 6c28 0a20 2020  _rename_all(.   
-00021160: 2020 2020 2073 656c 662c 206e 616d 655f       self, name_
-00021170: 6469 6374 3a20 4d61 7070 696e 675b 416e  dict: Mapping[An
-00021180: 792c 2048 6173 6861 626c 655d 2c20 6469  y, Hashable], di
-00021190: 6d73 5f64 6963 743a 204d 6170 7069 6e67  ms_dict: Mapping
-000211a0: 5b41 6e79 2c20 4861 7368 6162 6c65 5d0a  [Any, Hashable].
-000211b0: 2020 2020 2920 2d3e 2074 7570 6c65 5b0a      ) -> tuple[.
-000211c0: 2020 2020 2020 2020 6469 6374 5b48 6173          dict[Has
-000211d0: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-000211e0: 2c0a 2020 2020 2020 2020 7365 745b 4861  ,.        set[Ha
-000211f0: 7368 6162 6c65 5d2c 0a20 2020 2020 2020  shable],.       
-00021200: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00021210: 696e 745d 2c0a 2020 2020 2020 2020 6469  int],.        di
-00021220: 6374 5b48 6173 6861 626c 652c 2049 6e64  ct[Hashable, Ind
-00021230: 6578 5d2c 0a20 2020 205d 3a0a 2020 2020  ex],.    ]:.    
-00021240: 2020 2020 7661 7269 6162 6c65 732c 2063      variables, c
-00021250: 6f6f 7264 5f6e 616d 6573 203d 2073 656c  oord_names = sel
-00021260: 662e 5f72 656e 616d 655f 7661 7273 286e  f._rename_vars(n
-00021270: 616d 655f 6469 6374 2c20 6469 6d73 5f64  ame_dict, dims_d
-00021280: 6963 7429 0a20 2020 2020 2020 2064 696d  ict).        dim
-00021290: 7320 3d20 7365 6c66 2e5f 7265 6e61 6d65  s = self._rename
-000212a0: 5f64 696d 7328 6469 6d73 5f64 6963 7429  _dims(dims_dict)
-000212b0: 0a0a 2020 2020 2020 2020 696e 6465 7865  ..        indexe
-000212c0: 732c 2069 6e64 6578 5f76 6172 7320 3d20  s, index_vars = 
-000212d0: 7365 6c66 2e5f 7265 6e61 6d65 5f69 6e64  self._rename_ind
-000212e0: 6578 6573 286e 616d 655f 6469 6374 2c20  exes(name_dict, 
-000212f0: 6469 6d73 5f64 6963 7429 0a20 2020 2020  dims_dict).     
-00021300: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
-00021310: 6b3a 2069 6e64 6578 5f76 6172 732e 6765  k: index_vars.ge
-00021320: 7428 6b2c 2076 2920 666f 7220 6b2c 2076  t(k, v) for k, v
-00021330: 2069 6e20 7661 7269 6162 6c65 732e 6974   in variables.it
-00021340: 656d 7328 297d 0a0a 2020 2020 2020 2020  ems()}..        
-00021350: 7265 7475 726e 2076 6172 6961 626c 6573  return variables
-00021360: 2c20 636f 6f72 645f 6e61 6d65 732c 2064  , coord_names, d
-00021370: 696d 732c 2069 6e64 6578 6573 0a0a 2020  ims, indexes..  
-00021380: 2020 6465 6620 5f72 656e 616d 6528 0a20    def _rename(. 
-00021390: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
-000213a0: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
-000213b0: 6e61 6d65 5f64 6963 743a 204d 6170 7069  name_dict: Mappi
-000213c0: 6e67 5b41 6e79 2c20 4861 7368 6162 6c65  ng[Any, Hashable
-000213d0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-000213e0: 0a20 2020 2020 2020 202a 2a6e 616d 6573  .        **names
-000213f0: 3a20 4861 7368 6162 6c65 2c0a 2020 2020  : Hashable,.    
-00021400: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-00021410: 2020 2020 2020 2020 2222 2241 6c73 6f20          """Also 
-00021420: 7573 6564 2069 6e74 6572 6e61 6c6c 7920  used internally 
-00021430: 6279 2044 6174 6141 7272 6179 2073 6f20  by DataArray so 
-00021440: 7468 6174 2074 6865 2077 6172 6e69 6e67  that the warning
-00021450: 2028 6966 2061 6e79 290a 2020 2020 2020   (if any).      
-00021460: 2020 6973 2072 6169 7365 6420 6174 2074    is raised at t
-00021470: 6865 2072 6967 6874 2073 7461 636b 206c  he right stack l
-00021480: 6576 656c 2e0a 2020 2020 2020 2020 2222  evel..        ""
-00021490: 220a 2020 2020 2020 2020 6e61 6d65 5f64  ".        name_d
-000214a0: 6963 7420 3d20 6569 7468 6572 5f64 6963  ict = either_dic
-000214b0: 745f 6f72 5f6b 7761 7267 7328 6e61 6d65  t_or_kwargs(name
-000214c0: 5f64 6963 742c 206e 616d 6573 2c20 2272  _dict, names, "r
-000214d0: 656e 616d 6522 290a 2020 2020 2020 2020  ename").        
-000214e0: 666f 7220 6b20 696e 206e 616d 655f 6469  for k in name_di
-000214f0: 6374 2e6b 6579 7328 293a 0a20 2020 2020  ct.keys():.     
-00021500: 2020 2020 2020 2069 6620 6b20 6e6f 7420         if k not 
-00021510: 696e 2073 656c 6620 616e 6420 6b20 6e6f  in self and k no
-00021520: 7420 696e 2073 656c 662e 6469 6d73 3a0a  t in self.dims:.
-00021530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021540: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00021550: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00021560: 2020 2020 2020 6622 6361 6e6e 6f74 2072        f"cannot r
-00021570: 656e 616d 6520 7b6b 2172 7d20 6265 6361  ename {k!r} beca
-00021580: 7573 6520 6974 2069 7320 6e6f 7420 6120  use it is not a 
-00021590: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000215a0: 2020 2020 2020 2276 6172 6961 626c 6520        "variable 
-000215b0: 6f72 2064 696d 656e 7369 6f6e 2069 6e20  or dimension in 
-000215c0: 7468 6973 2064 6174 6173 6574 220a 2020  this dataset".  
-000215d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-000215e0: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
-000215f0: 6174 655f 6469 6d5f 636f 6f72 6420 3d20  ate_dim_coord = 
-00021600: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00021610: 2020 6e65 775f 6b20 3d20 6e61 6d65 5f64    new_k = name_d
-00021620: 6963 745b 6b5d 0a0a 2020 2020 2020 2020  ict[k]..        
-00021630: 2020 2020 6966 206b 2069 6e20 7365 6c66      if k in self
-00021640: 2e64 696d 7320 616e 6420 6e65 775f 6b20  .dims and new_k 
-00021650: 696e 2073 656c 662e 5f63 6f6f 7264 5f6e  in self._coord_n
-00021660: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-00021670: 2020 2020 2020 636f 6f72 645f 6469 6d73        coord_dims
-00021680: 203d 2073 656c 662e 5f76 6172 6961 626c   = self._variabl
-00021690: 6573 5b6e 616d 655f 6469 6374 5b6b 5d5d  es[name_dict[k]]
-000216a0: 2e64 696d 730a 2020 2020 2020 2020 2020  .dims.          
-000216b0: 2020 2020 2020 6966 2063 6f6f 7264 5f64        if coord_d
-000216c0: 696d 7320 3d3d 2028 6b2c 293a 0a20 2020  ims == (k,):.   
-000216d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216e0: 2063 7265 6174 655f 6469 6d5f 636f 6f72   create_dim_coor
-000216f0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-00021700: 2020 2020 2065 6c69 6620 6b20 696e 2073       elif k in s
-00021710: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
-00021720: 2061 6e64 206e 6577 5f6b 2069 6e20 7365   and new_k in se
-00021730: 6c66 2e64 696d 733a 0a20 2020 2020 2020  lf.dims:.       
-00021740: 2020 2020 2020 2020 2063 6f6f 7264 5f64           coord_d
-00021750: 696d 7320 3d20 7365 6c66 2e5f 7661 7269  ims = self._vari
-00021760: 6162 6c65 735b 6b5d 2e64 696d 730a 2020  ables[k].dims.  
-00021770: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00021780: 2063 6f6f 7264 5f64 696d 7320 3d3d 2028   coord_dims == (
-00021790: 6e65 775f 6b2c 293a 0a20 2020 2020 2020  new_k,):.       
-000217a0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-000217b0: 6174 655f 6469 6d5f 636f 6f72 6420 3d20  ate_dim_coord = 
-000217c0: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
-000217d0: 2020 6966 2063 7265 6174 655f 6469 6d5f    if create_dim_
-000217e0: 636f 6f72 643a 0a20 2020 2020 2020 2020  coord:.         
-000217f0: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
-00021800: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
-00021810: 2020 2020 2020 2020 2020 6622 7265 6e61            f"rena
-00021820: 6d65 207b 6b21 727d 2074 6f20 7b6e 616d  me {k!r} to {nam
-00021830: 655f 6469 6374 5b6b 5d21 727d 2064 6f65  e_dict[k]!r} doe
-00021840: 7320 6e6f 7420 6372 6561 7465 2061 6e20  s not create an 
-00021850: 696e 6465 7820 220a 2020 2020 2020 2020  index ".        
-00021860: 2020 2020 2020 2020 2020 2020 2261 6e79              "any
-00021870: 6d6f 7265 2e20 5472 7920 7573 696e 6720  more. Try using 
-00021880: 7377 6170 5f64 696d 7320 696e 7374 6561  swap_dims instea
-00021890: 6420 6f72 2075 7365 2073 6574 5f69 6e64  d or use set_ind
-000218a0: 6578 2022 0a20 2020 2020 2020 2020 2020  ex ".           
-000218b0: 2020 2020 2020 2020 2022 6166 7465 7220           "after 
-000218c0: 7265 6e61 6d65 2074 6f20 6372 6561 7465  rename to create
-000218d0: 2061 6e20 696e 6465 7865 6420 636f 6f72   an indexed coor
-000218e0: 6469 6e61 7465 2e22 2c0a 2020 2020 2020  dinate.",.      
-000218f0: 2020 2020 2020 2020 2020 2020 2020 5573                Us
-00021900: 6572 5761 726e 696e 672c 0a20 2020 2020  erWarning,.     
-00021910: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021920: 7461 636b 6c65 7665 6c3d 332c 0a20 2020  tacklevel=3,.   
-00021930: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00021940: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-00021950: 732c 2063 6f6f 7264 5f6e 616d 6573 2c20  s, coord_names, 
-00021960: 6469 6d73 2c20 696e 6465 7865 7320 3d20  dims, indexes = 
-00021970: 7365 6c66 2e5f 7265 6e61 6d65 5f61 6c6c  self._rename_all
-00021980: 280a 2020 2020 2020 2020 2020 2020 6e61  (.            na
-00021990: 6d65 5f64 6963 743d 6e61 6d65 5f64 6963  me_dict=name_dic
-000219a0: 742c 2064 696d 735f 6469 6374 3d6e 616d  t, dims_dict=nam
-000219b0: 655f 6469 6374 0a20 2020 2020 2020 2029  e_dict.        )
-000219c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000219d0: 7365 6c66 2e5f 7265 706c 6163 6528 7661  self._replace(va
-000219e0: 7269 6162 6c65 732c 2063 6f6f 7264 5f6e  riables, coord_n
-000219f0: 616d 6573 2c20 6469 6d73 3d64 696d 732c  ames, dims=dims,
-00021a00: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
-00021a10: 290a 0a20 2020 2064 6566 2072 656e 616d  )..    def renam
-00021a20: 6528 0a20 2020 2020 2020 2073 656c 663a  e(.        self:
-00021a30: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
-00021a40: 2020 2020 6e61 6d65 5f64 6963 743a 204d      name_dict: M
-00021a50: 6170 7069 6e67 5b41 6e79 2c20 4861 7368  apping[Any, Hash
-00021a60: 6162 6c65 5d20 7c20 4e6f 6e65 203d 204e  able] | None = N
-00021a70: 6f6e 652c 0a20 2020 2020 2020 202a 2a6e  one,.        **n
-00021a80: 616d 6573 3a20 4861 7368 6162 6c65 2c0a  ames: Hashable,.
-00021a90: 2020 2020 2920 2d3e 2054 5f44 6174 6173      ) -> T_Datas
-00021aa0: 6574 3a0a 2020 2020 2020 2020 2222 2252  et:.        """R
-00021ab0: 6574 7572 6e73 2061 206e 6577 206f 626a  eturns a new obj
-00021ac0: 6563 7420 7769 7468 2072 656e 616d 6564  ect with renamed
-00021ad0: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
-00021ae0: 6469 6e61 7465 7320 616e 6420 6469 6d65  dinates and dime
-00021af0: 6e73 696f 6e73 2e0a 0a20 2020 2020 2020  nsions...       
-00021b00: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00021b10: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00021b20: 2020 2020 2020 206e 616d 655f 6469 6374         name_dict
-00021b30: 203a 2064 6963 742d 6c69 6b65 2c20 6f70   : dict-like, op
-00021b40: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00021b50: 2020 2044 6963 7469 6f6e 6172 7920 7768     Dictionary wh
-00021b60: 6f73 6520 6b65 7973 2061 7265 2063 7572  ose keys are cur
-00021b70: 7265 6e74 2076 6172 6961 626c 652c 2063  rent variable, c
-00021b80: 6f6f 7264 696e 6174 6520 6f72 2064 696d  oordinate or dim
-00021b90: 656e 7369 6f6e 206e 616d 6573 2061 6e64  ension names and
-00021ba0: 0a20 2020 2020 2020 2020 2020 2077 686f  .            who
-00021bb0: 7365 2076 616c 7565 7320 6172 6520 7468  se values are th
-00021bc0: 6520 6465 7369 7265 6420 6e61 6d65 732e  e desired names.
-00021bd0: 0a20 2020 2020 2020 202a 2a6e 616d 6573  .        **names
-00021be0: 203a 206f 7074 696f 6e61 6c0a 2020 2020   : optional.    
-00021bf0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-00021c00: 666f 726d 206f 6620 6060 6e61 6d65 5f64  form of ``name_d
-00021c10: 6963 7460 602e 0a20 2020 2020 2020 2020  ict``..         
-00021c20: 2020 204f 6e65 206f 6620 6e61 6d65 5f64     One of name_d
-00021c30: 6963 7420 6f72 206e 616d 6573 206d 7573  ict or names mus
-00021c40: 7420 6265 2070 726f 7669 6465 642e 0a0a  t be provided...
-00021c50: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00021c60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00021c70: 2020 2020 2020 2020 7265 6e61 6d65 6420          renamed 
-00021c80: 3a20 4461 7461 7365 740a 2020 2020 2020  : Dataset.      
-00021c90: 2020 2020 2020 4461 7461 7365 7420 7769        Dataset wi
-00021ca0: 7468 2072 656e 616d 6564 2076 6172 6961  th renamed varia
-00021cb0: 626c 6573 2c20 636f 6f72 6469 6e61 7465  bles, coordinate
-00021cc0: 7320 616e 6420 6469 6d65 6e73 696f 6e73  s and dimensions
-00021cd0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-00021ce0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-00021cf0: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
-00021d00: 6173 6574 2e73 7761 705f 6469 6d73 0a20  aset.swap_dims. 
-00021d10: 2020 2020 2020 2044 6174 6173 6574 2e72         Dataset.r
-00021d20: 656e 616d 655f 7661 7273 0a20 2020 2020  ename_vars.     
-00021d30: 2020 2044 6174 6173 6574 2e72 656e 616d     Dataset.renam
-00021d40: 655f 6469 6d73 0a20 2020 2020 2020 2044  e_dims.        D
-00021d50: 6174 6141 7272 6179 2e72 656e 616d 650a  ataArray.rename.
-00021d60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00021d70: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00021d80: 5f72 656e 616d 6528 6e61 6d65 5f64 6963  _rename(name_dic
-00021d90: 743d 6e61 6d65 5f64 6963 742c 202a 2a6e  t=name_dict, **n
-00021da0: 616d 6573 290a 0a20 2020 2064 6566 2072  ames)..    def r
-00021db0: 656e 616d 655f 6469 6d73 280a 2020 2020  ename_dims(.    
-00021dc0: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
-00021dd0: 7365 742c 0a20 2020 2020 2020 2064 696d  set,.        dim
-00021de0: 735f 6469 6374 3a20 4d61 7070 696e 675b  s_dict: Mapping[
-00021df0: 416e 792c 2048 6173 6861 626c 655d 207c  Any, Hashable] |
-00021e00: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00021e10: 2020 2020 2020 2a2a 6469 6d73 3a20 4861        **dims: Ha
-00021e20: 7368 6162 6c65 2c0a 2020 2020 2920 2d3e  shable,.    ) ->
-00021e30: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00021e40: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
-00021e50: 206e 6577 206f 626a 6563 7420 7769 7468   new object with
-00021e60: 2072 656e 616d 6564 2064 696d 656e 7369   renamed dimensi
-00021e70: 6f6e 7320 6f6e 6c79 2e0a 0a20 2020 2020  ons only...     
-00021e80: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00021e90: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00021ea0: 0a20 2020 2020 2020 2064 696d 735f 6469  .        dims_di
-00021eb0: 6374 203a 2064 6963 742d 6c69 6b65 2c20  ct : dict-like, 
-00021ec0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00021ed0: 2020 2020 2044 6963 7469 6f6e 6172 7920       Dictionary 
-00021ee0: 7768 6f73 6520 6b65 7973 2061 7265 2063  whose keys are c
-00021ef0: 7572 7265 6e74 2064 696d 656e 7369 6f6e  urrent dimension
-00021f00: 206e 616d 6573 2061 6e64 0a20 2020 2020   names and.     
-00021f10: 2020 2020 2020 2077 686f 7365 2076 616c         whose val
-00021f20: 7565 7320 6172 6520 7468 6520 6465 7369  ues are the desi
-00021f30: 7265 6420 6e61 6d65 732e 2054 6865 2064  red names. The d
-00021f40: 6573 6972 6564 206e 616d 6573 206d 7573  esired names mus
-00021f50: 740a 2020 2020 2020 2020 2020 2020 6e6f  t.            no
-00021f60: 7420 6265 2074 6865 206e 616d 6520 6f66  t be the name of
-00021f70: 2061 6e20 6578 6973 7469 6e67 2064 696d   an existing dim
-00021f80: 656e 7369 6f6e 206f 7220 5661 7269 6162  ension or Variab
-00021f90: 6c65 2069 6e20 7468 6520 4461 7461 7365  le in the Datase
-00021fa0: 742e 0a20 2020 2020 2020 202a 2a64 696d  t..        **dim
-00021fb0: 7320 3a20 6f70 7469 6f6e 616c 0a20 2020  s : optional.   
-00021fc0: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
-00021fd0: 2066 6f72 6d20 6f66 2060 6064 696d 735f   form of ``dims_
-00021fe0: 6469 6374 6060 2e0a 2020 2020 2020 2020  dict``..        
-00021ff0: 2020 2020 4f6e 6520 6f66 2064 696d 735f      One of dims_
-00022000: 6469 6374 206f 7220 6469 6d73 206d 7573  dict or dims mus
-00022010: 7420 6265 2070 726f 7669 6465 642e 0a0a  t be provided...
-00022020: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00022030: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00022040: 2020 2020 2020 2020 7265 6e61 6d65 6420          renamed 
-00022050: 3a20 4461 7461 7365 740a 2020 2020 2020  : Dataset.      
-00022060: 2020 2020 2020 4461 7461 7365 7420 7769        Dataset wi
-00022070: 7468 2072 656e 616d 6564 2064 696d 656e  th renamed dimen
-00022080: 7369 6f6e 732e 0a0a 2020 2020 2020 2020  sions...        
-00022090: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-000220a0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-000220b0: 2020 4461 7461 7365 742e 7377 6170 5f64    Dataset.swap_d
-000220c0: 696d 730a 2020 2020 2020 2020 4461 7461  ims.        Data
-000220d0: 7365 742e 7265 6e61 6d65 0a20 2020 2020  set.rename.     
-000220e0: 2020 2044 6174 6173 6574 2e72 656e 616d     Dataset.renam
-000220f0: 655f 7661 7273 0a20 2020 2020 2020 2044  e_vars.        D
-00022100: 6174 6141 7272 6179 2e72 656e 616d 650a  ataArray.rename.
-00022110: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00022120: 2020 2020 6469 6d73 5f64 6963 7420 3d20      dims_dict = 
-00022130: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
-00022140: 7761 7267 7328 6469 6d73 5f64 6963 742c  wargs(dims_dict,
-00022150: 2064 696d 732c 2022 7265 6e61 6d65 5f64   dims, "rename_d
-00022160: 696d 7322 290a 2020 2020 2020 2020 666f  ims").        fo
-00022170: 7220 6b2c 2076 2069 6e20 6469 6d73 5f64  r k, v in dims_d
-00022180: 6963 742e 6974 656d 7328 293a 0a20 2020  ict.items():.   
-00022190: 2020 2020 2020 2020 2069 6620 6b20 6e6f           if k no
-000221a0: 7420 696e 2073 656c 662e 6469 6d73 3a0a  t in self.dims:.
-000221b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000221d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000221e0: 2020 2020 2020 6622 6361 6e6e 6f74 2072        f"cannot r
-000221f0: 656e 616d 6520 7b6b 2172 7d20 6265 6361  ename {k!r} beca
-00022200: 7573 6520 6974 2069 7320 6e6f 7420 6120  use it is not a 
-00022210: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00022220: 2020 2020 2020 2264 696d 656e 7369 6f6e        "dimension
-00022230: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
-00022240: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00022250: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00022260: 6966 2076 2069 6e20 7365 6c66 2e64 696d  if v in self.dim
-00022270: 7320 6f72 2076 2069 6e20 7365 6c66 3a0a  s or v in self:.
-00022280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022290: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000222a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000222b0: 2020 2020 2020 6622 4361 6e6e 6f74 2072        f"Cannot r
-000222c0: 656e 616d 6520 7b6b 7d20 746f 207b 767d  ename {k} to {v}
-000222d0: 2062 6563 6175 7365 207b 767d 2061 6c72   because {v} alr
-000222e0: 6561 6479 2065 7869 7374 732e 2022 0a20  eady exists. ". 
-000222f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022300: 2020 2022 5472 7920 7573 696e 6720 7377     "Try using sw
-00022310: 6170 5f64 696d 7320 696e 7374 6561 642e  ap_dims instead.
-00022320: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00022330: 2020 290a 0a20 2020 2020 2020 2076 6172    )..        var
-00022340: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
-00022350: 6d65 732c 2073 697a 6573 2c20 696e 6465  mes, sizes, inde
-00022360: 7865 7320 3d20 7365 6c66 2e5f 7265 6e61  xes = self._rena
-00022370: 6d65 5f61 6c6c 280a 2020 2020 2020 2020  me_all(.        
-00022380: 2020 2020 6e61 6d65 5f64 6963 743d 7b7d      name_dict={}
-00022390: 2c20 6469 6d73 5f64 6963 743d 6469 6d73  , dims_dict=dims
-000223a0: 5f64 6963 740a 2020 2020 2020 2020 290a  _dict.        ).
-000223b0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000223c0: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
-000223d0: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
-000223e0: 6d65 732c 2064 696d 733d 7369 7a65 732c  mes, dims=sizes,
-000223f0: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
-00022400: 290a 0a20 2020 2064 6566 2072 656e 616d  )..    def renam
-00022410: 655f 7661 7273 280a 2020 2020 2020 2020  e_vars(.        
-00022420: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-00022430: 0a20 2020 2020 2020 206e 616d 655f 6469  .        name_di
-00022440: 6374 3a20 4d61 7070 696e 675b 416e 792c  ct: Mapping[Any,
-00022450: 2048 6173 6861 626c 655d 207c 204e 6f6e   Hashable] | Non
-00022460: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00022470: 2020 2a2a 6e61 6d65 733a 2048 6173 6861    **names: Hasha
-00022480: 626c 652c 0a20 2020 2029 202d 3e20 545f  ble,.    ) -> T_
-00022490: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-000224a0: 2022 2222 5265 7475 726e 7320 6120 6e65   """Returns a ne
-000224b0: 7720 6f62 6a65 6374 2077 6974 6820 7265  w object with re
-000224c0: 6e61 6d65 6420 7661 7269 6162 6c65 7320  named variables 
-000224d0: 696e 636c 7564 696e 6720 636f 6f72 6469  including coordi
-000224e0: 6e61 7465 730a 0a20 2020 2020 2020 2050  nates..        P
-000224f0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00022500: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00022510: 2020 2020 206e 616d 655f 6469 6374 203a       name_dict :
-00022520: 2064 6963 742d 6c69 6b65 2c20 6f70 7469   dict-like, opti
-00022530: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00022540: 2044 6963 7469 6f6e 6172 7920 7768 6f73   Dictionary whos
-00022550: 6520 6b65 7973 2061 7265 2063 7572 7265  e keys are curre
-00022560: 6e74 2076 6172 6961 626c 6520 6f72 2063  nt variable or c
-00022570: 6f6f 7264 696e 6174 6520 6e61 6d65 7320  oordinate names 
-00022580: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
-00022590: 7768 6f73 6520 7661 6c75 6573 2061 7265  whose values are
-000225a0: 2074 6865 2064 6573 6972 6564 206e 616d   the desired nam
-000225b0: 6573 2e0a 2020 2020 2020 2020 2a2a 6e61  es..        **na
-000225c0: 6d65 7320 3a20 6f70 7469 6f6e 616c 0a20  mes : optional. 
-000225d0: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
-000225e0: 7264 2066 6f72 6d20 6f66 2060 606e 616d  rd form of ``nam
-000225f0: 655f 6469 6374 6060 2e0a 2020 2020 2020  e_dict``..      
-00022600: 2020 2020 2020 4f6e 6520 6f66 206e 616d        One of nam
-00022610: 655f 6469 6374 206f 7220 6e61 6d65 7320  e_dict or names 
-00022620: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
-00022630: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00022640: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00022650: 2d2d 0a20 2020 2020 2020 2072 656e 616d  --.        renam
-00022660: 6564 203a 2044 6174 6173 6574 0a20 2020  ed : Dataset.   
-00022670: 2020 2020 2020 2020 2044 6174 6173 6574           Dataset
-00022680: 2077 6974 6820 7265 6e61 6d65 6420 7661   with renamed va
-00022690: 7269 6162 6c65 7320 696e 636c 7564 696e  riables includin
-000226a0: 6720 636f 6f72 6469 6e61 7465 730a 0a20  g coordinates.. 
-000226b0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-000226c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000226d0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-000226e0: 2e73 7761 705f 6469 6d73 0a20 2020 2020  .swap_dims.     
-000226f0: 2020 2044 6174 6173 6574 2e72 656e 616d     Dataset.renam
-00022700: 650a 2020 2020 2020 2020 4461 7461 7365  e.        Datase
-00022710: 742e 7265 6e61 6d65 5f64 696d 730a 2020  t.rename_dims.  
-00022720: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
-00022730: 7265 6e61 6d65 0a20 2020 2020 2020 2022  rename.        "
-00022740: 2222 0a20 2020 2020 2020 206e 616d 655f  "".        name_
-00022750: 6469 6374 203d 2065 6974 6865 725f 6469  dict = either_di
-00022760: 6374 5f6f 725f 6b77 6172 6773 286e 616d  ct_or_kwargs(nam
-00022770: 655f 6469 6374 2c20 6e61 6d65 732c 2022  e_dict, names, "
-00022780: 7265 6e61 6d65 5f76 6172 7322 290a 2020  rename_vars").  
-00022790: 2020 2020 2020 666f 7220 6b20 696e 206e        for k in n
-000227a0: 616d 655f 6469 6374 3a0a 2020 2020 2020  ame_dict:.      
-000227b0: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
-000227c0: 6e20 7365 6c66 3a0a 2020 2020 2020 2020  n self:.        
-000227d0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000227e0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-000227f0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00022800: 6361 6e6e 6f74 2072 656e 616d 6520 7b6b  cannot rename {k
-00022810: 2172 7d20 6265 6361 7573 6520 6974 2069  !r} because it i
-00022820: 7320 6e6f 7420 6120 220a 2020 2020 2020  s not a ".      
-00022830: 2020 2020 2020 2020 2020 2020 2020 2276                "v
-00022840: 6172 6961 626c 6520 6f72 2063 6f6f 7264  ariable or coord
-00022850: 696e 6174 6520 696e 2074 6869 7320 6461  inate in this da
-00022860: 7461 7365 7422 0a20 2020 2020 2020 2020  taset".         
-00022870: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00022880: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
-00022890: 645f 6e61 6d65 732c 2064 696d 732c 2069  d_names, dims, i
-000228a0: 6e64 6578 6573 203d 2073 656c 662e 5f72  ndexes = self._r
-000228b0: 656e 616d 655f 616c 6c28 0a20 2020 2020  ename_all(.     
-000228c0: 2020 2020 2020 206e 616d 655f 6469 6374         name_dict
-000228d0: 3d6e 616d 655f 6469 6374 2c20 6469 6d73  =name_dict, dims
-000228e0: 5f64 6963 743d 7b7d 0a20 2020 2020 2020  _dict={}.       
-000228f0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00022900: 6e20 7365 6c66 2e5f 7265 706c 6163 6528  n self._replace(
-00022910: 7661 7269 6162 6c65 732c 2063 6f6f 7264  variables, coord
-00022920: 5f6e 616d 6573 2c20 6469 6d73 3d64 696d  _names, dims=dim
-00022930: 732c 2069 6e64 6578 6573 3d69 6e64 6578  s, indexes=index
-00022940: 6573 290a 0a20 2020 2064 6566 2073 7761  es)..    def swa
-00022950: 705f 6469 6d73 280a 2020 2020 2020 2020  p_dims(.        
-00022960: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-00022970: 2064 696d 735f 6469 6374 3a20 4d61 7070   dims_dict: Mapp
-00022980: 696e 675b 416e 792c 2048 6173 6861 626c  ing[Any, Hashabl
-00022990: 655d 207c 204e 6f6e 6520 3d20 4e6f 6e65  e] | None = None
-000229a0: 2c20 2a2a 6469 6d73 5f6b 7761 7267 730a  , **dims_kwargs.
-000229b0: 2020 2020 2920 2d3e 2054 5f44 6174 6173      ) -> T_Datas
-000229c0: 6574 3a0a 2020 2020 2020 2020 2222 2252  et:.        """R
-000229d0: 6574 7572 6e73 2061 206e 6577 206f 626a  eturns a new obj
-000229e0: 6563 7420 7769 7468 2073 7761 7070 6564  ect with swapped
-000229f0: 2064 696d 656e 7369 6f6e 732e 0a0a 2020   dimensions...  
-00022a00: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00022a10: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00022a20: 2d2d 2d0a 2020 2020 2020 2020 6469 6d73  ---.        dims
-00022a30: 5f64 6963 7420 3a20 6469 6374 2d6c 696b  _dict : dict-lik
-00022a40: 650a 2020 2020 2020 2020 2020 2020 4469  e.            Di
-00022a50: 6374 696f 6e61 7279 2077 686f 7365 206b  ctionary whose k
-00022a60: 6579 7320 6172 6520 6375 7272 656e 7420  eys are current 
-00022a70: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
-00022a80: 616e 6420 7768 6f73 6520 7661 6c75 6573  and whose values
-00022a90: 0a20 2020 2020 2020 2020 2020 2061 7265  .            are
-00022aa0: 206e 6577 206e 616d 6573 2e0a 2020 2020   new names..    
-00022ab0: 2020 2020 2a2a 6469 6d73 5f6b 7761 7267      **dims_kwarg
-00022ac0: 7320 3a20 7b65 7869 7374 696e 675f 6469  s : {existing_di
-00022ad0: 6d3a 206e 6577 5f64 696d 2c20 2e2e 2e7d  m: new_dim, ...}
-00022ae0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00022af0: 2020 2020 2020 2054 6865 206b 6579 776f         The keywo
-00022b00: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
-00022b10: 6d20 6f66 2060 6064 696d 735f 6469 6374  m of ``dims_dict
-00022b20: 6060 2e0a 2020 2020 2020 2020 2020 2020  ``..            
-00022b30: 4f6e 6520 6f66 2064 696d 735f 6469 6374  One of dims_dict
-00022b40: 206f 7220 6469 6d73 5f6b 7761 7267 7320   or dims_kwargs 
-00022b50: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
-00022b60: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00022b70: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00022b80: 2d2d 0a20 2020 2020 2020 2073 7761 7070  --.        swapp
-00022b90: 6564 203a 2044 6174 6173 6574 0a20 2020  ed : Dataset.   
-00022ba0: 2020 2020 2020 2020 2044 6174 6173 6574           Dataset
-00022bb0: 2077 6974 6820 7377 6170 7065 6420 6469   with swapped di
-00022bc0: 6d65 6e73 696f 6e73 2e0a 0a20 2020 2020  mensions...     
-00022bd0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-00022be0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00022bf0: 2020 2020 203e 3e3e 2064 7320 3d20 7872       >>> ds = xr
-00022c00: 2e44 6174 6173 6574 280a 2020 2020 2020  .Dataset(.      
-00022c10: 2020 2e2e 2e20 2020 2020 6461 7461 5f76    ...     data_v
-00022c20: 6172 733d 7b22 6122 3a20 2822 7822 2c20  ars={"a": ("x", 
-00022c30: 5b35 2c20 375d 292c 2022 6222 3a20 2822  [5, 7]), "b": ("
-00022c40: 7822 2c20 5b30 2e31 2c20 322e 345d 297d  x", [0.1, 2.4])}
-00022c50: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-00022c60: 2020 636f 6f72 6473 3d7b 2278 223a 205b    coords={"x": [
-00022c70: 2261 222c 2022 6222 5d2c 2022 7922 3a20  "a", "b"], "y": 
-00022c80: 2822 7822 2c20 5b30 2c20 315d 297d 2c0a  ("x", [0, 1])},.
-00022c90: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
-00022ca0: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
-00022cb0: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-00022cc0: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
-00022cd0: 6d65 6e73 696f 6e73 3a20 2028 783a 2032  mensions:  (x: 2
-00022ce0: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
-00022cf0: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
-00022d00: 202a 2078 2020 2020 2020 2020 2878 2920   * x        (x) 
-00022d10: 3c55 3120 2761 2720 2762 270a 2020 2020  <U1 'a' 'b'.    
-00022d20: 2020 2020 2020 2020 7920 2020 2020 2020          y       
-00022d30: 2028 7829 2069 6e74 3634 2030 2031 0a20   (x) int64 0 1. 
-00022d40: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
-00022d50: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-00022d60: 2020 2061 2020 2020 2020 2020 2878 2920     a        (x) 
-00022d70: 696e 7436 3420 3520 370a 2020 2020 2020  int64 5 7.      
-00022d80: 2020 2020 2020 6220 2020 2020 2020 2028        b        (
-00022d90: 7829 2066 6c6f 6174 3634 2030 2e31 2032  x) float64 0.1 2
-00022da0: 2e34 0a0a 2020 2020 2020 2020 3e3e 3e20  .4..        >>> 
-00022db0: 6473 2e73 7761 705f 6469 6d73 287b 2278  ds.swap_dims({"x
-00022dc0: 223a 2022 7922 7d29 0a20 2020 2020 2020  ": "y"}).       
-00022dd0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-00022de0: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-00022df0: 696f 6e73 3a20 2028 793a 2032 290a 2020  ions:  (y: 2).  
-00022e00: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-00022e10: 733a 0a20 2020 2020 2020 2020 2020 2078  s:.            x
-00022e20: 2020 2020 2020 2020 2879 2920 3c55 3120          (y) <U1 
-00022e30: 2761 2720 2762 270a 2020 2020 2020 2020  'a' 'b'.        
-00022e40: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
-00022e50: 2069 6e74 3634 2030 2031 0a20 2020 2020   int64 0 1.     
-00022e60: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-00022e70: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
-00022e80: 2020 2020 2020 2020 2879 2920 696e 7436          (y) int6
-00022e90: 3420 3520 370a 2020 2020 2020 2020 2020  4 5 7.          
-00022ea0: 2020 6220 2020 2020 2020 2028 7929 2066    b        (y) f
-00022eb0: 6c6f 6174 3634 2030 2e31 2032 2e34 0a0a  loat64 0.1 2.4..
-00022ec0: 2020 2020 2020 2020 3e3e 3e20 6473 2e73          >>> ds.s
-00022ed0: 7761 705f 6469 6d73 287b 2278 223a 2022  wap_dims({"x": "
-00022ee0: 7a22 7d29 0a20 2020 2020 2020 203c 7861  z"}).        <xa
-00022ef0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-00022f00: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-00022f10: 3a20 2028 7a3a 2032 290a 2020 2020 2020  :  (z: 2).      
-00022f20: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-00022f30: 2020 2020 2020 2020 2020 2078 2020 2020             x    
-00022f40: 2020 2020 287a 2920 3c55 3120 2761 2720      (z) <U1 'a' 
-00022f50: 2762 270a 2020 2020 2020 2020 2020 2020  'b'.            
-00022f60: 7920 2020 2020 2020 2028 7a29 2069 6e74  y        (z) int
-00022f70: 3634 2030 2031 0a20 2020 2020 2020 2044  64 0 1.        D
-00022f80: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
-00022f90: 7420 636f 6f72 6469 6e61 7465 733a 207a  t coordinates: z
-00022fa0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-00022fb0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00022fc0: 2020 2020 2061 2020 2020 2020 2020 287a       a        (z
-00022fd0: 2920 696e 7436 3420 3520 370a 2020 2020  ) int64 5 7.    
-00022fe0: 2020 2020 2020 2020 6220 2020 2020 2020          b       
-00022ff0: 2028 7a29 2066 6c6f 6174 3634 2030 2e31   (z) float64 0.1
-00023000: 2032 2e34 0a0a 2020 2020 2020 2020 5365   2.4..        Se
-00023010: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00023020: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00023030: 4461 7461 7365 742e 7265 6e61 6d65 0a20  Dataset.rename. 
-00023040: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
-00023050: 2e73 7761 705f 6469 6d73 0a20 2020 2020  .swap_dims.     
-00023060: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-00023070: 2054 4f44 4f3a 2064 6570 7265 6361 7465   TODO: deprecate
-00023080: 2074 6869 7320 6d65 7468 6f64 2069 6e20   this method in 
-00023090: 6661 766f 7220 6f66 2061 2028 6c65 7373  favor of a (less
-000230a0: 2063 6f6e 6675 7369 6e67 290a 2020 2020   confusing).    
-000230b0: 2020 2020 2320 7265 6e61 6d65 5f64 696d      # rename_dim
-000230c0: 7328 2920 6d65 7468 6f64 2074 6861 7420  s() method that 
-000230d0: 6f6e 6c79 2072 656e 616d 6573 2064 696d  only renames dim
-000230e0: 656e 7369 6f6e 732e 0a0a 2020 2020 2020  ensions...      
-000230f0: 2020 6469 6d73 5f64 6963 7420 3d20 6569    dims_dict = ei
-00023100: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
-00023110: 7267 7328 6469 6d73 5f64 6963 742c 2064  rgs(dims_dict, d
-00023120: 696d 735f 6b77 6172 6773 2c20 2273 7761  ims_kwargs, "swa
-00023130: 705f 6469 6d73 2229 0a20 2020 2020 2020  p_dims").       
-00023140: 2066 6f72 206b 2c20 7620 696e 2064 696d   for k, v in dim
-00023150: 735f 6469 6374 2e69 7465 6d73 2829 3a0a  s_dict.items():.
-00023160: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00023170: 206e 6f74 2069 6e20 7365 6c66 2e64 696d   not in self.dim
-00023180: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00023190: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000231a0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-000231b0: 2020 2020 2020 2020 2066 2263 616e 6e6f           f"canno
-000231c0: 7420 7377 6170 2066 726f 6d20 6469 6d65  t swap from dime
-000231d0: 6e73 696f 6e20 7b6b 2172 7d20 6265 6361  nsion {k!r} beca
-000231e0: 7573 6520 6974 2069 7320 220a 2020 2020  use it is ".    
-000231f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023200: 226e 6f74 2061 6e20 6578 6973 7469 6e67  "not an existing
-00023210: 2064 696d 656e 7369 6f6e 220a 2020 2020   dimension".    
-00023220: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00023230: 2020 2020 2020 2020 2020 6966 2076 2069            if v i
-00023240: 6e20 7365 6c66 2e76 6172 6961 626c 6573  n self.variables
-00023250: 2061 6e64 2073 656c 662e 7661 7269 6162   and self.variab
-00023260: 6c65 735b 765d 2e64 696d 7320 213d 2028  les[v].dims != (
-00023270: 6b2c 293a 0a20 2020 2020 2020 2020 2020  k,):.           
-00023280: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00023290: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-000232a0: 2020 2020 2020 2020 2020 2066 2272 6570             f"rep
-000232b0: 6c61 6365 6d65 6e74 2064 696d 656e 7369  lacement dimensi
-000232c0: 6f6e 207b 7621 727d 2069 7320 6e6f 7420  on {v!r} is not 
-000232d0: 6120 3144 2022 0a20 2020 2020 2020 2020  a 1D ".         
-000232e0: 2020 2020 2020 2020 2020 2066 2276 6172             f"var
-000232f0: 6961 626c 6520 616c 6f6e 6720 7468 6520  iable along the 
-00023300: 6f6c 6420 6469 6d65 6e73 696f 6e20 7b6b  old dimension {k
-00023310: 2172 7d22 0a20 2020 2020 2020 2020 2020  !r}".           
-00023320: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00023330: 7265 7375 6c74 5f64 696d 7320 3d20 7b64  result_dims = {d
-00023340: 696d 735f 6469 6374 2e67 6574 2864 696d  ims_dict.get(dim
-00023350: 2c20 6469 6d29 2066 6f72 2064 696d 2069  , dim) for dim i
-00023360: 6e20 7365 6c66 2e64 696d 737d 0a0a 2020  n self.dims}..  
-00023370: 2020 2020 2020 636f 6f72 645f 6e61 6d65        coord_name
-00023380: 7320 3d20 7365 6c66 2e5f 636f 6f72 645f  s = self._coord_
-00023390: 6e61 6d65 732e 636f 7079 2829 0a20 2020  names.copy().   
-000233a0: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
-000233b0: 2e75 7064 6174 6528 7b64 696d 2066 6f72  .update({dim for
-000233c0: 2064 696d 2069 6e20 6469 6d73 5f64 6963   dim in dims_dic
-000233d0: 742e 7661 6c75 6573 2829 2069 6620 6469  t.values() if di
-000233e0: 6d20 696e 2073 656c 662e 7661 7269 6162  m in self.variab
-000233f0: 6c65 737d 290a 0a20 2020 2020 2020 2076  les})..        v
-00023400: 6172 6961 626c 6573 3a20 6469 6374 5b48  ariables: dict[H
-00023410: 6173 6861 626c 652c 2056 6172 6961 626c  ashable, Variabl
-00023420: 655d 203d 207b 7d0a 2020 2020 2020 2020  e] = {}.        
-00023430: 696e 6465 7865 733a 2064 6963 745b 4861  indexes: dict[Ha
-00023440: 7368 6162 6c65 2c20 496e 6465 785d 203d  shable, Index] =
-00023450: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-00023460: 6b2c 2076 2069 6e20 7365 6c66 2e76 6172  k, v in self.var
-00023470: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
-00023480: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
-00023490: 203d 2074 7570 6c65 2864 696d 735f 6469   = tuple(dims_di
-000234a0: 6374 2e67 6574 2864 696d 2c20 6469 6d29  ct.get(dim, dim)
-000234b0: 2066 6f72 2064 696d 2069 6e20 762e 6469   for dim in v.di
-000234c0: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-000234d0: 7661 723a 2056 6172 6961 626c 650a 2020  var: Variable.  
-000234e0: 2020 2020 2020 2020 2020 6966 206b 2069            if k i
-000234f0: 6e20 7265 7375 6c74 5f64 696d 733a 0a20  n result_dims:. 
-00023500: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00023510: 6172 203d 2076 2e74 6f5f 696e 6465 785f  ar = v.to_index_
-00023520: 7661 7269 6162 6c65 2829 0a20 2020 2020  variable().     
-00023530: 2020 2020 2020 2020 2020 2076 6172 2e64             var.d
-00023540: 696d 7320 3d20 6469 6d73 0a20 2020 2020  ims = dims.     
-00023550: 2020 2020 2020 2020 2020 2069 6620 6b20             if k 
-00023560: 696e 2073 656c 662e 5f69 6e64 6578 6573  in self._indexes
-00023570: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023580: 2020 2020 2020 696e 6465 7865 735b 6b5d        indexes[k]
-00023590: 203d 2073 656c 662e 5f69 6e64 6578 6573   = self._indexes
-000235a0: 5b6b 5d0a 2020 2020 2020 2020 2020 2020  [k].            
-000235b0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-000235c0: 735b 6b5d 203d 2076 6172 0a20 2020 2020  s[k] = var.     
-000235d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000235e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000235f0: 2020 2020 2069 6e64 6578 2c20 696e 6465       index, inde
-00023600: 785f 7661 7273 203d 2063 7265 6174 655f  x_vars = create_
-00023610: 6465 6661 756c 745f 696e 6465 785f 696d  default_index_im
-00023620: 706c 6963 6974 2876 6172 290a 2020 2020  plicit(var).    
-00023630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023640: 696e 6465 7865 732e 7570 6461 7465 287b  indexes.update({
-00023650: 6e61 6d65 3a20 696e 6465 7820 666f 7220  name: index for 
-00023660: 6e61 6d65 2069 6e20 696e 6465 785f 7661  name in index_va
-00023670: 7273 7d29 0a20 2020 2020 2020 2020 2020  rs}).           
-00023680: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00023690: 6573 2e75 7064 6174 6528 696e 6465 785f  es.update(index_
-000236a0: 7661 7273 290a 2020 2020 2020 2020 2020  vars).          
-000236b0: 2020 2020 2020 2020 2020 636f 6f72 645f            coord_
-000236c0: 6e61 6d65 732e 7570 6461 7465 2869 6e64  names.update(ind
-000236d0: 6578 5f76 6172 7329 0a20 2020 2020 2020  ex_vars).       
-000236e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000236f0: 2020 2020 2020 2020 2020 2076 6172 203d             var =
-00023700: 2076 2e74 6f5f 6261 7365 5f76 6172 6961   v.to_base_varia
-00023710: 626c 6528 290a 2020 2020 2020 2020 2020  ble().          
-00023720: 2020 2020 2020 7661 722e 6469 6d73 203d        var.dims =
-00023730: 2064 696d 730a 2020 2020 2020 2020 2020   dims.          
-00023740: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
-00023750: 6b5d 203d 2076 6172 0a0a 2020 2020 2020  k] = var..      
-00023760: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-00023770: 6570 6c61 6365 5f77 6974 685f 6e65 775f  eplace_with_new_
-00023780: 6469 6d73 2876 6172 6961 626c 6573 2c20  dims(variables, 
-00023790: 636f 6f72 645f 6e61 6d65 732c 2069 6e64  coord_names, ind
-000237a0: 6578 6573 3d69 6e64 6578 6573 290a 0a20  exes=indexes).. 
-000237b0: 2020 2023 2063 6861 6e67 6520 7479 7065     # change type
-000237c0: 206f 6620 7365 6c66 2061 6e64 2072 6574   of self and ret
-000237d0: 7572 6e20 746f 2054 5f44 6174 6173 6574  urn to T_Dataset
-000237e0: 206f 6e63 650a 2020 2020 2320 6874 7470   once.    # http
-000237f0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
-00023800: 7974 686f 6e2f 6d79 7079 2f69 7373 7565  ython/mypy/issue
-00023810: 732f 3132 3834 3620 6973 2072 6573 6f6c  s/12846 is resol
-00023820: 7665 640a 2020 2020 6465 6620 6578 7061  ved.    def expa
-00023830: 6e64 5f64 696d 7328 0a20 2020 2020 2020  nd_dims(.       
-00023840: 2073 656c 662c 0a20 2020 2020 2020 2064   self,.        d
-00023850: 696d 3a20 4e6f 6e65 207c 2048 6173 6861  im: None | Hasha
-00023860: 626c 6520 7c20 5365 7175 656e 6365 5b48  ble | Sequence[H
-00023870: 6173 6861 626c 655d 207c 204d 6170 7069  ashable] | Mappi
-00023880: 6e67 5b41 6e79 2c20 416e 795d 203d 204e  ng[Any, Any] = N
-00023890: 6f6e 652c 0a20 2020 2020 2020 2061 7869  one,.        axi
-000238a0: 733a 204e 6f6e 6520 7c20 696e 7420 7c20  s: None | int | 
-000238b0: 5365 7175 656e 6365 5b69 6e74 5d20 3d20  Sequence[int] = 
-000238c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
-000238d0: 6469 6d5f 6b77 6172 6773 3a20 416e 792c  dim_kwargs: Any,
-000238e0: 0a20 2020 2029 202d 3e20 4461 7461 7365  .    ) -> Datase
-000238f0: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
-00023900: 7475 726e 2061 206e 6577 206f 626a 6563  turn a new objec
-00023910: 7420 7769 7468 2061 6e20 6164 6469 7469  t with an additi
-00023920: 6f6e 616c 2061 7869 7320 286f 7220 6178  onal axis (or ax
-00023930: 6573 2920 696e 7365 7274 6564 2061 740a  es) inserted at.
-00023940: 2020 2020 2020 2020 7468 6520 636f 7272          the corr
-00023950: 6573 706f 6e64 696e 6720 706f 7369 7469  esponding positi
-00023960: 6f6e 2069 6e20 7468 6520 6172 7261 7920  on in the array 
-00023970: 7368 6170 652e 2020 5468 6520 6e65 7720  shape.  The new 
-00023980: 6f62 6a65 6374 2069 7320 610a 2020 2020  object is a.    
-00023990: 2020 2020 7669 6577 2069 6e74 6f20 7468      view into th
-000239a0: 6520 756e 6465 726c 7969 6e67 2061 7272  e underlying arr
-000239b0: 6179 2c20 6e6f 7420 6120 636f 7079 2e0a  ay, not a copy..
-000239c0: 0a20 2020 2020 2020 2049 6620 6469 6d20  .        If dim 
-000239d0: 6973 2061 6c72 6561 6479 2061 2073 6361  is already a sca
-000239e0: 6c61 7220 636f 6f72 6469 6e61 7465 2c20  lar coordinate, 
-000239f0: 6974 2077 696c 6c20 6265 2070 726f 6d6f  it will be promo
-00023a00: 7465 6420 746f 2061 2031 440a 2020 2020  ted to a 1D.    
-00023a10: 2020 2020 636f 6f72 6469 6e61 7465 2063      coordinate c
-00023a20: 6f6e 7369 7374 696e 6720 6f66 2061 2073  onsisting of a s
-00023a30: 696e 676c 6520 7661 6c75 652e 0a0a 2020  ingle value...  
-00023a40: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00023a50: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00023a60: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
-00023a70: 3a20 6861 7368 6162 6c65 2c20 7365 7175  : hashable, sequ
-00023a80: 656e 6365 206f 6620 6861 7368 6162 6c65  ence of hashable
-00023a90: 2c20 6d61 7070 696e 672c 206f 7220 4e6f  , mapping, or No
-00023aa0: 6e65 0a20 2020 2020 2020 2020 2020 2044  ne.            D
-00023ab0: 696d 656e 7369 6f6e 7320 746f 2069 6e63  imensions to inc
-00023ac0: 6c75 6465 206f 6e20 7468 6520 6e65 7720  lude on the new 
-00023ad0: 7661 7269 6162 6c65 2e20 4966 2070 726f  variable. If pro
-00023ae0: 7669 6465 6420 6173 2068 6173 6861 626c  vided as hashabl
-00023af0: 650a 2020 2020 2020 2020 2020 2020 6f72  e.            or
-00023b00: 2073 6571 7565 6e63 6520 6f66 2068 6173   sequence of has
-00023b10: 6861 626c 652c 2074 6865 6e20 6469 6d65  hable, then dime
-00023b20: 6e73 696f 6e73 2061 7265 2069 6e73 6572  nsions are inser
-00023b30: 7465 6420 7769 7468 206c 656e 6774 680a  ted with length.
-00023b40: 2020 2020 2020 2020 2020 2020 312e 2049              1. I
-00023b50: 6620 7072 6f76 6964 6564 2061 7320 6120  f provided as a 
-00023b60: 6d61 7070 696e 672c 2074 6865 6e20 7468  mapping, then th
-00023b70: 6520 6b65 7973 2061 7265 2074 6865 206e  e keys are the n
-00023b80: 6577 2064 696d 656e 7369 6f6e 730a 2020  ew dimensions.  
-00023b90: 2020 2020 2020 2020 2020 616e 6420 7468            and th
-00023ba0: 6520 7661 6c75 6573 2061 7265 2065 6974  e values are eit
-00023bb0: 6865 7220 696e 7465 6765 7273 2028 6769  her integers (gi
-00023bc0: 7669 6e67 2074 6865 206c 656e 6774 6820  ving the length 
-00023bd0: 6f66 2074 6865 206e 6577 0a20 2020 2020  of the new.     
-00023be0: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
-00023bf0: 7329 206f 7220 6172 7261 792d 6c69 6b65  s) or array-like
-00023c00: 2028 6769 7669 6e67 2074 6865 2063 6f6f   (giving the coo
-00023c10: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
-00023c20: 6e65 770a 2020 2020 2020 2020 2020 2020  new.            
-00023c30: 6469 6d65 6e73 696f 6e73 292e 0a20 2020  dimensions)..   
-00023c40: 2020 2020 2061 7869 7320 3a20 696e 742c       axis : int,
-00023c50: 2073 6571 7565 6e63 6520 6f66 2069 6e74   sequence of int
-00023c60: 2c20 6f72 204e 6f6e 652c 2064 6566 6175  , or None, defau
-00023c70: 6c74 3a20 4e6f 6e65 0a20 2020 2020 2020  lt: None.       
-00023c80: 2020 2020 2041 7869 7320 706f 7369 7469       Axis positi
-00023c90: 6f6e 2873 2920 7768 6572 6520 6e65 7720  on(s) where new 
-00023ca0: 6178 6973 2069 7320 746f 2062 6520 696e  axis is to be in
-00023cb0: 7365 7274 6564 2028 706f 7369 7469 6f6e  serted (position
-00023cc0: 2873 2920 6f6e 0a20 2020 2020 2020 2020  (s) on.         
-00023cd0: 2020 2074 6865 2072 6573 756c 7420 6172     the result ar
-00023ce0: 7261 7929 2e20 4966 2061 2073 6571 7565  ray). If a seque
-00023cf0: 6e63 6520 6f66 2069 6e74 6567 6572 7320  nce of integers 
-00023d00: 6973 2070 6173 7365 642c 0a20 2020 2020  is passed,.     
-00023d10: 2020 2020 2020 206d 756c 7469 706c 6520         multiple 
-00023d20: 6178 6573 2061 7265 2069 6e73 6572 7465  axes are inserte
-00023d30: 642e 2049 6e20 7468 6973 2063 6173 652c  d. In this case,
-00023d40: 2064 696d 2061 7267 756d 656e 7473 2073   dim arguments s
-00023d50: 686f 756c 6420 6265 0a20 2020 2020 2020  hould be.       
-00023d60: 2020 2020 2073 616d 6520 6c65 6e67 7468       same length
-00023d70: 206c 6973 742e 2049 6620 6178 6973 3d4e   list. If axis=N
-00023d80: 6f6e 6520 6973 2070 6173 7365 642c 2061  one is passed, a
-00023d90: 6c6c 2074 6865 2061 7865 7320 7769 6c6c  ll the axes will
-00023da0: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
-00023db0: 696e 7365 7274 6564 2074 6f20 7468 6520  inserted to the 
-00023dc0: 7374 6172 7420 6f66 2074 6865 2072 6573  start of the res
-00023dd0: 756c 7420 6172 7261 792e 0a20 2020 2020  ult array..     
-00023de0: 2020 202a 2a64 696d 5f6b 7761 7267 7320     **dim_kwargs 
-00023df0: 3a20 696e 7420 6f72 2073 6571 7565 6e63  : int or sequenc
-00023e00: 6520 6f72 206e 6461 7272 6179 0a20 2020  e or ndarray.   
-00023e10: 2020 2020 2020 2020 2054 6865 206b 6579           The key
-00023e20: 776f 7264 7320 6172 6520 6172 6269 7472  words are arbitr
-00023e30: 6172 7920 6469 6d65 6e73 696f 6e73 2062  ary dimensions b
-00023e40: 6569 6e67 2069 6e73 6572 7465 6420 616e  eing inserted an
-00023e50: 6420 7468 6520 7661 6c75 6573 0a20 2020  d the values.   
-00023e60: 2020 2020 2020 2020 2061 7265 2065 6974           are eit
-00023e70: 6865 7220 7468 6520 6c65 6e67 7468 7320  her the lengths 
-00023e80: 6f66 2074 6865 206e 6577 2064 696d 7320  of the new dims 
-00023e90: 2869 6620 696e 7420 6973 2067 6976 656e  (if int is given
-00023ea0: 292c 206f 7220 7468 6569 720a 2020 2020  ), or their.    
-00023eb0: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
-00023ec0: 7465 732e 204e 6f74 652c 2074 6869 7320  tes. Note, this 
-00023ed0: 6973 2061 6e20 616c 7465 726e 6174 6976  is an alternativ
-00023ee0: 6520 746f 2070 6173 7369 6e67 2061 2064  e to passing a d
-00023ef0: 6963 7420 746f 2074 6865 0a20 2020 2020  ict to the.     
-00023f00: 2020 2020 2020 2064 696d 206b 7761 7267         dim kwarg
-00023f10: 2061 6e64 2077 696c 6c20 6f6e 6c79 2062   and will only b
-00023f20: 6520 7573 6564 2069 6620 6469 6d20 6973  e used if dim is
-00023f30: 204e 6f6e 652e 0a0a 2020 2020 2020 2020   None...        
-00023f40: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-00023f50: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00023f60: 6578 7061 6e64 6564 203a 2044 6174 6173  expanded : Datas
-00023f70: 6574 0a20 2020 2020 2020 2020 2020 2054  et.            T
-00023f80: 6869 7320 6f62 6a65 6374 2c20 6275 7420  his object, but 
-00023f90: 7769 7468 2061 6464 6974 696f 6e61 6c20  with additional 
-00023fa0: 6469 6d65 6e73 696f 6e28 7329 2e0a 0a20  dimension(s)... 
-00023fb0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00023fc0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00023fd0: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-00023fe0: 6179 2e65 7870 616e 645f 6469 6d73 0a20  ay.expand_dims. 
-00023ff0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00024000: 2020 2069 6620 6469 6d20 6973 204e 6f6e     if dim is Non
-00024010: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00024020: 6173 730a 2020 2020 2020 2020 656c 6966  ass.        elif
-00024030: 2069 7369 6e73 7461 6e63 6528 6469 6d2c   isinstance(dim,
-00024040: 204d 6170 7069 6e67 293a 0a20 2020 2020   Mapping):.     
-00024050: 2020 2020 2020 2023 2057 6527 7265 206c         # We're l
-00024060: 6174 6572 2067 6f69 6e67 2074 6f20 6d6f  ater going to mo
-00024070: 6469 6679 2064 696d 2069 6e20 706c 6163  dify dim in plac
-00024080: 653b 2064 6f6e 2774 2074 616d 7065 7220  e; don't tamper 
-00024090: 7769 7468 0a20 2020 2020 2020 2020 2020  with.           
-000240a0: 2023 2074 6865 2069 6e70 7574 0a20 2020   # the input.   
-000240b0: 2020 2020 2020 2020 2064 696d 203d 2064           dim = d
-000240c0: 6963 7428 6469 6d29 0a20 2020 2020 2020  ict(dim).       
-000240d0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-000240e0: 2864 696d 2c20 696e 7429 3a0a 2020 2020  (dim, int):.    
-000240f0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00024100: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
-00024110: 2020 2020 2020 2020 2022 6469 6d20 7368           "dim sh
-00024120: 6f75 6c64 2062 6520 6861 7368 6162 6c65  ould be hashable
-00024130: 206f 7220 7365 7175 656e 6365 206f 6620   or sequence of 
-00024140: 6861 7368 6162 6c65 7320 6f72 206d 6170  hashables or map
-00024150: 7069 6e67 220a 2020 2020 2020 2020 2020  ping".          
-00024160: 2020 290a 2020 2020 2020 2020 656c 6966    ).        elif
-00024170: 2069 7369 6e73 7461 6e63 6528 6469 6d2c   isinstance(dim,
-00024180: 2073 7472 2920 6f72 206e 6f74 2069 7369   str) or not isi
-00024190: 6e73 7461 6e63 6528 6469 6d2c 2053 6571  nstance(dim, Seq
-000241a0: 7565 6e63 6529 3a0a 2020 2020 2020 2020  uence):.        
-000241b0: 2020 2020 6469 6d20 3d20 7b64 696d 3a20      dim = {dim: 
-000241c0: 317d 0a20 2020 2020 2020 2065 6c69 6620  1}.        elif 
-000241d0: 6973 696e 7374 616e 6365 2864 696d 2c20  isinstance(dim, 
-000241e0: 5365 7175 656e 6365 293a 0a20 2020 2020  Sequence):.     
-000241f0: 2020 2020 2020 2069 6620 6c65 6e28 6469         if len(di
-00024200: 6d29 2021 3d20 6c65 6e28 7365 7428 6469  m) != len(set(di
-00024210: 6d29 293a 0a20 2020 2020 2020 2020 2020  m)):.           
-00024220: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00024230: 4572 726f 7228 2264 696d 7320 7368 6f75  Error("dims shou
-00024240: 6c64 206e 6f74 2063 6f6e 7461 696e 2064  ld not contain d
-00024250: 7570 6c69 6361 7465 2076 616c 7565 732e  uplicate values.
-00024260: 2229 0a20 2020 2020 2020 2020 2020 2064  ").            d
-00024270: 696d 203d 207b 643a 2031 2066 6f72 2064  im = {d: 1 for d
-00024280: 2069 6e20 6469 6d7d 0a0a 2020 2020 2020   in dim}..      
-00024290: 2020 6469 6d20 3d20 6569 7468 6572 5f64    dim = either_d
-000242a0: 6963 745f 6f72 5f6b 7761 7267 7328 6469  ict_or_kwargs(di
-000242b0: 6d2c 2064 696d 5f6b 7761 7267 732c 2022  m, dim_kwargs, "
-000242c0: 6578 7061 6e64 5f64 696d 7322 290a 2020  expand_dims").  
-000242d0: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
-000242e0: 6e73 7461 6e63 6528 6469 6d2c 204d 7574  nstance(dim, Mut
-000242f0: 6162 6c65 4d61 7070 696e 6729 0a0a 2020  ableMapping)..  
-00024300: 2020 2020 2020 6966 2061 7869 7320 6973        if axis is
-00024310: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00024320: 2020 2061 7869 7320 3d20 6c69 7374 2872     axis = list(r
-00024330: 616e 6765 286c 656e 2864 696d 2929 290a  ange(len(dim))).
-00024340: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
-00024350: 2069 7369 6e73 7461 6e63 6528 6178 6973   isinstance(axis
-00024360: 2c20 5365 7175 656e 6365 293a 0a20 2020  , Sequence):.   
-00024370: 2020 2020 2020 2020 2061 7869 7320 3d20           axis = 
-00024380: 5b61 7869 735d 0a0a 2020 2020 2020 2020  [axis]..        
-00024390: 6966 206c 656e 2864 696d 2920 213d 206c  if len(dim) != l
-000243a0: 656e 2861 7869 7329 3a0a 2020 2020 2020  en(axis):.      
-000243b0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000243c0: 6545 7272 6f72 2822 6c65 6e67 7468 7320  eError("lengths 
-000243d0: 6f66 2064 696d 2061 6e64 2061 7869 7320  of dim and axis 
-000243e0: 7368 6f75 6c64 2062 6520 6964 656e 7469  should be identi
-000243f0: 6361 6c2e 2229 0a20 2020 2020 2020 2066  cal.").        f
-00024400: 6f72 2064 2069 6e20 6469 6d3a 0a20 2020  or d in dim:.   
-00024410: 2020 2020 2020 2020 2069 6620 6420 696e           if d in
-00024420: 2073 656c 662e 6469 6d73 3a0a 2020 2020   self.dims:.    
-00024430: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00024440: 6520 5661 6c75 6545 7272 6f72 2866 2244  e ValueError(f"D
-00024450: 696d 656e 7369 6f6e 207b 647d 2061 6c72  imension {d} alr
-00024460: 6561 6479 2065 7869 7374 732e 2229 0a20  eady exists."). 
-00024470: 2020 2020 2020 2020 2020 2069 6620 6420             if d 
-00024480: 696e 2073 656c 662e 5f76 6172 6961 626c  in self._variabl
-00024490: 6573 2061 6e64 206e 6f74 2075 7469 6c73  es and not utils
-000244a0: 2e69 735f 7363 616c 6172 2873 656c 662e  .is_scalar(self.
-000244b0: 5f76 6172 6961 626c 6573 5b64 5d29 3a0a  _variables[d]):.
-000244c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000244e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000244f0: 2020 2020 2020 227b 6469 6d7d 2061 6c72        "{dim} alr
-00024500: 6561 6479 2065 7869 7374 7320 6173 2063  eady exists as c
-00024510: 6f6f 7264 696e 6174 6520 6f72 220a 2020  oordinate or".  
-00024520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024530: 2020 2220 7661 7269 6162 6c65 206e 616d    " variable nam
-00024540: 652e 222e 666f 726d 6174 2864 696d 3d64  e.".format(dim=d
-00024550: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00024560: 2020 290a 0a20 2020 2020 2020 2076 6172    )..        var
-00024570: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
-00024580: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-00024590: 203d 207b 7d0a 2020 2020 2020 2020 696e   = {}.        in
-000245a0: 6465 7865 733a 2064 6963 745b 4861 7368  dexes: dict[Hash
-000245b0: 6162 6c65 2c20 496e 6465 785d 203d 2064  able, Index] = d
-000245c0: 6963 7428 7365 6c66 2e5f 696e 6465 7865  ict(self._indexe
-000245d0: 7329 0a20 2020 2020 2020 2063 6f6f 7264  s).        coord
-000245e0: 5f6e 616d 6573 203d 2073 656c 662e 5f63  _names = self._c
-000245f0: 6f6f 7264 5f6e 616d 6573 2e63 6f70 7928  oord_names.copy(
-00024600: 290a 2020 2020 2020 2020 2320 4966 2064  ).        # If d
-00024610: 696d 2069 7320 6120 6469 6374 2c20 7468  im is a dict, th
-00024620: 656e 2065 6e73 7572 6520 7468 6174 2074  en ensure that t
-00024630: 6865 2076 616c 7565 7320 6172 6520 6569  he values are ei
-00024640: 7468 6572 2069 6e74 6567 6572 730a 2020  ther integers.  
-00024650: 2020 2020 2020 2320 6f72 2069 7465 7261        # or itera
-00024660: 626c 6573 2e0a 2020 2020 2020 2020 666f  bles..        fo
-00024670: 7220 6b2c 2076 2069 6e20 6469 6d2e 6974  r k, v in dim.it
-00024680: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00024690: 2020 2069 6620 6861 7361 7474 7228 762c     if hasattr(v,
-000246a0: 2022 5f5f 6974 6572 5f5f 2229 3a0a 2020   "__iter__"):.  
-000246b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000246c0: 4966 2074 6865 2076 616c 7565 2066 6f72  If the value for
-000246d0: 2074 6865 206e 6577 2064 696d 656e 7369   the new dimensi
-000246e0: 6f6e 2069 7320 616e 2069 7465 7261 626c  on is an iterabl
-000246f0: 652c 2074 6865 6e0a 2020 2020 2020 2020  e, then.        
-00024700: 2020 2020 2020 2020 2320 7361 7665 2074          # save t
-00024710: 6865 2063 6f6f 7264 696e 6174 6573 2074  he coordinates t
-00024720: 6f20 7468 6520 7661 7269 6162 6c65 7320  o the variables 
-00024730: 6469 6374 2c20 616e 6420 7365 7420 7468  dict, and set th
-00024740: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00024750: 2020 2320 7661 6c75 6520 7769 7468 696e    # value within
-00024760: 2074 6865 2064 696d 2064 6963 7420 746f   the dim dict to
-00024770: 2074 6865 206c 656e 6774 6820 6f66 2074   the length of t
-00024780: 6865 2069 7465 7261 626c 650a 2020 2020  he iterable.    
-00024790: 2020 2020 2020 2020 2020 2020 2320 666f              # fo
-000247a0: 7220 6c61 7465 7220 7573 652e 0a20 2020  r later use..   
-000247b0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-000247c0: 6578 203d 2050 616e 6461 7349 6e64 6578  ex = PandasIndex
-000247d0: 2876 2c20 6b29 0a20 2020 2020 2020 2020  (v, k).         
-000247e0: 2020 2020 2020 2069 6e64 6578 6573 5b6b         indexes[k
-000247f0: 5d20 3d20 696e 6465 780a 2020 2020 2020  ] = index.      
-00024800: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-00024810: 6c65 732e 7570 6461 7465 2869 6e64 6578  les.update(index
-00024820: 2e63 7265 6174 655f 7661 7269 6162 6c65  .create_variable
-00024830: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
-00024840: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
-00024850: 2e61 6464 286b 290a 2020 2020 2020 2020  .add(k).        
-00024860: 2020 2020 2020 2020 6469 6d5b 6b5d 203d          dim[k] =
-00024870: 2076 6172 6961 626c 6573 5b6b 5d2e 7369   variables[k].si
-00024880: 7a65 0a20 2020 2020 2020 2020 2020 2065  ze.            e
-00024890: 6c69 6620 6973 696e 7374 616e 6365 2876  lif isinstance(v
-000248a0: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
-000248b0: 2020 2020 2020 2020 7061 7373 2020 2320          pass  # 
-000248c0: 446f 206e 6f74 6869 6e67 2069 6620 7468  Do nothing if th
-000248d0: 6520 6469 6d65 6e73 696f 6e73 2076 616c  e dimensions val
-000248e0: 7565 2069 7320 6a75 7374 2061 6e20 696e  ue is just an in
-000248f0: 740a 2020 2020 2020 2020 2020 2020 656c  t.            el
-00024900: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00024910: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-00024920: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00024930: 2020 2020 2020 2020 2022 5468 6520 7661           "The va
-00024940: 6c75 6520 6f66 206e 6577 2064 696d 656e  lue of new dimen
-00024950: 7369 6f6e 207b 6b7d 206d 7573 7420 6265  sion {k} must be
-00024960: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00024970: 2020 2020 2020 2022 616e 2069 7465 7261         "an itera
-00024980: 626c 6520 6f72 2061 6e20 696e 7422 2e66  ble or an int".f
-00024990: 6f72 6d61 7428 6b3d 6b29 0a20 2020 2020  ormat(k=k).     
-000249a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000249b0: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
-000249c0: 6e20 7365 6c66 2e5f 7661 7269 6162 6c65  n self._variable
-000249d0: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-000249e0: 2020 2020 2020 2069 6620 6b20 6e6f 7420         if k not 
-000249f0: 696e 2064 696d 3a0a 2020 2020 2020 2020  in dim:.        
-00024a00: 2020 2020 2020 2020 6966 206b 2069 6e20          if k in 
-00024a10: 636f 6f72 645f 6e61 6d65 733a 2020 2320  coord_names:  # 
-00024a20: 446f 206e 6f74 2063 6861 6e67 6520 636f  Do not change co
-00024a30: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
-00024a40: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00024a50: 7269 6162 6c65 735b 6b5d 203d 2076 0a20  riables[k] = v. 
-00024a60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00024a70: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00024a80: 2020 2020 2020 2020 2072 6573 756c 745f           result_
-00024a90: 6e64 696d 203d 206c 656e 2876 2e64 696d  ndim = len(v.dim
-00024aa0: 7329 202b 206c 656e 2861 7869 7329 0a20  s) + len(axis). 
-00024ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ac0: 2020 2066 6f72 2061 2069 6e20 6178 6973     for a in axis
-00024ad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00024ae0: 2020 2020 2020 2020 2020 6966 2061 203c            if a <
-00024af0: 202d 7265 7375 6c74 5f6e 6469 6d20 6f72   -result_ndim or
-00024b00: 2072 6573 756c 745f 6e64 696d 202d 2031   result_ndim - 1
-00024b10: 203c 2061 3a0a 2020 2020 2020 2020 2020   < a:.          
-00024b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024b30: 2020 7261 6973 6520 496e 6465 7845 7272    raise IndexErr
-00024b40: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00024b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024b60: 2020 2020 6622 4178 6973 207b 617d 206f      f"Axis {a} o
-00024b70: 6620 7661 7269 6162 6c65 207b 6b7d 2069  f variable {k} i
-00024b80: 7320 6f75 7420 6f66 2062 6f75 6e64 7320  s out of bounds 
-00024b90: 6f66 2074 6865 2022 0a20 2020 2020 2020  of the ".       
-00024ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024bb0: 2020 2020 2020 2020 2066 2265 7870 616e           f"expan
-00024bc0: 6465 6420 6469 6d65 6e73 696f 6e20 7369  ded dimension si
-00024bd0: 7a65 207b 7265 7375 6c74 5f6e 6469 6d7d  ze {result_ndim}
-00024be0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00024bf0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00024c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024c10: 2020 2020 2061 7869 735f 706f 7320 3d20       axis_pos = 
-00024c20: 5b61 2069 6620 6120 3e3d 2030 2065 6c73  [a if a >= 0 els
-00024c30: 6520 7265 7375 6c74 5f6e 6469 6d20 2b20  e result_ndim + 
-00024c40: 6120 666f 7220 6120 696e 2061 7869 735d  a for a in axis]
-00024c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024c60: 2020 2020 2069 6620 6c65 6e28 6178 6973       if len(axis
-00024c70: 5f70 6f73 2920 213d 206c 656e 2873 6574  _pos) != len(set
-00024c80: 2861 7869 735f 706f 7329 293a 0a20 2020  (axis_pos)):.   
-00024c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ca0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00024cb0: 4572 726f 7228 2261 7869 7320 7368 6f75  Error("axis shou
-00024cc0: 6c64 206e 6f74 2063 6f6e 7461 696e 2064  ld not contain d
-00024cd0: 7570 6c69 6361 7465 2076 616c 7565 7322  uplicate values"
-00024ce0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00024cf0: 2020 2020 2020 2320 5765 206e 6565 6420        # We need 
-00024d00: 746f 2073 6f72 7420 7468 656d 2074 6f20  to sort them to 
-00024d10: 6d61 6b65 2073 7572 6520 6061 7869 7360  make sure `axis`
-00024d20: 2065 7175 616c 7320 746f 2074 6865 0a20   equals to the. 
-00024d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d40: 2020 2023 2061 7869 7320 706f 7369 7469     # axis positi
-00024d50: 6f6e 7320 6f66 2074 6865 2072 6573 756c  ons of the resul
-00024d60: 7420 6172 7261 792e 0a20 2020 2020 2020  t array..       
-00024d70: 2020 2020 2020 2020 2020 2020 207a 6970               zip
-00024d80: 5f61 7869 735f 6469 6d20 3d20 736f 7274  _axis_dim = sort
-00024d90: 6564 287a 6970 2861 7869 735f 706f 732c  ed(zip(axis_pos,
-00024da0: 2064 696d 2e69 7465 6d73 2829 2929 0a0a   dim.items()))..
-00024db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024dc0: 2020 2020 616c 6c5f 6469 6d73 203d 206c      all_dims = l
-00024dd0: 6973 7428 7a69 7028 762e 6469 6d73 2c20  ist(zip(v.dims, 
-00024de0: 762e 7368 6170 6529 290a 2020 2020 2020  v.shape)).      
-00024df0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00024e00: 7220 642c 2063 2069 6e20 7a69 705f 6178  r d, c in zip_ax
-00024e10: 6973 5f64 696d 3a0a 2020 2020 2020 2020  is_dim:.        
-00024e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e30: 616c 6c5f 6469 6d73 2e69 6e73 6572 7428  all_dims.insert(
-00024e40: 642c 2063 290a 2020 2020 2020 2020 2020  d, c).          
-00024e50: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-00024e60: 6c65 735b 6b5d 203d 2076 2e73 6574 5f64  les[k] = v.set_d
-00024e70: 696d 7328 6469 6374 2861 6c6c 5f64 696d  ims(dict(all_dim
-00024e80: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-00024e90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00024ea0: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
-00024eb0: 6e20 7661 7269 6162 6c65 733a 0a20 2020  n variables:.   
-00024ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ed0: 2023 2049 6620 6469 6d73 2069 6e63 6c75   # If dims inclu
-00024ee0: 6465 7320 6120 6c61 6265 6c20 6f66 2061  des a label of a
-00024ef0: 206e 6f6e 2d64 696d 656e 7369 6f6e 2063   non-dimension c
-00024f00: 6f6f 7264 696e 6174 652c 0a20 2020 2020  oordinate,.     
-00024f10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00024f20: 2069 7420 7769 6c6c 2062 6520 7072 6f6d   it will be prom
-00024f30: 6f74 6564 2074 6f20 6120 3144 2063 6f6f  oted to a 1D coo
-00024f40: 7264 696e 6174 6520 7769 7468 2061 2073  rdinate with a s
-00024f50: 696e 676c 6520 7661 6c75 652e 0a20 2020  ingle value..   
-00024f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f70: 2069 6e64 6578 2c20 696e 6465 785f 7661   index, index_va
-00024f80: 7273 203d 2063 7265 6174 655f 6465 6661  rs = create_defa
-00024f90: 756c 745f 696e 6465 785f 696d 706c 6963  ult_index_implic
-00024fa0: 6974 2876 2e73 6574 5f64 696d 7328 6b29  it(v.set_dims(k)
-00024fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00024fc0: 2020 2020 2020 696e 6465 7865 735b 6b5d        indexes[k]
-00024fd0: 203d 2069 6e64 6578 0a20 2020 2020 2020   = index.       
-00024fe0: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00024ff0: 6961 626c 6573 2e75 7064 6174 6528 696e  iables.update(in
-00025000: 6465 785f 7661 7273 290a 0a20 2020 2020  dex_vars)..     
-00025010: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00025020: 7265 706c 6163 655f 7769 7468 5f6e 6577  replace_with_new
-00025030: 5f64 696d 7328 0a20 2020 2020 2020 2020  _dims(.         
-00025040: 2020 2076 6172 6961 626c 6573 2c20 636f     variables, co
-00025050: 6f72 645f 6e61 6d65 733d 636f 6f72 645f  ord_names=coord_
-00025060: 6e61 6d65 732c 2069 6e64 6578 6573 3d69  names, indexes=i
-00025070: 6e64 6578 6573 0a20 2020 2020 2020 2029  ndexes.        )
-00025080: 0a0a 2020 2020 2320 6368 616e 6765 2074  ..    # change t
-00025090: 7970 6520 6f66 2073 656c 6620 616e 6420  ype of self and 
-000250a0: 7265 7475 726e 2074 6f20 545f 4461 7461  return to T_Data
-000250b0: 7365 7420 6f6e 6365 0a20 2020 2023 2068  set once.    # h
-000250c0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-000250d0: 6d2f 7079 7468 6f6e 2f6d 7970 792f 6973  m/python/mypy/is
-000250e0: 7375 6573 2f31 3238 3436 2069 7320 7265  sues/12846 is re
-000250f0: 736f 6c76 6564 0a20 2020 2064 6566 2073  solved.    def s
-00025100: 6574 5f69 6e64 6578 280a 2020 2020 2020  et_index(.      
-00025110: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00025120: 696e 6465 7865 733a 204d 6170 7069 6e67  indexes: Mapping
-00025130: 5b41 6e79 2c20 4861 7368 6162 6c65 207c  [Any, Hashable |
-00025140: 2053 6571 7565 6e63 655b 4861 7368 6162   Sequence[Hashab
-00025150: 6c65 5d5d 207c 204e 6f6e 6520 3d20 4e6f  le]] | None = No
-00025160: 6e65 2c0a 2020 2020 2020 2020 6170 7065  ne,.        appe
-00025170: 6e64 3a20 626f 6f6c 203d 2046 616c 7365  nd: bool = False
-00025180: 2c0a 2020 2020 2020 2020 2a2a 696e 6465  ,.        **inde
-00025190: 7865 735f 6b77 6172 6773 3a20 4861 7368  xes_kwargs: Hash
-000251a0: 6162 6c65 207c 2053 6571 7565 6e63 655b  able | Sequence[
-000251b0: 4861 7368 6162 6c65 5d2c 0a20 2020 2029  Hashable],.    )
-000251c0: 202d 3e20 4461 7461 7365 743a 0a20 2020   -> Dataset:.   
-000251d0: 2020 2020 2022 2222 5365 7420 4461 7461       """Set Data
-000251e0: 7365 7420 286d 756c 7469 2d29 696e 6465  set (multi-)inde
-000251f0: 7865 7320 7573 696e 6720 6f6e 6520 6f72  xes using one or
-00025200: 206d 6f72 6520 6578 6973 7469 6e67 2063   more existing c
-00025210: 6f6f 7264 696e 6174 6573 0a20 2020 2020  oordinates.     
-00025220: 2020 206f 7220 7661 7269 6162 6c65 732e     or variables.
-00025230: 0a0a 2020 2020 2020 2020 5468 6973 206c  ..        This l
-00025240: 6567 6163 7920 6d65 7468 6f64 2069 7320  egacy method is 
-00025250: 6c69 6d69 7465 6420 746f 2070 616e 6461  limited to panda
-00025260: 7320 286d 756c 7469 2d29 696e 6465 7865  s (multi-)indexe
-00025270: 7320 616e 640a 2020 2020 2020 2020 312d  s and.        1-
-00025280: 6469 6d65 6e73 696f 6e61 6c20 2264 696d  dimensional "dim
-00025290: 656e 7369 6f6e 2220 636f 6f72 6469 6e61  ension" coordina
-000252a0: 7465 732e 2053 6565 0a20 2020 2020 2020  tes. See.       
-000252b0: 203a 7079 3a6d 6574 683a 607e 4461 7461   :py:meth:`~Data
-000252c0: 7365 742e 7365 745f 7869 6e64 6578 6020  set.set_xindex` 
-000252d0: 666f 7220 7365 7474 696e 6720 6120 7061  for setting a pa
-000252e0: 6e64 6173 206f 7220 6120 6375 7374 6f6d  ndas or a custom
-000252f0: 0a20 2020 2020 2020 2058 6172 7261 792d  .        Xarray-
-00025300: 636f 6d70 6174 6962 6c65 2069 6e64 6578  compatible index
-00025310: 2066 726f 6d20 6f6e 6520 6f72 206d 6f72   from one or mor
-00025320: 6520 6172 6269 7472 6172 7920 636f 6f72  e arbitrary coor
-00025330: 6469 6e61 7465 732e 0a0a 2020 2020 2020  dinates...      
-00025340: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00025350: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00025360: 2020 2020 2020 2020 696e 6465 7865 7320          indexes 
-00025370: 3a20 7b64 696d 3a20 696e 6465 782c 202e  : {dim: index, .
-00025380: 2e2e 7d0a 2020 2020 2020 2020 2020 2020  ..}.            
-00025390: 4d61 7070 696e 6720 6672 6f6d 206e 616d  Mapping from nam
-000253a0: 6573 206d 6174 6368 696e 6720 6469 6d65  es matching dime
-000253b0: 6e73 696f 6e73 2061 6e64 2076 616c 7565  nsions and value
-000253c0: 7320 6769 7665 6e0a 2020 2020 2020 2020  s given.        
-000253d0: 2020 2020 6279 2028 6c69 7374 7320 6f66      by (lists of
-000253e0: 2920 7468 6520 6e61 6d65 7320 6f66 2065  ) the names of e
-000253f0: 7869 7374 696e 6720 636f 6f72 6469 6e61  xisting coordina
-00025400: 7465 7320 6f72 2076 6172 6961 626c 6573  tes or variables
-00025410: 2074 6f20 7365 740a 2020 2020 2020 2020   to set.        
-00025420: 2020 2020 6173 206e 6577 2028 6d75 6c74      as new (mult
-00025430: 692d 2969 6e64 6578 2e0a 2020 2020 2020  i-)index..      
-00025440: 2020 6170 7065 6e64 203a 2062 6f6f 6c2c    append : bool,
-00025450: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
-00025460: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00025470: 7275 652c 2061 7070 656e 6420 7468 6520  rue, append the 
-00025480: 7375 7070 6c69 6564 2069 6e64 6578 2865  supplied index(e
-00025490: 7329 2074 6f20 7468 6520 6578 6973 7469  s) to the existi
-000254a0: 6e67 2069 6e64 6578 2865 7329 2e0a 2020  ng index(es)..  
-000254b0: 2020 2020 2020 2020 2020 4f74 6865 7277            Otherw
-000254c0: 6973 6520 7265 706c 6163 6520 7468 6520  ise replace the 
-000254d0: 6578 6973 7469 6e67 2069 6e64 6578 2865  existing index(e
-000254e0: 7329 2028 6465 6661 756c 7429 2e0a 2020  s) (default)..  
-000254f0: 2020 2020 2020 2a2a 696e 6465 7865 735f        **indexes_
-00025500: 6b77 6172 6773 203a 206f 7074 696f 6e61  kwargs : optiona
-00025510: 6c0a 2020 2020 2020 2020 2020 2020 5468  l.            Th
-00025520: 6520 6b65 7977 6f72 6420 6172 6775 6d65  e keyword argume
-00025530: 6e74 7320 666f 726d 206f 6620 6060 696e  nts form of ``in
-00025540: 6465 7865 7360 602e 0a20 2020 2020 2020  dexes``..       
-00025550: 2020 2020 204f 6e65 206f 6620 696e 6465       One of inde
-00025560: 7865 7320 6f72 2069 6e64 6578 6573 5f6b  xes or indexes_k
-00025570: 7761 7267 7320 6d75 7374 2062 6520 7072  wargs must be pr
-00025580: 6f76 6964 6564 2e0a 0a20 2020 2020 2020  ovided...       
-00025590: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000255a0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-000255b0: 206f 626a 203a 2044 6174 6173 6574 0a20   obj : Dataset. 
-000255c0: 2020 2020 2020 2020 2020 2041 6e6f 7468             Anoth
-000255d0: 6572 2064 6174 6173 6574 2c20 7769 7468  er dataset, with
-000255e0: 2074 6869 7320 6461 7461 7365 7427 7320   this dataset's 
-000255f0: 6461 7461 2062 7574 2072 6570 6c61 6365  data but replace
-00025600: 6420 636f 6f72 6469 6e61 7465 732e 0a0a  d coordinates...
-00025610: 2020 2020 2020 2020 4578 616d 706c 6573          Examples
-00025620: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00025630: 2d0a 2020 2020 2020 2020 3e3e 3e20 6172  -.        >>> ar
-00025640: 7220 3d20 7872 2e44 6174 6141 7272 6179  r = xr.DataArray
-00025650: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
-00025660: 2020 6461 7461 3d6e 702e 6f6e 6573 2828    data=np.ones((
-00025670: 322c 2033 2929 2c0a 2020 2020 2020 2020  2, 3)),.        
-00025680: 2e2e 2e20 2020 2020 6469 6d73 3d5b 2278  ...     dims=["x
-00025690: 222c 2022 7922 5d2c 0a20 2020 2020 2020  ", "y"],.       
-000256a0: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
-000256b0: 7b22 7822 3a20 7261 6e67 6528 3229 2c20  {"x": range(2), 
-000256c0: 2279 223a 2072 616e 6765 2833 292c 2022  "y": range(3), "
-000256d0: 6122 3a20 2822 7822 2c20 5b33 2c20 345d  a": ("x", [3, 4]
-000256e0: 297d 2c0a 2020 2020 2020 2020 2e2e 2e20  )},.        ... 
-000256f0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
-00025700: 203d 2078 722e 4461 7461 7365 7428 7b22   = xr.Dataset({"
-00025710: 7622 3a20 6172 727d 290a 2020 2020 2020  v": arr}).      
-00025720: 2020 3e3e 3e20 6473 0a20 2020 2020 2020    >>> ds.       
-00025730: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-00025740: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-00025750: 696f 6e73 3a20 2028 783a 2032 2c20 793a  ions:  (x: 2, y:
-00025760: 2033 290a 2020 2020 2020 2020 436f 6f72   3).        Coor
-00025770: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-00025780: 2020 202a 2078 2020 2020 2020 2020 2878     * x        (x
-00025790: 2920 696e 7436 3420 3020 310a 2020 2020  ) int64 0 1.    
-000257a0: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
-000257b0: 2028 7929 2069 6e74 3634 2030 2031 2032   (y) int64 0 1 2
-000257c0: 0a20 2020 2020 2020 2020 2020 2061 2020  .            a  
-000257d0: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-000257e0: 3320 340a 2020 2020 2020 2020 4461 7461  3 4.        Data
-000257f0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00025800: 2020 2020 2020 2020 7620 2020 2020 2020          v       
-00025810: 2028 782c 2079 2920 666c 6f61 7436 3420   (x, y) float64 
-00025820: 312e 3020 312e 3020 312e 3020 312e 3020  1.0 1.0 1.0 1.0 
-00025830: 312e 3020 312e 300a 2020 2020 2020 2020  1.0 1.0.        
-00025840: 3e3e 3e20 6473 2e73 6574 5f69 6e64 6578  >>> ds.set_index
-00025850: 2878 3d22 6122 290a 2020 2020 2020 2020  (x="a").        
-00025860: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
-00025870: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-00025880: 6f6e 733a 2020 2878 3a20 322c 2079 3a20  ons:  (x: 2, y: 
-00025890: 3329 0a20 2020 2020 2020 2043 6f6f 7264  3).        Coord
-000258a0: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-000258b0: 2020 2a20 7820 2020 2020 2020 2028 7829    * x        (x)
-000258c0: 2069 6e74 3634 2033 2034 0a20 2020 2020   int64 3 4.     
-000258d0: 2020 2020 202a 2079 2020 2020 2020 2020       * y        
-000258e0: 2879 2920 696e 7436 3420 3020 3120 320a  (y) int64 0 1 2.
-000258f0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-00025900: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-00025910: 2020 2020 7620 2020 2020 2020 2028 782c      v        (x,
-00025920: 2079 2920 666c 6f61 7436 3420 312e 3020   y) float64 1.0 
-00025930: 312e 3020 312e 3020 312e 3020 312e 3020  1.0 1.0 1.0 1.0 
-00025940: 312e 300a 0a20 2020 2020 2020 2053 6565  1.0..        See
-00025950: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00025960: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
-00025970: 6174 6173 6574 2e72 6573 6574 5f69 6e64  ataset.reset_ind
-00025980: 6578 0a20 2020 2020 2020 2044 6174 6173  ex.        Datas
-00025990: 6574 2e73 6574 5f78 696e 6465 780a 2020  et.set_xindex.  
-000259a0: 2020 2020 2020 4461 7461 7365 742e 7377        Dataset.sw
-000259b0: 6170 5f64 696d 730a 2020 2020 2020 2020  ap_dims.        
-000259c0: 2222 220a 2020 2020 2020 2020 6469 6d5f  """.        dim_
-000259d0: 636f 6f72 6473 203d 2065 6974 6865 725f  coords = either_
-000259e0: 6469 6374 5f6f 725f 6b77 6172 6773 2869  dict_or_kwargs(i
-000259f0: 6e64 6578 6573 2c20 696e 6465 7865 735f  ndexes, indexes_
-00025a00: 6b77 6172 6773 2c20 2273 6574 5f69 6e64  kwargs, "set_ind
-00025a10: 6578 2229 0a0a 2020 2020 2020 2020 6e65  ex")..        ne
-00025a20: 775f 696e 6465 7865 733a 2064 6963 745b  w_indexes: dict[
-00025a30: 4861 7368 6162 6c65 2c20 496e 6465 785d  Hashable, Index]
-00025a40: 203d 207b 7d0a 2020 2020 2020 2020 6e65   = {}.        ne
-00025a50: 775f 7661 7269 6162 6c65 733a 2064 6963  w_variables: dic
-00025a60: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
-00025a70: 6162 6c65 5d20 3d20 7b7d 0a20 2020 2020  able] = {}.     
-00025a80: 2020 2064 726f 705f 696e 6465 7865 733a     drop_indexes:
-00025a90: 2073 6574 5b48 6173 6861 626c 655d 203d   set[Hashable] =
-00025aa0: 2073 6574 2829 0a20 2020 2020 2020 2064   set().        d
-00025ab0: 726f 705f 7661 7269 6162 6c65 733a 2073  rop_variables: s
-00025ac0: 6574 5b48 6173 6861 626c 655d 203d 2073  et[Hashable] = s
-00025ad0: 6574 2829 0a20 2020 2020 2020 2072 6570  et().        rep
-00025ae0: 6c61 6365 5f64 696d 733a 2064 6963 745b  lace_dims: dict[
-00025af0: 4861 7368 6162 6c65 2c20 4861 7368 6162  Hashable, Hashab
-00025b00: 6c65 5d20 3d20 7b7d 0a20 2020 2020 2020  le] = {}.       
-00025b10: 2061 6c6c 5f76 6172 5f6e 616d 6573 3a20   all_var_names: 
-00025b20: 7365 745b 4861 7368 6162 6c65 5d20 3d20  set[Hashable] = 
-00025b30: 7365 7428 290a 0a20 2020 2020 2020 2066  set()..        f
-00025b40: 6f72 2064 696d 2c20 5f76 6172 5f6e 616d  or dim, _var_nam
-00025b50: 6573 2069 6e20 6469 6d5f 636f 6f72 6473  es in dim_coords
-00025b60: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00025b70: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00025b80: 6e63 6528 5f76 6172 5f6e 616d 6573 2c20  nce(_var_names, 
-00025b90: 7374 7229 206f 7220 6e6f 7420 6973 696e  str) or not isin
-00025ba0: 7374 616e 6365 285f 7661 725f 6e61 6d65  stance(_var_name
-00025bb0: 732c 2053 6571 7565 6e63 6529 3a0a 2020  s, Sequence):.  
-00025bc0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00025bd0: 725f 6e61 6d65 7320 3d20 5b5f 7661 725f  r_names = [_var_
-00025be0: 6e61 6d65 735d 0a20 2020 2020 2020 2020  names].         
-00025bf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00025c00: 2020 2020 2020 2020 2076 6172 5f6e 616d           var_nam
-00025c10: 6573 203d 206c 6973 7428 5f76 6172 5f6e  es = list(_var_n
-00025c20: 616d 6573 290a 0a20 2020 2020 2020 2020  ames)..         
-00025c30: 2020 2069 6e76 616c 6964 5f76 6172 7320     invalid_vars 
-00025c40: 3d20 7365 7428 7661 725f 6e61 6d65 7329  = set(var_names)
-00025c50: 202d 2073 6574 2873 656c 662e 5f76 6172   - set(self._var
-00025c60: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
-00025c70: 2020 2020 6966 2069 6e76 616c 6964 5f76      if invalid_v
-00025c80: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
-00025c90: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00025ca0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00025cb0: 2020 2020 2020 2020 2020 2022 2c20 222e             ", ".
-00025cc0: 6a6f 696e 285b 7374 7228 7629 2066 6f72  join([str(v) for
-00025cd0: 2076 2069 6e20 696e 7661 6c69 645f 7661   v in invalid_va
-00025ce0: 7273 5d29 0a20 2020 2020 2020 2020 2020  rs]).           
-00025cf0: 2020 2020 2020 2020 202b 2022 2076 6172           + " var
-00025d00: 6961 626c 6528 7329 2064 6f20 6e6f 7420  iable(s) do not 
-00025d10: 6578 6973 7422 0a20 2020 2020 2020 2020  exist".         
-00025d20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00025d30: 2020 2020 2020 616c 6c5f 7661 725f 6e61        all_var_na
-00025d40: 6d65 732e 7570 6461 7465 2876 6172 5f6e  mes.update(var_n
-00025d50: 616d 6573 290a 2020 2020 2020 2020 2020  ames).          
-00025d60: 2020 6472 6f70 5f76 6172 6961 626c 6573    drop_variables
-00025d70: 2e75 7064 6174 6528 7661 725f 6e61 6d65  .update(var_name
-00025d80: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-00025d90: 2320 6472 6f70 2061 6e79 2070 7265 2d65  # drop any pre-e
-00025da0: 7869 7374 696e 6720 696e 6465 7820 696e  xisting index in
-00025db0: 766f 6c76 6564 2061 6e64 2069 7473 2063  volved and its c
-00025dc0: 6f72 7265 7370 6f6e 6469 6e67 2063 6f6f  orresponding coo
-00025dd0: 7264 696e 6174 6573 0a20 2020 2020 2020  rdinates.       
-00025de0: 2020 2020 2069 6e64 6578 5f63 6f6f 7264       index_coord
-00025df0: 5f6e 616d 6573 203d 2073 656c 662e 7869  _names = self.xi
-00025e00: 6e64 6578 6573 2e67 6574 5f61 6c6c 5f63  ndexes.get_all_c
-00025e10: 6f6f 7264 7328 6469 6d2c 2065 7272 6f72  oords(dim, error
-00025e20: 733d 2269 676e 6f72 6522 290a 2020 2020  s="ignore").    
-00025e30: 2020 2020 2020 2020 616c 6c5f 696e 6465          all_inde
-00025e40: 785f 636f 6f72 645f 6e61 6d65 7320 3d20  x_coord_names = 
-00025e50: 7365 7428 696e 6465 785f 636f 6f72 645f  set(index_coord_
-00025e60: 6e61 6d65 7329 0a20 2020 2020 2020 2020  names).         
-00025e70: 2020 2066 6f72 206b 2069 6e20 7661 725f     for k in var_
-00025e80: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
-00025e90: 2020 2020 2020 2061 6c6c 5f69 6e64 6578         all_index
-00025ea0: 5f63 6f6f 7264 5f6e 616d 6573 2e75 7064  _coord_names.upd
-00025eb0: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
-00025ec0: 2020 2020 2020 2020 2073 656c 662e 7869           self.xi
-00025ed0: 6e64 6578 6573 2e67 6574 5f61 6c6c 5f63  ndexes.get_all_c
-00025ee0: 6f6f 7264 7328 6b2c 2065 7272 6f72 733d  oords(k, errors=
-00025ef0: 2269 676e 6f72 6522 290a 2020 2020 2020  "ignore").      
-00025f00: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00025f10: 2020 2020 2020 2020 2064 726f 705f 696e           drop_in
-00025f20: 6465 7865 732e 7570 6461 7465 2861 6c6c  dexes.update(all
-00025f30: 5f69 6e64 6578 5f63 6f6f 7264 5f6e 616d  _index_coord_nam
-00025f40: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00025f50: 6472 6f70 5f76 6172 6961 626c 6573 2e75  drop_variables.u
-00025f60: 7064 6174 6528 616c 6c5f 696e 6465 785f  pdate(all_index_
-00025f70: 636f 6f72 645f 6e61 6d65 7329 0a0a 2020  coord_names)..  
-00025f80: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00025f90: 2876 6172 5f6e 616d 6573 2920 3d3d 2031  (var_names) == 1
-00025fa0: 2061 6e64 2028 6e6f 7420 6170 7065 6e64   and (not append
-00025fb0: 206f 7220 6469 6d20 6e6f 7420 696e 2073   or dim not in s
-00025fc0: 656c 662e 5f69 6e64 6578 6573 293a 0a20  elf._indexes):. 
-00025fd0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00025fe0: 6172 5f6e 616d 6520 3d20 7661 725f 6e61  ar_name = var_na
-00025ff0: 6d65 735b 305d 0a20 2020 2020 2020 2020  mes[0].         
-00026000: 2020 2020 2020 2076 6172 203d 2073 656c         var = sel
-00026010: 662e 5f76 6172 6961 626c 6573 5b76 6172  f._variables[var
-00026020: 5f6e 616d 655d 0a20 2020 2020 2020 2020  _name].         
-00026030: 2020 2020 2020 2069 6620 7661 722e 6469         if var.di
-00026040: 6d73 2021 3d20 2864 696d 2c29 3a0a 2020  ms != (dim,):.  
-00026050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026060: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00026070: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00026080: 2020 2020 2020 2020 2020 2020 6622 6469              f"di
-00026090: 6d65 6e73 696f 6e20 6d69 736d 6174 6368  mension mismatch
-000260a0: 3a20 7472 7920 7365 7474 696e 6720 616e  : try setting an
-000260b0: 2069 6e64 6578 2066 6f72 2064 696d 656e   index for dimen
-000260c0: 7369 6f6e 207b 6469 6d21 727d 2077 6974  sion {dim!r} wit
-000260d0: 6820 220a 2020 2020 2020 2020 2020 2020  h ".            
-000260e0: 2020 2020 2020 2020 2020 2020 6622 7661              f"va
-000260f0: 7269 6162 6c65 207b 7661 725f 6e61 6d65  riable {var_name
-00026100: 2172 7d20 7468 6174 2068 6173 2064 696d  !r} that has dim
-00026110: 656e 7369 6f6e 7320 7b76 6172 2e64 696d  ensions {var.dim
-00026120: 737d 220a 2020 2020 2020 2020 2020 2020  s}".            
-00026130: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00026140: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-00026150: 5061 6e64 6173 496e 6465 782e 6672 6f6d  PandasIndex.from
-00026160: 5f76 6172 6961 626c 6573 287b 6469 6d3a  _variables({dim:
-00026170: 2076 6172 7d2c 206f 7074 696f 6e73 3d7b   var}, options={
-00026180: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-00026190: 2020 2069 6478 5f76 6172 7320 3d20 6964     idx_vars = id
-000261a0: 782e 6372 6561 7465 5f76 6172 6961 626c  x.create_variabl
-000261b0: 6573 287b 7661 725f 6e61 6d65 3a20 7661  es({var_name: va
-000261c0: 727d 290a 0a20 2020 2020 2020 2020 2020  r})..           
-000261d0: 2020 2020 2023 2074 7269 636b 2074 6f20       # trick to 
-000261e0: 7072 6573 6572 7665 2063 6f6f 7264 696e  preserve coordin
-000261f0: 6174 6520 6f72 6465 7220 696e 2074 6869  ate order in thi
-00026200: 7320 6361 7365 0a20 2020 2020 2020 2020  s case.         
-00026210: 2020 2020 2020 2069 6620 6469 6d20 696e         if dim in
-00026220: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-00026230: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00026240: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
-00026250: 6961 626c 6573 2e72 656d 6f76 6528 6469  iables.remove(di
-00026260: 6d29 0a20 2020 2020 2020 2020 2020 2065  m).            e
-00026270: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00026280: 2020 2020 2069 6620 6170 7065 6e64 3a0a       if append:.
-00026290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262a0: 2020 2020 6375 7272 656e 745f 7661 7269      current_vari
-000262b0: 6162 6c65 7320 3d20 7b0a 2020 2020 2020  ables = {.      
-000262c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262d0: 2020 6b3a 2073 656c 662e 5f76 6172 6961    k: self._varia
-000262e0: 626c 6573 5b6b 5d20 666f 7220 6b20 696e  bles[k] for k in
-000262f0: 2069 6e64 6578 5f63 6f6f 7264 5f6e 616d   index_coord_nam
-00026300: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00026310: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00026320: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00026330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026340: 2020 2063 7572 7265 6e74 5f76 6172 6961     current_varia
-00026350: 626c 6573 203d 207b 7d0a 2020 2020 2020  bles = {}.      
-00026360: 2020 2020 2020 2020 2020 6964 782c 2069            idx, i
-00026370: 6478 5f76 6172 7320 3d20 5061 6e64 6173  dx_vars = Pandas
-00026380: 4d75 6c74 6949 6e64 6578 2e66 726f 6d5f  MultiIndex.from_
-00026390: 7661 7269 6162 6c65 735f 6d61 7962 655f  variables_maybe_
-000263a0: 6578 7061 6e64 280a 2020 2020 2020 2020  expand(.        
-000263b0: 2020 2020 2020 2020 2020 2020 6469 6d2c              dim,
-000263c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000263d0: 2020 2020 2063 7572 7265 6e74 5f76 6172       current_var
-000263e0: 6961 626c 6573 2c0a 2020 2020 2020 2020  iables,.        
-000263f0: 2020 2020 2020 2020 2020 2020 7b6b 3a20              {k: 
-00026400: 7365 6c66 2e5f 7661 7269 6162 6c65 735b  self._variables[
-00026410: 6b5d 2066 6f72 206b 2069 6e20 7661 725f  k] for k in var_
-00026420: 6e61 6d65 737d 2c0a 2020 2020 2020 2020  names},.        
-00026430: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00026440: 2020 2020 2020 2020 2020 666f 7220 6e20            for n 
-00026450: 696e 2069 6478 2e69 6e64 6578 2e6e 616d  in idx.index.nam
-00026460: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00026470: 2020 2020 2020 2020 7265 706c 6163 655f          replace_
-00026480: 6469 6d73 5b6e 5d20 3d20 6469 6d0a 0a20  dims[n] = dim.. 
-00026490: 2020 2020 2020 2020 2020 206e 6577 5f69             new_i
-000264a0: 6e64 6578 6573 2e75 7064 6174 6528 7b6b  ndexes.update({k
-000264b0: 3a20 6964 7820 666f 7220 6b20 696e 2069  : idx for k in i
-000264c0: 6478 5f76 6172 737d 290a 2020 2020 2020  dx_vars}).      
-000264d0: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
-000264e0: 6c65 732e 7570 6461 7465 2869 6478 5f76  les.update(idx_v
-000264f0: 6172 7329 0a0a 2020 2020 2020 2020 2320  ars)..        # 
-00026500: 7265 2d61 6464 2064 6569 6e64 6578 6564  re-add deindexed
-00026510: 2063 6f6f 7264 696e 6174 6573 2028 636f   coordinates (co
-00026520: 6e76 6572 7420 746f 2062 6173 6520 7661  nvert to base va
-00026530: 7269 6162 6c65 7329 0a20 2020 2020 2020  riables).       
-00026540: 2066 6f72 206b 2069 6e20 6472 6f70 5f76   for k in drop_v
-00026550: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
-00026560: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-00026570: 2020 2020 2020 2020 2020 206b 206e 6f74             k not
-00026580: 2069 6e20 6e65 775f 7661 7269 6162 6c65   in new_variable
-00026590: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-000265a0: 2020 616e 6420 6b20 6e6f 7420 696e 2061    and k not in a
-000265b0: 6c6c 5f76 6172 5f6e 616d 6573 0a20 2020  ll_var_names.   
-000265c0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-000265d0: 206b 2069 6e20 7365 6c66 2e5f 636f 6f72   k in self._coor
-000265e0: 645f 6e61 6d65 730a 2020 2020 2020 2020  d_names.        
-000265f0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00026600: 2020 2020 2020 206e 6577 5f76 6172 6961         new_varia
-00026610: 626c 6573 5b6b 5d20 3d20 7365 6c66 2e5f  bles[k] = self._
-00026620: 7661 7269 6162 6c65 735b 6b5d 2e74 6f5f  variables[k].to_
-00026630: 6261 7365 5f76 6172 6961 626c 6528 290a  base_variable().
-00026640: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
-00026650: 5f3a 2064 6963 745b 416e 792c 2049 6e64  _: dict[Any, Ind
-00026660: 6578 5d20 3d20 7b0a 2020 2020 2020 2020  ex] = {.        
-00026670: 2020 2020 6b3a 2076 2066 6f72 206b 2c20      k: v for k, 
-00026680: 7620 696e 2073 656c 662e 5f69 6e64 6578  v in self._index
-00026690: 6573 2e69 7465 6d73 2829 2069 6620 6b20  es.items() if k 
-000266a0: 6e6f 7420 696e 2064 726f 705f 696e 6465  not in drop_inde
-000266b0: 7865 730a 2020 2020 2020 2020 7d0a 2020  xes.        }.  
-000266c0: 2020 2020 2020 696e 6465 7865 735f 2e75        indexes_.u
-000266d0: 7064 6174 6528 6e65 775f 696e 6465 7865  pdate(new_indexe
-000266e0: 7329 0a0a 2020 2020 2020 2020 7661 7269  s)..        vari
-000266f0: 6162 6c65 7320 3d20 7b0a 2020 2020 2020  ables = {.      
-00026700: 2020 2020 2020 6b3a 2076 2066 6f72 206b        k: v for k
-00026710: 2c20 7620 696e 2073 656c 662e 5f76 6172  , v in self._var
-00026720: 6961 626c 6573 2e69 7465 6d73 2829 2069  iables.items() i
-00026730: 6620 6b20 6e6f 7420 696e 2064 726f 705f  f k not in drop_
-00026740: 7661 7269 6162 6c65 730a 2020 2020 2020  variables.      
-00026750: 2020 7d0a 2020 2020 2020 2020 7661 7269    }.        vari
-00026760: 6162 6c65 732e 7570 6461 7465 286e 6577  ables.update(new
-00026770: 5f76 6172 6961 626c 6573 290a 0a20 2020  _variables)..   
-00026780: 2020 2020 2023 2075 7064 6174 6520 6469       # update di
-00026790: 6d65 6e73 696f 6e73 2069 6620 6e65 6365  mensions if nece
-000267a0: 7373 6172 792c 2047 483a 2033 3531 320a  ssary, GH: 3512.
-000267b0: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-000267c0: 2069 6e20 7661 7269 6162 6c65 732e 6974   in variables.it
-000267d0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-000267e0: 2020 2069 6620 616e 7928 6420 696e 2072     if any(d in r
-000267f0: 6570 6c61 6365 5f64 696d 7320 666f 7220  eplace_dims for 
-00026800: 6420 696e 2076 2e64 696d 7329 3a0a 2020  d in v.dims):.  
-00026810: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00026820: 775f 6469 6d73 203d 205b 7265 706c 6163  w_dims = [replac
-00026830: 655f 6469 6d73 2e67 6574 2864 2c20 6429  e_dims.get(d, d)
-00026840: 2066 6f72 2064 2069 6e20 762e 6469 6d73   for d in v.dims
-00026850: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00026860: 2020 7661 7269 6162 6c65 735b 6b5d 203d    variables[k] =
-00026870: 2076 2e5f 7265 706c 6163 6528 6469 6d73   v._replace(dims
-00026880: 3d6e 6577 5f64 696d 7329 0a0a 2020 2020  =new_dims)..    
-00026890: 2020 2020 636f 6f72 645f 6e61 6d65 7320      coord_names 
-000268a0: 3d20 7365 6c66 2e5f 636f 6f72 645f 6e61  = self._coord_na
-000268b0: 6d65 7320 2d20 6472 6f70 5f76 6172 6961  mes - drop_varia
-000268c0: 626c 6573 207c 2073 6574 286e 6577 5f76  bles | set(new_v
-000268d0: 6172 6961 626c 6573 290a 0a20 2020 2020  ariables)..     
-000268e0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000268f0: 7265 706c 6163 655f 7769 7468 5f6e 6577  replace_with_new
-00026900: 5f64 696d 7328 0a20 2020 2020 2020 2020  _dims(.         
-00026910: 2020 2076 6172 6961 626c 6573 2c20 636f     variables, co
-00026920: 6f72 645f 6e61 6d65 733d 636f 6f72 645f  ord_names=coord_
-00026930: 6e61 6d65 732c 2069 6e64 6578 6573 3d69  names, indexes=i
-00026940: 6e64 6578 6573 5f0a 2020 2020 2020 2020  ndexes_.        
-00026950: 290a 0a20 2020 2064 6566 2072 6573 6574  )..    def reset
-00026960: 5f69 6e64 6578 280a 2020 2020 2020 2020  _index(.        
-00026970: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-00026980: 0a20 2020 2020 2020 2064 696d 735f 6f72  .        dims_or
-00026990: 5f6c 6576 656c 733a 2048 6173 6861 626c  _levels: Hashabl
-000269a0: 6520 7c20 5365 7175 656e 6365 5b48 6173  e | Sequence[Has
-000269b0: 6861 626c 655d 2c0a 2020 2020 2020 2020  hable],.        
-000269c0: 6472 6f70 3a20 626f 6f6c 203d 2046 616c  drop: bool = Fal
-000269d0: 7365 2c0a 2020 2020 2920 2d3e 2054 5f44  se,.    ) -> T_D
-000269e0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-000269f0: 2222 2252 6573 6574 2074 6865 2073 7065  """Reset the spe
-00026a00: 6369 6669 6564 2069 6e64 6578 2865 7329  cified index(es)
-00026a10: 206f 7220 6d75 6c74 692d 696e 6465 7820   or multi-index 
-00026a20: 6c65 7665 6c28 7329 2e0a 0a20 2020 2020  level(s)...     
-00026a30: 2020 2054 6869 7320 6c65 6761 6379 206d     This legacy m
-00026a40: 6574 686f 6420 6973 2073 7065 6369 6669  ethod is specifi
-00026a50: 6320 746f 2070 616e 6461 7320 286d 756c  c to pandas (mul
-00026a60: 7469 2d29 696e 6465 7865 7320 616e 640a  ti-)indexes and.
-00026a70: 2020 2020 2020 2020 312d 6469 6d65 6e73          1-dimens
-00026a80: 696f 6e61 6c20 2264 696d 656e 7369 6f6e  ional "dimension
-00026a90: 2220 636f 6f72 6469 6e61 7465 732e 2053  " coordinates. S
-00026aa0: 6565 2074 6865 206d 6f72 6520 6765 6e65  ee the more gene
-00026ab0: 7269 630a 2020 2020 2020 2020 3a70 793a  ric.        :py:
-00026ac0: 6d65 7468 3a60 7e44 6174 6173 6574 2e64  meth:`~Dataset.d
-00026ad0: 726f 705f 696e 6465 7865 7360 2061 6e64  rop_indexes` and
-00026ae0: 203a 7079 3a6d 6574 683a 607e 4461 7461   :py:meth:`~Data
-00026af0: 7365 742e 7365 745f 7869 6e64 6578 600a  set.set_xindex`.
-00026b00: 2020 2020 2020 2020 6d65 7468 6f64 2074          method t
-00026b10: 6f20 7265 7370 6563 7469 7665 6c79 2064  o respectively d
-00026b20: 726f 7020 616e 6420 7365 7420 7061 6e64  rop and set pand
-00026b30: 6173 206f 7220 6375 7374 6f6d 2069 6e64  as or custom ind
-00026b40: 6578 6573 2066 6f72 0a20 2020 2020 2020  exes for.       
-00026b50: 2061 7262 6974 7261 7279 2063 6f6f 7264   arbitrary coord
-00026b60: 696e 6174 6573 2e0a 0a20 2020 2020 2020  inates...       
-00026b70: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00026b80: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00026b90: 2020 2020 2020 2064 696d 735f 6f72 5f6c         dims_or_l
-00026ba0: 6576 656c 7320 3a20 4861 7368 6162 6c65  evels : Hashable
-00026bb0: 206f 7220 5365 7175 656e 6365 206f 6620   or Sequence of 
-00026bc0: 4861 7368 6162 6c65 0a20 2020 2020 2020  Hashable.       
-00026bd0: 2020 2020 204e 616d 6528 7329 206f 6620       Name(s) of 
-00026be0: 7468 6520 6469 6d65 6e73 696f 6e28 7329  the dimension(s)
-00026bf0: 2061 6e64 2f6f 7220 6d75 6c74 692d 696e   and/or multi-in
-00026c00: 6465 7820 6c65 7665 6c28 7329 2074 6861  dex level(s) tha
-00026c10: 7420 7769 6c6c 0a20 2020 2020 2020 2020  t will.         
-00026c20: 2020 2062 6520 7265 7365 742e 0a20 2020     be reset..   
-00026c30: 2020 2020 2064 726f 7020 3a20 626f 6f6c       drop : bool
-00026c40: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
-00026c50: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00026c60: 5472 7565 2c20 7265 6d6f 7665 2074 6865  True, remove the
-00026c70: 2073 7065 6369 6669 6564 2069 6e64 6578   specified index
-00026c80: 6573 2061 6e64 2f6f 7220 6d75 6c74 692d  es and/or multi-
-00026c90: 696e 6465 7820 6c65 7665 6c73 0a20 2020  index levels.   
-00026ca0: 2020 2020 2020 2020 2069 6e73 7465 6164           instead
-00026cb0: 206f 6620 6578 7472 6163 7469 6e67 2074   of extracting t
-00026cc0: 6865 6d20 6173 206e 6577 2063 6f6f 7264  hem as new coord
-00026cd0: 696e 6174 6573 2028 6465 6661 756c 743a  inates (default:
-00026ce0: 2046 616c 7365 292e 0a0a 2020 2020 2020   False)...      
-00026cf0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00026d00: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00026d10: 2020 6f62 6a20 3a20 4461 7461 7365 740a    obj : Dataset.
-00026d20: 2020 2020 2020 2020 2020 2020 416e 6f74              Anot
-00026d30: 6865 7220 6461 7461 7365 742c 2077 6974  her dataset, wit
-00026d40: 6820 7468 6973 2064 6174 6173 6574 2773  h this dataset's
-00026d50: 2064 6174 6120 6275 7420 7265 706c 6163   data but replac
-00026d60: 6564 2063 6f6f 7264 696e 6174 6573 2e0a  ed coordinates..
-00026d70: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-00026d80: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-00026d90: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
-00026da0: 6574 2e73 6574 5f69 6e64 6578 0a20 2020  et.set_index.   
-00026db0: 2020 2020 2044 6174 6173 6574 2e73 6574       Dataset.set
-00026dc0: 5f78 696e 6465 780a 2020 2020 2020 2020  _xindex.        
-00026dd0: 4461 7461 7365 742e 6472 6f70 5f69 6e64  Dataset.drop_ind
-00026de0: 6578 6573 0a20 2020 2020 2020 2022 2222  exes.        """
-00026df0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00026e00: 7374 616e 6365 2864 696d 735f 6f72 5f6c  stance(dims_or_l
-00026e10: 6576 656c 732c 2073 7472 2920 6f72 206e  evels, str) or n
-00026e20: 6f74 2069 7369 6e73 7461 6e63 6528 6469  ot isinstance(di
-00026e30: 6d73 5f6f 725f 6c65 7665 6c73 2c20 5365  ms_or_levels, Se
-00026e40: 7175 656e 6365 293a 0a20 2020 2020 2020  quence):.       
-00026e50: 2020 2020 2064 696d 735f 6f72 5f6c 6576       dims_or_lev
-00026e60: 656c 7320 3d20 5b64 696d 735f 6f72 5f6c  els = [dims_or_l
-00026e70: 6576 656c 735d 0a0a 2020 2020 2020 2020  evels]..        
-00026e80: 696e 7661 6c69 645f 636f 6f72 6473 203d  invalid_coords =
-00026e90: 2073 6574 2864 696d 735f 6f72 5f6c 6576   set(dims_or_lev
-00026ea0: 656c 7329 202d 2073 6574 2873 656c 662e  els) - set(self.
-00026eb0: 5f69 6e64 6578 6573 290a 2020 2020 2020  _indexes).      
-00026ec0: 2020 6966 2069 6e76 616c 6964 5f63 6f6f    if invalid_coo
-00026ed0: 7264 733a 0a20 2020 2020 2020 2020 2020  rds:.           
-00026ee0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00026ef0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00026f00: 2020 2066 227b 7475 706c 6528 696e 7661     f"{tuple(inva
-00026f10: 6c69 645f 636f 6f72 6473 297d 2061 7265  lid_coords)} are
-00026f20: 206e 6f74 2063 6f6f 7264 696e 6174 6573   not coordinates
-00026f30: 2077 6974 6820 616e 2069 6e64 6578 220a   with an index".
-00026f40: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00026f50: 2020 2020 2020 2064 726f 705f 696e 6465         drop_inde
-00026f60: 7865 733a 2073 6574 5b48 6173 6861 626c  xes: set[Hashabl
-00026f70: 655d 203d 2073 6574 2829 0a20 2020 2020  e] = set().     
-00026f80: 2020 2064 726f 705f 7661 7269 6162 6c65     drop_variable
-00026f90: 733a 2073 6574 5b48 6173 6861 626c 655d  s: set[Hashable]
-00026fa0: 203d 2073 6574 2829 0a20 2020 2020 2020   = set().       
-00026fb0: 2073 6565 6e3a 2073 6574 5b49 6e64 6578   seen: set[Index
-00026fc0: 5d20 3d20 7365 7428 290a 2020 2020 2020  ] = set().      
-00026fd0: 2020 6e65 775f 696e 6465 7865 733a 2064    new_indexes: d
-00026fe0: 6963 745b 4861 7368 6162 6c65 2c20 496e  ict[Hashable, In
-00026ff0: 6465 785d 203d 207b 7d0a 2020 2020 2020  dex] = {}.      
-00027000: 2020 6e65 775f 7661 7269 6162 6c65 733a    new_variables:
-00027010: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00027020: 5661 7269 6162 6c65 5d20 3d20 7b7d 0a0a  Variable] = {}..
-00027030: 2020 2020 2020 2020 6465 6620 6472 6f70          def drop
-00027040: 5f6f 725f 636f 6e76 6572 7428 7661 725f  _or_convert(var_
-00027050: 6e61 6d65 7329 3a0a 2020 2020 2020 2020  names):.        
-00027060: 2020 2020 6966 2064 726f 703a 0a20 2020      if drop:.   
-00027070: 2020 2020 2020 2020 2020 2020 2064 726f               dro
-00027080: 705f 7661 7269 6162 6c65 732e 7570 6461  p_variables.upda
-00027090: 7465 2876 6172 5f6e 616d 6573 290a 2020  te(var_names).  
-000270a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00010d50: 2020 2020 2020 6368 756e 6b5f 7374 6f72        chunk_stor
+00010d60: 653a 204d 7574 6162 6c65 4d61 7070 696e  e: MutableMappin
+00010d70: 6720 7c20 7374 7220 7c20 5061 7468 4c69  g | str | PathLi
+00010d80: 6b65 207c 204e 6f6e 6520 3d20 4e6f 6e65  ke | None = None
+00010d90: 2c0a 2020 2020 2020 2020 6d6f 6465 3a20  ,.        mode: 
+00010da0: 4c69 7465 7261 6c5b 2277 222c 2022 772d  Literal["w", "w-
+00010db0: 222c 2022 6122 2c20 2272 2b22 2c20 4e6f  ", "a", "r+", No
+00010dc0: 6e65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ne] = None,.    
+00010dd0: 2020 2020 7379 6e63 6872 6f6e 697a 6572      synchronizer
+00010de0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2067  =None,.        g
+00010df0: 726f 7570 3a20 7374 7220 7c20 4e6f 6e65  roup: str | None
+00010e00: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00010e10: 2065 6e63 6f64 696e 673a 204d 6170 7069   encoding: Mappi
+00010e20: 6e67 207c 204e 6f6e 6520 3d20 4e6f 6e65  ng | None = None
+00010e30: 2c0a 2020 2020 2020 2020 2a2c 0a20 2020  ,.        *,.   
+00010e40: 2020 2020 2063 6f6d 7075 7465 3a20 4c69       compute: Li
+00010e50: 7465 7261 6c5b 4661 6c73 655d 2c0a 2020  teral[False],.  
+00010e60: 2020 2020 2020 636f 6e73 6f6c 6964 6174        consolidat
+00010e70: 6564 3a20 626f 6f6c 207c 204e 6f6e 6520  ed: bool | None 
+00010e80: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00010e90: 6170 7065 6e64 5f64 696d 3a20 4861 7368  append_dim: Hash
+00010ea0: 6162 6c65 207c 204e 6f6e 6520 3d20 4e6f  able | None = No
+00010eb0: 6e65 2c0a 2020 2020 2020 2020 7265 6769  ne,.        regi
+00010ec0: 6f6e 3a20 4d61 7070 696e 675b 7374 722c  on: Mapping[str,
+00010ed0: 2073 6c69 6365 5d20 7c20 4e6f 6e65 203d   slice] | None =
+00010ee0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
+00010ef0: 6166 655f 6368 756e 6b73 3a20 626f 6f6c  afe_chunks: bool
+00010f00: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+00010f10: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
+00010f20: 3a20 6469 6374 5b73 7472 2c20 7374 725d  : dict[str, str]
+00010f30: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00010f40: 2020 2020 2020 2020 7a61 7272 5f76 6572          zarr_ver
+00010f50: 7369 6f6e 3a20 696e 7420 7c20 4e6f 6e65  sion: int | None
+00010f60: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00010f70: 2063 6875 6e6b 6d61 6e61 6765 725f 7374   chunkmanager_st
+00010f80: 6f72 655f 6b77 6172 6773 3a20 6469 6374  ore_kwargs: dict
+00010f90: 5b73 7472 2c20 416e 795d 207c 204e 6f6e  [str, Any] | Non
+00010fa0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
+00010fb0: 2d3e 2044 656c 6179 6564 3a0a 2020 2020  -> Delayed:.    
+00010fc0: 2020 2020 2e2e 2e0a 0a20 2020 2064 6566      .....    def
+00010fd0: 2074 6f5f 7a61 7272 280a 2020 2020 2020   to_zarr(.      
+00010fe0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00010ff0: 7374 6f72 653a 204d 7574 6162 6c65 4d61  store: MutableMa
+00011000: 7070 696e 6720 7c20 7374 7220 7c20 5061  pping | str | Pa
+00011010: 7468 4c69 6b65 5b73 7472 5d20 7c20 4e6f  thLike[str] | No
+00011020: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+00011030: 2020 2063 6875 6e6b 5f73 746f 7265 3a20     chunk_store: 
+00011040: 4d75 7461 626c 654d 6170 7069 6e67 207c  MutableMapping |
+00011050: 2073 7472 207c 2050 6174 684c 696b 6520   str | PathLike 
+00011060: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00011070: 2020 2020 2020 206d 6f64 653a 204c 6974         mode: Lit
+00011080: 6572 616c 5b22 7722 2c20 2277 2d22 2c20  eral["w", "w-", 
+00011090: 2261 222c 2022 722b 222c 204e 6f6e 655d  "a", "r+", None]
+000110a0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000110b0: 2073 796e 6368 726f 6e69 7a65 723d 4e6f   synchronizer=No
+000110c0: 6e65 2c0a 2020 2020 2020 2020 6772 6f75  ne,.        grou
+000110d0: 703a 2073 7472 207c 204e 6f6e 6520 3d20  p: str | None = 
+000110e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 656e  None,.        en
+000110f0: 636f 6469 6e67 3a20 4d61 7070 696e 6720  coding: Mapping 
+00011100: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00011110: 2020 2020 2020 2063 6f6d 7075 7465 3a20         compute: 
+00011120: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+00011130: 2020 2020 2063 6f6e 736f 6c69 6461 7465       consolidate
+00011140: 643a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  d: bool | None =
+00011150: 204e 6f6e 652c 0a20 2020 2020 2020 2061   None,.        a
+00011160: 7070 656e 645f 6469 6d3a 2048 6173 6861  ppend_dim: Hasha
+00011170: 626c 6520 7c20 4e6f 6e65 203d 204e 6f6e  ble | None = Non
+00011180: 652c 0a20 2020 2020 2020 2072 6567 696f  e,.        regio
+00011190: 6e3a 204d 6170 7069 6e67 5b73 7472 2c20  n: Mapping[str, 
+000111a0: 736c 6963 655d 207c 204e 6f6e 6520 3d20  slice] | None = 
+000111b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7361  None,.        sa
+000111c0: 6665 5f63 6875 6e6b 733a 2062 6f6f 6c20  fe_chunks: bool 
+000111d0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+000111e0: 7374 6f72 6167 655f 6f70 7469 6f6e 733a  storage_options:
+000111f0: 2064 6963 745b 7374 722c 2073 7472 5d20   dict[str, str] 
+00011200: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00011210: 2020 2020 2020 207a 6172 725f 7665 7273         zarr_vers
+00011220: 696f 6e3a 2069 6e74 207c 204e 6f6e 6520  ion: int | None 
+00011230: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00011240: 6368 756e 6b6d 616e 6167 6572 5f73 746f  chunkmanager_sto
+00011250: 7265 5f6b 7761 7267 733a 2064 6963 745b  re_kwargs: dict[
+00011260: 7374 722c 2041 6e79 5d20 7c20 4e6f 6e65  str, Any] | None
+00011270: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+00011280: 3e20 5a61 7272 5374 6f72 6520 7c20 4465  > ZarrStore | De
+00011290: 6c61 7965 643a 0a20 2020 2020 2020 2022  layed:.        "
+000112a0: 2222 5772 6974 6520 6461 7461 7365 7420  ""Write dataset 
+000112b0: 636f 6e74 656e 7473 2074 6f20 6120 7a61  contents to a za
+000112c0: 7272 2067 726f 7570 2e0a 0a20 2020 2020  rr group...     
+000112d0: 2020 205a 6172 7220 6368 756e 6b73 2061     Zarr chunks a
+000112e0: 7265 2064 6574 6572 6d69 6e65 6420 696e  re determined in
+000112f0: 2074 6865 2066 6f6c 6c6f 7769 6e67 2077   the following w
+00011300: 6179 3a0a 0a20 2020 2020 2020 202d 2046  ay:..        - F
+00011310: 726f 6d20 7468 6520 6060 6368 756e 6b73  rom the ``chunks
+00011320: 6060 2061 7474 7269 6275 7465 2069 6e20  `` attribute in 
+00011330: 6561 6368 2076 6172 6961 626c 6527 7320  each variable's 
+00011340: 6060 656e 636f 6469 6e67 6060 0a20 2020  ``encoding``.   
+00011350: 2020 2020 2020 2028 6361 6e20 6265 2073         (can be s
+00011360: 6574 2076 6961 2060 4461 7461 7365 742e  et via `Dataset.
+00011370: 6368 756e 6b60 292e 0a20 2020 2020 2020  chunk`)..       
+00011380: 202d 2049 6620 7468 6520 7661 7269 6162   - If the variab
+00011390: 6c65 2069 7320 6120 4461 736b 2061 7272  le is a Dask arr
+000113a0: 6179 2c20 6672 6f6d 2074 6865 2064 6173  ay, from the das
+000113b0: 6b20 6368 756e 6b73 0a20 2020 2020 2020  k chunks.       
+000113c0: 202d 2049 6620 6e65 6974 6865 7220 4461   - If neither Da
+000113d0: 736b 2063 6875 6e6b 7320 6e6f 7220 656e  sk chunks nor en
+000113e0: 636f 6469 6e67 2063 6875 6e6b 7320 6172  coding chunks ar
+000113f0: 6520 7072 6573 656e 742c 2063 6875 6e6b  e present, chunk
+00011400: 7320 7769 6c6c 0a20 2020 2020 2020 2020  s will.         
+00011410: 2062 6520 6465 7465 726d 696e 6564 2061   be determined a
+00011420: 7574 6f6d 6174 6963 616c 6c79 2062 7920  utomatically by 
+00011430: 5a61 7272 0a20 2020 2020 2020 202d 2049  Zarr.        - I
+00011440: 6620 626f 7468 2044 6173 6b20 6368 756e  f both Dask chun
+00011450: 6b73 2061 6e64 2065 6e63 6f64 696e 6720  ks and encoding 
+00011460: 6368 756e 6b73 2061 7265 2070 7265 7365  chunks are prese
+00011470: 6e74 2c20 656e 636f 6469 6e67 2063 6875  nt, encoding chu
+00011480: 6e6b 730a 2020 2020 2020 2020 2020 7769  nks.          wi
+00011490: 6c6c 2062 6520 7573 6564 2c20 7072 6f76  ll be used, prov
+000114a0: 6964 6564 2074 6861 7420 7468 6572 6520  ided that there 
+000114b0: 6973 2061 206d 616e 792d 746f 2d6f 6e65  is a many-to-one
+000114c0: 2072 656c 6174 696f 6e73 6869 7020 6265   relationship be
+000114d0: 7477 6565 6e0a 2020 2020 2020 2020 2020  tween.          
+000114e0: 656e 636f 6469 6e67 2063 6875 6e6b 7320  encoding chunks 
+000114f0: 616e 6420 6461 736b 2063 6875 6e6b 7320  and dask chunks 
+00011500: 2869 2e65 2e20 4461 736b 2063 6875 6e6b  (i.e. Dask chunk
+00011510: 7320 6172 6520 6269 6767 6572 2074 6861  s are bigger tha
+00011520: 6e20 616e 640a 2020 2020 2020 2020 2020  n and.          
+00011530: 6576 656e 6c79 2064 6976 6964 6520 656e  evenly divide en
+00011540: 636f 6469 6e67 2063 6875 6e6b 7329 3b20  coding chunks); 
+00011550: 6f74 6865 7277 6973 6520 7261 6973 6520  otherwise raise 
+00011560: 6120 6060 5661 6c75 6545 7272 6f72 6060  a ``ValueError``
+00011570: 2e0a 2020 2020 2020 2020 2020 5468 6973  ..          This
+00011580: 2072 6573 7472 6963 7469 6f6e 2065 6e73   restriction ens
+00011590: 7572 6573 2074 6861 7420 6e6f 2073 796e  ures that no syn
+000115a0: 6368 726f 6e69 7a61 7469 6f6e 202f 206c  chronization / l
+000115b0: 6f63 6b73 2061 7265 2072 6571 7569 7265  ocks are require
+000115c0: 640a 2020 2020 2020 2020 2020 7768 656e  d.          when
+000115d0: 2077 7269 7469 6e67 2e20 546f 2064 6973   writing. To dis
+000115e0: 6162 6c65 2074 6869 7320 7265 7374 7269  able this restri
+000115f0: 6374 696f 6e2c 2075 7365 2060 6073 6166  ction, use ``saf
+00011600: 655f 6368 756e 6b73 3d46 616c 7365 6060  e_chunks=False``
+00011610: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00011620: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00011630: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00011640: 2073 746f 7265 203a 204d 7574 6162 6c65   store : Mutable
+00011650: 4d61 7070 696e 672c 2073 7472 206f 7220  Mapping, str or 
+00011660: 7061 7468 2d6c 696b 652c 206f 7074 696f  path-like, optio
+00011670: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+00011680: 5374 6f72 6520 6f72 2070 6174 6820 746f  Store or path to
+00011690: 2064 6972 6563 746f 7279 2069 6e20 6c6f   directory in lo
+000116a0: 6361 6c20 6f72 2072 656d 6f74 6520 6669  cal or remote fi
+000116b0: 6c65 2073 7973 7465 6d2e 0a20 2020 2020  le system..     
+000116c0: 2020 2063 6875 6e6b 5f73 746f 7265 203a     chunk_store :
+000116d0: 204d 7574 6162 6c65 4d61 7070 696e 672c   MutableMapping,
+000116e0: 2073 7472 206f 7220 7061 7468 2d6c 696b   str or path-lik
+000116f0: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+00011700: 2020 2020 2020 2020 5374 6f72 6520 6f72          Store or
+00011710: 2070 6174 6820 746f 2064 6972 6563 746f   path to directo
+00011720: 7279 2069 6e20 6c6f 6361 6c20 6f72 2072  ry in local or r
+00011730: 656d 6f74 6520 6669 6c65 2073 7973 7465  emote file syste
+00011740: 6d20 6f6e 6c79 2066 6f72 205a 6172 720a  m only for Zarr.
+00011750: 2020 2020 2020 2020 2020 2020 6172 7261              arra
+00011760: 7920 6368 756e 6b73 2e20 5265 7175 6972  y chunks. Requir
+00011770: 6573 207a 6172 722d 7079 7468 6f6e 2076  es zarr-python v
+00011780: 322e 342e 3020 6f72 206c 6174 6572 2e0a  2.4.0 or later..
+00011790: 2020 2020 2020 2020 6d6f 6465 203a 207b          mode : {
+000117a0: 2277 222c 2022 772d 222c 2022 6122 2c20  "w", "w-", "a", 
+000117b0: 2272 2b22 2c20 4e6f 6e65 7d2c 206f 7074  "r+", None}, opt
+000117c0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+000117d0: 2020 5065 7273 6973 7465 6e63 6520 6d6f    Persistence mo
+000117e0: 6465 3a20 2277 2220 6d65 616e 7320 6372  de: "w" means cr
+000117f0: 6561 7465 2028 6f76 6572 7772 6974 6520  eate (overwrite 
+00011800: 6966 2065 7869 7374 7329 3b0a 2020 2020  if exists);.    
+00011810: 2020 2020 2020 2020 2277 2d22 206d 6561          "w-" mea
+00011820: 6e73 2063 7265 6174 6520 2866 6169 6c20  ns create (fail 
+00011830: 6966 2065 7869 7374 7329 3b0a 2020 2020  if exists);.    
+00011840: 2020 2020 2020 2020 2261 2220 6d65 616e          "a" mean
+00011850: 7320 6f76 6572 7269 6465 2065 7869 7374  s override exist
+00011860: 696e 6720 7661 7269 6162 6c65 7320 2863  ing variables (c
+00011870: 7265 6174 6520 6966 2064 6f65 7320 6e6f  reate if does no
+00011880: 7420 6578 6973 7429 3b0a 2020 2020 2020  t exist);.      
+00011890: 2020 2020 2020 2272 2b22 206d 6561 6e73        "r+" means
+000118a0: 206d 6f64 6966 7920 6578 6973 7469 6e67   modify existing
+000118b0: 2061 7272 6179 202a 7661 6c75 6573 2a20   array *values* 
+000118c0: 6f6e 6c79 2028 7261 6973 6520 616e 2065  only (raise an e
+000118d0: 7272 6f72 2069 660a 2020 2020 2020 2020  rror if.        
+000118e0: 2020 2020 616e 7920 6d65 7461 6461 7461      any metadata
+000118f0: 206f 7220 7368 6170 6573 2077 6f75 6c64   or shapes would
+00011900: 2063 6861 6e67 6529 2e0a 2020 2020 2020   change)..      
+00011910: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
+00011920: 7420 6d6f 6465 2069 7320 2261 2220 6966  t mode is "a" if
+00011930: 2060 6061 7070 656e 645f 6469 6d60 6020   ``append_dim`` 
+00011940: 6973 2073 6574 2e20 4f74 6865 7277 6973  is set. Otherwis
+00011950: 652c 2069 7420 6973 0a20 2020 2020 2020  e, it is.       
+00011960: 2020 2020 2022 722b 2220 6966 2060 6072       "r+" if ``r
+00011970: 6567 696f 6e60 6020 6973 2073 6574 2061  egion`` is set a
+00011980: 6e64 2060 6077 2d60 6020 6f74 6865 7277  nd ``w-`` otherw
+00011990: 6973 652e 0a20 2020 2020 2020 2073 796e  ise..        syn
+000119a0: 6368 726f 6e69 7a65 7220 3a20 6f62 6a65  chronizer : obje
+000119b0: 6374 2c20 6f70 7469 6f6e 616c 0a20 2020  ct, optional.   
+000119c0: 2020 2020 2020 2020 205a 6172 7220 6172           Zarr ar
+000119d0: 7261 7920 7379 6e63 6872 6f6e 697a 6572  ray synchronizer
+000119e0: 2e0a 2020 2020 2020 2020 6772 6f75 7020  ..        group 
+000119f0: 3a20 7374 722c 206f 7074 696f 6e61 6c0a  : str, optional.
+00011a00: 2020 2020 2020 2020 2020 2020 4772 6f75              Grou
+00011a10: 7020 7061 7468 2e20 2861 2e6b 2e61 2e20  p path. (a.k.a. 
+00011a20: 6070 6174 6860 2069 6e20 7a61 7272 2074  `path` in zarr t
+00011a30: 6572 6d69 6e6f 6c6f 6779 2e29 0a20 2020  erminology.).   
+00011a40: 2020 2020 2065 6e63 6f64 696e 6720 3a20       encoding : 
+00011a50: 6469 6374 2c20 6f70 7469 6f6e 616c 0a20  dict, optional. 
+00011a60: 2020 2020 2020 2020 2020 204e 6573 7465             Neste
+00011a70: 6420 6469 6374 696f 6e61 7279 2077 6974  d dictionary wit
+00011a80: 6820 7661 7269 6162 6c65 206e 616d 6573  h variable names
+00011a90: 2061 7320 6b65 7973 2061 6e64 2064 6963   as keys and dic
+00011aa0: 7469 6f6e 6172 6965 7320 6f66 0a20 2020  tionaries of.   
+00011ab0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00011ac0: 6520 7370 6563 6966 6963 2065 6e63 6f64  e specific encod
+00011ad0: 696e 6773 2061 7320 7661 6c75 6573 2c20  ings as values, 
+00011ae0: 652e 672e 2c0a 2020 2020 2020 2020 2020  e.g.,.          
+00011af0: 2020 6060 7b22 6d79 5f76 6172 6961 626c    ``{"my_variabl
+00011b00: 6522 3a20 7b22 6474 7970 6522 3a20 2269  e": {"dtype": "i
+00011b10: 6e74 3136 222c 2022 7363 616c 655f 6661  nt16", "scale_fa
+00011b20: 6374 6f72 223a 2030 2e31 2c7d 2c20 2e2e  ctor": 0.1,}, ..
+00011b30: 2e7d 6060 0a20 2020 2020 2020 2063 6f6d  .}``.        com
+00011b40: 7075 7465 203a 2062 6f6f 6c2c 2064 6566  pute : bool, def
+00011b50: 6175 6c74 3a20 5472 7565 0a20 2020 2020  ault: True.     
+00011b60: 2020 2020 2020 2049 6620 5472 7565 2077         If True w
+00011b70: 7269 7465 2061 7272 6179 2064 6174 6120  rite array data 
+00011b80: 696d 6d65 6469 6174 656c 792c 206f 7468  immediately, oth
+00011b90: 6572 7769 7365 2072 6574 7572 6e20 610a  erwise return a.
+00011ba0: 2020 2020 2020 2020 2020 2020 6060 6461              ``da
+00011bb0: 736b 2e64 656c 6179 6564 2e44 656c 6179  sk.delayed.Delay
+00011bc0: 6564 6060 206f 626a 6563 7420 7468 6174  ed`` object that
+00011bd0: 2063 616e 2062 6520 636f 6d70 7574 6564   can be computed
+00011be0: 2074 6f20 7772 6974 650a 2020 2020 2020   to write.      
+00011bf0: 2020 2020 2020 6172 7261 7920 6461 7461        array data
+00011c00: 206c 6174 6572 2e20 4d65 7461 6461 7461   later. Metadata
+00011c10: 2069 7320 616c 7761 7973 2075 7064 6174   is always updat
+00011c20: 6564 2065 6167 6572 6c79 2e0a 2020 2020  ed eagerly..    
+00011c30: 2020 2020 636f 6e73 6f6c 6964 6174 6564      consolidated
+00011c40: 203a 2062 6f6f 6c2c 206f 7074 696f 6e61   : bool, optiona
+00011c50: 6c0a 2020 2020 2020 2020 2020 2020 4966  l.            If
+00011c60: 2054 7275 652c 2061 7070 6c79 207a 6172   True, apply zar
+00011c70: 7227 7320 6063 6f6e 736f 6c69 6461 7465  r's `consolidate
+00011c80: 5f6d 6574 6164 6174 6160 2066 756e 6374  _metadata` funct
+00011c90: 696f 6e20 746f 2074 6865 2073 746f 7265  ion to the store
+00011ca0: 0a20 2020 2020 2020 2020 2020 2061 6674  .            aft
+00011cb0: 6572 2077 7269 7469 6e67 206d 6574 6164  er writing metad
+00011cc0: 6174 6120 616e 6420 7265 6164 2065 7869  ata and read exi
+00011cd0: 7374 696e 6720 7374 6f72 6573 2077 6974  sting stores wit
+00011ce0: 6820 636f 6e73 6f6c 6964 6174 6564 0a20  h consolidated. 
+00011cf0: 2020 2020 2020 2020 2020 206d 6574 6164             metad
+00011d00: 6174 613b 2069 6620 4661 6c73 652c 2064  ata; if False, d
+00011d10: 6f20 6e6f 742e 2054 6865 2064 6566 6175  o not. The defau
+00011d20: 6c74 2028 6063 6f6e 736f 6c69 6461 7465  lt (`consolidate
+00011d30: 643d 4e6f 6e65 6029 206d 6561 6e73 0a20  d=None`) means. 
+00011d40: 2020 2020 2020 2020 2020 2077 7269 7465             write
+00011d50: 2063 6f6e 736f 6c69 6461 7465 6420 6d65   consolidated me
+00011d60: 7461 6461 7461 2061 6e64 2061 7474 656d  tadata and attem
+00011d70: 7074 2074 6f20 7265 6164 2063 6f6e 736f  pt to read conso
+00011d80: 6c69 6461 7465 640a 2020 2020 2020 2020  lidated.        
+00011d90: 2020 2020 6d65 7461 6461 7461 2066 6f72      metadata for
+00011da0: 2065 7869 7374 696e 6720 7374 6f72 6573   existing stores
+00011db0: 2028 6661 6c6c 696e 6720 6261 636b 2074   (falling back t
+00011dc0: 6f20 6e6f 6e2d 636f 6e73 6f6c 6964 6174  o non-consolidat
+00011dd0: 6564 292e 0a0a 2020 2020 2020 2020 2020  ed)...          
+00011de0: 2020 5768 656e 2074 6865 2065 7870 6572    When the exper
+00011df0: 696d 656e 7461 6c20 6060 7a61 7272 5f76  imental ``zarr_v
+00011e00: 6572 7369 6f6e 3d33 6060 2c20 6060 636f  ersion=3``, ``co
+00011e10: 6e73 6f6c 6964 6174 6564 6060 206d 7573  nsolidated`` mus
+00011e20: 7420 6265 0a20 2020 2020 2020 2020 2020  t be.           
+00011e30: 2065 6974 6865 7220 6265 2060 604e 6f6e   either be ``Non
+00011e40: 6560 6020 6f72 2060 6046 616c 7365 6060  e`` or ``False``
+00011e50: 2e0a 2020 2020 2020 2020 6170 7065 6e64  ..        append
+00011e60: 5f64 696d 203a 2068 6173 6861 626c 652c  _dim : hashable,
+00011e70: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00011e80: 2020 2020 2020 4966 2073 6574 2c20 7468        If set, th
+00011e90: 6520 6469 6d65 6e73 696f 6e20 616c 6f6e  e dimension alon
+00011ea0: 6720 7768 6963 6820 7468 6520 6461 7461  g which the data
+00011eb0: 2077 696c 6c20 6265 2061 7070 656e 6465   will be appende
+00011ec0: 642e 2041 6c6c 0a20 2020 2020 2020 2020  d. All.         
+00011ed0: 2020 206f 7468 6572 2064 696d 656e 7369     other dimensi
+00011ee0: 6f6e 7320 6f6e 206f 7665 7272 6964 6465  ons on overridde
+00011ef0: 6e20 7661 7269 6162 6c65 7320 6d75 7374  n variables must
+00011f00: 2072 656d 6169 6e20 7468 6520 7361 6d65   remain the same
+00011f10: 2073 697a 652e 0a20 2020 2020 2020 2072   size..        r
+00011f20: 6567 696f 6e20 3a20 6469 6374 2c20 6f70  egion : dict, op
+00011f30: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00011f40: 2020 204f 7074 696f 6e61 6c20 6d61 7070     Optional mapp
+00011f50: 696e 6720 6672 6f6d 2064 696d 656e 7369  ing from dimensi
+00011f60: 6f6e 206e 616d 6573 2074 6f20 696e 7465  on names to inte
+00011f70: 6765 7220 736c 6963 6573 2061 6c6f 6e67  ger slices along
+00011f80: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00011f90: 6173 6574 2064 696d 656e 7369 6f6e 7320  aset dimensions 
+00011fa0: 746f 2069 6e64 6963 6174 6520 7468 6520  to indicate the 
+00011fb0: 7265 6769 6f6e 206f 6620 6578 6973 7469  region of existi
+00011fc0: 6e67 207a 6172 7220 6172 7261 7928 7329  ng zarr array(s)
+00011fd0: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
+00011fe0: 7768 6963 6820 746f 2077 7269 7465 2074  which to write t
+00011ff0: 6869 7320 6461 7461 7365 7427 7320 6461  his dataset's da
+00012000: 7461 2e20 466f 7220 6578 616d 706c 652c  ta. For example,
+00012010: 0a20 2020 2020 2020 2020 2020 2060 607b  .            ``{
+00012020: 2778 273a 2073 6c69 6365 2830 2c20 3130  'x': slice(0, 10
+00012030: 3030 292c 2027 7927 3a20 736c 6963 6528  00), 'y': slice(
+00012040: 3130 3030 302c 2031 3130 3030 297d 6060  10000, 11000)}``
+00012050: 2077 6f75 6c64 2069 6e64 6963 6174 650a   would indicate.
+00012060: 2020 2020 2020 2020 2020 2020 7468 6174              that
+00012070: 2076 616c 7565 7320 7368 6f75 6c64 2062   values should b
+00012080: 6520 7772 6974 7465 6e20 746f 2074 6865  e written to the
+00012090: 2072 6567 696f 6e20 6060 303a 3130 3030   region ``0:1000
+000120a0: 6060 2061 6c6f 6e67 2060 6078 6060 0a20  `` along ``x``. 
+000120b0: 2020 2020 2020 2020 2020 2061 6e64 2060             and `
+000120c0: 6031 3030 3030 3a31 3130 3030 6060 2061  `10000:11000`` a
+000120d0: 6c6f 6e67 2060 6079 6060 2e0a 0a20 2020  long ``y``...   
+000120e0: 2020 2020 2020 2020 2054 776f 2072 6573           Two res
+000120f0: 7472 6963 7469 6f6e 7320 6170 706c 7920  trictions apply 
+00012100: 746f 2074 6865 2075 7365 206f 6620 6060  to the use of ``
+00012110: 7265 6769 6f6e 6060 3a0a 0a20 2020 2020  region``:..     
+00012120: 2020 2020 2020 202d 2049 6620 6060 7265         - If ``re
+00012130: 6769 6f6e 6060 2069 7320 7365 742c 205f  gion`` is set, _
+00012140: 616c 6c5f 2076 6172 6961 626c 6573 2069  all_ variables i
+00012150: 6e20 6120 6461 7461 7365 7420 6d75 7374  n a dataset must
+00012160: 2068 6176 6520 6174 0a20 2020 2020 2020   have at.       
+00012170: 2020 2020 2020 206c 6561 7374 206f 6e65         least one
+00012180: 2064 696d 656e 7369 6f6e 2069 6e20 636f   dimension in co
+00012190: 6d6d 6f6e 2077 6974 6820 7468 6520 7265  mmon with the re
+000121a0: 6769 6f6e 2e20 4f74 6865 7220 7661 7269  gion. Other vari
+000121b0: 6162 6c65 730a 2020 2020 2020 2020 2020  ables.          
+000121c0: 2020 2020 7368 6f75 6c64 2062 6520 7772      should be wr
+000121d0: 6974 7465 6e20 696e 2061 2073 6570 6172  itten in a separ
+000121e0: 6174 6520 6361 6c6c 2074 6f20 6060 746f  ate call to ``to
+000121f0: 5f7a 6172 7228 2960 602e 0a20 2020 2020  _zarr()``..     
+00012200: 2020 2020 2020 202d 2044 696d 656e 7369         - Dimensi
+00012210: 6f6e 7320 6361 6e6e 6f74 2062 6520 696e  ons cannot be in
+00012220: 636c 7564 6564 2069 6e20 626f 7468 2060  cluded in both `
+00012230: 6072 6567 696f 6e60 6020 616e 640a 2020  `region`` and.  
+00012240: 2020 2020 2020 2020 2020 2020 6060 6170              ``ap
+00012250: 7065 6e64 5f64 696d 6060 2061 7420 7468  pend_dim`` at th
+00012260: 6520 7361 6d65 2074 696d 652e 2054 6f20  e same time. To 
+00012270: 6372 6561 7465 2065 6d70 7479 2061 7272  create empty arr
+00012280: 6179 7320 746f 2066 696c 6c0a 2020 2020  ays to fill.    
+00012290: 2020 2020 2020 2020 2020 696e 2077 6974            in wit
+000122a0: 6820 6060 7265 6769 6f6e 6060 2c20 7573  h ``region``, us
+000122b0: 6520 6120 7365 7061 7261 7465 2063 616c  e a separate cal
+000122c0: 6c20 746f 2060 6074 6f5f 7a61 7272 2829  l to ``to_zarr()
+000122d0: 6060 2077 6974 680a 2020 2020 2020 2020  `` with.        
+000122e0: 2020 2020 2020 6060 636f 6d70 7574 653d        ``compute=
+000122f0: 4661 6c73 6560 602e 2053 6565 2022 4170  False``. See "Ap
+00012300: 7065 6e64 696e 6720 746f 2065 7869 7374  pending to exist
+00012310: 696e 6720 5a61 7272 2073 746f 7265 7322  ing Zarr stores"
+00012320: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
+00012330: 2020 7468 6520 7265 6665 7265 6e63 6520    the reference 
+00012340: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
+00012350: 7220 6675 6c6c 2064 6574 6169 6c73 2e0a  r full details..
+00012360: 2020 2020 2020 2020 7361 6665 5f63 6875          safe_chu
+00012370: 6e6b 7320 3a20 626f 6f6c 2c20 6465 6661  nks : bool, defa
+00012380: 756c 743a 2054 7275 650a 2020 2020 2020  ult: True.      
+00012390: 2020 2020 2020 4966 2054 7275 652c 206f        If True, o
+000123a0: 6e6c 7920 616c 6c6f 7720 7772 6974 6573  nly allow writes
+000123b0: 2074 6f20 7768 656e 2074 6865 7265 2069   to when there i
+000123c0: 7320 6120 6d61 6e79 2d74 6f2d 6f6e 6520  s a many-to-one 
+000123d0: 7265 6c61 7469 6f6e 7368 6970 0a20 2020  relationship.   
+000123e0: 2020 2020 2020 2020 2062 6574 7765 656e           between
+000123f0: 205a 6172 7220 6368 756e 6b73 2028 7370   Zarr chunks (sp
+00012400: 6563 6966 6965 6420 696e 2065 6e63 6f64  ecified in encod
+00012410: 696e 6729 2061 6e64 2044 6173 6b20 6368  ing) and Dask ch
+00012420: 756e 6b73 2e0a 2020 2020 2020 2020 2020  unks..          
+00012430: 2020 5365 7420 4661 6c73 6520 746f 206f    Set False to o
+00012440: 7665 7272 6964 6520 7468 6973 2072 6573  verride this res
+00012450: 7472 6963 7469 6f6e 3b20 686f 7765 7665  triction; howeve
+00012460: 722c 2064 6174 6120 6d61 7920 6265 636f  r, data may beco
+00012470: 6d65 2063 6f72 7275 7074 6564 0a20 2020  me corrupted.   
+00012480: 2020 2020 2020 2020 2069 6620 5a61 7272           if Zarr
+00012490: 2061 7272 6179 7320 6172 6520 7772 6974   arrays are writ
+000124a0: 7465 6e20 696e 2070 6172 616c 6c65 6c2e  ten in parallel.
+000124b0: 2054 6869 7320 6f70 7469 6f6e 206d 6179   This option may
+000124c0: 2062 6520 7573 6566 756c 2069 6e20 636f   be useful in co
+000124d0: 6d62 696e 6174 696f 6e0a 2020 2020 2020  mbination.      
+000124e0: 2020 2020 2020 7769 7468 2060 6063 6f6d        with ``com
+000124f0: 7075 7465 3d46 616c 7365 6060 2074 6f20  pute=False`` to 
+00012500: 696e 6974 6961 6c69 7a65 2061 205a 6172  initialize a Zar
+00012510: 7220 6672 6f6d 2061 6e20 6578 6973 7469  r from an existi
+00012520: 6e67 0a20 2020 2020 2020 2020 2020 2044  ng.            D
+00012530: 6174 6173 6574 2077 6974 6820 6172 6269  ataset with arbi
+00012540: 7472 6172 7920 6368 756e 6b20 7374 7275  trary chunk stru
+00012550: 6374 7572 652e 0a20 2020 2020 2020 2073  cture..        s
+00012560: 746f 7261 6765 5f6f 7074 696f 6e73 203a  torage_options :
+00012570: 2064 6963 742c 206f 7074 696f 6e61 6c0a   dict, optional.
+00012580: 2020 2020 2020 2020 2020 2020 416e 7920              Any 
+00012590: 6164 6469 7469 6f6e 616c 2070 6172 616d  additional param
+000125a0: 6574 6572 7320 666f 7220 7468 6520 7374  eters for the st
+000125b0: 6f72 6167 6520 6261 636b 656e 6420 2869  orage backend (i
+000125c0: 676e 6f72 6564 2066 6f72 206c 6f63 616c  gnored for local
+000125d0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+000125e0: 6873 292e 0a20 2020 2020 2020 207a 6172  hs)..        zar
+000125f0: 725f 7665 7273 696f 6e20 3a20 696e 7420  r_version : int 
+00012600: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
+00012610: 6c0a 2020 2020 2020 2020 2020 2020 5468  l.            Th
+00012620: 6520 6465 7369 7265 6420 7a61 7272 2073  e desired zarr s
+00012630: 7065 6320 7665 7273 696f 6e20 746f 2074  pec version to t
+00012640: 6172 6765 7420 2863 7572 7265 6e74 6c79  arget (currently
+00012650: 2032 206f 7220 3329 2e20 5468 650a 2020   2 or 3). The.  
+00012660: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00012670: 7420 6f66 204e 6f6e 6520 7769 6c6c 2061  t of None will a
+00012680: 7474 656d 7074 2074 6f20 6465 7465 726d  ttempt to determ
+00012690: 696e 6520 7468 6520 7a61 7272 2076 6572  ine the zarr ver
+000126a0: 7369 6f6e 2066 726f 6d0a 2020 2020 2020  sion from.      
+000126b0: 2020 2020 2020 6060 7374 6f72 6560 6020        ``store`` 
+000126c0: 7768 656e 2070 6f73 7369 626c 652c 206f  when possible, o
+000126d0: 7468 6572 7769 7365 2064 6566 6175 6c74  therwise default
+000126e0: 696e 6720 746f 2032 2e0a 2020 2020 2020  ing to 2..      
+000126f0: 2020 6368 756e 6b6d 616e 6167 6572 5f73    chunkmanager_s
+00012700: 746f 7265 5f6b 7761 7267 7320 3a20 6469  tore_kwargs : di
+00012710: 6374 2c20 6f70 7469 6f6e 616c 0a20 2020  ct, optional.   
+00012720: 2020 2020 2020 2020 2041 6464 6974 696f           Additio
+00012730: 6e61 6c20 6b65 7977 6f72 6420 6172 6775  nal keyword argu
+00012740: 6d65 6e74 7320 7061 7373 6564 206f 6e20  ments passed on 
+00012750: 746f 2074 6865 2060 4368 756e 6b4d 616e  to the `ChunkMan
+00012760: 6167 6572 2e73 746f 7265 6020 6d65 7468  ager.store` meth
+00012770: 6f64 2075 7365 6420 746f 2073 746f 7265  od used to store
+00012780: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
+00012790: 6e6b 6564 2061 7272 6179 732e 2046 6f72  nked arrays. For
+000127a0: 2065 7861 6d70 6c65 2066 6f72 2061 2064   example for a d
+000127b0: 6173 6b20 6172 7261 7920 6164 6469 7469  ask array additi
+000127c0: 6f6e 616c 206b 7761 7267 7320 7769 6c6c  onal kwargs will
+000127d0: 2062 6520 7061 7373 6564 2065 7665 6e74   be passed event
+000127e0: 7561 6c6c 7920 746f 0a20 2020 2020 2020  ually to.       
+000127f0: 2020 2020 203a 7079 3a66 756e 633a 6064       :py:func:`d
+00012800: 6173 6b2e 6172 7261 792e 7374 6f72 6528  ask.array.store(
+00012810: 2960 2e20 4578 7065 7269 6d65 6e74 616c  )`. Experimental
+00012820: 2041 5049 2074 6861 7420 7368 6f75 6c64   API that should
+00012830: 206e 6f74 2062 6520 7265 6c69 6564 2075   not be relied u
+00012840: 706f 6e2e 0a0a 2020 2020 2020 2020 5265  pon...        Re
+00012850: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+00012860: 2d2d 2d2d 2d0a 2020 2020 2020 2020 2020  -----.          
+00012870: 2020 2a20 6060 6461 736b 2e64 656c 6179    * ``dask.delay
+00012880: 6564 2e44 656c 6179 6564 6060 2069 6620  ed.Delayed`` if 
+00012890: 636f 6d70 7574 6520 6973 2046 616c 7365  compute is False
+000128a0: 0a20 2020 2020 2020 2020 2020 202a 205a  .            * Z
+000128b0: 6172 7253 746f 7265 206f 7468 6572 7769  arrStore otherwi
+000128c0: 7365 0a0a 2020 2020 2020 2020 5265 6665  se..        Refe
+000128d0: 7265 6e63 6573 0a20 2020 2020 2020 202d  rences.        -
+000128e0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+000128f0: 2020 6874 7470 733a 2f2f 7a61 7272 2e72    https://zarr.r
+00012900: 6561 6474 6865 646f 6373 2e69 6f2f 0a0a  eadthedocs.io/..
+00012910: 2020 2020 2020 2020 4e6f 7465 730a 2020          Notes.  
+00012920: 2020 2020 2020 2d2d 2d2d 2d0a 2020 2020        -----.    
+00012930: 2020 2020 5a61 7272 2063 6875 6e6b 696e      Zarr chunkin
+00012940: 6720 6265 6861 7669 6f72 3a0a 2020 2020  g behavior:.    
+00012950: 2020 2020 2020 2020 4966 2063 6875 6e6b          If chunk
+00012960: 7320 6172 6520 666f 756e 6420 696e 2074  s are found in t
+00012970: 6865 2065 6e63 6f64 696e 6720 6172 6775  he encoding argu
+00012980: 6d65 6e74 206f 7220 6174 7472 6962 7574  ment or attribut
+00012990: 650a 2020 2020 2020 2020 2020 2020 636f  e.            co
+000129a0: 7272 6573 706f 6e64 696e 6720 746f 2061  rresponding to a
+000129b0: 6e79 2044 6174 6141 7272 6179 2c20 7468  ny DataArray, th
+000129c0: 6f73 6520 6368 756e 6b73 2061 7265 2075  ose chunks are u
+000129d0: 7365 642e 0a20 2020 2020 2020 2020 2020  sed..           
+000129e0: 2049 6620 6120 4461 7461 4172 7261 7920   If a DataArray 
+000129f0: 6973 2061 2064 6173 6b20 6172 7261 792c  is a dask array,
+00012a00: 2069 7420 6973 2077 7269 7474 656e 2077   it is written w
+00012a10: 6974 6820 7468 6f73 6520 6368 756e 6b73  ith those chunks
+00012a20: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+00012a30: 206e 6f74 206f 7468 6572 2063 6875 6e6b   not other chunk
+00012a40: 7320 6172 6520 666f 756e 642c 205a 6172  s are found, Zar
+00012a50: 7220 7573 6573 2069 7473 206f 776e 2068  r uses its own h
+00012a60: 6575 7269 7374 6963 7320 746f 0a20 2020  euristics to.   
+00012a70: 2020 2020 2020 2020 2063 686f 6f73 6520           choose 
+00012a80: 6175 746f 6d61 7469 6320 6368 756e 6b20  automatic chunk 
+00012a90: 7369 7a65 732e 0a0a 2020 2020 2020 2020  sizes...        
+00012aa0: 656e 636f 6469 6e67 3a0a 2020 2020 2020  encoding:.      
+00012ab0: 2020 2020 2020 5468 6520 656e 636f 6469        The encodi
+00012ac0: 6e67 2061 7474 7269 6275 7465 2028 6966  ng attribute (if
+00012ad0: 2065 7869 7374 7329 206f 6620 7468 6520   exists) of the 
+00012ae0: 4461 7461 4172 7261 7928 7329 2077 696c  DataArray(s) wil
+00012af0: 6c20 6265 0a20 2020 2020 2020 2020 2020  l be.           
+00012b00: 2075 7365 642e 204f 7665 7272 6964 6520   used. Override 
+00012b10: 616e 7920 6578 6973 7469 6e67 2065 6e63  any existing enc
+00012b20: 6f64 696e 6773 2062 7920 7072 6f76 6964  odings by provid
+00012b30: 696e 6720 7468 6520 6060 656e 636f 6469  ing the ``encodi
+00012b40: 6e67 6060 206b 7761 7267 2e0a 0a20 2020  ng`` kwarg...   
+00012b50: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00012b60: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00012b70: 2020 2020 2020 203a 7265 663a 6069 6f2e         :ref:`io.
+00012b80: 7a61 7272 600a 2020 2020 2020 2020 2020  zarr`.          
+00012b90: 2020 5468 6520 492f 4f20 7573 6572 2067    The I/O user g
+00012ba0: 7569 6465 2c20 7769 7468 206d 6f72 6520  uide, with more 
+00012bb0: 6465 7461 696c 7320 616e 6420 6578 616d  details and exam
+00012bc0: 706c 6573 2e0a 2020 2020 2020 2020 2222  ples..        ""
+00012bd0: 220a 2020 2020 2020 2020 6672 6f6d 2078  ".        from x
+00012be0: 6172 7261 792e 6261 636b 656e 6473 2e61  array.backends.a
+00012bf0: 7069 2069 6d70 6f72 7420 746f 5f7a 6172  pi import to_zar
+00012c00: 720a 0a20 2020 2020 2020 2072 6574 7572  r..        retur
+00012c10: 6e20 746f 5f7a 6172 7228 2020 2320 7479  n to_zarr(  # ty
+00012c20: 7065 3a20 6967 6e6f 7265 5b63 616c 6c2d  pe: ignore[call-
+00012c30: 6f76 6572 6c6f 6164 2c6d 6973 635d 0a20  overload,misc]. 
+00012c40: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00012c50: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
+00012c60: 7265 3d73 746f 7265 2c0a 2020 2020 2020  re=store,.      
+00012c70: 2020 2020 2020 6368 756e 6b5f 7374 6f72        chunk_stor
+00012c80: 653d 6368 756e 6b5f 7374 6f72 652c 0a20  e=chunk_store,. 
+00012c90: 2020 2020 2020 2020 2020 2073 746f 7261             stora
+00012ca0: 6765 5f6f 7074 696f 6e73 3d73 746f 7261  ge_options=stora
+00012cb0: 6765 5f6f 7074 696f 6e73 2c0a 2020 2020  ge_options,.    
+00012cc0: 2020 2020 2020 2020 6d6f 6465 3d6d 6f64          mode=mod
+00012cd0: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
+00012ce0: 796e 6368 726f 6e69 7a65 723d 7379 6e63  ynchronizer=sync
+00012cf0: 6872 6f6e 697a 6572 2c0a 2020 2020 2020  hronizer,.      
+00012d00: 2020 2020 2020 6772 6f75 703d 6772 6f75        group=grou
+00012d10: 702c 0a20 2020 2020 2020 2020 2020 2065  p,.            e
+00012d20: 6e63 6f64 696e 673d 656e 636f 6469 6e67  ncoding=encoding
+00012d30: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00012d40: 6d70 7574 653d 636f 6d70 7574 652c 0a20  mpute=compute,. 
+00012d50: 2020 2020 2020 2020 2020 2063 6f6e 736f             conso
+00012d60: 6c69 6461 7465 643d 636f 6e73 6f6c 6964  lidated=consolid
+00012d70: 6174 6564 2c0a 2020 2020 2020 2020 2020  ated,.          
+00012d80: 2020 6170 7065 6e64 5f64 696d 3d61 7070    append_dim=app
+00012d90: 656e 645f 6469 6d2c 0a20 2020 2020 2020  end_dim,.       
+00012da0: 2020 2020 2072 6567 696f 6e3d 7265 6769       region=regi
+00012db0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00012dc0: 7361 6665 5f63 6875 6e6b 733d 7361 6665  safe_chunks=safe
+00012dd0: 5f63 6875 6e6b 732c 0a20 2020 2020 2020  _chunks,.       
+00012de0: 2020 2020 207a 6172 725f 7665 7273 696f       zarr_versio
+00012df0: 6e3d 7a61 7272 5f76 6572 7369 6f6e 2c0a  n=zarr_version,.
+00012e00: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+00012e10: 6b6d 616e 6167 6572 5f73 746f 7265 5f6b  kmanager_store_k
+00012e20: 7761 7267 733d 6368 756e 6b6d 616e 6167  wargs=chunkmanag
+00012e30: 6572 5f73 746f 7265 5f6b 7761 7267 732c  er_store_kwargs,
+00012e40: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00012e50: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+00012e60: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
+00012e70: 2020 2072 6574 7572 6e20 666f 726d 6174     return format
+00012e80: 7469 6e67 2e64 6174 6173 6574 5f72 6570  ting.dataset_rep
+00012e90: 7228 7365 6c66 290a 0a20 2020 2064 6566  r(self)..    def
+00012ea0: 205f 7265 7072 5f68 746d 6c5f 2873 656c   _repr_html_(sel
+00012eb0: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
+00012ec0: 2020 2069 6620 4f50 5449 4f4e 535b 2264     if OPTIONS["d
+00012ed0: 6973 706c 6179 5f73 7479 6c65 225d 203d  isplay_style"] =
+00012ee0: 3d20 2274 6578 7422 3a0a 2020 2020 2020  = "text":.      
+00012ef0: 2020 2020 2020 7265 7475 726e 2066 223c        return f"<
+00012f00: 7072 653e 7b65 7363 6170 6528 7265 7072  pre>{escape(repr
+00012f10: 2873 656c 6629 297d 3c2f 7072 653e 220a  (self))}</pre>".
+00012f20: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00012f30: 6f72 6d61 7474 696e 675f 6874 6d6c 2e64  ormatting_html.d
+00012f40: 6174 6173 6574 5f72 6570 7228 7365 6c66  ataset_repr(self
+00012f50: 290a 0a20 2020 2064 6566 2069 6e66 6f28  )..    def info(
+00012f60: 7365 6c66 2c20 6275 663a 2049 4f20 7c20  self, buf: IO | 
+00012f70: 4e6f 6e65 203d 204e 6f6e 6529 202d 3e20  None = None) -> 
+00012f80: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00012f90: 220a 2020 2020 2020 2020 436f 6e63 6973  ".        Concis
+00012fa0: 6520 7375 6d6d 6172 7920 6f66 2061 2044  e summary of a D
+00012fb0: 6174 6173 6574 2076 6172 6961 626c 6573  ataset variables
+00012fc0: 2061 6e64 2061 7474 7269 6275 7465 732e   and attributes.
+00012fd0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00012fe0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00012ff0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00013000: 6275 6620 3a20 6669 6c65 2d6c 696b 652c  buf : file-like,
+00013010: 2064 6566 6175 6c74 3a20 7379 732e 7374   default: sys.st
+00013020: 646f 7574 0a20 2020 2020 2020 2020 2020  dout.           
+00013030: 2077 7269 7461 626c 6520 6275 6666 6572   writable buffer
+00013040: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+00013050: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+00013060: 2d2d 2d0a 2020 2020 2020 2020 7061 6e64  ---.        pand
+00013070: 6173 2e44 6174 6146 7261 6d65 2e61 7373  as.DataFrame.ass
+00013080: 6967 6e0a 2020 2020 2020 2020 6e63 6475  ign.        ncdu
+00013090: 6d70 203a 206e 6574 4344 4627 7320 6e63  mp : netCDF's nc
+000130a0: 6475 6d70 0a20 2020 2020 2020 2022 2222  dump.        """
+000130b0: 0a20 2020 2020 2020 2069 6620 6275 6620  .        if buf 
+000130c0: 6973 204e 6f6e 653a 2020 2320 7072 6167  is None:  # prag
+000130d0: 6d61 3a20 6e6f 2063 6f76 6572 0a20 2020  ma: no cover.   
+000130e0: 2020 2020 2020 2020 2062 7566 203d 2073           buf = s
+000130f0: 7973 2e73 7464 6f75 740a 0a20 2020 2020  ys.stdout..     
+00013100: 2020 206c 696e 6573 203d 205b 5d0a 2020     lines = [].  
+00013110: 2020 2020 2020 6c69 6e65 732e 6170 7065        lines.appe
+00013120: 6e64 2822 7861 7272 6179 2e44 6174 6173  nd("xarray.Datas
+00013130: 6574 207b 2229 0a20 2020 2020 2020 206c  et {").        l
+00013140: 696e 6573 2e61 7070 656e 6428 2264 696d  ines.append("dim
+00013150: 656e 7369 6f6e 733a 2229 0a20 2020 2020  ensions:").     
+00013160: 2020 2066 6f72 206e 616d 652c 2073 697a     for name, siz
+00013170: 6520 696e 2073 656c 662e 6469 6d73 2e69  e in self.dims.i
+00013180: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00013190: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
+000131a0: 2866 225c 747b 6e61 6d65 7d20 3d20 7b73  (f"\t{name} = {s
+000131b0: 697a 657d 203b 2229 0a20 2020 2020 2020  ize} ;").       
+000131c0: 206c 696e 6573 2e61 7070 656e 6428 225c   lines.append("\
+000131d0: 6e76 6172 6961 626c 6573 3a22 290a 2020  nvariables:").  
+000131e0: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
+000131f0: 6461 2069 6e20 7365 6c66 2e76 6172 6961  da in self.varia
+00013200: 626c 6573 2e69 7465 6d73 2829 3a0a 2020  bles.items():.  
+00013210: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
+00013220: 2022 2c20 222e 6a6f 696e 286d 6170 2873   ", ".join(map(s
+00013230: 7472 2c20 6461 2e64 696d 7329 290a 2020  tr, da.dims)).  
+00013240: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
+00013250: 6170 7065 6e64 2866 225c 747b 6461 2e64  append(f"\t{da.d
+00013260: 7479 7065 7d20 7b6e 616d 657d 287b 6469  type} {name}({di
+00013270: 6d73 7d29 203b 2229 0a20 2020 2020 2020  ms}) ;").       
+00013280: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+00013290: 2064 612e 6174 7472 732e 6974 656d 7328   da.attrs.items(
+000132a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000132b0: 2020 206c 696e 6573 2e61 7070 656e 6428     lines.append(
+000132c0: 6622 5c74 5c74 7b6e 616d 657d 3a7b 6b7d  f"\t\t{name}:{k}
+000132d0: 203d 207b 767d 203b 2229 0a20 2020 2020   = {v} ;").     
+000132e0: 2020 206c 696e 6573 2e61 7070 656e 6428     lines.append(
+000132f0: 225c 6e2f 2f20 676c 6f62 616c 2061 7474  "\n// global att
+00013300: 7269 6275 7465 733a 2229 0a20 2020 2020  ributes:").     
+00013310: 2020 2066 6f72 206b 2c20 7620 696e 2073     for k, v in s
+00013320: 656c 662e 6174 7472 732e 6974 656d 7328  elf.attrs.items(
+00013330: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
+00013340: 696e 6573 2e61 7070 656e 6428 6622 5c74  ines.append(f"\t
+00013350: 3a7b 6b7d 203d 207b 767d 203b 2229 0a20  :{k} = {v} ;"). 
+00013360: 2020 2020 2020 206c 696e 6573 2e61 7070         lines.app
+00013370: 656e 6428 227d 2229 0a0a 2020 2020 2020  end("}")..      
+00013380: 2020 6275 662e 7772 6974 6528 225c 6e22    buf.write("\n"
+00013390: 2e6a 6f69 6e28 6c69 6e65 7329 290a 0a20  .join(lines)).. 
+000133a0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+000133b0: 2064 6566 2063 6875 6e6b 7328 7365 6c66   def chunks(self
+000133c0: 2920 2d3e 204d 6170 7069 6e67 5b48 6173  ) -> Mapping[Has
+000133d0: 6861 626c 652c 2074 7570 6c65 5b69 6e74  hable, tuple[int
+000133e0: 2c20 2e2e 2e5d 5d3a 0a20 2020 2020 2020  , ...]]:.       
+000133f0: 2022 2222 0a20 2020 2020 2020 204d 6170   """.        Map
+00013400: 7069 6e67 2066 726f 6d20 6469 6d65 6e73  ping from dimens
+00013410: 696f 6e20 6e61 6d65 7320 746f 2062 6c6f  ion names to blo
+00013420: 636b 206c 656e 6774 6873 2066 6f72 2074  ck lengths for t
+00013430: 6869 7320 6461 7461 7365 7427 7320 6461  his dataset's da
+00013440: 7461 2c20 6f72 204e 6f6e 6520 6966 0a20  ta, or None if. 
+00013450: 2020 2020 2020 2074 6865 2075 6e64 6572         the under
+00013460: 6c79 696e 6720 6461 7461 2069 7320 6e6f  lying data is no
+00013470: 7420 6120 6461 736b 2061 7272 6179 2e0a  t a dask array..
+00013480: 2020 2020 2020 2020 4361 6e6e 6f74 2062          Cannot b
+00013490: 6520 6d6f 6469 6669 6564 2064 6972 6563  e modified direc
+000134a0: 746c 792c 2062 7574 2063 616e 2062 6520  tly, but can be 
+000134b0: 6d6f 6469 6669 6564 2062 7920 6361 6c6c  modified by call
+000134c0: 696e 6720 2e63 6875 6e6b 2829 2e0a 0a20  ing .chunk()... 
+000134d0: 2020 2020 2020 2053 616d 6520 6173 2044         Same as D
+000134e0: 6174 6173 6574 2e63 6875 6e6b 7369 7a65  ataset.chunksize
+000134f0: 732c 2062 7574 206d 6169 6e74 6169 6e65  s, but maintaine
+00013500: 6420 666f 7220 6261 636b 7761 7264 7320  d for backwards 
+00013510: 636f 6d70 6174 6962 696c 6974 792e 0a0a  compatibility...
+00013520: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+00013530: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00013540: 2d0a 2020 2020 2020 2020 4461 7461 7365  -.        Datase
+00013550: 742e 6368 756e 6b0a 2020 2020 2020 2020  t.chunk.        
+00013560: 4461 7461 7365 742e 6368 756e 6b73 697a  Dataset.chunksiz
+00013570: 6573 0a20 2020 2020 2020 2078 6172 7261  es.        xarra
+00013580: 792e 756e 6966 795f 6368 756e 6b73 0a20  y.unify_chunks. 
+00013590: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000135a0: 2020 2072 6574 7572 6e20 6765 745f 6368     return get_ch
+000135b0: 756e 6b73 697a 6573 2873 656c 662e 7661  unksizes(self.va
+000135c0: 7269 6162 6c65 732e 7661 6c75 6573 2829  riables.values()
+000135d0: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+000135e0: 0a20 2020 2064 6566 2063 6875 6e6b 7369  .    def chunksi
+000135f0: 7a65 7328 7365 6c66 2920 2d3e 204d 6170  zes(self) -> Map
+00013600: 7069 6e67 5b48 6173 6861 626c 652c 2074  ping[Hashable, t
+00013610: 7570 6c65 5b69 6e74 2c20 2e2e 2e5d 5d3a  uple[int, ...]]:
+00013620: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013630: 2020 2020 204d 6170 7069 6e67 2066 726f       Mapping fro
+00013640: 6d20 6469 6d65 6e73 696f 6e20 6e61 6d65  m dimension name
+00013650: 7320 746f 2062 6c6f 636b 206c 656e 6774  s to block lengt
+00013660: 6873 2066 6f72 2074 6869 7320 6461 7461  hs for this data
+00013670: 7365 7427 7320 6461 7461 2c20 6f72 204e  set's data, or N
+00013680: 6f6e 6520 6966 0a20 2020 2020 2020 2074  one if.        t
+00013690: 6865 2075 6e64 6572 6c79 696e 6720 6461  he underlying da
+000136a0: 7461 2069 7320 6e6f 7420 6120 6461 736b  ta is not a dask
+000136b0: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
+000136c0: 4361 6e6e 6f74 2062 6520 6d6f 6469 6669  Cannot be modifi
+000136d0: 6564 2064 6972 6563 746c 792c 2062 7574  ed directly, but
+000136e0: 2063 616e 2062 6520 6d6f 6469 6669 6564   can be modified
+000136f0: 2062 7920 6361 6c6c 696e 6720 2e63 6875   by calling .chu
+00013700: 6e6b 2829 2e0a 0a20 2020 2020 2020 2053  nk()...        S
+00013710: 616d 6520 6173 2044 6174 6173 6574 2e63  ame as Dataset.c
+00013720: 6875 6e6b 732e 0a0a 2020 2020 2020 2020  hunks...        
+00013730: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00013740: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00013750: 2020 4461 7461 7365 742e 6368 756e 6b0a    Dataset.chunk.
+00013760: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
+00013770: 6368 756e 6b73 0a20 2020 2020 2020 2078  chunks.        x
+00013780: 6172 7261 792e 756e 6966 795f 6368 756e  array.unify_chun
+00013790: 6b73 0a20 2020 2020 2020 2022 2222 0a20  ks.        """. 
+000137a0: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
+000137b0: 745f 6368 756e 6b73 697a 6573 2873 656c  t_chunksizes(sel
+000137c0: 662e 7661 7269 6162 6c65 732e 7661 6c75  f.variables.valu
+000137d0: 6573 2829 290a 0a20 2020 2064 6566 2063  es())..    def c
+000137e0: 6875 6e6b 280a 2020 2020 2020 2020 7365  hunk(.        se
+000137f0: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
+00013800: 2020 2020 2020 2063 6875 6e6b 733a 2028         chunks: (
+00013810: 0a20 2020 2020 2020 2020 2020 2069 6e74  .            int
+00013820: 207c 204c 6974 6572 616c 5b22 6175 746f   | Literal["auto
+00013830: 225d 207c 204d 6170 7069 6e67 5b41 6e79  "] | Mapping[Any
+00013840: 2c20 4e6f 6e65 207c 2069 6e74 207c 2073  , None | int | s
+00013850: 7472 207c 2074 7570 6c65 5b69 6e74 2c20  tr | tuple[int, 
+00013860: 2e2e 2e5d 5d0a 2020 2020 2020 2020 2920  ...]].        ) 
+00013870: 3d20 7b7d 2c20 2023 207b 7d20 6576 656e  = {},  # {} even
+00013880: 2074 686f 7567 6820 6974 2773 2074 6563   though it's tec
+00013890: 686e 6963 616c 6c79 2075 6e73 6166 652c  hnically unsafe,
+000138a0: 2069 7320 6265 696e 6720 7573 6564 2069   is being used i
+000138b0: 6e74 656e 7469 6f6e 616c 6c79 2068 6572  ntentionally her
+000138c0: 6520 2823 3436 3637 290a 2020 2020 2020  e (#4667).      
+000138d0: 2020 6e61 6d65 5f70 7265 6669 783a 2073    name_prefix: s
+000138e0: 7472 203d 2022 7861 7272 6179 2d22 2c0a  tr = "xarray-",.
+000138f0: 2020 2020 2020 2020 746f 6b65 6e3a 2073          token: s
+00013900: 7472 207c 204e 6f6e 6520 3d20 4e6f 6e65  tr | None = None
+00013910: 2c0a 2020 2020 2020 2020 6c6f 636b 3a20  ,.        lock: 
+00013920: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+00013930: 2020 2020 2020 696e 6c69 6e65 5f61 7272        inline_arr
+00013940: 6179 3a20 626f 6f6c 203d 2046 616c 7365  ay: bool = False
+00013950: 2c0a 2020 2020 2020 2020 6368 756e 6b65  ,.        chunke
+00013960: 645f 6172 7261 795f 7479 7065 3a20 7374  d_array_type: st
+00013970: 7220 7c20 4368 756e 6b4d 616e 6167 6572  r | ChunkManager
+00013980: 456e 7472 7970 6f69 6e74 207c 204e 6f6e  Entrypoint | Non
+00013990: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+000139a0: 2020 6672 6f6d 5f61 7272 6179 5f6b 7761    from_array_kwa
+000139b0: 7267 733d 4e6f 6e65 2c0a 2020 2020 2020  rgs=None,.      
+000139c0: 2020 2a2a 6368 756e 6b73 5f6b 7761 7267    **chunks_kwarg
+000139d0: 733a 204e 6f6e 6520 7c20 696e 7420 7c20  s: None | int | 
+000139e0: 7374 7220 7c20 7475 706c 655b 696e 742c  str | tuple[int,
+000139f0: 202e 2e2e 5d2c 0a20 2020 2029 202d 3e20   ...],.    ) -> 
+00013a00: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+00013a10: 2020 2022 2222 436f 6572 6365 2061 6c6c     """Coerce all
+00013a20: 2061 7272 6179 7320 696e 2074 6869 7320   arrays in this 
+00013a30: 6461 7461 7365 7420 696e 746f 2064 6173  dataset into das
+00013a40: 6b20 6172 7261 7973 2077 6974 6820 7468  k arrays with th
+00013a50: 6520 6769 7665 6e0a 2020 2020 2020 2020  e given.        
+00013a60: 6368 756e 6b73 2e0a 0a20 2020 2020 2020  chunks...       
+00013a70: 204e 6f6e 2d64 6173 6b20 6172 7261 7973   Non-dask arrays
+00013a80: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
+00013a90: 2077 696c 6c20 6265 2063 6f6e 7665 7274   will be convert
+00013aa0: 6564 2074 6f20 6461 736b 2061 7272 6179  ed to dask array
+00013ab0: 732e 2044 6173 6b0a 2020 2020 2020 2020  s. Dask.        
+00013ac0: 6172 7261 7973 2077 696c 6c20 6265 2072  arrays will be r
+00013ad0: 6563 6875 6e6b 6564 2074 6f20 7468 6520  echunked to the 
+00013ae0: 6769 7665 6e20 6368 756e 6b20 7369 7a65  given chunk size
+00013af0: 732e 0a0a 2020 2020 2020 2020 4966 206e  s...        If n
+00013b00: 6569 7468 6572 2063 6875 6e6b 7320 6973  either chunks is
+00013b10: 206e 6f74 2070 726f 7669 6465 6420 666f   not provided fo
+00013b20: 7220 6f6e 6520 6f72 206d 6f72 6520 6469  r one or more di
+00013b30: 6d65 6e73 696f 6e73 2c20 6368 756e 6b0a  mensions, chunk.
+00013b40: 2020 2020 2020 2020 7369 7a65 7320 616c          sizes al
+00013b50: 6f6e 6720 7468 6174 2064 696d 656e 7369  ong that dimensi
+00013b60: 6f6e 2077 696c 6c20 6e6f 7420 6265 2075  on will not be u
+00013b70: 7064 6174 6564 3b20 6e6f 6e2d 6461 736b  pdated; non-dask
+00013b80: 2061 7272 6179 7320 7769 6c6c 2062 650a   arrays will be.
+00013b90: 2020 2020 2020 2020 636f 6e76 6572 7465          converte
+00013ba0: 6420 696e 746f 2064 6173 6b20 6172 7261  d into dask arra
+00013bb0: 7973 2077 6974 6820 6120 7369 6e67 6c65  ys with a single
+00013bc0: 2062 6c6f 636b 2e0a 0a20 2020 2020 2020   block...       
+00013bd0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00013be0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00013bf0: 2020 2020 2020 2063 6875 6e6b 7320 3a20         chunks : 
+00013c00: 696e 742c 2074 7570 6c65 206f 6620 696e  int, tuple of in
+00013c10: 742c 2022 6175 746f 2220 6f72 206d 6170  t, "auto" or map
+00013c20: 7069 6e67 206f 6620 6861 7368 6162 6c65  ping of hashable
+00013c30: 2074 6f20 696e 742c 206f 7074 696f 6e61   to int, optiona
+00013c40: 6c0a 2020 2020 2020 2020 2020 2020 4368  l.            Ch
+00013c50: 756e 6b20 7369 7a65 7320 616c 6f6e 6720  unk sizes along 
+00013c60: 6561 6368 2064 696d 656e 7369 6f6e 2c20  each dimension, 
+00013c70: 652e 672e 2c20 6060 3560 602c 2060 6022  e.g., ``5``, ``"
+00013c80: 6175 746f 2260 602c 206f 720a 2020 2020  auto"``, or.    
+00013c90: 2020 2020 2020 2020 6060 7b22 7822 3a20          ``{"x": 
+00013ca0: 352c 2022 7922 3a20 357d 6060 2e0a 2020  5, "y": 5}``..  
+00013cb0: 2020 2020 2020 6e61 6d65 5f70 7265 6669        name_prefi
+00013cc0: 7820 3a20 7374 722c 2064 6566 6175 6c74  x : str, default
+00013cd0: 3a20 2278 6172 7261 792d 220a 2020 2020  : "xarray-".    
+00013ce0: 2020 2020 2020 2020 5072 6566 6978 2066          Prefix f
+00013cf0: 6f72 2074 6865 206e 616d 6520 6f66 2061  or the name of a
+00013d00: 6e79 206e 6577 2064 6173 6b20 6172 7261  ny new dask arra
+00013d10: 7973 2e0a 2020 2020 2020 2020 746f 6b65  ys..        toke
+00013d20: 6e20 3a20 7374 722c 206f 7074 696f 6e61  n : str, optiona
+00013d30: 6c0a 2020 2020 2020 2020 2020 2020 546f  l.            To
+00013d40: 6b65 6e20 756e 6971 7565 6c79 2069 6465  ken uniquely ide
+00013d50: 6e74 6966 7969 6e67 2074 6869 7320 6461  ntifying this da
+00013d60: 7461 7365 742e 0a20 2020 2020 2020 206c  taset..        l
+00013d70: 6f63 6b20 3a20 626f 6f6c 2c20 6465 6661  ock : bool, defa
+00013d80: 756c 743a 2046 616c 7365 0a20 2020 2020  ult: False.     
+00013d90: 2020 2020 2020 2050 6173 7365 6420 6f6e         Passed on
+00013da0: 2074 6f20 3a70 793a 6675 6e63 3a60 6461   to :py:func:`da
+00013db0: 736b 2e61 7272 6179 2e66 726f 6d5f 6172  sk.array.from_ar
+00013dc0: 7261 7960 2c20 6966 2074 6865 2061 7272  ray`, if the arr
+00013dd0: 6179 2069 7320 6e6f 740a 2020 2020 2020  ay is not.      
+00013de0: 2020 2020 2020 616c 7265 6164 7920 6173        already as
+00013df0: 2064 6173 6b20 6172 7261 792e 0a20 2020   dask array..   
+00013e00: 2020 2020 2069 6e6c 696e 655f 6172 7261       inline_arra
+00013e10: 793a 2062 6f6f 6c2c 2064 6566 6175 6c74  y: bool, default
+00013e20: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
+00013e30: 2020 2020 5061 7373 6564 206f 6e20 746f      Passed on to
+00013e40: 203a 7079 3a66 756e 633a 6064 6173 6b2e   :py:func:`dask.
+00013e50: 6172 7261 792e 6672 6f6d 5f61 7272 6179  array.from_array
+00013e60: 602c 2069 6620 7468 6520 6172 7261 7920  `, if the array 
+00013e70: 6973 206e 6f74 0a20 2020 2020 2020 2020  is not.         
+00013e80: 2020 2061 6c72 6561 6479 2061 7320 6461     already as da
+00013e90: 736b 2061 7272 6179 2e0a 2020 2020 2020  sk array..      
+00013ea0: 2020 6368 756e 6b65 645f 6172 7261 795f    chunked_array_
+00013eb0: 7479 7065 3a20 7374 722c 206f 7074 696f  type: str, optio
+00013ec0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+00013ed0: 5768 6963 6820 6368 756e 6b65 6420 6172  Which chunked ar
+00013ee0: 7261 7920 7479 7065 2074 6f20 636f 6572  ray type to coer
+00013ef0: 6365 2074 6869 7320 6461 7461 7365 7473  ce this datasets
+00013f00: 2720 6172 7261 7973 2074 6f2e 0a20 2020  ' arrays to..   
+00013f10: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
+00013f20: 7320 746f 2027 6461 736b 2720 6966 2069  s to 'dask' if i
+00013f30: 6e73 7461 6c6c 6564 2c20 656c 7365 2077  nstalled, else w
+00013f40: 6861 7465 7665 7220 6973 2072 6567 6973  hatever is regis
+00013f50: 7465 7265 6420 7669 6120 7468 6520 6043  tered via the `C
+00013f60: 6875 6e6b 4d61 6e61 6765 7245 6e65 7472  hunkManagerEnetr
+00013f70: 7950 6f69 6e74 6020 7379 7374 656d 2e0a  yPoint` system..
+00013f80: 2020 2020 2020 2020 2020 2020 4578 7065              Expe
+00013f90: 7269 6d65 6e74 616c 2041 5049 2074 6861  rimental API tha
+00013fa0: 7420 7368 6f75 6c64 206e 6f74 2062 6520  t should not be 
+00013fb0: 7265 6c69 6564 2075 706f 6e2e 0a20 2020  relied upon..   
+00013fc0: 2020 2020 2066 726f 6d5f 6172 7261 795f       from_array_
+00013fd0: 6b77 6172 6773 3a20 6469 6374 2c20 6f70  kwargs: dict, op
+00013fe0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00013ff0: 2020 2041 6464 6974 696f 6e61 6c20 6b65     Additional ke
+00014000: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
+00014010: 7061 7373 6564 206f 6e20 746f 2074 6865  passed on to the
+00014020: 2060 4368 756e 6b4d 616e 6167 6572 456e   `ChunkManagerEn
+00014030: 7472 7970 6f69 6e74 2e66 726f 6d5f 6172  trypoint.from_ar
+00014040: 7261 7960 206d 6574 686f 6420 7573 6564  ray` method used
+00014050: 2074 6f20 6372 6561 7465 0a20 2020 2020   to create.     
+00014060: 2020 2020 2020 2063 6875 6e6b 6564 2061         chunked a
+00014070: 7272 6179 732c 2076 6961 2077 6869 6368  rrays, via which
+00014080: 6576 6572 2063 6875 6e6b 206d 616e 6167  ever chunk manag
+00014090: 6572 2069 7320 7370 6563 6966 6965 6420  er is specified 
+000140a0: 7468 726f 7567 6820 7468 6520 6063 6875  through the `chu
+000140b0: 6e6b 6564 5f61 7272 6179 5f74 7970 6560  nked_array_type`
+000140c0: 206b 7761 7267 2e0a 2020 2020 2020 2020   kwarg..        
+000140d0: 2020 2020 466f 7220 6578 616d 706c 652c      For example,
+000140e0: 2077 6974 6820 6461 736b 2061 7320 7468   with dask as th
+000140f0: 6520 6465 6661 756c 7420 6368 756e 6b65  e default chunke
+00014100: 6420 6172 7261 7920 7479 7065 2c20 7468  d array type, th
+00014110: 6973 206d 6574 686f 6420 776f 756c 6420  is method would 
+00014120: 7061 7373 2061 6464 6974 696f 6e61 6c20  pass additional 
+00014130: 6b77 6172 6773 0a20 2020 2020 2020 2020  kwargs.         
+00014140: 2020 2074 6f20 3a70 793a 6675 6e63 3a60     to :py:func:`
+00014150: 6461 736b 2e61 7272 6179 2e66 726f 6d5f  dask.array.from_
+00014160: 6172 7261 7960 2e20 4578 7065 7269 6d65  array`. Experime
+00014170: 6e74 616c 2041 5049 2074 6861 7420 7368  ntal API that sh
+00014180: 6f75 6c64 206e 6f74 2062 6520 7265 6c69  ould not be reli
+00014190: 6564 2075 706f 6e2e 0a20 2020 2020 2020  ed upon..       
+000141a0: 202a 2a63 6875 6e6b 735f 6b77 6172 6773   **chunks_kwargs
+000141b0: 203a 207b 6469 6d3a 2063 6875 6e6b 732c   : {dim: chunks,
+000141c0: 202e 2e2e 7d2c 206f 7074 696f 6e61 6c0a   ...}, optional.
+000141d0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+000141e0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
+000141f0: 7320 666f 726d 206f 6620 6060 6368 756e  s form of ``chun
+00014200: 6b73 6060 2e0a 2020 2020 2020 2020 2020  ks``..          
+00014210: 2020 4f6e 6520 6f66 2063 6875 6e6b 7320    One of chunks 
+00014220: 6f72 2063 6875 6e6b 735f 6b77 6172 6773  or chunks_kwargs
+00014230: 206d 7573 7420 6265 2070 726f 7669 6465   must be provide
+00014240: 640a 0a20 2020 2020 2020 2052 6574 7572  d..        Retur
+00014250: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00014260: 2d2d 0a20 2020 2020 2020 2063 6875 6e6b  --.        chunk
+00014270: 6564 203a 2078 6172 7261 792e 4461 7461  ed : xarray.Data
+00014280: 7365 740a 0a20 2020 2020 2020 2053 6565  set..        See
+00014290: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+000142a0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+000142b0: 6174 6173 6574 2e63 6875 6e6b 730a 2020  ataset.chunks.  
+000142c0: 2020 2020 2020 4461 7461 7365 742e 6368        Dataset.ch
+000142d0: 756e 6b73 697a 6573 0a20 2020 2020 2020  unksizes.       
+000142e0: 2078 6172 7261 792e 756e 6966 795f 6368   xarray.unify_ch
+000142f0: 756e 6b73 0a20 2020 2020 2020 2064 6173  unks.        das
+00014300: 6b2e 6172 7261 792e 6672 6f6d 5f61 7272  k.array.from_arr
+00014310: 6179 0a20 2020 2020 2020 2022 2222 0a20  ay.        """. 
+00014320: 2020 2020 2020 2069 6620 6368 756e 6b73         if chunks
+00014330: 2069 7320 4e6f 6e65 2061 6e64 2063 6875   is None and chu
+00014340: 6e6b 735f 6b77 6172 6773 2069 7320 4e6f  nks_kwargs is No
+00014350: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00014360: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
+00014370: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00014380: 4e6f 6e65 2076 616c 7565 2066 6f72 2027  None value for '
+00014390: 6368 756e 6b73 2720 6973 2064 6570 7265  chunks' is depre
+000143a0: 6361 7465 642e 2022 0a20 2020 2020 2020  cated. ".       
+000143b0: 2020 2020 2020 2020 2022 4974 2077 696c           "It wil
+000143c0: 6c20 7261 6973 6520 616e 2065 7272 6f72  l raise an error
+000143d0: 2069 6e20 7468 6520 6675 7475 7265 2e20   in the future. 
+000143e0: 5573 6520 696e 7374 6561 6420 277b 7d27  Use instead '{}'
+000143f0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00014400: 2020 2063 6174 6567 6f72 793d 4675 7475     category=Futu
+00014410: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
+00014420: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00014430: 2020 2020 2063 6875 6e6b 7320 3d20 7b7d       chunks = {}
+00014440: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+00014450: 6e73 7461 6e63 6528 6368 756e 6b73 2c20  nstance(chunks, 
+00014460: 284e 756d 6265 722c 2073 7472 2c20 696e  (Number, str, in
+00014470: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
+00014480: 2063 6875 6e6b 7320 3d20 6469 6374 2e66   chunks = dict.f
+00014490: 726f 6d6b 6579 7328 7365 6c66 2e64 696d  romkeys(self.dim
+000144a0: 732c 2063 6875 6e6b 7329 0a20 2020 2020  s, chunks).     
+000144b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000144c0: 2020 2020 2063 6875 6e6b 7320 3d20 6569       chunks = ei
+000144d0: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
+000144e0: 7267 7328 6368 756e 6b73 2c20 6368 756e  rgs(chunks, chun
+000144f0: 6b73 5f6b 7761 7267 732c 2022 6368 756e  ks_kwargs, "chun
+00014500: 6b22 290a 0a20 2020 2020 2020 2062 6164  k")..        bad
+00014510: 5f64 696d 7320 3d20 6368 756e 6b73 2e6b  _dims = chunks.k
+00014520: 6579 7328 2920 2d20 7365 6c66 2e64 696d  eys() - self.dim
+00014530: 732e 6b65 7973 2829 0a20 2020 2020 2020  s.keys().       
+00014540: 2069 6620 6261 645f 6469 6d73 3a0a 2020   if bad_dims:.  
+00014550: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00014560: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00014570: 2020 2020 2020 2020 2020 2020 6622 736f              f"so
+00014580: 6d65 2063 6875 6e6b 7320 6b65 7973 2061  me chunks keys a
+00014590: 7265 206e 6f74 2064 696d 656e 7369 6f6e  re not dimension
+000145a0: 7320 6f6e 2074 6869 7320 6f62 6a65 6374  s on this object
+000145b0: 3a20 7b62 6164 5f64 696d 737d 220a 2020  : {bad_dims}".  
+000145c0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+000145d0: 2020 2020 2063 6875 6e6b 6d61 6e61 6765       chunkmanage
+000145e0: 7220 3d20 6775 6573 735f 6368 756e 6b6d  r = guess_chunkm
+000145f0: 616e 6167 6572 2863 6875 6e6b 6564 5f61  anager(chunked_a
+00014600: 7272 6179 5f74 7970 6529 0a20 2020 2020  rray_type).     
+00014610: 2020 2069 6620 6672 6f6d 5f61 7272 6179     if from_array
+00014620: 5f6b 7761 7267 7320 6973 204e 6f6e 653a  _kwargs is None:
+00014630: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+00014640: 6d5f 6172 7261 795f 6b77 6172 6773 203d  m_array_kwargs =
+00014650: 207b 7d0a 0a20 2020 2020 2020 2076 6172   {}..        var
+00014660: 6961 626c 6573 203d 207b 0a20 2020 2020  iables = {.     
+00014670: 2020 2020 2020 206b 3a20 5f6d 6179 6265         k: _maybe
+00014680: 5f63 6875 6e6b 280a 2020 2020 2020 2020  _chunk(.        
+00014690: 2020 2020 2020 2020 6b2c 0a20 2020 2020          k,.     
+000146a0: 2020 2020 2020 2020 2020 2076 2c0a 2020             v,.  
+000146b0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+000146c0: 756e 6b73 2c0a 2020 2020 2020 2020 2020  unks,.          
+000146d0: 2020 2020 2020 746f 6b65 6e2c 0a20 2020        token,.   
+000146e0: 2020 2020 2020 2020 2020 2020 206c 6f63               loc
+000146f0: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
+00014700: 2020 206e 616d 655f 7072 6566 6978 2c0a     name_prefix,.
+00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014720: 696e 6c69 6e65 5f61 7272 6179 3d69 6e6c  inline_array=inl
+00014730: 696e 655f 6172 7261 792c 0a20 2020 2020  ine_array,.     
+00014740: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00014750: 6564 5f61 7272 6179 5f74 7970 653d 6368  ed_array_type=ch
+00014760: 756e 6b6d 616e 6167 6572 2c0a 2020 2020  unkmanager,.    
+00014770: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+00014780: 5f61 7272 6179 5f6b 7761 7267 733d 6672  _array_kwargs=fr
+00014790: 6f6d 5f61 7272 6179 5f6b 7761 7267 732e  om_array_kwargs.
+000147a0: 636f 7079 2829 2c0a 2020 2020 2020 2020  copy(),.        
+000147b0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000147c0: 2020 666f 7220 6b2c 2076 2069 6e20 7365    for k, v in se
+000147d0: 6c66 2e76 6172 6961 626c 6573 2e69 7465  lf.variables.ite
+000147e0: 6d73 2829 0a20 2020 2020 2020 207d 0a20  ms().        }. 
+000147f0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00014800: 6c66 2e5f 7265 706c 6163 6528 7661 7269  lf._replace(vari
+00014810: 6162 6c65 7329 0a0a 2020 2020 6465 6620  ables)..    def 
+00014820: 5f76 616c 6964 6174 655f 696e 6465 7865  _validate_indexe
+00014830: 7273 280a 2020 2020 2020 2020 7365 6c66  rs(.        self
+00014840: 2c20 696e 6465 7865 7273 3a20 4d61 7070  , indexers: Mapp
+00014850: 696e 675b 416e 792c 2041 6e79 5d2c 206d  ing[Any, Any], m
+00014860: 6973 7369 6e67 5f64 696d 733a 2045 7272  issing_dims: Err
+00014870: 6f72 4f70 7469 6f6e 7357 6974 6857 6172  orOptionsWithWar
+00014880: 6e20 3d20 2272 6169 7365 220a 2020 2020  n = "raise".    
+00014890: 2920 2d3e 2049 7465 7261 746f 725b 7475  ) -> Iterator[tu
+000148a0: 706c 655b 4861 7368 6162 6c65 2c20 696e  ple[Hashable, in
+000148b0: 7420 7c20 736c 6963 6520 7c20 6e70 2e6e  t | slice | np.n
+000148c0: 6461 7272 6179 207c 2056 6172 6961 626c  darray | Variabl
+000148d0: 655d 5d3a 0a20 2020 2020 2020 2022 2222  e]]:.        """
+000148e0: 4865 7265 2077 6520 6d61 6b65 2073 7572  Here we make sur
+000148f0: 650a 2020 2020 2020 2020 2b20 696e 6465  e.        + inde
+00014900: 7865 7220 6861 7320 6120 7661 6c69 6420  xer has a valid 
+00014910: 6b65 7973 0a20 2020 2020 2020 202b 2069  keys.        + i
+00014920: 6e64 6578 6572 2069 7320 696e 2061 2076  ndexer is in a v
+00014930: 616c 6964 2064 6174 6120 7479 7065 0a20  alid data type. 
+00014940: 2020 2020 2020 202b 2073 7472 696e 6720         + string 
+00014950: 696e 6465 7865 7273 2061 7265 2063 6173  indexers are cas
+00014960: 7420 746f 2074 6865 2061 7070 726f 7072  t to the appropr
+00014970: 6961 7465 2064 6174 6520 7479 7065 2069  iate date type i
+00014980: 6620 7468 650a 2020 2020 2020 2020 2020  f the.          
+00014990: 6173 736f 6369 6174 6564 2069 6e64 6578  associated index
+000149a0: 2069 7320 6120 4461 7465 7469 6d65 496e   is a DatetimeIn
+000149b0: 6465 7820 6f72 2043 4654 696d 6549 6e64  dex or CFTimeInd
+000149c0: 6578 0a20 2020 2020 2020 2022 2222 0a20  ex.        """. 
+000149d0: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
+000149e0: 6179 2e63 6f64 696e 672e 6366 7469 6d65  ay.coding.cftime
+000149f0: 696e 6465 7820 696d 706f 7274 2043 4654  index import CFT
+00014a00: 696d 6549 6e64 6578 0a20 2020 2020 2020  imeIndex.       
+00014a10: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
+00014a20: 652e 6461 7461 6172 7261 7920 696d 706f  e.dataarray impo
+00014a30: 7274 2044 6174 6141 7272 6179 0a0a 2020  rt DataArray..  
+00014a40: 2020 2020 2020 696e 6465 7865 7273 203d        indexers =
+00014a50: 2064 726f 705f 6469 6d73 5f66 726f 6d5f   drop_dims_from_
+00014a60: 696e 6465 7865 7273 2869 6e64 6578 6572  indexers(indexer
+00014a70: 732c 2073 656c 662e 6469 6d73 2c20 6d69  s, self.dims, mi
+00014a80: 7373 696e 675f 6469 6d73 290a 0a20 2020  ssing_dims)..   
+00014a90: 2020 2020 2023 2061 6c6c 2069 6e64 6578       # all index
+00014aa0: 6572 7320 7368 6f75 6c64 2062 6520 696e  ers should be in
+00014ab0: 742c 2073 6c69 6365 2c20 6e70 2e6e 6461  t, slice, np.nda
+00014ac0: 7272 6179 732c 206f 7220 5661 7269 6162  rrays, or Variab
+00014ad0: 6c65 0a20 2020 2020 2020 2066 6f72 206b  le.        for k
+00014ae0: 2c20 7620 696e 2069 6e64 6578 6572 732e  , v in indexers.
+00014af0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00014b00: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00014b10: 6365 2876 2c20 2869 6e74 2c20 736c 6963  ce(v, (int, slic
+00014b20: 652c 2056 6172 6961 626c 6529 293a 0a20  e, Variable)):. 
+00014b30: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00014b40: 6965 6c64 206b 2c20 760a 2020 2020 2020  ield k, v.      
+00014b50: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+00014b60: 7461 6e63 6528 762c 2044 6174 6141 7272  tance(v, DataArr
+00014b70: 6179 293a 0a20 2020 2020 2020 2020 2020  ay):.           
+00014b80: 2020 2020 2079 6965 6c64 206b 2c20 762e       yield k, v.
+00014b90: 7661 7269 6162 6c65 0a20 2020 2020 2020  variable.       
+00014ba0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00014bb0: 616e 6365 2876 2c20 7475 706c 6529 3a0a  ance(v, tuple):.
+00014bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bd0: 7969 656c 6420 6b2c 2061 735f 7661 7269  yield k, as_vari
+00014be0: 6162 6c65 2876 290a 2020 2020 2020 2020  able(v).        
+00014bf0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+00014c00: 6e63 6528 762c 2044 6174 6173 6574 293a  nce(v, Dataset):
+00014c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c20: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+00014c30: 2822 6361 6e6e 6f74 2075 7365 2061 2044  ("cannot use a D
+00014c40: 6174 6173 6574 2061 7320 616e 2069 6e64  ataset as an ind
+00014c50: 6578 6572 2229 0a20 2020 2020 2020 2020  exer").         
+00014c60: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00014c70: 6365 2876 2c20 5365 7175 656e 6365 2920  ce(v, Sequence) 
+00014c80: 616e 6420 6c65 6e28 7629 203d 3d20 303a  and len(v) == 0:
+00014c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ca0: 2079 6965 6c64 206b 2c20 6e70 2e65 6d70   yield k, np.emp
+00014cb0: 7479 2828 302c 292c 2064 7479 7065 3d22  ty((0,), dtype="
+00014cc0: 696e 7436 3422 290a 2020 2020 2020 2020  int64").        
+00014cd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00014ce0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00014cf0: 2069 735f 6475 636b 5f61 7272 6179 2876   is_duck_array(v
+00014d00: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00014d10: 2020 2020 2020 2076 203d 206e 702e 6173         v = np.as
+00014d20: 6172 7261 7928 7629 0a0a 2020 2020 2020  array(v)..      
+00014d30: 2020 2020 2020 2020 2020 6966 2076 2e64            if v.d
+00014d40: 7479 7065 2e6b 696e 6420 696e 2022 5553  type.kind in "US
+00014d50: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00014d60: 2020 2020 2020 2069 6e64 6578 203d 2073         index = s
+00014d70: 656c 662e 5f69 6e64 6578 6573 5b6b 5d2e  elf._indexes[k].
+00014d80: 746f 5f70 616e 6461 735f 696e 6465 7828  to_pandas_index(
+00014d90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014da0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00014db0: 6e63 6528 696e 6465 782c 2070 642e 4461  nce(index, pd.Da
+00014dc0: 7465 7469 6d65 496e 6465 7829 3a0a 2020  tetimeIndex):.  
+00014dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014de0: 2020 2020 2020 7620 3d20 6475 636b 5f61        v = duck_a
+00014df0: 7272 6179 5f6f 7073 2e61 7374 7970 6528  rray_ops.astype(
+00014e00: 762c 2064 7479 7065 3d22 6461 7465 7469  v, dtype="dateti
+00014e10: 6d65 3634 5b6e 735d 2229 0a20 2020 2020  me64[ns]").     
+00014e20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00014e30: 6c69 6620 6973 696e 7374 616e 6365 2869  lif isinstance(i
+00014e40: 6e64 6578 2c20 4346 5469 6d65 496e 6465  ndex, CFTimeInde
+00014e50: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
+00014e60: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
+00014e70: 5f70 6172 7365 5f61 7272 6179 5f6f 665f  _parse_array_of_
+00014e80: 6366 7469 6d65 5f73 7472 696e 6773 2876  cftime_strings(v
+00014e90: 2c20 696e 6465 782e 6461 7465 5f74 7970  , index.date_typ
+00014ea0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+00014eb0: 2020 2020 6966 2076 2e6e 6469 6d20 3e20      if v.ndim > 
+00014ec0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00014ed0: 2020 2020 2020 2072 6169 7365 2049 6e64         raise Ind
+00014ee0: 6578 4572 726f 7228 0a20 2020 2020 2020  exError(.       
+00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f00: 2022 556e 6c61 6265 6c65 6420 6d75 6c74   "Unlabeled mult
+00014f10: 692d 6469 6d65 6e73 696f 6e61 6c20 6172  i-dimensional ar
+00014f20: 7261 7920 6361 6e6e 6f74 2062 6520 220a  ray cannot be ".
+00014f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f40: 2020 2020 2020 2020 2275 7365 6420 666f          "used fo
+00014f50: 7220 696e 6465 7869 6e67 3a20 7b7d 222e  r indexing: {}".
+00014f60: 666f 726d 6174 286b 290a 2020 2020 2020  format(k).      
+00014f70: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00014f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f90: 7969 656c 6420 6b2c 2076 0a0a 2020 2020  yield k, v..    
+00014fa0: 6465 6620 5f76 616c 6964 6174 655f 696e  def _validate_in
+00014fb0: 7465 7270 5f69 6e64 6578 6572 7328 0a20  terp_indexers(. 
+00014fc0: 2020 2020 2020 2073 656c 662c 2069 6e64         self, ind
+00014fd0: 6578 6572 733a 204d 6170 7069 6e67 5b41  exers: Mapping[A
+00014fe0: 6e79 2c20 416e 795d 0a20 2020 2029 202d  ny, Any].    ) -
+00014ff0: 3e20 4974 6572 6174 6f72 5b74 7570 6c65  > Iterator[tuple
+00015000: 5b48 6173 6861 626c 652c 2056 6172 6961  [Hashable, Varia
+00015010: 626c 655d 5d3a 0a20 2020 2020 2020 2022  ble]]:.        "
+00015020: 2222 5661 7269 616e 7420 6f66 205f 7661  ""Variant of _va
+00015030: 6c69 6461 7465 5f69 6e64 6578 6572 7320  lidate_indexers 
+00015040: 746f 2062 6520 7573 6564 2066 6f72 2069  to be used for i
+00015050: 6e74 6572 706f 6c61 7469 6f6e 2222 220a  nterpolation""".
+00015060: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+00015070: 2069 6e20 7365 6c66 2e5f 7661 6c69 6461   in self._valida
+00015080: 7465 5f69 6e64 6578 6572 7328 696e 6465  te_indexers(inde
+00015090: 7865 7273 293a 0a20 2020 2020 2020 2020  xers):.         
+000150a0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+000150b0: 2876 2c20 5661 7269 6162 6c65 293a 0a20  (v, Variable):. 
+000150c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000150d0: 6620 762e 6e64 696d 203d 3d20 313a 0a20  f v.ndim == 1:. 
+000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150f0: 2020 2079 6965 6c64 206b 2c20 762e 746f     yield k, v.to
+00015100: 5f69 6e64 6578 5f76 6172 6961 626c 6528  _index_variable(
+00015110: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015120: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00015130: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+00015140: 6420 6b2c 2076 0a20 2020 2020 2020 2020  d k, v.         
+00015150: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00015160: 6365 2876 2c20 696e 7429 3a0a 2020 2020  ce(v, int):.    
+00015170: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+00015180: 6420 6b2c 2056 6172 6961 626c 6528 2829  d k, Variable(()
+00015190: 2c20 762c 2061 7474 7273 3d73 656c 662e  , v, attrs=self.
+000151a0: 636f 6f72 6473 5b6b 5d2e 6174 7472 7329  coords[k].attrs)
+000151b0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000151c0: 6620 6973 696e 7374 616e 6365 2876 2c20  f isinstance(v, 
+000151d0: 6e70 2e6e 6461 7272 6179 293a 0a20 2020  np.ndarray):.   
+000151e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000151f0: 762e 6e64 696d 203d 3d20 303a 0a20 2020  v.ndim == 0:.   
+00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015210: 2079 6965 6c64 206b 2c20 5661 7269 6162   yield k, Variab
+00015220: 6c65 2828 292c 2076 2c20 6174 7472 733d  le((), v, attrs=
+00015230: 7365 6c66 2e63 6f6f 7264 735b 6b5d 2e61  self.coords[k].a
+00015240: 7474 7273 290a 2020 2020 2020 2020 2020  ttrs).          
+00015250: 2020 2020 2020 656c 6966 2076 2e6e 6469        elif v.ndi
+00015260: 6d20 3d3d 2031 3a0a 2020 2020 2020 2020  m == 1:.        
+00015270: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+00015280: 6420 6b2c 2049 6e64 6578 5661 7269 6162  d k, IndexVariab
+00015290: 6c65 2828 6b2c 292c 2076 2c20 6174 7472  le((k,), v, attr
+000152a0: 733d 7365 6c66 2e63 6f6f 7264 735b 6b5d  s=self.coords[k]
+000152b0: 2e61 7474 7273 290a 2020 2020 2020 2020  .attrs).        
+000152c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152e0: 2020 7261 6973 6520 4173 7365 7274 696f    raise Assertio
+000152f0: 6e45 7272 6f72 2829 2020 2320 416c 7265  nError()  # Alre
+00015300: 6164 7920 7465 7374 6564 2062 7920 5f76  ady tested by _v
+00015310: 616c 6964 6174 655f 696e 6465 7865 7273  alidate_indexers
+00015320: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00015330: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00015340: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00015350: 6f72 2874 7970 6528 7629 290a 0a20 2020  or(type(v))..   
+00015360: 2064 6566 205f 6765 745f 696e 6465 7865   def _get_indexe
+00015370: 7273 5f63 6f6f 7264 735f 616e 645f 696e  rs_coords_and_in
+00015380: 6465 7865 7328 7365 6c66 2c20 696e 6465  dexes(self, inde
+00015390: 7865 7273 293a 0a20 2020 2020 2020 2022  xers):.        "
+000153a0: 2222 4578 7472 6163 7420 636f 6f72 6469  ""Extract coordi
+000153b0: 6e61 7465 7320 616e 6420 696e 6465 7865  nates and indexe
+000153c0: 7320 6672 6f6d 2069 6e64 6578 6572 732e  s from indexers.
+000153d0: 0a0a 2020 2020 2020 2020 4f6e 6c79 2063  ..        Only c
+000153e0: 6f6f 7264 696e 6174 6520 7769 7468 2061  oordinate with a
+000153f0: 206e 616d 6520 6469 6666 6572 656e 7420   name different 
+00015400: 6672 6f6d 2061 6e79 206f 6620 7365 6c66  from any of self
+00015410: 2e76 6172 6961 626c 6573 2077 696c 6c0a  .variables will.
+00015420: 2020 2020 2020 2020 6265 2061 7474 6163          be attac
+00015430: 6865 642e 0a20 2020 2020 2020 2022 2222  hed..        """
+00015440: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
+00015450: 7272 6179 2e63 6f72 652e 6461 7461 6172  rray.core.dataar
+00015460: 7261 7920 696d 706f 7274 2044 6174 6141  ray import DataA
+00015470: 7272 6179 0a0a 2020 2020 2020 2020 636f  rray..        co
+00015480: 6f72 6473 5f6c 6973 7420 3d20 5b5d 0a20  ords_list = []. 
+00015490: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+000154a0: 696e 2069 6e64 6578 6572 732e 6974 656d  in indexers.item
+000154b0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000154c0: 2069 6620 6973 696e 7374 616e 6365 2876   if isinstance(v
+000154d0: 2c20 4461 7461 4172 7261 7929 3a0a 2020  , DataArray):.  
+000154e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000154f0: 2076 2e64 7479 7065 2e6b 696e 6420 3d3d   v.dtype.kind ==
+00015500: 2022 6222 3a0a 2020 2020 2020 2020 2020   "b":.          
+00015510: 2020 2020 2020 2020 2020 6966 2076 2e6e            if v.n
+00015520: 6469 6d20 213d 2031 3a20 2023 2077 6520  dim != 1:  # we 
+00015530: 6f6e 6c79 2073 7570 706f 7274 2031 2d64  only support 1-d
+00015540: 2062 6f6f 6c65 616e 2061 7272 6179 0a20   boolean array. 
+00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015560: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00015570: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00015580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015590: 2020 2020 2022 7b3a 647d 642d 626f 6f6c       "{:d}d-bool
+000155a0: 6561 6e20 6172 7261 7920 6973 2075 7365  ean array is use
+000155b0: 6420 666f 7220 696e 6465 7869 6e67 2061  d for indexing a
+000155c0: 6c6f 6e67 2022 0a20 2020 2020 2020 2020  long ".         
+000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155e0: 2020 2022 6469 6d65 6e73 696f 6e20 7b21     "dimension {!
+000155f0: 727d 2c20 6275 7420 6f6e 6c79 2031 6420  r}, but only 1d 
+00015600: 626f 6f6c 6561 6e20 6172 7261 7973 2061  boolean arrays a
+00015610: 7265 2022 0a20 2020 2020 2020 2020 2020  re ".           
+00015620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015630: 2022 7375 7070 6f72 7465 642e 222e 666f   "supported.".fo
+00015640: 726d 6174 2876 2e6e 6469 6d2c 206b 290a  rmat(v.ndim, k).
+00015650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015660: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00015670: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00015680: 4d61 6b65 2073 7572 6520 696e 2063 6173  Make sure in cas
+00015690: 6520 6f66 2062 6f6f 6c65 616e 2044 6174  e of boolean Dat
+000156a0: 6141 7272 6179 2c20 6974 730a 2020 2020  aArray, its.    
+000156b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000156c0: 2320 636f 6f72 6469 6e61 7465 2061 6c73  # coordinate als
+000156d0: 6f20 7368 6f75 6c64 2062 6520 696e 6465  o should be inde
+000156e0: 7865 642e 0a20 2020 2020 2020 2020 2020  xed..           
+000156f0: 2020 2020 2020 2020 2076 5f63 6f6f 7264           v_coord
+00015700: 7320 3d20 765b 762e 7661 6c75 6573 2e6e  s = v[v.values.n
+00015710: 6f6e 7a65 726f 2829 5b30 5d5d 2e63 6f6f  onzero()[0]].coo
+00015720: 7264 730a 2020 2020 2020 2020 2020 2020  rds.            
+00015730: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00015740: 2020 2020 2020 2020 2020 2020 2020 765f                v_
+00015750: 636f 6f72 6473 203d 2076 2e63 6f6f 7264  coords = v.coord
+00015760: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00015770: 2020 636f 6f72 6473 5f6c 6973 742e 6170    coords_list.ap
+00015780: 7065 6e64 2876 5f63 6f6f 7264 7329 0a0a  pend(v_coords)..
+00015790: 2020 2020 2020 2020 2320 7765 2064 6f6e          # we don
+000157a0: 2774 206e 6565 6420 746f 2063 616c 6c20  't need to call 
+000157b0: 616c 6967 6e28 2920 6578 706c 6963 6974  align() explicit
+000157c0: 6c79 206f 7220 6368 6563 6b20 696e 6465  ly or check inde
+000157d0: 7865 7320 666f 720a 2020 2020 2020 2020  xes for.        
+000157e0: 2320 616c 6967 6e6d 656e 742c 2062 6563  # alignment, bec
+000157f0: 6175 7365 206d 6572 6765 5f76 6172 6961  ause merge_varia
+00015800: 626c 6573 2061 6c72 6561 6479 2063 6865  bles already che
+00015810: 636b 7320 666f 7220 6578 6163 7420 616c  cks for exact al
+00015820: 6967 6e6d 656e 740a 2020 2020 2020 2020  ignment.        
+00015830: 2320 6265 7477 6565 6e20 6469 6d65 6e73  # between dimens
+00015840: 696f 6e20 636f 6f72 6469 6e61 7465 730a  ion coordinates.
+00015850: 2020 2020 2020 2020 636f 6f72 6473 2c20          coords, 
+00015860: 696e 6465 7865 7320 3d20 6d65 7267 655f  indexes = merge_
+00015870: 636f 6f72 6469 6e61 7465 735f 7769 7468  coordinates_with
+00015880: 6f75 745f 616c 6967 6e28 636f 6f72 6473  out_align(coords
+00015890: 5f6c 6973 7429 0a20 2020 2020 2020 2061  _list).        a
+000158a0: 7373 6572 745f 636f 6f72 6469 6e61 7465  ssert_coordinate
+000158b0: 5f63 6f6e 7369 7374 656e 7428 7365 6c66  _consistent(self
+000158c0: 2c20 636f 6f72 6473 290a 0a20 2020 2020  , coords)..     
+000158d0: 2020 2023 2073 696c 656e 746c 7920 6472     # silently dr
+000158e0: 6f70 2074 6865 2063 6f6e 666c 6963 7465  op the conflicte
+000158f0: 6420 7661 7269 6162 6c65 732e 0a20 2020  d variables..   
+00015900: 2020 2020 2061 7474 6163 6865 645f 636f       attached_co
+00015910: 6f72 6473 203d 207b 6b3a 2076 2066 6f72  ords = {k: v for
+00015920: 206b 2c20 7620 696e 2063 6f6f 7264 732e   k, v in coords.
+00015930: 6974 656d 7328 2920 6966 206b 206e 6f74  items() if k not
+00015940: 2069 6e20 7365 6c66 2e5f 7661 7269 6162   in self._variab
+00015950: 6c65 737d 0a20 2020 2020 2020 2061 7474  les}.        att
+00015960: 6163 6865 645f 696e 6465 7865 7320 3d20  ached_indexes = 
+00015970: 7b0a 2020 2020 2020 2020 2020 2020 6b3a  {.            k:
+00015980: 2076 2066 6f72 206b 2c20 7620 696e 2069   v for k, v in i
+00015990: 6e64 6578 6573 2e69 7465 6d73 2829 2069  ndexes.items() i
+000159a0: 6620 6b20 6e6f 7420 696e 2073 656c 662e  f k not in self.
+000159b0: 5f76 6172 6961 626c 6573 0a20 2020 2020  _variables.     
+000159c0: 2020 207d 0a20 2020 2020 2020 2072 6574     }.        ret
+000159d0: 7572 6e20 6174 7461 6368 6564 5f63 6f6f  urn attached_coo
+000159e0: 7264 732c 2061 7474 6163 6865 645f 696e  rds, attached_in
+000159f0: 6465 7865 730a 0a20 2020 2064 6566 2069  dexes..    def i
+00015a00: 7365 6c28 0a20 2020 2020 2020 2073 656c  sel(.        sel
+00015a10: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
+00015a20: 2020 2020 2020 696e 6465 7865 7273 3a20        indexers: 
+00015a30: 4d61 7070 696e 675b 416e 792c 2041 6e79  Mapping[Any, Any
+00015a40: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+00015a50: 0a20 2020 2020 2020 2064 726f 703a 2062  .        drop: b
+00015a60: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+00015a70: 2020 2020 206d 6973 7369 6e67 5f64 696d       missing_dim
+00015a80: 733a 2045 7272 6f72 4f70 7469 6f6e 7357  s: ErrorOptionsW
+00015a90: 6974 6857 6172 6e20 3d20 2272 6169 7365  ithWarn = "raise
+00015aa0: 222c 0a20 2020 2020 2020 202a 2a69 6e64  ",.        **ind
+00015ab0: 6578 6572 735f 6b77 6172 6773 3a20 416e  exers_kwargs: An
+00015ac0: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
+00015ad0: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+00015ae0: 2222 5265 7475 726e 7320 6120 6e65 7720  ""Returns a new 
+00015af0: 6461 7461 7365 7420 7769 7468 2065 6163  dataset with eac
+00015b00: 6820 6172 7261 7920 696e 6465 7865 6420  h array indexed 
+00015b10: 616c 6f6e 6720 7468 6520 7370 6563 6966  along the specif
+00015b20: 6965 640a 2020 2020 2020 2020 6469 6d65  ied.        dime
+00015b30: 6e73 696f 6e28 7329 2e0a 0a20 2020 2020  nsion(s)...     
+00015b40: 2020 2054 6869 7320 6d65 7468 6f64 2073     This method s
+00015b50: 656c 6563 7473 2076 616c 7565 7320 6672  elects values fr
+00015b60: 6f6d 2065 6163 6820 6172 7261 7920 7573  om each array us
+00015b70: 696e 6720 6974 7320 605f 5f67 6574 6974  ing its `__getit
+00015b80: 656d 5f5f 600a 2020 2020 2020 2020 6d65  em__`.        me
+00015b90: 7468 6f64 2c20 6578 6365 7074 2074 6869  thod, except thi
+00015ba0: 7320 6d65 7468 6f64 2064 6f65 7320 6e6f  s method does no
+00015bb0: 7420 7265 7175 6972 6520 6b6e 6f77 696e  t require knowin
+00015bc0: 6720 7468 6520 6f72 6465 7220 6f66 0a20  g the order of. 
+00015bd0: 2020 2020 2020 2065 6163 6820 6172 7261         each arra
+00015be0: 7927 7320 6469 6d65 6e73 696f 6e73 2e0a  y's dimensions..
+00015bf0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00015c00: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00015c10: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2069  ------.        i
+00015c20: 6e64 6578 6572 7320 3a20 6469 6374 2c20  ndexers : dict, 
+00015c30: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00015c40: 2020 2020 2041 2064 6963 7420 7769 7468       A dict with
+00015c50: 206b 6579 7320 6d61 7463 6869 6e67 2064   keys matching d
+00015c60: 696d 656e 7369 6f6e 7320 616e 6420 7661  imensions and va
+00015c70: 6c75 6573 2067 6976 656e 0a20 2020 2020  lues given.     
+00015c80: 2020 2020 2020 2062 7920 696e 7465 6765         by intege
+00015c90: 7273 2c20 736c 6963 6520 6f62 6a65 6374  rs, slice object
+00015ca0: 7320 6f72 2061 7272 6179 732e 0a20 2020  s or arrays..   
+00015cb0: 2020 2020 2020 2020 2069 6e64 6578 6572           indexer
+00015cc0: 2063 616e 2062 6520 6120 696e 7465 6765   can be a intege
+00015cd0: 722c 2073 6c69 6365 2c20 6172 7261 792d  r, slice, array-
+00015ce0: 6c69 6b65 206f 7220 4461 7461 4172 7261  like or DataArra
+00015cf0: 792e 0a20 2020 2020 2020 2020 2020 2049  y..            I
+00015d00: 6620 4461 7461 4172 7261 7973 2061 7265  f DataArrays are
+00015d10: 2070 6173 7365 6420 6173 2069 6e64 6578   passed as index
+00015d20: 6572 732c 2078 6172 7261 792d 7374 796c  ers, xarray-styl
+00015d30: 6520 696e 6465 7869 6e67 2077 696c 6c20  e indexing will 
+00015d40: 6265 0a20 2020 2020 2020 2020 2020 2063  be.            c
+00015d50: 6172 7269 6564 206f 7574 2e20 5365 6520  arried out. See 
+00015d60: 3a72 6566 3a60 696e 6465 7869 6e67 6020  :ref:`indexing` 
+00015d70: 666f 7220 7468 6520 6465 7461 696c 732e  for the details.
+00015d80: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
+00015d90: 206f 6620 696e 6465 7865 7273 206f 7220   of indexers or 
+00015da0: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
+00015db0: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+00015dc0: 2e0a 2020 2020 2020 2020 6472 6f70 203a  ..        drop :
+00015dd0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
+00015de0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00015df0: 2020 4966 2060 6064 726f 703d 5472 7565    If ``drop=True
+00015e00: 6060 2c20 6472 6f70 2063 6f6f 7264 696e  ``, drop coordin
+00015e10: 6174 6573 2076 6172 6961 626c 6573 2069  ates variables i
+00015e20: 6e64 6578 6564 2062 7920 696e 7465 6765  ndexed by intege
+00015e30: 7273 0a20 2020 2020 2020 2020 2020 2069  rs.            i
+00015e40: 6e73 7465 6164 206f 6620 6d61 6b69 6e67  nstead of making
+00015e50: 2074 6865 6d20 7363 616c 6172 2e0a 2020   them scalar..  
+00015e60: 2020 2020 2020 6d69 7373 696e 675f 6469        missing_di
+00015e70: 6d73 203a 207b 2272 6169 7365 222c 2022  ms : {"raise", "
+00015e80: 7761 726e 222c 2022 6967 6e6f 7265 227d  warn", "ignore"}
+00015e90: 2c20 6465 6661 756c 743a 2022 7261 6973  , default: "rais
+00015ea0: 6522 0a20 2020 2020 2020 2020 2020 2057  e".            W
+00015eb0: 6861 7420 746f 2064 6f20 6966 2064 696d  hat to do if dim
+00015ec0: 656e 7369 6f6e 7320 7468 6174 2073 686f  ensions that sho
+00015ed0: 756c 6420 6265 2073 656c 6563 7465 6420  uld be selected 
+00015ee0: 6672 6f6d 2061 7265 206e 6f74 2070 7265  from are not pre
+00015ef0: 7365 6e74 2069 6e20 7468 650a 2020 2020  sent in the.    
+00015f00: 2020 2020 2020 2020 4461 7461 7365 743a          Dataset:
+00015f10: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+00015f20: 7261 6973 6522 3a20 7261 6973 6520 616e  raise": raise an
+00015f30: 2065 7863 6570 7469 6f6e 0a20 2020 2020   exception.     
+00015f40: 2020 2020 2020 202d 2022 7761 726e 223a         - "warn":
+00015f50: 2072 6169 7365 2061 2077 6172 6e69 6e67   raise a warning
+00015f60: 2c20 616e 6420 6967 6e6f 7265 2074 6865  , and ignore the
+00015f70: 206d 6973 7369 6e67 2064 696d 656e 7369   missing dimensi
+00015f80: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+00015f90: 2d20 2269 676e 6f72 6522 3a20 6967 6e6f  - "ignore": igno
+00015fa0: 7265 2074 6865 206d 6973 7369 6e67 2064  re the missing d
+00015fb0: 696d 656e 7369 6f6e 730a 0a20 2020 2020  imensions..     
+00015fc0: 2020 202a 2a69 6e64 6578 6572 735f 6b77     **indexers_kw
+00015fd0: 6172 6773 203a 207b 6469 6d3a 2069 6e64  args : {dim: ind
+00015fe0: 6578 6572 2c20 2e2e 2e7d 2c20 6f70 7469  exer, ...}, opti
+00015ff0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00016000: 2054 6865 206b 6579 776f 7264 2061 7267   The keyword arg
+00016010: 756d 656e 7473 2066 6f72 6d20 6f66 2060  uments form of `
+00016020: 6069 6e64 6578 6572 7360 602e 0a20 2020  `indexers``..   
+00016030: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
+00016040: 696e 6465 7865 7273 206f 7220 696e 6465  indexers or inde
+00016050: 7865 7273 5f6b 7761 7267 7320 6d75 7374  xers_kwargs must
+00016060: 2062 6520 7072 6f76 6964 6564 2e0a 0a20   be provided... 
+00016070: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00016080: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+00016090: 2020 2020 2020 206f 626a 203a 2044 6174         obj : Dat
+000160a0: 6173 6574 0a20 2020 2020 2020 2020 2020  aset.           
+000160b0: 2041 206e 6577 2044 6174 6173 6574 2077   A new Dataset w
+000160c0: 6974 6820 7468 6520 7361 6d65 2063 6f6e  ith the same con
+000160d0: 7465 6e74 7320 6173 2074 6869 7320 6461  tents as this da
+000160e0: 7461 7365 742c 2065 7863 6570 7420 6561  taset, except ea
+000160f0: 6368 0a20 2020 2020 2020 2020 2020 2061  ch.            a
+00016100: 7272 6179 2061 6e64 2064 696d 656e 7369  rray and dimensi
+00016110: 6f6e 2069 7320 696e 6465 7865 6420 6279  on is indexed by
+00016120: 2074 6865 2061 7070 726f 7072 6961 7465   the appropriate
+00016130: 2069 6e64 6578 6572 732e 0a20 2020 2020   indexers..     
+00016140: 2020 2020 2020 2049 6620 696e 6465 7865         If indexe
+00016150: 7220 4461 7461 4172 7261 7973 2068 6176  r DataArrays hav
+00016160: 6520 636f 6f72 6469 6e61 7465 7320 7468  e coordinates th
+00016170: 6174 2064 6f20 6e6f 7420 636f 6e66 6c69  at do not confli
+00016180: 6374 2077 6974 680a 2020 2020 2020 2020  ct with.        
+00016190: 2020 2020 7468 6973 206f 626a 6563 742c      this object,
+000161a0: 2074 6865 6e20 7468 6573 6520 636f 6f72   then these coor
+000161b0: 6469 6e61 7465 7320 7769 6c6c 2062 6520  dinates will be 
+000161c0: 6174 7461 6368 6564 2e0a 2020 2020 2020  attached..      
+000161d0: 2020 2020 2020 496e 2067 656e 6572 616c        In general
+000161e0: 2c20 6561 6368 2061 7272 6179 2773 2064  , each array's d
+000161f0: 6174 6120 7769 6c6c 2062 6520 6120 7669  ata will be a vi
+00016200: 6577 206f 6620 7468 6520 6172 7261 7927  ew of the array'
+00016210: 7320 6461 7461 0a20 2020 2020 2020 2020  s data.         
+00016220: 2020 2069 6e20 7468 6973 2064 6174 6173     in this datas
+00016230: 6574 2c20 756e 6c65 7373 2076 6563 746f  et, unless vecto
+00016240: 7269 7a65 6420 696e 6465 7869 6e67 2077  rized indexing w
+00016250: 6173 2074 7269 6767 6572 6564 2062 7920  as triggered by 
+00016260: 7573 696e 670a 2020 2020 2020 2020 2020  using.          
+00016270: 2020 616e 2061 7272 6179 2069 6e64 6578    an array index
+00016280: 6572 2c20 696e 2077 6869 6368 2063 6173  er, in which cas
+00016290: 6520 7468 6520 6461 7461 2077 696c 6c20  e the data will 
+000162a0: 6265 2061 2063 6f70 792e 0a0a 2020 2020  be a copy...    
+000162b0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+000162c0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+000162d0: 2020 2020 2020 4461 7461 7365 742e 7365        Dataset.se
+000162e0: 6c0a 2020 2020 2020 2020 4461 7461 4172  l.        DataAr
+000162f0: 7261 792e 6973 656c 0a20 2020 2020 2020  ray.isel.       
+00016300: 2022 2222 0a20 2020 2020 2020 2069 6e64   """.        ind
+00016310: 6578 6572 7320 3d20 6569 7468 6572 5f64  exers = either_d
+00016320: 6963 745f 6f72 5f6b 7761 7267 7328 696e  ict_or_kwargs(in
+00016330: 6465 7865 7273 2c20 696e 6465 7865 7273  dexers, indexers
+00016340: 5f6b 7761 7267 732c 2022 6973 656c 2229  _kwargs, "isel")
+00016350: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+00016360: 6973 5f66 616e 6379 5f69 6e64 6578 6572  is_fancy_indexer
+00016370: 2869 6478 2920 666f 7220 6964 7820 696e  (idx) for idx in
+00016380: 2069 6e64 6578 6572 732e 7661 6c75 6573   indexers.values
+00016390: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+000163a0: 2072 6574 7572 6e20 7365 6c66 2e5f 6973   return self._is
+000163b0: 656c 5f66 616e 6379 2869 6e64 6578 6572  el_fancy(indexer
+000163c0: 732c 2064 726f 703d 6472 6f70 2c20 6d69  s, drop=drop, mi
+000163d0: 7373 696e 675f 6469 6d73 3d6d 6973 7369  ssing_dims=missi
+000163e0: 6e67 5f64 696d 7329 0a0a 2020 2020 2020  ng_dims)..      
+000163f0: 2020 2320 4d75 6368 2066 6173 7465 7220    # Much faster 
+00016400: 616c 676f 7269 7468 6d20 666f 7220 7768  algorithm for wh
+00016410: 656e 2061 6c6c 2069 6e64 6578 6572 7320  en all indexers 
+00016420: 6172 6520 696e 7473 2c20 736c 6963 6573  are ints, slices
+00016430: 2c20 6f6e 652d 6469 6d65 6e73 696f 6e61  , one-dimensiona
+00016440: 6c0a 2020 2020 2020 2020 2320 6c69 7374  l.        # list
+00016450: 732c 206f 7220 7a65 726f 206f 7220 6f6e  s, or zero or on
+00016460: 652d 6469 6d65 6e73 696f 6e61 6c20 6e70  e-dimensional np
+00016470: 2e6e 6461 7272 6179 2773 0a20 2020 2020  .ndarray's.     
+00016480: 2020 2069 6e64 6578 6572 7320 3d20 6472     indexers = dr
+00016490: 6f70 5f64 696d 735f 6672 6f6d 5f69 6e64  op_dims_from_ind
+000164a0: 6578 6572 7328 696e 6465 7865 7273 2c20  exers(indexers, 
+000164b0: 7365 6c66 2e64 696d 732c 206d 6973 7369  self.dims, missi
+000164c0: 6e67 5f64 696d 7329 0a0a 2020 2020 2020  ng_dims)..      
+000164d0: 2020 7661 7269 6162 6c65 7320 3d20 7b7d    variables = {}
+000164e0: 0a20 2020 2020 2020 2064 696d 733a 2064  .        dims: d
+000164f0: 6963 745b 4861 7368 6162 6c65 2c20 696e  ict[Hashable, in
+00016500: 745d 203d 207b 7d0a 2020 2020 2020 2020  t] = {}.        
+00016510: 636f 6f72 645f 6e61 6d65 7320 3d20 7365  coord_names = se
+00016520: 6c66 2e5f 636f 6f72 645f 6e61 6d65 732e  lf._coord_names.
+00016530: 636f 7079 2829 0a0a 2020 2020 2020 2020  copy()..        
+00016540: 696e 6465 7865 732c 2069 6e64 6578 5f76  indexes, index_v
+00016550: 6172 6961 626c 6573 203d 2069 7365 6c5f  ariables = isel_
+00016560: 696e 6465 7865 7328 7365 6c66 2e78 696e  indexes(self.xin
+00016570: 6465 7865 732c 2069 6e64 6578 6572 7329  dexes, indexers)
+00016580: 0a0a 2020 2020 2020 2020 666f 7220 6e61  ..        for na
+00016590: 6d65 2c20 7661 7220 696e 2073 656c 662e  me, var in self.
+000165a0: 5f76 6172 6961 626c 6573 2e69 7465 6d73  _variables.items
+000165b0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+000165c0: 2320 7072 6573 6572 7665 2076 6172 6961  # preserve varia
+000165d0: 626c 6520 6f72 6465 720a 2020 2020 2020  ble order.      
+000165e0: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
+000165f0: 2069 6e64 6578 5f76 6172 6961 626c 6573   index_variables
+00016600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016610: 2020 7661 7220 3d20 696e 6465 785f 7661    var = index_va
+00016620: 7269 6162 6c65 735b 6e61 6d65 5d0a 2020  riables[name].  
+00016630: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016650: 7661 725f 696e 6465 7865 7273 203d 207b  var_indexers = {
+00016660: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+00016670: 2069 6e64 6578 6572 732e 6974 656d 7328   indexers.items(
+00016680: 2920 6966 206b 2069 6e20 7661 722e 6469  ) if k in var.di
+00016690: 6d73 7d0a 2020 2020 2020 2020 2020 2020  ms}.            
+000166a0: 2020 2020 6966 2076 6172 5f69 6e64 6578      if var_index
+000166b0: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+000166c0: 2020 2020 2020 2020 2076 6172 203d 2076           var = v
+000166d0: 6172 2e69 7365 6c28 7661 725f 696e 6465  ar.isel(var_inde
+000166e0: 7865 7273 290a 2020 2020 2020 2020 2020  xers).          
+000166f0: 2020 2020 2020 2020 2020 6966 2064 726f            if dro
+00016700: 7020 616e 6420 7661 722e 6e64 696d 203d  p and var.ndim =
+00016710: 3d20 3020 616e 6420 6e61 6d65 2069 6e20  = 0 and name in 
+00016720: 636f 6f72 645f 6e61 6d65 733a 0a20 2020  coord_names:.   
+00016730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016740: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
+00016750: 2e72 656d 6f76 6528 6e61 6d65 290a 2020  .remove(name).  
+00016760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016770: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00016780: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+00016790: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
+000167a0: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+000167b0: 732e 7570 6461 7465 287a 6970 2876 6172  s.update(zip(var
+000167c0: 2e64 696d 732c 2076 6172 2e73 6861 7065  .dims, var.shape
+000167d0: 2929 0a0a 2020 2020 2020 2020 7265 7475  ))..        retu
+000167e0: 726e 2073 656c 662e 5f63 6f6e 7374 7275  rn self._constru
+000167f0: 6374 5f64 6972 6563 7428 0a20 2020 2020  ct_direct(.     
+00016800: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00016810: 3d76 6172 6961 626c 6573 2c0a 2020 2020  =variables,.    
+00016820: 2020 2020 2020 2020 636f 6f72 645f 6e61          coord_na
+00016830: 6d65 733d 636f 6f72 645f 6e61 6d65 732c  mes=coord_names,
+00016840: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00016850: 733d 6469 6d73 2c0a 2020 2020 2020 2020  s=dims,.        
+00016860: 2020 2020 6174 7472 733d 7365 6c66 2e5f      attrs=self._
+00016870: 6174 7472 732c 0a20 2020 2020 2020 2020  attrs,.         
+00016880: 2020 2069 6e64 6578 6573 3d69 6e64 6578     indexes=index
+00016890: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+000168a0: 656e 636f 6469 6e67 3d73 656c 662e 5f65  encoding=self._e
+000168b0: 6e63 6f64 696e 672c 0a20 2020 2020 2020  ncoding,.       
+000168c0: 2020 2020 2063 6c6f 7365 3d73 656c 662e       close=self.
+000168d0: 5f63 6c6f 7365 2c0a 2020 2020 2020 2020  _close,.        
+000168e0: 290a 0a20 2020 2064 6566 205f 6973 656c  )..    def _isel
+000168f0: 5f66 616e 6379 280a 2020 2020 2020 2020  _fancy(.        
+00016900: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+00016910: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
+00016920: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
+00016930: 416e 795d 2c0a 2020 2020 2020 2020 2a2c  Any],.        *,
+00016940: 0a20 2020 2020 2020 2064 726f 703a 2062  .        drop: b
+00016950: 6f6f 6c2c 0a20 2020 2020 2020 206d 6973  ool,.        mis
+00016960: 7369 6e67 5f64 696d 733a 2045 7272 6f72  sing_dims: Error
+00016970: 4f70 7469 6f6e 7357 6974 6857 6172 6e20  OptionsWithWarn 
+00016980: 3d20 2272 6169 7365 222c 0a20 2020 2029  = "raise",.    )
+00016990: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+000169a0: 2020 2020 2020 2076 616c 6964 5f69 6e64         valid_ind
+000169b0: 6578 6572 7320 3d20 6469 6374 2873 656c  exers = dict(sel
+000169c0: 662e 5f76 616c 6964 6174 655f 696e 6465  f._validate_inde
+000169d0: 7865 7273 2869 6e64 6578 6572 732c 206d  xers(indexers, m
+000169e0: 6973 7369 6e67 5f64 696d 7329 290a 0a20  issing_dims)).. 
+000169f0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00016a00: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
+00016a10: 2056 6172 6961 626c 655d 203d 207b 7d0a   Variable] = {}.
+00016a20: 2020 2020 2020 2020 696e 6465 7865 732c          indexes,
+00016a30: 2069 6e64 6578 5f76 6172 6961 626c 6573   index_variables
+00016a40: 203d 2069 7365 6c5f 696e 6465 7865 7328   = isel_indexes(
+00016a50: 7365 6c66 2e78 696e 6465 7865 732c 2076  self.xindexes, v
+00016a60: 616c 6964 5f69 6e64 6578 6572 7329 0a0a  alid_indexers)..
+00016a70: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
+00016a80: 2c20 7661 7220 696e 2073 656c 662e 7661  , var in self.va
+00016a90: 7269 6162 6c65 732e 6974 656d 7328 293a  riables.items():
+00016aa0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016ab0: 6e61 6d65 2069 6e20 696e 6465 785f 7661  name in index_va
+00016ac0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+00016ad0: 2020 2020 2020 2020 206e 6577 5f76 6172           new_var
+00016ae0: 203d 2069 6e64 6578 5f76 6172 6961 626c   = index_variabl
+00016af0: 6573 5b6e 616d 655d 0a20 2020 2020 2020  es[name].       
+00016b00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00016b10: 2020 2020 2020 2020 2020 2076 6172 5f69             var_i
+00016b20: 6e64 6578 6572 7320 3d20 7b0a 2020 2020  ndexers = {.    
+00016b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b40: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+00016b50: 2076 616c 6964 5f69 6e64 6578 6572 732e   valid_indexers.
+00016b60: 6974 656d 7328 2920 6966 206b 2069 6e20  items() if k in 
+00016b70: 7661 722e 6469 6d73 0a20 2020 2020 2020  var.dims.       
+00016b80: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00016b90: 2020 2020 2020 2020 2020 2069 6620 7661             if va
+00016ba0: 725f 696e 6465 7865 7273 3a0a 2020 2020  r_indexers:.    
+00016bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bc0: 6e65 775f 7661 7220 3d20 7661 722e 6973  new_var = var.is
+00016bd0: 656c 2869 6e64 6578 6572 733d 7661 725f  el(indexers=var_
+00016be0: 696e 6465 7865 7273 290a 2020 2020 2020  indexers).      
+00016bf0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00016c00: 6472 6f70 2073 6361 6c61 7220 636f 6f72  drop scalar coor
+00016c10: 6469 6e61 7465 730a 2020 2020 2020 2020  dinates.        
+00016c20: 2020 2020 2020 2020 2020 2020 2320 6874              # ht
+00016c30: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00016c40: 2f70 7964 6174 612f 7861 7272 6179 2f69  /pydata/xarray/i
+00016c50: 7373 7565 732f 3635 3534 0a20 2020 2020  ssues/6554.     
+00016c60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016c70: 6620 6e61 6d65 2069 6e20 7365 6c66 2e63  f name in self.c
+00016c80: 6f6f 7264 7320 616e 6420 6472 6f70 2061  oords and drop a
+00016c90: 6e64 206e 6577 5f76 6172 2e6e 6469 6d20  nd new_var.ndim 
+00016ca0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00016cb0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00016cc0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00016cd0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00016ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cf0: 206e 6577 5f76 6172 203d 2076 6172 2e63   new_var = var.c
+00016d00: 6f70 7928 6465 6570 3d46 616c 7365 290a  opy(deep=False).
+00016d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d20: 6966 206e 616d 6520 6e6f 7420 696e 2069  if name not in i
+00016d30: 6e64 6578 6573 3a0a 2020 2020 2020 2020  ndexes:.        
+00016d40: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00016d50: 7661 7220 3d20 6e65 775f 7661 722e 746f  var = new_var.to
+00016d60: 5f62 6173 655f 7661 7269 6162 6c65 2829  _base_variable()
+00016d70: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
+00016d80: 6961 626c 6573 5b6e 616d 655d 203d 206e  iables[name] = n
+00016d90: 6577 5f76 6172 0a0a 2020 2020 2020 2020  ew_var..        
+00016da0: 636f 6f72 645f 6e61 6d65 7320 3d20 7365  coord_names = se
+00016db0: 6c66 2e5f 636f 6f72 645f 6e61 6d65 7320  lf._coord_names 
+00016dc0: 2620 7661 7269 6162 6c65 732e 6b65 7973  & variables.keys
+00016dd0: 2829 0a20 2020 2020 2020 2073 656c 6563  ().        selec
+00016de0: 7465 6420 3d20 7365 6c66 2e5f 7265 706c  ted = self._repl
+00016df0: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
+00016e00: 7328 7661 7269 6162 6c65 732c 2063 6f6f  s(variables, coo
+00016e10: 7264 5f6e 616d 6573 2c20 696e 6465 7865  rd_names, indexe
+00016e20: 7329 0a0a 2020 2020 2020 2020 2320 4578  s)..        # Ex
+00016e30: 7472 6163 7420 636f 6f72 6469 6e61 7465  tract coordinate
+00016e40: 7320 6672 6f6d 2069 6e64 6578 6572 730a  s from indexers.
+00016e50: 2020 2020 2020 2020 636f 6f72 645f 7661          coord_va
+00016e60: 7273 2c20 6e65 775f 696e 6465 7865 7320  rs, new_indexes 
+00016e70: 3d20 7365 6c65 6374 6564 2e5f 6765 745f  = selected._get_
+00016e80: 696e 6465 7865 7273 5f63 6f6f 7264 735f  indexers_coords_
+00016e90: 616e 645f 696e 6465 7865 7328 696e 6465  and_indexes(inde
+00016ea0: 7865 7273 290a 2020 2020 2020 2020 7661  xers).        va
+00016eb0: 7269 6162 6c65 732e 7570 6461 7465 2863  riables.update(c
+00016ec0: 6f6f 7264 5f76 6172 7329 0a20 2020 2020  oord_vars).     
+00016ed0: 2020 2069 6e64 6578 6573 2e75 7064 6174     indexes.updat
+00016ee0: 6528 6e65 775f 696e 6465 7865 7329 0a20  e(new_indexes). 
+00016ef0: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
+00016f00: 6573 203d 2073 656c 662e 5f63 6f6f 7264  es = self._coord
+00016f10: 5f6e 616d 6573 2026 2076 6172 6961 626c  _names & variabl
+00016f20: 6573 2e6b 6579 7328 2920 7c20 636f 6f72  es.keys() | coor
+00016f30: 645f 7661 7273 2e6b 6579 7328 290a 2020  d_vars.keys().  
+00016f40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00016f50: 662e 5f72 6570 6c61 6365 5f77 6974 685f  f._replace_with_
+00016f60: 6e65 775f 6469 6d73 2876 6172 6961 626c  new_dims(variabl
+00016f70: 6573 2c20 636f 6f72 645f 6e61 6d65 732c  es, coord_names,
+00016f80: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+00016f90: 290a 0a20 2020 2064 6566 2073 656c 280a  )..    def sel(.
+00016fa0: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
+00016fb0: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
+00016fc0: 2069 6e64 6578 6572 733a 204d 6170 7069   indexers: Mappi
+00016fd0: 6e67 5b41 6e79 2c20 416e 795d 207c 204e  ng[Any, Any] | N
+00016fe0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00016ff0: 2020 2020 6d65 7468 6f64 3a20 7374 7220      method: str 
+00017000: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00017010: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
+00017020: 3a20 696e 7420 7c20 666c 6f61 7420 7c20  : int | float | 
+00017030: 4974 6572 6162 6c65 5b69 6e74 207c 2066  Iterable[int | f
+00017040: 6c6f 6174 5d20 7c20 4e6f 6e65 203d 204e  loat] | None = N
+00017050: 6f6e 652c 0a20 2020 2020 2020 2064 726f  one,.        dro
+00017060: 703a 2062 6f6f 6c20 3d20 4661 6c73 652c  p: bool = False,
+00017070: 0a20 2020 2020 2020 202a 2a69 6e64 6578  .        **index
+00017080: 6572 735f 6b77 6172 6773 3a20 416e 792c  ers_kwargs: Any,
+00017090: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
+000170a0: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
+000170b0: 5265 7475 726e 7320 6120 6e65 7720 6461  Returns a new da
+000170c0: 7461 7365 7420 7769 7468 2065 6163 6820  taset with each 
+000170d0: 6172 7261 7920 696e 6465 7865 6420 6279  array indexed by
+000170e0: 2074 6963 6b20 6c61 6265 6c73 0a20 2020   tick labels.   
+000170f0: 2020 2020 2061 6c6f 6e67 2074 6865 2073       along the s
+00017100: 7065 6369 6669 6564 2064 696d 656e 7369  pecified dimensi
+00017110: 6f6e 2873 292e 0a0a 2020 2020 2020 2020  on(s)...        
+00017120: 496e 2063 6f6e 7472 6173 7420 746f 2060  In contrast to `
+00017130: 4461 7461 7365 742e 6973 656c 602c 2069  Dataset.isel`, i
+00017140: 6e64 6578 6572 7320 666f 7220 7468 6973  ndexers for this
+00017150: 206d 6574 686f 6420 7368 6f75 6c64 2075   method should u
+00017160: 7365 0a20 2020 2020 2020 206c 6162 656c  se.        label
+00017170: 7320 696e 7374 6561 6420 6f66 2069 6e74  s instead of int
+00017180: 6567 6572 732e 0a0a 2020 2020 2020 2020  egers...        
+00017190: 556e 6465 7220 7468 6520 686f 6f64 2c20  Under the hood, 
+000171a0: 7468 6973 206d 6574 686f 6420 6973 2070  this method is p
+000171b0: 6f77 6572 6564 2062 7920 7573 696e 6720  owered by using 
+000171c0: 7061 6e64 6173 2773 2070 6f77 6572 6675  pandas's powerfu
+000171d0: 6c20 496e 6465 780a 2020 2020 2020 2020  l Index.        
+000171e0: 6f62 6a65 6374 732e 2054 6869 7320 6d61  objects. This ma
+000171f0: 6b65 7320 6c61 6265 6c20 6261 7365 6420  kes label based 
+00017200: 696e 6465 7869 6e67 2065 7373 656e 7469  indexing essenti
+00017210: 616c 6c79 206a 7573 7420 6173 2066 6173  ally just as fas
+00017220: 7420 6173 0a20 2020 2020 2020 2075 7369  t as.        usi
+00017230: 6e67 2069 6e74 6567 6572 2069 6e64 6578  ng integer index
+00017240: 696e 672e 0a0a 2020 2020 2020 2020 4974  ing...        It
+00017250: 2061 6c73 6f20 6d65 616e 7320 7468 6973   also means this
+00017260: 206d 6574 686f 6420 7573 6573 2070 616e   method uses pan
+00017270: 6461 7327 7320 2877 656c 6c20 646f 6375  das's (well docu
+00017280: 6d65 6e74 6564 2920 6c6f 6769 6320 666f  mented) logic fo
+00017290: 720a 2020 2020 2020 2020 696e 6465 7869  r.        indexi
+000172a0: 6e67 2e20 5468 6973 206d 6561 6e73 2079  ng. This means y
+000172b0: 6f75 2063 616e 2075 7365 2073 7472 696e  ou can use strin
+000172c0: 6720 7368 6f72 7463 7574 7320 666f 7220  g shortcuts for 
+000172d0: 6461 7465 7469 6d65 2069 6e64 6578 6573  datetime indexes
+000172e0: 0a20 2020 2020 2020 2028 652e 672e 2c20  .        (e.g., 
+000172f0: 2732 3030 302d 3031 2720 746f 2073 656c  '2000-01' to sel
+00017300: 6563 7420 616c 6c20 7661 6c75 6573 2069  ect all values i
+00017310: 6e20 4a61 6e75 6172 7920 3230 3030 292e  n January 2000).
+00017320: 2049 7420 616c 736f 206d 6561 6e73 0a20   It also means. 
+00017330: 2020 2020 2020 2074 6861 7420 736c 6963         that slic
+00017340: 6573 2061 7265 2074 7265 6174 6564 2061  es are treated a
+00017350: 7320 696e 636c 7573 6976 6520 6f66 2062  s inclusive of b
+00017360: 6f74 6820 7468 6520 7374 6172 7420 616e  oth the start an
+00017370: 6420 7374 6f70 2076 616c 7565 732c 0a20  d stop values,. 
+00017380: 2020 2020 2020 2075 6e6c 696b 6520 6e6f         unlike no
+00017390: 726d 616c 2050 7974 686f 6e20 696e 6465  rmal Python inde
+000173a0: 7869 6e67 2e0a 0a20 2020 2020 2020 2050  xing...        P
+000173b0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+000173c0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+000173d0: 2020 2020 2069 6e64 6578 6572 7320 3a20       indexers : 
+000173e0: 6469 6374 2c20 6f70 7469 6f6e 616c 0a20  dict, optional. 
+000173f0: 2020 2020 2020 2020 2020 2041 2064 6963             A dic
+00017400: 7420 7769 7468 206b 6579 7320 6d61 7463  t with keys matc
+00017410: 6869 6e67 2064 696d 656e 7369 6f6e 7320  hing dimensions 
+00017420: 616e 6420 7661 6c75 6573 2067 6976 656e  and values given
+00017430: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
+00017440: 7363 616c 6172 732c 2073 6c69 6365 7320  scalars, slices 
+00017450: 6f72 2061 7272 6179 7320 6f66 2074 6963  or arrays of tic
+00017460: 6b20 6c61 6265 6c73 2e20 466f 7220 6469  k labels. For di
+00017470: 6d65 6e73 696f 6e73 2077 6974 680a 2020  mensions with.  
+00017480: 2020 2020 2020 2020 2020 6d75 6c74 692d            multi-
+00017490: 696e 6465 782c 2074 6865 2069 6e64 6578  index, the index
+000174a0: 6572 206d 6179 2061 6c73 6f20 6265 2061  er may also be a
+000174b0: 2064 6963 742d 6c69 6b65 206f 626a 6563   dict-like objec
+000174c0: 7420 7769 7468 206b 6579 730a 2020 2020  t with keys.    
+000174d0: 2020 2020 2020 2020 6d61 7463 6869 6e67          matching
+000174e0: 2069 6e64 6578 206c 6576 656c 206e 616d   index level nam
+000174f0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+00017500: 4966 2044 6174 6141 7272 6179 7320 6172  If DataArrays ar
+00017510: 6520 7061 7373 6564 2061 7320 696e 6465  e passed as inde
+00017520: 7865 7273 2c20 7861 7272 6179 2d73 7479  xers, xarray-sty
+00017530: 6c65 2069 6e64 6578 696e 6720 7769 6c6c  le indexing will
+00017540: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
+00017550: 6361 7272 6965 6420 6f75 742e 2053 6565  carried out. See
+00017560: 203a 7265 663a 6069 6e64 6578 696e 6760   :ref:`indexing`
+00017570: 2066 6f72 2074 6865 2064 6574 6169 6c73   for the details
+00017580: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
+00017590: 6520 6f66 2069 6e64 6578 6572 7320 6f72  e of indexers or
+000175a0: 2069 6e64 6578 6572 735f 6b77 6172 6773   indexers_kwargs
+000175b0: 206d 7573 7420 6265 2070 726f 7669 6465   must be provide
+000175c0: 642e 0a20 2020 2020 2020 206d 6574 686f  d..        metho
+000175d0: 6420 3a20 7b4e 6f6e 652c 2022 6e65 6172  d : {None, "near
+000175e0: 6573 7422 2c20 2270 6164 222c 2022 6666  est", "pad", "ff
+000175f0: 696c 6c22 2c20 2262 6163 6b66 696c 6c22  ill", "backfill"
+00017600: 2c20 2262 6669 6c6c 227d 2c20 6f70 7469  , "bfill"}, opti
+00017610: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00017620: 204d 6574 686f 6420 746f 2075 7365 2066   Method to use f
+00017630: 6f72 2069 6e65 7861 6374 206d 6174 6368  or inexact match
+00017640: 6573 3a0a 0a20 2020 2020 2020 2020 2020  es:..           
+00017650: 202a 204e 6f6e 6520 2864 6566 6175 6c74   * None (default
+00017660: 293a 206f 6e6c 7920 6578 6163 7420 6d61  ): only exact ma
+00017670: 7463 6865 730a 2020 2020 2020 2020 2020  tches.          
+00017680: 2020 2a20 7061 6420 2f20 6666 696c 6c3a    * pad / ffill:
+00017690: 2070 726f 7061 6761 7465 206c 6173 7420   propagate last 
+000176a0: 7661 6c69 6420 696e 6465 7820 7661 6c75  valid index valu
+000176b0: 6520 666f 7277 6172 640a 2020 2020 2020  e forward.      
+000176c0: 2020 2020 2020 2a20 6261 636b 6669 6c6c        * backfill
+000176d0: 202f 2062 6669 6c6c 3a20 7072 6f70 6167   / bfill: propag
+000176e0: 6174 6520 6e65 7874 2076 616c 6964 2069  ate next valid i
+000176f0: 6e64 6578 2076 616c 7565 2062 6163 6b77  ndex value backw
+00017700: 6172 640a 2020 2020 2020 2020 2020 2020  ard.            
+00017710: 2a20 6e65 6172 6573 743a 2075 7365 206e  * nearest: use n
+00017720: 6561 7265 7374 2076 616c 6964 2069 6e64  earest valid ind
+00017730: 6578 2076 616c 7565 0a20 2020 2020 2020  ex value.       
+00017740: 2074 6f6c 6572 616e 6365 203a 206f 7074   tolerance : opt
+00017750: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+00017760: 2020 4d61 7869 6d75 6d20 6469 7374 616e    Maximum distan
+00017770: 6365 2062 6574 7765 656e 206f 7269 6769  ce between origi
+00017780: 6e61 6c20 616e 6420 6e65 7720 6c61 6265  nal and new labe
+00017790: 6c73 2066 6f72 2069 6e65 7861 6374 0a20  ls for inexact. 
+000177a0: 2020 2020 2020 2020 2020 206d 6174 6368             match
+000177b0: 6573 2e20 5468 6520 7661 6c75 6573 206f  es. The values o
+000177c0: 6620 7468 6520 696e 6465 7820 6174 2074  f the index at t
+000177d0: 6865 206d 6174 6368 696e 6720 6c6f 6361  he matching loca
+000177e0: 7469 6f6e 7320 6d75 7374 0a20 2020 2020  tions must.     
+000177f0: 2020 2020 2020 2073 6174 6973 6679 2074         satisfy t
+00017800: 6865 2065 7175 6174 696f 6e20 6060 6162  he equation ``ab
+00017810: 7328 696e 6465 785b 696e 6465 7865 725d  s(index[indexer]
+00017820: 202d 2074 6172 6765 7429 203c 3d20 746f   - target) <= to
+00017830: 6c65 7261 6e63 6560 602e 0a20 2020 2020  lerance``..     
+00017840: 2020 2064 726f 7020 3a20 626f 6f6c 2c20     drop : bool, 
+00017850: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00017860: 2020 2020 2049 6620 6060 6472 6f70 3d54       If ``drop=T
+00017870: 7275 6560 602c 2064 726f 7020 636f 6f72  rue``, drop coor
+00017880: 6469 6e61 7465 7320 7661 7269 6162 6c65  dinates variable
+00017890: 7320 696e 2060 696e 6465 7865 7273 6020  s in `indexers` 
+000178a0: 696e 7374 6561 640a 2020 2020 2020 2020  instead.        
+000178b0: 2020 2020 6f66 206d 616b 696e 6720 7468      of making th
+000178c0: 656d 2073 6361 6c61 722e 0a20 2020 2020  em scalar..     
+000178d0: 2020 202a 2a69 6e64 6578 6572 735f 6b77     **indexers_kw
+000178e0: 6172 6773 203a 207b 6469 6d3a 2069 6e64  args : {dim: ind
+000178f0: 6578 6572 2c20 2e2e 2e7d 2c20 6f70 7469  exer, ...}, opti
+00017900: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00017910: 2054 6865 206b 6579 776f 7264 2061 7267   The keyword arg
+00017920: 756d 656e 7473 2066 6f72 6d20 6f66 2060  uments form of `
+00017930: 6069 6e64 6578 6572 7360 602e 0a20 2020  `indexers``..   
+00017940: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
+00017950: 696e 6465 7865 7273 206f 7220 696e 6465  indexers or inde
+00017960: 7865 7273 5f6b 7761 7267 7320 6d75 7374  xers_kwargs must
+00017970: 2062 6520 7072 6f76 6964 6564 2e0a 0a20   be provided... 
+00017980: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00017990: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+000179a0: 2020 2020 2020 206f 626a 203a 2044 6174         obj : Dat
+000179b0: 6173 6574 0a20 2020 2020 2020 2020 2020  aset.           
+000179c0: 2041 206e 6577 2044 6174 6173 6574 2077   A new Dataset w
+000179d0: 6974 6820 7468 6520 7361 6d65 2063 6f6e  ith the same con
+000179e0: 7465 6e74 7320 6173 2074 6869 7320 6461  tents as this da
+000179f0: 7461 7365 742c 2065 7863 6570 7420 6561  taset, except ea
+00017a00: 6368 0a20 2020 2020 2020 2020 2020 2076  ch.            v
+00017a10: 6172 6961 626c 6520 616e 6420 6469 6d65  ariable and dime
+00017a20: 6e73 696f 6e20 6973 2069 6e64 6578 6564  nsion is indexed
+00017a30: 2062 7920 7468 6520 6170 7072 6f70 7269   by the appropri
+00017a40: 6174 6520 696e 6465 7865 7273 2e0a 2020  ate indexers..  
+00017a50: 2020 2020 2020 2020 2020 4966 2069 6e64            If ind
+00017a60: 6578 6572 2044 6174 6141 7272 6179 7320  exer DataArrays 
+00017a70: 6861 7665 2063 6f6f 7264 696e 6174 6573  have coordinates
+00017a80: 2074 6861 7420 646f 206e 6f74 2063 6f6e   that do not con
+00017a90: 666c 6963 7420 7769 7468 0a20 2020 2020  flict with.     
+00017aa0: 2020 2020 2020 2074 6869 7320 6f62 6a65         this obje
+00017ab0: 6374 2c20 7468 656e 2074 6865 7365 2063  ct, then these c
+00017ac0: 6f6f 7264 696e 6174 6573 2077 696c 6c20  oordinates will 
+00017ad0: 6265 2061 7474 6163 6865 642e 0a20 2020  be attached..   
+00017ae0: 2020 2020 2020 2020 2049 6e20 6765 6e65           In gene
+00017af0: 7261 6c2c 2065 6163 6820 6172 7261 7927  ral, each array'
+00017b00: 7320 6461 7461 2077 696c 6c20 6265 2061  s data will be a
+00017b10: 2076 6965 7720 6f66 2074 6865 2061 7272   view of the arr
+00017b20: 6179 2773 2064 6174 610a 2020 2020 2020  ay's data.      
+00017b30: 2020 2020 2020 696e 2074 6869 7320 6461        in this da
+00017b40: 7461 7365 742c 2075 6e6c 6573 7320 7665  taset, unless ve
+00017b50: 6374 6f72 697a 6564 2069 6e64 6578 696e  ctorized indexin
+00017b60: 6720 7761 7320 7472 6967 6765 7265 6420  g was triggered 
+00017b70: 6279 2075 7369 6e67 0a20 2020 2020 2020  by using.       
+00017b80: 2020 2020 2061 6e20 6172 7261 7920 696e       an array in
+00017b90: 6465 7865 722c 2069 6e20 7768 6963 6820  dexer, in which 
+00017ba0: 6361 7365 2074 6865 2064 6174 6120 7769  case the data wi
+00017bb0: 6c6c 2062 6520 6120 636f 7079 2e0a 0a20  ll be a copy... 
+00017bc0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+00017bd0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00017be0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+00017bf0: 2e69 7365 6c0a 2020 2020 2020 2020 4461  .isel.        Da
+00017c00: 7461 4172 7261 792e 7365 6c0a 2020 2020  taArray.sel.    
+00017c10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00017c20: 696e 6465 7865 7273 203d 2065 6974 6865  indexers = eithe
+00017c30: 725f 6469 6374 5f6f 725f 6b77 6172 6773  r_dict_or_kwargs
+00017c40: 2869 6e64 6578 6572 732c 2069 6e64 6578  (indexers, index
+00017c50: 6572 735f 6b77 6172 6773 2c20 2273 656c  ers_kwargs, "sel
+00017c60: 2229 0a20 2020 2020 2020 2071 7565 7279  ").        query
+00017c70: 5f72 6573 756c 7473 203d 206d 6170 5f69  _results = map_i
+00017c80: 6e64 6578 5f71 7565 7269 6573 280a 2020  ndex_queries(.  
+00017c90: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
+00017ca0: 696e 6465 7865 7273 3d69 6e64 6578 6572  indexers=indexer
+00017cb0: 732c 206d 6574 686f 643d 6d65 7468 6f64  s, method=method
+00017cc0: 2c20 746f 6c65 7261 6e63 653d 746f 6c65  , tolerance=tole
+00017cd0: 7261 6e63 650a 2020 2020 2020 2020 290a  rance.        ).
+00017ce0: 0a20 2020 2020 2020 2069 6620 6472 6f70  .        if drop
+00017cf0: 3a0a 2020 2020 2020 2020 2020 2020 6e6f  :.            no
+00017d00: 5f73 6361 6c61 725f 7661 7269 6162 6c65  _scalar_variable
+00017d10: 7320 3d20 7b7d 0a20 2020 2020 2020 2020  s = {}.         
+00017d20: 2020 2066 6f72 206b 2c20 7620 696e 2071     for k, v in q
+00017d30: 7565 7279 5f72 6573 756c 7473 2e76 6172  uery_results.var
+00017d40: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
+00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d60: 6966 2076 2e64 696d 733a 0a20 2020 2020  if v.dims:.     
+00017d70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00017d80: 6f5f 7363 616c 6172 5f76 6172 6961 626c  o_scalar_variabl
+00017d90: 6573 5b6b 5d20 3d20 760a 2020 2020 2020  es[k] = v.      
+00017da0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017dc0: 2020 2020 6966 206b 2069 6e20 7365 6c66      if k in self
+00017dd0: 2e5f 636f 6f72 645f 6e61 6d65 733a 0a20  ._coord_names:. 
+00017de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017df0: 2020 2020 2020 2071 7565 7279 5f72 6573         query_res
+00017e00: 756c 7473 2e64 726f 705f 636f 6f72 6473  ults.drop_coords
+00017e10: 2e61 7070 656e 6428 6b29 0a20 2020 2020  .append(k).     
+00017e20: 2020 2020 2020 2071 7565 7279 5f72 6573         query_res
+00017e30: 756c 7473 2e76 6172 6961 626c 6573 203d  ults.variables =
+00017e40: 206e 6f5f 7363 616c 6172 5f76 6172 6961   no_scalar_varia
+00017e50: 626c 6573 0a0a 2020 2020 2020 2020 7265  bles..        re
+00017e60: 7375 6c74 203d 2073 656c 662e 6973 656c  sult = self.isel
+00017e70: 2869 6e64 6578 6572 733d 7175 6572 795f  (indexers=query_
+00017e80: 7265 7375 6c74 732e 6469 6d5f 696e 6465  results.dim_inde
+00017e90: 7865 7273 2c20 6472 6f70 3d64 726f 7029  xers, drop=drop)
+00017ea0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00017eb0: 7265 7375 6c74 2e5f 6f76 6572 7772 6974  result._overwrit
+00017ec0: 655f 696e 6465 7865 7328 2a71 7565 7279  e_indexes(*query
+00017ed0: 5f72 6573 756c 7473 2e61 735f 7475 706c  _results.as_tupl
+00017ee0: 6528 295b 313a 5d29 0a0a 2020 2020 6465  e()[1:])..    de
+00017ef0: 6620 6865 6164 280a 2020 2020 2020 2020  f head(.        
+00017f00: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
+00017f10: 0a20 2020 2020 2020 2069 6e64 6578 6572  .        indexer
+00017f20: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
+00017f30: 696e 745d 207c 2069 6e74 207c 204e 6f6e  int] | int | Non
+00017f40: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00017f50: 2020 2a2a 696e 6465 7865 7273 5f6b 7761    **indexers_kwa
+00017f60: 7267 733a 2041 6e79 2c0a 2020 2020 2920  rgs: Any,.    ) 
+00017f70: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+00017f80: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00017f90: 2061 206e 6577 2064 6174 6173 6574 2077   a new dataset w
+00017fa0: 6974 6820 7468 6520 6669 7273 7420 606e  ith the first `n
+00017fb0: 6020 7661 6c75 6573 206f 6620 6561 6368  ` values of each
+00017fc0: 2061 7272 6179 0a20 2020 2020 2020 2066   array.        f
+00017fd0: 6f72 2074 6865 2073 7065 6369 6669 6564  or the specified
+00017fe0: 2064 696d 656e 7369 6f6e 2873 292e 0a0a   dimension(s)...
+00017ff0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00018000: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00018010: 2d2d 2d2d 2d0a 2020 2020 2020 2020 696e  -----.        in
+00018020: 6465 7865 7273 203a 2064 6963 7420 6f72  dexers : dict or
+00018030: 2069 6e74 2c20 6465 6661 756c 743a 2035   int, default: 5
+00018040: 0a20 2020 2020 2020 2020 2020 2041 2064  .            A d
+00018050: 6963 7420 7769 7468 206b 6579 7320 6d61  ict with keys ma
+00018060: 7463 6869 6e67 2064 696d 656e 7369 6f6e  tching dimension
+00018070: 7320 616e 6420 696e 7465 6765 7220 7661  s and integer va
+00018080: 6c75 6573 2060 6e60 0a20 2020 2020 2020  lues `n`.       
+00018090: 2020 2020 206f 7220 6120 7369 6e67 6c65       or a single
+000180a0: 2069 6e74 6567 6572 2060 6e60 2061 7070   integer `n` app
+000180b0: 6c69 6564 206f 7665 7220 616c 6c20 6469  lied over all di
+000180c0: 6d65 6e73 696f 6e73 2e0a 2020 2020 2020  mensions..      
+000180d0: 2020 2020 2020 4f6e 6520 6f66 2069 6e64        One of ind
+000180e0: 6578 6572 7320 6f72 2069 6e64 6578 6572  exers or indexer
+000180f0: 735f 6b77 6172 6773 206d 7573 7420 6265  s_kwargs must be
+00018100: 2070 726f 7669 6465 642e 0a20 2020 2020   provided..     
+00018110: 2020 202a 2a69 6e64 6578 6572 735f 6b77     **indexers_kw
+00018120: 6172 6773 203a 207b 6469 6d3a 206e 2c20  args : {dim: n, 
+00018130: 2e2e 2e7d 2c20 6f70 7469 6f6e 616c 0a20  ...}, optional. 
+00018140: 2020 2020 2020 2020 2020 2054 6865 206b             The k
+00018150: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00018160: 2066 6f72 6d20 6f66 2060 6069 6e64 6578   form of ``index
+00018170: 6572 7360 602e 0a20 2020 2020 2020 2020  ers``..         
+00018180: 2020 204f 6e65 206f 6620 696e 6465 7865     One of indexe
+00018190: 7273 206f 7220 696e 6465 7865 7273 5f6b  rs or indexers_k
+000181a0: 7761 7267 7320 6d75 7374 2062 6520 7072  wargs must be pr
+000181b0: 6f76 6964 6564 2e0a 0a20 2020 2020 2020  ovided...       
+000181c0: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+000181d0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+000181e0: 2020 2044 6174 6173 6574 2e74 6169 6c0a     Dataset.tail.
+000181f0: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
+00018200: 7468 696e 0a20 2020 2020 2020 2044 6174  thin.        Dat
+00018210: 6141 7272 6179 2e68 6561 640a 2020 2020  aArray.head.    
+00018220: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00018230: 6966 206e 6f74 2069 6e64 6578 6572 735f  if not indexers_
+00018240: 6b77 6172 6773 3a0a 2020 2020 2020 2020  kwargs:.        
+00018250: 2020 2020 6966 2069 6e64 6578 6572 7320      if indexers 
+00018260: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00018270: 2020 2020 2020 2020 2069 6e64 6578 6572           indexer
+00018280: 7320 3d20 350a 2020 2020 2020 2020 2020  s = 5.          
+00018290: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+000182a0: 6e63 6528 696e 6465 7865 7273 2c20 696e  nce(indexers, in
+000182b0: 7429 2061 6e64 206e 6f74 2069 735f 6469  t) and not is_di
+000182c0: 6374 5f6c 696b 6528 696e 6465 7865 7273  ct_like(indexers
+000182d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000182e0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+000182f0: 6f72 2822 696e 6465 7865 7273 206d 7573  or("indexers mus
+00018300: 7420 6265 2065 6974 6865 7220 6469 6374  t be either dict
+00018310: 2d6c 696b 6520 6f72 2061 2073 696e 676c  -like or a singl
+00018320: 6520 696e 7465 6765 7222 290a 2020 2020  e integer").    
+00018330: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00018340: 6528 696e 6465 7865 7273 2c20 696e 7429  e(indexers, int)
+00018350: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+00018360: 6465 7865 7273 203d 207b 6469 6d3a 2069  dexers = {dim: i
+00018370: 6e64 6578 6572 7320 666f 7220 6469 6d20  ndexers for dim 
+00018380: 696e 2073 656c 662e 6469 6d73 7d0a 2020  in self.dims}.  
+00018390: 2020 2020 2020 696e 6465 7865 7273 203d        indexers =
+000183a0: 2065 6974 6865 725f 6469 6374 5f6f 725f   either_dict_or_
+000183b0: 6b77 6172 6773 2869 6e64 6578 6572 732c  kwargs(indexers,
+000183c0: 2069 6e64 6578 6572 735f 6b77 6172 6773   indexers_kwargs
+000183d0: 2c20 2268 6561 6422 290a 2020 2020 2020  , "head").      
+000183e0: 2020 666f 7220 6b2c 2076 2069 6e20 696e    for k, v in in
+000183f0: 6465 7865 7273 2e69 7465 6d73 2829 3a0a  dexers.items():.
+00018400: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00018410: 6f74 2069 7369 6e73 7461 6e63 6528 762c  ot isinstance(v,
+00018420: 2069 6e74 293a 0a20 2020 2020 2020 2020   int):.         
+00018430: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00018440: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00018450: 2020 2020 2020 2020 2020 2020 2265 7870              "exp
+00018460: 6563 7465 6420 696e 7465 6765 7220 7479  ected integer ty
+00018470: 7065 2069 6e64 6578 6572 2066 6f72 2022  pe indexer for "
+00018480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018490: 2020 2020 2066 2264 696d 656e 7369 6f6e       f"dimension
+000184a0: 207b 6b21 727d 2c20 666f 756e 6420 7b74   {k!r}, found {t
+000184b0: 7970 6528 7629 2172 7d22 0a20 2020 2020  ype(v)!r}".     
+000184c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000184d0: 2020 2020 2020 2020 2065 6c69 6620 7620           elif v 
+000184e0: 3c20 303a 0a20 2020 2020 2020 2020 2020  < 0:.           
+000184f0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00018500: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00018510: 2020 2020 2020 2020 2020 2022 6578 7065             "expe
+00018520: 6374 6564 2070 6f73 6974 6976 6520 696e  cted positive in
+00018530: 7465 6765 7220 6173 2069 6e64 6578 6572  teger as indexer
+00018540: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00018550: 2020 2020 2020 2066 2266 6f72 2064 696d         f"for dim
+00018560: 656e 7369 6f6e 207b 6b21 727d 2c20 666f  ension {k!r}, fo
+00018570: 756e 6420 7b76 7d22 0a20 2020 2020 2020  und {v}".       
+00018580: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00018590: 2020 2069 6e64 6578 6572 735f 736c 6963     indexers_slic
+000185a0: 6573 203d 207b 6b3a 2073 6c69 6365 2876  es = {k: slice(v
+000185b0: 616c 2920 666f 7220 6b2c 2076 616c 2069  al) for k, val i
+000185c0: 6e20 696e 6465 7865 7273 2e69 7465 6d73  n indexers.items
+000185d0: 2829 7d0a 2020 2020 2020 2020 7265 7475  ()}.        retu
+000185e0: 726e 2073 656c 662e 6973 656c 2869 6e64  rn self.isel(ind
+000185f0: 6578 6572 735f 736c 6963 6573 290a 0a20  exers_slices).. 
+00018600: 2020 2064 6566 2074 6169 6c28 0a20 2020     def tail(.   
+00018610: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+00018620: 6173 6574 2c0a 2020 2020 2020 2020 696e  aset,.        in
+00018630: 6465 7865 7273 3a20 4d61 7070 696e 675b  dexers: Mapping[
+00018640: 416e 792c 2069 6e74 5d20 7c20 696e 7420  Any, int] | int 
+00018650: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00018660: 2020 2020 2020 202a 2a69 6e64 6578 6572         **indexer
+00018670: 735f 6b77 6172 6773 3a20 416e 792c 0a20  s_kwargs: Any,. 
+00018680: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
+00018690: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
+000186a0: 7475 726e 7320 6120 6e65 7720 6461 7461  turns a new data
+000186b0: 7365 7420 7769 7468 2074 6865 206c 6173  set with the las
+000186c0: 7420 606e 6020 7661 6c75 6573 206f 6620  t `n` values of 
+000186d0: 6561 6368 2061 7272 6179 0a20 2020 2020  each array.     
+000186e0: 2020 2066 6f72 2074 6865 2073 7065 6369     for the speci
+000186f0: 6669 6564 2064 696d 656e 7369 6f6e 2873  fied dimension(s
+00018700: 292e 0a0a 2020 2020 2020 2020 5061 7261  )...        Para
+00018710: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00018720: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00018730: 2020 696e 6465 7865 7273 203a 2064 6963    indexers : dic
+00018740: 7420 6f72 2069 6e74 2c20 6465 6661 756c  t or int, defaul
+00018750: 743a 2035 0a20 2020 2020 2020 2020 2020  t: 5.           
+00018760: 2041 2064 6963 7420 7769 7468 206b 6579   A dict with key
+00018770: 7320 6d61 7463 6869 6e67 2064 696d 656e  s matching dimen
+00018780: 7369 6f6e 7320 616e 6420 696e 7465 6765  sions and intege
+00018790: 7220 7661 6c75 6573 2060 6e60 0a20 2020  r values `n`.   
+000187a0: 2020 2020 2020 2020 206f 7220 6120 7369           or a si
+000187b0: 6e67 6c65 2069 6e74 6567 6572 2060 6e60  ngle integer `n`
+000187c0: 2061 7070 6c69 6564 206f 7665 7220 616c   applied over al
+000187d0: 6c20 6469 6d65 6e73 696f 6e73 2e0a 2020  l dimensions..  
+000187e0: 2020 2020 2020 2020 2020 4f6e 6520 6f66            One of
+000187f0: 2069 6e64 6578 6572 7320 6f72 2069 6e64   indexers or ind
+00018800: 6578 6572 735f 6b77 6172 6773 206d 7573  exers_kwargs mus
+00018810: 7420 6265 2070 726f 7669 6465 642e 0a20  t be provided.. 
+00018820: 2020 2020 2020 202a 2a69 6e64 6578 6572         **indexer
+00018830: 735f 6b77 6172 6773 203a 207b 6469 6d3a  s_kwargs : {dim:
+00018840: 206e 2c20 2e2e 2e7d 2c20 6f70 7469 6f6e   n, ...}, option
+00018850: 616c 0a20 2020 2020 2020 2020 2020 2054  al.            T
+00018860: 6865 206b 6579 776f 7264 2061 7267 756d  he keyword argum
+00018870: 656e 7473 2066 6f72 6d20 6f66 2060 6069  ents form of ``i
+00018880: 6e64 6578 6572 7360 602e 0a20 2020 2020  ndexers``..     
+00018890: 2020 2020 2020 204f 6e65 206f 6620 696e         One of in
+000188a0: 6465 7865 7273 206f 7220 696e 6465 7865  dexers or indexe
+000188b0: 7273 5f6b 7761 7267 7320 6d75 7374 2062  rs_kwargs must b
+000188c0: 6520 7072 6f76 6964 6564 2e0a 0a20 2020  e provided...   
+000188d0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+000188e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+000188f0: 2020 2020 2020 2044 6174 6173 6574 2e68         Dataset.h
+00018900: 6561 640a 2020 2020 2020 2020 4461 7461  ead.        Data
+00018910: 7365 742e 7468 696e 0a20 2020 2020 2020  set.thin.       
+00018920: 2044 6174 6141 7272 6179 2e74 6169 6c0a   DataArray.tail.
+00018930: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00018940: 2020 2020 6966 206e 6f74 2069 6e64 6578      if not index
+00018950: 6572 735f 6b77 6172 6773 3a0a 2020 2020  ers_kwargs:.    
+00018960: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
+00018970: 6572 7320 6973 204e 6f6e 653a 0a20 2020  ers is None:.   
+00018980: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+00018990: 6578 6572 7320 3d20 350a 2020 2020 2020  exers = 5.      
+000189a0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+000189b0: 6e73 7461 6e63 6528 696e 6465 7865 7273  nstance(indexers
+000189c0: 2c20 696e 7429 2061 6e64 206e 6f74 2069  , int) and not i
+000189d0: 735f 6469 6374 5f6c 696b 6528 696e 6465  s_dict_like(inde
+000189e0: 7865 7273 293a 0a20 2020 2020 2020 2020  xers):.         
+000189f0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00018a00: 6545 7272 6f72 2822 696e 6465 7865 7273  eError("indexers
+00018a10: 206d 7573 7420 6265 2065 6974 6865 7220   must be either 
+00018a20: 6469 6374 2d6c 696b 6520 6f72 2061 2073  dict-like or a s
+00018a30: 696e 676c 6520 696e 7465 6765 7222 290a  ingle integer").
+00018a40: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00018a50: 7461 6e63 6528 696e 6465 7865 7273 2c20  tance(indexers, 
+00018a60: 696e 7429 3a0a 2020 2020 2020 2020 2020  int):.          
+00018a70: 2020 696e 6465 7865 7273 203d 207b 6469    indexers = {di
+00018a80: 6d3a 2069 6e64 6578 6572 7320 666f 7220  m: indexers for 
+00018a90: 6469 6d20 696e 2073 656c 662e 6469 6d73  dim in self.dims
+00018aa0: 7d0a 2020 2020 2020 2020 696e 6465 7865  }.        indexe
+00018ab0: 7273 203d 2065 6974 6865 725f 6469 6374  rs = either_dict
+00018ac0: 5f6f 725f 6b77 6172 6773 2869 6e64 6578  _or_kwargs(index
+00018ad0: 6572 732c 2069 6e64 6578 6572 735f 6b77  ers, indexers_kw
+00018ae0: 6172 6773 2c20 2274 6169 6c22 290a 2020  args, "tail").  
+00018af0: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
+00018b00: 6e20 696e 6465 7865 7273 2e69 7465 6d73  n indexers.items
+00018b10: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00018b20: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00018b30: 6528 762c 2069 6e74 293a 0a20 2020 2020  e(v, int):.     
+00018b40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00018b50: 2054 7970 6545 7272 6f72 280a 2020 2020   TypeError(.    
+00018b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b70: 2265 7870 6563 7465 6420 696e 7465 6765  "expected intege
+00018b80: 7220 7479 7065 2069 6e64 6578 6572 2066  r type indexer f
+00018b90: 6f72 2022 0a20 2020 2020 2020 2020 2020  or ".           
+00018ba0: 2020 2020 2020 2020 2066 2264 696d 656e           f"dimen
+00018bb0: 7369 6f6e 207b 6b21 727d 2c20 666f 756e  sion {k!r}, foun
+00018bc0: 6420 7b74 7970 6528 7629 2172 7d22 0a20  d {type(v)!r}". 
+00018bd0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00018be0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00018bf0: 6620 7620 3c20 303a 0a20 2020 2020 2020  f v < 0:.       
+00018c00: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00018c10: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00018c20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00018c30: 6578 7065 6374 6564 2070 6f73 6974 6976  expected positiv
+00018c40: 6520 696e 7465 6765 7220 6173 2069 6e64  e integer as ind
+00018c50: 6578 6572 2022 0a20 2020 2020 2020 2020  exer ".         
+00018c60: 2020 2020 2020 2020 2020 2066 2266 6f72             f"for
+00018c70: 2064 696d 656e 7369 6f6e 207b 6b21 727d   dimension {k!r}
+00018c80: 2c20 666f 756e 6420 7b76 7d22 0a20 2020  , found {v}".   
+00018c90: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00018ca0: 2020 2020 2020 2069 6e64 6578 6572 735f         indexers_
+00018cb0: 736c 6963 6573 203d 207b 0a20 2020 2020  slices = {.     
+00018cc0: 2020 2020 2020 206b 3a20 736c 6963 6528         k: slice(
+00018cd0: 2d76 616c 2c20 4e6f 6e65 2920 6966 2076  -val, None) if v
+00018ce0: 616c 2021 3d20 3020 656c 7365 2073 6c69  al != 0 else sli
+00018cf0: 6365 2876 616c 290a 2020 2020 2020 2020  ce(val).        
+00018d00: 2020 2020 666f 7220 6b2c 2076 616c 2069      for k, val i
+00018d10: 6e20 696e 6465 7865 7273 2e69 7465 6d73  n indexers.items
+00018d20: 2829 0a20 2020 2020 2020 207d 0a20 2020  ().        }.   
+00018d30: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00018d40: 2e69 7365 6c28 696e 6465 7865 7273 5f73  .isel(indexers_s
+00018d50: 6c69 6365 7329 0a0a 2020 2020 6465 6620  lices)..    def 
+00018d60: 7468 696e 280a 2020 2020 2020 2020 7365  thin(.        se
+00018d70: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
+00018d80: 2020 2020 2020 2069 6e64 6578 6572 733a         indexers:
+00018d90: 204d 6170 7069 6e67 5b41 6e79 2c20 696e   Mapping[Any, in
+00018da0: 745d 207c 2069 6e74 207c 204e 6f6e 6520  t] | int | None 
+00018db0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00018dc0: 2a2a 696e 6465 7865 7273 5f6b 7761 7267  **indexers_kwarg
+00018dd0: 733a 2041 6e79 2c0a 2020 2020 2920 2d3e  s: Any,.    ) ->
+00018de0: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+00018df0: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
+00018e00: 206e 6577 2064 6174 6173 6574 2077 6974   new dataset wit
+00018e10: 6820 6561 6368 2061 7272 6179 2069 6e64  h each array ind
+00018e20: 6578 6564 2061 6c6f 6e67 2065 7665 7279  exed along every
+00018e30: 2060 6e60 2d74 680a 2020 2020 2020 2020   `n`-th.        
+00018e40: 7661 6c75 6520 666f 7220 7468 6520 7370  value for the sp
+00018e50: 6563 6966 6965 6420 6469 6d65 6e73 696f  ecified dimensio
+00018e60: 6e28 7329 0a0a 2020 2020 2020 2020 5061  n(s)..        Pa
+00018e70: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00018e80: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00018e90: 2020 2020 696e 6465 7865 7273 203a 2064      indexers : d
+00018ea0: 6963 7420 6f72 2069 6e74 0a20 2020 2020  ict or int.     
+00018eb0: 2020 2020 2020 2041 2064 6963 7420 7769         A dict wi
+00018ec0: 7468 206b 6579 7320 6d61 7463 6869 6e67  th keys matching
+00018ed0: 2064 696d 656e 7369 6f6e 7320 616e 6420   dimensions and 
+00018ee0: 696e 7465 6765 7220 7661 6c75 6573 2060  integer values `
+00018ef0: 6e60 0a20 2020 2020 2020 2020 2020 206f  n`.            o
+00018f00: 7220 6120 7369 6e67 6c65 2069 6e74 6567  r a single integ
+00018f10: 6572 2060 6e60 2061 7070 6c69 6564 206f  er `n` applied o
+00018f20: 7665 7220 616c 6c20 6469 6d65 6e73 696f  ver all dimensio
+00018f30: 6e73 2e0a 2020 2020 2020 2020 2020 2020  ns..            
+00018f40: 4f6e 6520 6f66 2069 6e64 6578 6572 7320  One of indexers 
+00018f50: 6f72 2069 6e64 6578 6572 735f 6b77 6172  or indexers_kwar
+00018f60: 6773 206d 7573 7420 6265 2070 726f 7669  gs must be provi
+00018f70: 6465 642e 0a20 2020 2020 2020 202a 2a69  ded..        **i
+00018f80: 6e64 6578 6572 735f 6b77 6172 6773 203a  ndexers_kwargs :
+00018f90: 207b 6469 6d3a 206e 2c20 2e2e 2e7d 2c20   {dim: n, ...}, 
+00018fa0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00018fb0: 2020 2020 2054 6865 206b 6579 776f 7264       The keyword
+00018fc0: 2061 7267 756d 656e 7473 2066 6f72 6d20   arguments form 
+00018fd0: 6f66 2060 6069 6e64 6578 6572 7360 602e  of ``indexers``.
+00018fe0: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
+00018ff0: 206f 6620 696e 6465 7865 7273 206f 7220   of indexers or 
+00019000: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
+00019010: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+00019020: 2e0a 0a20 2020 2020 2020 2045 7861 6d70  ...        Examp
+00019030: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
+00019040: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
+00019050: 2078 5f61 7272 203d 206e 702e 6172 616e   x_arr = np.aran
+00019060: 6765 2830 2c20 3236 290a 2020 2020 2020  ge(0, 26).      
+00019070: 2020 3e3e 3e20 785f 6172 720a 2020 2020    >>> x_arr.    
+00019080: 2020 2020 6172 7261 7928 5b20 302c 2020      array([ 0,  
+00019090: 312c 2020 322c 2020 332c 2020 342c 2020  1,  2,  3,  4,  
+000190a0: 352c 2020 362c 2020 372c 2020 382c 2020  5,  6,  7,  8,  
+000190b0: 392c 2031 302c 2031 312c 2031 322c 2031  9, 10, 11, 12, 1
+000190c0: 332c 2031 342c 2031 352c 2031 362c 0a20  3, 14, 15, 16,. 
+000190d0: 2020 2020 2020 2020 2020 2020 2020 3137                17
+000190e0: 2c20 3138 2c20 3139 2c20 3230 2c20 3231  , 18, 19, 20, 21
+000190f0: 2c20 3232 2c20 3233 2c20 3234 2c20 3235  , 22, 23, 24, 25
+00019100: 5d29 0a20 2020 2020 2020 203e 3e3e 2078  ]).        >>> x
+00019110: 203d 2078 722e 4461 7461 4172 7261 7928   = xr.DataArray(
+00019120: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+00019130: 206e 702e 7265 7368 6170 6528 785f 6172   np.reshape(x_ar
+00019140: 722c 2028 322c 2031 3329 292c 0a20 2020  r, (2, 13)),.   
+00019150: 2020 2020 202e 2e2e 2020 2020 2064 696d       ...     dim
+00019160: 733d 2822 7822 2c20 2279 2229 2c0a 2020  s=("x", "y"),.  
+00019170: 2020 2020 2020 2e2e 2e20 2020 2020 636f        ...     co
+00019180: 6f72 6473 3d7b 2278 223a 205b 302c 2031  ords={"x": [0, 1
+00019190: 5d2c 2022 7922 3a20 6e70 2e61 7261 6e67  ], "y": np.arang
+000191a0: 6528 302c 2031 3329 7d2c 0a20 2020 2020  e(0, 13)},.     
+000191b0: 2020 202e 2e2e 2029 0a20 2020 2020 2020     ... ).       
+000191c0: 203e 3e3e 2078 5f64 7320 3d20 7872 2e44   >>> x_ds = xr.D
+000191d0: 6174 6173 6574 287b 2266 6f6f 223a 2078  ataset({"foo": x
+000191e0: 7d29 0a20 2020 2020 2020 203e 3e3e 2078  }).        >>> x
+000191f0: 5f64 730a 2020 2020 2020 2020 3c78 6172  _ds.        <xar
+00019200: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+00019210: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+00019220: 2020 2878 3a20 322c 2079 3a20 3133 290a    (x: 2, y: 13).
+00019230: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+00019240: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
+00019250: 2078 2020 2020 2020 2020 2878 2920 696e   x        (x) in
+00019260: 7436 3420 3020 310a 2020 2020 2020 2020  t64 0 1.        
+00019270: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
+00019280: 2069 6e74 3634 2030 2031 2032 2033 2034   int64 0 1 2 3 4
+00019290: 2035 2036 2037 2038 2039 2031 3020 3131   5 6 7 8 9 10 11
+000192a0: 2031 320a 2020 2020 2020 2020 4461 7461   12.        Data
+000192b0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+000192c0: 2020 2020 2020 2020 666f 6f20 2020 2020          foo     
+000192d0: 2028 782c 2079 2920 696e 7436 3420 3020   (x, y) int64 0 
+000192e0: 3120 3220 3320 3420 3520 3620 3720 3820  1 2 3 4 5 6 7 8 
+000192f0: 3920 2e2e 2e20 3136 2031 3720 3138 2031  9 ... 16 17 18 1
+00019300: 3920 3230 2032 3120 3232 2032 3320 3234  9 20 21 22 23 24
+00019310: 2032 350a 0a20 2020 2020 2020 203e 3e3e   25..        >>>
+00019320: 2078 5f64 732e 7468 696e 2833 290a 2020   x_ds.thin(3).  
+00019330: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+00019340: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+00019350: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
+00019360: 312c 2079 3a20 3529 0a20 2020 2020 2020  1, y: 5).       
+00019370: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00019380: 2020 2020 2020 2020 2a20 7820 2020 2020          * x     
+00019390: 2020 2028 7829 2069 6e74 3634 2030 0a20     (x) int64 0. 
+000193a0: 2020 2020 2020 2020 202a 2079 2020 2020           * y    
+000193b0: 2020 2020 2879 2920 696e 7436 3420 3020      (y) int64 0 
+000193c0: 3320 3620 3920 3132 0a20 2020 2020 2020  3 6 9 12.       
+000193d0: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
+000193e0: 0a20 2020 2020 2020 2020 2020 2066 6f6f  .            foo
+000193f0: 2020 2020 2020 2878 2c20 7929 2069 6e74        (x, y) int
+00019400: 3634 2030 2033 2036 2039 2031 320a 2020  64 0 3 6 9 12.  
+00019410: 2020 2020 2020 3e3e 3e20 782e 7468 696e        >>> x.thin
+00019420: 287b 2278 223a 2032 2c20 2279 223a 2035  ({"x": 2, "y": 5
+00019430: 7d29 0a20 2020 2020 2020 203c 7861 7272  }).        <xarr
+00019440: 6179 2e44 6174 6141 7272 6179 2028 783a  ay.DataArray (x:
+00019450: 2031 2c20 793a 2033 293e 0a20 2020 2020   1, y: 3)>.     
+00019460: 2020 2061 7272 6179 285b 5b20 302c 2020     array([[ 0,  
+00019470: 352c 2031 305d 5d29 0a20 2020 2020 2020  5, 10]]).       
+00019480: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00019490: 2020 2020 2020 2020 2a20 7820 2020 2020          * x     
+000194a0: 2020 2028 7829 2069 6e74 3634 2030 0a20     (x) int64 0. 
+000194b0: 2020 2020 2020 2020 202a 2079 2020 2020           * y    
+000194c0: 2020 2020 2879 2920 696e 7436 3420 3020      (y) int64 0 
+000194d0: 3520 3130 0a0a 2020 2020 2020 2020 5365  5 10..        Se
+000194e0: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+000194f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00019500: 4461 7461 7365 742e 6865 6164 0a20 2020  Dataset.head.   
+00019510: 2020 2020 2044 6174 6173 6574 2e74 6169       Dataset.tai
+00019520: 6c0a 2020 2020 2020 2020 4461 7461 4172  l.        DataAr
+00019530: 7261 792e 7468 696e 0a20 2020 2020 2020  ray.thin.       
+00019540: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00019550: 280a 2020 2020 2020 2020 2020 2020 6e6f  (.            no
+00019560: 7420 696e 6465 7865 7273 5f6b 7761 7267  t indexers_kwarg
+00019570: 730a 2020 2020 2020 2020 2020 2020 616e  s.            an
+00019580: 6420 6e6f 7420 6973 696e 7374 616e 6365  d not isinstance
+00019590: 2869 6e64 6578 6572 732c 2069 6e74 290a  (indexers, int).
+000195a0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+000195b0: 6e6f 7420 6973 5f64 6963 745f 6c69 6b65  not is_dict_like
+000195c0: 2869 6e64 6578 6572 7329 0a20 2020 2020  (indexers).     
+000195d0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+000195e0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+000195f0: 7228 2269 6e64 6578 6572 7320 6d75 7374  r("indexers must
+00019600: 2062 6520 6569 7468 6572 2064 6963 742d   be either dict-
+00019610: 6c69 6b65 206f 7220 6120 7369 6e67 6c65  like or a single
+00019620: 2069 6e74 6567 6572 2229 0a20 2020 2020   integer").     
+00019630: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00019640: 2869 6e64 6578 6572 732c 2069 6e74 293a  (indexers, int):
+00019650: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+00019660: 6578 6572 7320 3d20 7b64 696d 3a20 696e  exers = {dim: in
+00019670: 6465 7865 7273 2066 6f72 2064 696d 2069  dexers for dim i
+00019680: 6e20 7365 6c66 2e64 696d 737d 0a20 2020  n self.dims}.   
+00019690: 2020 2020 2069 6e64 6578 6572 7320 3d20       indexers = 
+000196a0: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
+000196b0: 7761 7267 7328 696e 6465 7865 7273 2c20  wargs(indexers, 
+000196c0: 696e 6465 7865 7273 5f6b 7761 7267 732c  indexers_kwargs,
+000196d0: 2022 7468 696e 2229 0a20 2020 2020 2020   "thin").       
+000196e0: 2066 6f72 206b 2c20 7620 696e 2069 6e64   for k, v in ind
+000196f0: 6578 6572 732e 6974 656d 7328 293a 0a20  exers.items():. 
+00019700: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00019710: 7420 6973 696e 7374 616e 6365 2876 2c20  t isinstance(v, 
+00019720: 696e 7429 3a0a 2020 2020 2020 2020 2020  int):.          
+00019730: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+00019740: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00019750: 2020 2020 2020 2020 2020 2022 6578 7065             "expe
+00019760: 6374 6564 2069 6e74 6567 6572 2074 7970  cted integer typ
+00019770: 6520 696e 6465 7865 7220 666f 7220 220a  e indexer for ".
+00019780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019790: 2020 2020 6622 6469 6d65 6e73 696f 6e20      f"dimension 
+000197a0: 7b6b 2172 7d2c 2066 6f75 6e64 207b 7479  {k!r}, found {ty
+000197b0: 7065 2876 2921 727d 220a 2020 2020 2020  pe(v)!r}".      
+000197c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000197d0: 2020 2020 2020 2020 656c 6966 2076 203c          elif v <
+000197e0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000197f0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00019800: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00019810: 2020 2020 2020 2020 2020 2265 7870 6563            "expec
+00019820: 7465 6420 706f 7369 7469 7665 2069 6e74  ted positive int
+00019830: 6567 6572 2061 7320 696e 6465 7865 7220  eger as indexer 
+00019840: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00019850: 2020 2020 2020 6622 666f 7220 6469 6d65        f"for dime
+00019860: 6e73 696f 6e20 7b6b 2172 7d2c 2066 6f75  nsion {k!r}, fou
+00019870: 6e64 207b 767d 220a 2020 2020 2020 2020  nd {v}".        
+00019880: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00019890: 2020 2020 2020 656c 6966 2076 203d 3d20        elif v == 
+000198a0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+000198b0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+000198c0: 726f 7228 2273 7465 7020 6361 6e6e 6f74  ror("step cannot
+000198d0: 2062 6520 7a65 726f 2229 0a20 2020 2020   be zero").     
+000198e0: 2020 2069 6e64 6578 6572 735f 736c 6963     indexers_slic
+000198f0: 6573 203d 207b 6b3a 2073 6c69 6365 284e  es = {k: slice(N
+00019900: 6f6e 652c 204e 6f6e 652c 2076 616c 2920  one, None, val) 
+00019910: 666f 7220 6b2c 2076 616c 2069 6e20 696e  for k, val in in
+00019920: 6465 7865 7273 2e69 7465 6d73 2829 7d0a  dexers.items()}.
+00019930: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00019940: 656c 662e 6973 656c 2869 6e64 6578 6572  elf.isel(indexer
+00019950: 735f 736c 6963 6573 290a 0a20 2020 2064  s_slices)..    d
+00019960: 6566 2062 726f 6164 6361 7374 5f6c 696b  ef broadcast_lik
+00019970: 6528 0a20 2020 2020 2020 2073 656c 663a  e(.        self:
+00019980: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
+00019990: 2020 2020 6f74 6865 723a 2044 6174 6173      other: Datas
+000199a0: 6574 207c 2044 6174 6141 7272 6179 2c0a  et | DataArray,.
+000199b0: 2020 2020 2020 2020 6578 636c 7564 653a          exclude:
+000199c0: 2049 7465 7261 626c 655b 4861 7368 6162   Iterable[Hashab
+000199d0: 6c65 5d20 7c20 4e6f 6e65 203d 204e 6f6e  le] | None = Non
+000199e0: 652c 0a20 2020 2029 202d 3e20 545f 4461  e,.    ) -> T_Da
+000199f0: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+00019a00: 2222 4272 6f61 6463 6173 7420 7468 6973  ""Broadcast this
+00019a10: 2044 6174 6141 7272 6179 2061 6761 696e   DataArray again
+00019a20: 7374 2061 6e6f 7468 6572 2044 6174 6173  st another Datas
+00019a30: 6574 206f 7220 4461 7461 4172 7261 792e  et or DataArray.
+00019a40: 0a20 2020 2020 2020 2054 6869 7320 6973  .        This is
+00019a50: 2065 7175 6976 616c 656e 7420 746f 2078   equivalent to x
+00019a60: 722e 6272 6f61 6463 6173 7428 6f74 6865  r.broadcast(othe
+00019a70: 722c 2073 656c 6629 5b31 5d0a 0a20 2020  r, self)[1]..   
+00019a80: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00019a90: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00019aa0: 2d2d 0a20 2020 2020 2020 206f 7468 6572  --.        other
+00019ab0: 203a 2044 6174 6173 6574 206f 7220 4461   : Dataset or Da
+00019ac0: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
+00019ad0: 2020 2020 4f62 6a65 6374 2061 6761 696e      Object again
+00019ae0: 7374 2077 6869 6368 2074 6f20 6272 6f61  st which to broa
+00019af0: 6463 6173 7420 7468 6973 2061 7272 6179  dcast this array
+00019b00: 2e0a 2020 2020 2020 2020 6578 636c 7564  ..        exclud
+00019b10: 6520 3a20 6974 6572 6162 6c65 206f 6620  e : iterable of 
+00019b20: 6861 7368 6162 6c65 2c20 6f70 7469 6f6e  hashable, option
+00019b30: 616c 0a20 2020 2020 2020 2020 2020 2044  al.            D
+00019b40: 696d 656e 7369 6f6e 7320 7468 6174 206d  imensions that m
+00019b50: 7573 7420 6e6f 7420 6265 2062 726f 6164  ust not be broad
+00019b60: 6361 7374 6564 0a0a 2020 2020 2020 2020  casted..        
+00019b70: 2222 220a 2020 2020 2020 2020 6966 2065  """.        if e
+00019b80: 7863 6c75 6465 2069 7320 4e6f 6e65 3a0a  xclude is None:.
+00019b90: 2020 2020 2020 2020 2020 2020 6578 636c              excl
+00019ba0: 7564 6520 3d20 7365 7428 290a 2020 2020  ude = set().    
+00019bb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00019bc0: 2020 2020 2020 6578 636c 7564 6520 3d20        exclude = 
+00019bd0: 7365 7428 6578 636c 7564 6529 0a20 2020  set(exclude).   
+00019be0: 2020 2020 2061 7267 7320 3d20 616c 6967       args = alig
+00019bf0: 6e28 6f74 6865 722c 2073 656c 662c 206a  n(other, self, j
+00019c00: 6f69 6e3d 226f 7574 6572 222c 2063 6f70  oin="outer", cop
+00019c10: 793d 4661 6c73 652c 2065 7863 6c75 6465  y=False, exclude
+00019c20: 3d65 7863 6c75 6465 290a 0a20 2020 2020  =exclude)..     
+00019c30: 2020 2064 696d 735f 6d61 702c 2063 6f6d     dims_map, com
+00019c40: 6d6f 6e5f 636f 6f72 6473 203d 205f 6765  mon_coords = _ge
+00019c50: 745f 6272 6f61 6463 6173 745f 6469 6d73  t_broadcast_dims
+00019c60: 5f6d 6170 5f63 6f6d 6d6f 6e5f 636f 6f72  _map_common_coor
+00019c70: 6473 2861 7267 732c 2065 7863 6c75 6465  ds(args, exclude
+00019c80: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00019c90: 6e20 5f62 726f 6164 6361 7374 5f68 656c  n _broadcast_hel
+00019ca0: 7065 7228 0a20 2020 2020 2020 2020 2020  per(.           
+00019cb0: 2063 6173 7428 2254 5f44 6174 6173 6574   cast("T_Dataset
+00019cc0: 222c 2061 7267 735b 315d 292c 2065 7863  ", args[1]), exc
+00019cd0: 6c75 6465 2c20 6469 6d73 5f6d 6170 2c20  lude, dims_map, 
+00019ce0: 636f 6d6d 6f6e 5f63 6f6f 7264 730a 2020  common_coords.  
+00019cf0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00019d00: 205f 7265 696e 6465 785f 6361 6c6c 6261   _reindex_callba
+00019d10: 636b 280a 2020 2020 2020 2020 7365 6c66  ck(.        self
+00019d20: 2c0a 2020 2020 2020 2020 616c 6967 6e65  ,.        aligne
+00019d30: 723a 2061 6c69 676e 6d65 6e74 2e41 6c69  r: alignment.Ali
+00019d40: 676e 6572 2c0a 2020 2020 2020 2020 6469  gner,.        di
+00019d50: 6d5f 706f 735f 696e 6465 7865 7273 3a20  m_pos_indexers: 
+00019d60: 6469 6374 5b48 6173 6861 626c 652c 2041  dict[Hashable, A
+00019d70: 6e79 5d2c 0a20 2020 2020 2020 2076 6172  ny],.        var
+00019d80: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
+00019d90: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
+00019da0: 2c0a 2020 2020 2020 2020 696e 6465 7865  ,.        indexe
+00019db0: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
+00019dc0: 2c20 496e 6465 785d 2c0a 2020 2020 2020  , Index],.      
+00019dd0: 2020 6669 6c6c 5f76 616c 7565 3a20 416e    fill_value: An
+00019de0: 792c 0a20 2020 2020 2020 2065 7863 6c75  y,.        exclu
+00019df0: 6465 5f64 696d 733a 2066 726f 7a65 6e73  de_dims: frozens
+00019e00: 6574 5b48 6173 6861 626c 655d 2c0a 2020  et[Hashable],.  
+00019e10: 2020 2020 2020 6578 636c 7564 655f 7661        exclude_va
+00019e20: 7273 3a20 6672 6f7a 656e 7365 745b 4861  rs: frozenset[Ha
+00019e30: 7368 6162 6c65 5d2c 0a20 2020 2029 202d  shable],.    ) -
+00019e40: 3e20 4461 7461 7365 743a 0a20 2020 2020  > Dataset:.     
+00019e50: 2020 2022 2222 4361 6c6c 6261 636b 2063     """Callback c
+00019e60: 616c 6c65 6420 6672 6f6d 2060 6041 6c69  alled from ``Ali
+00019e70: 676e 6572 6060 2074 6f20 6372 6561 7465  gner`` to create
+00019e80: 2061 206e 6577 2072 6569 6e64 6578 6564   a new reindexed
+00019e90: 2044 6174 6173 6574 2e22 2222 0a0a 2020   Dataset."""..  
+00019ea0: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
+00019eb0: 6c65 7320 3d20 7661 7269 6162 6c65 732e  les = variables.
+00019ec0: 636f 7079 2829 0a20 2020 2020 2020 206e  copy().        n
+00019ed0: 6577 5f69 6e64 6578 6573 203d 2069 6e64  ew_indexes = ind
+00019ee0: 6578 6573 2e63 6f70 7928 290a 0a20 2020  exes.copy()..   
+00019ef0: 2020 2020 2023 2072 652d 6173 7369 676e       # re-assign
+00019f00: 2076 6172 6961 626c 6520 6d65 7461 6461   variable metada
+00019f10: 7461 0a20 2020 2020 2020 2066 6f72 206e  ta.        for n
+00019f20: 616d 652c 206e 6577 5f76 6172 2069 6e20  ame, new_var in 
+00019f30: 6e65 775f 7661 7269 6162 6c65 732e 6974  new_variables.it
+00019f40: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00019f50: 2020 2076 6172 203d 2073 656c 662e 5f76     var = self._v
+00019f60: 6172 6961 626c 6573 2e67 6574 286e 616d  ariables.get(nam
+00019f70: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+00019f80: 6620 7661 7220 6973 206e 6f74 204e 6f6e  f var is not Non
+00019f90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00019fa0: 2020 206e 6577 5f76 6172 2e61 7474 7273     new_var.attrs
+00019fb0: 203d 2076 6172 2e61 7474 7273 0a20 2020   = var.attrs.   
+00019fc0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00019fd0: 5f76 6172 2e65 6e63 6f64 696e 6720 3d20  _var.encoding = 
+00019fe0: 7661 722e 656e 636f 6469 6e67 0a0a 2020  var.encoding..  
+00019ff0: 2020 2020 2020 2320 7061 7373 2074 6872        # pass thr
+0001a000: 6f75 6768 2069 6e64 6578 6573 2066 726f  ough indexes fro
+0001a010: 6d20 6578 636c 7564 6564 2064 696d 656e  m excluded dimen
+0001a020: 7369 6f6e 730a 2020 2020 2020 2020 2320  sions.        # 
+0001a030: 6e6f 2065 7874 7261 2063 6865 636b 206e  no extra check n
+0001a040: 6565 6465 6420 666f 7220 6d75 6c74 692d  eeded for multi-
+0001a050: 636f 6f72 6469 6e61 7465 2069 6e64 6578  coordinate index
+0001a060: 6573 2c20 706f 7465 6e74 6961 6c20 636f  es, potential co
+0001a070: 6e66 6c69 6374 730a 2020 2020 2020 2020  nflicts.        
+0001a080: 2320 7368 6f75 6c64 2061 6c72 6561 6479  # should already
+0001a090: 2068 6176 6520 6265 656e 2064 6574 6563   have been detec
+0001a0a0: 7465 6420 7768 656e 2061 6c69 676e 696e  ted when alignin
+0001a0b0: 6720 7468 6520 696e 6465 7865 730a 2020  g the indexes.  
+0001a0c0: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
+0001a0d0: 6964 7820 696e 2073 656c 662e 5f69 6e64  idx in self._ind
+0001a0e0: 6578 6573 2e69 7465 6d73 2829 3a0a 2020  exes.items():.  
+0001a0f0: 2020 2020 2020 2020 2020 7661 7220 3d20            var = 
+0001a100: 7365 6c66 2e5f 7661 7269 6162 6c65 735b  self._variables[
+0001a110: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
+0001a120: 2020 6966 2073 6574 2876 6172 2e64 696d    if set(var.dim
+0001a130: 7329 203c 3d20 6578 636c 7564 655f 6469  s) <= exclude_di
+0001a140: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0001a150: 2020 2020 6e65 775f 696e 6465 7865 735b      new_indexes[
+0001a160: 6e61 6d65 5d20 3d20 6964 780a 2020 2020  name] = idx.    
+0001a170: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0001a180: 7661 7269 6162 6c65 735b 6e61 6d65 5d20  variables[name] 
+0001a190: 3d20 7661 720a 0a20 2020 2020 2020 2069  = var..        i
+0001a1a0: 6620 6e6f 7420 6469 6d5f 706f 735f 696e  f not dim_pos_in
+0001a1b0: 6465 7865 7273 3a0a 2020 2020 2020 2020  dexers:.        
+0001a1c0: 2020 2020 2320 6661 7374 2070 6174 6820      # fast path 
+0001a1d0: 666f 7220 6e6f 2072 6569 6e64 6578 696e  for no reindexin
+0001a1e0: 6720 6e65 6365 7373 6172 790a 2020 2020  g necessary.    
+0001a1f0: 2020 2020 2020 2020 6966 2073 6574 286e          if set(n
+0001a200: 6577 5f69 6e64 6578 6573 2920 2d20 7365  ew_indexes) - se
+0001a210: 7428 7365 6c66 2e5f 696e 6465 7865 7329  t(self._indexes)
+0001a220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a230: 2020 2320 7468 6973 206f 6e6c 7920 6164    # this only ad
+0001a240: 6473 206e 6577 2069 6e64 6578 6573 2061  ds new indexes a
+0001a250: 6e64 2074 6865 6972 2063 6f6f 7264 696e  nd their coordin
+0001a260: 6174 6520 7661 7269 6162 6c65 730a 2020  ate variables.  
+0001a270: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001a280: 696e 6465 7865 6420 3d20 7365 6c66 2e5f  indexed = self._
+0001a290: 6f76 6572 7772 6974 655f 696e 6465 7865  overwrite_indexe
+0001a2a0: 7328 6e65 775f 696e 6465 7865 732c 206e  s(new_indexes, n
+0001a2b0: 6577 5f76 6172 6961 626c 6573 290a 2020  ew_variables).  
+0001a2c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a2e0: 7265 696e 6465 7865 6420 3d20 7365 6c66  reindexed = self
+0001a2f0: 2e63 6f70 7928 6465 6570 3d61 6c69 676e  .copy(deep=align
+0001a300: 6572 2e63 6f70 7929 0a20 2020 2020 2020  er.copy).       
+0001a310: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001a320: 2020 2074 6f5f 7265 696e 6465 7820 3d20     to_reindex = 
+0001a330: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001a340: 2020 6b3a 2076 0a20 2020 2020 2020 2020    k: v.         
+0001a350: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+0001a360: 696e 2073 656c 662e 7661 7269 6162 6c65  in self.variable
+0001a370: 732e 6974 656d 7328 290a 2020 2020 2020  s.items().      
+0001a380: 2020 2020 2020 2020 2020 6966 206b 206e            if k n
+0001a390: 6f74 2069 6e20 7661 7269 6162 6c65 7320  ot in variables 
+0001a3a0: 616e 6420 6b20 6e6f 7420 696e 2065 7863  and k not in exc
+0001a3b0: 6c75 6465 5f76 6172 730a 2020 2020 2020  lude_vars.      
+0001a3c0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0001a3d0: 2020 2020 7265 696e 6465 7865 645f 7661      reindexed_va
+0001a3e0: 7273 203d 2061 6c69 676e 6d65 6e74 2e72  rs = alignment.r
+0001a3f0: 6569 6e64 6578 5f76 6172 6961 626c 6573  eindex_variables
+0001a400: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001a410: 2020 746f 5f72 6569 6e64 6578 2c0a 2020    to_reindex,.  
+0001a420: 2020 2020 2020 2020 2020 2020 2020 6469                di
+0001a430: 6d5f 706f 735f 696e 6465 7865 7273 2c0a  m_pos_indexers,.
+0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a450: 636f 7079 3d61 6c69 676e 6572 2e63 6f70  copy=aligner.cop
+0001a460: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+0001a470: 2020 2066 696c 6c5f 7661 6c75 653d 6669     fill_value=fi
+0001a480: 6c6c 5f76 616c 7565 2c0a 2020 2020 2020  ll_value,.      
+0001a490: 2020 2020 2020 2020 2020 7370 6172 7365            sparse
+0001a4a0: 3d61 6c69 676e 6572 2e73 7061 7273 652c  =aligner.sparse,
+0001a4b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001a4c0: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
+0001a4d0: 6172 6961 626c 6573 2e75 7064 6174 6528  ariables.update(
+0001a4e0: 7265 696e 6465 7865 645f 7661 7273 290a  reindexed_vars).
+0001a4f0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0001a500: 636f 6f72 645f 6e61 6d65 7320 3d20 7365  coord_names = se
+0001a510: 6c66 2e5f 636f 6f72 645f 6e61 6d65 7320  lf._coord_names 
+0001a520: 7c20 7365 7428 6e65 775f 696e 6465 7865  | set(new_indexe
+0001a530: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
+0001a540: 6569 6e64 6578 6564 203d 2073 656c 662e  eindexed = self.
+0001a550: 5f72 6570 6c61 6365 5f77 6974 685f 6e65  _replace_with_ne
+0001a560: 775f 6469 6d73 280a 2020 2020 2020 2020  w_dims(.        
+0001a570: 2020 2020 2020 2020 6e65 775f 7661 7269          new_vari
+0001a580: 6162 6c65 732c 206e 6577 5f63 6f6f 7264  ables, new_coord
+0001a590: 5f6e 616d 6573 2c20 696e 6465 7865 733d  _names, indexes=
+0001a5a0: 6e65 775f 696e 6465 7865 730a 2020 2020  new_indexes.    
+0001a5b0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001a5c0: 2020 2072 6574 7572 6e20 7265 696e 6465     return reinde
+0001a5d0: 7865 640a 0a20 2020 2064 6566 2072 6569  xed..    def rei
+0001a5e0: 6e64 6578 5f6c 696b 6528 0a20 2020 2020  ndex_like(.     
+0001a5f0: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+0001a600: 6574 2c0a 2020 2020 2020 2020 6f74 6865  et,.        othe
+0001a610: 723a 2044 6174 6173 6574 207c 2044 6174  r: Dataset | Dat
+0001a620: 6141 7272 6179 2c0a 2020 2020 2020 2020  aArray,.        
+0001a630: 6d65 7468 6f64 3a20 5265 696e 6465 784d  method: ReindexM
+0001a640: 6574 686f 644f 7074 696f 6e73 203d 204e  ethodOptions = N
+0001a650: 6f6e 652c 0a20 2020 2020 2020 2074 6f6c  one,.        tol
+0001a660: 6572 616e 6365 3a20 696e 7420 7c20 666c  erance: int | fl
+0001a670: 6f61 7420 7c20 4974 6572 6162 6c65 5b69  oat | Iterable[i
+0001a680: 6e74 207c 2066 6c6f 6174 5d20 7c20 4e6f  nt | float] | No
+0001a690: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+0001a6a0: 2020 2063 6f70 793a 2062 6f6f 6c20 3d20     copy: bool = 
+0001a6b0: 5472 7565 2c0a 2020 2020 2020 2020 6669  True,.        fi
+0001a6c0: 6c6c 5f76 616c 7565 3a20 416e 7920 3d20  ll_value: Any = 
+0001a6d0: 7872 6474 7970 6573 2e4e 412c 0a20 2020  xrdtypes.NA,.   
+0001a6e0: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+0001a6f0: 0a20 2020 2020 2020 2022 2222 436f 6e66  .        """Conf
+0001a700: 6f72 6d20 7468 6973 206f 626a 6563 7420  orm this object 
+0001a710: 6f6e 746f 2074 6865 2069 6e64 6578 6573  onto the indexes
+0001a720: 206f 6620 616e 6f74 6865 7220 6f62 6a65   of another obje
+0001a730: 6374 2c20 6669 6c6c 696e 6720 696e 0a20  ct, filling in. 
+0001a740: 2020 2020 2020 206d 6973 7369 6e67 2076         missing v
+0001a750: 616c 7565 7320 7769 7468 2060 6066 696c  alues with ``fil
+0001a760: 6c5f 7661 6c75 6560 602e 2054 6865 2064  l_value``. The d
+0001a770: 6566 6175 6c74 2066 696c 6c20 7661 6c75  efault fill valu
+0001a780: 6520 6973 204e 614e 2e0a 0a20 2020 2020  e is NaN...     
+0001a790: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+0001a7a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0001a7b0: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
+0001a7c0: 2044 6174 6173 6574 206f 7220 4461 7461   Dataset or Data
+0001a7d0: 4172 7261 790a 2020 2020 2020 2020 2020  Array.          
+0001a7e0: 2020 4f62 6a65 6374 2077 6974 6820 616e    Object with an
+0001a7f0: 2027 696e 6465 7865 7327 2061 7474 7269   'indexes' attri
+0001a800: 6275 7465 2067 6976 696e 6720 6120 6d61  bute giving a ma
+0001a810: 7070 696e 6720 6672 6f6d 2064 696d 656e  pping from dimen
+0001a820: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
+0001a830: 206e 616d 6573 2074 6f20 7061 6e64 6173   names to pandas
+0001a840: 2e49 6e64 6578 206f 626a 6563 7473 2c20  .Index objects, 
+0001a850: 7768 6963 6820 7072 6f76 6964 6573 2063  which provides c
+0001a860: 6f6f 7264 696e 6174 6573 2075 706f 6e0a  oordinates upon.
+0001a870: 2020 2020 2020 2020 2020 2020 7768 6963              whic
+0001a880: 6820 746f 2069 6e64 6578 2074 6865 2076  h to index the v
+0001a890: 6172 6961 626c 6573 2069 6e20 7468 6973  ariables in this
+0001a8a0: 2064 6174 6173 6574 2e20 5468 6520 696e   dataset. The in
+0001a8b0: 6465 7865 7320 6f6e 2074 6869 730a 2020  dexes on this.  
+0001a8c0: 2020 2020 2020 2020 2020 6f74 6865 7220            other 
+0001a8d0: 6f62 6a65 6374 206e 6565 6420 6e6f 7420  object need not 
+0001a8e0: 6265 2074 6865 2073 616d 6520 6173 2074  be the same as t
+0001a8f0: 6865 2069 6e64 6578 6573 206f 6e20 7468  he indexes on th
+0001a900: 6973 0a20 2020 2020 2020 2020 2020 2064  is.            d
+0001a910: 6174 6173 6574 2e20 416e 7920 6d69 732d  ataset. Any mis-
+0001a920: 6d61 7463 6865 6420 696e 6465 7820 7661  matched index va
+0001a930: 6c75 6573 2077 696c 6c20 6265 2066 696c  lues will be fil
+0001a940: 6c65 6420 696e 2077 6974 680a 2020 2020  led in with.    
+0001a950: 2020 2020 2020 2020 4e61 4e2c 2061 6e64          NaN, and
+0001a960: 2061 6e79 206d 6973 2d6d 6174 6368 6564   any mis-matched
+0001a970: 2064 696d 656e 7369 6f6e 206e 616d 6573   dimension names
+0001a980: 2077 696c 6c20 7369 6d70 6c79 2062 6520   will simply be 
+0001a990: 6967 6e6f 7265 642e 0a20 2020 2020 2020  ignored..       
+0001a9a0: 206d 6574 686f 6420 3a20 7b4e 6f6e 652c   method : {None,
+0001a9b0: 2022 6e65 6172 6573 7422 2c20 2270 6164   "nearest", "pad
+0001a9c0: 222c 2022 6666 696c 6c22 2c20 2262 6163  ", "ffill", "bac
+0001a9d0: 6b66 696c 6c22 2c20 2262 6669 6c6c 222c  kfill", "bfill",
+0001a9e0: 204e 6f6e 657d 2c20 6f70 7469 6f6e 616c   None}, optional
+0001a9f0: 0a20 2020 2020 2020 2020 2020 204d 6574  .            Met
+0001aa00: 686f 6420 746f 2075 7365 2066 6f72 2066  hod to use for f
+0001aa10: 696c 6c69 6e67 2069 6e64 6578 2076 616c  illing index val
+0001aa20: 7565 7320 6672 6f6d 206f 7468 6572 206e  ues from other n
+0001aa30: 6f74 2066 6f75 6e64 2069 6e20 7468 6973  ot found in this
+0001aa40: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+0001aa50: 6173 6574 3a0a 0a20 2020 2020 2020 2020  aset:..         
+0001aa60: 2020 202d 204e 6f6e 6520 2864 6566 6175     - None (defau
+0001aa70: 6c74 293a 2064 6f6e 2774 2066 696c 6c20  lt): don't fill 
+0001aa80: 6761 7073 0a20 2020 2020 2020 2020 2020  gaps.           
+0001aa90: 202d 2022 7061 6422 202f 2022 6666 696c   - "pad" / "ffil
+0001aaa0: 6c22 3a20 7072 6f70 6167 6174 6520 6c61  l": propagate la
+0001aab0: 7374 2076 616c 6964 2069 6e64 6578 2076  st valid index v
+0001aac0: 616c 7565 2066 6f72 7761 7264 0a20 2020  alue forward.   
+0001aad0: 2020 2020 2020 2020 202d 2022 6261 636b           - "back
+0001aae0: 6669 6c6c 2220 2f20 2262 6669 6c6c 223a  fill" / "bfill":
+0001aaf0: 2070 726f 7061 6761 7465 206e 6578 7420   propagate next 
+0001ab00: 7661 6c69 6420 696e 6465 7820 7661 6c75  valid index valu
+0001ab10: 6520 6261 636b 7761 7264 0a20 2020 2020  e backward.     
+0001ab20: 2020 2020 2020 202d 2022 6e65 6172 6573         - "neares
+0001ab30: 7422 3a20 7573 6520 6e65 6172 6573 7420  t": use nearest 
+0001ab40: 7661 6c69 6420 696e 6465 7820 7661 6c75  valid index valu
+0001ab50: 650a 0a20 2020 2020 2020 2074 6f6c 6572  e..        toler
+0001ab60: 616e 6365 203a 206f 7074 696f 6e61 6c0a  ance : optional.
+0001ab70: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
+0001ab80: 6d75 6d20 6469 7374 616e 6365 2062 6574  mum distance bet
+0001ab90: 7765 656e 206f 7269 6769 6e61 6c20 616e  ween original an
+0001aba0: 6420 6e65 7720 6c61 6265 6c73 2066 6f72  d new labels for
+0001abb0: 2069 6e65 7861 6374 0a20 2020 2020 2020   inexact.       
+0001abc0: 2020 2020 206d 6174 6368 6573 2e20 5468       matches. Th
+0001abd0: 6520 7661 6c75 6573 206f 6620 7468 6520  e values of the 
+0001abe0: 696e 6465 7820 6174 2074 6865 206d 6174  index at the mat
+0001abf0: 6368 696e 6720 6c6f 6361 7469 6f6e 7320  ching locations 
+0001ac00: 6d75 7374 0a20 2020 2020 2020 2020 2020  must.           
+0001ac10: 2073 6174 6973 6679 2074 6865 2065 7175   satisfy the equ
+0001ac20: 6174 696f 6e20 6060 6162 7328 696e 6465  ation ``abs(inde
+0001ac30: 785b 696e 6465 7865 725d 202d 2074 6172  x[indexer] - tar
+0001ac40: 6765 7429 203c 3d20 746f 6c65 7261 6e63  get) <= toleranc
+0001ac50: 6560 602e 0a20 2020 2020 2020 2020 2020  e``..           
+0001ac60: 2054 6f6c 6572 616e 6365 206d 6179 2062   Tolerance may b
+0001ac70: 6520 6120 7363 616c 6172 2076 616c 7565  e a scalar value
+0001ac80: 2c20 7768 6963 6820 6170 706c 6965 7320  , which applies 
+0001ac90: 7468 6520 7361 6d65 2074 6f6c 6572 616e  the same toleran
+0001aca0: 6365 0a20 2020 2020 2020 2020 2020 2074  ce.            t
+0001acb0: 6f20 616c 6c20 7661 6c75 6573 2c20 6f72  o all values, or
+0001acc0: 206c 6973 742d 6c69 6b65 2c20 7768 6963   list-like, whic
+0001acd0: 6820 6170 706c 6965 7320 7661 7269 6162  h applies variab
+0001ace0: 6c65 2074 6f6c 6572 616e 6365 2070 6572  le tolerance per
+0001acf0: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
+0001ad00: 6d65 6e74 2e20 4c69 7374 2d6c 696b 6520  ment. List-like 
+0001ad10: 6d75 7374 2062 6520 7468 6520 7361 6d65  must be the same
+0001ad20: 2073 697a 6520 6173 2074 6865 2069 6e64   size as the ind
+0001ad30: 6578 2061 6e64 2069 7473 2064 7479 7065  ex and its dtype
+0001ad40: 0a20 2020 2020 2020 2020 2020 206d 7573  .            mus
+0001ad50: 7420 6578 6163 746c 7920 6d61 7463 6820  t exactly match 
+0001ad60: 7468 6520 696e 6465 78e2 8099 7320 7479  the index...s ty
+0001ad70: 7065 2e0a 2020 2020 2020 2020 636f 7079  pe..        copy
+0001ad80: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0001ad90: 3a20 5472 7565 0a20 2020 2020 2020 2020  : True.         
+0001ada0: 2020 2049 6620 6060 636f 7079 3d54 7275     If ``copy=Tru
+0001adb0: 6560 602c 2064 6174 6120 696e 2074 6865  e``, data in the
+0001adc0: 2072 6574 7572 6e20 7661 6c75 6520 6973   return value is
+0001add0: 2061 6c77 6179 7320 636f 7069 6564 2e20   always copied. 
+0001ade0: 4966 0a20 2020 2020 2020 2020 2020 2060  If.            `
+0001adf0: 6063 6f70 793d 4661 6c73 6560 6020 616e  `copy=False`` an
+0001ae00: 6420 7265 696e 6465 7869 6e67 2069 7320  d reindexing is 
+0001ae10: 756e 6e65 6365 7373 6172 792c 206f 7220  unnecessary, or 
+0001ae20: 6361 6e20 6265 2070 6572 666f 726d 6564  can be performed
+0001ae30: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0001ae40: 6820 6f6e 6c79 2073 6c69 6365 206f 7065  h only slice ope
+0001ae50: 7261 7469 6f6e 732c 2074 6865 6e20 7468  rations, then th
+0001ae60: 6520 6f75 7470 7574 206d 6179 2073 6861  e output may sha
+0001ae70: 7265 206d 656d 6f72 7920 7769 7468 0a20  re memory with. 
+0001ae80: 2020 2020 2020 2020 2020 2074 6865 2069             the i
+0001ae90: 6e70 7574 2e20 496e 2065 6974 6865 7220  nput. In either 
+0001aea0: 6361 7365 2c20 6120 6e65 7720 7861 7272  case, a new xarr
+0001aeb0: 6179 206f 626a 6563 7420 6973 2061 6c77  ay object is alw
+0001aec0: 6179 7320 7265 7475 726e 6564 2e0a 2020  ays returned..  
+0001aed0: 2020 2020 2020 6669 6c6c 5f76 616c 7565        fill_value
+0001aee0: 203a 2073 6361 6c61 7220 6f72 2064 6963   : scalar or dic
+0001aef0: 742d 6c69 6b65 2c20 6f70 7469 6f6e 616c  t-like, optional
+0001af00: 0a20 2020 2020 2020 2020 2020 2056 616c  .            Val
+0001af10: 7565 2074 6f20 7573 6520 666f 7220 6e65  ue to use for ne
+0001af20: 776c 7920 6d69 7373 696e 6720 7661 6c75  wly missing valu
+0001af30: 6573 2e20 4966 2061 2064 6963 742d 6c69  es. If a dict-li
+0001af40: 6b65 206d 6170 730a 2020 2020 2020 2020  ke maps.        
+0001af50: 2020 2020 7661 7269 6162 6c65 206e 616d      variable nam
+0001af60: 6573 2074 6f20 6669 6c6c 2076 616c 7565  es to fill value
+0001af70: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
+0001af80: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+0001af90: 2d2d 2d0a 2020 2020 2020 2020 7265 696e  ---.        rein
+0001afa0: 6465 7865 6420 3a20 4461 7461 7365 740a  dexed : Dataset.
+0001afb0: 2020 2020 2020 2020 2020 2020 416e 6f74              Anot
+0001afc0: 6865 7220 6461 7461 7365 742c 2077 6974  her dataset, wit
+0001afd0: 6820 7468 6973 2064 6174 6173 6574 2773  h this dataset's
+0001afe0: 2064 6174 6120 6275 7420 636f 6f72 6469   data but coordi
+0001aff0: 6e61 7465 7320 6672 6f6d 2074 6865 0a20  nates from the. 
+0001b000: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0001b010: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
+0001b020: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+0001b030: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0001b040: 2020 2020 4461 7461 7365 742e 7265 696e      Dataset.rein
+0001b050: 6465 780a 2020 2020 2020 2020 616c 6967  dex.        alig
+0001b060: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+0001b070: 2020 2020 2020 7265 7475 726e 2061 6c69        return ali
+0001b080: 676e 6d65 6e74 2e72 6569 6e64 6578 5f6c  gnment.reindex_l
+0001b090: 696b 6528 0a20 2020 2020 2020 2020 2020  ike(.           
+0001b0a0: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+0001b0b0: 2020 206f 7468 6572 3d6f 7468 6572 2c0a     other=other,.
+0001b0c0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0001b0d0: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
+0001b0e0: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
+0001b0f0: 3d74 6f6c 6572 616e 6365 2c0a 2020 2020  =tolerance,.    
+0001b100: 2020 2020 2020 2020 636f 7079 3d63 6f70          copy=cop
+0001b110: 792c 0a20 2020 2020 2020 2020 2020 2066  y,.            f
+0001b120: 696c 6c5f 7661 6c75 653d 6669 6c6c 5f76  ill_value=fill_v
+0001b130: 616c 7565 2c0a 2020 2020 2020 2020 290a  alue,.        ).
+0001b140: 0a20 2020 2064 6566 2072 6569 6e64 6578  .    def reindex
+0001b150: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+0001b160: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
+0001b170: 2020 2069 6e64 6578 6572 733a 204d 6170     indexers: Map
+0001b180: 7069 6e67 5b41 6e79 2c20 416e 795d 207c  ping[Any, Any] |
+0001b190: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+0001b1a0: 2020 2020 2020 6d65 7468 6f64 3a20 5265        method: Re
+0001b1b0: 696e 6465 784d 6574 686f 644f 7074 696f  indexMethodOptio
+0001b1c0: 6e73 203d 204e 6f6e 652c 0a20 2020 2020  ns = None,.     
+0001b1d0: 2020 2074 6f6c 6572 616e 6365 3a20 696e     tolerance: in
+0001b1e0: 7420 7c20 666c 6f61 7420 7c20 4974 6572  t | float | Iter
+0001b1f0: 6162 6c65 5b69 6e74 207c 2066 6c6f 6174  able[int | float
+0001b200: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+0001b210: 0a20 2020 2020 2020 2063 6f70 793a 2062  .        copy: b
+0001b220: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
+0001b230: 2020 2020 6669 6c6c 5f76 616c 7565 3a20      fill_value: 
+0001b240: 416e 7920 3d20 7872 6474 7970 6573 2e4e  Any = xrdtypes.N
+0001b250: 412c 0a20 2020 2020 2020 202a 2a69 6e64  A,.        **ind
+0001b260: 6578 6572 735f 6b77 6172 6773 3a20 416e  exers_kwargs: An
+0001b270: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
+0001b280: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+0001b290: 2222 436f 6e66 6f72 6d20 7468 6973 206f  ""Conform this o
+0001b2a0: 626a 6563 7420 6f6e 746f 2061 206e 6577  bject onto a new
+0001b2b0: 2073 6574 206f 6620 696e 6465 7865 732c   set of indexes,
+0001b2c0: 2066 696c 6c69 6e67 2069 6e0a 2020 2020   filling in.    
+0001b2d0: 2020 2020 6d69 7373 696e 6720 7661 6c75      missing valu
+0001b2e0: 6573 2077 6974 6820 6060 6669 6c6c 5f76  es with ``fill_v
+0001b2f0: 616c 7565 6060 2e20 5468 6520 6465 6661  alue``. The defa
+0001b300: 756c 7420 6669 6c6c 2076 616c 7565 2069  ult fill value i
+0001b310: 7320 4e61 4e2e 0a0a 2020 2020 2020 2020  s NaN...        
+0001b320: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0001b330: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0001b340: 2020 2020 2020 696e 6465 7865 7273 203a        indexers :
+0001b350: 2064 6963 742c 206f 7074 696f 6e61 6c0a   dict, optional.
+0001b360: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
+0001b370: 696f 6e61 7279 2077 6974 6820 6b65 7973  ionary with keys
+0001b380: 2067 6976 656e 2062 7920 6469 6d65 6e73   given by dimens
+0001b390: 696f 6e20 6e61 6d65 7320 616e 6420 7661  ion names and va
+0001b3a0: 6c75 6573 2067 6976 656e 2062 790a 2020  lues given by.  
+0001b3b0: 2020 2020 2020 2020 2020 6172 7261 7973            arrays
+0001b3c0: 206f 6620 636f 6f72 6469 6e61 7465 7320   of coordinates 
+0001b3d0: 7469 636b 206c 6162 656c 732e 2041 6e79  tick labels. Any
+0001b3e0: 206d 6973 2d6d 6174 6368 6564 2063 6f6f   mis-matched coo
+0001b3f0: 7264 696e 6174 650a 2020 2020 2020 2020  rdinate.        
+0001b400: 2020 2020 7661 6c75 6573 2077 696c 6c20      values will 
+0001b410: 6265 2066 696c 6c65 6420 696e 2077 6974  be filled in wit
+0001b420: 6820 4e61 4e2c 2061 6e64 2061 6e79 206d  h NaN, and any m
+0001b430: 6973 2d6d 6174 6368 6564 2064 696d 656e  is-matched dimen
+0001b440: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
+0001b450: 206e 616d 6573 2077 696c 6c20 7369 6d70   names will simp
+0001b460: 6c79 2062 6520 6967 6e6f 7265 642e 0a20  ly be ignored.. 
+0001b470: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
+0001b480: 6620 696e 6465 7865 7273 206f 7220 696e  f indexers or in
+0001b490: 6465 7865 7273 5f6b 7761 7267 7320 6d75  dexers_kwargs mu
+0001b4a0: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
+0001b4b0: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+0001b4c0: 207b 4e6f 6e65 2c20 226e 6561 7265 7374   {None, "nearest
+0001b4d0: 222c 2022 7061 6422 2c20 2266 6669 6c6c  ", "pad", "ffill
+0001b4e0: 222c 2022 6261 636b 6669 6c6c 222c 2022  ", "backfill", "
+0001b4f0: 6266 696c 6c22 2c20 4e6f 6e65 7d2c 206f  bfill", None}, o
+0001b500: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0001b510: 2020 2020 4d65 7468 6f64 2074 6f20 7573      Method to us
+0001b520: 6520 666f 7220 6669 6c6c 696e 6720 696e  e for filling in
+0001b530: 6465 7820 7661 6c75 6573 2069 6e20 6060  dex values in ``
+0001b540: 696e 6465 7865 7273 6060 206e 6f74 2066  indexers`` not f
+0001b550: 6f75 6e64 2069 6e0a 2020 2020 2020 2020  ound in.        
+0001b560: 2020 2020 7468 6973 2064 6174 6173 6574      this dataset
+0001b570: 3a0a 0a20 2020 2020 2020 2020 2020 202d  :..            -
+0001b580: 204e 6f6e 6520 2864 6566 6175 6c74 293a   None (default):
+0001b590: 2064 6f6e 2774 2066 696c 6c20 6761 7073   don't fill gaps
+0001b5a0: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+0001b5b0: 7061 6422 202f 2022 6666 696c 6c22 3a20  pad" / "ffill": 
+0001b5c0: 7072 6f70 6167 6174 6520 6c61 7374 2076  propagate last v
+0001b5d0: 616c 6964 2069 6e64 6578 2076 616c 7565  alid index value
+0001b5e0: 2066 6f72 7761 7264 0a20 2020 2020 2020   forward.       
+0001b5f0: 2020 2020 202d 2022 6261 636b 6669 6c6c       - "backfill
+0001b600: 2220 2f20 2262 6669 6c6c 223a 2070 726f  " / "bfill": pro
+0001b610: 7061 6761 7465 206e 6578 7420 7661 6c69  pagate next vali
+0001b620: 6420 696e 6465 7820 7661 6c75 6520 6261  d index value ba
+0001b630: 636b 7761 7264 0a20 2020 2020 2020 2020  ckward.         
+0001b640: 2020 202d 2022 6e65 6172 6573 7422 3a20     - "nearest": 
+0001b650: 7573 6520 6e65 6172 6573 7420 7661 6c69  use nearest vali
+0001b660: 6420 696e 6465 7820 7661 6c75 650a 0a20  d index value.. 
+0001b670: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
+0001b680: 203a 206f 7074 696f 6e61 6c0a 2020 2020   : optional.    
+0001b690: 2020 2020 2020 2020 4d61 7869 6d75 6d20          Maximum 
+0001b6a0: 6469 7374 616e 6365 2062 6574 7765 656e  distance between
+0001b6b0: 206f 7269 6769 6e61 6c20 616e 6420 6e65   original and ne
+0001b6c0: 7720 6c61 6265 6c73 2066 6f72 2069 6e65  w labels for ine
+0001b6d0: 7861 6374 0a20 2020 2020 2020 2020 2020  xact.           
+0001b6e0: 206d 6174 6368 6573 2e20 5468 6520 7661   matches. The va
+0001b6f0: 6c75 6573 206f 6620 7468 6520 696e 6465  lues of the inde
+0001b700: 7820 6174 2074 6865 206d 6174 6368 696e  x at the matchin
+0001b710: 6720 6c6f 6361 7469 6f6e 7320 6d75 7374  g locations must
+0001b720: 0a20 2020 2020 2020 2020 2020 2073 6174  .            sat
+0001b730: 6973 6679 2074 6865 2065 7175 6174 696f  isfy the equatio
+0001b740: 6e20 6060 6162 7328 696e 6465 785b 696e  n ``abs(index[in
+0001b750: 6465 7865 725d 202d 2074 6172 6765 7429  dexer] - target)
+0001b760: 203c 3d20 746f 6c65 7261 6e63 6560 602e   <= tolerance``.
+0001b770: 0a20 2020 2020 2020 2020 2020 2054 6f6c  .            Tol
+0001b780: 6572 616e 6365 206d 6179 2062 6520 6120  erance may be a 
+0001b790: 7363 616c 6172 2076 616c 7565 2c20 7768  scalar value, wh
+0001b7a0: 6963 6820 6170 706c 6965 7320 7468 6520  ich applies the 
+0001b7b0: 7361 6d65 2074 6f6c 6572 616e 6365 0a20  same tolerance. 
+0001b7c0: 2020 2020 2020 2020 2020 2074 6f20 616c             to al
+0001b7d0: 6c20 7661 6c75 6573 2c20 6f72 206c 6973  l values, or lis
+0001b7e0: 742d 6c69 6b65 2c20 7768 6963 6820 6170  t-like, which ap
+0001b7f0: 706c 6965 7320 7661 7269 6162 6c65 2074  plies variable t
+0001b800: 6f6c 6572 616e 6365 2070 6572 0a20 2020  olerance per.   
+0001b810: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+0001b820: 2e20 4c69 7374 2d6c 696b 6520 6d75 7374  . List-like must
+0001b830: 2062 6520 7468 6520 7361 6d65 2073 697a   be the same siz
+0001b840: 6520 6173 2074 6865 2069 6e64 6578 2061  e as the index a
+0001b850: 6e64 2069 7473 2064 7479 7065 0a20 2020  nd its dtype.   
+0001b860: 2020 2020 2020 2020 206d 7573 7420 6578           must ex
+0001b870: 6163 746c 7920 6d61 7463 6820 7468 6520  actly match the 
+0001b880: 696e 6465 78e2 8099 7320 7479 7065 2e0a  index...s type..
+0001b890: 2020 2020 2020 2020 636f 7079 203a 2062          copy : b
+0001b8a0: 6f6f 6c2c 2064 6566 6175 6c74 3a20 5472  ool, default: Tr
+0001b8b0: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
+0001b8c0: 6620 6060 636f 7079 3d54 7275 6560 602c  f ``copy=True``,
+0001b8d0: 2064 6174 6120 696e 2074 6865 2072 6574   data in the ret
+0001b8e0: 7572 6e20 7661 6c75 6520 6973 2061 6c77  urn value is alw
+0001b8f0: 6179 7320 636f 7069 6564 2e20 4966 0a20  ays copied. If. 
+0001b900: 2020 2020 2020 2020 2020 2060 6063 6f70             ``cop
+0001b910: 793d 4661 6c73 6560 6020 616e 6420 7265  y=False`` and re
+0001b920: 696e 6465 7869 6e67 2069 7320 756e 6e65  indexing is unne
+0001b930: 6365 7373 6172 792c 206f 7220 6361 6e20  cessary, or can 
+0001b940: 6265 2070 6572 666f 726d 6564 0a20 2020  be performed.   
+0001b950: 2020 2020 2020 2020 2077 6974 6820 6f6e           with on
+0001b960: 6c79 2073 6c69 6365 206f 7065 7261 7469  ly slice operati
+0001b970: 6f6e 732c 2074 6865 6e20 7468 6520 6f75  ons, then the ou
+0001b980: 7470 7574 206d 6179 2073 6861 7265 206d  tput may share m
+0001b990: 656d 6f72 7920 7769 7468 0a20 2020 2020  emory with.     
+0001b9a0: 2020 2020 2020 2074 6865 2069 6e70 7574         the input
+0001b9b0: 2e20 496e 2065 6974 6865 7220 6361 7365  . In either case
+0001b9c0: 2c20 6120 6e65 7720 7861 7272 6179 206f  , a new xarray o
+0001b9d0: 626a 6563 7420 6973 2061 6c77 6179 7320  bject is always 
+0001b9e0: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+0001b9f0: 2020 6669 6c6c 5f76 616c 7565 203a 2073    fill_value : s
+0001ba00: 6361 6c61 7220 6f72 2064 6963 742d 6c69  calar or dict-li
+0001ba10: 6b65 2c20 6f70 7469 6f6e 616c 0a20 2020  ke, optional.   
+0001ba20: 2020 2020 2020 2020 2056 616c 7565 2074           Value t
+0001ba30: 6f20 7573 6520 666f 7220 6e65 776c 7920  o use for newly 
+0001ba40: 6d69 7373 696e 6720 7661 6c75 6573 2e20  missing values. 
+0001ba50: 4966 2061 2064 6963 742d 6c69 6b65 2c0a  If a dict-like,.
+0001ba60: 2020 2020 2020 2020 2020 2020 6d61 7073              maps
+0001ba70: 2076 6172 6961 626c 6520 6e61 6d65 7320   variable names 
+0001ba80: 2869 6e63 6c75 6469 6e67 2063 6f6f 7264  (including coord
+0001ba90: 696e 6174 6573 2920 746f 2066 696c 6c20  inates) to fill 
+0001baa0: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
+0001bab0: 7370 6172 7365 203a 2062 6f6f 6c2c 2064  sparse : bool, d
+0001bac0: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
+0001bad0: 2020 2020 2020 2020 2020 7573 6520 7370            use sp
+0001bae0: 6172 7365 2d61 7272 6179 2e0a 2020 2020  arse-array..    
+0001baf0: 2020 2020 2a2a 696e 6465 7865 7273 5f6b      **indexers_k
+0001bb00: 7761 7267 7320 3a20 7b64 696d 3a20 696e  wargs : {dim: in
+0001bb10: 6465 7865 722c 202e 2e2e 7d2c 206f 7074  dexer, ...}, opt
+0001bb20: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+0001bb30: 2020 4b65 7977 6f72 6420 6172 6775 6d65    Keyword argume
+0001bb40: 6e74 7320 696e 2074 6865 2073 616d 6520  nts in the same 
+0001bb50: 666f 726d 2061 7320 6060 696e 6465 7865  form as ``indexe
+0001bb60: 7273 6060 2e0a 2020 2020 2020 2020 2020  rs``..          
+0001bb70: 2020 4f6e 6520 6f66 2069 6e64 6578 6572    One of indexer
+0001bb80: 7320 6f72 2069 6e64 6578 6572 735f 6b77  s or indexers_kw
+0001bb90: 6172 6773 206d 7573 7420 6265 2070 726f  args must be pro
+0001bba0: 7669 6465 642e 0a0a 2020 2020 2020 2020  vided...        
+0001bbb0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+0001bbc0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0001bbd0: 7265 696e 6465 7865 6420 3a20 4461 7461  reindexed : Data
+0001bbe0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+0001bbf0: 416e 6f74 6865 7220 6461 7461 7365 742c  Another dataset,
+0001bc00: 2077 6974 6820 7468 6973 2064 6174 6173   with this datas
+0001bc10: 6574 2773 2064 6174 6120 6275 7420 7265  et's data but re
+0001bc20: 706c 6163 6564 2063 6f6f 7264 696e 6174  placed coordinat
+0001bc30: 6573 2e0a 0a20 2020 2020 2020 2053 6565  es...        See
+0001bc40: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+0001bc50: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+0001bc60: 6174 6173 6574 2e72 6569 6e64 6578 5f6c  ataset.reindex_l
+0001bc70: 696b 650a 2020 2020 2020 2020 616c 6967  ike.        alig
+0001bc80: 6e0a 2020 2020 2020 2020 7061 6e64 6173  n.        pandas
+0001bc90: 2e49 6e64 6578 2e67 6574 5f69 6e64 6578  .Index.get_index
+0001bca0: 6572 0a0a 2020 2020 2020 2020 4578 616d  er..        Exam
+0001bcb0: 706c 6573 0a20 2020 2020 2020 202d 2d2d  ples.        ---
+0001bcc0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4372  -----.        Cr
+0001bcd0: 6561 7465 2061 2064 6174 6173 6574 2077  eate a dataset w
+0001bce0: 6974 6820 736f 6d65 2066 6963 7469 6f6e  ith some fiction
+0001bcf0: 616c 2064 6174 612e 0a0a 2020 2020 2020  al data...      
+0001bd00: 2020 3e3e 3e20 7820 3d20 7872 2e44 6174    >>> x = xr.Dat
+0001bd10: 6173 6574 280a 2020 2020 2020 2020 2e2e  aset(.        ..
+0001bd20: 2e20 2020 2020 7b0a 2020 2020 2020 2020  .     {.        
+0001bd30: 2e2e 2e20 2020 2020 2020 2020 2274 656d  ...         "tem
+0001bd40: 7065 7261 7475 7265 223a 2028 2273 7461  perature": ("sta
+0001bd50: 7469 6f6e 222c 2032 3020 2a20 6e70 2e72  tion", 20 * np.r
+0001bd60: 616e 646f 6d2e 7261 6e64 2834 2929 2c0a  andom.rand(4)),.
+0001bd70: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0001bd80: 2020 2020 2270 7265 7373 7572 6522 3a20      "pressure": 
+0001bd90: 2822 7374 6174 696f 6e22 2c20 3530 3020  ("station", 500 
+0001bda0: 2a20 6e70 2e72 616e 646f 6d2e 7261 6e64  * np.random.rand
+0001bdb0: 2834 2929 2c0a 2020 2020 2020 2020 2e2e  (4)),.        ..
+0001bdc0: 2e20 2020 2020 7d2c 0a20 2020 2020 2020  .     },.       
+0001bdd0: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
+0001bde0: 7b22 7374 6174 696f 6e22 3a20 5b22 626f  {"station": ["bo
+0001bdf0: 7374 6f6e 222c 2022 6e79 6322 2c20 2273  ston", "nyc", "s
+0001be00: 6561 7474 6c65 222c 2022 6465 6e76 6572  eattle", "denver
+0001be10: 225d 7d2c 0a20 2020 2020 2020 202e 2e2e  "]},.        ...
+0001be20: 2029 0a20 2020 2020 2020 203e 3e3e 2078   ).        >>> x
+0001be30: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+0001be40: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
+0001be50: 2020 4469 6d65 6e73 696f 6e73 3a20 2020    Dimensions:   
+0001be60: 2020 2028 7374 6174 696f 6e3a 2034 290a     (station: 4).
+0001be70: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+0001be80: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
+0001be90: 2073 7461 7469 6f6e 2020 2020 2020 2873   station      (s
+0001bea0: 7461 7469 6f6e 2920 3c55 3720 2762 6f73  tation) <U7 'bos
+0001beb0: 746f 6e27 2027 6e79 6327 2027 7365 6174  ton' 'nyc' 'seat
+0001bec0: 746c 6527 2027 6465 6e76 6572 270a 2020  tle' 'denver'.  
+0001bed0: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+0001bee0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+0001bef0: 2020 7465 6d70 6572 6174 7572 6520 2028    temperature  (
+0001bf00: 7374 6174 696f 6e29 2066 6c6f 6174 3634  station) float64
+0001bf10: 2031 302e 3938 2031 342e 3320 3132 2e30   10.98 14.3 12.0
+0001bf20: 3620 3130 2e39 0a20 2020 2020 2020 2020  6 10.9.         
+0001bf30: 2020 2070 7265 7373 7572 6520 2020 2020     pressure     
+0001bf40: 2873 7461 7469 6f6e 2920 666c 6f61 7436  (station) float6
+0001bf50: 3420 3231 312e 3820 3332 322e 3920 3231  4 211.8 322.9 21
+0001bf60: 382e 3820 3434 352e 390a 2020 2020 2020  8.8 445.9.      
+0001bf70: 2020 3e3e 3e20 782e 696e 6465 7865 730a    >>> x.indexes.
+0001bf80: 2020 2020 2020 2020 496e 6465 7865 733a          Indexes:
+0001bf90: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+0001bfa0: 7469 6f6e 2020 496e 6465 7828 5b27 626f  tion  Index(['bo
+0001bfb0: 7374 6f6e 272c 2027 6e79 6327 2c20 2773  ston', 'nyc', 's
+0001bfc0: 6561 7474 6c65 272c 2027 6465 6e76 6572  eattle', 'denver
+0001bfd0: 275d 2c20 6474 7970 653d 276f 626a 6563  '], dtype='objec
+0001bfe0: 7427 2c20 6e61 6d65 3d27 7374 6174 696f  t', name='statio
+0001bff0: 6e27 290a 0a20 2020 2020 2020 2043 7265  n')..        Cre
+0001c000: 6174 6520 6120 6e65 7720 696e 6465 7820  ate a new index 
+0001c010: 616e 6420 7265 696e 6465 7820 7468 6520  and reindex the 
+0001c020: 6461 7461 7365 742e 2042 7920 6465 6661  dataset. By defa
+0001c030: 756c 7420 7661 6c75 6573 2069 6e20 7468  ult values in th
+0001c040: 6520 6e65 7720 696e 6465 7820 7468 6174  e new index that
+0001c050: 0a20 2020 2020 2020 2064 6f20 6e6f 7420  .        do not 
+0001c060: 6861 7665 2063 6f72 7265 7370 6f6e 6469  have correspondi
+0001c070: 6e67 2072 6563 6f72 6473 2069 6e20 7468  ng records in th
+0001c080: 6520 6461 7461 7365 7420 6172 6520 6173  e dataset are as
+0001c090: 7369 676e 6564 2060 4e61 4e60 2e0a 0a20  signed `NaN`... 
+0001c0a0: 2020 2020 2020 203e 3e3e 206e 6577 5f69         >>> new_i
+0001c0b0: 6e64 6578 203d 205b 2262 6f73 746f 6e22  ndex = ["boston"
+0001c0c0: 2c20 2261 7573 7469 6e22 2c20 2273 6561  , "austin", "sea
+0001c0d0: 7474 6c65 222c 2022 6c69 6e63 6f6c 6e22  ttle", "lincoln"
+0001c0e0: 5d0a 2020 2020 2020 2020 3e3e 3e20 782e  ].        >>> x.
+0001c0f0: 7265 696e 6465 7828 7b22 7374 6174 696f  reindex({"statio
+0001c100: 6e22 3a20 6e65 775f 696e 6465 787d 290a  n": new_index}).
+0001c110: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+0001c120: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+0001c130: 2044 696d 656e 7369 6f6e 733a 2020 2020   Dimensions:    
+0001c140: 2020 2873 7461 7469 6f6e 3a20 3429 0a20    (station: 4). 
+0001c150: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
+0001c160: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
+0001c170: 7374 6174 696f 6e20 2020 2020 2028 7374  station      (st
+0001c180: 6174 696f 6e29 203c 5537 2027 626f 7374  ation) <U7 'bost
+0001c190: 6f6e 2720 2761 7573 7469 6e27 2027 7365  on' 'austin' 'se
+0001c1a0: 6174 746c 6527 2027 6c69 6e63 6f6c 6e27  attle' 'lincoln'
+0001c1b0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+0001c1c0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+0001c1d0: 2020 2020 2074 656d 7065 7261 7475 7265       temperature
+0001c1e0: 2020 2873 7461 7469 6f6e 2920 666c 6f61    (station) floa
+0001c1f0: 7436 3420 3130 2e39 3820 6e61 6e20 3132  t64 10.98 nan 12
+0001c200: 2e30 3620 6e61 6e0a 2020 2020 2020 2020  .06 nan.        
+0001c210: 2020 2020 7072 6573 7375 7265 2020 2020      pressure    
+0001c220: 2028 7374 6174 696f 6e29 2066 6c6f 6174   (station) float
+0001c230: 3634 2032 3131 2e38 206e 616e 2032 3138  64 211.8 nan 218
+0001c240: 2e38 206e 616e 0a0a 2020 2020 2020 2020  .8 nan..        
+0001c250: 5765 2063 616e 2066 696c 6c20 696e 2074  We can fill in t
+0001c260: 6865 206d 6973 7369 6e67 2076 616c 7565  he missing value
+0001c270: 7320 6279 2070 6173 7369 6e67 2061 2076  s by passing a v
+0001c280: 616c 7565 2074 6f20 7468 6520 6b65 7977  alue to the keyw
+0001c290: 6f72 6420 6066 696c 6c5f 7661 6c75 6560  ord `fill_value`
+0001c2a0: 2e0a 0a20 2020 2020 2020 203e 3e3e 2078  ...        >>> x
+0001c2b0: 2e72 6569 6e64 6578 287b 2273 7461 7469  .reindex({"stati
+0001c2c0: 6f6e 223a 206e 6577 5f69 6e64 6578 7d2c  on": new_index},
+0001c2d0: 2066 696c 6c5f 7661 6c75 653d 3029 0a20   fill_value=0). 
+0001c2e0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+0001c2f0: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+0001c300: 4469 6d65 6e73 696f 6e73 3a20 2020 2020  Dimensions:     
+0001c310: 2028 7374 6174 696f 6e3a 2034 290a 2020   (station: 4).  
+0001c320: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+0001c330: 733a 0a20 2020 2020 2020 2020 202a 2073  s:.          * s
+0001c340: 7461 7469 6f6e 2020 2020 2020 2873 7461  tation      (sta
+0001c350: 7469 6f6e 2920 3c55 3720 2762 6f73 746f  tion) <U7 'bosto
+0001c360: 6e27 2027 6175 7374 696e 2720 2773 6561  n' 'austin' 'sea
+0001c370: 7474 6c65 2720 276c 696e 636f 6c6e 270a  ttle' 'lincoln'.
+0001c380: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+0001c390: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+0001c3a0: 2020 2020 7465 6d70 6572 6174 7572 6520      temperature 
+0001c3b0: 2028 7374 6174 696f 6e29 2066 6c6f 6174   (station) float
+0001c3c0: 3634 2031 302e 3938 2030 2e30 2031 322e  64 10.98 0.0 12.
+0001c3d0: 3036 2030 2e30 0a20 2020 2020 2020 2020  06 0.0.         
+0001c3e0: 2020 2070 7265 7373 7572 6520 2020 2020     pressure     
+0001c3f0: 2873 7461 7469 6f6e 2920 666c 6f61 7436  (station) float6
+0001c400: 3420 3231 312e 3820 302e 3020 3231 382e  4 211.8 0.0 218.
+0001c410: 3820 302e 300a 0a20 2020 2020 2020 2057  8 0.0..        W
+0001c420: 6520 6361 6e20 616c 736f 2075 7365 2064  e can also use d
+0001c430: 6966 6665 7265 6e74 2066 696c 6c20 7661  ifferent fill va
+0001c440: 6c75 6573 2066 6f72 2065 6163 6820 7661  lues for each va
+0001c450: 7269 6162 6c65 2e0a 0a20 2020 2020 2020  riable...       
+0001c460: 203e 3e3e 2078 2e72 6569 6e64 6578 280a   >>> x.reindex(.
+0001c470: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0001c480: 7b22 7374 6174 696f 6e22 3a20 6e65 775f  {"station": new_
+0001c490: 696e 6465 787d 2c20 6669 6c6c 5f76 616c  index}, fill_val
+0001c4a0: 7565 3d7b 2274 656d 7065 7261 7475 7265  ue={"temperature
+0001c4b0: 223a 2030 2c20 2270 7265 7373 7572 6522  ": 0, "pressure"
+0001c4c0: 3a20 3130 307d 0a20 2020 2020 2020 202e  : 100}.        .
+0001c4d0: 2e2e 2029 0a20 2020 2020 2020 203c 7861  .. ).        <xa
+0001c4e0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+0001c4f0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+0001c500: 3a20 2020 2020 2028 7374 6174 696f 6e3a  :      (station:
+0001c510: 2034 290a 2020 2020 2020 2020 436f 6f72   4).        Coor
+0001c520: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
+0001c530: 2020 202a 2073 7461 7469 6f6e 2020 2020     * station    
+0001c540: 2020 2873 7461 7469 6f6e 2920 3c55 3720    (station) <U7 
+0001c550: 2762 6f73 746f 6e27 2027 6175 7374 696e  'boston' 'austin
+0001c560: 2720 2773 6561 7474 6c65 2720 276c 696e  ' 'seattle' 'lin
+0001c570: 636f 6c6e 270a 2020 2020 2020 2020 4461  coln'.        Da
+0001c580: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+0001c590: 2020 2020 2020 2020 2020 7465 6d70 6572            temper
+0001c5a0: 6174 7572 6520 2028 7374 6174 696f 6e29  ature  (station)
+0001c5b0: 2066 6c6f 6174 3634 2031 302e 3938 2030   float64 10.98 0
+0001c5c0: 2e30 2031 322e 3036 2030 2e30 0a20 2020  .0 12.06 0.0.   
+0001c5d0: 2020 2020 2020 2020 2070 7265 7373 7572           pressur
+0001c5e0: 6520 2020 2020 2873 7461 7469 6f6e 2920  e     (station) 
+0001c5f0: 666c 6f61 7436 3420 3231 312e 3820 3130  float64 211.8 10
+0001c600: 302e 3020 3231 382e 3820 3130 302e 300a  0.0 218.8 100.0.
+0001c610: 0a20 2020 2020 2020 2042 6563 6175 7365  .        Because
+0001c620: 2074 6865 2069 6e64 6578 2069 7320 6e6f   the index is no
+0001c630: 7420 6d6f 6e6f 746f 6e69 6361 6c6c 7920  t monotonically 
+0001c640: 696e 6372 6561 7369 6e67 206f 7220 6465  increasing or de
+0001c650: 6372 6561 7369 6e67 2c20 7765 2063 616e  creasing, we can
+0001c660: 6e6f 7420 7573 6520 6172 6775 6d65 6e74  not use argument
+0001c670: 730a 2020 2020 2020 2020 746f 2074 6865  s.        to the
+0001c680: 206b 6579 776f 7264 206d 6574 686f 6420   keyword method 
+0001c690: 746f 2066 696c 6c20 7468 6520 604e 614e  to fill the `NaN
+0001c6a0: 6020 7661 6c75 6573 2e0a 0a20 2020 2020  ` values...     
+0001c6b0: 2020 203e 3e3e 2078 2e72 6569 6e64 6578     >>> x.reindex
+0001c6c0: 287b 2273 7461 7469 6f6e 223a 206e 6577  ({"station": new
+0001c6d0: 5f69 6e64 6578 7d2c 206d 6574 686f 643d  _index}, method=
+0001c6e0: 226e 6561 7265 7374 2229 0a20 2020 2020  "nearest").     
+0001c6f0: 2020 2054 7261 6365 6261 636b 2028 6d6f     Traceback (mo
+0001c700: 7374 2072 6563 656e 7420 6361 6c6c 206c  st recent call l
+0001c710: 6173 7429 3a0a 2020 2020 2020 2020 2e2e  ast):.        ..
+0001c720: 2e0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0001c730: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+0001c740: 696e 6465 7820 6d75 7374 2062 6520 6d6f  index must be mo
+0001c750: 6e6f 746f 6e69 6320 696e 6372 6561 7369  notonic increasi
+0001c760: 6e67 206f 7220 6465 6372 6561 7369 6e67  ng or decreasing
+0001c770: 2729 0a20 2020 2020 2020 2056 616c 7565  ').        Value
+0001c780: 4572 726f 723a 2069 6e64 6578 206d 7573  Error: index mus
+0001c790: 7420 6265 206d 6f6e 6f74 6f6e 6963 2069  t be monotonic i
+0001c7a0: 6e63 7265 6173 696e 6720 6f72 2064 6563  ncreasing or dec
+0001c7b0: 7265 6173 696e 670a 0a20 2020 2020 2020  reasing..       
+0001c7c0: 2054 6f20 6675 7274 6865 7220 696c 6c75   To further illu
+0001c7d0: 7374 7261 7465 2074 6865 2066 696c 6c69  strate the filli
+0001c7e0: 6e67 2066 756e 6374 696f 6e61 6c69 7479  ng functionality
+0001c7f0: 2069 6e20 7265 696e 6465 782c 2077 6520   in reindex, we 
+0001c800: 7769 6c6c 2063 7265 6174 6520 610a 2020  will create a.  
+0001c810: 2020 2020 2020 6461 7461 7365 7420 7769        dataset wi
+0001c820: 7468 2061 206d 6f6e 6f74 6f6e 6963 616c  th a monotonical
+0001c830: 6c79 2069 6e63 7265 6173 696e 6720 696e  ly increasing in
+0001c840: 6465 7820 2866 6f72 2065 7861 6d70 6c65  dex (for example
+0001c850: 2c20 6120 7365 7175 656e 6365 206f 6620  , a sequence of 
+0001c860: 6461 7465 7329 2e0a 0a20 2020 2020 2020  dates)...       
+0001c870: 203e 3e3e 2078 3220 3d20 7872 2e44 6174   >>> x2 = xr.Dat
+0001c880: 6173 6574 280a 2020 2020 2020 2020 2e2e  aset(.        ..
+0001c890: 2e20 2020 2020 7b0a 2020 2020 2020 2020  .     {.        
+0001c8a0: 2e2e 2e20 2020 2020 2020 2020 2274 656d  ...         "tem
+0001c8b0: 7065 7261 7475 7265 223a 2028 0a20 2020  perature": (.   
+0001c8c0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+0001c8d0: 2020 2020 2022 7469 6d65 222c 0a20 2020       "time",.   
+0001c8e0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+0001c8f0: 2020 2020 205b 3135 2e35 372c 2031 322e       [15.57, 12.
+0001c900: 3737 2c20 6e70 2e6e 616e 2c20 302e 3330  77, np.nan, 0.30
+0001c910: 3831 2c20 3136 2e35 392c 2031 352e 3132  81, 16.59, 15.12
+0001c920: 5d2c 0a20 2020 2020 2020 202e 2e2e 2020  ],.        ...  
+0001c930: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+0001c940: 2020 2e2e 2e20 2020 2020 2020 2020 2270    ...         "p
+0001c950: 7265 7373 7572 6522 3a20 2822 7469 6d65  ressure": ("time
+0001c960: 222c 2035 3030 202a 206e 702e 7261 6e64  ", 500 * np.rand
+0001c970: 6f6d 2e72 616e 6428 3629 292c 0a20 2020  om.rand(6)),.   
+0001c980: 2020 2020 202e 2e2e 2020 2020 207d 2c0a       ...     },.
+0001c990: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0001c9a0: 636f 6f72 6473 3d7b 2274 696d 6522 3a20  coords={"time": 
+0001c9b0: 7064 2e64 6174 655f 7261 6e67 6528 2230  pd.date_range("0
+0001c9c0: 312f 3031 2f32 3031 3922 2c20 7065 7269  1/01/2019", peri
+0001c9d0: 6f64 733d 362c 2066 7265 713d 2244 2229  ods=6, freq="D")
+0001c9e0: 7d2c 0a20 2020 2020 2020 202e 2e2e 2029  },.        ... )
+0001c9f0: 0a20 2020 2020 2020 203e 3e3e 2078 320a  .        >>> x2.
+0001ca00: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+0001ca10: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+0001ca20: 2044 696d 656e 7369 6f6e 733a 2020 2020   Dimensions:    
+0001ca30: 2020 2874 696d 653a 2036 290a 2020 2020    (time: 6).    
+0001ca40: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+0001ca50: 0a20 2020 2020 2020 2020 202a 2074 696d  .          * tim
+0001ca60: 6520 2020 2020 2020 2020 2874 696d 6529  e         (time)
+0001ca70: 2064 6174 6574 696d 6536 345b 6e73 5d20   datetime64[ns] 
+0001ca80: 3230 3139 2d30 312d 3031 2032 3031 392d  2019-01-01 2019-
+0001ca90: 3031 2d30 3220 2e2e 2e20 3230 3139 2d30  01-02 ... 2019-0
+0001caa0: 312d 3036 0a20 2020 2020 2020 2044 6174  1-06.        Dat
+0001cab0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+0001cac0: 2020 2020 2020 2020 2074 656d 7065 7261           tempera
+0001cad0: 7475 7265 2020 2874 696d 6529 2066 6c6f  ture  (time) flo
+0001cae0: 6174 3634 2031 352e 3537 2031 322e 3737  at64 15.57 12.77
+0001caf0: 206e 616e 2030 2e33 3038 3120 3136 2e35   nan 0.3081 16.5
+0001cb00: 3920 3135 2e31 320a 2020 2020 2020 2020  9 15.12.        
+0001cb10: 2020 2020 7072 6573 7375 7265 2020 2020      pressure    
+0001cb20: 2028 7469 6d65 2920 666c 6f61 7436 3420   (time) float64 
+0001cb30: 3438 312e 3820 3139 312e 3720 3339 352e  481.8 191.7 395.
+0001cb40: 3920 3236 342e 3420 3238 342e 3020 3436  9 264.4 284.0 46
+0001cb50: 322e 380a 0a20 2020 2020 2020 2053 7570  2.8..        Sup
+0001cb60: 706f 7365 2077 6520 6465 6369 6465 2074  pose we decide t
+0001cb70: 6f20 6578 7061 6e64 2074 6865 2064 6174  o expand the dat
+0001cb80: 6173 6574 2074 6f20 636f 7665 7220 6120  aset to cover a 
+0001cb90: 7769 6465 7220 6461 7465 2072 616e 6765  wider date range
+0001cba0: 2e0a 0a20 2020 2020 2020 203e 3e3e 2074  ...        >>> t
+0001cbb0: 696d 655f 696e 6465 7832 203d 2070 642e  ime_index2 = pd.
+0001cbc0: 6461 7465 5f72 616e 6765 2822 3132 2f32  date_range("12/2
+0001cbd0: 392f 3230 3138 222c 2070 6572 696f 6473  9/2018", periods
+0001cbe0: 3d31 302c 2066 7265 713d 2244 2229 0a20  =10, freq="D"). 
+0001cbf0: 2020 2020 2020 203e 3e3e 2078 322e 7265         >>> x2.re
+0001cc00: 696e 6465 7828 7b22 7469 6d65 223a 2074  index({"time": t
+0001cc10: 696d 655f 696e 6465 7832 7d29 0a20 2020  ime_index2}).   
+0001cc20: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+0001cc30: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+0001cc40: 6d65 6e73 696f 6e73 3a20 2020 2020 2028  mensions:      (
+0001cc50: 7469 6d65 3a20 3130 290a 2020 2020 2020  time: 10).      
+0001cc60: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0001cc70: 2020 2020 2020 2020 202a 2074 696d 6520           * time 
+0001cc80: 2020 2020 2020 2020 2874 696d 6529 2064          (time) d
+0001cc90: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
+0001cca0: 3138 2d31 322d 3239 2032 3031 382d 3132  18-12-29 2018-12
+0001ccb0: 2d33 3020 2e2e 2e20 3230 3139 2d30 312d  -30 ... 2019-01-
+0001ccc0: 3037 0a20 2020 2020 2020 2044 6174 6120  07.        Data 
+0001ccd0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+0001cce0: 2020 2020 2020 2074 656d 7065 7261 7475         temperatu
+0001ccf0: 7265 2020 2874 696d 6529 2066 6c6f 6174  re  (time) float
+0001cd00: 3634 206e 616e 206e 616e 206e 616e 2031  64 nan nan nan 1
+0001cd10: 352e 3537 202e 2e2e 2030 2e33 3038 3120  5.57 ... 0.3081 
+0001cd20: 3136 2e35 3920 3135 2e31 3220 6e61 6e0a  16.59 15.12 nan.
+0001cd30: 2020 2020 2020 2020 2020 2020 7072 6573              pres
+0001cd40: 7375 7265 2020 2020 2028 7469 6d65 2920  sure     (time) 
+0001cd50: 666c 6f61 7436 3420 6e61 6e20 6e61 6e20  float64 nan nan 
+0001cd60: 6e61 6e20 3438 312e 3820 2e2e 2e20 3236  nan 481.8 ... 26
+0001cd70: 342e 3420 3238 342e 3020 3436 322e 3820  4.4 284.0 462.8 
+0001cd80: 6e61 6e0a 0a20 2020 2020 2020 2054 6865  nan..        The
+0001cd90: 2069 6e64 6578 2065 6e74 7269 6573 2074   index entries t
+0001cda0: 6861 7420 6469 6420 6e6f 7420 6861 7665  hat did not have
+0001cdb0: 2061 2076 616c 7565 2069 6e20 7468 6520   a value in the 
+0001cdc0: 6f72 6967 696e 616c 2064 6174 6120 6672  original data fr
+0001cdd0: 616d 6520 2866 6f72 2065 7861 6d70 6c65  ame (for example
+0001cde0: 2c20 6032 3031 382d 3132 2d32 3960 290a  , `2018-12-29`).
+0001cdf0: 2020 2020 2020 2020 6172 6520 6279 2064          are by d
+0001ce00: 6566 6175 6c74 2066 696c 6c65 6420 7769  efault filled wi
+0001ce10: 7468 204e 614e 2e20 4966 2064 6573 6972  th NaN. If desir
+0001ce20: 6564 2c20 7765 2063 616e 2066 696c 6c20  ed, we can fill 
+0001ce30: 696e 2074 6865 206d 6973 7369 6e67 2076  in the missing v
+0001ce40: 616c 7565 7320 7573 696e 6720 6f6e 6520  alues using one 
+0001ce50: 6f66 2073 6576 6572 616c 206f 7074 696f  of several optio
+0001ce60: 6e73 2e0a 0a20 2020 2020 2020 2046 6f72  ns...        For
+0001ce70: 2065 7861 6d70 6c65 2c20 746f 2062 6163   example, to bac
+0001ce80: 6b2d 7072 6f70 6167 6174 6520 7468 6520  k-propagate the 
+0001ce90: 6c61 7374 2076 616c 6964 2076 616c 7565  last valid value
+0001cea0: 2074 6f20 6669 6c6c 2074 6865 2060 4e61   to fill the `Na
+0001ceb0: 4e60 2076 616c 7565 732c 0a20 2020 2020  N` values,.     
+0001cec0: 2020 2070 6173 7320 6062 6669 6c6c 6020     pass `bfill` 
+0001ced0: 6173 2061 6e20 6172 6775 6d65 6e74 2074  as an argument t
+0001cee0: 6f20 7468 6520 606d 6574 686f 6460 206b  o the `method` k
+0001cef0: 6579 776f 7264 2e0a 0a20 2020 2020 2020  eyword...       
+0001cf00: 203e 3e3e 2078 3320 3d20 7832 2e72 6569   >>> x3 = x2.rei
+0001cf10: 6e64 6578 287b 2274 696d 6522 3a20 7469  ndex({"time": ti
+0001cf20: 6d65 5f69 6e64 6578 327d 2c20 6d65 7468  me_index2}, meth
+0001cf30: 6f64 3d22 6266 696c 6c22 290a 2020 2020  od="bfill").    
+0001cf40: 2020 2020 3e3e 3e20 7833 0a20 2020 2020      >>> x3.     
+0001cf50: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+0001cf60: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+0001cf70: 6e73 696f 6e73 3a20 2020 2020 2028 7469  nsions:      (ti
+0001cf80: 6d65 3a20 3130 290a 2020 2020 2020 2020  me: 10).        
+0001cf90: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+0001cfa0: 2020 2020 2020 202a 2074 696d 6520 2020         * time   
+0001cfb0: 2020 2020 2020 2874 696d 6529 2064 6174        (time) dat
+0001cfc0: 6574 696d 6536 345b 6e73 5d20 3230 3138  etime64[ns] 2018
+0001cfd0: 2d31 322d 3239 2032 3031 382d 3132 2d33  -12-29 2018-12-3
+0001cfe0: 3020 2e2e 2e20 3230 3139 2d30 312d 3037  0 ... 2019-01-07
+0001cff0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+0001d000: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+0001d010: 2020 2020 2074 656d 7065 7261 7475 7265       temperature
+0001d020: 2020 2874 696d 6529 2066 6c6f 6174 3634    (time) float64
+0001d030: 2031 352e 3537 2031 352e 3537 2031 352e   15.57 15.57 15.
+0001d040: 3537 2031 352e 3537 202e 2e2e 2031 362e  57 15.57 ... 16.
+0001d050: 3539 2031 352e 3132 206e 616e 0a20 2020  59 15.12 nan.   
+0001d060: 2020 2020 2020 2020 2070 7265 7373 7572           pressur
+0001d070: 6520 2020 2020 2874 696d 6529 2066 6c6f  e     (time) flo
+0001d080: 6174 3634 2034 3831 2e38 2034 3831 2e38  at64 481.8 481.8
+0001d090: 2034 3831 2e38 2034 3831 2e38 202e 2e2e   481.8 481.8 ...
+0001d0a0: 2032 3834 2e30 2034 3632 2e38 206e 616e   284.0 462.8 nan
+0001d0b0: 0a0a 2020 2020 2020 2020 506c 6561 7365  ..        Please
+0001d0c0: 206e 6f74 6520 7468 6174 2074 6865 2060   note that the `
+0001d0d0: 4e61 4e60 2076 616c 7565 2070 7265 7365  NaN` value prese
+0001d0e0: 6e74 2069 6e20 7468 6520 6f72 6967 696e  nt in the origin
+0001d0f0: 616c 2064 6174 6173 6574 2028 6174 2069  al dataset (at i
+0001d100: 6e64 6578 2076 616c 7565 2060 3230 3139  ndex value `2019
+0001d110: 2d30 312d 3033 6029 0a20 2020 2020 2020  -01-03`).       
+0001d120: 2077 696c 6c20 6e6f 7420 6265 2066 696c   will not be fil
+0001d130: 6c65 6420 6279 2061 6e79 206f 6620 7468  led by any of th
+0001d140: 6520 7661 6c75 6520 7072 6f70 6167 6174  e value propagat
+0001d150: 696f 6e20 7363 6865 6d65 732e 0a0a 2020  ion schemes...  
+0001d160: 2020 2020 2020 3e3e 3e20 7832 2e77 6865        >>> x2.whe
+0001d170: 7265 2878 322e 7465 6d70 6572 6174 7572  re(x2.temperatur
+0001d180: 652e 6973 6e75 6c6c 2829 2c20 6472 6f70  e.isnull(), drop
+0001d190: 3d54 7275 6529 0a20 2020 2020 2020 203c  =True).        <
+0001d1a0: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+0001d1b0: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+0001d1c0: 6e73 3a20 2020 2020 2028 7469 6d65 3a20  ns:      (time: 
+0001d1d0: 3129 0a20 2020 2020 2020 2043 6f6f 7264  1).        Coord
+0001d1e0: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
+0001d1f0: 2020 2a20 7469 6d65 2020 2020 2020 2020    * time        
+0001d200: 2028 7469 6d65 2920 6461 7465 7469 6d65   (time) datetime
+0001d210: 3634 5b6e 735d 2032 3031 392d 3031 2d30  64[ns] 2019-01-0
+0001d220: 330a 2020 2020 2020 2020 4461 7461 2076  3.        Data v
+0001d230: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+0001d240: 2020 2020 2020 7465 6d70 6572 6174 7572        temperatur
+0001d250: 6520 2028 7469 6d65 2920 666c 6f61 7436  e  (time) float6
+0001d260: 3420 6e61 6e0a 2020 2020 2020 2020 2020  4 nan.          
+0001d270: 2020 7072 6573 7375 7265 2020 2020 2028    pressure     (
+0001d280: 7469 6d65 2920 666c 6f61 7436 3420 3339  time) float64 39
+0001d290: 352e 390a 2020 2020 2020 2020 3e3e 3e20  5.9.        >>> 
+0001d2a0: 7833 2e77 6865 7265 2878 332e 7465 6d70  x3.where(x3.temp
+0001d2b0: 6572 6174 7572 652e 6973 6e75 6c6c 2829  erature.isnull()
+0001d2c0: 2c20 6472 6f70 3d54 7275 6529 0a20 2020  , drop=True).   
+0001d2d0: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+0001d2e0: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+0001d2f0: 6d65 6e73 696f 6e73 3a20 2020 2020 2028  mensions:      (
+0001d300: 7469 6d65 3a20 3229 0a20 2020 2020 2020  time: 2).       
+0001d310: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+0001d320: 2020 2020 2020 2020 2a20 7469 6d65 2020          * time  
+0001d330: 2020 2020 2020 2028 7469 6d65 2920 6461         (time) da
+0001d340: 7465 7469 6d65 3634 5b6e 735d 2032 3031  tetime64[ns] 201
+0001d350: 392d 3031 2d30 3320 3230 3139 2d30 312d  9-01-03 2019-01-
+0001d360: 3037 0a20 2020 2020 2020 2044 6174 6120  07.        Data 
+0001d370: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+0001d380: 2020 2020 2020 2074 656d 7065 7261 7475         temperatu
+0001d390: 7265 2020 2874 696d 6529 2066 6c6f 6174  re  (time) float
+0001d3a0: 3634 206e 616e 206e 616e 0a20 2020 2020  64 nan nan.     
+0001d3b0: 2020 2020 2020 2070 7265 7373 7572 6520         pressure 
+0001d3c0: 2020 2020 2874 696d 6529 2066 6c6f 6174      (time) float
+0001d3d0: 3634 2033 3935 2e39 206e 616e 0a0a 2020  64 395.9 nan..  
+0001d3e0: 2020 2020 2020 5468 6973 2069 7320 6265        This is be
+0001d3f0: 6361 7573 6520 6669 6c6c 696e 6720 7768  cause filling wh
+0001d400: 696c 6520 7265 696e 6465 7869 6e67 2064  ile reindexing d
+0001d410: 6f65 7320 6e6f 7420 6c6f 6f6b 2061 7420  oes not look at 
+0001d420: 6461 7461 7365 7420 7661 6c75 6573 2c20  dataset values, 
+0001d430: 6275 7420 6f6e 6c79 2063 6f6d 7061 7265  but only compare
+0001d440: 730a 2020 2020 2020 2020 7468 6520 6f72  s.        the or
+0001d450: 6967 696e 616c 2061 6e64 2064 6573 6972  iginal and desir
+0001d460: 6564 2069 6e64 6578 6573 2e20 4966 2079  ed indexes. If y
+0001d470: 6f75 2064 6f20 7761 6e74 2074 6f20 6669  ou do want to fi
+0001d480: 6c6c 2069 6e20 7468 6520 604e 614e 6020  ll in the `NaN` 
+0001d490: 7661 6c75 6573 2070 7265 7365 6e74 2069  values present i
+0001d4a0: 6e20 7468 650a 2020 2020 2020 2020 6f72  n the.        or
+0001d4b0: 6967 696e 616c 2064 6174 6173 6574 2c20  iginal dataset, 
+0001d4c0: 7573 6520 7468 6520 3a70 793a 6d65 7468  use the :py:meth
+0001d4d0: 3a60 7e44 6174 6173 6574 2e66 696c 6c6e  :`~Dataset.filln
+0001d4e0: 6128 2960 206d 6574 686f 642e 0a0a 2020  a()` method...  
+0001d4f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d500: 2020 696e 6465 7865 7273 203d 2075 7469    indexers = uti
+0001d510: 6c73 2e65 6974 6865 725f 6469 6374 5f6f  ls.either_dict_o
+0001d520: 725f 6b77 6172 6773 2869 6e64 6578 6572  r_kwargs(indexer
+0001d530: 732c 2069 6e64 6578 6572 735f 6b77 6172  s, indexers_kwar
+0001d540: 6773 2c20 2272 6569 6e64 6578 2229 0a20  gs, "reindex"). 
+0001d550: 2020 2020 2020 2072 6574 7572 6e20 616c         return al
+0001d560: 6967 6e6d 656e 742e 7265 696e 6465 7828  ignment.reindex(
+0001d570: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001d580: 662c 0a20 2020 2020 2020 2020 2020 2069  f,.            i
+0001d590: 6e64 6578 6572 733d 696e 6465 7865 7273  ndexers=indexers
+0001d5a0: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
+0001d5b0: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+0001d5c0: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
+0001d5d0: 6365 3d74 6f6c 6572 616e 6365 2c0a 2020  ce=tolerance,.  
+0001d5e0: 2020 2020 2020 2020 2020 636f 7079 3d63            copy=c
+0001d5f0: 6f70 792c 0a20 2020 2020 2020 2020 2020  opy,.           
+0001d600: 2066 696c 6c5f 7661 6c75 653d 6669 6c6c   fill_value=fill
+0001d610: 5f76 616c 7565 2c0a 2020 2020 2020 2020  _value,.        
+0001d620: 290a 0a20 2020 2064 6566 205f 7265 696e  )..    def _rein
+0001d630: 6465 7828 0a20 2020 2020 2020 2073 656c  dex(.        sel
+0001d640: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
+0001d650: 2020 2020 2020 696e 6465 7865 7273 3a20        indexers: 
+0001d660: 4d61 7070 696e 675b 416e 792c 2041 6e79  Mapping[Any, Any
+0001d670: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+0001d680: 0a20 2020 2020 2020 206d 6574 686f 643a  .        method:
+0001d690: 2073 7472 207c 204e 6f6e 6520 3d20 4e6f   str | None = No
+0001d6a0: 6e65 2c0a 2020 2020 2020 2020 746f 6c65  ne,.        tole
+0001d6b0: 7261 6e63 653a 2069 6e74 207c 2066 6c6f  rance: int | flo
+0001d6c0: 6174 207c 2049 7465 7261 626c 655b 696e  at | Iterable[in
+0001d6d0: 7420 7c20 666c 6f61 745d 207c 204e 6f6e  t | float] | Non
+0001d6e0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0001d6f0: 2020 636f 7079 3a20 626f 6f6c 203d 2054    copy: bool = T
+0001d700: 7275 652c 0a20 2020 2020 2020 2066 696c  rue,.        fil
+0001d710: 6c5f 7661 6c75 653a 2041 6e79 203d 2078  l_value: Any = x
+0001d720: 7264 7479 7065 732e 4e41 2c0a 2020 2020  rdtypes.NA,.    
+0001d730: 2020 2020 7370 6172 7365 3a20 626f 6f6c      sparse: bool
+0001d740: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0001d750: 2020 2a2a 696e 6465 7865 7273 5f6b 7761    **indexers_kwa
+0001d760: 7267 733a 2041 6e79 2c0a 2020 2020 2920  rgs: Any,.    ) 
+0001d770: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+0001d780: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d790: 2020 5361 6d65 2061 7320 7265 696e 6465    Same as reinde
+0001d7a0: 7820 6275 7420 7375 7070 6f72 7473 2073  x but supports s
+0001d7b0: 7061 7273 6520 6f70 7469 6f6e 2e0a 2020  parse option..  
+0001d7c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d7d0: 2020 696e 6465 7865 7273 203d 2075 7469    indexers = uti
+0001d7e0: 6c73 2e65 6974 6865 725f 6469 6374 5f6f  ls.either_dict_o
+0001d7f0: 725f 6b77 6172 6773 2869 6e64 6578 6572  r_kwargs(indexer
+0001d800: 732c 2069 6e64 6578 6572 735f 6b77 6172  s, indexers_kwar
+0001d810: 6773 2c20 2272 6569 6e64 6578 2229 0a20  gs, "reindex"). 
+0001d820: 2020 2020 2020 2072 6574 7572 6e20 616c         return al
+0001d830: 6967 6e6d 656e 742e 7265 696e 6465 7828  ignment.reindex(
+0001d840: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001d850: 662c 0a20 2020 2020 2020 2020 2020 2069  f,.            i
+0001d860: 6e64 6578 6572 733d 696e 6465 7865 7273  ndexers=indexers
+0001d870: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
+0001d880: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
+0001d890: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
+0001d8a0: 6365 3d74 6f6c 6572 616e 6365 2c0a 2020  ce=tolerance,.  
+0001d8b0: 2020 2020 2020 2020 2020 636f 7079 3d63            copy=c
+0001d8c0: 6f70 792c 0a20 2020 2020 2020 2020 2020  opy,.           
+0001d8d0: 2066 696c 6c5f 7661 6c75 653d 6669 6c6c   fill_value=fill
+0001d8e0: 5f76 616c 7565 2c0a 2020 2020 2020 2020  _value,.        
+0001d8f0: 2020 2020 7370 6172 7365 3d73 7061 7273      sparse=spars
+0001d900: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+0001d910: 2020 6465 6620 696e 7465 7270 280a 2020    def interp(.  
+0001d920: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+0001d930: 7461 7365 742c 0a20 2020 2020 2020 2063  taset,.        c
+0001d940: 6f6f 7264 733a 204d 6170 7069 6e67 5b41  oords: Mapping[A
+0001d950: 6e79 2c20 416e 795d 207c 204e 6f6e 6520  ny, Any] | None 
+0001d960: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001d970: 6d65 7468 6f64 3a20 496e 7465 7270 4f70  method: InterpOp
+0001d980: 7469 6f6e 7320 3d20 226c 696e 6561 7222  tions = "linear"
+0001d990: 2c0a 2020 2020 2020 2020 6173 7375 6d65  ,.        assume
+0001d9a0: 5f73 6f72 7465 643a 2062 6f6f 6c20 3d20  _sorted: bool = 
+0001d9b0: 4661 6c73 652c 0a20 2020 2020 2020 206b  False,.        k
+0001d9c0: 7761 7267 733a 204d 6170 7069 6e67 5b73  wargs: Mapping[s
+0001d9d0: 7472 2c20 416e 795d 207c 204e 6f6e 6520  tr, Any] | None 
+0001d9e0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001d9f0: 6d65 7468 6f64 5f6e 6f6e 5f6e 756d 6572  method_non_numer
+0001da00: 6963 3a20 7374 7220 3d20 226e 6561 7265  ic: str = "neare
+0001da10: 7374 222c 0a20 2020 2020 2020 202a 2a63  st",.        **c
+0001da20: 6f6f 7264 735f 6b77 6172 6773 3a20 416e  oords_kwargs: An
+0001da30: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
+0001da40: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+0001da50: 2222 496e 7465 7270 6f6c 6174 6520 6120  ""Interpolate a 
+0001da60: 4461 7461 7365 7420 6f6e 746f 206e 6577  Dataset onto new
+0001da70: 2063 6f6f 7264 696e 6174 6573 0a0a 2020   coordinates..  
+0001da80: 2020 2020 2020 5065 7266 6f72 6d73 2075        Performs u
+0001da90: 6e69 7661 7269 6174 6520 6f72 206d 756c  nivariate or mul
+0001daa0: 7469 7661 7269 6174 6520 696e 7465 7270  tivariate interp
+0001dab0: 6f6c 6174 696f 6e20 6f66 2061 2044 6174  olation of a Dat
+0001dac0: 6173 6574 206f 6e74 6f0a 2020 2020 2020  aset onto.      
+0001dad0: 2020 6e65 7720 636f 6f72 6469 6e61 7465    new coordinate
+0001dae0: 7320 7573 696e 6720 7363 6970 7927 7320  s using scipy's 
+0001daf0: 696e 7465 7270 6f6c 6174 696f 6e20 726f  interpolation ro
+0001db00: 7574 696e 6573 2e20 4966 2069 6e74 6572  utines. If inter
+0001db10: 706f 6c61 7469 6e67 0a20 2020 2020 2020  polating.       
+0001db20: 2061 6c6f 6e67 2061 6e20 6578 6973 7469   along an existi
+0001db30: 6e67 2064 696d 656e 7369 6f6e 2c20 3a70  ng dimension, :p
+0001db40: 793a 636c 6173 733a 6073 6369 7079 2e69  y:class:`scipy.i
+0001db50: 6e74 6572 706f 6c61 7465 2e69 6e74 6572  nterpolate.inter
+0001db60: 7031 6460 2069 730a 2020 2020 2020 2020  p1d` is.        
+0001db70: 6361 6c6c 6564 2e20 2057 6865 6e20 696e  called.  When in
+0001db80: 7465 7270 6f6c 6174 696e 6720 616c 6f6e  terpolating alon
+0001db90: 6720 6d75 6c74 6970 6c65 2065 7869 7374  g multiple exist
+0001dba0: 696e 6720 6469 6d65 6e73 696f 6e73 2c20  ing dimensions, 
+0001dbb0: 616e 0a20 2020 2020 2020 2061 7474 656d  an.        attem
+0001dbc0: 7074 2069 7320 6d61 6465 2074 6f20 6465  pt is made to de
+0001dbd0: 636f 6d70 6f73 6520 7468 6520 696e 7465  compose the inte
+0001dbe0: 7270 6f6c 6174 696f 6e20 696e 746f 206d  rpolation into m
+0001dbf0: 756c 7469 706c 650a 2020 2020 2020 2020  ultiple.        
+0001dc00: 312d 6469 6d65 6e73 696f 6e61 6c20 696e  1-dimensional in
+0001dc10: 7465 7270 6f6c 6174 696f 6e73 2e20 4966  terpolations. If
+0001dc20: 2074 6869 7320 6973 2070 6f73 7369 626c   this is possibl
+0001dc30: 652c 0a20 2020 2020 2020 203a 7079 3a63  e,.        :py:c
+0001dc40: 6c61 7373 3a60 7363 6970 792e 696e 7465  lass:`scipy.inte
+0001dc50: 7270 6f6c 6174 652e 696e 7465 7270 3164  rpolate.interp1d
+0001dc60: 6020 6973 2063 616c 6c65 642e 204f 7468  ` is called. Oth
+0001dc70: 6572 7769 7365 2c0a 2020 2020 2020 2020  erwise,.        
+0001dc80: 3a70 793a 6675 6e63 3a60 7363 6970 792e  :py:func:`scipy.
+0001dc90: 696e 7465 7270 6f6c 6174 652e 696e 7465  interpolate.inte
+0001dca0: 7270 6e60 2069 7320 6361 6c6c 6564 2e0a  rpn` is called..
+0001dcb0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0001dcc0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+0001dcd0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2063  ------.        c
+0001dce0: 6f6f 7264 7320 3a20 6469 6374 2c20 6f70  oords : dict, op
+0001dcf0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0001dd00: 2020 204d 6170 7069 6e67 2066 726f 6d20     Mapping from 
+0001dd10: 6469 6d65 6e73 696f 6e20 6e61 6d65 7320  dimension names 
+0001dd20: 746f 2074 6865 206e 6577 2063 6f6f 7264  to the new coord
+0001dd30: 696e 6174 6573 2e0a 2020 2020 2020 2020  inates..        
+0001dd40: 2020 2020 4e65 7720 636f 6f72 6469 6e61      New coordina
+0001dd50: 7465 2063 616e 2062 6520 6120 7363 616c  te can be a scal
+0001dd60: 6172 2c20 6172 7261 792d 6c69 6b65 206f  ar, array-like o
+0001dd70: 7220 4461 7461 4172 7261 792e 0a20 2020  r DataArray..   
+0001dd80: 2020 2020 2020 2020 2049 6620 4461 7461           If Data
+0001dd90: 4172 7261 7973 2061 7265 2070 6173 7365  Arrays are passe
+0001dda0: 6420 6173 206e 6577 2063 6f6f 7264 696e  d as new coordin
+0001ddb0: 6174 6573 2c20 7468 6569 7220 6469 6d65  ates, their dime
+0001ddc0: 6e73 696f 6e73 2061 7265 0a20 2020 2020  nsions are.     
+0001ddd0: 2020 2020 2020 2075 7365 6420 666f 7220         used for 
+0001dde0: 7468 6520 6272 6f61 6463 6173 7469 6e67  the broadcasting
+0001ddf0: 2e20 4d69 7373 696e 6720 7661 6c75 6573  . Missing values
+0001de00: 2061 7265 2073 6b69 7070 6564 2e0a 2020   are skipped..  
+0001de10: 2020 2020 2020 6d65 7468 6f64 203a 207b        method : {
+0001de20: 226c 696e 6561 7222 2c20 226e 6561 7265  "linear", "neare
+0001de30: 7374 222c 2022 7a65 726f 222c 2022 736c  st", "zero", "sl
+0001de40: 696e 6561 7222 2c20 2271 7561 6472 6174  inear", "quadrat
+0001de50: 6963 222c 2022 6375 6269 6322 2c20 2270  ic", "cubic", "p
+0001de60: 6f6c 796e 6f6d 6961 6c22 2c20 5c0a 2020  olynomial", \.  
+0001de70: 2020 2020 2020 2020 2020 2262 6172 7963            "baryc
+0001de80: 656e 7472 6963 222c 2022 6b72 6f67 222c  entric", "krog",
+0001de90: 2022 7063 6869 7022 2c20 2273 706c 696e   "pchip", "splin
+0001dea0: 6522 2c20 2261 6b69 6d61 227d 2c20 6465  e", "akima"}, de
+0001deb0: 6661 756c 743a 2022 6c69 6e65 6172 220a  fault: "linear".
+0001dec0: 2020 2020 2020 2020 2020 2020 5374 7269              Stri
+0001ded0: 6e67 2069 6e64 6963 6174 696e 6720 7768  ng indicating wh
+0001dee0: 6963 6820 6d65 7468 6f64 2074 6f20 7573  ich method to us
+0001def0: 6520 666f 7220 696e 7465 7270 6f6c 6174  e for interpolat
+0001df00: 696f 6e3a 0a0a 2020 2020 2020 2020 2020  ion:..          
+0001df10: 2020 2d20 276c 696e 6561 7227 3a20 6c69    - 'linear': li
+0001df20: 6e65 6172 2069 6e74 6572 706f 6c61 7469  near interpolati
+0001df30: 6f6e 2e20 4164 6469 7469 6f6e 616c 206b  on. Additional k
+0001df40: 6579 776f 7264 0a20 2020 2020 2020 2020  eyword.         
+0001df50: 2020 2020 2061 7267 756d 656e 7473 2061       arguments a
+0001df60: 7265 2070 6173 7365 6420 746f 203a 7079  re passed to :py
+0001df70: 3a66 756e 633a 606e 756d 7079 2e69 6e74  :func:`numpy.int
+0001df80: 6572 7060 0a20 2020 2020 2020 2020 2020  erp`.           
+0001df90: 202d 2027 6e65 6172 6573 7427 2c20 277a   - 'nearest', 'z
+0001dfa0: 6572 6f27 2c20 2773 6c69 6e65 6172 272c  ero', 'slinear',
+0001dfb0: 2027 7175 6164 7261 7469 6327 2c20 2763   'quadratic', 'c
+0001dfc0: 7562 6963 272c 2027 706f 6c79 6e6f 6d69  ubic', 'polynomi
+0001dfd0: 616c 273a 0a20 2020 2020 2020 2020 2020  al':.           
+0001dfe0: 2020 2061 7265 2070 6173 7365 6420 746f     are passed to
+0001dff0: 203a 7079 3a66 756e 633a 6073 6369 7079   :py:func:`scipy
+0001e000: 2e69 6e74 6572 706f 6c61 7465 2e69 6e74  .interpolate.int
+0001e010: 6572 7031 6460 2e20 4966 0a20 2020 2020  erp1d`. If.     
+0001e020: 2020 2020 2020 2020 2060 606d 6574 686f           ``metho
+0001e030: 643d 2770 6f6c 796e 6f6d 6961 6c27 6060  d='polynomial'``
+0001e040: 2c20 7468 6520 6060 6f72 6465 7260 6020  , the ``order`` 
+0001e050: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
+0001e060: 206d 7573 7420 616c 736f 2062 650a 2020   must also be.  
+0001e070: 2020 2020 2020 2020 2020 2020 7072 6f76              prov
+0001e080: 6964 6564 2e0a 2020 2020 2020 2020 2020  ided..          
+0001e090: 2020 2d20 2762 6172 7963 656e 7472 6963    - 'barycentric
+0001e0a0: 272c 2027 6b72 6f67 272c 2027 7063 6869  ', 'krog', 'pchi
+0001e0b0: 7027 2c20 2773 706c 696e 6527 2c20 2761  p', 'spline', 'a
+0001e0c0: 6b69 6d61 273a 2075 7365 2074 6865 6972  kima': use their
+0001e0d0: 0a20 2020 2020 2020 2020 2020 2020 2072  .              r
+0001e0e0: 6573 7065 6374 6976 6520 3a70 793a 636c  espective :py:cl
+0001e0f0: 6173 733a 6073 6369 7079 2e69 6e74 6572  ass:`scipy.inter
+0001e100: 706f 6c61 7465 6020 636c 6173 7365 732e  polate` classes.
+0001e110: 0a0a 2020 2020 2020 2020 6173 7375 6d65  ..        assume
+0001e120: 5f73 6f72 7465 6420 3a20 626f 6f6c 2c20  _sorted : bool, 
+0001e130: 6465 6661 756c 743a 2046 616c 7365 0a20  default: False. 
+0001e140: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
+0001e150: 6c73 652c 2076 616c 7565 7320 6f66 2063  lse, values of c
+0001e160: 6f6f 7264 696e 6174 6573 2074 6861 7420  oordinates that 
+0001e170: 6172 6520 696e 7465 7270 6f6c 6174 6564  are interpolated
+0001e180: 206f 7665 7220 6361 6e20 6265 0a20 2020   over can be.   
+0001e190: 2020 2020 2020 2020 2069 6e20 616e 7920           in any 
+0001e1a0: 6f72 6465 7220 616e 6420 7468 6579 2061  order and they a
+0001e1b0: 7265 2073 6f72 7465 6420 6669 7273 742e  re sorted first.
+0001e1c0: 2049 6620 5472 7565 2c20 696e 7465 7270   If True, interp
+0001e1d0: 6f6c 6174 6564 0a20 2020 2020 2020 2020  olated.         
+0001e1e0: 2020 2063 6f6f 7264 696e 6174 6573 2061     coordinates a
+0001e1f0: 7265 2061 7373 756d 6564 2074 6f20 6265  re assumed to be
+0001e200: 2061 6e20 6172 7261 7920 6f66 206d 6f6e   an array of mon
+0001e210: 6f74 6f6e 6963 616c 6c79 2069 6e63 7265  otonically incre
+0001e220: 6173 696e 670a 2020 2020 2020 2020 2020  asing.          
+0001e230: 2020 7661 6c75 6573 2e0a 2020 2020 2020    values..      
+0001e240: 2020 6b77 6172 6773 203a 2064 6963 742c    kwargs : dict,
+0001e250: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0001e260: 2020 2020 2020 4164 6469 7469 6f6e 616c        Additional
+0001e270: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+0001e280: 7473 2070 6173 7365 6420 746f 2073 6369  ts passed to sci
+0001e290: 7079 2773 2069 6e74 6572 706f 6c61 746f  py's interpolato
+0001e2a0: 722e 2056 616c 6964 0a20 2020 2020 2020  r. Valid.       
+0001e2b0: 2020 2020 206f 7074 696f 6e73 2061 6e64       options and
+0001e2c0: 2074 6865 6972 2062 6568 6176 696f 7220   their behavior 
+0001e2d0: 6465 7065 6e64 2077 6865 7468 6572 2060  depend whether `
+0001e2e0: 6069 6e74 6572 7031 6460 6020 6f72 0a20  `interp1d`` or. 
+0001e2f0: 2020 2020 2020 2020 2020 2060 6069 6e74             ``int
+0001e300: 6572 706e 6060 2069 7320 7573 6564 2e0a  erpn`` is used..
+0001e310: 2020 2020 2020 2020 6d65 7468 6f64 5f6e          method_n
+0001e320: 6f6e 5f6e 756d 6572 6963 203a 207b 226e  on_numeric : {"n
+0001e330: 6561 7265 7374 222c 2022 7061 6422 2c20  earest", "pad", 
+0001e340: 2266 6669 6c6c 222c 2022 6261 636b 6669  "ffill", "backfi
+0001e350: 6c6c 222c 2022 6266 696c 6c22 7d2c 206f  ll", "bfill"}, o
+0001e360: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0001e370: 2020 2020 4d65 7468 6f64 2066 6f72 206e      Method for n
+0001e380: 6f6e 2d6e 756d 6572 6963 2074 7970 6573  on-numeric types
+0001e390: 2e20 5061 7373 6564 206f 6e20 746f 203a  . Passed on to :
+0001e3a0: 7079 3a6d 6574 683a 6044 6174 6173 6574  py:meth:`Dataset
+0001e3b0: 2e72 6569 6e64 6578 602e 0a20 2020 2020  .reindex`..     
+0001e3c0: 2020 2020 2020 2060 6022 6e65 6172 6573         ``"neares
+0001e3d0: 7422 6060 2069 7320 7573 6564 2062 7920  t"`` is used by 
+0001e3e0: 6465 6661 756c 742e 0a20 2020 2020 2020  default..       
+0001e3f0: 202a 2a63 6f6f 7264 735f 6b77 6172 6773   **coords_kwargs
+0001e400: 203a 207b 6469 6d3a 2063 6f6f 7264 696e   : {dim: coordin
+0001e410: 6174 652c 202e 2e2e 7d2c 206f 7074 696f  ate, ...}, optio
+0001e420: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+0001e430: 5468 6520 6b65 7977 6f72 6420 6172 6775  The keyword argu
+0001e440: 6d65 6e74 7320 666f 726d 206f 6620 6060  ments form of ``
+0001e450: 636f 6f72 6473 6060 2e0a 2020 2020 2020  coords``..      
+0001e460: 2020 2020 2020 4f6e 6520 6f66 2063 6f6f        One of coo
+0001e470: 7264 7320 6f72 2063 6f6f 7264 735f 6b77  rds or coords_kw
+0001e480: 6172 6773 206d 7573 7420 6265 2070 726f  args must be pro
+0001e490: 7669 6465 642e 0a0a 2020 2020 2020 2020  vided...        
+0001e4a0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+0001e4b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0001e4c0: 696e 7465 7270 6f6c 6174 6564 203a 2044  interpolated : D
+0001e4d0: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+0001e4e0: 2020 204e 6577 2064 6174 6173 6574 206f     New dataset o
+0001e4f0: 6e20 7468 6520 6e65 7720 636f 6f72 6469  n the new coordi
+0001e500: 6e61 7465 732e 0a0a 2020 2020 2020 2020  nates...        
+0001e510: 4e6f 7465 730a 2020 2020 2020 2020 2d2d  Notes.        --
+0001e520: 2d2d 2d0a 2020 2020 2020 2020 7363 6970  ---.        scip
+0001e530: 7920 6973 2072 6571 7569 7265 642e 0a0a  y is required...
+0001e540: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+0001e550: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0001e560: 2d0a 2020 2020 2020 2020 7363 6970 792e  -.        scipy.
+0001e570: 696e 7465 7270 6f6c 6174 652e 696e 7465  interpolate.inte
+0001e580: 7270 3164 0a20 2020 2020 2020 2073 6369  rp1d.        sci
+0001e590: 7079 2e69 6e74 6572 706f 6c61 7465 2e69  py.interpolate.i
+0001e5a0: 6e74 6572 706e 0a0a 2020 2020 2020 2020  nterpn..        
+0001e5b0: 4578 616d 706c 6573 0a20 2020 2020 2020  Examples.       
+0001e5c0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+0001e5d0: 2020 3e3e 3e20 6473 203d 2078 722e 4461    >>> ds = xr.Da
+0001e5e0: 7461 7365 7428 0a20 2020 2020 2020 202e  taset(.        .
+0001e5f0: 2e2e 2020 2020 2064 6174 615f 7661 7273  ..     data_vars
+0001e600: 3d7b 0a20 2020 2020 2020 202e 2e2e 2020  ={.        ...  
+0001e610: 2020 2020 2020 2022 6122 3a20 2822 7822         "a": ("x"
+0001e620: 2c20 5b35 2c20 372c 2034 5d29 2c0a 2020  , [5, 7, 4]),.  
+0001e630: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+0001e640: 2020 2262 223a 2028 0a20 2020 2020 2020    "b": (.       
+0001e650: 202e 2e2e 2020 2020 2020 2020 2020 2020   ...            
+0001e660: 2028 2278 222c 2022 7922 292c 0a20 2020   ("x", "y"),.   
+0001e670: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+0001e680: 2020 2020 205b 5b31 2c20 342c 2032 2c20       [[1, 4, 2, 
+0001e690: 395d 2c20 5b32 2c20 372c 2036 2c20 6e70  9], [2, 7, 6, np
+0001e6a0: 2e6e 616e 5d2c 205b 362c 206e 702e 6e61  .nan], [6, np.na
+0001e6b0: 6e2c 2035 2c20 385d 5d2c 0a20 2020 2020  n, 5, 8]],.     
+0001e6c0: 2020 202e 2e2e 2020 2020 2020 2020 2029     ...         )
+0001e6d0: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+0001e6e0: 2020 7d2c 0a20 2020 2020 2020 202e 2e2e    },.        ...
+0001e6f0: 2020 2020 2063 6f6f 7264 733d 7b22 7822       coords={"x"
+0001e700: 3a20 5b30 2c20 312c 2032 5d2c 2022 7922  : [0, 1, 2], "y"
+0001e710: 3a20 5b31 302c 2031 322c 2031 342c 2031  : [10, 12, 14, 1
+0001e720: 365d 7d2c 0a20 2020 2020 2020 202e 2e2e  6]},.        ...
+0001e730: 2029 0a20 2020 2020 2020 203e 3e3e 2064   ).        >>> d
+0001e740: 730a 2020 2020 2020 2020 3c78 6172 7261  s.        <xarra
+0001e750: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+0001e760: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+0001e770: 2878 3a20 332c 2079 3a20 3429 0a20 2020  (x: 3, y: 4).   
+0001e780: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+0001e790: 3a0a 2020 2020 2020 2020 2020 2a20 7820  :.          * x 
+0001e7a0: 2020 2020 2020 2028 7829 2069 6e74 3634         (x) int64
+0001e7b0: 2030 2031 2032 0a20 2020 2020 2020 2020   0 1 2.         
+0001e7c0: 202a 2079 2020 2020 2020 2020 2879 2920   * y        (y) 
+0001e7d0: 696e 7436 3420 3130 2031 3220 3134 2031  int64 10 12 14 1
+0001e7e0: 360a 2020 2020 2020 2020 4461 7461 2076  6.        Data v
+0001e7f0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+0001e800: 2020 2020 2020 6120 2020 2020 2020 2028        a        (
+0001e810: 7829 2069 6e74 3634 2035 2037 2034 0a20  x) int64 5 7 4. 
+0001e820: 2020 2020 2020 2020 2020 2062 2020 2020             b    
+0001e830: 2020 2020 2878 2c20 7929 2066 6c6f 6174      (x, y) float
+0001e840: 3634 2031 2e30 2034 2e30 2032 2e30 2039  64 1.0 4.0 2.0 9
+0001e850: 2e30 2032 2e30 2037 2e30 2036 2e30 206e  .0 2.0 7.0 6.0 n
+0001e860: 616e 2036 2e30 206e 616e 2035 2e30 2038  an 6.0 nan 5.0 8
+0001e870: 2e30 0a0a 2020 2020 2020 2020 3144 2069  .0..        1D i
+0001e880: 6e74 6572 706f 6c61 7469 6f6e 2077 6974  nterpolation wit
+0001e890: 6820 7468 6520 6465 6661 756c 7420 6d65  h the default me
+0001e8a0: 7468 6f64 2028 6c69 6e65 6172 293a 0a0a  thod (linear):..
+0001e8b0: 2020 2020 2020 2020 3e3e 3e20 6473 2e69          >>> ds.i
+0001e8c0: 6e74 6572 7028 783d 5b30 2c20 302e 3735  nterp(x=[0, 0.75
+0001e8d0: 2c20 312e 3235 2c20 312e 3735 5d29 0a20  , 1.25, 1.75]). 
+0001e8e0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+0001e8f0: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+0001e900: 4469 6d65 6e73 696f 6e73 3a20 2028 783a  Dimensions:  (x:
+0001e910: 2034 2c20 793a 2034 290a 2020 2020 2020   4, y: 4).      
+0001e920: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+0001e930: 2020 2020 2020 2020 202a 2079 2020 2020           * y    
+0001e940: 2020 2020 2879 2920 696e 7436 3420 3130      (y) int64 10
+0001e950: 2031 3220 3134 2031 360a 2020 2020 2020   12 14 16.      
+0001e960: 2020 2020 2a20 7820 2020 2020 2020 2028      * x        (
+0001e970: 7829 2066 6c6f 6174 3634 2030 2e30 2030  x) float64 0.0 0
+0001e980: 2e37 3520 312e 3235 2031 2e37 350a 2020  .75 1.25 1.75.  
+0001e990: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+0001e9a0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+0001e9b0: 2020 6120 2020 2020 2020 2028 7829 2066    a        (x) f
+0001e9c0: 6c6f 6174 3634 2035 2e30 2036 2e35 2036  loat64 5.0 6.5 6
+0001e9d0: 2e32 3520 342e 3735 0a20 2020 2020 2020  .25 4.75.       
+0001e9e0: 2020 2020 2062 2020 2020 2020 2020 2878       b        (x
+0001e9f0: 2c20 7929 2066 6c6f 6174 3634 2031 2e30  , y) float64 1.0
+0001ea00: 2034 2e30 2032 2e30 206e 616e 2031 2e37   4.0 2.0 nan 1.7
+0001ea10: 3520 362e 3235 202e 2e2e 206e 616e 2035  5 6.25 ... nan 5
+0001ea20: 2e30 206e 616e 2035 2e32 3520 6e61 6e0a  .0 nan 5.25 nan.
+0001ea30: 0a20 2020 2020 2020 2031 4420 696e 7465  .        1D inte
+0001ea40: 7270 6f6c 6174 696f 6e20 7769 7468 2061  rpolation with a
+0001ea50: 2064 6966 6665 7265 6e74 206d 6574 686f   different metho
+0001ea60: 643a 0a0a 2020 2020 2020 2020 3e3e 3e20  d:..        >>> 
+0001ea70: 6473 2e69 6e74 6572 7028 783d 5b30 2c20  ds.interp(x=[0, 
+0001ea80: 302e 3735 2c20 312e 3235 2c20 312e 3735  0.75, 1.25, 1.75
+0001ea90: 5d2c 206d 6574 686f 643d 226e 6561 7265  ], method="neare
+0001eaa0: 7374 2229 0a20 2020 2020 2020 203c 7861  st").        <xa
+0001eab0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+0001eac0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+0001ead0: 3a20 2028 783a 2034 2c20 793a 2034 290a  :  (x: 4, y: 4).
+0001eae0: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+0001eaf0: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
+0001eb00: 2079 2020 2020 2020 2020 2879 2920 696e   y        (y) in
+0001eb10: 7436 3420 3130 2031 3220 3134 2031 360a  t64 10 12 14 16.
+0001eb20: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+0001eb30: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
+0001eb40: 2030 2e30 2030 2e37 3520 312e 3235 2031   0.0 0.75 1.25 1
+0001eb50: 2e37 350a 2020 2020 2020 2020 4461 7461  .75.        Data
+0001eb60: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+0001eb70: 2020 2020 2020 2020 6120 2020 2020 2020          a       
+0001eb80: 2028 7829 2066 6c6f 6174 3634 2035 2e30   (x) float64 5.0
+0001eb90: 2037 2e30 2037 2e30 2034 2e30 0a20 2020   7.0 7.0 4.0.   
+0001eba0: 2020 2020 2020 2020 2062 2020 2020 2020           b      
+0001ebb0: 2020 2878 2c20 7929 2066 6c6f 6174 3634    (x, y) float64
+0001ebc0: 2031 2e30 2034 2e30 2032 2e30 2039 2e30   1.0 4.0 2.0 9.0
+0001ebd0: 2032 2e30 2037 2e30 202e 2e2e 2036 2e30   2.0 7.0 ... 6.0
+0001ebe0: 206e 616e 2036 2e30 206e 616e 2035 2e30   nan 6.0 nan 5.0
+0001ebf0: 2038 2e30 0a0a 2020 2020 2020 2020 3144   8.0..        1D
+0001ec00: 2065 7874 7261 706f 6c61 7469 6f6e 3a0a   extrapolation:.
+0001ec10: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
+0001ec20: 696e 7465 7270 280a 2020 2020 2020 2020  interp(.        
+0001ec30: 2e2e 2e20 2020 2020 783d 5b31 2c20 312e  ...     x=[1, 1.
+0001ec40: 352c 2032 2e35 2c20 332e 355d 2c0a 2020  5, 2.5, 3.5],.  
+0001ec50: 2020 2020 2020 2e2e 2e20 2020 2020 6d65        ...     me
+0001ec60: 7468 6f64 3d22 6c69 6e65 6172 222c 0a20  thod="linear",. 
+0001ec70: 2020 2020 2020 202e 2e2e 2020 2020 206b         ...     k
+0001ec80: 7761 7267 733d 7b22 6669 6c6c 5f76 616c  wargs={"fill_val
+0001ec90: 7565 223a 2022 6578 7472 6170 6f6c 6174  ue": "extrapolat
+0001eca0: 6522 7d2c 0a20 2020 2020 2020 202e 2e2e  e"},.        ...
+0001ecb0: 2029 0a20 2020 2020 2020 203c 7861 7272   ).        <xarr
+0001ecc0: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
+0001ecd0: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
+0001ece0: 2028 783a 2034 2c20 793a 2034 290a 2020   (x: 4, y: 4).  
+0001ecf0: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+0001ed00: 733a 0a20 2020 2020 2020 2020 202a 2079  s:.          * y
+0001ed10: 2020 2020 2020 2020 2879 2920 696e 7436          (y) int6
+0001ed20: 3420 3130 2031 3220 3134 2031 360a 2020  4 10 12 14 16.  
+0001ed30: 2020 2020 2020 2020 2a20 7820 2020 2020          * x     
+0001ed40: 2020 2028 7829 2066 6c6f 6174 3634 2031     (x) float64 1
+0001ed50: 2e30 2031 2e35 2032 2e35 2033 2e35 0a20  .0 1.5 2.5 3.5. 
+0001ed60: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
+0001ed70: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
+0001ed80: 2020 2061 2020 2020 2020 2020 2878 2920     a        (x) 
+0001ed90: 666c 6f61 7436 3420 372e 3020 352e 3520  float64 7.0 5.5 
+0001eda0: 322e 3520 2d30 2e35 0a20 2020 2020 2020  2.5 -0.5.       
+0001edb0: 2020 2020 2062 2020 2020 2020 2020 2878       b        (x
+0001edc0: 2c20 7929 2066 6c6f 6174 3634 2032 2e30  , y) float64 2.0
+0001edd0: 2037 2e30 2036 2e30 206e 616e 2034 2e30   7.0 6.0 nan 4.0
+0001ede0: 206e 616e 202e 2e2e 2034 2e35 206e 616e   nan ... 4.5 nan
+0001edf0: 2031 322e 3020 6e61 6e20 332e 3520 6e61   12.0 nan 3.5 na
+0001ee00: 6e0a 0a20 2020 2020 2020 2032 4420 696e  n..        2D in
+0001ee10: 7465 7270 6f6c 6174 696f 6e3a 0a0a 2020  terpolation:..  
+0001ee20: 2020 2020 2020 3e3e 3e20 6473 2e69 6e74        >>> ds.int
+0001ee30: 6572 7028 783d 5b30 2c20 302e 3735 2c20  erp(x=[0, 0.75, 
+0001ee40: 312e 3235 2c20 312e 3735 5d2c 2079 3d5b  1.25, 1.75], y=[
+0001ee50: 3131 2c20 3133 2c20 3135 5d2c 206d 6574  11, 13, 15], met
+0001ee60: 686f 643d 226c 696e 6561 7222 290a 2020  hod="linear").  
+0001ee70: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+0001ee80: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+0001ee90: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
+0001eea0: 342c 2079 3a20 3329 0a20 2020 2020 2020  4, y: 3).       
+0001eeb0: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+0001eec0: 2020 2020 2020 2020 2a20 7820 2020 2020          * x     
+0001eed0: 2020 2028 7829 2066 6c6f 6174 3634 2030     (x) float64 0
+0001eee0: 2e30 2030 2e37 3520 312e 3235 2031 2e37  .0 0.75 1.25 1.7
+0001eef0: 350a 2020 2020 2020 2020 2020 2a20 7920  5.          * y 
+0001ef00: 2020 2020 2020 2028 7929 2069 6e74 3634         (y) int64
+0001ef10: 2031 3120 3133 2031 350a 2020 2020 2020   11 13 15.      
+0001ef20: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
+0001ef30: 3a0a 2020 2020 2020 2020 2020 2020 6120  :.            a 
+0001ef40: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+0001ef50: 3634 2035 2e30 2036 2e35 2036 2e32 3520  64 5.0 6.5 6.25 
+0001ef60: 342e 3735 0a20 2020 2020 2020 2020 2020  4.75.           
+0001ef70: 2062 2020 2020 2020 2020 2878 2c20 7929   b        (x, y)
+0001ef80: 2066 6c6f 6174 3634 2032 2e35 2033 2e30   float64 2.5 3.0
+0001ef90: 206e 616e 2034 2e30 2035 2e36 3235 206e   nan 4.0 5.625 n
+0001efa0: 616e 206e 616e 206e 616e 206e 616e 206e  an nan nan nan n
+0001efb0: 616e 206e 616e 206e 616e 0a20 2020 2020  an nan nan.     
+0001efc0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+0001efd0: 726f 6d20 7861 7272 6179 2e63 6f72 6520  rom xarray.core 
+0001efe0: 696d 706f 7274 206d 6973 7369 6e67 0a0a  import missing..
+0001eff0: 2020 2020 2020 2020 6966 206b 7761 7267          if kwarg
+0001f000: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+0001f010: 2020 2020 2020 206b 7761 7267 7320 3d20         kwargs = 
+0001f020: 7b7d 0a0a 2020 2020 2020 2020 636f 6f72  {}..        coor
+0001f030: 6473 203d 2065 6974 6865 725f 6469 6374  ds = either_dict
+0001f040: 5f6f 725f 6b77 6172 6773 2863 6f6f 7264  _or_kwargs(coord
+0001f050: 732c 2063 6f6f 7264 735f 6b77 6172 6773  s, coords_kwargs
+0001f060: 2c20 2269 6e74 6572 7022 290a 2020 2020  , "interp").    
+0001f070: 2020 2020 696e 6465 7865 7273 203d 2064      indexers = d
+0001f080: 6963 7428 7365 6c66 2e5f 7661 6c69 6461  ict(self._valida
+0001f090: 7465 5f69 6e74 6572 705f 696e 6465 7865  te_interp_indexe
+0001f0a0: 7273 2863 6f6f 7264 7329 290a 0a20 2020  rs(coords))..   
+0001f0b0: 2020 2020 2069 6620 636f 6f72 6473 3a0a       if coords:.
+0001f0c0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+0001f0d0: 6973 2061 766f 6964 7320 6272 6f61 6463  is avoids broadc
+0001f0e0: 6173 7469 6e67 206f 7665 7220 636f 6f72  asting over coor
+0001f0f0: 6469 6e61 7465 7320 7468 6174 2061 7265  dinates that are
+0001f100: 2062 6f74 6820 696e 0a20 2020 2020 2020   both in.       
+0001f110: 2020 2020 2023 2074 6865 206f 7269 6769       # the origi
+0001f120: 6e61 6c20 6172 7261 7920 414e 4420 696e  nal array AND in
+0001f130: 2074 6865 2069 6e64 6578 696e 6720 6172   the indexing ar
+0001f140: 7261 792e 2049 7420 6573 7365 6e74 6961  ray. It essentia
+0001f150: 6c6c 790a 2020 2020 2020 2020 2020 2020  lly.            
+0001f160: 2320 666f 7263 6573 2069 6e74 6572 706f  # forces interpo
+0001f170: 6c61 7469 6f6e 2061 6c6f 6e67 2074 6865  lation along the
+0001f180: 2073 6861 7265 6420 636f 6f72 6469 6e61   shared coordina
+0001f190: 7465 732e 0a20 2020 2020 2020 2020 2020  tes..           
+0001f1a0: 2073 6469 6d73 203d 2028 0a20 2020 2020   sdims = (.     
+0001f1b0: 2020 2020 2020 2020 2020 2073 6574 2873             set(s
+0001f1c0: 656c 662e 6469 6d73 290a 2020 2020 2020  elf.dims).      
+0001f1d0: 2020 2020 2020 2020 2020 2e69 6e74 6572            .inter
+0001f1e0: 7365 6374 696f 6e28 2a5b 7365 7428 6e78  section(*[set(nx
+0001f1f0: 2e64 696d 7329 2066 6f72 206e 7820 696e  .dims) for nx in
+0001f200: 2069 6e64 6578 6572 732e 7661 6c75 6573   indexers.values
+0001f210: 2829 5d29 0a20 2020 2020 2020 2020 2020  ()]).           
+0001f220: 2020 2020 202e 6469 6666 6572 656e 6365       .difference
+0001f230: 2863 6f6f 7264 732e 6b65 7973 2829 290a  (coords.keys()).
+0001f240: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001f250: 2020 2020 2020 2020 2020 696e 6465 7865            indexe
+0001f260: 7273 2e75 7064 6174 6528 7b64 3a20 7365  rs.update({d: se
+0001f270: 6c66 2e76 6172 6961 626c 6573 5b64 5d20  lf.variables[d] 
+0001f280: 666f 7220 6420 696e 2073 6469 6d73 7d29  for d in sdims})
+0001f290: 0a0a 2020 2020 2020 2020 6f62 6a20 3d20  ..        obj = 
+0001f2a0: 7365 6c66 2069 6620 6173 7375 6d65 5f73  self if assume_s
+0001f2b0: 6f72 7465 6420 656c 7365 2073 656c 662e  orted else self.
+0001f2c0: 736f 7274 6279 285b 6b20 666f 7220 6b20  sortby([k for k 
+0001f2d0: 696e 2063 6f6f 7264 735d 290a 0a20 2020  in coords])..   
+0001f2e0: 2020 2020 2064 6566 206d 6179 6265 5f76       def maybe_v
+0001f2f0: 6172 6961 626c 6528 6f62 6a2c 206b 293a  ariable(obj, k):
+0001f300: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
+0001f310: 6f72 6b61 726f 756e 6420 746f 2067 6574  orkaround to get
+0001f320: 2076 6172 6961 626c 6520 666f 7220 6469   variable for di
+0001f330: 6d65 6e73 696f 6e20 7769 7468 6f75 7420  mension without 
+0001f340: 636f 6f72 6469 6e61 7465 2e0a 2020 2020  coordinate..    
+0001f350: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001f360: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001f370: 7572 6e20 6f62 6a2e 5f76 6172 6961 626c  urn obj._variabl
+0001f380: 6573 5b6b 5d0a 2020 2020 2020 2020 2020  es[k].          
+0001f390: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+0001f3a0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0001f3b0: 2020 2072 6574 7572 6e20 6173 5f76 6172     return as_var
+0001f3c0: 6961 626c 6528 286b 2c20 7261 6e67 6528  iable((k, range(
+0001f3d0: 6f62 6a2e 6469 6d73 5b6b 5d29 2929 0a0a  obj.dims[k])))..
+0001f3e0: 2020 2020 2020 2020 6465 6620 5f76 616c          def _val
+0001f3f0: 6964 6174 655f 696e 7465 7270 5f69 6e64  idate_interp_ind
+0001f400: 6578 6572 2878 2c20 6e65 775f 7829 3a0a  exer(x, new_x):.
+0001f410: 2020 2020 2020 2020 2020 2020 2320 496e              # In
+0001f420: 2074 6865 2063 6173 6520 6f66 2064 6174   the case of dat
+0001f430: 6574 696d 6573 2c20 7468 6520 7265 7374  etimes, the rest
+0001f440: 7269 6374 696f 6e73 2070 6c61 6365 6420  rictions placed 
+0001f450: 6f6e 2069 6e64 6578 6572 730a 2020 2020  on indexers.    
+0001f460: 2020 2020 2020 2020 2320 7573 6564 2077          # used w
+0001f470: 6974 6820 696e 7465 7270 2061 7265 2073  ith interp are s
+0001f480: 7472 6f6e 6765 7220 7468 616e 2074 686f  tronger than tho
+0001f490: 7365 2077 6869 6368 2061 7265 2070 6c61  se which are pla
+0001f4a0: 6365 6420 6f6e 0a20 2020 2020 2020 2020  ced on.         
+0001f4b0: 2020 2023 2069 7365 6c2c 2073 6f20 7765     # isel, so we
+0001f4c0: 206e 6565 6420 616e 2061 6464 6974 696f   need an additio
+0001f4d0: 6e61 6c20 6368 6563 6b20 6166 7465 7220  nal check after 
+0001f4e0: 5f76 616c 6964 6174 655f 696e 6465 7865  _validate_indexe
+0001f4f0: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
+0001f500: 6966 205f 636f 6e74 6169 6e73 5f64 6174  if _contains_dat
+0001f510: 6574 696d 655f 6c69 6b65 5f6f 626a 6563  etime_like_objec
+0001f520: 7473 280a 2020 2020 2020 2020 2020 2020  ts(.            
+0001f530: 2020 2020 780a 2020 2020 2020 2020 2020      x.          
+0001f540: 2020 2920 616e 6420 6e6f 7420 5f63 6f6e    ) and not _con
+0001f550: 7461 696e 735f 6461 7465 7469 6d65 5f6c  tains_datetime_l
+0001f560: 696b 655f 6f62 6a65 6374 7328 6e65 775f  ike_objects(new_
+0001f570: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
+0001f580: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+0001f590: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0001f5a0: 2020 2020 2020 2020 2022 5768 656e 2069           "When i
+0001f5b0: 6e74 6572 706f 6c61 7469 6e67 206f 7665  nterpolating ove
+0001f5c0: 7220 6120 6461 7465 7469 6d65 2d6c 696b  r a datetime-lik
+0001f5d0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+0001f5e0: 2020 2020 2020 2020 2263 6f6f 7264 696e          "coordin
+0001f5f0: 6174 652c 2074 6865 2063 6f6f 7264 696e  ate, the coordin
+0001f600: 6174 6573 2074 6f20 220a 2020 2020 2020  ates to ".      
+0001f610: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+0001f620: 6e74 6572 706f 6c61 7465 2074 6f20 6d75  nterpolate to mu
+0001f630: 7374 2062 6520 6569 7468 6572 2064 6174  st be either dat
+0001f640: 6574 696d 6520 220a 2020 2020 2020 2020  etime ".        
+0001f650: 2020 2020 2020 2020 2020 2020 2273 7472              "str
+0001f660: 696e 6773 206f 7220 6461 7465 7469 6d65  ings or datetime
+0001f670: 732e 2022 0a20 2020 2020 2020 2020 2020  s. ".           
+0001f680: 2020 2020 2020 2020 2022 496e 7374 6561           "Instea
+0001f690: 6420 676f 745c 6e7b 7d22 2e66 6f72 6d61  d got\n{}".forma
+0001f6a0: 7428 6e65 775f 7829 0a20 2020 2020 2020  t(new_x).       
+0001f6b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001f6c0: 2020 2020 2020 2072 6574 7572 6e20 782c         return x,
+0001f6d0: 206e 6577 5f78 0a0a 2020 2020 2020 2020   new_x..        
+0001f6e0: 7661 6c69 6461 7465 645f 696e 6465 7865  validated_indexe
+0001f6f0: 7273 203d 207b 0a20 2020 2020 2020 2020  rs = {.         
+0001f700: 2020 206b 3a20 5f76 616c 6964 6174 655f     k: _validate_
+0001f710: 696e 7465 7270 5f69 6e64 6578 6572 286d  interp_indexer(m
+0001f720: 6179 6265 5f76 6172 6961 626c 6528 6f62  aybe_variable(ob
+0001f730: 6a2c 206b 292c 2076 290a 2020 2020 2020  j, k), v).      
+0001f740: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
+0001f750: 6e20 696e 6465 7865 7273 2e69 7465 6d73  n indexers.items
+0001f760: 2829 0a20 2020 2020 2020 207d 0a0a 2020  ().        }..  
+0001f770: 2020 2020 2020 2320 6f70 7469 6d69 7a61        # optimiza
+0001f780: 7469 6f6e 3a20 7375 6273 6574 2074 6f20  tion: subset to 
+0001f790: 636f 6f72 6469 6e61 7465 2072 616e 6765  coordinate range
+0001f7a0: 206f 6620 7468 6520 7461 7267 6574 2069   of the target i
+0001f7b0: 6e64 6578 0a20 2020 2020 2020 2069 6620  ndex.        if 
+0001f7c0: 6d65 7468 6f64 2069 6e20 5b22 6c69 6e65  method in ["line
+0001f7d0: 6172 222c 2022 6e65 6172 6573 7422 5d3a  ar", "nearest"]:
+0001f7e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001f7f0: 206b 2c20 7620 696e 2076 616c 6964 6174   k, v in validat
+0001f800: 6564 5f69 6e64 6578 6572 732e 6974 656d  ed_indexers.item
+0001f810: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0001f820: 2020 2020 206f 626a 2c20 6e65 7769 6478       obj, newidx
+0001f830: 203d 206d 6973 7369 6e67 2e5f 6c6f 6361   = missing._loca
+0001f840: 6c69 7a65 286f 626a 2c20 7b6b 3a20 767d  lize(obj, {k: v}
+0001f850: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001f860: 2020 7661 6c69 6461 7465 645f 696e 6465    validated_inde
+0001f870: 7865 7273 5b6b 5d20 3d20 6e65 7769 6478  xers[k] = newidx
+0001f880: 5b6b 5d0a 0a20 2020 2020 2020 2023 206f  [k]..        # o
+0001f890: 7074 696d 697a 6174 696f 6e3a 2063 7265  ptimization: cre
+0001f8a0: 6174 6520 6461 736b 2063 6f6f 7264 696e  ate dask coordin
+0001f8b0: 6174 6520 6172 7261 7973 206f 6e63 6520  ate arrays once 
+0001f8c0: 7065 7220 4461 7461 7365 740a 2020 2020  per Dataset.    
+0001f8d0: 2020 2020 2320 7261 7468 6572 2074 6861      # rather tha
+0001f8e0: 6e20 6f6e 6365 2070 6572 2056 6172 6961  n once per Varia
+0001f8f0: 626c 6520 7768 656e 2064 6173 6b2e 6172  ble when dask.ar
+0001f900: 7261 792e 756e 6966 795f 6368 756e 6b73  ray.unify_chunks
+0001f910: 2069 7320 6361 6c6c 6564 206c 6174 6572   is called later
+0001f920: 0a20 2020 2020 2020 2023 2047 4834 3733  .        # GH473
+0001f930: 390a 2020 2020 2020 2020 6966 206f 626a  9.        if obj
+0001f940: 2e5f 5f64 6173 6b5f 6772 6170 685f 5f28  .__dask_graph__(
+0001f950: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
+0001f960: 6173 6b5f 696e 6465 7865 7273 203d 207b  ask_indexers = {
+0001f970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f980: 206b 3a20 2869 6e64 6578 2e74 6f5f 6261   k: (index.to_ba
+0001f990: 7365 5f76 6172 6961 626c 6528 292e 6368  se_variable().ch
+0001f9a0: 756e 6b28 292c 2064 6573 742e 746f 5f62  unk(), dest.to_b
+0001f9b0: 6173 655f 7661 7269 6162 6c65 2829 2e63  ase_variable().c
+0001f9c0: 6875 6e6b 2829 290a 2020 2020 2020 2020  hunk()).        
+0001f9d0: 2020 2020 2020 2020 666f 7220 6b2c 2028          for k, (
+0001f9e0: 696e 6465 782c 2064 6573 7429 2069 6e20  index, dest) in 
+0001f9f0: 7661 6c69 6461 7465 645f 696e 6465 7865  validated_indexe
+0001fa00: 7273 2e69 7465 6d73 2829 0a20 2020 2020  rs.items().     
+0001fa10: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
+0001fa20: 2020 7661 7269 6162 6c65 733a 2064 6963    variables: dic
+0001fa30: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
+0001fa40: 6162 6c65 5d20 3d20 7b7d 0a20 2020 2020  able] = {}.     
+0001fa50: 2020 2072 6569 6e64 6578 3a20 626f 6f6c     reindex: bool
+0001fa60: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+0001fa70: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
+0001fa80: 6e20 6f62 6a2e 5f76 6172 6961 626c 6573  n obj._variables
+0001fa90: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+0001faa0: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
+0001fab0: 2069 6e64 6578 6572 733a 0a20 2020 2020   indexers:.     
+0001fac0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0001fad0: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
+0001fae0: 2069 6620 6973 5f64 7563 6b5f 6461 736b   if is_duck_dask
+0001faf0: 5f61 7272 6179 2876 6172 2e64 6174 6129  _array(var.data)
+0001fb00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001fb10: 2020 7573 655f 696e 6465 7865 7273 203d    use_indexers =
+0001fb20: 2064 6173 6b5f 696e 6465 7865 7273 0a20   dask_indexers. 
+0001fb30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001fb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fb50: 2075 7365 5f69 6e64 6578 6572 7320 3d20   use_indexers = 
+0001fb60: 7661 6c69 6461 7465 645f 696e 6465 7865  validated_indexe
+0001fb70: 7273 0a0a 2020 2020 2020 2020 2020 2020  rs..            
+0001fb80: 6474 7970 655f 6b69 6e64 203d 2076 6172  dtype_kind = var
+0001fb90: 2e64 7479 7065 2e6b 696e 640a 2020 2020  .dtype.kind.    
+0001fba0: 2020 2020 2020 2020 6966 2064 7479 7065          if dtype
+0001fbb0: 5f6b 696e 6420 696e 2022 7569 6663 223a  _kind in "uifc":
+0001fbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fbd0: 2023 2046 6f72 206e 6f72 6d61 6c20 6e75   # For normal nu
+0001fbe0: 6d62 6572 2074 7970 6573 2064 6f20 7468  mber types do th
+0001fbf0: 6520 696e 7465 7270 6f6c 6174 696f 6e3a  e interpolation:
+0001fc00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fc10: 2076 6172 5f69 6e64 6578 6572 7320 3d20   var_indexers = 
+0001fc20: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+0001fc30: 6e20 7573 655f 696e 6465 7865 7273 2e69  n use_indexers.i
+0001fc40: 7465 6d73 2829 2069 6620 6b20 696e 2076  tems() if k in v
+0001fc50: 6172 2e64 696d 737d 0a20 2020 2020 2020  ar.dims}.       
+0001fc60: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0001fc70: 6573 5b6e 616d 655d 203d 206d 6973 7369  es[name] = missi
+0001fc80: 6e67 2e69 6e74 6572 7028 7661 722c 2076  ng.interp(var, v
+0001fc90: 6172 5f69 6e64 6578 6572 732c 206d 6574  ar_indexers, met
+0001fca0: 686f 642c 202a 2a6b 7761 7267 7329 0a20  hod, **kwargs). 
+0001fcb0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001fcc0: 6474 7970 655f 6b69 6e64 2069 6e20 224f  dtype_kind in "O
+0001fcd0: 6255 2220 616e 6420 2875 7365 5f69 6e64  bU" and (use_ind
+0001fce0: 6578 6572 732e 6b65 7973 2829 2026 2076  exers.keys() & v
+0001fcf0: 6172 2e64 696d 7329 3a0a 2020 2020 2020  ar.dims):.      
+0001fd00: 2020 2020 2020 2020 2020 2320 466f 7220            # For 
+0001fd10: 7479 7065 7320 7468 6174 2077 6520 646f  types that we do
+0001fd20: 206e 6f74 2075 6e64 6572 7374 616e 6420   not understand 
+0001fd30: 646f 2073 7465 7077 6973 650a 2020 2020  do stepwise.    
+0001fd40: 2020 2020 2020 2020 2020 2020 2320 696e              # in
+0001fd50: 7465 7270 6f6c 6174 696f 6e20 746f 2061  terpolation to a
+0001fd60: 766f 6964 206d 6f64 6966 7969 6e67 2074  void modifying t
+0001fd70: 6865 2065 6c65 6d65 6e74 732e 0a20 2020  he elements..   
+0001fd80: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+0001fd90: 6569 6e64 6578 2074 6865 2076 6172 6961  eindex the varia
+0001fda0: 626c 6520 696e 7374 6561 6420 6265 6361  ble instead beca
+0001fdb0: 7573 6520 6974 2073 7570 706f 7274 730a  use it supports.
+0001fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fdd0: 2320 626f 6f6c 6561 6e73 2061 6e64 206f  # booleans and o
+0001fde0: 626a 6563 7473 2061 6e64 2072 6574 6169  bjects and retai
+0001fdf0: 6e73 2074 6865 2064 7479 7065 2062 7574  ns the dtype but
+0001fe00: 2069 6e73 6964 650a 2020 2020 2020 2020   inside.        
+0001fe10: 2020 2020 2020 2020 2320 7468 6973 206c          # this l
+0001fe20: 6f6f 7020 7468 6572 6520 6d69 6768 7420  oop there might 
+0001fe30: 6265 2073 6f6d 6520 6475 706c 6963 6174  be some duplicat
+0001fe40: 6520 636f 6465 2074 6861 7420 736c 6f77  e code that slow
+0001fe50: 7320 6974 0a20 2020 2020 2020 2020 2020  s it.           
+0001fe60: 2020 2020 2023 2064 6f77 6e2c 2074 6865       # down, the
+0001fe70: 7265 666f 7265 2063 6f6c 6c65 6374 2074  refore collect t
+0001fe80: 6865 7365 2073 6967 6e61 6c73 2061 6e64  hese signals and
+0001fe90: 2072 756e 2069 7420 6c61 7465 723a 0a20   run it later:. 
+0001fea0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001feb0: 6569 6e64 6578 203d 2054 7275 650a 2020  eindex = True.  
+0001fec0: 2020 2020 2020 2020 2020 656c 6966 2061            elif a
+0001fed0: 6c6c 2864 206e 6f74 2069 6e20 696e 6465  ll(d not in inde
+0001fee0: 7865 7273 2066 6f72 2064 2069 6e20 7661  xers for d in va
+0001fef0: 722e 6469 6d73 293a 0a20 2020 2020 2020  r.dims):.       
+0001ff00: 2020 2020 2020 2020 2023 2046 6f72 2061           # For a
+0001ff10: 6e79 7468 696e 6720 656c 7365 2077 6520  nything else we 
+0001ff20: 6361 6e20 6f6e 6c79 206b 6565 7020 7661  can only keep va
+0001ff30: 7269 6162 6c65 7320 6966 2074 6865 790a  riables if they.
+0001ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff50: 2320 6172 6520 6e6f 7420 6465 7065 6e64  # are not depend
+0001ff60: 656e 7420 6f6e 2061 6e79 2063 6f6f 7264  ent on any coord
+0001ff70: 7320 7468 6174 2061 7265 2062 6569 6e67  s that are being
+0001ff80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ff90: 2023 2069 6e74 6572 706f 6c61 7465 6420   # interpolated 
+0001ffa0: 616c 6f6e 673a 0a20 2020 2020 2020 2020  along:.         
+0001ffb0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0001ffc0: 5b6e 616d 655d 203d 2076 6172 0a0a 2020  [name] = var..  
+0001ffd0: 2020 2020 2020 6966 2072 6569 6e64 6578        if reindex
+0001ffe0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001fff0: 696e 6465 785f 696e 6465 7865 7273 203d  index_indexers =
+00020000: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00020010: 2020 206b 3a20 7620 666f 7220 6b2c 2028     k: v for k, (
+00020020: 5f2c 2076 2920 696e 2076 616c 6964 6174  _, v) in validat
+00020030: 6564 5f69 6e64 6578 6572 732e 6974 656d  ed_indexers.item
+00020040: 7328 2920 6966 2076 2e64 696d 7320 3d3d  s() if v.dims ==
+00020050: 2028 6b2c 290a 2020 2020 2020 2020 2020   (k,).          
+00020060: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+00020070: 7265 696e 6465 7865 6420 3d20 616c 6967  reindexed = alig
+00020080: 6e6d 656e 742e 7265 696e 6465 7828 0a20  nment.reindex(. 
+00020090: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000200a0: 626a 2c0a 2020 2020 2020 2020 2020 2020  bj,.            
+000200b0: 2020 2020 696e 6465 7865 7273 3d72 6569      indexers=rei
+000200c0: 6e64 6578 5f69 6e64 6578 6572 732c 0a20  ndex_indexers,. 
+000200d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000200e0: 6574 686f 643d 6d65 7468 6f64 5f6e 6f6e  ethod=method_non
+000200f0: 5f6e 756d 6572 6963 2c0a 2020 2020 2020  _numeric,.      
+00020100: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00020110: 655f 7661 7273 3d76 6172 6961 626c 6573  e_vars=variables
+00020120: 2e6b 6579 7328 292c 0a20 2020 2020 2020  .keys(),.       
+00020130: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00020140: 2020 2069 6e64 6578 6573 203d 2064 6963     indexes = dic
+00020150: 7428 7265 696e 6465 7865 642e 5f69 6e64  t(reindexed._ind
+00020160: 6578 6573 290a 2020 2020 2020 2020 2020  exes).          
+00020170: 2020 7661 7269 6162 6c65 732e 7570 6461    variables.upda
+00020180: 7465 2872 6569 6e64 6578 6564 2e76 6172  te(reindexed.var
+00020190: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
+000201a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000201b0: 2020 2320 4765 7420 7468 6520 696e 6465    # Get the inde
+000201c0: 7865 7320 7468 6174 2061 7265 206e 6f74  xes that are not
+000201d0: 2062 6569 6e67 2069 6e74 6572 706f 6c61   being interpola
+000201e0: 7465 6420 616c 6f6e 670a 2020 2020 2020  ted along.      
+000201f0: 2020 2020 2020 696e 6465 7865 7320 3d20        indexes = 
+00020200: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+00020210: 6e20 6f62 6a2e 5f69 6e64 6578 6573 2e69  n obj._indexes.i
+00020220: 7465 6d73 2829 2069 6620 6b20 6e6f 7420  tems() if k not 
+00020230: 696e 2069 6e64 6578 6572 737d 0a0a 2020  in indexers}..  
+00020240: 2020 2020 2020 2320 4765 7420 7468 6520        # Get the 
+00020250: 636f 6f72 6473 2074 6861 7420 616c 736f  coords that also
+00020260: 2065 7869 7374 2069 6e20 7468 6520 7661   exist in the va
+00020270: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+00020280: 2063 6f6f 7264 5f6e 616d 6573 203d 206f   coord_names = o
+00020290: 626a 2e5f 636f 6f72 645f 6e61 6d65 7320  bj._coord_names 
+000202a0: 2620 7661 7269 6162 6c65 732e 6b65 7973  & variables.keys
+000202b0: 2829 0a20 2020 2020 2020 2073 656c 6563  ().        selec
+000202c0: 7465 6420 3d20 7365 6c66 2e5f 7265 706c  ted = self._repl
+000202d0: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
+000202e0: 7328 0a20 2020 2020 2020 2020 2020 2076  s(.            v
+000202f0: 6172 6961 626c 6573 2e63 6f70 7928 292c  ariables.copy(),
+00020300: 2063 6f6f 7264 5f6e 616d 6573 2c20 696e   coord_names, in
+00020310: 6465 7865 733d 696e 6465 7865 730a 2020  dexes=indexes.  
+00020320: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00020330: 2023 2041 7474 6163 6820 696e 6465 7865   # Attach indexe
+00020340: 7220 6173 2063 6f6f 7264 696e 6174 650a  r as coordinate.
+00020350: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+00020360: 2069 6e20 696e 6465 7865 7273 2e69 7465   in indexers.ite
+00020370: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00020380: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+00020390: 6e63 6528 762c 2056 6172 6961 626c 6529  nce(v, Variable)
+000203a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000203b0: 762e 6469 6d73 203d 3d20 286b 2c29 3a0a  v.dims == (k,):.
+000203c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203d0: 696e 6465 7820 3d20 5061 6e64 6173 496e  index = PandasIn
+000203e0: 6465 7828 762c 206b 2c20 636f 6f72 645f  dex(v, k, coord_
+000203f0: 6474 7970 653d 762e 6474 7970 6529 0a20  dtype=v.dtype). 
+00020400: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00020410: 6e64 6578 5f76 6172 7320 3d20 696e 6465  ndex_vars = inde
+00020420: 782e 6372 6561 7465 5f76 6172 6961 626c  x.create_variabl
+00020430: 6573 287b 6b3a 2076 7d29 0a20 2020 2020  es({k: v}).     
+00020440: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00020450: 6573 5b6b 5d20 3d20 696e 6465 780a 2020  es[k] = index.  
+00020460: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00020470: 7269 6162 6c65 732e 7570 6461 7465 2869  riables.update(i
+00020480: 6e64 6578 5f76 6172 7329 0a20 2020 2020  ndex_vars).     
+00020490: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000204a0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+000204b0: 6961 626c 6573 5b6b 5d20 3d20 760a 0a20  iables[k] = v.. 
+000204c0: 2020 2020 2020 2023 2045 7874 7261 6374         # Extract
+000204d0: 2063 6f6f 7264 696e 6174 6573 2066 726f   coordinates fro
+000204e0: 6d20 696e 6465 7865 7273 0a20 2020 2020  m indexers.     
+000204f0: 2020 2063 6f6f 7264 5f76 6172 732c 206e     coord_vars, n
+00020500: 6577 5f69 6e64 6578 6573 203d 2073 656c  ew_indexes = sel
+00020510: 6563 7465 642e 5f67 6574 5f69 6e64 6578  ected._get_index
+00020520: 6572 735f 636f 6f72 6473 5f61 6e64 5f69  ers_coords_and_i
+00020530: 6e64 6578 6573 2863 6f6f 7264 7329 0a20  ndexes(coords). 
+00020540: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00020550: 2e75 7064 6174 6528 636f 6f72 645f 7661  .update(coord_va
+00020560: 7273 290a 2020 2020 2020 2020 696e 6465  rs).        inde
+00020570: 7865 732e 7570 6461 7465 286e 6577 5f69  xes.update(new_i
+00020580: 6e64 6578 6573 290a 0a20 2020 2020 2020  ndexes)..       
+00020590: 2063 6f6f 7264 5f6e 616d 6573 203d 206f   coord_names = o
+000205a0: 626a 2e5f 636f 6f72 645f 6e61 6d65 7320  bj._coord_names 
+000205b0: 2620 7661 7269 6162 6c65 732e 6b65 7973  & variables.keys
+000205c0: 2829 207c 2063 6f6f 7264 5f76 6172 732e  () | coord_vars.
+000205d0: 6b65 7973 2829 0a20 2020 2020 2020 2072  keys().        r
+000205e0: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
+000205f0: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
+00020600: 7328 7661 7269 6162 6c65 732c 2063 6f6f  s(variables, coo
+00020610: 7264 5f6e 616d 6573 2c20 696e 6465 7865  rd_names, indexe
+00020620: 733d 696e 6465 7865 7329 0a0a 2020 2020  s=indexes)..    
+00020630: 6465 6620 696e 7465 7270 5f6c 696b 6528  def interp_like(
+00020640: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00020650: 2020 2020 2020 206f 7468 6572 3a20 4461         other: Da
+00020660: 7461 7365 7420 7c20 4461 7461 4172 7261  taset | DataArra
+00020670: 792c 0a20 2020 2020 2020 206d 6574 686f  y,.        metho
+00020680: 643a 2049 6e74 6572 704f 7074 696f 6e73  d: InterpOptions
+00020690: 203d 2022 6c69 6e65 6172 222c 0a20 2020   = "linear",.   
+000206a0: 2020 2020 2061 7373 756d 655f 736f 7274       assume_sort
+000206b0: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
+000206c0: 2c0a 2020 2020 2020 2020 6b77 6172 6773  ,.        kwargs
+000206d0: 3a20 4d61 7070 696e 675b 7374 722c 2041  : Mapping[str, A
+000206e0: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
+000206f0: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
+00020700: 645f 6e6f 6e5f 6e75 6d65 7269 633a 2073  d_non_numeric: s
+00020710: 7472 203d 2022 6e65 6172 6573 7422 2c0a  tr = "nearest",.
+00020720: 2020 2020 2920 2d3e 2044 6174 6173 6574      ) -> Dataset
+00020730: 3a0a 2020 2020 2020 2020 2222 2249 6e74  :.        """Int
+00020740: 6572 706f 6c61 7465 2074 6869 7320 6f62  erpolate this ob
+00020750: 6a65 6374 206f 6e74 6f20 7468 6520 636f  ject onto the co
+00020760: 6f72 6469 6e61 7465 7320 6f66 2061 6e6f  ordinates of ano
+00020770: 7468 6572 206f 626a 6563 742c 0a20 2020  ther object,.   
+00020780: 2020 2020 2066 696c 6c69 6e67 2074 6865       filling the
+00020790: 206f 7574 206f 6620 7261 6e67 6520 7661   out of range va
+000207a0: 6c75 6573 2077 6974 6820 4e61 4e2e 0a0a  lues with NaN...
+000207b0: 2020 2020 2020 2020 4966 2069 6e74 6572          If inter
+000207c0: 706f 6c61 7469 6e67 2061 6c6f 6e67 2061  polating along a
+000207d0: 2073 696e 676c 6520 6578 6973 7469 6e67   single existing
+000207e0: 2064 696d 656e 7369 6f6e 2c0a 2020 2020   dimension,.    
+000207f0: 2020 2020 3a70 793a 636c 6173 733a 6073      :py:class:`s
+00020800: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
+00020810: 2e69 6e74 6572 7031 6460 2069 7320 6361  .interp1d` is ca
+00020820: 6c6c 6564 2e20 5768 656e 2069 6e74 6572  lled. When inter
+00020830: 706f 6c61 7469 6e67 0a20 2020 2020 2020  polating.       
+00020840: 2061 6c6f 6e67 206d 756c 7469 706c 6520   along multiple 
+00020850: 6578 6973 7469 6e67 2064 696d 656e 7369  existing dimensi
+00020860: 6f6e 732c 2061 6e20 6174 7465 6d70 7420  ons, an attempt 
+00020870: 6973 206d 6164 6520 746f 2064 6563 6f6d  is made to decom
+00020880: 706f 7365 2074 6865 0a20 2020 2020 2020  pose the.       
+00020890: 2069 6e74 6572 706f 6c61 7469 6f6e 2069   interpolation i
+000208a0: 6e74 6f20 6d75 6c74 6970 6c65 2031 2d64  nto multiple 1-d
+000208b0: 696d 656e 7369 6f6e 616c 2069 6e74 6572  imensional inter
+000208c0: 706f 6c61 7469 6f6e 732e 2049 6620 7468  polations. If th
+000208d0: 6973 2069 730a 2020 2020 2020 2020 706f  is is.        po
+000208e0: 7373 6962 6c65 2c20 3a70 793a 636c 6173  ssible, :py:clas
+000208f0: 733a 6073 6369 7079 2e69 6e74 6572 706f  s:`scipy.interpo
+00020900: 6c61 7465 2e69 6e74 6572 7031 6460 2069  late.interp1d` i
+00020910: 7320 6361 6c6c 6564 2e20 4f74 6865 7277  s called. Otherw
+00020920: 6973 652c 0a20 2020 2020 2020 203a 7079  ise,.        :py
+00020930: 3a66 756e 633a 6073 6369 7079 2e69 6e74  :func:`scipy.int
+00020940: 6572 706f 6c61 7465 2e69 6e74 6572 706e  erpolate.interpn
+00020950: 6020 6973 2063 616c 6c65 642e 0a0a 2020  ` is called...  
+00020960: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00020970: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00020980: 2d2d 2d0a 2020 2020 2020 2020 6f74 6865  ---.        othe
+00020990: 7220 3a20 4461 7461 7365 7420 6f72 2044  r : Dataset or D
+000209a0: 6174 6141 7272 6179 0a20 2020 2020 2020  ataArray.       
+000209b0: 2020 2020 204f 626a 6563 7420 7769 7468       Object with
+000209c0: 2061 6e20 2769 6e64 6578 6573 2720 6174   an 'indexes' at
+000209d0: 7472 6962 7574 6520 6769 7669 6e67 2061  tribute giving a
+000209e0: 206d 6170 7069 6e67 2066 726f 6d20 6469   mapping from di
+000209f0: 6d65 6e73 696f 6e0a 2020 2020 2020 2020  mension.        
+00020a00: 2020 2020 6e61 6d65 7320 746f 2061 6e20      names to an 
+00020a10: 3164 2061 7272 6179 2d6c 696b 652c 2077  1d array-like, w
+00020a20: 6869 6368 2070 726f 7669 6465 7320 636f  hich provides co
+00020a30: 6f72 6469 6e61 7465 7320 7570 6f6e 0a20  ordinates upon. 
+00020a40: 2020 2020 2020 2020 2020 2077 6869 6368             which
+00020a50: 2074 6f20 696e 6465 7820 7468 6520 7661   to index the va
+00020a60: 7269 6162 6c65 7320 696e 2074 6869 7320  riables in this 
+00020a70: 6461 7461 7365 742e 204d 6973 7369 6e67  dataset. Missing
+00020a80: 2076 616c 7565 7320 6172 6520 736b 6970   values are skip
+00020a90: 7065 642e 0a20 2020 2020 2020 206d 6574  ped..        met
+00020aa0: 686f 6420 3a20 7b22 6c69 6e65 6172 222c  hod : {"linear",
+00020ab0: 2022 6e65 6172 6573 7422 2c20 227a 6572   "nearest", "zer
+00020ac0: 6f22 2c20 2273 6c69 6e65 6172 222c 2022  o", "slinear", "
+00020ad0: 7175 6164 7261 7469 6322 2c20 2263 7562  quadratic", "cub
+00020ae0: 6963 222c 2022 706f 6c79 6e6f 6d69 616c  ic", "polynomial
+00020af0: 222c 205c 0a20 2020 2020 2020 2020 2020  ", \.           
+00020b00: 2022 6261 7279 6365 6e74 7269 6322 2c20   "barycentric", 
+00020b10: 226b 726f 6722 2c20 2270 6368 6970 222c  "krog", "pchip",
+00020b20: 2022 7370 6c69 6e65 222c 2022 616b 696d   "spline", "akim
+00020b30: 6122 7d2c 2064 6566 6175 6c74 3a20 226c  a"}, default: "l
+00020b40: 696e 6561 7222 0a20 2020 2020 2020 2020  inear".         
+00020b50: 2020 2053 7472 696e 6720 696e 6469 6361     String indica
+00020b60: 7469 6e67 2077 6869 6368 206d 6574 686f  ting which metho
+00020b70: 6420 746f 2075 7365 2066 6f72 2069 6e74  d to use for int
+00020b80: 6572 706f 6c61 7469 6f6e 3a0a 0a20 2020  erpolation:..   
+00020b90: 2020 2020 2020 2020 202d 2027 6c69 6e65           - 'line
+00020ba0: 6172 273a 206c 696e 6561 7220 696e 7465  ar': linear inte
+00020bb0: 7270 6f6c 6174 696f 6e2e 2041 6464 6974  rpolation. Addit
+00020bc0: 696f 6e61 6c20 6b65 7977 6f72 640a 2020  ional keyword.  
+00020bd0: 2020 2020 2020 2020 2020 2020 6172 6775              argu
+00020be0: 6d65 6e74 7320 6172 6520 7061 7373 6564  ments are passed
+00020bf0: 2074 6f20 3a70 793a 6675 6e63 3a60 6e75   to :py:func:`nu
+00020c00: 6d70 792e 696e 7465 7270 600a 2020 2020  mpy.interp`.    
+00020c10: 2020 2020 2020 2020 2d20 276e 6561 7265          - 'neare
+00020c20: 7374 272c 2027 7a65 726f 272c 2027 736c  st', 'zero', 'sl
+00020c30: 696e 6561 7227 2c20 2771 7561 6472 6174  inear', 'quadrat
+00020c40: 6963 272c 2027 6375 6269 6327 2c20 2770  ic', 'cubic', 'p
+00020c50: 6f6c 796e 6f6d 6961 6c27 3a0a 2020 2020  olynomial':.    
+00020c60: 2020 2020 2020 2020 2020 6172 6520 7061            are pa
+00020c70: 7373 6564 2074 6f20 3a70 793a 6675 6e63  ssed to :py:func
+00020c80: 3a60 7363 6970 792e 696e 7465 7270 6f6c  :`scipy.interpol
+00020c90: 6174 652e 696e 7465 7270 3164 602e 2049  ate.interp1d`. I
+00020ca0: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+00020cb0: 6060 6d65 7468 6f64 3d27 706f 6c79 6e6f  ``method='polyno
+00020cc0: 6d69 616c 2760 602c 2074 6865 2060 606f  mial'``, the ``o
+00020cd0: 7264 6572 6060 206b 6579 776f 7264 2061  rder`` keyword a
+00020ce0: 7267 756d 656e 7420 6d75 7374 2061 6c73  rgument must als
+00020cf0: 6f20 6265 0a20 2020 2020 2020 2020 2020  o be.           
+00020d00: 2020 2070 726f 7669 6465 642e 0a20 2020     provided..   
+00020d10: 2020 2020 2020 2020 202d 2027 6261 7279           - 'bary
+00020d20: 6365 6e74 7269 6327 2c20 276b 726f 6727  centric', 'krog'
+00020d30: 2c20 2770 6368 6970 272c 2027 7370 6c69  , 'pchip', 'spli
+00020d40: 6e65 272c 2027 616b 696d 6127 3a20 7573  ne', 'akima': us
+00020d50: 6520 7468 6569 720a 2020 2020 2020 2020  e their.        
+00020d60: 2020 2020 2020 7265 7370 6563 7469 7665        respective
+00020d70: 203a 7079 3a63 6c61 7373 3a60 7363 6970   :py:class:`scip
+00020d80: 792e 696e 7465 7270 6f6c 6174 6560 2063  y.interpolate` c
+00020d90: 6c61 7373 6573 2e0a 0a20 2020 2020 2020  lasses...       
+00020da0: 2061 7373 756d 655f 736f 7274 6564 203a   assume_sorted :
+00020db0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
+00020dc0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00020dd0: 2020 4966 2046 616c 7365 2c20 7661 6c75    If False, valu
+00020de0: 6573 206f 6620 636f 6f72 6469 6e61 7465  es of coordinate
+00020df0: 7320 7468 6174 2061 7265 2069 6e74 6572  s that are inter
+00020e00: 706f 6c61 7465 6420 6f76 6572 2063 616e  polated over can
+00020e10: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
+00020e20: 696e 2061 6e79 206f 7264 6572 2061 6e64  in any order and
+00020e30: 2074 6865 7920 6172 6520 736f 7274 6564   they are sorted
+00020e40: 2066 6972 7374 2e20 4966 2054 7275 652c   first. If True,
+00020e50: 2069 6e74 6572 706f 6c61 7465 640a 2020   interpolated.  
+00020e60: 2020 2020 2020 2020 2020 636f 6f72 6469            coordi
+00020e70: 6e61 7465 7320 6172 6520 6173 7375 6d65  nates are assume
+00020e80: 6420 746f 2062 6520 616e 2061 7272 6179  d to be an array
+00020e90: 206f 6620 6d6f 6e6f 746f 6e69 6361 6c6c   of monotonicall
+00020ea0: 7920 696e 6372 6561 7369 6e67 0a20 2020  y increasing.   
+00020eb0: 2020 2020 2020 2020 2076 616c 7565 732e           values.
+00020ec0: 0a20 2020 2020 2020 206b 7761 7267 7320  .        kwargs 
+00020ed0: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
+00020ee0: 0a20 2020 2020 2020 2020 2020 2041 6464  .            Add
+00020ef0: 6974 696f 6e61 6c20 6b65 7977 6f72 6420  itional keyword 
+00020f00: 7061 7373 6564 2074 6f20 7363 6970 7927  passed to scipy'
+00020f10: 7320 696e 7465 7270 6f6c 6174 6f72 2e0a  s interpolator..
+00020f20: 2020 2020 2020 2020 6d65 7468 6f64 5f6e          method_n
+00020f30: 6f6e 5f6e 756d 6572 6963 203a 207b 226e  on_numeric : {"n
+00020f40: 6561 7265 7374 222c 2022 7061 6422 2c20  earest", "pad", 
+00020f50: 2266 6669 6c6c 222c 2022 6261 636b 6669  "ffill", "backfi
+00020f60: 6c6c 222c 2022 6266 696c 6c22 7d2c 206f  ll", "bfill"}, o
+00020f70: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00020f80: 2020 2020 4d65 7468 6f64 2066 6f72 206e      Method for n
+00020f90: 6f6e 2d6e 756d 6572 6963 2074 7970 6573  on-numeric types
+00020fa0: 2e20 5061 7373 6564 206f 6e20 746f 203a  . Passed on to :
+00020fb0: 7079 3a6d 6574 683a 6044 6174 6173 6574  py:meth:`Dataset
+00020fc0: 2e72 6569 6e64 6578 602e 0a20 2020 2020  .reindex`..     
+00020fd0: 2020 2020 2020 2060 6022 6e65 6172 6573         ``"neares
+00020fe0: 7422 6060 2069 7320 7573 6564 2062 7920  t"`` is used by 
+00020ff0: 6465 6661 756c 742e 0a0a 2020 2020 2020  default...      
+00021000: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00021010: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00021020: 2020 696e 7465 7270 6f6c 6174 6564 203a    interpolated :
+00021030: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
+00021040: 2020 2020 2041 6e6f 7468 6572 2064 6174       Another dat
+00021050: 6173 6574 2062 7920 696e 7465 7270 6f6c  aset by interpol
+00021060: 6174 696e 6720 7468 6973 2064 6174 6173  ating this datas
+00021070: 6574 2773 2064 6174 6120 616c 6f6e 6720  et's data along 
+00021080: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00021090: 636f 6f72 6469 6e61 7465 7320 6f66 2074  coordinates of t
+000210a0: 6865 206f 7468 6572 206f 626a 6563 742e  he other object.
+000210b0: 0a0a 2020 2020 2020 2020 4e6f 7465 730a  ..        Notes.
+000210c0: 2020 2020 2020 2020 2d2d 2d2d 2d0a 2020          -----.  
+000210d0: 2020 2020 2020 7363 6970 7920 6973 2072        scipy is r
+000210e0: 6571 7569 7265 642e 0a20 2020 2020 2020  equired..       
+000210f0: 2049 6620 7468 6520 6461 7461 7365 7420   If the dataset 
+00021100: 6861 7320 6f62 6a65 6374 2d74 7970 6520  has object-type 
+00021110: 636f 6f72 6469 6e61 7465 732c 2072 6569  coordinates, rei
+00021120: 6e64 6578 2069 7320 7573 6564 2066 6f72  ndex is used for
+00021130: 2074 6865 7365 0a20 2020 2020 2020 2063   these.        c
+00021140: 6f6f 7264 696e 6174 6573 2069 6e73 7465  oordinates inste
+00021150: 6164 206f 6620 7468 6520 696e 7465 7270  ad of the interp
+00021160: 6f6c 6174 696f 6e2e 0a0a 2020 2020 2020  olation...      
+00021170: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00021180: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00021190: 2020 2020 4461 7461 7365 742e 696e 7465      Dataset.inte
+000211a0: 7270 0a20 2020 2020 2020 2044 6174 6173  rp.        Datas
+000211b0: 6574 2e72 6569 6e64 6578 5f6c 696b 650a  et.reindex_like.
+000211c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000211d0: 2020 2020 6966 206b 7761 7267 7320 6973      if kwargs is
+000211e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000211f0: 2020 206b 7761 7267 7320 3d20 7b7d 0a0a     kwargs = {}..
+00021200: 2020 2020 2020 2020 2320 7069 636b 206f          # pick o
+00021210: 6e6c 7920 6469 6d65 6e73 696f 6e20 636f  nly dimension co
+00021220: 6f72 6469 6e61 7465 7320 7769 7468 2061  ordinates with a
+00021230: 2073 696e 676c 6520 696e 6465 780a 2020   single index.  
+00021240: 2020 2020 2020 636f 6f72 6473 203d 207b        coords = {
+00021250: 7d0a 2020 2020 2020 2020 6f74 6865 725f  }.        other_
+00021260: 696e 6465 7865 7320 3d20 6f74 6865 722e  indexes = other.
+00021270: 7869 6e64 6578 6573 0a20 2020 2020 2020  xindexes.       
+00021280: 2066 6f72 2064 696d 2069 6e20 7365 6c66   for dim in self
+00021290: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
+000212a0: 2020 206f 7468 6572 5f64 696d 5f63 6f6f     other_dim_coo
+000212b0: 7264 7320 3d20 6f74 6865 725f 696e 6465  rds = other_inde
+000212c0: 7865 732e 6765 745f 616c 6c5f 636f 6f72  xes.get_all_coor
+000212d0: 6473 2864 696d 2c20 6572 726f 7273 3d22  ds(dim, errors="
+000212e0: 6967 6e6f 7265 2229 0a20 2020 2020 2020  ignore").       
+000212f0: 2020 2020 2069 6620 6c65 6e28 6f74 6865       if len(othe
+00021300: 725f 6469 6d5f 636f 6f72 6473 2920 3d3d  r_dim_coords) ==
+00021310: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00021320: 2020 2020 636f 6f72 6473 5b64 696d 5d20      coords[dim] 
+00021330: 3d20 6f74 6865 725f 6469 6d5f 636f 6f72  = other_dim_coor
+00021340: 6473 5b64 696d 5d0a 0a20 2020 2020 2020  ds[dim]..       
+00021350: 206e 756d 6572 6963 5f63 6f6f 7264 733a   numeric_coords:
+00021360: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+00021370: 7064 2e49 6e64 6578 5d20 3d20 7b7d 0a20  pd.Index] = {}. 
+00021380: 2020 2020 2020 206f 626a 6563 745f 636f         object_co
+00021390: 6f72 6473 3a20 6469 6374 5b48 6173 6861  ords: dict[Hasha
+000213a0: 626c 652c 2070 642e 496e 6465 785d 203d  ble, pd.Index] =
+000213b0: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+000213c0: 6b2c 2076 2069 6e20 636f 6f72 6473 2e69  k, v in coords.i
+000213d0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+000213e0: 2020 2020 6966 2076 2e64 7479 7065 2e6b      if v.dtype.k
+000213f0: 696e 6420 696e 2022 7569 6663 4d6d 223a  ind in "uifcMm":
+00021400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021410: 206e 756d 6572 6963 5f63 6f6f 7264 735b   numeric_coords[
+00021420: 6b5d 203d 2076 0a20 2020 2020 2020 2020  k] = v.         
+00021430: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00021440: 2020 2020 2020 2020 206f 626a 6563 745f           object_
+00021450: 636f 6f72 6473 5b6b 5d20 3d20 760a 0a20  coords[k] = v.. 
+00021460: 2020 2020 2020 2064 7320 3d20 7365 6c66         ds = self
+00021470: 0a20 2020 2020 2020 2069 6620 6f62 6a65  .        if obje
+00021480: 6374 5f63 6f6f 7264 733a 0a20 2020 2020  ct_coords:.     
+00021490: 2020 2020 2020 2023 2057 6520 646f 206e         # We do n
+000214a0: 6f74 2073 7570 706f 7274 2069 6e74 6572  ot support inter
+000214b0: 706f 6c61 7469 6f6e 2061 6c6f 6e67 206f  polation along o
+000214c0: 626a 6563 7420 636f 6f72 6469 6e61 7465  bject coordinate
+000214d0: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000214e0: 7265 696e 6465 7820 696e 7374 6561 642e  reindex instead.
+000214f0: 0a20 2020 2020 2020 2020 2020 2064 7320  .            ds 
+00021500: 3d20 7365 6c66 2e72 6569 6e64 6578 286f  = self.reindex(o
+00021510: 626a 6563 745f 636f 6f72 6473 290a 2020  bject_coords).  
+00021520: 2020 2020 2020 7265 7475 726e 2064 732e        return ds.
+00021530: 696e 7465 7270 280a 2020 2020 2020 2020  interp(.        
+00021540: 2020 2020 636f 6f72 6473 3d6e 756d 6572      coords=numer
+00021550: 6963 5f63 6f6f 7264 732c 0a20 2020 2020  ic_coords,.     
+00021560: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00021570: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
+00021580: 2020 6173 7375 6d65 5f73 6f72 7465 643d    assume_sorted=
+00021590: 6173 7375 6d65 5f73 6f72 7465 642c 0a20  assume_sorted,. 
+000215a0: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+000215b0: 733d 6b77 6172 6773 2c0a 2020 2020 2020  s=kwargs,.      
+000215c0: 2020 2020 2020 6d65 7468 6f64 5f6e 6f6e        method_non
+000215d0: 5f6e 756d 6572 6963 3d6d 6574 686f 645f  _numeric=method_
+000215e0: 6e6f 6e5f 6e75 6d65 7269 632c 0a20 2020  non_numeric,.   
+000215f0: 2020 2020 2029 0a0a 2020 2020 2320 4865       )..    # He
+00021600: 6c70 6572 206d 6574 686f 6473 2066 6f72  lper methods for
+00021610: 2072 656e 616d 6528 290a 2020 2020 6465   rename().    de
+00021620: 6620 5f72 656e 616d 655f 7661 7273 280a  f _rename_vars(.
+00021630: 2020 2020 2020 2020 7365 6c66 2c20 6e61          self, na
+00021640: 6d65 5f64 6963 742c 2064 696d 735f 6469  me_dict, dims_di
+00021650: 6374 0a20 2020 2029 202d 3e20 7475 706c  ct.    ) -> tupl
+00021660: 655b 6469 6374 5b48 6173 6861 626c 652c  e[dict[Hashable,
+00021670: 2056 6172 6961 626c 655d 2c20 7365 745b   Variable], set[
+00021680: 4861 7368 6162 6c65 5d5d 3a0a 2020 2020  Hashable]]:.    
+00021690: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
+000216a0: 7b7d 0a20 2020 2020 2020 2063 6f6f 7264  {}.        coord
+000216b0: 5f6e 616d 6573 203d 2073 6574 2829 0a20  _names = set(). 
+000216c0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+000216d0: 696e 2073 656c 662e 7661 7269 6162 6c65  in self.variable
+000216e0: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+000216f0: 2020 2020 2020 2076 6172 203d 2076 2e63         var = v.c
+00021700: 6f70 7928 6465 6570 3d46 616c 7365 290a  opy(deep=False).
+00021710: 2020 2020 2020 2020 2020 2020 7661 722e              var.
+00021720: 6469 6d73 203d 2074 7570 6c65 2864 696d  dims = tuple(dim
+00021730: 735f 6469 6374 2e67 6574 2864 696d 2c20  s_dict.get(dim, 
+00021740: 6469 6d29 2066 6f72 2064 696d 2069 6e20  dim) for dim in 
+00021750: 762e 6469 6d73 290a 2020 2020 2020 2020  v.dims).        
+00021760: 2020 2020 6e61 6d65 203d 206e 616d 655f      name = name_
+00021770: 6469 6374 2e67 6574 286b 2c20 6b29 0a20  dict.get(k, k). 
+00021780: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
+00021790: 6d65 2069 6e20 7661 7269 6162 6c65 733a  me in variables:
+000217a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000217b0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000217c0: 7228 6622 7468 6520 6e65 7720 6e61 6d65  r(f"the new name
+000217d0: 207b 6e61 6d65 2172 7d20 636f 6e66 6c69   {name!r} confli
+000217e0: 6374 7322 290a 2020 2020 2020 2020 2020  cts").          
+000217f0: 2020 7661 7269 6162 6c65 735b 6e61 6d65    variables[name
+00021800: 5d20 3d20 7661 720a 2020 2020 2020 2020  ] = var.        
+00021810: 2020 2020 6966 206b 2069 6e20 7365 6c66      if k in self
+00021820: 2e5f 636f 6f72 645f 6e61 6d65 733a 0a20  ._coord_names:. 
+00021830: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00021840: 6f6f 7264 5f6e 616d 6573 2e61 6464 286e  oord_names.add(n
+00021850: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
+00021860: 7572 6e20 7661 7269 6162 6c65 732c 2063  urn variables, c
+00021870: 6f6f 7264 5f6e 616d 6573 0a0a 2020 2020  oord_names..    
+00021880: 6465 6620 5f72 656e 616d 655f 6469 6d73  def _rename_dims
+00021890: 2873 656c 662c 206e 616d 655f 6469 6374  (self, name_dict
+000218a0: 3a20 4d61 7070 696e 675b 416e 792c 2048  : Mapping[Any, H
+000218b0: 6173 6861 626c 655d 2920 2d3e 2064 6963  ashable]) -> dic
+000218c0: 745b 4861 7368 6162 6c65 2c20 696e 745d  t[Hashable, int]
+000218d0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000218e0: 207b 6e61 6d65 5f64 6963 742e 6765 7428   {name_dict.get(
+000218f0: 6b2c 206b 293a 2076 2066 6f72 206b 2c20  k, k): v for k, 
+00021900: 7620 696e 2073 656c 662e 6469 6d73 2e69  v in self.dims.i
+00021910: 7465 6d73 2829 7d0a 0a20 2020 2064 6566  tems()}..    def
+00021920: 205f 7265 6e61 6d65 5f69 6e64 6578 6573   _rename_indexes
+00021930: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00021940: 6e61 6d65 5f64 6963 743a 204d 6170 7069  name_dict: Mappi
+00021950: 6e67 5b41 6e79 2c20 4861 7368 6162 6c65  ng[Any, Hashable
+00021960: 5d2c 2064 696d 735f 6469 6374 3a20 4d61  ], dims_dict: Ma
+00021970: 7070 696e 675b 416e 792c 2048 6173 6861  pping[Any, Hasha
+00021980: 626c 655d 0a20 2020 2029 202d 3e20 7475  ble].    ) -> tu
+00021990: 706c 655b 6469 6374 5b48 6173 6861 626c  ple[dict[Hashabl
+000219a0: 652c 2049 6e64 6578 5d2c 2064 6963 745b  e, Index], dict[
+000219b0: 4861 7368 6162 6c65 2c20 5661 7269 6162  Hashable, Variab
+000219c0: 6c65 5d5d 3a0a 2020 2020 2020 2020 6966  le]]:.        if
+000219d0: 206e 6f74 2073 656c 662e 5f69 6e64 6578   not self._index
+000219e0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000219f0: 7265 7475 726e 207b 7d2c 207b 7d0a 0a20  return {}, {}.. 
+00021a00: 2020 2020 2020 2069 6e64 6578 6573 203d         indexes =
+00021a10: 207b 7d0a 2020 2020 2020 2020 7661 7269   {}.        vari
+00021a20: 6162 6c65 7320 3d20 7b7d 0a0a 2020 2020  ables = {}..    
+00021a30: 2020 2020 666f 7220 696e 6465 782c 2063      for index, c
+00021a40: 6f6f 7264 5f6e 616d 6573 2069 6e20 7365  oord_names in se
+00021a50: 6c66 2e78 696e 6465 7865 732e 6772 6f75  lf.xindexes.grou
+00021a60: 705f 6279 5f69 6e64 6578 2829 3a0a 2020  p_by_index():.  
+00021a70: 2020 2020 2020 2020 2020 6e65 775f 696e            new_in
+00021a80: 6465 7820 3d20 696e 6465 782e 7265 6e61  dex = index.rena
+00021a90: 6d65 286e 616d 655f 6469 6374 2c20 6469  me(name_dict, di
+00021aa0: 6d73 5f64 6963 7429 0a20 2020 2020 2020  ms_dict).       
+00021ab0: 2020 2020 206e 6577 5f63 6f6f 7264 5f6e       new_coord_n
+00021ac0: 616d 6573 203d 205b 6e61 6d65 5f64 6963  ames = [name_dic
+00021ad0: 742e 6765 7428 6b2c 206b 2920 666f 7220  t.get(k, k) for 
+00021ae0: 6b20 696e 2063 6f6f 7264 5f6e 616d 6573  k in coord_names
+00021af0: 5d0a 2020 2020 2020 2020 2020 2020 696e  ].            in
+00021b00: 6465 7865 732e 7570 6461 7465 287b 6b3a  dexes.update({k:
+00021b10: 206e 6577 5f69 6e64 6578 2066 6f72 206b   new_index for k
+00021b20: 2069 6e20 6e65 775f 636f 6f72 645f 6e61   in new_coord_na
+00021b30: 6d65 737d 290a 2020 2020 2020 2020 2020  mes}).          
+00021b40: 2020 6e65 775f 696e 6465 785f 7661 7273    new_index_vars
+00021b50: 203d 206e 6577 5f69 6e64 6578 2e63 7265   = new_index.cre
+00021b60: 6174 655f 7661 7269 6162 6c65 7328 0a20  ate_variables(. 
+00021b70: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+00021b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021b90: 2020 2020 206e 6577 3a20 7365 6c66 2e5f       new: self._
+00021ba0: 7661 7269 6162 6c65 735b 6f6c 645d 0a20  variables[old]. 
+00021bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021bc0: 2020 2066 6f72 206f 6c64 2c20 6e65 7720     for old, new 
+00021bd0: 696e 207a 6970 2863 6f6f 7264 5f6e 616d  in zip(coord_nam
+00021be0: 6573 2c20 6e65 775f 636f 6f72 645f 6e61  es, new_coord_na
+00021bf0: 6d65 7329 0a20 2020 2020 2020 2020 2020  mes).           
+00021c00: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00021c10: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00021c20: 2076 6172 6961 626c 6573 2e75 7064 6174   variables.updat
+00021c30: 6528 6e65 775f 696e 6465 785f 7661 7273  e(new_index_vars
+00021c40: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00021c50: 6e20 696e 6465 7865 732c 2076 6172 6961  n indexes, varia
+00021c60: 626c 6573 0a0a 2020 2020 6465 6620 5f72  bles..    def _r
+00021c70: 656e 616d 655f 616c 6c28 0a20 2020 2020  ename_all(.     
+00021c80: 2020 2073 656c 662c 206e 616d 655f 6469     self, name_di
+00021c90: 6374 3a20 4d61 7070 696e 675b 416e 792c  ct: Mapping[Any,
+00021ca0: 2048 6173 6861 626c 655d 2c20 6469 6d73   Hashable], dims
+00021cb0: 5f64 6963 743a 204d 6170 7069 6e67 5b41  _dict: Mapping[A
+00021cc0: 6e79 2c20 4861 7368 6162 6c65 5d0a 2020  ny, Hashable].  
+00021cd0: 2020 2920 2d3e 2074 7570 6c65 5b0a 2020    ) -> tuple[.  
+00021ce0: 2020 2020 2020 6469 6374 5b48 6173 6861        dict[Hasha
+00021cf0: 626c 652c 2056 6172 6961 626c 655d 2c0a  ble, Variable],.
+00021d00: 2020 2020 2020 2020 7365 745b 4861 7368          set[Hash
+00021d10: 6162 6c65 5d2c 0a20 2020 2020 2020 2064  able],.        d
+00021d20: 6963 745b 4861 7368 6162 6c65 2c20 696e  ict[Hashable, in
+00021d30: 745d 2c0a 2020 2020 2020 2020 6469 6374  t],.        dict
+00021d40: 5b48 6173 6861 626c 652c 2049 6e64 6578  [Hashable, Index
+00021d50: 5d2c 0a20 2020 205d 3a0a 2020 2020 2020  ],.    ]:.      
+00021d60: 2020 7661 7269 6162 6c65 732c 2063 6f6f    variables, coo
+00021d70: 7264 5f6e 616d 6573 203d 2073 656c 662e  rd_names = self.
+00021d80: 5f72 656e 616d 655f 7661 7273 286e 616d  _rename_vars(nam
+00021d90: 655f 6469 6374 2c20 6469 6d73 5f64 6963  e_dict, dims_dic
+00021da0: 7429 0a20 2020 2020 2020 2064 696d 7320  t).        dims 
+00021db0: 3d20 7365 6c66 2e5f 7265 6e61 6d65 5f64  = self._rename_d
+00021dc0: 696d 7328 6469 6d73 5f64 6963 7429 0a0a  ims(dims_dict)..
+00021dd0: 2020 2020 2020 2020 696e 6465 7865 732c          indexes,
+00021de0: 2069 6e64 6578 5f76 6172 7320 3d20 7365   index_vars = se
+00021df0: 6c66 2e5f 7265 6e61 6d65 5f69 6e64 6578  lf._rename_index
+00021e00: 6573 286e 616d 655f 6469 6374 2c20 6469  es(name_dict, di
+00021e10: 6d73 5f64 6963 7429 0a20 2020 2020 2020  ms_dict).       
+00021e20: 2076 6172 6961 626c 6573 203d 207b 6b3a   variables = {k:
+00021e30: 2069 6e64 6578 5f76 6172 732e 6765 7428   index_vars.get(
+00021e40: 6b2c 2076 2920 666f 7220 6b2c 2076 2069  k, v) for k, v i
+00021e50: 6e20 7661 7269 6162 6c65 732e 6974 656d  n variables.item
+00021e60: 7328 297d 0a0a 2020 2020 2020 2020 7265  s()}..        re
+00021e70: 7475 726e 2076 6172 6961 626c 6573 2c20  turn variables, 
+00021e80: 636f 6f72 645f 6e61 6d65 732c 2064 696d  coord_names, dim
+00021e90: 732c 2069 6e64 6578 6573 0a0a 2020 2020  s, indexes..    
+00021ea0: 6465 6620 5f72 656e 616d 6528 0a20 2020  def _rename(.   
+00021eb0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+00021ec0: 6173 6574 2c0a 2020 2020 2020 2020 6e61  aset,.        na
+00021ed0: 6d65 5f64 6963 743a 204d 6170 7069 6e67  me_dict: Mapping
+00021ee0: 5b41 6e79 2c20 4861 7368 6162 6c65 5d20  [Any, Hashable] 
+00021ef0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00021f00: 2020 2020 2020 202a 2a6e 616d 6573 3a20         **names: 
+00021f10: 4861 7368 6162 6c65 2c0a 2020 2020 2920  Hashable,.    ) 
+00021f20: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+00021f30: 2020 2020 2020 2222 2241 6c73 6f20 7573        """Also us
+00021f40: 6564 2069 6e74 6572 6e61 6c6c 7920 6279  ed internally by
+00021f50: 2044 6174 6141 7272 6179 2073 6f20 7468   DataArray so th
+00021f60: 6174 2074 6865 2077 6172 6e69 6e67 2028  at the warning (
+00021f70: 6966 2061 6e79 290a 2020 2020 2020 2020  if any).        
+00021f80: 6973 2072 6169 7365 6420 6174 2074 6865  is raised at the
+00021f90: 2072 6967 6874 2073 7461 636b 206c 6576   right stack lev
+00021fa0: 656c 2e0a 2020 2020 2020 2020 2222 220a  el..        """.
+00021fb0: 2020 2020 2020 2020 6e61 6d65 5f64 6963          name_dic
+00021fc0: 7420 3d20 6569 7468 6572 5f64 6963 745f  t = either_dict_
+00021fd0: 6f72 5f6b 7761 7267 7328 6e61 6d65 5f64  or_kwargs(name_d
+00021fe0: 6963 742c 206e 616d 6573 2c20 2272 656e  ict, names, "ren
+00021ff0: 616d 6522 290a 2020 2020 2020 2020 666f  ame").        fo
+00022000: 7220 6b20 696e 206e 616d 655f 6469 6374  r k in name_dict
+00022010: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
+00022020: 2020 2020 2069 6620 6b20 6e6f 7420 696e       if k not in
+00022030: 2073 656c 6620 616e 6420 6b20 6e6f 7420   self and k not 
+00022040: 696e 2073 656c 662e 6469 6d73 3a0a 2020  in self.dims:.  
+00022050: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00022060: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00022070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022080: 2020 2020 6622 6361 6e6e 6f74 2072 656e      f"cannot ren
+00022090: 616d 6520 7b6b 2172 7d20 6265 6361 7573  ame {k!r} becaus
+000220a0: 6520 6974 2069 7320 6e6f 7420 6120 220a  e it is not a ".
+000220b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000220c0: 2020 2020 2276 6172 6961 626c 6520 6f72      "variable or
+000220d0: 2064 696d 656e 7369 6f6e 2069 6e20 7468   dimension in th
+000220e0: 6973 2064 6174 6173 6574 220a 2020 2020  is dataset".    
+000220f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00022100: 2020 2020 2020 2020 2020 2063 7265 6174             creat
+00022110: 655f 6469 6d5f 636f 6f72 6420 3d20 4661  e_dim_coord = Fa
+00022120: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00022130: 6e65 775f 6b20 3d20 6e61 6d65 5f64 6963  new_k = name_dic
+00022140: 745b 6b5d 0a0a 2020 2020 2020 2020 2020  t[k]..          
+00022150: 2020 6966 206b 2069 6e20 7365 6c66 2e64    if k in self.d
+00022160: 696d 7320 616e 6420 6e65 775f 6b20 696e  ims and new_k in
+00022170: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
+00022180: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00022190: 2020 2020 636f 6f72 645f 6469 6d73 203d      coord_dims =
+000221a0: 2073 656c 662e 5f76 6172 6961 626c 6573   self._variables
+000221b0: 5b6e 616d 655f 6469 6374 5b6b 5d5d 2e64  [name_dict[k]].d
+000221c0: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
+000221d0: 2020 2020 6966 2063 6f6f 7264 5f64 696d      if coord_dim
+000221e0: 7320 3d3d 2028 6b2c 293a 0a20 2020 2020  s == (k,):.     
+000221f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00022200: 7265 6174 655f 6469 6d5f 636f 6f72 6420  reate_dim_coord 
+00022210: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00022220: 2020 2065 6c69 6620 6b20 696e 2073 656c     elif k in sel
+00022230: 662e 5f63 6f6f 7264 5f6e 616d 6573 2061  f._coord_names a
+00022240: 6e64 206e 6577 5f6b 2069 6e20 7365 6c66  nd new_k in self
+00022250: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
+00022260: 2020 2020 2020 2063 6f6f 7264 5f64 696d         coord_dim
+00022270: 7320 3d20 7365 6c66 2e5f 7661 7269 6162  s = self._variab
+00022280: 6c65 735b 6b5d 2e64 696d 730a 2020 2020  les[k].dims.    
+00022290: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000222a0: 6f6f 7264 5f64 696d 7320 3d3d 2028 6e65  oord_dims == (ne
+000222b0: 775f 6b2c 293a 0a20 2020 2020 2020 2020  w_k,):.         
+000222c0: 2020 2020 2020 2020 2020 2063 7265 6174             creat
+000222d0: 655f 6469 6d5f 636f 6f72 6420 3d20 5472  e_dim_coord = Tr
+000222e0: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+000222f0: 6966 2063 7265 6174 655f 6469 6d5f 636f  if create_dim_co
+00022300: 6f72 643a 0a20 2020 2020 2020 2020 2020  ord:.           
+00022310: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+00022320: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
+00022330: 2020 2020 2020 2020 6622 7265 6e61 6d65          f"rename
+00022340: 207b 6b21 727d 2074 6f20 7b6e 616d 655f   {k!r} to {name_
+00022350: 6469 6374 5b6b 5d21 727d 2064 6f65 7320  dict[k]!r} does 
+00022360: 6e6f 7420 6372 6561 7465 2061 6e20 696e  not create an in
+00022370: 6465 7820 220a 2020 2020 2020 2020 2020  dex ".          
+00022380: 2020 2020 2020 2020 2020 2261 6e79 6d6f            "anymo
+00022390: 7265 2e20 5472 7920 7573 696e 6720 7377  re. Try using sw
+000223a0: 6170 5f64 696d 7320 696e 7374 6561 6420  ap_dims instead 
+000223b0: 6f72 2075 7365 2073 6574 5f69 6e64 6578  or use set_index
+000223c0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000223d0: 2020 2020 2020 2022 6166 7465 7220 7265         "after re
+000223e0: 6e61 6d65 2074 6f20 6372 6561 7465 2061  name to create a
+000223f0: 6e20 696e 6465 7865 6420 636f 6f72 6469  n indexed coordi
+00022400: 6e61 7465 2e22 2c0a 2020 2020 2020 2020  nate.",.        
+00022410: 2020 2020 2020 2020 2020 2020 5573 6572              User
+00022420: 5761 726e 696e 672c 0a20 2020 2020 2020  Warning,.       
+00022430: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00022440: 636b 6c65 7665 6c3d 332c 0a20 2020 2020  cklevel=3,.     
+00022450: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00022460: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
+00022470: 2063 6f6f 7264 5f6e 616d 6573 2c20 6469   coord_names, di
+00022480: 6d73 2c20 696e 6465 7865 7320 3d20 7365  ms, indexes = se
+00022490: 6c66 2e5f 7265 6e61 6d65 5f61 6c6c 280a  lf._rename_all(.
+000224a0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+000224b0: 5f64 6963 743d 6e61 6d65 5f64 6963 742c  _dict=name_dict,
+000224c0: 2064 696d 735f 6469 6374 3d6e 616d 655f   dims_dict=name_
+000224d0: 6469 6374 0a20 2020 2020 2020 2029 0a20  dict.        ). 
+000224e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000224f0: 6c66 2e5f 7265 706c 6163 6528 7661 7269  lf._replace(vari
+00022500: 6162 6c65 732c 2063 6f6f 7264 5f6e 616d  ables, coord_nam
+00022510: 6573 2c20 6469 6d73 3d64 696d 732c 2069  es, dims=dims, i
+00022520: 6e64 6578 6573 3d69 6e64 6578 6573 290a  ndexes=indexes).
+00022530: 0a20 2020 2064 6566 2072 656e 616d 6528  .    def rename(
+00022540: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
+00022550: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
+00022560: 2020 6e61 6d65 5f64 6963 743a 204d 6170    name_dict: Map
+00022570: 7069 6e67 5b41 6e79 2c20 4861 7368 6162  ping[Any, Hashab
+00022580: 6c65 5d20 7c20 4e6f 6e65 203d 204e 6f6e  le] | None = Non
+00022590: 652c 0a20 2020 2020 2020 202a 2a6e 616d  e,.        **nam
+000225a0: 6573 3a20 4861 7368 6162 6c65 2c0a 2020  es: Hashable,.  
+000225b0: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
+000225c0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+000225d0: 7572 6e73 2061 206e 6577 206f 626a 6563  urns a new objec
+000225e0: 7420 7769 7468 2072 656e 616d 6564 2076  t with renamed v
+000225f0: 6172 6961 626c 6573 2c20 636f 6f72 6469  ariables, coordi
+00022600: 6e61 7465 7320 616e 6420 6469 6d65 6e73  nates and dimens
+00022610: 696f 6e73 2e0a 0a20 2020 2020 2020 2050  ions...        P
+00022620: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00022630: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00022640: 2020 2020 206e 616d 655f 6469 6374 203a       name_dict :
+00022650: 2064 6963 742d 6c69 6b65 2c20 6f70 7469   dict-like, opti
+00022660: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00022670: 2044 6963 7469 6f6e 6172 7920 7768 6f73   Dictionary whos
+00022680: 6520 6b65 7973 2061 7265 2063 7572 7265  e keys are curre
+00022690: 6e74 2076 6172 6961 626c 652c 2063 6f6f  nt variable, coo
+000226a0: 7264 696e 6174 6520 6f72 2064 696d 656e  rdinate or dimen
+000226b0: 7369 6f6e 206e 616d 6573 2061 6e64 0a20  sion names and. 
+000226c0: 2020 2020 2020 2020 2020 2077 686f 7365             whose
+000226d0: 2076 616c 7565 7320 6172 6520 7468 6520   values are the 
+000226e0: 6465 7369 7265 6420 6e61 6d65 732e 0a20  desired names.. 
+000226f0: 2020 2020 2020 202a 2a6e 616d 6573 203a         **names :
+00022700: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00022710: 2020 2020 2020 4b65 7977 6f72 6420 666f        Keyword fo
+00022720: 726d 206f 6620 6060 6e61 6d65 5f64 6963  rm of ``name_dic
+00022730: 7460 602e 0a20 2020 2020 2020 2020 2020  t``..           
+00022740: 204f 6e65 206f 6620 6e61 6d65 5f64 6963   One of name_dic
+00022750: 7420 6f72 206e 616d 6573 206d 7573 7420  t or names must 
+00022760: 6265 2070 726f 7669 6465 642e 0a0a 2020  be provided...  
+00022770: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00022780: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00022790: 2020 2020 2020 7265 6e61 6d65 6420 3a20        renamed : 
+000227a0: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
+000227b0: 2020 2020 4461 7461 7365 7420 7769 7468      Dataset with
+000227c0: 2072 656e 616d 6564 2076 6172 6961 626c   renamed variabl
+000227d0: 6573 2c20 636f 6f72 6469 6e61 7465 7320  es, coordinates 
+000227e0: 616e 6420 6469 6d65 6e73 696f 6e73 2e0a  and dimensions..
+000227f0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00022800: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00022810: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
+00022820: 6574 2e73 7761 705f 6469 6d73 0a20 2020  et.swap_dims.   
+00022830: 2020 2020 2044 6174 6173 6574 2e72 656e       Dataset.ren
+00022840: 616d 655f 7661 7273 0a20 2020 2020 2020  ame_vars.       
+00022850: 2044 6174 6173 6574 2e72 656e 616d 655f   Dataset.rename_
+00022860: 6469 6d73 0a20 2020 2020 2020 2044 6174  dims.        Dat
+00022870: 6141 7272 6179 2e72 656e 616d 650a 2020  aArray.rename.  
+00022880: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00022890: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+000228a0: 656e 616d 6528 6e61 6d65 5f64 6963 743d  ename(name_dict=
+000228b0: 6e61 6d65 5f64 6963 742c 202a 2a6e 616d  name_dict, **nam
+000228c0: 6573 290a 0a20 2020 2064 6566 2072 656e  es)..    def ren
+000228d0: 616d 655f 6469 6d73 280a 2020 2020 2020  ame_dims(.      
+000228e0: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
+000228f0: 742c 0a20 2020 2020 2020 2064 696d 735f  t,.        dims_
+00022900: 6469 6374 3a20 4d61 7070 696e 675b 416e  dict: Mapping[An
+00022910: 792c 2048 6173 6861 626c 655d 207c 204e  y, Hashable] | N
+00022920: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00022930: 2020 2020 2a2a 6469 6d73 3a20 4861 7368      **dims: Hash
+00022940: 6162 6c65 2c0a 2020 2020 2920 2d3e 2054  able,.    ) -> T
+00022950: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
+00022960: 2020 2222 2252 6574 7572 6e73 2061 206e    """Returns a n
+00022970: 6577 206f 626a 6563 7420 7769 7468 2072  ew object with r
+00022980: 656e 616d 6564 2064 696d 656e 7369 6f6e  enamed dimension
+00022990: 7320 6f6e 6c79 2e0a 0a20 2020 2020 2020  s only...       
+000229a0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+000229b0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+000229c0: 2020 2020 2020 2064 696d 735f 6469 6374         dims_dict
+000229d0: 203a 2064 6963 742d 6c69 6b65 2c20 6f70   : dict-like, op
+000229e0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+000229f0: 2020 2044 6963 7469 6f6e 6172 7920 7768     Dictionary wh
+00022a00: 6f73 6520 6b65 7973 2061 7265 2063 7572  ose keys are cur
+00022a10: 7265 6e74 2064 696d 656e 7369 6f6e 206e  rent dimension n
+00022a20: 616d 6573 2061 6e64 0a20 2020 2020 2020  ames and.       
+00022a30: 2020 2020 2077 686f 7365 2076 616c 7565       whose value
+00022a40: 7320 6172 6520 7468 6520 6465 7369 7265  s are the desire
+00022a50: 6420 6e61 6d65 732e 2054 6865 2064 6573  d names. The des
+00022a60: 6972 6564 206e 616d 6573 206d 7573 740a  ired names must.
+00022a70: 2020 2020 2020 2020 2020 2020 6e6f 7420              not 
+00022a80: 6265 2074 6865 206e 616d 6520 6f66 2061  be the name of a
+00022a90: 6e20 6578 6973 7469 6e67 2064 696d 656e  n existing dimen
+00022aa0: 7369 6f6e 206f 7220 5661 7269 6162 6c65  sion or Variable
+00022ab0: 2069 6e20 7468 6520 4461 7461 7365 742e   in the Dataset.
+00022ac0: 0a20 2020 2020 2020 202a 2a64 696d 7320  .        **dims 
+00022ad0: 3a20 6f70 7469 6f6e 616c 0a20 2020 2020  : optional.     
+00022ae0: 2020 2020 2020 204b 6579 776f 7264 2066         Keyword f
+00022af0: 6f72 6d20 6f66 2060 6064 696d 735f 6469  orm of ``dims_di
+00022b00: 6374 6060 2e0a 2020 2020 2020 2020 2020  ct``..          
+00022b10: 2020 4f6e 6520 6f66 2064 696d 735f 6469    One of dims_di
+00022b20: 6374 206f 7220 6469 6d73 206d 7573 7420  ct or dims must 
+00022b30: 6265 2070 726f 7669 6465 642e 0a0a 2020  be provided...  
+00022b40: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00022b50: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00022b60: 2020 2020 2020 7265 6e61 6d65 6420 3a20        renamed : 
+00022b70: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
+00022b80: 2020 2020 4461 7461 7365 7420 7769 7468      Dataset with
+00022b90: 2072 656e 616d 6564 2064 696d 656e 7369   renamed dimensi
+00022ba0: 6f6e 732e 0a0a 2020 2020 2020 2020 5365  ons...        Se
+00022bb0: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+00022bc0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00022bd0: 4461 7461 7365 742e 7377 6170 5f64 696d  Dataset.swap_dim
+00022be0: 730a 2020 2020 2020 2020 4461 7461 7365  s.        Datase
+00022bf0: 742e 7265 6e61 6d65 0a20 2020 2020 2020  t.rename.       
+00022c00: 2044 6174 6173 6574 2e72 656e 616d 655f   Dataset.rename_
+00022c10: 7661 7273 0a20 2020 2020 2020 2044 6174  vars.        Dat
+00022c20: 6141 7272 6179 2e72 656e 616d 650a 2020  aArray.rename.  
+00022c30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00022c40: 2020 6469 6d73 5f64 6963 7420 3d20 6569    dims_dict = ei
+00022c50: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
+00022c60: 7267 7328 6469 6d73 5f64 6963 742c 2064  rgs(dims_dict, d
+00022c70: 696d 732c 2022 7265 6e61 6d65 5f64 696d  ims, "rename_dim
+00022c80: 7322 290a 2020 2020 2020 2020 666f 7220  s").        for 
+00022c90: 6b2c 2076 2069 6e20 6469 6d73 5f64 6963  k, v in dims_dic
+00022ca0: 742e 6974 656d 7328 293a 0a20 2020 2020  t.items():.     
+00022cb0: 2020 2020 2020 2069 6620 6b20 6e6f 7420         if k not 
+00022cc0: 696e 2073 656c 662e 6469 6d73 3a0a 2020  in self.dims:.  
+00022cd0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00022ce0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00022cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d00: 2020 2020 6622 6361 6e6e 6f74 2072 656e      f"cannot ren
+00022d10: 616d 6520 7b6b 2172 7d20 6265 6361 7573  ame {k!r} becaus
+00022d20: 6520 6974 2069 7320 6e6f 7420 6120 220a  e it is not a ".
+00022d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d40: 2020 2020 2264 696d 656e 7369 6f6e 2069      "dimension i
+00022d50: 6e20 7468 6973 2064 6174 6173 6574 220a  n this dataset".
+00022d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00022d80: 2076 2069 6e20 7365 6c66 2e64 696d 7320   v in self.dims 
+00022d90: 6f72 2076 2069 6e20 7365 6c66 3a0a 2020  or v in self:.  
+00022da0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00022db0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00022dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022dd0: 2020 2020 6622 4361 6e6e 6f74 2072 656e      f"Cannot ren
+00022de0: 616d 6520 7b6b 7d20 746f 207b 767d 2062  ame {k} to {v} b
+00022df0: 6563 6175 7365 207b 767d 2061 6c72 6561  ecause {v} alrea
+00022e00: 6479 2065 7869 7374 732e 2022 0a20 2020  dy exists. ".   
+00022e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e20: 2022 5472 7920 7573 696e 6720 7377 6170   "Try using swap
+00022e30: 5f64 696d 7320 696e 7374 6561 642e 220a  _dims instead.".
+00022e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e50: 290a 0a20 2020 2020 2020 2076 6172 6961  )..        varia
+00022e60: 626c 6573 2c20 636f 6f72 645f 6e61 6d65  bles, coord_name
+00022e70: 732c 2073 697a 6573 2c20 696e 6465 7865  s, sizes, indexe
+00022e80: 7320 3d20 7365 6c66 2e5f 7265 6e61 6d65  s = self._rename
+00022e90: 5f61 6c6c 280a 2020 2020 2020 2020 2020  _all(.          
+00022ea0: 2020 6e61 6d65 5f64 6963 743d 7b7d 2c20    name_dict={}, 
+00022eb0: 6469 6d73 5f64 6963 743d 6469 6d73 5f64  dims_dict=dims_d
+00022ec0: 6963 740a 2020 2020 2020 2020 290a 2020  ict.        ).  
+00022ed0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00022ee0: 662e 5f72 6570 6c61 6365 2876 6172 6961  f._replace(varia
+00022ef0: 626c 6573 2c20 636f 6f72 645f 6e61 6d65  bles, coord_name
+00022f00: 732c 2064 696d 733d 7369 7a65 732c 2069  s, dims=sizes, i
+00022f10: 6e64 6578 6573 3d69 6e64 6578 6573 290a  ndexes=indexes).
+00022f20: 0a20 2020 2064 6566 2072 656e 616d 655f  .    def rename_
+00022f30: 7661 7273 280a 2020 2020 2020 2020 7365  vars(.        se
+00022f40: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
+00022f50: 2020 2020 2020 206e 616d 655f 6469 6374         name_dict
+00022f60: 3a20 4d61 7070 696e 675b 416e 792c 2048  : Mapping[Any, H
+00022f70: 6173 6861 626c 655d 207c 204e 6f6e 6520  ashable] | None 
+00022f80: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00022f90: 2a2a 6e61 6d65 733a 2048 6173 6861 626c  **names: Hashabl
+00022fa0: 652c 0a20 2020 2029 202d 3e20 545f 4461  e,.    ) -> T_Da
+00022fb0: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+00022fc0: 2222 5265 7475 726e 7320 6120 6e65 7720  ""Returns a new 
+00022fd0: 6f62 6a65 6374 2077 6974 6820 7265 6e61  object with rena
+00022fe0: 6d65 6420 7661 7269 6162 6c65 7320 696e  med variables in
+00022ff0: 636c 7564 696e 6720 636f 6f72 6469 6e61  cluding coordina
+00023000: 7465 730a 0a20 2020 2020 2020 2050 6172  tes..        Par
+00023010: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00023020: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00023030: 2020 206e 616d 655f 6469 6374 203a 2064     name_dict : d
+00023040: 6963 742d 6c69 6b65 2c20 6f70 7469 6f6e  ict-like, option
+00023050: 616c 0a20 2020 2020 2020 2020 2020 2044  al.            D
+00023060: 6963 7469 6f6e 6172 7920 7768 6f73 6520  ictionary whose 
+00023070: 6b65 7973 2061 7265 2063 7572 7265 6e74  keys are current
+00023080: 2076 6172 6961 626c 6520 6f72 2063 6f6f   variable or coo
+00023090: 7264 696e 6174 6520 6e61 6d65 7320 616e  rdinate names an
+000230a0: 640a 2020 2020 2020 2020 2020 2020 7768  d.            wh
+000230b0: 6f73 6520 7661 6c75 6573 2061 7265 2074  ose values are t
+000230c0: 6865 2064 6573 6972 6564 206e 616d 6573  he desired names
+000230d0: 2e0a 2020 2020 2020 2020 2a2a 6e61 6d65  ..        **name
+000230e0: 7320 3a20 6f70 7469 6f6e 616c 0a20 2020  s : optional.   
+000230f0: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+00023100: 2066 6f72 6d20 6f66 2060 606e 616d 655f   form of ``name_
+00023110: 6469 6374 6060 2e0a 2020 2020 2020 2020  dict``..        
+00023120: 2020 2020 4f6e 6520 6f66 206e 616d 655f      One of name_
+00023130: 6469 6374 206f 7220 6e61 6d65 7320 6d75  dict or names mu
+00023140: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
+00023150: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00023160: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00023170: 0a20 2020 2020 2020 2072 656e 616d 6564  .        renamed
+00023180: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
+00023190: 2020 2020 2020 2044 6174 6173 6574 2077         Dataset w
+000231a0: 6974 6820 7265 6e61 6d65 6420 7661 7269  ith renamed vari
+000231b0: 6162 6c65 7320 696e 636c 7564 696e 6720  ables including 
+000231c0: 636f 6f72 6469 6e61 7465 730a 0a20 2020  coordinates..   
+000231d0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+000231e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+000231f0: 2020 2020 2020 2044 6174 6173 6574 2e73         Dataset.s
+00023200: 7761 705f 6469 6d73 0a20 2020 2020 2020  wap_dims.       
+00023210: 2044 6174 6173 6574 2e72 656e 616d 650a   Dataset.rename.
+00023220: 2020 2020 2020 2020 4461 7461 7365 742e          Dataset.
+00023230: 7265 6e61 6d65 5f64 696d 730a 2020 2020  rename_dims.    
+00023240: 2020 2020 4461 7461 4172 7261 792e 7265      DataArray.re
+00023250: 6e61 6d65 0a20 2020 2020 2020 2022 2222  name.        """
+00023260: 0a20 2020 2020 2020 206e 616d 655f 6469  .        name_di
+00023270: 6374 203d 2065 6974 6865 725f 6469 6374  ct = either_dict
+00023280: 5f6f 725f 6b77 6172 6773 286e 616d 655f  _or_kwargs(name_
+00023290: 6469 6374 2c20 6e61 6d65 732c 2022 7265  dict, names, "re
+000232a0: 6e61 6d65 5f76 6172 7322 290a 2020 2020  name_vars").    
+000232b0: 2020 2020 666f 7220 6b20 696e 206e 616d      for k in nam
+000232c0: 655f 6469 6374 3a0a 2020 2020 2020 2020  e_dict:.        
+000232d0: 2020 2020 6966 206b 206e 6f74 2069 6e20      if k not in 
+000232e0: 7365 6c66 3a0a 2020 2020 2020 2020 2020  self:.          
+000232f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00023300: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00023310: 2020 2020 2020 2020 2020 2020 6622 6361              f"ca
+00023320: 6e6e 6f74 2072 656e 616d 6520 7b6b 2172  nnot rename {k!r
+00023330: 7d20 6265 6361 7573 6520 6974 2069 7320  } because it is 
+00023340: 6e6f 7420 6120 220a 2020 2020 2020 2020  not a ".        
+00023350: 2020 2020 2020 2020 2020 2020 2276 6172              "var
+00023360: 6961 626c 6520 6f72 2063 6f6f 7264 696e  iable or coordin
+00023370: 6174 6520 696e 2074 6869 7320 6461 7461  ate in this data
+00023380: 7365 7422 0a20 2020 2020 2020 2020 2020  set".           
+00023390: 2020 2020 2029 0a20 2020 2020 2020 2076       ).        v
+000233a0: 6172 6961 626c 6573 2c20 636f 6f72 645f  ariables, coord_
+000233b0: 6e61 6d65 732c 2064 696d 732c 2069 6e64  names, dims, ind
+000233c0: 6578 6573 203d 2073 656c 662e 5f72 656e  exes = self._ren
+000233d0: 616d 655f 616c 6c28 0a20 2020 2020 2020  ame_all(.       
+000233e0: 2020 2020 206e 616d 655f 6469 6374 3d6e       name_dict=n
+000233f0: 616d 655f 6469 6374 2c20 6469 6d73 5f64  ame_dict, dims_d
+00023400: 6963 743d 7b7d 0a20 2020 2020 2020 2029  ict={}.        )
+00023410: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00023420: 7365 6c66 2e5f 7265 706c 6163 6528 7661  self._replace(va
+00023430: 7269 6162 6c65 732c 2063 6f6f 7264 5f6e  riables, coord_n
+00023440: 616d 6573 2c20 6469 6d73 3d64 696d 732c  ames, dims=dims,
+00023450: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+00023460: 290a 0a20 2020 2064 6566 2073 7761 705f  )..    def swap_
+00023470: 6469 6d73 280a 2020 2020 2020 2020 7365  dims(.        se
+00023480: 6c66 3a20 545f 4461 7461 7365 742c 2064  lf: T_Dataset, d
+00023490: 696d 735f 6469 6374 3a20 4d61 7070 696e  ims_dict: Mappin
+000234a0: 675b 416e 792c 2048 6173 6861 626c 655d  g[Any, Hashable]
+000234b0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c20   | None = None, 
+000234c0: 2a2a 6469 6d73 5f6b 7761 7267 730a 2020  **dims_kwargs.  
+000234d0: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
+000234e0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+000234f0: 7572 6e73 2061 206e 6577 206f 626a 6563  urns a new objec
+00023500: 7420 7769 7468 2073 7761 7070 6564 2064  t with swapped d
+00023510: 696d 656e 7369 6f6e 732e 0a0a 2020 2020  imensions...    
+00023520: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00023530: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00023540: 2d0a 2020 2020 2020 2020 6469 6d73 5f64  -.        dims_d
+00023550: 6963 7420 3a20 6469 6374 2d6c 696b 650a  ict : dict-like.
+00023560: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
+00023570: 696f 6e61 7279 2077 686f 7365 206b 6579  ionary whose key
+00023580: 7320 6172 6520 6375 7272 656e 7420 6469  s are current di
+00023590: 6d65 6e73 696f 6e20 6e61 6d65 7320 616e  mension names an
+000235a0: 6420 7768 6f73 6520 7661 6c75 6573 0a20  d whose values. 
+000235b0: 2020 2020 2020 2020 2020 2061 7265 206e             are n
+000235c0: 6577 206e 616d 6573 2e0a 2020 2020 2020  ew names..      
+000235d0: 2020 2a2a 6469 6d73 5f6b 7761 7267 7320    **dims_kwargs 
+000235e0: 3a20 7b65 7869 7374 696e 675f 6469 6d3a  : {existing_dim:
+000235f0: 206e 6577 5f64 696d 2c20 2e2e 2e7d 2c20   new_dim, ...}, 
+00023600: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00023610: 2020 2020 2054 6865 206b 6579 776f 7264       The keyword
+00023620: 2061 7267 756d 656e 7473 2066 6f72 6d20   arguments form 
+00023630: 6f66 2060 6064 696d 735f 6469 6374 6060  of ``dims_dict``
+00023640: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
+00023650: 6520 6f66 2064 696d 735f 6469 6374 206f  e of dims_dict o
+00023660: 7220 6469 6d73 5f6b 7761 7267 7320 6d75  r dims_kwargs mu
+00023670: 7374 2062 6520 7072 6f76 6964 6564 2e0a  st be provided..
+00023680: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00023690: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000236a0: 0a20 2020 2020 2020 2073 7761 7070 6564  .        swapped
+000236b0: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
+000236c0: 2020 2020 2020 2044 6174 6173 6574 2077         Dataset w
+000236d0: 6974 6820 7377 6170 7065 6420 6469 6d65  ith swapped dime
+000236e0: 6e73 696f 6e73 2e0a 0a20 2020 2020 2020  nsions...       
+000236f0: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
+00023700: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+00023710: 2020 203e 3e3e 2064 7320 3d20 7872 2e44     >>> ds = xr.D
+00023720: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
+00023730: 2e2e 2e20 2020 2020 6461 7461 5f76 6172  ...     data_var
+00023740: 733d 7b22 6122 3a20 2822 7822 2c20 5b35  s={"a": ("x", [5
+00023750: 2c20 375d 292c 2022 6222 3a20 2822 7822  , 7]), "b": ("x"
+00023760: 2c20 5b30 2e31 2c20 322e 345d 297d 2c0a  , [0.1, 2.4])},.
+00023770: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+00023780: 636f 6f72 6473 3d7b 2278 223a 205b 2261  coords={"x": ["a
+00023790: 222c 2022 6222 5d2c 2022 7922 3a20 2822  ", "b"], "y": ("
+000237a0: 7822 2c20 5b30 2c20 315d 297d 2c0a 2020  x", [0, 1])},.  
+000237b0: 2020 2020 2020 2e2e 2e20 290a 2020 2020        ... ).    
+000237c0: 2020 2020 3e3e 3e20 6473 0a20 2020 2020      >>> ds.     
+000237d0: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+000237e0: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+000237f0: 6e73 696f 6e73 3a20 2028 783a 2032 290a  nsions:  (x: 2).
+00023800: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+00023810: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
+00023820: 2078 2020 2020 2020 2020 2878 2920 3c55   x        (x) <U
+00023830: 3120 2761 2720 2762 270a 2020 2020 2020  1 'a' 'b'.      
+00023840: 2020 2020 2020 7920 2020 2020 2020 2028        y        (
+00023850: 7829 2069 6e74 3634 2030 2031 0a20 2020  x) int64 0 1.   
+00023860: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+00023870: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00023880: 2061 2020 2020 2020 2020 2878 2920 696e   a        (x) in
+00023890: 7436 3420 3520 370a 2020 2020 2020 2020  t64 5 7.        
+000238a0: 2020 2020 6220 2020 2020 2020 2028 7829      b        (x)
+000238b0: 2066 6c6f 6174 3634 2030 2e31 2032 2e34   float64 0.1 2.4
+000238c0: 0a0a 2020 2020 2020 2020 3e3e 3e20 6473  ..        >>> ds
+000238d0: 2e73 7761 705f 6469 6d73 287b 2278 223a  .swap_dims({"x":
+000238e0: 2022 7922 7d29 0a20 2020 2020 2020 203c   "y"}).        <
+000238f0: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+00023900: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00023910: 6e73 3a20 2028 793a 2032 290a 2020 2020  ns:  (y: 2).    
+00023920: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+00023930: 0a20 2020 2020 2020 2020 2020 2078 2020  .            x  
+00023940: 2020 2020 2020 2879 2920 3c55 3120 2761        (y) <U1 'a
+00023950: 2720 2762 270a 2020 2020 2020 2020 2020  ' 'b'.          
+00023960: 2a20 7920 2020 2020 2020 2028 7929 2069  * y        (y) i
+00023970: 6e74 3634 2030 2031 0a20 2020 2020 2020  nt64 0 1.       
+00023980: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
+00023990: 0a20 2020 2020 2020 2020 2020 2061 2020  .            a  
+000239a0: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
+000239b0: 3520 370a 2020 2020 2020 2020 2020 2020  5 7.            
+000239c0: 6220 2020 2020 2020 2028 7929 2066 6c6f  b        (y) flo
+000239d0: 6174 3634 2030 2e31 2032 2e34 0a0a 2020  at64 0.1 2.4..  
+000239e0: 2020 2020 2020 3e3e 3e20 6473 2e73 7761        >>> ds.swa
+000239f0: 705f 6469 6d73 287b 2278 223a 2022 7a22  p_dims({"x": "z"
+00023a00: 7d29 0a20 2020 2020 2020 203c 7861 7272  }).        <xarr
+00023a10: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
+00023a20: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
+00023a30: 2028 7a3a 2032 290a 2020 2020 2020 2020   (z: 2).        
+00023a40: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+00023a50: 2020 2020 2020 2020 2078 2020 2020 2020           x      
+00023a60: 2020 287a 2920 3c55 3120 2761 2720 2762    (z) <U1 'a' 'b
+00023a70: 270a 2020 2020 2020 2020 2020 2020 7920  '.            y 
+00023a80: 2020 2020 2020 2028 7a29 2069 6e74 3634         (z) int64
+00023a90: 2030 2031 0a20 2020 2020 2020 2044 696d   0 1.        Dim
+00023aa0: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
+00023ab0: 636f 6f72 6469 6e61 7465 733a 207a 0a20  coordinates: z. 
+00023ac0: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
+00023ad0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
+00023ae0: 2020 2061 2020 2020 2020 2020 287a 2920     a        (z) 
+00023af0: 696e 7436 3420 3520 370a 2020 2020 2020  int64 5 7.      
+00023b00: 2020 2020 2020 6220 2020 2020 2020 2028        b        (
+00023b10: 7a29 2066 6c6f 6174 3634 2030 2e31 2032  z) float64 0.1 2
+00023b20: 2e34 0a0a 2020 2020 2020 2020 5365 6520  .4..        See 
+00023b30: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+00023b40: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
+00023b50: 7461 7365 742e 7265 6e61 6d65 0a20 2020  taset.rename.   
+00023b60: 2020 2020 2044 6174 6141 7272 6179 2e73       DataArray.s
+00023b70: 7761 705f 6469 6d73 0a20 2020 2020 2020  wap_dims.       
+00023b80: 2022 2222 0a20 2020 2020 2020 2023 2054   """.        # T
+00023b90: 4f44 4f3a 2064 6570 7265 6361 7465 2074  ODO: deprecate t
+00023ba0: 6869 7320 6d65 7468 6f64 2069 6e20 6661  his method in fa
+00023bb0: 766f 7220 6f66 2061 2028 6c65 7373 2063  vor of a (less c
+00023bc0: 6f6e 6675 7369 6e67 290a 2020 2020 2020  onfusing).      
+00023bd0: 2020 2320 7265 6e61 6d65 5f64 696d 7328    # rename_dims(
+00023be0: 2920 6d65 7468 6f64 2074 6861 7420 6f6e  ) method that on
+00023bf0: 6c79 2072 656e 616d 6573 2064 696d 656e  ly renames dimen
+00023c00: 7369 6f6e 732e 0a0a 2020 2020 2020 2020  sions...        
+00023c10: 6469 6d73 5f64 6963 7420 3d20 6569 7468  dims_dict = eith
+00023c20: 6572 5f64 6963 745f 6f72 5f6b 7761 7267  er_dict_or_kwarg
+00023c30: 7328 6469 6d73 5f64 6963 742c 2064 696d  s(dims_dict, dim
+00023c40: 735f 6b77 6172 6773 2c20 2273 7761 705f  s_kwargs, "swap_
+00023c50: 6469 6d73 2229 0a20 2020 2020 2020 2066  dims").        f
+00023c60: 6f72 206b 2c20 7620 696e 2064 696d 735f  or k, v in dims_
+00023c70: 6469 6374 2e69 7465 6d73 2829 3a0a 2020  dict.items():.  
+00023c80: 2020 2020 2020 2020 2020 6966 206b 206e            if k n
+00023c90: 6f74 2069 6e20 7365 6c66 2e64 696d 733a  ot in self.dims:
+00023ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023cb0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00023cc0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00023cd0: 2020 2020 2020 2066 2263 616e 6e6f 7420         f"cannot 
+00023ce0: 7377 6170 2066 726f 6d20 6469 6d65 6e73  swap from dimens
+00023cf0: 696f 6e20 7b6b 2172 7d20 6265 6361 7573  ion {k!r} becaus
+00023d00: 6520 6974 2069 7320 220a 2020 2020 2020  e it is ".      
+00023d10: 2020 2020 2020 2020 2020 2020 2020 226e                "n
+00023d20: 6f74 2061 6e20 6578 6973 7469 6e67 2064  ot an existing d
+00023d30: 696d 656e 7369 6f6e 220a 2020 2020 2020  imension".      
+00023d40: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00023d50: 2020 2020 2020 2020 6966 2076 2069 6e20          if v in 
+00023d60: 7365 6c66 2e76 6172 6961 626c 6573 2061  self.variables a
+00023d70: 6e64 2073 656c 662e 7661 7269 6162 6c65  nd self.variable
+00023d80: 735b 765d 2e64 696d 7320 213d 2028 6b2c  s[v].dims != (k,
+00023d90: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00023da0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00023db0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00023dc0: 2020 2020 2020 2020 2066 2272 6570 6c61           f"repla
+00023dd0: 6365 6d65 6e74 2064 696d 656e 7369 6f6e  cement dimension
+00023de0: 207b 7621 727d 2069 7320 6e6f 7420 6120   {v!r} is not a 
+00023df0: 3144 2022 0a20 2020 2020 2020 2020 2020  1D ".           
+00023e00: 2020 2020 2020 2020 2066 2276 6172 6961           f"varia
+00023e10: 626c 6520 616c 6f6e 6720 7468 6520 6f6c  ble along the ol
+00023e20: 6420 6469 6d65 6e73 696f 6e20 7b6b 2172  d dimension {k!r
+00023e30: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00023e40: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
+00023e50: 7375 6c74 5f64 696d 7320 3d20 7b64 696d  sult_dims = {dim
+00023e60: 735f 6469 6374 2e67 6574 2864 696d 2c20  s_dict.get(dim, 
+00023e70: 6469 6d29 2066 6f72 2064 696d 2069 6e20  dim) for dim in 
+00023e80: 7365 6c66 2e64 696d 737d 0a0a 2020 2020  self.dims}..    
+00023e90: 2020 2020 636f 6f72 645f 6e61 6d65 7320      coord_names 
+00023ea0: 3d20 7365 6c66 2e5f 636f 6f72 645f 6e61  = self._coord_na
+00023eb0: 6d65 732e 636f 7079 2829 0a20 2020 2020  mes.copy().     
+00023ec0: 2020 2063 6f6f 7264 5f6e 616d 6573 2e75     coord_names.u
+00023ed0: 7064 6174 6528 7b64 696d 2066 6f72 2064  pdate({dim for d
+00023ee0: 696d 2069 6e20 6469 6d73 5f64 6963 742e  im in dims_dict.
+00023ef0: 7661 6c75 6573 2829 2069 6620 6469 6d20  values() if dim 
+00023f00: 696e 2073 656c 662e 7661 7269 6162 6c65  in self.variable
+00023f10: 737d 290a 0a20 2020 2020 2020 2076 6172  s})..        var
+00023f20: 6961 626c 6573 3a20 6469 6374 5b48 6173  iables: dict[Has
+00023f30: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
+00023f40: 203d 207b 7d0a 2020 2020 2020 2020 696e   = {}.        in
+00023f50: 6465 7865 733a 2064 6963 745b 4861 7368  dexes: dict[Hash
+00023f60: 6162 6c65 2c20 496e 6465 785d 203d 207b  able, Index] = {
+00023f70: 7d0a 2020 2020 2020 2020 666f 7220 6b2c  }.        for k,
+00023f80: 2076 2069 6e20 7365 6c66 2e76 6172 6961   v in self.varia
+00023f90: 626c 6573 2e69 7465 6d73 2829 3a0a 2020  bles.items():.  
+00023fa0: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
+00023fb0: 2074 7570 6c65 2864 696d 735f 6469 6374   tuple(dims_dict
+00023fc0: 2e67 6574 2864 696d 2c20 6469 6d29 2066  .get(dim, dim) f
+00023fd0: 6f72 2064 696d 2069 6e20 762e 6469 6d73  or dim in v.dims
+00023fe0: 290a 2020 2020 2020 2020 2020 2020 7661  ).            va
+00023ff0: 723a 2056 6172 6961 626c 650a 2020 2020  r: Variable.    
+00024000: 2020 2020 2020 2020 6966 206b 2069 6e20          if k in 
+00024010: 7265 7375 6c74 5f64 696d 733a 0a20 2020  result_dims:.   
+00024020: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00024030: 203d 2076 2e74 6f5f 696e 6465 785f 7661   = v.to_index_va
+00024040: 7269 6162 6c65 2829 0a20 2020 2020 2020  riable().       
+00024050: 2020 2020 2020 2020 2076 6172 2e64 696d           var.dim
+00024060: 7320 3d20 6469 6d73 0a20 2020 2020 2020  s = dims.       
+00024070: 2020 2020 2020 2020 2069 6620 6b20 696e           if k in
+00024080: 2073 656c 662e 5f69 6e64 6578 6573 3a0a   self._indexes:.
+00024090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000240a0: 2020 2020 696e 6465 7865 735b 6b5d 203d      indexes[k] =
+000240b0: 2073 656c 662e 5f69 6e64 6578 6573 5b6b   self._indexes[k
+000240c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000240d0: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
+000240e0: 6b5d 203d 2076 6172 0a20 2020 2020 2020  k] = var.       
+000240f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00024100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024110: 2020 2069 6e64 6578 2c20 696e 6465 785f     index, index_
+00024120: 7661 7273 203d 2063 7265 6174 655f 6465  vars = create_de
+00024130: 6661 756c 745f 696e 6465 785f 696d 706c  fault_index_impl
+00024140: 6963 6974 2876 6172 290a 2020 2020 2020  icit(var).      
+00024150: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00024160: 6465 7865 732e 7570 6461 7465 287b 6e61  dexes.update({na
+00024170: 6d65 3a20 696e 6465 7820 666f 7220 6e61  me: index for na
+00024180: 6d65 2069 6e20 696e 6465 785f 7661 7273  me in index_vars
+00024190: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+000241a0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+000241b0: 2e75 7064 6174 6528 696e 6465 785f 7661  .update(index_va
+000241c0: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+000241d0: 2020 2020 2020 2020 636f 6f72 645f 6e61          coord_na
+000241e0: 6d65 732e 7570 6461 7465 2869 6e64 6578  mes.update(index
+000241f0: 5f76 6172 7329 0a20 2020 2020 2020 2020  _vars).         
+00024200: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00024210: 2020 2020 2020 2020 2076 6172 203d 2076           var = v
+00024220: 2e74 6f5f 6261 7365 5f76 6172 6961 626c  .to_base_variabl
+00024230: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00024240: 2020 2020 7661 722e 6469 6d73 203d 2064      var.dims = d
+00024250: 696d 730a 2020 2020 2020 2020 2020 2020  ims.            
+00024260: 2020 2020 7661 7269 6162 6c65 735b 6b5d      variables[k]
+00024270: 203d 2076 6172 0a0a 2020 2020 2020 2020   = var..        
+00024280: 7265 7475 726e 2073 656c 662e 5f72 6570  return self._rep
+00024290: 6c61 6365 5f77 6974 685f 6e65 775f 6469  lace_with_new_di
+000242a0: 6d73 2876 6172 6961 626c 6573 2c20 636f  ms(variables, co
+000242b0: 6f72 645f 6e61 6d65 732c 2069 6e64 6578  ord_names, index
+000242c0: 6573 3d69 6e64 6578 6573 290a 0a20 2020  es=indexes)..   
+000242d0: 2023 2063 6861 6e67 6520 7479 7065 206f   # change type o
+000242e0: 6620 7365 6c66 2061 6e64 2072 6574 7572  f self and retur
+000242f0: 6e20 746f 2054 5f44 6174 6173 6574 206f  n to T_Dataset o
+00024300: 6e63 650a 2020 2020 2320 6874 7470 733a  nce.    # https:
+00024310: 2f2f 6769 7468 7562 2e63 6f6d 2f70 7974  //github.com/pyt
+00024320: 686f 6e2f 6d79 7079 2f69 7373 7565 732f  hon/mypy/issues/
+00024330: 3132 3834 3620 6973 2072 6573 6f6c 7665  12846 is resolve
+00024340: 640a 2020 2020 6465 6620 6578 7061 6e64  d.    def expand
+00024350: 5f64 696d 7328 0a20 2020 2020 2020 2073  _dims(.        s
+00024360: 656c 662c 0a20 2020 2020 2020 2064 696d  elf,.        dim
+00024370: 3a20 4e6f 6e65 207c 2048 6173 6861 626c  : None | Hashabl
+00024380: 6520 7c20 5365 7175 656e 6365 5b48 6173  e | Sequence[Has
+00024390: 6861 626c 655d 207c 204d 6170 7069 6e67  hable] | Mapping
+000243a0: 5b41 6e79 2c20 416e 795d 203d 204e 6f6e  [Any, Any] = Non
+000243b0: 652c 0a20 2020 2020 2020 2061 7869 733a  e,.        axis:
+000243c0: 204e 6f6e 6520 7c20 696e 7420 7c20 5365   None | int | Se
+000243d0: 7175 656e 6365 5b69 6e74 5d20 3d20 4e6f  quence[int] = No
+000243e0: 6e65 2c0a 2020 2020 2020 2020 2a2a 6469  ne,.        **di
+000243f0: 6d5f 6b77 6172 6773 3a20 416e 792c 0a20  m_kwargs: Any,. 
+00024400: 2020 2029 202d 3e20 4461 7461 7365 743a     ) -> Dataset:
+00024410: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00024420: 726e 2061 206e 6577 206f 626a 6563 7420  rn a new object 
+00024430: 7769 7468 2061 6e20 6164 6469 7469 6f6e  with an addition
+00024440: 616c 2061 7869 7320 286f 7220 6178 6573  al axis (or axes
+00024450: 2920 696e 7365 7274 6564 2061 740a 2020  ) inserted at.  
+00024460: 2020 2020 2020 7468 6520 636f 7272 6573        the corres
+00024470: 706f 6e64 696e 6720 706f 7369 7469 6f6e  ponding position
+00024480: 2069 6e20 7468 6520 6172 7261 7920 7368   in the array sh
+00024490: 6170 652e 2020 5468 6520 6e65 7720 6f62  ape.  The new ob
+000244a0: 6a65 6374 2069 7320 610a 2020 2020 2020  ject is a.      
+000244b0: 2020 7669 6577 2069 6e74 6f20 7468 6520    view into the 
+000244c0: 756e 6465 726c 7969 6e67 2061 7272 6179  underlying array
+000244d0: 2c20 6e6f 7420 6120 636f 7079 2e0a 0a20  , not a copy... 
+000244e0: 2020 2020 2020 2049 6620 6469 6d20 6973         If dim is
+000244f0: 2061 6c72 6561 6479 2061 2073 6361 6c61   already a scala
+00024500: 7220 636f 6f72 6469 6e61 7465 2c20 6974  r coordinate, it
+00024510: 2077 696c 6c20 6265 2070 726f 6d6f 7465   will be promote
+00024520: 6420 746f 2061 2031 440a 2020 2020 2020  d to a 1D.      
+00024530: 2020 636f 6f72 6469 6e61 7465 2063 6f6e    coordinate con
+00024540: 7369 7374 696e 6720 6f66 2061 2073 696e  sisting of a sin
+00024550: 676c 6520 7661 6c75 652e 0a0a 2020 2020  gle value...    
+00024560: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00024570: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00024580: 2d0a 2020 2020 2020 2020 6469 6d20 3a20  -.        dim : 
+00024590: 6861 7368 6162 6c65 2c20 7365 7175 656e  hashable, sequen
+000245a0: 6365 206f 6620 6861 7368 6162 6c65 2c20  ce of hashable, 
+000245b0: 6d61 7070 696e 672c 206f 7220 4e6f 6e65  mapping, or None
+000245c0: 0a20 2020 2020 2020 2020 2020 2044 696d  .            Dim
+000245d0: 656e 7369 6f6e 7320 746f 2069 6e63 6c75  ensions to inclu
+000245e0: 6465 206f 6e20 7468 6520 6e65 7720 7661  de on the new va
+000245f0: 7269 6162 6c65 2e20 4966 2070 726f 7669  riable. If provi
+00024600: 6465 6420 6173 2068 6173 6861 626c 650a  ded as hashable.
+00024610: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
+00024620: 6571 7565 6e63 6520 6f66 2068 6173 6861  equence of hasha
+00024630: 626c 652c 2074 6865 6e20 6469 6d65 6e73  ble, then dimens
+00024640: 696f 6e73 2061 7265 2069 6e73 6572 7465  ions are inserte
+00024650: 6420 7769 7468 206c 656e 6774 680a 2020  d with length.  
+00024660: 2020 2020 2020 2020 2020 312e 2049 6620            1. If 
+00024670: 7072 6f76 6964 6564 2061 7320 6120 6d61  provided as a ma
+00024680: 7070 696e 672c 2074 6865 6e20 7468 6520  pping, then the 
+00024690: 6b65 7973 2061 7265 2074 6865 206e 6577  keys are the new
+000246a0: 2064 696d 656e 7369 6f6e 730a 2020 2020   dimensions.    
+000246b0: 2020 2020 2020 2020 616e 6420 7468 6520          and the 
+000246c0: 7661 6c75 6573 2061 7265 2065 6974 6865  values are eithe
+000246d0: 7220 696e 7465 6765 7273 2028 6769 7669  r integers (givi
+000246e0: 6e67 2074 6865 206c 656e 6774 6820 6f66  ng the length of
+000246f0: 2074 6865 206e 6577 0a20 2020 2020 2020   the new.       
+00024700: 2020 2020 2064 696d 656e 7369 6f6e 7329       dimensions)
+00024710: 206f 7220 6172 7261 792d 6c69 6b65 2028   or array-like (
+00024720: 6769 7669 6e67 2074 6865 2063 6f6f 7264  giving the coord
+00024730: 696e 6174 6573 206f 6620 7468 6520 6e65  inates of the ne
+00024740: 770a 2020 2020 2020 2020 2020 2020 6469  w.            di
+00024750: 6d65 6e73 696f 6e73 292e 0a20 2020 2020  mensions)..     
+00024760: 2020 2061 7869 7320 3a20 696e 742c 2073     axis : int, s
+00024770: 6571 7565 6e63 6520 6f66 2069 6e74 2c20  equence of int, 
+00024780: 6f72 204e 6f6e 652c 2064 6566 6175 6c74  or None, default
+00024790: 3a20 4e6f 6e65 0a20 2020 2020 2020 2020  : None.         
+000247a0: 2020 2041 7869 7320 706f 7369 7469 6f6e     Axis position
+000247b0: 2873 2920 7768 6572 6520 6e65 7720 6178  (s) where new ax
+000247c0: 6973 2069 7320 746f 2062 6520 696e 7365  is is to be inse
+000247d0: 7274 6564 2028 706f 7369 7469 6f6e 2873  rted (position(s
+000247e0: 2920 6f6e 0a20 2020 2020 2020 2020 2020  ) on.           
+000247f0: 2074 6865 2072 6573 756c 7420 6172 7261   the result arra
+00024800: 7929 2e20 4966 2061 2073 6571 7565 6e63  y). If a sequenc
+00024810: 6520 6f66 2069 6e74 6567 6572 7320 6973  e of integers is
+00024820: 2070 6173 7365 642c 0a20 2020 2020 2020   passed,.       
+00024830: 2020 2020 206d 756c 7469 706c 6520 6178       multiple ax
+00024840: 6573 2061 7265 2069 6e73 6572 7465 642e  es are inserted.
+00024850: 2049 6e20 7468 6973 2063 6173 652c 2064   In this case, d
+00024860: 696d 2061 7267 756d 656e 7473 2073 686f  im arguments sho
+00024870: 756c 6420 6265 0a20 2020 2020 2020 2020  uld be.         
+00024880: 2020 2073 616d 6520 6c65 6e67 7468 206c     same length l
+00024890: 6973 742e 2049 6620 6178 6973 3d4e 6f6e  ist. If axis=Non
+000248a0: 6520 6973 2070 6173 7365 642c 2061 6c6c  e is passed, all
+000248b0: 2074 6865 2061 7865 7320 7769 6c6c 2062   the axes will b
+000248c0: 650a 2020 2020 2020 2020 2020 2020 696e  e.            in
+000248d0: 7365 7274 6564 2074 6f20 7468 6520 7374  serted to the st
+000248e0: 6172 7420 6f66 2074 6865 2072 6573 756c  art of the resul
+000248f0: 7420 6172 7261 792e 0a20 2020 2020 2020  t array..       
+00024900: 202a 2a64 696d 5f6b 7761 7267 7320 3a20   **dim_kwargs : 
+00024910: 696e 7420 6f72 2073 6571 7565 6e63 6520  int or sequence 
+00024920: 6f72 206e 6461 7272 6179 0a20 2020 2020  or ndarray.     
+00024930: 2020 2020 2020 2054 6865 206b 6579 776f         The keywo
+00024940: 7264 7320 6172 6520 6172 6269 7472 6172  rds are arbitrar
+00024950: 7920 6469 6d65 6e73 696f 6e73 2062 6569  y dimensions bei
+00024960: 6e67 2069 6e73 6572 7465 6420 616e 6420  ng inserted and 
+00024970: 7468 6520 7661 6c75 6573 0a20 2020 2020  the values.     
+00024980: 2020 2020 2020 2061 7265 2065 6974 6865         are eithe
+00024990: 7220 7468 6520 6c65 6e67 7468 7320 6f66  r the lengths of
+000249a0: 2074 6865 206e 6577 2064 696d 7320 2869   the new dims (i
+000249b0: 6620 696e 7420 6973 2067 6976 656e 292c  f int is given),
+000249c0: 206f 7220 7468 6569 720a 2020 2020 2020   or their.      
+000249d0: 2020 2020 2020 636f 6f72 6469 6e61 7465        coordinate
+000249e0: 732e 204e 6f74 652c 2074 6869 7320 6973  s. Note, this is
+000249f0: 2061 6e20 616c 7465 726e 6174 6976 6520   an alternative 
+00024a00: 746f 2070 6173 7369 6e67 2061 2064 6963  to passing a dic
+00024a10: 7420 746f 2074 6865 0a20 2020 2020 2020  t to the.       
+00024a20: 2020 2020 2064 696d 206b 7761 7267 2061       dim kwarg a
+00024a30: 6e64 2077 696c 6c20 6f6e 6c79 2062 6520  nd will only be 
+00024a40: 7573 6564 2069 6620 6469 6d20 6973 204e  used if dim is N
+00024a50: 6f6e 652e 0a0a 2020 2020 2020 2020 5265  one...        Re
+00024a60: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+00024a70: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6578  -----.        ex
+00024a80: 7061 6e64 6564 203a 2044 6174 6173 6574  panded : Dataset
+00024a90: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
+00024aa0: 7320 6f62 6a65 6374 2c20 6275 7420 7769  s object, but wi
+00024ab0: 7468 2061 6464 6974 696f 6e61 6c20 6469  th additional di
+00024ac0: 6d65 6e73 696f 6e28 7329 2e0a 0a20 2020  mension(s)...   
+00024ad0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00024ae0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00024af0: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
+00024b00: 2e65 7870 616e 645f 6469 6d73 0a20 2020  .expand_dims.   
+00024b10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00024b20: 2069 6620 6469 6d20 6973 204e 6f6e 653a   if dim is None:
+00024b30: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+00024b40: 730a 2020 2020 2020 2020 656c 6966 2069  s.        elif i
+00024b50: 7369 6e73 7461 6e63 6528 6469 6d2c 204d  sinstance(dim, M
+00024b60: 6170 7069 6e67 293a 0a20 2020 2020 2020  apping):.       
+00024b70: 2020 2020 2023 2057 6527 7265 206c 6174       # We're lat
+00024b80: 6572 2067 6f69 6e67 2074 6f20 6d6f 6469  er going to modi
+00024b90: 6679 2064 696d 2069 6e20 706c 6163 653b  fy dim in place;
+00024ba0: 2064 6f6e 2774 2074 616d 7065 7220 7769   don't tamper wi
+00024bb0: 7468 0a20 2020 2020 2020 2020 2020 2023  th.            #
+00024bc0: 2074 6865 2069 6e70 7574 0a20 2020 2020   the input.     
+00024bd0: 2020 2020 2020 2064 696d 203d 2064 6963         dim = dic
+00024be0: 7428 6469 6d29 0a20 2020 2020 2020 2065  t(dim).        e
+00024bf0: 6c69 6620 6973 696e 7374 616e 6365 2864  lif isinstance(d
+00024c00: 696d 2c20 696e 7429 3a0a 2020 2020 2020  im, int):.      
+00024c10: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+00024c20: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00024c30: 2020 2020 2020 2022 6469 6d20 7368 6f75         "dim shou
+00024c40: 6c64 2062 6520 6861 7368 6162 6c65 206f  ld be hashable o
+00024c50: 7220 7365 7175 656e 6365 206f 6620 6861  r sequence of ha
+00024c60: 7368 6162 6c65 7320 6f72 206d 6170 7069  shables or mappi
+00024c70: 6e67 220a 2020 2020 2020 2020 2020 2020  ng".            
+00024c80: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
+00024c90: 7369 6e73 7461 6e63 6528 6469 6d2c 2073  sinstance(dim, s
+00024ca0: 7472 2920 6f72 206e 6f74 2069 7369 6e73  tr) or not isins
+00024cb0: 7461 6e63 6528 6469 6d2c 2053 6571 7565  tance(dim, Seque
+00024cc0: 6e63 6529 3a0a 2020 2020 2020 2020 2020  nce):.          
+00024cd0: 2020 6469 6d20 3d20 7b64 696d 3a20 317d    dim = {dim: 1}
+00024ce0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00024cf0: 696e 7374 616e 6365 2864 696d 2c20 5365  instance(dim, Se
+00024d00: 7175 656e 6365 293a 0a20 2020 2020 2020  quence):.       
+00024d10: 2020 2020 2069 6620 6c65 6e28 6469 6d29       if len(dim)
+00024d20: 2021 3d20 6c65 6e28 7365 7428 6469 6d29   != len(set(dim)
+00024d30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00024d40: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00024d50: 726f 7228 2264 696d 7320 7368 6f75 6c64  ror("dims should
+00024d60: 206e 6f74 2063 6f6e 7461 696e 2064 7570   not contain dup
+00024d70: 6c69 6361 7465 2076 616c 7565 732e 2229  licate values.")
+00024d80: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00024d90: 203d 207b 643a 2031 2066 6f72 2064 2069   = {d: 1 for d i
+00024da0: 6e20 6469 6d7d 0a0a 2020 2020 2020 2020  n dim}..        
+00024db0: 6469 6d20 3d20 6569 7468 6572 5f64 6963  dim = either_dic
+00024dc0: 745f 6f72 5f6b 7761 7267 7328 6469 6d2c  t_or_kwargs(dim,
+00024dd0: 2064 696d 5f6b 7761 7267 732c 2022 6578   dim_kwargs, "ex
+00024de0: 7061 6e64 5f64 696d 7322 290a 2020 2020  pand_dims").    
+00024df0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+00024e00: 7461 6e63 6528 6469 6d2c 204d 7574 6162  tance(dim, Mutab
+00024e10: 6c65 4d61 7070 696e 6729 0a0a 2020 2020  leMapping)..    
+00024e20: 2020 2020 6966 2061 7869 7320 6973 204e      if axis is N
+00024e30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00024e40: 2061 7869 7320 3d20 6c69 7374 2872 616e   axis = list(ran
+00024e50: 6765 286c 656e 2864 696d 2929 290a 2020  ge(len(dim))).  
+00024e60: 2020 2020 2020 656c 6966 206e 6f74 2069        elif not i
+00024e70: 7369 6e73 7461 6e63 6528 6178 6973 2c20  sinstance(axis, 
+00024e80: 5365 7175 656e 6365 293a 0a20 2020 2020  Sequence):.     
+00024e90: 2020 2020 2020 2061 7869 7320 3d20 5b61         axis = [a
+00024ea0: 7869 735d 0a0a 2020 2020 2020 2020 6966  xis]..        if
+00024eb0: 206c 656e 2864 696d 2920 213d 206c 656e   len(dim) != len
+00024ec0: 2861 7869 7329 3a0a 2020 2020 2020 2020  (axis):.        
+00024ed0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00024ee0: 7272 6f72 2822 6c65 6e67 7468 7320 6f66  rror("lengths of
+00024ef0: 2064 696d 2061 6e64 2061 7869 7320 7368   dim and axis sh
+00024f00: 6f75 6c64 2062 6520 6964 656e 7469 6361  ould be identica
+00024f10: 6c2e 2229 0a20 2020 2020 2020 2066 6f72  l.").        for
+00024f20: 2064 2069 6e20 6469 6d3a 0a20 2020 2020   d in dim:.     
+00024f30: 2020 2020 2020 2069 6620 6420 696e 2073         if d in s
+00024f40: 656c 662e 6469 6d73 3a0a 2020 2020 2020  elf.dims:.      
+00024f50: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00024f60: 5661 6c75 6545 7272 6f72 2866 2244 696d  ValueError(f"Dim
+00024f70: 656e 7369 6f6e 207b 647d 2061 6c72 6561  ension {d} alrea
+00024f80: 6479 2065 7869 7374 732e 2229 0a20 2020  dy exists.").   
+00024f90: 2020 2020 2020 2020 2069 6620 6420 696e           if d in
+00024fa0: 2073 656c 662e 5f76 6172 6961 626c 6573   self._variables
+00024fb0: 2061 6e64 206e 6f74 2075 7469 6c73 2e69   and not utils.i
+00024fc0: 735f 7363 616c 6172 2873 656c 662e 5f76  s_scalar(self._v
+00024fd0: 6172 6961 626c 6573 5b64 5d29 3a0a 2020  ariables[d]):.  
+00024fe0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00024ff0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00025000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025010: 2020 2020 227b 6469 6d7d 2061 6c72 6561      "{dim} alrea
+00025020: 6479 2065 7869 7374 7320 6173 2063 6f6f  dy exists as coo
+00025030: 7264 696e 6174 6520 6f72 220a 2020 2020  rdinate or".    
+00025040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025050: 2220 7661 7269 6162 6c65 206e 616d 652e  " variable name.
+00025060: 222e 666f 726d 6174 2864 696d 3d64 290a  ".format(dim=d).
+00025070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025080: 290a 0a20 2020 2020 2020 2076 6172 6961  )..        varia
+00025090: 626c 6573 3a20 6469 6374 5b48 6173 6861  bles: dict[Hasha
+000250a0: 626c 652c 2056 6172 6961 626c 655d 203d  ble, Variable] =
+000250b0: 207b 7d0a 2020 2020 2020 2020 696e 6465   {}.        inde
+000250c0: 7865 733a 2064 6963 745b 4861 7368 6162  xes: dict[Hashab
+000250d0: 6c65 2c20 496e 6465 785d 203d 2064 6963  le, Index] = dic
+000250e0: 7428 7365 6c66 2e5f 696e 6465 7865 7329  t(self._indexes)
+000250f0: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
+00025100: 616d 6573 203d 2073 656c 662e 5f63 6f6f  ames = self._coo
+00025110: 7264 5f6e 616d 6573 2e63 6f70 7928 290a  rd_names.copy().
+00025120: 2020 2020 2020 2020 2320 4966 2064 696d          # If dim
+00025130: 2069 7320 6120 6469 6374 2c20 7468 656e   is a dict, then
+00025140: 2065 6e73 7572 6520 7468 6174 2074 6865   ensure that the
+00025150: 2076 616c 7565 7320 6172 6520 6569 7468   values are eith
+00025160: 6572 2069 6e74 6567 6572 730a 2020 2020  er integers.    
+00025170: 2020 2020 2320 6f72 2069 7465 7261 626c      # or iterabl
+00025180: 6573 2e0a 2020 2020 2020 2020 666f 7220  es..        for 
+00025190: 6b2c 2076 2069 6e20 6469 6d2e 6974 656d  k, v in dim.item
+000251a0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000251b0: 2069 6620 6861 7361 7474 7228 762c 2022   if hasattr(v, "
+000251c0: 5f5f 6974 6572 5f5f 2229 3a0a 2020 2020  __iter__"):.    
+000251d0: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+000251e0: 2074 6865 2076 616c 7565 2066 6f72 2074   the value for t
+000251f0: 6865 206e 6577 2064 696d 656e 7369 6f6e  he new dimension
+00025200: 2069 7320 616e 2069 7465 7261 626c 652c   is an iterable,
+00025210: 2074 6865 6e0a 2020 2020 2020 2020 2020   then.          
+00025220: 2020 2020 2020 2320 7361 7665 2074 6865        # save the
+00025230: 2063 6f6f 7264 696e 6174 6573 2074 6f20   coordinates to 
+00025240: 7468 6520 7661 7269 6162 6c65 7320 6469  the variables di
+00025250: 6374 2c20 616e 6420 7365 7420 7468 650a  ct, and set the.
+00025260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025270: 2320 7661 6c75 6520 7769 7468 696e 2074  # value within t
+00025280: 6865 2064 696d 2064 6963 7420 746f 2074  he dim dict to t
+00025290: 6865 206c 656e 6774 6820 6f66 2074 6865  he length of the
+000252a0: 2069 7465 7261 626c 650a 2020 2020 2020   iterable.      
+000252b0: 2020 2020 2020 2020 2020 2320 666f 7220            # for 
+000252c0: 6c61 7465 7220 7573 652e 0a20 2020 2020  later use..     
+000252d0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+000252e0: 203d 2050 616e 6461 7349 6e64 6578 2876   = PandasIndex(v
+000252f0: 2c20 6b29 0a20 2020 2020 2020 2020 2020  , k).           
+00025300: 2020 2020 2069 6e64 6578 6573 5b6b 5d20       indexes[k] 
+00025310: 3d20 696e 6465 780a 2020 2020 2020 2020  = index.        
+00025320: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00025330: 732e 7570 6461 7465 2869 6e64 6578 2e63  s.update(index.c
+00025340: 7265 6174 655f 7661 7269 6162 6c65 7328  reate_variables(
+00025350: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00025360: 2020 2063 6f6f 7264 5f6e 616d 6573 2e61     coord_names.a
+00025370: 6464 286b 290a 2020 2020 2020 2020 2020  dd(k).          
+00025380: 2020 2020 2020 6469 6d5b 6b5d 203d 2076        dim[k] = v
+00025390: 6172 6961 626c 6573 5b6b 5d2e 7369 7a65  ariables[k].size
+000253a0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000253b0: 6620 6973 696e 7374 616e 6365 2876 2c20  f isinstance(v, 
+000253c0: 696e 7429 3a0a 2020 2020 2020 2020 2020  int):.          
+000253d0: 2020 2020 2020 7061 7373 2020 2320 446f        pass  # Do
+000253e0: 206e 6f74 6869 6e67 2069 6620 7468 6520   nothing if the 
+000253f0: 6469 6d65 6e73 696f 6e73 2076 616c 7565  dimensions value
+00025400: 2069 7320 6a75 7374 2061 6e20 696e 740a   is just an int.
+00025410: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00025420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025430: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+00025440: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00025450: 2020 2020 2020 2022 5468 6520 7661 6c75         "The valu
+00025460: 6520 6f66 206e 6577 2064 696d 656e 7369  e of new dimensi
+00025470: 6f6e 207b 6b7d 206d 7573 7420 6265 2022  on {k} must be "
+00025480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025490: 2020 2020 2022 616e 2069 7465 7261 626c       "an iterabl
+000254a0: 6520 6f72 2061 6e20 696e 7422 2e66 6f72  e or an int".for
+000254b0: 6d61 7428 6b3d 6b29 0a20 2020 2020 2020  mat(k=k).       
+000254c0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000254d0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+000254e0: 7365 6c66 2e5f 7661 7269 6162 6c65 732e  self._variables.
+000254f0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00025500: 2020 2020 2069 6620 6b20 6e6f 7420 696e       if k not in
+00025510: 2064 696d 3a0a 2020 2020 2020 2020 2020   dim:.          
+00025520: 2020 2020 2020 6966 206b 2069 6e20 636f        if k in co
+00025530: 6f72 645f 6e61 6d65 733a 2020 2320 446f  ord_names:  # Do
+00025540: 206e 6f74 2063 6861 6e67 6520 636f 6f72   not change coor
+00025550: 6469 6e61 7465 730a 2020 2020 2020 2020  dinates.        
+00025560: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+00025570: 6162 6c65 735b 6b5d 203d 2076 0a20 2020  ables[k] = v.   
+00025580: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00025590: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000255a0: 2020 2020 2020 2072 6573 756c 745f 6e64         result_nd
+000255b0: 696d 203d 206c 656e 2876 2e64 696d 7329  im = len(v.dims)
+000255c0: 202b 206c 656e 2861 7869 7329 0a20 2020   + len(axis).   
+000255d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255e0: 2066 6f72 2061 2069 6e20 6178 6973 3a0a   for a in axis:.
+000255f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025600: 2020 2020 2020 2020 6966 2061 203c 202d          if a < -
+00025610: 7265 7375 6c74 5f6e 6469 6d20 6f72 2072  result_ndim or r
+00025620: 6573 756c 745f 6e64 696d 202d 2031 203c  esult_ndim - 1 <
+00025630: 2061 3a0a 2020 2020 2020 2020 2020 2020   a:.            
+00025640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025650: 7261 6973 6520 496e 6465 7845 7272 6f72  raise IndexError
+00025660: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00025670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025680: 2020 6622 4178 6973 207b 617d 206f 6620    f"Axis {a} of 
+00025690: 7661 7269 6162 6c65 207b 6b7d 2069 7320  variable {k} is 
+000256a0: 6f75 7420 6f66 2062 6f75 6e64 7320 6f66  out of bounds of
+000256b0: 2074 6865 2022 0a20 2020 2020 2020 2020   the ".         
+000256c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000256d0: 2020 2020 2020 2066 2265 7870 616e 6465         f"expande
+000256e0: 6420 6469 6d65 6e73 696f 6e20 7369 7a65  d dimension size
+000256f0: 207b 7265 7375 6c74 5f6e 6469 6d7d 220a   {result_ndim}".
+00025700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025710: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00025720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025730: 2020 2061 7869 735f 706f 7320 3d20 5b61     axis_pos = [a
+00025740: 2069 6620 6120 3e3d 2030 2065 6c73 6520   if a >= 0 else 
+00025750: 7265 7375 6c74 5f6e 6469 6d20 2b20 6120  result_ndim + a 
+00025760: 666f 7220 6120 696e 2061 7869 735d 0a20  for a in axis]. 
+00025770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025780: 2020 2069 6620 6c65 6e28 6178 6973 5f70     if len(axis_p
+00025790: 6f73 2920 213d 206c 656e 2873 6574 2861  os) != len(set(a
+000257a0: 7869 735f 706f 7329 293a 0a20 2020 2020  xis_pos)):.     
+000257b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257c0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+000257d0: 726f 7228 2261 7869 7320 7368 6f75 6c64  ror("axis should
+000257e0: 206e 6f74 2063 6f6e 7461 696e 2064 7570   not contain dup
+000257f0: 6c69 6361 7465 2076 616c 7565 7322 290a  licate values").
+00025800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025810: 2020 2020 2320 5765 206e 6565 6420 746f      # We need to
+00025820: 2073 6f72 7420 7468 656d 2074 6f20 6d61   sort them to ma
+00025830: 6b65 2073 7572 6520 6061 7869 7360 2065  ke sure `axis` e
+00025840: 7175 616c 7320 746f 2074 6865 0a20 2020  quals to the.   
+00025850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025860: 2023 2061 7869 7320 706f 7369 7469 6f6e   # axis position
+00025870: 7320 6f66 2074 6865 2072 6573 756c 7420  s of the result 
+00025880: 6172 7261 792e 0a20 2020 2020 2020 2020  array..         
+00025890: 2020 2020 2020 2020 2020 207a 6970 5f61             zip_a
+000258a0: 7869 735f 6469 6d20 3d20 736f 7274 6564  xis_dim = sorted
+000258b0: 287a 6970 2861 7869 735f 706f 732c 2064  (zip(axis_pos, d
+000258c0: 696d 2e69 7465 6d73 2829 2929 0a0a 2020  im.items()))..  
+000258d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000258e0: 2020 616c 6c5f 6469 6d73 203d 206c 6973    all_dims = lis
+000258f0: 7428 7a69 7028 762e 6469 6d73 2c20 762e  t(zip(v.dims, v.
+00025900: 7368 6170 6529 290a 2020 2020 2020 2020  shape)).        
+00025910: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00025920: 642c 2063 2069 6e20 7a69 705f 6178 6973  d, c in zip_axis
+00025930: 5f64 696d 3a0a 2020 2020 2020 2020 2020  _dim:.          
+00025940: 2020 2020 2020 2020 2020 2020 2020 616c                al
+00025950: 6c5f 6469 6d73 2e69 6e73 6572 7428 642c  l_dims.insert(d,
+00025960: 2063 290a 2020 2020 2020 2020 2020 2020   c).            
+00025970: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00025980: 735b 6b5d 203d 2076 2e73 6574 5f64 696d  s[k] = v.set_dim
+00025990: 7328 6469 6374 2861 6c6c 5f64 696d 7329  s(dict(all_dims)
+000259a0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+000259b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000259c0: 2020 2020 6966 206b 206e 6f74 2069 6e20      if k not in 
+000259d0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+000259e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000259f0: 2049 6620 6469 6d73 2069 6e63 6c75 6465   If dims include
+00025a00: 7320 6120 6c61 6265 6c20 6f66 2061 206e  s a label of a n
+00025a10: 6f6e 2d64 696d 656e 7369 6f6e 2063 6f6f  on-dimension coo
+00025a20: 7264 696e 6174 652c 0a20 2020 2020 2020  rdinate,.       
+00025a30: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00025a40: 7420 7769 6c6c 2062 6520 7072 6f6d 6f74  t will be promot
+00025a50: 6564 2074 6f20 6120 3144 2063 6f6f 7264  ed to a 1D coord
+00025a60: 696e 6174 6520 7769 7468 2061 2073 696e  inate with a sin
+00025a70: 676c 6520 7661 6c75 652e 0a20 2020 2020  gle value..     
+00025a80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00025a90: 6e64 6578 2c20 696e 6465 785f 7661 7273  ndex, index_vars
+00025aa0: 203d 2063 7265 6174 655f 6465 6661 756c   = create_defaul
+00025ab0: 745f 696e 6465 785f 696d 706c 6963 6974  t_index_implicit
+00025ac0: 2876 2e73 6574 5f64 696d 7328 6b29 290a  (v.set_dims(k)).
+00025ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ae0: 2020 2020 696e 6465 7865 735b 6b5d 203d      indexes[k] =
+00025af0: 2069 6e64 6578 0a20 2020 2020 2020 2020   index.         
+00025b00: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+00025b10: 626c 6573 2e75 7064 6174 6528 696e 6465  bles.update(inde
+00025b20: 785f 7661 7273 290a 0a20 2020 2020 2020  x_vars)..       
+00025b30: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+00025b40: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
+00025b50: 696d 7328 0a20 2020 2020 2020 2020 2020  ims(.           
+00025b60: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
+00025b70: 645f 6e61 6d65 733d 636f 6f72 645f 6e61  d_names=coord_na
+00025b80: 6d65 732c 2069 6e64 6578 6573 3d69 6e64  mes, indexes=ind
+00025b90: 6578 6573 0a20 2020 2020 2020 2029 0a0a  exes.        )..
+00025ba0: 2020 2020 2320 6368 616e 6765 2074 7970      # change typ
+00025bb0: 6520 6f66 2073 656c 6620 616e 6420 7265  e of self and re
+00025bc0: 7475 726e 2074 6f20 545f 4461 7461 7365  turn to T_Datase
+00025bd0: 7420 6f6e 6365 0a20 2020 2023 2068 7474  t once.    # htt
+00025be0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00025bf0: 7079 7468 6f6e 2f6d 7970 792f 6973 7375  python/mypy/issu
+00025c00: 6573 2f31 3238 3436 2069 7320 7265 736f  es/12846 is reso
+00025c10: 6c76 6564 0a20 2020 2064 6566 2073 6574  lved.    def set
+00025c20: 5f69 6e64 6578 280a 2020 2020 2020 2020  _index(.        
+00025c30: 7365 6c66 2c0a 2020 2020 2020 2020 696e  self,.        in
+00025c40: 6465 7865 733a 204d 6170 7069 6e67 5b41  dexes: Mapping[A
+00025c50: 6e79 2c20 4861 7368 6162 6c65 207c 2053  ny, Hashable | S
+00025c60: 6571 7565 6e63 655b 4861 7368 6162 6c65  equence[Hashable
+00025c70: 5d5d 207c 204e 6f6e 6520 3d20 4e6f 6e65  ]] | None = None
+00025c80: 2c0a 2020 2020 2020 2020 6170 7065 6e64  ,.        append
+00025c90: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00025ca0: 2020 2020 2020 2020 2a2a 696e 6465 7865          **indexe
+00025cb0: 735f 6b77 6172 6773 3a20 4861 7368 6162  s_kwargs: Hashab
+00025cc0: 6c65 207c 2053 6571 7565 6e63 655b 4861  le | Sequence[Ha
+00025cd0: 7368 6162 6c65 5d2c 0a20 2020 2029 202d  shable],.    ) -
+00025ce0: 3e20 4461 7461 7365 743a 0a20 2020 2020  > Dataset:.     
+00025cf0: 2020 2022 2222 5365 7420 4461 7461 7365     """Set Datase
+00025d00: 7420 286d 756c 7469 2d29 696e 6465 7865  t (multi-)indexe
+00025d10: 7320 7573 696e 6720 6f6e 6520 6f72 206d  s using one or m
+00025d20: 6f72 6520 6578 6973 7469 6e67 2063 6f6f  ore existing coo
+00025d30: 7264 696e 6174 6573 0a20 2020 2020 2020  rdinates.       
+00025d40: 206f 7220 7661 7269 6162 6c65 732e 0a0a   or variables...
+00025d50: 2020 2020 2020 2020 5468 6973 206c 6567          This leg
+00025d60: 6163 7920 6d65 7468 6f64 2069 7320 6c69  acy method is li
+00025d70: 6d69 7465 6420 746f 2070 616e 6461 7320  mited to pandas 
+00025d80: 286d 756c 7469 2d29 696e 6465 7865 7320  (multi-)indexes 
+00025d90: 616e 640a 2020 2020 2020 2020 312d 6469  and.        1-di
+00025da0: 6d65 6e73 696f 6e61 6c20 2264 696d 656e  mensional "dimen
+00025db0: 7369 6f6e 2220 636f 6f72 6469 6e61 7465  sion" coordinate
+00025dc0: 732e 2053 6565 0a20 2020 2020 2020 203a  s. See.        :
+00025dd0: 7079 3a6d 6574 683a 607e 4461 7461 7365  py:meth:`~Datase
+00025de0: 742e 7365 745f 7869 6e64 6578 6020 666f  t.set_xindex` fo
+00025df0: 7220 7365 7474 696e 6720 6120 7061 6e64  r setting a pand
+00025e00: 6173 206f 7220 6120 6375 7374 6f6d 0a20  as or a custom. 
+00025e10: 2020 2020 2020 2058 6172 7261 792d 636f         Xarray-co
+00025e20: 6d70 6174 6962 6c65 2069 6e64 6578 2066  mpatible index f
+00025e30: 726f 6d20 6f6e 6520 6f72 206d 6f72 6520  rom one or more 
+00025e40: 6172 6269 7472 6172 7920 636f 6f72 6469  arbitrary coordi
+00025e50: 6e61 7465 732e 0a0a 2020 2020 2020 2020  nates...        
+00025e60: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00025e70: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00025e80: 2020 2020 2020 696e 6465 7865 7320 3a20        indexes : 
+00025e90: 7b64 696d 3a20 696e 6465 782c 202e 2e2e  {dim: index, ...
+00025ea0: 7d0a 2020 2020 2020 2020 2020 2020 4d61  }.            Ma
+00025eb0: 7070 696e 6720 6672 6f6d 206e 616d 6573  pping from names
+00025ec0: 206d 6174 6368 696e 6720 6469 6d65 6e73   matching dimens
+00025ed0: 696f 6e73 2061 6e64 2076 616c 7565 7320  ions and values 
+00025ee0: 6769 7665 6e0a 2020 2020 2020 2020 2020  given.          
+00025ef0: 2020 6279 2028 6c69 7374 7320 6f66 2920    by (lists of) 
+00025f00: 7468 6520 6e61 6d65 7320 6f66 2065 7869  the names of exi
+00025f10: 7374 696e 6720 636f 6f72 6469 6e61 7465  sting coordinate
+00025f20: 7320 6f72 2076 6172 6961 626c 6573 2074  s or variables t
+00025f30: 6f20 7365 740a 2020 2020 2020 2020 2020  o set.          
+00025f40: 2020 6173 206e 6577 2028 6d75 6c74 692d    as new (multi-
+00025f50: 2969 6e64 6578 2e0a 2020 2020 2020 2020  )index..        
+00025f60: 6170 7065 6e64 203a 2062 6f6f 6c2c 2064  append : bool, d
+00025f70: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
+00025f80: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00025f90: 652c 2061 7070 656e 6420 7468 6520 7375  e, append the su
+00025fa0: 7070 6c69 6564 2069 6e64 6578 2865 7329  pplied index(es)
+00025fb0: 2074 6f20 7468 6520 6578 6973 7469 6e67   to the existing
+00025fc0: 2069 6e64 6578 2865 7329 2e0a 2020 2020   index(es)..    
+00025fd0: 2020 2020 2020 2020 4f74 6865 7277 6973          Otherwis
+00025fe0: 6520 7265 706c 6163 6520 7468 6520 6578  e replace the ex
+00025ff0: 6973 7469 6e67 2069 6e64 6578 2865 7329  isting index(es)
+00026000: 2028 6465 6661 756c 7429 2e0a 2020 2020   (default)..    
+00026010: 2020 2020 2a2a 696e 6465 7865 735f 6b77      **indexes_kw
+00026020: 6172 6773 203a 206f 7074 696f 6e61 6c0a  args : optional.
+00026030: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+00026040: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
+00026050: 7320 666f 726d 206f 6620 6060 696e 6465  s form of ``inde
+00026060: 7865 7360 602e 0a20 2020 2020 2020 2020  xes``..         
+00026070: 2020 204f 6e65 206f 6620 696e 6465 7865     One of indexe
+00026080: 7320 6f72 2069 6e64 6578 6573 5f6b 7761  s or indexes_kwa
+00026090: 7267 7320 6d75 7374 2062 6520 7072 6f76  rgs must be prov
+000260a0: 6964 6564 2e0a 0a20 2020 2020 2020 2052  ided...        R
+000260b0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+000260c0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206f  ------.        o
+000260d0: 626a 203a 2044 6174 6173 6574 0a20 2020  bj : Dataset.   
+000260e0: 2020 2020 2020 2020 2041 6e6f 7468 6572           Another
+000260f0: 2064 6174 6173 6574 2c20 7769 7468 2074   dataset, with t
+00026100: 6869 7320 6461 7461 7365 7427 7320 6461  his dataset's da
+00026110: 7461 2062 7574 2072 6570 6c61 6365 6420  ta but replaced 
+00026120: 636f 6f72 6469 6e61 7465 732e 0a0a 2020  coordinates...  
+00026130: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
+00026140: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+00026150: 2020 2020 2020 2020 3e3e 3e20 6172 7220          >>> arr 
+00026160: 3d20 7872 2e44 6174 6141 7272 6179 280a  = xr.DataArray(.
+00026170: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+00026180: 6461 7461 3d6e 702e 6f6e 6573 2828 322c  data=np.ones((2,
+00026190: 2033 2929 2c0a 2020 2020 2020 2020 2e2e   3)),.        ..
+000261a0: 2e20 2020 2020 6469 6d73 3d5b 2278 222c  .     dims=["x",
+000261b0: 2022 7922 5d2c 0a20 2020 2020 2020 202e   "y"],.        .
+000261c0: 2e2e 2020 2020 2063 6f6f 7264 733d 7b22  ..     coords={"
+000261d0: 7822 3a20 7261 6e67 6528 3229 2c20 2279  x": range(2), "y
+000261e0: 223a 2072 616e 6765 2833 292c 2022 6122  ": range(3), "a"
+000261f0: 3a20 2822 7822 2c20 5b33 2c20 345d 297d  : ("x", [3, 4])}
+00026200: 2c0a 2020 2020 2020 2020 2e2e 2e20 290a  ,.        ... ).
+00026210: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+00026220: 2078 722e 4461 7461 7365 7428 7b22 7622   xr.Dataset({"v"
+00026230: 3a20 6172 727d 290a 2020 2020 2020 2020  : arr}).        
+00026240: 3e3e 3e20 6473 0a20 2020 2020 2020 203c  >>> ds.        <
+00026250: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+00026260: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00026270: 6e73 3a20 2028 783a 2032 2c20 793a 2033  ns:  (x: 2, y: 3
+00026280: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+00026290: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+000262a0: 202a 2078 2020 2020 2020 2020 2878 2920   * x        (x) 
+000262b0: 696e 7436 3420 3020 310a 2020 2020 2020  int64 0 1.      
+000262c0: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
+000262d0: 7929 2069 6e74 3634 2030 2031 2032 0a20  y) int64 0 1 2. 
+000262e0: 2020 2020 2020 2020 2020 2061 2020 2020             a    
+000262f0: 2020 2020 2878 2920 696e 7436 3420 3320      (x) int64 3 
+00026300: 340a 2020 2020 2020 2020 4461 7461 2076  4.        Data v
+00026310: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+00026320: 2020 2020 2020 7620 2020 2020 2020 2028        v        (
+00026330: 782c 2079 2920 666c 6f61 7436 3420 312e  x, y) float64 1.
+00026340: 3020 312e 3020 312e 3020 312e 3020 312e  0 1.0 1.0 1.0 1.
+00026350: 3020 312e 300a 2020 2020 2020 2020 3e3e  0 1.0.        >>
+00026360: 3e20 6473 2e73 6574 5f69 6e64 6578 2878  > ds.set_index(x
+00026370: 3d22 6122 290a 2020 2020 2020 2020 3c78  ="a").        <x
+00026380: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+00026390: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+000263a0: 733a 2020 2878 3a20 322c 2079 3a20 3329  s:  (x: 2, y: 3)
+000263b0: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
+000263c0: 6174 6573 3a0a 2020 2020 2020 2020 2020  ates:.          
+000263d0: 2a20 7820 2020 2020 2020 2028 7829 2069  * x        (x) i
+000263e0: 6e74 3634 2033 2034 0a20 2020 2020 2020  nt64 3 4.       
+000263f0: 2020 202a 2079 2020 2020 2020 2020 2879     * y        (y
+00026400: 2920 696e 7436 3420 3020 3120 320a 2020  ) int64 0 1 2.  
+00026410: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+00026420: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+00026430: 2020 7620 2020 2020 2020 2028 782c 2079    v        (x, y
+00026440: 2920 666c 6f61 7436 3420 312e 3020 312e  ) float64 1.0 1.
+00026450: 3020 312e 3020 312e 3020 312e 3020 312e  0 1.0 1.0 1.0 1.
+00026460: 300a 0a20 2020 2020 2020 2053 6565 2041  0..        See A
+00026470: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+00026480: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
+00026490: 6173 6574 2e72 6573 6574 5f69 6e64 6578  aset.reset_index
+000264a0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+000264b0: 2e73 6574 5f78 696e 6465 780a 2020 2020  .set_xindex.    
+000264c0: 2020 2020 4461 7461 7365 742e 7377 6170      Dataset.swap
+000264d0: 5f64 696d 730a 2020 2020 2020 2020 2222  _dims.        ""
+000264e0: 220a 2020 2020 2020 2020 6469 6d5f 636f  ".        dim_co
+000264f0: 6f72 6473 203d 2065 6974 6865 725f 6469  ords = either_di
+00026500: 6374 5f6f 725f 6b77 6172 6773 2869 6e64  ct_or_kwargs(ind
+00026510: 6578 6573 2c20 696e 6465 7865 735f 6b77  exes, indexes_kw
+00026520: 6172 6773 2c20 2273 6574 5f69 6e64 6578  args, "set_index
+00026530: 2229 0a0a 2020 2020 2020 2020 6e65 775f  ")..        new_
+00026540: 696e 6465 7865 733a 2064 6963 745b 4861  indexes: dict[Ha
+00026550: 7368 6162 6c65 2c20 496e 6465 785d 203d  shable, Index] =
+00026560: 207b 7d0a 2020 2020 2020 2020 6e65 775f   {}.        new_
+00026570: 7661 7269 6162 6c65 733a 2064 6963 745b  variables: dict[
+00026580: 4861 7368 6162 6c65 2c20 5661 7269 6162  Hashable, Variab
+00026590: 6c65 5d20 3d20 7b7d 0a20 2020 2020 2020  le] = {}.       
+000265a0: 2064 726f 705f 696e 6465 7865 733a 2073   drop_indexes: s
+000265b0: 6574 5b48 6173 6861 626c 655d 203d 2073  et[Hashable] = s
+000265c0: 6574 2829 0a20 2020 2020 2020 2064 726f  et().        dro
+000265d0: 705f 7661 7269 6162 6c65 733a 2073 6574  p_variables: set
+000265e0: 5b48 6173 6861 626c 655d 203d 2073 6574  [Hashable] = set
+000265f0: 2829 0a20 2020 2020 2020 2072 6570 6c61  ().        repla
+00026600: 6365 5f64 696d 733a 2064 6963 745b 4861  ce_dims: dict[Ha
+00026610: 7368 6162 6c65 2c20 4861 7368 6162 6c65  shable, Hashable
+00026620: 5d20 3d20 7b7d 0a20 2020 2020 2020 2061  ] = {}.        a
+00026630: 6c6c 5f76 6172 5f6e 616d 6573 3a20 7365  ll_var_names: se
+00026640: 745b 4861 7368 6162 6c65 5d20 3d20 7365  t[Hashable] = se
+00026650: 7428 290a 0a20 2020 2020 2020 2066 6f72  t()..        for
+00026660: 2064 696d 2c20 5f76 6172 5f6e 616d 6573   dim, _var_names
+00026670: 2069 6e20 6469 6d5f 636f 6f72 6473 2e69   in dim_coords.i
+00026680: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+00026690: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+000266a0: 6528 5f76 6172 5f6e 616d 6573 2c20 7374  e(_var_names, st
+000266b0: 7229 206f 7220 6e6f 7420 6973 696e 7374  r) or not isinst
+000266c0: 616e 6365 285f 7661 725f 6e61 6d65 732c  ance(_var_names,
+000266d0: 2053 6571 7565 6e63 6529 3a0a 2020 2020   Sequence):.    
+000266e0: 2020 2020 2020 2020 2020 2020 7661 725f              var_
+000266f0: 6e61 6d65 7320 3d20 5b5f 7661 725f 6e61  names = [_var_na
+00026700: 6d65 735d 0a20 2020 2020 2020 2020 2020  mes].           
+00026710: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00026720: 2020 2020 2020 2076 6172 5f6e 616d 6573         var_names
+00026730: 203d 206c 6973 7428 5f76 6172 5f6e 616d   = list(_var_nam
+00026740: 6573 290a 0a20 2020 2020 2020 2020 2020  es)..           
+00026750: 2069 6e76 616c 6964 5f76 6172 7320 3d20   invalid_vars = 
+00026760: 7365 7428 7661 725f 6e61 6d65 7329 202d  set(var_names) -
+00026770: 2073 6574 2873 656c 662e 5f76 6172 6961   set(self._varia
+00026780: 626c 6573 290a 2020 2020 2020 2020 2020  bles).          
+00026790: 2020 6966 2069 6e76 616c 6964 5f76 6172    if invalid_var
+000267a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000267b0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+000267c0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+000267d0: 2020 2020 2020 2020 2022 2c20 222e 6a6f           ", ".jo
+000267e0: 696e 285b 7374 7228 7629 2066 6f72 2076  in([str(v) for v
+000267f0: 2069 6e20 696e 7661 6c69 645f 7661 7273   in invalid_vars
+00026800: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00026810: 2020 2020 2020 202b 2022 2076 6172 6961         + " varia
+00026820: 626c 6528 7329 2064 6f20 6e6f 7420 6578  ble(s) do not ex
+00026830: 6973 7422 0a20 2020 2020 2020 2020 2020  ist".           
+00026840: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00026850: 2020 2020 616c 6c5f 7661 725f 6e61 6d65      all_var_name
+00026860: 732e 7570 6461 7465 2876 6172 5f6e 616d  s.update(var_nam
+00026870: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00026880: 6472 6f70 5f76 6172 6961 626c 6573 2e75  drop_variables.u
+00026890: 7064 6174 6528 7661 725f 6e61 6d65 7329  pdate(var_names)
+000268a0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000268b0: 6472 6f70 2061 6e79 2070 7265 2d65 7869  drop any pre-exi
+000268c0: 7374 696e 6720 696e 6465 7820 696e 766f  sting index invo
+000268d0: 6c76 6564 2061 6e64 2069 7473 2063 6f72  lved and its cor
+000268e0: 7265 7370 6f6e 6469 6e67 2063 6f6f 7264  responding coord
+000268f0: 696e 6174 6573 0a20 2020 2020 2020 2020  inates.         
+00026900: 2020 2069 6e64 6578 5f63 6f6f 7264 5f6e     index_coord_n
+00026910: 616d 6573 203d 2073 656c 662e 7869 6e64  ames = self.xind
+00026920: 6578 6573 2e67 6574 5f61 6c6c 5f63 6f6f  exes.get_all_coo
+00026930: 7264 7328 6469 6d2c 2065 7272 6f72 733d  rds(dim, errors=
+00026940: 2269 676e 6f72 6522 290a 2020 2020 2020  "ignore").      
+00026950: 2020 2020 2020 616c 6c5f 696e 6465 785f        all_index_
+00026960: 636f 6f72 645f 6e61 6d65 7320 3d20 7365  coord_names = se
+00026970: 7428 696e 6465 785f 636f 6f72 645f 6e61  t(index_coord_na
+00026980: 6d65 7329 0a20 2020 2020 2020 2020 2020  mes).           
+00026990: 2066 6f72 206b 2069 6e20 7661 725f 6e61   for k in var_na
+000269a0: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
+000269b0: 2020 2020 2061 6c6c 5f69 6e64 6578 5f63       all_index_c
+000269c0: 6f6f 7264 5f6e 616d 6573 2e75 7064 6174  oord_names.updat
+000269d0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+000269e0: 2020 2020 2020 2073 656c 662e 7869 6e64         self.xind
+000269f0: 6578 6573 2e67 6574 5f61 6c6c 5f63 6f6f  exes.get_all_coo
+00026a00: 7264 7328 6b2c 2065 7272 6f72 733d 2269  rds(k, errors="i
+00026a10: 676e 6f72 6522 290a 2020 2020 2020 2020  gnore").        
+00026a20: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00026a30: 2020 2020 2020 2064 726f 705f 696e 6465         drop_inde
+00026a40: 7865 732e 7570 6461 7465 2861 6c6c 5f69  xes.update(all_i
+00026a50: 6e64 6578 5f63 6f6f 7264 5f6e 616d 6573  ndex_coord_names
+00026a60: 290a 2020 2020 2020 2020 2020 2020 6472  ).            dr
+00026a70: 6f70 5f76 6172 6961 626c 6573 2e75 7064  op_variables.upd
+00026a80: 6174 6528 616c 6c5f 696e 6465 785f 636f  ate(all_index_co
+00026a90: 6f72 645f 6e61 6d65 7329 0a0a 2020 2020  ord_names)..    
+00026aa0: 2020 2020 2020 2020 6966 206c 656e 2876          if len(v
+00026ab0: 6172 5f6e 616d 6573 2920 3d3d 2031 2061  ar_names) == 1 a
+00026ac0: 6e64 2028 6e6f 7420 6170 7065 6e64 206f  nd (not append o
+00026ad0: 7220 6469 6d20 6e6f 7420 696e 2073 656c  r dim not in sel
+00026ae0: 662e 5f69 6e64 6578 6573 293a 0a20 2020  f._indexes):.   
+00026af0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00026b00: 5f6e 616d 6520 3d20 7661 725f 6e61 6d65  _name = var_name
+00026b10: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+00026b20: 2020 2020 2076 6172 203d 2073 656c 662e       var = self.
+00026b30: 5f76 6172 6961 626c 6573 5b76 6172 5f6e  _variables[var_n
+00026b40: 616d 655d 0a20 2020 2020 2020 2020 2020  ame].           
+00026b50: 2020 2020 2069 6620 7661 722e 6469 6d73       if var.dims
+00026b60: 2021 3d20 2864 696d 2c29 3a0a 2020 2020   != (dim,):.    
+00026b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b80: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00026b90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00026ba0: 2020 2020 2020 2020 2020 6622 6469 6d65            f"dime
+00026bb0: 6e73 696f 6e20 6d69 736d 6174 6368 3a20  nsion mismatch: 
+00026bc0: 7472 7920 7365 7474 696e 6720 616e 2069  try setting an i
+00026bd0: 6e64 6578 2066 6f72 2064 696d 656e 7369  ndex for dimensi
+00026be0: 6f6e 207b 6469 6d21 727d 2077 6974 6820  on {dim!r} with 
+00026bf0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00026c00: 2020 2020 2020 2020 2020 6622 7661 7269            f"vari
+00026c10: 6162 6c65 207b 7661 725f 6e61 6d65 2172  able {var_name!r
+00026c20: 7d20 7468 6174 2068 6173 2064 696d 656e  } that has dimen
+00026c30: 7369 6f6e 7320 7b76 6172 2e64 696d 737d  sions {var.dims}
+00026c40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00026c50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00026c60: 2020 2020 2020 2020 6964 7820 3d20 5061          idx = Pa
+00026c70: 6e64 6173 496e 6465 782e 6672 6f6d 5f76  ndasIndex.from_v
+00026c80: 6172 6961 626c 6573 287b 6469 6d3a 2076  ariables({dim: v
+00026c90: 6172 7d2c 206f 7074 696f 6e73 3d7b 7d29  ar}, options={})
+00026ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026cb0: 2069 6478 5f76 6172 7320 3d20 6964 782e   idx_vars = idx.
+00026cc0: 6372 6561 7465 5f76 6172 6961 626c 6573  create_variables
+00026cd0: 287b 7661 725f 6e61 6d65 3a20 7661 727d  ({var_name: var}
+00026ce0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00026cf0: 2020 2023 2074 7269 636b 2074 6f20 7072     # trick to pr
+00026d00: 6573 6572 7665 2063 6f6f 7264 696e 6174  eserve coordinat
+00026d10: 6520 6f72 6465 7220 696e 2074 6869 7320  e order in this 
+00026d20: 6361 7365 0a20 2020 2020 2020 2020 2020  case.           
+00026d30: 2020 2020 2069 6620 6469 6d20 696e 2073       if dim in s
+00026d40: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
+00026d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026d60: 2020 2020 2020 6472 6f70 5f76 6172 6961        drop_varia
+00026d70: 626c 6573 2e72 656d 6f76 6528 6469 6d29  bles.remove(dim)
+00026d80: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00026d90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00026da0: 2020 2069 6620 6170 7065 6e64 3a0a 2020     if append:.  
+00026db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026dc0: 2020 6375 7272 656e 745f 7661 7269 6162    current_variab
+00026dd0: 6c65 7320 3d20 7b0a 2020 2020 2020 2020  les = {.        
+00026de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026df0: 6b3a 2073 656c 662e 5f76 6172 6961 626c  k: self._variabl
+00026e00: 6573 5b6b 5d20 666f 7220 6b20 696e 2069  es[k] for k in i
+00026e10: 6e64 6578 5f63 6f6f 7264 5f6e 616d 6573  ndex_coord_names
+00026e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026e30: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00026e40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00026e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026e60: 2063 7572 7265 6e74 5f76 6172 6961 626c   current_variabl
+00026e70: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+00026e80: 2020 2020 2020 2020 6964 782c 2069 6478          idx, idx
+00026e90: 5f76 6172 7320 3d20 5061 6e64 6173 4d75  _vars = PandasMu
+00026ea0: 6c74 6949 6e64 6578 2e66 726f 6d5f 7661  ltiIndex.from_va
+00026eb0: 7269 6162 6c65 735f 6d61 7962 655f 6578  riables_maybe_ex
+00026ec0: 7061 6e64 280a 2020 2020 2020 2020 2020  pand(.          
+00026ed0: 2020 2020 2020 2020 2020 6469 6d2c 0a20            dim,. 
+00026ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ef0: 2020 2063 7572 7265 6e74 5f76 6172 6961     current_varia
+00026f00: 626c 6573 2c0a 2020 2020 2020 2020 2020  bles,.          
+00026f10: 2020 2020 2020 2020 2020 7b6b 3a20 7365            {k: se
+00026f20: 6c66 2e5f 7661 7269 6162 6c65 735b 6b5d  lf._variables[k]
+00026f30: 2066 6f72 206b 2069 6e20 7661 725f 6e61   for k in var_na
+00026f40: 6d65 737d 2c0a 2020 2020 2020 2020 2020  mes},.          
+00026f50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00026f60: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
+00026f70: 2069 6478 2e69 6e64 6578 2e6e 616d 6573   idx.index.names
+00026f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026f90: 2020 2020 2020 7265 706c 6163 655f 6469        replace_di
+00026fa0: 6d73 5b6e 5d20 3d20 6469 6d0a 0a20 2020  ms[n] = dim..   
+00026fb0: 2020 2020 2020 2020 206e 6577 5f69 6e64           new_ind
+00026fc0: 6578 6573 2e75 7064 6174 6528 7b6b 3a20  exes.update({k: 
+00026fd0: 6964 7820 666f 7220 6b20 696e 2069 6478  idx for k in idx
+00026fe0: 5f76 6172 737d 290a 2020 2020 2020 2020  _vars}).        
+00026ff0: 2020 2020 6e65 775f 7661 7269 6162 6c65      new_variable
+00027000: 732e 7570 6461 7465 2869 6478 5f76 6172  s.update(idx_var
+00027010: 7329 0a0a 2020 2020 2020 2020 2320 7265  s)..        # re
+00027020: 2d61 6464 2064 6569 6e64 6578 6564 2063  -add deindexed c
+00027030: 6f6f 7264 696e 6174 6573 2028 636f 6e76  oordinates (conv
+00027040: 6572 7420 746f 2062 6173 6520 7661 7269  ert to base vari
+00027050: 6162 6c65 7329 0a20 2020 2020 2020 2066  ables).        f
+00027060: 6f72 206b 2069 6e20 6472 6f70 5f76 6172  or k in drop_var
+00027070: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+00027080: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00027090: 2020 2020 2020 2020 206b 206e 6f74 2069           k not i
+000270a0: 6e20 6e65 775f 7661 7269 6162 6c65 730a  n new_variables.
 000270b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000270c0: 6261 7365 5f76 6172 7320 3d20 7b0a 2020  base_vars = {.  
-000270d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000270e0: 2020 6b3a 2073 656c 662e 5f76 6172 6961    k: self._varia
-000270f0: 626c 6573 5b6b 5d2e 746f 5f62 6173 655f  bles[k].to_base_
-00027100: 7661 7269 6162 6c65 2829 2066 6f72 206b  variable() for k
-00027110: 2069 6e20 7661 725f 6e61 6d65 730a 2020   in var_names.  
-00027120: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-00027130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027140: 6e65 775f 7661 7269 6162 6c65 732e 7570  new_variables.up
-00027150: 6461 7465 2862 6173 655f 7661 7273 290a  date(base_vars).
-00027160: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-00027170: 6520 696e 2064 696d 735f 6f72 5f6c 6576  e in dims_or_lev
-00027180: 656c 733a 0a20 2020 2020 2020 2020 2020  els:.           
-00027190: 2069 6e64 6578 203d 2073 656c 662e 5f69   index = self._i
-000271a0: 6e64 6578 6573 5b6e 616d 655d 0a0a 2020  ndexes[name]..  
-000271b0: 2020 2020 2020 2020 2020 6966 2069 6e64            if ind
-000271c0: 6578 2069 6e20 7365 656e 3a0a 2020 2020  ex in seen:.    
-000271d0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-000271e0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-000271f0: 2073 6565 6e2e 6164 6428 696e 6465 7829   seen.add(index)
-00027200: 0a0a 2020 2020 2020 2020 2020 2020 6964  ..            id
-00027210: 785f 7661 725f 6e61 6d65 7320 3d20 7365  x_var_names = se
-00027220: 7428 7365 6c66 2e78 696e 6465 7865 732e  t(self.xindexes.
-00027230: 6765 745f 616c 6c5f 636f 6f72 6473 286e  get_all_coords(n
-00027240: 616d 6529 290a 2020 2020 2020 2020 2020  ame)).          
-00027250: 2020 6472 6f70 5f69 6e64 6578 6573 2e75    drop_indexes.u
-00027260: 7064 6174 6528 6964 785f 7661 725f 6e61  pdate(idx_var_na
-00027270: 6d65 7329 0a0a 2020 2020 2020 2020 2020  mes)..          
-00027280: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00027290: 696e 6465 782c 2050 616e 6461 734d 756c  index, PandasMul
-000272a0: 7469 496e 6465 7829 3a0a 2020 2020 2020  tiIndex):.      
-000272b0: 2020 2020 2020 2020 2020 2320 7370 6563            # spec
-000272c0: 6961 6c20 6361 7365 2066 6f72 2070 642e  ial case for pd.
-000272d0: 4d75 6c74 6949 6e64 6578 0a20 2020 2020  MultiIndex.     
-000272e0: 2020 2020 2020 2020 2020 206c 6576 656c             level
-000272f0: 5f6e 616d 6573 203d 2069 6e64 6578 2e69  _names = index.i
-00027300: 6e64 6578 2e6e 616d 6573 0a20 2020 2020  ndex.names.     
-00027310: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
-00027320: 6c65 7665 6c5f 7661 7273 203d 207b 0a20  level_vars = {. 
-00027330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027340: 2020 206b 3a20 7365 6c66 2e5f 7661 7269     k: self._vari
-00027350: 6162 6c65 735b 6b5d 0a20 2020 2020 2020  ables[k].       
-00027360: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00027370: 206b 2069 6e20 6c65 7665 6c5f 6e61 6d65   k in level_name
-00027380: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00027390: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
-000273a0: 6e20 6469 6d73 5f6f 725f 6c65 7665 6c73  n dims_or_levels
-000273b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000273c0: 207d 0a0a 2020 2020 2020 2020 2020 2020   }..            
-000273d0: 2020 2020 6966 2069 6e64 6578 2e64 696d      if index.dim
-000273e0: 206e 6f74 2069 6e20 6469 6d73 5f6f 725f   not in dims_or_
-000273f0: 6c65 7665 6c73 2061 6e64 206b 6565 705f  levels and keep_
-00027400: 6c65 7665 6c5f 7661 7273 3a0a 2020 2020  level_vars:.    
-00027410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027420: 2320 646f 206e 6f74 2064 726f 7020 7468  # do not drop th
-00027430: 6520 6d75 6c74 692d 696e 6465 7820 636f  e multi-index co
-00027440: 6d70 6c65 7465 6c79 0a20 2020 2020 2020  mpletely.       
-00027450: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-00027460: 6e73 7465 6164 2072 6570 6c61 6365 2069  nstead replace i
-00027470: 7420 6279 2061 206e 6577 2028 6d75 6c74  t by a new (mult
-00027480: 692d 2969 6e64 6578 2077 6974 6820 6472  i-)index with dr
-00027490: 6f70 7065 6420 6c65 7665 6c28 7329 0a20  opped level(s). 
-000274a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000274b0: 2020 2069 6478 203d 2069 6e64 6578 2e6b     idx = index.k
-000274c0: 6565 705f 6c65 7665 6c73 286b 6565 705f  eep_levels(keep_
-000274d0: 6c65 7665 6c5f 7661 7273 290a 2020 2020  level_vars).    
-000274e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000274f0: 6964 785f 7661 7273 203d 2069 6478 2e63  idx_vars = idx.c
-00027500: 7265 6174 655f 7661 7269 6162 6c65 7328  reate_variables(
-00027510: 6b65 6570 5f6c 6576 656c 5f76 6172 7329  keep_level_vars)
-00027520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027530: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
-00027540: 2e75 7064 6174 6528 7b6b 3a20 6964 7820  .update({k: idx 
-00027550: 666f 7220 6b20 696e 2069 6478 5f76 6172  for k in idx_var
-00027560: 737d 290a 2020 2020 2020 2020 2020 2020  s}).            
-00027570: 2020 2020 2020 2020 6e65 775f 7661 7269          new_vari
-00027580: 6162 6c65 732e 7570 6461 7465 2869 6478  ables.update(idx
-00027590: 5f76 6172 7329 0a20 2020 2020 2020 2020  _vars).         
-000275a0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000275b0: 7420 6973 696e 7374 616e 6365 2869 6478  t isinstance(idx
-000275c0: 2c20 5061 6e64 6173 4d75 6c74 6949 6e64  , PandasMultiInd
-000275d0: 6578 293a 0a20 2020 2020 2020 2020 2020  ex):.           
-000275e0: 2020 2020 2020 2020 2020 2020 2023 206d               # m
-000275f0: 756c 7469 2d69 6e64 6578 2072 6564 7563  ulti-index reduc
-00027600: 6564 2074 6f20 7369 6e67 6c65 2069 6e64  ed to single ind
-00027610: 6578 0a20 2020 2020 2020 2020 2020 2020  ex.             
-00027620: 2020 2020 2020 2020 2020 2023 2062 6163             # bac
-00027630: 6b77 6172 6420 636f 6d70 6174 6962 696c  kward compatibil
-00027640: 6974 793a 2075 6e69 7175 6520 6c65 7665  ity: unique leve
-00027650: 6c20 636f 6f72 6469 6e61 7465 2072 656e  l coordinate ren
-00027660: 616d 6564 2074 6f20 6469 6d65 6e73 696f  amed to dimensio
-00027670: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00027680: 2020 2020 2020 2020 2020 6472 6f70 5f76            drop_v
-00027690: 6172 6961 626c 6573 2e75 7064 6174 6528  ariables.update(
-000276a0: 6b65 6570 5f6c 6576 656c 5f76 6172 7329  keep_level_vars)
-000276b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000276c0: 2020 2020 2064 726f 705f 6f72 5f63 6f6e       drop_or_con
-000276d0: 7665 7274 280a 2020 2020 2020 2020 2020  vert(.          
-000276e0: 2020 2020 2020 2020 2020 2020 2020 5b6b                [k
-000276f0: 2066 6f72 206b 2069 6e20 6c65 7665 6c5f   for k in level_
-00027700: 6e61 6d65 7320 6966 206b 206e 6f74 2069  names if k not i
-00027710: 6e20 6b65 6570 5f6c 6576 656c 5f76 6172  n keep_level_var
-00027720: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
-00027730: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00027740: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00027750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027760: 2020 2023 2061 6c77 6179 7320 6472 6f70     # always drop
-00027770: 2074 6865 206d 756c 7469 2d69 6e64 6578   the multi-index
-00027780: 2064 696d 656e 7369 6f6e 2076 6172 6961   dimension varia
-00027790: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
-000277a0: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
-000277b0: 6961 626c 6573 2e61 6464 2869 6e64 6578  iables.add(index
-000277c0: 2e64 696d 290a 2020 2020 2020 2020 2020  .dim).          
-000277d0: 2020 2020 2020 2020 2020 6472 6f70 5f6f            drop_o
-000277e0: 725f 636f 6e76 6572 7428 6c65 7665 6c5f  r_convert(level_
-000277f0: 6e61 6d65 7329 0a20 2020 2020 2020 2020  names).         
-00027800: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00027810: 2020 2020 2020 2020 2064 726f 705f 6f72           drop_or
-00027820: 5f63 6f6e 7665 7274 2869 6478 5f76 6172  _convert(idx_var
-00027830: 5f6e 616d 6573 290a 0a20 2020 2020 2020  _names)..       
-00027840: 2069 6e64 6578 6573 203d 207b 6b3a 2076   indexes = {k: v
-00027850: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-00027860: 662e 5f69 6e64 6578 6573 2e69 7465 6d73  f._indexes.items
-00027870: 2829 2069 6620 6b20 6e6f 7420 696e 2064  () if k not in d
-00027880: 726f 705f 696e 6465 7865 737d 0a20 2020  rop_indexes}.   
-00027890: 2020 2020 2069 6e64 6578 6573 2e75 7064       indexes.upd
-000278a0: 6174 6528 6e65 775f 696e 6465 7865 7329  ate(new_indexes)
-000278b0: 0a0a 2020 2020 2020 2020 7661 7269 6162  ..        variab
-000278c0: 6c65 7320 3d20 7b0a 2020 2020 2020 2020  les = {.        
-000278d0: 2020 2020 6b3a 2076 2066 6f72 206b 2c20      k: v for k, 
-000278e0: 7620 696e 2073 656c 662e 5f76 6172 6961  v in self._varia
-000278f0: 626c 6573 2e69 7465 6d73 2829 2069 6620  bles.items() if 
-00027900: 6b20 6e6f 7420 696e 2064 726f 705f 7661  k not in drop_va
-00027910: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
-00027920: 7d0a 2020 2020 2020 2020 7661 7269 6162  }.        variab
-00027930: 6c65 732e 7570 6461 7465 286e 6577 5f76  les.update(new_v
-00027940: 6172 6961 626c 6573 290a 0a20 2020 2020  ariables)..     
-00027950: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
-00027960: 2073 656c 662e 5f63 6f6f 7264 5f6e 616d   self._coord_nam
-00027970: 6573 202d 2064 726f 705f 7661 7269 6162  es - drop_variab
-00027980: 6c65 730a 0a20 2020 2020 2020 2072 6574  les..        ret
-00027990: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
-000279a0: 655f 7769 7468 5f6e 6577 5f64 696d 7328  e_with_new_dims(
-000279b0: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-000279c0: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
-000279d0: 6d65 733d 636f 6f72 645f 6e61 6d65 732c  mes=coord_names,
-000279e0: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
-000279f0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00027a00: 6465 6620 7365 745f 7869 6e64 6578 280a  def set_xindex(.
-00027a10: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
-00027a20: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
-00027a30: 2063 6f6f 7264 5f6e 616d 6573 3a20 7374   coord_names: st
-00027a40: 7220 7c20 5365 7175 656e 6365 5b48 6173  r | Sequence[Has
-00027a50: 6861 626c 655d 2c0a 2020 2020 2020 2020  hable],.        
-00027a60: 696e 6465 785f 636c 733a 2074 7970 655b  index_cls: type[
-00027a70: 496e 6465 785d 207c 204e 6f6e 6520 3d20  Index] | None = 
-00027a80: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
-00027a90: 6f70 7469 6f6e 732c 0a20 2020 2029 202d  options,.    ) -
-00027aa0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00027ab0: 2020 2020 2022 2222 5365 7420 6120 6e65       """Set a ne
-00027ac0: 772c 2058 6172 7261 792d 636f 6d70 6174  w, Xarray-compat
-00027ad0: 6962 6c65 2069 6e64 6578 2066 726f 6d20  ible index from 
-00027ae0: 6f6e 6520 6f72 206d 6f72 6520 6578 6973  one or more exis
-00027af0: 7469 6e67 0a20 2020 2020 2020 2063 6f6f  ting.        coo
-00027b00: 7264 696e 6174 6528 7329 2e0a 0a20 2020  rdinate(s)...   
-00027b10: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00027b20: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00027b30: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
-00027b40: 5f6e 616d 6573 203a 2073 7472 206f 7220  _names : str or 
-00027b50: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-00027b60: 204e 616d 6528 7329 206f 6620 7468 6520   Name(s) of the 
-00027b70: 636f 6f72 6469 6e61 7465 2873 2920 7573  coordinate(s) us
-00027b80: 6564 2074 6f20 6275 696c 6420 7468 6520  ed to build the 
-00027b90: 696e 6465 782e 0a20 2020 2020 2020 2020  index..         
-00027ba0: 2020 2049 6620 7365 7665 7261 6c20 6e61     If several na
-00027bb0: 6d65 7320 6172 6520 6769 7665 6e2c 2074  mes are given, t
-00027bc0: 6865 6972 206f 7264 6572 206d 6174 7465  heir order matte
-00027bd0: 7273 2e0a 2020 2020 2020 2020 696e 6465  rs..        inde
-00027be0: 785f 636c 7320 3a20 7375 6263 6c61 7373  x_cls : subclass
-00027bf0: 206f 6620 3a63 6c61 7373 3a60 7e78 6172   of :class:`~xar
-00027c00: 7261 792e 696e 6465 7865 732e 496e 6465  ray.indexes.Inde
-00027c10: 7860 2c20 6f70 7469 6f6e 616c 0a20 2020  x`, optional.   
-00027c20: 2020 2020 2020 2020 2054 6865 2074 7970           The typ
-00027c30: 6520 6f66 2069 6e64 6578 2074 6f20 6372  e of index to cr
-00027c40: 6561 7465 2e20 4279 2064 6566 6175 6c74  eate. By default
-00027c50: 2c20 7472 7920 7365 7474 696e 670a 2020  , try setting.  
-00027c60: 2020 2020 2020 2020 2020 6120 6060 5061            a ``Pa
-00027c70: 6e64 6173 496e 6465 7860 6020 6966 2060  ndasIndex`` if `
-00027c80: 606c 656e 2863 6f6f 7264 5f6e 616d 6573  `len(coord_names
-00027c90: 2920 3d3d 2031 6060 2c0a 2020 2020 2020  ) == 1``,.      
-00027ca0: 2020 2020 2020 6f74 6865 7277 6973 6520        otherwise 
-00027cb0: 6120 6060 5061 6e64 6173 4d75 6c74 6949  a ``PandasMultiI
-00027cc0: 6e64 6578 6060 2e0a 2020 2020 2020 2020  ndex``..        
-00027cd0: 2a2a 6f70 7469 6f6e 730a 2020 2020 2020  **options.      
-00027ce0: 2020 2020 2020 4f70 7469 6f6e 7320 7061        Options pa
-00027cf0: 7373 6564 2074 6f20 7468 6520 696e 6465  ssed to the inde
-00027d00: 7820 636f 6e73 7472 7563 746f 722e 0a0a  x constructor...
-00027d10: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00027d20: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00027d30: 2020 2020 2020 2020 6f62 6a20 3a20 4461          obj : Da
-00027d40: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
-00027d50: 2020 416e 6f74 6865 7220 6461 7461 7365    Another datase
-00027d60: 742c 2077 6974 6820 7468 6973 2064 6174  t, with this dat
-00027d70: 6173 6574 2773 2064 6174 6120 616e 6420  aset's data and 
-00027d80: 7769 7468 2061 206e 6577 2069 6e64 6578  with a new index
-00027d90: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
-00027da0: 2020 2020 2020 2023 2074 6865 2053 6571         # the Seq
-00027db0: 7565 6e63 6520 6368 6563 6b20 6973 2072  uence check is r
-00027dc0: 6571 7569 7265 6420 666f 7220 6d79 7079  equired for mypy
-00027dd0: 0a20 2020 2020 2020 2069 6620 6973 5f73  .        if is_s
-00027de0: 6361 6c61 7228 636f 6f72 645f 6e61 6d65  calar(coord_name
-00027df0: 7329 206f 7220 6e6f 7420 6973 696e 7374  s) or not isinst
-00027e00: 616e 6365 2863 6f6f 7264 5f6e 616d 6573  ance(coord_names
-00027e10: 2c20 5365 7175 656e 6365 293a 0a20 2020  , Sequence):.   
-00027e20: 2020 2020 2020 2020 2063 6f6f 7264 5f6e           coord_n
-00027e30: 616d 6573 203d 205b 636f 6f72 645f 6e61  ames = [coord_na
-00027e40: 6d65 735d 0a0a 2020 2020 2020 2020 6966  mes]..        if
-00027e50: 2069 6e64 6578 5f63 6c73 2069 7320 4e6f   index_cls is No
-00027e60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00027e70: 6966 206c 656e 2863 6f6f 7264 5f6e 616d  if len(coord_nam
-00027e80: 6573 2920 3d3d 2031 3a0a 2020 2020 2020  es) == 1:.      
-00027e90: 2020 2020 2020 2020 2020 696e 6465 785f            index_
-00027ea0: 636c 7320 3d20 5061 6e64 6173 496e 6465  cls = PandasInde
-00027eb0: 780a 2020 2020 2020 2020 2020 2020 656c  x.            el
-00027ec0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00027ed0: 2020 2020 696e 6465 785f 636c 7320 3d20      index_cls = 
-00027ee0: 5061 6e64 6173 4d75 6c74 6949 6e64 6578  PandasMultiIndex
-00027ef0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00027f00: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00027f10: 7420 6973 7375 6263 6c61 7373 2869 6e64  t issubclass(ind
-00027f20: 6578 5f63 6c73 2c20 496e 6465 7829 3a0a  ex_cls, Index):.
-00027f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f40: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-00027f50: 6622 7b69 6e64 6578 5f63 6c73 7d20 6973  f"{index_cls} is
-00027f60: 206e 6f74 2061 2073 7562 636c 6173 7320   not a subclass 
-00027f70: 6f66 2078 6172 7261 792e 496e 6465 7822  of xarray.Index"
-00027f80: 290a 0a20 2020 2020 2020 2069 6e76 616c  )..        inval
-00027f90: 6964 5f63 6f6f 7264 7320 3d20 7365 7428  id_coords = set(
-00027fa0: 636f 6f72 645f 6e61 6d65 7329 202d 2073  coord_names) - s
-00027fb0: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
-00027fc0: 0a0a 2020 2020 2020 2020 6966 2069 6e76  ..        if inv
-00027fd0: 616c 6964 5f63 6f6f 7264 733a 0a20 2020  alid_coords:.   
-00027fe0: 2020 2020 2020 2020 206d 7367 203d 205b           msg = [
-00027ff0: 2269 6e76 616c 6964 2063 6f6f 7264 696e  "invalid coordin
-00028000: 6174 6528 7329 225d 0a20 2020 2020 2020  ate(s)"].       
-00028010: 2020 2020 206e 6f5f 7661 7273 203d 2069       no_vars = i
-00028020: 6e76 616c 6964 5f63 6f6f 7264 7320 2d20  nvalid_coords - 
-00028030: 7365 7428 7365 6c66 2e5f 7661 7269 6162  set(self._variab
-00028040: 6c65 7329 0a20 2020 2020 2020 2020 2020  les).           
-00028050: 2064 6174 615f 7661 7273 203d 2069 6e76   data_vars = inv
-00028060: 616c 6964 5f63 6f6f 7264 7320 2d20 6e6f  alid_coords - no
-00028070: 5f76 6172 730a 2020 2020 2020 2020 2020  _vars.          
-00028080: 2020 6966 206e 6f5f 7661 7273 3a0a 2020    if no_vars:.  
-00028090: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-000280a0: 672e 6170 7065 6e64 2866 2274 686f 7365  g.append(f"those
-000280b0: 2076 6172 6961 626c 6573 2064 6f6e 2774   variables don't
-000280c0: 2065 7869 7374 3a20 7b6e 6f5f 7661 7273   exist: {no_vars
-000280d0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-000280e0: 6966 2064 6174 615f 7661 7273 3a0a 2020  if data_vars:.  
-000280f0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-00028100: 672e 6170 7065 6e64 280a 2020 2020 2020  g.append(.      
-00028110: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00028120: 7468 6f73 6520 7661 7269 6162 6c65 7320  those variables 
-00028130: 6172 6520 6461 7461 2076 6172 6961 626c  are data variabl
-00028140: 6573 3a20 7b64 6174 615f 7661 7273 7d2c  es: {data_vars},
-00028150: 2075 7365 2060 7365 745f 636f 6f72 6473   use `set_coords
-00028160: 6020 6669 7273 7422 0a20 2020 2020 2020  ` first".       
-00028170: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00028180: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00028190: 7565 4572 726f 7228 225c 6e22 2e6a 6f69  ueError("\n".joi
-000281a0: 6e28 6d73 6729 290a 0a20 2020 2020 2020  n(msg))..       
-000281b0: 2023 2077 6520 636f 756c 6420 6265 206d   # we could be m
-000281c0: 6f72 6520 636c 6576 6572 2068 6572 6520  ore clever here 
-000281d0: 2865 2e67 2e2c 2064 726f 702d 696e 2069  (e.g., drop-in i
-000281e0: 6e64 6578 2072 6570 6c61 6365 6d65 6e74  ndex replacement
-000281f0: 2069 6620 696e 6465 780a 2020 2020 2020   if index.      
-00028200: 2020 2320 636f 6f72 6469 6e61 7465 7320    # coordinates 
-00028210: 646f 206e 6f74 2063 6f6e 666c 6963 7429  do not conflict)
-00028220: 2c20 6275 7420 6c65 7427 7320 6e6f 7420  , but let's not 
-00028230: 616c 6c6f 7720 7468 6973 2066 6f72 206e  allow this for n
-00028240: 6f77 0a20 2020 2020 2020 2069 6e64 6578  ow.        index
-00028250: 6564 5f63 6f6f 7264 7320 3d20 7365 7428  ed_coords = set(
-00028260: 636f 6f72 645f 6e61 6d65 7329 2026 2073  coord_names) & s
-00028270: 6574 2873 656c 662e 5f69 6e64 6578 6573  et(self._indexes
-00028280: 290a 0a20 2020 2020 2020 2069 6620 696e  )..        if in
-00028290: 6465 7865 645f 636f 6f72 6473 3a0a 2020  dexed_coords:.  
-000282a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000282b0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-000282c0: 2020 2020 2020 2020 2020 2020 6622 7468              f"th
-000282d0: 6f73 6520 636f 6f72 6469 6e61 7465 7320  ose coordinates 
-000282e0: 616c 7265 6164 7920 6861 7665 2061 6e20  already have an 
-000282f0: 696e 6465 783a 207b 696e 6465 7865 645f  index: {indexed_
-00028300: 636f 6f72 6473 7d22 0a20 2020 2020 2020  coords}".       
-00028310: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00028320: 636f 6f72 645f 7661 7273 203d 207b 6e61  coord_vars = {na
-00028330: 6d65 3a20 7365 6c66 2e5f 7661 7269 6162  me: self._variab
-00028340: 6c65 735b 6e61 6d65 5d20 666f 7220 6e61  les[name] for na
-00028350: 6d65 2069 6e20 636f 6f72 645f 6e61 6d65  me in coord_name
-00028360: 737d 0a0a 2020 2020 2020 2020 696e 6465  s}..        inde
-00028370: 7820 3d20 696e 6465 785f 636c 732e 6672  x = index_cls.fr
-00028380: 6f6d 5f76 6172 6961 626c 6573 2863 6f6f  om_variables(coo
-00028390: 7264 5f76 6172 732c 206f 7074 696f 6e73  rd_vars, options
-000283a0: 3d6f 7074 696f 6e73 290a 0a20 2020 2020  =options)..     
-000283b0: 2020 206e 6577 5f63 6f6f 7264 5f76 6172     new_coord_var
-000283c0: 7320 3d20 696e 6465 782e 6372 6561 7465  s = index.create
-000283d0: 5f76 6172 6961 626c 6573 2863 6f6f 7264  _variables(coord
-000283e0: 5f76 6172 7329 0a0a 2020 2020 2020 2020  _vars)..        
-000283f0: 2320 7370 6563 6961 6c20 6361 7365 2066  # special case f
-00028400: 6f72 2073 6574 7469 6e67 2061 2070 616e  or setting a pan
-00028410: 6461 7320 6d75 6c74 692d 696e 6465 7820  das multi-index 
-00028420: 6672 6f6d 206c 6576 656c 2063 6f6f 7264  from level coord
-00028430: 696e 6174 6573 0a20 2020 2020 2020 2023  inates.        #
-00028440: 2054 4f44 4f3a 2072 656d 6f76 6520 6974   TODO: remove it
-00028450: 206f 6e63 6520 7765 2064 6570 7265 6369   once we depreci
-00028460: 6174 6520 7061 6e64 6173 206d 756c 7469  ate pandas multi
-00028470: 2d69 6e64 6578 2064 696d 656e 7369 6f6e  -index dimension
-00028480: 2028 7475 706c 650a 2020 2020 2020 2020   (tuple.        
-00028490: 2320 656c 656d 656e 7473 2920 636f 6f72  # elements) coor
-000284a0: 6469 6e61 7465 0a20 2020 2020 2020 2069  dinate.        i
-000284b0: 6620 6973 696e 7374 616e 6365 2869 6e64  f isinstance(ind
-000284c0: 6578 2c20 5061 6e64 6173 4d75 6c74 6949  ex, PandasMultiI
-000284d0: 6e64 6578 293a 0a20 2020 2020 2020 2020  ndex):.         
-000284e0: 2020 2063 6f6f 7264 5f6e 616d 6573 203d     coord_names =
-000284f0: 205b 696e 6465 782e 6469 6d5d 202b 206c   [index.dim] + l
-00028500: 6973 7428 636f 6f72 645f 6e61 6d65 7329  ist(coord_names)
-00028510: 0a0a 2020 2020 2020 2020 7661 7269 6162  ..        variab
-00028520: 6c65 733a 2064 6963 745b 4861 7368 6162  les: dict[Hashab
-00028530: 6c65 2c20 5661 7269 6162 6c65 5d0a 2020  le, Variable].  
-00028540: 2020 2020 2020 696e 6465 7865 733a 2064        indexes: d
-00028550: 6963 745b 4861 7368 6162 6c65 2c20 496e  ict[Hashable, In
-00028560: 6465 785d 0a0a 2020 2020 2020 2020 6966  dex]..        if
-00028570: 206c 656e 2863 6f6f 7264 5f6e 616d 6573   len(coord_names
-00028580: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
-00028590: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
-000285a0: 7365 6c66 2e5f 7661 7269 6162 6c65 732e  self._variables.
-000285b0: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-000285c0: 2020 2069 6e64 6578 6573 203d 2073 656c     indexes = sel
-000285d0: 662e 5f69 6e64 6578 6573 2e63 6f70 7928  f._indexes.copy(
-000285e0: 290a 0a20 2020 2020 2020 2020 2020 206e  )..            n
-000285f0: 616d 6520 3d20 6c69 7374 2863 6f6f 7264  ame = list(coord
-00028600: 5f6e 616d 6573 292e 706f 7028 290a 2020  _names).pop().  
-00028610: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-00028620: 6520 696e 206e 6577 5f63 6f6f 7264 5f76  e in new_coord_v
-00028630: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
-00028640: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
-00028650: 616d 655d 203d 206e 6577 5f63 6f6f 7264  ame] = new_coord
-00028660: 5f76 6172 735b 6e61 6d65 5d0a 2020 2020  _vars[name].    
-00028670: 2020 2020 2020 2020 696e 6465 7865 735b          indexes[
-00028680: 6e61 6d65 5d20 3d20 696e 6465 780a 2020  name] = index.  
-00028690: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000286a0: 2020 2020 2020 2020 2320 7265 6f72 6465          # reorde
-000286b0: 7220 7661 7269 6162 6c65 7320 616e 6420  r variables and 
-000286c0: 696e 6465 7865 7320 736f 2074 6861 7420  indexes so that 
-000286d0: 636f 6f72 6469 6e61 7465 7320 6861 7669  coordinates havi
-000286e0: 6e67 2074 6865 2073 616d 650a 2020 2020  ng the same.    
-000286f0: 2020 2020 2020 2020 2320 696e 6465 7820          # index 
-00028700: 6172 6520 6e65 7874 2074 6f20 6561 6368  are next to each
-00028710: 206f 7468 6572 0a20 2020 2020 2020 2020   other.         
-00028720: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
-00028730: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-00028740: 7220 6e61 6d65 2c20 7661 7220 696e 2073  r name, var in s
-00028750: 656c 662e 5f76 6172 6961 626c 6573 2e69  elf._variables.i
-00028760: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-00028770: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-00028780: 6e6f 7420 696e 2063 6f6f 7264 5f6e 616d  not in coord_nam
-00028790: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000287a0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-000287b0: 735b 6e61 6d65 5d20 3d20 7661 720a 0a20  s[name] = var.. 
-000287c0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-000287d0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
-000287e0: 2020 2020 666f 7220 6e61 6d65 2c20 6964      for name, id
-000287f0: 7820 696e 2073 656c 662e 5f69 6e64 6578  x in self._index
-00028800: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-00028810: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00028820: 616d 6520 6e6f 7420 696e 2063 6f6f 7264  ame not in coord
-00028830: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
-00028840: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00028850: 7865 735b 6e61 6d65 5d20 3d20 6964 780a  xes[name] = idx.
-00028860: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00028870: 206e 616d 6520 696e 2063 6f6f 7264 5f6e   name in coord_n
-00028880: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-00028890: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000288a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000288b0: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
-000288c0: 206e 6577 5f63 6f6f 7264 5f76 6172 735b   new_coord_vars[
-000288d0: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
-000288e0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-000288f0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00028900: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-00028910: 626c 6573 5b6e 616d 655d 203d 2073 656c  bles[name] = sel
-00028920: 662e 5f76 6172 6961 626c 6573 5b6e 616d  f._variables[nam
-00028930: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-00028940: 2020 2069 6e64 6578 6573 5b6e 616d 655d     indexes[name]
-00028950: 203d 2069 6e64 6578 0a0a 2020 2020 2020   = index..      
-00028960: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-00028970: 6570 6c61 6365 280a 2020 2020 2020 2020  eplace(.        
-00028980: 2020 2020 7661 7269 6162 6c65 733d 7661      variables=va
-00028990: 7269 6162 6c65 732c 0a20 2020 2020 2020  riables,.       
-000289a0: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
-000289b0: 3d73 656c 662e 5f63 6f6f 7264 5f6e 616d  =self._coord_nam
-000289c0: 6573 207c 2073 6574 2863 6f6f 7264 5f6e  es | set(coord_n
-000289d0: 616d 6573 292c 0a20 2020 2020 2020 2020  ames),.         
-000289e0: 2020 2069 6e64 6578 6573 3d69 6e64 6578     indexes=index
-000289f0: 6573 2c0a 2020 2020 2020 2020 290a 0a20  es,.        ).. 
-00028a00: 2020 2064 6566 2072 656f 7264 6572 5f6c     def reorder_l
-00028a10: 6576 656c 7328 0a20 2020 2020 2020 2073  evels(.        s
-00028a20: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-00028a30: 2020 2020 2020 2020 6469 6d5f 6f72 6465          dim_orde
-00028a40: 723a 204d 6170 7069 6e67 5b41 6e79 2c20  r: Mapping[Any, 
-00028a50: 5365 7175 656e 6365 5b69 6e74 207c 2048  Sequence[int | H
-00028a60: 6173 6861 626c 655d 5d20 7c20 4e6f 6e65  ashable]] | None
-00028a70: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00028a80: 202a 2a64 696d 5f6f 7264 6572 5f6b 7761   **dim_order_kwa
-00028a90: 7267 733a 2053 6571 7565 6e63 655b 696e  rgs: Sequence[in
-00028aa0: 7420 7c20 4861 7368 6162 6c65 5d2c 0a20  t | Hashable],. 
-00028ab0: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
-00028ac0: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
-00028ad0: 6172 7261 6e67 6520 696e 6465 7820 6c65  arrange index le
-00028ae0: 7665 6c73 2075 7369 6e67 2069 6e70 7574  vels using input
-00028af0: 206f 7264 6572 2e0a 0a20 2020 2020 2020   order...       
-00028b00: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00028b10: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00028b20: 2020 2020 2020 2064 696d 5f6f 7264 6572         dim_order
-00028b30: 203a 2064 6963 742d 6c69 6b65 206f 6620   : dict-like of 
-00028b40: 4861 7368 6162 6c65 2074 6f20 5365 7175  Hashable to Sequ
-00028b50: 656e 6365 206f 6620 696e 7420 6f72 2048  ence of int or H
-00028b60: 6173 6861 626c 652c 206f 7074 696f 6e61  ashable, optiona
-00028b70: 6c0a 2020 2020 2020 2020 2020 2020 4d61  l.            Ma
-00028b80: 7070 696e 6720 6672 6f6d 206e 616d 6573  pping from names
-00028b90: 206d 6174 6368 696e 6720 6469 6d65 6e73   matching dimens
-00028ba0: 696f 6e73 2061 6e64 2076 616c 7565 7320  ions and values 
-00028bb0: 6769 7665 6e0a 2020 2020 2020 2020 2020  given.          
-00028bc0: 2020 6279 206c 6973 7473 2072 6570 7265    by lists repre
-00028bd0: 7365 6e74 696e 6720 6e65 7720 6c65 7665  senting new leve
-00028be0: 6c20 6f72 6465 7273 2e20 4576 6572 7920  l orders. Every 
-00028bf0: 6769 7665 6e20 6469 6d65 6e73 696f 6e0a  given dimension.
-00028c00: 2020 2020 2020 2020 2020 2020 6d75 7374              must
-00028c10: 2068 6176 6520 6120 6d75 6c74 692d 696e   have a multi-in
-00028c20: 6465 782e 0a20 2020 2020 2020 202a 2a64  dex..        **d
-00028c30: 696d 5f6f 7264 6572 5f6b 7761 7267 7320  im_order_kwargs 
-00028c40: 3a20 5365 7175 656e 6365 206f 6620 696e  : Sequence of in
-00028c50: 7420 6f72 2048 6173 6861 626c 652c 206f  t or Hashable, o
-00028c60: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00028c70: 2020 2020 5468 6520 6b65 7977 6f72 6420      The keyword 
-00028c80: 6172 6775 6d65 6e74 7320 666f 726d 206f  arguments form o
-00028c90: 6620 6060 6469 6d5f 6f72 6465 7260 602e  f ``dim_order``.
-00028ca0: 0a20 2020 2020 2020 2020 2020 204f 6e65  .            One
-00028cb0: 206f 6620 6469 6d5f 6f72 6465 7220 6f72   of dim_order or
-00028cc0: 2064 696d 5f6f 7264 6572 5f6b 7761 7267   dim_order_kwarg
-00028cd0: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
-00028ce0: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
-00028cf0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00028d00: 2d2d 2d2d 0a20 2020 2020 2020 206f 626a  ----.        obj
-00028d10: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
-00028d20: 2020 2020 2020 2041 6e6f 7468 6572 2064         Another d
-00028d30: 6174 6173 6574 2c20 7769 7468 2074 6869  ataset, with thi
-00028d40: 7320 6461 7461 7365 7427 7320 6461 7461  s dataset's data
-00028d50: 2062 7574 2072 6570 6c61 6365 640a 2020   but replaced.  
-00028d60: 2020 2020 2020 2020 2020 636f 6f72 6469            coordi
-00028d70: 6e61 7465 732e 0a20 2020 2020 2020 2022  nates..        "
-00028d80: 2222 0a20 2020 2020 2020 2064 696d 5f6f  "".        dim_o
-00028d90: 7264 6572 203d 2065 6974 6865 725f 6469  rder = either_di
-00028da0: 6374 5f6f 725f 6b77 6172 6773 2864 696d  ct_or_kwargs(dim
-00028db0: 5f6f 7264 6572 2c20 6469 6d5f 6f72 6465  _order, dim_orde
-00028dc0: 725f 6b77 6172 6773 2c20 2272 656f 7264  r_kwargs, "reord
-00028dd0: 6572 5f6c 6576 656c 7322 290a 2020 2020  er_levels").    
-00028de0: 2020 2020 7661 7269 6162 6c65 7320 3d20      variables = 
-00028df0: 7365 6c66 2e5f 7661 7269 6162 6c65 732e  self._variables.
-00028e00: 636f 7079 2829 0a20 2020 2020 2020 2069  copy().        i
-00028e10: 6e64 6578 6573 203d 2064 6963 7428 7365  ndexes = dict(se
-00028e20: 6c66 2e5f 696e 6465 7865 7329 0a20 2020  lf._indexes).   
-00028e30: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
-00028e40: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
-00028e50: 2049 6e64 6578 5d20 3d20 7b7d 0a20 2020   Index] = {}.   
-00028e60: 2020 2020 206e 6577 5f76 6172 6961 626c       new_variabl
-00028e70: 6573 3a20 6469 6374 5b48 6173 6861 626c  es: dict[Hashabl
-00028e80: 652c 2049 6e64 6578 5661 7269 6162 6c65  e, IndexVariable
-00028e90: 5d20 3d20 7b7d 0a0a 2020 2020 2020 2020  ] = {}..        
-00028ea0: 666f 7220 6469 6d2c 206f 7264 6572 2069  for dim, order i
-00028eb0: 6e20 6469 6d5f 6f72 6465 722e 6974 656d  n dim_order.item
-00028ec0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00028ed0: 2069 6e64 6578 203d 2073 656c 662e 5f69   index = self._i
-00028ee0: 6e64 6578 6573 5b64 696d 5d0a 0a20 2020  ndexes[dim]..   
-00028ef0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00028f00: 6973 696e 7374 616e 6365 2869 6e64 6578  isinstance(index
-00028f10: 2c20 5061 6e64 6173 4d75 6c74 6949 6e64  , PandasMultiInd
-00028f20: 6578 293a 0a20 2020 2020 2020 2020 2020  ex):.           
-00028f30: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00028f40: 4572 726f 7228 6622 636f 6f72 6469 6e61  Error(f"coordina
-00028f50: 7465 207b 6469 6d7d 2068 6173 206e 6f20  te {dim} has no 
-00028f60: 4d75 6c74 6949 6e64 6578 2229 0a0a 2020  MultiIndex")..  
-00028f70: 2020 2020 2020 2020 2020 6c65 7665 6c5f            level_
-00028f80: 7661 7273 203d 207b 6b3a 2073 656c 662e  vars = {k: self.
-00028f90: 5f76 6172 6961 626c 6573 5b6b 5d20 666f  _variables[k] fo
-00028fa0: 7220 6b20 696e 206f 7264 6572 7d0a 2020  r k in order}.  
-00028fb0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-00028fc0: 696e 6465 782e 7265 6f72 6465 725f 6c65  index.reorder_le
-00028fd0: 7665 6c73 286c 6576 656c 5f76 6172 7329  vels(level_vars)
-00028fe0: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-00028ff0: 5f76 6172 7320 3d20 6964 782e 6372 6561  _vars = idx.crea
-00029000: 7465 5f76 6172 6961 626c 6573 286c 6576  te_variables(lev
-00029010: 656c 5f76 6172 7329 0a20 2020 2020 2020  el_vars).       
-00029020: 2020 2020 206e 6577 5f69 6e64 6578 6573       new_indexes
-00029030: 2e75 7064 6174 6528 7b6b 3a20 6964 7820  .update({k: idx 
-00029040: 666f 7220 6b20 696e 2069 6478 5f76 6172  for k in idx_var
-00029050: 737d 290a 2020 2020 2020 2020 2020 2020  s}).            
-00029060: 6e65 775f 7661 7269 6162 6c65 732e 7570  new_variables.up
-00029070: 6461 7465 2869 6478 5f76 6172 7329 0a0a  date(idx_vars)..
-00029080: 2020 2020 2020 2020 696e 6465 7865 7320          indexes 
-00029090: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-000290a0: 2069 6e20 7365 6c66 2e5f 696e 6465 7865   in self._indexe
-000290b0: 732e 6974 656d 7328 2920 6966 206b 206e  s.items() if k n
-000290c0: 6f74 2069 6e20 6e65 775f 696e 6465 7865  ot in new_indexe
-000290d0: 737d 0a20 2020 2020 2020 2069 6e64 6578  s}.        index
-000290e0: 6573 2e75 7064 6174 6528 6e65 775f 696e  es.update(new_in
-000290f0: 6465 7865 7329 0a0a 2020 2020 2020 2020  dexes)..        
-00029100: 7661 7269 6162 6c65 7320 3d20 7b6b 3a20  variables = {k: 
-00029110: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
-00029120: 6c66 2e5f 7661 7269 6162 6c65 732e 6974  lf._variables.it
-00029130: 656d 7328 2920 6966 206b 206e 6f74 2069  ems() if k not i
-00029140: 6e20 6e65 775f 7661 7269 6162 6c65 737d  n new_variables}
-00029150: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-00029160: 6573 2e75 7064 6174 6528 6e65 775f 7661  es.update(new_va
-00029170: 7269 6162 6c65 7329 0a0a 2020 2020 2020  riables)..      
-00029180: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-00029190: 6570 6c61 6365 2876 6172 6961 626c 6573  eplace(variables
-000291a0: 2c20 696e 6465 7865 733d 696e 6465 7865  , indexes=indexe
-000291b0: 7329 0a0a 2020 2020 6465 6620 5f67 6574  s)..    def _get
-000291c0: 5f73 7461 636b 5f69 6e64 6578 280a 2020  _stack_index(.  
-000291d0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-000291e0: 2020 2020 6469 6d2c 0a20 2020 2020 2020      dim,.       
-000291f0: 206d 756c 7469 3d46 616c 7365 2c0a 2020   multi=False,.  
-00029200: 2020 2020 2020 6372 6561 7465 5f69 6e64        create_ind
-00029210: 6578 3d46 616c 7365 2c0a 2020 2020 2920  ex=False,.    ) 
-00029220: 2d3e 2074 7570 6c65 5b49 6e64 6578 207c  -> tuple[Index |
-00029230: 204e 6f6e 652c 2064 6963 745b 4861 7368   None, dict[Hash
-00029240: 6162 6c65 2c20 5661 7269 6162 6c65 5d5d  able, Variable]]
-00029250: 3a0a 2020 2020 2020 2020 2222 2255 7365  :.        """Use
-00029260: 6420 6279 2073 7461 636b 2061 6e64 2075  d by stack and u
-00029270: 6e73 7461 636b 2074 6f20 6765 7420 6f6e  nstack to get on
-00029280: 6520 7061 6e64 6173 2028 6d75 6c74 692d  e pandas (multi-
-00029290: 2969 6e64 6578 2061 6d6f 6e67 0a20 2020  )index among.   
-000292a0: 2020 2020 2074 6865 2069 6e64 6578 6564       the indexed
-000292b0: 2063 6f6f 7264 696e 6174 6573 2061 6c6f   coordinates alo
-000292c0: 6e67 2064 696d 656e 7369 6f6e 2060 6469  ng dimension `di
-000292d0: 6d60 2e0a 0a20 2020 2020 2020 2049 6620  m`...        If 
-000292e0: 6578 6163 746c 7920 6f6e 6520 696e 6465  exactly one inde
-000292f0: 7820 6973 2066 6f75 6e64 2c20 7265 7475  x is found, retu
-00029300: 726e 2069 7420 7769 7468 2069 7473 2063  rn it with its c
-00029310: 6f72 7265 7370 6f6e 6469 6e67 0a20 2020  orresponding.   
-00029320: 2020 2020 2063 6f6f 7264 696e 6174 6520       coordinate 
-00029330: 7661 7269 6162 6c65 7328 7329 2c20 6f74  variables(s), ot
-00029340: 6865 7277 6973 6520 7265 7475 726e 204e  herwise return N
-00029350: 6f6e 6520 616e 6420 616e 2065 6d70 7479  one and an empty
-00029360: 2064 6963 742e 0a0a 2020 2020 2020 2020   dict...        
-00029370: 4966 2060 6372 6561 7465 5f69 6e64 6578  If `create_index
-00029380: 3d54 7275 6560 2c20 6372 6561 7465 2061  =True`, create a
-00029390: 206e 6577 2069 6e64 6578 2069 6620 6e6f   new index if no
-000293a0: 6e65 2069 7320 666f 756e 6420 6f72 2072  ne is found or r
-000293b0: 6169 7365 0a20 2020 2020 2020 2061 6e20  aise.        an 
-000293c0: 6572 726f 7220 6966 206d 756c 7469 706c  error if multipl
-000293d0: 6520 696e 6465 7865 7320 6172 6520 666f  e indexes are fo
-000293e0: 756e 642e 0a0a 2020 2020 2020 2020 2222  und...        ""
-000293f0: 220a 2020 2020 2020 2020 7374 6163 6b5f  ".        stack_
-00029400: 696e 6465 783a 2049 6e64 6578 207c 204e  index: Index | N
-00029410: 6f6e 6520 3d20 4e6f 6e65 0a20 2020 2020  one = None.     
-00029420: 2020 2073 7461 636b 5f63 6f6f 7264 733a     stack_coords:
-00029430: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-00029440: 5661 7269 6162 6c65 5d20 3d20 7b7d 0a0a  Variable] = {}..
-00029450: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-00029460: 2c20 696e 6465 7820 696e 2073 656c 662e  , index in self.
-00029470: 5f69 6e64 6578 6573 2e69 7465 6d73 2829  _indexes.items()
-00029480: 3a0a 2020 2020 2020 2020 2020 2020 7661  :.            va
-00029490: 7220 3d20 7365 6c66 2e5f 7661 7269 6162  r = self._variab
-000294a0: 6c65 735b 6e61 6d65 5d0a 2020 2020 2020  les[name].      
-000294b0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-000294c0: 2020 2020 2020 2020 2020 2076 6172 2e6e             var.n
-000294d0: 6469 6d20 3d3d 2031 0a20 2020 2020 2020  dim == 1.       
-000294e0: 2020 2020 2020 2020 2061 6e64 2076 6172           and var
-000294f0: 2e64 696d 735b 305d 203d 3d20 6469 6d0a  .dims[0] == dim.
-00029500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029510: 616e 6420 280a 2020 2020 2020 2020 2020  and (.          
-00029520: 2020 2020 2020 2020 2020 2320 7374 6163            # stac
-00029530: 6b3a 206d 7573 7420 6265 2061 2073 696e  k: must be a sin
-00029540: 676c 6520 636f 6f72 6469 6e61 7465 2069  gle coordinate i
-00029550: 6e64 6578 0a20 2020 2020 2020 2020 2020  ndex.           
-00029560: 2020 2020 2020 2020 206e 6f74 206d 756c           not mul
-00029570: 7469 0a20 2020 2020 2020 2020 2020 2020  ti.             
-00029580: 2020 2020 2020 2061 6e64 206e 6f74 2073         and not s
-00029590: 656c 662e 7869 6e64 6578 6573 2e69 735f  elf.xindexes.is_
-000295a0: 6d75 6c74 6928 6e61 6d65 290a 2020 2020  multi(name).    
-000295b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000295c0: 2320 756e 7374 6163 6b3a 206d 7573 7420  # unstack: must 
-000295d0: 6265 2061 6e20 696e 6465 7820 7468 6174  be an index that
-000295e0: 2069 6d70 6c65 6d65 6e74 7320 2e75 6e73   implements .uns
-000295f0: 7461 636b 0a20 2020 2020 2020 2020 2020  tack.           
-00029600: 2020 2020 2020 2020 206f 7220 6d75 6c74           or mult
-00029610: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
-00029620: 2020 2020 2020 616e 6420 7479 7065 2869        and type(i
-00029630: 6e64 6578 292e 756e 7374 6163 6b20 6973  ndex).unstack is
-00029640: 206e 6f74 2049 6e64 6578 2e75 6e73 7461   not Index.unsta
-00029650: 636b 0a20 2020 2020 2020 2020 2020 2020  ck.             
-00029660: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00029670: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00029680: 2020 2020 6966 2073 7461 636b 5f69 6e64      if stack_ind
-00029690: 6578 2069 7320 6e6f 7420 4e6f 6e65 2061  ex is not None a
-000296a0: 6e64 2069 6e64 6578 2069 7320 6e6f 7420  nd index is not 
-000296b0: 7374 6163 6b5f 696e 6465 783a 0a20 2020  stack_index:.   
-000296c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000296d0: 2023 206d 6f72 6520 7468 616e 206f 6e65   # more than one
-000296e0: 2069 6e64 6578 2066 6f75 6e64 2c20 7374   index found, st
-000296f0: 6f70 0a20 2020 2020 2020 2020 2020 2020  op.             
-00029700: 2020 2020 2020 2069 6620 6372 6561 7465         if create
-00029710: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
-00029720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029730: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00029740: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00029750: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00029760: 6361 6e6e 6f74 2073 7461 636b 2064 696d  cannot stack dim
-00029770: 656e 7369 6f6e 207b 6469 6d21 727d 2077  ension {dim!r} w
-00029780: 6974 6820 6063 7265 6174 655f 696e 6465  ith `create_inde
-00029790: 783d 5472 7565 6020 220a 2020 2020 2020  x=True` ".      
-000297a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000297b0: 2020 2020 2020 2261 6e64 2077 6974 6820        "and with 
-000297c0: 6d6f 7265 2074 6861 6e20 6f6e 6520 696e  more than one in
-000297d0: 6465 7820 666f 756e 6420 616c 6f6e 6720  dex found along 
-000297e0: 7468 6174 2064 696d 656e 7369 6f6e 220a  that dimension".
-000297f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029800: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00029810: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00029820: 7475 726e 204e 6f6e 652c 207b 7d0a 2020  turn None, {}.  
-00029830: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00029840: 6163 6b5f 696e 6465 7820 3d20 696e 6465  ack_index = inde
-00029850: 780a 2020 2020 2020 2020 2020 2020 2020  x.              
-00029860: 2020 7374 6163 6b5f 636f 6f72 6473 5b6e    stack_coords[n
-00029870: 616d 655d 203d 2076 6172 0a0a 2020 2020  ame] = var..    
-00029880: 2020 2020 6966 2063 7265 6174 655f 696e      if create_in
-00029890: 6465 7820 616e 6420 7374 6163 6b5f 696e  dex and stack_in
-000298a0: 6465 7820 6973 204e 6f6e 653a 0a20 2020  dex is None:.   
-000298b0: 2020 2020 2020 2020 2069 6620 6469 6d20           if dim 
-000298c0: 696e 2073 656c 662e 5f76 6172 6961 626c  in self._variabl
-000298d0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000298e0: 2020 2020 7661 7220 3d20 7365 6c66 2e5f      var = self._
-000298f0: 7661 7269 6162 6c65 735b 6469 6d5d 0a20  variables[dim]. 
-00029900: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00029910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029920: 205f 2c20 5f2c 2076 6172 203d 205f 6765   _, _, var = _ge
-00029930: 745f 7669 7274 7561 6c5f 7661 7269 6162  t_virtual_variab
-00029940: 6c65 2873 656c 662e 5f76 6172 6961 626c  le(self._variabl
-00029950: 6573 2c20 6469 6d2c 2073 656c 662e 6469  es, dim, self.di
-00029960: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-00029970: 2320 6475 6d6d 7920 696e 6465 7820 286f  # dummy index (o
-00029980: 6e6c 7920 6073 7461 636b 5f63 6f6f 7264  nly `stack_coord
-00029990: 7360 2077 696c 6c20 6265 2075 7365 6420  s` will be used 
-000299a0: 746f 2063 6f6e 7374 7275 6374 2074 6865  to construct the
-000299b0: 206d 756c 7469 2d69 6e64 6578 290a 2020   multi-index).  
-000299c0: 2020 2020 2020 2020 2020 7374 6163 6b5f            stack_
-000299d0: 696e 6465 7820 3d20 5061 6e64 6173 496e  index = PandasIn
-000299e0: 6465 7828 5b30 5d2c 2064 696d 290a 2020  dex([0], dim).  
-000299f0: 2020 2020 2020 2020 2020 7374 6163 6b5f            stack_
-00029a00: 636f 6f72 6473 203d 207b 6469 6d3a 2076  coords = {dim: v
-00029a10: 6172 7d0a 0a20 2020 2020 2020 2072 6574  ar}..        ret
-00029a20: 7572 6e20 7374 6163 6b5f 696e 6465 782c  urn stack_index,
-00029a30: 2073 7461 636b 5f63 6f6f 7264 730a 0a20   stack_coords.. 
-00029a40: 2020 2064 6566 205f 7374 6163 6b5f 6f6e     def _stack_on
-00029a50: 6365 280a 2020 2020 2020 2020 7365 6c66  ce(.        self
-00029a60: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-00029a70: 2020 2020 2064 696d 733a 2053 6571 7565       dims: Seque
-00029a80: 6e63 655b 4861 7368 6162 6c65 207c 2065  nce[Hashable | e
-00029a90: 6c6c 6970 7369 735d 2c0a 2020 2020 2020  llipsis],.      
-00029aa0: 2020 6e65 775f 6469 6d3a 2048 6173 6861    new_dim: Hasha
-00029ab0: 626c 652c 0a20 2020 2020 2020 2069 6e64  ble,.        ind
-00029ac0: 6578 5f63 6c73 3a20 7479 7065 5b49 6e64  ex_cls: type[Ind
-00029ad0: 6578 5d2c 0a20 2020 2020 2020 2063 7265  ex],.        cre
-00029ae0: 6174 655f 696e 6465 783a 2062 6f6f 6c20  ate_index: bool 
-00029af0: 7c20 4e6f 6e65 203d 2054 7275 652c 0a20  | None = True,. 
-00029b00: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
-00029b10: 743a 0a20 2020 2020 2020 2069 6620 6469  t:.        if di
-00029b20: 6d73 203d 3d20 2e2e 2e3a 0a20 2020 2020  ms == ...:.     
-00029b30: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00029b40: 7565 4572 726f 7228 2250 6c65 6173 6520  ueError("Please 
-00029b50: 7573 6520 5b2e 2e2e 5d20 666f 7220 6469  use [...] for di
-00029b60: 6d73 2c20 7261 7468 6572 2074 6861 6e20  ms, rather than 
-00029b70: 6a75 7374 202e 2e2e 2229 0a20 2020 2020  just ...").     
-00029b80: 2020 2069 6620 2e2e 2e20 696e 2064 696d     if ... in dim
-00029b90: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
-00029ba0: 696d 7320 3d20 6c69 7374 2869 6e66 6978  ims = list(infix
-00029bb0: 5f64 696d 7328 6469 6d73 2c20 7365 6c66  _dims(dims, self
-00029bc0: 2e64 696d 7329 290a 0a20 2020 2020 2020  .dims))..       
-00029bd0: 206e 6577 5f76 6172 6961 626c 6573 3a20   new_variables: 
-00029be0: 6469 6374 5b48 6173 6861 626c 652c 2056  dict[Hashable, V
-00029bf0: 6172 6961 626c 655d 203d 207b 7d0a 2020  ariable] = {}.  
-00029c00: 2020 2020 2020 7374 6163 6b65 645f 7661        stacked_va
-00029c10: 725f 6e61 6d65 733a 206c 6973 745b 4861  r_names: list[Ha
-00029c20: 7368 6162 6c65 5d20 3d20 5b5d 0a20 2020  shable] = [].   
-00029c30: 2020 2020 2064 726f 705f 696e 6465 7865       drop_indexe
-00029c40: 733a 206c 6973 745b 4861 7368 6162 6c65  s: list[Hashable
-00029c50: 5d20 3d20 5b5d 0a0a 2020 2020 2020 2020  ] = []..        
-00029c60: 666f 7220 6e61 6d65 2c20 7661 7220 696e  for name, var in
-00029c70: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
-00029c80: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00029c90: 2020 2020 2069 6620 616e 7928 6420 696e       if any(d in
-00029ca0: 2076 6172 2e64 696d 7320 666f 7220 6420   var.dims for d 
-00029cb0: 696e 2064 696d 7329 3a0a 2020 2020 2020  in dims):.      
-00029cc0: 2020 2020 2020 2020 2020 6164 645f 6469            add_di
-00029cd0: 6d73 203d 205b 6420 666f 7220 6420 696e  ms = [d for d in
-00029ce0: 2064 696d 7320 6966 2064 206e 6f74 2069   dims if d not i
-00029cf0: 6e20 7661 722e 6469 6d73 5d0a 2020 2020  n var.dims].    
-00029d00: 2020 2020 2020 2020 2020 2020 7664 696d              vdim
-00029d10: 7320 3d20 6c69 7374 2876 6172 2e64 696d  s = list(var.dim
-00029d20: 7329 202b 2061 6464 5f64 696d 730a 2020  s) + add_dims.  
-00029d30: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00029d40: 6170 6520 3d20 5b73 656c 662e 6469 6d73  ape = [self.dims
-00029d50: 5b64 5d20 666f 7220 6420 696e 2076 6469  [d] for d in vdi
-00029d60: 6d73 5d0a 2020 2020 2020 2020 2020 2020  ms].            
-00029d70: 2020 2020 6578 705f 7661 7220 3d20 7661      exp_var = va
-00029d80: 722e 7365 745f 6469 6d73 2876 6469 6d73  r.set_dims(vdims
-00029d90: 2c20 7368 6170 6529 0a20 2020 2020 2020  , shape).       
-00029da0: 2020 2020 2020 2020 2073 7461 636b 6564           stacked
-00029db0: 5f76 6172 203d 2065 7870 5f76 6172 2e73  _var = exp_var.s
-00029dc0: 7461 636b 282a 2a7b 6e65 775f 6469 6d3a  tack(**{new_dim:
-00029dd0: 2064 696d 737d 290a 2020 2020 2020 2020   dims}).        
-00029de0: 2020 2020 2020 2020 6e65 775f 7661 7269          new_vari
-00029df0: 6162 6c65 735b 6e61 6d65 5d20 3d20 7374  ables[name] = st
-00029e00: 6163 6b65 645f 7661 720a 2020 2020 2020  acked_var.      
-00029e10: 2020 2020 2020 2020 2020 7374 6163 6b65            stacke
-00029e20: 645f 7661 725f 6e61 6d65 732e 6170 7065  d_var_names.appe
-00029e30: 6e64 286e 616d 6529 0a20 2020 2020 2020  nd(name).       
-00029e40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00029e50: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
-00029e60: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
-00029e70: 2076 6172 2e63 6f70 7928 6465 6570 3d46   var.copy(deep=F
-00029e80: 616c 7365 290a 0a20 2020 2020 2020 2023  alse)..        #
-00029e90: 2064 726f 7020 696e 6465 7865 7320 6f66   drop indexes of
-00029ea0: 2073 7461 636b 6564 2063 6f6f 7264 696e   stacked coordin
-00029eb0: 6174 6573 2028 6966 2061 6e79 290a 2020  ates (if any).  
-00029ec0: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
-00029ed0: 6e20 7374 6163 6b65 645f 7661 725f 6e61  n stacked_var_na
-00029ee0: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
-00029ef0: 2064 726f 705f 696e 6465 7865 7320 2b3d   drop_indexes +=
-00029f00: 206c 6973 7428 7365 6c66 2e78 696e 6465   list(self.xinde
-00029f10: 7865 732e 6765 745f 616c 6c5f 636f 6f72  xes.get_all_coor
-00029f20: 6473 286e 616d 652c 2065 7272 6f72 733d  ds(name, errors=
-00029f30: 2269 676e 6f72 6522 2929 0a0a 2020 2020  "ignore"))..    
-00029f40: 2020 2020 6e65 775f 696e 6465 7865 7320      new_indexes 
-00029f50: 3d20 7b7d 0a20 2020 2020 2020 206e 6577  = {}.        new
-00029f60: 5f63 6f6f 7264 5f6e 616d 6573 203d 2073  _coord_names = s
-00029f70: 6574 2873 656c 662e 5f63 6f6f 7264 5f6e  et(self._coord_n
-00029f80: 616d 6573 290a 2020 2020 2020 2020 6966  ames).        if
-00029f90: 2063 7265 6174 655f 696e 6465 7820 6f72   create_index or
-00029fa0: 2063 7265 6174 655f 696e 6465 7820 6973   create_index is
-00029fb0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00029fc0: 2020 2070 726f 6475 6374 5f76 6172 733a     product_vars:
-00029fd0: 2064 6963 745b 416e 792c 2056 6172 6961   dict[Any, Varia
-00029fe0: 626c 655d 203d 207b 7d0a 2020 2020 2020  ble] = {}.      
-00029ff0: 2020 2020 2020 666f 7220 6469 6d20 696e        for dim in
-0002a000: 2064 696d 733a 0a20 2020 2020 2020 2020   dims:.         
-0002a010: 2020 2020 2020 2069 6478 2c20 6964 785f         idx, idx_
-0002a020: 7661 7273 203d 2073 656c 662e 5f67 6574  vars = self._get
-0002a030: 5f73 7461 636b 5f69 6e64 6578 2864 696d  _stack_index(dim
-0002a040: 2c20 6372 6561 7465 5f69 6e64 6578 3d63  , create_index=c
-0002a050: 7265 6174 655f 696e 6465 7829 0a20 2020  reate_index).   
-0002a060: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002a070: 6964 7820 6973 206e 6f74 204e 6f6e 653a  idx is not None:
-0002a080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a090: 2020 2020 2070 726f 6475 6374 5f76 6172       product_var
-0002a0a0: 732e 7570 6461 7465 2869 6478 5f76 6172  s.update(idx_var
-0002a0b0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-0002a0c0: 6966 206c 656e 2870 726f 6475 6374 5f76  if len(product_v
-0002a0d0: 6172 7329 203d 3d20 6c65 6e28 6469 6d73  ars) == len(dims
-0002a0e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0002a0f0: 2020 2069 6478 203d 2069 6e64 6578 5f63     idx = index_c
-0002a100: 6c73 2e73 7461 636b 2870 726f 6475 6374  ls.stack(product
-0002a110: 5f76 6172 732c 206e 6577 5f64 696d 290a  _vars, new_dim).
-0002a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a130: 6e65 775f 696e 6465 7865 735b 6e65 775f  new_indexes[new_
-0002a140: 6469 6d5d 203d 2069 6478 0a20 2020 2020  dim] = idx.     
-0002a150: 2020 2020 2020 2020 2020 206e 6577 5f69             new_i
-0002a160: 6e64 6578 6573 2e75 7064 6174 6528 7b6b  ndexes.update({k
-0002a170: 3a20 6964 7820 666f 7220 6b20 696e 2070  : idx for k in p
-0002a180: 726f 6475 6374 5f76 6172 737d 290a 2020  roduct_vars}).  
-0002a190: 2020 2020 2020 2020 2020 2020 2020 6964                id
-0002a1a0: 785f 7661 7273 203d 2069 6478 2e63 7265  x_vars = idx.cre
-0002a1b0: 6174 655f 7661 7269 6162 6c65 7328 7072  ate_variables(pr
-0002a1c0: 6f64 7563 745f 7661 7273 290a 2020 2020  oduct_vars).    
-0002a1d0: 2020 2020 2020 2020 2020 2020 2320 6b65              # ke
-0002a1e0: 6570 2063 6f6e 7369 7374 656e 7420 6d75  ep consistent mu
-0002a1f0: 6c74 692d 696e 6465 7820 636f 6f72 6469  lti-index coordi
-0002a200: 6e61 7465 206f 7264 6572 0a20 2020 2020  nate order.     
-0002a210: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-0002a220: 2069 6e20 6964 785f 7661 7273 3a0a 2020   in idx_vars:.  
-0002a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a240: 2020 6e65 775f 7661 7269 6162 6c65 732e    new_variables.
-0002a250: 706f 7028 6b2c 204e 6f6e 6529 0a20 2020  pop(k, None).   
-0002a260: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0002a270: 5f76 6172 6961 626c 6573 2e75 7064 6174  _variables.updat
-0002a280: 6528 6964 785f 7661 7273 290a 2020 2020  e(idx_vars).    
-0002a290: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0002a2a0: 636f 6f72 645f 6e61 6d65 732e 7570 6461  coord_names.upda
-0002a2b0: 7465 2869 6478 5f76 6172 7329 0a0a 2020  te(idx_vars)..  
-0002a2c0: 2020 2020 2020 696e 6465 7865 7320 3d20        indexes = 
-0002a2d0: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
-0002a2e0: 6e20 7365 6c66 2e5f 696e 6465 7865 732e  n self._indexes.
-0002a2f0: 6974 656d 7328 2920 6966 206b 206e 6f74  items() if k not
-0002a300: 2069 6e20 6472 6f70 5f69 6e64 6578 6573   in drop_indexes
-0002a310: 7d0a 2020 2020 2020 2020 696e 6465 7865  }.        indexe
-0002a320: 732e 7570 6461 7465 286e 6577 5f69 6e64  s.update(new_ind
-0002a330: 6578 6573 290a 0a20 2020 2020 2020 2072  exes)..        r
-0002a340: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
-0002a350: 6163 655f 7769 7468 5f6e 6577 5f64 696d  ace_with_new_dim
-0002a360: 7328 0a20 2020 2020 2020 2020 2020 206e  s(.            n
-0002a370: 6577 5f76 6172 6961 626c 6573 2c20 636f  ew_variables, co
-0002a380: 6f72 645f 6e61 6d65 733d 6e65 775f 636f  ord_names=new_co
-0002a390: 6f72 645f 6e61 6d65 732c 2069 6e64 6578  ord_names, index
-0002a3a0: 6573 3d69 6e64 6578 6573 0a20 2020 2020  es=indexes.     
-0002a3b0: 2020 2029 0a0a 2020 2020 6465 6620 7374     )..    def st
-0002a3c0: 6163 6b28 0a20 2020 2020 2020 2073 656c  ack(.        sel
-0002a3d0: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
-0002a3e0: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
-0002a3f0: 3a20 4d61 7070 696e 675b 416e 792c 2053  : Mapping[Any, S
-0002a400: 6571 7565 6e63 655b 4861 7368 6162 6c65  equence[Hashable
-0002a410: 207c 2065 6c6c 6970 7369 735d 5d20 7c20   | ellipsis]] | 
-0002a420: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-0002a430: 2020 2020 2063 7265 6174 655f 696e 6465       create_inde
-0002a440: 783a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  x: bool | None =
-0002a450: 2054 7275 652c 0a20 2020 2020 2020 2069   True,.        i
-0002a460: 6e64 6578 5f63 6c73 3a20 7479 7065 5b49  ndex_cls: type[I
-0002a470: 6e64 6578 5d20 3d20 5061 6e64 6173 4d75  ndex] = PandasMu
-0002a480: 6c74 6949 6e64 6578 2c0a 2020 2020 2020  ltiIndex,.      
-0002a490: 2020 2a2a 6469 6d65 6e73 696f 6e73 5f6b    **dimensions_k
-0002a4a0: 7761 7267 733a 2053 6571 7565 6e63 655b  wargs: Sequence[
-0002a4b0: 4861 7368 6162 6c65 207c 2065 6c6c 6970  Hashable | ellip
-0002a4c0: 7369 735d 2c0a 2020 2020 2920 2d3e 2054  sis],.    ) -> T
-0002a4d0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-0002a4e0: 2020 2222 220a 2020 2020 2020 2020 5374    """.        St
-0002a4f0: 6163 6b20 616e 7920 6e75 6d62 6572 206f  ack any number o
-0002a500: 6620 6578 6973 7469 6e67 2064 696d 656e  f existing dimen
-0002a510: 7369 6f6e 7320 696e 746f 2061 2073 696e  sions into a sin
-0002a520: 676c 6520 6e65 7720 6469 6d65 6e73 696f  gle new dimensio
-0002a530: 6e2e 0a0a 2020 2020 2020 2020 4e65 7720  n...        New 
-0002a540: 6469 6d65 6e73 696f 6e73 2077 696c 6c20  dimensions will 
-0002a550: 6265 2061 6464 6564 2061 7420 7468 6520  be added at the 
-0002a560: 656e 642c 2061 6e64 2062 7920 6465 6661  end, and by defa
-0002a570: 756c 7420 7468 6520 636f 7272 6573 706f  ult the correspo
-0002a580: 6e64 696e 670a 2020 2020 2020 2020 636f  nding.        co
-0002a590: 6f72 6469 6e61 7465 2076 6172 6961 626c  ordinate variabl
-0002a5a0: 6573 2077 696c 6c20 6265 2063 6f6d 6269  es will be combi
-0002a5b0: 6e65 6420 696e 746f 2061 204d 756c 7469  ned into a Multi
-0002a5c0: 496e 6465 782e 0a0a 2020 2020 2020 2020  Index...        
-0002a5d0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0002a5e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0002a5f0: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
-0002a600: 203a 206d 6170 7069 6e67 206f 6620 6861   : mapping of ha
-0002a610: 7368 6162 6c65 2074 6f20 7365 7175 656e  shable to sequen
-0002a620: 6365 206f 6620 6861 7368 6162 6c65 0a20  ce of hashable. 
-0002a630: 2020 2020 2020 2020 2020 204d 6170 7069             Mappi
-0002a640: 6e67 206f 6620 7468 6520 666f 726d 2060  ng of the form `
-0002a650: 6e65 775f 6e61 6d65 3d28 6469 6d31 2c20  new_name=(dim1, 
-0002a660: 6469 6d32 2c20 2e2e 2e29 602e 204e 616d  dim2, ...)`. Nam
-0002a670: 6573 206f 6620 6e65 770a 2020 2020 2020  es of new.      
-0002a680: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
-0002a690: 2c20 616e 6420 7468 6520 6578 6973 7469  , and the existi
-0002a6a0: 6e67 2064 696d 656e 7369 6f6e 7320 7468  ng dimensions th
-0002a6b0: 6174 2074 6865 7920 7265 706c 6163 652e  at they replace.
-0002a6c0: 2041 6e0a 2020 2020 2020 2020 2020 2020   An.            
-0002a6d0: 656c 6c69 7073 6973 2028 602e 2e2e 6029  ellipsis (`...`)
-0002a6e0: 2077 696c 6c20 6265 2072 6570 6c61 6365   will be replace
-0002a6f0: 6420 6279 2061 6c6c 2075 6e6c 6973 7465  d by all unliste
-0002a700: 6420 6469 6d65 6e73 696f 6e73 2e0a 2020  d dimensions..  
-0002a710: 2020 2020 2020 2020 2020 5061 7373 696e            Passin
-0002a720: 6720 6120 6c69 7374 2063 6f6e 7461 696e  g a list contain
-0002a730: 696e 6720 616e 2065 6c6c 6970 7369 7320  ing an ellipsis 
-0002a740: 2860 7374 6163 6b65 645f 6469 6d3d 5b2e  (`stacked_dim=[.
-0002a750: 2e2e 5d60 2920 7769 6c6c 2073 7461 636b  ..]`) will stack
-0002a760: 206f 7665 720a 2020 2020 2020 2020 2020   over.          
-0002a770: 2020 616c 6c20 6469 6d65 6e73 696f 6e73    all dimensions
-0002a780: 2e0a 2020 2020 2020 2020 6372 6561 7465  ..        create
-0002a790: 5f69 6e64 6578 203a 2062 6f6f 6c20 6f72  _index : bool or
-0002a7a0: 204e 6f6e 652c 2064 6566 6175 6c74 3a20   None, default: 
-0002a7b0: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
-0002a7c0: 2020 2d20 5472 7565 3a20 6372 6561 7465    - True: create
-0002a7d0: 2061 206d 756c 7469 2d69 6e64 6578 2066   a multi-index f
-0002a7e0: 6f72 2065 6163 6820 6f66 2074 6865 2073  or each of the s
-0002a7f0: 7461 636b 6564 2064 696d 656e 7369 6f6e  tacked dimension
-0002a800: 732e 0a20 2020 2020 2020 2020 2020 202d  s..            -
-0002a810: 2046 616c 7365 3a20 646f 6e27 7420 6372   False: don't cr
-0002a820: 6561 7465 2061 6e79 2069 6e64 6578 2e0a  eate any index..
-0002a830: 2020 2020 2020 2020 2020 2020 2d20 4e6f              - No
-0002a840: 6e65 2e20 6372 6561 7465 2061 206d 756c  ne. create a mul
-0002a850: 7469 2d69 6e64 6578 206f 6e6c 7920 6966  ti-index only if
-0002a860: 2065 7861 6374 6c79 206f 6e65 2073 696e   exactly one sin
-0002a870: 676c 6520 2831 2d64 2920 636f 6f72 6469  gle (1-d) coordi
-0002a880: 6e61 7465 0a20 2020 2020 2020 2020 2020  nate.           
-0002a890: 2020 2069 6e64 6578 2069 7320 666f 756e     index is foun
-0002a8a0: 6420 666f 7220 6576 6572 7920 6469 6d65  d for every dime
-0002a8b0: 6e73 696f 6e20 746f 2073 7461 636b 2e0a  nsion to stack..
-0002a8c0: 0a20 2020 2020 2020 2069 6e64 6578 5f63  .        index_c
-0002a8d0: 6c73 3a20 496e 6465 782d 636c 6173 732c  ls: Index-class,
-0002a8e0: 2064 6566 6175 6c74 3a20 5061 6e64 6173   default: Pandas
-0002a8f0: 4d75 6c74 6949 6e64 6578 0a20 2020 2020  MultiIndex.     
-0002a900: 2020 2020 2020 2043 616e 2062 6520 7573         Can be us
-0002a910: 6564 2074 6f20 7061 7373 2061 2063 7573  ed to pass a cus
-0002a920: 746f 6d20 6d75 6c74 692d 696e 6465 7820  tom multi-index 
-0002a930: 7479 7065 2028 6d75 7374 2062 6520 616e  type (must be an
-0002a940: 2058 6172 7261 7920 696e 6465 7820 7468   Xarray index th
-0002a950: 6174 0a20 2020 2020 2020 2020 2020 2069  at.            i
-0002a960: 6d70 6c65 6d65 6e74 7320 602e 7374 6163  mplements `.stac
-0002a970: 6b28 2960 292e 2042 7920 6465 6661 756c  k()`). By defaul
-0002a980: 742c 2061 2070 616e 6461 7320 6d75 6c74  t, a pandas mult
-0002a990: 692d 696e 6465 7820 7772 6170 7065 7220  i-index wrapper 
-0002a9a0: 6973 2075 7365 642e 0a20 2020 2020 2020  is used..       
-0002a9b0: 202a 2a64 696d 656e 7369 6f6e 735f 6b77   **dimensions_kw
-0002a9c0: 6172 6773 0a20 2020 2020 2020 2020 2020  args.           
-0002a9d0: 2054 6865 206b 6579 776f 7264 2061 7267   The keyword arg
-0002a9e0: 756d 656e 7473 2066 6f72 6d20 6f66 2060  uments form of `
-0002a9f0: 6064 696d 656e 7369 6f6e 7360 602e 0a20  `dimensions``.. 
-0002aa00: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
-0002aa10: 6620 6469 6d65 6e73 696f 6e73 206f 7220  f dimensions or 
-0002aa20: 6469 6d65 6e73 696f 6e73 5f6b 7761 7267  dimensions_kwarg
-0002aa30: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
-0002aa40: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
-0002aa50: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-0002aa60: 2d2d 2d2d 0a20 2020 2020 2020 2073 7461  ----.        sta
-0002aa70: 636b 6564 203a 2044 6174 6173 6574 0a20  cked : Dataset. 
-0002aa80: 2020 2020 2020 2020 2020 2044 6174 6173             Datas
-0002aa90: 6574 2077 6974 6820 7374 6163 6b65 6420  et with stacked 
-0002aaa0: 6461 7461 2e0a 0a20 2020 2020 2020 2053  data...        S
-0002aab0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-0002aac0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0002aad0: 2044 6174 6173 6574 2e75 6e73 7461 636b   Dataset.unstack
-0002aae0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0002aaf0: 2020 2020 2064 696d 656e 7369 6f6e 7320       dimensions 
-0002ab00: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
-0002ab10: 5f6b 7761 7267 7328 6469 6d65 6e73 696f  _kwargs(dimensio
-0002ab20: 6e73 2c20 6469 6d65 6e73 696f 6e73 5f6b  ns, dimensions_k
-0002ab30: 7761 7267 732c 2022 7374 6163 6b22 290a  wargs, "stack").
-0002ab40: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0002ab50: 2073 656c 660a 2020 2020 2020 2020 666f   self.        fo
-0002ab60: 7220 6e65 775f 6469 6d2c 2064 696d 7320  r new_dim, dims 
-0002ab70: 696e 2064 696d 656e 7369 6f6e 732e 6974  in dimensions.it
-0002ab80: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-0002ab90: 2020 2072 6573 756c 7420 3d20 7265 7375     result = resu
-0002aba0: 6c74 2e5f 7374 6163 6b5f 6f6e 6365 2864  lt._stack_once(d
-0002abb0: 696d 732c 206e 6577 5f64 696d 2c20 696e  ims, new_dim, in
-0002abc0: 6465 785f 636c 732c 2063 7265 6174 655f  dex_cls, create_
-0002abd0: 696e 6465 7829 0a20 2020 2020 2020 2072  index).        r
-0002abe0: 6574 7572 6e20 7265 7375 6c74 0a0a 2020  eturn result..  
-0002abf0: 2020 6465 6620 746f 5f73 7461 636b 6564    def to_stacked
-0002ac00: 5f61 7272 6179 280a 2020 2020 2020 2020  _array(.        
-0002ac10: 7365 6c66 2c0a 2020 2020 2020 2020 6e65  self,.        ne
-0002ac20: 775f 6469 6d3a 2048 6173 6861 626c 652c  w_dim: Hashable,
-0002ac30: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-0002ac40: 6469 6d73 3a20 436f 6c6c 6563 7469 6f6e  dims: Collection
-0002ac50: 5b48 6173 6861 626c 655d 2c0a 2020 2020  [Hashable],.    
-0002ac60: 2020 2020 7661 7269 6162 6c65 5f64 696d      variable_dim
-0002ac70: 3a20 4861 7368 6162 6c65 203d 2022 7661  : Hashable = "va
-0002ac80: 7269 6162 6c65 222c 0a20 2020 2020 2020  riable",.       
-0002ac90: 206e 616d 653a 2048 6173 6861 626c 6520   name: Hashable 
-0002aca0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-0002acb0: 2020 2029 202d 3e20 4461 7461 4172 7261     ) -> DataArra
-0002acc0: 793a 0a20 2020 2020 2020 2022 2222 436f  y:.        """Co
-0002acd0: 6d62 696e 6520 7661 7269 6162 6c65 7320  mbine variables 
-0002ace0: 6f66 2064 6966 6665 7269 6e67 2064 696d  of differing dim
-0002acf0: 656e 7369 6f6e 616c 6974 7920 696e 746f  ensionality into
-0002ad00: 2061 2044 6174 6141 7272 6179 0a20 2020   a DataArray.   
-0002ad10: 2020 2020 2077 6974 686f 7574 2062 726f       without bro
-0002ad20: 6164 6361 7374 696e 672e 0a0a 2020 2020  adcasting...    
-0002ad30: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
-0002ad40: 6973 2073 696d 696c 6172 2074 6f20 4461  is similar to Da
-0002ad50: 7461 7365 742e 746f 5f61 7272 6179 2062  taset.to_array b
-0002ad60: 7574 2064 6f65 7320 6e6f 7420 6272 6f61  ut does not broa
-0002ad70: 6463 6173 7420 7468 650a 2020 2020 2020  dcast the.      
-0002ad80: 2020 7661 7269 6162 6c65 732e 0a0a 2020    variables...  
-0002ad90: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0002ada0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0002adb0: 2d2d 2d0a 2020 2020 2020 2020 6e65 775f  ---.        new_
-0002adc0: 6469 6d20 3a20 6861 7368 6162 6c65 0a20  dim : hashable. 
-0002add0: 2020 2020 2020 2020 2020 204e 616d 6520             Name 
-0002ade0: 6f66 2074 6865 206e 6577 2073 7461 636b  of the new stack
-0002adf0: 6564 2063 6f6f 7264 696e 6174 650a 2020  ed coordinate.  
-0002ae00: 2020 2020 2020 7361 6d70 6c65 5f64 696d        sample_dim
-0002ae10: 7320 3a20 436f 6c6c 6563 7469 6f6e 206f  s : Collection o
-0002ae20: 6620 6861 7368 6162 6c65 730a 2020 2020  f hashables.    
-0002ae30: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
-0002ae40: 6469 6d65 6e73 696f 6e73 2074 6861 7420  dimensions that 
-0002ae50: 2a2a 7769 6c6c 206e 6f74 2a2a 2062 6520  **will not** be 
-0002ae60: 7374 6163 6b65 642e 2045 6163 6820 6172  stacked. Each ar
-0002ae70: 7261 7920 696e 2074 6865 0a20 2020 2020  ray in the.     
-0002ae80: 2020 2020 2020 2064 6174 6173 6574 206d         dataset m
-0002ae90: 7573 7420 7368 6172 6520 7468 6573 6520  ust share these 
-0002aea0: 6469 6d65 6e73 696f 6e73 2e20 466f 7220  dimensions. For 
-0002aeb0: 6d61 6368 696e 6520 6c65 6172 6e69 6e67  machine learning
-0002aec0: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
-0002aed0: 6c69 6361 7469 6f6e 732c 2074 6865 7365  lications, these
-0002aee0: 2064 6566 696e 6520 7468 6520 6469 6d65   define the dime
-0002aef0: 6e73 696f 6e73 206f 7665 7220 7768 6963  nsions over whic
-0002af00: 6820 7361 6d70 6c65 7320 6172 650a 2020  h samples are.  
-0002af10: 2020 2020 2020 2020 2020 6472 6177 6e2e            drawn.
-0002af20: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-0002af30: 655f 6469 6d20 3a20 6861 7368 6162 6c65  e_dim : hashable
-0002af40: 2c20 6465 6661 756c 743a 2022 7661 7269  , default: "vari
-0002af50: 6162 6c65 220a 2020 2020 2020 2020 2020  able".          
-0002af60: 2020 4e61 6d65 206f 6620 7468 6520 6c65    Name of the le
-0002af70: 7665 6c20 696e 2074 6865 2073 7461 636b  vel in the stack
-0002af80: 6564 2063 6f6f 7264 696e 6174 6520 7768  ed coordinate wh
-0002af90: 6963 6820 636f 7272 6573 706f 6e64 7320  ich corresponds 
-0002afa0: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
-0002afb0: 6865 2076 6172 6961 626c 6573 2e0a 2020  he variables..  
-0002afc0: 2020 2020 2020 6e61 6d65 203a 2068 6173        name : has
-0002afd0: 6861 626c 652c 206f 7074 696f 6e61 6c0a  hable, optional.
-0002afe0: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
-0002aff0: 206f 6620 7468 6520 6e65 7720 6461 7461   of the new data
-0002b000: 2061 7272 6179 2e0a 0a20 2020 2020 2020   array...       
-0002b010: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-0002b020: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-0002b030: 2073 7461 636b 6564 203a 2044 6174 6141   stacked : DataA
-0002b040: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
-0002b050: 2044 6174 6141 7272 6179 2077 6974 6820   DataArray with 
-0002b060: 7468 6520 7370 6563 6966 6965 6420 6469  the specified di
-0002b070: 6d65 6e73 696f 6e73 2061 6e64 2064 6174  mensions and dat
-0002b080: 6120 7661 7269 6162 6c65 730a 2020 2020  a variables.    
-0002b090: 2020 2020 2020 2020 7374 6163 6b65 6420          stacked 
-0002b0a0: 746f 6765 7468 6572 2e20 5468 6520 7374  together. The st
-0002b0b0: 6163 6b65 6420 636f 6f72 6469 6e61 7465  acked coordinate
-0002b0c0: 2069 7320 6e61 6d65 6420 6060 6e65 775f   is named ``new_
-0002b0d0: 6469 6d60 600a 2020 2020 2020 2020 2020  dim``.          
-0002b0e0: 2020 616e 6420 7265 7072 6573 656e 7465    and represente
-0002b0f0: 6420 6279 2061 204d 756c 7469 496e 6465  d by a MultiInde
-0002b100: 7820 6f62 6a65 6374 2077 6974 6820 6120  x object with a 
-0002b110: 6c65 7665 6c20 636f 6e74 6169 6e69 6e67  level containing
-0002b120: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-0002b130: 2064 6174 6120 7661 7269 6162 6c65 206e   data variable n
-0002b140: 616d 6573 2e20 5468 6520 6e61 6d65 206f  ames. The name o
-0002b150: 6620 7468 6973 206c 6576 656c 2069 7320  f this level is 
-0002b160: 636f 6e74 726f 6c6c 6564 2075 7369 6e67  controlled using
-0002b170: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-0002b180: 2060 6076 6172 6961 626c 655f 6469 6d60   ``variable_dim`
-0002b190: 6020 6172 6775 6d65 6e74 2e0a 0a20 2020  ` argument...   
-0002b1a0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
-0002b1b0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-0002b1c0: 2020 2020 2020 2044 6174 6173 6574 2e74         Dataset.t
-0002b1d0: 6f5f 6172 7261 790a 2020 2020 2020 2020  o_array.        
-0002b1e0: 4461 7461 7365 742e 7374 6163 6b0a 2020  Dataset.stack.  
-0002b1f0: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
-0002b200: 746f 5f75 6e73 7461 636b 6564 5f64 6174  to_unstacked_dat
-0002b210: 6173 6574 0a0a 2020 2020 2020 2020 4578  aset..        Ex
-0002b220: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
-0002b230: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0002b240: 3e3e 3e20 6461 7461 203d 2078 722e 4461  >>> data = xr.Da
-0002b250: 7461 7365 7428 0a20 2020 2020 2020 202e  taset(.        .
-0002b260: 2e2e 2020 2020 2064 6174 615f 7661 7273  ..     data_vars
-0002b270: 3d7b 0a20 2020 2020 2020 202e 2e2e 2020  ={.        ...  
-0002b280: 2020 2020 2020 2022 6122 3a20 2828 2278         "a": (("x
-0002b290: 222c 2022 7922 292c 205b 5b30 2c20 312c  ", "y"), [[0, 1,
-0002b2a0: 2032 5d2c 205b 332c 2034 2c20 355d 5d29   2], [3, 4, 5]])
-0002b2b0: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-0002b2c0: 2020 2020 2020 2262 223a 2028 2278 222c        "b": ("x",
-0002b2d0: 205b 362c 2037 5d29 2c0a 2020 2020 2020   [6, 7]),.      
-0002b2e0: 2020 2e2e 2e20 2020 2020 7d2c 0a20 2020    ...     },.   
-0002b2f0: 2020 2020 202e 2e2e 2020 2020 2063 6f6f       ...     coo
-0002b300: 7264 733d 7b22 7922 3a20 5b22 7522 2c20  rds={"y": ["u", 
-0002b310: 2276 222c 2022 7722 5d7d 2c0a 2020 2020  "v", "w"]},.    
-0002b320: 2020 2020 2e2e 2e20 290a 0a20 2020 2020      ... )..     
-0002b330: 2020 203e 3e3e 2064 6174 610a 2020 2020     >>> data.    
-0002b340: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-0002b350: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
-0002b360: 656e 7369 6f6e 733a 2020 2878 3a20 322c  ensions:  (x: 2,
-0002b370: 2079 3a20 3329 0a20 2020 2020 2020 2043   y: 3).        C
-0002b380: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-0002b390: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
-0002b3a0: 2028 7929 203c 5531 2027 7527 2027 7627   (y) <U1 'u' 'v'
-0002b3b0: 2027 7727 0a20 2020 2020 2020 2044 696d   'w'.        Dim
-0002b3c0: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
-0002b3d0: 636f 6f72 6469 6e61 7465 733a 2078 0a20  coordinates: x. 
-0002b3e0: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
-0002b3f0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-0002b400: 2020 2061 2020 2020 2020 2020 2878 2c20     a        (x, 
-0002b410: 7929 2069 6e74 3634 2030 2031 2032 2033  y) int64 0 1 2 3
-0002b420: 2034 2035 0a20 2020 2020 2020 2020 2020   4 5.           
-0002b430: 2062 2020 2020 2020 2020 2878 2920 696e   b        (x) in
-0002b440: 7436 3420 3620 370a 0a20 2020 2020 2020  t64 6 7..       
-0002b450: 203e 3e3e 2064 6174 612e 746f 5f73 7461   >>> data.to_sta
-0002b460: 636b 6564 5f61 7272 6179 2822 7a22 2c20  cked_array("z", 
-0002b470: 7361 6d70 6c65 5f64 696d 733d 5b22 7822  sample_dims=["x"
-0002b480: 5d29 0a20 2020 2020 2020 203c 7861 7272  ]).        <xarr
-0002b490: 6179 2e44 6174 6141 7272 6179 2027 6127  ay.DataArray 'a'
-0002b4a0: 2028 783a 2032 2c20 7a3a 2034 293e 0a20   (x: 2, z: 4)>. 
-0002b4b0: 2020 2020 2020 2061 7272 6179 285b 5b30         array([[0
-0002b4c0: 2c20 312c 2032 2c20 365d 2c0a 2020 2020  , 1, 2, 6],.    
-0002b4d0: 2020 2020 2020 2020 2020 205b 332c 2034             [3, 4
-0002b4e0: 2c20 352c 2037 5d5d 290a 2020 2020 2020  , 5, 7]]).      
-0002b4f0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-0002b500: 2020 2020 2020 2020 202a 207a 2020 2020           * z    
-0002b510: 2020 2020 2028 7a29 206f 626a 6563 7420       (z) object 
-0002b520: 4d75 6c74 6949 6e64 6578 0a20 2020 2020  MultiIndex.     
-0002b530: 2020 2020 202a 2076 6172 6961 626c 6520       * variable 
-0002b540: 2028 7a29 206f 626a 6563 7420 2761 2720   (z) object 'a' 
-0002b550: 2761 2720 2761 2720 2762 270a 2020 2020  'a' 'a' 'b'.    
-0002b560: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
-0002b570: 2020 287a 2920 6f62 6a65 6374 2027 7527    (z) object 'u'
-0002b580: 2027 7627 2027 7727 206e 616e 0a20 2020   'v' 'w' nan.   
-0002b590: 2020 2020 2044 696d 656e 7369 6f6e 7320       Dimensions 
-0002b5a0: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-0002b5b0: 7465 733a 2078 0a0a 2020 2020 2020 2020  tes: x..        
-0002b5c0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-0002b5d0: 2078 6172 7261 792e 636f 7265 2e63 6f6e   xarray.core.con
-0002b5e0: 6361 7420 696d 706f 7274 2063 6f6e 6361  cat import conca
-0002b5f0: 740a 0a20 2020 2020 2020 2073 7461 636b  t..        stack
-0002b600: 696e 675f 6469 6d73 203d 2074 7570 6c65  ing_dims = tuple
-0002b610: 2864 696d 2066 6f72 2064 696d 2069 6e20  (dim for dim in 
-0002b620: 7365 6c66 2e64 696d 7320 6966 2064 696d  self.dims if dim
-0002b630: 206e 6f74 2069 6e20 7361 6d70 6c65 5f64   not in sample_d
-0002b640: 696d 7329 0a0a 2020 2020 2020 2020 666f  ims)..        fo
-0002b650: 7220 7661 7269 6162 6c65 2069 6e20 7365  r variable in se
-0002b660: 6c66 3a0a 2020 2020 2020 2020 2020 2020  lf:.            
-0002b670: 6469 6d73 203d 2073 656c 665b 7661 7269  dims = self[vari
-0002b680: 6162 6c65 5d2e 6469 6d73 0a20 2020 2020  able].dims.     
-0002b690: 2020 2020 2020 2064 696d 735f 696e 636c         dims_incl
-0002b6a0: 7564 655f 7361 6d70 6c65 5f64 696d 7320  ude_sample_dims 
-0002b6b0: 3d20 7365 7428 7361 6d70 6c65 5f64 696d  = set(sample_dim
-0002b6c0: 7329 203c 3d20 7365 7428 6469 6d73 290a  s) <= set(dims).
-0002b6d0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0002b6e0: 6f74 2064 696d 735f 696e 636c 7564 655f  ot dims_include_
-0002b6f0: 7361 6d70 6c65 5f64 696d 733a 0a20 2020  sample_dims:.   
-0002b700: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0002b710: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-0002b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b730: 2020 2022 416c 6c20 7661 7269 6162 6c65     "All variable
-0002b740: 7320 696e 2074 6865 2064 6174 6173 6574  s in the dataset
-0002b750: 206d 7573 7420 636f 6e74 6169 6e20 7468   must contain th
-0002b760: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-0002b770: 2020 2020 2020 2020 2264 696d 656e 7369          "dimensi
-0002b780: 6f6e 7320 7b7d 2e22 2e66 6f72 6d61 7428  ons {}.".format(
-0002b790: 6469 6d73 290a 2020 2020 2020 2020 2020  dims).          
-0002b7a0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0002b7b0: 2064 6566 2065 6e73 7572 655f 7374 6163   def ensure_stac
-0002b7c0: 6b61 626c 6528 7661 6c29 3a0a 2020 2020  kable(val):.    
-0002b7d0: 2020 2020 2020 2020 6173 7369 676e 5f63          assign_c
-0002b7e0: 6f6f 7264 7320 3d20 7b76 6172 6961 626c  oords = {variabl
-0002b7f0: 655f 6469 6d3a 2076 616c 2e6e 616d 657d  e_dim: val.name}
-0002b800: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0002b810: 2064 696d 2069 6e20 7374 6163 6b69 6e67   dim in stacking
-0002b820: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
-0002b830: 2020 2020 2020 2069 6620 6469 6d20 6e6f         if dim no
-0002b840: 7420 696e 2076 616c 2e64 696d 733a 0a20  t in val.dims:. 
-0002b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b860: 2020 2061 7373 6967 6e5f 636f 6f72 6473     assign_coords
-0002b870: 5b64 696d 5d20 3d20 4e6f 6e65 0a0a 2020  [dim] = None..  
-0002b880: 2020 2020 2020 2020 2020 6578 7061 6e64            expand
-0002b890: 5f64 696d 7320 3d20 7365 7428 7374 6163  _dims = set(stac
-0002b8a0: 6b69 6e67 5f64 696d 7329 2e64 6966 6665  king_dims).diffe
-0002b8b0: 7265 6e63 6528 7365 7428 7661 6c2e 6469  rence(set(val.di
-0002b8c0: 6d73 2929 0a20 2020 2020 2020 2020 2020  ms)).           
-0002b8d0: 2065 7870 616e 645f 6469 6d73 2e61 6464   expand_dims.add
-0002b8e0: 2876 6172 6961 626c 655f 6469 6d29 0a20  (variable_dim). 
-0002b8f0: 2020 2020 2020 2020 2020 2023 206d 7573             # mus
-0002b900: 7420 6265 206c 6973 7420 666f 7220 2e65  t be list for .e
-0002b910: 7870 616e 645f 6469 6d73 0a20 2020 2020  xpand_dims.     
-0002b920: 2020 2020 2020 2065 7870 616e 645f 6469         expand_di
-0002b930: 6d73 203d 206c 6973 7428 6578 7061 6e64  ms = list(expand
-0002b940: 5f64 696d 7329 0a0a 2020 2020 2020 2020  _dims)..        
-0002b950: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-0002b960: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0002b970: 2e61 7373 6967 6e5f 636f 6f72 6473 282a  .assign_coords(*
-0002b980: 2a61 7373 6967 6e5f 636f 6f72 6473 290a  *assign_coords).
-0002b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b9a0: 2e65 7870 616e 645f 6469 6d73 2865 7870  .expand_dims(exp
-0002b9b0: 616e 645f 6469 6d73 290a 2020 2020 2020  and_dims).      
-0002b9c0: 2020 2020 2020 2020 2020 2e73 7461 636b            .stack
-0002b9d0: 287b 6e65 775f 6469 6d3a 2028 7661 7269  ({new_dim: (vari
-0002b9e0: 6162 6c65 5f64 696d 2c29 202b 2073 7461  able_dim,) + sta
-0002b9f0: 636b 696e 675f 6469 6d73 7d29 0a20 2020  cking_dims}).   
-0002ba00: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0002ba10: 2020 2020 2320 636f 6e63 6174 656e 6174      # concatenat
-0002ba20: 6520 7468 6520 6172 7261 7973 0a20 2020  e the arrays.   
-0002ba30: 2020 2020 2073 7461 636b 6162 6c65 5f76       stackable_v
-0002ba40: 6172 7320 3d20 5b65 6e73 7572 655f 7374  ars = [ensure_st
-0002ba50: 6163 6b61 626c 6528 7365 6c66 5b6b 6579  ackable(self[key
-0002ba60: 5d29 2066 6f72 206b 6579 2069 6e20 7365  ]) for key in se
-0002ba70: 6c66 2e64 6174 615f 7661 7273 5d0a 2020  lf.data_vars].  
-0002ba80: 2020 2020 2020 6461 7461 5f61 7272 6179        data_array
-0002ba90: 203d 2063 6f6e 6361 7428 7374 6163 6b61   = concat(stacka
-0002baa0: 626c 655f 7661 7273 2c20 6469 6d3d 6e65  ble_vars, dim=ne
-0002bab0: 775f 6469 6d29 0a0a 2020 2020 2020 2020  w_dim)..        
-0002bac0: 6966 206e 616d 6520 6973 206e 6f74 204e  if name is not N
-0002bad0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002bae0: 2064 6174 615f 6172 7261 792e 6e61 6d65   data_array.name
-0002baf0: 203d 206e 616d 650a 0a20 2020 2020 2020   = name..       
-0002bb00: 2072 6574 7572 6e20 6461 7461 5f61 7272   return data_arr
-0002bb10: 6179 0a0a 2020 2020 6465 6620 5f75 6e73  ay..    def _uns
-0002bb20: 7461 636b 5f6f 6e63 6528 0a20 2020 2020  tack_once(.     
-0002bb30: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-0002bb40: 6574 2c0a 2020 2020 2020 2020 6469 6d3a  et,.        dim:
-0002bb50: 2048 6173 6861 626c 652c 0a20 2020 2020   Hashable,.     
-0002bb60: 2020 2069 6e64 6578 5f61 6e64 5f76 6172     index_and_var
-0002bb70: 733a 2074 7570 6c65 5b49 6e64 6578 2c20  s: tuple[Index, 
-0002bb80: 6469 6374 5b48 6173 6861 626c 652c 2056  dict[Hashable, V
-0002bb90: 6172 6961 626c 655d 5d2c 0a20 2020 2020  ariable]],.     
-0002bba0: 2020 2066 696c 6c5f 7661 6c75 652c 0a20     fill_value,. 
-0002bbb0: 2020 2020 2020 2073 7061 7273 653a 2062         sparse: b
-0002bbc0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0002bbd0: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-0002bbe0: 0a20 2020 2020 2020 2069 6e64 6578 2c20  .        index, 
-0002bbf0: 696e 6465 785f 7661 7273 203d 2069 6e64  index_vars = ind
-0002bc00: 6578 5f61 6e64 5f76 6172 730a 2020 2020  ex_and_vars.    
-0002bc10: 2020 2020 7661 7269 6162 6c65 733a 2064      variables: d
-0002bc20: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
-0002bc30: 7269 6162 6c65 5d20 3d20 7b7d 0a20 2020  riable] = {}.   
-0002bc40: 2020 2020 2069 6e64 6578 6573 203d 207b       indexes = {
-0002bc50: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
-0002bc60: 2073 656c 662e 5f69 6e64 6578 6573 2e69   self._indexes.i
-0002bc70: 7465 6d73 2829 2069 6620 6b20 213d 2064  tems() if k != d
-0002bc80: 696d 7d0a 0a20 2020 2020 2020 206e 6577  im}..        new
-0002bc90: 5f69 6e64 6578 6573 2c20 636c 6561 6e5f  _indexes, clean_
-0002bca0: 696e 6465 7820 3d20 696e 6465 782e 756e  index = index.un
-0002bcb0: 7374 6163 6b28 290a 2020 2020 2020 2020  stack().        
-0002bcc0: 696e 6465 7865 732e 7570 6461 7465 286e  indexes.update(n
-0002bcd0: 6577 5f69 6e64 6578 6573 290a 0a20 2020  ew_indexes)..   
-0002bce0: 2020 2020 2066 6f72 206e 616d 652c 2069       for name, i
-0002bcf0: 6478 2069 6e20 6e65 775f 696e 6465 7865  dx in new_indexe
-0002bd00: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-0002bd10: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0002bd20: 2e75 7064 6174 6528 6964 782e 6372 6561  .update(idx.crea
-0002bd30: 7465 5f76 6172 6961 626c 6573 2869 6e64  te_variables(ind
-0002bd40: 6578 5f76 6172 7329 290a 0a20 2020 2020  ex_vars))..     
-0002bd50: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
-0002bd60: 2069 6e20 7365 6c66 2e76 6172 6961 626c   in self.variabl
-0002bd70: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-0002bd80: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-0002bd90: 6e6f 7420 696e 2069 6e64 6578 5f76 6172  not in index_var
-0002bda0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0002bdb0: 2020 2069 6620 6469 6d20 696e 2076 6172     if dim in var
-0002bdc0: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
-0002bdd0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0002bde0: 696e 7374 616e 6365 2866 696c 6c5f 7661  instance(fill_va
-0002bdf0: 6c75 652c 204d 6170 7069 6e67 293a 0a20  lue, Mapping):. 
-0002be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002be10: 2020 2020 2020 2066 696c 6c5f 7661 6c75         fill_valu
-0002be20: 655f 203d 2066 696c 6c5f 7661 6c75 655b  e_ = fill_value[
-0002be30: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
-0002be40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002be60: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
-0002be70: 7565 5f20 3d20 6669 6c6c 5f76 616c 7565  ue_ = fill_value
-0002be80: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002be90: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
-0002bea0: 6e61 6d65 5d20 3d20 7661 722e 5f75 6e73  name] = var._uns
-0002beb0: 7461 636b 5f6f 6e63 6528 0a20 2020 2020  tack_once(.     
-0002bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bed0: 2020 2069 6e64 6578 3d63 6c65 616e 5f69     index=clean_i
-0002bee0: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
-0002bef0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0002bf00: 6d3d 6469 6d2c 0a20 2020 2020 2020 2020  m=dim,.         
-0002bf10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0002bf20: 696c 6c5f 7661 6c75 653d 6669 6c6c 5f76  ill_value=fill_v
-0002bf30: 616c 7565 5f2c 0a20 2020 2020 2020 2020  alue_,.         
-0002bf40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002bf50: 7061 7273 653d 7370 6172 7365 2c0a 2020  parse=sparse,.  
-0002bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bf70: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0002bf80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002bf90: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0002bfa0: 7269 6162 6c65 735b 6e61 6d65 5d20 3d20  riables[name] = 
-0002bfb0: 7661 720a 0a20 2020 2020 2020 2063 6f6f  var..        coo
-0002bfc0: 7264 5f6e 616d 6573 203d 2073 6574 2873  rd_names = set(s
-0002bfd0: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
-0002bfe0: 2920 2d20 7b64 696d 7d20 7c20 7365 7428  ) - {dim} | set(
-0002bff0: 6e65 775f 696e 6465 7865 7329 0a0a 2020  new_indexes)..  
-0002c000: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002c010: 662e 5f72 6570 6c61 6365 5f77 6974 685f  f._replace_with_
-0002c020: 6e65 775f 6469 6d73 280a 2020 2020 2020  new_dims(.      
-0002c030: 2020 2020 2020 7661 7269 6162 6c65 732c        variables,
-0002c040: 2063 6f6f 7264 5f6e 616d 6573 3d63 6f6f   coord_names=coo
-0002c050: 7264 5f6e 616d 6573 2c20 696e 6465 7865  rd_names, indexe
-0002c060: 733d 696e 6465 7865 730a 2020 2020 2020  s=indexes.      
-0002c070: 2020 290a 0a20 2020 2064 6566 205f 756e    )..    def _un
-0002c080: 7374 6163 6b5f 6675 6c6c 5f72 6569 6e64  stack_full_reind
-0002c090: 6578 280a 2020 2020 2020 2020 7365 6c66  ex(.        self
-0002c0a0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-0002c0b0: 2020 2020 2064 696d 3a20 4861 7368 6162       dim: Hashab
-0002c0c0: 6c65 2c0a 2020 2020 2020 2020 696e 6465  le,.        inde
-0002c0d0: 785f 616e 645f 7661 7273 3a20 7475 706c  x_and_vars: tupl
-0002c0e0: 655b 496e 6465 782c 2064 6963 745b 4861  e[Index, dict[Ha
-0002c0f0: 7368 6162 6c65 2c20 5661 7269 6162 6c65  shable, Variable
-0002c100: 5d5d 2c0a 2020 2020 2020 2020 6669 6c6c  ]],.        fill
-0002c110: 5f76 616c 7565 2c0a 2020 2020 2020 2020  _value,.        
-0002c120: 7370 6172 7365 3a20 626f 6f6c 2c0a 2020  sparse: bool,.  
-0002c130: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-0002c140: 3a0a 2020 2020 2020 2020 696e 6465 782c  :.        index,
-0002c150: 2069 6e64 6578 5f76 6172 7320 3d20 696e   index_vars = in
-0002c160: 6465 785f 616e 645f 7661 7273 0a20 2020  dex_and_vars.   
-0002c170: 2020 2020 2076 6172 6961 626c 6573 3a20       variables: 
-0002c180: 6469 6374 5b48 6173 6861 626c 652c 2056  dict[Hashable, V
-0002c190: 6172 6961 626c 655d 203d 207b 7d0a 2020  ariable] = {}.  
-0002c1a0: 2020 2020 2020 696e 6465 7865 7320 3d20        indexes = 
-0002c1b0: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
-0002c1c0: 6e20 7365 6c66 2e5f 696e 6465 7865 732e  n self._indexes.
-0002c1d0: 6974 656d 7328 2920 6966 206b 2021 3d20  items() if k != 
-0002c1e0: 6469 6d7d 0a0a 2020 2020 2020 2020 6e65  dim}..        ne
-0002c1f0: 775f 696e 6465 7865 732c 2063 6c65 616e  w_indexes, clean
-0002c200: 5f69 6e64 6578 203d 2069 6e64 6578 2e75  _index = index.u
-0002c210: 6e73 7461 636b 2829 0a20 2020 2020 2020  nstack().       
-0002c220: 2069 6e64 6578 6573 2e75 7064 6174 6528   indexes.update(
-0002c230: 6e65 775f 696e 6465 7865 7329 0a0a 2020  new_indexes)..  
-0002c240: 2020 2020 2020 6e65 775f 696e 6465 785f        new_index_
-0002c250: 7661 7269 6162 6c65 7320 3d20 7b7d 0a20  variables = {}. 
-0002c260: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
-0002c270: 2069 6478 2069 6e20 6e65 775f 696e 6465   idx in new_inde
-0002c280: 7865 732e 6974 656d 7328 293a 0a20 2020  xes.items():.   
-0002c290: 2020 2020 2020 2020 206e 6577 5f69 6e64           new_ind
-0002c2a0: 6578 5f76 6172 6961 626c 6573 2e75 7064  ex_variables.upd
-0002c2b0: 6174 6528 6964 782e 6372 6561 7465 5f76  ate(idx.create_v
-0002c2c0: 6172 6961 626c 6573 2869 6e64 6578 5f76  ariables(index_v
-0002c2d0: 6172 7329 290a 0a20 2020 2020 2020 206e  ars))..        n
-0002c2e0: 6577 5f64 696d 5f73 697a 6573 203d 207b  ew_dim_sizes = {
-0002c2f0: 6b3a 2076 2e73 697a 6520 666f 7220 6b2c  k: v.size for k,
-0002c300: 2076 2069 6e20 6e65 775f 696e 6465 785f   v in new_index_
-0002c310: 7661 7269 6162 6c65 732e 6974 656d 7328  variables.items(
-0002c320: 297d 0a20 2020 2020 2020 2076 6172 6961  )}.        varia
-0002c330: 626c 6573 2e75 7064 6174 6528 6e65 775f  bles.update(new_
-0002c340: 696e 6465 785f 7661 7269 6162 6c65 7329  index_variables)
-0002c350: 0a0a 2020 2020 2020 2020 2320 7461 6b65  ..        # take
-0002c360: 2061 2073 686f 7274 6375 7420 696e 2063   a shortcut in c
-0002c370: 6173 6520 7468 6520 4d75 6c74 6949 6e64  ase the MultiInd
-0002c380: 6578 2077 6173 206e 6f74 206d 6f64 6966  ex was not modif
-0002c390: 6965 642e 0a20 2020 2020 2020 2066 756c  ied..        ful
-0002c3a0: 6c5f 6964 7820 3d20 7064 2e4d 756c 7469  l_idx = pd.Multi
-0002c3b0: 496e 6465 782e 6672 6f6d 5f70 726f 6475  Index.from_produ
-0002c3c0: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
-0002c3d0: 636c 6561 6e5f 696e 6465 782e 6c65 7665  clean_index.leve
-0002c3e0: 6c73 2c20 6e61 6d65 733d 636c 6561 6e5f  ls, names=clean_
-0002c3f0: 696e 6465 782e 6e61 6d65 730a 2020 2020  index.names.    
-0002c400: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-0002c410: 2063 6c65 616e 5f69 6e64 6578 2e65 7175   clean_index.equ
-0002c420: 616c 7328 6675 6c6c 5f69 6478 293a 0a20  als(full_idx):. 
-0002c430: 2020 2020 2020 2020 2020 206f 626a 203d             obj =
-0002c440: 2073 656c 660a 2020 2020 2020 2020 656c   self.        el
-0002c450: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002c460: 2320 544f 444f 3a20 7765 206d 6179 2064  # TODO: we may d
-0002c470: 6570 7265 6369 6174 6520 696d 706c 6963  epreciate implic
-0002c480: 6974 2072 652d 696e 6465 7869 6e67 2077  it re-indexing w
-0002c490: 6974 6820 6120 7061 6e64 6173 2e4d 756c  ith a pandas.Mul
-0002c4a0: 7469 496e 6465 780a 2020 2020 2020 2020  tiIndex.        
-0002c4b0: 2020 2020 7872 5f66 756c 6c5f 6964 7820      xr_full_idx 
-0002c4c0: 3d20 5061 6e64 6173 4d75 6c74 6949 6e64  = PandasMultiInd
-0002c4d0: 6578 2866 756c 6c5f 6964 782c 2064 696d  ex(full_idx, dim
-0002c4e0: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-0002c4f0: 6465 7865 7273 203d 2049 6e64 6578 6573  dexers = Indexes
-0002c500: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002c510: 2020 7b6b 3a20 7872 5f66 756c 6c5f 6964    {k: xr_full_id
-0002c520: 7820 666f 7220 6b20 696e 2069 6e64 6578  x for k in index
-0002c530: 5f76 6172 737d 2c0a 2020 2020 2020 2020  _vars},.        
-0002c540: 2020 2020 2020 2020 7872 5f66 756c 6c5f          xr_full_
-0002c550: 6964 782e 6372 6561 7465 5f76 6172 6961  idx.create_varia
-0002c560: 626c 6573 2869 6e64 6578 5f76 6172 7329  bles(index_vars)
-0002c570: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0002c580: 2020 2020 2020 2020 2020 2020 6f62 6a20              obj 
-0002c590: 3d20 7365 6c66 2e5f 7265 696e 6465 7828  = self._reindex(
-0002c5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c5b0: 2069 6e64 6578 6572 732c 2063 6f70 793d   indexers, copy=
-0002c5c0: 4661 6c73 652c 2066 696c 6c5f 7661 6c75  False, fill_valu
-0002c5d0: 653d 6669 6c6c 5f76 616c 7565 2c20 7370  e=fill_value, sp
-0002c5e0: 6172 7365 3d73 7061 7273 650a 2020 2020  arse=sparse.    
-0002c5f0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0002c600: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
-0002c610: 2069 6e20 6f62 6a2e 7661 7269 6162 6c65   in obj.variable
-0002c620: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-0002c630: 2020 2020 2020 2069 6620 6e61 6d65 206e         if name n
-0002c640: 6f74 2069 6e20 696e 6465 785f 7661 7273  ot in index_vars
-0002c650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002c660: 2020 6966 2064 696d 2069 6e20 7661 722e    if dim in var.
-0002c670: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-0002c680: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-0002c690: 6c65 735b 6e61 6d65 5d20 3d20 7661 722e  les[name] = var.
-0002c6a0: 756e 7374 6163 6b28 7b64 696d 3a20 6e65  unstack({dim: ne
-0002c6b0: 775f 6469 6d5f 7369 7a65 737d 290a 2020  w_dim_sizes}).  
-0002c6c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002c6d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002c6e0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0002c6f0: 735b 6e61 6d65 5d20 3d20 7661 720a 0a20  s[name] = var.. 
-0002c700: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
-0002c710: 6573 203d 2073 6574 2873 656c 662e 5f63  es = set(self._c
-0002c720: 6f6f 7264 5f6e 616d 6573 2920 2d20 7b64  oord_names) - {d
-0002c730: 696d 7d20 7c20 7365 7428 6e65 775f 6469  im} | set(new_di
-0002c740: 6d5f 7369 7a65 7329 0a0a 2020 2020 2020  m_sizes)..      
-0002c750: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-0002c760: 6570 6c61 6365 5f77 6974 685f 6e65 775f  eplace_with_new_
-0002c770: 6469 6d73 280a 2020 2020 2020 2020 2020  dims(.          
-0002c780: 2020 7661 7269 6162 6c65 732c 2063 6f6f    variables, coo
-0002c790: 7264 5f6e 616d 6573 3d63 6f6f 7264 5f6e  rd_names=coord_n
-0002c7a0: 616d 6573 2c20 696e 6465 7865 733d 696e  ames, indexes=in
-0002c7b0: 6465 7865 730a 2020 2020 2020 2020 290a  dexes.        ).
-0002c7c0: 0a20 2020 2064 6566 2075 6e73 7461 636b  .    def unstack
-0002c7d0: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
-0002c7e0: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
-0002c7f0: 2020 2064 696d 3a20 4469 6d73 203d 204e     dim: Dims = N
-0002c800: 6f6e 652c 0a20 2020 2020 2020 2066 696c  one,.        fil
-0002c810: 6c5f 7661 6c75 653a 2041 6e79 203d 2078  l_value: Any = x
-0002c820: 7264 7479 7065 732e 4e41 2c0a 2020 2020  rdtypes.NA,.    
-0002c830: 2020 2020 7370 6172 7365 3a20 626f 6f6c      sparse: bool
-0002c840: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
-0002c850: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-0002c860: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0002c870: 2020 556e 7374 6163 6b20 6578 6973 7469    Unstack existi
-0002c880: 6e67 2064 696d 656e 7369 6f6e 7320 636f  ng dimensions co
-0002c890: 7272 6573 706f 6e64 696e 6720 746f 204d  rresponding to M
-0002c8a0: 756c 7469 496e 6465 7865 7320 696e 746f  ultiIndexes into
-0002c8b0: 0a20 2020 2020 2020 206d 756c 7469 706c  .        multipl
-0002c8c0: 6520 6e65 7720 6469 6d65 6e73 696f 6e73  e new dimensions
-0002c8d0: 2e0a 0a20 2020 2020 2020 204e 6577 2064  ...        New d
-0002c8e0: 696d 656e 7369 6f6e 7320 7769 6c6c 2062  imensions will b
-0002c8f0: 6520 6164 6465 6420 6174 2074 6865 2065  e added at the e
-0002c900: 6e64 2e0a 0a20 2020 2020 2020 2050 6172  nd...        Par
-0002c910: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-0002c920: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0002c930: 2020 2064 696d 203a 2073 7472 2c20 4974     dim : str, It
-0002c940: 6572 6162 6c65 206f 6620 4861 7368 6162  erable of Hashab
-0002c950: 6c65 206f 7220 4e6f 6e65 2c20 6f70 7469  le or None, opti
-0002c960: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-0002c970: 2044 696d 656e 7369 6f6e 2873 2920 6f76   Dimension(s) ov
-0002c980: 6572 2077 6869 6368 2074 6f20 756e 7374  er which to unst
-0002c990: 6163 6b2e 2042 7920 6465 6661 756c 7420  ack. By default 
-0002c9a0: 756e 7374 6163 6b73 2061 6c6c 0a20 2020  unstacks all.   
-0002c9b0: 2020 2020 2020 2020 204d 756c 7469 496e           MultiIn
-0002c9c0: 6465 7865 732e 0a20 2020 2020 2020 2066  dexes..        f
-0002c9d0: 696c 6c5f 7661 6c75 6520 3a20 7363 616c  ill_value : scal
-0002c9e0: 6172 206f 7220 6469 6374 2d6c 696b 652c  ar or dict-like,
-0002c9f0: 2064 6566 6175 6c74 3a20 6e61 6e0a 2020   default: nan.  
-0002ca00: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-0002ca10: 746f 2062 6520 6669 6c6c 6564 2e20 4966  to be filled. If
-0002ca20: 2061 2064 6963 742d 6c69 6b65 2c20 6d61   a dict-like, ma
-0002ca30: 7073 2076 6172 6961 626c 6520 6e61 6d65  ps variable name
-0002ca40: 7320 746f 0a20 2020 2020 2020 2020 2020  s to.           
-0002ca50: 2066 696c 6c20 7661 6c75 6573 2e20 4966   fill values. If
-0002ca60: 206e 6f74 2070 726f 7669 6465 6420 6f72   not provided or
-0002ca70: 2069 6620 7468 6520 6469 6374 2d6c 696b   if the dict-lik
-0002ca80: 6520 646f 6573 206e 6f74 0a20 2020 2020  e does not.     
-0002ca90: 2020 2020 2020 2063 6f6e 7461 696e 2061         contain a
-0002caa0: 6c6c 2076 6172 6961 626c 6573 2c20 7468  ll variables, th
-0002cab0: 6520 6474 7970 6527 7320 4e41 2076 616c  e dtype's NA val
-0002cac0: 7565 2077 696c 6c20 6265 2075 7365 642e  ue will be used.
-0002cad0: 0a20 2020 2020 2020 2073 7061 7273 6520  .        sparse 
-0002cae0: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
-0002caf0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-0002cb00: 2020 2075 7365 2073 7061 7273 652d 6172     use sparse-ar
-0002cb10: 7261 7920 6966 2054 7275 650a 0a20 2020  ray if True..   
-0002cb20: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-0002cb30: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-0002cb40: 2020 2020 2075 6e73 7461 636b 6564 203a       unstacked :
-0002cb50: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
-0002cb60: 2020 2020 2044 6174 6173 6574 2077 6974       Dataset wit
-0002cb70: 6820 756e 7374 6163 6b65 6420 6461 7461  h unstacked data
-0002cb80: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-0002cb90: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-0002cba0: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
-0002cbb0: 6173 6574 2e73 7461 636b 0a20 2020 2020  aset.stack.     
-0002cbc0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0002cbd0: 6966 2064 696d 2069 7320 4e6f 6e65 3a0a  if dim is None:.
-0002cbe0: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
-0002cbf0: 203d 206c 6973 7428 7365 6c66 2e64 696d   = list(self.dim
-0002cc00: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-0002cc10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002cc20: 6973 696e 7374 616e 6365 2864 696d 2c20  isinstance(dim, 
-0002cc30: 7374 7229 206f 7220 6e6f 7420 6973 696e  str) or not isin
-0002cc40: 7374 616e 6365 2864 696d 2c20 4974 6572  stance(dim, Iter
-0002cc50: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
-0002cc60: 2020 2020 2020 2064 696d 7320 3d20 5b64         dims = [d
-0002cc70: 696d 5d0a 2020 2020 2020 2020 2020 2020  im].            
-0002cc80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0002cc90: 2020 2020 2020 6469 6d73 203d 206c 6973        dims = lis
-0002cca0: 7428 6469 6d29 0a0a 2020 2020 2020 2020  t(dim)..        
-0002ccb0: 2020 2020 6d69 7373 696e 675f 6469 6d73      missing_dims
-0002ccc0: 203d 205b 6420 666f 7220 6420 696e 2064   = [d for d in d
-0002ccd0: 696d 7320 6966 2064 206e 6f74 2069 6e20  ims if d not in 
-0002cce0: 7365 6c66 2e64 696d 735d 0a20 2020 2020  self.dims].     
-0002ccf0: 2020 2020 2020 2069 6620 6d69 7373 696e         if missin
-0002cd00: 675f 6469 6d73 3a0a 2020 2020 2020 2020  g_dims:.        
-0002cd10: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002cd20: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0002cd30: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0002cd40: 4461 7461 7365 7420 646f 6573 206e 6f74  Dataset does not
-0002cd50: 2063 6f6e 7461 696e 2074 6865 2064 696d   contain the dim
-0002cd60: 656e 7369 6f6e 733a 207b 6d69 7373 696e  ensions: {missin
-0002cd70: 675f 6469 6d73 7d22 0a20 2020 2020 2020  g_dims}".       
-0002cd80: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0002cd90: 2020 2020 2320 6561 6368 2073 7065 6369      # each speci
-0002cda0: 6669 6564 2064 696d 656e 7369 6f6e 206d  fied dimension m
-0002cdb0: 7573 7420 6861 7665 2065 7861 6374 6c79  ust have exactly
-0002cdc0: 206f 6e65 206d 756c 7469 2d69 6e64 6578   one multi-index
-0002cdd0: 0a20 2020 2020 2020 2073 7461 636b 6564  .        stacked
-0002cde0: 5f69 6e64 6578 6573 3a20 6469 6374 5b41  _indexes: dict[A
-0002cdf0: 6e79 2c20 7475 706c 655b 496e 6465 782c  ny, tuple[Index,
-0002ce00: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
-0002ce10: 5661 7269 6162 6c65 5d5d 5d20 3d20 7b7d  Variable]]] = {}
-0002ce20: 0a20 2020 2020 2020 2066 6f72 2064 2069  .        for d i
-0002ce30: 6e20 6469 6d73 3a0a 2020 2020 2020 2020  n dims:.        
-0002ce40: 2020 2020 6964 782c 2069 6478 5f76 6172      idx, idx_var
-0002ce50: 7320 3d20 7365 6c66 2e5f 6765 745f 7374  s = self._get_st
-0002ce60: 6163 6b5f 696e 6465 7828 642c 206d 756c  ack_index(d, mul
-0002ce70: 7469 3d54 7275 6529 0a20 2020 2020 2020  ti=True).       
-0002ce80: 2020 2020 2069 6620 6964 7820 6973 206e       if idx is n
-0002ce90: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0002cea0: 2020 2020 2020 2020 2073 7461 636b 6564           stacked
-0002ceb0: 5f69 6e64 6578 6573 5b64 5d20 3d20 6964  _indexes[d] = id
-0002cec0: 782c 2069 6478 5f76 6172 730a 0a20 2020  x, idx_vars..   
-0002ced0: 2020 2020 2069 6620 6469 6d20 6973 204e       if dim is N
-0002cee0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002cef0: 2064 696d 7320 3d20 6c69 7374 2873 7461   dims = list(sta
-0002cf00: 636b 6564 5f69 6e64 6578 6573 290a 2020  cked_indexes).  
-0002cf10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002cf20: 2020 2020 2020 2020 6e6f 6e5f 6d75 6c74          non_mult
-0002cf30: 695f 6469 6d73 203d 2073 6574 2864 696d  i_dims = set(dim
-0002cf40: 7329 202d 2073 6574 2873 7461 636b 6564  s) - set(stacked
-0002cf50: 5f69 6e64 6578 6573 290a 2020 2020 2020  _indexes).      
-0002cf60: 2020 2020 2020 6966 206e 6f6e 5f6d 756c        if non_mul
-0002cf70: 7469 5f64 696d 733a 0a20 2020 2020 2020  ti_dims:.       
-0002cf80: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0002cf90: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0002cfa0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0002cfb0: 6361 6e6e 6f74 2075 6e73 7461 636b 2064  cannot unstack d
-0002cfc0: 696d 656e 7369 6f6e 7320 7468 6174 2064  imensions that d
-0002cfd0: 6f20 6e6f 7420 220a 2020 2020 2020 2020  o not ".        
-0002cfe0: 2020 2020 2020 2020 2020 2020 6622 6861              f"ha
-0002cff0: 7665 2065 7861 6374 6c79 206f 6e65 206d  ve exactly one m
-0002d000: 756c 7469 2d69 6e64 6578 3a20 7b74 7570  ulti-index: {tup
-0002d010: 6c65 286e 6f6e 5f6d 756c 7469 5f64 696d  le(non_multi_dim
-0002d020: 7329 7d22 0a20 2020 2020 2020 2020 2020  s)}".           
-0002d030: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0002d040: 7265 7375 6c74 203d 2073 656c 662e 636f  result = self.co
-0002d050: 7079 2864 6565 703d 4661 6c73 6529 0a0a  py(deep=False)..
-0002d060: 2020 2020 2020 2020 2320 7765 2077 616e          # we wan
-0002d070: 7420 746f 2061 766f 6964 2061 6c6c 6f63  t to avoid alloc
-0002d080: 6174 696e 6720 616e 206f 626a 6563 742d  ating an object-
-0002d090: 6474 7970 6520 6e64 6172 7261 7920 666f  dtype ndarray fo
-0002d0a0: 7220 6120 4d75 6c74 6949 6e64 6578 2c0a  r a MultiIndex,.
-0002d0b0: 2020 2020 2020 2020 2320 736f 2077 6520          # so we 
-0002d0c0: 6361 6e27 7420 6a75 7374 2061 6363 6573  can't just acces
-0002d0d0: 7320 7365 6c66 2e76 6172 6961 626c 6573  s self.variables
-0002d0e0: 5b76 5d2e 6461 7461 2066 6f72 2065 7665  [v].data for eve
-0002d0f0: 7279 2076 6172 6961 626c 652e 0a20 2020  ry variable..   
-0002d100: 2020 2020 2023 2057 6520 6f6e 6c79 2063       # We only c
-0002d110: 6865 636b 2074 6865 206e 6f6e 2d69 6e64  heck the non-ind
-0002d120: 6578 2076 6172 6961 626c 6573 2e0a 2020  ex variables..  
-0002d130: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
-0002d140: 6769 7468 7562 2e63 6f6d 2f70 7964 6174  github.com/pydat
-0002d150: 612f 7861 7272 6179 2f69 7373 7565 732f  a/xarray/issues/
-0002d160: 3539 3032 0a20 2020 2020 2020 206e 6f6e  5902.        non
-0002d170: 696e 6465 7865 7320 3d20 5b0a 2020 2020  indexes = [.    
-0002d180: 2020 2020 2020 2020 7365 6c66 2e76 6172          self.var
-0002d190: 6961 626c 6573 5b6b 5d20 666f 7220 6b20  iables[k] for k 
-0002d1a0: 696e 2073 6574 2873 656c 662e 7661 7269  in set(self.vari
-0002d1b0: 6162 6c65 7329 202d 2073 6574 2873 656c  ables) - set(sel
-0002d1c0: 662e 5f69 6e64 6578 6573 290a 2020 2020  f._indexes).    
-0002d1d0: 2020 2020 5d0a 2020 2020 2020 2020 2320      ].        # 
-0002d1e0: 4e6f 7465 7320 666f 7220 6561 6368 206f  Notes for each o
-0002d1f0: 6620 7468 6573 6520 6361 7365 733a 0a20  f these cases:. 
-0002d200: 2020 2020 2020 2023 2031 2e20 4461 736b         # 1. Dask
-0002d210: 2061 7272 6179 7320 646f 6e27 7420 7375   arrays don't su
-0002d220: 7070 6f72 7420 6173 7369 676e 6d65 6e74  pport assignment
-0002d230: 2062 7920 696e 6465 782c 2077 6869 6368   by index, which
-0002d240: 2074 6865 2066 6173 7420 756e 7374 6163   the fast unstac
-0002d250: 6b0a 2020 2020 2020 2020 2320 2020 2066  k.        #    f
-0002d260: 756e 6374 696f 6e20 7265 7175 6972 6573  unction requires
-0002d270: 2e0a 2020 2020 2020 2020 2320 2020 2068  ..        #    h
-0002d280: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-0002d290: 6d2f 7079 6461 7461 2f78 6172 7261 792f  m/pydata/xarray/
-0002d2a0: 7075 6c6c 2f34 3734 3623 6973 7375 6563  pull/4746#issuec
-0002d2b0: 6f6d 6d65 6e74 2d37 3533 3238 3231 3235  omment-753282125
-0002d2c0: 0a20 2020 2020 2020 2023 2032 2e20 5370  .        # 2. Sp
-0002d2d0: 6172 7365 2064 6f65 736e 2774 2063 7572  arse doesn't cur
-0002d2e0: 7265 6e74 6c79 2073 7570 706f 7274 2028  rently support (
-0002d2f0: 7468 6f75 6768 2077 6520 636f 756c 6420  though we could 
-0002d300: 7370 6563 6961 6c2d 6361 7365 2069 7429  special-case it)
-0002d310: 0a20 2020 2020 2020 2023 2020 2020 6874  .        #    ht
-0002d320: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-0002d330: 2f70 7964 6174 612f 7370 6172 7365 2f69  /pydata/sparse/i
-0002d340: 7373 7565 732f 3432 320a 2020 2020 2020  ssues/422.      
-0002d350: 2020 2320 332e 2070 696e 7420 7265 7175    # 3. pint requ
-0002d360: 6972 6573 2063 6865 636b 696e 6720 6966  ires checking if
-0002d370: 2069 7427 7320 6120 4e75 6d50 7920 6172   it's a NumPy ar
-0002d380: 7261 7920 756e 7469 6c0a 2020 2020 2020  ray until.      
-0002d390: 2020 2320 2020 2068 7474 7073 3a2f 2f67    #    https://g
-0002d3a0: 6974 6875 622e 636f 6d2f 7079 6461 7461  ithub.com/pydata
-0002d3b0: 2f78 6172 7261 792f 7075 6c6c 2f34 3735  /xarray/pull/475
-0002d3c0: 3120 6973 2072 6573 6f6c 7665 642c 0a20  1 is resolved,. 
-0002d3d0: 2020 2020 2020 2023 2020 2020 4f6e 6365         #    Once
-0002d3e0: 2074 6861 7420 6973 2072 6573 6f6c 7665   that is resolve
-0002d3f0: 642c 2065 7870 6c69 6369 746c 7920 6578  d, explicitly ex
-0002d400: 636c 7564 6520 7069 6e74 2061 7272 6179  clude pint array
-0002d410: 732e 0a20 2020 2020 2020 2023 2020 2020  s..        #    
-0002d420: 7069 6e74 2064 6f65 736e 2774 2069 6d70  pint doesn't imp
-0002d430: 6c65 6d65 6e74 2060 6e70 2e66 756c 6c5f  lement `np.full_
-0002d440: 6c69 6b65 6020 696e 2061 2077 6179 2074  like` in a way t
-0002d450: 6861 7427 730a 2020 2020 2020 2020 2320  hat's.        # 
-0002d460: 2020 2063 7572 7265 6e74 6c79 2063 6f6d     currently com
-0002d470: 7061 7469 626c 652e 0a20 2020 2020 2020  patible..       
-0002d480: 2073 7061 7273 655f 6172 7261 795f 7479   sparse_array_ty
-0002d490: 7065 203d 2061 7272 6179 5f74 7970 6528  pe = array_type(
-0002d4a0: 2273 7061 7273 6522 290a 2020 2020 2020  "sparse").      
-0002d4b0: 2020 6e65 6564 735f 6675 6c6c 5f72 6569    needs_full_rei
-0002d4c0: 6e64 6578 203d 2061 6e79 280a 2020 2020  ndex = any(.    
-0002d4d0: 2020 2020 2020 2020 6973 5f64 7563 6b5f          is_duck_
-0002d4e0: 6461 736b 5f61 7272 6179 2876 2e64 6174  dask_array(v.dat
-0002d4f0: 6129 0a20 2020 2020 2020 2020 2020 206f  a).            o
-0002d500: 7220 6973 696e 7374 616e 6365 2876 2e64  r isinstance(v.d
-0002d510: 6174 612c 2073 7061 7273 655f 6172 7261  ata, sparse_arra
-0002d520: 795f 7479 7065 290a 2020 2020 2020 2020  y_type).        
-0002d530: 2020 2020 6f72 206e 6f74 2069 7369 6e73      or not isins
-0002d540: 7461 6e63 6528 762e 6461 7461 2c20 6e70  tance(v.data, np
-0002d550: 2e6e 6461 7272 6179 290a 2020 2020 2020  .ndarray).      
-0002d560: 2020 2020 2020 666f 7220 7620 696e 206e        for v in n
-0002d570: 6f6e 696e 6465 7865 730a 2020 2020 2020  onindexes.      
-0002d580: 2020 290a 0a20 2020 2020 2020 2066 6f72    )..        for
-0002d590: 2064 2069 6e20 6469 6d73 3a0a 2020 2020   d in dims:.    
-0002d5a0: 2020 2020 2020 2020 6966 206e 6565 6473          if needs
-0002d5b0: 5f66 756c 6c5f 7265 696e 6465 783a 0a20  _full_reindex:. 
-0002d5c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002d5d0: 6573 756c 7420 3d20 7265 7375 6c74 2e5f  esult = result._
-0002d5e0: 756e 7374 6163 6b5f 6675 6c6c 5f72 6569  unstack_full_rei
-0002d5f0: 6e64 6578 280a 2020 2020 2020 2020 2020  ndex(.          
-0002d600: 2020 2020 2020 2020 2020 642c 2073 7461            d, sta
-0002d610: 636b 6564 5f69 6e64 6578 6573 5b64 5d2c  cked_indexes[d],
-0002d620: 2066 696c 6c5f 7661 6c75 652c 2073 7061   fill_value, spa
-0002d630: 7273 650a 2020 2020 2020 2020 2020 2020  rse.            
-0002d640: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0002d650: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002d660: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0002d670: 2072 6573 756c 742e 5f75 6e73 7461 636b   result._unstack
-0002d680: 5f6f 6e63 6528 642c 2073 7461 636b 6564  _once(d, stacked
-0002d690: 5f69 6e64 6578 6573 5b64 5d2c 2066 696c  _indexes[d], fil
-0002d6a0: 6c5f 7661 6c75 652c 2073 7061 7273 6529  l_value, sparse)
-0002d6b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0002d6c0: 7265 7375 6c74 0a0a 2020 2020 6465 6620  result..    def 
-0002d6d0: 7570 6461 7465 2873 656c 663a 2054 5f44  update(self: T_D
-0002d6e0: 6174 6173 6574 2c20 6f74 6865 723a 2043  ataset, other: C
-0002d6f0: 6f65 7263 6962 6c65 4d61 7070 696e 6729  oercibleMapping)
-0002d700: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
-0002d710: 2020 2020 2020 2022 2222 5570 6461 7465         """Update
-0002d720: 2074 6869 7320 6461 7461 7365 7427 7320   this dataset's 
-0002d730: 7661 7269 6162 6c65 7320 7769 7468 2074  variables with t
-0002d740: 686f 7365 2066 726f 6d20 616e 6f74 6865  hose from anothe
-0002d750: 7220 6461 7461 7365 742e 0a0a 2020 2020  r dataset...    
-0002d760: 2020 2020 4a75 7374 206c 696b 6520 3a70      Just like :p
-0002d770: 793a 6d65 7468 3a60 6469 6374 2e75 7064  y:meth:`dict.upd
-0002d780: 6174 6560 2074 6869 7320 6973 2061 2069  ate` this is a i
-0002d790: 6e2d 706c 6163 6520 6f70 6572 6174 696f  n-place operatio
-0002d7a0: 6e2e 0a20 2020 2020 2020 2046 6f72 2061  n..        For a
-0002d7b0: 206e 6f6e 2d69 6e70 6c61 6365 2076 6572   non-inplace ver
-0002d7c0: 7369 6f6e 2c20 7365 6520 3a70 793a 6d65  sion, see :py:me
-0002d7d0: 7468 3a60 4461 7461 7365 742e 6d65 7267  th:`Dataset.merg
-0002d7e0: 6560 2e0a 0a20 2020 2020 2020 2050 6172  e`...        Par
-0002d7f0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-0002d800: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0002d810: 2020 206f 7468 6572 203a 2044 6174 6173     other : Datas
-0002d820: 6574 206f 7220 6d61 7070 696e 670a 2020  et or mapping.  
-0002d830: 2020 2020 2020 2020 2020 5661 7269 6162            Variab
-0002d840: 6c65 7320 7769 7468 2077 6869 6368 2074  les with which t
-0002d850: 6f20 7570 6461 7465 2074 6869 7320 6461  o update this da
-0002d860: 7461 7365 742e 204f 6e65 206f 663a 0a0a  taset. One of:..
-0002d870: 2020 2020 2020 2020 2020 2020 2d20 4461              - Da
-0002d880: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
-0002d890: 2020 2d20 6d61 7070 696e 6720 7b76 6172    - mapping {var
-0002d8a0: 206e 616d 653a 2044 6174 6141 7272 6179   name: DataArray
-0002d8b0: 7d0a 2020 2020 2020 2020 2020 2020 2d20  }.            - 
-0002d8c0: 6d61 7070 696e 6720 7b76 6172 206e 616d  mapping {var nam
-0002d8d0: 653a 2056 6172 6961 626c 657d 0a20 2020  e: Variable}.   
-0002d8e0: 2020 2020 2020 2020 202d 206d 6170 7069           - mappi
-0002d8f0: 6e67 207b 7661 7220 6e61 6d65 3a20 2864  ng {var name: (d
-0002d900: 696d 656e 7369 6f6e 206e 616d 652c 2061  imension name, a
-0002d910: 7272 6179 2d6c 696b 6529 7d0a 2020 2020  rray-like)}.    
-0002d920: 2020 2020 2020 2020 2d20 6d61 7070 696e          - mappin
-0002d930: 6720 7b76 6172 206e 616d 653a 2028 7475  g {var name: (tu
-0002d940: 706c 6520 6f66 2064 696d 656e 7369 6f6e  ple of dimension
-0002d950: 206e 616d 6573 2c20 6172 7261 792d 6c69   names, array-li
-0002d960: 6b65 297d 0a0a 2020 2020 2020 2020 5265  ke)}..        Re
-0002d970: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-0002d980: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7570  -----.        up
-0002d990: 6461 7465 6420 3a20 4461 7461 7365 740a  dated : Dataset.
-0002d9a0: 2020 2020 2020 2020 2020 2020 5570 6461              Upda
-0002d9b0: 7465 6420 6461 7461 7365 742e 204e 6f74  ted dataset. Not
-0002d9c0: 6520 7468 6174 2073 696e 6365 2074 6865  e that since the
-0002d9d0: 2075 7064 6174 6520 6973 2069 6e2d 706c   update is in-pl
-0002d9e0: 6163 6520 7468 6973 2069 7320 7468 6520  ace this is the 
-0002d9f0: 696e 7075 740a 2020 2020 2020 2020 2020  input.          
-0002da00: 2020 6461 7461 7365 742e 0a0a 2020 2020    dataset...    
-0002da10: 2020 2020 2020 2020 4974 2069 7320 6465          It is de
-0002da20: 7072 6563 6174 6564 2073 696e 6365 2076  precated since v
-0002da30: 6572 7369 6f6e 2030 2e31 3720 616e 6420  ersion 0.17 and 
-0002da40: 7363 6865 6475 6c65 6420 746f 2062 6520  scheduled to be 
-0002da50: 7265 6d6f 7665 6420 696e 2030 2e32 312e  removed in 0.21.
-0002da60: 0a0a 2020 2020 2020 2020 5261 6973 6573  ..        Raises
-0002da70: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d0a  .        ------.
-0002da80: 2020 2020 2020 2020 5661 6c75 6545 7272          ValueErr
-0002da90: 6f72 0a20 2020 2020 2020 2020 2020 2049  or.            I
-0002daa0: 6620 616e 7920 6469 6d65 6e73 696f 6e73  f any dimensions
-0002dab0: 2077 6f75 6c64 2068 6176 6520 696e 636f   would have inco
-0002dac0: 6e73 6973 7465 6e74 2073 697a 6573 2069  nsistent sizes i
-0002dad0: 6e20 7468 6520 7570 6461 7465 640a 2020  n the updated.  
-0002dae0: 2020 2020 2020 2020 2020 6461 7461 7365            datase
-0002daf0: 742e 0a0a 2020 2020 2020 2020 5365 6520  t...        See 
-0002db00: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-0002db10: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
-0002db20: 7461 7365 742e 6173 7369 676e 0a20 2020  taset.assign.   
-0002db30: 2020 2020 2044 6174 6173 6574 2e6d 6572       Dataset.mer
-0002db40: 6765 0a20 2020 2020 2020 2022 2222 0a20  ge.        """. 
-0002db50: 2020 2020 2020 206d 6572 6765 5f72 6573         merge_res
-0002db60: 756c 7420 3d20 6461 7461 7365 745f 7570  ult = dataset_up
-0002db70: 6461 7465 5f6d 6574 686f 6428 7365 6c66  date_method(self
-0002db80: 2c20 6f74 6865 7229 0a20 2020 2020 2020  , other).       
-0002db90: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-0002dba0: 706c 6163 6528 696e 706c 6163 653d 5472  place(inplace=Tr
-0002dbb0: 7565 2c20 2a2a 6d65 7267 655f 7265 7375  ue, **merge_resu
-0002dbc0: 6c74 2e5f 6173 6469 6374 2829 290a 0a20  lt._asdict()).. 
-0002dbd0: 2020 2064 6566 206d 6572 6765 280a 2020     def merge(.  
-0002dbe0: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
-0002dbf0: 7461 7365 742c 0a20 2020 2020 2020 206f  taset,.        o
-0002dc00: 7468 6572 3a20 436f 6572 6369 626c 654d  ther: CoercibleM
-0002dc10: 6170 7069 6e67 207c 2044 6174 6141 7272  apping | DataArr
-0002dc20: 6179 2c0a 2020 2020 2020 2020 6f76 6572  ay,.        over
-0002dc30: 7772 6974 655f 7661 7273 3a20 4861 7368  write_vars: Hash
-0002dc40: 6162 6c65 207c 2049 7465 7261 626c 655b  able | Iterable[
-0002dc50: 4861 7368 6162 6c65 5d20 3d20 6672 6f7a  Hashable] = froz
-0002dc60: 656e 7365 7428 292c 0a20 2020 2020 2020  enset(),.       
-0002dc70: 2063 6f6d 7061 743a 2043 6f6d 7061 744f   compat: CompatO
-0002dc80: 7074 696f 6e73 203d 2022 6e6f 5f63 6f6e  ptions = "no_con
-0002dc90: 666c 6963 7473 222c 0a20 2020 2020 2020  flicts",.       
-0002dca0: 206a 6f69 6e3a 204a 6f69 6e4f 7074 696f   join: JoinOptio
-0002dcb0: 6e73 203d 2022 6f75 7465 7222 2c0a 2020  ns = "outer",.  
-0002dcc0: 2020 2020 2020 6669 6c6c 5f76 616c 7565        fill_value
-0002dcd0: 3a20 416e 7920 3d20 7872 6474 7970 6573  : Any = xrdtypes
-0002dce0: 2e4e 412c 0a20 2020 2020 2020 2063 6f6d  .NA,.        com
-0002dcf0: 6269 6e65 5f61 7474 7273 3a20 436f 6d62  bine_attrs: Comb
-0002dd00: 696e 6541 7474 7273 4f70 7469 6f6e 7320  ineAttrsOptions 
-0002dd10: 3d20 226f 7665 7272 6964 6522 2c0a 2020  = "override",.  
-0002dd20: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-0002dd30: 3a0a 2020 2020 2020 2020 2222 224d 6572  :.        """Mer
-0002dd40: 6765 2074 6865 2061 7272 6179 7320 6f66  ge the arrays of
-0002dd50: 2074 776f 2064 6174 6173 6574 7320 696e   two datasets in
-0002dd60: 746f 2061 2073 696e 676c 6520 6461 7461  to a single data
-0002dd70: 7365 742e 0a0a 2020 2020 2020 2020 5468  set...        Th
-0002dd80: 6973 206d 6574 686f 6420 6765 6e65 7261  is method genera
-0002dd90: 6c6c 7920 646f 6573 206e 6f74 2061 6c6c  lly does not all
-0002dda0: 6f77 2066 6f72 206f 7665 7272 6964 696e  ow for overridin
-0002ddb0: 6720 6461 7461 2c20 7769 7468 2074 6865  g data, with the
-0002ddc0: 0a20 2020 2020 2020 2065 7863 6570 7469  .        excepti
-0002ddd0: 6f6e 206f 6620 6174 7472 6962 7574 6573  on of attributes
-0002dde0: 2c20 7768 6963 6820 6172 6520 6967 6e6f  , which are igno
-0002ddf0: 7265 6420 6f6e 2074 6865 2073 6563 6f6e  red on the secon
-0002de00: 6420 6461 7461 7365 742e 0a20 2020 2020  d dataset..     
-0002de10: 2020 2056 6172 6961 626c 6573 2077 6974     Variables wit
-0002de20: 6820 7468 6520 7361 6d65 206e 616d 6520  h the same name 
-0002de30: 6172 6520 6368 6563 6b65 6420 666f 7220  are checked for 
-0002de40: 636f 6e66 6c69 6374 7320 7669 6120 7468  conflicts via th
-0002de50: 6520 6571 7561 6c73 0a20 2020 2020 2020  e equals.       
-0002de60: 206f 7220 6964 656e 7469 6361 6c20 6d65   or identical me
-0002de70: 7468 6f64 732e 0a0a 2020 2020 2020 2020  thods...        
-0002de80: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0002de90: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0002dea0: 2020 2020 2020 6f74 6865 7220 3a20 4461        other : Da
-0002deb0: 7461 7365 7420 6f72 206d 6170 7069 6e67  taset or mapping
-0002dec0: 0a20 2020 2020 2020 2020 2020 2044 6174  .            Dat
-0002ded0: 6173 6574 206f 7220 7661 7269 6162 6c65  aset or variable
-0002dee0: 7320 746f 206d 6572 6765 2077 6974 6820  s to merge with 
-0002def0: 7468 6973 2064 6174 6173 6574 2e0a 2020  this dataset..  
-0002df00: 2020 2020 2020 6f76 6572 7772 6974 655f        overwrite_
-0002df10: 7661 7273 203a 2068 6173 6861 626c 6520  vars : hashable 
-0002df20: 6f72 2069 7465 7261 626c 6520 6f66 2068  or iterable of h
-0002df30: 6173 6861 626c 652c 206f 7074 696f 6e61  ashable, optiona
-0002df40: 6c0a 2020 2020 2020 2020 2020 2020 4966  l.            If
-0002df50: 2070 726f 7669 6465 642c 2075 7064 6174   provided, updat
-0002df60: 6520 7661 7269 6162 6c65 7320 6f66 2074  e variables of t
-0002df70: 6865 7365 206e 616d 6528 7329 2077 6974  hese name(s) wit
-0002df80: 686f 7574 2063 6865 636b 696e 6720 666f  hout checking fo
-0002df90: 720a 2020 2020 2020 2020 2020 2020 636f  r.            co
-0002dfa0: 6e66 6c69 6374 7320 696e 2074 6869 7320  nflicts in this 
-0002dfb0: 6461 7461 7365 742e 0a20 2020 2020 2020  dataset..       
-0002dfc0: 2063 6f6d 7061 7420 3a20 7b22 6964 656e   compat : {"iden
-0002dfd0: 7469 6361 6c22 2c20 2265 7175 616c 7322  tical", "equals"
-0002dfe0: 2c20 2262 726f 6164 6361 7374 5f65 7175  , "broadcast_equ
-0002dff0: 616c 7322 2c20 5c0a 2020 2020 2020 2020  als", \.        
-0002e000: 2020 2020 2020 2020 2020 226e 6f5f 636f            "no_co
-0002e010: 6e66 6c69 6374 7322 2c20 226f 7665 7272  nflicts", "overr
-0002e020: 6964 6522 2c20 226d 696e 696d 616c 227d  ide", "minimal"}
-0002e030: 2c20 6465 6661 756c 743a 2022 6e6f 5f63  , default: "no_c
-0002e040: 6f6e 666c 6963 7473 220a 2020 2020 2020  onflicts".      
-0002e050: 2020 2020 2020 5374 7269 6e67 2069 6e64        String ind
-0002e060: 6963 6174 696e 6720 686f 7720 746f 2063  icating how to c
-0002e070: 6f6d 7061 7265 2076 6172 6961 626c 6573  ompare variables
-0002e080: 206f 6620 7468 6520 7361 6d65 206e 616d   of the same nam
-0002e090: 6520 666f 720a 2020 2020 2020 2020 2020  e for.          
-0002e0a0: 2020 706f 7465 6e74 6961 6c20 636f 6e66    potential conf
-0002e0b0: 6c69 6374 733a 0a0a 2020 2020 2020 2020  licts:..        
-0002e0c0: 2020 2020 2d20 2769 6465 6e74 6963 616c      - 'identical
-0002e0d0: 273a 2061 6c6c 2076 616c 7565 732c 2064  ': all values, d
-0002e0e0: 696d 656e 7369 6f6e 7320 616e 6420 6174  imensions and at
-0002e0f0: 7472 6962 7574 6573 206d 7573 7420 6265  tributes must be
-0002e100: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-0002e110: 2020 2073 616d 652e 0a20 2020 2020 2020     same..       
-0002e120: 2020 2020 202d 2027 6571 7561 6c73 273a       - 'equals':
-0002e130: 2061 6c6c 2076 616c 7565 7320 616e 6420   all values and 
-0002e140: 6469 6d65 6e73 696f 6e73 206d 7573 7420  dimensions must 
-0002e150: 6265 2074 6865 2073 616d 652e 0a20 2020  be the same..   
-0002e160: 2020 2020 2020 2020 202d 2027 6272 6f61           - 'broa
-0002e170: 6463 6173 745f 6571 7561 6c73 273a 2061  dcast_equals': a
-0002e180: 6c6c 2076 616c 7565 7320 6d75 7374 2062  ll values must b
-0002e190: 6520 6571 7561 6c20 7768 656e 2076 6172  e equal when var
-0002e1a0: 6961 626c 6573 2061 7265 0a20 2020 2020  iables are.     
-0002e1b0: 2020 2020 2020 2020 2062 726f 6164 6361           broadca
-0002e1c0: 7374 2061 6761 696e 7374 2065 6163 6820  st against each 
-0002e1d0: 6f74 6865 7220 746f 2065 6e73 7572 6520  other to ensure 
-0002e1e0: 636f 6d6d 6f6e 2064 696d 656e 7369 6f6e  common dimension
-0002e1f0: 732e 0a20 2020 2020 2020 2020 2020 202d  s..            -
-0002e200: 2027 6e6f 5f63 6f6e 666c 6963 7473 273a   'no_conflicts':
-0002e210: 206f 6e6c 7920 7661 6c75 6573 2077 6869   only values whi
-0002e220: 6368 2061 7265 206e 6f74 206e 756c 6c20  ch are not null 
-0002e230: 696e 2062 6f74 6820 6461 7461 7365 7473  in both datasets
-0002e240: 0a20 2020 2020 2020 2020 2020 2020 206d  .              m
-0002e250: 7573 7420 6265 2065 7175 616c 2e20 5468  ust be equal. Th
-0002e260: 6520 7265 7475 726e 6564 2064 6174 6173  e returned datas
-0002e270: 6574 2074 6865 6e20 636f 6e74 6169 6e73  et then contains
-0002e280: 2074 6865 2063 6f6d 6269 6e61 7469 6f6e   the combination
-0002e290: 0a20 2020 2020 2020 2020 2020 2020 206f  .              o
-0002e2a0: 6620 616c 6c20 6e6f 6e2d 6e75 6c6c 2076  f all non-null v
-0002e2b0: 616c 7565 732e 0a20 2020 2020 2020 2020  alues..         
-0002e2c0: 2020 202d 2027 6f76 6572 7269 6465 273a     - 'override':
-0002e2d0: 2073 6b69 7020 636f 6d70 6172 696e 6720   skip comparing 
-0002e2e0: 616e 6420 7069 636b 2076 6172 6961 626c  and pick variabl
-0002e2f0: 6520 6672 6f6d 2066 6972 7374 2064 6174  e from first dat
-0002e300: 6173 6574 0a20 2020 2020 2020 2020 2020  aset.           
-0002e310: 202d 2027 6d69 6e69 6d61 6c27 3a20 6472   - 'minimal': dr
-0002e320: 6f70 2063 6f6e 666c 6963 7469 6e67 2063  op conflicting c
-0002e330: 6f6f 7264 696e 6174 6573 0a0a 2020 2020  oordinates..    
-0002e340: 2020 2020 6a6f 696e 203a 207b 226f 7574      join : {"out
-0002e350: 6572 222c 2022 696e 6e65 7222 2c20 226c  er", "inner", "l
-0002e360: 6566 7422 2c20 2272 6967 6874 222c 2022  eft", "right", "
-0002e370: 6578 6163 7422 2c20 226f 7665 7272 6964  exact", "overrid
-0002e380: 6522 7d2c 205c 0a20 2020 2020 2020 2020  e"}, \.         
-0002e390: 2020 2020 2020 6465 6661 756c 743a 2022        default: "
-0002e3a0: 6f75 7465 7222 0a20 2020 2020 2020 2020  outer".         
-0002e3b0: 2020 204d 6574 686f 6420 666f 7220 6a6f     Method for jo
-0002e3c0: 696e 696e 6720 6060 7365 6c66 6060 2061  ining ``self`` a
-0002e3d0: 6e64 2060 606f 7468 6572 6060 2061 6c6f  nd ``other`` alo
-0002e3e0: 6e67 2073 6861 7265 6420 6469 6d65 6e73  ng shared dimens
-0002e3f0: 696f 6e73 3a0a 0a20 2020 2020 2020 2020  ions:..         
-0002e400: 2020 202d 2027 6f75 7465 7227 3a20 7573     - 'outer': us
-0002e410: 6520 7468 6520 756e 696f 6e20 6f66 2074  e the union of t
-0002e420: 6865 2069 6e64 6578 6573 0a20 2020 2020  he indexes.     
-0002e430: 2020 2020 2020 202d 2027 696e 6e65 7227         - 'inner'
-0002e440: 3a20 7573 6520 7468 6520 696e 7465 7273  : use the inters
-0002e450: 6563 7469 6f6e 206f 6620 7468 6520 696e  ection of the in
-0002e460: 6465 7865 730a 2020 2020 2020 2020 2020  dexes.          
-0002e470: 2020 2d20 276c 6566 7427 3a20 7573 6520    - 'left': use 
-0002e480: 696e 6465 7865 7320 6672 6f6d 2060 6073  indexes from ``s
-0002e490: 656c 6660 600a 2020 2020 2020 2020 2020  elf``.          
-0002e4a0: 2020 2d20 2772 6967 6874 273a 2075 7365    - 'right': use
-0002e4b0: 2069 6e64 6578 6573 2066 726f 6d20 6060   indexes from ``
-0002e4c0: 6f74 6865 7260 600a 2020 2020 2020 2020  other``.        
-0002e4d0: 2020 2020 2d20 2765 7861 6374 273a 2065      - 'exact': e
-0002e4e0: 7272 6f72 2069 6e73 7465 6164 206f 6620  rror instead of 
-0002e4f0: 616c 6967 6e69 6e67 206e 6f6e 2d65 7175  aligning non-equ
-0002e500: 616c 2069 6e64 6578 6573 0a20 2020 2020  al indexes.     
-0002e510: 2020 2020 2020 202d 2027 6f76 6572 7269         - 'overri
-0002e520: 6465 273a 2075 7365 2069 6e64 6578 6573  de': use indexes
-0002e530: 2066 726f 6d20 6060 7365 6c66 6060 2074   from ``self`` t
-0002e540: 6861 7420 6172 6520 7468 6520 7361 6d65  hat are the same
-0002e550: 2073 697a 650a 2020 2020 2020 2020 2020   size.          
-0002e560: 2020 2020 6173 2074 686f 7365 206f 6620      as those of 
-0002e570: 6060 6f74 6865 7260 6020 696e 2074 6861  ``other`` in tha
-0002e580: 7420 6469 6d65 6e73 696f 6e0a 0a20 2020  t dimension..   
-0002e590: 2020 2020 2066 696c 6c5f 7661 6c75 6520       fill_value 
-0002e5a0: 3a20 7363 616c 6172 206f 7220 6469 6374  : scalar or dict
-0002e5b0: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
-0002e5c0: 2020 2020 2020 2020 2020 2020 5661 6c75              Valu
-0002e5d0: 6520 746f 2075 7365 2066 6f72 206e 6577  e to use for new
-0002e5e0: 6c79 206d 6973 7369 6e67 2076 616c 7565  ly missing value
-0002e5f0: 732e 2049 6620 6120 6469 6374 2d6c 696b  s. If a dict-lik
-0002e600: 652c 206d 6170 730a 2020 2020 2020 2020  e, maps.        
-0002e610: 2020 2020 7661 7269 6162 6c65 206e 616d      variable nam
-0002e620: 6573 2028 696e 636c 7564 696e 6720 636f  es (including co
-0002e630: 6f72 6469 6e61 7465 7329 2074 6f20 6669  ordinates) to fi
-0002e640: 6c6c 2076 616c 7565 732e 0a20 2020 2020  ll values..     
-0002e650: 2020 2063 6f6d 6269 6e65 5f61 7474 7273     combine_attrs
-0002e660: 203a 207b 2264 726f 7022 2c20 2269 6465   : {"drop", "ide
-0002e670: 6e74 6963 616c 222c 2022 6e6f 5f63 6f6e  ntical", "no_con
-0002e680: 666c 6963 7473 222c 2022 6472 6f70 5f63  flicts", "drop_c
-0002e690: 6f6e 666c 6963 7473 222c 205c 0a20 2020  onflicts", \.   
-0002e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e6b0: 2020 2020 2020 226f 7665 7272 6964 6522        "override"
-0002e6c0: 7d20 6f72 2063 616c 6c61 626c 652c 2064  } or callable, d
-0002e6d0: 6566 6175 6c74 3a20 226f 7665 7272 6964  efault: "overrid
-0002e6e0: 6522 0a20 2020 2020 2020 2020 2020 2041  e".            A
-0002e6f0: 2063 616c 6c61 626c 6520 6f72 2061 2073   callable or a s
-0002e700: 7472 696e 6720 696e 6469 6361 7469 6e67  tring indicating
-0002e710: 2068 6f77 2074 6f20 636f 6d62 696e 6520   how to combine 
-0002e720: 6174 7472 7320 6f66 2074 6865 206f 626a  attrs of the obj
-0002e730: 6563 7473 2062 6569 6e67 0a20 2020 2020  ects being.     
-0002e740: 2020 2020 2020 206d 6572 6765 643a 0a0a         merged:..
-0002e750: 2020 2020 2020 2020 2020 2020 2d20 2264              - "d
-0002e760: 726f 7022 3a20 656d 7074 7920 6174 7472  rop": empty attr
-0002e770: 7320 6f6e 2072 6574 7572 6e65 6420 4461  s on returned Da
-0002e780: 7461 7365 742e 0a20 2020 2020 2020 2020  taset..         
-0002e790: 2020 202d 2022 6964 656e 7469 6361 6c22     - "identical"
-0002e7a0: 3a20 616c 6c20 6174 7472 7320 6d75 7374  : all attrs must
-0002e7b0: 2062 6520 7468 6520 7361 6d65 206f 6e20   be the same on 
-0002e7c0: 6576 6572 7920 6f62 6a65 6374 2e0a 2020  every object..  
-0002e7d0: 2020 2020 2020 2020 2020 2d20 226e 6f5f            - "no_
-0002e7e0: 636f 6e66 6c69 6374 7322 3a20 6174 7472  conflicts": attr
-0002e7f0: 7320 6672 6f6d 2061 6c6c 206f 626a 6563  s from all objec
-0002e800: 7473 2061 7265 2063 6f6d 6269 6e65 642c  ts are combined,
-0002e810: 2061 6e79 2074 6861 7420 6861 7665 0a20   any that have. 
-0002e820: 2020 2020 2020 2020 2020 2020 2074 6865               the
-0002e830: 2073 616d 6520 6e61 6d65 206d 7573 7420   same name must 
-0002e840: 616c 736f 2068 6176 6520 7468 6520 7361  also have the sa
-0002e850: 6d65 2076 616c 7565 2e0a 2020 2020 2020  me value..      
-0002e860: 2020 2020 2020 2d20 2264 726f 705f 636f        - "drop_co
-0002e870: 6e66 6c69 6374 7322 3a20 6174 7472 7320  nflicts": attrs 
-0002e880: 6672 6f6d 2061 6c6c 206f 626a 6563 7473  from all objects
-0002e890: 2061 7265 2063 6f6d 6269 6e65 642c 2061   are combined, a
-0002e8a0: 6e79 2074 6861 7420 6861 7665 0a20 2020  ny that have.   
-0002e8b0: 2020 2020 2020 2020 2020 2074 6865 2073             the s
-0002e8c0: 616d 6520 6e61 6d65 2062 7574 2064 6966  ame name but dif
-0002e8d0: 6665 7265 6e74 2076 616c 7565 7320 6172  ferent values ar
-0002e8e0: 6520 6472 6f70 7065 642e 0a20 2020 2020  e dropped..     
-0002e8f0: 2020 2020 2020 202d 2022 6f76 6572 7269         - "overri
-0002e900: 6465 223a 2073 6b69 7020 636f 6d70 6172  de": skip compar
-0002e910: 696e 6720 616e 6420 636f 7079 2061 7474  ing and copy att
-0002e920: 7273 2066 726f 6d20 7468 6520 6669 7273  rs from the firs
-0002e930: 7420 6461 7461 7365 7420 746f 0a20 2020  t dataset to.   
-0002e940: 2020 2020 2020 2020 2020 2074 6865 2072             the r
-0002e950: 6573 756c 742e 0a0a 2020 2020 2020 2020  esult...        
-0002e960: 2020 2020 4966 2061 2063 616c 6c61 626c      If a callabl
-0002e970: 652c 2069 7420 6d75 7374 2065 7870 6563  e, it must expec
-0002e980: 7420 6120 7365 7175 656e 6365 206f 6620  t a sequence of 
-0002e990: 6060 6174 7472 7360 6020 6469 6374 7320  ``attrs`` dicts 
-0002e9a0: 616e 6420 6120 636f 6e74 6578 7420 6f62  and a context ob
-0002e9b0: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
-0002e9c0: 2061 7320 6974 7320 6f6e 6c79 2070 6172   as its only par
-0002e9d0: 616d 6574 6572 732e 0a0a 2020 2020 2020  ameters...      
-0002e9e0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0002e9f0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-0002ea00: 2020 6d65 7267 6564 203a 2044 6174 6173    merged : Datas
-0002ea10: 6574 0a20 2020 2020 2020 2020 2020 204d  et.            M
-0002ea20: 6572 6765 6420 6461 7461 7365 742e 0a0a  erged dataset...
-0002ea30: 2020 2020 2020 2020 5261 6973 6573 0a20          Raises. 
-0002ea40: 2020 2020 2020 202d 2d2d 2d2d 2d0a 2020         ------.  
-0002ea50: 2020 2020 2020 4d65 7267 6545 7272 6f72        MergeError
-0002ea60: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0002ea70: 616e 7920 7661 7269 6162 6c65 7320 636f  any variables co
-0002ea80: 6e66 6c69 6374 2028 7365 6520 6060 636f  nflict (see ``co
-0002ea90: 6d70 6174 6060 292e 0a0a 2020 2020 2020  mpat``)...      
-0002eaa0: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-0002eab0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-0002eac0: 2020 2020 4461 7461 7365 742e 7570 6461      Dataset.upda
-0002ead0: 7465 0a20 2020 2020 2020 2022 2222 0a20  te.        """. 
-0002eae0: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
-0002eaf0: 6179 2e63 6f72 652e 6461 7461 6172 7261  ay.core.dataarra
-0002eb00: 7920 696d 706f 7274 2044 6174 6141 7272  y import DataArr
-0002eb10: 6179 0a0a 2020 2020 2020 2020 6f74 6865  ay..        othe
-0002eb20: 7220 3d20 6f74 6865 722e 746f 5f64 6174  r = other.to_dat
-0002eb30: 6173 6574 2829 2069 6620 6973 696e 7374  aset() if isinst
-0002eb40: 616e 6365 286f 7468 6572 2c20 4461 7461  ance(other, Data
-0002eb50: 4172 7261 7929 2065 6c73 6520 6f74 6865  Array) else othe
-0002eb60: 720a 2020 2020 2020 2020 6d65 7267 655f  r.        merge_
-0002eb70: 7265 7375 6c74 203d 2064 6174 6173 6574  result = dataset
-0002eb80: 5f6d 6572 6765 5f6d 6574 686f 6428 0a20  _merge_method(. 
-0002eb90: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-0002eba0: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-0002ebb0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-0002ebc0: 6f76 6572 7772 6974 655f 7661 7273 3d6f  overwrite_vars=o
-0002ebd0: 7665 7277 7269 7465 5f76 6172 732c 0a20  verwrite_vars,. 
-0002ebe0: 2020 2020 2020 2020 2020 2063 6f6d 7061             compa
-0002ebf0: 743d 636f 6d70 6174 2c0a 2020 2020 2020  t=compat,.      
-0002ec00: 2020 2020 2020 6a6f 696e 3d6a 6f69 6e2c        join=join,
-0002ec10: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-0002ec20: 6c5f 7661 6c75 653d 6669 6c6c 5f76 616c  l_value=fill_val
-0002ec30: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0002ec40: 636f 6d62 696e 655f 6174 7472 733d 636f  combine_attrs=co
-0002ec50: 6d62 696e 655f 6174 7472 732c 0a20 2020  mbine_attrs,.   
-0002ec60: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0002ec70: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
-0002ec80: 6163 6528 2a2a 6d65 7267 655f 7265 7375  ace(**merge_resu
-0002ec90: 6c74 2e5f 6173 6469 6374 2829 290a 0a20  lt._asdict()).. 
-0002eca0: 2020 2064 6566 205f 6173 7365 7274 5f61     def _assert_a
-0002ecb0: 6c6c 5f69 6e5f 6461 7461 7365 7428 0a20  ll_in_dataset(. 
-0002ecc0: 2020 2020 2020 2073 656c 662c 206e 616d         self, nam
-0002ecd0: 6573 3a20 4974 6572 6162 6c65 5b48 6173  es: Iterable[Has
-0002ece0: 6861 626c 655d 2c20 7669 7274 7561 6c5f  hable], virtual_
-0002ecf0: 6f6b 6179 3a20 626f 6f6c 203d 2046 616c  okay: bool = Fal
-0002ed00: 7365 0a20 2020 2029 202d 3e20 4e6f 6e65  se.    ) -> None
-0002ed10: 3a0a 2020 2020 2020 2020 6261 645f 6e61  :.        bad_na
-0002ed20: 6d65 7320 3d20 7365 7428 6e61 6d65 7329  mes = set(names)
-0002ed30: 202d 2073 6574 2873 656c 662e 5f76 6172   - set(self._var
-0002ed40: 6961 626c 6573 290a 2020 2020 2020 2020  iables).        
-0002ed50: 6966 2076 6972 7475 616c 5f6f 6b61 793a  if virtual_okay:
-0002ed60: 0a20 2020 2020 2020 2020 2020 2062 6164  .            bad
-0002ed70: 5f6e 616d 6573 202d 3d20 7365 6c66 2e76  _names -= self.v
-0002ed80: 6972 7475 616c 5f76 6172 6961 626c 6573  irtual_variables
-0002ed90: 0a20 2020 2020 2020 2069 6620 6261 645f  .        if bad_
-0002eda0: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
-0002edb0: 2020 206f 7264 6572 6564 5f62 6164 5f6e     ordered_bad_n
-0002edc0: 616d 6573 203d 205b 6e61 6d65 2066 6f72  ames = [name for
-0002edd0: 206e 616d 6520 696e 206e 616d 6573 2069   name in names i
-0002ede0: 6620 6e61 6d65 2069 6e20 6261 645f 6e61  f name in bad_na
-0002edf0: 6d65 735d 0a20 2020 2020 2020 2020 2020  mes].           
-0002ee00: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0002ee10: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0002ee20: 2020 2066 2254 6865 7365 2076 6172 6961     f"These varia
-0002ee30: 626c 6573 2063 616e 6e6f 7420 6265 2066  bles cannot be f
-0002ee40: 6f75 6e64 2069 6e20 7468 6973 2064 6174  ound in this dat
-0002ee50: 6173 6574 3a20 7b6f 7264 6572 6564 5f62  aset: {ordered_b
-0002ee60: 6164 5f6e 616d 6573 7d22 0a20 2020 2020  ad_names}".     
-0002ee70: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0002ee80: 6620 6472 6f70 5f76 6172 7328 0a20 2020  f drop_vars(.   
-0002ee90: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-0002eea0: 6173 6574 2c0a 2020 2020 2020 2020 6e61  aset,.        na
-0002eeb0: 6d65 733a 2048 6173 6861 626c 6520 7c20  mes: Hashable | 
-0002eec0: 4974 6572 6162 6c65 5b48 6173 6861 626c  Iterable[Hashabl
-0002eed0: 655d 2c0a 2020 2020 2020 2020 2a2c 0a20  e],.        *,. 
-0002eee0: 2020 2020 2020 2065 7272 6f72 733a 2045         errors: E
-0002eef0: 7272 6f72 4f70 7469 6f6e 7320 3d20 2272  rrorOptions = "r
-0002ef00: 6169 7365 222c 0a20 2020 2029 202d 3e20  aise",.    ) -> 
-0002ef10: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
-0002ef20: 2020 2022 2222 4472 6f70 2076 6172 6961     """Drop varia
-0002ef30: 626c 6573 2066 726f 6d20 7468 6973 2064  bles from this d
-0002ef40: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
-0002ef50: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0002ef60: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0002ef70: 2020 2020 2020 206e 616d 6573 203a 2068         names : h
-0002ef80: 6173 6861 626c 6520 6f72 2069 7465 7261  ashable or itera
-0002ef90: 626c 6520 6f66 2068 6173 6861 626c 650a  ble of hashable.
-0002efa0: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
-0002efb0: 2873 2920 6f66 2076 6172 6961 626c 6573  (s) of variables
-0002efc0: 2074 6f20 6472 6f70 2e0a 2020 2020 2020   to drop..      
-0002efd0: 2020 6572 726f 7273 203a 207b 2272 6169    errors : {"rai
-0002efe0: 7365 222c 2022 6967 6e6f 7265 227d 2c20  se", "ignore"}, 
-0002eff0: 6465 6661 756c 743a 2022 7261 6973 6522  default: "raise"
-0002f000: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0002f010: 2772 6169 7365 272c 2072 6169 7365 7320  'raise', raises 
-0002f020: 6120 5661 6c75 6545 7272 6f72 2065 7272  a ValueError err
-0002f030: 6f72 2069 6620 616e 7920 6f66 2074 6865  or if any of the
-0002f040: 2076 6172 6961 626c 650a 2020 2020 2020   variable.      
-0002f050: 2020 2020 2020 7061 7373 6564 2061 7265        passed are
-0002f060: 206e 6f74 2069 6e20 7468 6520 6461 7461   not in the data
-0002f070: 7365 742e 2049 6620 2769 676e 6f72 6527  set. If 'ignore'
-0002f080: 2c20 616e 7920 6769 7665 6e20 6e61 6d65  , any given name
-0002f090: 7320 7468 6174 2061 7265 2069 6e20 7468  s that are in th
-0002f0a0: 650a 2020 2020 2020 2020 2020 2020 6461  e.            da
-0002f0b0: 7461 7365 7420 6172 6520 6472 6f70 7065  taset are droppe
-0002f0c0: 6420 616e 6420 6e6f 2065 7272 6f72 2069  d and no error i
-0002f0d0: 7320 7261 6973 6564 2e0a 0a20 2020 2020  s raised...     
-0002f0e0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-0002f0f0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-0002f100: 2020 2064 726f 7070 6564 203a 2044 6174     dropped : Dat
-0002f110: 6173 6574 0a0a 2020 2020 2020 2020 2222  aset..        ""
-0002f120: 220a 2020 2020 2020 2020 2320 7468 6520  ".        # the 
-0002f130: 4974 6572 6162 6c65 2063 6865 636b 2069  Iterable check i
-0002f140: 7320 7265 7175 6972 6564 2066 6f72 206d  s required for m
-0002f150: 7970 790a 2020 2020 2020 2020 6966 2069  ypy.        if i
-0002f160: 735f 7363 616c 6172 286e 616d 6573 2920  s_scalar(names) 
-0002f170: 6f72 206e 6f74 2069 7369 6e73 7461 6e63  or not isinstanc
-0002f180: 6528 6e61 6d65 732c 2049 7465 7261 626c  e(names, Iterabl
-0002f190: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0002f1a0: 6e61 6d65 7320 3d20 7b6e 616d 6573 7d0a  names = {names}.
-0002f1b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002f1c0: 2020 2020 2020 2020 2020 6e61 6d65 7320            names 
-0002f1d0: 3d20 7365 7428 6e61 6d65 7329 0a20 2020  = set(names).   
-0002f1e0: 2020 2020 2069 6620 6572 726f 7273 203d       if errors =
-0002f1f0: 3d20 2272 6169 7365 223a 0a20 2020 2020  = "raise":.     
-0002f200: 2020 2020 2020 2073 656c 662e 5f61 7373         self._ass
-0002f210: 6572 745f 616c 6c5f 696e 5f64 6174 6173  ert_all_in_datas
-0002f220: 6574 286e 616d 6573 290a 0a20 2020 2020  et(names)..     
-0002f230: 2020 2023 2047 4836 3530 350a 2020 2020     # GH6505.    
-0002f240: 2020 2020 6f74 6865 725f 6e61 6d65 7320      other_names 
-0002f250: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
-0002f260: 666f 7220 7661 7220 696e 206e 616d 6573  for var in names
-0002f270: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-0002f280: 7962 655f 6d69 6478 203d 2073 656c 662e  ybe_midx = self.
-0002f290: 5f69 6e64 6578 6573 2e67 6574 2876 6172  _indexes.get(var
-0002f2a0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0002f2b0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0002f2c0: 6528 6d61 7962 655f 6d69 6478 2c20 5061  e(maybe_midx, Pa
-0002f2d0: 6e64 6173 4d75 6c74 6949 6e64 6578 293a  ndasMultiIndex):
-0002f2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f2f0: 2069 6478 5f63 6f6f 7264 5f6e 616d 6573   idx_coord_names
-0002f300: 203d 2073 6574 286d 6179 6265 5f6d 6964   = set(maybe_mid
-0002f310: 782e 696e 6465 782e 6e61 6d65 7320 2b20  x.index.names + 
-0002f320: 5b6d 6179 6265 5f6d 6964 782e 6469 6d5d  [maybe_midx.dim]
-0002f330: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002f340: 2020 6964 785f 6f74 6865 725f 6e61 6d65    idx_other_name
-0002f350: 7320 3d20 6964 785f 636f 6f72 645f 6e61  s = idx_coord_na
-0002f360: 6d65 7320 2d20 7365 7428 6e61 6d65 7329  mes - set(names)
-0002f370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f380: 206f 7468 6572 5f6e 616d 6573 2e75 7064   other_names.upd
-0002f390: 6174 6528 6964 785f 6f74 6865 725f 6e61  ate(idx_other_na
-0002f3a0: 6d65 7329 0a20 2020 2020 2020 2069 6620  mes).        if 
-0002f3b0: 6f74 6865 725f 6e61 6d65 733a 0a20 2020  other_names:.   
-0002f3c0: 2020 2020 2020 2020 206e 616d 6573 207c           names |
-0002f3d0: 3d20 7365 7428 6f74 6865 725f 6e61 6d65  = set(other_name
-0002f3e0: 7329 0a20 2020 2020 2020 2020 2020 2077  s).            w
-0002f3f0: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-0002f400: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0002f410: 4465 6c65 7469 6e67 2061 2073 696e 676c  Deleting a singl
-0002f420: 6520 6c65 7665 6c20 6f66 2061 204d 756c  e level of a Mul
-0002f430: 7469 496e 6465 7820 6973 2064 6570 7265  tiIndex is depre
-0002f440: 6361 7465 642e 2050 7265 7669 6f75 736c  cated. Previousl
-0002f450: 792c 2074 6869 7320 6465 6c65 7465 6420  y, this deleted 
-0002f460: 616c 6c20 6c65 7665 6c73 206f 6620 6120  all levels of a 
-0002f470: 4d75 6c74 6949 6e64 6578 2e20 220a 2020  MultiIndex. ".  
-0002f480: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0002f490: 506c 6561 7365 2061 6c73 6f20 6472 6f70  Please also drop
-0002f4a0: 2074 6865 2066 6f6c 6c6f 7769 6e67 2076   the following v
-0002f4b0: 6172 6961 626c 6573 3a20 7b6f 7468 6572  ariables: {other
-0002f4c0: 5f6e 616d 6573 2172 7d20 746f 2061 766f  _names!r} to avo
-0002f4d0: 6964 2061 6e20 6572 726f 7220 696e 2074  id an error in t
-0002f4e0: 6865 2066 7574 7572 652e 222c 0a20 2020  he future.",.   
-0002f4f0: 2020 2020 2020 2020 2020 2020 2044 6570               Dep
-0002f500: 7265 6361 7469 6f6e 5761 726e 696e 672c  recationWarning,
-0002f510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f520: 2073 7461 636b 6c65 7665 6c3d 322c 0a20   stacklevel=2,. 
-0002f530: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0002f540: 2020 2020 2020 6173 7365 7274 5f6e 6f5f        assert_no_
-0002f550: 696e 6465 785f 636f 7272 7570 7465 6428  index_corrupted(
-0002f560: 7365 6c66 2e78 696e 6465 7865 732c 206e  self.xindexes, n
-0002f570: 616d 6573 290a 0a20 2020 2020 2020 2076  ames)..        v
-0002f580: 6172 6961 626c 6573 203d 207b 6b3a 2076  ariables = {k: v
-0002f590: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-0002f5a0: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
-0002f5b0: 6d73 2829 2069 6620 6b20 6e6f 7420 696e  ms() if k not in
-0002f5c0: 206e 616d 6573 7d0a 2020 2020 2020 2020   names}.        
-0002f5d0: 636f 6f72 645f 6e61 6d65 7320 3d20 7b6b  coord_names = {k
-0002f5e0: 2066 6f72 206b 2069 6e20 7365 6c66 2e5f   for k in self._
-0002f5f0: 636f 6f72 645f 6e61 6d65 7320 6966 206b  coord_names if k
-0002f600: 2069 6e20 7661 7269 6162 6c65 737d 0a20   in variables}. 
-0002f610: 2020 2020 2020 2069 6e64 6578 6573 203d         indexes =
-0002f620: 207b 6b3a 2076 2066 6f72 206b 2c20 7620   {k: v for k, v 
-0002f630: 696e 2073 656c 662e 5f69 6e64 6578 6573  in self._indexes
-0002f640: 2e69 7465 6d73 2829 2069 6620 6b20 6e6f  .items() if k no
-0002f650: 7420 696e 206e 616d 6573 7d0a 2020 2020  t in names}.    
-0002f660: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0002f670: 5f72 6570 6c61 6365 5f77 6974 685f 6e65  _replace_with_ne
-0002f680: 775f 6469 6d73 280a 2020 2020 2020 2020  w_dims(.        
-0002f690: 2020 2020 7661 7269 6162 6c65 732c 2063      variables, c
-0002f6a0: 6f6f 7264 5f6e 616d 6573 3d63 6f6f 7264  oord_names=coord
-0002f6b0: 5f6e 616d 6573 2c20 696e 6465 7865 733d  _names, indexes=
-0002f6c0: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
-0002f6d0: 290a 0a20 2020 2064 6566 2064 726f 705f  )..    def drop_
-0002f6e0: 696e 6465 7865 7328 0a20 2020 2020 2020  indexes(.       
-0002f6f0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-0002f700: 2c0a 2020 2020 2020 2020 636f 6f72 645f  ,.        coord_
-0002f710: 6e61 6d65 733a 2048 6173 6861 626c 6520  names: Hashable 
-0002f720: 7c20 4974 6572 6162 6c65 5b48 6173 6861  | Iterable[Hasha
-0002f730: 626c 655d 2c0a 2020 2020 2020 2020 2a2c  ble],.        *,
-0002f740: 0a20 2020 2020 2020 2065 7272 6f72 733a  .        errors:
-0002f750: 2045 7272 6f72 4f70 7469 6f6e 7320 3d20   ErrorOptions = 
-0002f760: 2272 6169 7365 222c 0a20 2020 2029 202d  "raise",.    ) -
-0002f770: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-0002f780: 2020 2020 2022 2222 4472 6f70 2074 6865       """Drop the
-0002f790: 2069 6e64 6578 6573 2061 7373 6967 6e65   indexes assigne
-0002f7a0: 6420 746f 2074 6865 2067 6976 656e 2063  d to the given c
-0002f7b0: 6f6f 7264 696e 6174 6573 2e0a 0a20 2020  oordinates...   
-0002f7c0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-0002f7d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0002f7e0: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
-0002f7f0: 5f6e 616d 6573 203a 2068 6173 6861 626c  _names : hashabl
-0002f800: 6520 6f72 2069 7465 7261 626c 6520 6f66  e or iterable of
-0002f810: 2068 6173 6861 626c 650a 2020 2020 2020   hashable.      
-0002f820: 2020 2020 2020 4e61 6d65 2873 2920 6f66        Name(s) of
-0002f830: 2074 6865 2063 6f6f 7264 696e 6174 6528   the coordinate(
-0002f840: 7329 2066 6f72 2077 6869 6368 2074 6f20  s) for which to 
-0002f850: 6472 6f70 2074 6865 2069 6e64 6578 2e0a  drop the index..
-0002f860: 2020 2020 2020 2020 6572 726f 7273 203a          errors :
-0002f870: 207b 2272 6169 7365 222c 2022 6967 6e6f   {"raise", "igno
-0002f880: 7265 227d 2c20 6465 6661 756c 743a 2022  re"}, default: "
-0002f890: 7261 6973 6522 0a20 2020 2020 2020 2020  raise".         
-0002f8a0: 2020 2049 6620 2772 6169 7365 272c 2072     If 'raise', r
-0002f8b0: 6169 7365 7320 6120 5661 6c75 6545 7272  aises a ValueErr
-0002f8c0: 6f72 2065 7272 6f72 2069 6620 616e 7920  or error if any 
-0002f8d0: 6f66 2074 6865 2063 6f6f 7264 696e 6174  of the coordinat
-0002f8e0: 6573 0a20 2020 2020 2020 2020 2020 2070  es.            p
-0002f8f0: 6173 7365 6420 6861 7665 206e 6f20 696e  assed have no in
-0002f900: 6465 7820 6f72 2061 7265 206e 6f74 2069  dex or are not i
-0002f910: 6e20 7468 6520 6461 7461 7365 742e 0a20  n the dataset.. 
-0002f920: 2020 2020 2020 2020 2020 2049 6620 2769             If 'i
-0002f930: 676e 6f72 6527 2c20 6e6f 2065 7272 6f72  gnore', no error
-0002f940: 2069 7320 7261 6973 6564 2e0a 0a20 2020   is raised...   
-0002f950: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-0002f960: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-0002f970: 2020 2020 2064 726f 7070 6564 203a 2044       dropped : D
-0002f980: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
-0002f990: 2020 2041 206e 6577 2064 6174 6173 6574     A new dataset
-0002f9a0: 2077 6974 6820 6472 6f70 7065 6420 696e   with dropped in
-0002f9b0: 6465 7865 732e 0a0a 2020 2020 2020 2020  dexes...        
-0002f9c0: 2222 220a 2020 2020 2020 2020 2320 7468  """.        # th
-0002f9d0: 6520 4974 6572 6162 6c65 2063 6865 636b  e Iterable check
-0002f9e0: 2069 7320 7265 7175 6972 6564 2066 6f72   is required for
-0002f9f0: 206d 7970 790a 2020 2020 2020 2020 6966   mypy.        if
-0002fa00: 2069 735f 7363 616c 6172 2863 6f6f 7264   is_scalar(coord
-0002fa10: 5f6e 616d 6573 2920 6f72 206e 6f74 2069  _names) or not i
-0002fa20: 7369 6e73 7461 6e63 6528 636f 6f72 645f  sinstance(coord_
-0002fa30: 6e61 6d65 732c 2049 7465 7261 626c 6529  names, Iterable)
-0002fa40: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0002fa50: 6f72 645f 6e61 6d65 7320 3d20 7b63 6f6f  ord_names = {coo
-0002fa60: 7264 5f6e 616d 6573 7d0a 2020 2020 2020  rd_names}.      
-0002fa70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002fa80: 2020 2020 636f 6f72 645f 6e61 6d65 7320      coord_names 
-0002fa90: 3d20 7365 7428 636f 6f72 645f 6e61 6d65  = set(coord_name
-0002faa0: 7329 0a0a 2020 2020 2020 2020 6966 2065  s)..        if e
-0002fab0: 7272 6f72 7320 3d3d 2022 7261 6973 6522  rrors == "raise"
-0002fac0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-0002fad0: 7661 6c69 645f 636f 6f72 6473 203d 2063  valid_coords = c
-0002fae0: 6f6f 7264 5f6e 616d 6573 202d 2073 656c  oord_names - sel
-0002faf0: 662e 5f63 6f6f 7264 5f6e 616d 6573 0a20  f._coord_names. 
-0002fb00: 2020 2020 2020 2020 2020 2069 6620 696e             if in
-0002fb10: 7661 6c69 645f 636f 6f72 6473 3a0a 2020  valid_coords:.  
-0002fb20: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0002fb30: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-0002fb40: 2274 686f 7365 2063 6f6f 7264 696e 6174  "those coordinat
-0002fb50: 6573 2064 6f6e 2774 2065 7869 7374 3a20  es don't exist: 
-0002fb60: 7b69 6e76 616c 6964 5f63 6f6f 7264 737d  {invalid_coords}
-0002fb70: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0002fb80: 756e 696e 6465 7865 645f 636f 6f72 6473  unindexed_coords
-0002fb90: 203d 2073 6574 2863 6f6f 7264 5f6e 616d   = set(coord_nam
-0002fba0: 6573 2920 2d20 7365 7428 7365 6c66 2e5f  es) - set(self._
-0002fbb0: 696e 6465 7865 7329 0a20 2020 2020 2020  indexes).       
-0002fbc0: 2020 2020 2069 6620 756e 696e 6465 7865       if unindexe
-0002fbd0: 645f 636f 6f72 6473 3a0a 2020 2020 2020  d_coords:.      
-0002fbe0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0002fbf0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0002fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fc10: 6622 7468 6f73 6520 636f 6f72 6469 6e61  f"those coordina
-0002fc20: 7465 7320 646f 206e 6f74 2068 6176 6520  tes do not have 
-0002fc30: 616e 2069 6e64 6578 3a20 7b75 6e69 6e64  an index: {unind
-0002fc40: 6578 6564 5f63 6f6f 7264 737d 220a 2020  exed_coords}".  
-0002fc50: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0002fc60: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
-0002fc70: 6e6f 5f69 6e64 6578 5f63 6f72 7275 7074  no_index_corrupt
-0002fc80: 6564 2873 656c 662e 7869 6e64 6578 6573  ed(self.xindexes
-0002fc90: 2c20 636f 6f72 645f 6e61 6d65 732c 2061  , coord_names, a
-0002fca0: 6374 696f 6e3d 2272 656d 6f76 6520 696e  ction="remove in
-0002fcb0: 6465 7828 6573 2922 290a 0a20 2020 2020  dex(es)")..     
-0002fcc0: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
-0002fcd0: 7d0a 2020 2020 2020 2020 666f 7220 6e61  }.        for na
-0002fce0: 6d65 2c20 7661 7220 696e 2073 656c 662e  me, var in self.
-0002fcf0: 5f76 6172 6961 626c 6573 2e69 7465 6d73  _variables.items
-0002fd00: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0002fd10: 6966 206e 616d 6520 696e 2063 6f6f 7264  if name in coord
-0002fd20: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
-0002fd30: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0002fd40: 735b 6e61 6d65 5d20 3d20 7661 722e 746f  s[name] = var.to
-0002fd50: 5f62 6173 655f 7661 7269 6162 6c65 2829  _base_variable()
-0002fd60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0002fd70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002fd80: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
-0002fd90: 655d 203d 2076 6172 0a0a 2020 2020 2020  e] = var..      
-0002fda0: 2020 696e 6465 7865 7320 3d20 7b6b 3a20    indexes = {k: 
-0002fdb0: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
-0002fdc0: 6c66 2e5f 696e 6465 7865 732e 6974 656d  lf._indexes.item
-0002fdd0: 7328 2920 6966 206b 206e 6f74 2069 6e20  s() if k not in 
-0002fde0: 636f 6f72 645f 6e61 6d65 737d 0a0a 2020  coord_names}..  
-0002fdf0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002fe00: 662e 5f72 6570 6c61 6365 2876 6172 6961  f._replace(varia
-0002fe10: 626c 6573 3d76 6172 6961 626c 6573 2c20  bles=variables, 
-0002fe20: 696e 6465 7865 733d 696e 6465 7865 7329  indexes=indexes)
-0002fe30: 0a0a 2020 2020 6465 6620 6472 6f70 280a  ..    def drop(.
-0002fe40: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
-0002fe50: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
-0002fe60: 206c 6162 656c 733d 4e6f 6e65 2c0a 2020   labels=None,.  
-0002fe70: 2020 2020 2020 6469 6d3d 4e6f 6e65 2c0a        dim=None,.
-0002fe80: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
-0002fe90: 2020 2065 7272 6f72 733a 2045 7272 6f72     errors: Error
-0002fea0: 4f70 7469 6f6e 7320 3d20 2272 6169 7365  Options = "raise
-0002feb0: 222c 0a20 2020 2020 2020 202a 2a6c 6162  ",.        **lab
-0002fec0: 656c 735f 6b77 6172 6773 2c0a 2020 2020  els_kwargs,.    
-0002fed0: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-0002fee0: 2020 2020 2020 2020 2222 2242 6163 6b77          """Backw
-0002fef0: 6172 6420 636f 6d70 6174 6962 6c65 206d  ard compatible m
-0002ff00: 6574 686f 6420 6261 7365 6420 6f6e 2060  ethod based on `
-0002ff10: 6472 6f70 5f76 6172 7360 2061 6e64 2060  drop_vars` and `
-0002ff20: 6472 6f70 5f73 656c 600a 0a20 2020 2020  drop_sel`..     
-0002ff30: 2020 2055 7369 6e67 2065 6974 6865 7220     Using either 
-0002ff40: 6064 726f 705f 7661 7273 6020 6f72 2060  `drop_vars` or `
-0002ff50: 6472 6f70 5f73 656c 6020 6973 2065 6e63  drop_sel` is enc
-0002ff60: 6f75 7261 6765 640a 0a20 2020 2020 2020  ouraged..       
-0002ff70: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-0002ff80: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-0002ff90: 2020 2044 6174 6173 6574 2e64 726f 705f     Dataset.drop_
-0002ffa0: 7661 7273 0a20 2020 2020 2020 2044 6174  vars.        Dat
-0002ffb0: 6173 6574 2e64 726f 705f 7365 6c0a 2020  aset.drop_sel.  
-0002ffc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0002ffd0: 2020 6966 2065 7272 6f72 7320 6e6f 7420    if errors not 
-0002ffe0: 696e 205b 2272 6169 7365 222c 2022 6967  in ["raise", "ig
-0002fff0: 6e6f 7265 225d 3a0a 2020 2020 2020 2020  nore"]:.        
-00030000: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00030010: 7272 6f72 2827 6572 726f 7273 206d 7573  rror('errors mus
-00030020: 7420 6265 2065 6974 6865 7220 2272 6169  t be either "rai
-00030030: 7365 2220 6f72 2022 6967 6e6f 7265 2227  se" or "ignore"'
-00030040: 290a 0a20 2020 2020 2020 2069 6620 6973  )..        if is
-00030050: 5f64 6963 745f 6c69 6b65 286c 6162 656c  _dict_like(label
-00030060: 7329 2061 6e64 206e 6f74 2069 7369 6e73  s) and not isins
-00030070: 7461 6e63 6528 6c61 6265 6c73 2c20 6469  tance(labels, di
-00030080: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
-00030090: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-000300a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000300b0: 2264 726f 7070 696e 6720 636f 6f72 6469  "dropping coordi
-000300c0: 6e61 7465 7320 7573 696e 6720 6064 726f  nates using `dro
-000300d0: 7060 2069 7320 6265 2064 6570 7265 6361  p` is be depreca
-000300e0: 7465 643b 2075 7365 2064 726f 705f 7661  ted; use drop_va
-000300f0: 7273 2e22 2c0a 2020 2020 2020 2020 2020  rs.",.          
-00030100: 2020 2020 2020 4675 7475 7265 5761 726e        FutureWarn
-00030110: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
-00030120: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
-00030130: 322c 0a20 2020 2020 2020 2020 2020 2029  2,.            )
-00030140: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00030150: 7572 6e20 7365 6c66 2e64 726f 705f 7661  urn self.drop_va
-00030160: 7273 286c 6162 656c 732c 2065 7272 6f72  rs(labels, error
-00030170: 733d 6572 726f 7273 290a 0a20 2020 2020  s=errors)..     
-00030180: 2020 2069 6620 6c61 6265 6c73 5f6b 7761     if labels_kwa
-00030190: 7267 7320 6f72 2069 7369 6e73 7461 6e63  rgs or isinstanc
-000301a0: 6528 6c61 6265 6c73 2c20 6469 6374 293a  e(labels, dict):
-000301b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000301c0: 6469 6d20 6973 206e 6f74 204e 6f6e 653a  dim is not None:
-000301d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000301e0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000301f0: 7228 2263 616e 6e6f 7420 7370 6563 6966  r("cannot specif
-00030200: 7920 6469 6d20 616e 6420 6469 6374 2d6c  y dim and dict-l
-00030210: 696b 6520 6172 6775 6d65 6e74 732e 2229  ike arguments.")
-00030220: 0a20 2020 2020 2020 2020 2020 206c 6162  .            lab
-00030230: 656c 7320 3d20 6569 7468 6572 5f64 6963  els = either_dic
-00030240: 745f 6f72 5f6b 7761 7267 7328 6c61 6265  t_or_kwargs(labe
-00030250: 6c73 2c20 6c61 6265 6c73 5f6b 7761 7267  ls, labels_kwarg
-00030260: 732c 2022 6472 6f70 2229 0a0a 2020 2020  s, "drop")..    
-00030270: 2020 2020 6966 2064 696d 2069 7320 4e6f      if dim is No
-00030280: 6e65 2061 6e64 2028 6973 5f73 6361 6c61  ne and (is_scala
-00030290: 7228 6c61 6265 6c73 2920 6f72 2069 7369  r(labels) or isi
-000302a0: 6e73 7461 6e63 6528 6c61 6265 6c73 2c20  nstance(labels, 
-000302b0: 4974 6572 6162 6c65 2929 3a0a 2020 2020  Iterable)):.    
-000302c0: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-000302d0: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
-000302e0: 2020 2020 2020 2022 6472 6f70 7069 6e67         "dropping
-000302f0: 2076 6172 6961 626c 6573 2075 7369 6e67   variables using
-00030300: 2060 6472 6f70 6020 7769 6c6c 2062 6520   `drop` will be 
-00030310: 6465 7072 6563 6174 6564 3b20 7573 696e  deprecated; usin
-00030320: 6720 6472 6f70 5f76 6172 7320 6973 2065  g drop_vars is e
-00030330: 6e63 6f75 7261 6765 642e 222c 0a20 2020  ncouraged.",.   
-00030340: 2020 2020 2020 2020 2020 2020 2050 656e               Pen
-00030350: 6469 6e67 4465 7072 6563 6174 696f 6e57  dingDeprecationW
-00030360: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
-00030370: 2020 2020 2020 2020 7374 6163 6b6c 6576          stacklev
-00030380: 656c 3d32 2c0a 2020 2020 2020 2020 2020  el=2,.          
-00030390: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000303a0: 7265 7475 726e 2073 656c 662e 6472 6f70  return self.drop
-000303b0: 5f76 6172 7328 6c61 6265 6c73 2c20 6572  _vars(labels, er
-000303c0: 726f 7273 3d65 7272 6f72 7329 0a20 2020  rors=errors).   
-000303d0: 2020 2020 2069 6620 6469 6d20 6973 206e       if dim is n
-000303e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000303f0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-00030400: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
-00030410: 2020 2020 2264 726f 7070 696e 6720 6c61      "dropping la
-00030420: 6265 6c73 2075 7369 6e67 206c 6973 742d  bels using list-
-00030430: 6c69 6b65 206c 6162 656c 7320 6973 2064  like labels is d
-00030440: 6570 7265 6361 7465 643b 2075 7369 6e67  eprecated; using
-00030450: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00030460: 2020 2022 6469 6374 2d6c 696b 6520 6172     "dict-like ar
-00030470: 6775 6d65 6e74 7320 7769 7468 2060 6472  guments with `dr
-00030480: 6f70 5f73 656c 602c 2065 2e67 2e20 6064  op_sel`, e.g. `d
-00030490: 732e 6472 6f70 5f73 656c 2864 696d 3d5b  s.drop_sel(dim=[
-000304a0: 6c61 6265 6c73 5d29 2e22 2c0a 2020 2020  labels]).",.    
-000304b0: 2020 2020 2020 2020 2020 2020 4465 7072              Depr
-000304c0: 6563 6174 696f 6e57 6172 6e69 6e67 2c0a  ecationWarning,.
-000304d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000304e0: 7374 6163 6b6c 6576 656c 3d32 2c0a 2020  stacklevel=2,.  
-000304f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00030500: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00030510: 656c 662e 6472 6f70 5f73 656c 287b 6469  elf.drop_sel({di
-00030520: 6d3a 206c 6162 656c 737d 2c20 6572 726f  m: labels}, erro
-00030530: 7273 3d65 7272 6f72 732c 202a 2a6c 6162  rs=errors, **lab
-00030540: 656c 735f 6b77 6172 6773 290a 0a20 2020  els_kwargs)..   
-00030550: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-00030560: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
-00030570: 2264 726f 7070 696e 6720 6c61 6265 6c73  "dropping labels
-00030580: 2075 7369 6e67 2060 6472 6f70 6020 7769   using `drop` wi
-00030590: 6c6c 2062 6520 6465 7072 6563 6174 6564  ll be deprecated
-000305a0: 3b20 7573 696e 6720 6472 6f70 5f73 656c  ; using drop_sel
-000305b0: 2069 7320 656e 636f 7572 6167 6564 2e22   is encouraged."
-000305c0: 2c0a 2020 2020 2020 2020 2020 2020 5065  ,.            Pe
-000305d0: 6e64 696e 6744 6570 7265 6361 7469 6f6e  ndingDeprecation
-000305e0: 5761 726e 696e 672c 0a20 2020 2020 2020  Warning,.       
-000305f0: 2020 2020 2073 7461 636b 6c65 7665 6c3d       stacklevel=
-00030600: 322c 0a20 2020 2020 2020 2029 0a20 2020  2,.        ).   
-00030610: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00030620: 2e64 726f 705f 7365 6c28 6c61 6265 6c73  .drop_sel(labels
-00030630: 2c20 6572 726f 7273 3d65 7272 6f72 7329  , errors=errors)
-00030640: 0a0a 2020 2020 6465 6620 6472 6f70 5f73  ..    def drop_s
-00030650: 656c 280a 2020 2020 2020 2020 7365 6c66  el(.        self
-00030660: 3a20 545f 4461 7461 7365 742c 206c 6162  : T_Dataset, lab
-00030670: 656c 733d 4e6f 6e65 2c20 2a2c 2065 7272  els=None, *, err
-00030680: 6f72 733a 2045 7272 6f72 4f70 7469 6f6e  ors: ErrorOption
-00030690: 7320 3d20 2272 6169 7365 222c 202a 2a6c  s = "raise", **l
-000306a0: 6162 656c 735f 6b77 6172 6773 0a20 2020  abels_kwargs.   
-000306b0: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-000306c0: 0a20 2020 2020 2020 2022 2222 4472 6f70  .        """Drop
-000306d0: 2069 6e64 6578 206c 6162 656c 7320 6672   index labels fr
-000306e0: 6f6d 2074 6869 7320 6461 7461 7365 742e  om this dataset.
-000306f0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00030700: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00030710: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00030720: 6c61 6265 6c73 203a 206d 6170 7069 6e67  labels : mapping
-00030730: 206f 6620 6861 7368 6162 6c65 2074 6f20   of hashable to 
-00030740: 416e 790a 2020 2020 2020 2020 2020 2020  Any.            
-00030750: 496e 6465 7820 6c61 6265 6c73 2074 6f20  Index labels to 
-00030760: 6472 6f70 0a20 2020 2020 2020 2065 7272  drop.        err
-00030770: 6f72 7320 3a20 7b22 7261 6973 6522 2c20  ors : {"raise", 
-00030780: 2269 676e 6f72 6522 7d2c 2064 6566 6175  "ignore"}, defau
-00030790: 6c74 3a20 2272 6169 7365 220a 2020 2020  lt: "raise".    
-000307a0: 2020 2020 2020 2020 4966 2027 7261 6973          If 'rais
-000307b0: 6527 2c20 7261 6973 6573 2061 2056 616c  e', raises a Val
-000307c0: 7565 4572 726f 7220 6572 726f 7220 6966  ueError error if
-000307d0: 0a20 2020 2020 2020 2020 2020 2061 6e79  .            any
-000307e0: 206f 6620 7468 6520 696e 6465 7820 6c61   of the index la
-000307f0: 6265 6c73 2070 6173 7365 6420 6172 6520  bels passed are 
-00030800: 6e6f 740a 2020 2020 2020 2020 2020 2020  not.            
-00030810: 696e 2074 6865 2064 6174 6173 6574 2e20  in the dataset. 
-00030820: 4966 2027 6967 6e6f 7265 272c 2061 6e79  If 'ignore', any
-00030830: 2067 6976 656e 206c 6162 656c 7320 7468   given labels th
-00030840: 6174 2061 7265 2069 6e20 7468 650a 2020  at are in the.  
-00030850: 2020 2020 2020 2020 2020 6461 7461 7365            datase
-00030860: 7420 6172 6520 6472 6f70 7065 6420 616e  t are dropped an
-00030870: 6420 6e6f 2065 7272 6f72 2069 7320 7261  d no error is ra
-00030880: 6973 6564 2e0a 2020 2020 2020 2020 2a2a  ised..        **
-00030890: 6c61 6265 6c73 5f6b 7761 7267 7320 3a20  labels_kwargs : 
-000308a0: 7b64 696d 3a20 6c61 6265 6c2c 202e 2e2e  {dim: label, ...
-000308b0: 7d2c 206f 7074 696f 6e61 6c0a 2020 2020  }, optional.    
-000308c0: 2020 2020 2020 2020 5468 6520 6b65 7977          The keyw
-000308d0: 6f72 6420 6172 6775 6d65 6e74 7320 666f  ord arguments fo
-000308e0: 726d 206f 6620 6060 6469 6d60 6020 616e  rm of ``dim`` an
-000308f0: 6420 6060 6c61 6265 6c73 6060 0a0a 2020  d ``labels``..  
-00030900: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00030910: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00030920: 2020 2020 2020 6472 6f70 7065 6420 3a20        dropped : 
-00030930: 4461 7461 7365 740a 0a20 2020 2020 2020  Dataset..       
-00030940: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
-00030950: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00030960: 2020 203e 3e3e 2064 6174 6120 3d20 6e70     >>> data = np
-00030970: 2e61 7261 6e67 6528 3629 2e72 6573 6861  .arange(6).resha
-00030980: 7065 2832 2c20 3329 0a20 2020 2020 2020  pe(2, 3).       
-00030990: 203e 3e3e 206c 6162 656c 7320 3d20 5b22   >>> labels = ["
-000309a0: 6122 2c20 2262 222c 2022 6322 5d0a 2020  a", "b", "c"].  
-000309b0: 2020 2020 2020 3e3e 3e20 6473 203d 2078        >>> ds = x
-000309c0: 722e 4461 7461 7365 7428 7b22 4122 3a20  r.Dataset({"A": 
-000309d0: 285b 2278 222c 2022 7922 5d2c 2064 6174  (["x", "y"], dat
-000309e0: 6129 2c20 2279 223a 206c 6162 656c 737d  a), "y": labels}
-000309f0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
-00030a00: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
-00030a10: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
-00030a20: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
-00030a30: 783a 2032 2c20 793a 2033 290a 2020 2020  x: 2, y: 3).    
-00030a40: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-00030a50: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
-00030a60: 2020 2020 2020 2879 2920 3c55 3120 2761        (y) <U1 'a
-00030a70: 2720 2762 2720 2763 270a 2020 2020 2020  ' 'b' 'c'.      
-00030a80: 2020 4469 6d65 6e73 696f 6e73 2077 6974    Dimensions wit
-00030a90: 686f 7574 2063 6f6f 7264 696e 6174 6573  hout coordinates
-00030aa0: 3a20 780a 2020 2020 2020 2020 4461 7461  : x.        Data
-00030ab0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00030ac0: 2020 2020 2020 2020 4120 2020 2020 2020          A       
-00030ad0: 2028 782c 2079 2920 696e 7436 3420 3020   (x, y) int64 0 
-00030ae0: 3120 3220 3320 3420 350a 2020 2020 2020  1 2 3 4 5.      
-00030af0: 2020 3e3e 3e20 6473 2e64 726f 705f 7365    >>> ds.drop_se
-00030b00: 6c28 793d 5b22 6122 2c20 2263 225d 290a  l(y=["a", "c"]).
-00030b10: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-00030b20: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-00030b30: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-00030b40: 3a20 322c 2079 3a20 3129 0a20 2020 2020  : 2, y: 1).     
-00030b50: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-00030b60: 2020 2020 2020 2020 2020 2a20 7920 2020            * y   
-00030b70: 2020 2020 2028 7929 203c 5531 2027 6227       (y) <U1 'b'
-00030b80: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-00030b90: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
-00030ba0: 6469 6e61 7465 733a 2078 0a20 2020 2020  dinates: x.     
-00030bb0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-00030bc0: 733a 0a20 2020 2020 2020 2020 2020 2041  s:.            A
-00030bd0: 2020 2020 2020 2020 2878 2c20 7929 2069          (x, y) i
-00030be0: 6e74 3634 2031 2034 0a20 2020 2020 2020  nt64 1 4.       
-00030bf0: 203e 3e3e 2064 732e 6472 6f70 5f73 656c   >>> ds.drop_sel
-00030c00: 2879 3d22 6222 290a 2020 2020 2020 2020  (y="b").        
-00030c10: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
-00030c20: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-00030c30: 6f6e 733a 2020 2878 3a20 322c 2079 3a20  ons:  (x: 2, y: 
-00030c40: 3229 0a20 2020 2020 2020 2043 6f6f 7264  2).        Coord
-00030c50: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-00030c60: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
-00030c70: 203c 5531 2027 6127 2027 6327 0a20 2020   <U1 'a' 'c'.   
-00030c80: 2020 2020 2044 696d 656e 7369 6f6e 7320       Dimensions 
-00030c90: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
-00030ca0: 7465 733a 2078 0a20 2020 2020 2020 2044  tes: x.        D
-00030cb0: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-00030cc0: 2020 2020 2020 2020 2020 2041 2020 2020             A    
-00030cd0: 2020 2020 2878 2c20 7929 2069 6e74 3634      (x, y) int64
-00030ce0: 2030 2032 2033 2035 0a20 2020 2020 2020   0 2 3 5.       
-00030cf0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00030d00: 6572 726f 7273 206e 6f74 2069 6e20 5b22  errors not in ["
-00030d10: 7261 6973 6522 2c20 2269 676e 6f72 6522  raise", "ignore"
-00030d20: 5d3a 0a20 2020 2020 2020 2020 2020 2072  ]:.            r
-00030d30: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00030d40: 2765 7272 6f72 7320 6d75 7374 2062 6520  'errors must be 
-00030d50: 6569 7468 6572 2022 7261 6973 6522 206f  either "raise" o
-00030d60: 7220 2269 676e 6f72 6522 2729 0a0a 2020  r "ignore"')..  
-00030d70: 2020 2020 2020 6c61 6265 6c73 203d 2065        labels = e
-00030d80: 6974 6865 725f 6469 6374 5f6f 725f 6b77  ither_dict_or_kw
-00030d90: 6172 6773 286c 6162 656c 732c 206c 6162  args(labels, lab
-00030da0: 656c 735f 6b77 6172 6773 2c20 2264 726f  els_kwargs, "dro
-00030db0: 705f 7365 6c22 290a 0a20 2020 2020 2020  p_sel")..       
-00030dc0: 2064 7320 3d20 7365 6c66 0a20 2020 2020   ds = self.     
-00030dd0: 2020 2066 6f72 2064 696d 2c20 6c61 6265     for dim, labe
-00030de0: 6c73 5f66 6f72 5f64 696d 2069 6e20 6c61  ls_for_dim in la
-00030df0: 6265 6c73 2e69 7465 6d73 2829 3a0a 2020  bels.items():.  
-00030e00: 2020 2020 2020 2020 2020 2320 446f 6e27            # Don'
-00030e10: 7420 6361 7374 2074 6f20 7365 742c 2061  t cast to set, a
-00030e20: 7320 6974 2077 6f75 6c64 2068 6172 6d20  s it would harm 
-00030e30: 7065 7266 6f72 6d61 6e63 6520 7768 656e  performance when
-00030e40: 206c 6162 656c 730a 2020 2020 2020 2020   labels.        
-00030e50: 2020 2020 2320 6973 2061 206c 6172 6765      # is a large
-00030e60: 206e 756d 7079 2061 7272 6179 0a20 2020   numpy array.   
-00030e70: 2020 2020 2020 2020 2069 6620 7574 696c           if util
-00030e80: 732e 6973 5f73 6361 6c61 7228 6c61 6265  s.is_scalar(labe
-00030e90: 6c73 5f66 6f72 5f64 696d 293a 0a20 2020  ls_for_dim):.   
-00030ea0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-00030eb0: 656c 735f 666f 725f 6469 6d20 3d20 5b6c  els_for_dim = [l
-00030ec0: 6162 656c 735f 666f 725f 6469 6d5d 0a20  abels_for_dim]. 
-00030ed0: 2020 2020 2020 2020 2020 206c 6162 656c             label
-00030ee0: 735f 666f 725f 6469 6d20 3d20 6e70 2e61  s_for_dim = np.a
-00030ef0: 7361 7272 6179 286c 6162 656c 735f 666f  sarray(labels_fo
-00030f00: 725f 6469 6d29 0a20 2020 2020 2020 2020  r_dim).         
-00030f10: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00030f20: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-00030f30: 7365 6c66 2e67 6574 5f69 6e64 6578 2864  self.get_index(d
-00030f40: 696d 290a 2020 2020 2020 2020 2020 2020  im).            
-00030f50: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
-00030f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030f70: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00030f80: 7228 6622 6469 6d65 6e73 696f 6e20 7b64  r(f"dimension {d
-00030f90: 696d 2172 7d20 646f 6573 206e 6f74 2068  im!r} does not h
-00030fa0: 6176 6520 636f 6f72 6469 6e61 7465 206c  ave coordinate l
-00030fb0: 6162 656c 7322 290a 2020 2020 2020 2020  abels").        
-00030fc0: 2020 2020 6e65 775f 696e 6465 7820 3d20      new_index = 
-00030fd0: 696e 6465 782e 6472 6f70 286c 6162 656c  index.drop(label
-00030fe0: 735f 666f 725f 6469 6d2c 2065 7272 6f72  s_for_dim, error
-00030ff0: 733d 6572 726f 7273 290a 2020 2020 2020  s=errors).      
-00031000: 2020 2020 2020 6473 203d 2064 732e 6c6f        ds = ds.lo
-00031010: 635b 7b64 696d 3a20 6e65 775f 696e 6465  c[{dim: new_inde
-00031020: 787d 5d0a 2020 2020 2020 2020 7265 7475  x}].        retu
-00031030: 726e 2064 730a 0a20 2020 2064 6566 2064  rn ds..    def d
-00031040: 726f 705f 6973 656c 2873 656c 663a 2054  rop_isel(self: T
-00031050: 5f44 6174 6173 6574 2c20 696e 6465 7865  _Dataset, indexe
-00031060: 7273 3d4e 6f6e 652c 202a 2a69 6e64 6578  rs=None, **index
-00031070: 6572 735f 6b77 6172 6773 2920 2d3e 2054  ers_kwargs) -> T
-00031080: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00031090: 2020 2222 2244 726f 7020 696e 6465 7820    """Drop index 
-000310a0: 706f 7369 7469 6f6e 7320 6672 6f6d 2074  positions from t
-000310b0: 6869 7320 4461 7461 7365 742e 0a0a 2020  his Dataset...  
-000310c0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-000310d0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000310e0: 2d2d 2d0a 2020 2020 2020 2020 696e 6465  ---.        inde
-000310f0: 7865 7273 203a 206d 6170 7069 6e67 206f  xers : mapping o
-00031100: 6620 6861 7368 6162 6c65 2074 6f20 416e  f hashable to An
-00031110: 790a 2020 2020 2020 2020 2020 2020 496e  y.            In
-00031120: 6465 7820 6c6f 6361 7469 6f6e 7320 746f  dex locations to
-00031130: 2064 726f 700a 2020 2020 2020 2020 2a2a   drop.        **
-00031140: 696e 6465 7865 7273 5f6b 7761 7267 7320  indexers_kwargs 
-00031150: 3a20 7b64 696d 3a20 706f 7369 7469 6f6e  : {dim: position
-00031160: 2c20 2e2e 2e7d 2c20 6f70 7469 6f6e 616c  , ...}, optional
-00031170: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00031180: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00031190: 7473 2066 6f72 6d20 6f66 2060 6064 696d  ts form of ``dim
-000311a0: 6060 2061 6e64 2060 6070 6f73 6974 696f  `` and ``positio
-000311b0: 6e73 6060 0a0a 2020 2020 2020 2020 5265  ns``..        Re
-000311c0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-000311d0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6472  -----.        dr
-000311e0: 6f70 7065 6420 3a20 4461 7461 7365 740a  opped : Dataset.
-000311f0: 0a20 2020 2020 2020 2052 6169 7365 730a  .        Raises.
-00031200: 2020 2020 2020 2020 2d2d 2d2d 2d2d 0a20          ------. 
-00031210: 2020 2020 2020 2049 6e64 6578 4572 726f         IndexErro
-00031220: 720a 0a20 2020 2020 2020 2045 7861 6d70  r..        Examp
-00031230: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
-00031240: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
-00031250: 2064 6174 6120 3d20 6e70 2e61 7261 6e67   data = np.arang
-00031260: 6528 3629 2e72 6573 6861 7065 2832 2c20  e(6).reshape(2, 
-00031270: 3329 0a20 2020 2020 2020 203e 3e3e 206c  3).        >>> l
-00031280: 6162 656c 7320 3d20 5b22 6122 2c20 2262  abels = ["a", "b
-00031290: 222c 2022 6322 5d0a 2020 2020 2020 2020  ", "c"].        
-000312a0: 3e3e 3e20 6473 203d 2078 722e 4461 7461  >>> ds = xr.Data
-000312b0: 7365 7428 7b22 4122 3a20 285b 2278 222c  set({"A": (["x",
-000312c0: 2022 7922 5d2c 2064 6174 6129 2c20 2279   "y"], data), "y
-000312d0: 223a 206c 6162 656c 737d 290a 2020 2020  ": labels}).    
-000312e0: 2020 2020 3e3e 3e20 6473 0a20 2020 2020      >>> ds.     
-000312f0: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-00031300: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-00031310: 6e73 696f 6e73 3a20 2028 783a 2032 2c20  nsions:  (x: 2, 
-00031320: 793a 2033 290a 2020 2020 2020 2020 436f  y: 3).        Co
-00031330: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
-00031340: 2020 2020 202a 2079 2020 2020 2020 2020       * y        
-00031350: 2879 2920 3c55 3120 2761 2720 2762 2720  (y) <U1 'a' 'b' 
-00031360: 2763 270a 2020 2020 2020 2020 4469 6d65  'c'.        Dime
-00031370: 6e73 696f 6e73 2077 6974 686f 7574 2063  nsions without c
-00031380: 6f6f 7264 696e 6174 6573 3a20 780a 2020  oordinates: x.  
-00031390: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
-000313a0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-000313b0: 2020 4120 2020 2020 2020 2028 782c 2079    A        (x, y
-000313c0: 2920 696e 7436 3420 3020 3120 3220 3320  ) int64 0 1 2 3 
-000313d0: 3420 350a 2020 2020 2020 2020 3e3e 3e20  4 5.        >>> 
-000313e0: 6473 2e64 726f 705f 6973 656c 2879 3d5b  ds.drop_isel(y=[
-000313f0: 302c 2032 5d29 0a20 2020 2020 2020 203c  0, 2]).        <
-00031400: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
-00031410: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00031420: 6e73 3a20 2028 783a 2032 2c20 793a 2031  ns:  (x: 2, y: 1
-00031430: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
-00031440: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
-00031450: 202a 2079 2020 2020 2020 2020 2879 2920   * y        (y) 
-00031460: 3c55 3120 2762 270a 2020 2020 2020 2020  <U1 'b'.        
-00031470: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
-00031480: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
-00031490: 780a 2020 2020 2020 2020 4461 7461 2076  x.        Data v
-000314a0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
-000314b0: 2020 2020 2020 4120 2020 2020 2020 2028        A        (
-000314c0: 782c 2079 2920 696e 7436 3420 3120 340a  x, y) int64 1 4.
-000314d0: 2020 2020 2020 2020 3e3e 3e20 6473 2e64          >>> ds.d
-000314e0: 726f 705f 6973 656c 2879 3d31 290a 2020  rop_isel(y=1).  
-000314f0: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-00031500: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-00031510: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
-00031520: 322c 2079 3a20 3229 0a20 2020 2020 2020  2, y: 2).       
-00031530: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-00031540: 2020 2020 2020 2020 2a20 7920 2020 2020          * y     
-00031550: 2020 2028 7929 203c 5531 2027 6127 2027     (y) <U1 'a' '
-00031560: 6327 0a20 2020 2020 2020 2044 696d 656e  c'.        Dimen
-00031570: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
-00031580: 6f72 6469 6e61 7465 733a 2078 0a20 2020  ordinates: x.   
-00031590: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-000315a0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-000315b0: 2041 2020 2020 2020 2020 2878 2c20 7929   A        (x, y)
-000315c0: 2069 6e74 3634 2030 2032 2033 2035 0a20   int64 0 2 3 5. 
-000315d0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000315e0: 2020 2020 696e 6465 7865 7273 203d 2065      indexers = e
-000315f0: 6974 6865 725f 6469 6374 5f6f 725f 6b77  ither_dict_or_kw
-00031600: 6172 6773 2869 6e64 6578 6572 732c 2069  args(indexers, i
-00031610: 6e64 6578 6572 735f 6b77 6172 6773 2c20  ndexers_kwargs, 
-00031620: 2264 726f 705f 6973 656c 2229 0a0a 2020  "drop_isel")..  
-00031630: 2020 2020 2020 6473 203d 2073 656c 660a        ds = self.
-00031640: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
-00031650: 6e5f 696e 6465 7820 3d20 7b7d 0a20 2020  n_index = {}.   
-00031660: 2020 2020 2066 6f72 2064 696d 2c20 706f       for dim, po
-00031670: 735f 666f 725f 6469 6d20 696e 2069 6e64  s_for_dim in ind
-00031680: 6578 6572 732e 6974 656d 7328 293a 0a20  exers.items():. 
-00031690: 2020 2020 2020 2020 2020 2023 2044 6f6e             # Don
-000316a0: 2774 2063 6173 7420 746f 2073 6574 2c20  't cast to set, 
-000316b0: 6173 2069 7420 776f 756c 6420 6861 726d  as it would harm
-000316c0: 2070 6572 666f 726d 616e 6365 2077 6865   performance whe
-000316d0: 6e20 6c61 6265 6c73 0a20 2020 2020 2020  n labels.       
-000316e0: 2020 2020 2023 2069 7320 6120 6c61 7267       # is a larg
-000316f0: 6520 6e75 6d70 7920 6172 7261 790a 2020  e numpy array.  
-00031700: 2020 2020 2020 2020 2020 6966 2075 7469            if uti
-00031710: 6c73 2e69 735f 7363 616c 6172 2870 6f73  ls.is_scalar(pos
-00031720: 5f66 6f72 5f64 696d 293a 0a20 2020 2020  _for_dim):.     
-00031730: 2020 2020 2020 2020 2020 2070 6f73 5f66             pos_f
-00031740: 6f72 5f64 696d 203d 205b 706f 735f 666f  or_dim = [pos_fo
-00031750: 725f 6469 6d5d 0a20 2020 2020 2020 2020  r_dim].         
-00031760: 2020 2070 6f73 5f66 6f72 5f64 696d 203d     pos_for_dim =
-00031770: 206e 702e 6173 6172 7261 7928 706f 735f   np.asarray(pos_
-00031780: 666f 725f 6469 6d29 0a20 2020 2020 2020  for_dim).       
-00031790: 2020 2020 2069 6e64 6578 203d 2073 656c       index = sel
-000317a0: 662e 6765 745f 696e 6465 7828 6469 6d29  f.get_index(dim)
-000317b0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-000317c0: 5f69 6e64 6578 203d 2069 6e64 6578 2e64  _index = index.d
-000317d0: 656c 6574 6528 706f 735f 666f 725f 6469  elete(pos_for_di
-000317e0: 6d29 0a20 2020 2020 2020 2020 2020 2064  m).            d
-000317f0: 696d 656e 7369 6f6e 5f69 6e64 6578 5b64  imension_index[d
-00031800: 696d 5d20 3d20 6e65 775f 696e 6465 780a  im] = new_index.
-00031810: 2020 2020 2020 2020 6473 203d 2064 732e          ds = ds.
-00031820: 6c6f 635b 6469 6d65 6e73 696f 6e5f 696e  loc[dimension_in
-00031830: 6465 785d 0a20 2020 2020 2020 2072 6574  dex].        ret
-00031840: 7572 6e20 6473 0a0a 2020 2020 6465 6620  urn ds..    def 
-00031850: 6472 6f70 5f64 696d 7328 0a20 2020 2020  drop_dims(.     
-00031860: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-00031870: 6574 2c0a 2020 2020 2020 2020 6472 6f70  et,.        drop
-00031880: 5f64 696d 733a 2073 7472 207c 2049 7465  _dims: str | Ite
-00031890: 7261 626c 655b 4861 7368 6162 6c65 5d2c  rable[Hashable],
-000318a0: 0a20 2020 2020 2020 202a 2c0a 2020 2020  .        *,.    
-000318b0: 2020 2020 6572 726f 7273 3a20 4572 726f      errors: Erro
-000318c0: 724f 7074 696f 6e73 203d 2022 7261 6973  rOptions = "rais
-000318d0: 6522 2c0a 2020 2020 2920 2d3e 2054 5f44  e",.    ) -> T_D
-000318e0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-000318f0: 2222 2244 726f 7020 6469 6d65 6e73 696f  """Drop dimensio
-00031900: 6e73 2061 6e64 2061 7373 6f63 6961 7465  ns and associate
-00031910: 6420 7661 7269 6162 6c65 7320 6672 6f6d  d variables from
-00031920: 2074 6869 7320 6461 7461 7365 742e 0a0a   this dataset...
-00031930: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00031940: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00031950: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6472  -----.        dr
-00031960: 6f70 5f64 696d 7320 3a20 7374 7220 6f72  op_dims : str or
-00031970: 2049 7465 7261 626c 6520 6f66 2048 6173   Iterable of Has
-00031980: 6861 626c 650a 2020 2020 2020 2020 2020  hable.          
-00031990: 2020 4469 6d65 6e73 696f 6e20 6f72 2064    Dimension or d
-000319a0: 696d 656e 7369 6f6e 7320 746f 2064 726f  imensions to dro
-000319b0: 702e 0a20 2020 2020 2020 2065 7272 6f72  p..        error
-000319c0: 7320 3a20 7b22 7261 6973 6522 2c20 2269  s : {"raise", "i
-000319d0: 676e 6f72 6522 7d2c 2064 6566 6175 6c74  gnore"}, default
-000319e0: 3a20 2272 6169 7365 220a 2020 2020 2020  : "raise".      
-000319f0: 2020 2020 2020 4966 2027 7261 6973 6527        If 'raise'
-00031a00: 2c20 7261 6973 6573 2061 2056 616c 7565  , raises a Value
-00031a10: 4572 726f 7220 6572 726f 7220 6966 2061  Error error if a
-00031a20: 6e79 206f 6620 7468 650a 2020 2020 2020  ny of the.      
-00031a30: 2020 2020 2020 6469 6d65 6e73 696f 6e73        dimensions
-00031a40: 2070 6173 7365 6420 6172 6520 6e6f 7420   passed are not 
-00031a50: 696e 2074 6865 2064 6174 6173 6574 2e20  in the dataset. 
-00031a60: 4966 2027 6967 6e6f 7265 272c 2061 6e79  If 'ignore', any
-00031a70: 2067 6976 656e 0a20 2020 2020 2020 2020   given.         
-00031a80: 2020 2064 696d 656e 7369 6f6e 7320 7468     dimensions th
-00031a90: 6174 2061 7265 2069 6e20 7468 6520 6461  at are in the da
-00031aa0: 7461 7365 7420 6172 6520 6472 6f70 7065  taset are droppe
-00031ab0: 6420 616e 6420 6e6f 2065 7272 6f72 2069  d and no error i
-00031ac0: 7320 7261 6973 6564 2e0a 0a20 2020 2020  s raised...     
-00031ad0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00031ae0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00031af0: 2020 206f 626a 203a 2044 6174 6173 6574     obj : Dataset
-00031b00: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00031b10: 2064 6174 6173 6574 2077 6974 686f 7574   dataset without
-00031b20: 2074 6865 2067 6976 656e 2064 696d 656e   the given dimen
-00031b30: 7369 6f6e 7320 286f 7220 616e 7920 7661  sions (or any va
-00031b40: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
-00031b50: 2020 2020 636f 6e74 6169 6e69 6e67 2074      containing t
-00031b60: 686f 7365 2064 696d 656e 7369 6f6e 7329  hose dimensions)
-00031b70: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00031b80: 2020 2020 2020 6966 2065 7272 6f72 7320        if errors 
-00031b90: 6e6f 7420 696e 205b 2272 6169 7365 222c  not in ["raise",
-00031ba0: 2022 6967 6e6f 7265 225d 3a0a 2020 2020   "ignore"]:.    
-00031bb0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00031bc0: 6c75 6545 7272 6f72 2827 6572 726f 7273  lueError('errors
-00031bd0: 206d 7573 7420 6265 2065 6974 6865 7220   must be either 
-00031be0: 2272 6169 7365 2220 6f72 2022 6967 6e6f  "raise" or "igno
-00031bf0: 7265 2227 290a 0a20 2020 2020 2020 2069  re"')..        i
-00031c00: 6620 6973 696e 7374 616e 6365 2864 726f  f isinstance(dro
-00031c10: 705f 6469 6d73 2c20 7374 7229 206f 7220  p_dims, str) or 
-00031c20: 6e6f 7420 6973 696e 7374 616e 6365 2864  not isinstance(d
-00031c30: 726f 705f 6469 6d73 2c20 4974 6572 6162  rop_dims, Iterab
-00031c40: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00031c50: 2064 726f 705f 6469 6d73 203d 207b 6472   drop_dims = {dr
-00031c60: 6f70 5f64 696d 737d 0a20 2020 2020 2020  op_dims}.       
-00031c70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00031c80: 2020 2064 726f 705f 6469 6d73 203d 2073     drop_dims = s
-00031c90: 6574 2864 726f 705f 6469 6d73 290a 0a20  et(drop_dims).. 
-00031ca0: 2020 2020 2020 2069 6620 6572 726f 7273         if errors
-00031cb0: 203d 3d20 2272 6169 7365 223a 0a20 2020   == "raise":.   
-00031cc0: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
-00031cd0: 5f64 696d 7320 3d20 6472 6f70 5f64 696d  _dims = drop_dim
-00031ce0: 7320 2d20 7365 7428 7365 6c66 2e64 696d  s - set(self.dim
-00031cf0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
-00031d00: 6620 6d69 7373 696e 675f 6469 6d73 3a0a  f missing_dims:.
-00031d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031d20: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00031d30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00031d40: 2020 2020 2020 6622 4461 7461 7365 7420        f"Dataset 
-00031d50: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
-00031d60: 2074 6865 2064 696d 656e 7369 6f6e 733a   the dimensions:
-00031d70: 207b 6d69 7373 696e 675f 6469 6d73 7d22   {missing_dims}"
-00031d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031d90: 2029 0a0a 2020 2020 2020 2020 6472 6f70   )..        drop
-00031da0: 5f76 6172 7320 3d20 7b6b 2066 6f72 206b  _vars = {k for k
-00031db0: 2c20 7620 696e 2073 656c 662e 5f76 6172  , v in self._var
-00031dc0: 6961 626c 6573 2e69 7465 6d73 2829 2069  iables.items() i
-00031dd0: 6620 7365 7428 762e 6469 6d73 2920 2620  f set(v.dims) & 
-00031de0: 6472 6f70 5f64 696d 737d 0a20 2020 2020  drop_dims}.     
-00031df0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
-00031e00: 726f 705f 7661 7273 2864 726f 705f 7661  rop_vars(drop_va
-00031e10: 7273 290a 0a20 2020 2064 6566 2074 7261  rs)..    def tra
-00031e20: 6e73 706f 7365 280a 2020 2020 2020 2020  nspose(.        
-00031e30: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-00031e40: 0a20 2020 2020 2020 202a 6469 6d73 3a20  .        *dims: 
-00031e50: 4861 7368 6162 6c65 2c0a 2020 2020 2020  Hashable,.      
-00031e60: 2020 6d69 7373 696e 675f 6469 6d73 3a20    missing_dims: 
-00031e70: 4572 726f 724f 7074 696f 6e73 5769 7468  ErrorOptionsWith
-00031e80: 5761 726e 203d 2022 7261 6973 6522 2c0a  Warn = "raise",.
-00031e90: 2020 2020 2920 2d3e 2054 5f44 6174 6173      ) -> T_Datas
-00031ea0: 6574 3a0a 2020 2020 2020 2020 2222 2252  et:.        """R
-00031eb0: 6574 7572 6e20 6120 6e65 7720 4461 7461  eturn a new Data
-00031ec0: 7365 7420 6f62 6a65 6374 2077 6974 6820  set object with 
-00031ed0: 616c 6c20 6172 7261 7920 6469 6d65 6e73  all array dimens
-00031ee0: 696f 6e73 2074 7261 6e73 706f 7365 642e  ions transposed.
-00031ef0: 0a0a 2020 2020 2020 2020 416c 7468 6f75  ..        Althou
-00031f00: 6768 2074 6865 206f 7264 6572 206f 6620  gh the order of 
-00031f10: 6469 6d65 6e73 696f 6e73 206f 6e20 6561  dimensions on ea
-00031f20: 6368 2061 7272 6179 2077 696c 6c20 6368  ch array will ch
-00031f30: 616e 6765 2c20 7468 6520 6461 7461 7365  ange, the datase
-00031f40: 740a 2020 2020 2020 2020 6469 6d65 6e73  t.        dimens
-00031f50: 696f 6e73 2074 6865 6d73 656c 7665 7320  ions themselves 
-00031f60: 7769 6c6c 2072 656d 6169 6e20 696e 2066  will remain in f
-00031f70: 6978 6564 2028 736f 7274 6564 2920 6f72  ixed (sorted) or
-00031f80: 6465 722e 0a0a 2020 2020 2020 2020 5061  der...        Pa
-00031f90: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00031fa0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00031fb0: 2020 2020 2a64 696d 7320 3a20 6861 7368      *dims : hash
-00031fc0: 6162 6c65 2c20 6f70 7469 6f6e 616c 0a20  able, optional. 
-00031fd0: 2020 2020 2020 2020 2020 2042 7920 6465             By de
-00031fe0: 6661 756c 742c 2072 6576 6572 7365 2074  fault, reverse t
-00031ff0: 6865 2064 696d 656e 7369 6f6e 7320 6f6e  he dimensions on
-00032000: 2065 6163 6820 6172 7261 792e 204f 7468   each array. Oth
-00032010: 6572 7769 7365 2c0a 2020 2020 2020 2020  erwise,.        
-00032020: 2020 2020 7265 6f72 6465 7220 7468 6520      reorder the 
-00032030: 6469 6d65 6e73 696f 6e73 2074 6f20 7468  dimensions to th
-00032040: 6973 206f 7264 6572 2e0a 2020 2020 2020  is order..      
-00032050: 2020 6d69 7373 696e 675f 6469 6d73 203a    missing_dims :
-00032060: 207b 2272 6169 7365 222c 2022 7761 726e   {"raise", "warn
-00032070: 222c 2022 6967 6e6f 7265 227d 2c20 6465  ", "ignore"}, de
-00032080: 6661 756c 743a 2022 7261 6973 6522 0a20  fault: "raise". 
-00032090: 2020 2020 2020 2020 2020 2057 6861 7420             What 
-000320a0: 746f 2064 6f20 6966 2064 696d 656e 7369  to do if dimensi
-000320b0: 6f6e 7320 7468 6174 2073 686f 756c 6420  ons that should 
-000320c0: 6265 2073 656c 6563 7465 6420 6672 6f6d  be selected from
-000320d0: 2061 7265 206e 6f74 2070 7265 7365 6e74   are not present
-000320e0: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
-000320f0: 2020 2020 4461 7461 7365 743a 0a20 2020      Dataset:.   
-00032100: 2020 2020 2020 2020 202d 2022 7261 6973           - "rais
-00032110: 6522 3a20 7261 6973 6520 616e 2065 7863  e": raise an exc
-00032120: 6570 7469 6f6e 0a20 2020 2020 2020 2020  eption.         
-00032130: 2020 202d 2022 7761 726e 223a 2072 6169     - "warn": rai
-00032140: 7365 2061 2077 6172 6e69 6e67 2c20 616e  se a warning, an
-00032150: 6420 6967 6e6f 7265 2074 6865 206d 6973  d ignore the mis
-00032160: 7369 6e67 2064 696d 656e 7369 6f6e 730a  sing dimensions.
-00032170: 2020 2020 2020 2020 2020 2020 2d20 2269              - "i
-00032180: 676e 6f72 6522 3a20 6967 6e6f 7265 2074  gnore": ignore t
-00032190: 6865 206d 6973 7369 6e67 2064 696d 656e  he missing dimen
-000321a0: 7369 6f6e 730a 0a20 2020 2020 2020 2052  sions..        R
-000321b0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-000321c0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2074  ------.        t
-000321d0: 7261 6e73 706f 7365 6420 3a20 4461 7461  ransposed : Data
-000321e0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-000321f0: 4561 6368 2061 7272 6179 2069 6e20 7468  Each array in th
-00032200: 6520 6461 7461 7365 7420 2869 6e63 6c75  e dataset (inclu
-00032210: 6469 6e67 2920 636f 6f72 6469 6e61 7465  ding) coordinate
-00032220: 7320 7769 6c6c 2062 650a 2020 2020 2020  s will be.      
-00032230: 2020 2020 2020 7472 616e 7370 6f73 6564        transposed
-00032240: 2074 6f20 7468 6520 6769 7665 6e20 6f72   to the given or
-00032250: 6465 722e 0a0a 2020 2020 2020 2020 4e6f  der...        No
-00032260: 7465 730a 2020 2020 2020 2020 2d2d 2d2d  tes.        ----
-00032270: 2d0a 2020 2020 2020 2020 5468 6973 206f  -.        This o
-00032280: 7065 7261 7469 6f6e 2072 6574 7572 6e73  peration returns
-00032290: 2061 2076 6965 7720 6f66 2065 6163 6820   a view of each 
-000322a0: 6172 7261 7927 7320 6461 7461 2e20 4974  array's data. It
-000322b0: 2069 730a 2020 2020 2020 2020 6c61 7a79   is.        lazy
-000322c0: 2066 6f72 2064 6173 6b2d 6261 636b 6564   for dask-backed
-000322d0: 2044 6174 6141 7272 6179 7320 6275 7420   DataArrays but 
-000322e0: 6e6f 7420 666f 7220 6e75 6d70 792d 6261  not for numpy-ba
-000322f0: 636b 6564 2044 6174 6141 7272 6179 730a  cked DataArrays.
-00032300: 2020 2020 2020 2020 2d2d 2074 6865 2064          -- the d
-00032310: 6174 6120 7769 6c6c 2062 6520 6675 6c6c  ata will be full
-00032320: 7920 6c6f 6164 6564 2069 6e74 6f20 6d65  y loaded into me
-00032330: 6d6f 7279 2e0a 0a20 2020 2020 2020 2053  mory...        S
-00032340: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-00032350: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00032360: 206e 756d 7079 2e74 7261 6e73 706f 7365   numpy.transpose
-00032370: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-00032380: 6179 2e74 7261 6e73 706f 7365 0a20 2020  ay.transpose.   
-00032390: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000323a0: 2023 2052 6169 7365 2065 7272 6f72 2069   # Raise error i
-000323b0: 6620 6c69 7374 2069 7320 7061 7373 6564  f list is passed
-000323c0: 2061 7320 6469 6d73 0a20 2020 2020 2020   as dims.       
-000323d0: 2069 6620 286c 656e 2864 696d 7329 203e   if (len(dims) >
-000323e0: 2030 2920 616e 6420 2869 7369 6e73 7461   0) and (isinsta
-000323f0: 6e63 6528 6469 6d73 5b30 5d2c 206c 6973  nce(dims[0], lis
-00032400: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
-00032410: 206c 6973 745f 6669 7820 3d20 5b66 227b   list_fix = [f"{
-00032420: 7265 7072 2878 297d 2220 6966 2069 7369  repr(x)}" if isi
-00032430: 6e73 7461 6e63 6528 782c 2073 7472 2920  nstance(x, str) 
-00032440: 656c 7365 2066 227b 787d 2220 666f 7220  else f"{x}" for 
-00032450: 7820 696e 2064 696d 735b 305d 5d0a 2020  x in dims[0]].  
-00032460: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00032470: 5479 7065 4572 726f 7228 0a20 2020 2020  TypeError(.     
-00032480: 2020 2020 2020 2020 2020 2066 2774 7261             f'tra
-00032490: 6e73 706f 7365 2072 6571 7569 7265 7320  nspose requires 
-000324a0: 6469 6d73 2074 6f20 6265 2070 6173 7365  dims to be passe
-000324b0: 6420 6173 206d 756c 7469 706c 6520 6172  d as multiple ar
-000324c0: 6775 6d65 6e74 732e 2045 7870 6563 7465  guments. Expecte
-000324d0: 6420 607b 222c 2022 2e6a 6f69 6e28 6c69  d `{", ".join(li
-000324e0: 7374 5f66 6978 297d 602e 2052 6563 6569  st_fix)}`. Recei
-000324f0: 7665 6420 607b 6469 6d73 5b30 5d7d 6020  ved `{dims[0]}` 
-00032500: 696e 7374 6561 6427 0a20 2020 2020 2020  instead'.       
-00032510: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00032520: 2320 5573 6520 696e 6669 785f 6469 6d73  # Use infix_dims
-00032530: 2074 6f20 6368 6563 6b20 6f6e 6365 2066   to check once f
-00032540: 6f72 206d 6973 7369 6e67 2064 696d 656e  or missing dimen
-00032550: 7369 6f6e 730a 2020 2020 2020 2020 6966  sions.        if
-00032560: 206c 656e 2864 696d 7329 2021 3d20 303a   len(dims) != 0:
-00032570: 0a20 2020 2020 2020 2020 2020 205f 203d  .            _ =
-00032580: 206c 6973 7428 696e 6669 785f 6469 6d73   list(infix_dims
-00032590: 2864 696d 732c 2073 656c 662e 6469 6d73  (dims, self.dims
-000325a0: 2c20 6d69 7373 696e 675f 6469 6d73 2929  , missing_dims))
-000325b0: 0a0a 2020 2020 2020 2020 6473 203d 2073  ..        ds = s
-000325c0: 656c 662e 636f 7079 2829 0a20 2020 2020  elf.copy().     
-000325d0: 2020 2066 6f72 206e 616d 652c 2076 6172     for name, var
-000325e0: 2069 6e20 7365 6c66 2e5f 7661 7269 6162   in self._variab
-000325f0: 6c65 732e 6974 656d 7328 293a 0a20 2020  les.items():.   
-00032600: 2020 2020 2020 2020 2076 6172 5f64 696d           var_dim
-00032610: 7320 3d20 7475 706c 6528 6469 6d20 666f  s = tuple(dim fo
-00032620: 7220 6469 6d20 696e 2064 696d 7320 6966  r dim in dims if
-00032630: 2064 696d 2069 6e20 2876 6172 2e64 696d   dim in (var.dim
-00032640: 7320 2b20 282e 2e2e 2c29 2929 0a20 2020  s + (...,))).   
-00032650: 2020 2020 2020 2020 2064 732e 5f76 6172           ds._var
-00032660: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
-00032670: 6172 2e74 7261 6e73 706f 7365 282a 7661  ar.transpose(*va
-00032680: 725f 6469 6d73 290a 2020 2020 2020 2020  r_dims).        
-00032690: 7265 7475 726e 2064 730a 0a20 2020 2064  return ds..    d
-000326a0: 6566 2064 726f 706e 6128 0a20 2020 2020  ef dropna(.     
-000326b0: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-000326c0: 6574 2c0a 2020 2020 2020 2020 6469 6d3a  et,.        dim:
-000326d0: 2048 6173 6861 626c 652c 0a20 2020 2020   Hashable,.     
-000326e0: 2020 2068 6f77 3a20 4c69 7465 7261 6c5b     how: Literal[
-000326f0: 2261 6e79 222c 2022 616c 6c22 5d20 3d20  "any", "all"] = 
-00032700: 2261 6e79 222c 0a20 2020 2020 2020 2074  "any",.        t
-00032710: 6872 6573 683a 2069 6e74 207c 204e 6f6e  hresh: int | Non
-00032720: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00032730: 2020 7375 6273 6574 3a20 4974 6572 6162    subset: Iterab
-00032740: 6c65 5b48 6173 6861 626c 655d 207c 204e  le[Hashable] | N
-00032750: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00032760: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-00032770: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00032780: 6e73 2061 206e 6577 2064 6174 6173 6574  ns a new dataset
-00032790: 2077 6974 6820 6472 6f70 7065 6420 6c61   with dropped la
-000327a0: 6265 6c73 2066 6f72 206d 6973 7369 6e67  bels for missing
-000327b0: 2076 616c 7565 7320 616c 6f6e 670a 2020   values along.  
-000327c0: 2020 2020 2020 7468 6520 7072 6f76 6964        the provid
-000327d0: 6564 2064 696d 656e 7369 6f6e 2e0a 0a20  ed dimension... 
-000327e0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-000327f0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00032800: 2d2d 2d2d 0a20 2020 2020 2020 2064 696d  ----.        dim
-00032810: 203a 2068 6173 6861 626c 650a 2020 2020   : hashable.    
-00032820: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00032830: 6e20 616c 6f6e 6720 7768 6963 6820 746f  n along which to
-00032840: 2064 726f 7020 6d69 7373 696e 6720 7661   drop missing va
-00032850: 6c75 6573 2e20 4472 6f70 7069 6e67 2061  lues. Dropping a
-00032860: 6c6f 6e67 0a20 2020 2020 2020 2020 2020  long.           
-00032870: 206d 756c 7469 706c 6520 6469 6d65 6e73   multiple dimens
-00032880: 696f 6e73 2073 696d 756c 7461 6e65 6f75  ions simultaneou
-00032890: 736c 7920 6973 206e 6f74 2079 6574 2073  sly is not yet s
-000328a0: 7570 706f 7274 6564 2e0a 2020 2020 2020  upported..      
-000328b0: 2020 686f 7720 3a20 7b22 616e 7922 2c20    how : {"any", 
-000328c0: 2261 6c6c 227d 2c20 6465 6661 756c 743a  "all"}, default:
-000328d0: 2022 616e 7922 0a20 2020 2020 2020 2020   "any".         
-000328e0: 2020 202d 2061 6e79 203a 2069 6620 616e     - any : if an
-000328f0: 7920 4e41 2076 616c 7565 7320 6172 6520  y NA values are 
-00032900: 7072 6573 656e 742c 2064 726f 7020 7468  present, drop th
-00032910: 6174 206c 6162 656c 0a20 2020 2020 2020  at label.       
-00032920: 2020 2020 202d 2061 6c6c 203a 2069 6620       - all : if 
-00032930: 616c 6c20 7661 6c75 6573 2061 7265 204e  all values are N
-00032940: 412c 2064 726f 7020 7468 6174 206c 6162  A, drop that lab
-00032950: 656c 0a0a 2020 2020 2020 2020 7468 7265  el..        thre
-00032960: 7368 203a 2069 6e74 206f 7220 4e6f 6e65  sh : int or None
-00032970: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00032980: 2020 2020 2020 2049 6620 7375 7070 6c69         If suppli
-00032990: 6564 2c20 7265 7175 6972 6520 7468 6973  ed, require this
-000329a0: 206d 616e 7920 6e6f 6e2d 4e41 2076 616c   many non-NA val
-000329b0: 7565 7320 2873 756d 6d65 6420 6f76 6572  ues (summed over
-000329c0: 2061 6c6c 2074 6865 2073 7562 7365 7420   all the subset 
-000329d0: 7661 7269 6162 6c65 7329 2e0a 2020 2020  variables)..    
-000329e0: 2020 2020 7375 6273 6574 203a 2069 7465      subset : ite
-000329f0: 7261 626c 6520 6f66 2068 6173 6861 626c  rable of hashabl
-00032a00: 6520 6f72 204e 6f6e 652c 206f 7074 696f  e or None, optio
-00032a10: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00032a20: 5768 6963 6820 7661 7269 6162 6c65 7320  Which variables 
-00032a30: 746f 2063 6865 636b 2066 6f72 206d 6973  to check for mis
-00032a40: 7369 6e67 2076 616c 7565 732e 2042 7920  sing values. By 
-00032a50: 6465 6661 756c 742c 2061 6c6c 0a20 2020  default, all.   
-00032a60: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00032a70: 6573 2069 6e20 7468 6520 6461 7461 7365  es in the datase
-00032a80: 7420 6172 6520 6368 6563 6b65 642e 0a0a  t are checked...
-00032a90: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00032aa0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00032ab0: 2020 2020 2020 2020 4461 7461 7365 740a          Dataset.
-00032ac0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00032ad0: 2020 2020 2320 544f 444f 3a20 636f 6e73      # TODO: cons
-00032ae0: 6964 6572 2073 7570 706f 7274 696e 6720  ider supporting 
-00032af0: 6d75 6c74 6970 6c65 2064 696d 656e 7369  multiple dimensi
-00032b00: 6f6e 733f 204f 7220 6e6f 742c 2067 6976  ons? Or not, giv
-00032b10: 656e 2074 6861 740a 2020 2020 2020 2020  en that.        
-00032b20: 2320 7468 6572 6520 6172 6520 736f 6d65  # there are some
-00032b30: 2075 676c 7920 6564 6765 2063 6173 6573   ugly edge cases
-00032b40: 2c20 652e 672e 2c20 7061 6e64 6173 2773  , e.g., pandas's
-00032b50: 2064 726f 706e 6120 6469 6666 6572 730a   dropna differs.
-00032b60: 2020 2020 2020 2020 2320 6465 7065 6e64          # depend
-00032b70: 696e 6720 6f6e 2074 6865 206f 7264 6572  ing on the order
-00032b80: 206f 6620 7468 6520 7375 7070 6c69 6564   of the supplied
-00032b90: 2061 7865 732e 0a0a 2020 2020 2020 2020   axes...        
-00032ba0: 6966 2064 696d 206e 6f74 2069 6e20 7365  if dim not in se
-00032bb0: 6c66 2e64 696d 733a 0a20 2020 2020 2020  lf.dims:.       
-00032bc0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00032bd0: 4572 726f 7228 6622 7b64 696d 7d20 6d75  Error(f"{dim} mu
-00032be0: 7374 2062 6520 6120 7369 6e67 6c65 2064  st be a single d
-00032bf0: 6174 6173 6574 2064 696d 656e 7369 6f6e  ataset dimension
-00032c00: 2229 0a0a 2020 2020 2020 2020 6966 2073  ")..        if s
-00032c10: 7562 7365 7420 6973 204e 6f6e 653a 0a20  ubset is None:. 
-00032c20: 2020 2020 2020 2020 2020 2073 7562 7365             subse
-00032c30: 7420 3d20 6974 6572 2873 656c 662e 6461  t = iter(self.da
-00032c40: 7461 5f76 6172 7329 0a0a 2020 2020 2020  ta_vars)..      
-00032c50: 2020 636f 756e 7420 3d20 6e70 2e7a 6572    count = np.zer
-00032c60: 6f73 2873 656c 662e 6469 6d73 5b64 696d  os(self.dims[dim
-00032c70: 5d2c 2064 7479 7065 3d6e 702e 696e 7436  ], dtype=np.int6
-00032c80: 3429 0a20 2020 2020 2020 2073 697a 6520  4).        size 
-00032c90: 3d20 6e70 2e69 6e74 5f28 3029 2020 2320  = np.int_(0)  # 
-00032ca0: 666f 7220 7479 7065 2063 6865 636b 696e  for type checkin
-00032cb0: 670a 0a20 2020 2020 2020 2066 6f72 206b  g..        for k
-00032cc0: 2069 6e20 7375 6273 6574 3a0a 2020 2020   in subset:.    
-00032cd0: 2020 2020 2020 2020 6172 7261 7920 3d20          array = 
-00032ce0: 7365 6c66 2e5f 7661 7269 6162 6c65 735b  self._variables[
-00032cf0: 6b5d 0a20 2020 2020 2020 2020 2020 2069  k].            i
-00032d00: 6620 6469 6d20 696e 2061 7272 6179 2e64  f dim in array.d
-00032d10: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
-00032d20: 2020 2020 2064 696d 7320 3d20 5b64 2066       dims = [d f
-00032d30: 6f72 2064 2069 6e20 6172 7261 792e 6469  or d in array.di
-00032d40: 6d73 2069 6620 6420 213d 2064 696d 5d0a  ms if d != dim].
-00032d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d60: 636f 756e 7420 2b3d 206e 702e 6173 6172  count += np.asar
-00032d70: 7261 7928 6172 7261 792e 636f 756e 7428  ray(array.count(
-00032d80: 6469 6d73 2929 2020 2320 7479 7065 3a20  dims))  # type: 
-00032d90: 6967 6e6f 7265 5b61 7474 722d 6465 6669  ignore[attr-defi
-00032da0: 6e65 645d 0a20 2020 2020 2020 2020 2020  ned].           
-00032db0: 2020 2020 2073 697a 6520 2b3d 206d 6174       size += mat
-00032dc0: 682e 7072 6f64 285b 7365 6c66 2e64 696d  h.prod([self.dim
-00032dd0: 735b 645d 2066 6f72 2064 2069 6e20 6469  s[d] for d in di
-00032de0: 6d73 5d29 0a0a 2020 2020 2020 2020 6966  ms])..        if
-00032df0: 2074 6872 6573 6820 6973 206e 6f74 204e   thresh is not N
-00032e00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00032e10: 206d 6173 6b20 3d20 636f 756e 7420 3e3d   mask = count >=
-00032e20: 2074 6872 6573 680a 2020 2020 2020 2020   thresh.        
-00032e30: 656c 6966 2068 6f77 203d 3d20 2261 6e79  elif how == "any
-00032e40: 223a 0a20 2020 2020 2020 2020 2020 206d  ":.            m
-00032e50: 6173 6b20 3d20 636f 756e 7420 3d3d 2073  ask = count == s
-00032e60: 697a 650a 2020 2020 2020 2020 656c 6966  ize.        elif
-00032e70: 2068 6f77 203d 3d20 2261 6c6c 223a 0a20   how == "all":. 
-00032e80: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
-00032e90: 3d20 636f 756e 7420 3e20 300a 2020 2020  = count > 0.    
-00032ea0: 2020 2020 656c 6966 2068 6f77 2069 7320      elif how is 
-00032eb0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00032ec0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00032ed0: 6545 7272 6f72 2866 2269 6e76 616c 6964  eError(f"invalid
-00032ee0: 2068 6f77 206f 7074 696f 6e3a 207b 686f   how option: {ho
-00032ef0: 777d 2229 0a20 2020 2020 2020 2065 6c73  w}").        els
-00032f00: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00032f10: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
-00032f20: 6d75 7374 2073 7065 6369 6679 2068 6f77  must specify how
-00032f30: 206f 7220 7468 7265 7368 2229 0a0a 2020   or thresh")..  
-00032f40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00032f50: 662e 6973 656c 287b 6469 6d3a 206d 6173  f.isel({dim: mas
-00032f60: 6b7d 290a 0a20 2020 2064 6566 2066 696c  k})..    def fil
-00032f70: 6c6e 6128 7365 6c66 3a20 545f 4461 7461  lna(self: T_Data
-00032f80: 7365 742c 2076 616c 7565 3a20 416e 7929  set, value: Any)
-00032f90: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
-00032fa0: 2020 2020 2020 2022 2222 4669 6c6c 206d         """Fill m
-00032fb0: 6973 7369 6e67 2076 616c 7565 7320 696e  issing values in
-00032fc0: 2074 6869 7320 6f62 6a65 6374 2e0a 0a20   this object... 
-00032fd0: 2020 2020 2020 2054 6869 7320 6f70 6572         This oper
-00032fe0: 6174 696f 6e20 666f 6c6c 6f77 7320 7468  ation follows th
-00032ff0: 6520 6e6f 726d 616c 2062 726f 6164 6361  e normal broadca
-00033000: 7374 696e 6720 616e 6420 616c 6967 6e6d  sting and alignm
-00033010: 656e 7420 7275 6c65 7320 7468 6174 0a20  ent rules that. 
-00033020: 2020 2020 2020 2078 6172 7261 7920 7573         xarray us
-00033030: 6573 2066 6f72 2062 696e 6172 7920 6172  es for binary ar
-00033040: 6974 686d 6574 6963 2c20 6578 6365 7074  ithmetic, except
-00033050: 2074 6865 2072 6573 756c 7420 6973 2061   the result is a
-00033060: 6c69 676e 6564 2074 6f20 7468 6973 0a20  ligned to this. 
-00033070: 2020 2020 2020 206f 626a 6563 7420 2860         object (`
-00033080: 606a 6f69 6e3d 276c 6566 7427 6060 2920  `join='left'``) 
-00033090: 696e 7374 6561 6420 6f66 2061 6c69 676e  instead of align
-000330a0: 6564 2074 6f20 7468 6520 696e 7465 7273  ed to the inters
-000330b0: 6563 7469 6f6e 206f 660a 2020 2020 2020  ection of.      
-000330c0: 2020 696e 6465 7820 636f 6f72 6469 6e61    index coordina
-000330d0: 7465 7320 2860 606a 6f69 6e3d 2769 6e6e  tes (``join='inn
-000330e0: 6572 2760 6029 2e0a 0a20 2020 2020 2020  er'``)...       
-000330f0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00033100: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00033110: 2020 2020 2020 2076 616c 7565 203a 2073         value : s
-00033120: 6361 6c61 722c 206e 6461 7272 6179 2c20  calar, ndarray, 
-00033130: 4461 7461 4172 7261 792c 2064 6963 7420  DataArray, dict 
-00033140: 6f72 2044 6174 6173 6574 0a20 2020 2020  or Dataset.     
-00033150: 2020 2020 2020 2055 7365 6420 746f 2066         Used to f
-00033160: 696c 6c20 616c 6c20 6d61 7463 6869 6e67  ill all matching
-00033170: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
-00033180: 696e 2074 6869 7320 6461 7461 7365 7427  in this dataset'
-00033190: 7320 6461 7461 0a20 2020 2020 2020 2020  s data.         
-000331a0: 2020 2076 6172 6961 626c 6573 2e20 5363     variables. Sc
-000331b0: 616c 6172 732c 206e 6461 7272 6179 7320  alars, ndarrays 
-000331c0: 6f72 2044 6174 6141 7272 6179 7320 6172  or DataArrays ar
-000331d0: 6775 6d65 6e74 7320 6172 6520 7573 6564  guments are used
-000331e0: 2074 6f0a 2020 2020 2020 2020 2020 2020   to.            
-000331f0: 6669 6c6c 2061 6c6c 2064 6174 6120 7769  fill all data wi
-00033200: 7468 2061 6c69 676e 6564 2063 6f6f 7264  th aligned coord
-00033210: 696e 6174 6573 2028 666f 7220 4461 7461  inates (for Data
-00033220: 4172 7261 7973 292e 0a20 2020 2020 2020  Arrays)..       
-00033230: 2020 2020 2044 6963 7469 6f6e 6172 6965       Dictionarie
-00033240: 7320 6f72 2064 6174 6173 6574 7320 6d61  s or datasets ma
-00033250: 7463 6820 6461 7461 2076 6172 6961 626c  tch data variabl
-00033260: 6573 2061 6e64 2074 6865 6e20 616c 6967  es and then alig
-00033270: 6e0a 2020 2020 2020 2020 2020 2020 636f  n.            co
-00033280: 6f72 6469 6e61 7465 7320 6966 206e 6563  ordinates if nec
-00033290: 6573 7361 7279 2e0a 0a20 2020 2020 2020  essary...       
-000332a0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000332b0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-000332c0: 2044 6174 6173 6574 0a0a 2020 2020 2020   Dataset..      
-000332d0: 2020 4578 616d 706c 6573 0a20 2020 2020    Examples.     
-000332e0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-000332f0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
-00033300: 4461 7461 7365 7428 0a20 2020 2020 2020  Dataset(.       
-00033310: 202e 2e2e 2020 2020 207b 0a20 2020 2020   ...     {.     
-00033320: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
-00033330: 4122 3a20 2822 7822 2c20 5b6e 702e 6e61  A": ("x", [np.na
-00033340: 6e2c 2032 2c20 6e70 2e6e 616e 2c20 305d  n, 2, np.nan, 0]
-00033350: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
-00033360: 2020 2020 2020 2022 4222 3a20 2822 7822         "B": ("x"
-00033370: 2c20 5b33 2c20 342c 206e 702e 6e61 6e2c  , [3, 4, np.nan,
-00033380: 2031 5d29 2c0a 2020 2020 2020 2020 2e2e   1]),.        ..
-00033390: 2e20 2020 2020 2020 2020 2243 223a 2028  .         "C": (
-000333a0: 2278 222c 205b 6e70 2e6e 616e 2c20 6e70  "x", [np.nan, np
-000333b0: 2e6e 616e 2c20 6e70 2e6e 616e 2c20 355d  .nan, np.nan, 5]
-000333c0: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
-000333d0: 2020 2020 2020 2022 4422 3a20 2822 7822         "D": ("x"
-000333e0: 2c20 5b6e 702e 6e61 6e2c 2033 2c20 6e70  , [np.nan, 3, np
-000333f0: 2e6e 616e 2c20 345d 292c 0a20 2020 2020  .nan, 4]),.     
-00033400: 2020 202e 2e2e 2020 2020 207d 2c0a 2020     ...     },.  
-00033410: 2020 2020 2020 2e2e 2e20 2020 2020 636f        ...     co
-00033420: 6f72 6473 3d7b 2278 223a 205b 302c 2031  ords={"x": [0, 1
-00033430: 2c20 322c 2033 5d7d 2c0a 2020 2020 2020  , 2, 3]},.      
-00033440: 2020 2e2e 2e20 290a 2020 2020 2020 2020    ... ).        
-00033450: 3e3e 3e20 6473 0a20 2020 2020 2020 203c  >>> ds.        <
-00033460: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
-00033470: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00033480: 6e73 3a20 2028 783a 2034 290a 2020 2020  ns:  (x: 4).    
-00033490: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-000334a0: 0a20 2020 2020 2020 2020 202a 2078 2020  .          * x  
-000334b0: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-000334c0: 3020 3120 3220 330a 2020 2020 2020 2020  0 1 2 3.        
-000334d0: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-000334e0: 2020 2020 2020 2020 2020 2020 4120 2020              A   
-000334f0: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
-00033500: 206e 616e 2032 2e30 206e 616e 2030 2e30   nan 2.0 nan 0.0
-00033510: 0a20 2020 2020 2020 2020 2020 2042 2020  .            B  
-00033520: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
-00033530: 3420 332e 3020 342e 3020 6e61 6e20 312e  4 3.0 4.0 nan 1.
-00033540: 300a 2020 2020 2020 2020 2020 2020 4320  0.            C 
-00033550: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
-00033560: 3634 206e 616e 206e 616e 206e 616e 2035  64 nan nan nan 5
-00033570: 2e30 0a20 2020 2020 2020 2020 2020 2044  .0.            D
-00033580: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-00033590: 7436 3420 6e61 6e20 332e 3020 6e61 6e20  t64 nan 3.0 nan 
-000335a0: 342e 300a 0a20 2020 2020 2020 2052 6570  4.0..        Rep
-000335b0: 6c61 6365 2061 6c6c 2060 4e61 4e60 2076  lace all `NaN` v
-000335c0: 616c 7565 7320 7769 7468 2030 732e 0a0a  alues with 0s...
-000335d0: 2020 2020 2020 2020 3e3e 3e20 6473 2e66          >>> ds.f
-000335e0: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
-000335f0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-00033600: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-00033610: 696f 6e73 3a20 2028 783a 2034 290a 2020  ions:  (x: 4).  
-00033620: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-00033630: 733a 0a20 2020 2020 2020 2020 202a 2078  s:.          * x
-00033640: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
-00033650: 3420 3020 3120 3220 330a 2020 2020 2020  4 0 1 2 3.      
-00033660: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-00033670: 3a0a 2020 2020 2020 2020 2020 2020 4120  :.            A 
-00033680: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
-00033690: 3634 2030 2e30 2032 2e30 2030 2e30 2030  64 0.0 2.0 0.0 0
-000336a0: 2e30 0a20 2020 2020 2020 2020 2020 2042  .0.            B
-000336b0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-000336c0: 7436 3420 332e 3020 342e 3020 302e 3020  t64 3.0 4.0 0.0 
-000336d0: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
-000336e0: 4320 2020 2020 2020 2028 7829 2066 6c6f  C        (x) flo
-000336f0: 6174 3634 2030 2e30 2030 2e30 2030 2e30  at64 0.0 0.0 0.0
-00033700: 2035 2e30 0a20 2020 2020 2020 2020 2020   5.0.           
-00033710: 2044 2020 2020 2020 2020 2878 2920 666c   D        (x) fl
-00033720: 6f61 7436 3420 302e 3020 332e 3020 302e  oat64 0.0 3.0 0.
-00033730: 3020 342e 300a 0a20 2020 2020 2020 2052  0 4.0..        R
-00033740: 6570 6c61 6365 2061 6c6c 2060 4e61 4e60  eplace all `NaN`
-00033750: 2065 6c65 6d65 6e74 7320 696e 2063 6f6c   elements in col
-00033760: 756d 6e20 e280 9841 e280 992c 20e2 8098  umn ...A..., ...
-00033770: 42e2 8099 2c20 e280 9843 e280 992c 2061  B..., ...C..., a
-00033780: 6e64 20e2 8098 44e2 8099 2c20 7769 7468  nd ...D..., with
-00033790: 2030 2c20 312c 2032 2c20 616e 6420 3320   0, 1, 2, and 3 
-000337a0: 7265 7370 6563 7469 7665 6c79 2e0a 0a20  respectively... 
-000337b0: 2020 2020 2020 203e 3e3e 2076 616c 7565         >>> value
-000337c0: 7320 3d20 7b22 4122 3a20 302c 2022 4222  s = {"A": 0, "B"
-000337d0: 3a20 312c 2022 4322 3a20 322c 2022 4422  : 1, "C": 2, "D"
-000337e0: 3a20 337d 0a20 2020 2020 2020 203e 3e3e  : 3}.        >>>
-000337f0: 2064 732e 6669 6c6c 6e61 2876 616c 7565   ds.fillna(value
-00033800: 3d76 616c 7565 7329 0a20 2020 2020 2020  =values).       
-00033810: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-00033820: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-00033830: 696f 6e73 3a20 2028 783a 2034 290a 2020  ions:  (x: 4).  
-00033840: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
-00033850: 733a 0a20 2020 2020 2020 2020 202a 2078  s:.          * x
-00033860: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
-00033870: 3420 3020 3120 3220 330a 2020 2020 2020  4 0 1 2 3.      
-00033880: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-00033890: 3a0a 2020 2020 2020 2020 2020 2020 4120  :.            A 
-000338a0: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
-000338b0: 3634 2030 2e30 2032 2e30 2030 2e30 2030  64 0.0 2.0 0.0 0
-000338c0: 2e30 0a20 2020 2020 2020 2020 2020 2042  .0.            B
-000338d0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-000338e0: 7436 3420 332e 3020 342e 3020 312e 3020  t64 3.0 4.0 1.0 
-000338f0: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
-00033900: 4320 2020 2020 2020 2028 7829 2066 6c6f  C        (x) flo
-00033910: 6174 3634 2032 2e30 2032 2e30 2032 2e30  at64 2.0 2.0 2.0
-00033920: 2035 2e30 0a20 2020 2020 2020 2020 2020   5.0.           
-00033930: 2044 2020 2020 2020 2020 2878 2920 666c   D        (x) fl
-00033940: 6f61 7436 3420 332e 3020 332e 3020 332e  oat64 3.0 3.0 3.
-00033950: 3020 342e 300a 2020 2020 2020 2020 2222  0 4.0.        ""
-00033960: 220a 2020 2020 2020 2020 6966 2075 7469  ".        if uti
-00033970: 6c73 2e69 735f 6469 6374 5f6c 696b 6528  ls.is_dict_like(
-00033980: 7661 6c75 6529 3a0a 2020 2020 2020 2020  value):.        
-00033990: 2020 2020 7661 6c75 655f 6b65 7973 203d      value_keys =
-000339a0: 2067 6574 6174 7472 2876 616c 7565 2c20   getattr(value, 
-000339b0: 2264 6174 615f 7661 7273 222c 2076 616c  "data_vars", val
-000339c0: 7565 292e 6b65 7973 2829 0a20 2020 2020  ue).keys().     
-000339d0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-000339e0: 7428 7661 6c75 655f 6b65 7973 2920 3c3d  t(value_keys) <=
-000339f0: 2073 6574 2873 656c 662e 6461 7461 5f76   set(self.data_v
-00033a00: 6172 732e 6b65 7973 2829 293a 0a20 2020  ars.keys()):.   
-00033a10: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00033a20: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00033a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033a40: 2020 2022 616c 6c20 7661 7269 6162 6c65     "all variable
-00033a50: 7320 696e 2074 6865 2061 7267 756d 656e  s in the argumen
-00033a60: 7420 746f 2060 6669 6c6c 6e61 6020 220a  t to `fillna` ".
-00033a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033a80: 2020 2020 226d 7573 7420 6265 2063 6f6e      "must be con
-00033a90: 7461 696e 6564 2069 6e20 7468 6520 6f72  tained in the or
-00033aa0: 6967 696e 616c 2064 6174 6173 6574 220a  iginal dataset".
-00033ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033ac0: 290a 2020 2020 2020 2020 6f75 7420 3d20  ).        out = 
-00033ad0: 6f70 732e 6669 6c6c 6e61 2873 656c 662c  ops.fillna(self,
-00033ae0: 2076 616c 7565 290a 2020 2020 2020 2020   value).        
-00033af0: 7265 7475 726e 206f 7574 0a0a 2020 2020  return out..    
-00033b00: 6465 6620 696e 7465 7270 6f6c 6174 655f  def interpolate_
-00033b10: 6e61 280a 2020 2020 2020 2020 7365 6c66  na(.        self
-00033b20: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-00033b30: 2020 2020 2064 696d 3a20 4861 7368 6162       dim: Hashab
-00033b40: 6c65 207c 204e 6f6e 6520 3d20 4e6f 6e65  le | None = None
-00033b50: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
-00033b60: 3a20 496e 7465 7270 4f70 7469 6f6e 7320  : InterpOptions 
-00033b70: 3d20 226c 696e 6561 7222 2c0a 2020 2020  = "linear",.    
-00033b80: 2020 2020 6c69 6d69 743a 2069 6e74 207c      limit: int |
-00033b90: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00033ba0: 2020 2020 2020 7573 655f 636f 6f72 6469        use_coordi
-00033bb0: 6e61 7465 3a20 626f 6f6c 207c 2048 6173  nate: bool | Has
-00033bc0: 6861 626c 6520 3d20 5472 7565 2c0a 2020  hable = True,.  
-00033bd0: 2020 2020 2020 6d61 785f 6761 703a 2028        max_gap: (
-00033be0: 0a20 2020 2020 2020 2020 2020 2069 6e74  .            int
-00033bf0: 207c 2066 6c6f 6174 207c 2073 7472 207c   | float | str |
-00033c00: 2070 642e 5469 6d65 6465 6c74 6120 7c20   pd.Timedelta | 
-00033c10: 6e70 2e74 696d 6564 656c 7461 3634 207c  np.timedelta64 |
-00033c20: 2064 6174 6574 696d 652e 7469 6d65 6465   datetime.timede
-00033c30: 6c74 610a 2020 2020 2020 2020 2920 3d20  lta.        ) = 
-00033c40: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
-00033c50: 6b77 6172 6773 3a20 416e 792c 0a20 2020  kwargs: Any,.   
-00033c60: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-00033c70: 0a20 2020 2020 2020 2022 2222 4669 6c6c  .        """Fill
-00033c80: 2069 6e20 4e61 4e73 2062 7920 696e 7465   in NaNs by inte
-00033c90: 7270 6f6c 6174 696e 6720 6163 636f 7264  rpolating accord
-00033ca0: 696e 6720 746f 2064 6966 6665 7265 6e74  ing to different
-00033cb0: 206d 6574 686f 6473 2e0a 0a20 2020 2020   methods...     
-00033cc0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00033cd0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00033ce0: 0a20 2020 2020 2020 2064 696d 203a 2048  .        dim : H
-00033cf0: 6173 6861 626c 6520 6f72 204e 6f6e 652c  ashable or None,
-00033d00: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00033d10: 2020 2020 2020 5370 6563 6966 6965 7320        Specifies 
-00033d20: 7468 6520 6469 6d65 6e73 696f 6e20 616c  the dimension al
-00033d30: 6f6e 6720 7768 6963 6820 746f 2069 6e74  ong which to int
-00033d40: 6572 706f 6c61 7465 2e0a 2020 2020 2020  erpolate..      
-00033d50: 2020 6d65 7468 6f64 203a 207b 226c 696e    method : {"lin
-00033d60: 6561 7222 2c20 226e 6561 7265 7374 222c  ear", "nearest",
-00033d70: 2022 7a65 726f 222c 2022 736c 696e 6561   "zero", "slinea
-00033d80: 7222 2c20 2271 7561 6472 6174 6963 222c  r", "quadratic",
-00033d90: 2022 6375 6269 6322 2c20 2270 6f6c 796e   "cubic", "polyn
-00033da0: 6f6d 6961 6c22 2c20 5c0a 2020 2020 2020  omial", \.      
-00033db0: 2020 2020 2020 2262 6172 7963 656e 7472        "barycentr
-00033dc0: 6963 222c 2022 6b72 6f67 222c 2022 7063  ic", "krog", "pc
-00033dd0: 6869 7022 2c20 2273 706c 696e 6522 2c20  hip", "spline", 
-00033de0: 2261 6b69 6d61 227d 2c20 6465 6661 756c  "akima"}, defaul
-00033df0: 743a 2022 6c69 6e65 6172 220a 2020 2020  t: "linear".    
-00033e00: 2020 2020 2020 2020 5374 7269 6e67 2069          String i
-00033e10: 6e64 6963 6174 696e 6720 7768 6963 6820  ndicating which 
-00033e20: 6d65 7468 6f64 2074 6f20 7573 6520 666f  method to use fo
-00033e30: 7220 696e 7465 7270 6f6c 6174 696f 6e3a  r interpolation:
-00033e40: 0a0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-00033e50: 276c 696e 6561 7227 3a20 6c69 6e65 6172  'linear': linear
-00033e60: 2069 6e74 6572 706f 6c61 7469 6f6e 2e20   interpolation. 
-00033e70: 4164 6469 7469 6f6e 616c 206b 6579 776f  Additional keywo
-00033e80: 7264 0a20 2020 2020 2020 2020 2020 2020  rd.             
-00033e90: 2061 7267 756d 656e 7473 2061 7265 2070   arguments are p
-00033ea0: 6173 7365 6420 746f 203a 7079 3a66 756e  assed to :py:fun
-00033eb0: 633a 606e 756d 7079 2e69 6e74 6572 7060  c:`numpy.interp`
-00033ec0: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-00033ed0: 6e65 6172 6573 7427 2c20 277a 6572 6f27  nearest', 'zero'
-00033ee0: 2c20 2773 6c69 6e65 6172 272c 2027 7175  , 'slinear', 'qu
-00033ef0: 6164 7261 7469 6327 2c20 2763 7562 6963  adratic', 'cubic
-00033f00: 272c 2027 706f 6c79 6e6f 6d69 616c 273a  ', 'polynomial':
-00033f10: 0a20 2020 2020 2020 2020 2020 2020 2061  .              a
-00033f20: 7265 2070 6173 7365 6420 746f 203a 7079  re passed to :py
-00033f30: 3a66 756e 633a 6073 6369 7079 2e69 6e74  :func:`scipy.int
-00033f40: 6572 706f 6c61 7465 2e69 6e74 6572 7031  erpolate.interp1
-00033f50: 6460 2e20 4966 0a20 2020 2020 2020 2020  d`. If.         
-00033f60: 2020 2020 2060 606d 6574 686f 643d 2770       ``method='p
-00033f70: 6f6c 796e 6f6d 6961 6c27 6060 2c20 7468  olynomial'``, th
-00033f80: 6520 6060 6f72 6465 7260 6020 6b65 7977  e ``order`` keyw
-00033f90: 6f72 6420 6172 6775 6d65 6e74 206d 7573  ord argument mus
-00033fa0: 7420 616c 736f 2062 650a 2020 2020 2020  t also be.      
-00033fb0: 2020 2020 2020 2020 7072 6f76 6964 6564          provided
-00033fc0: 2e0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-00033fd0: 2762 6172 7963 656e 7472 6963 272c 2027  'barycentric', '
-00033fe0: 6b72 6f67 272c 2027 7063 6869 7027 2c20  krog', 'pchip', 
-00033ff0: 2773 706c 696e 6527 2c20 2761 6b69 6d61  'spline', 'akima
-00034000: 273a 2075 7365 2074 6865 6972 0a20 2020  ': use their.   
-00034010: 2020 2020 2020 2020 2020 2072 6573 7065             respe
-00034020: 6374 6976 6520 3a70 793a 636c 6173 733a  ctive :py:class:
-00034030: 6073 6369 7079 2e69 6e74 6572 706f 6c61  `scipy.interpola
-00034040: 7465 6020 636c 6173 7365 732e 0a0a 2020  te` classes...  
-00034050: 2020 2020 2020 7573 655f 636f 6f72 6469        use_coordi
-00034060: 6e61 7465 203a 2062 6f6f 6c20 6f72 2048  nate : bool or H
-00034070: 6173 6861 626c 652c 2064 6566 6175 6c74  ashable, default
-00034080: 3a20 5472 7565 0a20 2020 2020 2020 2020  : True.         
-00034090: 2020 2053 7065 6369 6669 6573 2077 6869     Specifies whi
-000340a0: 6368 2069 6e64 6578 2074 6f20 7573 6520  ch index to use 
-000340b0: 6173 2074 6865 2078 2076 616c 7565 7320  as the x values 
-000340c0: 696e 2074 6865 2069 6e74 6572 706f 6c61  in the interpola
-000340d0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-000340e0: 2066 6f72 6d75 6c61 7465 6420 6173 2060   formulated as `
-000340f0: 7920 3d20 6628 7829 602e 2049 6620 4661  y = f(x)`. If Fa
-00034100: 6c73 652c 2076 616c 7565 7320 6172 6520  lse, values are 
-00034110: 7472 6561 7465 6420 6173 2069 660a 2020  treated as if.  
-00034120: 2020 2020 2020 2020 2020 6571 7561 6c6c            equall
-00034130: 792d 7370 6163 6564 2061 6c6f 6e67 2060  y-spaced along `
-00034140: 6064 696d 6060 2e20 4966 2054 7275 652c  `dim``. If True,
-00034150: 2074 6865 2049 6e64 6578 5661 7269 6162   the IndexVariab
-00034160: 6c65 2060 6469 6d60 2069 730a 2020 2020  le `dim` is.    
-00034170: 2020 2020 2020 2020 7573 6564 2e20 4966          used. If
-00034180: 2060 6075 7365 5f63 6f6f 7264 696e 6174   ``use_coordinat
-00034190: 6560 6020 6973 2061 2073 7472 696e 672c  e`` is a string,
-000341a0: 2069 7420 7370 6563 6966 6965 7320 7468   it specifies th
-000341b0: 6520 6e61 6d65 206f 6620 610a 2020 2020  e name of a.    
-000341c0: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
-000341d0: 7465 2076 6172 6961 626c 6520 746f 2075  te variable to u
-000341e0: 7365 2061 7320 7468 6520 696e 6465 782e  se as the index.
-000341f0: 0a20 2020 2020 2020 206c 696d 6974 203a  .        limit :
-00034200: 2069 6e74 2c20 6465 6661 756c 743a 204e   int, default: N
-00034210: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00034220: 4d61 7869 6d75 6d20 6e75 6d62 6572 206f  Maximum number o
-00034230: 6620 636f 6e73 6563 7574 6976 6520 4e61  f consecutive Na
-00034240: 4e73 2074 6f20 6669 6c6c 2e20 4d75 7374  Ns to fill. Must
-00034250: 2062 6520 6772 6561 7465 7220 7468 616e   be greater than
-00034260: 2030 0a20 2020 2020 2020 2020 2020 206f   0.            o
-00034270: 7220 4e6f 6e65 2066 6f72 206e 6f20 6c69  r None for no li
-00034280: 6d69 742e 2054 6869 7320 6669 6c6c 696e  mit. This fillin
-00034290: 6720 6973 2064 6f6e 6520 7265 6761 7264  g is done regard
-000342a0: 6c65 7373 206f 6620 7468 6520 7369 7a65  less of the size
-000342b0: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-000342c0: 7468 6520 6761 7020 696e 2074 6865 2064  the gap in the d
-000342d0: 6174 612e 2054 6f20 6f6e 6c79 2069 6e74  ata. To only int
-000342e0: 6572 706f 6c61 7465 206f 7665 7220 6761  erpolate over ga
-000342f0: 7073 206c 6573 7320 7468 616e 2061 2067  ps less than a g
-00034300: 6976 656e 206c 656e 6774 682c 0a20 2020  iven length,.   
-00034310: 2020 2020 2020 2020 2073 6565 2060 606d           see ``m
-00034320: 6178 5f67 6170 6060 2e0a 2020 2020 2020  ax_gap``..      
-00034330: 2020 6d61 785f 6761 7020 3a20 696e 742c    max_gap : int,
-00034340: 2066 6c6f 6174 2c20 7374 722c 2070 616e   float, str, pan
-00034350: 6461 732e 5469 6d65 6465 6c74 612c 206e  das.Timedelta, n
-00034360: 756d 7079 2e74 696d 6564 656c 7461 3634  umpy.timedelta64
-00034370: 2c20 6461 7465 7469 6d65 2e74 696d 6564  , datetime.timed
-00034380: 656c 7461 2c20 6465 6661 756c 743a 204e  elta, default: N
-00034390: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000343a0: 4d61 7869 6d75 6d20 7369 7a65 206f 6620  Maximum size of 
-000343b0: 6761 702c 2061 2063 6f6e 7469 6e75 6f75  gap, a continuou
-000343c0: 7320 7365 7175 656e 6365 206f 6620 4e61  s sequence of Na
-000343d0: 4e73 2c20 7468 6174 2077 696c 6c20 6265  Ns, that will be
-000343e0: 2066 696c 6c65 642e 0a20 2020 2020 2020   filled..       
-000343f0: 2020 2020 2055 7365 204e 6f6e 6520 666f       Use None fo
-00034400: 7220 6e6f 206c 696d 6974 2e20 5768 656e  r no limit. When
-00034410: 2069 6e74 6572 706f 6c61 7469 6e67 2061   interpolating a
-00034420: 6c6f 6e67 2061 2064 6174 6574 696d 6536  long a datetime6
-00034430: 3420 6469 6d65 6e73 696f 6e0a 2020 2020  4 dimension.    
-00034440: 2020 2020 2020 2020 616e 6420 6060 7573          and ``us
-00034450: 655f 636f 6f72 6469 6e61 7465 3d54 7275  e_coordinate=Tru
-00034460: 6560 602c 2060 606d 6178 5f67 6170 6060  e``, ``max_gap``
-00034470: 2063 616e 2062 6520 6f6e 6520 6f66 2074   can be one of t
-00034480: 6865 2066 6f6c 6c6f 7769 6e67 3a0a 0a20  he following:.. 
-00034490: 2020 2020 2020 2020 2020 202d 2061 2073             - a s
-000344a0: 7472 696e 6720 7468 6174 2069 7320 7661  tring that is va
-000344b0: 6c69 6420 696e 7075 7420 666f 7220 7061  lid input for pa
-000344c0: 6e64 6173 2e74 6f5f 7469 6d65 6465 6c74  ndas.to_timedelt
-000344d0: 610a 2020 2020 2020 2020 2020 2020 2d20  a.            - 
-000344e0: 6120 3a70 793a 636c 6173 733a 606e 756d  a :py:class:`num
-000344f0: 7079 2e74 696d 6564 656c 7461 3634 6020  py.timedelta64` 
-00034500: 6f62 6a65 6374 0a20 2020 2020 2020 2020  object.         
-00034510: 2020 202d 2061 203a 7079 3a63 6c61 7373     - a :py:class
-00034520: 3a60 7061 6e64 6173 2e54 696d 6564 656c  :`pandas.Timedel
-00034530: 7461 6020 6f62 6a65 6374 0a20 2020 2020  ta` object.     
-00034540: 2020 2020 2020 202d 2061 203a 7079 3a63         - a :py:c
-00034550: 6c61 7373 3a60 6461 7465 7469 6d65 2e74  lass:`datetime.t
-00034560: 696d 6564 656c 7461 6020 6f62 6a65 6374  imedelta` object
-00034570: 0a0a 2020 2020 2020 2020 2020 2020 4f74  ..            Ot
-00034580: 6865 7277 6973 652c 2060 606d 6178 5f67  herwise, ``max_g
-00034590: 6170 6060 206d 7573 7420 6265 2061 6e20  ap`` must be an 
-000345a0: 696e 7420 6f72 2061 2066 6c6f 6174 2e20  int or a float. 
-000345b0: 5573 6520 6f66 2060 606d 6178 5f67 6170  Use of ``max_gap
-000345c0: 6060 2077 6974 6820 756e 6c61 6265 6c65  `` with unlabele
-000345d0: 640a 2020 2020 2020 2020 2020 2020 6469  d.            di
-000345e0: 6d65 6e73 696f 6e73 2068 6173 206e 6f74  mensions has not
-000345f0: 2062 6565 6e20 696d 706c 656d 656e 7465   been implemente
-00034600: 6420 7965 742e 2047 6170 206c 656e 6774  d yet. Gap lengt
-00034610: 6820 6973 2064 6566 696e 6564 2061 7320  h is defined as 
-00034620: 7468 6520 6469 6666 6572 656e 6365 0a20  the difference. 
-00034630: 2020 2020 2020 2020 2020 2062 6574 7765             betwe
-00034640: 656e 2063 6f6f 7264 696e 6174 6520 7661  en coordinate va
-00034650: 6c75 6573 2061 7420 7468 6520 6669 7273  lues at the firs
-00034660: 7420 6461 7461 2070 6f69 6e74 2061 6674  t data point aft
-00034670: 6572 2061 2067 6170 2061 6e64 2074 6865  er a gap and the
-00034680: 206c 6173 7420 7661 6c75 650a 2020 2020   last value.    
-00034690: 2020 2020 2020 2020 6265 666f 7265 2061          before a
-000346a0: 2067 6170 2e20 466f 7220 6761 7073 2061   gap. For gaps a
-000346b0: 7420 7468 6520 6265 6769 6e6e 696e 6720  t the beginning 
-000346c0: 2865 6e64 292c 2067 6170 206c 656e 6774  (end), gap lengt
-000346d0: 6820 6973 2064 6566 696e 6564 2061 7320  h is defined as 
-000346e0: 7468 6520 6469 6666 6572 656e 6365 0a20  the difference. 
-000346f0: 2020 2020 2020 2020 2020 2062 6574 7765             betwe
-00034700: 656e 2063 6f6f 7264 696e 6174 6520 7661  en coordinate va
-00034710: 6c75 6573 2061 7420 7468 6520 6669 7273  lues at the firs
-00034720: 7420 286c 6173 7429 2076 616c 6964 2064  t (last) valid d
-00034730: 6174 6120 706f 696e 7420 616e 6420 7468  ata point and th
-00034740: 6520 6669 7273 7420 286c 6173 7429 204e  e first (last) N
-00034750: 614e 2e0a 2020 2020 2020 2020 2020 2020  aN..            
-00034760: 466f 7220 6578 616d 706c 652c 2063 6f6e  For example, con
-00034770: 7369 6465 723a 3a0a 0a20 2020 2020 2020  sider::..       
-00034780: 2020 2020 2020 2020 203c 7861 7272 6179           <xarray
-00034790: 2e44 6174 6141 7272 6179 2028 783a 2039  .DataArray (x: 9
-000347a0: 293e 0a20 2020 2020 2020 2020 2020 2020  )>.             
-000347b0: 2020 2061 7272 6179 285b 6e61 6e2c 206e     array([nan, n
-000347c0: 616e 2c20 6e61 6e2c 2020 312e 2c20 6e61  an, nan,  1., na
-000347d0: 6e2c 206e 616e 2c20 2034 2e2c 206e 616e  n, nan,  4., nan
-000347e0: 2c20 6e61 6e5d 290a 2020 2020 2020 2020  , nan]).        
-000347f0: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
-00034800: 7465 733a 0a20 2020 2020 2020 2020 2020  tes:.           
-00034810: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
-00034820: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
-00034830: 3220 3320 3420 3520 3620 3720 380a 0a20  2 3 4 5 6 7 8.. 
-00034840: 2020 2020 2020 2020 2020 2054 6865 2067             The g
-00034850: 6170 206c 656e 6774 6873 2061 7265 2033  ap lengths are 3
-00034860: 2d30 203d 2033 3b20 362d 3320 3d20 333b  -0 = 3; 6-3 = 3;
-00034870: 2061 6e64 2038 2d36 203d 2032 2072 6573   and 8-6 = 2 res
-00034880: 7065 6374 6976 656c 790a 2020 2020 2020  pectively.      
-00034890: 2020 2a2a 6b77 6172 6773 203a 2064 6963    **kwargs : dic
-000348a0: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
-000348b0: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
-000348c0: 7273 2070 6173 7365 6420 7665 7262 6174  rs passed verbat
-000348d0: 696d 2074 6f20 7468 6520 756e 6465 726c  im to the underl
-000348e0: 7969 6e67 2069 6e74 6572 706f 6c61 7469  ying interpolati
-000348f0: 6f6e 2066 756e 6374 696f 6e0a 0a20 2020  on function..   
-00034900: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00034910: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00034920: 2020 2020 2069 6e74 6572 706f 6c61 7465       interpolate
-00034930: 643a 2044 6174 6173 6574 0a20 2020 2020  d: Dataset.     
-00034940: 2020 2020 2020 2046 696c 6c65 6420 696e         Filled in
-00034950: 2044 6174 6173 6574 2e0a 0a20 2020 2020   Dataset...     
-00034960: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-00034970: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00034980: 2020 2020 206e 756d 7079 2e69 6e74 6572       numpy.inter
-00034990: 700a 2020 2020 2020 2020 7363 6970 792e  p.        scipy.
-000349a0: 696e 7465 7270 6f6c 6174 650a 0a20 2020  interpolate..   
-000349b0: 2020 2020 2045 7861 6d70 6c65 730a 2020       Examples.  
-000349c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-000349d0: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
-000349e0: 7872 2e44 6174 6173 6574 280a 2020 2020  xr.Dataset(.    
-000349f0: 2020 2020 2e2e 2e20 2020 2020 7b0a 2020      ...     {.  
-00034a00: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
-00034a10: 2020 2241 223a 2028 2278 222c 205b 6e70    "A": ("x", [np
-00034a20: 2e6e 616e 2c20 322c 2033 2c20 6e70 2e6e  .nan, 2, 3, np.n
-00034a30: 616e 2c20 305d 292c 0a20 2020 2020 2020  an, 0]),.       
-00034a40: 202e 2e2e 2020 2020 2020 2020 2022 4222   ...         "B"
-00034a50: 3a20 2822 7822 2c20 5b33 2c20 342c 206e  : ("x", [3, 4, n
-00034a60: 702e 6e61 6e2c 2031 2c20 375d 292c 0a20  p.nan, 1, 7]),. 
-00034a70: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-00034a80: 2020 2022 4322 3a20 2822 7822 2c20 5b6e     "C": ("x", [n
-00034a90: 702e 6e61 6e2c 206e 702e 6e61 6e2c 206e  p.nan, np.nan, n
-00034aa0: 702e 6e61 6e2c 2035 2c20 305d 292c 0a20  p.nan, 5, 0]),. 
-00034ab0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
-00034ac0: 2020 2022 4422 3a20 2822 7822 2c20 5b6e     "D": ("x", [n
-00034ad0: 702e 6e61 6e2c 2033 2c20 6e70 2e6e 616e  p.nan, 3, np.nan
-00034ae0: 2c20 2d31 2c20 345d 292c 0a20 2020 2020  , -1, 4]),.     
-00034af0: 2020 202e 2e2e 2020 2020 207d 2c0a 2020     ...     },.  
-00034b00: 2020 2020 2020 2e2e 2e20 2020 2020 636f        ...     co
-00034b10: 6f72 6473 3d7b 2278 223a 205b 302c 2031  ords={"x": [0, 1
-00034b20: 2c20 322c 2033 2c20 345d 7d2c 0a20 2020  , 2, 3, 4]},.   
-00034b30: 2020 2020 202e 2e2e 2029 0a20 2020 2020       ... ).     
-00034b40: 2020 203e 3e3e 2064 730a 2020 2020 2020     >>> ds.      
-00034b50: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
-00034b60: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
-00034b70: 7369 6f6e 733a 2020 2878 3a20 3529 0a20  sions:  (x: 5). 
-00034b80: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-00034b90: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
-00034ba0: 7820 2020 2020 2020 2028 7829 2069 6e74  x        (x) int
-00034bb0: 3634 2030 2031 2032 2033 2034 0a20 2020  64 0 1 2 3 4.   
-00034bc0: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-00034bd0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-00034be0: 2041 2020 2020 2020 2020 2878 2920 666c   A        (x) fl
-00034bf0: 6f61 7436 3420 6e61 6e20 322e 3020 332e  oat64 nan 2.0 3.
-00034c00: 3020 6e61 6e20 302e 300a 2020 2020 2020  0 nan 0.0.      
-00034c10: 2020 2020 2020 4220 2020 2020 2020 2028        B        (
-00034c20: 7829 2066 6c6f 6174 3634 2033 2e30 2034  x) float64 3.0 4
-00034c30: 2e30 206e 616e 2031 2e30 2037 2e30 0a20  .0 nan 1.0 7.0. 
-00034c40: 2020 2020 2020 2020 2020 2043 2020 2020             C    
-00034c50: 2020 2020 2878 2920 666c 6f61 7436 3420      (x) float64 
-00034c60: 6e61 6e20 6e61 6e20 6e61 6e20 352e 3020  nan nan nan 5.0 
-00034c70: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
-00034c80: 4420 2020 2020 2020 2028 7829 2066 6c6f  D        (x) flo
-00034c90: 6174 3634 206e 616e 2033 2e30 206e 616e  at64 nan 3.0 nan
-00034ca0: 202d 312e 3020 342e 300a 0a20 2020 2020   -1.0 4.0..     
-00034cb0: 2020 203e 3e3e 2064 732e 696e 7465 7270     >>> ds.interp
-00034cc0: 6f6c 6174 655f 6e61 2864 696d 3d22 7822  olate_na(dim="x"
-00034cd0: 2c20 6d65 7468 6f64 3d22 6c69 6e65 6172  , method="linear
-00034ce0: 2229 0a20 2020 2020 2020 203c 7861 7272  ").        <xarr
-00034cf0: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
-00034d00: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
-00034d10: 2028 783a 2035 290a 2020 2020 2020 2020   (x: 5).        
-00034d20: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
-00034d30: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
-00034d40: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
-00034d50: 3220 3320 340a 2020 2020 2020 2020 4461  2 3 4.        Da
-00034d60: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
-00034d70: 2020 2020 2020 2020 2020 4120 2020 2020            A     
-00034d80: 2020 2028 7829 2066 6c6f 6174 3634 206e     (x) float64 n
-00034d90: 616e 2032 2e30 2033 2e30 2031 2e35 2030  an 2.0 3.0 1.5 0
-00034da0: 2e30 0a20 2020 2020 2020 2020 2020 2042  .0.            B
-00034db0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-00034dc0: 7436 3420 332e 3020 342e 3020 322e 3520  t64 3.0 4.0 2.5 
-00034dd0: 312e 3020 372e 300a 2020 2020 2020 2020  1.0 7.0.        
-00034de0: 2020 2020 4320 2020 2020 2020 2028 7829      C        (x)
-00034df0: 2066 6c6f 6174 3634 206e 616e 206e 616e   float64 nan nan
-00034e00: 206e 616e 2035 2e30 2030 2e30 0a20 2020   nan 5.0 0.0.   
-00034e10: 2020 2020 2020 2020 2044 2020 2020 2020           D      
-00034e20: 2020 2878 2920 666c 6f61 7436 3420 6e61    (x) float64 na
-00034e30: 6e20 332e 3020 312e 3020 2d31 2e30 2034  n 3.0 1.0 -1.0 4
-00034e40: 2e30 0a0a 2020 2020 2020 2020 3e3e 3e20  .0..        >>> 
-00034e50: 6473 2e69 6e74 6572 706f 6c61 7465 5f6e  ds.interpolate_n
-00034e60: 6128 6469 6d3d 2278 222c 206d 6574 686f  a(dim="x", metho
-00034e70: 643d 226c 696e 6561 7222 2c20 6669 6c6c  d="linear", fill
-00034e80: 5f76 616c 7565 3d22 6578 7472 6170 6f6c  _value="extrapol
-00034e90: 6174 6522 290a 2020 2020 2020 2020 3c78  ate").        <x
-00034ea0: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-00034eb0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-00034ec0: 733a 2020 2878 3a20 3529 0a20 2020 2020  s:  (x: 5).     
-00034ed0: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-00034ee0: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-00034ef0: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
-00034f00: 2031 2032 2033 2034 0a20 2020 2020 2020   1 2 3 4.       
-00034f10: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-00034f20: 0a20 2020 2020 2020 2020 2020 2041 2020  .            A  
-00034f30: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
-00034f40: 3420 312e 3020 322e 3020 332e 3020 312e  4 1.0 2.0 3.0 1.
-00034f50: 3520 302e 300a 2020 2020 2020 2020 2020  5 0.0.          
-00034f60: 2020 4220 2020 2020 2020 2028 7829 2066    B        (x) f
-00034f70: 6c6f 6174 3634 2033 2e30 2034 2e30 2032  loat64 3.0 4.0 2
-00034f80: 2e35 2031 2e30 2037 2e30 0a20 2020 2020  .5 1.0 7.0.     
-00034f90: 2020 2020 2020 2043 2020 2020 2020 2020         C        
-00034fa0: 2878 2920 666c 6f61 7436 3420 3230 2e30  (x) float64 20.0
-00034fb0: 2031 352e 3020 3130 2e30 2035 2e30 2030   15.0 10.0 5.0 0
-00034fc0: 2e30 0a20 2020 2020 2020 2020 2020 2044  .0.            D
-00034fd0: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
-00034fe0: 7436 3420 352e 3020 332e 3020 312e 3020  t64 5.0 3.0 1.0 
-00034ff0: 2d31 2e30 2034 2e30 0a20 2020 2020 2020  -1.0 4.0.       
-00035000: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00035010: 6d20 7861 7272 6179 2e63 6f72 652e 6d69  m xarray.core.mi
-00035020: 7373 696e 6720 696d 706f 7274 205f 6170  ssing import _ap
-00035030: 706c 795f 6f76 6572 5f76 6172 735f 7769  ply_over_vars_wi
-00035040: 7468 5f64 696d 2c20 696e 7465 7270 5f6e  th_dim, interp_n
-00035050: 610a 0a20 2020 2020 2020 206e 6577 203d  a..        new =
-00035060: 205f 6170 706c 795f 6f76 6572 5f76 6172   _apply_over_var
-00035070: 735f 7769 7468 5f64 696d 280a 2020 2020  s_with_dim(.    
-00035080: 2020 2020 2020 2020 696e 7465 7270 5f6e          interp_n
-00035090: 612c 0a20 2020 2020 2020 2020 2020 2073  a,.            s
-000350a0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-000350b0: 2064 696d 3d64 696d 2c0a 2020 2020 2020   dim=dim,.      
-000350c0: 2020 2020 2020 6d65 7468 6f64 3d6d 6574        method=met
-000350d0: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
-000350e0: 206c 696d 6974 3d6c 696d 6974 2c0a 2020   limit=limit,.  
-000350f0: 2020 2020 2020 2020 2020 7573 655f 636f            use_co
-00035100: 6f72 6469 6e61 7465 3d75 7365 5f63 6f6f  ordinate=use_coo
-00035110: 7264 696e 6174 652c 0a20 2020 2020 2020  rdinate,.       
-00035120: 2020 2020 206d 6178 5f67 6170 3d6d 6178       max_gap=max
-00035130: 5f67 6170 2c0a 2020 2020 2020 2020 2020  _gap,.          
-00035140: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-00035150: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-00035160: 7475 726e 206e 6577 0a0a 2020 2020 6465  turn new..    de
-00035170: 6620 6666 696c 6c28 7365 6c66 3a20 545f  f ffill(self: T_
-00035180: 4461 7461 7365 742c 2064 696d 3a20 4861  Dataset, dim: Ha
-00035190: 7368 6162 6c65 2c20 6c69 6d69 743a 2069  shable, limit: i
-000351a0: 6e74 207c 204e 6f6e 6520 3d20 4e6f 6e65  nt | None = None
-000351b0: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
-000351c0: 2020 2020 2020 2020 2222 2246 696c 6c20          """Fill 
-000351d0: 4e61 4e20 7661 6c75 6573 2062 7920 7072  NaN values by pr
-000351e0: 6f70 6167 6174 696e 6720 7661 6c75 6573  opagating values
-000351f0: 2066 6f72 7761 7264 0a0a 2020 2020 2020   forward..      
-00035200: 2020 2a52 6571 7569 7265 7320 626f 7474    *Requires bott
-00035210: 6c65 6e65 636b 2e2a 0a0a 2020 2020 2020  leneck.*..      
-00035220: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00035230: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00035240: 2020 2020 2020 2020 6469 6d20 3a20 4861          dim : Ha
-00035250: 7368 6162 6c65 0a20 2020 2020 2020 2020  shable.         
-00035260: 2020 2053 7065 6369 6669 6573 2074 6865     Specifies the
-00035270: 2064 696d 656e 7369 6f6e 2061 6c6f 6e67   dimension along
-00035280: 2077 6869 6368 2074 6f20 7072 6f70 6167   which to propag
-00035290: 6174 6520 7661 6c75 6573 2077 6865 6e0a  ate values when.
-000352a0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-000352b0: 696e 672e 0a20 2020 2020 2020 206c 696d  ing..        lim
-000352c0: 6974 203a 2069 6e74 206f 7220 4e6f 6e65  it : int or None
-000352d0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-000352e0: 2020 2020 2020 2054 6865 206d 6178 696d         The maxim
-000352f0: 756d 206e 756d 6265 7220 6f66 2063 6f6e  um number of con
-00035300: 7365 6375 7469 7665 204e 614e 2076 616c  secutive NaN val
-00035310: 7565 7320 746f 2066 6f72 7761 7264 2066  ues to forward f
-00035320: 696c 6c2e 2049 6e0a 2020 2020 2020 2020  ill. In.        
-00035330: 2020 2020 6f74 6865 7220 776f 7264 732c      other words,
-00035340: 2069 6620 7468 6572 6520 6973 2061 2067   if there is a g
-00035350: 6170 2077 6974 6820 6d6f 7265 2074 6861  ap with more tha
-00035360: 6e20 7468 6973 206e 756d 6265 7220 6f66  n this number of
-00035370: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00035380: 7365 6375 7469 7665 204e 614e 732c 2069  secutive NaNs, i
-00035390: 7420 7769 6c6c 206f 6e6c 7920 6265 2070  t will only be p
-000353a0: 6172 7469 616c 6c79 2066 696c 6c65 642e  artially filled.
-000353b0: 204d 7573 7420 6265 2067 7265 6174 6572   Must be greater
-000353c0: 0a20 2020 2020 2020 2020 2020 2074 6861  .            tha
-000353d0: 6e20 3020 6f72 204e 6f6e 6520 666f 7220  n 0 or None for 
-000353e0: 6e6f 206c 696d 6974 2e20 4d75 7374 2062  no limit. Must b
-000353f0: 6520 4e6f 6e65 206f 7220 6772 6561 7465  e None or greate
-00035400: 7220 7468 616e 206f 7220 6571 7561 6c0a  r than or equal.
-00035410: 2020 2020 2020 2020 2020 2020 746f 2061              to a
-00035420: 7869 7320 6c65 6e67 7468 2069 6620 6669  xis length if fi
-00035430: 6c6c 696e 6720 616c 6f6e 6720 6368 756e  lling along chun
-00035440: 6b65 6420 6178 6573 2028 6469 6d65 6e73  ked axes (dimens
-00035450: 696f 6e73 292e 0a0a 2020 2020 2020 2020  ions)...        
-00035460: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-00035470: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00035480: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
-00035490: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-000354a0: 2078 6172 7261 792e 636f 7265 2e6d 6973   xarray.core.mis
-000354b0: 7369 6e67 2069 6d70 6f72 7420 5f61 7070  sing import _app
-000354c0: 6c79 5f6f 7665 725f 7661 7273 5f77 6974  ly_over_vars_wit
-000354d0: 685f 6469 6d2c 2066 6669 6c6c 0a0a 2020  h_dim, ffill..  
-000354e0: 2020 2020 2020 6e65 7720 3d20 5f61 7070        new = _app
-000354f0: 6c79 5f6f 7665 725f 7661 7273 5f77 6974  ly_over_vars_wit
-00035500: 685f 6469 6d28 6666 696c 6c2c 2073 656c  h_dim(ffill, sel
-00035510: 662c 2064 696d 3d64 696d 2c20 6c69 6d69  f, dim=dim, limi
-00035520: 743d 6c69 6d69 7429 0a20 2020 2020 2020  t=limit).       
-00035530: 2072 6574 7572 6e20 6e65 770a 0a20 2020   return new..   
-00035540: 2064 6566 2062 6669 6c6c 2873 656c 663a   def bfill(self:
-00035550: 2054 5f44 6174 6173 6574 2c20 6469 6d3a   T_Dataset, dim:
-00035560: 2048 6173 6861 626c 652c 206c 696d 6974   Hashable, limit
-00035570: 3a20 696e 7420 7c20 4e6f 6e65 203d 204e  : int | None = N
-00035580: 6f6e 6529 202d 3e20 545f 4461 7461 7365  one) -> T_Datase
-00035590: 743a 0a20 2020 2020 2020 2022 2222 4669  t:.        """Fi
-000355a0: 6c6c 204e 614e 2076 616c 7565 7320 6279  ll NaN values by
-000355b0: 2070 726f 7061 6761 7469 6e67 2076 616c   propagating val
-000355c0: 7565 7320 6261 636b 7761 7264 0a0a 2020  ues backward..  
-000355d0: 2020 2020 2020 2a52 6571 7569 7265 7320        *Requires 
-000355e0: 626f 7474 6c65 6e65 636b 2e2a 0a0a 2020  bottleneck.*..  
-000355f0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00035600: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00035610: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
-00035620: 3a20 4861 7368 6162 6c65 0a20 2020 2020  : Hashable.     
-00035630: 2020 2020 2020 2053 7065 6369 6669 6573         Specifies
-00035640: 2074 6865 2064 696d 656e 7369 6f6e 2061   the dimension a
-00035650: 6c6f 6e67 2077 6869 6368 2074 6f20 7072  long which to pr
-00035660: 6f70 6167 6174 6520 7661 6c75 6573 2077  opagate values w
-00035670: 6865 6e0a 2020 2020 2020 2020 2020 2020  hen.            
-00035680: 6669 6c6c 696e 672e 0a20 2020 2020 2020  filling..       
-00035690: 206c 696d 6974 203a 2069 6e74 206f 7220   limit : int or 
-000356a0: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0a20  None, optional. 
-000356b0: 2020 2020 2020 2020 2020 2054 6865 206d             The m
-000356c0: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
-000356d0: 2063 6f6e 7365 6375 7469 7665 204e 614e   consecutive NaN
-000356e0: 2076 616c 7565 7320 746f 2062 6163 6b77   values to backw
-000356f0: 6172 6420 6669 6c6c 2e20 496e 0a20 2020  ard fill. In.   
-00035700: 2020 2020 2020 2020 206f 7468 6572 2077           other w
-00035710: 6f72 6473 2c20 6966 2074 6865 7265 2069  ords, if there i
-00035720: 7320 6120 6761 7020 7769 7468 206d 6f72  s a gap with mor
-00035730: 6520 7468 616e 2074 6869 7320 6e75 6d62  e than this numb
-00035740: 6572 206f 660a 2020 2020 2020 2020 2020  er of.          
-00035750: 2020 636f 6e73 6563 7574 6976 6520 4e61    consecutive Na
-00035760: 4e73 2c20 6974 2077 696c 6c20 6f6e 6c79  Ns, it will only
-00035770: 2062 6520 7061 7274 6961 6c6c 7920 6669   be partially fi
-00035780: 6c6c 6564 2e20 4d75 7374 2062 6520 6772  lled. Must be gr
-00035790: 6561 7465 720a 2020 2020 2020 2020 2020  eater.          
-000357a0: 2020 7468 616e 2030 206f 7220 4e6f 6e65    than 0 or None
-000357b0: 2066 6f72 206e 6f20 6c69 6d69 742e 204d   for no limit. M
-000357c0: 7573 7420 6265 204e 6f6e 6520 6f72 2067  ust be None or g
-000357d0: 7265 6174 6572 2074 6861 6e20 6f72 2065  reater than or e
-000357e0: 7175 616c 0a20 2020 2020 2020 2020 2020  qual.           
-000357f0: 2074 6f20 6178 6973 206c 656e 6774 6820   to axis length 
-00035800: 6966 2066 696c 6c69 6e67 2061 6c6f 6e67  if filling along
-00035810: 2063 6875 6e6b 6564 2061 7865 7320 2864   chunked axes (d
-00035820: 696d 656e 7369 6f6e 7329 2e0a 0a20 2020  imensions)...   
-00035830: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00035840: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00035850: 2020 2020 2044 6174 6173 6574 0a20 2020       Dataset.   
-00035860: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00035870: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-00035880: 652e 6d69 7373 696e 6720 696d 706f 7274  e.missing import
-00035890: 205f 6170 706c 795f 6f76 6572 5f76 6172   _apply_over_var
-000358a0: 735f 7769 7468 5f64 696d 2c20 6266 696c  s_with_dim, bfil
-000358b0: 6c0a 0a20 2020 2020 2020 206e 6577 203d  l..        new =
-000358c0: 205f 6170 706c 795f 6f76 6572 5f76 6172   _apply_over_var
-000358d0: 735f 7769 7468 5f64 696d 2862 6669 6c6c  s_with_dim(bfill
-000358e0: 2c20 7365 6c66 2c20 6469 6d3d 6469 6d2c  , self, dim=dim,
-000358f0: 206c 696d 6974 3d6c 696d 6974 290a 2020   limit=limit).  
-00035900: 2020 2020 2020 7265 7475 726e 206e 6577        return new
-00035910: 0a0a 2020 2020 6465 6620 636f 6d62 696e  ..    def combin
-00035920: 655f 6669 7273 7428 7365 6c66 3a20 545f  e_first(self: T_
-00035930: 4461 7461 7365 742c 206f 7468 6572 3a20  Dataset, other: 
-00035940: 545f 4461 7461 7365 7429 202d 3e20 545f  T_Dataset) -> T_
-00035950: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-00035960: 2022 2222 436f 6d62 696e 6520 7477 6f20   """Combine two 
-00035970: 4461 7461 7365 7473 2c20 6465 6661 756c  Datasets, defaul
-00035980: 7420 746f 2064 6174 615f 7661 7273 206f  t to data_vars o
-00035990: 6620 7365 6c66 2e0a 0a20 2020 2020 2020  f self...       
-000359a0: 2054 6865 206e 6577 2063 6f6f 7264 696e   The new coordin
-000359b0: 6174 6573 2066 6f6c 6c6f 7720 7468 6520  ates follow the 
-000359c0: 6e6f 726d 616c 2062 726f 6164 6361 7374  normal broadcast
-000359d0: 696e 6720 616e 6420 616c 6967 6e6d 656e  ing and alignmen
-000359e0: 7420 7275 6c65 730a 2020 2020 2020 2020  t rules.        
-000359f0: 6f66 2060 606a 6f69 6e3d 276f 7574 6572  of ``join='outer
-00035a00: 2760 602e 2020 5661 6361 6e74 2063 656c  '``.  Vacant cel
-00035a10: 6c73 2069 6e20 7468 6520 6578 7061 6e64  ls in the expand
-00035a20: 6564 2063 6f6f 7264 696e 6174 6573 2061  ed coordinates a
-00035a30: 7265 0a20 2020 2020 2020 2066 696c 6c65  re.        fille
-00035a40: 6420 7769 7468 206e 702e 6e61 6e2e 0a0a  d with np.nan...
-00035a50: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00035a60: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00035a70: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6f74  -----.        ot
-00035a80: 6865 7220 3a20 4461 7461 7365 740a 2020  her : Dataset.  
-00035a90: 2020 2020 2020 2020 2020 5573 6564 2074            Used t
-00035aa0: 6f20 6669 6c6c 2061 6c6c 206d 6174 6368  o fill all match
-00035ab0: 696e 6720 6d69 7373 696e 6720 7661 6c75  ing missing valu
-00035ac0: 6573 2069 6e20 7468 6973 2061 7272 6179  es in this array
-00035ad0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00035ae0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00035af0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
-00035b00: 6574 0a20 2020 2020 2020 2022 2222 0a20  et.        """. 
-00035b10: 2020 2020 2020 206f 7574 203d 206f 7073         out = ops
-00035b20: 2e66 696c 6c6e 6128 7365 6c66 2c20 6f74  .fillna(self, ot
-00035b30: 6865 722c 206a 6f69 6e3d 226f 7574 6572  her, join="outer
-00035b40: 222c 2064 6174 6173 6574 5f6a 6f69 6e3d  ", dataset_join=
-00035b50: 226f 7574 6572 2229 0a20 2020 2020 2020  "outer").       
-00035b60: 2072 6574 7572 6e20 6f75 740a 0a20 2020   return out..   
-00035b70: 2064 6566 2072 6564 7563 6528 0a20 2020   def reduce(.   
-00035b80: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-00035b90: 6173 6574 2c0a 2020 2020 2020 2020 6675  aset,.        fu
-00035ba0: 6e63 3a20 4361 6c6c 6162 6c65 2c0a 2020  nc: Callable,.  
-00035bb0: 2020 2020 2020 6469 6d3a 2044 696d 7320        dim: Dims 
-00035bc0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00035bd0: 2a2c 0a20 2020 2020 2020 206b 6565 705f  *,.        keep_
-00035be0: 6174 7472 733a 2062 6f6f 6c20 7c20 4e6f  attrs: bool | No
-00035bf0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-00035c00: 2020 206b 6565 7064 696d 733a 2062 6f6f     keepdims: boo
-00035c10: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00035c20: 2020 206e 756d 6572 6963 5f6f 6e6c 793a     numeric_only:
-00035c30: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00035c40: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
-00035c50: 2041 6e79 2c0a 2020 2020 2920 2d3e 2054   Any,.    ) -> T
-00035c60: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-00035c70: 2020 2222 2252 6564 7563 6520 7468 6973    """Reduce this
-00035c80: 2064 6174 6173 6574 2062 7920 6170 706c   dataset by appl
-00035c90: 7969 6e67 2060 6675 6e63 6020 616c 6f6e  ying `func` alon
-00035ca0: 6720 736f 6d65 2064 696d 656e 7369 6f6e  g some dimension
-00035cb0: 2873 292e 0a0a 2020 2020 2020 2020 5061  (s)...        Pa
-00035cc0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00035cd0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00035ce0: 2020 2020 6675 6e63 203a 2063 616c 6c61      func : calla
-00035cf0: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
-00035d00: 4675 6e63 7469 6f6e 2077 6869 6368 2063  Function which c
-00035d10: 616e 2062 6520 6361 6c6c 6564 2069 6e20  an be called in 
-00035d20: 7468 6520 666f 726d 0a20 2020 2020 2020  the form.       
-00035d30: 2020 2020 2060 6628 782c 2061 7869 733d       `f(x, axis=
-00035d40: 6178 6973 2c20 2a2a 6b77 6172 6773 2960  axis, **kwargs)`
-00035d50: 2074 6f20 7265 7475 726e 2074 6865 2072   to return the r
-00035d60: 6573 756c 7420 6f66 2072 6564 7563 696e  esult of reducin
-00035d70: 6720 616e 0a20 2020 2020 2020 2020 2020  g an.           
-00035d80: 206e 702e 6e64 6172 7261 7920 6f76 6572   np.ndarray over
-00035d90: 2061 6e20 696e 7465 6765 7220 7661 6c75   an integer valu
-00035da0: 6564 2061 7869 732e 0a20 2020 2020 2020  ed axis..       
-00035db0: 2064 696d 203a 2073 7472 2c20 4974 6572   dim : str, Iter
-00035dc0: 6162 6c65 206f 6620 4861 7368 6162 6c65  able of Hashable
-00035dd0: 206f 7220 4e6f 6e65 2c20 6f70 7469 6f6e   or None, option
-00035de0: 616c 0a20 2020 2020 2020 2020 2020 2044  al.            D
-00035df0: 696d 656e 7369 6f6e 2873 2920 6f76 6572  imension(s) over
-00035e00: 2077 6869 6368 2074 6f20 6170 706c 7920   which to apply 
-00035e10: 6066 756e 6360 2e20 4279 2064 6566 6175  `func`. By defau
-00035e20: 6c74 2060 6675 6e63 6020 6973 0a20 2020  lt `func` is.   
-00035e30: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-00035e40: 206f 7665 7220 616c 6c20 6469 6d65 6e73   over all dimens
-00035e50: 696f 6e73 2e0a 2020 2020 2020 2020 6b65  ions..        ke
-00035e60: 6570 5f61 7474 7273 203a 2062 6f6f 6c20  ep_attrs : bool 
-00035e70: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
-00035e80: 6c0a 2020 2020 2020 2020 2020 2020 4966  l.            If
-00035e90: 2054 7275 652c 2074 6865 2064 6174 6173   True, the datas
-00035ea0: 6574 2773 2061 7474 7269 6275 7465 7320  et's attributes 
-00035eb0: 2860 6174 7472 7360 2920 7769 6c6c 2062  (`attrs`) will b
-00035ec0: 6520 636f 7069 6564 2066 726f 6d0a 2020  e copied from.  
-00035ed0: 2020 2020 2020 2020 2020 7468 6520 6f72            the or
-00035ee0: 6967 696e 616c 206f 626a 6563 7420 746f  iginal object to
-00035ef0: 2074 6865 206e 6577 206f 6e65 2e20 2049   the new one.  I
-00035f00: 6620 4661 6c73 6520 2864 6566 6175 6c74  f False (default
-00035f10: 292c 2074 6865 206e 6577 0a20 2020 2020  ), the new.     
-00035f20: 2020 2020 2020 206f 626a 6563 7420 7769         object wi
-00035f30: 6c6c 2062 6520 7265 7475 726e 6564 2077  ll be returned w
-00035f40: 6974 686f 7574 2061 7474 7269 6275 7465  ithout attribute
-00035f50: 732e 0a20 2020 2020 2020 206b 6565 7064  s..        keepd
-00035f60: 696d 7320 3a20 626f 6f6c 2c20 6465 6661  ims : bool, defa
-00035f70: 756c 743a 2046 616c 7365 0a20 2020 2020  ult: False.     
-00035f80: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00035f90: 7468 6520 6469 6d65 6e73 696f 6e73 2077  the dimensions w
-00035fa0: 6869 6368 2061 7265 2072 6564 7563 6564  hich are reduced
-00035fb0: 2061 7265 206c 6566 7420 696e 2074 6865   are left in the
-00035fc0: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-00035fd0: 2020 2020 6173 2064 696d 656e 7369 6f6e      as dimension
-00035fe0: 7320 6f66 2073 697a 6520 6f6e 652e 2043  s of size one. C
-00035ff0: 6f6f 7264 696e 6174 6573 2074 6861 7420  oordinates that 
-00036000: 7573 6520 7468 6573 6520 6469 6d65 6e73  use these dimens
-00036010: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-00036020: 2061 7265 2072 656d 6f76 6564 2e0a 2020   are removed..  
-00036030: 2020 2020 2020 6e75 6d65 7269 635f 6f6e        numeric_on
-00036040: 6c79 203a 2062 6f6f 6c2c 2064 6566 6175  ly : bool, defau
-00036050: 6c74 3a20 4661 6c73 650a 2020 2020 2020  lt: False.      
-00036060: 2020 2020 2020 4966 2054 7275 652c 206f        If True, o
-00036070: 6e6c 7920 6170 706c 7920 6060 6675 6e63  nly apply ``func
-00036080: 6060 2074 6f20 7661 7269 6162 6c65 7320  `` to variables 
-00036090: 7769 7468 2061 206e 756d 6572 6963 2064  with a numeric d
-000360a0: 7479 7065 2e0a 2020 2020 2020 2020 2a2a  type..        **
-000360b0: 6b77 6172 6773 203a 2041 6e79 0a20 2020  kwargs : Any.   
-000360c0: 2020 2020 2020 2020 2041 6464 6974 696f           Additio
-000360d0: 6e61 6c20 6b65 7977 6f72 6420 6172 6775  nal keyword argu
-000360e0: 6d65 6e74 7320 7061 7373 6564 206f 6e20  ments passed on 
-000360f0: 746f 2060 6066 756e 6360 602e 0a0a 2020  to ``func``...  
-00036100: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00036110: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00036120: 2020 2020 2020 7265 6475 6365 6420 3a20        reduced : 
-00036130: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
-00036140: 2020 2020 4461 7461 7365 7420 7769 7468      Dataset with
-00036150: 2074 6869 7320 6f62 6a65 6374 2773 2044   this object's D
-00036160: 6174 6141 7272 6179 7320 7265 706c 6163  ataArrays replac
-00036170: 6564 2077 6974 6820 6e65 7720 4461 7461  ed with new Data
-00036180: 4172 7261 7973 0a20 2020 2020 2020 2020  Arrays.         
-00036190: 2020 206f 6620 7375 6d6d 6172 697a 6564     of summarized
-000361a0: 2064 6174 6120 616e 6420 7468 6520 696e   data and the in
-000361b0: 6469 6361 7465 6420 6469 6d65 6e73 696f  dicated dimensio
-000361c0: 6e28 7329 2072 656d 6f76 6564 2e0a 2020  n(s) removed..  
-000361d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000361e0: 2020 6966 206b 7761 7267 732e 6765 7428    if kwargs.get(
-000361f0: 2261 7869 7322 2c20 4e6f 6e65 2920 6973  "axis", None) is
-00036200: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00036210: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00036220: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00036230: 2020 2020 2020 2020 2022 7061 7373 696e           "passin
-00036240: 6720 2761 7869 7327 2074 6f20 4461 7461  g 'axis' to Data
-00036250: 7365 7420 7265 6475 6365 206d 6574 686f  set reduce metho
-00036260: 6473 2069 7320 616d 6269 6775 6f75 732e  ds is ambiguous.
-00036270: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00036280: 2020 2220 506c 6561 7365 2075 7365 2027    " Please use '
-00036290: 6469 6d27 2069 6e73 7465 6164 2e22 0a20  dim' instead.". 
-000362a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000362b0: 2020 2020 2020 6966 2064 696d 2069 7320        if dim is 
-000362c0: 4e6f 6e65 206f 7220 6469 6d20 6973 202e  None or dim is .
-000362d0: 2e2e 3a0a 2020 2020 2020 2020 2020 2020  ..:.            
-000362e0: 6469 6d73 203d 2073 6574 2873 656c 662e  dims = set(self.
-000362f0: 6469 6d73 290a 2020 2020 2020 2020 656c  dims).        el
-00036300: 6966 2069 7369 6e73 7461 6e63 6528 6469  if isinstance(di
-00036310: 6d2c 2073 7472 2920 6f72 206e 6f74 2069  m, str) or not i
-00036320: 7369 6e73 7461 6e63 6528 6469 6d2c 2049  sinstance(dim, I
-00036330: 7465 7261 626c 6529 3a0a 2020 2020 2020  terable):.      
-00036340: 2020 2020 2020 6469 6d73 203d 207b 6469        dims = {di
-00036350: 6d7d 0a20 2020 2020 2020 2065 6c73 653a  m}.        else:
-00036360: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-00036370: 7320 3d20 7365 7428 6469 6d29 0a0a 2020  s = set(dim)..  
-00036380: 2020 2020 2020 6d69 7373 696e 675f 6469        missing_di
-00036390: 6d65 6e73 696f 6e73 203d 205b 6420 666f  mensions = [d fo
-000363a0: 7220 6420 696e 2064 696d 7320 6966 2064  r d in dims if d
-000363b0: 206e 6f74 2069 6e20 7365 6c66 2e64 696d   not in self.dim
-000363c0: 735d 0a20 2020 2020 2020 2069 6620 6d69  s].        if mi
-000363d0: 7373 696e 675f 6469 6d65 6e73 696f 6e73  ssing_dimensions
-000363e0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000363f0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-00036400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036410: 6622 4461 7461 7365 7420 646f 6573 206e  f"Dataset does n
-00036420: 6f74 2063 6f6e 7461 696e 2074 6865 2064  ot contain the d
-00036430: 696d 656e 7369 6f6e 733a 207b 6d69 7373  imensions: {miss
-00036440: 696e 675f 6469 6d65 6e73 696f 6e73 7d22  ing_dimensions}"
-00036450: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00036460: 2020 2020 2020 2020 6966 206b 6565 705f          if keep_
-00036470: 6174 7472 7320 6973 204e 6f6e 653a 0a20  attrs is None:. 
-00036480: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
-00036490: 6174 7472 7320 3d20 5f67 6574 5f6b 6565  attrs = _get_kee
-000364a0: 705f 6174 7472 7328 6465 6661 756c 743d  p_attrs(default=
-000364b0: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
-000364c0: 7661 7269 6162 6c65 733a 2064 6963 745b  variables: dict[
-000364d0: 4861 7368 6162 6c65 2c20 5661 7269 6162  Hashable, Variab
-000364e0: 6c65 5d20 3d20 7b7d 0a20 2020 2020 2020  le] = {}.       
-000364f0: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
-00036500: 6e20 7365 6c66 2e5f 7661 7269 6162 6c65  n self._variable
-00036510: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-00036520: 2020 2020 2020 2072 6564 7563 655f 6469         reduce_di
-00036530: 6d73 203d 205b 6420 666f 7220 6420 696e  ms = [d for d in
-00036540: 2076 6172 2e64 696d 7320 6966 2064 2069   var.dims if d i
-00036550: 6e20 6469 6d73 5d0a 2020 2020 2020 2020  n dims].        
-00036560: 2020 2020 6966 206e 616d 6520 696e 2073      if name in s
-00036570: 656c 662e 636f 6f72 6473 3a0a 2020 2020  elf.coords:.    
-00036580: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00036590: 6f74 2072 6564 7563 655f 6469 6d73 3a0a  ot reduce_dims:.
-000365a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000365b0: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
-000365c0: 6d65 5d20 3d20 7661 720a 2020 2020 2020  me] = var.      
-000365d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000365e0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-000365f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036600: 2020 2020 2023 2053 6f6d 6520 7265 6475       # Some redu
-00036610: 6374 696f 6e20 6675 6e63 7469 6f6e 7320  ction functions 
-00036620: 2865 2e67 2e20 7374 642c 2076 6172 2920  (e.g. std, var) 
-00036630: 6e65 6564 2074 6f20 7275 6e20 6f6e 2076  need to run on v
-00036640: 6172 6961 626c 6573 0a20 2020 2020 2020  ariables.       
-00036650: 2020 2020 2020 2020 2020 2020 2023 2074               # t
-00036660: 6861 7420 646f 6e27 7420 6861 7665 2074  hat don't have t
-00036670: 6865 2072 6564 7563 6520 6469 6d73 3a20  he reduce dims: 
-00036680: 5052 3533 3933 0a20 2020 2020 2020 2020  PR5393.         
-00036690: 2020 2020 2020 2020 2020 206e 6f74 2072             not r
-000366a0: 6564 7563 655f 6469 6d73 0a20 2020 2020  educe_dims.     
-000366b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000366c0: 7220 6e6f 7420 6e75 6d65 7269 635f 6f6e  r not numeric_on
-000366d0: 6c79 0a20 2020 2020 2020 2020 2020 2020  ly.             
-000366e0: 2020 2020 2020 206f 7220 6e70 2e69 7373         or np.iss
-000366f0: 7562 6474 7970 6528 7661 722e 6474 7970  ubdtype(var.dtyp
-00036700: 652c 206e 702e 6e75 6d62 6572 290a 2020  e, np.number).  
-00036710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036720: 2020 6f72 2028 7661 722e 6474 7970 6520    or (var.dtype 
-00036730: 3d3d 206e 702e 626f 6f6c 5f29 0a20 2020  == np.bool_).   
-00036740: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-00036750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036760: 2020 2020 2320 7072 6566 6572 2074 6f20      # prefer to 
-00036770: 6167 6772 6567 6174 6520 6f76 6572 2061  aggregate over a
-00036780: 7869 733d 4e6f 6e65 2072 6174 6865 7220  xis=None rather 
-00036790: 7468 616e 0a20 2020 2020 2020 2020 2020  than.           
-000367a0: 2020 2020 2020 2020 2023 2061 7869 733d           # axis=
-000367b0: 2830 2c20 3129 2069 6620 7468 6579 2077  (0, 1) if they w
-000367c0: 696c 6c20 6265 2065 7175 6976 616c 656e  ill be equivalen
-000367d0: 742c 2062 6563 6175 7365 0a20 2020 2020  t, because.     
-000367e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000367f0: 2074 6865 2066 6f72 6d65 7220 6973 206f   the former is o
-00036800: 6674 656e 206d 6f72 6520 6566 6669 6369  ften more effici
-00036810: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
-00036820: 2020 2020 2020 2020 2320 6b65 6570 2073          # keep s
-00036830: 696e 676c 652d 656c 656d 656e 7420 6469  ingle-element di
-00036840: 6d73 2061 7320 6c69 7374 2c20 746f 2073  ms as list, to s
-00036850: 7570 706f 7274 2048 6173 6861 626c 6573  upport Hashables
-00036860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036870: 2020 2020 2072 6564 7563 655f 6d61 7962       reduce_mayb
-00036880: 655f 7369 6e67 6c65 203d 2028 0a20 2020  e_single = (.   
-00036890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000368a0: 2020 2020 204e 6f6e 650a 2020 2020 2020       None.      
-000368b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000368c0: 2020 6966 206c 656e 2872 6564 7563 655f    if len(reduce_
-000368d0: 6469 6d73 2920 3d3d 2076 6172 2e6e 6469  dims) == var.ndi
-000368e0: 6d20 616e 6420 7661 722e 6e64 696d 2021  m and var.ndim !
-000368f0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00036900: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00036910: 2072 6564 7563 655f 6469 6d73 0a20 2020   reduce_dims.   
-00036920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036930: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00036940: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-00036950: 5b6e 616d 655d 203d 2076 6172 2e72 6564  [name] = var.red
-00036960: 7563 6528 0a20 2020 2020 2020 2020 2020  uce(.           
-00036970: 2020 2020 2020 2020 2020 2020 2066 756e               fun
-00036980: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
-00036990: 2020 2020 2020 2020 2020 2064 696d 3d72             dim=r
-000369a0: 6564 7563 655f 6d61 7962 655f 7369 6e67  educe_maybe_sing
-000369b0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-000369c0: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-000369d0: 5f61 7474 7273 3d6b 6565 705f 6174 7472  _attrs=keep_attr
-000369e0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000369f0: 2020 2020 2020 2020 2020 206b 6565 7064             keepd
-00036a00: 696d 733d 6b65 6570 6469 6d73 2c0a 2020  ims=keepdims,.  
-00036a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036a20: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-00036a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036a40: 2020 2020 290a 0a20 2020 2020 2020 2063      )..        c
-00036a50: 6f6f 7264 5f6e 616d 6573 203d 207b 6b20  oord_names = {k 
-00036a60: 666f 7220 6b20 696e 2073 656c 662e 636f  for k in self.co
-00036a70: 6f72 6473 2069 6620 6b20 696e 2076 6172  ords if k in var
-00036a80: 6961 626c 6573 7d0a 2020 2020 2020 2020  iables}.        
-00036a90: 696e 6465 7865 7320 3d20 7b6b 3a20 7620  indexes = {k: v 
-00036aa0: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-00036ab0: 2e5f 696e 6465 7865 732e 6974 656d 7328  ._indexes.items(
-00036ac0: 2920 6966 206b 2069 6e20 7661 7269 6162  ) if k in variab
-00036ad0: 6c65 737d 0a20 2020 2020 2020 2061 7474  les}.        att
-00036ae0: 7273 203d 2073 656c 662e 6174 7472 7320  rs = self.attrs 
-00036af0: 6966 206b 6565 705f 6174 7472 7320 656c  if keep_attrs el
-00036b00: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
-00036b10: 7265 7475 726e 2073 656c 662e 5f72 6570  return self._rep
-00036b20: 6c61 6365 5f77 6974 685f 6e65 775f 6469  lace_with_new_di
-00036b30: 6d73 280a 2020 2020 2020 2020 2020 2020  ms(.            
-00036b40: 7661 7269 6162 6c65 732c 2063 6f6f 7264  variables, coord
-00036b50: 5f6e 616d 6573 3d63 6f6f 7264 5f6e 616d  _names=coord_nam
-00036b60: 6573 2c20 6174 7472 733d 6174 7472 732c  es, attrs=attrs,
-00036b70: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
-00036b80: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00036b90: 6465 6620 6d61 7028 0a20 2020 2020 2020  def map(.       
-00036ba0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-00036bb0: 2c0a 2020 2020 2020 2020 6675 6e63 3a20  ,.        func: 
-00036bc0: 4361 6c6c 6162 6c65 2c0a 2020 2020 2020  Callable,.      
-00036bd0: 2020 6b65 6570 5f61 7474 7273 3a20 626f    keep_attrs: bo
-00036be0: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
-00036bf0: 2c0a 2020 2020 2020 2020 6172 6773 3a20  ,.        args: 
-00036c00: 4974 6572 6162 6c65 5b41 6e79 5d20 3d20  Iterable[Any] = 
-00036c10: 2829 2c0a 2020 2020 2020 2020 2a2a 6b77  (),.        **kw
-00036c20: 6172 6773 3a20 416e 792c 0a20 2020 2029  args: Any,.    )
-00036c30: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
-00036c40: 2020 2020 2020 2022 2222 4170 706c 7920         """Apply 
-00036c50: 6120 6675 6e63 7469 6f6e 2074 6f20 6561  a function to ea
-00036c60: 6368 2064 6174 6120 7661 7269 6162 6c65  ch data variable
-00036c70: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
-00036c80: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00036c90: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00036ca0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00036cb0: 6675 6e63 203a 2063 616c 6c61 626c 650a  func : callable.
-00036cc0: 2020 2020 2020 2020 2020 2020 4675 6e63              Func
-00036cd0: 7469 6f6e 2077 6869 6368 2063 616e 2062  tion which can b
-00036ce0: 6520 6361 6c6c 6564 2069 6e20 7468 6520  e called in the 
-00036cf0: 666f 726d 2060 6675 6e63 2878 2c20 2a61  form `func(x, *a
-00036d00: 7267 732c 202a 2a6b 7761 7267 7329 600a  rgs, **kwargs)`.
-00036d10: 2020 2020 2020 2020 2020 2020 746f 2074              to t
-00036d20: 7261 6e73 666f 726d 2065 6163 6820 4461  ransform each Da
-00036d30: 7461 4172 7261 7920 6078 6020 696e 2074  taArray `x` in t
-00036d40: 6869 7320 6461 7461 7365 7420 696e 746f  his dataset into
-00036d50: 2061 6e6f 7468 6572 0a20 2020 2020 2020   another.       
-00036d60: 2020 2020 2044 6174 6141 7272 6179 2e0a       DataArray..
-00036d70: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
-00036d80: 7273 203a 2062 6f6f 6c20 6f72 204e 6f6e  rs : bool or Non
-00036d90: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-00036da0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00036db0: 2062 6f74 6820 7468 6520 6461 7461 7365   both the datase
-00036dc0: 7427 7320 616e 6420 7661 7269 6162 6c65  t's and variable
-00036dd0: 7327 2061 7474 7269 6275 7465 7320 2860  s' attributes (`
-00036de0: 6174 7472 7360 2920 7769 6c6c 2062 650a  attrs`) will be.
-00036df0: 2020 2020 2020 2020 2020 2020 636f 7069              copi
-00036e00: 6564 2066 726f 6d20 7468 6520 6f72 6967  ed from the orig
-00036e10: 696e 616c 206f 626a 6563 7473 2074 6f20  inal objects to 
-00036e20: 7468 6520 6e65 7720 6f6e 6573 2e20 4966  the new ones. If
-00036e30: 2046 616c 7365 2c20 7468 6520 6e65 7720   False, the new 
-00036e40: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
-00036e50: 2020 2020 616e 6420 7661 7269 6162 6c65      and variable
-00036e60: 7320 7769 6c6c 2062 6520 7265 7475 726e  s will be return
-00036e70: 6564 2077 6974 686f 7574 2063 6f70 7969  ed without copyi
-00036e80: 6e67 2074 6865 2061 7474 7269 6275 7465  ng the attribute
-00036e90: 732e 0a20 2020 2020 2020 2061 7267 7320  s..        args 
-00036ea0: 3a20 6974 6572 6162 6c65 2c20 6f70 7469  : iterable, opti
-00036eb0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00036ec0: 2050 6f73 6974 696f 6e61 6c20 6172 6775   Positional argu
-00036ed0: 6d65 6e74 7320 7061 7373 6564 206f 6e20  ments passed on 
-00036ee0: 746f 2060 6675 6e63 602e 0a20 2020 2020  to `func`..     
-00036ef0: 2020 202a 2a6b 7761 7267 7320 3a20 416e     **kwargs : An
-00036f00: 790a 2020 2020 2020 2020 2020 2020 4b65  y.            Ke
-00036f10: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-00036f20: 7061 7373 6564 206f 6e20 746f 2060 6675  passed on to `fu
-00036f30: 6e63 602e 0a0a 2020 2020 2020 2020 5265  nc`...        Re
-00036f40: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-00036f50: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6170  -----.        ap
-00036f60: 706c 6965 6420 3a20 4461 7461 7365 740a  plied : Dataset.
-00036f70: 2020 2020 2020 2020 2020 2020 5265 7375              Resu
-00036f80: 6c74 696e 6720 6461 7461 7365 7420 6672  lting dataset fr
-00036f90: 6f6d 2061 7070 6c79 696e 6720 6060 6675  om applying ``fu
-00036fa0: 6e63 6060 2074 6f20 6561 6368 2064 6174  nc`` to each dat
-00036fb0: 6120 7661 7269 6162 6c65 2e0a 0a20 2020  a variable...   
-00036fc0: 2020 2020 2045 7861 6d70 6c65 730a 2020       Examples.  
-00036fd0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-00036fe0: 2020 2020 2020 203e 3e3e 2064 6120 3d20         >>> da = 
-00036ff0: 7872 2e44 6174 6141 7272 6179 286e 702e  xr.DataArray(np.
-00037000: 7261 6e64 6f6d 2e72 616e 646e 2832 2c20  random.randn(2, 
-00037010: 3329 290a 2020 2020 2020 2020 3e3e 3e20  3)).        >>> 
-00037020: 6473 203d 2078 722e 4461 7461 7365 7428  ds = xr.Dataset(
-00037030: 7b22 666f 6f22 3a20 6461 2c20 2262 6172  {"foo": da, "bar
-00037040: 223a 2028 2278 222c 205b 2d31 2c20 325d  ": ("x", [-1, 2]
-00037050: 297d 290a 2020 2020 2020 2020 3e3e 3e20  )}).        >>> 
-00037060: 6473 0a20 2020 2020 2020 203c 7861 7272  ds.        <xarr
-00037070: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
-00037080: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
-00037090: 2028 6469 6d5f 303a 2032 2c20 6469 6d5f   (dim_0: 2, dim_
-000370a0: 313a 2033 2c20 783a 2032 290a 2020 2020  1: 3, x: 2).    
-000370b0: 2020 2020 4469 6d65 6e73 696f 6e73 2077      Dimensions w
-000370c0: 6974 686f 7574 2063 6f6f 7264 696e 6174  ithout coordinat
-000370d0: 6573 3a20 6469 6d5f 302c 2064 696d 5f31  es: dim_0, dim_1
-000370e0: 2c20 780a 2020 2020 2020 2020 4461 7461  , x.        Data
-000370f0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00037100: 2020 2020 2020 2020 666f 6f20 2020 2020          foo     
-00037110: 2028 6469 6d5f 302c 2064 696d 5f31 2920   (dim_0, dim_1) 
-00037120: 666c 6f61 7436 3420 312e 3736 3420 302e  float64 1.764 0.
-00037130: 3430 3032 2030 2e39 3738 3720 322e 3234  4002 0.9787 2.24
-00037140: 3120 312e 3836 3820 2d30 2e39 3737 330a  1 1.868 -0.9773.
-00037150: 2020 2020 2020 2020 2020 2020 6261 7220              bar 
-00037160: 2020 2020 2028 7829 2069 6e74 3634 202d       (x) int64 -
-00037170: 3120 320a 2020 2020 2020 2020 3e3e 3e20  1 2.        >>> 
-00037180: 6473 2e6d 6170 286e 702e 6661 6273 290a  ds.map(np.fabs).
-00037190: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-000371a0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-000371b0: 2044 696d 656e 7369 6f6e 733a 2020 2864   Dimensions:  (d
-000371c0: 696d 5f30 3a20 322c 2064 696d 5f31 3a20  im_0: 2, dim_1: 
-000371d0: 332c 2078 3a20 3229 0a20 2020 2020 2020  3, x: 2).       
-000371e0: 2044 696d 656e 7369 6f6e 7320 7769 7468   Dimensions with
-000371f0: 6f75 7420 636f 6f72 6469 6e61 7465 733a  out coordinates:
-00037200: 2064 696d 5f30 2c20 6469 6d5f 312c 2078   dim_0, dim_1, x
-00037210: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-00037220: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00037230: 2020 2020 2066 6f6f 2020 2020 2020 2864       foo      (d
-00037240: 696d 5f30 2c20 6469 6d5f 3129 2066 6c6f  im_0, dim_1) flo
-00037250: 6174 3634 2031 2e37 3634 2030 2e34 3030  at64 1.764 0.400
-00037260: 3220 302e 3937 3837 2032 2e32 3431 2031  2 0.9787 2.241 1
-00037270: 2e38 3638 2030 2e39 3737 330a 2020 2020  .868 0.9773.    
-00037280: 2020 2020 2020 2020 6261 7220 2020 2020          bar     
-00037290: 2028 7829 2066 6c6f 6174 3634 2031 2e30   (x) float64 1.0
-000372a0: 2032 2e30 0a20 2020 2020 2020 2022 2222   2.0.        """
-000372b0: 0a20 2020 2020 2020 2069 6620 6b65 6570  .        if keep
-000372c0: 5f61 7474 7273 2069 7320 4e6f 6e65 3a0a  _attrs is None:.
-000372d0: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-000372e0: 5f61 7474 7273 203d 205f 6765 745f 6b65  _attrs = _get_ke
-000372f0: 6570 5f61 7474 7273 2864 6566 6175 6c74  ep_attrs(default
-00037300: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-00037310: 7661 7269 6162 6c65 7320 3d20 7b0a 2020  variables = {.  
-00037320: 2020 2020 2020 2020 2020 6b3a 206d 6179            k: may
-00037330: 6265 5f77 7261 705f 6172 7261 7928 762c  be_wrap_array(v,
-00037340: 2066 756e 6328 762c 202a 6172 6773 2c20   func(v, *args, 
-00037350: 2a2a 6b77 6172 6773 2929 0a20 2020 2020  **kwargs)).     
-00037360: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00037370: 696e 2073 656c 662e 6461 7461 5f76 6172  in self.data_var
-00037380: 732e 6974 656d 7328 290a 2020 2020 2020  s.items().      
-00037390: 2020 7d0a 2020 2020 2020 2020 6966 206b    }.        if k
-000373a0: 6565 705f 6174 7472 733a 0a20 2020 2020  eep_attrs:.     
-000373b0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-000373c0: 696e 2076 6172 6961 626c 6573 2e69 7465  in variables.ite
-000373d0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-000373e0: 2020 2020 2020 762e 5f63 6f70 795f 6174        v._copy_at
-000373f0: 7472 735f 6672 6f6d 2873 656c 662e 6461  trs_from(self.da
-00037400: 7461 5f76 6172 735b 6b5d 290a 2020 2020  ta_vars[k]).    
-00037410: 2020 2020 6174 7472 7320 3d20 7365 6c66      attrs = self
-00037420: 2e61 7474 7273 2069 6620 6b65 6570 5f61  .attrs if keep_a
-00037430: 7474 7273 2065 6c73 6520 4e6f 6e65 0a20  ttrs else None. 
-00037440: 2020 2020 2020 2072 6574 7572 6e20 7479         return ty
-00037450: 7065 2873 656c 6629 2876 6172 6961 626c  pe(self)(variabl
-00037460: 6573 2c20 6174 7472 733d 6174 7472 7329  es, attrs=attrs)
-00037470: 0a0a 2020 2020 6465 6620 6170 706c 7928  ..    def apply(
-00037480: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
-00037490: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
-000374a0: 2020 6675 6e63 3a20 4361 6c6c 6162 6c65    func: Callable
-000374b0: 2c0a 2020 2020 2020 2020 6b65 6570 5f61  ,.        keep_a
-000374c0: 7474 7273 3a20 626f 6f6c 207c 204e 6f6e  ttrs: bool | Non
-000374d0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-000374e0: 2020 6172 6773 3a20 4974 6572 6162 6c65    args: Iterable
-000374f0: 5b41 6e79 5d20 3d20 2829 2c0a 2020 2020  [Any] = (),.    
-00037500: 2020 2020 2a2a 6b77 6172 6773 3a20 416e      **kwargs: An
-00037510: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
-00037520: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
-00037530: 2222 0a20 2020 2020 2020 2042 6163 6b77  "".        Backw
-00037540: 6172 6420 636f 6d70 6174 6962 6c65 2069  ard compatible i
-00037550: 6d70 6c65 6d65 6e74 6174 696f 6e20 6f66  mplementation of
-00037560: 2060 606d 6170 6060 0a0a 2020 2020 2020   ``map``..      
-00037570: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-00037580: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00037590: 2020 2020 4461 7461 7365 742e 6d61 700a      Dataset.map.
-000375a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000375b0: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
-000375c0: 6e28 0a20 2020 2020 2020 2020 2020 2022  n(.            "
-000375d0: 4461 7461 7365 742e 6170 706c 7920 6d61  Dataset.apply ma
-000375e0: 7920 6265 2064 6570 7265 6361 7465 6420  y be deprecated 
-000375f0: 696e 2074 6865 2066 7574 7572 652e 2055  in the future. U
-00037600: 7369 6e67 2044 6174 6173 6574 2e6d 6170  sing Dataset.map
-00037610: 2069 7320 656e 636f 7572 6167 6564 222c   is encouraged",
-00037620: 0a20 2020 2020 2020 2020 2020 2050 656e  .            Pen
-00037630: 6469 6e67 4465 7072 6563 6174 696f 6e57  dingDeprecationW
-00037640: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
-00037650: 2020 2020 7374 6163 6b6c 6576 656c 3d32      stacklevel=2
-00037660: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00037670: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00037680: 6d61 7028 6675 6e63 2c20 6b65 6570 5f61  map(func, keep_a
-00037690: 7474 7273 2c20 6172 6773 2c20 2a2a 6b77  ttrs, args, **kw
-000376a0: 6172 6773 290a 0a20 2020 2064 6566 2061  args)..    def a
-000376b0: 7373 6967 6e28 0a20 2020 2020 2020 2073  ssign(.        s
+000270c0: 616e 6420 6b20 6e6f 7420 696e 2061 6c6c  and k not in all
+000270d0: 5f76 6172 5f6e 616d 6573 0a20 2020 2020  _var_names.     
+000270e0: 2020 2020 2020 2020 2020 2061 6e64 206b             and k
+000270f0: 2069 6e20 7365 6c66 2e5f 636f 6f72 645f   in self._coord_
+00027100: 6e61 6d65 730a 2020 2020 2020 2020 2020  names.          
+00027110: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00027120: 2020 2020 206e 6577 5f76 6172 6961 626c       new_variabl
+00027130: 6573 5b6b 5d20 3d20 7365 6c66 2e5f 7661  es[k] = self._va
+00027140: 7269 6162 6c65 735b 6b5d 2e74 6f5f 6261  riables[k].to_ba
+00027150: 7365 5f76 6172 6961 626c 6528 290a 0a20  se_variable().. 
+00027160: 2020 2020 2020 2069 6e64 6578 6573 5f3a         indexes_:
+00027170: 2064 6963 745b 416e 792c 2049 6e64 6578   dict[Any, Index
+00027180: 5d20 3d20 7b0a 2020 2020 2020 2020 2020  ] = {.          
+00027190: 2020 6b3a 2076 2066 6f72 206b 2c20 7620    k: v for k, v 
+000271a0: 696e 2073 656c 662e 5f69 6e64 6578 6573  in self._indexes
+000271b0: 2e69 7465 6d73 2829 2069 6620 6b20 6e6f  .items() if k no
+000271c0: 7420 696e 2064 726f 705f 696e 6465 7865  t in drop_indexe
+000271d0: 730a 2020 2020 2020 2020 7d0a 2020 2020  s.        }.    
+000271e0: 2020 2020 696e 6465 7865 735f 2e75 7064      indexes_.upd
+000271f0: 6174 6528 6e65 775f 696e 6465 7865 7329  ate(new_indexes)
+00027200: 0a0a 2020 2020 2020 2020 7661 7269 6162  ..        variab
+00027210: 6c65 7320 3d20 7b0a 2020 2020 2020 2020  les = {.        
+00027220: 2020 2020 6b3a 2076 2066 6f72 206b 2c20      k: v for k, 
+00027230: 7620 696e 2073 656c 662e 5f76 6172 6961  v in self._varia
+00027240: 626c 6573 2e69 7465 6d73 2829 2069 6620  bles.items() if 
+00027250: 6b20 6e6f 7420 696e 2064 726f 705f 7661  k not in drop_va
+00027260: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
+00027270: 7d0a 2020 2020 2020 2020 7661 7269 6162  }.        variab
+00027280: 6c65 732e 7570 6461 7465 286e 6577 5f76  les.update(new_v
+00027290: 6172 6961 626c 6573 290a 0a20 2020 2020  ariables)..     
+000272a0: 2020 2023 2075 7064 6174 6520 6469 6d65     # update dime
+000272b0: 6e73 696f 6e73 2069 6620 6e65 6365 7373  nsions if necess
+000272c0: 6172 792c 2047 483a 2033 3531 320a 2020  ary, GH: 3512.  
+000272d0: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
+000272e0: 6e20 7661 7269 6162 6c65 732e 6974 656d  n variables.item
+000272f0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00027300: 2069 6620 616e 7928 6420 696e 2072 6570   if any(d in rep
+00027310: 6c61 6365 5f64 696d 7320 666f 7220 6420  lace_dims for d 
+00027320: 696e 2076 2e64 696d 7329 3a0a 2020 2020  in v.dims):.    
+00027330: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00027340: 6469 6d73 203d 205b 7265 706c 6163 655f  dims = [replace_
+00027350: 6469 6d73 2e67 6574 2864 2c20 6429 2066  dims.get(d, d) f
+00027360: 6f72 2064 2069 6e20 762e 6469 6d73 5d0a  or d in v.dims].
+00027370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027380: 7661 7269 6162 6c65 735b 6b5d 203d 2076  variables[k] = v
+00027390: 2e5f 7265 706c 6163 6528 6469 6d73 3d6e  ._replace(dims=n
+000273a0: 6577 5f64 696d 7329 0a0a 2020 2020 2020  ew_dims)..      
+000273b0: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
+000273c0: 7365 6c66 2e5f 636f 6f72 645f 6e61 6d65  self._coord_name
+000273d0: 7320 2d20 6472 6f70 5f76 6172 6961 626c  s - drop_variabl
+000273e0: 6573 207c 2073 6574 286e 6577 5f76 6172  es | set(new_var
+000273f0: 6961 626c 6573 290a 0a20 2020 2020 2020  iables)..       
+00027400: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
+00027410: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
+00027420: 696d 7328 0a20 2020 2020 2020 2020 2020  ims(.           
+00027430: 2076 6172 6961 626c 6573 2c20 636f 6f72   variables, coor
+00027440: 645f 6e61 6d65 733d 636f 6f72 645f 6e61  d_names=coord_na
+00027450: 6d65 732c 2069 6e64 6578 6573 3d69 6e64  mes, indexes=ind
+00027460: 6578 6573 5f0a 2020 2020 2020 2020 290a  exes_.        ).
+00027470: 0a20 2020 2064 6566 2072 6573 6574 5f69  .    def reset_i
+00027480: 6e64 6578 280a 2020 2020 2020 2020 7365  ndex(.        se
+00027490: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
+000274a0: 2020 2020 2020 2064 696d 735f 6f72 5f6c         dims_or_l
+000274b0: 6576 656c 733a 2048 6173 6861 626c 6520  evels: Hashable 
+000274c0: 7c20 5365 7175 656e 6365 5b48 6173 6861  | Sequence[Hasha
+000274d0: 626c 655d 2c0a 2020 2020 2020 2020 6472  ble],.        dr
+000274e0: 6f70 3a20 626f 6f6c 203d 2046 616c 7365  op: bool = False
+000274f0: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
+00027500: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
+00027510: 2252 6573 6574 2074 6865 2073 7065 6369  "Reset the speci
+00027520: 6669 6564 2069 6e64 6578 2865 7329 206f  fied index(es) o
+00027530: 7220 6d75 6c74 692d 696e 6465 7820 6c65  r multi-index le
+00027540: 7665 6c28 7329 2e0a 0a20 2020 2020 2020  vel(s)...       
+00027550: 2054 6869 7320 6c65 6761 6379 206d 6574   This legacy met
+00027560: 686f 6420 6973 2073 7065 6369 6669 6320  hod is specific 
+00027570: 746f 2070 616e 6461 7320 286d 756c 7469  to pandas (multi
+00027580: 2d29 696e 6465 7865 7320 616e 640a 2020  -)indexes and.  
+00027590: 2020 2020 2020 312d 6469 6d65 6e73 696f        1-dimensio
+000275a0: 6e61 6c20 2264 696d 656e 7369 6f6e 2220  nal "dimension" 
+000275b0: 636f 6f72 6469 6e61 7465 732e 2053 6565  coordinates. See
+000275c0: 2074 6865 206d 6f72 6520 6765 6e65 7269   the more generi
+000275d0: 630a 2020 2020 2020 2020 3a70 793a 6d65  c.        :py:me
+000275e0: 7468 3a60 7e44 6174 6173 6574 2e64 726f  th:`~Dataset.dro
+000275f0: 705f 696e 6465 7865 7360 2061 6e64 203a  p_indexes` and :
+00027600: 7079 3a6d 6574 683a 607e 4461 7461 7365  py:meth:`~Datase
+00027610: 742e 7365 745f 7869 6e64 6578 600a 2020  t.set_xindex`.  
+00027620: 2020 2020 2020 6d65 7468 6f64 2074 6f20        method to 
+00027630: 7265 7370 6563 7469 7665 6c79 2064 726f  respectively dro
+00027640: 7020 616e 6420 7365 7420 7061 6e64 6173  p and set pandas
+00027650: 206f 7220 6375 7374 6f6d 2069 6e64 6578   or custom index
+00027660: 6573 2066 6f72 0a20 2020 2020 2020 2061  es for.        a
+00027670: 7262 6974 7261 7279 2063 6f6f 7264 696e  rbitrary coordin
+00027680: 6174 6573 2e0a 0a20 2020 2020 2020 2050  ates...        P
+00027690: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+000276a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+000276b0: 2020 2020 2064 696d 735f 6f72 5f6c 6576       dims_or_lev
+000276c0: 656c 7320 3a20 4861 7368 6162 6c65 206f  els : Hashable o
+000276d0: 7220 5365 7175 656e 6365 206f 6620 4861  r Sequence of Ha
+000276e0: 7368 6162 6c65 0a20 2020 2020 2020 2020  shable.         
+000276f0: 2020 204e 616d 6528 7329 206f 6620 7468     Name(s) of th
+00027700: 6520 6469 6d65 6e73 696f 6e28 7329 2061  e dimension(s) a
+00027710: 6e64 2f6f 7220 6d75 6c74 692d 696e 6465  nd/or multi-inde
+00027720: 7820 6c65 7665 6c28 7329 2074 6861 7420  x level(s) that 
+00027730: 7769 6c6c 0a20 2020 2020 2020 2020 2020  will.           
+00027740: 2062 6520 7265 7365 742e 0a20 2020 2020   be reset..     
+00027750: 2020 2064 726f 7020 3a20 626f 6f6c 2c20     drop : bool, 
+00027760: 6465 6661 756c 743a 2046 616c 7365 0a20  default: False. 
+00027770: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00027780: 7565 2c20 7265 6d6f 7665 2074 6865 2073  ue, remove the s
+00027790: 7065 6369 6669 6564 2069 6e64 6578 6573  pecified indexes
+000277a0: 2061 6e64 2f6f 7220 6d75 6c74 692d 696e   and/or multi-in
+000277b0: 6465 7820 6c65 7665 6c73 0a20 2020 2020  dex levels.     
+000277c0: 2020 2020 2020 2069 6e73 7465 6164 206f         instead o
+000277d0: 6620 6578 7472 6163 7469 6e67 2074 6865  f extracting the
+000277e0: 6d20 6173 206e 6577 2063 6f6f 7264 696e  m as new coordin
+000277f0: 6174 6573 2028 6465 6661 756c 743a 2046  ates (default: F
+00027800: 616c 7365 292e 0a0a 2020 2020 2020 2020  alse)...        
+00027810: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00027820: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00027830: 6f62 6a20 3a20 4461 7461 7365 740a 2020  obj : Dataset.  
+00027840: 2020 2020 2020 2020 2020 416e 6f74 6865            Anothe
+00027850: 7220 6461 7461 7365 742c 2077 6974 6820  r dataset, with 
+00027860: 7468 6973 2064 6174 6173 6574 2773 2064  this dataset's d
+00027870: 6174 6120 6275 7420 7265 706c 6163 6564  ata but replaced
+00027880: 2063 6f6f 7264 696e 6174 6573 2e0a 0a20   coordinates... 
+00027890: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+000278a0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000278b0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+000278c0: 2e73 6574 5f69 6e64 6578 0a20 2020 2020  .set_index.     
+000278d0: 2020 2044 6174 6173 6574 2e73 6574 5f78     Dataset.set_x
+000278e0: 696e 6465 780a 2020 2020 2020 2020 4461  index.        Da
+000278f0: 7461 7365 742e 6472 6f70 5f69 6e64 6578  taset.drop_index
+00027900: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
+00027910: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00027920: 616e 6365 2864 696d 735f 6f72 5f6c 6576  ance(dims_or_lev
+00027930: 656c 732c 2073 7472 2920 6f72 206e 6f74  els, str) or not
+00027940: 2069 7369 6e73 7461 6e63 6528 6469 6d73   isinstance(dims
+00027950: 5f6f 725f 6c65 7665 6c73 2c20 5365 7175  _or_levels, Sequ
+00027960: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
+00027970: 2020 2064 696d 735f 6f72 5f6c 6576 656c     dims_or_level
+00027980: 7320 3d20 5b64 696d 735f 6f72 5f6c 6576  s = [dims_or_lev
+00027990: 656c 735d 0a0a 2020 2020 2020 2020 696e  els]..        in
+000279a0: 7661 6c69 645f 636f 6f72 6473 203d 2073  valid_coords = s
+000279b0: 6574 2864 696d 735f 6f72 5f6c 6576 656c  et(dims_or_level
+000279c0: 7329 202d 2073 6574 2873 656c 662e 5f69  s) - set(self._i
+000279d0: 6e64 6578 6573 290a 2020 2020 2020 2020  ndexes).        
+000279e0: 6966 2069 6e76 616c 6964 5f63 6f6f 7264  if invalid_coord
+000279f0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00027a00: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00027a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027a20: 2066 227b 7475 706c 6528 696e 7661 6c69   f"{tuple(invali
+00027a30: 645f 636f 6f72 6473 297d 2061 7265 206e  d_coords)} are n
+00027a40: 6f74 2063 6f6f 7264 696e 6174 6573 2077  ot coordinates w
+00027a50: 6974 6820 616e 2069 6e64 6578 220a 2020  ith an index".  
+00027a60: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00027a70: 2020 2020 2064 726f 705f 696e 6465 7865       drop_indexe
+00027a80: 733a 2073 6574 5b48 6173 6861 626c 655d  s: set[Hashable]
+00027a90: 203d 2073 6574 2829 0a20 2020 2020 2020   = set().       
+00027aa0: 2064 726f 705f 7661 7269 6162 6c65 733a   drop_variables:
+00027ab0: 2073 6574 5b48 6173 6861 626c 655d 203d   set[Hashable] =
+00027ac0: 2073 6574 2829 0a20 2020 2020 2020 2073   set().        s
+00027ad0: 6565 6e3a 2073 6574 5b49 6e64 6578 5d20  een: set[Index] 
+00027ae0: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
+00027af0: 6e65 775f 696e 6465 7865 733a 2064 6963  new_indexes: dic
+00027b00: 745b 4861 7368 6162 6c65 2c20 496e 6465  t[Hashable, Inde
+00027b10: 785d 203d 207b 7d0a 2020 2020 2020 2020  x] = {}.        
+00027b20: 6e65 775f 7661 7269 6162 6c65 733a 2064  new_variables: d
+00027b30: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
+00027b40: 7269 6162 6c65 5d20 3d20 7b7d 0a0a 2020  riable] = {}..  
+00027b50: 2020 2020 2020 6465 6620 6472 6f70 5f6f        def drop_o
+00027b60: 725f 636f 6e76 6572 7428 7661 725f 6e61  r_convert(var_na
+00027b70: 6d65 7329 3a0a 2020 2020 2020 2020 2020  mes):.          
+00027b80: 2020 6966 2064 726f 703a 0a20 2020 2020    if drop:.     
+00027b90: 2020 2020 2020 2020 2020 2064 726f 705f             drop_
+00027ba0: 7661 7269 6162 6c65 732e 7570 6461 7465  variables.update
+00027bb0: 2876 6172 5f6e 616d 6573 290a 2020 2020  (var_names).    
+00027bc0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00027bd0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+00027be0: 7365 5f76 6172 7320 3d20 7b0a 2020 2020  se_vars = {.    
+00027bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c00: 6b3a 2073 656c 662e 5f76 6172 6961 626c  k: self._variabl
+00027c10: 6573 5b6b 5d2e 746f 5f62 6173 655f 7661  es[k].to_base_va
+00027c20: 7269 6162 6c65 2829 2066 6f72 206b 2069  riable() for k i
+00027c30: 6e20 7661 725f 6e61 6d65 730a 2020 2020  n var_names.    
+00027c40: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00027c50: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00027c60: 775f 7661 7269 6162 6c65 732e 7570 6461  w_variables.upda
+00027c70: 7465 2862 6173 655f 7661 7273 290a 0a20  te(base_vars).. 
+00027c80: 2020 2020 2020 2066 6f72 206e 616d 6520         for name 
+00027c90: 696e 2064 696d 735f 6f72 5f6c 6576 656c  in dims_or_level
+00027ca0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+00027cb0: 6e64 6578 203d 2073 656c 662e 5f69 6e64  ndex = self._ind
+00027cc0: 6578 6573 5b6e 616d 655d 0a0a 2020 2020  exes[name]..    
+00027cd0: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
+00027ce0: 2069 6e20 7365 656e 3a0a 2020 2020 2020   in seen:.      
+00027cf0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00027d00: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+00027d10: 6565 6e2e 6164 6428 696e 6465 7829 0a0a  een.add(index)..
+00027d20: 2020 2020 2020 2020 2020 2020 6964 785f              idx_
+00027d30: 7661 725f 6e61 6d65 7320 3d20 7365 7428  var_names = set(
+00027d40: 7365 6c66 2e78 696e 6465 7865 732e 6765  self.xindexes.ge
+00027d50: 745f 616c 6c5f 636f 6f72 6473 286e 616d  t_all_coords(nam
+00027d60: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+00027d70: 6472 6f70 5f69 6e64 6578 6573 2e75 7064  drop_indexes.upd
+00027d80: 6174 6528 6964 785f 7661 725f 6e61 6d65  ate(idx_var_name
+00027d90: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00027da0: 6966 2069 7369 6e73 7461 6e63 6528 696e  if isinstance(in
+00027db0: 6465 782c 2050 616e 6461 734d 756c 7469  dex, PandasMulti
+00027dc0: 496e 6465 7829 3a0a 2020 2020 2020 2020  Index):.        
+00027dd0: 2020 2020 2020 2020 2320 7370 6563 6961          # specia
+00027de0: 6c20 6361 7365 2066 6f72 2070 642e 4d75  l case for pd.Mu
+00027df0: 6c74 6949 6e64 6578 0a20 2020 2020 2020  ltiIndex.       
+00027e00: 2020 2020 2020 2020 206c 6576 656c 5f6e           level_n
+00027e10: 616d 6573 203d 2069 6e64 6578 2e69 6e64  ames = index.ind
+00027e20: 6578 2e6e 616d 6573 0a20 2020 2020 2020  ex.names.       
+00027e30: 2020 2020 2020 2020 206b 6565 705f 6c65           keep_le
+00027e40: 7665 6c5f 7661 7273 203d 207b 0a20 2020  vel_vars = {.   
+00027e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e60: 206b 3a20 7365 6c66 2e5f 7661 7269 6162   k: self._variab
+00027e70: 6c65 735b 6b5d 0a20 2020 2020 2020 2020  les[k].         
+00027e80: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00027e90: 2069 6e20 6c65 7665 6c5f 6e61 6d65 730a   in level_names.
+00027ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027eb0: 2020 2020 6966 206b 206e 6f74 2069 6e20      if k not in 
+00027ec0: 6469 6d73 5f6f 725f 6c65 7665 6c73 0a20  dims_or_levels. 
+00027ed0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00027ee0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00027ef0: 2020 6966 2069 6e64 6578 2e64 696d 206e    if index.dim n
+00027f00: 6f74 2069 6e20 6469 6d73 5f6f 725f 6c65  ot in dims_or_le
+00027f10: 7665 6c73 2061 6e64 206b 6565 705f 6c65  vels and keep_le
+00027f20: 7665 6c5f 7661 7273 3a0a 2020 2020 2020  vel_vars:.      
+00027f30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00027f40: 646f 206e 6f74 2064 726f 7020 7468 6520  do not drop the 
+00027f50: 6d75 6c74 692d 696e 6465 7820 636f 6d70  multi-index comp
+00027f60: 6c65 7465 6c79 0a20 2020 2020 2020 2020  letely.         
+00027f70: 2020 2020 2020 2020 2020 2023 2069 6e73             # ins
+00027f80: 7465 6164 2072 6570 6c61 6365 2069 7420  tead replace it 
+00027f90: 6279 2061 206e 6577 2028 6d75 6c74 692d  by a new (multi-
+00027fa0: 2969 6e64 6578 2077 6974 6820 6472 6f70  )index with drop
+00027fb0: 7065 6420 6c65 7665 6c28 7329 0a20 2020  ped level(s).   
+00027fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fd0: 2069 6478 203d 2069 6e64 6578 2e6b 6565   idx = index.kee
+00027fe0: 705f 6c65 7665 6c73 286b 6565 705f 6c65  p_levels(keep_le
+00027ff0: 7665 6c5f 7661 7273 290a 2020 2020 2020  vel_vars).      
+00028000: 2020 2020 2020 2020 2020 2020 2020 6964                id
+00028010: 785f 7661 7273 203d 2069 6478 2e63 7265  x_vars = idx.cre
+00028020: 6174 655f 7661 7269 6162 6c65 7328 6b65  ate_variables(ke
+00028030: 6570 5f6c 6576 656c 5f76 6172 7329 0a20  ep_level_vars). 
+00028040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028050: 2020 206e 6577 5f69 6e64 6578 6573 2e75     new_indexes.u
+00028060: 7064 6174 6528 7b6b 3a20 6964 7820 666f  pdate({k: idx fo
+00028070: 7220 6b20 696e 2069 6478 5f76 6172 737d  r k in idx_vars}
+00028080: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00028090: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
+000280a0: 6c65 732e 7570 6461 7465 2869 6478 5f76  les.update(idx_v
+000280b0: 6172 7329 0a20 2020 2020 2020 2020 2020  ars).           
+000280c0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000280d0: 6973 696e 7374 616e 6365 2869 6478 2c20  isinstance(idx, 
+000280e0: 5061 6e64 6173 4d75 6c74 6949 6e64 6578  PandasMultiIndex
+000280f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00028100: 2020 2020 2020 2020 2020 2023 206d 756c             # mul
+00028110: 7469 2d69 6e64 6578 2072 6564 7563 6564  ti-index reduced
+00028120: 2074 6f20 7369 6e67 6c65 2069 6e64 6578   to single index
+00028130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028140: 2020 2020 2020 2020 2023 2062 6163 6b77           # backw
+00028150: 6172 6420 636f 6d70 6174 6962 696c 6974  ard compatibilit
+00028160: 793a 2075 6e69 7175 6520 6c65 7665 6c20  y: unique level 
+00028170: 636f 6f72 6469 6e61 7465 2072 656e 616d  coordinate renam
+00028180: 6564 2074 6f20 6469 6d65 6e73 696f 6e0a  ed to dimension.
+00028190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000281a0: 2020 2020 2020 2020 6472 6f70 5f76 6172          drop_var
+000281b0: 6961 626c 6573 2e75 7064 6174 6528 6b65  iables.update(ke
+000281c0: 6570 5f6c 6576 656c 5f76 6172 7329 0a20  ep_level_vars). 
+000281d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000281e0: 2020 2064 726f 705f 6f72 5f63 6f6e 7665     drop_or_conve
+000281f0: 7274 280a 2020 2020 2020 2020 2020 2020  rt(.            
+00028200: 2020 2020 2020 2020 2020 2020 5b6b 2066              [k f
+00028210: 6f72 206b 2069 6e20 6c65 7665 6c5f 6e61  or k in level_na
+00028220: 6d65 7320 6966 206b 206e 6f74 2069 6e20  mes if k not in 
+00028230: 6b65 6570 5f6c 6576 656c 5f76 6172 735d  keep_level_vars]
+00028240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028250: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00028260: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00028270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028280: 2023 2061 6c77 6179 7320 6472 6f70 2074   # always drop t
+00028290: 6865 206d 756c 7469 2d69 6e64 6578 2064  he multi-index d
+000282a0: 696d 656e 7369 6f6e 2076 6172 6961 626c  imension variabl
+000282b0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000282c0: 2020 2020 2020 6472 6f70 5f76 6172 6961        drop_varia
+000282d0: 626c 6573 2e61 6464 2869 6e64 6578 2e64  bles.add(index.d
+000282e0: 696d 290a 2020 2020 2020 2020 2020 2020  im).            
+000282f0: 2020 2020 2020 2020 6472 6f70 5f6f 725f          drop_or_
+00028300: 636f 6e76 6572 7428 6c65 7665 6c5f 6e61  convert(level_na
+00028310: 6d65 7329 0a20 2020 2020 2020 2020 2020  mes).           
+00028320: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00028330: 2020 2020 2020 2064 726f 705f 6f72 5f63         drop_or_c
+00028340: 6f6e 7665 7274 2869 6478 5f76 6172 5f6e  onvert(idx_var_n
+00028350: 616d 6573 290a 0a20 2020 2020 2020 2069  ames)..        i
+00028360: 6e64 6578 6573 203d 207b 6b3a 2076 2066  ndexes = {k: v f
+00028370: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
+00028380: 5f69 6e64 6578 6573 2e69 7465 6d73 2829  _indexes.items()
+00028390: 2069 6620 6b20 6e6f 7420 696e 2064 726f   if k not in dro
+000283a0: 705f 696e 6465 7865 737d 0a20 2020 2020  p_indexes}.     
+000283b0: 2020 2069 6e64 6578 6573 2e75 7064 6174     indexes.updat
+000283c0: 6528 6e65 775f 696e 6465 7865 7329 0a0a  e(new_indexes)..
+000283d0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+000283e0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+000283f0: 2020 6b3a 2076 2066 6f72 206b 2c20 7620    k: v for k, v 
+00028400: 696e 2073 656c 662e 5f76 6172 6961 626c  in self._variabl
+00028410: 6573 2e69 7465 6d73 2829 2069 6620 6b20  es.items() if k 
+00028420: 6e6f 7420 696e 2064 726f 705f 7661 7269  not in drop_vari
+00028430: 6162 6c65 730a 2020 2020 2020 2020 7d0a  ables.        }.
+00028440: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00028450: 732e 7570 6461 7465 286e 6577 5f76 6172  s.update(new_var
+00028460: 6961 626c 6573 290a 0a20 2020 2020 2020  iables)..       
+00028470: 2063 6f6f 7264 5f6e 616d 6573 203d 2073   coord_names = s
+00028480: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
+00028490: 202d 2064 726f 705f 7661 7269 6162 6c65   - drop_variable
+000284a0: 730a 0a20 2020 2020 2020 2072 6574 7572  s..        retur
+000284b0: 6e20 7365 6c66 2e5f 7265 706c 6163 655f  n self._replace_
+000284c0: 7769 7468 5f6e 6577 5f64 696d 7328 0a20  with_new_dims(. 
+000284d0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+000284e0: 626c 6573 2c20 636f 6f72 645f 6e61 6d65  bles, coord_name
+000284f0: 733d 636f 6f72 645f 6e61 6d65 732c 2069  s=coord_names, i
+00028500: 6e64 6578 6573 3d69 6e64 6578 6573 0a20  ndexes=indexes. 
+00028510: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00028520: 6620 7365 745f 7869 6e64 6578 280a 2020  f set_xindex(.  
+00028530: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+00028540: 7461 7365 742c 0a20 2020 2020 2020 2063  taset,.        c
+00028550: 6f6f 7264 5f6e 616d 6573 3a20 7374 7220  oord_names: str 
+00028560: 7c20 5365 7175 656e 6365 5b48 6173 6861  | Sequence[Hasha
+00028570: 626c 655d 2c0a 2020 2020 2020 2020 696e  ble],.        in
+00028580: 6465 785f 636c 733a 2074 7970 655b 496e  dex_cls: type[In
+00028590: 6465 785d 207c 204e 6f6e 6520 3d20 4e6f  dex] | None = No
+000285a0: 6e65 2c0a 2020 2020 2020 2020 2a2a 6f70  ne,.        **op
+000285b0: 7469 6f6e 732c 0a20 2020 2029 202d 3e20  tions,.    ) -> 
+000285c0: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+000285d0: 2020 2022 2222 5365 7420 6120 6e65 772c     """Set a new,
+000285e0: 2058 6172 7261 792d 636f 6d70 6174 6962   Xarray-compatib
+000285f0: 6c65 2069 6e64 6578 2066 726f 6d20 6f6e  le index from on
+00028600: 6520 6f72 206d 6f72 6520 6578 6973 7469  e or more existi
+00028610: 6e67 0a20 2020 2020 2020 2063 6f6f 7264  ng.        coord
+00028620: 696e 6174 6528 7329 2e0a 0a20 2020 2020  inate(s)...     
+00028630: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00028640: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00028650: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
+00028660: 616d 6573 203a 2073 7472 206f 7220 6c69  ames : str or li
+00028670: 7374 0a20 2020 2020 2020 2020 2020 204e  st.            N
+00028680: 616d 6528 7329 206f 6620 7468 6520 636f  ame(s) of the co
+00028690: 6f72 6469 6e61 7465 2873 2920 7573 6564  ordinate(s) used
+000286a0: 2074 6f20 6275 696c 6420 7468 6520 696e   to build the in
+000286b0: 6465 782e 0a20 2020 2020 2020 2020 2020  dex..           
+000286c0: 2049 6620 7365 7665 7261 6c20 6e61 6d65   If several name
+000286d0: 7320 6172 6520 6769 7665 6e2c 2074 6865  s are given, the
+000286e0: 6972 206f 7264 6572 206d 6174 7465 7273  ir order matters
+000286f0: 2e0a 2020 2020 2020 2020 696e 6465 785f  ..        index_
+00028700: 636c 7320 3a20 7375 6263 6c61 7373 206f  cls : subclass o
+00028710: 6620 3a63 6c61 7373 3a60 7e78 6172 7261  f :class:`~xarra
+00028720: 792e 696e 6465 7865 732e 496e 6465 7860  y.indexes.Index`
+00028730: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00028740: 2020 2020 2020 2054 6865 2074 7970 6520         The type 
+00028750: 6f66 2069 6e64 6578 2074 6f20 6372 6561  of index to crea
+00028760: 7465 2e20 4279 2064 6566 6175 6c74 2c20  te. By default, 
+00028770: 7472 7920 7365 7474 696e 670a 2020 2020  try setting.    
+00028780: 2020 2020 2020 2020 6120 6060 5061 6e64          a ``Pand
+00028790: 6173 496e 6465 7860 6020 6966 2060 606c  asIndex`` if ``l
+000287a0: 656e 2863 6f6f 7264 5f6e 616d 6573 2920  en(coord_names) 
+000287b0: 3d3d 2031 6060 2c0a 2020 2020 2020 2020  == 1``,.        
+000287c0: 2020 2020 6f74 6865 7277 6973 6520 6120      otherwise a 
+000287d0: 6060 5061 6e64 6173 4d75 6c74 6949 6e64  ``PandasMultiInd
+000287e0: 6578 6060 2e0a 2020 2020 2020 2020 2a2a  ex``..        **
+000287f0: 6f70 7469 6f6e 730a 2020 2020 2020 2020  options.        
+00028800: 2020 2020 4f70 7469 6f6e 7320 7061 7373      Options pass
+00028810: 6564 2074 6f20 7468 6520 696e 6465 7820  ed to the index 
+00028820: 636f 6e73 7472 7563 746f 722e 0a0a 2020  constructor...  
+00028830: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00028840: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00028850: 2020 2020 2020 6f62 6a20 3a20 4461 7461        obj : Data
+00028860: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+00028870: 416e 6f74 6865 7220 6461 7461 7365 742c  Another dataset,
+00028880: 2077 6974 6820 7468 6973 2064 6174 6173   with this datas
+00028890: 6574 2773 2064 6174 6120 616e 6420 7769  et's data and wi
+000288a0: 7468 2061 206e 6577 2069 6e64 6578 2e0a  th a new index..
+000288b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000288c0: 2020 2020 2023 2074 6865 2053 6571 7565       # the Seque
+000288d0: 6e63 6520 6368 6563 6b20 6973 2072 6571  nce check is req
+000288e0: 7569 7265 6420 666f 7220 6d79 7079 0a20  uired for mypy. 
+000288f0: 2020 2020 2020 2069 6620 6973 5f73 6361         if is_sca
+00028900: 6c61 7228 636f 6f72 645f 6e61 6d65 7329  lar(coord_names)
+00028910: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
+00028920: 6365 2863 6f6f 7264 5f6e 616d 6573 2c20  ce(coord_names, 
+00028930: 5365 7175 656e 6365 293a 0a20 2020 2020  Sequence):.     
+00028940: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
+00028950: 6573 203d 205b 636f 6f72 645f 6e61 6d65  es = [coord_name
+00028960: 735d 0a0a 2020 2020 2020 2020 6966 2069  s]..        if i
+00028970: 6e64 6578 5f63 6c73 2069 7320 4e6f 6e65  ndex_cls is None
+00028980: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00028990: 206c 656e 2863 6f6f 7264 5f6e 616d 6573   len(coord_names
+000289a0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+000289b0: 2020 2020 2020 2020 696e 6465 785f 636c          index_cl
+000289c0: 7320 3d20 5061 6e64 6173 496e 6465 780a  s = PandasIndex.
+000289d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000289e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000289f0: 2020 696e 6465 785f 636c 7320 3d20 5061    index_cls = Pa
+00028a00: 6e64 6173 4d75 6c74 6949 6e64 6578 0a20  ndasMultiIndex. 
+00028a10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00028a20: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00028a30: 6973 7375 6263 6c61 7373 2869 6e64 6578  issubclass(index
+00028a40: 5f63 6c73 2c20 496e 6465 7829 3a0a 2020  _cls, Index):.  
+00028a50: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00028a60: 6973 6520 5479 7065 4572 726f 7228 6622  ise TypeError(f"
+00028a70: 7b69 6e64 6578 5f63 6c73 7d20 6973 206e  {index_cls} is n
+00028a80: 6f74 2061 2073 7562 636c 6173 7320 6f66  ot a subclass of
+00028a90: 2078 6172 7261 792e 496e 6465 7822 290a   xarray.Index").
+00028aa0: 0a20 2020 2020 2020 2069 6e76 616c 6964  .        invalid
+00028ab0: 5f63 6f6f 7264 7320 3d20 7365 7428 636f  _coords = set(co
+00028ac0: 6f72 645f 6e61 6d65 7329 202d 2073 656c  ord_names) - sel
+00028ad0: 662e 5f63 6f6f 7264 5f6e 616d 6573 0a0a  f._coord_names..
+00028ae0: 2020 2020 2020 2020 6966 2069 6e76 616c          if inval
+00028af0: 6964 5f63 6f6f 7264 733a 0a20 2020 2020  id_coords:.     
+00028b00: 2020 2020 2020 206d 7367 203d 205b 2269         msg = ["i
+00028b10: 6e76 616c 6964 2063 6f6f 7264 696e 6174  nvalid coordinat
+00028b20: 6528 7329 225d 0a20 2020 2020 2020 2020  e(s)"].         
+00028b30: 2020 206e 6f5f 7661 7273 203d 2069 6e76     no_vars = inv
+00028b40: 616c 6964 5f63 6f6f 7264 7320 2d20 7365  alid_coords - se
+00028b50: 7428 7365 6c66 2e5f 7661 7269 6162 6c65  t(self._variable
+00028b60: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
+00028b70: 6174 615f 7661 7273 203d 2069 6e76 616c  ata_vars = inval
+00028b80: 6964 5f63 6f6f 7264 7320 2d20 6e6f 5f76  id_coords - no_v
+00028b90: 6172 730a 2020 2020 2020 2020 2020 2020  ars.            
+00028ba0: 6966 206e 6f5f 7661 7273 3a0a 2020 2020  if no_vars:.    
+00028bb0: 2020 2020 2020 2020 2020 2020 6d73 672e              msg.
+00028bc0: 6170 7065 6e64 2866 2274 686f 7365 2076  append(f"those v
+00028bd0: 6172 6961 626c 6573 2064 6f6e 2774 2065  ariables don't e
+00028be0: 7869 7374 3a20 7b6e 6f5f 7661 7273 7d22  xist: {no_vars}"
+00028bf0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00028c00: 2064 6174 615f 7661 7273 3a0a 2020 2020   data_vars:.    
+00028c10: 2020 2020 2020 2020 2020 2020 6d73 672e              msg.
+00028c20: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
+00028c30: 2020 2020 2020 2020 2020 2020 6622 7468              f"th
+00028c40: 6f73 6520 7661 7269 6162 6c65 7320 6172  ose variables ar
+00028c50: 6520 6461 7461 2076 6172 6961 626c 6573  e data variables
+00028c60: 3a20 7b64 6174 615f 7661 7273 7d2c 2075  : {data_vars}, u
+00028c70: 7365 2060 7365 745f 636f 6f72 6473 6020  se `set_coords` 
+00028c80: 6669 7273 7422 0a20 2020 2020 2020 2020  first".         
+00028c90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00028ca0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00028cb0: 4572 726f 7228 225c 6e22 2e6a 6f69 6e28  Error("\n".join(
+00028cc0: 6d73 6729 290a 0a20 2020 2020 2020 2023  msg))..        #
+00028cd0: 2077 6520 636f 756c 6420 6265 206d 6f72   we could be mor
+00028ce0: 6520 636c 6576 6572 2068 6572 6520 2865  e clever here (e
+00028cf0: 2e67 2e2c 2064 726f 702d 696e 2069 6e64  .g., drop-in ind
+00028d00: 6578 2072 6570 6c61 6365 6d65 6e74 2069  ex replacement i
+00028d10: 6620 696e 6465 780a 2020 2020 2020 2020  f index.        
+00028d20: 2320 636f 6f72 6469 6e61 7465 7320 646f  # coordinates do
+00028d30: 206e 6f74 2063 6f6e 666c 6963 7429 2c20   not conflict), 
+00028d40: 6275 7420 6c65 7427 7320 6e6f 7420 616c  but let's not al
+00028d50: 6c6f 7720 7468 6973 2066 6f72 206e 6f77  low this for now
+00028d60: 0a20 2020 2020 2020 2069 6e64 6578 6564  .        indexed
+00028d70: 5f63 6f6f 7264 7320 3d20 7365 7428 636f  _coords = set(co
+00028d80: 6f72 645f 6e61 6d65 7329 2026 2073 6574  ord_names) & set
+00028d90: 2873 656c 662e 5f69 6e64 6578 6573 290a  (self._indexes).
+00028da0: 0a20 2020 2020 2020 2069 6620 696e 6465  .        if inde
+00028db0: 7865 645f 636f 6f72 6473 3a0a 2020 2020  xed_coords:.    
+00028dc0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00028dd0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00028de0: 2020 2020 2020 2020 2020 6622 7468 6f73            f"thos
+00028df0: 6520 636f 6f72 6469 6e61 7465 7320 616c  e coordinates al
+00028e00: 7265 6164 7920 6861 7665 2061 6e20 696e  ready have an in
+00028e10: 6465 783a 207b 696e 6465 7865 645f 636f  dex: {indexed_co
+00028e20: 6f72 6473 7d22 0a20 2020 2020 2020 2020  ords}".         
+00028e30: 2020 2029 0a0a 2020 2020 2020 2020 636f     )..        co
+00028e40: 6f72 645f 7661 7273 203d 207b 6e61 6d65  ord_vars = {name
+00028e50: 3a20 7365 6c66 2e5f 7661 7269 6162 6c65  : self._variable
+00028e60: 735b 6e61 6d65 5d20 666f 7220 6e61 6d65  s[name] for name
+00028e70: 2069 6e20 636f 6f72 645f 6e61 6d65 737d   in coord_names}
+00028e80: 0a0a 2020 2020 2020 2020 696e 6465 7820  ..        index 
+00028e90: 3d20 696e 6465 785f 636c 732e 6672 6f6d  = index_cls.from
+00028ea0: 5f76 6172 6961 626c 6573 2863 6f6f 7264  _variables(coord
+00028eb0: 5f76 6172 732c 206f 7074 696f 6e73 3d6f  _vars, options=o
+00028ec0: 7074 696f 6e73 290a 0a20 2020 2020 2020  ptions)..       
+00028ed0: 206e 6577 5f63 6f6f 7264 5f76 6172 7320   new_coord_vars 
+00028ee0: 3d20 696e 6465 782e 6372 6561 7465 5f76  = index.create_v
+00028ef0: 6172 6961 626c 6573 2863 6f6f 7264 5f76  ariables(coord_v
+00028f00: 6172 7329 0a0a 2020 2020 2020 2020 2320  ars)..        # 
+00028f10: 7370 6563 6961 6c20 6361 7365 2066 6f72  special case for
+00028f20: 2073 6574 7469 6e67 2061 2070 616e 6461   setting a panda
+00028f30: 7320 6d75 6c74 692d 696e 6465 7820 6672  s multi-index fr
+00028f40: 6f6d 206c 6576 656c 2063 6f6f 7264 696e  om level coordin
+00028f50: 6174 6573 0a20 2020 2020 2020 2023 2054  ates.        # T
+00028f60: 4f44 4f3a 2072 656d 6f76 6520 6974 206f  ODO: remove it o
+00028f70: 6e63 6520 7765 2064 6570 7265 6369 6174  nce we depreciat
+00028f80: 6520 7061 6e64 6173 206d 756c 7469 2d69  e pandas multi-i
+00028f90: 6e64 6578 2064 696d 656e 7369 6f6e 2028  ndex dimension (
+00028fa0: 7475 706c 650a 2020 2020 2020 2020 2320  tuple.        # 
+00028fb0: 656c 656d 656e 7473 2920 636f 6f72 6469  elements) coordi
+00028fc0: 6e61 7465 0a20 2020 2020 2020 2069 6620  nate.        if 
+00028fd0: 6973 696e 7374 616e 6365 2869 6e64 6578  isinstance(index
+00028fe0: 2c20 5061 6e64 6173 4d75 6c74 6949 6e64  , PandasMultiInd
+00028ff0: 6578 293a 0a20 2020 2020 2020 2020 2020  ex):.           
+00029000: 2063 6f6f 7264 5f6e 616d 6573 203d 205b   coord_names = [
+00029010: 696e 6465 782e 6469 6d5d 202b 206c 6973  index.dim] + lis
+00029020: 7428 636f 6f72 645f 6e61 6d65 7329 0a0a  t(coord_names)..
+00029030: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00029040: 733a 2064 6963 745b 4861 7368 6162 6c65  s: dict[Hashable
+00029050: 2c20 5661 7269 6162 6c65 5d0a 2020 2020  , Variable].    
+00029060: 2020 2020 696e 6465 7865 733a 2064 6963      indexes: dic
+00029070: 745b 4861 7368 6162 6c65 2c20 496e 6465  t[Hashable, Inde
+00029080: 785d 0a0a 2020 2020 2020 2020 6966 206c  x]..        if l
+00029090: 656e 2863 6f6f 7264 5f6e 616d 6573 2920  en(coord_names) 
+000290a0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+000290b0: 2020 7661 7269 6162 6c65 7320 3d20 7365    variables = se
+000290c0: 6c66 2e5f 7661 7269 6162 6c65 732e 636f  lf._variables.co
+000290d0: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
+000290e0: 2069 6e64 6578 6573 203d 2073 656c 662e   indexes = self.
+000290f0: 5f69 6e64 6578 6573 2e63 6f70 7928 290a  _indexes.copy().
+00029100: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
+00029110: 6520 3d20 6c69 7374 2863 6f6f 7264 5f6e  e = list(coord_n
+00029120: 616d 6573 292e 706f 7028 290a 2020 2020  ames).pop().    
+00029130: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+00029140: 696e 206e 6577 5f63 6f6f 7264 5f76 6172  in new_coord_var
+00029150: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00029160: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
+00029170: 655d 203d 206e 6577 5f63 6f6f 7264 5f76  e] = new_coord_v
+00029180: 6172 735b 6e61 6d65 5d0a 2020 2020 2020  ars[name].      
+00029190: 2020 2020 2020 696e 6465 7865 735b 6e61        indexes[na
+000291a0: 6d65 5d20 3d20 696e 6465 780a 2020 2020  me] = index.    
+000291b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000291c0: 2020 2020 2020 2320 7265 6f72 6465 7220        # reorder 
+000291d0: 7661 7269 6162 6c65 7320 616e 6420 696e  variables and in
+000291e0: 6465 7865 7320 736f 2074 6861 7420 636f  dexes so that co
+000291f0: 6f72 6469 6e61 7465 7320 6861 7669 6e67  ordinates having
+00029200: 2074 6865 2073 616d 650a 2020 2020 2020   the same.      
+00029210: 2020 2020 2020 2320 696e 6465 7820 6172        # index ar
+00029220: 6520 6e65 7874 2074 6f20 6561 6368 206f  e next to each o
+00029230: 7468 6572 0a20 2020 2020 2020 2020 2020  ther.           
+00029240: 2076 6172 6961 626c 6573 203d 207b 7d0a   variables = {}.
+00029250: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00029260: 6e61 6d65 2c20 7661 7220 696e 2073 656c  name, var in sel
+00029270: 662e 5f76 6172 6961 626c 6573 2e69 7465  f._variables.ite
+00029280: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00029290: 2020 2020 2020 6966 206e 616d 6520 6e6f        if name no
+000292a0: 7420 696e 2063 6f6f 7264 5f6e 616d 6573  t in coord_names
+000292b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000292c0: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
+000292d0: 6e61 6d65 5d20 3d20 7661 720a 0a20 2020  name] = var..   
+000292e0: 2020 2020 2020 2020 2069 6e64 6578 6573           indexes
+000292f0: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+00029300: 2020 666f 7220 6e61 6d65 2c20 6964 7820    for name, idx 
+00029310: 696e 2073 656c 662e 5f69 6e64 6578 6573  in self._indexes
+00029320: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00029330: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+00029340: 6520 6e6f 7420 696e 2063 6f6f 7264 5f6e  e not in coord_n
+00029350: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+00029360: 2020 2020 2020 2020 2020 696e 6465 7865            indexe
+00029370: 735b 6e61 6d65 5d20 3d20 6964 780a 0a20  s[name] = idx.. 
+00029380: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
+00029390: 616d 6520 696e 2063 6f6f 7264 5f6e 616d  ame in coord_nam
+000293a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000293b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000293c0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+000293d0: 6961 626c 6573 5b6e 616d 655d 203d 206e  iables[name] = n
+000293e0: 6577 5f63 6f6f 7264 5f76 6172 735b 6e61  ew_coord_vars[na
+000293f0: 6d65 5d0a 2020 2020 2020 2020 2020 2020  me].            
+00029400: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+00029410: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00029420: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00029430: 6573 5b6e 616d 655d 203d 2073 656c 662e  es[name] = self.
+00029440: 5f76 6172 6961 626c 6573 5b6e 616d 655d  _variables[name]
+00029450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029460: 2069 6e64 6578 6573 5b6e 616d 655d 203d   indexes[name] =
+00029470: 2069 6e64 6578 0a0a 2020 2020 2020 2020   index..        
+00029480: 7265 7475 726e 2073 656c 662e 5f72 6570  return self._rep
+00029490: 6c61 6365 280a 2020 2020 2020 2020 2020  lace(.          
+000294a0: 2020 7661 7269 6162 6c65 733d 7661 7269    variables=vari
+000294b0: 6162 6c65 732c 0a20 2020 2020 2020 2020  ables,.         
+000294c0: 2020 2063 6f6f 7264 5f6e 616d 6573 3d73     coord_names=s
+000294d0: 656c 662e 5f63 6f6f 7264 5f6e 616d 6573  elf._coord_names
+000294e0: 207c 2073 6574 2863 6f6f 7264 5f6e 616d   | set(coord_nam
+000294f0: 6573 292c 0a20 2020 2020 2020 2020 2020  es),.           
+00029500: 2069 6e64 6578 6573 3d69 6e64 6578 6573   indexes=indexes
+00029510: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00029520: 2064 6566 2072 656f 7264 6572 5f6c 6576   def reorder_lev
+00029530: 656c 7328 0a20 2020 2020 2020 2073 656c  els(.        sel
+00029540: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
+00029550: 2020 2020 2020 6469 6d5f 6f72 6465 723a        dim_order:
+00029560: 204d 6170 7069 6e67 5b41 6e79 2c20 5365   Mapping[Any, Se
+00029570: 7175 656e 6365 5b69 6e74 207c 2048 6173  quence[int | Has
+00029580: 6861 626c 655d 5d20 7c20 4e6f 6e65 203d  hable]] | None =
+00029590: 204e 6f6e 652c 0a20 2020 2020 2020 202a   None,.        *
+000295a0: 2a64 696d 5f6f 7264 6572 5f6b 7761 7267  *dim_order_kwarg
+000295b0: 733a 2053 6571 7565 6e63 655b 696e 7420  s: Sequence[int 
+000295c0: 7c20 4861 7368 6162 6c65 5d2c 0a20 2020  | Hashable],.   
+000295d0: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+000295e0: 0a20 2020 2020 2020 2022 2222 5265 6172  .        """Rear
+000295f0: 7261 6e67 6520 696e 6465 7820 6c65 7665  range index leve
+00029600: 6c73 2075 7369 6e67 2069 6e70 7574 206f  ls using input o
+00029610: 7264 6572 2e0a 0a20 2020 2020 2020 2050  rder...        P
+00029620: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00029630: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00029640: 2020 2020 2064 696d 5f6f 7264 6572 203a       dim_order :
+00029650: 2064 6963 742d 6c69 6b65 206f 6620 4861   dict-like of Ha
+00029660: 7368 6162 6c65 2074 6f20 5365 7175 656e  shable to Sequen
+00029670: 6365 206f 6620 696e 7420 6f72 2048 6173  ce of int or Has
+00029680: 6861 626c 652c 206f 7074 696f 6e61 6c0a  hable, optional.
+00029690: 2020 2020 2020 2020 2020 2020 4d61 7070              Mapp
+000296a0: 696e 6720 6672 6f6d 206e 616d 6573 206d  ing from names m
+000296b0: 6174 6368 696e 6720 6469 6d65 6e73 696f  atching dimensio
+000296c0: 6e73 2061 6e64 2076 616c 7565 7320 6769  ns and values gi
+000296d0: 7665 6e0a 2020 2020 2020 2020 2020 2020  ven.            
+000296e0: 6279 206c 6973 7473 2072 6570 7265 7365  by lists represe
+000296f0: 6e74 696e 6720 6e65 7720 6c65 7665 6c20  nting new level 
+00029700: 6f72 6465 7273 2e20 4576 6572 7920 6769  orders. Every gi
+00029710: 7665 6e20 6469 6d65 6e73 696f 6e0a 2020  ven dimension.  
+00029720: 2020 2020 2020 2020 2020 6d75 7374 2068            must h
+00029730: 6176 6520 6120 6d75 6c74 692d 696e 6465  ave a multi-inde
+00029740: 782e 0a20 2020 2020 2020 202a 2a64 696d  x..        **dim
+00029750: 5f6f 7264 6572 5f6b 7761 7267 7320 3a20  _order_kwargs : 
+00029760: 5365 7175 656e 6365 206f 6620 696e 7420  Sequence of int 
+00029770: 6f72 2048 6173 6861 626c 652c 206f 7074  or Hashable, opt
+00029780: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+00029790: 2020 5468 6520 6b65 7977 6f72 6420 6172    The keyword ar
+000297a0: 6775 6d65 6e74 7320 666f 726d 206f 6620  guments form of 
+000297b0: 6060 6469 6d5f 6f72 6465 7260 602e 0a20  ``dim_order``.. 
+000297c0: 2020 2020 2020 2020 2020 204f 6e65 206f             One o
+000297d0: 6620 6469 6d5f 6f72 6465 7220 6f72 2064  f dim_order or d
+000297e0: 696d 5f6f 7264 6572 5f6b 7761 7267 7320  im_order_kwargs 
+000297f0: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+00029800: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00029810: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00029820: 2d2d 0a20 2020 2020 2020 206f 626a 203a  --.        obj :
+00029830: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
+00029840: 2020 2020 2041 6e6f 7468 6572 2064 6174       Another dat
+00029850: 6173 6574 2c20 7769 7468 2074 6869 7320  aset, with this 
+00029860: 6461 7461 7365 7427 7320 6461 7461 2062  dataset's data b
+00029870: 7574 2072 6570 6c61 6365 640a 2020 2020  ut replaced.    
+00029880: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
+00029890: 7465 732e 0a20 2020 2020 2020 2022 2222  tes..        """
+000298a0: 0a20 2020 2020 2020 2064 696d 5f6f 7264  .        dim_ord
+000298b0: 6572 203d 2065 6974 6865 725f 6469 6374  er = either_dict
+000298c0: 5f6f 725f 6b77 6172 6773 2864 696d 5f6f  _or_kwargs(dim_o
+000298d0: 7264 6572 2c20 6469 6d5f 6f72 6465 725f  rder, dim_order_
+000298e0: 6b77 6172 6773 2c20 2272 656f 7264 6572  kwargs, "reorder
+000298f0: 5f6c 6576 656c 7322 290a 2020 2020 2020  _levels").      
+00029900: 2020 7661 7269 6162 6c65 7320 3d20 7365    variables = se
+00029910: 6c66 2e5f 7661 7269 6162 6c65 732e 636f  lf._variables.co
+00029920: 7079 2829 0a20 2020 2020 2020 2069 6e64  py().        ind
+00029930: 6578 6573 203d 2064 6963 7428 7365 6c66  exes = dict(self
+00029940: 2e5f 696e 6465 7865 7329 0a20 2020 2020  ._indexes).     
+00029950: 2020 206e 6577 5f69 6e64 6578 6573 3a20     new_indexes: 
+00029960: 6469 6374 5b48 6173 6861 626c 652c 2049  dict[Hashable, I
+00029970: 6e64 6578 5d20 3d20 7b7d 0a20 2020 2020  ndex] = {}.     
+00029980: 2020 206e 6577 5f76 6172 6961 626c 6573     new_variables
+00029990: 3a20 6469 6374 5b48 6173 6861 626c 652c  : dict[Hashable,
+000299a0: 2049 6e64 6578 5661 7269 6162 6c65 5d20   IndexVariable] 
+000299b0: 3d20 7b7d 0a0a 2020 2020 2020 2020 666f  = {}..        fo
+000299c0: 7220 6469 6d2c 206f 7264 6572 2069 6e20  r dim, order in 
+000299d0: 6469 6d5f 6f72 6465 722e 6974 656d 7328  dim_order.items(
+000299e0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+000299f0: 6e64 6578 203d 2073 656c 662e 5f69 6e64  ndex = self._ind
+00029a00: 6578 6573 5b64 696d 5d0a 0a20 2020 2020  exes[dim]..     
+00029a10: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00029a20: 696e 7374 616e 6365 2869 6e64 6578 2c20  instance(index, 
+00029a30: 5061 6e64 6173 4d75 6c74 6949 6e64 6578  PandasMultiIndex
+00029a40: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00029a50: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00029a60: 726f 7228 6622 636f 6f72 6469 6e61 7465  ror(f"coordinate
+00029a70: 207b 6469 6d7d 2068 6173 206e 6f20 4d75   {dim} has no Mu
+00029a80: 6c74 6949 6e64 6578 2229 0a0a 2020 2020  ltiIndex")..    
+00029a90: 2020 2020 2020 2020 6c65 7665 6c5f 7661          level_va
+00029aa0: 7273 203d 207b 6b3a 2073 656c 662e 5f76  rs = {k: self._v
+00029ab0: 6172 6961 626c 6573 5b6b 5d20 666f 7220  ariables[k] for 
+00029ac0: 6b20 696e 206f 7264 6572 7d0a 2020 2020  k in order}.    
+00029ad0: 2020 2020 2020 2020 6964 7820 3d20 696e          idx = in
+00029ae0: 6465 782e 7265 6f72 6465 725f 6c65 7665  dex.reorder_leve
+00029af0: 6c73 286c 6576 656c 5f76 6172 7329 0a20  ls(level_vars). 
+00029b00: 2020 2020 2020 2020 2020 2069 6478 5f76             idx_v
+00029b10: 6172 7320 3d20 6964 782e 6372 6561 7465  ars = idx.create
+00029b20: 5f76 6172 6961 626c 6573 286c 6576 656c  _variables(level
+00029b30: 5f76 6172 7329 0a20 2020 2020 2020 2020  _vars).         
+00029b40: 2020 206e 6577 5f69 6e64 6578 6573 2e75     new_indexes.u
+00029b50: 7064 6174 6528 7b6b 3a20 6964 7820 666f  pdate({k: idx fo
+00029b60: 7220 6b20 696e 2069 6478 5f76 6172 737d  r k in idx_vars}
+00029b70: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
+00029b80: 775f 7661 7269 6162 6c65 732e 7570 6461  w_variables.upda
+00029b90: 7465 2869 6478 5f76 6172 7329 0a0a 2020  te(idx_vars)..  
+00029ba0: 2020 2020 2020 696e 6465 7865 7320 3d20        indexes = 
+00029bb0: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+00029bc0: 6e20 7365 6c66 2e5f 696e 6465 7865 732e  n self._indexes.
+00029bd0: 6974 656d 7328 2920 6966 206b 206e 6f74  items() if k not
+00029be0: 2069 6e20 6e65 775f 696e 6465 7865 737d   in new_indexes}
+00029bf0: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
+00029c00: 2e75 7064 6174 6528 6e65 775f 696e 6465  .update(new_inde
+00029c10: 7865 7329 0a0a 2020 2020 2020 2020 7661  xes)..        va
+00029c20: 7269 6162 6c65 7320 3d20 7b6b 3a20 7620  riables = {k: v 
+00029c30: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+00029c40: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
+00029c50: 7328 2920 6966 206b 206e 6f74 2069 6e20  s() if k not in 
+00029c60: 6e65 775f 7661 7269 6162 6c65 737d 0a20  new_variables}. 
+00029c70: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00029c80: 2e75 7064 6174 6528 6e65 775f 7661 7269  .update(new_vari
+00029c90: 6162 6c65 7329 0a0a 2020 2020 2020 2020  ables)..        
+00029ca0: 7265 7475 726e 2073 656c 662e 5f72 6570  return self._rep
+00029cb0: 6c61 6365 2876 6172 6961 626c 6573 2c20  lace(variables, 
+00029cc0: 696e 6465 7865 733d 696e 6465 7865 7329  indexes=indexes)
+00029cd0: 0a0a 2020 2020 6465 6620 5f67 6574 5f73  ..    def _get_s
+00029ce0: 7461 636b 5f69 6e64 6578 280a 2020 2020  tack_index(.    
+00029cf0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00029d00: 2020 6469 6d2c 0a20 2020 2020 2020 206d    dim,.        m
+00029d10: 756c 7469 3d46 616c 7365 2c0a 2020 2020  ulti=False,.    
+00029d20: 2020 2020 6372 6561 7465 5f69 6e64 6578      create_index
+00029d30: 3d46 616c 7365 2c0a 2020 2020 2920 2d3e  =False,.    ) ->
+00029d40: 2074 7570 6c65 5b49 6e64 6578 207c 204e   tuple[Index | N
+00029d50: 6f6e 652c 2064 6963 745b 4861 7368 6162  one, dict[Hashab
+00029d60: 6c65 2c20 5661 7269 6162 6c65 5d5d 3a0a  le, Variable]]:.
+00029d70: 2020 2020 2020 2020 2222 2255 7365 6420          """Used 
+00029d80: 6279 2073 7461 636b 2061 6e64 2075 6e73  by stack and uns
+00029d90: 7461 636b 2074 6f20 6765 7420 6f6e 6520  tack to get one 
+00029da0: 7061 6e64 6173 2028 6d75 6c74 692d 2969  pandas (multi-)i
+00029db0: 6e64 6578 2061 6d6f 6e67 0a20 2020 2020  ndex among.     
+00029dc0: 2020 2074 6865 2069 6e64 6578 6564 2063     the indexed c
+00029dd0: 6f6f 7264 696e 6174 6573 2061 6c6f 6e67  oordinates along
+00029de0: 2064 696d 656e 7369 6f6e 2060 6469 6d60   dimension `dim`
+00029df0: 2e0a 0a20 2020 2020 2020 2049 6620 6578  ...        If ex
+00029e00: 6163 746c 7920 6f6e 6520 696e 6465 7820  actly one index 
+00029e10: 6973 2066 6f75 6e64 2c20 7265 7475 726e  is found, return
+00029e20: 2069 7420 7769 7468 2069 7473 2063 6f72   it with its cor
+00029e30: 7265 7370 6f6e 6469 6e67 0a20 2020 2020  responding.     
+00029e40: 2020 2063 6f6f 7264 696e 6174 6520 7661     coordinate va
+00029e50: 7269 6162 6c65 7328 7329 2c20 6f74 6865  riables(s), othe
+00029e60: 7277 6973 6520 7265 7475 726e 204e 6f6e  rwise return Non
+00029e70: 6520 616e 6420 616e 2065 6d70 7479 2064  e and an empty d
+00029e80: 6963 742e 0a0a 2020 2020 2020 2020 4966  ict...        If
+00029e90: 2060 6372 6561 7465 5f69 6e64 6578 3d54   `create_index=T
+00029ea0: 7275 6560 2c20 6372 6561 7465 2061 206e  rue`, create a n
+00029eb0: 6577 2069 6e64 6578 2069 6620 6e6f 6e65  ew index if none
+00029ec0: 2069 7320 666f 756e 6420 6f72 2072 6169   is found or rai
+00029ed0: 7365 0a20 2020 2020 2020 2061 6e20 6572  se.        an er
+00029ee0: 726f 7220 6966 206d 756c 7469 706c 6520  ror if multiple 
+00029ef0: 696e 6465 7865 7320 6172 6520 666f 756e  indexes are foun
+00029f00: 642e 0a0a 2020 2020 2020 2020 2222 220a  d...        """.
+00029f10: 2020 2020 2020 2020 7374 6163 6b5f 696e          stack_in
+00029f20: 6465 783a 2049 6e64 6578 207c 204e 6f6e  dex: Index | Non
+00029f30: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
+00029f40: 2073 7461 636b 5f63 6f6f 7264 733a 2064   stack_coords: d
+00029f50: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
+00029f60: 7269 6162 6c65 5d20 3d20 7b7d 0a0a 2020  riable] = {}..  
+00029f70: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
+00029f80: 696e 6465 7820 696e 2073 656c 662e 5f69  index in self._i
+00029f90: 6e64 6578 6573 2e69 7465 6d73 2829 3a0a  ndexes.items():.
+00029fa0: 2020 2020 2020 2020 2020 2020 7661 7220              var 
+00029fb0: 3d20 7365 6c66 2e5f 7661 7269 6162 6c65  = self._variable
+00029fc0: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
+00029fd0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00029fe0: 2020 2020 2020 2020 2076 6172 2e6e 6469           var.ndi
+00029ff0: 6d20 3d3d 2031 0a20 2020 2020 2020 2020  m == 1.         
+0002a000: 2020 2020 2020 2061 6e64 2076 6172 2e64         and var.d
+0002a010: 696d 735b 305d 203d 3d20 6469 6d0a 2020  ims[0] == dim.  
+0002a020: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0002a030: 6420 280a 2020 2020 2020 2020 2020 2020  d (.            
+0002a040: 2020 2020 2020 2020 2320 7374 6163 6b3a          # stack:
+0002a050: 206d 7573 7420 6265 2061 2073 696e 676c   must be a singl
+0002a060: 6520 636f 6f72 6469 6e61 7465 2069 6e64  e coordinate ind
+0002a070: 6578 0a20 2020 2020 2020 2020 2020 2020  ex.             
+0002a080: 2020 2020 2020 206e 6f74 206d 756c 7469         not multi
+0002a090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a0a0: 2020 2020 2061 6e64 206e 6f74 2073 656c       and not sel
+0002a0b0: 662e 7869 6e64 6578 6573 2e69 735f 6d75  f.xindexes.is_mu
+0002a0c0: 6c74 6928 6e61 6d65 290a 2020 2020 2020  lti(name).      
+0002a0d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0002a0e0: 756e 7374 6163 6b3a 206d 7573 7420 6265  unstack: must be
+0002a0f0: 2061 6e20 696e 6465 7820 7468 6174 2069   an index that i
+0002a100: 6d70 6c65 6d65 6e74 7320 2e75 6e73 7461  mplements .unsta
+0002a110: 636b 0a20 2020 2020 2020 2020 2020 2020  ck.             
+0002a120: 2020 2020 2020 206f 7220 6d75 6c74 690a         or multi.
+0002a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a140: 2020 2020 616e 6420 7479 7065 2869 6e64      and type(ind
+0002a150: 6578 292e 756e 7374 6163 6b20 6973 206e  ex).unstack is n
+0002a160: 6f74 2049 6e64 6578 2e75 6e73 7461 636b  ot Index.unstack
+0002a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a180: 2029 0a20 2020 2020 2020 2020 2020 2029   ).            )
+0002a190: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002a1a0: 2020 6966 2073 7461 636b 5f69 6e64 6578    if stack_index
+0002a1b0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0002a1c0: 2069 6e64 6578 2069 7320 6e6f 7420 7374   index is not st
+0002a1d0: 6163 6b5f 696e 6465 783a 0a20 2020 2020  ack_index:.     
+0002a1e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0002a1f0: 206d 6f72 6520 7468 616e 206f 6e65 2069   more than one i
+0002a200: 6e64 6578 2066 6f75 6e64 2c20 7374 6f70  ndex found, stop
+0002a210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a220: 2020 2020 2069 6620 6372 6561 7465 5f69       if create_i
+0002a230: 6e64 6578 3a0a 2020 2020 2020 2020 2020  ndex:.          
+0002a240: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0002a250: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0002a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a270: 2020 2020 2020 2020 2020 2020 6622 6361              f"ca
+0002a280: 6e6e 6f74 2073 7461 636b 2064 696d 656e  nnot stack dimen
+0002a290: 7369 6f6e 207b 6469 6d21 727d 2077 6974  sion {dim!r} wit
+0002a2a0: 6820 6063 7265 6174 655f 696e 6465 783d  h `create_index=
+0002a2b0: 5472 7565 6020 220a 2020 2020 2020 2020  True` ".        
+0002a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2d0: 2020 2020 2261 6e64 2077 6974 6820 6d6f      "and with mo
+0002a2e0: 7265 2074 6861 6e20 6f6e 6520 696e 6465  re than one inde
+0002a2f0: 7820 666f 756e 6420 616c 6f6e 6720 7468  x found along th
+0002a300: 6174 2064 696d 656e 7369 6f6e 220a 2020  at dimension".  
+0002a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a320: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0002a330: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002a340: 726e 204e 6f6e 652c 207b 7d0a 2020 2020  rn None, {}.    
+0002a350: 2020 2020 2020 2020 2020 2020 7374 6163              stac
+0002a360: 6b5f 696e 6465 7820 3d20 696e 6465 780a  k_index = index.
+0002a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a380: 7374 6163 6b5f 636f 6f72 6473 5b6e 616d  stack_coords[nam
+0002a390: 655d 203d 2076 6172 0a0a 2020 2020 2020  e] = var..      
+0002a3a0: 2020 6966 2063 7265 6174 655f 696e 6465    if create_inde
+0002a3b0: 7820 616e 6420 7374 6163 6b5f 696e 6465  x and stack_inde
+0002a3c0: 7820 6973 204e 6f6e 653a 0a20 2020 2020  x is None:.     
+0002a3d0: 2020 2020 2020 2069 6620 6469 6d20 696e         if dim in
+0002a3e0: 2073 656c 662e 5f76 6172 6961 626c 6573   self._variables
+0002a3f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002a400: 2020 7661 7220 3d20 7365 6c66 2e5f 7661    var = self._va
+0002a410: 7269 6162 6c65 735b 6469 6d5d 0a20 2020  riables[dim].   
+0002a420: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0002a430: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0002a440: 2c20 5f2c 2076 6172 203d 205f 6765 745f  , _, var = _get_
+0002a450: 7669 7274 7561 6c5f 7661 7269 6162 6c65  virtual_variable
+0002a460: 2873 656c 662e 5f76 6172 6961 626c 6573  (self._variables
+0002a470: 2c20 6469 6d2c 2073 656c 662e 6469 6d73  , dim, self.dims
+0002a480: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0002a490: 6475 6d6d 7920 696e 6465 7820 286f 6e6c  dummy index (onl
+0002a4a0: 7920 6073 7461 636b 5f63 6f6f 7264 7360  y `stack_coords`
+0002a4b0: 2077 696c 6c20 6265 2075 7365 6420 746f   will be used to
+0002a4c0: 2063 6f6e 7374 7275 6374 2074 6865 206d   construct the m
+0002a4d0: 756c 7469 2d69 6e64 6578 290a 2020 2020  ulti-index).    
+0002a4e0: 2020 2020 2020 2020 7374 6163 6b5f 696e          stack_in
+0002a4f0: 6465 7820 3d20 5061 6e64 6173 496e 6465  dex = PandasInde
+0002a500: 7828 5b30 5d2c 2064 696d 290a 2020 2020  x([0], dim).    
+0002a510: 2020 2020 2020 2020 7374 6163 6b5f 636f          stack_co
+0002a520: 6f72 6473 203d 207b 6469 6d3a 2076 6172  ords = {dim: var
+0002a530: 7d0a 0a20 2020 2020 2020 2072 6574 7572  }..        retur
+0002a540: 6e20 7374 6163 6b5f 696e 6465 782c 2073  n stack_index, s
+0002a550: 7461 636b 5f63 6f6f 7264 730a 0a20 2020  tack_coords..   
+0002a560: 2064 6566 205f 7374 6163 6b5f 6f6e 6365   def _stack_once
+0002a570: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+0002a580: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
+0002a590: 2020 2064 696d 733a 2053 6571 7565 6e63     dims: Sequenc
+0002a5a0: 655b 4861 7368 6162 6c65 207c 2065 6c6c  e[Hashable | ell
+0002a5b0: 6970 7369 735d 2c0a 2020 2020 2020 2020  ipsis],.        
+0002a5c0: 6e65 775f 6469 6d3a 2048 6173 6861 626c  new_dim: Hashabl
+0002a5d0: 652c 0a20 2020 2020 2020 2069 6e64 6578  e,.        index
+0002a5e0: 5f63 6c73 3a20 7479 7065 5b49 6e64 6578  _cls: type[Index
+0002a5f0: 5d2c 0a20 2020 2020 2020 2063 7265 6174  ],.        creat
+0002a600: 655f 696e 6465 783a 2062 6f6f 6c20 7c20  e_index: bool | 
+0002a610: 4e6f 6e65 203d 2054 7275 652c 0a20 2020  None = True,.   
+0002a620: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
+0002a630: 0a20 2020 2020 2020 2069 6620 6469 6d73  .        if dims
+0002a640: 203d 3d20 2e2e 2e3a 0a20 2020 2020 2020   == ...:.       
+0002a650: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0002a660: 4572 726f 7228 2250 6c65 6173 6520 7573  Error("Please us
+0002a670: 6520 5b2e 2e2e 5d20 666f 7220 6469 6d73  e [...] for dims
+0002a680: 2c20 7261 7468 6572 2074 6861 6e20 6a75  , rather than ju
+0002a690: 7374 202e 2e2e 2229 0a20 2020 2020 2020  st ...").       
+0002a6a0: 2069 6620 2e2e 2e20 696e 2064 696d 733a   if ... in dims:
+0002a6b0: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+0002a6c0: 7320 3d20 6c69 7374 2869 6e66 6978 5f64  s = list(infix_d
+0002a6d0: 696d 7328 6469 6d73 2c20 7365 6c66 2e64  ims(dims, self.d
+0002a6e0: 696d 7329 290a 0a20 2020 2020 2020 206e  ims))..        n
+0002a6f0: 6577 5f76 6172 6961 626c 6573 3a20 6469  ew_variables: di
+0002a700: 6374 5b48 6173 6861 626c 652c 2056 6172  ct[Hashable, Var
+0002a710: 6961 626c 655d 203d 207b 7d0a 2020 2020  iable] = {}.    
+0002a720: 2020 2020 7374 6163 6b65 645f 7661 725f      stacked_var_
+0002a730: 6e61 6d65 733a 206c 6973 745b 4861 7368  names: list[Hash
+0002a740: 6162 6c65 5d20 3d20 5b5d 0a20 2020 2020  able] = [].     
+0002a750: 2020 2064 726f 705f 696e 6465 7865 733a     drop_indexes:
+0002a760: 206c 6973 745b 4861 7368 6162 6c65 5d20   list[Hashable] 
+0002a770: 3d20 5b5d 0a0a 2020 2020 2020 2020 666f  = []..        fo
+0002a780: 7220 6e61 6d65 2c20 7661 7220 696e 2073  r name, var in s
+0002a790: 656c 662e 7661 7269 6162 6c65 732e 6974  elf.variables.it
+0002a7a0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0002a7b0: 2020 2069 6620 616e 7928 6420 696e 2076     if any(d in v
+0002a7c0: 6172 2e64 696d 7320 666f 7220 6420 696e  ar.dims for d in
+0002a7d0: 2064 696d 7329 3a0a 2020 2020 2020 2020   dims):.        
+0002a7e0: 2020 2020 2020 2020 6164 645f 6469 6d73          add_dims
+0002a7f0: 203d 205b 6420 666f 7220 6420 696e 2064   = [d for d in d
+0002a800: 696d 7320 6966 2064 206e 6f74 2069 6e20  ims if d not in 
+0002a810: 7661 722e 6469 6d73 5d0a 2020 2020 2020  var.dims].      
+0002a820: 2020 2020 2020 2020 2020 7664 696d 7320            vdims 
+0002a830: 3d20 6c69 7374 2876 6172 2e64 696d 7329  = list(var.dims)
+0002a840: 202b 2061 6464 5f64 696d 730a 2020 2020   + add_dims.    
+0002a850: 2020 2020 2020 2020 2020 2020 7368 6170              shap
+0002a860: 6520 3d20 5b73 656c 662e 6469 6d73 5b64  e = [self.dims[d
+0002a870: 5d20 666f 7220 6420 696e 2076 6469 6d73  ] for d in vdims
+0002a880: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0002a890: 2020 6578 705f 7661 7220 3d20 7661 722e    exp_var = var.
+0002a8a0: 7365 745f 6469 6d73 2876 6469 6d73 2c20  set_dims(vdims, 
+0002a8b0: 7368 6170 6529 0a20 2020 2020 2020 2020  shape).         
+0002a8c0: 2020 2020 2020 2073 7461 636b 6564 5f76         stacked_v
+0002a8d0: 6172 203d 2065 7870 5f76 6172 2e73 7461  ar = exp_var.sta
+0002a8e0: 636b 282a 2a7b 6e65 775f 6469 6d3a 2064  ck(**{new_dim: d
+0002a8f0: 696d 737d 290a 2020 2020 2020 2020 2020  ims}).          
+0002a900: 2020 2020 2020 6e65 775f 7661 7269 6162        new_variab
+0002a910: 6c65 735b 6e61 6d65 5d20 3d20 7374 6163  les[name] = stac
+0002a920: 6b65 645f 7661 720a 2020 2020 2020 2020  ked_var.        
+0002a930: 2020 2020 2020 2020 7374 6163 6b65 645f          stacked_
+0002a940: 7661 725f 6e61 6d65 732e 6170 7065 6e64  var_names.append
+0002a950: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
+0002a960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002a970: 2020 2020 2020 2020 206e 6577 5f76 6172           new_var
+0002a980: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
+0002a990: 6172 2e63 6f70 7928 6465 6570 3d46 616c  ar.copy(deep=Fal
+0002a9a0: 7365 290a 0a20 2020 2020 2020 2023 2064  se)..        # d
+0002a9b0: 726f 7020 696e 6465 7865 7320 6f66 2073  rop indexes of s
+0002a9c0: 7461 636b 6564 2063 6f6f 7264 696e 6174  tacked coordinat
+0002a9d0: 6573 2028 6966 2061 6e79 290a 2020 2020  es (if any).    
+0002a9e0: 2020 2020 666f 7220 6e61 6d65 2069 6e20      for name in 
+0002a9f0: 7374 6163 6b65 645f 7661 725f 6e61 6d65  stacked_var_name
+0002aa00: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
+0002aa10: 726f 705f 696e 6465 7865 7320 2b3d 206c  rop_indexes += l
+0002aa20: 6973 7428 7365 6c66 2e78 696e 6465 7865  ist(self.xindexe
+0002aa30: 732e 6765 745f 616c 6c5f 636f 6f72 6473  s.get_all_coords
+0002aa40: 286e 616d 652c 2065 7272 6f72 733d 2269  (name, errors="i
+0002aa50: 676e 6f72 6522 2929 0a0a 2020 2020 2020  gnore"))..      
+0002aa60: 2020 6e65 775f 696e 6465 7865 7320 3d20    new_indexes = 
+0002aa70: 7b7d 0a20 2020 2020 2020 206e 6577 5f63  {}.        new_c
+0002aa80: 6f6f 7264 5f6e 616d 6573 203d 2073 6574  oord_names = set
+0002aa90: 2873 656c 662e 5f63 6f6f 7264 5f6e 616d  (self._coord_nam
+0002aaa0: 6573 290a 2020 2020 2020 2020 6966 2063  es).        if c
+0002aab0: 7265 6174 655f 696e 6465 7820 6f72 2063  reate_index or c
+0002aac0: 7265 6174 655f 696e 6465 7820 6973 204e  reate_index is N
+0002aad0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002aae0: 2070 726f 6475 6374 5f76 6172 733a 2064   product_vars: d
+0002aaf0: 6963 745b 416e 792c 2056 6172 6961 626c  ict[Any, Variabl
+0002ab00: 655d 203d 207b 7d0a 2020 2020 2020 2020  e] = {}.        
+0002ab10: 2020 2020 666f 7220 6469 6d20 696e 2064      for dim in d
+0002ab20: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
+0002ab30: 2020 2020 2069 6478 2c20 6964 785f 7661       idx, idx_va
+0002ab40: 7273 203d 2073 656c 662e 5f67 6574 5f73  rs = self._get_s
+0002ab50: 7461 636b 5f69 6e64 6578 2864 696d 2c20  tack_index(dim, 
+0002ab60: 6372 6561 7465 5f69 6e64 6578 3d63 7265  create_index=cre
+0002ab70: 6174 655f 696e 6465 7829 0a20 2020 2020  ate_index).     
+0002ab80: 2020 2020 2020 2020 2020 2069 6620 6964             if id
+0002ab90: 7820 6973 206e 6f74 204e 6f6e 653a 0a20  x is not None:. 
+0002aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002abb0: 2020 2070 726f 6475 6374 5f76 6172 732e     product_vars.
+0002abc0: 7570 6461 7465 2869 6478 5f76 6172 7329  update(idx_vars)
+0002abd0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0002abe0: 206c 656e 2870 726f 6475 6374 5f76 6172   len(product_var
+0002abf0: 7329 203d 3d20 6c65 6e28 6469 6d73 293a  s) == len(dims):
+0002ac00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ac10: 2069 6478 203d 2069 6e64 6578 5f63 6c73   idx = index_cls
+0002ac20: 2e73 7461 636b 2870 726f 6475 6374 5f76  .stack(product_v
+0002ac30: 6172 732c 206e 6577 5f64 696d 290a 2020  ars, new_dim).  
+0002ac40: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0002ac50: 775f 696e 6465 7865 735b 6e65 775f 6469  w_indexes[new_di
+0002ac60: 6d5d 203d 2069 6478 0a20 2020 2020 2020  m] = idx.       
+0002ac70: 2020 2020 2020 2020 206e 6577 5f69 6e64           new_ind
+0002ac80: 6578 6573 2e75 7064 6174 6528 7b6b 3a20  exes.update({k: 
+0002ac90: 6964 7820 666f 7220 6b20 696e 2070 726f  idx for k in pro
+0002aca0: 6475 6374 5f76 6172 737d 290a 2020 2020  duct_vars}).    
+0002acb0: 2020 2020 2020 2020 2020 2020 6964 785f              idx_
+0002acc0: 7661 7273 203d 2069 6478 2e63 7265 6174  vars = idx.creat
+0002acd0: 655f 7661 7269 6162 6c65 7328 7072 6f64  e_variables(prod
+0002ace0: 7563 745f 7661 7273 290a 2020 2020 2020  uct_vars).      
+0002acf0: 2020 2020 2020 2020 2020 2320 6b65 6570            # keep
+0002ad00: 2063 6f6e 7369 7374 656e 7420 6d75 6c74   consistent mult
+0002ad10: 692d 696e 6465 7820 636f 6f72 6469 6e61  i-index coordina
+0002ad20: 7465 206f 7264 6572 0a20 2020 2020 2020  te order.       
+0002ad30: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
+0002ad40: 6e20 6964 785f 7661 7273 3a0a 2020 2020  n idx_vars:.    
+0002ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad60: 6e65 775f 7661 7269 6162 6c65 732e 706f  new_variables.po
+0002ad70: 7028 6b2c 204e 6f6e 6529 0a20 2020 2020  p(k, None).     
+0002ad80: 2020 2020 2020 2020 2020 206e 6577 5f76             new_v
+0002ad90: 6172 6961 626c 6573 2e75 7064 6174 6528  ariables.update(
+0002ada0: 6964 785f 7661 7273 290a 2020 2020 2020  idx_vars).      
+0002adb0: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
+0002adc0: 6f72 645f 6e61 6d65 732e 7570 6461 7465  ord_names.update
+0002add0: 2869 6478 5f76 6172 7329 0a0a 2020 2020  (idx_vars)..    
+0002ade0: 2020 2020 696e 6465 7865 7320 3d20 7b6b      indexes = {k
+0002adf0: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+0002ae00: 7365 6c66 2e5f 696e 6465 7865 732e 6974  self._indexes.it
+0002ae10: 656d 7328 2920 6966 206b 206e 6f74 2069  ems() if k not i
+0002ae20: 6e20 6472 6f70 5f69 6e64 6578 6573 7d0a  n drop_indexes}.
+0002ae30: 2020 2020 2020 2020 696e 6465 7865 732e          indexes.
+0002ae40: 7570 6461 7465 286e 6577 5f69 6e64 6578  update(new_index
+0002ae50: 6573 290a 0a20 2020 2020 2020 2072 6574  es)..        ret
+0002ae60: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
+0002ae70: 655f 7769 7468 5f6e 6577 5f64 696d 7328  e_with_new_dims(
+0002ae80: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+0002ae90: 5f76 6172 6961 626c 6573 2c20 636f 6f72  _variables, coor
+0002aea0: 645f 6e61 6d65 733d 6e65 775f 636f 6f72  d_names=new_coor
+0002aeb0: 645f 6e61 6d65 732c 2069 6e64 6578 6573  d_names, indexes
+0002aec0: 3d69 6e64 6578 6573 0a20 2020 2020 2020  =indexes.       
+0002aed0: 2029 0a0a 2020 2020 6465 6620 7374 6163   )..    def stac
+0002aee0: 6b28 0a20 2020 2020 2020 2073 656c 663a  k(.        self:
+0002aef0: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
+0002af00: 2020 2020 6469 6d65 6e73 696f 6e73 3a20      dimensions: 
+0002af10: 4d61 7070 696e 675b 416e 792c 2053 6571  Mapping[Any, Seq
+0002af20: 7565 6e63 655b 4861 7368 6162 6c65 207c  uence[Hashable |
+0002af30: 2065 6c6c 6970 7369 735d 5d20 7c20 4e6f   ellipsis]] | No
+0002af40: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+0002af50: 2020 2063 7265 6174 655f 696e 6465 783a     create_index:
+0002af60: 2062 6f6f 6c20 7c20 4e6f 6e65 203d 2054   bool | None = T
+0002af70: 7275 652c 0a20 2020 2020 2020 2069 6e64  rue,.        ind
+0002af80: 6578 5f63 6c73 3a20 7479 7065 5b49 6e64  ex_cls: type[Ind
+0002af90: 6578 5d20 3d20 5061 6e64 6173 4d75 6c74  ex] = PandasMult
+0002afa0: 6949 6e64 6578 2c0a 2020 2020 2020 2020  iIndex,.        
+0002afb0: 2a2a 6469 6d65 6e73 696f 6e73 5f6b 7761  **dimensions_kwa
+0002afc0: 7267 733a 2053 6571 7565 6e63 655b 4861  rgs: Sequence[Ha
+0002afd0: 7368 6162 6c65 207c 2065 6c6c 6970 7369  shable | ellipsi
+0002afe0: 735d 2c0a 2020 2020 2920 2d3e 2054 5f44  s],.    ) -> T_D
+0002aff0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+0002b000: 2222 220a 2020 2020 2020 2020 5374 6163  """.        Stac
+0002b010: 6b20 616e 7920 6e75 6d62 6572 206f 6620  k any number of 
+0002b020: 6578 6973 7469 6e67 2064 696d 656e 7369  existing dimensi
+0002b030: 6f6e 7320 696e 746f 2061 2073 696e 676c  ons into a singl
+0002b040: 6520 6e65 7720 6469 6d65 6e73 696f 6e2e  e new dimension.
+0002b050: 0a0a 2020 2020 2020 2020 4e65 7720 6469  ..        New di
+0002b060: 6d65 6e73 696f 6e73 2077 696c 6c20 6265  mensions will be
+0002b070: 2061 6464 6564 2061 7420 7468 6520 656e   added at the en
+0002b080: 642c 2061 6e64 2062 7920 6465 6661 756c  d, and by defaul
+0002b090: 7420 7468 6520 636f 7272 6573 706f 6e64  t the correspond
+0002b0a0: 696e 670a 2020 2020 2020 2020 636f 6f72  ing.        coor
+0002b0b0: 6469 6e61 7465 2076 6172 6961 626c 6573  dinate variables
+0002b0c0: 2077 696c 6c20 6265 2063 6f6d 6269 6e65   will be combine
+0002b0d0: 6420 696e 746f 2061 204d 756c 7469 496e  d into a MultiIn
+0002b0e0: 6465 782e 0a0a 2020 2020 2020 2020 5061  dex...        Pa
+0002b0f0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+0002b100: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+0002b110: 2020 2020 6469 6d65 6e73 696f 6e73 203a      dimensions :
+0002b120: 206d 6170 7069 6e67 206f 6620 6861 7368   mapping of hash
+0002b130: 6162 6c65 2074 6f20 7365 7175 656e 6365  able to sequence
+0002b140: 206f 6620 6861 7368 6162 6c65 0a20 2020   of hashable.   
+0002b150: 2020 2020 2020 2020 204d 6170 7069 6e67           Mapping
+0002b160: 206f 6620 7468 6520 666f 726d 2060 6e65   of the form `ne
+0002b170: 775f 6e61 6d65 3d28 6469 6d31 2c20 6469  w_name=(dim1, di
+0002b180: 6d32 2c20 2e2e 2e29 602e 204e 616d 6573  m2, ...)`. Names
+0002b190: 206f 6620 6e65 770a 2020 2020 2020 2020   of new.        
+0002b1a0: 2020 2020 6469 6d65 6e73 696f 6e73 2c20      dimensions, 
+0002b1b0: 616e 6420 7468 6520 6578 6973 7469 6e67  and the existing
+0002b1c0: 2064 696d 656e 7369 6f6e 7320 7468 6174   dimensions that
+0002b1d0: 2074 6865 7920 7265 706c 6163 652e 2041   they replace. A
+0002b1e0: 6e0a 2020 2020 2020 2020 2020 2020 656c  n.            el
+0002b1f0: 6c69 7073 6973 2028 602e 2e2e 6029 2077  lipsis (`...`) w
+0002b200: 696c 6c20 6265 2072 6570 6c61 6365 6420  ill be replaced 
+0002b210: 6279 2061 6c6c 2075 6e6c 6973 7465 6420  by all unlisted 
+0002b220: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
+0002b230: 2020 2020 2020 2020 5061 7373 696e 6720          Passing 
+0002b240: 6120 6c69 7374 2063 6f6e 7461 696e 696e  a list containin
+0002b250: 6720 616e 2065 6c6c 6970 7369 7320 2860  g an ellipsis (`
+0002b260: 7374 6163 6b65 645f 6469 6d3d 5b2e 2e2e  stacked_dim=[...
+0002b270: 5d60 2920 7769 6c6c 2073 7461 636b 206f  ]`) will stack o
+0002b280: 7665 720a 2020 2020 2020 2020 2020 2020  ver.            
+0002b290: 616c 6c20 6469 6d65 6e73 696f 6e73 2e0a  all dimensions..
+0002b2a0: 2020 2020 2020 2020 6372 6561 7465 5f69          create_i
+0002b2b0: 6e64 6578 203a 2062 6f6f 6c20 6f72 204e  ndex : bool or N
+0002b2c0: 6f6e 652c 2064 6566 6175 6c74 3a20 5472  one, default: Tr
+0002b2d0: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+0002b2e0: 2d20 5472 7565 3a20 6372 6561 7465 2061  - True: create a
+0002b2f0: 206d 756c 7469 2d69 6e64 6578 2066 6f72   multi-index for
+0002b300: 2065 6163 6820 6f66 2074 6865 2073 7461   each of the sta
+0002b310: 636b 6564 2064 696d 656e 7369 6f6e 732e  cked dimensions.
+0002b320: 0a20 2020 2020 2020 2020 2020 202d 2046  .            - F
+0002b330: 616c 7365 3a20 646f 6e27 7420 6372 6561  alse: don't crea
+0002b340: 7465 2061 6e79 2069 6e64 6578 2e0a 2020  te any index..  
+0002b350: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
+0002b360: 2e20 6372 6561 7465 2061 206d 756c 7469  . create a multi
+0002b370: 2d69 6e64 6578 206f 6e6c 7920 6966 2065  -index only if e
+0002b380: 7861 6374 6c79 206f 6e65 2073 696e 676c  xactly one singl
+0002b390: 6520 2831 2d64 2920 636f 6f72 6469 6e61  e (1-d) coordina
+0002b3a0: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
+0002b3b0: 2069 6e64 6578 2069 7320 666f 756e 6420   index is found 
+0002b3c0: 666f 7220 6576 6572 7920 6469 6d65 6e73  for every dimens
+0002b3d0: 696f 6e20 746f 2073 7461 636b 2e0a 0a20  ion to stack... 
+0002b3e0: 2020 2020 2020 2069 6e64 6578 5f63 6c73         index_cls
+0002b3f0: 3a20 496e 6465 782d 636c 6173 732c 2064  : Index-class, d
+0002b400: 6566 6175 6c74 3a20 5061 6e64 6173 4d75  efault: PandasMu
+0002b410: 6c74 6949 6e64 6578 0a20 2020 2020 2020  ltiIndex.       
+0002b420: 2020 2020 2043 616e 2062 6520 7573 6564       Can be used
+0002b430: 2074 6f20 7061 7373 2061 2063 7573 746f   to pass a custo
+0002b440: 6d20 6d75 6c74 692d 696e 6465 7820 7479  m multi-index ty
+0002b450: 7065 2028 6d75 7374 2062 6520 616e 2058  pe (must be an X
+0002b460: 6172 7261 7920 696e 6465 7820 7468 6174  array index that
+0002b470: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
+0002b480: 6c65 6d65 6e74 7320 602e 7374 6163 6b28  lements `.stack(
+0002b490: 2960 292e 2042 7920 6465 6661 756c 742c  )`). By default,
+0002b4a0: 2061 2070 616e 6461 7320 6d75 6c74 692d   a pandas multi-
+0002b4b0: 696e 6465 7820 7772 6170 7065 7220 6973  index wrapper is
+0002b4c0: 2075 7365 642e 0a20 2020 2020 2020 202a   used..        *
+0002b4d0: 2a64 696d 656e 7369 6f6e 735f 6b77 6172  *dimensions_kwar
+0002b4e0: 6773 0a20 2020 2020 2020 2020 2020 2054  gs.            T
+0002b4f0: 6865 206b 6579 776f 7264 2061 7267 756d  he keyword argum
+0002b500: 656e 7473 2066 6f72 6d20 6f66 2060 6064  ents form of ``d
+0002b510: 696d 656e 7369 6f6e 7360 602e 0a20 2020  imensions``..   
+0002b520: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
+0002b530: 6469 6d65 6e73 696f 6e73 206f 7220 6469  dimensions or di
+0002b540: 6d65 6e73 696f 6e73 5f6b 7761 7267 7320  mensions_kwargs 
+0002b550: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
+0002b560: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+0002b570: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+0002b580: 2d2d 0a20 2020 2020 2020 2073 7461 636b  --.        stack
+0002b590: 6564 203a 2044 6174 6173 6574 0a20 2020  ed : Dataset.   
+0002b5a0: 2020 2020 2020 2020 2044 6174 6173 6574           Dataset
+0002b5b0: 2077 6974 6820 7374 6163 6b65 6420 6461   with stacked da
+0002b5c0: 7461 2e0a 0a20 2020 2020 2020 2053 6565  ta...        See
+0002b5d0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+0002b5e0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+0002b5f0: 6174 6173 6574 2e75 6e73 7461 636b 0a20  ataset.unstack. 
+0002b600: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0002b610: 2020 2064 696d 656e 7369 6f6e 7320 3d20     dimensions = 
+0002b620: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
+0002b630: 7761 7267 7328 6469 6d65 6e73 696f 6e73  wargs(dimensions
+0002b640: 2c20 6469 6d65 6e73 696f 6e73 5f6b 7761  , dimensions_kwa
+0002b650: 7267 732c 2022 7374 6163 6b22 290a 2020  rgs, "stack").  
+0002b660: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+0002b670: 656c 660a 2020 2020 2020 2020 666f 7220  elf.        for 
+0002b680: 6e65 775f 6469 6d2c 2064 696d 7320 696e  new_dim, dims in
+0002b690: 2064 696d 656e 7369 6f6e 732e 6974 656d   dimensions.item
+0002b6a0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0002b6b0: 2072 6573 756c 7420 3d20 7265 7375 6c74   result = result
+0002b6c0: 2e5f 7374 6163 6b5f 6f6e 6365 2864 696d  ._stack_once(dim
+0002b6d0: 732c 206e 6577 5f64 696d 2c20 696e 6465  s, new_dim, inde
+0002b6e0: 785f 636c 732c 2063 7265 6174 655f 696e  x_cls, create_in
+0002b6f0: 6465 7829 0a20 2020 2020 2020 2072 6574  dex).        ret
+0002b700: 7572 6e20 7265 7375 6c74 0a0a 2020 2020  urn result..    
+0002b710: 6465 6620 746f 5f73 7461 636b 6564 5f61  def to_stacked_a
+0002b720: 7272 6179 280a 2020 2020 2020 2020 7365  rray(.        se
+0002b730: 6c66 2c0a 2020 2020 2020 2020 6e65 775f  lf,.        new_
+0002b740: 6469 6d3a 2048 6173 6861 626c 652c 0a20  dim: Hashable,. 
+0002b750: 2020 2020 2020 2073 616d 706c 655f 6469         sample_di
+0002b760: 6d73 3a20 436f 6c6c 6563 7469 6f6e 5b48  ms: Collection[H
+0002b770: 6173 6861 626c 655d 2c0a 2020 2020 2020  ashable],.      
+0002b780: 2020 7661 7269 6162 6c65 5f64 696d 3a20    variable_dim: 
+0002b790: 4861 7368 6162 6c65 203d 2022 7661 7269  Hashable = "vari
+0002b7a0: 6162 6c65 222c 0a20 2020 2020 2020 206e  able",.        n
+0002b7b0: 616d 653a 2048 6173 6861 626c 6520 7c20  ame: Hashable | 
+0002b7c0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+0002b7d0: 2029 202d 3e20 4461 7461 4172 7261 793a   ) -> DataArray:
+0002b7e0: 0a20 2020 2020 2020 2022 2222 436f 6d62  .        """Comb
+0002b7f0: 696e 6520 7661 7269 6162 6c65 7320 6f66  ine variables of
+0002b800: 2064 6966 6665 7269 6e67 2064 696d 656e   differing dimen
+0002b810: 7369 6f6e 616c 6974 7920 696e 746f 2061  sionality into a
+0002b820: 2044 6174 6141 7272 6179 0a20 2020 2020   DataArray.     
+0002b830: 2020 2077 6974 686f 7574 2062 726f 6164     without broad
+0002b840: 6361 7374 696e 672e 0a0a 2020 2020 2020  casting...      
+0002b850: 2020 5468 6973 206d 6574 686f 6420 6973    This method is
+0002b860: 2073 696d 696c 6172 2074 6f20 4461 7461   similar to Data
+0002b870: 7365 742e 746f 5f61 7272 6179 2062 7574  set.to_array but
+0002b880: 2064 6f65 7320 6e6f 7420 6272 6f61 6463   does not broadc
+0002b890: 6173 7420 7468 650a 2020 2020 2020 2020  ast the.        
+0002b8a0: 7661 7269 6162 6c65 732e 0a0a 2020 2020  variables...    
+0002b8b0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0002b8c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0002b8d0: 2d0a 2020 2020 2020 2020 6e65 775f 6469  -.        new_di
+0002b8e0: 6d20 3a20 6861 7368 6162 6c65 0a20 2020  m : hashable.   
+0002b8f0: 2020 2020 2020 2020 204e 616d 6520 6f66           Name of
+0002b900: 2074 6865 206e 6577 2073 7461 636b 6564   the new stacked
+0002b910: 2063 6f6f 7264 696e 6174 650a 2020 2020   coordinate.    
+0002b920: 2020 2020 7361 6d70 6c65 5f64 696d 7320      sample_dims 
+0002b930: 3a20 436f 6c6c 6563 7469 6f6e 206f 6620  : Collection of 
+0002b940: 6861 7368 6162 6c65 730a 2020 2020 2020  hashables.      
+0002b950: 2020 2020 2020 4c69 7374 206f 6620 6469        List of di
+0002b960: 6d65 6e73 696f 6e73 2074 6861 7420 2a2a  mensions that **
+0002b970: 7769 6c6c 206e 6f74 2a2a 2062 6520 7374  will not** be st
+0002b980: 6163 6b65 642e 2045 6163 6820 6172 7261  acked. Each arra
+0002b990: 7920 696e 2074 6865 0a20 2020 2020 2020  y in the.       
+0002b9a0: 2020 2020 2064 6174 6173 6574 206d 7573       dataset mus
+0002b9b0: 7420 7368 6172 6520 7468 6573 6520 6469  t share these di
+0002b9c0: 6d65 6e73 696f 6e73 2e20 466f 7220 6d61  mensions. For ma
+0002b9d0: 6368 696e 6520 6c65 6172 6e69 6e67 0a20  chine learning. 
+0002b9e0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+0002b9f0: 6361 7469 6f6e 732c 2074 6865 7365 2064  cations, these d
+0002ba00: 6566 696e 6520 7468 6520 6469 6d65 6e73  efine the dimens
+0002ba10: 696f 6e73 206f 7665 7220 7768 6963 6820  ions over which 
+0002ba20: 7361 6d70 6c65 7320 6172 650a 2020 2020  samples are.    
+0002ba30: 2020 2020 2020 2020 6472 6177 6e2e 0a20          drawn.. 
+0002ba40: 2020 2020 2020 2076 6172 6961 626c 655f         variable_
+0002ba50: 6469 6d20 3a20 6861 7368 6162 6c65 2c20  dim : hashable, 
+0002ba60: 6465 6661 756c 743a 2022 7661 7269 6162  default: "variab
+0002ba70: 6c65 220a 2020 2020 2020 2020 2020 2020  le".            
+0002ba80: 4e61 6d65 206f 6620 7468 6520 6c65 7665  Name of the leve
+0002ba90: 6c20 696e 2074 6865 2073 7461 636b 6564  l in the stacked
+0002baa0: 2063 6f6f 7264 696e 6174 6520 7768 6963   coordinate whic
+0002bab0: 6820 636f 7272 6573 706f 6e64 7320 746f  h corresponds to
+0002bac0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0002bad0: 2076 6172 6961 626c 6573 2e0a 2020 2020   variables..    
+0002bae0: 2020 2020 6e61 6d65 203a 2068 6173 6861      name : hasha
+0002baf0: 626c 652c 206f 7074 696f 6e61 6c0a 2020  ble, optional.  
+0002bb00: 2020 2020 2020 2020 2020 4e61 6d65 206f            Name o
+0002bb10: 6620 7468 6520 6e65 7720 6461 7461 2061  f the new data a
+0002bb20: 7272 6179 2e0a 0a20 2020 2020 2020 2052  rray...        R
+0002bb30: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+0002bb40: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2073  ------.        s
+0002bb50: 7461 636b 6564 203a 2044 6174 6141 7272  tacked : DataArr
+0002bb60: 6179 0a20 2020 2020 2020 2020 2020 2044  ay.            D
+0002bb70: 6174 6141 7272 6179 2077 6974 6820 7468  ataArray with th
+0002bb80: 6520 7370 6563 6966 6965 6420 6469 6d65  e specified dime
+0002bb90: 6e73 696f 6e73 2061 6e64 2064 6174 6120  nsions and data 
+0002bba0: 7661 7269 6162 6c65 730a 2020 2020 2020  variables.      
+0002bbb0: 2020 2020 2020 7374 6163 6b65 6420 746f        stacked to
+0002bbc0: 6765 7468 6572 2e20 5468 6520 7374 6163  gether. The stac
+0002bbd0: 6b65 6420 636f 6f72 6469 6e61 7465 2069  ked coordinate i
+0002bbe0: 7320 6e61 6d65 6420 6060 6e65 775f 6469  s named ``new_di
+0002bbf0: 6d60 600a 2020 2020 2020 2020 2020 2020  m``.            
+0002bc00: 616e 6420 7265 7072 6573 656e 7465 6420  and represented 
+0002bc10: 6279 2061 204d 756c 7469 496e 6465 7820  by a MultiIndex 
+0002bc20: 6f62 6a65 6374 2077 6974 6820 6120 6c65  object with a le
+0002bc30: 7665 6c20 636f 6e74 6169 6e69 6e67 2074  vel containing t
+0002bc40: 6865 0a20 2020 2020 2020 2020 2020 2064  he.            d
+0002bc50: 6174 6120 7661 7269 6162 6c65 206e 616d  ata variable nam
+0002bc60: 6573 2e20 5468 6520 6e61 6d65 206f 6620  es. The name of 
+0002bc70: 7468 6973 206c 6576 656c 2069 7320 636f  this level is co
+0002bc80: 6e74 726f 6c6c 6564 2075 7369 6e67 0a20  ntrolled using. 
+0002bc90: 2020 2020 2020 2020 2020 2074 6865 2060             the `
+0002bca0: 6076 6172 6961 626c 655f 6469 6d60 6020  `variable_dim`` 
+0002bcb0: 6172 6775 6d65 6e74 2e0a 0a20 2020 2020  argument...     
+0002bcc0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+0002bcd0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0002bce0: 2020 2020 2044 6174 6173 6574 2e74 6f5f       Dataset.to_
+0002bcf0: 6172 7261 790a 2020 2020 2020 2020 4461  array.        Da
+0002bd00: 7461 7365 742e 7374 6163 6b0a 2020 2020  taset.stack.    
+0002bd10: 2020 2020 4461 7461 4172 7261 792e 746f      DataArray.to
+0002bd20: 5f75 6e73 7461 636b 6564 5f64 6174 6173  _unstacked_datas
+0002bd30: 6574 0a0a 2020 2020 2020 2020 4578 616d  et..        Exam
+0002bd40: 706c 6573 0a20 2020 2020 2020 202d 2d2d  ples.        ---
+0002bd50: 2d2d 2d2d 2d0a 2020 2020 2020 2020 3e3e  -----.        >>
+0002bd60: 3e20 6461 7461 203d 2078 722e 4461 7461  > data = xr.Data
+0002bd70: 7365 7428 0a20 2020 2020 2020 202e 2e2e  set(.        ...
+0002bd80: 2020 2020 2064 6174 615f 7661 7273 3d7b       data_vars={
+0002bd90: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0002bda0: 2020 2020 2022 6122 3a20 2828 2278 222c       "a": (("x",
+0002bdb0: 2022 7922 292c 205b 5b30 2c20 312c 2032   "y"), [[0, 1, 2
+0002bdc0: 5d2c 205b 332c 2034 2c20 355d 5d29 2c0a  ], [3, 4, 5]]),.
+0002bdd0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0002bde0: 2020 2020 2262 223a 2028 2278 222c 205b      "b": ("x", [
+0002bdf0: 362c 2037 5d29 2c0a 2020 2020 2020 2020  6, 7]),.        
+0002be00: 2e2e 2e20 2020 2020 7d2c 0a20 2020 2020  ...     },.     
+0002be10: 2020 202e 2e2e 2020 2020 2063 6f6f 7264     ...     coord
+0002be20: 733d 7b22 7922 3a20 5b22 7522 2c20 2276  s={"y": ["u", "v
+0002be30: 222c 2022 7722 5d7d 2c0a 2020 2020 2020  ", "w"]},.      
+0002be40: 2020 2e2e 2e20 290a 0a20 2020 2020 2020    ... )..       
+0002be50: 203e 3e3e 2064 6174 610a 2020 2020 2020   >>> data.      
+0002be60: 2020 3c78 6172 7261 792e 4461 7461 7365    <xarray.Datase
+0002be70: 743e 0a20 2020 2020 2020 2044 696d 656e  t>.        Dimen
+0002be80: 7369 6f6e 733a 2020 2878 3a20 322c 2079  sions:  (x: 2, y
+0002be90: 3a20 3329 0a20 2020 2020 2020 2043 6f6f  : 3).        Coo
+0002bea0: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+0002beb0: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
+0002bec0: 7929 203c 5531 2027 7527 2027 7627 2027  y) <U1 'u' 'v' '
+0002bed0: 7727 0a20 2020 2020 2020 2044 696d 656e  w'.        Dimen
+0002bee0: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
+0002bef0: 6f72 6469 6e61 7465 733a 2078 0a20 2020  ordinates: x.   
+0002bf00: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+0002bf10: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+0002bf20: 2061 2020 2020 2020 2020 2878 2c20 7929   a        (x, y)
+0002bf30: 2069 6e74 3634 2030 2031 2032 2033 2034   int64 0 1 2 3 4
+0002bf40: 2035 0a20 2020 2020 2020 2020 2020 2062   5.            b
+0002bf50: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
+0002bf60: 3420 3620 370a 0a20 2020 2020 2020 203e  4 6 7..        >
+0002bf70: 3e3e 2064 6174 612e 746f 5f73 7461 636b  >> data.to_stack
+0002bf80: 6564 5f61 7272 6179 2822 7a22 2c20 7361  ed_array("z", sa
+0002bf90: 6d70 6c65 5f64 696d 733d 5b22 7822 5d29  mple_dims=["x"])
+0002bfa0: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+0002bfb0: 2e44 6174 6141 7272 6179 2027 6127 2028  .DataArray 'a' (
+0002bfc0: 783a 2032 2c20 7a3a 2034 293e 0a20 2020  x: 2, z: 4)>.   
+0002bfd0: 2020 2020 2061 7272 6179 285b 5b30 2c20       array([[0, 
+0002bfe0: 312c 2032 2c20 365d 2c0a 2020 2020 2020  1, 2, 6],.      
+0002bff0: 2020 2020 2020 2020 205b 332c 2034 2c20           [3, 4, 
+0002c000: 352c 2037 5d5d 290a 2020 2020 2020 2020  5, 7]]).        
+0002c010: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+0002c020: 2020 2020 2020 202a 207a 2020 2020 2020         * z      
+0002c030: 2020 2028 7a29 206f 626a 6563 7420 4d75     (z) object Mu
+0002c040: 6c74 6949 6e64 6578 0a20 2020 2020 2020  ltiIndex.       
+0002c050: 2020 202a 2076 6172 6961 626c 6520 2028     * variable  (
+0002c060: 7a29 206f 626a 6563 7420 2761 2720 2761  z) object 'a' 'a
+0002c070: 2720 2761 2720 2762 270a 2020 2020 2020  ' 'a' 'b'.      
+0002c080: 2020 2020 2a20 7920 2020 2020 2020 2020      * y         
+0002c090: 287a 2920 6f62 6a65 6374 2027 7527 2027  (z) object 'u' '
+0002c0a0: 7627 2027 7727 206e 616e 0a20 2020 2020  v' 'w' nan.     
+0002c0b0: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
+0002c0c0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
+0002c0d0: 733a 2078 0a0a 2020 2020 2020 2020 2222  s: x..        ""
+0002c0e0: 220a 2020 2020 2020 2020 6672 6f6d 2078  ".        from x
+0002c0f0: 6172 7261 792e 636f 7265 2e63 6f6e 6361  array.core.conca
+0002c100: 7420 696d 706f 7274 2063 6f6e 6361 740a  t import concat.
+0002c110: 0a20 2020 2020 2020 2073 7461 636b 696e  .        stackin
+0002c120: 675f 6469 6d73 203d 2074 7570 6c65 2864  g_dims = tuple(d
+0002c130: 696d 2066 6f72 2064 696d 2069 6e20 7365  im for dim in se
+0002c140: 6c66 2e64 696d 7320 6966 2064 696d 206e  lf.dims if dim n
+0002c150: 6f74 2069 6e20 7361 6d70 6c65 5f64 696d  ot in sample_dim
+0002c160: 7329 0a0a 2020 2020 2020 2020 666f 7220  s)..        for 
+0002c170: 7661 7269 6162 6c65 2069 6e20 7365 6c66  variable in self
+0002c180: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+0002c190: 6d73 203d 2073 656c 665b 7661 7269 6162  ms = self[variab
+0002c1a0: 6c65 5d2e 6469 6d73 0a20 2020 2020 2020  le].dims.       
+0002c1b0: 2020 2020 2064 696d 735f 696e 636c 7564       dims_includ
+0002c1c0: 655f 7361 6d70 6c65 5f64 696d 7320 3d20  e_sample_dims = 
+0002c1d0: 7365 7428 7361 6d70 6c65 5f64 696d 7329  set(sample_dims)
+0002c1e0: 203c 3d20 7365 7428 6469 6d73 290a 2020   <= set(dims).  
+0002c1f0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0002c200: 2064 696d 735f 696e 636c 7564 655f 7361   dims_include_sa
+0002c210: 6d70 6c65 5f64 696d 733a 0a20 2020 2020  mple_dims:.     
+0002c220: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0002c230: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0002c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c250: 2022 416c 6c20 7661 7269 6162 6c65 7320   "All variables 
+0002c260: 696e 2074 6865 2064 6174 6173 6574 206d  in the dataset m
+0002c270: 7573 7420 636f 6e74 6169 6e20 7468 6520  ust contain the 
+0002c280: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0002c290: 2020 2020 2020 2264 696d 656e 7369 6f6e        "dimension
+0002c2a0: 7320 7b7d 2e22 2e66 6f72 6d61 7428 6469  s {}.".format(di
+0002c2b0: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
+0002c2c0: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
+0002c2d0: 6566 2065 6e73 7572 655f 7374 6163 6b61  ef ensure_stacka
+0002c2e0: 626c 6528 7661 6c29 3a0a 2020 2020 2020  ble(val):.      
+0002c2f0: 2020 2020 2020 6173 7369 676e 5f63 6f6f        assign_coo
+0002c300: 7264 7320 3d20 7b76 6172 6961 626c 655f  rds = {variable_
+0002c310: 6469 6d3a 2076 616c 2e6e 616d 657d 0a20  dim: val.name}. 
+0002c320: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+0002c330: 696d 2069 6e20 7374 6163 6b69 6e67 5f64  im in stacking_d
+0002c340: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
+0002c350: 2020 2020 2069 6620 6469 6d20 6e6f 7420       if dim not 
+0002c360: 696e 2076 616c 2e64 696d 733a 0a20 2020  in val.dims:.   
+0002c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c380: 2061 7373 6967 6e5f 636f 6f72 6473 5b64   assign_coords[d
+0002c390: 696d 5d20 3d20 4e6f 6e65 0a0a 2020 2020  im] = None..    
+0002c3a0: 2020 2020 2020 2020 6578 7061 6e64 5f64          expand_d
+0002c3b0: 696d 7320 3d20 7365 7428 7374 6163 6b69  ims = set(stacki
+0002c3c0: 6e67 5f64 696d 7329 2e64 6966 6665 7265  ng_dims).differe
+0002c3d0: 6e63 6528 7365 7428 7661 6c2e 6469 6d73  nce(set(val.dims
+0002c3e0: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
+0002c3f0: 7870 616e 645f 6469 6d73 2e61 6464 2876  xpand_dims.add(v
+0002c400: 6172 6961 626c 655f 6469 6d29 0a20 2020  ariable_dim).   
+0002c410: 2020 2020 2020 2020 2023 206d 7573 7420           # must 
+0002c420: 6265 206c 6973 7420 666f 7220 2e65 7870  be list for .exp
+0002c430: 616e 645f 6469 6d73 0a20 2020 2020 2020  and_dims.       
+0002c440: 2020 2020 2065 7870 616e 645f 6469 6d73       expand_dims
+0002c450: 203d 206c 6973 7428 6578 7061 6e64 5f64   = list(expand_d
+0002c460: 696d 7329 0a0a 2020 2020 2020 2020 2020  ims)..          
+0002c470: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+0002c480: 2020 2020 2020 2020 2020 2076 616c 2e61             val.a
+0002c490: 7373 6967 6e5f 636f 6f72 6473 282a 2a61  ssign_coords(**a
+0002c4a0: 7373 6967 6e5f 636f 6f72 6473 290a 2020  ssign_coords).  
+0002c4b0: 2020 2020 2020 2020 2020 2020 2020 2e65                .e
+0002c4c0: 7870 616e 645f 6469 6d73 2865 7870 616e  xpand_dims(expan
+0002c4d0: 645f 6469 6d73 290a 2020 2020 2020 2020  d_dims).        
+0002c4e0: 2020 2020 2020 2020 2e73 7461 636b 287b          .stack({
+0002c4f0: 6e65 775f 6469 6d3a 2028 7661 7269 6162  new_dim: (variab
+0002c500: 6c65 5f64 696d 2c29 202b 2073 7461 636b  le_dim,) + stack
+0002c510: 696e 675f 6469 6d73 7d29 0a20 2020 2020  ing_dims}).     
+0002c520: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0002c530: 2020 2320 636f 6e63 6174 656e 6174 6520    # concatenate 
+0002c540: 7468 6520 6172 7261 7973 0a20 2020 2020  the arrays.     
+0002c550: 2020 2073 7461 636b 6162 6c65 5f76 6172     stackable_var
+0002c560: 7320 3d20 5b65 6e73 7572 655f 7374 6163  s = [ensure_stac
+0002c570: 6b61 626c 6528 7365 6c66 5b6b 6579 5d29  kable(self[key])
+0002c580: 2066 6f72 206b 6579 2069 6e20 7365 6c66   for key in self
+0002c590: 2e64 6174 615f 7661 7273 5d0a 2020 2020  .data_vars].    
+0002c5a0: 2020 2020 6461 7461 5f61 7272 6179 203d      data_array =
+0002c5b0: 2063 6f6e 6361 7428 7374 6163 6b61 626c   concat(stackabl
+0002c5c0: 655f 7661 7273 2c20 6469 6d3d 6e65 775f  e_vars, dim=new_
+0002c5d0: 6469 6d29 0a0a 2020 2020 2020 2020 6966  dim)..        if
+0002c5e0: 206e 616d 6520 6973 206e 6f74 204e 6f6e   name is not Non
+0002c5f0: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+0002c600: 6174 615f 6172 7261 792e 6e61 6d65 203d  ata_array.name =
+0002c610: 206e 616d 650a 0a20 2020 2020 2020 2072   name..        r
+0002c620: 6574 7572 6e20 6461 7461 5f61 7272 6179  eturn data_array
+0002c630: 0a0a 2020 2020 6465 6620 5f75 6e73 7461  ..    def _unsta
+0002c640: 636b 5f6f 6e63 6528 0a20 2020 2020 2020  ck_once(.       
+0002c650: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
+0002c660: 2c0a 2020 2020 2020 2020 6469 6d3a 2048  ,.        dim: H
+0002c670: 6173 6861 626c 652c 0a20 2020 2020 2020  ashable,.       
+0002c680: 2069 6e64 6578 5f61 6e64 5f76 6172 733a   index_and_vars:
+0002c690: 2074 7570 6c65 5b49 6e64 6578 2c20 6469   tuple[Index, di
+0002c6a0: 6374 5b48 6173 6861 626c 652c 2056 6172  ct[Hashable, Var
+0002c6b0: 6961 626c 655d 5d2c 0a20 2020 2020 2020  iable]],.       
+0002c6c0: 2066 696c 6c5f 7661 6c75 652c 0a20 2020   fill_value,.   
+0002c6d0: 2020 2020 2073 7061 7273 653a 2062 6f6f       sparse: boo
+0002c6e0: 6c20 3d20 4661 6c73 652c 0a20 2020 2029  l = False,.    )
+0002c6f0: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+0002c700: 2020 2020 2020 2069 6e64 6578 2c20 696e         index, in
+0002c710: 6465 785f 7661 7273 203d 2069 6e64 6578  dex_vars = index
+0002c720: 5f61 6e64 5f76 6172 730a 2020 2020 2020  _and_vars.      
+0002c730: 2020 7661 7269 6162 6c65 733a 2064 6963    variables: dic
+0002c740: 745b 4861 7368 6162 6c65 2c20 5661 7269  t[Hashable, Vari
+0002c750: 6162 6c65 5d20 3d20 7b7d 0a20 2020 2020  able] = {}.     
+0002c760: 2020 2069 6e64 6578 6573 203d 207b 6b3a     indexes = {k:
+0002c770: 2076 2066 6f72 206b 2c20 7620 696e 2073   v for k, v in s
+0002c780: 656c 662e 5f69 6e64 6578 6573 2e69 7465  elf._indexes.ite
+0002c790: 6d73 2829 2069 6620 6b20 213d 2064 696d  ms() if k != dim
+0002c7a0: 7d0a 0a20 2020 2020 2020 206e 6577 5f69  }..        new_i
+0002c7b0: 6e64 6578 6573 2c20 636c 6561 6e5f 696e  ndexes, clean_in
+0002c7c0: 6465 7820 3d20 696e 6465 782e 756e 7374  dex = index.unst
+0002c7d0: 6163 6b28 290a 2020 2020 2020 2020 696e  ack().        in
+0002c7e0: 6465 7865 732e 7570 6461 7465 286e 6577  dexes.update(new
+0002c7f0: 5f69 6e64 6578 6573 290a 0a20 2020 2020  _indexes)..     
+0002c800: 2020 2066 6f72 206e 616d 652c 2069 6478     for name, idx
+0002c810: 2069 6e20 6e65 775f 696e 6465 7865 732e   in new_indexes.
+0002c820: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0002c830: 2020 2020 2076 6172 6961 626c 6573 2e75       variables.u
+0002c840: 7064 6174 6528 6964 782e 6372 6561 7465  pdate(idx.create
+0002c850: 5f76 6172 6961 626c 6573 2869 6e64 6578  _variables(index
+0002c860: 5f76 6172 7329 290a 0a20 2020 2020 2020  _vars))..       
+0002c870: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
+0002c880: 6e20 7365 6c66 2e76 6172 6961 626c 6573  n self.variables
+0002c890: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+0002c8a0: 2020 2020 2020 6966 206e 616d 6520 6e6f        if name no
+0002c8b0: 7420 696e 2069 6e64 6578 5f76 6172 733a  t in index_vars:
+0002c8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c8d0: 2069 6620 6469 6d20 696e 2076 6172 2e64   if dim in var.d
+0002c8e0: 696d 733a 0a20 2020 2020 2020 2020 2020  ims:.           
+0002c8f0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0002c900: 7374 616e 6365 2866 696c 6c5f 7661 6c75  stance(fill_valu
+0002c910: 652c 204d 6170 7069 6e67 293a 0a20 2020  e, Mapping):.   
+0002c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c930: 2020 2020 2066 696c 6c5f 7661 6c75 655f       fill_value_
+0002c940: 203d 2066 696c 6c5f 7661 6c75 655b 6e61   = fill_value[na
+0002c950: 6d65 5d0a 2020 2020 2020 2020 2020 2020  me].            
+0002c960: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c980: 2020 2020 2020 6669 6c6c 5f76 616c 7565        fill_value
+0002c990: 5f20 3d20 6669 6c6c 5f76 616c 7565 0a0a  _ = fill_value..
+0002c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9b0: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
+0002c9c0: 6d65 5d20 3d20 7661 722e 5f75 6e73 7461  me] = var._unsta
+0002c9d0: 636b 5f6f 6e63 6528 0a20 2020 2020 2020  ck_once(.       
+0002c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9f0: 2069 6e64 6578 3d63 6c65 616e 5f69 6e64   index=clean_ind
+0002ca00: 6578 2c0a 2020 2020 2020 2020 2020 2020  ex,.            
+0002ca10: 2020 2020 2020 2020 2020 2020 6469 6d3d              dim=
+0002ca20: 6469 6d2c 0a20 2020 2020 2020 2020 2020  dim,.           
+0002ca30: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0002ca40: 6c5f 7661 6c75 653d 6669 6c6c 5f76 616c  l_value=fill_val
+0002ca50: 7565 5f2c 0a20 2020 2020 2020 2020 2020  ue_,.           
+0002ca60: 2020 2020 2020 2020 2020 2020 2073 7061               spa
+0002ca70: 7273 653d 7370 6172 7365 2c0a 2020 2020  rse=sparse,.    
+0002ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002caa0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002cab0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+0002cac0: 6162 6c65 735b 6e61 6d65 5d20 3d20 7661  ables[name] = va
+0002cad0: 720a 0a20 2020 2020 2020 2063 6f6f 7264  r..        coord
+0002cae0: 5f6e 616d 6573 203d 2073 6574 2873 656c  _names = set(sel
+0002caf0: 662e 5f63 6f6f 7264 5f6e 616d 6573 2920  f._coord_names) 
+0002cb00: 2d20 7b64 696d 7d20 7c20 7365 7428 6e65  - {dim} | set(ne
+0002cb10: 775f 696e 6465 7865 7329 0a0a 2020 2020  w_indexes)..    
+0002cb20: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0002cb30: 5f72 6570 6c61 6365 5f77 6974 685f 6e65  _replace_with_ne
+0002cb40: 775f 6469 6d73 280a 2020 2020 2020 2020  w_dims(.        
+0002cb50: 2020 2020 7661 7269 6162 6c65 732c 2063      variables, c
+0002cb60: 6f6f 7264 5f6e 616d 6573 3d63 6f6f 7264  oord_names=coord
+0002cb70: 5f6e 616d 6573 2c20 696e 6465 7865 733d  _names, indexes=
+0002cb80: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
+0002cb90: 290a 0a20 2020 2064 6566 205f 756e 7374  )..    def _unst
+0002cba0: 6163 6b5f 6675 6c6c 5f72 6569 6e64 6578  ack_full_reindex
+0002cbb0: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+0002cbc0: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
+0002cbd0: 2020 2064 696d 3a20 4861 7368 6162 6c65     dim: Hashable
+0002cbe0: 2c0a 2020 2020 2020 2020 696e 6465 785f  ,.        index_
+0002cbf0: 616e 645f 7661 7273 3a20 7475 706c 655b  and_vars: tuple[
+0002cc00: 496e 6465 782c 2064 6963 745b 4861 7368  Index, dict[Hash
+0002cc10: 6162 6c65 2c20 5661 7269 6162 6c65 5d5d  able, Variable]]
+0002cc20: 2c0a 2020 2020 2020 2020 6669 6c6c 5f76  ,.        fill_v
+0002cc30: 616c 7565 2c0a 2020 2020 2020 2020 7370  alue,.        sp
+0002cc40: 6172 7365 3a20 626f 6f6c 2c0a 2020 2020  arse: bool,.    
+0002cc50: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0002cc60: 2020 2020 2020 2020 696e 6465 782c 2069          index, i
+0002cc70: 6e64 6578 5f76 6172 7320 3d20 696e 6465  ndex_vars = inde
+0002cc80: 785f 616e 645f 7661 7273 0a20 2020 2020  x_and_vars.     
+0002cc90: 2020 2076 6172 6961 626c 6573 3a20 6469     variables: di
+0002cca0: 6374 5b48 6173 6861 626c 652c 2056 6172  ct[Hashable, Var
+0002ccb0: 6961 626c 655d 203d 207b 7d0a 2020 2020  iable] = {}.    
+0002ccc0: 2020 2020 696e 6465 7865 7320 3d20 7b6b      indexes = {k
+0002ccd0: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+0002cce0: 7365 6c66 2e5f 696e 6465 7865 732e 6974  self._indexes.it
+0002ccf0: 656d 7328 2920 6966 206b 2021 3d20 6469  ems() if k != di
+0002cd00: 6d7d 0a0a 2020 2020 2020 2020 6e65 775f  m}..        new_
+0002cd10: 696e 6465 7865 732c 2063 6c65 616e 5f69  indexes, clean_i
+0002cd20: 6e64 6578 203d 2069 6e64 6578 2e75 6e73  ndex = index.uns
+0002cd30: 7461 636b 2829 0a20 2020 2020 2020 2069  tack().        i
+0002cd40: 6e64 6578 6573 2e75 7064 6174 6528 6e65  ndexes.update(ne
+0002cd50: 775f 696e 6465 7865 7329 0a0a 2020 2020  w_indexes)..    
+0002cd60: 2020 2020 6e65 775f 696e 6465 785f 7661      new_index_va
+0002cd70: 7269 6162 6c65 7320 3d20 7b7d 0a20 2020  riables = {}.   
+0002cd80: 2020 2020 2066 6f72 206e 616d 652c 2069       for name, i
+0002cd90: 6478 2069 6e20 6e65 775f 696e 6465 7865  dx in new_indexe
+0002cda0: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+0002cdb0: 2020 2020 2020 206e 6577 5f69 6e64 6578         new_index
+0002cdc0: 5f76 6172 6961 626c 6573 2e75 7064 6174  _variables.updat
+0002cdd0: 6528 6964 782e 6372 6561 7465 5f76 6172  e(idx.create_var
+0002cde0: 6961 626c 6573 2869 6e64 6578 5f76 6172  iables(index_var
+0002cdf0: 7329 290a 0a20 2020 2020 2020 206e 6577  s))..        new
+0002ce00: 5f64 696d 5f73 697a 6573 203d 207b 6b3a  _dim_sizes = {k:
+0002ce10: 2076 2e73 697a 6520 666f 7220 6b2c 2076   v.size for k, v
+0002ce20: 2069 6e20 6e65 775f 696e 6465 785f 7661   in new_index_va
+0002ce30: 7269 6162 6c65 732e 6974 656d 7328 297d  riables.items()}
+0002ce40: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+0002ce50: 6573 2e75 7064 6174 6528 6e65 775f 696e  es.update(new_in
+0002ce60: 6465 785f 7661 7269 6162 6c65 7329 0a0a  dex_variables)..
+0002ce70: 2020 2020 2020 2020 2320 7461 6b65 2061          # take a
+0002ce80: 2073 686f 7274 6375 7420 696e 2063 6173   shortcut in cas
+0002ce90: 6520 7468 6520 4d75 6c74 6949 6e64 6578  e the MultiIndex
+0002cea0: 2077 6173 206e 6f74 206d 6f64 6966 6965   was not modifie
+0002ceb0: 642e 0a20 2020 2020 2020 2066 756c 6c5f  d..        full_
+0002cec0: 6964 7820 3d20 7064 2e4d 756c 7469 496e  idx = pd.MultiIn
+0002ced0: 6465 782e 6672 6f6d 5f70 726f 6475 6374  dex.from_product
+0002cee0: 280a 2020 2020 2020 2020 2020 2020 636c  (.            cl
+0002cef0: 6561 6e5f 696e 6465 782e 6c65 7665 6c73  ean_index.levels
+0002cf00: 2c20 6e61 6d65 733d 636c 6561 6e5f 696e  , names=clean_in
+0002cf10: 6465 782e 6e61 6d65 730a 2020 2020 2020  dex.names.      
+0002cf20: 2020 290a 2020 2020 2020 2020 6966 2063    ).        if c
+0002cf30: 6c65 616e 5f69 6e64 6578 2e65 7175 616c  lean_index.equal
+0002cf40: 7328 6675 6c6c 5f69 6478 293a 0a20 2020  s(full_idx):.   
+0002cf50: 2020 2020 2020 2020 206f 626a 203d 2073           obj = s
+0002cf60: 656c 660a 2020 2020 2020 2020 656c 7365  elf.        else
+0002cf70: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0002cf80: 544f 444f 3a20 7765 206d 6179 2064 6570  TODO: we may dep
+0002cf90: 7265 6369 6174 6520 696d 706c 6963 6974  reciate implicit
+0002cfa0: 2072 652d 696e 6465 7869 6e67 2077 6974   re-indexing wit
+0002cfb0: 6820 6120 7061 6e64 6173 2e4d 756c 7469  h a pandas.Multi
+0002cfc0: 496e 6465 780a 2020 2020 2020 2020 2020  Index.          
+0002cfd0: 2020 7872 5f66 756c 6c5f 6964 7820 3d20    xr_full_idx = 
+0002cfe0: 5061 6e64 6173 4d75 6c74 6949 6e64 6578  PandasMultiIndex
+0002cff0: 2866 756c 6c5f 6964 782c 2064 696d 290a  (full_idx, dim).
+0002d000: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+0002d010: 7865 7273 203d 2049 6e64 6578 6573 280a  xers = Indexes(.
+0002d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d030: 7b6b 3a20 7872 5f66 756c 6c5f 6964 7820  {k: xr_full_idx 
+0002d040: 666f 7220 6b20 696e 2069 6e64 6578 5f76  for k in index_v
+0002d050: 6172 737d 2c0a 2020 2020 2020 2020 2020  ars},.          
+0002d060: 2020 2020 2020 7872 5f66 756c 6c5f 6964        xr_full_id
+0002d070: 782e 6372 6561 7465 5f76 6172 6961 626c  x.create_variabl
+0002d080: 6573 2869 6e64 6578 5f76 6172 7329 2c0a  es(index_vars),.
+0002d090: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0002d0a0: 2020 2020 2020 2020 2020 6f62 6a20 3d20            obj = 
+0002d0b0: 7365 6c66 2e5f 7265 696e 6465 7828 0a20  self._reindex(. 
+0002d0c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002d0d0: 6e64 6578 6572 732c 2063 6f70 793d 4661  ndexers, copy=Fa
+0002d0e0: 6c73 652c 2066 696c 6c5f 7661 6c75 653d  lse, fill_value=
+0002d0f0: 6669 6c6c 5f76 616c 7565 2c20 7370 6172  fill_value, spar
+0002d100: 7365 3d73 7061 7273 650a 2020 2020 2020  se=sparse.      
+0002d110: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0002d120: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
+0002d130: 6e20 6f62 6a2e 7661 7269 6162 6c65 732e  n obj.variables.
+0002d140: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0002d150: 2020 2020 2069 6620 6e61 6d65 206e 6f74       if name not
+0002d160: 2069 6e20 696e 6465 785f 7661 7273 3a0a   in index_vars:.
+0002d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d180: 6966 2064 696d 2069 6e20 7661 722e 6469  if dim in var.di
+0002d190: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0002d1a0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+0002d1b0: 735b 6e61 6d65 5d20 3d20 7661 722e 756e  s[name] = var.un
+0002d1c0: 7374 6163 6b28 7b64 696d 3a20 6e65 775f  stack({dim: new_
+0002d1d0: 6469 6d5f 7369 7a65 737d 290a 2020 2020  dim_sizes}).    
+0002d1e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002d1f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d200: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
+0002d210: 6e61 6d65 5d20 3d20 7661 720a 0a20 2020  name] = var..   
+0002d220: 2020 2020 2063 6f6f 7264 5f6e 616d 6573       coord_names
+0002d230: 203d 2073 6574 2873 656c 662e 5f63 6f6f   = set(self._coo
+0002d240: 7264 5f6e 616d 6573 2920 2d20 7b64 696d  rd_names) - {dim
+0002d250: 7d20 7c20 7365 7428 6e65 775f 6469 6d5f  } | set(new_dim_
+0002d260: 7369 7a65 7329 0a0a 2020 2020 2020 2020  sizes)..        
+0002d270: 7265 7475 726e 2073 656c 662e 5f72 6570  return self._rep
+0002d280: 6c61 6365 5f77 6974 685f 6e65 775f 6469  lace_with_new_di
+0002d290: 6d73 280a 2020 2020 2020 2020 2020 2020  ms(.            
+0002d2a0: 7661 7269 6162 6c65 732c 2063 6f6f 7264  variables, coord
+0002d2b0: 5f6e 616d 6573 3d63 6f6f 7264 5f6e 616d  _names=coord_nam
+0002d2c0: 6573 2c20 696e 6465 7865 733d 696e 6465  es, indexes=inde
+0002d2d0: 7865 730a 2020 2020 2020 2020 290a 0a20  xes.        ).. 
+0002d2e0: 2020 2064 6566 2075 6e73 7461 636b 280a     def unstack(.
+0002d2f0: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
+0002d300: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
+0002d310: 2064 696d 3a20 4469 6d73 203d 204e 6f6e   dim: Dims = Non
+0002d320: 652c 0a20 2020 2020 2020 2066 696c 6c5f  e,.        fill_
+0002d330: 7661 6c75 653a 2041 6e79 203d 2078 7264  value: Any = xrd
+0002d340: 7479 7065 732e 4e41 2c0a 2020 2020 2020  types.NA,.      
+0002d350: 2020 7370 6172 7365 3a20 626f 6f6c 203d    sparse: bool =
+0002d360: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
+0002d370: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+0002d380: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0002d390: 556e 7374 6163 6b20 6578 6973 7469 6e67  Unstack existing
+0002d3a0: 2064 696d 656e 7369 6f6e 7320 636f 7272   dimensions corr
+0002d3b0: 6573 706f 6e64 696e 6720 746f 204d 756c  esponding to Mul
+0002d3c0: 7469 496e 6465 7865 7320 696e 746f 0a20  tiIndexes into. 
+0002d3d0: 2020 2020 2020 206d 756c 7469 706c 6520         multiple 
+0002d3e0: 6e65 7720 6469 6d65 6e73 696f 6e73 2e0a  new dimensions..
+0002d3f0: 0a20 2020 2020 2020 204e 6577 2064 696d  .        New dim
+0002d400: 656e 7369 6f6e 7320 7769 6c6c 2062 6520  ensions will be 
+0002d410: 6164 6465 6420 6174 2074 6865 2065 6e64  added at the end
+0002d420: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0002d430: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0002d440: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0002d450: 2064 696d 203a 2073 7472 2c20 4974 6572   dim : str, Iter
+0002d460: 6162 6c65 206f 6620 4861 7368 6162 6c65  able of Hashable
+0002d470: 206f 7220 4e6f 6e65 2c20 6f70 7469 6f6e   or None, option
+0002d480: 616c 0a20 2020 2020 2020 2020 2020 2044  al.            D
+0002d490: 696d 656e 7369 6f6e 2873 2920 6f76 6572  imension(s) over
+0002d4a0: 2077 6869 6368 2074 6f20 756e 7374 6163   which to unstac
+0002d4b0: 6b2e 2042 7920 6465 6661 756c 7420 756e  k. By default un
+0002d4c0: 7374 6163 6b73 2061 6c6c 0a20 2020 2020  stacks all.     
+0002d4d0: 2020 2020 2020 204d 756c 7469 496e 6465         MultiInde
+0002d4e0: 7865 732e 0a20 2020 2020 2020 2066 696c  xes..        fil
+0002d4f0: 6c5f 7661 6c75 6520 3a20 7363 616c 6172  l_value : scalar
+0002d500: 206f 7220 6469 6374 2d6c 696b 652c 2064   or dict-like, d
+0002d510: 6566 6175 6c74 3a20 6e61 6e0a 2020 2020  efault: nan.    
+0002d520: 2020 2020 2020 2020 7661 6c75 6520 746f          value to
+0002d530: 2062 6520 6669 6c6c 6564 2e20 4966 2061   be filled. If a
+0002d540: 2064 6963 742d 6c69 6b65 2c20 6d61 7073   dict-like, maps
+0002d550: 2076 6172 6961 626c 6520 6e61 6d65 7320   variable names 
+0002d560: 746f 0a20 2020 2020 2020 2020 2020 2066  to.            f
+0002d570: 696c 6c20 7661 6c75 6573 2e20 4966 206e  ill values. If n
+0002d580: 6f74 2070 726f 7669 6465 6420 6f72 2069  ot provided or i
+0002d590: 6620 7468 6520 6469 6374 2d6c 696b 6520  f the dict-like 
+0002d5a0: 646f 6573 206e 6f74 0a20 2020 2020 2020  does not.       
+0002d5b0: 2020 2020 2063 6f6e 7461 696e 2061 6c6c       contain all
+0002d5c0: 2076 6172 6961 626c 6573 2c20 7468 6520   variables, the 
+0002d5d0: 6474 7970 6527 7320 4e41 2076 616c 7565  dtype's NA value
+0002d5e0: 2077 696c 6c20 6265 2075 7365 642e 0a20   will be used.. 
+0002d5f0: 2020 2020 2020 2073 7061 7273 6520 3a20         sparse : 
+0002d600: 626f 6f6c 2c20 6465 6661 756c 743a 2046  bool, default: F
+0002d610: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0002d620: 2075 7365 2073 7061 7273 652d 6172 7261   use sparse-arra
+0002d630: 7920 6966 2054 7275 650a 0a20 2020 2020  y if True..     
+0002d640: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+0002d650: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+0002d660: 2020 2075 6e73 7461 636b 6564 203a 2044     unstacked : D
+0002d670: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+0002d680: 2020 2044 6174 6173 6574 2077 6974 6820     Dataset with 
+0002d690: 756e 7374 6163 6b65 6420 6461 7461 2e0a  unstacked data..
+0002d6a0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+0002d6b0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+0002d6c0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
+0002d6d0: 6574 2e73 7461 636b 0a20 2020 2020 2020  et.stack.       
+0002d6e0: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
+0002d6f0: 2064 696d 2069 7320 4e6f 6e65 3a0a 2020   dim is None:.  
+0002d700: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
+0002d710: 206c 6973 7428 7365 6c66 2e64 696d 7329   list(self.dims)
+0002d720: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0002d730: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0002d740: 696e 7374 616e 6365 2864 696d 2c20 7374  instance(dim, st
+0002d750: 7229 206f 7220 6e6f 7420 6973 696e 7374  r) or not isinst
+0002d760: 616e 6365 2864 696d 2c20 4974 6572 6162  ance(dim, Iterab
+0002d770: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+0002d780: 2020 2020 2064 696d 7320 3d20 5b64 696d       dims = [dim
+0002d790: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+0002d7a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002d7b0: 2020 2020 6469 6d73 203d 206c 6973 7428      dims = list(
+0002d7c0: 6469 6d29 0a0a 2020 2020 2020 2020 2020  dim)..          
+0002d7d0: 2020 6d69 7373 696e 675f 6469 6d73 203d    missing_dims =
+0002d7e0: 205b 6420 666f 7220 6420 696e 2064 696d   [d for d in dim
+0002d7f0: 7320 6966 2064 206e 6f74 2069 6e20 7365  s if d not in se
+0002d800: 6c66 2e64 696d 735d 0a20 2020 2020 2020  lf.dims].       
+0002d810: 2020 2020 2069 6620 6d69 7373 696e 675f       if missing_
+0002d820: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
+0002d830: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0002d840: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0002d850: 2020 2020 2020 2020 2020 2020 6622 4461              f"Da
+0002d860: 7461 7365 7420 646f 6573 206e 6f74 2063  taset does not c
+0002d870: 6f6e 7461 696e 2074 6865 2064 696d 656e  ontain the dimen
+0002d880: 7369 6f6e 733a 207b 6d69 7373 696e 675f  sions: {missing_
+0002d890: 6469 6d73 7d22 0a20 2020 2020 2020 2020  dims}".         
+0002d8a0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0002d8b0: 2020 2320 6561 6368 2073 7065 6369 6669    # each specifi
+0002d8c0: 6564 2064 696d 656e 7369 6f6e 206d 7573  ed dimension mus
+0002d8d0: 7420 6861 7665 2065 7861 6374 6c79 206f  t have exactly o
+0002d8e0: 6e65 206d 756c 7469 2d69 6e64 6578 0a20  ne multi-index. 
+0002d8f0: 2020 2020 2020 2073 7461 636b 6564 5f69         stacked_i
+0002d900: 6e64 6578 6573 3a20 6469 6374 5b41 6e79  ndexes: dict[Any
+0002d910: 2c20 7475 706c 655b 496e 6465 782c 2064  , tuple[Index, d
+0002d920: 6963 745b 4861 7368 6162 6c65 2c20 5661  ict[Hashable, Va
+0002d930: 7269 6162 6c65 5d5d 5d20 3d20 7b7d 0a20  riable]]] = {}. 
+0002d940: 2020 2020 2020 2066 6f72 2064 2069 6e20         for d in 
+0002d950: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
+0002d960: 2020 6964 782c 2069 6478 5f76 6172 7320    idx, idx_vars 
+0002d970: 3d20 7365 6c66 2e5f 6765 745f 7374 6163  = self._get_stac
+0002d980: 6b5f 696e 6465 7828 642c 206d 756c 7469  k_index(d, multi
+0002d990: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+0002d9a0: 2020 2069 6620 6964 7820 6973 206e 6f74     if idx is not
+0002d9b0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0002d9c0: 2020 2020 2020 2073 7461 636b 6564 5f69         stacked_i
+0002d9d0: 6e64 6578 6573 5b64 5d20 3d20 6964 782c  ndexes[d] = idx,
+0002d9e0: 2069 6478 5f76 6172 730a 0a20 2020 2020   idx_vars..     
+0002d9f0: 2020 2069 6620 6469 6d20 6973 204e 6f6e     if dim is Non
+0002da00: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+0002da10: 696d 7320 3d20 6c69 7374 2873 7461 636b  ims = list(stack
+0002da20: 6564 5f69 6e64 6578 6573 290a 2020 2020  ed_indexes).    
+0002da30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002da40: 2020 2020 2020 6e6f 6e5f 6d75 6c74 695f        non_multi_
+0002da50: 6469 6d73 203d 2073 6574 2864 696d 7329  dims = set(dims)
+0002da60: 202d 2073 6574 2873 7461 636b 6564 5f69   - set(stacked_i
+0002da70: 6e64 6578 6573 290a 2020 2020 2020 2020  ndexes).        
+0002da80: 2020 2020 6966 206e 6f6e 5f6d 756c 7469      if non_multi
+0002da90: 5f64 696d 733a 0a20 2020 2020 2020 2020  _dims:.         
+0002daa0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0002dab0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+0002dac0: 2020 2020 2020 2020 2020 2020 2022 6361               "ca
+0002dad0: 6e6e 6f74 2075 6e73 7461 636b 2064 696d  nnot unstack dim
+0002dae0: 656e 7369 6f6e 7320 7468 6174 2064 6f20  ensions that do 
+0002daf0: 6e6f 7420 220a 2020 2020 2020 2020 2020  not ".          
+0002db00: 2020 2020 2020 2020 2020 6622 6861 7665            f"have
+0002db10: 2065 7861 6374 6c79 206f 6e65 206d 756c   exactly one mul
+0002db20: 7469 2d69 6e64 6578 3a20 7b74 7570 6c65  ti-index: {tuple
+0002db30: 286e 6f6e 5f6d 756c 7469 5f64 696d 7329  (non_multi_dims)
+0002db40: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0002db50: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
+0002db60: 7375 6c74 203d 2073 656c 662e 636f 7079  sult = self.copy
+0002db70: 2864 6565 703d 4661 6c73 6529 0a0a 2020  (deep=False)..  
+0002db80: 2020 2020 2020 2320 7765 2077 616e 7420        # we want 
+0002db90: 746f 2061 766f 6964 2061 6c6c 6f63 6174  to avoid allocat
+0002dba0: 696e 6720 616e 206f 626a 6563 742d 6474  ing an object-dt
+0002dbb0: 7970 6520 6e64 6172 7261 7920 666f 7220  ype ndarray for 
+0002dbc0: 6120 4d75 6c74 6949 6e64 6578 2c0a 2020  a MultiIndex,.  
+0002dbd0: 2020 2020 2020 2320 736f 2077 6520 6361        # so we ca
+0002dbe0: 6e27 7420 6a75 7374 2061 6363 6573 7320  n't just access 
+0002dbf0: 7365 6c66 2e76 6172 6961 626c 6573 5b76  self.variables[v
+0002dc00: 5d2e 6461 7461 2066 6f72 2065 7665 7279  ].data for every
+0002dc10: 2076 6172 6961 626c 652e 0a20 2020 2020   variable..     
+0002dc20: 2020 2023 2057 6520 6f6e 6c79 2063 6865     # We only che
+0002dc30: 636b 2074 6865 206e 6f6e 2d69 6e64 6578  ck the non-index
+0002dc40: 2076 6172 6961 626c 6573 2e0a 2020 2020   variables..    
+0002dc50: 2020 2020 2320 6874 7470 733a 2f2f 6769      # https://gi
+0002dc60: 7468 7562 2e63 6f6d 2f70 7964 6174 612f  thub.com/pydata/
+0002dc70: 7861 7272 6179 2f69 7373 7565 732f 3539  xarray/issues/59
+0002dc80: 3032 0a20 2020 2020 2020 206e 6f6e 696e  02.        nonin
+0002dc90: 6465 7865 7320 3d20 5b0a 2020 2020 2020  dexes = [.      
+0002dca0: 2020 2020 2020 7365 6c66 2e76 6172 6961        self.varia
+0002dcb0: 626c 6573 5b6b 5d20 666f 7220 6b20 696e  bles[k] for k in
+0002dcc0: 2073 6574 2873 656c 662e 7661 7269 6162   set(self.variab
+0002dcd0: 6c65 7329 202d 2073 6574 2873 656c 662e  les) - set(self.
+0002dce0: 5f69 6e64 6578 6573 290a 2020 2020 2020  _indexes).      
+0002dcf0: 2020 5d0a 2020 2020 2020 2020 2320 4e6f    ].        # No
+0002dd00: 7465 7320 666f 7220 6561 6368 206f 6620  tes for each of 
+0002dd10: 7468 6573 6520 6361 7365 733a 0a20 2020  these cases:.   
+0002dd20: 2020 2020 2023 2031 2e20 4461 736b 2061       # 1. Dask a
+0002dd30: 7272 6179 7320 646f 6e27 7420 7375 7070  rrays don't supp
+0002dd40: 6f72 7420 6173 7369 676e 6d65 6e74 2062  ort assignment b
+0002dd50: 7920 696e 6465 782c 2077 6869 6368 2074  y index, which t
+0002dd60: 6865 2066 6173 7420 756e 7374 6163 6b0a  he fast unstack.
+0002dd70: 2020 2020 2020 2020 2320 2020 2066 756e          #    fun
+0002dd80: 6374 696f 6e20 7265 7175 6972 6573 2e0a  ction requires..
+0002dd90: 2020 2020 2020 2020 2320 2020 2068 7474          #    htt
+0002dda0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+0002ddb0: 7079 6461 7461 2f78 6172 7261 792f 7075  pydata/xarray/pu
+0002ddc0: 6c6c 2f34 3734 3623 6973 7375 6563 6f6d  ll/4746#issuecom
+0002ddd0: 6d65 6e74 2d37 3533 3238 3231 3235 0a20  ment-753282125. 
+0002dde0: 2020 2020 2020 2023 2032 2e20 5370 6172         # 2. Spar
+0002ddf0: 7365 2064 6f65 736e 2774 2063 7572 7265  se doesn't curre
+0002de00: 6e74 6c79 2073 7570 706f 7274 2028 7468  ntly support (th
+0002de10: 6f75 6768 2077 6520 636f 756c 6420 7370  ough we could sp
+0002de20: 6563 6961 6c2d 6361 7365 2069 7429 0a20  ecial-case it). 
+0002de30: 2020 2020 2020 2023 2020 2020 6874 7470         #    http
+0002de40: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
+0002de50: 7964 6174 612f 7370 6172 7365 2f69 7373  ydata/sparse/iss
+0002de60: 7565 732f 3432 320a 2020 2020 2020 2020  ues/422.        
+0002de70: 2320 332e 2070 696e 7420 7265 7175 6972  # 3. pint requir
+0002de80: 6573 2063 6865 636b 696e 6720 6966 2069  es checking if i
+0002de90: 7427 7320 6120 4e75 6d50 7920 6172 7261  t's a NumPy arra
+0002dea0: 7920 756e 7469 6c0a 2020 2020 2020 2020  y until.        
+0002deb0: 2320 2020 2068 7474 7073 3a2f 2f67 6974  #    https://git
+0002dec0: 6875 622e 636f 6d2f 7079 6461 7461 2f78  hub.com/pydata/x
+0002ded0: 6172 7261 792f 7075 6c6c 2f34 3735 3120  array/pull/4751 
+0002dee0: 6973 2072 6573 6f6c 7665 642c 0a20 2020  is resolved,.   
+0002def0: 2020 2020 2023 2020 2020 4f6e 6365 2074       #    Once t
+0002df00: 6861 7420 6973 2072 6573 6f6c 7665 642c  hat is resolved,
+0002df10: 2065 7870 6c69 6369 746c 7920 6578 636c   explicitly excl
+0002df20: 7564 6520 7069 6e74 2061 7272 6179 732e  ude pint arrays.
+0002df30: 0a20 2020 2020 2020 2023 2020 2020 7069  .        #    pi
+0002df40: 6e74 2064 6f65 736e 2774 2069 6d70 6c65  nt doesn't imple
+0002df50: 6d65 6e74 2060 6e70 2e66 756c 6c5f 6c69  ment `np.full_li
+0002df60: 6b65 6020 696e 2061 2077 6179 2074 6861  ke` in a way tha
+0002df70: 7427 730a 2020 2020 2020 2020 2320 2020  t's.        #   
+0002df80: 2063 7572 7265 6e74 6c79 2063 6f6d 7061   currently compa
+0002df90: 7469 626c 652e 0a20 2020 2020 2020 2073  tible..        s
+0002dfa0: 7061 7273 655f 6172 7261 795f 7479 7065  parse_array_type
+0002dfb0: 203d 2061 7272 6179 5f74 7970 6528 2273   = array_type("s
+0002dfc0: 7061 7273 6522 290a 2020 2020 2020 2020  parse").        
+0002dfd0: 6e65 6564 735f 6675 6c6c 5f72 6569 6e64  needs_full_reind
+0002dfe0: 6578 203d 2061 6e79 280a 2020 2020 2020  ex = any(.      
+0002dff0: 2020 2020 2020 6973 5f64 7563 6b5f 6461        is_duck_da
+0002e000: 736b 5f61 7272 6179 2876 2e64 6174 6129  sk_array(v.data)
+0002e010: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+0002e020: 6973 696e 7374 616e 6365 2876 2e64 6174  isinstance(v.dat
+0002e030: 612c 2073 7061 7273 655f 6172 7261 795f  a, sparse_array_
+0002e040: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
+0002e050: 2020 6f72 206e 6f74 2069 7369 6e73 7461    or not isinsta
+0002e060: 6e63 6528 762e 6461 7461 2c20 6e70 2e6e  nce(v.data, np.n
+0002e070: 6461 7272 6179 290a 2020 2020 2020 2020  darray).        
+0002e080: 2020 2020 666f 7220 7620 696e 206e 6f6e      for v in non
+0002e090: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
+0002e0a0: 290a 0a20 2020 2020 2020 2066 6f72 2064  )..        for d
+0002e0b0: 2069 6e20 6469 6d73 3a0a 2020 2020 2020   in dims:.      
+0002e0c0: 2020 2020 2020 6966 206e 6565 6473 5f66        if needs_f
+0002e0d0: 756c 6c5f 7265 696e 6465 783a 0a20 2020  ull_reindex:.   
+0002e0e0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0002e0f0: 756c 7420 3d20 7265 7375 6c74 2e5f 756e  ult = result._un
+0002e100: 7374 6163 6b5f 6675 6c6c 5f72 6569 6e64  stack_full_reind
+0002e110: 6578 280a 2020 2020 2020 2020 2020 2020  ex(.            
+0002e120: 2020 2020 2020 2020 642c 2073 7461 636b          d, stack
+0002e130: 6564 5f69 6e64 6578 6573 5b64 5d2c 2066  ed_indexes[d], f
+0002e140: 696c 6c5f 7661 6c75 652c 2073 7061 7273  ill_value, spars
+0002e150: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002e160: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0002e170: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002e180: 2020 2020 2020 7265 7375 6c74 203d 2072        result = r
+0002e190: 6573 756c 742e 5f75 6e73 7461 636b 5f6f  esult._unstack_o
+0002e1a0: 6e63 6528 642c 2073 7461 636b 6564 5f69  nce(d, stacked_i
+0002e1b0: 6e64 6578 6573 5b64 5d2c 2066 696c 6c5f  ndexes[d], fill_
+0002e1c0: 7661 6c75 652c 2073 7061 7273 6529 0a20  value, sparse). 
+0002e1d0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0002e1e0: 7375 6c74 0a0a 2020 2020 6465 6620 7570  sult..    def up
+0002e1f0: 6461 7465 2873 656c 663a 2054 5f44 6174  date(self: T_Dat
+0002e200: 6173 6574 2c20 6f74 6865 723a 2043 6f65  aset, other: Coe
+0002e210: 7263 6962 6c65 4d61 7070 696e 6729 202d  rcibleMapping) -
+0002e220: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+0002e230: 2020 2020 2022 2222 5570 6461 7465 2074       """Update t
+0002e240: 6869 7320 6461 7461 7365 7427 7320 7661  his dataset's va
+0002e250: 7269 6162 6c65 7320 7769 7468 2074 686f  riables with tho
+0002e260: 7365 2066 726f 6d20 616e 6f74 6865 7220  se from another 
+0002e270: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
+0002e280: 2020 4a75 7374 206c 696b 6520 3a70 793a    Just like :py:
+0002e290: 6d65 7468 3a60 6469 6374 2e75 7064 6174  meth:`dict.updat
+0002e2a0: 6560 2074 6869 7320 6973 2061 2069 6e2d  e` this is a in-
+0002e2b0: 706c 6163 6520 6f70 6572 6174 696f 6e2e  place operation.
+0002e2c0: 0a20 2020 2020 2020 2046 6f72 2061 206e  .        For a n
+0002e2d0: 6f6e 2d69 6e70 6c61 6365 2076 6572 7369  on-inplace versi
+0002e2e0: 6f6e 2c20 7365 6520 3a70 793a 6d65 7468  on, see :py:meth
+0002e2f0: 3a60 4461 7461 7365 742e 6d65 7267 6560  :`Dataset.merge`
+0002e300: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0002e310: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0002e320: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0002e330: 206f 7468 6572 203a 2044 6174 6173 6574   other : Dataset
+0002e340: 206f 7220 6d61 7070 696e 670a 2020 2020   or mapping.    
+0002e350: 2020 2020 2020 2020 5661 7269 6162 6c65          Variable
+0002e360: 7320 7769 7468 2077 6869 6368 2074 6f20  s with which to 
+0002e370: 7570 6461 7465 2074 6869 7320 6461 7461  update this data
+0002e380: 7365 742e 204f 6e65 206f 663a 0a0a 2020  set. One of:..  
+0002e390: 2020 2020 2020 2020 2020 2d20 4461 7461            - Data
+0002e3a0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+0002e3b0: 2d20 6d61 7070 696e 6720 7b76 6172 206e  - mapping {var n
+0002e3c0: 616d 653a 2044 6174 6141 7272 6179 7d0a  ame: DataArray}.
+0002e3d0: 2020 2020 2020 2020 2020 2020 2d20 6d61              - ma
+0002e3e0: 7070 696e 6720 7b76 6172 206e 616d 653a  pping {var name:
+0002e3f0: 2056 6172 6961 626c 657d 0a20 2020 2020   Variable}.     
+0002e400: 2020 2020 2020 202d 206d 6170 7069 6e67         - mapping
+0002e410: 207b 7661 7220 6e61 6d65 3a20 2864 696d   {var name: (dim
+0002e420: 656e 7369 6f6e 206e 616d 652c 2061 7272  ension name, arr
+0002e430: 6179 2d6c 696b 6529 7d0a 2020 2020 2020  ay-like)}.      
+0002e440: 2020 2020 2020 2d20 6d61 7070 696e 6720        - mapping 
+0002e450: 7b76 6172 206e 616d 653a 2028 7475 706c  {var name: (tupl
+0002e460: 6520 6f66 2064 696d 656e 7369 6f6e 206e  e of dimension n
+0002e470: 616d 6573 2c20 6172 7261 792d 6c69 6b65  ames, array-like
+0002e480: 297d 0a0a 2020 2020 2020 2020 5265 7475  )}..        Retu
+0002e490: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+0002e4a0: 2d2d 2d0a 2020 2020 2020 2020 7570 6461  ---.        upda
+0002e4b0: 7465 6420 3a20 4461 7461 7365 740a 2020  ted : Dataset.  
+0002e4c0: 2020 2020 2020 2020 2020 5570 6461 7465            Update
+0002e4d0: 6420 6461 7461 7365 742e 204e 6f74 6520  d dataset. Note 
+0002e4e0: 7468 6174 2073 696e 6365 2074 6865 2075  that since the u
+0002e4f0: 7064 6174 6520 6973 2069 6e2d 706c 6163  pdate is in-plac
+0002e500: 6520 7468 6973 2069 7320 7468 6520 696e  e this is the in
+0002e510: 7075 740a 2020 2020 2020 2020 2020 2020  put.            
+0002e520: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
+0002e530: 2020 2020 2020 4974 2069 7320 6465 7072        It is depr
+0002e540: 6563 6174 6564 2073 696e 6365 2076 6572  ecated since ver
+0002e550: 7369 6f6e 2030 2e31 3720 616e 6420 7363  sion 0.17 and sc
+0002e560: 6865 6475 6c65 6420 746f 2062 6520 7265  heduled to be re
+0002e570: 6d6f 7665 6420 696e 2030 2e32 312e 0a0a  moved in 0.21...
+0002e580: 2020 2020 2020 2020 5261 6973 6573 0a20          Raises. 
+0002e590: 2020 2020 2020 202d 2d2d 2d2d 2d0a 2020         ------.  
+0002e5a0: 2020 2020 2020 5661 6c75 6545 7272 6f72        ValueError
+0002e5b0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0002e5c0: 616e 7920 6469 6d65 6e73 696f 6e73 2077  any dimensions w
+0002e5d0: 6f75 6c64 2068 6176 6520 696e 636f 6e73  ould have incons
+0002e5e0: 6973 7465 6e74 2073 697a 6573 2069 6e20  istent sizes in 
+0002e5f0: 7468 6520 7570 6461 7465 640a 2020 2020  the updated.    
+0002e600: 2020 2020 2020 2020 6461 7461 7365 742e          dataset.
+0002e610: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+0002e620: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+0002e630: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
+0002e640: 7365 742e 6173 7369 676e 0a20 2020 2020  set.assign.     
+0002e650: 2020 2044 6174 6173 6574 2e6d 6572 6765     Dataset.merge
+0002e660: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0002e670: 2020 2020 206d 6572 6765 5f72 6573 756c       merge_resul
+0002e680: 7420 3d20 6461 7461 7365 745f 7570 6461  t = dataset_upda
+0002e690: 7465 5f6d 6574 686f 6428 7365 6c66 2c20  te_method(self, 
+0002e6a0: 6f74 6865 7229 0a20 2020 2020 2020 2072  other).        r
+0002e6b0: 6574 7572 6e20 7365 6c66 2e5f 7265 706c  eturn self._repl
+0002e6c0: 6163 6528 696e 706c 6163 653d 5472 7565  ace(inplace=True
+0002e6d0: 2c20 2a2a 6d65 7267 655f 7265 7375 6c74  , **merge_result
+0002e6e0: 2e5f 6173 6469 6374 2829 290a 0a20 2020  ._asdict())..   
+0002e6f0: 2064 6566 206d 6572 6765 280a 2020 2020   def merge(.    
+0002e700: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
+0002e710: 7365 742c 0a20 2020 2020 2020 206f 7468  set,.        oth
+0002e720: 6572 3a20 436f 6572 6369 626c 654d 6170  er: CoercibleMap
+0002e730: 7069 6e67 207c 2044 6174 6141 7272 6179  ping | DataArray
+0002e740: 2c0a 2020 2020 2020 2020 6f76 6572 7772  ,.        overwr
+0002e750: 6974 655f 7661 7273 3a20 4861 7368 6162  ite_vars: Hashab
+0002e760: 6c65 207c 2049 7465 7261 626c 655b 4861  le | Iterable[Ha
+0002e770: 7368 6162 6c65 5d20 3d20 6672 6f7a 656e  shable] = frozen
+0002e780: 7365 7428 292c 0a20 2020 2020 2020 2063  set(),.        c
+0002e790: 6f6d 7061 743a 2043 6f6d 7061 744f 7074  ompat: CompatOpt
+0002e7a0: 696f 6e73 203d 2022 6e6f 5f63 6f6e 666c  ions = "no_confl
+0002e7b0: 6963 7473 222c 0a20 2020 2020 2020 206a  icts",.        j
+0002e7c0: 6f69 6e3a 204a 6f69 6e4f 7074 696f 6e73  oin: JoinOptions
+0002e7d0: 203d 2022 6f75 7465 7222 2c0a 2020 2020   = "outer",.    
+0002e7e0: 2020 2020 6669 6c6c 5f76 616c 7565 3a20      fill_value: 
+0002e7f0: 416e 7920 3d20 7872 6474 7970 6573 2e4e  Any = xrdtypes.N
+0002e800: 412c 0a20 2020 2020 2020 2063 6f6d 6269  A,.        combi
+0002e810: 6e65 5f61 7474 7273 3a20 436f 6d62 696e  ne_attrs: Combin
+0002e820: 6541 7474 7273 4f70 7469 6f6e 7320 3d20  eAttrsOptions = 
+0002e830: 226f 7665 7272 6964 6522 2c0a 2020 2020  "override",.    
+0002e840: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0002e850: 2020 2020 2020 2020 2222 224d 6572 6765          """Merge
+0002e860: 2074 6865 2061 7272 6179 7320 6f66 2074   the arrays of t
+0002e870: 776f 2064 6174 6173 6574 7320 696e 746f  wo datasets into
+0002e880: 2061 2073 696e 676c 6520 6461 7461 7365   a single datase
+0002e890: 742e 0a0a 2020 2020 2020 2020 5468 6973  t...        This
+0002e8a0: 206d 6574 686f 6420 6765 6e65 7261 6c6c   method generall
+0002e8b0: 7920 646f 6573 206e 6f74 2061 6c6c 6f77  y does not allow
+0002e8c0: 2066 6f72 206f 7665 7272 6964 696e 6720   for overriding 
+0002e8d0: 6461 7461 2c20 7769 7468 2074 6865 0a20  data, with the. 
+0002e8e0: 2020 2020 2020 2065 7863 6570 7469 6f6e         exception
+0002e8f0: 206f 6620 6174 7472 6962 7574 6573 2c20   of attributes, 
+0002e900: 7768 6963 6820 6172 6520 6967 6e6f 7265  which are ignore
+0002e910: 6420 6f6e 2074 6865 2073 6563 6f6e 6420  d on the second 
+0002e920: 6461 7461 7365 742e 0a20 2020 2020 2020  dataset..       
+0002e930: 2056 6172 6961 626c 6573 2077 6974 6820   Variables with 
+0002e940: 7468 6520 7361 6d65 206e 616d 6520 6172  the same name ar
+0002e950: 6520 6368 6563 6b65 6420 666f 7220 636f  e checked for co
+0002e960: 6e66 6c69 6374 7320 7669 6120 7468 6520  nflicts via the 
+0002e970: 6571 7561 6c73 0a20 2020 2020 2020 206f  equals.        o
+0002e980: 7220 6964 656e 7469 6361 6c20 6d65 7468  r identical meth
+0002e990: 6f64 732e 0a0a 2020 2020 2020 2020 5061  ods...        Pa
+0002e9a0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+0002e9b0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+0002e9c0: 2020 2020 6f74 6865 7220 3a20 4461 7461      other : Data
+0002e9d0: 7365 7420 6f72 206d 6170 7069 6e67 0a20  set or mapping. 
+0002e9e0: 2020 2020 2020 2020 2020 2044 6174 6173             Datas
+0002e9f0: 6574 206f 7220 7661 7269 6162 6c65 7320  et or variables 
+0002ea00: 746f 206d 6572 6765 2077 6974 6820 7468  to merge with th
+0002ea10: 6973 2064 6174 6173 6574 2e0a 2020 2020  is dataset..    
+0002ea20: 2020 2020 6f76 6572 7772 6974 655f 7661      overwrite_va
+0002ea30: 7273 203a 2068 6173 6861 626c 6520 6f72  rs : hashable or
+0002ea40: 2069 7465 7261 626c 6520 6f66 2068 6173   iterable of has
+0002ea50: 6861 626c 652c 206f 7074 696f 6e61 6c0a  hable, optional.
+0002ea60: 2020 2020 2020 2020 2020 2020 4966 2070              If p
+0002ea70: 726f 7669 6465 642c 2075 7064 6174 6520  rovided, update 
+0002ea80: 7661 7269 6162 6c65 7320 6f66 2074 6865  variables of the
+0002ea90: 7365 206e 616d 6528 7329 2077 6974 686f  se name(s) witho
+0002eaa0: 7574 2063 6865 636b 696e 6720 666f 720a  ut checking for.
+0002eab0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+0002eac0: 6c69 6374 7320 696e 2074 6869 7320 6461  licts in this da
+0002ead0: 7461 7365 742e 0a20 2020 2020 2020 2063  taset..        c
+0002eae0: 6f6d 7061 7420 3a20 7b22 6964 656e 7469  ompat : {"identi
+0002eaf0: 6361 6c22 2c20 2265 7175 616c 7322 2c20  cal", "equals", 
+0002eb00: 2262 726f 6164 6361 7374 5f65 7175 616c  "broadcast_equal
+0002eb10: 7322 2c20 5c0a 2020 2020 2020 2020 2020  s", \.          
+0002eb20: 2020 2020 2020 2020 226e 6f5f 636f 6e66          "no_conf
+0002eb30: 6c69 6374 7322 2c20 226f 7665 7272 6964  licts", "overrid
+0002eb40: 6522 2c20 226d 696e 696d 616c 227d 2c20  e", "minimal"}, 
+0002eb50: 6465 6661 756c 743a 2022 6e6f 5f63 6f6e  default: "no_con
+0002eb60: 666c 6963 7473 220a 2020 2020 2020 2020  flicts".        
+0002eb70: 2020 2020 5374 7269 6e67 2069 6e64 6963      String indic
+0002eb80: 6174 696e 6720 686f 7720 746f 2063 6f6d  ating how to com
+0002eb90: 7061 7265 2076 6172 6961 626c 6573 206f  pare variables o
+0002eba0: 6620 7468 6520 7361 6d65 206e 616d 6520  f the same name 
+0002ebb0: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+0002ebc0: 706f 7465 6e74 6961 6c20 636f 6e66 6c69  potential confli
+0002ebd0: 6374 733a 0a0a 2020 2020 2020 2020 2020  cts:..          
+0002ebe0: 2020 2d20 2769 6465 6e74 6963 616c 273a    - 'identical':
+0002ebf0: 2061 6c6c 2076 616c 7565 732c 2064 696d   all values, dim
+0002ec00: 656e 7369 6f6e 7320 616e 6420 6174 7472  ensions and attr
+0002ec10: 6962 7574 6573 206d 7573 7420 6265 2074  ibutes must be t
+0002ec20: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+0002ec30: 2073 616d 652e 0a20 2020 2020 2020 2020   same..         
+0002ec40: 2020 202d 2027 6571 7561 6c73 273a 2061     - 'equals': a
+0002ec50: 6c6c 2076 616c 7565 7320 616e 6420 6469  ll values and di
+0002ec60: 6d65 6e73 696f 6e73 206d 7573 7420 6265  mensions must be
+0002ec70: 2074 6865 2073 616d 652e 0a20 2020 2020   the same..     
+0002ec80: 2020 2020 2020 202d 2027 6272 6f61 6463         - 'broadc
+0002ec90: 6173 745f 6571 7561 6c73 273a 2061 6c6c  ast_equals': all
+0002eca0: 2076 616c 7565 7320 6d75 7374 2062 6520   values must be 
+0002ecb0: 6571 7561 6c20 7768 656e 2076 6172 6961  equal when varia
+0002ecc0: 626c 6573 2061 7265 0a20 2020 2020 2020  bles are.       
+0002ecd0: 2020 2020 2020 2062 726f 6164 6361 7374         broadcast
+0002ece0: 2061 6761 696e 7374 2065 6163 6820 6f74   against each ot
+0002ecf0: 6865 7220 746f 2065 6e73 7572 6520 636f  her to ensure co
+0002ed00: 6d6d 6f6e 2064 696d 656e 7369 6f6e 732e  mmon dimensions.
+0002ed10: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
+0002ed20: 6e6f 5f63 6f6e 666c 6963 7473 273a 206f  no_conflicts': o
+0002ed30: 6e6c 7920 7661 6c75 6573 2077 6869 6368  nly values which
+0002ed40: 2061 7265 206e 6f74 206e 756c 6c20 696e   are not null in
+0002ed50: 2062 6f74 6820 6461 7461 7365 7473 0a20   both datasets. 
+0002ed60: 2020 2020 2020 2020 2020 2020 206d 7573               mus
+0002ed70: 7420 6265 2065 7175 616c 2e20 5468 6520  t be equal. The 
+0002ed80: 7265 7475 726e 6564 2064 6174 6173 6574  returned dataset
+0002ed90: 2074 6865 6e20 636f 6e74 6169 6e73 2074   then contains t
+0002eda0: 6865 2063 6f6d 6269 6e61 7469 6f6e 0a20  he combination. 
+0002edb0: 2020 2020 2020 2020 2020 2020 206f 6620               of 
+0002edc0: 616c 6c20 6e6f 6e2d 6e75 6c6c 2076 616c  all non-null val
+0002edd0: 7565 732e 0a20 2020 2020 2020 2020 2020  ues..           
+0002ede0: 202d 2027 6f76 6572 7269 6465 273a 2073   - 'override': s
+0002edf0: 6b69 7020 636f 6d70 6172 696e 6720 616e  kip comparing an
+0002ee00: 6420 7069 636b 2076 6172 6961 626c 6520  d pick variable 
+0002ee10: 6672 6f6d 2066 6972 7374 2064 6174 6173  from first datas
+0002ee20: 6574 0a20 2020 2020 2020 2020 2020 202d  et.            -
+0002ee30: 2027 6d69 6e69 6d61 6c27 3a20 6472 6f70   'minimal': drop
+0002ee40: 2063 6f6e 666c 6963 7469 6e67 2063 6f6f   conflicting coo
+0002ee50: 7264 696e 6174 6573 0a0a 2020 2020 2020  rdinates..      
+0002ee60: 2020 6a6f 696e 203a 207b 226f 7574 6572    join : {"outer
+0002ee70: 222c 2022 696e 6e65 7222 2c20 226c 6566  ", "inner", "lef
+0002ee80: 7422 2c20 2272 6967 6874 222c 2022 6578  t", "right", "ex
+0002ee90: 6163 7422 2c20 226f 7665 7272 6964 6522  act", "override"
+0002eea0: 7d2c 205c 0a20 2020 2020 2020 2020 2020  }, \.           
+0002eeb0: 2020 2020 6465 6661 756c 743a 2022 6f75      default: "ou
+0002eec0: 7465 7222 0a20 2020 2020 2020 2020 2020  ter".           
+0002eed0: 204d 6574 686f 6420 666f 7220 6a6f 696e   Method for join
+0002eee0: 696e 6720 6060 7365 6c66 6060 2061 6e64  ing ``self`` and
+0002eef0: 2060 606f 7468 6572 6060 2061 6c6f 6e67   ``other`` along
+0002ef00: 2073 6861 7265 6420 6469 6d65 6e73 696f   shared dimensio
+0002ef10: 6e73 3a0a 0a20 2020 2020 2020 2020 2020  ns:..           
+0002ef20: 202d 2027 6f75 7465 7227 3a20 7573 6520   - 'outer': use 
+0002ef30: 7468 6520 756e 696f 6e20 6f66 2074 6865  the union of the
+0002ef40: 2069 6e64 6578 6573 0a20 2020 2020 2020   indexes.       
+0002ef50: 2020 2020 202d 2027 696e 6e65 7227 3a20       - 'inner': 
+0002ef60: 7573 6520 7468 6520 696e 7465 7273 6563  use the intersec
+0002ef70: 7469 6f6e 206f 6620 7468 6520 696e 6465  tion of the inde
+0002ef80: 7865 730a 2020 2020 2020 2020 2020 2020  xes.            
+0002ef90: 2d20 276c 6566 7427 3a20 7573 6520 696e  - 'left': use in
+0002efa0: 6465 7865 7320 6672 6f6d 2060 6073 656c  dexes from ``sel
+0002efb0: 6660 600a 2020 2020 2020 2020 2020 2020  f``.            
+0002efc0: 2d20 2772 6967 6874 273a 2075 7365 2069  - 'right': use i
+0002efd0: 6e64 6578 6573 2066 726f 6d20 6060 6f74  ndexes from ``ot
+0002efe0: 6865 7260 600a 2020 2020 2020 2020 2020  her``.          
+0002eff0: 2020 2d20 2765 7861 6374 273a 2065 7272    - 'exact': err
+0002f000: 6f72 2069 6e73 7465 6164 206f 6620 616c  or instead of al
+0002f010: 6967 6e69 6e67 206e 6f6e 2d65 7175 616c  igning non-equal
+0002f020: 2069 6e64 6578 6573 0a20 2020 2020 2020   indexes.       
+0002f030: 2020 2020 202d 2027 6f76 6572 7269 6465       - 'override
+0002f040: 273a 2075 7365 2069 6e64 6578 6573 2066  ': use indexes f
+0002f050: 726f 6d20 6060 7365 6c66 6060 2074 6861  rom ``self`` tha
+0002f060: 7420 6172 6520 7468 6520 7361 6d65 2073  t are the same s
+0002f070: 697a 650a 2020 2020 2020 2020 2020 2020  ize.            
+0002f080: 2020 6173 2074 686f 7365 206f 6620 6060    as those of ``
+0002f090: 6f74 6865 7260 6020 696e 2074 6861 7420  other`` in that 
+0002f0a0: 6469 6d65 6e73 696f 6e0a 0a20 2020 2020  dimension..     
+0002f0b0: 2020 2066 696c 6c5f 7661 6c75 6520 3a20     fill_value : 
+0002f0c0: 7363 616c 6172 206f 7220 6469 6374 2d6c  scalar or dict-l
+0002f0d0: 696b 652c 206f 7074 696f 6e61 6c0a 2020  ike, optional.  
+0002f0e0: 2020 2020 2020 2020 2020 5661 6c75 6520            Value 
+0002f0f0: 746f 2075 7365 2066 6f72 206e 6577 6c79  to use for newly
+0002f100: 206d 6973 7369 6e67 2076 616c 7565 732e   missing values.
+0002f110: 2049 6620 6120 6469 6374 2d6c 696b 652c   If a dict-like,
+0002f120: 206d 6170 730a 2020 2020 2020 2020 2020   maps.          
+0002f130: 2020 7661 7269 6162 6c65 206e 616d 6573    variable names
+0002f140: 2028 696e 636c 7564 696e 6720 636f 6f72   (including coor
+0002f150: 6469 6e61 7465 7329 2074 6f20 6669 6c6c  dinates) to fill
+0002f160: 2076 616c 7565 732e 0a20 2020 2020 2020   values..       
+0002f170: 2063 6f6d 6269 6e65 5f61 7474 7273 203a   combine_attrs :
+0002f180: 207b 2264 726f 7022 2c20 2269 6465 6e74   {"drop", "ident
+0002f190: 6963 616c 222c 2022 6e6f 5f63 6f6e 666c  ical", "no_confl
+0002f1a0: 6963 7473 222c 2022 6472 6f70 5f63 6f6e  icts", "drop_con
+0002f1b0: 666c 6963 7473 222c 205c 0a20 2020 2020  flicts", \.     
+0002f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f1d0: 2020 2020 226f 7665 7272 6964 6522 7d20      "override"} 
+0002f1e0: 6f72 2063 616c 6c61 626c 652c 2064 6566  or callable, def
+0002f1f0: 6175 6c74 3a20 226f 7665 7272 6964 6522  ault: "override"
+0002f200: 0a20 2020 2020 2020 2020 2020 2041 2063  .            A c
+0002f210: 616c 6c61 626c 6520 6f72 2061 2073 7472  allable or a str
+0002f220: 696e 6720 696e 6469 6361 7469 6e67 2068  ing indicating h
+0002f230: 6f77 2074 6f20 636f 6d62 696e 6520 6174  ow to combine at
+0002f240: 7472 7320 6f66 2074 6865 206f 626a 6563  trs of the objec
+0002f250: 7473 2062 6569 6e67 0a20 2020 2020 2020  ts being.       
+0002f260: 2020 2020 206d 6572 6765 643a 0a0a 2020       merged:..  
+0002f270: 2020 2020 2020 2020 2020 2d20 2264 726f            - "dro
+0002f280: 7022 3a20 656d 7074 7920 6174 7472 7320  p": empty attrs 
+0002f290: 6f6e 2072 6574 7572 6e65 6420 4461 7461  on returned Data
+0002f2a0: 7365 742e 0a20 2020 2020 2020 2020 2020  set..           
+0002f2b0: 202d 2022 6964 656e 7469 6361 6c22 3a20   - "identical": 
+0002f2c0: 616c 6c20 6174 7472 7320 6d75 7374 2062  all attrs must b
+0002f2d0: 6520 7468 6520 7361 6d65 206f 6e20 6576  e the same on ev
+0002f2e0: 6572 7920 6f62 6a65 6374 2e0a 2020 2020  ery object..    
+0002f2f0: 2020 2020 2020 2020 2d20 226e 6f5f 636f          - "no_co
+0002f300: 6e66 6c69 6374 7322 3a20 6174 7472 7320  nflicts": attrs 
+0002f310: 6672 6f6d 2061 6c6c 206f 626a 6563 7473  from all objects
+0002f320: 2061 7265 2063 6f6d 6269 6e65 642c 2061   are combined, a
+0002f330: 6e79 2074 6861 7420 6861 7665 0a20 2020  ny that have.   
+0002f340: 2020 2020 2020 2020 2020 2074 6865 2073             the s
+0002f350: 616d 6520 6e61 6d65 206d 7573 7420 616c  ame name must al
+0002f360: 736f 2068 6176 6520 7468 6520 7361 6d65  so have the same
+0002f370: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
+0002f380: 2020 2020 2d20 2264 726f 705f 636f 6e66      - "drop_conf
+0002f390: 6c69 6374 7322 3a20 6174 7472 7320 6672  licts": attrs fr
+0002f3a0: 6f6d 2061 6c6c 206f 626a 6563 7473 2061  om all objects a
+0002f3b0: 7265 2063 6f6d 6269 6e65 642c 2061 6e79  re combined, any
+0002f3c0: 2074 6861 7420 6861 7665 0a20 2020 2020   that have.     
+0002f3d0: 2020 2020 2020 2020 2074 6865 2073 616d           the sam
+0002f3e0: 6520 6e61 6d65 2062 7574 2064 6966 6665  e name but diffe
+0002f3f0: 7265 6e74 2076 616c 7565 7320 6172 6520  rent values are 
+0002f400: 6472 6f70 7065 642e 0a20 2020 2020 2020  dropped..       
+0002f410: 2020 2020 202d 2022 6f76 6572 7269 6465       - "override
+0002f420: 223a 2073 6b69 7020 636f 6d70 6172 696e  ": skip comparin
+0002f430: 6720 616e 6420 636f 7079 2061 7474 7273  g and copy attrs
+0002f440: 2066 726f 6d20 7468 6520 6669 7273 7420   from the first 
+0002f450: 6461 7461 7365 7420 746f 0a20 2020 2020  dataset to.     
+0002f460: 2020 2020 2020 2020 2074 6865 2072 6573           the res
+0002f470: 756c 742e 0a0a 2020 2020 2020 2020 2020  ult...          
+0002f480: 2020 4966 2061 2063 616c 6c61 626c 652c    If a callable,
+0002f490: 2069 7420 6d75 7374 2065 7870 6563 7420   it must expect 
+0002f4a0: 6120 7365 7175 656e 6365 206f 6620 6060  a sequence of ``
+0002f4b0: 6174 7472 7360 6020 6469 6374 7320 616e  attrs`` dicts an
+0002f4c0: 6420 6120 636f 6e74 6578 7420 6f62 6a65  d a context obje
+0002f4d0: 6374 0a20 2020 2020 2020 2020 2020 2061  ct.            a
+0002f4e0: 7320 6974 7320 6f6e 6c79 2070 6172 616d  s its only param
+0002f4f0: 6574 6572 732e 0a0a 2020 2020 2020 2020  eters...        
+0002f500: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+0002f510: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0002f520: 6d65 7267 6564 203a 2044 6174 6173 6574  merged : Dataset
+0002f530: 0a20 2020 2020 2020 2020 2020 204d 6572  .            Mer
+0002f540: 6765 6420 6461 7461 7365 742e 0a0a 2020  ged dataset...  
+0002f550: 2020 2020 2020 5261 6973 6573 0a20 2020        Raises.   
+0002f560: 2020 2020 202d 2d2d 2d2d 2d0a 2020 2020       ------.    
+0002f570: 2020 2020 4d65 7267 6545 7272 6f72 0a20      MergeError. 
+0002f580: 2020 2020 2020 2020 2020 2049 6620 616e             If an
+0002f590: 7920 7661 7269 6162 6c65 7320 636f 6e66  y variables conf
+0002f5a0: 6c69 6374 2028 7365 6520 6060 636f 6d70  lict (see ``comp
+0002f5b0: 6174 6060 292e 0a0a 2020 2020 2020 2020  at``)...        
+0002f5c0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+0002f5d0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+0002f5e0: 2020 4461 7461 7365 742e 7570 6461 7465    Dataset.update
+0002f5f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0002f600: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
+0002f610: 2e63 6f72 652e 6461 7461 6172 7261 7920  .core.dataarray 
+0002f620: 696d 706f 7274 2044 6174 6141 7272 6179  import DataArray
+0002f630: 0a0a 2020 2020 2020 2020 6f74 6865 7220  ..        other 
+0002f640: 3d20 6f74 6865 722e 746f 5f64 6174 6173  = other.to_datas
+0002f650: 6574 2829 2069 6620 6973 696e 7374 616e  et() if isinstan
+0002f660: 6365 286f 7468 6572 2c20 4461 7461 4172  ce(other, DataAr
+0002f670: 7261 7929 2065 6c73 6520 6f74 6865 720a  ray) else other.
+0002f680: 2020 2020 2020 2020 6d65 7267 655f 7265          merge_re
+0002f690: 7375 6c74 203d 2064 6174 6173 6574 5f6d  sult = dataset_m
+0002f6a0: 6572 6765 5f6d 6574 686f 6428 0a20 2020  erge_method(.   
+0002f6b0: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+0002f6c0: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0002f6d0: 2c0a 2020 2020 2020 2020 2020 2020 6f76  ,.            ov
+0002f6e0: 6572 7772 6974 655f 7661 7273 3d6f 7665  erwrite_vars=ove
+0002f6f0: 7277 7269 7465 5f76 6172 732c 0a20 2020  rwrite_vars,.   
+0002f700: 2020 2020 2020 2020 2063 6f6d 7061 743d           compat=
+0002f710: 636f 6d70 6174 2c0a 2020 2020 2020 2020  compat,.        
+0002f720: 2020 2020 6a6f 696e 3d6a 6f69 6e2c 0a20      join=join,. 
+0002f730: 2020 2020 2020 2020 2020 2066 696c 6c5f             fill_
+0002f740: 7661 6c75 653d 6669 6c6c 5f76 616c 7565  value=fill_value
+0002f750: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+0002f760: 6d62 696e 655f 6174 7472 733d 636f 6d62  mbine_attrs=comb
+0002f770: 696e 655f 6174 7472 732c 0a20 2020 2020  ine_attrs,.     
+0002f780: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
+0002f790: 7572 6e20 7365 6c66 2e5f 7265 706c 6163  urn self._replac
+0002f7a0: 6528 2a2a 6d65 7267 655f 7265 7375 6c74  e(**merge_result
+0002f7b0: 2e5f 6173 6469 6374 2829 290a 0a20 2020  ._asdict())..   
+0002f7c0: 2064 6566 205f 6173 7365 7274 5f61 6c6c   def _assert_all
+0002f7d0: 5f69 6e5f 6461 7461 7365 7428 0a20 2020  _in_dataset(.   
+0002f7e0: 2020 2020 2073 656c 662c 206e 616d 6573       self, names
+0002f7f0: 3a20 4974 6572 6162 6c65 5b48 6173 6861  : Iterable[Hasha
+0002f800: 626c 655d 2c20 7669 7274 7561 6c5f 6f6b  ble], virtual_ok
+0002f810: 6179 3a20 626f 6f6c 203d 2046 616c 7365  ay: bool = False
+0002f820: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+0002f830: 2020 2020 2020 2020 6261 645f 6e61 6d65          bad_name
+0002f840: 7320 3d20 7365 7428 6e61 6d65 7329 202d  s = set(names) -
+0002f850: 2073 6574 2873 656c 662e 5f76 6172 6961   set(self._varia
+0002f860: 626c 6573 290a 2020 2020 2020 2020 6966  bles).        if
+0002f870: 2076 6972 7475 616c 5f6f 6b61 793a 0a20   virtual_okay:. 
+0002f880: 2020 2020 2020 2020 2020 2062 6164 5f6e             bad_n
+0002f890: 616d 6573 202d 3d20 7365 6c66 2e76 6972  ames -= self.vir
+0002f8a0: 7475 616c 5f76 6172 6961 626c 6573 0a20  tual_variables. 
+0002f8b0: 2020 2020 2020 2069 6620 6261 645f 6e61         if bad_na
+0002f8c0: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
+0002f8d0: 206f 7264 6572 6564 5f62 6164 5f6e 616d   ordered_bad_nam
+0002f8e0: 6573 203d 205b 6e61 6d65 2066 6f72 206e  es = [name for n
+0002f8f0: 616d 6520 696e 206e 616d 6573 2069 6620  ame in names if 
+0002f900: 6e61 6d65 2069 6e20 6261 645f 6e61 6d65  name in bad_name
+0002f910: 735d 0a20 2020 2020 2020 2020 2020 2072  s].            r
+0002f920: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0002f930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f940: 2066 2254 6865 7365 2076 6172 6961 626c   f"These variabl
+0002f950: 6573 2063 616e 6e6f 7420 6265 2066 6f75  es cannot be fou
+0002f960: 6e64 2069 6e20 7468 6973 2064 6174 6173  nd in this datas
+0002f970: 6574 3a20 7b6f 7264 6572 6564 5f62 6164  et: {ordered_bad
+0002f980: 5f6e 616d 6573 7d22 0a20 2020 2020 2020  _names}".       
+0002f990: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+0002f9a0: 6472 6f70 5f76 6172 7328 0a20 2020 2020  drop_vars(.     
+0002f9b0: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+0002f9c0: 6574 2c0a 2020 2020 2020 2020 6e61 6d65  et,.        name
+0002f9d0: 733a 2048 6173 6861 626c 6520 7c20 4974  s: Hashable | It
+0002f9e0: 6572 6162 6c65 5b48 6173 6861 626c 655d  erable[Hashable]
+0002f9f0: 2c0a 2020 2020 2020 2020 2a2c 0a20 2020  ,.        *,.   
+0002fa00: 2020 2020 2065 7272 6f72 733a 2045 7272       errors: Err
+0002fa10: 6f72 4f70 7469 6f6e 7320 3d20 2272 6169  orOptions = "rai
+0002fa20: 7365 222c 0a20 2020 2029 202d 3e20 545f  se",.    ) -> T_
+0002fa30: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0002fa40: 2022 2222 4472 6f70 2076 6172 6961 626c   """Drop variabl
+0002fa50: 6573 2066 726f 6d20 7468 6973 2064 6174  es from this dat
+0002fa60: 6173 6574 2e0a 0a20 2020 2020 2020 2050  aset...        P
+0002fa70: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0002fa80: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0002fa90: 2020 2020 206e 616d 6573 203a 2068 6173       names : has
+0002faa0: 6861 626c 6520 6f72 2069 7465 7261 626c  hable or iterabl
+0002fab0: 6520 6f66 2068 6173 6861 626c 650a 2020  e of hashable.  
+0002fac0: 2020 2020 2020 2020 2020 4e61 6d65 2873            Name(s
+0002fad0: 2920 6f66 2076 6172 6961 626c 6573 2074  ) of variables t
+0002fae0: 6f20 6472 6f70 2e0a 2020 2020 2020 2020  o drop..        
+0002faf0: 6572 726f 7273 203a 207b 2272 6169 7365  errors : {"raise
+0002fb00: 222c 2022 6967 6e6f 7265 227d 2c20 6465  ", "ignore"}, de
+0002fb10: 6661 756c 743a 2022 7261 6973 6522 0a20  fault: "raise". 
+0002fb20: 2020 2020 2020 2020 2020 2049 6620 2772             If 'r
+0002fb30: 6169 7365 272c 2072 6169 7365 7320 6120  aise', raises a 
+0002fb40: 5661 6c75 6545 7272 6f72 2065 7272 6f72  ValueError error
+0002fb50: 2069 6620 616e 7920 6f66 2074 6865 2076   if any of the v
+0002fb60: 6172 6961 626c 650a 2020 2020 2020 2020  ariable.        
+0002fb70: 2020 2020 7061 7373 6564 2061 7265 206e      passed are n
+0002fb80: 6f74 2069 6e20 7468 6520 6461 7461 7365  ot in the datase
+0002fb90: 742e 2049 6620 2769 676e 6f72 6527 2c20  t. If 'ignore', 
+0002fba0: 616e 7920 6769 7665 6e20 6e61 6d65 7320  any given names 
+0002fbb0: 7468 6174 2061 7265 2069 6e20 7468 650a  that are in the.
+0002fbc0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0002fbd0: 7365 7420 6172 6520 6472 6f70 7065 6420  set are dropped 
+0002fbe0: 616e 6420 6e6f 2065 7272 6f72 2069 7320  and no error is 
+0002fbf0: 7261 6973 6564 2e0a 0a20 2020 2020 2020  raised...       
+0002fc00: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+0002fc10: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+0002fc20: 2064 726f 7070 6564 203a 2044 6174 6173   dropped : Datas
+0002fc30: 6574 0a0a 2020 2020 2020 2020 2222 220a  et..        """.
+0002fc40: 2020 2020 2020 2020 2320 7468 6520 4974          # the It
+0002fc50: 6572 6162 6c65 2063 6865 636b 2069 7320  erable check is 
+0002fc60: 7265 7175 6972 6564 2066 6f72 206d 7970  required for myp
+0002fc70: 790a 2020 2020 2020 2020 6966 2069 735f  y.        if is_
+0002fc80: 7363 616c 6172 286e 616d 6573 2920 6f72  scalar(names) or
+0002fc90: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0002fca0: 6e61 6d65 732c 2049 7465 7261 626c 6529  names, Iterable)
+0002fcb0: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+0002fcc0: 6d65 7320 3d20 7b6e 616d 6573 7d0a 2020  mes = {names}.  
+0002fcd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002fce0: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
+0002fcf0: 7365 7428 6e61 6d65 7329 0a20 2020 2020  set(names).     
+0002fd00: 2020 2069 6620 6572 726f 7273 203d 3d20     if errors == 
+0002fd10: 2272 6169 7365 223a 0a20 2020 2020 2020  "raise":.       
+0002fd20: 2020 2020 2073 656c 662e 5f61 7373 6572       self._asser
+0002fd30: 745f 616c 6c5f 696e 5f64 6174 6173 6574  t_all_in_dataset
+0002fd40: 286e 616d 6573 290a 0a20 2020 2020 2020  (names)..       
+0002fd50: 2023 2047 4836 3530 350a 2020 2020 2020   # GH6505.      
+0002fd60: 2020 6f74 6865 725f 6e61 6d65 7320 3d20    other_names = 
+0002fd70: 7365 7428 290a 2020 2020 2020 2020 666f  set().        fo
+0002fd80: 7220 7661 7220 696e 206e 616d 6573 3a0a  r var in names:.
+0002fd90: 2020 2020 2020 2020 2020 2020 6d61 7962              mayb
+0002fda0: 655f 6d69 6478 203d 2073 656c 662e 5f69  e_midx = self._i
+0002fdb0: 6e64 6578 6573 2e67 6574 2876 6172 2c20  ndexes.get(var, 
+0002fdc0: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
+0002fdd0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0002fde0: 6d61 7962 655f 6d69 6478 2c20 5061 6e64  maybe_midx, Pand
+0002fdf0: 6173 4d75 6c74 6949 6e64 6578 293a 0a20  asMultiIndex):. 
+0002fe00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002fe10: 6478 5f63 6f6f 7264 5f6e 616d 6573 203d  dx_coord_names =
+0002fe20: 2073 6574 286d 6179 6265 5f6d 6964 782e   set(maybe_midx.
+0002fe30: 696e 6465 782e 6e61 6d65 7320 2b20 5b6d  index.names + [m
+0002fe40: 6179 6265 5f6d 6964 782e 6469 6d5d 290a  aybe_midx.dim]).
+0002fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fe60: 6964 785f 6f74 6865 725f 6e61 6d65 7320  idx_other_names 
+0002fe70: 3d20 6964 785f 636f 6f72 645f 6e61 6d65  = idx_coord_name
+0002fe80: 7320 2d20 7365 7428 6e61 6d65 7329 0a20  s - set(names). 
+0002fe90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0002fea0: 7468 6572 5f6e 616d 6573 2e75 7064 6174  ther_names.updat
+0002feb0: 6528 6964 785f 6f74 6865 725f 6e61 6d65  e(idx_other_name
+0002fec0: 7329 0a20 2020 2020 2020 2069 6620 6f74  s).        if ot
+0002fed0: 6865 725f 6e61 6d65 733a 0a20 2020 2020  her_names:.     
+0002fee0: 2020 2020 2020 206e 616d 6573 207c 3d20         names |= 
+0002fef0: 7365 7428 6f74 6865 725f 6e61 6d65 7329  set(other_names)
+0002ff00: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+0002ff10: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
+0002ff20: 2020 2020 2020 2020 2020 2020 6622 4465              f"De
+0002ff30: 6c65 7469 6e67 2061 2073 696e 676c 6520  leting a single 
+0002ff40: 6c65 7665 6c20 6f66 2061 204d 756c 7469  level of a Multi
+0002ff50: 496e 6465 7820 6973 2064 6570 7265 6361  Index is depreca
+0002ff60: 7465 642e 2050 7265 7669 6f75 736c 792c  ted. Previously,
+0002ff70: 2074 6869 7320 6465 6c65 7465 6420 616c   this deleted al
+0002ff80: 6c20 6c65 7665 6c73 206f 6620 6120 4d75  l levels of a Mu
+0002ff90: 6c74 6949 6e64 6578 2e20 220a 2020 2020  ltiIndex. ".    
+0002ffa0: 2020 2020 2020 2020 2020 2020 6622 506c              f"Pl
+0002ffb0: 6561 7365 2061 6c73 6f20 6472 6f70 2074  ease also drop t
+0002ffc0: 6865 2066 6f6c 6c6f 7769 6e67 2076 6172  he following var
+0002ffd0: 6961 626c 6573 3a20 7b6f 7468 6572 5f6e  iables: {other_n
+0002ffe0: 616d 6573 2172 7d20 746f 2061 766f 6964  ames!r} to avoid
+0002fff0: 2061 6e20 6572 726f 7220 696e 2074 6865   an error in the
+00030000: 2066 7574 7572 652e 222c 0a20 2020 2020   future.",.     
+00030010: 2020 2020 2020 2020 2020 2044 6570 7265             Depre
+00030020: 6361 7469 6f6e 5761 726e 696e 672c 0a20  cationWarning,. 
+00030030: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00030040: 7461 636b 6c65 7665 6c3d 322c 0a20 2020  tacklevel=2,.   
+00030050: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00030060: 2020 2020 6173 7365 7274 5f6e 6f5f 696e      assert_no_in
+00030070: 6465 785f 636f 7272 7570 7465 6428 7365  dex_corrupted(se
+00030080: 6c66 2e78 696e 6465 7865 732c 206e 616d  lf.xindexes, nam
+00030090: 6573 290a 0a20 2020 2020 2020 2076 6172  es)..        var
+000300a0: 6961 626c 6573 203d 207b 6b3a 2076 2066  iables = {k: v f
+000300b0: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
+000300c0: 5f76 6172 6961 626c 6573 2e69 7465 6d73  _variables.items
+000300d0: 2829 2069 6620 6b20 6e6f 7420 696e 206e  () if k not in n
+000300e0: 616d 6573 7d0a 2020 2020 2020 2020 636f  ames}.        co
+000300f0: 6f72 645f 6e61 6d65 7320 3d20 7b6b 2066  ord_names = {k f
+00030100: 6f72 206b 2069 6e20 7365 6c66 2e5f 636f  or k in self._co
+00030110: 6f72 645f 6e61 6d65 7320 6966 206b 2069  ord_names if k i
+00030120: 6e20 7661 7269 6162 6c65 737d 0a20 2020  n variables}.   
+00030130: 2020 2020 2069 6e64 6578 6573 203d 207b       indexes = {
+00030140: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+00030150: 2073 656c 662e 5f69 6e64 6578 6573 2e69   self._indexes.i
+00030160: 7465 6d73 2829 2069 6620 6b20 6e6f 7420  tems() if k not 
+00030170: 696e 206e 616d 6573 7d0a 2020 2020 2020  in names}.      
+00030180: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00030190: 6570 6c61 6365 5f77 6974 685f 6e65 775f  eplace_with_new_
+000301a0: 6469 6d73 280a 2020 2020 2020 2020 2020  dims(.          
+000301b0: 2020 7661 7269 6162 6c65 732c 2063 6f6f    variables, coo
+000301c0: 7264 5f6e 616d 6573 3d63 6f6f 7264 5f6e  rd_names=coord_n
+000301d0: 616d 6573 2c20 696e 6465 7865 733d 696e  ames, indexes=in
+000301e0: 6465 7865 730a 2020 2020 2020 2020 290a  dexes.        ).
+000301f0: 0a20 2020 2064 6566 2064 726f 705f 696e  .    def drop_in
+00030200: 6465 7865 7328 0a20 2020 2020 2020 2073  dexes(.        s
+00030210: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
+00030220: 2020 2020 2020 2020 636f 6f72 645f 6e61          coord_na
+00030230: 6d65 733a 2048 6173 6861 626c 6520 7c20  mes: Hashable | 
+00030240: 4974 6572 6162 6c65 5b48 6173 6861 626c  Iterable[Hashabl
+00030250: 655d 2c0a 2020 2020 2020 2020 2a2c 0a20  e],.        *,. 
+00030260: 2020 2020 2020 2065 7272 6f72 733a 2045         errors: E
+00030270: 7272 6f72 4f70 7469 6f6e 7320 3d20 2272  rrorOptions = "r
+00030280: 6169 7365 222c 0a20 2020 2029 202d 3e20  aise",.    ) -> 
+00030290: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+000302a0: 2020 2022 2222 4472 6f70 2074 6865 2069     """Drop the i
+000302b0: 6e64 6578 6573 2061 7373 6967 6e65 6420  ndexes assigned 
+000302c0: 746f 2074 6865 2067 6976 656e 2063 6f6f  to the given coo
+000302d0: 7264 696e 6174 6573 2e0a 0a20 2020 2020  rdinates...     
+000302e0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+000302f0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00030300: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
+00030310: 616d 6573 203a 2068 6173 6861 626c 6520  ames : hashable 
+00030320: 6f72 2069 7465 7261 626c 6520 6f66 2068  or iterable of h
+00030330: 6173 6861 626c 650a 2020 2020 2020 2020  ashable.        
+00030340: 2020 2020 4e61 6d65 2873 2920 6f66 2074      Name(s) of t
+00030350: 6865 2063 6f6f 7264 696e 6174 6528 7329  he coordinate(s)
+00030360: 2066 6f72 2077 6869 6368 2074 6f20 6472   for which to dr
+00030370: 6f70 2074 6865 2069 6e64 6578 2e0a 2020  op the index..  
+00030380: 2020 2020 2020 6572 726f 7273 203a 207b        errors : {
+00030390: 2272 6169 7365 222c 2022 6967 6e6f 7265  "raise", "ignore
+000303a0: 227d 2c20 6465 6661 756c 743a 2022 7261  "}, default: "ra
+000303b0: 6973 6522 0a20 2020 2020 2020 2020 2020  ise".           
+000303c0: 2049 6620 2772 6169 7365 272c 2072 6169   If 'raise', rai
+000303d0: 7365 7320 6120 5661 6c75 6545 7272 6f72  ses a ValueError
+000303e0: 2065 7272 6f72 2069 6620 616e 7920 6f66   error if any of
+000303f0: 2074 6865 2063 6f6f 7264 696e 6174 6573   the coordinates
+00030400: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+00030410: 7365 6420 6861 7665 206e 6f20 696e 6465  sed have no inde
+00030420: 7820 6f72 2061 7265 206e 6f74 2069 6e20  x or are not in 
+00030430: 7468 6520 6461 7461 7365 742e 0a20 2020  the dataset..   
+00030440: 2020 2020 2020 2020 2049 6620 2769 676e           If 'ign
+00030450: 6f72 6527 2c20 6e6f 2065 7272 6f72 2069  ore', no error i
+00030460: 7320 7261 6973 6564 2e0a 0a20 2020 2020  s raised...     
+00030470: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00030480: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+00030490: 2020 2064 726f 7070 6564 203a 2044 6174     dropped : Dat
+000304a0: 6173 6574 0a20 2020 2020 2020 2020 2020  aset.           
+000304b0: 2041 206e 6577 2064 6174 6173 6574 2077   A new dataset w
+000304c0: 6974 6820 6472 6f70 7065 6420 696e 6465  ith dropped inde
+000304d0: 7865 732e 0a0a 2020 2020 2020 2020 2222  xes...        ""
+000304e0: 220a 2020 2020 2020 2020 2320 7468 6520  ".        # the 
+000304f0: 4974 6572 6162 6c65 2063 6865 636b 2069  Iterable check i
+00030500: 7320 7265 7175 6972 6564 2066 6f72 206d  s required for m
+00030510: 7970 790a 2020 2020 2020 2020 6966 2069  ypy.        if i
+00030520: 735f 7363 616c 6172 2863 6f6f 7264 5f6e  s_scalar(coord_n
+00030530: 616d 6573 2920 6f72 206e 6f74 2069 7369  ames) or not isi
+00030540: 6e73 7461 6e63 6528 636f 6f72 645f 6e61  nstance(coord_na
+00030550: 6d65 732c 2049 7465 7261 626c 6529 3a0a  mes, Iterable):.
+00030560: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
+00030570: 645f 6e61 6d65 7320 3d20 7b63 6f6f 7264  d_names = {coord
+00030580: 5f6e 616d 6573 7d0a 2020 2020 2020 2020  _names}.        
+00030590: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000305a0: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
+000305b0: 7365 7428 636f 6f72 645f 6e61 6d65 7329  set(coord_names)
+000305c0: 0a0a 2020 2020 2020 2020 6966 2065 7272  ..        if err
+000305d0: 6f72 7320 3d3d 2022 7261 6973 6522 3a0a  ors == "raise":.
+000305e0: 2020 2020 2020 2020 2020 2020 696e 7661              inva
+000305f0: 6c69 645f 636f 6f72 6473 203d 2063 6f6f  lid_coords = coo
+00030600: 7264 5f6e 616d 6573 202d 2073 656c 662e  rd_names - self.
+00030610: 5f63 6f6f 7264 5f6e 616d 6573 0a20 2020  _coord_names.   
+00030620: 2020 2020 2020 2020 2069 6620 696e 7661           if inva
+00030630: 6c69 645f 636f 6f72 6473 3a0a 2020 2020  lid_coords:.    
+00030640: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00030650: 6520 5661 6c75 6545 7272 6f72 2866 2274  e ValueError(f"t
+00030660: 686f 7365 2063 6f6f 7264 696e 6174 6573  hose coordinates
+00030670: 2064 6f6e 2774 2065 7869 7374 3a20 7b69   don't exist: {i
+00030680: 6e76 616c 6964 5f63 6f6f 7264 737d 2229  nvalid_coords}")
+00030690: 0a0a 2020 2020 2020 2020 2020 2020 756e  ..            un
+000306a0: 696e 6465 7865 645f 636f 6f72 6473 203d  indexed_coords =
+000306b0: 2073 6574 2863 6f6f 7264 5f6e 616d 6573   set(coord_names
+000306c0: 2920 2d20 7365 7428 7365 6c66 2e5f 696e  ) - set(self._in
+000306d0: 6465 7865 7329 0a20 2020 2020 2020 2020  dexes).         
+000306e0: 2020 2069 6620 756e 696e 6465 7865 645f     if unindexed_
+000306f0: 636f 6f72 6473 3a0a 2020 2020 2020 2020  coords:.        
+00030700: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00030710: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00030720: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00030730: 7468 6f73 6520 636f 6f72 6469 6e61 7465  those coordinate
+00030740: 7320 646f 206e 6f74 2068 6176 6520 616e  s do not have an
+00030750: 2069 6e64 6578 3a20 7b75 6e69 6e64 6578   index: {unindex
+00030760: 6564 5f63 6f6f 7264 737d 220a 2020 2020  ed_coords}".    
+00030770: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00030780: 2020 2020 2020 2061 7373 6572 745f 6e6f         assert_no
+00030790: 5f69 6e64 6578 5f63 6f72 7275 7074 6564  _index_corrupted
+000307a0: 2873 656c 662e 7869 6e64 6578 6573 2c20  (self.xindexes, 
+000307b0: 636f 6f72 645f 6e61 6d65 732c 2061 6374  coord_names, act
+000307c0: 696f 6e3d 2272 656d 6f76 6520 696e 6465  ion="remove inde
+000307d0: 7828 6573 2922 290a 0a20 2020 2020 2020  x(es)")..       
+000307e0: 2076 6172 6961 626c 6573 203d 207b 7d0a   variables = {}.
+000307f0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
+00030800: 2c20 7661 7220 696e 2073 656c 662e 5f76  , var in self._v
+00030810: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
+00030820: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00030830: 206e 616d 6520 696e 2063 6f6f 7264 5f6e   name in coord_n
+00030840: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+00030850: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
+00030860: 6e61 6d65 5d20 3d20 7661 722e 746f 5f62  name] = var.to_b
+00030870: 6173 655f 7661 7269 6162 6c65 2829 0a20  ase_variable(). 
+00030880: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00030890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000308a0: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
+000308b0: 203d 2076 6172 0a0a 2020 2020 2020 2020   = var..        
+000308c0: 696e 6465 7865 7320 3d20 7b6b 3a20 7620  indexes = {k: v 
+000308d0: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+000308e0: 2e5f 696e 6465 7865 732e 6974 656d 7328  ._indexes.items(
+000308f0: 2920 6966 206b 206e 6f74 2069 6e20 636f  ) if k not in co
+00030900: 6f72 645f 6e61 6d65 737d 0a0a 2020 2020  ord_names}..    
+00030910: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00030920: 5f72 6570 6c61 6365 2876 6172 6961 626c  _replace(variabl
+00030930: 6573 3d76 6172 6961 626c 6573 2c20 696e  es=variables, in
+00030940: 6465 7865 733d 696e 6465 7865 7329 0a0a  dexes=indexes)..
+00030950: 2020 2020 6465 6620 6472 6f70 280a 2020      def drop(.  
+00030960: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+00030970: 7461 7365 742c 0a20 2020 2020 2020 206c  taset,.        l
+00030980: 6162 656c 733d 4e6f 6e65 2c0a 2020 2020  abels=None,.    
+00030990: 2020 2020 6469 6d3d 4e6f 6e65 2c0a 2020      dim=None,.  
+000309a0: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
+000309b0: 2065 7272 6f72 733a 2045 7272 6f72 4f70   errors: ErrorOp
+000309c0: 7469 6f6e 7320 3d20 2272 6169 7365 222c  tions = "raise",
+000309d0: 0a20 2020 2020 2020 202a 2a6c 6162 656c  .        **label
+000309e0: 735f 6b77 6172 6773 2c0a 2020 2020 2920  s_kwargs,.    ) 
+000309f0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+00030a00: 2020 2020 2020 2222 2242 6163 6b77 6172        """Backwar
+00030a10: 6420 636f 6d70 6174 6962 6c65 206d 6574  d compatible met
+00030a20: 686f 6420 6261 7365 6420 6f6e 2060 6472  hod based on `dr
+00030a30: 6f70 5f76 6172 7360 2061 6e64 2060 6472  op_vars` and `dr
+00030a40: 6f70 5f73 656c 600a 0a20 2020 2020 2020  op_sel`..       
+00030a50: 2055 7369 6e67 2065 6974 6865 7220 6064   Using either `d
+00030a60: 726f 705f 7661 7273 6020 6f72 2060 6472  rop_vars` or `dr
+00030a70: 6f70 5f73 656c 6020 6973 2065 6e63 6f75  op_sel` is encou
+00030a80: 7261 6765 640a 0a20 2020 2020 2020 2053  raged..        S
+00030a90: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00030aa0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00030ab0: 2044 6174 6173 6574 2e64 726f 705f 7661   Dataset.drop_va
+00030ac0: 7273 0a20 2020 2020 2020 2044 6174 6173  rs.        Datas
+00030ad0: 6574 2e64 726f 705f 7365 6c0a 2020 2020  et.drop_sel.    
+00030ae0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00030af0: 6966 2065 7272 6f72 7320 6e6f 7420 696e  if errors not in
+00030b00: 205b 2272 6169 7365 222c 2022 6967 6e6f   ["raise", "igno
+00030b10: 7265 225d 3a0a 2020 2020 2020 2020 2020  re"]:.          
+00030b20: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00030b30: 6f72 2827 6572 726f 7273 206d 7573 7420  or('errors must 
+00030b40: 6265 2065 6974 6865 7220 2272 6169 7365  be either "raise
+00030b50: 2220 6f72 2022 6967 6e6f 7265 2227 290a  " or "ignore"').
+00030b60: 0a20 2020 2020 2020 2069 6620 6973 5f64  .        if is_d
+00030b70: 6963 745f 6c69 6b65 286c 6162 656c 7329  ict_like(labels)
+00030b80: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
+00030b90: 6e63 6528 6c61 6265 6c73 2c20 6469 6374  nce(labels, dict
+00030ba0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+00030bb0: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
+00030bc0: 2020 2020 2020 2020 2020 2020 2020 2264                "d
+00030bd0: 726f 7070 696e 6720 636f 6f72 6469 6e61  ropping coordina
+00030be0: 7465 7320 7573 696e 6720 6064 726f 7060  tes using `drop`
+00030bf0: 2069 7320 6265 2064 6570 7265 6361 7465   is be deprecate
+00030c00: 643b 2075 7365 2064 726f 705f 7661 7273  d; use drop_vars
+00030c10: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00030c20: 2020 2020 4675 7475 7265 5761 726e 696e      FutureWarnin
+00030c30: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+00030c40: 2020 2073 7461 636b 6c65 7665 6c3d 322c     stacklevel=2,
+00030c50: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00030c60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00030c70: 6e20 7365 6c66 2e64 726f 705f 7661 7273  n self.drop_vars
+00030c80: 286c 6162 656c 732c 2065 7272 6f72 733d  (labels, errors=
+00030c90: 6572 726f 7273 290a 0a20 2020 2020 2020  errors)..       
+00030ca0: 2069 6620 6c61 6265 6c73 5f6b 7761 7267   if labels_kwarg
+00030cb0: 7320 6f72 2069 7369 6e73 7461 6e63 6528  s or isinstance(
+00030cc0: 6c61 6265 6c73 2c20 6469 6374 293a 0a20  labels, dict):. 
+00030cd0: 2020 2020 2020 2020 2020 2069 6620 6469             if di
+00030ce0: 6d20 6973 206e 6f74 204e 6f6e 653a 0a20  m is not None:. 
+00030cf0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00030d00: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00030d10: 2263 616e 6e6f 7420 7370 6563 6966 7920  "cannot specify 
+00030d20: 6469 6d20 616e 6420 6469 6374 2d6c 696b  dim and dict-lik
+00030d30: 6520 6172 6775 6d65 6e74 732e 2229 0a20  e arguments."). 
+00030d40: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00030d50: 7320 3d20 6569 7468 6572 5f64 6963 745f  s = either_dict_
+00030d60: 6f72 5f6b 7761 7267 7328 6c61 6265 6c73  or_kwargs(labels
+00030d70: 2c20 6c61 6265 6c73 5f6b 7761 7267 732c  , labels_kwargs,
+00030d80: 2022 6472 6f70 2229 0a0a 2020 2020 2020   "drop")..      
+00030d90: 2020 6966 2064 696d 2069 7320 4e6f 6e65    if dim is None
+00030da0: 2061 6e64 2028 6973 5f73 6361 6c61 7228   and (is_scalar(
+00030db0: 6c61 6265 6c73 2920 6f72 2069 7369 6e73  labels) or isins
+00030dc0: 7461 6e63 6528 6c61 6265 6c73 2c20 4974  tance(labels, It
+00030dd0: 6572 6162 6c65 2929 3a0a 2020 2020 2020  erable)):.      
+00030de0: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+00030df0: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
+00030e00: 2020 2020 2022 6472 6f70 7069 6e67 2076       "dropping v
+00030e10: 6172 6961 626c 6573 2075 7369 6e67 2060  ariables using `
+00030e20: 6472 6f70 6020 7769 6c6c 2062 6520 6465  drop` will be de
+00030e30: 7072 6563 6174 6564 3b20 7573 696e 6720  precated; using 
+00030e40: 6472 6f70 5f76 6172 7320 6973 2065 6e63  drop_vars is enc
+00030e50: 6f75 7261 6765 642e 222c 0a20 2020 2020  ouraged.",.     
+00030e60: 2020 2020 2020 2020 2020 2050 656e 6469             Pendi
+00030e70: 6e67 4465 7072 6563 6174 696f 6e57 6172  ngDeprecationWar
+00030e80: 6e69 6e67 2c0a 2020 2020 2020 2020 2020  ning,.          
+00030e90: 2020 2020 2020 7374 6163 6b6c 6576 656c        stacklevel
+00030ea0: 3d32 2c0a 2020 2020 2020 2020 2020 2020  =2,.            
+00030eb0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00030ec0: 7475 726e 2073 656c 662e 6472 6f70 5f76  turn self.drop_v
+00030ed0: 6172 7328 6c61 6265 6c73 2c20 6572 726f  ars(labels, erro
+00030ee0: 7273 3d65 7272 6f72 7329 0a20 2020 2020  rs=errors).     
+00030ef0: 2020 2069 6620 6469 6d20 6973 206e 6f74     if dim is not
+00030f00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00030f10: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+00030f20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00030f30: 2020 2264 726f 7070 696e 6720 6c61 6265    "dropping labe
+00030f40: 6c73 2075 7369 6e67 206c 6973 742d 6c69  ls using list-li
+00030f50: 6b65 206c 6162 656c 7320 6973 2064 6570  ke labels is dep
+00030f60: 7265 6361 7465 643b 2075 7369 6e67 2022  recated; using "
+00030f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030f80: 2022 6469 6374 2d6c 696b 6520 6172 6775   "dict-like argu
+00030f90: 6d65 6e74 7320 7769 7468 2060 6472 6f70  ments with `drop
+00030fa0: 5f73 656c 602c 2065 2e67 2e20 6064 732e  _sel`, e.g. `ds.
+00030fb0: 6472 6f70 5f73 656c 2864 696d 3d5b 6c61  drop_sel(dim=[la
+00030fc0: 6265 6c73 5d29 2e22 2c0a 2020 2020 2020  bels]).",.      
+00030fd0: 2020 2020 2020 2020 2020 4465 7072 6563            Deprec
+00030fe0: 6174 696f 6e57 6172 6e69 6e67 2c0a 2020  ationWarning,.  
+00030ff0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00031000: 6163 6b6c 6576 656c 3d32 2c0a 2020 2020  acklevel=2,.    
+00031010: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00031020: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00031030: 662e 6472 6f70 5f73 656c 287b 6469 6d3a  f.drop_sel({dim:
+00031040: 206c 6162 656c 737d 2c20 6572 726f 7273   labels}, errors
+00031050: 3d65 7272 6f72 732c 202a 2a6c 6162 656c  =errors, **label
+00031060: 735f 6b77 6172 6773 290a 0a20 2020 2020  s_kwargs)..     
+00031070: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+00031080: 280a 2020 2020 2020 2020 2020 2020 2264  (.            "d
+00031090: 726f 7070 696e 6720 6c61 6265 6c73 2075  ropping labels u
+000310a0: 7369 6e67 2060 6472 6f70 6020 7769 6c6c  sing `drop` will
+000310b0: 2062 6520 6465 7072 6563 6174 6564 3b20   be deprecated; 
+000310c0: 7573 696e 6720 6472 6f70 5f73 656c 2069  using drop_sel i
+000310d0: 7320 656e 636f 7572 6167 6564 2e22 2c0a  s encouraged.",.
+000310e0: 2020 2020 2020 2020 2020 2020 5065 6e64              Pend
+000310f0: 696e 6744 6570 7265 6361 7469 6f6e 5761  ingDeprecationWa
+00031100: 726e 696e 672c 0a20 2020 2020 2020 2020  rning,.         
+00031110: 2020 2073 7461 636b 6c65 7665 6c3d 322c     stacklevel=2,
+00031120: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00031130: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
+00031140: 726f 705f 7365 6c28 6c61 6265 6c73 2c20  rop_sel(labels, 
+00031150: 6572 726f 7273 3d65 7272 6f72 7329 0a0a  errors=errors)..
+00031160: 2020 2020 6465 6620 6472 6f70 5f73 656c      def drop_sel
+00031170: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+00031180: 545f 4461 7461 7365 742c 206c 6162 656c  T_Dataset, label
+00031190: 733d 4e6f 6e65 2c20 2a2c 2065 7272 6f72  s=None, *, error
+000311a0: 733a 2045 7272 6f72 4f70 7469 6f6e 7320  s: ErrorOptions 
+000311b0: 3d20 2272 6169 7365 222c 202a 2a6c 6162  = "raise", **lab
+000311c0: 656c 735f 6b77 6172 6773 0a20 2020 2029  els_kwargs.    )
+000311d0: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+000311e0: 2020 2020 2020 2022 2222 4472 6f70 2069         """Drop i
+000311f0: 6e64 6578 206c 6162 656c 7320 6672 6f6d  ndex labels from
+00031200: 2074 6869 7320 6461 7461 7365 742e 0a0a   this dataset...
+00031210: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00031220: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00031230: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6c61  -----.        la
+00031240: 6265 6c73 203a 206d 6170 7069 6e67 206f  bels : mapping o
+00031250: 6620 6861 7368 6162 6c65 2074 6f20 416e  f hashable to An
+00031260: 790a 2020 2020 2020 2020 2020 2020 496e  y.            In
+00031270: 6465 7820 6c61 6265 6c73 2074 6f20 6472  dex labels to dr
+00031280: 6f70 0a20 2020 2020 2020 2065 7272 6f72  op.        error
+00031290: 7320 3a20 7b22 7261 6973 6522 2c20 2269  s : {"raise", "i
+000312a0: 676e 6f72 6522 7d2c 2064 6566 6175 6c74  gnore"}, default
+000312b0: 3a20 2272 6169 7365 220a 2020 2020 2020  : "raise".      
+000312c0: 2020 2020 2020 4966 2027 7261 6973 6527        If 'raise'
+000312d0: 2c20 7261 6973 6573 2061 2056 616c 7565  , raises a Value
+000312e0: 4572 726f 7220 6572 726f 7220 6966 0a20  Error error if. 
+000312f0: 2020 2020 2020 2020 2020 2061 6e79 206f             any o
+00031300: 6620 7468 6520 696e 6465 7820 6c61 6265  f the index labe
+00031310: 6c73 2070 6173 7365 6420 6172 6520 6e6f  ls passed are no
+00031320: 740a 2020 2020 2020 2020 2020 2020 696e  t.            in
+00031330: 2074 6865 2064 6174 6173 6574 2e20 4966   the dataset. If
+00031340: 2027 6967 6e6f 7265 272c 2061 6e79 2067   'ignore', any g
+00031350: 6976 656e 206c 6162 656c 7320 7468 6174  iven labels that
+00031360: 2061 7265 2069 6e20 7468 650a 2020 2020   are in the.    
+00031370: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
+00031380: 6172 6520 6472 6f70 7065 6420 616e 6420  are dropped and 
+00031390: 6e6f 2065 7272 6f72 2069 7320 7261 6973  no error is rais
+000313a0: 6564 2e0a 2020 2020 2020 2020 2a2a 6c61  ed..        **la
+000313b0: 6265 6c73 5f6b 7761 7267 7320 3a20 7b64  bels_kwargs : {d
+000313c0: 696d 3a20 6c61 6265 6c2c 202e 2e2e 7d2c  im: label, ...},
+000313d0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+000313e0: 2020 2020 2020 5468 6520 6b65 7977 6f72        The keywor
+000313f0: 6420 6172 6775 6d65 6e74 7320 666f 726d  d arguments form
+00031400: 206f 6620 6060 6469 6d60 6020 616e 6420   of ``dim`` and 
+00031410: 6060 6c61 6265 6c73 6060 0a0a 2020 2020  ``labels``..    
+00031420: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00031430: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00031440: 2020 2020 6472 6f70 7065 6420 3a20 4461      dropped : Da
+00031450: 7461 7365 740a 0a20 2020 2020 2020 2045  taset..        E
+00031460: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
+00031470: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00031480: 203e 3e3e 2064 6174 6120 3d20 6e70 2e61   >>> data = np.a
+00031490: 7261 6e67 6528 3629 2e72 6573 6861 7065  range(6).reshape
+000314a0: 2832 2c20 3329 0a20 2020 2020 2020 203e  (2, 3).        >
+000314b0: 3e3e 206c 6162 656c 7320 3d20 5b22 6122  >> labels = ["a"
+000314c0: 2c20 2262 222c 2022 6322 5d0a 2020 2020  , "b", "c"].    
+000314d0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
+000314e0: 4461 7461 7365 7428 7b22 4122 3a20 285b  Dataset({"A": ([
+000314f0: 2278 222c 2022 7922 5d2c 2064 6174 6129  "x", "y"], data)
+00031500: 2c20 2279 223a 206c 6162 656c 737d 290a  , "y": labels}).
+00031510: 2020 2020 2020 2020 3e3e 3e20 6473 0a20          >>> ds. 
+00031520: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+00031530: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+00031540: 4469 6d65 6e73 696f 6e73 3a20 2028 783a  Dimensions:  (x:
+00031550: 2032 2c20 793a 2033 290a 2020 2020 2020   2, y: 3).      
+00031560: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+00031570: 2020 2020 2020 2020 202a 2079 2020 2020           * y    
+00031580: 2020 2020 2879 2920 3c55 3120 2761 2720      (y) <U1 'a' 
+00031590: 2762 2720 2763 270a 2020 2020 2020 2020  'b' 'c'.        
+000315a0: 4469 6d65 6e73 696f 6e73 2077 6974 686f  Dimensions witho
+000315b0: 7574 2063 6f6f 7264 696e 6174 6573 3a20  ut coordinates: 
+000315c0: 780a 2020 2020 2020 2020 4461 7461 2076  x.        Data v
+000315d0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+000315e0: 2020 2020 2020 4120 2020 2020 2020 2028        A        (
+000315f0: 782c 2079 2920 696e 7436 3420 3020 3120  x, y) int64 0 1 
+00031600: 3220 3320 3420 350a 2020 2020 2020 2020  2 3 4 5.        
+00031610: 3e3e 3e20 6473 2e64 726f 705f 7365 6c28  >>> ds.drop_sel(
+00031620: 793d 5b22 6122 2c20 2263 225d 290a 2020  y=["a", "c"]).  
+00031630: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+00031640: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+00031650: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
+00031660: 322c 2079 3a20 3129 0a20 2020 2020 2020  2, y: 1).       
+00031670: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00031680: 2020 2020 2020 2020 2a20 7920 2020 2020          * y     
+00031690: 2020 2028 7929 203c 5531 2027 6227 0a20     (y) <U1 'b'. 
+000316a0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+000316b0: 7320 7769 7468 6f75 7420 636f 6f72 6469  s without coordi
+000316c0: 6e61 7465 733a 2078 0a20 2020 2020 2020  nates: x.       
+000316d0: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
+000316e0: 0a20 2020 2020 2020 2020 2020 2041 2020  .            A  
+000316f0: 2020 2020 2020 2878 2c20 7929 2069 6e74        (x, y) int
+00031700: 3634 2031 2034 0a20 2020 2020 2020 203e  64 1 4.        >
+00031710: 3e3e 2064 732e 6472 6f70 5f73 656c 2879  >> ds.drop_sel(y
+00031720: 3d22 6222 290a 2020 2020 2020 2020 3c78  ="b").        <x
+00031730: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+00031740: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+00031750: 733a 2020 2878 3a20 322c 2079 3a20 3229  s:  (x: 2, y: 2)
+00031760: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
+00031770: 6174 6573 3a0a 2020 2020 2020 2020 2020  ates:.          
+00031780: 2a20 7920 2020 2020 2020 2028 7929 203c  * y        (y) <
+00031790: 5531 2027 6127 2027 6327 0a20 2020 2020  U1 'a' 'c'.     
+000317a0: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
+000317b0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
+000317c0: 733a 2078 0a20 2020 2020 2020 2044 6174  s: x.        Dat
+000317d0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+000317e0: 2020 2020 2020 2020 2041 2020 2020 2020           A      
+000317f0: 2020 2878 2c20 7929 2069 6e74 3634 2030    (x, y) int64 0
+00031800: 2032 2033 2035 0a20 2020 2020 2020 2022   2 3 5.        "
+00031810: 2222 0a20 2020 2020 2020 2069 6620 6572  "".        if er
+00031820: 726f 7273 206e 6f74 2069 6e20 5b22 7261  rors not in ["ra
+00031830: 6973 6522 2c20 2269 676e 6f72 6522 5d3a  ise", "ignore"]:
+00031840: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00031850: 7365 2056 616c 7565 4572 726f 7228 2765  se ValueError('e
+00031860: 7272 6f72 7320 6d75 7374 2062 6520 6569  rrors must be ei
+00031870: 7468 6572 2022 7261 6973 6522 206f 7220  ther "raise" or 
+00031880: 2269 676e 6f72 6522 2729 0a0a 2020 2020  "ignore"')..    
+00031890: 2020 2020 6c61 6265 6c73 203d 2065 6974      labels = eit
+000318a0: 6865 725f 6469 6374 5f6f 725f 6b77 6172  her_dict_or_kwar
+000318b0: 6773 286c 6162 656c 732c 206c 6162 656c  gs(labels, label
+000318c0: 735f 6b77 6172 6773 2c20 2264 726f 705f  s_kwargs, "drop_
+000318d0: 7365 6c22 290a 0a20 2020 2020 2020 2064  sel")..        d
+000318e0: 7320 3d20 7365 6c66 0a20 2020 2020 2020  s = self.       
+000318f0: 2066 6f72 2064 696d 2c20 6c61 6265 6c73   for dim, labels
+00031900: 5f66 6f72 5f64 696d 2069 6e20 6c61 6265  _for_dim in labe
+00031910: 6c73 2e69 7465 6d73 2829 3a0a 2020 2020  ls.items():.    
+00031920: 2020 2020 2020 2020 2320 446f 6e27 7420          # Don't 
+00031930: 6361 7374 2074 6f20 7365 742c 2061 7320  cast to set, as 
+00031940: 6974 2077 6f75 6c64 2068 6172 6d20 7065  it would harm pe
+00031950: 7266 6f72 6d61 6e63 6520 7768 656e 206c  rformance when l
+00031960: 6162 656c 730a 2020 2020 2020 2020 2020  abels.          
+00031970: 2020 2320 6973 2061 206c 6172 6765 206e    # is a large n
+00031980: 756d 7079 2061 7272 6179 0a20 2020 2020  umpy array.     
+00031990: 2020 2020 2020 2069 6620 7574 696c 732e         if utils.
+000319a0: 6973 5f73 6361 6c61 7228 6c61 6265 6c73  is_scalar(labels
+000319b0: 5f66 6f72 5f64 696d 293a 0a20 2020 2020  _for_dim):.     
+000319c0: 2020 2020 2020 2020 2020 206c 6162 656c             label
+000319d0: 735f 666f 725f 6469 6d20 3d20 5b6c 6162  s_for_dim = [lab
+000319e0: 656c 735f 666f 725f 6469 6d5d 0a20 2020  els_for_dim].   
+000319f0: 2020 2020 2020 2020 206c 6162 656c 735f           labels_
+00031a00: 666f 725f 6469 6d20 3d20 6e70 2e61 7361  for_dim = np.asa
+00031a10: 7272 6179 286c 6162 656c 735f 666f 725f  rray(labels_for_
+00031a20: 6469 6d29 0a20 2020 2020 2020 2020 2020  dim).           
+00031a30: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00031a40: 2020 2020 2020 696e 6465 7820 3d20 7365        index = se
+00031a50: 6c66 2e67 6574 5f69 6e64 6578 2864 696d  lf.get_index(dim
+00031a60: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+00031a70: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
+00031a80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00031a90: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00031aa0: 6622 6469 6d65 6e73 696f 6e20 7b64 696d  f"dimension {dim
+00031ab0: 2172 7d20 646f 6573 206e 6f74 2068 6176  !r} does not hav
+00031ac0: 6520 636f 6f72 6469 6e61 7465 206c 6162  e coordinate lab
+00031ad0: 656c 7322 290a 2020 2020 2020 2020 2020  els").          
+00031ae0: 2020 6e65 775f 696e 6465 7820 3d20 696e    new_index = in
+00031af0: 6465 782e 6472 6f70 286c 6162 656c 735f  dex.drop(labels_
+00031b00: 666f 725f 6469 6d2c 2065 7272 6f72 733d  for_dim, errors=
+00031b10: 6572 726f 7273 290a 2020 2020 2020 2020  errors).        
+00031b20: 2020 2020 6473 203d 2064 732e 6c6f 635b      ds = ds.loc[
+00031b30: 7b64 696d 3a20 6e65 775f 696e 6465 787d  {dim: new_index}
+00031b40: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+00031b50: 2064 730a 0a20 2020 2064 6566 2064 726f   ds..    def dro
+00031b60: 705f 6973 656c 2873 656c 663a 2054 5f44  p_isel(self: T_D
+00031b70: 6174 6173 6574 2c20 696e 6465 7865 7273  ataset, indexers
+00031b80: 3d4e 6f6e 652c 202a 2a69 6e64 6578 6572  =None, **indexer
+00031b90: 735f 6b77 6172 6773 2920 2d3e 2054 5f44  s_kwargs) -> T_D
+00031ba0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+00031bb0: 2222 2244 726f 7020 696e 6465 7820 706f  """Drop index po
+00031bc0: 7369 7469 6f6e 7320 6672 6f6d 2074 6869  sitions from thi
+00031bd0: 7320 4461 7461 7365 742e 0a0a 2020 2020  s Dataset...    
+00031be0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00031bf0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00031c00: 2d0a 2020 2020 2020 2020 696e 6465 7865  -.        indexe
+00031c10: 7273 203a 206d 6170 7069 6e67 206f 6620  rs : mapping of 
+00031c20: 6861 7368 6162 6c65 2074 6f20 416e 790a  hashable to Any.
+00031c30: 2020 2020 2020 2020 2020 2020 496e 6465              Inde
+00031c40: 7820 6c6f 6361 7469 6f6e 7320 746f 2064  x locations to d
+00031c50: 726f 700a 2020 2020 2020 2020 2a2a 696e  rop.        **in
+00031c60: 6465 7865 7273 5f6b 7761 7267 7320 3a20  dexers_kwargs : 
+00031c70: 7b64 696d 3a20 706f 7369 7469 6f6e 2c20  {dim: position, 
+00031c80: 2e2e 2e7d 2c20 6f70 7469 6f6e 616c 0a20  ...}, optional. 
+00031c90: 2020 2020 2020 2020 2020 2054 6865 206b             The k
+00031ca0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00031cb0: 2066 6f72 6d20 6f66 2060 6064 696d 6060   form of ``dim``
+00031cc0: 2061 6e64 2060 6070 6f73 6974 696f 6e73   and ``positions
+00031cd0: 6060 0a0a 2020 2020 2020 2020 5265 7475  ``..        Retu
+00031ce0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00031cf0: 2d2d 2d0a 2020 2020 2020 2020 6472 6f70  ---.        drop
+00031d00: 7065 6420 3a20 4461 7461 7365 740a 0a20  ped : Dataset.. 
+00031d10: 2020 2020 2020 2052 6169 7365 730a 2020         Raises.  
+00031d20: 2020 2020 2020 2d2d 2d2d 2d2d 0a20 2020        ------.   
+00031d30: 2020 2020 2049 6e64 6578 4572 726f 720a       IndexError.
+00031d40: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
+00031d50: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00031d60: 2d2d 0a20 2020 2020 2020 203e 3e3e 2064  --.        >>> d
+00031d70: 6174 6120 3d20 6e70 2e61 7261 6e67 6528  ata = np.arange(
+00031d80: 3629 2e72 6573 6861 7065 2832 2c20 3329  6).reshape(2, 3)
+00031d90: 0a20 2020 2020 2020 203e 3e3e 206c 6162  .        >>> lab
+00031da0: 656c 7320 3d20 5b22 6122 2c20 2262 222c  els = ["a", "b",
+00031db0: 2022 6322 5d0a 2020 2020 2020 2020 3e3e   "c"].        >>
+00031dc0: 3e20 6473 203d 2078 722e 4461 7461 7365  > ds = xr.Datase
+00031dd0: 7428 7b22 4122 3a20 285b 2278 222c 2022  t({"A": (["x", "
+00031de0: 7922 5d2c 2064 6174 6129 2c20 2279 223a  y"], data), "y":
+00031df0: 206c 6162 656c 737d 290a 2020 2020 2020   labels}).      
+00031e00: 2020 3e3e 3e20 6473 0a20 2020 2020 2020    >>> ds.       
+00031e10: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+00031e20: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+00031e30: 696f 6e73 3a20 2028 783a 2032 2c20 793a  ions:  (x: 2, y:
+00031e40: 2033 290a 2020 2020 2020 2020 436f 6f72   3).        Coor
+00031e50: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
+00031e60: 2020 202a 2079 2020 2020 2020 2020 2879     * y        (y
+00031e70: 2920 3c55 3120 2761 2720 2762 2720 2763  ) <U1 'a' 'b' 'c
+00031e80: 270a 2020 2020 2020 2020 4469 6d65 6e73  '.        Dimens
+00031e90: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
+00031ea0: 7264 696e 6174 6573 3a20 780a 2020 2020  rdinates: x.    
+00031eb0: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
+00031ec0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00031ed0: 4120 2020 2020 2020 2028 782c 2079 2920  A        (x, y) 
+00031ee0: 696e 7436 3420 3020 3120 3220 3320 3420  int64 0 1 2 3 4 
+00031ef0: 350a 2020 2020 2020 2020 3e3e 3e20 6473  5.        >>> ds
+00031f00: 2e64 726f 705f 6973 656c 2879 3d5b 302c  .drop_isel(y=[0,
+00031f10: 2032 5d29 0a20 2020 2020 2020 203c 7861   2]).        <xa
+00031f20: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+00031f30: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+00031f40: 3a20 2028 783a 2032 2c20 793a 2031 290a  :  (x: 2, y: 1).
+00031f50: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
+00031f60: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
+00031f70: 2079 2020 2020 2020 2020 2879 2920 3c55   y        (y) <U
+00031f80: 3120 2762 270a 2020 2020 2020 2020 4469  1 'b'.        Di
+00031f90: 6d65 6e73 696f 6e73 2077 6974 686f 7574  mensions without
+00031fa0: 2063 6f6f 7264 696e 6174 6573 3a20 780a   coordinates: x.
+00031fb0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+00031fc0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+00031fd0: 2020 2020 4120 2020 2020 2020 2028 782c      A        (x,
+00031fe0: 2079 2920 696e 7436 3420 3120 340a 2020   y) int64 1 4.  
+00031ff0: 2020 2020 2020 3e3e 3e20 6473 2e64 726f        >>> ds.dro
+00032000: 705f 6973 656c 2879 3d31 290a 2020 2020  p_isel(y=1).    
+00032010: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+00032020: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
+00032030: 656e 7369 6f6e 733a 2020 2878 3a20 322c  ensions:  (x: 2,
+00032040: 2079 3a20 3229 0a20 2020 2020 2020 2043   y: 2).        C
+00032050: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+00032060: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
+00032070: 2028 7929 203c 5531 2027 6127 2027 6327   (y) <U1 'a' 'c'
+00032080: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00032090: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
+000320a0: 6469 6e61 7465 733a 2078 0a20 2020 2020  dinates: x.     
+000320b0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+000320c0: 733a 0a20 2020 2020 2020 2020 2020 2041  s:.            A
+000320d0: 2020 2020 2020 2020 2878 2c20 7929 2069          (x, y) i
+000320e0: 6e74 3634 2030 2032 2033 2035 0a20 2020  nt64 0 2 3 5.   
+000320f0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00032100: 2020 696e 6465 7865 7273 203d 2065 6974    indexers = eit
+00032110: 6865 725f 6469 6374 5f6f 725f 6b77 6172  her_dict_or_kwar
+00032120: 6773 2869 6e64 6578 6572 732c 2069 6e64  gs(indexers, ind
+00032130: 6578 6572 735f 6b77 6172 6773 2c20 2264  exers_kwargs, "d
+00032140: 726f 705f 6973 656c 2229 0a0a 2020 2020  rop_isel")..    
+00032150: 2020 2020 6473 203d 2073 656c 660a 2020      ds = self.  
+00032160: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
+00032170: 696e 6465 7820 3d20 7b7d 0a20 2020 2020  index = {}.     
+00032180: 2020 2066 6f72 2064 696d 2c20 706f 735f     for dim, pos_
+00032190: 666f 725f 6469 6d20 696e 2069 6e64 6578  for_dim in index
+000321a0: 6572 732e 6974 656d 7328 293a 0a20 2020  ers.items():.   
+000321b0: 2020 2020 2020 2020 2023 2044 6f6e 2774           # Don't
+000321c0: 2063 6173 7420 746f 2073 6574 2c20 6173   cast to set, as
+000321d0: 2069 7420 776f 756c 6420 6861 726d 2070   it would harm p
+000321e0: 6572 666f 726d 616e 6365 2077 6865 6e20  erformance when 
+000321f0: 6c61 6265 6c73 0a20 2020 2020 2020 2020  labels.         
+00032200: 2020 2023 2069 7320 6120 6c61 7267 6520     # is a large 
+00032210: 6e75 6d70 7920 6172 7261 790a 2020 2020  numpy array.    
+00032220: 2020 2020 2020 2020 6966 2075 7469 6c73          if utils
+00032230: 2e69 735f 7363 616c 6172 2870 6f73 5f66  .is_scalar(pos_f
+00032240: 6f72 5f64 696d 293a 0a20 2020 2020 2020  or_dim):.       
+00032250: 2020 2020 2020 2020 2070 6f73 5f66 6f72           pos_for
+00032260: 5f64 696d 203d 205b 706f 735f 666f 725f  _dim = [pos_for_
+00032270: 6469 6d5d 0a20 2020 2020 2020 2020 2020  dim].           
+00032280: 2070 6f73 5f66 6f72 5f64 696d 203d 206e   pos_for_dim = n
+00032290: 702e 6173 6172 7261 7928 706f 735f 666f  p.asarray(pos_fo
+000322a0: 725f 6469 6d29 0a20 2020 2020 2020 2020  r_dim).         
+000322b0: 2020 2069 6e64 6578 203d 2073 656c 662e     index = self.
+000322c0: 6765 745f 696e 6465 7828 6469 6d29 0a20  get_index(dim). 
+000322d0: 2020 2020 2020 2020 2020 206e 6577 5f69             new_i
+000322e0: 6e64 6578 203d 2069 6e64 6578 2e64 656c  ndex = index.del
+000322f0: 6574 6528 706f 735f 666f 725f 6469 6d29  ete(pos_for_dim)
+00032300: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00032310: 656e 7369 6f6e 5f69 6e64 6578 5b64 696d  ension_index[dim
+00032320: 5d20 3d20 6e65 775f 696e 6465 780a 2020  ] = new_index.  
+00032330: 2020 2020 2020 6473 203d 2064 732e 6c6f        ds = ds.lo
+00032340: 635b 6469 6d65 6e73 696f 6e5f 696e 6465  c[dimension_inde
+00032350: 785d 0a20 2020 2020 2020 2072 6574 7572  x].        retur
+00032360: 6e20 6473 0a0a 2020 2020 6465 6620 6472  n ds..    def dr
+00032370: 6f70 5f64 696d 7328 0a20 2020 2020 2020  op_dims(.       
+00032380: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
+00032390: 2c0a 2020 2020 2020 2020 6472 6f70 5f64  ,.        drop_d
+000323a0: 696d 733a 2073 7472 207c 2049 7465 7261  ims: str | Itera
+000323b0: 626c 655b 4861 7368 6162 6c65 5d2c 0a20  ble[Hashable],. 
+000323c0: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
+000323d0: 2020 6572 726f 7273 3a20 4572 726f 724f    errors: ErrorO
+000323e0: 7074 696f 6e73 203d 2022 7261 6973 6522  ptions = "raise"
+000323f0: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
+00032400: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
+00032410: 2244 726f 7020 6469 6d65 6e73 696f 6e73  "Drop dimensions
+00032420: 2061 6e64 2061 7373 6f63 6961 7465 6420   and associated 
+00032430: 7661 7269 6162 6c65 7320 6672 6f6d 2074  variables from t
+00032440: 6869 7320 6461 7461 7365 742e 0a0a 2020  his dataset...  
+00032450: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00032460: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00032470: 2d2d 2d0a 2020 2020 2020 2020 6472 6f70  ---.        drop
+00032480: 5f64 696d 7320 3a20 7374 7220 6f72 2049  _dims : str or I
+00032490: 7465 7261 626c 6520 6f66 2048 6173 6861  terable of Hasha
+000324a0: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+000324b0: 4469 6d65 6e73 696f 6e20 6f72 2064 696d  Dimension or dim
+000324c0: 656e 7369 6f6e 7320 746f 2064 726f 702e  ensions to drop.
+000324d0: 0a20 2020 2020 2020 2065 7272 6f72 7320  .        errors 
+000324e0: 3a20 7b22 7261 6973 6522 2c20 2269 676e  : {"raise", "ign
+000324f0: 6f72 6522 7d2c 2064 6566 6175 6c74 3a20  ore"}, default: 
+00032500: 2272 6169 7365 220a 2020 2020 2020 2020  "raise".        
+00032510: 2020 2020 4966 2027 7261 6973 6527 2c20      If 'raise', 
+00032520: 7261 6973 6573 2061 2056 616c 7565 4572  raises a ValueEr
+00032530: 726f 7220 6572 726f 7220 6966 2061 6e79  ror error if any
+00032540: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
+00032550: 2020 2020 6469 6d65 6e73 696f 6e73 2070      dimensions p
+00032560: 6173 7365 6420 6172 6520 6e6f 7420 696e  assed are not in
+00032570: 2074 6865 2064 6174 6173 6574 2e20 4966   the dataset. If
+00032580: 2027 6967 6e6f 7265 272c 2061 6e79 2067   'ignore', any g
+00032590: 6976 656e 0a20 2020 2020 2020 2020 2020  iven.           
+000325a0: 2064 696d 656e 7369 6f6e 7320 7468 6174   dimensions that
+000325b0: 2061 7265 2069 6e20 7468 6520 6461 7461   are in the data
+000325c0: 7365 7420 6172 6520 6472 6f70 7065 6420  set are dropped 
+000325d0: 616e 6420 6e6f 2065 7272 6f72 2069 7320  and no error is 
+000325e0: 7261 6973 6564 2e0a 0a20 2020 2020 2020  raised...       
+000325f0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+00032600: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+00032610: 206f 626a 203a 2044 6174 6173 6574 0a20   obj : Dataset. 
+00032620: 2020 2020 2020 2020 2020 2054 6865 2064             The d
+00032630: 6174 6173 6574 2077 6974 686f 7574 2074  ataset without t
+00032640: 6865 2067 6976 656e 2064 696d 656e 7369  he given dimensi
+00032650: 6f6e 7320 286f 7220 616e 7920 7661 7269  ons (or any vari
+00032660: 6162 6c65 730a 2020 2020 2020 2020 2020  ables.          
+00032670: 2020 636f 6e74 6169 6e69 6e67 2074 686f    containing tho
+00032680: 7365 2064 696d 656e 7369 6f6e 7329 2e0a  se dimensions)..
+00032690: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000326a0: 2020 2020 6966 2065 7272 6f72 7320 6e6f      if errors no
+000326b0: 7420 696e 205b 2272 6169 7365 222c 2022  t in ["raise", "
+000326c0: 6967 6e6f 7265 225d 3a0a 2020 2020 2020  ignore"]:.      
+000326d0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000326e0: 6545 7272 6f72 2827 6572 726f 7273 206d  eError('errors m
+000326f0: 7573 7420 6265 2065 6974 6865 7220 2272  ust be either "r
+00032700: 6169 7365 2220 6f72 2022 6967 6e6f 7265  aise" or "ignore
+00032710: 2227 290a 0a20 2020 2020 2020 2069 6620  "')..        if 
+00032720: 6973 696e 7374 616e 6365 2864 726f 705f  isinstance(drop_
+00032730: 6469 6d73 2c20 7374 7229 206f 7220 6e6f  dims, str) or no
+00032740: 7420 6973 696e 7374 616e 6365 2864 726f  t isinstance(dro
+00032750: 705f 6469 6d73 2c20 4974 6572 6162 6c65  p_dims, Iterable
+00032760: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
+00032770: 726f 705f 6469 6d73 203d 207b 6472 6f70  rop_dims = {drop
+00032780: 5f64 696d 737d 0a20 2020 2020 2020 2065  _dims}.        e
+00032790: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000327a0: 2064 726f 705f 6469 6d73 203d 2073 6574   drop_dims = set
+000327b0: 2864 726f 705f 6469 6d73 290a 0a20 2020  (drop_dims)..   
+000327c0: 2020 2020 2069 6620 6572 726f 7273 203d       if errors =
+000327d0: 3d20 2272 6169 7365 223a 0a20 2020 2020  = "raise":.     
+000327e0: 2020 2020 2020 206d 6973 7369 6e67 5f64         missing_d
+000327f0: 696d 7320 3d20 6472 6f70 5f64 696d 7320  ims = drop_dims 
+00032800: 2d20 7365 7428 7365 6c66 2e64 696d 7329  - set(self.dims)
+00032810: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00032820: 6d69 7373 696e 675f 6469 6d73 3a0a 2020  missing_dims:.  
+00032830: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00032840: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00032850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032860: 2020 2020 6622 4461 7461 7365 7420 646f      f"Dataset do
+00032870: 6573 206e 6f74 2063 6f6e 7461 696e 2074  es not contain t
+00032880: 6865 2064 696d 656e 7369 6f6e 733a 207b  he dimensions: {
+00032890: 6d69 7373 696e 675f 6469 6d73 7d22 0a20  missing_dims}". 
+000328a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000328b0: 0a0a 2020 2020 2020 2020 6472 6f70 5f76  ..        drop_v
+000328c0: 6172 7320 3d20 7b6b 2066 6f72 206b 2c20  ars = {k for k, 
+000328d0: 7620 696e 2073 656c 662e 5f76 6172 6961  v in self._varia
+000328e0: 626c 6573 2e69 7465 6d73 2829 2069 6620  bles.items() if 
+000328f0: 7365 7428 762e 6469 6d73 2920 2620 6472  set(v.dims) & dr
+00032900: 6f70 5f64 696d 737d 0a20 2020 2020 2020  op_dims}.       
+00032910: 2072 6574 7572 6e20 7365 6c66 2e64 726f   return self.dro
+00032920: 705f 7661 7273 2864 726f 705f 7661 7273  p_vars(drop_vars
+00032930: 290a 0a20 2020 2064 6566 2074 7261 6e73  )..    def trans
+00032940: 706f 7365 280a 2020 2020 2020 2020 7365  pose(.        se
+00032950: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
+00032960: 2020 2020 2020 202a 6469 6d73 3a20 4861         *dims: Ha
+00032970: 7368 6162 6c65 2c0a 2020 2020 2020 2020  shable,.        
+00032980: 6d69 7373 696e 675f 6469 6d73 3a20 4572  missing_dims: Er
+00032990: 726f 724f 7074 696f 6e73 5769 7468 5761  rorOptionsWithWa
+000329a0: 726e 203d 2022 7261 6973 6522 2c0a 2020  rn = "raise",.  
+000329b0: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
+000329c0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+000329d0: 7572 6e20 6120 6e65 7720 4461 7461 7365  urn a new Datase
+000329e0: 7420 6f62 6a65 6374 2077 6974 6820 616c  t object with al
+000329f0: 6c20 6172 7261 7920 6469 6d65 6e73 696f  l array dimensio
+00032a00: 6e73 2074 7261 6e73 706f 7365 642e 0a0a  ns transposed...
+00032a10: 2020 2020 2020 2020 416c 7468 6f75 6768          Although
+00032a20: 2074 6865 206f 7264 6572 206f 6620 6469   the order of di
+00032a30: 6d65 6e73 696f 6e73 206f 6e20 6561 6368  mensions on each
+00032a40: 2061 7272 6179 2077 696c 6c20 6368 616e   array will chan
+00032a50: 6765 2c20 7468 6520 6461 7461 7365 740a  ge, the dataset.
+00032a60: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
+00032a70: 6e73 2074 6865 6d73 656c 7665 7320 7769  ns themselves wi
+00032a80: 6c6c 2072 656d 6169 6e20 696e 2066 6978  ll remain in fix
+00032a90: 6564 2028 736f 7274 6564 2920 6f72 6465  ed (sorted) orde
+00032aa0: 722e 0a0a 2020 2020 2020 2020 5061 7261  r...        Para
+00032ab0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00032ac0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00032ad0: 2020 2a64 696d 7320 3a20 6861 7368 6162    *dims : hashab
+00032ae0: 6c65 2c20 6f70 7469 6f6e 616c 0a20 2020  le, optional.   
+00032af0: 2020 2020 2020 2020 2042 7920 6465 6661           By defa
+00032b00: 756c 742c 2072 6576 6572 7365 2074 6865  ult, reverse the
+00032b10: 2064 696d 656e 7369 6f6e 7320 6f6e 2065   dimensions on e
+00032b20: 6163 6820 6172 7261 792e 204f 7468 6572  ach array. Other
+00032b30: 7769 7365 2c0a 2020 2020 2020 2020 2020  wise,.          
+00032b40: 2020 7265 6f72 6465 7220 7468 6520 6469    reorder the di
+00032b50: 6d65 6e73 696f 6e73 2074 6f20 7468 6973  mensions to this
+00032b60: 206f 7264 6572 2e0a 2020 2020 2020 2020   order..        
+00032b70: 6d69 7373 696e 675f 6469 6d73 203a 207b  missing_dims : {
+00032b80: 2272 6169 7365 222c 2022 7761 726e 222c  "raise", "warn",
+00032b90: 2022 6967 6e6f 7265 227d 2c20 6465 6661   "ignore"}, defa
+00032ba0: 756c 743a 2022 7261 6973 6522 0a20 2020  ult: "raise".   
+00032bb0: 2020 2020 2020 2020 2057 6861 7420 746f           What to
+00032bc0: 2064 6f20 6966 2064 696d 656e 7369 6f6e   do if dimension
+00032bd0: 7320 7468 6174 2073 686f 756c 6420 6265  s that should be
+00032be0: 2073 656c 6563 7465 6420 6672 6f6d 2061   selected from a
+00032bf0: 7265 206e 6f74 2070 7265 7365 6e74 2069  re not present i
+00032c00: 6e20 7468 650a 2020 2020 2020 2020 2020  n the.          
+00032c10: 2020 4461 7461 7365 743a 0a20 2020 2020    Dataset:.     
+00032c20: 2020 2020 2020 202d 2022 7261 6973 6522         - "raise"
+00032c30: 3a20 7261 6973 6520 616e 2065 7863 6570  : raise an excep
+00032c40: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+00032c50: 202d 2022 7761 726e 223a 2072 6169 7365   - "warn": raise
+00032c60: 2061 2077 6172 6e69 6e67 2c20 616e 6420   a warning, and 
+00032c70: 6967 6e6f 7265 2074 6865 206d 6973 7369  ignore the missi
+00032c80: 6e67 2064 696d 656e 7369 6f6e 730a 2020  ng dimensions.  
+00032c90: 2020 2020 2020 2020 2020 2d20 2269 676e            - "ign
+00032ca0: 6f72 6522 3a20 6967 6e6f 7265 2074 6865  ore": ignore the
+00032cb0: 206d 6973 7369 6e67 2064 696d 656e 7369   missing dimensi
+00032cc0: 6f6e 730a 0a20 2020 2020 2020 2052 6574  ons..        Ret
+00032cd0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00032ce0: 2d2d 2d2d 0a20 2020 2020 2020 2074 7261  ----.        tra
+00032cf0: 6e73 706f 7365 6420 3a20 4461 7461 7365  nsposed : Datase
+00032d00: 740a 2020 2020 2020 2020 2020 2020 4561  t.            Ea
+00032d10: 6368 2061 7272 6179 2069 6e20 7468 6520  ch array in the 
+00032d20: 6461 7461 7365 7420 2869 6e63 6c75 6469  dataset (includi
+00032d30: 6e67 2920 636f 6f72 6469 6e61 7465 7320  ng) coordinates 
+00032d40: 7769 6c6c 2062 650a 2020 2020 2020 2020  will be.        
+00032d50: 2020 2020 7472 616e 7370 6f73 6564 2074      transposed t
+00032d60: 6f20 7468 6520 6769 7665 6e20 6f72 6465  o the given orde
+00032d70: 722e 0a0a 2020 2020 2020 2020 4e6f 7465  r...        Note
+00032d80: 730a 2020 2020 2020 2020 2d2d 2d2d 2d0a  s.        -----.
+00032d90: 2020 2020 2020 2020 5468 6973 206f 7065          This ope
+00032da0: 7261 7469 6f6e 2072 6574 7572 6e73 2061  ration returns a
+00032db0: 2076 6965 7720 6f66 2065 6163 6820 6172   view of each ar
+00032dc0: 7261 7927 7320 6461 7461 2e20 4974 2069  ray's data. It i
+00032dd0: 730a 2020 2020 2020 2020 6c61 7a79 2066  s.        lazy f
+00032de0: 6f72 2064 6173 6b2d 6261 636b 6564 2044  or dask-backed D
+00032df0: 6174 6141 7272 6179 7320 6275 7420 6e6f  ataArrays but no
+00032e00: 7420 666f 7220 6e75 6d70 792d 6261 636b  t for numpy-back
+00032e10: 6564 2044 6174 6141 7272 6179 730a 2020  ed DataArrays.  
+00032e20: 2020 2020 2020 2d2d 2074 6865 2064 6174        -- the dat
+00032e30: 6120 7769 6c6c 2062 6520 6675 6c6c 7920  a will be fully 
+00032e40: 6c6f 6164 6564 2069 6e74 6f20 6d65 6d6f  loaded into memo
+00032e50: 7279 2e0a 0a20 2020 2020 2020 2053 6565  ry...        See
+00032e60: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00032e70: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206e  ------.        n
+00032e80: 756d 7079 2e74 7261 6e73 706f 7365 0a20  umpy.transpose. 
+00032e90: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
+00032ea0: 2e74 7261 6e73 706f 7365 0a20 2020 2020  .transpose.     
+00032eb0: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+00032ec0: 2052 6169 7365 2065 7272 6f72 2069 6620   Raise error if 
+00032ed0: 6c69 7374 2069 7320 7061 7373 6564 2061  list is passed a
+00032ee0: 7320 6469 6d73 0a20 2020 2020 2020 2069  s dims.        i
+00032ef0: 6620 286c 656e 2864 696d 7329 203e 2030  f (len(dims) > 0
+00032f00: 2920 616e 6420 2869 7369 6e73 7461 6e63  ) and (isinstanc
+00032f10: 6528 6469 6d73 5b30 5d2c 206c 6973 7429  e(dims[0], list)
+00032f20: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
+00032f30: 6973 745f 6669 7820 3d20 5b66 227b 7265  ist_fix = [f"{re
+00032f40: 7072 2878 297d 2220 6966 2069 7369 6e73  pr(x)}" if isins
+00032f50: 7461 6e63 6528 782c 2073 7472 2920 656c  tance(x, str) el
+00032f60: 7365 2066 227b 787d 2220 666f 7220 7820  se f"{x}" for x 
+00032f70: 696e 2064 696d 735b 305d 5d0a 2020 2020  in dims[0]].    
+00032f80: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00032f90: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
+00032fa0: 2020 2020 2020 2020 2066 2774 7261 6e73           f'trans
+00032fb0: 706f 7365 2072 6571 7569 7265 7320 6469  pose requires di
+00032fc0: 6d73 2074 6f20 6265 2070 6173 7365 6420  ms to be passed 
+00032fd0: 6173 206d 756c 7469 706c 6520 6172 6775  as multiple argu
+00032fe0: 6d65 6e74 732e 2045 7870 6563 7465 6420  ments. Expected 
+00032ff0: 607b 222c 2022 2e6a 6f69 6e28 6c69 7374  `{", ".join(list
+00033000: 5f66 6978 297d 602e 2052 6563 6569 7665  _fix)}`. Receive
+00033010: 6420 607b 6469 6d73 5b30 5d7d 6020 696e  d `{dims[0]}` in
+00033020: 7374 6561 6427 0a20 2020 2020 2020 2020  stead'.         
+00033030: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00033040: 5573 6520 696e 6669 785f 6469 6d73 2074  Use infix_dims t
+00033050: 6f20 6368 6563 6b20 6f6e 6365 2066 6f72  o check once for
+00033060: 206d 6973 7369 6e67 2064 696d 656e 7369   missing dimensi
+00033070: 6f6e 730a 2020 2020 2020 2020 6966 206c  ons.        if l
+00033080: 656e 2864 696d 7329 2021 3d20 303a 0a20  en(dims) != 0:. 
+00033090: 2020 2020 2020 2020 2020 205f 203d 206c             _ = l
+000330a0: 6973 7428 696e 6669 785f 6469 6d73 2864  ist(infix_dims(d
+000330b0: 696d 732c 2073 656c 662e 6469 6d73 2c20  ims, self.dims, 
+000330c0: 6d69 7373 696e 675f 6469 6d73 2929 0a0a  missing_dims))..
+000330d0: 2020 2020 2020 2020 6473 203d 2073 656c          ds = sel
+000330e0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+000330f0: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
+00033100: 6e20 7365 6c66 2e5f 7661 7269 6162 6c65  n self._variable
+00033110: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+00033120: 2020 2020 2020 2076 6172 5f64 696d 7320         var_dims 
+00033130: 3d20 7475 706c 6528 6469 6d20 666f 7220  = tuple(dim for 
+00033140: 6469 6d20 696e 2064 696d 7320 6966 2064  dim in dims if d
+00033150: 696d 2069 6e20 2876 6172 2e64 696d 7320  im in (var.dims 
+00033160: 2b20 282e 2e2e 2c29 2929 0a20 2020 2020  + (...,))).     
+00033170: 2020 2020 2020 2064 732e 5f76 6172 6961         ds._varia
+00033180: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
+00033190: 2e74 7261 6e73 706f 7365 282a 7661 725f  .transpose(*var_
+000331a0: 6469 6d73 290a 2020 2020 2020 2020 7265  dims).        re
+000331b0: 7475 726e 2064 730a 0a20 2020 2064 6566  turn ds..    def
+000331c0: 2064 726f 706e 6128 0a20 2020 2020 2020   dropna(.       
+000331d0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
+000331e0: 2c0a 2020 2020 2020 2020 6469 6d3a 2048  ,.        dim: H
+000331f0: 6173 6861 626c 652c 0a20 2020 2020 2020  ashable,.       
+00033200: 2068 6f77 3a20 4c69 7465 7261 6c5b 2261   how: Literal["a
+00033210: 6e79 222c 2022 616c 6c22 5d20 3d20 2261  ny", "all"] = "a
+00033220: 6e79 222c 0a20 2020 2020 2020 2074 6872  ny",.        thr
+00033230: 6573 683a 2069 6e74 207c 204e 6f6e 6520  esh: int | None 
+00033240: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00033250: 7375 6273 6574 3a20 4974 6572 6162 6c65  subset: Iterable
+00033260: 5b48 6173 6861 626c 655d 207c 204e 6f6e  [Hashable] | Non
+00033270: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
+00033280: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+00033290: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+000332a0: 2061 206e 6577 2064 6174 6173 6574 2077   a new dataset w
+000332b0: 6974 6820 6472 6f70 7065 6420 6c61 6265  ith dropped labe
+000332c0: 6c73 2066 6f72 206d 6973 7369 6e67 2076  ls for missing v
+000332d0: 616c 7565 7320 616c 6f6e 670a 2020 2020  alues along.    
+000332e0: 2020 2020 7468 6520 7072 6f76 6964 6564      the provided
+000332f0: 2064 696d 656e 7369 6f6e 2e0a 0a20 2020   dimension...   
+00033300: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00033310: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00033320: 2d2d 0a20 2020 2020 2020 2064 696d 203a  --.        dim :
+00033330: 2068 6173 6861 626c 650a 2020 2020 2020   hashable.      
+00033340: 2020 2020 2020 4469 6d65 6e73 696f 6e20        Dimension 
+00033350: 616c 6f6e 6720 7768 6963 6820 746f 2064  along which to d
+00033360: 726f 7020 6d69 7373 696e 6720 7661 6c75  rop missing valu
+00033370: 6573 2e20 4472 6f70 7069 6e67 2061 6c6f  es. Dropping alo
+00033380: 6e67 0a20 2020 2020 2020 2020 2020 206d  ng.            m
+00033390: 756c 7469 706c 6520 6469 6d65 6e73 696f  ultiple dimensio
+000333a0: 6e73 2073 696d 756c 7461 6e65 6f75 736c  ns simultaneousl
+000333b0: 7920 6973 206e 6f74 2079 6574 2073 7570  y is not yet sup
+000333c0: 706f 7274 6564 2e0a 2020 2020 2020 2020  ported..        
+000333d0: 686f 7720 3a20 7b22 616e 7922 2c20 2261  how : {"any", "a
+000333e0: 6c6c 227d 2c20 6465 6661 756c 743a 2022  ll"}, default: "
+000333f0: 616e 7922 0a20 2020 2020 2020 2020 2020  any".           
+00033400: 202d 2061 6e79 203a 2069 6620 616e 7920   - any : if any 
+00033410: 4e41 2076 616c 7565 7320 6172 6520 7072  NA values are pr
+00033420: 6573 656e 742c 2064 726f 7020 7468 6174  esent, drop that
+00033430: 206c 6162 656c 0a20 2020 2020 2020 2020   label.         
+00033440: 2020 202d 2061 6c6c 203a 2069 6620 616c     - all : if al
+00033450: 6c20 7661 6c75 6573 2061 7265 204e 412c  l values are NA,
+00033460: 2064 726f 7020 7468 6174 206c 6162 656c   drop that label
+00033470: 0a0a 2020 2020 2020 2020 7468 7265 7368  ..        thresh
+00033480: 203a 2069 6e74 206f 7220 4e6f 6e65 2c20   : int or None, 
+00033490: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+000334a0: 2020 2020 2049 6620 7375 7070 6c69 6564       If supplied
+000334b0: 2c20 7265 7175 6972 6520 7468 6973 206d  , require this m
+000334c0: 616e 7920 6e6f 6e2d 4e41 2076 616c 7565  any non-NA value
+000334d0: 7320 2873 756d 6d65 6420 6f76 6572 2061  s (summed over a
+000334e0: 6c6c 2074 6865 2073 7562 7365 7420 7661  ll the subset va
+000334f0: 7269 6162 6c65 7329 2e0a 2020 2020 2020  riables)..      
+00033500: 2020 7375 6273 6574 203a 2069 7465 7261    subset : itera
+00033510: 626c 6520 6f66 2068 6173 6861 626c 6520  ble of hashable 
+00033520: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
+00033530: 6c0a 2020 2020 2020 2020 2020 2020 5768  l.            Wh
+00033540: 6963 6820 7661 7269 6162 6c65 7320 746f  ich variables to
+00033550: 2063 6865 636b 2066 6f72 206d 6973 7369   check for missi
+00033560: 6e67 2076 616c 7565 732e 2042 7920 6465  ng values. By de
+00033570: 6661 756c 742c 2061 6c6c 0a20 2020 2020  fault, all.     
+00033580: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00033590: 2069 6e20 7468 6520 6461 7461 7365 7420   in the dataset 
+000335a0: 6172 6520 6368 6563 6b65 642e 0a0a 2020  are checked...  
+000335b0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+000335c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+000335d0: 2020 2020 2020 4461 7461 7365 740a 2020        Dataset.  
+000335e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000335f0: 2020 2320 544f 444f 3a20 636f 6e73 6964    # TODO: consid
+00033600: 6572 2073 7570 706f 7274 696e 6720 6d75  er supporting mu
+00033610: 6c74 6970 6c65 2064 696d 656e 7369 6f6e  ltiple dimension
+00033620: 733f 204f 7220 6e6f 742c 2067 6976 656e  s? Or not, given
+00033630: 2074 6861 740a 2020 2020 2020 2020 2320   that.        # 
+00033640: 7468 6572 6520 6172 6520 736f 6d65 2075  there are some u
+00033650: 676c 7920 6564 6765 2063 6173 6573 2c20  gly edge cases, 
+00033660: 652e 672e 2c20 7061 6e64 6173 2773 2064  e.g., pandas's d
+00033670: 726f 706e 6120 6469 6666 6572 730a 2020  ropna differs.  
+00033680: 2020 2020 2020 2320 6465 7065 6e64 696e        # dependin
+00033690: 6720 6f6e 2074 6865 206f 7264 6572 206f  g on the order o
+000336a0: 6620 7468 6520 7375 7070 6c69 6564 2061  f the supplied a
+000336b0: 7865 732e 0a0a 2020 2020 2020 2020 6966  xes...        if
+000336c0: 2064 696d 206e 6f74 2069 6e20 7365 6c66   dim not in self
+000336d0: 2e64 696d 733a 0a20 2020 2020 2020 2020  .dims:.         
+000336e0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+000336f0: 726f 7228 6622 7b64 696d 7d20 6d75 7374  ror(f"{dim} must
+00033700: 2062 6520 6120 7369 6e67 6c65 2064 6174   be a single dat
+00033710: 6173 6574 2064 696d 656e 7369 6f6e 2229  aset dimension")
+00033720: 0a0a 2020 2020 2020 2020 6966 2073 7562  ..        if sub
+00033730: 7365 7420 6973 204e 6f6e 653a 0a20 2020  set is None:.   
+00033740: 2020 2020 2020 2020 2073 7562 7365 7420           subset 
+00033750: 3d20 6974 6572 2873 656c 662e 6461 7461  = iter(self.data
+00033760: 5f76 6172 7329 0a0a 2020 2020 2020 2020  _vars)..        
+00033770: 636f 756e 7420 3d20 6e70 2e7a 6572 6f73  count = np.zeros
+00033780: 2873 656c 662e 6469 6d73 5b64 696d 5d2c  (self.dims[dim],
+00033790: 2064 7479 7065 3d6e 702e 696e 7436 3429   dtype=np.int64)
+000337a0: 0a20 2020 2020 2020 2073 697a 6520 3d20  .        size = 
+000337b0: 6e70 2e69 6e74 5f28 3029 2020 2320 666f  np.int_(0)  # fo
+000337c0: 7220 7479 7065 2063 6865 636b 696e 670a  r type checking.
+000337d0: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
+000337e0: 6e20 7375 6273 6574 3a0a 2020 2020 2020  n subset:.      
+000337f0: 2020 2020 2020 6172 7261 7920 3d20 7365        array = se
+00033800: 6c66 2e5f 7661 7269 6162 6c65 735b 6b5d  lf._variables[k]
+00033810: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00033820: 6469 6d20 696e 2061 7272 6179 2e64 696d  dim in array.dim
+00033830: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00033840: 2020 2064 696d 7320 3d20 5b64 2066 6f72     dims = [d for
+00033850: 2064 2069 6e20 6172 7261 792e 6469 6d73   d in array.dims
+00033860: 2069 6620 6420 213d 2064 696d 5d0a 2020   if d != dim].  
+00033870: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00033880: 756e 7420 2b3d 206e 702e 6173 6172 7261  unt += np.asarra
+00033890: 7928 6172 7261 792e 636f 756e 7428 6469  y(array.count(di
+000338a0: 6d73 2929 2020 2320 7479 7065 3a20 6967  ms))  # type: ig
+000338b0: 6e6f 7265 5b61 7474 722d 6465 6669 6e65  nore[attr-define
+000338c0: 645d 0a20 2020 2020 2020 2020 2020 2020  d].             
+000338d0: 2020 2073 697a 6520 2b3d 206d 6174 682e     size += math.
+000338e0: 7072 6f64 285b 7365 6c66 2e64 696d 735b  prod([self.dims[
+000338f0: 645d 2066 6f72 2064 2069 6e20 6469 6d73  d] for d in dims
+00033900: 5d29 0a0a 2020 2020 2020 2020 6966 2074  ])..        if t
+00033910: 6872 6573 6820 6973 206e 6f74 204e 6f6e  hresh is not Non
+00033920: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+00033930: 6173 6b20 3d20 636f 756e 7420 3e3d 2074  ask = count >= t
+00033940: 6872 6573 680a 2020 2020 2020 2020 656c  hresh.        el
+00033950: 6966 2068 6f77 203d 3d20 2261 6e79 223a  if how == "any":
+00033960: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+00033970: 6b20 3d20 636f 756e 7420 3d3d 2073 697a  k = count == siz
+00033980: 650a 2020 2020 2020 2020 656c 6966 2068  e.        elif h
+00033990: 6f77 203d 3d20 2261 6c6c 223a 0a20 2020  ow == "all":.   
+000339a0: 2020 2020 2020 2020 206d 6173 6b20 3d20           mask = 
+000339b0: 636f 756e 7420 3e20 300a 2020 2020 2020  count > 0.      
+000339c0: 2020 656c 6966 2068 6f77 2069 7320 6e6f    elif how is no
+000339d0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000339e0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000339f0: 7272 6f72 2866 2269 6e76 616c 6964 2068  rror(f"invalid h
+00033a00: 6f77 206f 7074 696f 6e3a 207b 686f 777d  ow option: {how}
+00033a10: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
+00033a20: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00033a30: 7365 2054 7970 6545 7272 6f72 2822 6d75  se TypeError("mu
+00033a40: 7374 2073 7065 6369 6679 2068 6f77 206f  st specify how o
+00033a50: 7220 7468 7265 7368 2229 0a0a 2020 2020  r thresh")..    
+00033a60: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00033a70: 6973 656c 287b 6469 6d3a 206d 6173 6b7d  isel({dim: mask}
+00033a80: 290a 0a20 2020 2064 6566 2066 696c 6c6e  )..    def filln
+00033a90: 6128 7365 6c66 3a20 545f 4461 7461 7365  a(self: T_Datase
+00033aa0: 742c 2076 616c 7565 3a20 416e 7929 202d  t, value: Any) -
+00033ab0: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+00033ac0: 2020 2020 2022 2222 4669 6c6c 206d 6973       """Fill mis
+00033ad0: 7369 6e67 2076 616c 7565 7320 696e 2074  sing values in t
+00033ae0: 6869 7320 6f62 6a65 6374 2e0a 0a20 2020  his object...   
+00033af0: 2020 2020 2054 6869 7320 6f70 6572 6174       This operat
+00033b00: 696f 6e20 666f 6c6c 6f77 7320 7468 6520  ion follows the 
+00033b10: 6e6f 726d 616c 2062 726f 6164 6361 7374  normal broadcast
+00033b20: 696e 6720 616e 6420 616c 6967 6e6d 656e  ing and alignmen
+00033b30: 7420 7275 6c65 7320 7468 6174 0a20 2020  t rules that.   
+00033b40: 2020 2020 2078 6172 7261 7920 7573 6573       xarray uses
+00033b50: 2066 6f72 2062 696e 6172 7920 6172 6974   for binary arit
+00033b60: 686d 6574 6963 2c20 6578 6365 7074 2074  hmetic, except t
+00033b70: 6865 2072 6573 756c 7420 6973 2061 6c69  he result is ali
+00033b80: 676e 6564 2074 6f20 7468 6973 0a20 2020  gned to this.   
+00033b90: 2020 2020 206f 626a 6563 7420 2860 606a       object (``j
+00033ba0: 6f69 6e3d 276c 6566 7427 6060 2920 696e  oin='left'``) in
+00033bb0: 7374 6561 6420 6f66 2061 6c69 676e 6564  stead of aligned
+00033bc0: 2074 6f20 7468 6520 696e 7465 7273 6563   to the intersec
+00033bd0: 7469 6f6e 206f 660a 2020 2020 2020 2020  tion of.        
+00033be0: 696e 6465 7820 636f 6f72 6469 6e61 7465  index coordinate
+00033bf0: 7320 2860 606a 6f69 6e3d 2769 6e6e 6572  s (``join='inner
+00033c00: 2760 6029 2e0a 0a20 2020 2020 2020 2050  '``)...        P
+00033c10: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00033c20: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00033c30: 2020 2020 2076 616c 7565 203a 2073 6361       value : sca
+00033c40: 6c61 722c 206e 6461 7272 6179 2c20 4461  lar, ndarray, Da
+00033c50: 7461 4172 7261 792c 2064 6963 7420 6f72  taArray, dict or
+00033c60: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
+00033c70: 2020 2020 2055 7365 6420 746f 2066 696c       Used to fil
+00033c80: 6c20 616c 6c20 6d61 7463 6869 6e67 206d  l all matching m
+00033c90: 6973 7369 6e67 2076 616c 7565 7320 696e  issing values in
+00033ca0: 2074 6869 7320 6461 7461 7365 7427 7320   this dataset's 
+00033cb0: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
+00033cc0: 2076 6172 6961 626c 6573 2e20 5363 616c   variables. Scal
+00033cd0: 6172 732c 206e 6461 7272 6179 7320 6f72  ars, ndarrays or
+00033ce0: 2044 6174 6141 7272 6179 7320 6172 6775   DataArrays argu
+00033cf0: 6d65 6e74 7320 6172 6520 7573 6564 2074  ments are used t
+00033d00: 6f0a 2020 2020 2020 2020 2020 2020 6669  o.            fi
+00033d10: 6c6c 2061 6c6c 2064 6174 6120 7769 7468  ll all data with
+00033d20: 2061 6c69 676e 6564 2063 6f6f 7264 696e   aligned coordin
+00033d30: 6174 6573 2028 666f 7220 4461 7461 4172  ates (for DataAr
+00033d40: 7261 7973 292e 0a20 2020 2020 2020 2020  rays)..         
+00033d50: 2020 2044 6963 7469 6f6e 6172 6965 7320     Dictionaries 
+00033d60: 6f72 2064 6174 6173 6574 7320 6d61 7463  or datasets matc
+00033d70: 6820 6461 7461 2076 6172 6961 626c 6573  h data variables
+00033d80: 2061 6e64 2074 6865 6e20 616c 6967 6e0a   and then align.
+00033d90: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
+00033da0: 6469 6e61 7465 7320 6966 206e 6563 6573  dinates if neces
+00033db0: 7361 7279 2e0a 0a20 2020 2020 2020 2052  sary...        R
+00033dc0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+00033dd0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+00033de0: 6174 6173 6574 0a0a 2020 2020 2020 2020  ataset..        
+00033df0: 4578 616d 706c 6573 0a20 2020 2020 2020  Examples.       
+00033e00: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00033e10: 2020 3e3e 3e20 6473 203d 2078 722e 4461    >>> ds = xr.Da
+00033e20: 7461 7365 7428 0a20 2020 2020 2020 202e  taset(.        .
+00033e30: 2e2e 2020 2020 207b 0a20 2020 2020 2020  ..     {.       
+00033e40: 202e 2e2e 2020 2020 2020 2020 2022 4122   ...         "A"
+00033e50: 3a20 2822 7822 2c20 5b6e 702e 6e61 6e2c  : ("x", [np.nan,
+00033e60: 2032 2c20 6e70 2e6e 616e 2c20 305d 292c   2, np.nan, 0]),
+00033e70: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+00033e80: 2020 2020 2022 4222 3a20 2822 7822 2c20       "B": ("x", 
+00033e90: 5b33 2c20 342c 206e 702e 6e61 6e2c 2031  [3, 4, np.nan, 1
+00033ea0: 5d29 2c0a 2020 2020 2020 2020 2e2e 2e20  ]),.        ... 
+00033eb0: 2020 2020 2020 2020 2243 223a 2028 2278          "C": ("x
+00033ec0: 222c 205b 6e70 2e6e 616e 2c20 6e70 2e6e  ", [np.nan, np.n
+00033ed0: 616e 2c20 6e70 2e6e 616e 2c20 355d 292c  an, np.nan, 5]),
+00033ee0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+00033ef0: 2020 2020 2022 4422 3a20 2822 7822 2c20       "D": ("x", 
+00033f00: 5b6e 702e 6e61 6e2c 2033 2c20 6e70 2e6e  [np.nan, 3, np.n
+00033f10: 616e 2c20 345d 292c 0a20 2020 2020 2020  an, 4]),.       
+00033f20: 202e 2e2e 2020 2020 207d 2c0a 2020 2020   ...     },.    
+00033f30: 2020 2020 2e2e 2e20 2020 2020 636f 6f72      ...     coor
+00033f40: 6473 3d7b 2278 223a 205b 302c 2031 2c20  ds={"x": [0, 1, 
+00033f50: 322c 2033 5d7d 2c0a 2020 2020 2020 2020  2, 3]},.        
+00033f60: 2e2e 2e20 290a 2020 2020 2020 2020 3e3e  ... ).        >>
+00033f70: 3e20 6473 0a20 2020 2020 2020 203c 7861  > ds.        <xa
+00033f80: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+00033f90: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+00033fa0: 3a20 2028 783a 2034 290a 2020 2020 2020  :  (x: 4).      
+00033fb0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+00033fc0: 2020 2020 2020 2020 202a 2078 2020 2020           * x    
+00033fd0: 2020 2020 2878 2920 696e 7436 3420 3020      (x) int64 0 
+00033fe0: 3120 3220 330a 2020 2020 2020 2020 4461  1 2 3.        Da
+00033ff0: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+00034000: 2020 2020 2020 2020 2020 4120 2020 2020            A     
+00034010: 2020 2028 7829 2066 6c6f 6174 3634 206e     (x) float64 n
+00034020: 616e 2032 2e30 206e 616e 2030 2e30 0a20  an 2.0 nan 0.0. 
+00034030: 2020 2020 2020 2020 2020 2042 2020 2020             B    
+00034040: 2020 2020 2878 2920 666c 6f61 7436 3420      (x) float64 
+00034050: 332e 3020 342e 3020 6e61 6e20 312e 300a  3.0 4.0 nan 1.0.
+00034060: 2020 2020 2020 2020 2020 2020 4320 2020              C   
+00034070: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
+00034080: 206e 616e 206e 616e 206e 616e 2035 2e30   nan nan nan 5.0
+00034090: 0a20 2020 2020 2020 2020 2020 2044 2020  .            D  
+000340a0: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
+000340b0: 3420 6e61 6e20 332e 3020 6e61 6e20 342e  4 nan 3.0 nan 4.
+000340c0: 300a 0a20 2020 2020 2020 2052 6570 6c61  0..        Repla
+000340d0: 6365 2061 6c6c 2060 4e61 4e60 2076 616c  ce all `NaN` val
+000340e0: 7565 7320 7769 7468 2030 732e 0a0a 2020  ues with 0s...  
+000340f0: 2020 2020 2020 3e3e 3e20 6473 2e66 696c        >>> ds.fil
+00034100: 6c6e 6128 3029 0a20 2020 2020 2020 203c  lna(0).        <
+00034110: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+00034120: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00034130: 6e73 3a20 2028 783a 2034 290a 2020 2020  ns:  (x: 4).    
+00034140: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+00034150: 0a20 2020 2020 2020 2020 202a 2078 2020  .          * x  
+00034160: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
+00034170: 3020 3120 3220 330a 2020 2020 2020 2020  0 1 2 3.        
+00034180: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
+00034190: 2020 2020 2020 2020 2020 2020 4120 2020              A   
+000341a0: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
+000341b0: 2030 2e30 2032 2e30 2030 2e30 2030 2e30   0.0 2.0 0.0 0.0
+000341c0: 0a20 2020 2020 2020 2020 2020 2042 2020  .            B  
+000341d0: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
+000341e0: 3420 332e 3020 342e 3020 302e 3020 312e  4 3.0 4.0 0.0 1.
+000341f0: 300a 2020 2020 2020 2020 2020 2020 4320  0.            C 
+00034200: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+00034210: 3634 2030 2e30 2030 2e30 2030 2e30 2035  64 0.0 0.0 0.0 5
+00034220: 2e30 0a20 2020 2020 2020 2020 2020 2044  .0.            D
+00034230: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+00034240: 7436 3420 302e 3020 332e 3020 302e 3020  t64 0.0 3.0 0.0 
+00034250: 342e 300a 0a20 2020 2020 2020 2052 6570  4.0..        Rep
+00034260: 6c61 6365 2061 6c6c 2060 4e61 4e60 2065  lace all `NaN` e
+00034270: 6c65 6d65 6e74 7320 696e 2063 6f6c 756d  lements in colum
+00034280: 6e20 e280 9841 e280 992c 20e2 8098 42e2  n ...A..., ...B.
+00034290: 8099 2c20 e280 9843 e280 992c 2061 6e64  .., ...C..., and
+000342a0: 20e2 8098 44e2 8099 2c20 7769 7468 2030   ...D..., with 0
+000342b0: 2c20 312c 2032 2c20 616e 6420 3320 7265  , 1, 2, and 3 re
+000342c0: 7370 6563 7469 7665 6c79 2e0a 0a20 2020  spectively...   
+000342d0: 2020 2020 203e 3e3e 2076 616c 7565 7320       >>> values 
+000342e0: 3d20 7b22 4122 3a20 302c 2022 4222 3a20  = {"A": 0, "B": 
+000342f0: 312c 2022 4322 3a20 322c 2022 4422 3a20  1, "C": 2, "D": 
+00034300: 337d 0a20 2020 2020 2020 203e 3e3e 2064  3}.        >>> d
+00034310: 732e 6669 6c6c 6e61 2876 616c 7565 3d76  s.fillna(value=v
+00034320: 616c 7565 7329 0a20 2020 2020 2020 203c  alues).        <
+00034330: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+00034340: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00034350: 6e73 3a20 2028 783a 2034 290a 2020 2020  ns:  (x: 4).    
+00034360: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+00034370: 0a20 2020 2020 2020 2020 202a 2078 2020  .          * x  
+00034380: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
+00034390: 3020 3120 3220 330a 2020 2020 2020 2020  0 1 2 3.        
+000343a0: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
+000343b0: 2020 2020 2020 2020 2020 2020 4120 2020              A   
+000343c0: 2020 2020 2028 7829 2066 6c6f 6174 3634       (x) float64
+000343d0: 2030 2e30 2032 2e30 2030 2e30 2030 2e30   0.0 2.0 0.0 0.0
+000343e0: 0a20 2020 2020 2020 2020 2020 2042 2020  .            B  
+000343f0: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
+00034400: 3420 332e 3020 342e 3020 312e 3020 312e  4 3.0 4.0 1.0 1.
+00034410: 300a 2020 2020 2020 2020 2020 2020 4320  0.            C 
+00034420: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+00034430: 3634 2032 2e30 2032 2e30 2032 2e30 2035  64 2.0 2.0 2.0 5
+00034440: 2e30 0a20 2020 2020 2020 2020 2020 2044  .0.            D
+00034450: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+00034460: 7436 3420 332e 3020 332e 3020 332e 3020  t64 3.0 3.0 3.0 
+00034470: 342e 300a 2020 2020 2020 2020 2222 220a  4.0.        """.
+00034480: 2020 2020 2020 2020 6966 2075 7469 6c73          if utils
+00034490: 2e69 735f 6469 6374 5f6c 696b 6528 7661  .is_dict_like(va
+000344a0: 6c75 6529 3a0a 2020 2020 2020 2020 2020  lue):.          
+000344b0: 2020 7661 6c75 655f 6b65 7973 203d 2067    value_keys = g
+000344c0: 6574 6174 7472 2876 616c 7565 2c20 2264  etattr(value, "d
+000344d0: 6174 615f 7661 7273 222c 2076 616c 7565  ata_vars", value
+000344e0: 292e 6b65 7973 2829 0a20 2020 2020 2020  ).keys().       
+000344f0: 2020 2020 2069 6620 6e6f 7420 7365 7428       if not set(
+00034500: 7661 6c75 655f 6b65 7973 2920 3c3d 2073  value_keys) <= s
+00034510: 6574 2873 656c 662e 6461 7461 5f76 6172  et(self.data_var
+00034520: 732e 6b65 7973 2829 293a 0a20 2020 2020  s.keys()):.     
+00034530: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00034540: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00034550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034560: 2022 616c 6c20 7661 7269 6162 6c65 7320   "all variables 
+00034570: 696e 2074 6865 2061 7267 756d 656e 7420  in the argument 
+00034580: 746f 2060 6669 6c6c 6e61 6020 220a 2020  to `fillna` ".  
+00034590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000345a0: 2020 226d 7573 7420 6265 2063 6f6e 7461    "must be conta
+000345b0: 696e 6564 2069 6e20 7468 6520 6f72 6967  ined in the orig
+000345c0: 696e 616c 2064 6174 6173 6574 220a 2020  inal dataset".  
+000345d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000345e0: 2020 2020 2020 2020 6f75 7420 3d20 6f70          out = op
+000345f0: 732e 6669 6c6c 6e61 2873 656c 662c 2076  s.fillna(self, v
+00034600: 616c 7565 290a 2020 2020 2020 2020 7265  alue).        re
+00034610: 7475 726e 206f 7574 0a0a 2020 2020 6465  turn out..    de
+00034620: 6620 696e 7465 7270 6f6c 6174 655f 6e61  f interpolate_na
+00034630: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+00034640: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
+00034650: 2020 2064 696d 3a20 4861 7368 6162 6c65     dim: Hashable
+00034660: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00034670: 2020 2020 2020 2020 6d65 7468 6f64 3a20          method: 
+00034680: 496e 7465 7270 4f70 7469 6f6e 7320 3d20  InterpOptions = 
+00034690: 226c 696e 6561 7222 2c0a 2020 2020 2020  "linear",.      
+000346a0: 2020 6c69 6d69 743a 2069 6e74 207c 204e    limit: int | N
+000346b0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+000346c0: 2020 2020 7573 655f 636f 6f72 6469 6e61      use_coordina
+000346d0: 7465 3a20 626f 6f6c 207c 2048 6173 6861  te: bool | Hasha
+000346e0: 626c 6520 3d20 5472 7565 2c0a 2020 2020  ble = True,.    
+000346f0: 2020 2020 6d61 785f 6761 703a 2028 0a20      max_gap: (. 
+00034700: 2020 2020 2020 2020 2020 2069 6e74 207c             int |
+00034710: 2066 6c6f 6174 207c 2073 7472 207c 2070   float | str | p
+00034720: 642e 5469 6d65 6465 6c74 6120 7c20 6e70  d.Timedelta | np
+00034730: 2e74 696d 6564 656c 7461 3634 207c 2064  .timedelta64 | d
+00034740: 6174 6574 696d 652e 7469 6d65 6465 6c74  atetime.timedelt
+00034750: 610a 2020 2020 2020 2020 2920 3d20 4e6f  a.        ) = No
+00034760: 6e65 2c0a 2020 2020 2020 2020 2a2a 6b77  ne,.        **kw
+00034770: 6172 6773 3a20 416e 792c 0a20 2020 2029  args: Any,.    )
+00034780: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+00034790: 2020 2020 2020 2022 2222 4669 6c6c 2069         """Fill i
+000347a0: 6e20 4e61 4e73 2062 7920 696e 7465 7270  n NaNs by interp
+000347b0: 6f6c 6174 696e 6720 6163 636f 7264 696e  olating accordin
+000347c0: 6720 746f 2064 6966 6665 7265 6e74 206d  g to different m
+000347d0: 6574 686f 6473 2e0a 0a20 2020 2020 2020  ethods...       
+000347e0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+000347f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00034800: 2020 2020 2020 2064 696d 203a 2048 6173         dim : Has
+00034810: 6861 626c 6520 6f72 204e 6f6e 652c 206f  hable or None, o
+00034820: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00034830: 2020 2020 5370 6563 6966 6965 7320 7468      Specifies th
+00034840: 6520 6469 6d65 6e73 696f 6e20 616c 6f6e  e dimension alon
+00034850: 6720 7768 6963 6820 746f 2069 6e74 6572  g which to inter
+00034860: 706f 6c61 7465 2e0a 2020 2020 2020 2020  polate..        
+00034870: 6d65 7468 6f64 203a 207b 226c 696e 6561  method : {"linea
+00034880: 7222 2c20 226e 6561 7265 7374 222c 2022  r", "nearest", "
+00034890: 7a65 726f 222c 2022 736c 696e 6561 7222  zero", "slinear"
+000348a0: 2c20 2271 7561 6472 6174 6963 222c 2022  , "quadratic", "
+000348b0: 6375 6269 6322 2c20 2270 6f6c 796e 6f6d  cubic", "polynom
+000348c0: 6961 6c22 2c20 5c0a 2020 2020 2020 2020  ial", \.        
+000348d0: 2020 2020 2262 6172 7963 656e 7472 6963      "barycentric
+000348e0: 222c 2022 6b72 6f67 222c 2022 7063 6869  ", "krog", "pchi
+000348f0: 7022 2c20 2273 706c 696e 6522 2c20 2261  p", "spline", "a
+00034900: 6b69 6d61 227d 2c20 6465 6661 756c 743a  kima"}, default:
+00034910: 2022 6c69 6e65 6172 220a 2020 2020 2020   "linear".      
+00034920: 2020 2020 2020 5374 7269 6e67 2069 6e64        String ind
+00034930: 6963 6174 696e 6720 7768 6963 6820 6d65  icating which me
+00034940: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
+00034950: 696e 7465 7270 6f6c 6174 696f 6e3a 0a0a  interpolation:..
+00034960: 2020 2020 2020 2020 2020 2020 2d20 276c              - 'l
+00034970: 696e 6561 7227 3a20 6c69 6e65 6172 2069  inear': linear i
+00034980: 6e74 6572 706f 6c61 7469 6f6e 2e20 4164  nterpolation. Ad
+00034990: 6469 7469 6f6e 616c 206b 6579 776f 7264  ditional keyword
+000349a0: 0a20 2020 2020 2020 2020 2020 2020 2061  .              a
+000349b0: 7267 756d 656e 7473 2061 7265 2070 6173  rguments are pas
+000349c0: 7365 6420 746f 203a 7079 3a66 756e 633a  sed to :py:func:
+000349d0: 606e 756d 7079 2e69 6e74 6572 7060 0a20  `numpy.interp`. 
+000349e0: 2020 2020 2020 2020 2020 202d 2027 6e65             - 'ne
+000349f0: 6172 6573 7427 2c20 277a 6572 6f27 2c20  arest', 'zero', 
+00034a00: 2773 6c69 6e65 6172 272c 2027 7175 6164  'slinear', 'quad
+00034a10: 7261 7469 6327 2c20 2763 7562 6963 272c  ratic', 'cubic',
+00034a20: 2027 706f 6c79 6e6f 6d69 616c 273a 0a20   'polynomial':. 
+00034a30: 2020 2020 2020 2020 2020 2020 2061 7265               are
+00034a40: 2070 6173 7365 6420 746f 203a 7079 3a66   passed to :py:f
+00034a50: 756e 633a 6073 6369 7079 2e69 6e74 6572  unc:`scipy.inter
+00034a60: 706f 6c61 7465 2e69 6e74 6572 7031 6460  polate.interp1d`
+00034a70: 2e20 4966 0a20 2020 2020 2020 2020 2020  . If.           
+00034a80: 2020 2060 606d 6574 686f 643d 2770 6f6c     ``method='pol
+00034a90: 796e 6f6d 6961 6c27 6060 2c20 7468 6520  ynomial'``, the 
+00034aa0: 6060 6f72 6465 7260 6020 6b65 7977 6f72  ``order`` keywor
+00034ab0: 6420 6172 6775 6d65 6e74 206d 7573 7420  d argument must 
+00034ac0: 616c 736f 2062 650a 2020 2020 2020 2020  also be.        
+00034ad0: 2020 2020 2020 7072 6f76 6964 6564 2e0a        provided..
+00034ae0: 2020 2020 2020 2020 2020 2020 2d20 2762              - 'b
+00034af0: 6172 7963 656e 7472 6963 272c 2027 6b72  arycentric', 'kr
+00034b00: 6f67 272c 2027 7063 6869 7027 2c20 2773  og', 'pchip', 's
+00034b10: 706c 696e 6527 2c20 2761 6b69 6d61 273a  pline', 'akima':
+00034b20: 2075 7365 2074 6865 6972 0a20 2020 2020   use their.     
+00034b30: 2020 2020 2020 2020 2072 6573 7065 6374           respect
+00034b40: 6976 6520 3a70 793a 636c 6173 733a 6073  ive :py:class:`s
+00034b50: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
+00034b60: 6020 636c 6173 7365 732e 0a0a 2020 2020  ` classes...    
+00034b70: 2020 2020 7573 655f 636f 6f72 6469 6e61      use_coordina
+00034b80: 7465 203a 2062 6f6f 6c20 6f72 2048 6173  te : bool or Has
+00034b90: 6861 626c 652c 2064 6566 6175 6c74 3a20  hable, default: 
+00034ba0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00034bb0: 2053 7065 6369 6669 6573 2077 6869 6368   Specifies which
+00034bc0: 2069 6e64 6578 2074 6f20 7573 6520 6173   index to use as
+00034bd0: 2074 6865 2078 2076 616c 7565 7320 696e   the x values in
+00034be0: 2074 6865 2069 6e74 6572 706f 6c61 7469   the interpolati
+00034bf0: 6f6e 0a20 2020 2020 2020 2020 2020 2066  on.            f
+00034c00: 6f72 6d75 6c61 7465 6420 6173 2060 7920  ormulated as `y 
+00034c10: 3d20 6628 7829 602e 2049 6620 4661 6c73  = f(x)`. If Fals
+00034c20: 652c 2076 616c 7565 7320 6172 6520 7472  e, values are tr
+00034c30: 6561 7465 6420 6173 2069 660a 2020 2020  eated as if.    
+00034c40: 2020 2020 2020 2020 6571 7561 6c6c 792d          equally-
+00034c50: 7370 6163 6564 2061 6c6f 6e67 2060 6064  spaced along ``d
+00034c60: 696d 6060 2e20 4966 2054 7275 652c 2074  im``. If True, t
+00034c70: 6865 2049 6e64 6578 5661 7269 6162 6c65  he IndexVariable
+00034c80: 2060 6469 6d60 2069 730a 2020 2020 2020   `dim` is.      
+00034c90: 2020 2020 2020 7573 6564 2e20 4966 2060        used. If `
+00034ca0: 6075 7365 5f63 6f6f 7264 696e 6174 6560  `use_coordinate`
+00034cb0: 6020 6973 2061 2073 7472 696e 672c 2069  ` is a string, i
+00034cc0: 7420 7370 6563 6966 6965 7320 7468 6520  t specifies the 
+00034cd0: 6e61 6d65 206f 6620 610a 2020 2020 2020  name of a.      
+00034ce0: 2020 2020 2020 636f 6f72 6469 6e61 7465        coordinate
+00034cf0: 2076 6172 6961 626c 6520 746f 2075 7365   variable to use
+00034d00: 2061 7320 7468 6520 696e 6465 782e 0a20   as the index.. 
+00034d10: 2020 2020 2020 206c 696d 6974 203a 2069         limit : i
+00034d20: 6e74 2c20 6465 6661 756c 743a 204e 6f6e  nt, default: Non
+00034d30: 650a 2020 2020 2020 2020 2020 2020 4d61  e.            Ma
+00034d40: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
+00034d50: 636f 6e73 6563 7574 6976 6520 4e61 4e73  consecutive NaNs
+00034d60: 2074 6f20 6669 6c6c 2e20 4d75 7374 2062   to fill. Must b
+00034d70: 6520 6772 6561 7465 7220 7468 616e 2030  e greater than 0
+00034d80: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00034d90: 4e6f 6e65 2066 6f72 206e 6f20 6c69 6d69  None for no limi
+00034da0: 742e 2054 6869 7320 6669 6c6c 696e 6720  t. This filling 
+00034db0: 6973 2064 6f6e 6520 7265 6761 7264 6c65  is done regardle
+00034dc0: 7373 206f 6620 7468 6520 7369 7a65 206f  ss of the size o
+00034dd0: 660a 2020 2020 2020 2020 2020 2020 7468  f.            th
+00034de0: 6520 6761 7020 696e 2074 6865 2064 6174  e gap in the dat
+00034df0: 612e 2054 6f20 6f6e 6c79 2069 6e74 6572  a. To only inter
+00034e00: 706f 6c61 7465 206f 7665 7220 6761 7073  polate over gaps
+00034e10: 206c 6573 7320 7468 616e 2061 2067 6976   less than a giv
+00034e20: 656e 206c 656e 6774 682c 0a20 2020 2020  en length,.     
+00034e30: 2020 2020 2020 2073 6565 2060 606d 6178         see ``max
+00034e40: 5f67 6170 6060 2e0a 2020 2020 2020 2020  _gap``..        
+00034e50: 6d61 785f 6761 7020 3a20 696e 742c 2066  max_gap : int, f
+00034e60: 6c6f 6174 2c20 7374 722c 2070 616e 6461  loat, str, panda
+00034e70: 732e 5469 6d65 6465 6c74 612c 206e 756d  s.Timedelta, num
+00034e80: 7079 2e74 696d 6564 656c 7461 3634 2c20  py.timedelta64, 
+00034e90: 6461 7465 7469 6d65 2e74 696d 6564 656c  datetime.timedel
+00034ea0: 7461 2c20 6465 6661 756c 743a 204e 6f6e  ta, default: Non
+00034eb0: 650a 2020 2020 2020 2020 2020 2020 4d61  e.            Ma
+00034ec0: 7869 6d75 6d20 7369 7a65 206f 6620 6761  ximum size of ga
+00034ed0: 702c 2061 2063 6f6e 7469 6e75 6f75 7320  p, a continuous 
+00034ee0: 7365 7175 656e 6365 206f 6620 4e61 4e73  sequence of NaNs
+00034ef0: 2c20 7468 6174 2077 696c 6c20 6265 2066  , that will be f
+00034f00: 696c 6c65 642e 0a20 2020 2020 2020 2020  illed..         
+00034f10: 2020 2055 7365 204e 6f6e 6520 666f 7220     Use None for 
+00034f20: 6e6f 206c 696d 6974 2e20 5768 656e 2069  no limit. When i
+00034f30: 6e74 6572 706f 6c61 7469 6e67 2061 6c6f  nterpolating alo
+00034f40: 6e67 2061 2064 6174 6574 696d 6536 3420  ng a datetime64 
+00034f50: 6469 6d65 6e73 696f 6e0a 2020 2020 2020  dimension.      
+00034f60: 2020 2020 2020 616e 6420 6060 7573 655f        and ``use_
+00034f70: 636f 6f72 6469 6e61 7465 3d54 7275 6560  coordinate=True`
+00034f80: 602c 2060 606d 6178 5f67 6170 6060 2063  `, ``max_gap`` c
+00034f90: 616e 2062 6520 6f6e 6520 6f66 2074 6865  an be one of the
+00034fa0: 2066 6f6c 6c6f 7769 6e67 3a0a 0a20 2020   following:..   
+00034fb0: 2020 2020 2020 2020 202d 2061 2073 7472           - a str
+00034fc0: 696e 6720 7468 6174 2069 7320 7661 6c69  ing that is vali
+00034fd0: 6420 696e 7075 7420 666f 7220 7061 6e64  d input for pand
+00034fe0: 6173 2e74 6f5f 7469 6d65 6465 6c74 610a  as.to_timedelta.
+00034ff0: 2020 2020 2020 2020 2020 2020 2d20 6120              - a 
+00035000: 3a70 793a 636c 6173 733a 606e 756d 7079  :py:class:`numpy
+00035010: 2e74 696d 6564 656c 7461 3634 6020 6f62  .timedelta64` ob
+00035020: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
+00035030: 202d 2061 203a 7079 3a63 6c61 7373 3a60   - a :py:class:`
+00035040: 7061 6e64 6173 2e54 696d 6564 656c 7461  pandas.Timedelta
+00035050: 6020 6f62 6a65 6374 0a20 2020 2020 2020  ` object.       
+00035060: 2020 2020 202d 2061 203a 7079 3a63 6c61       - a :py:cla
+00035070: 7373 3a60 6461 7465 7469 6d65 2e74 696d  ss:`datetime.tim
+00035080: 6564 656c 7461 6020 6f62 6a65 6374 0a0a  edelta` object..
+00035090: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
+000350a0: 7277 6973 652c 2060 606d 6178 5f67 6170  rwise, ``max_gap
+000350b0: 6060 206d 7573 7420 6265 2061 6e20 696e  `` must be an in
+000350c0: 7420 6f72 2061 2066 6c6f 6174 2e20 5573  t or a float. Us
+000350d0: 6520 6f66 2060 606d 6178 5f67 6170 6060  e of ``max_gap``
+000350e0: 2077 6974 6820 756e 6c61 6265 6c65 640a   with unlabeled.
+000350f0: 2020 2020 2020 2020 2020 2020 6469 6d65              dime
+00035100: 6e73 696f 6e73 2068 6173 206e 6f74 2062  nsions has not b
+00035110: 6565 6e20 696d 706c 656d 656e 7465 6420  een implemented 
+00035120: 7965 742e 2047 6170 206c 656e 6774 6820  yet. Gap length 
+00035130: 6973 2064 6566 696e 6564 2061 7320 7468  is defined as th
+00035140: 6520 6469 6666 6572 656e 6365 0a20 2020  e difference.   
+00035150: 2020 2020 2020 2020 2062 6574 7765 656e           between
+00035160: 2063 6f6f 7264 696e 6174 6520 7661 6c75   coordinate valu
+00035170: 6573 2061 7420 7468 6520 6669 7273 7420  es at the first 
+00035180: 6461 7461 2070 6f69 6e74 2061 6674 6572  data point after
+00035190: 2061 2067 6170 2061 6e64 2074 6865 206c   a gap and the l
+000351a0: 6173 7420 7661 6c75 650a 2020 2020 2020  ast value.      
+000351b0: 2020 2020 2020 6265 666f 7265 2061 2067        before a g
+000351c0: 6170 2e20 466f 7220 6761 7073 2061 7420  ap. For gaps at 
+000351d0: 7468 6520 6265 6769 6e6e 696e 6720 2865  the beginning (e
+000351e0: 6e64 292c 2067 6170 206c 656e 6774 6820  nd), gap length 
+000351f0: 6973 2064 6566 696e 6564 2061 7320 7468  is defined as th
+00035200: 6520 6469 6666 6572 656e 6365 0a20 2020  e difference.   
+00035210: 2020 2020 2020 2020 2062 6574 7765 656e           between
+00035220: 2063 6f6f 7264 696e 6174 6520 7661 6c75   coordinate valu
+00035230: 6573 2061 7420 7468 6520 6669 7273 7420  es at the first 
+00035240: 286c 6173 7429 2076 616c 6964 2064 6174  (last) valid dat
+00035250: 6120 706f 696e 7420 616e 6420 7468 6520  a point and the 
+00035260: 6669 7273 7420 286c 6173 7429 204e 614e  first (last) NaN
+00035270: 2e0a 2020 2020 2020 2020 2020 2020 466f  ..            Fo
+00035280: 7220 6578 616d 706c 652c 2063 6f6e 7369  r example, consi
+00035290: 6465 723a 3a0a 0a20 2020 2020 2020 2020  der::..         
+000352a0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+000352b0: 6174 6141 7272 6179 2028 783a 2039 293e  ataArray (x: 9)>
+000352c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000352d0: 2061 7272 6179 285b 6e61 6e2c 206e 616e   array([nan, nan
+000352e0: 2c20 6e61 6e2c 2020 312e 2c20 6e61 6e2c  , nan,  1., nan,
+000352f0: 206e 616e 2c20 2034 2e2c 206e 616e 2c20   nan,  4., nan, 
+00035300: 6e61 6e5d 290a 2020 2020 2020 2020 2020  nan]).          
+00035310: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+00035320: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00035330: 2020 2020 202a 2078 2020 2020 2020 2020       * x        
+00035340: 2878 2920 696e 7436 3420 3020 3120 3220  (x) int64 0 1 2 
+00035350: 3320 3420 3520 3620 3720 380a 0a20 2020  3 4 5 6 7 8..   
+00035360: 2020 2020 2020 2020 2054 6865 2067 6170           The gap
+00035370: 206c 656e 6774 6873 2061 7265 2033 2d30   lengths are 3-0
+00035380: 203d 2033 3b20 362d 3320 3d20 333b 2061   = 3; 6-3 = 3; a
+00035390: 6e64 2038 2d36 203d 2032 2072 6573 7065  nd 8-6 = 2 respe
+000353a0: 6374 6976 656c 790a 2020 2020 2020 2020  ctively.        
+000353b0: 2a2a 6b77 6172 6773 203a 2064 6963 742c  **kwargs : dict,
+000353c0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+000353d0: 2020 2020 2020 7061 7261 6d65 7465 7273        parameters
+000353e0: 2070 6173 7365 6420 7665 7262 6174 696d   passed verbatim
+000353f0: 2074 6f20 7468 6520 756e 6465 726c 7969   to the underlyi
+00035400: 6e67 2069 6e74 6572 706f 6c61 7469 6f6e  ng interpolation
+00035410: 2066 756e 6374 696f 6e0a 0a20 2020 2020   function..     
+00035420: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00035430: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+00035440: 2020 2069 6e74 6572 706f 6c61 7465 643a     interpolated:
+00035450: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
+00035460: 2020 2020 2046 696c 6c65 6420 696e 2044       Filled in D
+00035470: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
+00035480: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+00035490: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+000354a0: 2020 206e 756d 7079 2e69 6e74 6572 700a     numpy.interp.
+000354b0: 2020 2020 2020 2020 7363 6970 792e 696e          scipy.in
+000354c0: 7465 7270 6f6c 6174 650a 0a20 2020 2020  terpolate..     
+000354d0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+000354e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+000354f0: 2020 2020 203e 3e3e 2064 7320 3d20 7872       >>> ds = xr
+00035500: 2e44 6174 6173 6574 280a 2020 2020 2020  .Dataset(.      
+00035510: 2020 2e2e 2e20 2020 2020 7b0a 2020 2020    ...     {.    
+00035520: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+00035530: 2241 223a 2028 2278 222c 205b 6e70 2e6e  "A": ("x", [np.n
+00035540: 616e 2c20 322c 2033 2c20 6e70 2e6e 616e  an, 2, 3, np.nan
+00035550: 2c20 305d 292c 0a20 2020 2020 2020 202e  , 0]),.        .
+00035560: 2e2e 2020 2020 2020 2020 2022 4222 3a20  ..         "B": 
+00035570: 2822 7822 2c20 5b33 2c20 342c 206e 702e  ("x", [3, 4, np.
+00035580: 6e61 6e2c 2031 2c20 375d 292c 0a20 2020  nan, 1, 7]),.   
+00035590: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+000355a0: 2022 4322 3a20 2822 7822 2c20 5b6e 702e   "C": ("x", [np.
+000355b0: 6e61 6e2c 206e 702e 6e61 6e2c 206e 702e  nan, np.nan, np.
+000355c0: 6e61 6e2c 2035 2c20 305d 292c 0a20 2020  nan, 5, 0]),.   
+000355d0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+000355e0: 2022 4422 3a20 2822 7822 2c20 5b6e 702e   "D": ("x", [np.
+000355f0: 6e61 6e2c 2033 2c20 6e70 2e6e 616e 2c20  nan, 3, np.nan, 
+00035600: 2d31 2c20 345d 292c 0a20 2020 2020 2020  -1, 4]),.       
+00035610: 202e 2e2e 2020 2020 207d 2c0a 2020 2020   ...     },.    
+00035620: 2020 2020 2e2e 2e20 2020 2020 636f 6f72      ...     coor
+00035630: 6473 3d7b 2278 223a 205b 302c 2031 2c20  ds={"x": [0, 1, 
+00035640: 322c 2033 2c20 345d 7d2c 0a20 2020 2020  2, 3, 4]},.     
+00035650: 2020 202e 2e2e 2029 0a20 2020 2020 2020     ... ).       
+00035660: 203e 3e3e 2064 730a 2020 2020 2020 2020   >>> ds.        
+00035670: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
+00035680: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00035690: 6f6e 733a 2020 2878 3a20 3529 0a20 2020  ons:  (x: 5).   
+000356a0: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+000356b0: 3a0a 2020 2020 2020 2020 2020 2a20 7820  :.          * x 
+000356c0: 2020 2020 2020 2028 7829 2069 6e74 3634         (x) int64
+000356d0: 2030 2031 2032 2033 2034 0a20 2020 2020   0 1 2 3 4.     
+000356e0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+000356f0: 733a 0a20 2020 2020 2020 2020 2020 2041  s:.            A
+00035700: 2020 2020 2020 2020 2878 2920 666c 6f61          (x) floa
+00035710: 7436 3420 6e61 6e20 322e 3020 332e 3020  t64 nan 2.0 3.0 
+00035720: 6e61 6e20 302e 300a 2020 2020 2020 2020  nan 0.0.        
+00035730: 2020 2020 4220 2020 2020 2020 2028 7829      B        (x)
+00035740: 2066 6c6f 6174 3634 2033 2e30 2034 2e30   float64 3.0 4.0
+00035750: 206e 616e 2031 2e30 2037 2e30 0a20 2020   nan 1.0 7.0.   
+00035760: 2020 2020 2020 2020 2043 2020 2020 2020           C      
+00035770: 2020 2878 2920 666c 6f61 7436 3420 6e61    (x) float64 na
+00035780: 6e20 6e61 6e20 6e61 6e20 352e 3020 302e  n nan nan 5.0 0.
+00035790: 300a 2020 2020 2020 2020 2020 2020 4420  0.            D 
+000357a0: 2020 2020 2020 2028 7829 2066 6c6f 6174         (x) float
+000357b0: 3634 206e 616e 2033 2e30 206e 616e 202d  64 nan 3.0 nan -
+000357c0: 312e 3020 342e 300a 0a20 2020 2020 2020  1.0 4.0..       
+000357d0: 203e 3e3e 2064 732e 696e 7465 7270 6f6c   >>> ds.interpol
+000357e0: 6174 655f 6e61 2864 696d 3d22 7822 2c20  ate_na(dim="x", 
+000357f0: 6d65 7468 6f64 3d22 6c69 6e65 6172 2229  method="linear")
+00035800: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+00035810: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
+00035820: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
+00035830: 783a 2035 290a 2020 2020 2020 2020 436f  x: 5).        Co
+00035840: 6f72 6469 6e61 7465 733a 0a20 2020 2020  ordinates:.     
+00035850: 2020 2020 202a 2078 2020 2020 2020 2020       * x        
+00035860: 2878 2920 696e 7436 3420 3020 3120 3220  (x) int64 0 1 2 
+00035870: 3320 340a 2020 2020 2020 2020 4461 7461  3 4.        Data
+00035880: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+00035890: 2020 2020 2020 2020 4120 2020 2020 2020          A       
+000358a0: 2028 7829 2066 6c6f 6174 3634 206e 616e   (x) float64 nan
+000358b0: 2032 2e30 2033 2e30 2031 2e35 2030 2e30   2.0 3.0 1.5 0.0
+000358c0: 0a20 2020 2020 2020 2020 2020 2042 2020  .            B  
+000358d0: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
+000358e0: 3420 332e 3020 342e 3020 322e 3520 312e  4 3.0 4.0 2.5 1.
+000358f0: 3020 372e 300a 2020 2020 2020 2020 2020  0 7.0.          
+00035900: 2020 4320 2020 2020 2020 2028 7829 2066    C        (x) f
+00035910: 6c6f 6174 3634 206e 616e 206e 616e 206e  loat64 nan nan n
+00035920: 616e 2035 2e30 2030 2e30 0a20 2020 2020  an 5.0 0.0.     
+00035930: 2020 2020 2020 2044 2020 2020 2020 2020         D        
+00035940: 2878 2920 666c 6f61 7436 3420 6e61 6e20  (x) float64 nan 
+00035950: 332e 3020 312e 3020 2d31 2e30 2034 2e30  3.0 1.0 -1.0 4.0
+00035960: 0a0a 2020 2020 2020 2020 3e3e 3e20 6473  ..        >>> ds
+00035970: 2e69 6e74 6572 706f 6c61 7465 5f6e 6128  .interpolate_na(
+00035980: 6469 6d3d 2278 222c 206d 6574 686f 643d  dim="x", method=
+00035990: 226c 696e 6561 7222 2c20 6669 6c6c 5f76  "linear", fill_v
+000359a0: 616c 7565 3d22 6578 7472 6170 6f6c 6174  alue="extrapolat
+000359b0: 6522 290a 2020 2020 2020 2020 3c78 6172  e").        <xar
+000359c0: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+000359d0: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+000359e0: 2020 2878 3a20 3529 0a20 2020 2020 2020    (x: 5).       
+000359f0: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00035a00: 2020 2020 2020 2020 2a20 7820 2020 2020          * x     
+00035a10: 2020 2028 7829 2069 6e74 3634 2030 2031     (x) int64 0 1
+00035a20: 2032 2033 2034 0a20 2020 2020 2020 2044   2 3 4.        D
+00035a30: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+00035a40: 2020 2020 2020 2020 2020 2041 2020 2020             A    
+00035a50: 2020 2020 2878 2920 666c 6f61 7436 3420      (x) float64 
+00035a60: 312e 3020 322e 3020 332e 3020 312e 3520  1.0 2.0 3.0 1.5 
+00035a70: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
+00035a80: 4220 2020 2020 2020 2028 7829 2066 6c6f  B        (x) flo
+00035a90: 6174 3634 2033 2e30 2034 2e30 2032 2e35  at64 3.0 4.0 2.5
+00035aa0: 2031 2e30 2037 2e30 0a20 2020 2020 2020   1.0 7.0.       
+00035ab0: 2020 2020 2043 2020 2020 2020 2020 2878       C        (x
+00035ac0: 2920 666c 6f61 7436 3420 3230 2e30 2031  ) float64 20.0 1
+00035ad0: 352e 3020 3130 2e30 2035 2e30 2030 2e30  5.0 10.0 5.0 0.0
+00035ae0: 0a20 2020 2020 2020 2020 2020 2044 2020  .            D  
+00035af0: 2020 2020 2020 2878 2920 666c 6f61 7436        (x) float6
+00035b00: 3420 352e 3020 332e 3020 312e 3020 2d31  4 5.0 3.0 1.0 -1
+00035b10: 2e30 2034 2e30 0a20 2020 2020 2020 2022  .0 4.0.        "
+00035b20: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00035b30: 7861 7272 6179 2e63 6f72 652e 6d69 7373  xarray.core.miss
+00035b40: 696e 6720 696d 706f 7274 205f 6170 706c  ing import _appl
+00035b50: 795f 6f76 6572 5f76 6172 735f 7769 7468  y_over_vars_with
+00035b60: 5f64 696d 2c20 696e 7465 7270 5f6e 610a  _dim, interp_na.
+00035b70: 0a20 2020 2020 2020 206e 6577 203d 205f  .        new = _
+00035b80: 6170 706c 795f 6f76 6572 5f76 6172 735f  apply_over_vars_
+00035b90: 7769 7468 5f64 696d 280a 2020 2020 2020  with_dim(.      
+00035ba0: 2020 2020 2020 696e 7465 7270 5f6e 612c        interp_na,
+00035bb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00035bc0: 662c 0a20 2020 2020 2020 2020 2020 2064  f,.            d
+00035bd0: 696d 3d64 696d 2c0a 2020 2020 2020 2020  im=dim,.        
+00035be0: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
+00035bf0: 642c 0a20 2020 2020 2020 2020 2020 206c  d,.            l
+00035c00: 696d 6974 3d6c 696d 6974 2c0a 2020 2020  imit=limit,.    
+00035c10: 2020 2020 2020 2020 7573 655f 636f 6f72          use_coor
+00035c20: 6469 6e61 7465 3d75 7365 5f63 6f6f 7264  dinate=use_coord
+00035c30: 696e 6174 652c 0a20 2020 2020 2020 2020  inate,.         
+00035c40: 2020 206d 6178 5f67 6170 3d6d 6178 5f67     max_gap=max_g
+00035c50: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+00035c60: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
+00035c70: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+00035c80: 726e 206e 6577 0a0a 2020 2020 6465 6620  rn new..    def 
+00035c90: 6666 696c 6c28 7365 6c66 3a20 545f 4461  ffill(self: T_Da
+00035ca0: 7461 7365 742c 2064 696d 3a20 4861 7368  taset, dim: Hash
+00035cb0: 6162 6c65 2c20 6c69 6d69 743a 2069 6e74  able, limit: int
+00035cc0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2920   | None = None) 
+00035cd0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+00035ce0: 2020 2020 2020 2222 2246 696c 6c20 4e61        """Fill Na
+00035cf0: 4e20 7661 6c75 6573 2062 7920 7072 6f70  N values by prop
+00035d00: 6167 6174 696e 6720 7661 6c75 6573 2066  agating values f
+00035d10: 6f72 7761 7264 0a0a 2020 2020 2020 2020  orward..        
+00035d20: 2a52 6571 7569 7265 7320 626f 7474 6c65  *Requires bottle
+00035d30: 6e65 636b 2e2a 0a0a 2020 2020 2020 2020  neck.*..        
+00035d40: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00035d50: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00035d60: 2020 2020 2020 6469 6d20 3a20 4861 7368        dim : Hash
+00035d70: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
+00035d80: 2053 7065 6369 6669 6573 2074 6865 2064   Specifies the d
+00035d90: 696d 656e 7369 6f6e 2061 6c6f 6e67 2077  imension along w
+00035da0: 6869 6368 2074 6f20 7072 6f70 6167 6174  hich to propagat
+00035db0: 6520 7661 6c75 6573 2077 6865 6e0a 2020  e values when.  
+00035dc0: 2020 2020 2020 2020 2020 6669 6c6c 696e            fillin
+00035dd0: 672e 0a20 2020 2020 2020 206c 696d 6974  g..        limit
+00035de0: 203a 2069 6e74 206f 7220 4e6f 6e65 2c20   : int or None, 
+00035df0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00035e00: 2020 2020 2054 6865 206d 6178 696d 756d       The maximum
+00035e10: 206e 756d 6265 7220 6f66 2063 6f6e 7365   number of conse
+00035e20: 6375 7469 7665 204e 614e 2076 616c 7565  cutive NaN value
+00035e30: 7320 746f 2066 6f72 7761 7264 2066 696c  s to forward fil
+00035e40: 6c2e 2049 6e0a 2020 2020 2020 2020 2020  l. In.          
+00035e50: 2020 6f74 6865 7220 776f 7264 732c 2069    other words, i
+00035e60: 6620 7468 6572 6520 6973 2061 2067 6170  f there is a gap
+00035e70: 2077 6974 6820 6d6f 7265 2074 6861 6e20   with more than 
+00035e80: 7468 6973 206e 756d 6265 7220 6f66 0a20  this number of. 
+00035e90: 2020 2020 2020 2020 2020 2063 6f6e 7365             conse
+00035ea0: 6375 7469 7665 204e 614e 732c 2069 7420  cutive NaNs, it 
+00035eb0: 7769 6c6c 206f 6e6c 7920 6265 2070 6172  will only be par
+00035ec0: 7469 616c 6c79 2066 696c 6c65 642e 204d  tially filled. M
+00035ed0: 7573 7420 6265 2067 7265 6174 6572 0a20  ust be greater. 
+00035ee0: 2020 2020 2020 2020 2020 2074 6861 6e20             than 
+00035ef0: 3020 6f72 204e 6f6e 6520 666f 7220 6e6f  0 or None for no
+00035f00: 206c 696d 6974 2e20 4d75 7374 2062 6520   limit. Must be 
+00035f10: 4e6f 6e65 206f 7220 6772 6561 7465 7220  None or greater 
+00035f20: 7468 616e 206f 7220 6571 7561 6c0a 2020  than or equal.  
+00035f30: 2020 2020 2020 2020 2020 746f 2061 7869            to axi
+00035f40: 7320 6c65 6e67 7468 2069 6620 6669 6c6c  s length if fill
+00035f50: 696e 6720 616c 6f6e 6720 6368 756e 6b65  ing along chunke
+00035f60: 6420 6178 6573 2028 6469 6d65 6e73 696f  d axes (dimensio
+00035f70: 6e73 292e 0a0a 2020 2020 2020 2020 5265  ns)...        Re
+00035f80: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+00035f90: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
+00035fa0: 7461 7365 740a 2020 2020 2020 2020 2222  taset.        ""
+00035fb0: 220a 2020 2020 2020 2020 6672 6f6d 2078  ".        from x
+00035fc0: 6172 7261 792e 636f 7265 2e6d 6973 7369  array.core.missi
+00035fd0: 6e67 2069 6d70 6f72 7420 5f61 7070 6c79  ng import _apply
+00035fe0: 5f6f 7665 725f 7661 7273 5f77 6974 685f  _over_vars_with_
+00035ff0: 6469 6d2c 2066 6669 6c6c 0a0a 2020 2020  dim, ffill..    
+00036000: 2020 2020 6e65 7720 3d20 5f61 7070 6c79      new = _apply
+00036010: 5f6f 7665 725f 7661 7273 5f77 6974 685f  _over_vars_with_
+00036020: 6469 6d28 6666 696c 6c2c 2073 656c 662c  dim(ffill, self,
+00036030: 2064 696d 3d64 696d 2c20 6c69 6d69 743d   dim=dim, limit=
+00036040: 6c69 6d69 7429 0a20 2020 2020 2020 2072  limit).        r
+00036050: 6574 7572 6e20 6e65 770a 0a20 2020 2064  eturn new..    d
+00036060: 6566 2062 6669 6c6c 2873 656c 663a 2054  ef bfill(self: T
+00036070: 5f44 6174 6173 6574 2c20 6469 6d3a 2048  _Dataset, dim: H
+00036080: 6173 6861 626c 652c 206c 696d 6974 3a20  ashable, limit: 
+00036090: 696e 7420 7c20 4e6f 6e65 203d 204e 6f6e  int | None = Non
+000360a0: 6529 202d 3e20 545f 4461 7461 7365 743a  e) -> T_Dataset:
+000360b0: 0a20 2020 2020 2020 2022 2222 4669 6c6c  .        """Fill
+000360c0: 204e 614e 2076 616c 7565 7320 6279 2070   NaN values by p
+000360d0: 726f 7061 6761 7469 6e67 2076 616c 7565  ropagating value
+000360e0: 7320 6261 636b 7761 7264 0a0a 2020 2020  s backward..    
+000360f0: 2020 2020 2a52 6571 7569 7265 7320 626f      *Requires bo
+00036100: 7474 6c65 6e65 636b 2e2a 0a0a 2020 2020  ttleneck.*..    
+00036110: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00036120: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00036130: 2d0a 2020 2020 2020 2020 6469 6d20 3a20  -.        dim : 
+00036140: 4861 7368 6162 6c65 0a20 2020 2020 2020  Hashable.       
+00036150: 2020 2020 2053 7065 6369 6669 6573 2074       Specifies t
+00036160: 6865 2064 696d 656e 7369 6f6e 2061 6c6f  he dimension alo
+00036170: 6e67 2077 6869 6368 2074 6f20 7072 6f70  ng which to prop
+00036180: 6167 6174 6520 7661 6c75 6573 2077 6865  agate values whe
+00036190: 6e0a 2020 2020 2020 2020 2020 2020 6669  n.            fi
+000361a0: 6c6c 696e 672e 0a20 2020 2020 2020 206c  lling..        l
+000361b0: 696d 6974 203a 2069 6e74 206f 7220 4e6f  imit : int or No
+000361c0: 6e65 2c20 6f70 7469 6f6e 616c 0a20 2020  ne, optional.   
+000361d0: 2020 2020 2020 2020 2054 6865 206d 6178           The max
+000361e0: 696d 756d 206e 756d 6265 7220 6f66 2063  imum number of c
+000361f0: 6f6e 7365 6375 7469 7665 204e 614e 2076  onsecutive NaN v
+00036200: 616c 7565 7320 746f 2062 6163 6b77 6172  alues to backwar
+00036210: 6420 6669 6c6c 2e20 496e 0a20 2020 2020  d fill. In.     
+00036220: 2020 2020 2020 206f 7468 6572 2077 6f72         other wor
+00036230: 6473 2c20 6966 2074 6865 7265 2069 7320  ds, if there is 
+00036240: 6120 6761 7020 7769 7468 206d 6f72 6520  a gap with more 
+00036250: 7468 616e 2074 6869 7320 6e75 6d62 6572  than this number
+00036260: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
+00036270: 636f 6e73 6563 7574 6976 6520 4e61 4e73  consecutive NaNs
+00036280: 2c20 6974 2077 696c 6c20 6f6e 6c79 2062  , it will only b
+00036290: 6520 7061 7274 6961 6c6c 7920 6669 6c6c  e partially fill
+000362a0: 6564 2e20 4d75 7374 2062 6520 6772 6561  ed. Must be grea
+000362b0: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
+000362c0: 7468 616e 2030 206f 7220 4e6f 6e65 2066  than 0 or None f
+000362d0: 6f72 206e 6f20 6c69 6d69 742e 204d 7573  or no limit. Mus
+000362e0: 7420 6265 204e 6f6e 6520 6f72 2067 7265  t be None or gre
+000362f0: 6174 6572 2074 6861 6e20 6f72 2065 7175  ater than or equ
+00036300: 616c 0a20 2020 2020 2020 2020 2020 2074  al.            t
+00036310: 6f20 6178 6973 206c 656e 6774 6820 6966  o axis length if
+00036320: 2066 696c 6c69 6e67 2061 6c6f 6e67 2063   filling along c
+00036330: 6875 6e6b 6564 2061 7865 7320 2864 696d  hunked axes (dim
+00036340: 656e 7369 6f6e 7329 2e0a 0a20 2020 2020  ensions)...     
+00036350: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00036360: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+00036370: 2020 2044 6174 6173 6574 0a20 2020 2020     Dataset.     
+00036380: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00036390: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+000363a0: 6d69 7373 696e 6720 696d 706f 7274 205f  missing import _
+000363b0: 6170 706c 795f 6f76 6572 5f76 6172 735f  apply_over_vars_
+000363c0: 7769 7468 5f64 696d 2c20 6266 696c 6c0a  with_dim, bfill.
+000363d0: 0a20 2020 2020 2020 206e 6577 203d 205f  .        new = _
+000363e0: 6170 706c 795f 6f76 6572 5f76 6172 735f  apply_over_vars_
+000363f0: 7769 7468 5f64 696d 2862 6669 6c6c 2c20  with_dim(bfill, 
+00036400: 7365 6c66 2c20 6469 6d3d 6469 6d2c 206c  self, dim=dim, l
+00036410: 696d 6974 3d6c 696d 6974 290a 2020 2020  imit=limit).    
+00036420: 2020 2020 7265 7475 726e 206e 6577 0a0a      return new..
+00036430: 2020 2020 6465 6620 636f 6d62 696e 655f      def combine_
+00036440: 6669 7273 7428 7365 6c66 3a20 545f 4461  first(self: T_Da
+00036450: 7461 7365 742c 206f 7468 6572 3a20 545f  taset, other: T_
+00036460: 4461 7461 7365 7429 202d 3e20 545f 4461  Dataset) -> T_Da
+00036470: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+00036480: 2222 436f 6d62 696e 6520 7477 6f20 4461  ""Combine two Da
+00036490: 7461 7365 7473 2c20 6465 6661 756c 7420  tasets, default 
+000364a0: 746f 2064 6174 615f 7661 7273 206f 6620  to data_vars of 
+000364b0: 7365 6c66 2e0a 0a20 2020 2020 2020 2054  self...        T
+000364c0: 6865 206e 6577 2063 6f6f 7264 696e 6174  he new coordinat
+000364d0: 6573 2066 6f6c 6c6f 7720 7468 6520 6e6f  es follow the no
+000364e0: 726d 616c 2062 726f 6164 6361 7374 696e  rmal broadcastin
+000364f0: 6720 616e 6420 616c 6967 6e6d 656e 7420  g and alignment 
+00036500: 7275 6c65 730a 2020 2020 2020 2020 6f66  rules.        of
+00036510: 2060 606a 6f69 6e3d 276f 7574 6572 2760   ``join='outer'`
+00036520: 602e 2020 5661 6361 6e74 2063 656c 6c73  `.  Vacant cells
+00036530: 2069 6e20 7468 6520 6578 7061 6e64 6564   in the expanded
+00036540: 2063 6f6f 7264 696e 6174 6573 2061 7265   coordinates are
+00036550: 0a20 2020 2020 2020 2066 696c 6c65 6420  .        filled 
+00036560: 7769 7468 206e 702e 6e61 6e2e 0a0a 2020  with np.nan...  
+00036570: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00036580: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00036590: 2d2d 2d0a 2020 2020 2020 2020 6f74 6865  ---.        othe
+000365a0: 7220 3a20 4461 7461 7365 740a 2020 2020  r : Dataset.    
+000365b0: 2020 2020 2020 2020 5573 6564 2074 6f20          Used to 
+000365c0: 6669 6c6c 2061 6c6c 206d 6174 6368 696e  fill all matchin
+000365d0: 6720 6d69 7373 696e 6720 7661 6c75 6573  g missing values
+000365e0: 2069 6e20 7468 6973 2061 7272 6179 2e0a   in this array..
+000365f0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00036600: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00036610: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+00036620: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00036630: 2020 2020 206f 7574 203d 206f 7073 2e66       out = ops.f
+00036640: 696c 6c6e 6128 7365 6c66 2c20 6f74 6865  illna(self, othe
+00036650: 722c 206a 6f69 6e3d 226f 7574 6572 222c  r, join="outer",
+00036660: 2064 6174 6173 6574 5f6a 6f69 6e3d 226f   dataset_join="o
+00036670: 7574 6572 2229 0a20 2020 2020 2020 2072  uter").        r
+00036680: 6574 7572 6e20 6f75 740a 0a20 2020 2064  eturn out..    d
+00036690: 6566 2072 6564 7563 6528 0a20 2020 2020  ef reduce(.     
+000366a0: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+000366b0: 6574 2c0a 2020 2020 2020 2020 6675 6e63  et,.        func
+000366c0: 3a20 4361 6c6c 6162 6c65 2c0a 2020 2020  : Callable,.    
+000366d0: 2020 2020 6469 6d3a 2044 696d 7320 3d20      dim: Dims = 
+000366e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2c  None,.        *,
+000366f0: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
+00036700: 7472 733a 2062 6f6f 6c20 7c20 4e6f 6e65  trs: bool | None
+00036710: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00036720: 206b 6565 7064 696d 733a 2062 6f6f 6c20   keepdims: bool 
+00036730: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00036740: 206e 756d 6572 6963 5f6f 6e6c 793a 2062   numeric_only: b
+00036750: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+00036760: 2020 2020 202a 2a6b 7761 7267 733a 2041       **kwargs: A
+00036770: 6e79 2c0a 2020 2020 2920 2d3e 2054 5f44  ny,.    ) -> T_D
+00036780: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+00036790: 2222 2252 6564 7563 6520 7468 6973 2064  """Reduce this d
+000367a0: 6174 6173 6574 2062 7920 6170 706c 7969  ataset by applyi
+000367b0: 6e67 2060 6675 6e63 6020 616c 6f6e 6720  ng `func` along 
+000367c0: 736f 6d65 2064 696d 656e 7369 6f6e 2873  some dimension(s
+000367d0: 292e 0a0a 2020 2020 2020 2020 5061 7261  )...        Para
+000367e0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+000367f0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00036800: 2020 6675 6e63 203a 2063 616c 6c61 626c    func : callabl
+00036810: 650a 2020 2020 2020 2020 2020 2020 4675  e.            Fu
+00036820: 6e63 7469 6f6e 2077 6869 6368 2063 616e  nction which can
+00036830: 2062 6520 6361 6c6c 6564 2069 6e20 7468   be called in th
+00036840: 6520 666f 726d 0a20 2020 2020 2020 2020  e form.         
+00036850: 2020 2060 6628 782c 2061 7869 733d 6178     `f(x, axis=ax
+00036860: 6973 2c20 2a2a 6b77 6172 6773 2960 2074  is, **kwargs)` t
+00036870: 6f20 7265 7475 726e 2074 6865 2072 6573  o return the res
+00036880: 756c 7420 6f66 2072 6564 7563 696e 6720  ult of reducing 
+00036890: 616e 0a20 2020 2020 2020 2020 2020 206e  an.            n
+000368a0: 702e 6e64 6172 7261 7920 6f76 6572 2061  p.ndarray over a
+000368b0: 6e20 696e 7465 6765 7220 7661 6c75 6564  n integer valued
+000368c0: 2061 7869 732e 0a20 2020 2020 2020 2064   axis..        d
+000368d0: 696d 203a 2073 7472 2c20 4974 6572 6162  im : str, Iterab
+000368e0: 6c65 206f 6620 4861 7368 6162 6c65 206f  le of Hashable o
+000368f0: 7220 4e6f 6e65 2c20 6f70 7469 6f6e 616c  r None, optional
+00036900: 0a20 2020 2020 2020 2020 2020 2044 696d  .            Dim
+00036910: 656e 7369 6f6e 2873 2920 6f76 6572 2077  ension(s) over w
+00036920: 6869 6368 2074 6f20 6170 706c 7920 6066  hich to apply `f
+00036930: 756e 6360 2e20 4279 2064 6566 6175 6c74  unc`. By default
+00036940: 2060 6675 6e63 6020 6973 0a20 2020 2020   `func` is.     
+00036950: 2020 2020 2020 2061 7070 6c69 6564 206f         applied o
+00036960: 7665 7220 616c 6c20 6469 6d65 6e73 696f  ver all dimensio
+00036970: 6e73 2e0a 2020 2020 2020 2020 6b65 6570  ns..        keep
+00036980: 5f61 7474 7273 203a 2062 6f6f 6c20 6f72  _attrs : bool or
+00036990: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
+000369a0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+000369b0: 7275 652c 2074 6865 2064 6174 6173 6574  rue, the dataset
+000369c0: 2773 2061 7474 7269 6275 7465 7320 2860  's attributes (`
+000369d0: 6174 7472 7360 2920 7769 6c6c 2062 6520  attrs`) will be 
+000369e0: 636f 7069 6564 2066 726f 6d0a 2020 2020  copied from.    
+000369f0: 2020 2020 2020 2020 7468 6520 6f72 6967          the orig
+00036a00: 696e 616c 206f 626a 6563 7420 746f 2074  inal object to t
+00036a10: 6865 206e 6577 206f 6e65 2e20 2049 6620  he new one.  If 
+00036a20: 4661 6c73 6520 2864 6566 6175 6c74 292c  False (default),
+00036a30: 2074 6865 206e 6577 0a20 2020 2020 2020   the new.       
+00036a40: 2020 2020 206f 626a 6563 7420 7769 6c6c       object will
+00036a50: 2062 6520 7265 7475 726e 6564 2077 6974   be returned wit
+00036a60: 686f 7574 2061 7474 7269 6275 7465 732e  hout attributes.
+00036a70: 0a20 2020 2020 2020 206b 6565 7064 696d  .        keepdim
+00036a80: 7320 3a20 626f 6f6c 2c20 6465 6661 756c  s : bool, defaul
+00036a90: 743a 2046 616c 7365 0a20 2020 2020 2020  t: False.       
+00036aa0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+00036ab0: 6520 6469 6d65 6e73 696f 6e73 2077 6869  e dimensions whi
+00036ac0: 6368 2061 7265 2072 6564 7563 6564 2061  ch are reduced a
+00036ad0: 7265 206c 6566 7420 696e 2074 6865 2072  re left in the r
+00036ae0: 6573 756c 740a 2020 2020 2020 2020 2020  esult.          
+00036af0: 2020 6173 2064 696d 656e 7369 6f6e 7320    as dimensions 
+00036b00: 6f66 2073 697a 6520 6f6e 652e 2043 6f6f  of size one. Coo
+00036b10: 7264 696e 6174 6573 2074 6861 7420 7573  rdinates that us
+00036b20: 6520 7468 6573 6520 6469 6d65 6e73 696f  e these dimensio
+00036b30: 6e73 0a20 2020 2020 2020 2020 2020 2061  ns.            a
+00036b40: 7265 2072 656d 6f76 6564 2e0a 2020 2020  re removed..    
+00036b50: 2020 2020 6e75 6d65 7269 635f 6f6e 6c79      numeric_only
+00036b60: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00036b70: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
+00036b80: 2020 2020 4966 2054 7275 652c 206f 6e6c      If True, onl
+00036b90: 7920 6170 706c 7920 6060 6675 6e63 6060  y apply ``func``
+00036ba0: 2074 6f20 7661 7269 6162 6c65 7320 7769   to variables wi
+00036bb0: 7468 2061 206e 756d 6572 6963 2064 7479  th a numeric dty
+00036bc0: 7065 2e0a 2020 2020 2020 2020 2a2a 6b77  pe..        **kw
+00036bd0: 6172 6773 203a 2041 6e79 0a20 2020 2020  args : Any.     
+00036be0: 2020 2020 2020 2041 6464 6974 696f 6e61         Additiona
+00036bf0: 6c20 6b65 7977 6f72 6420 6172 6775 6d65  l keyword argume
+00036c00: 6e74 7320 7061 7373 6564 206f 6e20 746f  nts passed on to
+00036c10: 2060 6066 756e 6360 602e 0a0a 2020 2020   ``func``...    
+00036c20: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00036c30: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00036c40: 2020 2020 7265 6475 6365 6420 3a20 4461      reduced : Da
+00036c50: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
+00036c60: 2020 4461 7461 7365 7420 7769 7468 2074    Dataset with t
+00036c70: 6869 7320 6f62 6a65 6374 2773 2044 6174  his object's Dat
+00036c80: 6141 7272 6179 7320 7265 706c 6163 6564  aArrays replaced
+00036c90: 2077 6974 6820 6e65 7720 4461 7461 4172   with new DataAr
+00036ca0: 7261 7973 0a20 2020 2020 2020 2020 2020  rays.           
+00036cb0: 206f 6620 7375 6d6d 6172 697a 6564 2064   of summarized d
+00036cc0: 6174 6120 616e 6420 7468 6520 696e 6469  ata and the indi
+00036cd0: 6361 7465 6420 6469 6d65 6e73 696f 6e28  cated dimension(
+00036ce0: 7329 2072 656d 6f76 6564 2e0a 2020 2020  s) removed..    
+00036cf0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00036d00: 6966 206b 7761 7267 732e 6765 7428 2261  if kwargs.get("a
+00036d10: 7869 7322 2c20 4e6f 6e65 2920 6973 206e  xis", None) is n
+00036d20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00036d30: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00036d40: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00036d50: 2020 2020 2020 2022 7061 7373 696e 6720         "passing 
+00036d60: 2761 7869 7327 2074 6f20 4461 7461 7365  'axis' to Datase
+00036d70: 7420 7265 6475 6365 206d 6574 686f 6473  t reduce methods
+00036d80: 2069 7320 616d 6269 6775 6f75 732e 220a   is ambiguous.".
+00036d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036da0: 2220 506c 6561 7365 2075 7365 2027 6469  " Please use 'di
+00036db0: 6d27 2069 6e73 7465 6164 2e22 0a20 2020  m' instead.".   
+00036dc0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00036dd0: 2020 2020 6966 2064 696d 2069 7320 4e6f      if dim is No
+00036de0: 6e65 206f 7220 6469 6d20 6973 202e 2e2e  ne or dim is ...
+00036df0: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+00036e00: 6d73 203d 2073 6574 2873 656c 662e 6469  ms = set(self.di
+00036e10: 6d73 290a 2020 2020 2020 2020 656c 6966  ms).        elif
+00036e20: 2069 7369 6e73 7461 6e63 6528 6469 6d2c   isinstance(dim,
+00036e30: 2073 7472 2920 6f72 206e 6f74 2069 7369   str) or not isi
+00036e40: 6e73 7461 6e63 6528 6469 6d2c 2049 7465  nstance(dim, Ite
+00036e50: 7261 626c 6529 3a0a 2020 2020 2020 2020  rable):.        
+00036e60: 2020 2020 6469 6d73 203d 207b 6469 6d7d      dims = {dim}
+00036e70: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00036e80: 2020 2020 2020 2020 2020 2064 696d 7320             dims 
+00036e90: 3d20 7365 7428 6469 6d29 0a0a 2020 2020  = set(dim)..    
+00036ea0: 2020 2020 6d69 7373 696e 675f 6469 6d65      missing_dime
+00036eb0: 6e73 696f 6e73 203d 205b 6420 666f 7220  nsions = [d for 
+00036ec0: 6420 696e 2064 696d 7320 6966 2064 206e  d in dims if d n
+00036ed0: 6f74 2069 6e20 7365 6c66 2e64 696d 735d  ot in self.dims]
+00036ee0: 0a20 2020 2020 2020 2069 6620 6d69 7373  .        if miss
+00036ef0: 696e 675f 6469 6d65 6e73 696f 6e73 3a0a  ing_dimensions:.
+00036f00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00036f10: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00036f20: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00036f30: 4461 7461 7365 7420 646f 6573 206e 6f74  Dataset does not
+00036f40: 2063 6f6e 7461 696e 2074 6865 2064 696d   contain the dim
+00036f50: 656e 7369 6f6e 733a 207b 6d69 7373 696e  ensions: {missin
+00036f60: 675f 6469 6d65 6e73 696f 6e73 7d22 0a20  g_dimensions}". 
+00036f70: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00036f80: 2020 2020 2020 6966 206b 6565 705f 6174        if keep_at
+00036f90: 7472 7320 6973 204e 6f6e 653a 0a20 2020  trs is None:.   
+00036fa0: 2020 2020 2020 2020 206b 6565 705f 6174           keep_at
+00036fb0: 7472 7320 3d20 5f67 6574 5f6b 6565 705f  trs = _get_keep_
+00036fc0: 6174 7472 7328 6465 6661 756c 743d 4661  attrs(default=Fa
+00036fd0: 6c73 6529 0a0a 2020 2020 2020 2020 7661  lse)..        va
+00036fe0: 7269 6162 6c65 733a 2064 6963 745b 4861  riables: dict[Ha
+00036ff0: 7368 6162 6c65 2c20 5661 7269 6162 6c65  shable, Variable
+00037000: 5d20 3d20 7b7d 0a20 2020 2020 2020 2066  ] = {}.        f
+00037010: 6f72 206e 616d 652c 2076 6172 2069 6e20  or name, var in 
+00037020: 7365 6c66 2e5f 7661 7269 6162 6c65 732e  self._variables.
+00037030: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00037040: 2020 2020 2072 6564 7563 655f 6469 6d73       reduce_dims
+00037050: 203d 205b 6420 666f 7220 6420 696e 2076   = [d for d in v
+00037060: 6172 2e64 696d 7320 6966 2064 2069 6e20  ar.dims if d in 
+00037070: 6469 6d73 5d0a 2020 2020 2020 2020 2020  dims].          
+00037080: 2020 6966 206e 616d 6520 696e 2073 656c    if name in sel
+00037090: 662e 636f 6f72 6473 3a0a 2020 2020 2020  f.coords:.      
+000370a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000370b0: 2072 6564 7563 655f 6469 6d73 3a0a 2020   reduce_dims:.  
+000370c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000370d0: 2020 7661 7269 6162 6c65 735b 6e61 6d65    variables[name
+000370e0: 5d20 3d20 7661 720a 2020 2020 2020 2020  ] = var.        
+000370f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00037100: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+00037110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037120: 2020 2023 2053 6f6d 6520 7265 6475 6374     # Some reduct
+00037130: 696f 6e20 6675 6e63 7469 6f6e 7320 2865  ion functions (e
+00037140: 2e67 2e20 7374 642c 2076 6172 2920 6e65  .g. std, var) ne
+00037150: 6564 2074 6f20 7275 6e20 6f6e 2076 6172  ed to run on var
+00037160: 6961 626c 6573 0a20 2020 2020 2020 2020  iables.         
+00037170: 2020 2020 2020 2020 2020 2023 2074 6861             # tha
+00037180: 7420 646f 6e27 7420 6861 7665 2074 6865  t don't have the
+00037190: 2072 6564 7563 6520 6469 6d73 3a20 5052   reduce dims: PR
+000371a0: 3533 3933 0a20 2020 2020 2020 2020 2020  5393.           
+000371b0: 2020 2020 2020 2020 206e 6f74 2072 6564           not red
+000371c0: 7563 655f 6469 6d73 0a20 2020 2020 2020  uce_dims.       
+000371d0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
+000371e0: 6e6f 7420 6e75 6d65 7269 635f 6f6e 6c79  not numeric_only
+000371f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037200: 2020 2020 206f 7220 6e70 2e69 7373 7562       or np.issub
+00037210: 6474 7970 6528 7661 722e 6474 7970 652c  dtype(var.dtype,
+00037220: 206e 702e 6e75 6d62 6572 290a 2020 2020   np.number).    
+00037230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037240: 6f72 2028 7661 722e 6474 7970 6520 3d3d  or (var.dtype ==
+00037250: 206e 702e 626f 6f6c 5f29 0a20 2020 2020   np.bool_).     
+00037260: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+00037270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037280: 2020 2320 7072 6566 6572 2074 6f20 6167    # prefer to ag
+00037290: 6772 6567 6174 6520 6f76 6572 2061 7869  gregate over axi
+000372a0: 733d 4e6f 6e65 2072 6174 6865 7220 7468  s=None rather th
+000372b0: 616e 0a20 2020 2020 2020 2020 2020 2020  an.             
+000372c0: 2020 2020 2020 2023 2061 7869 733d 2830         # axis=(0
+000372d0: 2c20 3129 2069 6620 7468 6579 2077 696c  , 1) if they wil
+000372e0: 6c20 6265 2065 7175 6976 616c 656e 742c  l be equivalent,
+000372f0: 2062 6563 6175 7365 0a20 2020 2020 2020   because.       
+00037300: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+00037310: 6865 2066 6f72 6d65 7220 6973 206f 6674  he former is oft
+00037320: 656e 206d 6f72 6520 6566 6669 6369 656e  en more efficien
+00037330: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00037340: 2020 2020 2020 2320 6b65 6570 2073 696e        # keep sin
+00037350: 676c 652d 656c 656d 656e 7420 6469 6d73  gle-element dims
+00037360: 2061 7320 6c69 7374 2c20 746f 2073 7570   as list, to sup
+00037370: 706f 7274 2048 6173 6861 626c 6573 0a20  port Hashables. 
+00037380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037390: 2020 2072 6564 7563 655f 6d61 7962 655f     reduce_maybe_
+000373a0: 7369 6e67 6c65 203d 2028 0a20 2020 2020  single = (.     
+000373b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000373c0: 2020 204e 6f6e 650a 2020 2020 2020 2020     None.        
+000373d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000373e0: 6966 206c 656e 2872 6564 7563 655f 6469  if len(reduce_di
+000373f0: 6d73 2920 3d3d 2076 6172 2e6e 6469 6d20  ms) == var.ndim 
+00037400: 616e 6420 7661 722e 6e64 696d 2021 3d20  and var.ndim != 
+00037410: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00037420: 2020 2020 2020 2020 2020 656c 7365 2072            else r
+00037430: 6564 7563 655f 6469 6d73 0a20 2020 2020  educe_dims.     
+00037440: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00037450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037460: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
+00037470: 616d 655d 203d 2076 6172 2e72 6564 7563  ame] = var.reduc
+00037480: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00037490: 2020 2020 2020 2020 2020 2066 756e 632c             func,
+000374a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000374b0: 2020 2020 2020 2020 2064 696d 3d72 6564           dim=red
+000374c0: 7563 655f 6d61 7962 655f 7369 6e67 6c65  uce_maybe_single
+000374d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000374e0: 2020 2020 2020 2020 2020 6b65 6570 5f61            keep_a
+000374f0: 7474 7273 3d6b 6565 705f 6174 7472 732c  ttrs=keep_attrs,
+00037500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037510: 2020 2020 2020 2020 206b 6565 7064 696d           keepdim
+00037520: 733d 6b65 6570 6469 6d73 2c0a 2020 2020  s=keepdims,.    
+00037530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037540: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+00037550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037560: 2020 290a 0a20 2020 2020 2020 2063 6f6f    )..        coo
+00037570: 7264 5f6e 616d 6573 203d 207b 6b20 666f  rd_names = {k fo
+00037580: 7220 6b20 696e 2073 656c 662e 636f 6f72  r k in self.coor
+00037590: 6473 2069 6620 6b20 696e 2076 6172 6961  ds if k in varia
+000375a0: 626c 6573 7d0a 2020 2020 2020 2020 696e  bles}.        in
+000375b0: 6465 7865 7320 3d20 7b6b 3a20 7620 666f  dexes = {k: v fo
+000375c0: 7220 6b2c 2076 2069 6e20 7365 6c66 2e5f  r k, v in self._
+000375d0: 696e 6465 7865 732e 6974 656d 7328 2920  indexes.items() 
+000375e0: 6966 206b 2069 6e20 7661 7269 6162 6c65  if k in variable
+000375f0: 737d 0a20 2020 2020 2020 2061 7474 7273  s}.        attrs
+00037600: 203d 2073 656c 662e 6174 7472 7320 6966   = self.attrs if
+00037610: 206b 6565 705f 6174 7472 7320 656c 7365   keep_attrs else
+00037620: 204e 6f6e 650a 2020 2020 2020 2020 7265   None.        re
+00037630: 7475 726e 2073 656c 662e 5f72 6570 6c61  turn self._repla
+00037640: 6365 5f77 6974 685f 6e65 775f 6469 6d73  ce_with_new_dims
+00037650: 280a 2020 2020 2020 2020 2020 2020 7661  (.            va
+00037660: 7269 6162 6c65 732c 2063 6f6f 7264 5f6e  riables, coord_n
+00037670: 616d 6573 3d63 6f6f 7264 5f6e 616d 6573  ames=coord_names
+00037680: 2c20 6174 7472 733d 6174 7472 732c 2069  , attrs=attrs, i
+00037690: 6e64 6578 6573 3d69 6e64 6578 6573 0a20  ndexes=indexes. 
+000376a0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+000376b0: 6620 6d61 7028 0a20 2020 2020 2020 2073  f map(.        s
 000376c0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-000376d0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-000376e0: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
-000376f0: 416e 795d 207c 204e 6f6e 6520 3d20 4e6f  Any] | None = No
-00037700: 6e65 2c0a 2020 2020 2020 2020 2a2a 7661  ne,.        **va
-00037710: 7269 6162 6c65 735f 6b77 6172 6773 3a20  riables_kwargs: 
-00037720: 416e 792c 0a20 2020 2029 202d 3e20 545f  Any,.    ) -> T_
-00037730: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-00037740: 2022 2222 4173 7369 676e 206e 6577 2064   """Assign new d
-00037750: 6174 6120 7661 7269 6162 6c65 7320 746f  ata variables to
-00037760: 2061 2044 6174 6173 6574 2c20 7265 7475   a Dataset, retu
-00037770: 726e 696e 6720 6120 6e65 7720 6f62 6a65  rning a new obje
-00037780: 6374 0a20 2020 2020 2020 2077 6974 6820  ct.        with 
-00037790: 616c 6c20 7468 6520 6f72 6967 696e 616c  all the original
-000377a0: 2076 6172 6961 626c 6573 2069 6e20 6164   variables in ad
-000377b0: 6469 7469 6f6e 2074 6f20 7468 6520 6e65  dition to the ne
-000377c0: 7720 6f6e 6573 2e0a 0a20 2020 2020 2020  w ones...       
-000377d0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000377e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000377f0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-00037800: 203a 206d 6170 7069 6e67 206f 6620 6861   : mapping of ha
-00037810: 7368 6162 6c65 2074 6f20 416e 790a 2020  shable to Any.  
-00037820: 2020 2020 2020 2020 2020 4d61 7070 696e            Mappin
-00037830: 6720 6672 6f6d 2076 6172 6961 626c 6573  g from variables
-00037840: 206e 616d 6573 2074 6f20 7468 6520 6e65   names to the ne
-00037850: 7720 7661 6c75 6573 2e20 4966 2074 6865  w values. If the
-00037860: 206e 6577 2076 616c 7565 730a 2020 2020   new values.    
-00037870: 2020 2020 2020 2020 6172 6520 6361 6c6c          are call
-00037880: 6162 6c65 2c20 7468 6579 2061 7265 2063  able, they are c
-00037890: 6f6d 7075 7465 6420 6f6e 2074 6865 2044  omputed on the D
-000378a0: 6174 6173 6574 2061 6e64 2061 7373 6967  ataset and assig
-000378b0: 6e65 6420 746f 206e 6577 0a20 2020 2020  ned to new.     
-000378c0: 2020 2020 2020 2064 6174 6120 7661 7269         data vari
-000378d0: 6162 6c65 732e 2049 6620 7468 6520 7661  ables. If the va
-000378e0: 6c75 6573 2061 7265 206e 6f74 2063 616c  lues are not cal
-000378f0: 6c61 626c 652c 2028 652e 672e 2061 2044  lable, (e.g. a D
-00037900: 6174 6141 7272 6179 2c0a 2020 2020 2020  ataArray,.      
-00037910: 2020 2020 2020 7363 616c 6172 2c20 6f72        scalar, or
-00037920: 2061 7272 6179 292c 2074 6865 7920 6172   array), they ar
-00037930: 6520 7369 6d70 6c79 2061 7373 6967 6e65  e simply assigne
-00037940: 642e 0a20 2020 2020 2020 202a 2a76 6172  d..        **var
-00037950: 6961 626c 6573 5f6b 7761 7267 730a 2020  iables_kwargs.  
-00037960: 2020 2020 2020 2020 2020 5468 6520 6b65            The ke
-00037970: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-00037980: 666f 726d 206f 6620 6060 7661 7269 6162  form of ``variab
-00037990: 6c65 7360 602e 0a20 2020 2020 2020 2020  les``..         
-000379a0: 2020 204f 6e65 206f 6620 7661 7269 6162     One of variab
-000379b0: 6c65 7320 6f72 2076 6172 6961 626c 6573  les or variables
-000379c0: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
-000379d0: 7072 6f76 6964 6564 2e0a 0a20 2020 2020  provided...     
-000379e0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-000379f0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00037a00: 2020 2064 7320 3a20 4461 7461 7365 740a     ds : Dataset.
-00037a10: 2020 2020 2020 2020 2020 2020 4120 6e65              A ne
-00037a20: 7720 4461 7461 7365 7420 7769 7468 2074  w Dataset with t
-00037a30: 6865 206e 6577 2076 6172 6961 626c 6573  he new variables
-00037a40: 2069 6e20 6164 6469 7469 6f6e 2074 6f20   in addition to 
-00037a50: 616c 6c20 7468 650a 2020 2020 2020 2020  all the.        
-00037a60: 2020 2020 6578 6973 7469 6e67 2076 6172      existing var
-00037a70: 6961 626c 6573 2e0a 0a20 2020 2020 2020  iables...       
-00037a80: 204e 6f74 6573 0a20 2020 2020 2020 202d   Notes.        -
-00037a90: 2d2d 2d2d 0a20 2020 2020 2020 2053 696e  ----.        Sin
-00037aa0: 6365 2060 606b 7761 7267 7360 6020 6973  ce ``kwargs`` is
-00037ab0: 2061 2064 6963 7469 6f6e 6172 792c 2074   a dictionary, t
-00037ac0: 6865 206f 7264 6572 206f 6620 796f 7572  he order of your
-00037ad0: 2061 7267 756d 656e 7473 206d 6179 206e   arguments may n
-00037ae0: 6f74 0a20 2020 2020 2020 2062 6520 7072  ot.        be pr
-00037af0: 6573 6572 7665 642c 2061 6e64 2073 6f20  eserved, and so 
-00037b00: 7468 6520 6f72 6465 7220 6f66 2074 6865  the order of the
-00037b10: 206e 6577 2076 6172 6961 626c 6573 2069   new variables i
-00037b20: 7320 6e6f 7420 7765 6c6c 0a20 2020 2020  s not well.     
-00037b30: 2020 2064 6566 696e 6564 2e20 4173 7369     defined. Assi
-00037b40: 676e 696e 6720 6d75 6c74 6970 6c65 2076  gning multiple v
-00037b50: 6172 6961 626c 6573 2077 6974 6869 6e20  ariables within 
-00037b60: 7468 6520 7361 6d65 2060 6061 7373 6967  the same ``assig
-00037b70: 6e60 6020 6973 0a20 2020 2020 2020 2070  n`` is.        p
-00037b80: 6f73 7369 626c 652c 2062 7574 2079 6f75  ossible, but you
-00037b90: 2063 616e 6e6f 7420 7265 6665 7265 6e63   cannot referenc
-00037ba0: 6520 6f74 6865 7220 7661 7269 6162 6c65  e other variable
-00037bb0: 7320 6372 6561 7465 6420 7769 7468 696e  s created within
-00037bc0: 2074 6865 0a20 2020 2020 2020 2073 616d   the.        sam
-00037bd0: 6520 6060 6173 7369 676e 6060 2063 616c  e ``assign`` cal
-00037be0: 6c2e 0a0a 2020 2020 2020 2020 5365 6520  l...        See 
-00037bf0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-00037c00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7061  -----.        pa
-00037c10: 6e64 6173 2e44 6174 6146 7261 6d65 2e61  ndas.DataFrame.a
-00037c20: 7373 6967 6e0a 0a20 2020 2020 2020 2045  ssign..        E
-00037c30: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
-00037c40: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00037c50: 203e 3e3e 2078 203d 2078 722e 4461 7461   >>> x = xr.Data
-00037c60: 7365 7428 0a20 2020 2020 2020 202e 2e2e  set(.        ...
-00037c70: 2020 2020 207b 0a20 2020 2020 2020 202e       {.        .
-00037c80: 2e2e 2020 2020 2020 2020 2022 7465 6d70  ..         "temp
-00037c90: 6572 6174 7572 655f 6322 3a20 280a 2020  erature_c": (.  
-00037ca0: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
-00037cb0: 2020 2020 2020 2822 6c61 7422 2c20 226c        ("lat", "l
-00037cc0: 6f6e 2229 2c0a 2020 2020 2020 2020 2e2e  on"),.        ..
-00037cd0: 2e20 2020 2020 2020 2020 2020 2020 3230  .             20
-00037ce0: 202a 206e 702e 7261 6e64 6f6d 2e72 616e   * np.random.ran
-00037cf0: 6428 3429 2e72 6573 6861 7065 2832 2c20  d(4).reshape(2, 
-00037d00: 3229 2c0a 2020 2020 2020 2020 2e2e 2e20  2),.        ... 
-00037d10: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-00037d20: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
-00037d30: 7072 6563 6970 6974 6174 696f 6e22 3a20  precipitation": 
-00037d40: 2828 226c 6174 222c 2022 6c6f 6e22 292c  (("lat", "lon"),
-00037d50: 206e 702e 7261 6e64 6f6d 2e72 616e 6428   np.random.rand(
-00037d60: 3429 2e72 6573 6861 7065 2832 2c20 3229  4).reshape(2, 2)
-00037d70: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
-00037d80: 2020 207d 2c0a 2020 2020 2020 2020 2e2e     },.        ..
-00037d90: 2e20 2020 2020 636f 6f72 6473 3d7b 226c  .     coords={"l
-00037da0: 6174 223a 205b 3130 2c20 3230 5d2c 2022  at": [10, 20], "
-00037db0: 6c6f 6e22 3a20 5b31 3530 2c20 3136 305d  lon": [150, 160]
-00037dc0: 7d2c 0a20 2020 2020 2020 202e 2e2e 2029  },.        ... )
-00037dd0: 0a20 2020 2020 2020 203e 3e3e 2078 0a20  .        >>> x. 
-00037de0: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
-00037df0: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
-00037e00: 4469 6d65 6e73 696f 6e73 3a20 2020 2020  Dimensions:     
-00037e10: 2020 2028 6c61 743a 2032 2c20 6c6f 6e3a     (lat: 2, lon:
-00037e20: 2032 290a 2020 2020 2020 2020 436f 6f72   2).        Coor
-00037e30: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
-00037e40: 2020 202a 206c 6174 2020 2020 2020 2020     * lat        
-00037e50: 2020 2020 286c 6174 2920 696e 7436 3420      (lat) int64 
-00037e60: 3130 2032 300a 2020 2020 2020 2020 2020  10 20.          
-00037e70: 2a20 6c6f 6e20 2020 2020 2020 2020 2020  * lon           
-00037e80: 2028 6c6f 6e29 2069 6e74 3634 2031 3530   (lon) int64 150
-00037e90: 2031 3630 0a20 2020 2020 2020 2044 6174   160.        Dat
-00037ea0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-00037eb0: 2020 2020 2020 2020 2074 656d 7065 7261           tempera
-00037ec0: 7475 7265 5f63 2020 286c 6174 2c20 6c6f  ture_c  (lat, lo
-00037ed0: 6e29 2066 6c6f 6174 3634 2031 302e 3938  n) float64 10.98
-00037ee0: 2031 342e 3320 3132 2e30 3620 3130 2e39   14.3 12.06 10.9
-00037ef0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00037f00: 6369 7069 7461 7469 6f6e 2020 286c 6174  cipitation  (lat
-00037f10: 2c20 6c6f 6e29 2066 6c6f 6174 3634 2030  , lon) float64 0
-00037f20: 2e34 3233 3720 302e 3634 3539 2030 2e34  .4237 0.6459 0.4
-00037f30: 3337 3620 302e 3839 3138 0a0a 2020 2020  376 0.8918..    
-00037f40: 2020 2020 5768 6572 6520 7468 6520 7661      Where the va
-00037f50: 6c75 6520 6973 2061 2063 616c 6c61 626c  lue is a callabl
-00037f60: 652c 2065 7661 6c75 6174 6564 206f 6e20  e, evaluated on 
-00037f70: 6461 7461 7365 743a 0a0a 2020 2020 2020  dataset:..      
-00037f80: 2020 3e3e 3e20 782e 6173 7369 676e 2874    >>> x.assign(t
-00037f90: 656d 7065 7261 7475 7265 5f66 3d6c 616d  emperature_f=lam
-00037fa0: 6264 6120 783a 2078 2e74 656d 7065 7261  bda x: x.tempera
-00037fb0: 7475 7265 5f63 202a 2039 202f 2035 202b  ture_c * 9 / 5 +
-00037fc0: 2033 3229 0a20 2020 2020 2020 203c 7861   32).        <xa
-00037fd0: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-00037fe0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-00037ff0: 3a20 2020 2020 2020 2028 6c61 743a 2032  :        (lat: 2
-00038000: 2c20 6c6f 6e3a 2032 290a 2020 2020 2020  , lon: 2).      
-00038010: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-00038020: 2020 2020 2020 2020 202a 206c 6174 2020           * lat  
-00038030: 2020 2020 2020 2020 2020 286c 6174 2920            (lat) 
-00038040: 696e 7436 3420 3130 2032 300a 2020 2020  int64 10 20.    
-00038050: 2020 2020 2020 2a20 6c6f 6e20 2020 2020        * lon     
-00038060: 2020 2020 2020 2028 6c6f 6e29 2069 6e74         (lon) int
-00038070: 3634 2031 3530 2031 3630 0a20 2020 2020  64 150 160.     
-00038080: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-00038090: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-000380a0: 656d 7065 7261 7475 7265 5f63 2020 286c  emperature_c  (l
-000380b0: 6174 2c20 6c6f 6e29 2066 6c6f 6174 3634  at, lon) float64
-000380c0: 2031 302e 3938 2031 342e 3320 3132 2e30   10.98 14.3 12.0
-000380d0: 3620 3130 2e39 0a20 2020 2020 2020 2020  6 10.9.         
-000380e0: 2020 2070 7265 6369 7069 7461 7469 6f6e     precipitation
-000380f0: 2020 286c 6174 2c20 6c6f 6e29 2066 6c6f    (lat, lon) flo
-00038100: 6174 3634 2030 2e34 3233 3720 302e 3634  at64 0.4237 0.64
-00038110: 3539 2030 2e34 3337 3620 302e 3839 3138  59 0.4376 0.8918
-00038120: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
-00038130: 7065 7261 7475 7265 5f66 2020 286c 6174  perature_f  (lat
-00038140: 2c20 6c6f 6e29 2066 6c6f 6174 3634 2035  , lon) float64 5
-00038150: 312e 3736 2035 372e 3735 2035 332e 3720  1.76 57.75 53.7 
-00038160: 3531 2e36 320a 0a20 2020 2020 2020 2041  51.62..        A
-00038170: 6c74 6572 6e61 7469 7665 6c79 2c20 7468  lternatively, th
-00038180: 6520 7361 6d65 2062 6568 6176 696f 7220  e same behavior 
-00038190: 6361 6e20 6265 2061 6368 6965 7665 6420  can be achieved 
-000381a0: 6279 2064 6972 6563 746c 7920 7265 6665  by directly refe
-000381b0: 7265 6e63 696e 6720 616e 2065 7869 7374  rencing an exist
-000381c0: 696e 6720 6461 7461 6172 7261 793a 0a0a  ing dataarray:..
-000381d0: 2020 2020 2020 2020 3e3e 3e20 782e 6173          >>> x.as
-000381e0: 7369 676e 2874 656d 7065 7261 7475 7265  sign(temperature
-000381f0: 5f66 3d78 5b22 7465 6d70 6572 6174 7572  _f=x["temperatur
-00038200: 655f 6322 5d20 2a20 3920 2f20 3520 2b20  e_c"] * 9 / 5 + 
-00038210: 3332 290a 2020 2020 2020 2020 3c78 6172  32).        <xar
-00038220: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
-00038230: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
-00038240: 2020 2020 2020 2020 286c 6174 3a20 322c          (lat: 2,
-00038250: 206c 6f6e 3a20 3229 0a20 2020 2020 2020   lon: 2).       
-00038260: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-00038270: 2020 2020 2020 2020 2a20 6c61 7420 2020          * lat   
-00038280: 2020 2020 2020 2020 2028 6c61 7429 2069           (lat) i
-00038290: 6e74 3634 2031 3020 3230 0a20 2020 2020  nt64 10 20.     
-000382a0: 2020 2020 202a 206c 6f6e 2020 2020 2020       * lon      
-000382b0: 2020 2020 2020 286c 6f6e 2920 696e 7436        (lon) int6
-000382c0: 3420 3135 3020 3136 300a 2020 2020 2020  4 150 160.      
-000382d0: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-000382e0: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-000382f0: 6d70 6572 6174 7572 655f 6320 2028 6c61  mperature_c  (la
-00038300: 742c 206c 6f6e 2920 666c 6f61 7436 3420  t, lon) float64 
-00038310: 3130 2e39 3820 3134 2e33 2031 322e 3036  10.98 14.3 12.06
-00038320: 2031 302e 390a 2020 2020 2020 2020 2020   10.9.          
-00038330: 2020 7072 6563 6970 6974 6174 696f 6e20    precipitation 
-00038340: 2028 6c61 742c 206c 6f6e 2920 666c 6f61   (lat, lon) floa
-00038350: 7436 3420 302e 3432 3337 2030 2e36 3435  t64 0.4237 0.645
-00038360: 3920 302e 3433 3736 2030 2e38 3931 380a  9 0.4376 0.8918.
-00038370: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-00038380: 6572 6174 7572 655f 6620 2028 6c61 742c  erature_f  (lat,
-00038390: 206c 6f6e 2920 666c 6f61 7436 3420 3531   lon) float64 51
-000383a0: 2e37 3620 3537 2e37 3520 3533 2e37 2035  .76 57.75 53.7 5
-000383b0: 312e 3632 0a0a 2020 2020 2020 2020 2222  1.62..        ""
-000383c0: 220a 2020 2020 2020 2020 7661 7269 6162  ".        variab
-000383d0: 6c65 7320 3d20 6569 7468 6572 5f64 6963  les = either_dic
-000383e0: 745f 6f72 5f6b 7761 7267 7328 7661 7269  t_or_kwargs(vari
-000383f0: 6162 6c65 732c 2076 6172 6961 626c 6573  ables, variables
-00038400: 5f6b 7761 7267 732c 2022 6173 7369 676e  _kwargs, "assign
-00038410: 2229 0a20 2020 2020 2020 2064 6174 6120  ").        data 
-00038420: 3d20 7365 6c66 2e63 6f70 7928 290a 2020  = self.copy().  
-00038430: 2020 2020 2020 2320 646f 2061 6c6c 2063        # do all c
-00038440: 616c 6375 6c61 7469 6f6e 7320 6669 7273  alculations firs
-00038450: 742e 2e2e 0a20 2020 2020 2020 2072 6573  t....        res
-00038460: 756c 7473 3a20 436f 6572 6369 626c 654d  ults: CoercibleM
-00038470: 6170 7069 6e67 203d 2064 6174 612e 5f63  apping = data._c
-00038480: 616c 635f 6173 7369 676e 5f72 6573 756c  alc_assign_resul
-00038490: 7473 2876 6172 6961 626c 6573 290a 2020  ts(variables).  
-000384a0: 2020 2020 2020 6461 7461 2e63 6f6f 7264        data.coord
-000384b0: 732e 5f6d 6179 6265 5f64 726f 705f 6d75  s._maybe_drop_mu
-000384c0: 6c74 6969 6e64 6578 5f63 6f6f 7264 7328  ltiindex_coords(
-000384d0: 7365 7428 7265 7375 6c74 732e 6b65 7973  set(results.keys
-000384e0: 2829 2929 0a20 2020 2020 2020 2023 202e  ())).        # .
-000384f0: 2e2e 2061 6e64 2074 6865 6e20 6173 7369  .. and then assi
-00038500: 676e 0a20 2020 2020 2020 2064 6174 612e  gn.        data.
-00038510: 7570 6461 7465 2872 6573 756c 7473 290a  update(results).
-00038520: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00038530: 6174 610a 0a20 2020 2064 6566 2074 6f5f  ata..    def to_
-00038540: 6172 7261 7928 0a20 2020 2020 2020 2073  array(.        s
-00038550: 656c 662c 2064 696d 3a20 4861 7368 6162  elf, dim: Hashab
-00038560: 6c65 203d 2022 7661 7269 6162 6c65 222c  le = "variable",
-00038570: 206e 616d 653a 2048 6173 6861 626c 6520   name: Hashable 
-00038580: 7c20 4e6f 6e65 203d 204e 6f6e 650a 2020  | None = None.  
-00038590: 2020 2920 2d3e 2044 6174 6141 7272 6179    ) -> DataArray
-000385a0: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
-000385b0: 7665 7274 2074 6869 7320 6461 7461 7365  vert this datase
-000385c0: 7420 696e 746f 2061 6e20 7861 7272 6179  t into an xarray
-000385d0: 2e44 6174 6141 7272 6179 0a0a 2020 2020  .DataArray..    
-000385e0: 2020 2020 5468 6520 6461 7461 2076 6172      The data var
-000385f0: 6961 626c 6573 206f 6620 7468 6973 2064  iables of this d
-00038600: 6174 6173 6574 2077 696c 6c20 6265 2062  ataset will be b
-00038610: 726f 6164 6361 7374 2061 6761 696e 7374  roadcast against
-00038620: 2065 6163 6820 6f74 6865 720a 2020 2020   each other.    
-00038630: 2020 2020 616e 6420 7374 6163 6b65 6420      and stacked 
-00038640: 616c 6f6e 6720 7468 6520 6669 7273 7420  along the first 
-00038650: 6178 6973 206f 6620 7468 6520 6e65 7720  axis of the new 
-00038660: 6172 7261 792e 2041 6c6c 2063 6f6f 7264  array. All coord
-00038670: 696e 6174 6573 206f 660a 2020 2020 2020  inates of.      
-00038680: 2020 7468 6973 2064 6174 6173 6574 2077    this dataset w
-00038690: 696c 6c20 7265 6d61 696e 2063 6f6f 7264  ill remain coord
-000386a0: 696e 6174 6573 2e0a 0a20 2020 2020 2020  inates...       
-000386b0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000386c0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000386d0: 2020 2020 2020 2064 696d 203a 2048 6173         dim : Has
-000386e0: 6861 626c 652c 2064 6566 6175 6c74 3a20  hable, default: 
-000386f0: 2276 6172 6961 626c 6522 0a20 2020 2020  "variable".     
-00038700: 2020 2020 2020 204e 616d 6520 6f66 2074         Name of t
-00038710: 6865 206e 6577 2064 696d 656e 7369 6f6e  he new dimension
-00038720: 2e0a 2020 2020 2020 2020 6e61 6d65 203a  ..        name :
-00038730: 2048 6173 6861 626c 6520 6f72 204e 6f6e   Hashable or Non
-00038740: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-00038750: 2020 2020 2020 2020 4e61 6d65 206f 6620          Name of 
-00038760: 7468 6520 6e65 7720 6461 7461 2061 7272  the new data arr
-00038770: 6179 2e0a 0a20 2020 2020 2020 2052 6574  ay...        Ret
-00038780: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00038790: 2d2d 2d2d 0a20 2020 2020 2020 2061 7272  ----.        arr
-000387a0: 6179 203a 2078 6172 7261 792e 4461 7461  ay : xarray.Data
-000387b0: 4172 7261 790a 2020 2020 2020 2020 2222  Array.        ""
-000387c0: 220a 2020 2020 2020 2020 6672 6f6d 2078  ".        from x
-000387d0: 6172 7261 792e 636f 7265 2e64 6174 6161  array.core.dataa
-000387e0: 7272 6179 2069 6d70 6f72 7420 4461 7461  rray import Data
-000387f0: 4172 7261 790a 0a20 2020 2020 2020 2064  Array..        d
-00038800: 6174 615f 7661 7273 203d 205b 7365 6c66  ata_vars = [self
-00038810: 2e76 6172 6961 626c 6573 5b6b 5d20 666f  .variables[k] fo
-00038820: 7220 6b20 696e 2073 656c 662e 6461 7461  r k in self.data
-00038830: 5f76 6172 735d 0a20 2020 2020 2020 2062  _vars].        b
-00038840: 726f 6164 6361 7374 5f76 6172 7320 3d20  roadcast_vars = 
-00038850: 6272 6f61 6463 6173 745f 7661 7269 6162  broadcast_variab
-00038860: 6c65 7328 2a64 6174 615f 7661 7273 290a  les(*data_vars).
-00038870: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00038880: 7563 6b5f 6172 7261 795f 6f70 732e 7374  uck_array_ops.st
-00038890: 6163 6b28 5b62 2e64 6174 6120 666f 7220  ack([b.data for 
-000388a0: 6220 696e 2062 726f 6164 6361 7374 5f76  b in broadcast_v
-000388b0: 6172 735d 2c20 6178 6973 3d30 290a 0a20  ars], axis=0).. 
-000388c0: 2020 2020 2020 2064 696d 7320 3d20 2864         dims = (d
-000388d0: 696d 2c29 202b 2062 726f 6164 6361 7374  im,) + broadcast
-000388e0: 5f76 6172 735b 305d 2e64 696d 730a 2020  _vars[0].dims.  
-000388f0: 2020 2020 2020 7661 7269 6162 6c65 203d        variable =
-00038900: 2056 6172 6961 626c 6528 6469 6d73 2c20   Variable(dims, 
-00038910: 6461 7461 2c20 7365 6c66 2e61 7474 7273  data, self.attrs
-00038920: 2c20 6661 7374 7061 7468 3d54 7275 6529  , fastpath=True)
-00038930: 0a0a 2020 2020 2020 2020 636f 6f72 6473  ..        coords
-00038940: 203d 207b 6b3a 2076 2e76 6172 6961 626c   = {k: v.variabl
-00038950: 6520 666f 7220 6b2c 2076 2069 6e20 7365  e for k, v in se
-00038960: 6c66 2e63 6f6f 7264 732e 6974 656d 7328  lf.coords.items(
-00038970: 297d 0a20 2020 2020 2020 2069 6e64 6578  )}.        index
-00038980: 6573 203d 2066 696c 7465 725f 696e 6465  es = filter_inde
-00038990: 7865 735f 6672 6f6d 5f63 6f6f 7264 7328  xes_from_coords(
-000389a0: 7365 6c66 2e5f 696e 6465 7865 732c 2073  self._indexes, s
-000389b0: 6574 2863 6f6f 7264 7329 290a 2020 2020  et(coords)).    
-000389c0: 2020 2020 6e65 775f 6469 6d5f 696e 6465      new_dim_inde
-000389d0: 7820 3d20 5061 6e64 6173 496e 6465 7828  x = PandasIndex(
-000389e0: 6c69 7374 2873 656c 662e 6461 7461 5f76  list(self.data_v
-000389f0: 6172 7329 2c20 6469 6d29 0a20 2020 2020  ars), dim).     
-00038a00: 2020 2069 6e64 6578 6573 5b64 696d 5d20     indexes[dim] 
-00038a10: 3d20 6e65 775f 6469 6d5f 696e 6465 780a  = new_dim_index.
-00038a20: 2020 2020 2020 2020 636f 6f72 6473 2e75          coords.u
-00038a30: 7064 6174 6528 6e65 775f 6469 6d5f 696e  pdate(new_dim_in
-00038a40: 6465 782e 6372 6561 7465 5f76 6172 6961  dex.create_varia
-00038a50: 626c 6573 2829 290a 0a20 2020 2020 2020  bles())..       
-00038a60: 2072 6574 7572 6e20 4461 7461 4172 7261   return DataArra
-00038a70: 792e 5f63 6f6e 7374 7275 6374 5f64 6972  y._construct_dir
-00038a80: 6563 7428 7661 7269 6162 6c65 2c20 636f  ect(variable, co
-00038a90: 6f72 6473 2c20 6e61 6d65 2c20 696e 6465  ords, name, inde
-00038aa0: 7865 7329 0a0a 2020 2020 6465 6620 5f6e  xes)..    def _n
-00038ab0: 6f72 6d61 6c69 7a65 5f64 696d 5f6f 7264  ormalize_dim_ord
-00038ac0: 6572 280a 2020 2020 2020 2020 7365 6c66  er(.        self
-00038ad0: 2c20 6469 6d5f 6f72 6465 723a 2053 6571  , dim_order: Seq
-00038ae0: 7565 6e63 655b 4861 7368 6162 6c65 5d20  uence[Hashable] 
-00038af0: 7c20 4e6f 6e65 203d 204e 6f6e 650a 2020  | None = None.  
-00038b00: 2020 2920 2d3e 2064 6963 745b 4861 7368    ) -> dict[Hash
-00038b10: 6162 6c65 2c20 696e 745d 3a0a 2020 2020  able, int]:.    
-00038b20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00038b30: 4368 6563 6b20 7468 6520 7661 6c69 6469  Check the validi
-00038b40: 7479 206f 6620 7468 6520 7072 6f76 6964  ty of the provid
-00038b50: 6564 2064 696d 656e 7369 6f6e 7320 6966  ed dimensions if
-00038b60: 2061 6e79 2061 6e64 2072 6574 7572 6e20   any and return 
-00038b70: 7468 6520 6d61 7070 696e 670a 2020 2020  the mapping.    
-00038b80: 2020 2020 6265 7477 6565 6e20 6469 6d65      between dime
-00038b90: 6e73 696f 6e20 6e61 6d65 2061 6e64 2074  nsion name and t
-00038ba0: 6865 6972 2073 697a 652e 0a0a 2020 2020  heir size...    
-00038bb0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00038bc0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00038bd0: 2d0a 2020 2020 2020 2020 6469 6d5f 6f72  -.        dim_or
-00038be0: 6465 723a 2053 6571 7565 6e63 6520 6f66  der: Sequence of
-00038bf0: 2048 6173 6861 626c 6520 6f72 204e 6f6e   Hashable or Non
-00038c00: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
-00038c10: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00038c20: 6e20 6f72 6465 7220 746f 2076 616c 6964  n order to valid
-00038c30: 6174 6520 2864 6566 6175 6c74 2074 6f20  ate (default to 
-00038c40: 7468 6520 616c 7068 6162 6574 6963 616c  the alphabetical
-00038c50: 206f 7264 6572 2069 6620 4e6f 6e65 292e   order if None).
-00038c60: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00038c70: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00038c80: 2d0a 2020 2020 2020 2020 7265 7375 6c74  -.        result
-00038c90: 203a 2064 6963 745b 4861 7368 6162 6c65   : dict[Hashable
-00038ca0: 2c20 696e 745d 0a20 2020 2020 2020 2020  , int].         
-00038cb0: 2020 2056 616c 6964 6174 6564 2064 696d     Validated dim
-00038cc0: 656e 7369 6f6e 7320 6d61 7070 696e 672e  ensions mapping.
-00038cd0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00038ce0: 2020 2020 2020 6966 2064 696d 5f6f 7264        if dim_ord
-00038cf0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-00038d00: 2020 2020 2020 2020 6469 6d5f 6f72 6465          dim_orde
-00038d10: 7220 3d20 6c69 7374 2873 656c 662e 6469  r = list(self.di
-00038d20: 6d73 290a 2020 2020 2020 2020 656c 6966  ms).        elif
-00038d30: 2073 6574 2864 696d 5f6f 7264 6572 2920   set(dim_order) 
-00038d40: 213d 2073 6574 2873 656c 662e 6469 6d73  != set(self.dims
-00038d50: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00038d60: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00038d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038d80: 2022 6469 6d5f 6f72 6465 7220 7b7d 2064   "dim_order {} d
-00038d90: 6f65 7320 6e6f 7420 6d61 7463 6820 7468  oes not match th
-00038da0: 6520 7365 7420 6f66 2064 696d 656e 7369  e set of dimensi
-00038db0: 6f6e 7320 6f66 2074 6869 7320 220a 2020  ons of this ".  
-00038dc0: 2020 2020 2020 2020 2020 2020 2020 2244                "D
-00038dd0: 6174 6173 6574 3a20 7b7d 222e 666f 726d  ataset: {}".form
-00038de0: 6174 2864 696d 5f6f 7264 6572 2c20 6c69  at(dim_order, li
-00038df0: 7374 2873 656c 662e 6469 6d73 2929 0a20  st(self.dims)). 
-00038e00: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00038e10: 2020 2020 2020 6f72 6465 7265 645f 6469        ordered_di
-00038e20: 6d73 203d 207b 6b3a 2073 656c 662e 6469  ms = {k: self.di
-00038e30: 6d73 5b6b 5d20 666f 7220 6b20 696e 2064  ms[k] for k in d
-00038e40: 696d 5f6f 7264 6572 7d0a 0a20 2020 2020  im_order}..     
-00038e50: 2020 2072 6574 7572 6e20 6f72 6465 7265     return ordere
-00038e60: 645f 6469 6d73 0a0a 2020 2020 6465 6620  d_dims..    def 
-00038e70: 746f 5f70 616e 6461 7328 7365 6c66 2920  to_pandas(self) 
-00038e80: 2d3e 2070 642e 5365 7269 6573 207c 2070  -> pd.Series | p
-00038e90: 642e 4461 7461 4672 616d 653a 0a20 2020  d.DataFrame:.   
-00038ea0: 2020 2020 2022 2222 436f 6e76 6572 7420       """Convert 
-00038eb0: 7468 6973 2064 6174 6173 6574 2069 6e74  this dataset int
-00038ec0: 6f20 6120 7061 6e64 6173 206f 626a 6563  o a pandas objec
-00038ed0: 7420 7769 7468 6f75 7420 6368 616e 6769  t without changi
-00038ee0: 6e67 2074 6865 206e 756d 6265 7220 6f66  ng the number of
-00038ef0: 2064 696d 656e 7369 6f6e 732e 0a0a 2020   dimensions...  
-00038f00: 2020 2020 2020 5468 6520 7479 7065 206f        The type o
-00038f10: 6620 7468 6520 7265 7475 726e 6564 206f  f the returned o
-00038f20: 626a 6563 7420 6465 7065 6e64 7320 6f6e  bject depends on
-00038f30: 2074 6865 206e 756d 6265 7220 6f66 2044   the number of D
-00038f40: 6174 6173 6574 0a20 2020 2020 2020 2064  ataset.        d
-00038f50: 696d 656e 7369 6f6e 733a 0a0a 2020 2020  imensions:..    
-00038f60: 2020 2020 2a20 3044 202d 3e20 6070 616e      * 0D -> `pan
-00038f70: 6461 732e 5365 7269 6573 600a 2020 2020  das.Series`.    
-00038f80: 2020 2020 2a20 3144 202d 3e20 6070 616e      * 1D -> `pan
-00038f90: 6461 732e 4461 7461 4672 616d 6560 0a0a  das.DataFrame`..
-00038fa0: 2020 2020 2020 2020 4f6e 6c79 2077 6f72          Only wor
-00038fb0: 6b73 2066 6f72 2044 6174 6173 6574 7320  ks for Datasets 
-00038fc0: 7769 7468 2031 206f 7220 6665 7765 7220  with 1 or fewer 
-00038fd0: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
-00038fe0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00038ff0: 6966 206c 656e 2873 656c 662e 6469 6d73  if len(self.dims
-00039000: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00039010: 2020 2020 7265 7475 726e 2070 642e 5365      return pd.Se
-00039020: 7269 6573 287b 6b3a 2076 2e69 7465 6d28  ries({k: v.item(
-00039030: 2920 666f 7220 6b2c 2076 2069 6e20 7365  ) for k, v in se
-00039040: 6c66 2e69 7465 6d73 2829 7d29 0a20 2020  lf.items()}).   
-00039050: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-00039060: 2e64 696d 7329 203d 3d20 313a 0a20 2020  .dims) == 1:.   
-00039070: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00039080: 7365 6c66 2e74 6f5f 6461 7461 6672 616d  self.to_datafram
-00039090: 6528 290a 2020 2020 2020 2020 7261 6973  e().        rais
-000390a0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-000390b0: 2020 2020 2020 2020 2020 2263 616e 6e6f            "canno
-000390c0: 7420 636f 6e76 6572 7420 4461 7461 7365  t convert Datase
-000390d0: 7473 2077 6974 6820 2573 2064 696d 656e  ts with %s dimen
-000390e0: 7369 6f6e 7320 696e 746f 2022 0a20 2020  sions into ".   
-000390f0: 2020 2020 2020 2020 2022 7061 6e64 6173           "pandas
-00039100: 206f 626a 6563 7473 2077 6974 686f 7574   objects without
-00039110: 2063 6861 6e67 696e 6720 7468 6520 6e75   changing the nu
-00039120: 6d62 6572 206f 6620 6469 6d65 6e73 696f  mber of dimensio
-00039130: 6e73 2e20 220a 2020 2020 2020 2020 2020  ns. ".          
-00039140: 2020 2250 6c65 6173 6520 7573 6520 4461    "Please use Da
-00039150: 7461 7365 742e 746f 5f64 6174 6166 7261  taset.to_datafra
-00039160: 6d65 2829 2069 6e73 7465 6164 2e22 2025  me() instead." %
-00039170: 206c 656e 2873 656c 662e 6469 6d73 290a   len(self.dims).
-00039180: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00039190: 6566 205f 746f 5f64 6174 6166 7261 6d65  ef _to_dataframe
-000391a0: 2873 656c 662c 206f 7264 6572 6564 5f64  (self, ordered_d
-000391b0: 696d 733a 204d 6170 7069 6e67 5b41 6e79  ims: Mapping[Any
-000391c0: 2c20 696e 745d 293a 0a20 2020 2020 2020  , int]):.       
-000391d0: 2063 6f6c 756d 6e73 203d 205b 6b20 666f   columns = [k fo
-000391e0: 7220 6b20 696e 2073 656c 662e 7661 7269  r k in self.vari
-000391f0: 6162 6c65 7320 6966 206b 206e 6f74 2069  ables if k not i
-00039200: 6e20 7365 6c66 2e64 696d 735d 0a20 2020  n self.dims].   
-00039210: 2020 2020 2064 6174 6120 3d20 5b0a 2020       data = [.  
-00039220: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00039230: 7661 7269 6162 6c65 735b 6b5d 2e73 6574  variables[k].set
-00039240: 5f64 696d 7328 6f72 6465 7265 645f 6469  _dims(ordered_di
-00039250: 6d73 292e 7661 6c75 6573 2e72 6573 6861  ms).values.resha
-00039260: 7065 282d 3129 0a20 2020 2020 2020 2020  pe(-1).         
-00039270: 2020 2066 6f72 206b 2069 6e20 636f 6c75     for k in colu
-00039280: 6d6e 730a 2020 2020 2020 2020 5d0a 2020  mns.        ].  
-00039290: 2020 2020 2020 696e 6465 7820 3d20 7365        index = se
-000392a0: 6c66 2e63 6f6f 7264 732e 746f 5f69 6e64  lf.coords.to_ind
-000392b0: 6578 285b 2a6f 7264 6572 6564 5f64 696d  ex([*ordered_dim
-000392c0: 735d 290a 2020 2020 2020 2020 7265 7475  s]).        retu
-000392d0: 726e 2070 642e 4461 7461 4672 616d 6528  rn pd.DataFrame(
-000392e0: 6469 6374 287a 6970 2863 6f6c 756d 6e73  dict(zip(columns
-000392f0: 2c20 6461 7461 2929 2c20 696e 6465 783d  , data)), index=
-00039300: 696e 6465 7829 0a0a 2020 2020 6465 6620  index)..    def 
-00039310: 746f 5f64 6174 6166 7261 6d65 2873 656c  to_dataframe(sel
-00039320: 662c 2064 696d 5f6f 7264 6572 3a20 5365  f, dim_order: Se
-00039330: 7175 656e 6365 5b48 6173 6861 626c 655d  quence[Hashable]
-00039340: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2920   | None = None) 
-00039350: 2d3e 2070 642e 4461 7461 4672 616d 653a  -> pd.DataFrame:
-00039360: 0a20 2020 2020 2020 2022 2222 436f 6e76  .        """Conv
-00039370: 6572 7420 7468 6973 2064 6174 6173 6574  ert this dataset
-00039380: 2069 6e74 6f20 6120 7061 6e64 6173 2e44   into a pandas.D
-00039390: 6174 6146 7261 6d65 2e0a 0a20 2020 2020  ataFrame...     
-000393a0: 2020 204e 6f6e 2d69 6e64 6578 2076 6172     Non-index var
-000393b0: 6961 626c 6573 2069 6e20 7468 6973 2064  iables in this d
-000393c0: 6174 6173 6574 2066 6f72 6d20 7468 6520  ataset form the 
-000393d0: 636f 6c75 6d6e 7320 6f66 2074 6865 0a20  columns of the. 
-000393e0: 2020 2020 2020 2044 6174 6146 7261 6d65         DataFrame
-000393f0: 2e20 5468 6520 4461 7461 4672 616d 6520  . The DataFrame 
-00039400: 6973 2069 6e64 6578 6564 2062 7920 7468  is indexed by th
-00039410: 6520 4361 7274 6573 6961 6e20 7072 6f64  e Cartesian prod
-00039420: 7563 7420 6f66 0a20 2020 2020 2020 2074  uct of.        t
-00039430: 6869 7320 6461 7461 7365 7427 7320 696e  his dataset's in
-00039440: 6469 6365 732e 0a0a 2020 2020 2020 2020  dices...        
-00039450: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00039460: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00039470: 2020 2020 2020 6469 6d5f 6f72 6465 723a        dim_order:
-00039480: 2053 6571 7565 6e63 6520 6f66 2048 6173   Sequence of Has
-00039490: 6861 626c 6520 6f72 204e 6f6e 652c 206f  hable or None, o
-000394a0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-000394b0: 2020 2020 4869 6572 6172 6368 6963 616c      Hierarchical
-000394c0: 2064 696d 656e 7369 6f6e 206f 7264 6572   dimension order
-000394d0: 2066 6f72 2074 6865 2072 6573 756c 7469   for the resulti
-000394e0: 6e67 2064 6174 6166 7261 6d65 2e20 416c  ng dataframe. Al
-000394f0: 6c0a 2020 2020 2020 2020 2020 2020 6172  l.            ar
-00039500: 7261 7973 2061 7265 2074 7261 6e73 706f  rays are transpo
-00039510: 7365 6420 746f 2074 6869 7320 6f72 6465  sed to this orde
-00039520: 7220 616e 6420 7468 656e 2077 7269 7474  r and then writt
-00039530: 656e 206f 7574 2061 7320 666c 6174 0a20  en out as flat. 
-00039540: 2020 2020 2020 2020 2020 2076 6563 746f             vecto
-00039550: 7273 2069 6e20 636f 6e74 6967 756f 7573  rs in contiguous
-00039560: 206f 7264 6572 2c20 736f 2074 6865 206c   order, so the l
-00039570: 6173 7420 6469 6d65 6e73 696f 6e20 696e  ast dimension in
-00039580: 2074 6869 7320 6c69 7374 0a20 2020 2020   this list.     
-00039590: 2020 2020 2020 2077 696c 6c20 6265 2063         will be c
-000395a0: 6f6e 7469 6775 6f75 7320 696e 2074 6865  ontiguous in the
-000395b0: 2072 6573 756c 7469 6e67 2044 6174 6146   resulting DataF
-000395c0: 7261 6d65 2e20 5468 6973 2068 6173 2061  rame. This has a
-000395d0: 206d 616a 6f72 0a20 2020 2020 2020 2020   major.         
-000395e0: 2020 2069 6e66 6c75 656e 6365 206f 6e20     influence on 
-000395f0: 7768 6963 6820 6f70 6572 6174 696f 6e73  which operations
-00039600: 2061 7265 2065 6666 6963 6965 6e74 206f   are efficient o
-00039610: 6e20 7468 6520 7265 7375 6c74 696e 670a  n the resulting.
-00039620: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00039630: 6672 616d 652e 0a0a 2020 2020 2020 2020  frame...        
-00039640: 2020 2020 4966 2070 726f 7669 6465 642c      If provided,
-00039650: 206d 7573 7420 696e 636c 7564 6520 616c   must include al
-00039660: 6c20 6469 6d65 6e73 696f 6e73 206f 6620  l dimensions of 
-00039670: 7468 6973 2064 6174 6173 6574 2e20 4279  this dataset. By
-00039680: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00039690: 6175 6c74 2c20 6469 6d65 6e73 696f 6e73  ault, dimensions
-000396a0: 2061 7265 2073 6f72 7465 6420 616c 7068   are sorted alph
-000396b0: 6162 6574 6963 616c 6c79 2e0a 0a20 2020  abetically...   
-000396c0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-000396d0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-000396e0: 2020 2020 2072 6573 756c 7420 3a20 4461       result : Da
-000396f0: 7461 4672 616d 650a 2020 2020 2020 2020  taFrame.        
-00039700: 2020 2020 4461 7461 7365 7420 6173 2061      Dataset as a
-00039710: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-00039720: 652e 0a0a 2020 2020 2020 2020 2222 220a  e...        """.
-00039730: 0a20 2020 2020 2020 206f 7264 6572 6564  .        ordered
-00039740: 5f64 696d 7320 3d20 7365 6c66 2e5f 6e6f  _dims = self._no
-00039750: 726d 616c 697a 655f 6469 6d5f 6f72 6465  rmalize_dim_orde
-00039760: 7228 6469 6d5f 6f72 6465 723d 6469 6d5f  r(dim_order=dim_
-00039770: 6f72 6465 7229 0a0a 2020 2020 2020 2020  order)..        
-00039780: 7265 7475 726e 2073 656c 662e 5f74 6f5f  return self._to_
-00039790: 6461 7461 6672 616d 6528 6f72 6465 7265  dataframe(ordere
-000397a0: 645f 6469 6d73 3d6f 7264 6572 6564 5f64  d_dims=ordered_d
-000397b0: 696d 7329 0a0a 2020 2020 6465 6620 5f73  ims)..    def _s
-000397c0: 6574 5f73 7061 7273 655f 6461 7461 5f66  et_sparse_data_f
-000397d0: 726f 6d5f 6461 7461 6672 616d 6528 0a20  rom_dataframe(. 
-000397e0: 2020 2020 2020 2073 656c 662c 2069 6478         self, idx
-000397f0: 3a20 7064 2e49 6e64 6578 2c20 6172 7261  : pd.Index, arra
-00039800: 7973 3a20 6c69 7374 5b74 7570 6c65 5b48  ys: list[tuple[H
-00039810: 6173 6861 626c 652c 206e 702e 6e64 6172  ashable, np.ndar
-00039820: 7261 795d 5d2c 2064 696d 733a 2074 7570  ray]], dims: tup
-00039830: 6c65 0a20 2020 2029 202d 3e20 4e6f 6e65  le.    ) -> None
-00039840: 3a0a 2020 2020 2020 2020 6672 6f6d 2073  :.        from s
-00039850: 7061 7273 6520 696d 706f 7274 2043 4f4f  parse import COO
-00039860: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00039870: 6e73 7461 6e63 6528 6964 782c 2070 642e  nstance(idx, pd.
-00039880: 4d75 6c74 6949 6e64 6578 293a 0a20 2020  MultiIndex):.   
-00039890: 2020 2020 2020 2020 2063 6f6f 7264 7320           coords 
-000398a0: 3d20 6e70 2e73 7461 636b 285b 6e70 2e61  = np.stack([np.a
-000398b0: 7361 7272 6179 2863 6f64 6529 2066 6f72  sarray(code) for
-000398c0: 2063 6f64 6520 696e 2069 6478 2e63 6f64   code in idx.cod
-000398d0: 6573 5d2c 2061 7869 733d 3029 0a20 2020  es], axis=0).   
-000398e0: 2020 2020 2020 2020 2069 735f 736f 7274           is_sort
-000398f0: 6564 203d 2069 6478 2e69 735f 6d6f 6e6f  ed = idx.is_mono
-00039900: 746f 6e69 635f 696e 6372 6561 7369 6e67  tonic_increasing
-00039910: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
-00039920: 7065 203d 2074 7570 6c65 286c 6576 2e73  pe = tuple(lev.s
-00039930: 697a 6520 666f 7220 6c65 7620 696e 2069  ize for lev in i
-00039940: 6478 2e6c 6576 656c 7329 0a20 2020 2020  dx.levels).     
-00039950: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00039960: 2020 2020 2063 6f6f 7264 7320 3d20 6e70       coords = np
-00039970: 2e61 7261 6e67 6528 6964 782e 7369 7a65  .arange(idx.size
-00039980: 292e 7265 7368 6170 6528 312c 202d 3129  ).reshape(1, -1)
-00039990: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
-000399a0: 736f 7274 6564 203d 2054 7275 650a 2020  sorted = True.  
-000399b0: 2020 2020 2020 2020 2020 7368 6170 6520            shape 
-000399c0: 3d20 2869 6478 2e73 697a 652c 290a 0a20  = (idx.size,).. 
-000399d0: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
-000399e0: 2076 616c 7565 7320 696e 2061 7272 6179   values in array
-000399f0: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-00039a00: 2049 6e20 7669 7274 7561 6c6c 7920 616c   In virtually al
-00039a10: 6c20 7265 616c 2075 7365 2063 6173 6573  l real use cases
-00039a20: 2c20 7468 6520 7370 6172 7365 2061 7272  , the sparse arr
-00039a30: 6179 2077 696c 6c20 6e6f 7720 6861 7665  ay will now have
-00039a40: 0a20 2020 2020 2020 2020 2020 2023 206d  .            # m
-00039a50: 6973 7369 6e67 2076 616c 7565 7320 616e  issing values an
-00039a60: 6420 6e65 6564 7320 6120 6669 6c6c 5f76  d needs a fill_v
-00039a70: 616c 7565 2e20 466f 7220 636f 6e73 6973  alue. For consis
-00039a80: 7465 6e63 792c 2064 6f6e 2774 0a20 2020  tency, don't.   
-00039a90: 2020 2020 2020 2020 2023 2073 7065 6369           # speci
-00039aa0: 616c 2063 6173 6520 7468 6520 7261 7265  al case the rare
-00039ab0: 2065 7863 6570 7469 6f6e 7320 2865 2e67   exceptions (e.g
-00039ac0: 2e2c 2064 7479 7065 3d69 6e74 2077 6974  ., dtype=int wit
-00039ad0: 686f 7574 2061 0a20 2020 2020 2020 2020  hout a.         
-00039ae0: 2020 2023 204d 756c 7469 496e 6465 7829     # MultiIndex)
-00039af0: 2e0a 2020 2020 2020 2020 2020 2020 6474  ..            dt
-00039b00: 7970 652c 2066 696c 6c5f 7661 6c75 6520  ype, fill_value 
-00039b10: 3d20 7872 6474 7970 6573 2e6d 6179 6265  = xrdtypes.maybe
-00039b20: 5f70 726f 6d6f 7465 2876 616c 7565 732e  _promote(values.
-00039b30: 6474 7970 6529 0a20 2020 2020 2020 2020  dtype).         
-00039b40: 2020 2076 616c 7565 7320 3d20 6e70 2e61     values = np.a
-00039b50: 7361 7272 6179 2876 616c 7565 732c 2064  sarray(values, d
-00039b60: 7479 7065 3d64 7479 7065 290a 0a20 2020  type=dtype)..   
-00039b70: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
-00039b80: 434f 4f28 0a20 2020 2020 2020 2020 2020  COO(.           
-00039b90: 2020 2020 2063 6f6f 7264 732c 0a20 2020       coords,.   
-00039ba0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00039bb0: 7565 732c 0a20 2020 2020 2020 2020 2020  ues,.           
-00039bc0: 2020 2020 2073 6861 7065 2c0a 2020 2020       shape,.    
-00039bd0: 2020 2020 2020 2020 2020 2020 6861 735f              has_
-00039be0: 6475 706c 6963 6174 6573 3d46 616c 7365  duplicates=False
-00039bf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00039c00: 2020 736f 7274 6564 3d69 735f 736f 7274    sorted=is_sort
-00039c10: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-00039c20: 2020 2020 6669 6c6c 5f76 616c 7565 3d66      fill_value=f
-00039c30: 696c 6c5f 7661 6c75 652c 0a20 2020 2020  ill_value,.     
-00039c40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00039c50: 2020 2020 2073 656c 665b 6e61 6d65 5d20       self[name] 
-00039c60: 3d20 2864 696d 732c 2064 6174 6129 0a0a  = (dims, data)..
-00039c70: 2020 2020 6465 6620 5f73 6574 5f6e 756d      def _set_num
-00039c80: 7079 5f64 6174 615f 6672 6f6d 5f64 6174  py_data_from_dat
-00039c90: 6166 7261 6d65 280a 2020 2020 2020 2020  aframe(.        
-00039ca0: 7365 6c66 2c20 6964 783a 2070 642e 496e  self, idx: pd.In
-00039cb0: 6465 782c 2061 7272 6179 733a 206c 6973  dex, arrays: lis
-00039cc0: 745b 7475 706c 655b 4861 7368 6162 6c65  t[tuple[Hashable
-00039cd0: 2c20 6e70 2e6e 6461 7272 6179 5d5d 2c20  , np.ndarray]], 
-00039ce0: 6469 6d73 3a20 7475 706c 650a 2020 2020  dims: tuple.    
-00039cf0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00039d00: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00039d10: 616e 6365 2869 6478 2c20 7064 2e4d 756c  ance(idx, pd.Mul
-00039d20: 7469 496e 6465 7829 3a0a 2020 2020 2020  tiIndex):.      
-00039d30: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
-00039d40: 7661 6c75 6573 2069 6e20 6172 7261 7973  values in arrays
-00039d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00039d60: 2020 7365 6c66 5b6e 616d 655d 203d 2028    self[name] = (
-00039d70: 6469 6d73 2c20 7661 6c75 6573 290a 2020  dims, values).  
-00039d80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00039d90: 0a0a 2020 2020 2020 2020 2320 4e42 3a20  ..        # NB: 
-00039da0: 7369 6d69 6c61 722c 206d 6f72 6520 6765  similar, more ge
-00039db0: 6e65 7261 6c20 6c6f 6769 632c 206e 6f77  neral logic, now
-00039dc0: 2065 7869 7374 7320 696e 0a20 2020 2020   exists in.     
-00039dd0: 2020 2023 2076 6172 6961 626c 652e 756e     # variable.un
-00039de0: 7374 6163 6b5f 6f6e 6365 3b20 7765 2063  stack_once; we c
-00039df0: 6f75 6c64 2063 6f6e 7369 6465 7220 636f  ould consider co
-00039e00: 6d62 696e 696e 6720 7468 656d 2061 7420  mbining them at 
-00039e10: 736f 6d65 0a20 2020 2020 2020 2023 2070  some.        # p
-00039e20: 6f69 6e74 2e0a 0a20 2020 2020 2020 2073  oint...        s
-00039e30: 6861 7065 203d 2074 7570 6c65 286c 6576  hape = tuple(lev
-00039e40: 2e73 697a 6520 666f 7220 6c65 7620 696e  .size for lev in
-00039e50: 2069 6478 2e6c 6576 656c 7329 0a20 2020   idx.levels).   
-00039e60: 2020 2020 2069 6e64 6578 6572 203d 2074       indexer = t
-00039e70: 7570 6c65 2869 6478 2e63 6f64 6573 290a  uple(idx.codes).
-00039e80: 0a20 2020 2020 2020 2023 2057 6520 616c  .        # We al
-00039e90: 7265 6164 7920 7665 7269 6669 6564 2074  ready verified t
-00039ea0: 6861 7420 7468 6520 4d75 6c74 6949 6e64  hat the MultiInd
-00039eb0: 6578 2068 6173 2061 6c6c 2075 6e69 7175  ex has all uniqu
-00039ec0: 6520 7661 6c75 6573 2c20 736f 0a20 2020  e values, so.   
-00039ed0: 2020 2020 2023 2074 6865 7265 2061 7265       # there are
-00039ee0: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
-00039ef0: 6966 2061 6e64 206f 6e6c 7920 6966 2074  if and only if t
-00039f00: 6865 2073 697a 6520 6f66 206f 7574 7075  he size of outpu
-00039f10: 7420 6172 7261 7973 2069 730a 2020 2020  t arrays is.    
-00039f20: 2020 2020 2320 6c61 7267 6572 2074 6861      # larger tha
-00039f30: 7420 7468 6520 696e 6465 782e 0a20 2020  t the index..   
-00039f40: 2020 2020 206d 6973 7369 6e67 5f76 616c       missing_val
-00039f50: 7565 7320 3d20 6d61 7468 2e70 726f 6428  ues = math.prod(
-00039f60: 7368 6170 6529 203e 2069 6478 2e73 6861  shape) > idx.sha
-00039f70: 7065 5b30 5d0a 0a20 2020 2020 2020 2066  pe[0]..        f
-00039f80: 6f72 206e 616d 652c 2076 616c 7565 7320  or name, values 
-00039f90: 696e 2061 7272 6179 733a 0a20 2020 2020  in arrays:.     
-00039fa0: 2020 2020 2020 2023 204e 756d 5079 2069         # NumPy i
-00039fb0: 6e64 6578 696e 6720 6973 206d 7563 6820  ndexing is much 
-00039fc0: 6661 7374 6572 2074 6861 6e20 7573 696e  faster than usin
-00039fd0: 6720 4461 7461 4672 616d 652e 7265 696e  g DataFrame.rein
-00039fe0: 6465 7828 2920 746f 0a20 2020 2020 2020  dex() to.       
-00039ff0: 2020 2020 2023 2066 696c 6c20 696e 206d       # fill in m
-0003a000: 6973 7369 6e67 2076 616c 7565 733a 0a20  issing values:. 
-0003a010: 2020 2020 2020 2020 2020 2023 2068 7474             # htt
-0003a020: 7073 3a2f 2f73 7461 636b 6f76 6572 666c  ps://stackoverfl
-0003a030: 6f77 2e63 6f6d 2f61 2f33 3530 3439 3839  ow.com/a/3504989
-0003a040: 392f 3830 3937 3035 0a20 2020 2020 2020  9/809705.       
-0003a050: 2020 2020 2069 6620 6d69 7373 696e 675f       if missing_
-0003a060: 7661 6c75 6573 3a0a 2020 2020 2020 2020  values:.        
-0003a070: 2020 2020 2020 2020 6474 7970 652c 2066          dtype, f
-0003a080: 696c 6c5f 7661 6c75 6520 3d20 7872 6474  ill_value = xrdt
-0003a090: 7970 6573 2e6d 6179 6265 5f70 726f 6d6f  ypes.maybe_promo
-0003a0a0: 7465 2876 616c 7565 732e 6474 7970 6529  te(values.dtype)
-0003a0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a0c0: 2064 6174 6120 3d20 6e70 2e66 756c 6c28   data = np.full(
-0003a0d0: 7368 6170 652c 2066 696c 6c5f 7661 6c75  shape, fill_valu
-0003a0e0: 652c 2064 7479 7065 290a 2020 2020 2020  e, dtype).      
-0003a0f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0003a100: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-0003a110: 2074 6865 7265 2061 7265 206e 6f20 6d69   there are no mi
-0003a120: 7373 696e 6720 7661 6c75 6573 2c20 6b65  ssing values, ke
-0003a130: 6570 2074 6865 2065 7869 7374 696e 6720  ep the existing 
-0003a140: 6474 7970 650a 2020 2020 2020 2020 2020  dtype.          
-0003a150: 2020 2020 2020 2320 696e 7374 6561 6420        # instead 
-0003a160: 6f66 2070 726f 6d6f 7469 6e67 2074 6f20  of promoting to 
-0003a170: 7375 7070 6f72 7420 4e41 2c20 652e 672e  support NA, e.g.
-0003a180: 2c20 6b65 6570 2069 6e74 6567 6572 0a20  , keep integer. 
-0003a190: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0003a1a0: 2063 6f6c 756d 6e73 2061 7320 696e 7465   columns as inte
-0003a1b0: 6765 7273 2e0a 2020 2020 2020 2020 2020  gers..          
-0003a1c0: 2020 2020 2020 2320 544f 444f 3a20 636f        # TODO: co
-0003a1d0: 6e73 6964 6572 2072 656d 6f76 696e 6720  nsider removing 
-0003a1e0: 7468 6973 2073 7065 6369 616c 2063 6173  this special cas
-0003a1f0: 652c 2077 6869 6368 2064 6f65 736e 2774  e, which doesn't
-0003a200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a210: 2023 2065 7869 7374 2066 6f72 2073 7061   # exist for spa
-0003a220: 7273 653d 5472 7565 2e0a 2020 2020 2020  rse=True..      
-0003a230: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-0003a240: 206e 702e 7a65 726f 7328 7368 6170 652c   np.zeros(shape,
-0003a250: 2076 616c 7565 732e 6474 7970 6529 0a20   values.dtype). 
-0003a260: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-0003a270: 696e 6465 7865 725d 203d 2076 616c 7565  indexer] = value
-0003a280: 730a 2020 2020 2020 2020 2020 2020 7365  s.            se
-0003a290: 6c66 5b6e 616d 655d 203d 2028 6469 6d73  lf[name] = (dims
-0003a2a0: 2c20 6461 7461 290a 0a20 2020 2040 636c  , data)..    @cl
-0003a2b0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-0003a2c0: 6620 6672 6f6d 5f64 6174 6166 7261 6d65  f from_dataframe
-0003a2d0: 280a 2020 2020 2020 2020 636c 733a 2074  (.        cls: t
-0003a2e0: 7970 655b 545f 4461 7461 7365 745d 2c20  ype[T_Dataset], 
-0003a2f0: 6461 7461 6672 616d 653a 2070 642e 4461  dataframe: pd.Da
-0003a300: 7461 4672 616d 652c 2073 7061 7273 653a  taFrame, sparse:
-0003a310: 2062 6f6f 6c20 3d20 4661 6c73 650a 2020   bool = False.  
-0003a320: 2020 2920 2d3e 2054 5f44 6174 6173 6574    ) -> T_Dataset
-0003a330: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
-0003a340: 7665 7274 2061 2070 616e 6461 732e 4461  vert a pandas.Da
-0003a350: 7461 4672 616d 6520 696e 746f 2061 6e20  taFrame into an 
-0003a360: 7861 7272 6179 2e44 6174 6173 6574 0a0a  xarray.Dataset..
-0003a370: 2020 2020 2020 2020 4561 6368 2063 6f6c          Each col
-0003a380: 756d 6e20 7769 6c6c 2062 6520 636f 6e76  umn will be conv
-0003a390: 6572 7465 6420 696e 746f 2061 6e20 696e  erted into an in
-0003a3a0: 6465 7065 6e64 656e 7420 7661 7269 6162  dependent variab
-0003a3b0: 6c65 2069 6e20 7468 650a 2020 2020 2020  le in the.      
-0003a3c0: 2020 4461 7461 7365 742e 2049 6620 7468    Dataset. If th
-0003a3d0: 6520 6461 7461 6672 616d 6527 7320 696e  e dataframe's in
-0003a3e0: 6465 7820 6973 2061 204d 756c 7469 496e  dex is a MultiIn
-0003a3f0: 6465 782c 2069 7420 7769 6c6c 2062 6520  dex, it will be 
-0003a400: 6578 7061 6e64 6564 0a20 2020 2020 2020  expanded.       
-0003a410: 2069 6e74 6f20 6120 7465 6e73 6f72 2070   into a tensor p
-0003a420: 726f 6475 6374 206f 6620 6f6e 652d 6469  roduct of one-di
-0003a430: 6d65 6e73 696f 6e61 6c20 696e 6469 6365  mensional indice
-0003a440: 7320 2866 696c 6c69 6e67 2069 6e20 6d69  s (filling in mi
-0003a450: 7373 696e 670a 2020 2020 2020 2020 7661  ssing.        va
-0003a460: 6c75 6573 2077 6974 6820 4e61 4e29 2e20  lues with NaN). 
-0003a470: 5468 6973 206d 6574 686f 6420 7769 6c6c  This method will
-0003a480: 2070 726f 6475 6365 2061 2044 6174 6173   produce a Datas
-0003a490: 6574 2076 6572 7920 7369 6d69 6c61 7220  et very similar 
-0003a4a0: 746f 0a20 2020 2020 2020 2074 6861 7420  to.        that 
-0003a4b0: 6f6e 2077 6869 6368 2074 6865 2027 746f  on which the 'to
-0003a4c0: 5f64 6174 6166 7261 6d65 2720 6d65 7468  _dataframe' meth
-0003a4d0: 6f64 2077 6173 2063 616c 6c65 642c 2065  od was called, e
-0003a4e0: 7863 6570 7420 7769 7468 0a20 2020 2020  xcept with.     
-0003a4f0: 2020 2070 6f73 7369 626c 7920 7265 6475     possibly redu
-0003a500: 6e64 616e 7420 6469 6d65 6e73 696f 6e73  ndant dimensions
-0003a510: 2028 7369 6e63 6520 616c 6c20 6461 7461   (since all data
-0003a520: 7365 7420 7661 7269 6162 6c65 7320 7769  set variables wi
-0003a530: 6c6c 2068 6176 650a 2020 2020 2020 2020  ll have.        
-0003a540: 7468 6520 7361 6d65 2064 696d 656e 7369  the same dimensi
-0003a550: 6f6e 616c 6974 7929 0a0a 2020 2020 2020  onality)..      
-0003a560: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0003a570: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-0003a580: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-0003a590: 6520 3a20 4461 7461 4672 616d 650a 2020  e : DataFrame.  
-0003a5a0: 2020 2020 2020 2020 2020 4461 7461 4672            DataFr
-0003a5b0: 616d 6520 6672 6f6d 2077 6869 6368 2074  ame from which t
-0003a5c0: 6f20 636f 7079 2064 6174 6120 616e 6420  o copy data and 
-0003a5d0: 696e 6469 6365 732e 0a20 2020 2020 2020  indices..       
-0003a5e0: 2073 7061 7273 6520 3a20 626f 6f6c 2c20   sparse : bool, 
-0003a5f0: 6465 6661 756c 743a 2046 616c 7365 0a20  default: False. 
-0003a600: 2020 2020 2020 2020 2020 2049 6620 7472             If tr
-0003a610: 7565 2c20 6372 6561 7465 2061 2073 7061  ue, create a spa
-0003a620: 7273 6520 6172 7261 7973 2069 6e73 7465  rse arrays inste
-0003a630: 6164 206f 6620 6465 6e73 6520 6e75 6d70  ad of dense nump
-0003a640: 7920 6172 7261 7973 2e20 5468 6973 0a20  y arrays. This. 
-0003a650: 2020 2020 2020 2020 2020 2063 616e 2070             can p
-0003a660: 6f74 656e 7469 616c 6c79 2073 6176 6520  otentially save 
-0003a670: 6120 6c61 7267 6520 616d 6f75 6e74 206f  a large amount o
-0003a680: 6620 6d65 6d6f 7279 2069 6620 7468 6520  f memory if the 
-0003a690: 4461 7461 4672 616d 6520 6861 730a 2020  DataFrame has.  
-0003a6a0: 2020 2020 2020 2020 2020 6120 4d75 6c74            a Mult
-0003a6b0: 6949 6e64 6578 2e20 5265 7175 6972 6573  iIndex. Requires
-0003a6c0: 2074 6865 2073 7061 7273 6520 7061 636b   the sparse pack
-0003a6d0: 6167 6520 2873 7061 7273 652e 7079 6461  age (sparse.pyda
-0003a6e0: 7461 2e6f 7267 292e 0a0a 2020 2020 2020  ta.org)...      
-0003a6f0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0003a700: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-0003a710: 2020 4e65 7720 4461 7461 7365 742e 0a0a    New Dataset...
-0003a720: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-0003a730: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0003a740: 2d0a 2020 2020 2020 2020 7861 7272 6179  -.        xarray
-0003a750: 2e44 6174 6141 7272 6179 2e66 726f 6d5f  .DataArray.from_
-0003a760: 7365 7269 6573 0a20 2020 2020 2020 2070  series.        p
-0003a770: 616e 6461 732e 4461 7461 4672 616d 652e  andas.DataFrame.
-0003a780: 746f 5f78 6172 7261 790a 2020 2020 2020  to_xarray.      
-0003a790: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-0003a7a0: 544f 444f 3a20 4164 6420 616e 206f 7074  TODO: Add an opt
-0003a7b0: 696f 6e20 746f 2072 656d 6f76 6520 6469  ion to remove di
-0003a7c0: 6d65 6e73 696f 6e73 2061 6c6f 6e67 2077  mensions along w
-0003a7d0: 6869 6368 2074 6865 2076 6172 6961 626c  hich the variabl
-0003a7e0: 6573 0a20 2020 2020 2020 2023 2061 7265  es.        # are
-0003a7f0: 2063 6f6e 7374 616e 742c 2074 6f20 656e   constant, to en
-0003a800: 6162 6c65 2063 6f6e 7369 7374 656e 7420  able consistent 
-0003a810: 7365 7269 616c 697a 6174 696f 6e20 746f  serialization to
-0003a820: 2f66 726f 6d20 6120 6461 7461 6672 616d  /from a datafram
-0003a830: 652c 0a20 2020 2020 2020 2023 2065 7665  e,.        # eve
-0003a840: 6e20 6966 2073 6f6d 6520 7661 7269 6162  n if some variab
-0003a850: 6c65 7320 6861 7665 2064 6966 6665 7265  les have differe
-0003a860: 6e74 2064 696d 656e 7369 6f6e 616c 6974  nt dimensionalit
-0003a870: 792e 0a0a 2020 2020 2020 2020 6966 206e  y...        if n
-0003a880: 6f74 2064 6174 6166 7261 6d65 2e63 6f6c  ot dataframe.col
-0003a890: 756d 6e73 2e69 735f 756e 6971 7565 3a0a  umns.is_unique:.
-0003a8a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0003a8b0: 6520 5661 6c75 6545 7272 6f72 2822 6361  e ValueError("ca
-0003a8c0: 6e6e 6f74 2063 6f6e 7665 7274 2044 6174  nnot convert Dat
-0003a8d0: 6146 7261 6d65 2077 6974 6820 6e6f 6e2d  aFrame with non-
-0003a8e0: 756e 6971 7565 2063 6f6c 756d 6e73 2229  unique columns")
-0003a8f0: 0a0a 2020 2020 2020 2020 6964 7820 3d20  ..        idx = 
-0003a900: 7265 6d6f 7665 5f75 6e75 7365 645f 6c65  remove_unused_le
-0003a910: 7665 6c73 5f63 6174 6567 6f72 6965 7328  vels_categories(
-0003a920: 6461 7461 6672 616d 652e 696e 6465 7829  dataframe.index)
-0003a930: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0003a940: 6e73 7461 6e63 6528 6964 782c 2070 642e  nstance(idx, pd.
-0003a950: 4d75 6c74 6949 6e64 6578 2920 616e 6420  MultiIndex) and 
-0003a960: 6e6f 7420 6964 782e 6973 5f75 6e69 7175  not idx.is_uniqu
-0003a970: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0003a980: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0003a990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a9a0: 2022 6361 6e6e 6f74 2063 6f6e 7665 7274   "cannot convert
-0003a9b0: 2061 2044 6174 6146 7261 6d65 2077 6974   a DataFrame wit
-0003a9c0: 6820 6120 6e6f 6e2d 756e 6971 7565 204d  h a non-unique M
-0003a9d0: 756c 7469 496e 6465 7820 696e 746f 2078  ultiIndex into x
-0003a9e0: 6172 7261 7922 0a20 2020 2020 2020 2020  array".         
-0003a9f0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-0003aa00: 4361 7374 2074 6f20 6120 4e75 6d50 7920  Cast to a NumPy 
-0003aa10: 6172 7261 7920 6669 7273 742c 2069 6e20  array first, in 
-0003aa20: 6361 7365 2074 6865 2053 6572 6965 7320  case the Series 
-0003aa30: 6973 2061 2070 616e 6461 7320 4578 7465  is a pandas Exte
-0003aa40: 6e73 696f 6e0a 2020 2020 2020 2020 2320  nsion.        # 
-0003aa50: 6172 7261 7920 2877 6869 6368 2064 6f65  array (which doe
-0003aa60: 736e 2774 2068 6176 6520 6120 7661 6c69  sn't have a vali
-0003aa70: 6420 4e75 6d50 7920 6474 7970 6529 0a20  d NumPy dtype). 
-0003aa80: 2020 2020 2020 2023 2054 4f44 4f3a 2061         # TODO: a
-0003aa90: 6c6c 6f77 2075 7365 7273 2074 6f20 636f  llow users to co
-0003aaa0: 6e74 726f 6c20 686f 7720 7468 6973 2063  ntrol how this c
-0003aab0: 6173 7469 6e67 2068 6170 7065 6e73 2c20  asting happens, 
-0003aac0: 652e 672e 2c20 6279 0a20 2020 2020 2020  e.g., by.       
-0003aad0: 2023 2066 6f72 7761 7264 696e 6720 6172   # forwarding ar
-0003aae0: 6775 6d65 6e74 7320 746f 2070 616e 6461  guments to panda
-0003aaf0: 732e 5365 7269 6573 2e74 6f5f 6e75 6d70  s.Series.to_nump
-0003ab00: 793f 0a20 2020 2020 2020 2061 7272 6179  y?.        array
-0003ab10: 7320 3d20 5b28 6b2c 206e 702e 6173 6172  s = [(k, np.asar
-0003ab20: 7261 7928 7629 2920 666f 7220 6b2c 2076  ray(v)) for k, v
-0003ab30: 2069 6e20 6461 7461 6672 616d 652e 6974   in dataframe.it
-0003ab40: 656d 7328 295d 0a0a 2020 2020 2020 2020  ems()]..        
-0003ab50: 696e 6465 7865 733a 2064 6963 745b 4861  indexes: dict[Ha
-0003ab60: 7368 6162 6c65 2c20 496e 6465 785d 203d  shable, Index] =
-0003ab70: 207b 7d0a 2020 2020 2020 2020 696e 6465   {}.        inde
-0003ab80: 785f 7661 7273 3a20 6469 6374 5b48 6173  x_vars: dict[Has
-0003ab90: 6861 626c 652c 2056 6172 6961 626c 655d  hable, Variable]
-0003aba0: 203d 207b 7d0a 0a20 2020 2020 2020 2069   = {}..        i
-0003abb0: 6620 6973 696e 7374 616e 6365 2869 6478  f isinstance(idx
-0003abc0: 2c20 7064 2e4d 756c 7469 496e 6465 7829  , pd.MultiIndex)
-0003abd0: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
-0003abe0: 6d73 203d 2074 7570 6c65 280a 2020 2020  ms = tuple(.    
-0003abf0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0003ac00: 2069 6620 6e61 6d65 2069 7320 6e6f 7420   if name is not 
-0003ac10: 4e6f 6e65 2065 6c73 6520 226c 6576 656c  None else "level
-0003ac20: 5f25 6922 2025 206e 0a20 2020 2020 2020  _%i" % n.       
-0003ac30: 2020 2020 2020 2020 2066 6f72 206e 2c20           for n, 
-0003ac40: 6e61 6d65 2069 6e20 656e 756d 6572 6174  name in enumerat
-0003ac50: 6528 6964 782e 6e61 6d65 7329 0a20 2020  e(idx.names).   
-0003ac60: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0003ac70: 2020 2020 2020 2066 6f72 2064 696d 2c20         for dim, 
-0003ac80: 6c65 7620 696e 207a 6970 2864 696d 732c  lev in zip(dims,
-0003ac90: 2069 6478 2e6c 6576 656c 7329 3a0a 2020   idx.levels):.  
-0003aca0: 2020 2020 2020 2020 2020 2020 2020 7872                xr
-0003acb0: 5f69 6478 203d 2050 616e 6461 7349 6e64  _idx = PandasInd
-0003acc0: 6578 286c 6576 2c20 6469 6d29 0a20 2020  ex(lev, dim).   
-0003acd0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-0003ace0: 6578 6573 5b64 696d 5d20 3d20 7872 5f69  exes[dim] = xr_i
-0003acf0: 6478 0a20 2020 2020 2020 2020 2020 2020  dx.             
-0003ad00: 2020 2069 6e64 6578 5f76 6172 732e 7570     index_vars.up
-0003ad10: 6461 7465 2878 725f 6964 782e 6372 6561  date(xr_idx.crea
-0003ad20: 7465 5f76 6172 6961 626c 6573 2829 290a  te_variables()).
-0003ad30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0003ad40: 2020 2020 2020 2020 2020 696e 6465 785f            index_
-0003ad50: 6e61 6d65 203d 2069 6478 2e6e 616d 6520  name = idx.name 
-0003ad60: 6966 2069 6478 2e6e 616d 6520 6973 206e  if idx.name is n
-0003ad70: 6f74 204e 6f6e 6520 656c 7365 2022 696e  ot None else "in
-0003ad80: 6465 7822 0a20 2020 2020 2020 2020 2020  dex".           
-0003ad90: 2064 696d 7320 3d20 2869 6e64 6578 5f6e   dims = (index_n
-0003ada0: 616d 652c 290a 2020 2020 2020 2020 2020  ame,).          
-0003adb0: 2020 7872 5f69 6478 203d 2050 616e 6461    xr_idx = Panda
-0003adc0: 7349 6e64 6578 2869 6478 2c20 696e 6465  sIndex(idx, inde
-0003add0: 785f 6e61 6d65 290a 2020 2020 2020 2020  x_name).        
-0003ade0: 2020 2020 696e 6465 7865 735b 696e 6465      indexes[inde
-0003adf0: 785f 6e61 6d65 5d20 3d20 7872 5f69 6478  x_name] = xr_idx
-0003ae00: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-0003ae10: 6578 5f76 6172 732e 7570 6461 7465 2878  ex_vars.update(x
-0003ae20: 725f 6964 782e 6372 6561 7465 5f76 6172  r_idx.create_var
-0003ae30: 6961 626c 6573 2829 290a 0a20 2020 2020  iables())..     
-0003ae40: 2020 206f 626a 203d 2063 6c73 2e5f 636f     obj = cls._co
-0003ae50: 6e73 7472 7563 745f 6469 7265 6374 2869  nstruct_direct(i
-0003ae60: 6e64 6578 5f76 6172 732c 2073 6574 2869  ndex_vars, set(i
-0003ae70: 6e64 6578 5f76 6172 7329 2c20 696e 6465  ndex_vars), inde
-0003ae80: 7865 733d 696e 6465 7865 7329 0a0a 2020  xes=indexes)..  
-0003ae90: 2020 2020 2020 6966 2073 7061 7273 653a        if sparse:
-0003aea0: 0a20 2020 2020 2020 2020 2020 206f 626a  .            obj
-0003aeb0: 2e5f 7365 745f 7370 6172 7365 5f64 6174  ._set_sparse_dat
-0003aec0: 615f 6672 6f6d 5f64 6174 6166 7261 6d65  a_from_dataframe
-0003aed0: 2869 6478 2c20 6172 7261 7973 2c20 6469  (idx, arrays, di
-0003aee0: 6d73 290a 2020 2020 2020 2020 656c 7365  ms).        else
-0003aef0: 3a0a 2020 2020 2020 2020 2020 2020 6f62  :.            ob
-0003af00: 6a2e 5f73 6574 5f6e 756d 7079 5f64 6174  j._set_numpy_dat
-0003af10: 615f 6672 6f6d 5f64 6174 6166 7261 6d65  a_from_dataframe
-0003af20: 2869 6478 2c20 6172 7261 7973 2c20 6469  (idx, arrays, di
-0003af30: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
-0003af40: 726e 206f 626a 0a0a 2020 2020 6465 6620  rn obj..    def 
-0003af50: 746f 5f64 6173 6b5f 6461 7461 6672 616d  to_dask_datafram
-0003af60: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0003af70: 2064 696d 5f6f 7264 6572 3a20 5365 7175   dim_order: Sequ
-0003af80: 656e 6365 5b48 6173 6861 626c 655d 207c  ence[Hashable] |
-0003af90: 204e 6f6e 6520 3d20 4e6f 6e65 2c20 7365   None = None, se
-0003afa0: 745f 696e 6465 783a 2062 6f6f 6c20 3d20  t_index: bool = 
-0003afb0: 4661 6c73 650a 2020 2020 2920 2d3e 2044  False.    ) -> D
-0003afc0: 6173 6b44 6174 6146 7261 6d65 3a0a 2020  askDataFrame:.  
-0003afd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0003afe0: 2020 436f 6e76 6572 7420 7468 6973 2064    Convert this d
-0003aff0: 6174 6173 6574 2069 6e74 6f20 6120 6461  ataset into a da
-0003b000: 736b 2e64 6174 6166 7261 6d65 2e44 6174  sk.dataframe.Dat
-0003b010: 6146 7261 6d65 2e0a 0a20 2020 2020 2020  aFrame...       
-0003b020: 2054 6865 2064 696d 656e 7369 6f6e 732c   The dimensions,
-0003b030: 2063 6f6f 7264 696e 6174 6573 2061 6e64   coordinates and
-0003b040: 2064 6174 6120 7661 7269 6162 6c65 7320   data variables 
-0003b050: 696e 2074 6869 7320 6461 7461 7365 7420  in this dataset 
-0003b060: 666f 726d 0a20 2020 2020 2020 2074 6865  form.        the
-0003b070: 2063 6f6c 756d 6e73 206f 6620 7468 6520   columns of the 
-0003b080: 4461 7461 4672 616d 652e 0a0a 2020 2020  DataFrame...    
-0003b090: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0003b0a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0003b0b0: 2d0a 2020 2020 2020 2020 6469 6d5f 6f72  -.        dim_or
-0003b0c0: 6465 7220 3a20 6c69 7374 2c20 6f70 7469  der : list, opti
-0003b0d0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-0003b0e0: 2048 6965 7261 7263 6869 6361 6c20 6469   Hierarchical di
-0003b0f0: 6d65 6e73 696f 6e20 6f72 6465 7220 666f  mension order fo
-0003b100: 7220 7468 6520 7265 7375 6c74 696e 6720  r the resulting 
-0003b110: 6461 7461 6672 616d 652e 2041 6c6c 0a20  dataframe. All. 
-0003b120: 2020 2020 2020 2020 2020 2061 7272 6179             array
-0003b130: 7320 6172 6520 7472 616e 7370 6f73 6564  s are transposed
-0003b140: 2074 6f20 7468 6973 206f 7264 6572 2061   to this order a
-0003b150: 6e64 2074 6865 6e20 7772 6974 7465 6e20  nd then written 
-0003b160: 6f75 7420 6173 2066 6c61 740a 2020 2020  out as flat.    
-0003b170: 2020 2020 2020 2020 7665 6374 6f72 7320          vectors 
-0003b180: 696e 2063 6f6e 7469 6775 6f75 7320 6f72  in contiguous or
-0003b190: 6465 722c 2073 6f20 7468 6520 6c61 7374  der, so the last
-0003b1a0: 2064 696d 656e 7369 6f6e 2069 6e20 7468   dimension in th
-0003b1b0: 6973 206c 6973 740a 2020 2020 2020 2020  is list.        
-0003b1c0: 2020 2020 7769 6c6c 2062 6520 636f 6e74      will be cont
-0003b1d0: 6967 756f 7573 2069 6e20 7468 6520 7265  iguous in the re
-0003b1e0: 7375 6c74 696e 6720 4461 7461 4672 616d  sulting DataFram
-0003b1f0: 652e 2054 6869 7320 6861 7320 6120 6d61  e. This has a ma
-0003b200: 6a6f 720a 2020 2020 2020 2020 2020 2020  jor.            
-0003b210: 696e 666c 7565 6e63 6520 6f6e 2077 6869  influence on whi
-0003b220: 6368 206f 7065 7261 7469 6f6e 7320 6172  ch operations ar
-0003b230: 6520 6566 6669 6369 656e 7420 6f6e 2074  e efficient on t
-0003b240: 6865 2072 6573 756c 7469 6e67 2064 6173  he resulting das
-0003b250: 6b0a 2020 2020 2020 2020 2020 2020 6461  k.            da
-0003b260: 7461 6672 616d 652e 0a0a 2020 2020 2020  taframe...      
-0003b270: 2020 2020 2020 4966 2070 726f 7669 6465        If provide
-0003b280: 642c 206d 7573 7420 696e 636c 7564 6520  d, must include 
-0003b290: 616c 6c20 6469 6d65 6e73 696f 6e73 206f  all dimensions o
-0003b2a0: 6620 7468 6973 2064 6174 6173 6574 2e20  f this dataset. 
-0003b2b0: 4279 0a20 2020 2020 2020 2020 2020 2064  By.            d
-0003b2c0: 6566 6175 6c74 2c20 6469 6d65 6e73 696f  efault, dimensio
-0003b2d0: 6e73 2061 7265 2073 6f72 7465 6420 616c  ns are sorted al
-0003b2e0: 7068 6162 6574 6963 616c 6c79 2e0a 2020  phabetically..  
-0003b2f0: 2020 2020 2020 7365 745f 696e 6465 7820        set_index 
-0003b300: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
-0003b310: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-0003b320: 2020 2049 6620 7365 745f 696e 6465 783d     If set_index=
-0003b330: 5472 7565 2c20 7468 6520 6461 736b 2044  True, the dask D
-0003b340: 6174 6146 7261 6d65 2069 7320 696e 6465  ataFrame is inde
-0003b350: 7865 6420 6279 2074 6869 7320 6461 7461  xed by this data
-0003b360: 7365 7427 730a 2020 2020 2020 2020 2020  set's.          
-0003b370: 2020 636f 6f72 6469 6e61 7465 2e20 5369    coordinate. Si
-0003b380: 6e63 6520 6461 736b 2044 6174 6146 7261  nce dask DataFra
-0003b390: 6d65 7320 646f 206e 6f74 2073 7570 706f  mes do not suppo
-0003b3a0: 7274 206d 756c 7469 2d69 6e64 6578 6573  rt multi-indexes
-0003b3b0: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
-0003b3c0: 745f 696e 6465 7820 6f6e 6c79 2077 6f72  t_index only wor
-0003b3d0: 6b73 2069 6620 7468 6520 6461 7461 7365  ks if the datase
-0003b3e0: 7420 6f6e 6c79 2063 6f6e 7461 696e 7320  t only contains 
-0003b3f0: 6f6e 6520 6469 6d65 6e73 696f 6e2e 0a0a  one dimension...
-0003b400: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0003b410: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-0003b420: 2020 2020 2020 2020 6461 736b 2e64 6174          dask.dat
-0003b430: 6166 7261 6d65 2e44 6174 6146 7261 6d65  aframe.DataFrame
-0003b440: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0003b450: 2020 2020 2020 696d 706f 7274 2064 6173        import das
-0003b460: 6b2e 6172 7261 7920 6173 2064 610a 2020  k.array as da.  
-0003b470: 2020 2020 2020 696d 706f 7274 2064 6173        import das
-0003b480: 6b2e 6461 7461 6672 616d 6520 6173 2064  k.dataframe as d
-0003b490: 640a 0a20 2020 2020 2020 206f 7264 6572  d..        order
-0003b4a0: 6564 5f64 696d 7320 3d20 7365 6c66 2e5f  ed_dims = self._
-0003b4b0: 6e6f 726d 616c 697a 655f 6469 6d5f 6f72  normalize_dim_or
-0003b4c0: 6465 7228 6469 6d5f 6f72 6465 723d 6469  der(dim_order=di
-0003b4d0: 6d5f 6f72 6465 7229 0a0a 2020 2020 2020  m_order)..      
-0003b4e0: 2020 636f 6c75 6d6e 7320 3d20 6c69 7374    columns = list
-0003b4f0: 286f 7264 6572 6564 5f64 696d 7329 0a20  (ordered_dims). 
-0003b500: 2020 2020 2020 2063 6f6c 756d 6e73 2e65         columns.e
-0003b510: 7874 656e 6428 6b20 666f 7220 6b20 696e  xtend(k for k in
-0003b520: 2073 656c 662e 636f 6f72 6473 2069 6620   self.coords if 
-0003b530: 6b20 6e6f 7420 696e 2073 656c 662e 6469  k not in self.di
-0003b540: 6d73 290a 2020 2020 2020 2020 636f 6c75  ms).        colu
-0003b550: 6d6e 732e 6578 7465 6e64 2873 656c 662e  mns.extend(self.
-0003b560: 6461 7461 5f76 6172 7329 0a0a 2020 2020  data_vars)..    
-0003b570: 2020 2020 7365 7269 6573 5f6c 6973 7420      series_list 
-0003b580: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0003b590: 206e 616d 6520 696e 2063 6f6c 756d 6e73   name in columns
-0003b5a0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-0003b5b0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0003b5c0: 2020 2076 6172 203d 2073 656c 662e 7661     var = self.va
-0003b5d0: 7269 6162 6c65 735b 6e61 6d65 5d0a 2020  riables[name].  
-0003b5e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0003b5f0: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
-0003b600: 2020 2020 2020 2020 2020 2023 2064 696d             # dim
-0003b610: 656e 7369 6f6e 2077 6974 686f 7574 2061  ension without a
-0003b620: 206d 6174 6368 696e 6720 636f 6f72 6469   matching coordi
-0003b630: 6e61 7465 0a20 2020 2020 2020 2020 2020  nate.           
-0003b640: 2020 2020 2073 697a 6520 3d20 7365 6c66       size = self
-0003b650: 2e64 696d 735b 6e61 6d65 5d0a 2020 2020  .dims[name].    
-0003b660: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0003b670: 203d 2064 612e 6172 616e 6765 2873 697a   = da.arange(siz
-0003b680: 652c 2063 6875 6e6b 733d 7369 7a65 2c20  e, chunks=size, 
-0003b690: 6474 7970 653d 6e70 2e69 6e74 3634 290a  dtype=np.int64).
-0003b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b6b0: 7661 7220 3d20 5661 7269 6162 6c65 2828  var = Variable((
-0003b6c0: 6e61 6d65 2c29 2c20 6461 7461 290a 0a20  name,), data).. 
-0003b6d0: 2020 2020 2020 2020 2020 2023 2049 6e64             # Ind
-0003b6e0: 6578 5661 7269 6162 6c65 206f 626a 6563  exVariable objec
-0003b6f0: 7473 2068 6176 6520 6120 6475 6d6d 7920  ts have a dummy 
-0003b700: 2e63 6875 6e6b 2829 206d 6574 686f 640a  .chunk() method.
-0003b710: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0003b720: 7369 6e73 7461 6e63 6528 7661 722c 2049  sinstance(var, I
-0003b730: 6e64 6578 5661 7269 6162 6c65 293a 0a20  ndexVariable):. 
-0003b740: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0003b750: 6172 203d 2076 6172 2e74 6f5f 6261 7365  ar = var.to_base
-0003b760: 5f76 6172 6961 626c 6528 290a 0a20 2020  _variable()..   
-0003b770: 2020 2020 2020 2020 2023 204d 616b 6520           # Make 
-0003b780: 7375 7265 2076 6172 2069 7320 6120 6461  sure var is a da
-0003b790: 736b 2061 7272 6179 2c20 6f74 6865 7277  sk array, otherw
-0003b7a0: 6973 6520 7468 6520 6172 7261 7920 6361  ise the array ca
-0003b7b0: 6e20 6265 636f 6d65 2074 6f6f 206c 6172  n become too lar
-0003b7c0: 6765 0a20 2020 2020 2020 2020 2020 2023  ge.            #
-0003b7d0: 2077 6865 6e20 6974 2069 7320 6272 6f61   when it is broa
-0003b7e0: 6463 6173 7465 6420 746f 2073 6576 6572  dcasted to sever
-0003b7f0: 616c 2064 696d 656e 7369 6f6e 733a 0a20  al dimensions:. 
-0003b800: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0003b810: 7420 6973 5f64 7563 6b5f 6461 736b 5f61  t is_duck_dask_a
-0003b820: 7272 6179 2876 6172 2e5f 6461 7461 293a  rray(var._data):
-0003b830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003b840: 2076 6172 203d 2076 6172 2e63 6875 6e6b   var = var.chunk
-0003b850: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-0003b860: 6461 736b 5f61 7272 6179 203d 2076 6172  dask_array = var
-0003b870: 2e73 6574 5f64 696d 7328 6f72 6465 7265  .set_dims(ordere
-0003b880: 645f 6469 6d73 292e 6368 756e 6b28 7365  d_dims).chunk(se
-0003b890: 6c66 2e63 6875 6e6b 7329 2e64 6174 610a  lf.chunks).data.
-0003b8a0: 2020 2020 2020 2020 2020 2020 7365 7269              seri
-0003b8b0: 6573 203d 2064 642e 6672 6f6d 5f61 7272  es = dd.from_arr
-0003b8c0: 6179 2864 6173 6b5f 6172 7261 792e 7265  ay(dask_array.re
-0003b8d0: 7368 6170 6528 2d31 292c 2063 6f6c 756d  shape(-1), colum
-0003b8e0: 6e73 3d5b 6e61 6d65 5d29 0a20 2020 2020  ns=[name]).     
-0003b8f0: 2020 2020 2020 2073 6572 6965 735f 6c69         series_li
-0003b900: 7374 2e61 7070 656e 6428 7365 7269 6573  st.append(series
-0003b910: 290a 0a20 2020 2020 2020 2064 6620 3d20  )..        df = 
-0003b920: 6464 2e63 6f6e 6361 7428 7365 7269 6573  dd.concat(series
-0003b930: 5f6c 6973 742c 2061 7869 733d 3129 0a0a  _list, axis=1)..
-0003b940: 2020 2020 2020 2020 6966 2073 6574 5f69          if set_i
-0003b950: 6e64 6578 3a0a 2020 2020 2020 2020 2020  ndex:.          
-0003b960: 2020 6469 6d5f 6f72 6465 7220 3d20 5b2a    dim_order = [*
-0003b970: 6f72 6465 7265 645f 6469 6d73 5d0a 0a20  ordered_dims].. 
-0003b980: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0003b990: 6e28 6469 6d5f 6f72 6465 7229 203d 3d20  n(dim_order) == 
-0003b9a0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-0003b9b0: 2020 2028 6469 6d2c 2920 3d20 6469 6d5f     (dim,) = dim_
-0003b9c0: 6f72 6465 720a 2020 2020 2020 2020 2020  order.          
-0003b9d0: 2020 2020 2020 6466 203d 2064 662e 7365        df = df.se
-0003b9e0: 745f 696e 6465 7828 6469 6d29 0a20 2020  t_index(dim).   
-0003b9f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0003ba00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0003ba10: 2074 7269 6767 6572 7320 616e 2065 7272   triggers an err
-0003ba20: 6f72 2061 626f 7574 206d 756c 7469 2d69  or about multi-i
-0003ba30: 6e64 6578 6573 2c20 6576 656e 2069 6620  ndexes, even if 
-0003ba40: 6f6e 6c79 206f 6e65 0a20 2020 2020 2020  only one.       
-0003ba50: 2020 2020 2020 2020 2023 2064 696d 656e           # dimen
-0003ba60: 7369 6f6e 2069 7320 7061 7373 6564 0a20  sion is passed. 
-0003ba70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0003ba80: 6620 3d20 6466 2e73 6574 5f69 6e64 6578  f = df.set_index
-0003ba90: 2864 696d 5f6f 7264 6572 290a 0a20 2020  (dim_order)..   
-0003baa0: 2020 2020 2072 6574 7572 6e20 6466 0a0a       return df..
-0003bab0: 2020 2020 6465 6620 746f 5f64 6963 7428      def to_dict(
-0003bac0: 7365 6c66 2c20 6461 7461 3a20 626f 6f6c  self, data: bool
-0003bad0: 203d 2054 7275 652c 2065 6e63 6f64 696e   = True, encodin
-0003bae0: 673a 2062 6f6f 6c20 3d20 4661 6c73 6529  g: bool = False)
-0003baf0: 202d 3e20 6469 6374 5b73 7472 2c20 416e   -> dict[str, An
-0003bb00: 795d 3a0a 2020 2020 2020 2020 2222 220a  y]:.        """.
-0003bb10: 2020 2020 2020 2020 436f 6e76 6572 7420          Convert 
-0003bb20: 7468 6973 2064 6174 6173 6574 2074 6f20  this dataset to 
-0003bb30: 6120 6469 6374 696f 6e61 7279 2066 6f6c  a dictionary fol
-0003bb40: 6c6f 7769 6e67 2078 6172 7261 7920 6e61  lowing xarray na
-0003bb50: 6d69 6e67 0a20 2020 2020 2020 2063 6f6e  ming.        con
-0003bb60: 7665 6e74 696f 6e73 2e0a 0a20 2020 2020  ventions...     
-0003bb70: 2020 2043 6f6e 7665 7274 7320 616c 6c20     Converts all 
-0003bb80: 7661 7269 6162 6c65 7320 616e 6420 6174  variables and at
-0003bb90: 7472 6962 7574 6573 2074 6f20 6e61 7469  tributes to nati
-0003bba0: 7665 2050 7974 686f 6e20 6f62 6a65 6374  ve Python object
-0003bbb0: 730a 2020 2020 2020 2020 5573 6566 756c  s.        Useful
-0003bbc0: 2066 6f72 2063 6f6e 7665 7274 696e 6720   for converting 
-0003bbd0: 746f 206a 736f 6e2e 2054 6f20 6176 6f69  to json. To avoi
-0003bbe0: 6420 6461 7465 7469 6d65 2069 6e63 6f6d  d datetime incom
-0003bbf0: 7061 7469 6269 6c69 7479 0a20 2020 2020  patibility.     
-0003bc00: 2020 2075 7365 2064 6563 6f64 655f 7469     use decode_ti
-0003bc10: 6d65 733d 4661 6c73 6520 6b77 6172 6720  mes=False kwarg 
-0003bc20: 696e 2078 6172 7272 6179 2e6f 7065 6e5f  in xarrray.open_
-0003bc30: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
-0003bc40: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0003bc50: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-0003bc60: 2020 2020 2020 2020 6461 7461 203a 2062          data : b
-0003bc70: 6f6f 6c2c 2064 6566 6175 6c74 3a20 5472  ool, default: Tr
-0003bc80: 7565 0a20 2020 2020 2020 2020 2020 2057  ue.            W
-0003bc90: 6865 7468 6572 2074 6f20 696e 636c 7564  hether to includ
-0003bca0: 6520 7468 6520 6163 7475 616c 2064 6174  e the actual dat
-0003bcb0: 6120 696e 2074 6865 2064 6963 7469 6f6e  a in the diction
-0003bcc0: 6172 792e 2057 6865 6e20 7365 7420 746f  ary. When set to
-0003bcd0: 0a20 2020 2020 2020 2020 2020 2046 616c  .            Fal
-0003bce0: 7365 2c20 7265 7475 726e 7320 6a75 7374  se, returns just
-0003bcf0: 2074 6865 2073 6368 656d 612e 0a20 2020   the schema..   
-0003bd00: 2020 2020 2065 6e63 6f64 696e 6720 3a20       encoding : 
-0003bd10: 626f 6f6c 2c20 6465 6661 756c 743a 2046  bool, default: F
-0003bd20: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0003bd30: 2057 6865 7468 6572 2074 6f20 696e 636c   Whether to incl
-0003bd40: 7564 6520 7468 6520 4461 7461 7365 7427  ude the Dataset'
-0003bd50: 7320 656e 636f 6469 6e67 2069 6e20 7468  s encoding in th
-0003bd60: 6520 6469 6374 696f 6e61 7279 2e0a 0a20  e dictionary... 
-0003bd70: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-0003bd80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-0003bd90: 2020 2020 2020 2064 203a 2064 6963 740a         d : dict.
-0003bda0: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
-0003bdb0: 2077 6974 6820 6b65 7973 3a20 2263 6f6f   with keys: "coo
-0003bdc0: 7264 7322 2c20 2261 7474 7273 222c 2022  rds", "attrs", "
-0003bdd0: 6469 6d73 222c 2022 6461 7461 5f76 6172  dims", "data_var
-0003bde0: 7322 2061 6e64 206f 7074 696f 6e61 6c6c  s" and optionall
-0003bdf0: 790a 2020 2020 2020 2020 2020 2020 2265  y.            "e
-0003be00: 6e63 6f64 696e 6722 2e0a 0a20 2020 2020  ncoding"...     
-0003be10: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-0003be20: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0003be30: 2020 2020 2044 6174 6173 6574 2e66 726f       Dataset.fro
-0003be40: 6d5f 6469 6374 0a20 2020 2020 2020 2044  m_dict.        D
-0003be50: 6174 6141 7272 6179 2e74 6f5f 6469 6374  ataArray.to_dict
-0003be60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0003be70: 2020 2020 2064 3a20 6469 6374 203d 207b       d: dict = {
-0003be80: 0a20 2020 2020 2020 2020 2020 2022 636f  .            "co
-0003be90: 6f72 6473 223a 207b 7d2c 0a20 2020 2020  ords": {},.     
-0003bea0: 2020 2020 2020 2022 6174 7472 7322 3a20         "attrs": 
-0003beb0: 6465 636f 6465 5f6e 756d 7079 5f64 6963  decode_numpy_dic
-0003bec0: 745f 7661 6c75 6573 2873 656c 662e 6174  t_values(self.at
-0003bed0: 7472 7329 2c0a 2020 2020 2020 2020 2020  trs),.          
-0003bee0: 2020 2264 696d 7322 3a20 6469 6374 2873    "dims": dict(s
-0003bef0: 656c 662e 6469 6d73 292c 0a20 2020 2020  elf.dims),.     
-0003bf00: 2020 2020 2020 2022 6461 7461 5f76 6172         "data_var
-0003bf10: 7322 3a20 7b7d 2c0a 2020 2020 2020 2020  s": {},.        
-0003bf20: 7d0a 2020 2020 2020 2020 666f 7220 6b20  }.        for k 
-0003bf30: 696e 2073 656c 662e 636f 6f72 6473 3a0a  in self.coords:.
-0003bf40: 2020 2020 2020 2020 2020 2020 645b 2263              d["c
-0003bf50: 6f6f 7264 7322 5d2e 7570 6461 7465 280a  oords"].update(.
-0003bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bf70: 7b6b 3a20 7365 6c66 5b6b 5d2e 7661 7269  {k: self[k].vari
-0003bf80: 6162 6c65 2e74 6f5f 6469 6374 2864 6174  able.to_dict(dat
-0003bf90: 613d 6461 7461 2c20 656e 636f 6469 6e67  a=data, encoding
-0003bfa0: 3d65 6e63 6f64 696e 6729 7d0a 2020 2020  =encoding)}.    
-0003bfb0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0003bfc0: 2020 666f 7220 6b20 696e 2073 656c 662e    for k in self.
-0003bfd0: 6461 7461 5f76 6172 733a 0a20 2020 2020  data_vars:.     
-0003bfe0: 2020 2020 2020 2064 5b22 6461 7461 5f76         d["data_v
-0003bff0: 6172 7322 5d2e 7570 6461 7465 280a 2020  ars"].update(.  
-0003c000: 2020 2020 2020 2020 2020 2020 2020 7b6b                {k
-0003c010: 3a20 7365 6c66 5b6b 5d2e 7661 7269 6162  : self[k].variab
-0003c020: 6c65 2e74 6f5f 6469 6374 2864 6174 613d  le.to_dict(data=
-0003c030: 6461 7461 2c20 656e 636f 6469 6e67 3d65  data, encoding=e
-0003c040: 6e63 6f64 696e 6729 7d0a 2020 2020 2020  ncoding)}.      
-0003c050: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0003c060: 6966 2065 6e63 6f64 696e 673a 0a20 2020  if encoding:.   
-0003c070: 2020 2020 2020 2020 2064 5b22 656e 636f           d["enco
-0003c080: 6469 6e67 225d 203d 2064 6963 7428 7365  ding"] = dict(se
-0003c090: 6c66 2e65 6e63 6f64 696e 6729 0a20 2020  lf.encoding).   
-0003c0a0: 2020 2020 2072 6574 7572 6e20 640a 0a20       return d.. 
-0003c0b0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0003c0c0: 2020 2020 6465 6620 6672 6f6d 5f64 6963      def from_dic
-0003c0d0: 7428 636c 733a 2074 7970 655b 545f 4461  t(cls: type[T_Da
-0003c0e0: 7461 7365 745d 2c20 643a 204d 6170 7069  taset], d: Mappi
-0003c0f0: 6e67 5b41 6e79 2c20 416e 795d 2920 2d3e  ng[Any, Any]) ->
-0003c100: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-0003c110: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
-0003c120: 2064 6963 7469 6f6e 6172 7920 696e 746f   dictionary into
-0003c130: 2061 6e20 7861 7272 6179 2e44 6174 6173   an xarray.Datas
-0003c140: 6574 2e0a 0a20 2020 2020 2020 2050 6172  et...        Par
-0003c150: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-0003c160: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0003c170: 2020 2064 203a 2064 6963 742d 6c69 6b65     d : dict-like
-0003c180: 0a20 2020 2020 2020 2020 2020 204d 6170  .            Map
-0003c190: 7069 6e67 2077 6974 6820 6120 6d69 6e69  ping with a mini
-0003c1a0: 6d75 6d20 7374 7275 6374 7572 6520 6f66  mum structure of
-0003c1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003c1c0: 2060 607b 2276 6172 5f30 223a 207b 2264   ``{"var_0": {"d
-0003c1d0: 696d 7322 3a20 5b2e 2e5d 2c20 2264 6174  ims": [..], "dat
-0003c1e0: 6122 3a20 5b2e 2e5d 7d2c 205c 0a20 2020  a": [..]}, \.   
-0003c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c200: 2020 2020 2020 2020 202e 2e2e 7d60 600a           ...}``.
-0003c210: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0003c220: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0003c230: 0a20 2020 2020 2020 206f 626a 203a 2044  .        obj : D
-0003c240: 6174 6173 6574 0a0a 2020 2020 2020 2020  ataset..        
-0003c250: 5365 6520 616c 736f 0a20 2020 2020 2020  See also.       
-0003c260: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-0003c270: 2020 4461 7461 7365 742e 746f 5f64 6963    Dataset.to_dic
-0003c280: 740a 2020 2020 2020 2020 4461 7461 4172  t.        DataAr
-0003c290: 7261 792e 6672 6f6d 5f64 6963 740a 0a20  ray.from_dict.. 
-0003c2a0: 2020 2020 2020 2045 7861 6d70 6c65 730a         Examples.
-0003c2b0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0003c2c0: 0a20 2020 2020 2020 203e 3e3e 2064 203d  .        >>> d =
-0003c2d0: 207b 0a20 2020 2020 2020 202e 2e2e 2020   {.        ...  
-0003c2e0: 2020 2022 7422 3a20 7b22 6469 6d73 223a     "t": {"dims":
-0003c2f0: 2028 2274 2229 2c20 2264 6174 6122 3a20   ("t"), "data": 
-0003c300: 5b30 2c20 312c 2032 5d7d 2c0a 2020 2020  [0, 1, 2]},.    
-0003c310: 2020 2020 2e2e 2e20 2020 2020 2261 223a      ...     "a":
-0003c320: 207b 2264 696d 7322 3a20 2822 7422 292c   {"dims": ("t"),
-0003c330: 2022 6461 7461 223a 205b 2261 222c 2022   "data": ["a", "
-0003c340: 6222 2c20 2263 225d 7d2c 0a20 2020 2020  b", "c"]},.     
-0003c350: 2020 202e 2e2e 2020 2020 2022 6222 3a20     ...     "b": 
-0003c360: 7b22 6469 6d73 223a 2028 2274 2229 2c20  {"dims": ("t"), 
-0003c370: 2264 6174 6122 3a20 5b31 302c 2032 302c  "data": [10, 20,
-0003c380: 2033 305d 7d2c 0a20 2020 2020 2020 202e   30]},.        .
-0003c390: 2e2e 207d 0a20 2020 2020 2020 203e 3e3e  .. }.        >>>
-0003c3a0: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
-0003c3b0: 2e66 726f 6d5f 6469 6374 2864 290a 2020  .from_dict(d).  
-0003c3c0: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
-0003c3d0: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-0003c3e0: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
-0003c3f0: 6d65 6e73 696f 6e73 3a20 2028 743a 2033  mensions:  (t: 3
-0003c400: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
-0003c410: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
-0003c420: 202a 2074 2020 2020 2020 2020 2874 2920   * t        (t) 
-0003c430: 696e 7436 3420 3020 3120 320a 2020 2020  int64 0 1 2.    
-0003c440: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-0003c450: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0003c460: 6120 2020 2020 2020 2028 7429 203c 5531  a        (t) <U1
-0003c470: 2027 6127 2027 6227 2027 6327 0a20 2020   'a' 'b' 'c'.   
-0003c480: 2020 2020 2020 2020 2062 2020 2020 2020           b      
-0003c490: 2020 2874 2920 696e 7436 3420 3130 2032    (t) int64 10 2
-0003c4a0: 3020 3330 0a0a 2020 2020 2020 2020 3e3e  0 30..        >>
-0003c4b0: 3e20 6420 3d20 7b0a 2020 2020 2020 2020  > d = {.        
-0003c4c0: 2e2e 2e20 2020 2020 2263 6f6f 7264 7322  ...     "coords"
-0003c4d0: 3a20 7b0a 2020 2020 2020 2020 2e2e 2e20  : {.        ... 
-0003c4e0: 2020 2020 2020 2020 2274 223a 207b 2264          "t": {"d
-0003c4f0: 696d 7322 3a20 2274 222c 2022 6461 7461  ims": "t", "data
-0003c500: 223a 205b 302c 2031 2c20 325d 2c20 2261  ": [0, 1, 2], "a
-0003c510: 7474 7273 223a 207b 2275 6e69 7473 223a  ttrs": {"units":
-0003c520: 2022 7322 7d7d 0a20 2020 2020 2020 202e   "s"}}.        .
-0003c530: 2e2e 2020 2020 207d 2c0a 2020 2020 2020  ..     },.      
-0003c540: 2020 2e2e 2e20 2020 2020 2261 7474 7273    ...     "attrs
-0003c550: 223a 207b 2274 6974 6c65 223a 2022 6169  ": {"title": "ai
-0003c560: 7220 7465 6d70 6572 6174 7572 6522 7d2c  r temperature"},
-0003c570: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0003c580: 2022 6469 6d73 223a 2022 7422 2c0a 2020   "dims": "t",.  
-0003c590: 2020 2020 2020 2e2e 2e20 2020 2020 2264        ...     "d
-0003c5a0: 6174 615f 7661 7273 223a 207b 0a20 2020  ata_vars": {.   
-0003c5b0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
-0003c5c0: 2022 6122 3a20 7b22 6469 6d73 223a 2022   "a": {"dims": "
-0003c5d0: 7422 2c20 2264 6174 6122 3a20 5b31 302c  t", "data": [10,
-0003c5e0: 2032 302c 2033 305d 7d2c 0a20 2020 2020   20, 30]},.     
-0003c5f0: 2020 202e 2e2e 2020 2020 2020 2020 2022     ...         "
-0003c600: 6222 3a20 7b22 6469 6d73 223a 2022 7422  b": {"dims": "t"
-0003c610: 2c20 2264 6174 6122 3a20 5b22 6122 2c20  , "data": ["a", 
-0003c620: 2262 222c 2022 6322 5d7d 2c0a 2020 2020  "b", "c"]},.    
-0003c630: 2020 2020 2e2e 2e20 2020 2020 7d2c 0a20      ...     },. 
-0003c640: 2020 2020 2020 202e 2e2e 207d 0a20 2020         ... }.   
-0003c650: 2020 2020 203e 3e3e 2064 7320 3d20 7872       >>> ds = xr
-0003c660: 2e44 6174 6173 6574 2e66 726f 6d5f 6469  .Dataset.from_di
-0003c670: 6374 2864 290a 2020 2020 2020 2020 3e3e  ct(d).        >>
-0003c680: 3e20 6473 0a20 2020 2020 2020 203c 7861  > ds.        <xa
-0003c690: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-0003c6a0: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-0003c6b0: 3a20 2028 743a 2033 290a 2020 2020 2020  :  (t: 3).      
-0003c6c0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-0003c6d0: 2020 2020 2020 2020 202a 2074 2020 2020           * t    
-0003c6e0: 2020 2020 2874 2920 696e 7436 3420 3020      (t) int64 0 
-0003c6f0: 3120 320a 2020 2020 2020 2020 4461 7461  1 2.        Data
-0003c700: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-0003c710: 2020 2020 2020 2020 6120 2020 2020 2020          a       
-0003c720: 2028 7429 2069 6e74 3634 2031 3020 3230   (t) int64 10 20
-0003c730: 2033 300a 2020 2020 2020 2020 2020 2020   30.            
-0003c740: 6220 2020 2020 2020 2028 7429 203c 5531  b        (t) <U1
-0003c750: 2027 6127 2027 6227 2027 6327 0a20 2020   'a' 'b' 'c'.   
-0003c760: 2020 2020 2041 7474 7269 6275 7465 733a       Attributes:
-0003c770: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
-0003c780: 6c65 3a20 2020 2061 6972 2074 656d 7065  le:    air tempe
-0003c790: 7261 7475 7265 0a0a 2020 2020 2020 2020  rature..        
-0003c7a0: 2222 220a 0a20 2020 2020 2020 2076 6172  """..        var
-0003c7b0: 6961 626c 6573 3a20 4974 6572 6162 6c65  iables: Iterable
-0003c7c0: 5b74 7570 6c65 5b48 6173 6861 626c 652c  [tuple[Hashable,
-0003c7d0: 2041 6e79 5d5d 0a20 2020 2020 2020 2069   Any]].        i
-0003c7e0: 6620 6e6f 7420 7b22 636f 6f72 6473 222c  f not {"coords",
-0003c7f0: 2022 6461 7461 5f76 6172 7322 7d2e 6973   "data_vars"}.is
-0003c800: 7375 6273 6574 2873 6574 2864 2929 3a0a  subset(set(d)):.
-0003c810: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-0003c820: 6162 6c65 7320 3d20 642e 6974 656d 7328  ables = d.items(
-0003c830: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0003c840: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-0003c850: 7274 2069 7465 7274 6f6f 6c73 0a0a 2020  rt itertools..  
-0003c860: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-0003c870: 6c65 7320 3d20 6974 6572 746f 6f6c 732e  les = itertools.
-0003c880: 6368 6169 6e28 0a20 2020 2020 2020 2020  chain(.         
-0003c890: 2020 2020 2020 2064 2e67 6574 2822 636f         d.get("co
-0003c8a0: 6f72 6473 222c 207b 7d29 2e69 7465 6d73  ords", {}).items
-0003c8b0: 2829 2c20 642e 6765 7428 2264 6174 615f  (), d.get("data_
-0003c8c0: 7661 7273 222c 207b 7d29 2e69 7465 6d73  vars", {}).items
-0003c8d0: 2829 0a20 2020 2020 2020 2020 2020 2029  ().            )
-0003c8e0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0003c8f0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-0003c900: 6c65 5f64 6963 7420 3d20 7b0a 2020 2020  le_dict = {.    
-0003c910: 2020 2020 2020 2020 2020 2020 6b3a 2028              k: (
-0003c920: 765b 2264 696d 7322 5d2c 2076 5b22 6461  v["dims"], v["da
-0003c930: 7461 225d 2c20 762e 6765 7428 2261 7474  ta"], v.get("att
-0003c940: 7273 2229 2920 666f 7220 6b2c 2076 2069  rs")) for k, v i
-0003c950: 6e20 7661 7269 6162 6c65 730a 2020 2020  n variables.    
-0003c960: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0003c970: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-0003c980: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0003c990: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0003c9a0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0003c9b0: 2020 2020 2020 2263 616e 6e6f 7420 636f        "cannot co
-0003c9c0: 6e76 6572 7420 6469 6374 2077 6974 686f  nvert dict witho
-0003c9d0: 7574 2074 6865 206b 6579 2022 0a20 2020  ut the key ".   
-0003c9e0: 2020 2020 2020 2020 2020 2020 2022 277b               "'{
-0003c9f0: 6469 6d73 5f64 6174 617d 2722 2e66 6f72  dims_data}'".for
-0003ca00: 6d61 7428 6469 6d73 5f64 6174 613d 7374  mat(dims_data=st
-0003ca10: 7228 652e 6172 6773 5b30 5d29 290a 2020  r(e.args[0])).  
-0003ca20: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0003ca30: 2020 2020 6f62 6a20 3d20 636c 7328 7661      obj = cls(va
-0003ca40: 7269 6162 6c65 5f64 6963 7429 0a0a 2020  riable_dict)..  
-0003ca50: 2020 2020 2020 2320 7768 6174 2069 6620        # what if 
-0003ca60: 636f 6f72 6473 2061 7265 6e27 7420 6469  coords aren't di
-0003ca70: 6d73 3f0a 2020 2020 2020 2020 636f 6f72  ms?.        coor
-0003ca80: 6473 203d 2073 6574 2864 2e67 6574 2822  ds = set(d.get("
-0003ca90: 636f 6f72 6473 222c 207b 7d29 2920 2d20  coords", {})) - 
-0003caa0: 7365 7428 642e 6765 7428 2264 696d 7322  set(d.get("dims"
-0003cab0: 2c20 7b7d 2929 0a20 2020 2020 2020 206f  , {})).        o
-0003cac0: 626a 203d 206f 626a 2e73 6574 5f63 6f6f  bj = obj.set_coo
-0003cad0: 7264 7328 636f 6f72 6473 290a 0a20 2020  rds(coords)..   
-0003cae0: 2020 2020 206f 626a 2e61 7474 7273 2e75       obj.attrs.u
-0003caf0: 7064 6174 6528 642e 6765 7428 2261 7474  pdate(d.get("att
-0003cb00: 7273 222c 207b 7d29 290a 2020 2020 2020  rs", {})).      
-0003cb10: 2020 6f62 6a2e 656e 636f 6469 6e67 2e75    obj.encoding.u
-0003cb20: 7064 6174 6528 642e 6765 7428 2265 6e63  pdate(d.get("enc
-0003cb30: 6f64 696e 6722 2c20 7b7d 2929 0a0a 2020  oding", {}))..  
-0003cb40: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
-0003cb50: 0a0a 2020 2020 6465 6620 5f75 6e61 7279  ..    def _unary
-0003cb60: 5f6f 7028 7365 6c66 3a20 545f 4461 7461  _op(self: T_Data
-0003cb70: 7365 742c 2066 2c20 2a61 7267 732c 202a  set, f, *args, *
-0003cb80: 2a6b 7761 7267 7329 202d 3e20 545f 4461  *kwargs) -> T_Da
-0003cb90: 7461 7365 743a 0a20 2020 2020 2020 2076  taset:.        v
-0003cba0: 6172 6961 626c 6573 203d 207b 7d0a 2020  ariables = {}.  
-0003cbb0: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
-0003cbc0: 203d 206b 7761 7267 732e 706f 7028 226b   = kwargs.pop("k
-0003cbd0: 6565 705f 6174 7472 7322 2c20 4e6f 6e65  eep_attrs", None
-0003cbe0: 290a 2020 2020 2020 2020 6966 206b 6565  ).        if kee
-0003cbf0: 705f 6174 7472 7320 6973 204e 6f6e 653a  p_attrs is None:
-0003cc00: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
-0003cc10: 705f 6174 7472 7320 3d20 5f67 6574 5f6b  p_attrs = _get_k
-0003cc20: 6565 705f 6174 7472 7328 6465 6661 756c  eep_attrs(defaul
-0003cc30: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
-0003cc40: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-0003cc50: 2e5f 7661 7269 6162 6c65 732e 6974 656d  ._variables.item
-0003cc60: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0003cc70: 2069 6620 6b20 696e 2073 656c 662e 5f63   if k in self._c
-0003cc80: 6f6f 7264 5f6e 616d 6573 3a0a 2020 2020  oord_names:.    
-0003cc90: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-0003cca0: 6162 6c65 735b 6b5d 203d 2076 0a20 2020  ables[k] = v.   
-0003ccb0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0003ccc0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0003ccd0: 6172 6961 626c 6573 5b6b 5d20 3d20 6628  ariables[k] = f(
-0003cce0: 762c 202a 6172 6773 2c20 2a2a 6b77 6172  v, *args, **kwar
-0003ccf0: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
-0003cd00: 2020 2020 6966 206b 6565 705f 6174 7472      if keep_attr
-0003cd10: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0003cd20: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0003cd30: 5b6b 5d2e 6174 7472 7320 3d20 762e 5f61  [k].attrs = v._a
-0003cd40: 7474 7273 0a20 2020 2020 2020 2061 7474  ttrs.        att
-0003cd50: 7273 203d 2073 656c 662e 5f61 7474 7273  rs = self._attrs
-0003cd60: 2069 6620 6b65 6570 5f61 7474 7273 2065   if keep_attrs e
-0003cd70: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
-0003cd80: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-0003cd90: 706c 6163 655f 7769 7468 5f6e 6577 5f64  place_with_new_d
-0003cda0: 696d 7328 7661 7269 6162 6c65 732c 2061  ims(variables, a
-0003cdb0: 7474 7273 3d61 7474 7273 290a 0a20 2020  ttrs=attrs)..   
-0003cdc0: 2064 6566 205f 6269 6e61 7279 5f6f 7028   def _binary_op(
-0003cdd0: 7365 6c66 2c20 6f74 6865 722c 2066 2c20  self, other, f, 
-0003cde0: 7265 666c 6578 6976 653d 4661 6c73 652c  reflexive=False,
-0003cdf0: 206a 6f69 6e3d 4e6f 6e65 2920 2d3e 2044   join=None) -> D
-0003ce00: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
-0003ce10: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-0003ce20: 2e64 6174 6161 7272 6179 2069 6d70 6f72  .dataarray impor
-0003ce30: 7420 4461 7461 4172 7261 790a 2020 2020  t DataArray.    
-0003ce40: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
-0003ce50: 636f 7265 2e67 726f 7570 6279 2069 6d70  core.groupby imp
-0003ce60: 6f72 7420 4772 6f75 7042 790a 0a20 2020  ort GroupBy..   
-0003ce70: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0003ce80: 6365 286f 7468 6572 2c20 4772 6f75 7042  ce(other, GroupB
-0003ce90: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
-0003cea0: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
-0003ceb0: 656e 7465 640a 2020 2020 2020 2020 616c  ented.        al
-0003cec0: 6967 6e5f 7479 7065 203d 204f 5054 494f  ign_type = OPTIO
-0003ced0: 4e53 5b22 6172 6974 686d 6574 6963 5f6a  NS["arithmetic_j
-0003cee0: 6f69 6e22 5d20 6966 206a 6f69 6e20 6973  oin"] if join is
-0003cef0: 204e 6f6e 6520 656c 7365 206a 6f69 6e0a   None else join.
-0003cf00: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0003cf10: 7461 6e63 6528 6f74 6865 722c 2028 4461  tance(other, (Da
-0003cf20: 7461 4172 7261 792c 2044 6174 6173 6574  taArray, Dataset
-0003cf30: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0003cf40: 7365 6c66 2c20 6f74 6865 7220 3d20 616c  self, other = al
-0003cf50: 6967 6e28 7365 6c66 2c20 6f74 6865 722c  ign(self, other,
-0003cf60: 206a 6f69 6e3d 616c 6967 6e5f 7479 7065   join=align_type
-0003cf70: 2c20 636f 7079 3d46 616c 7365 2920 2023  , copy=False)  #
-0003cf80: 2074 7970 653a 2069 676e 6f72 655b 6173   type: ignore[as
-0003cf90: 7369 676e 6d65 6e74 5d0a 2020 2020 2020  signment].      
-0003cfa0: 2020 6720 3d20 6620 6966 206e 6f74 2072    g = f if not r
-0003cfb0: 6566 6c65 7869 7665 2065 6c73 6520 6c61  eflexive else la
-0003cfc0: 6d62 6461 2078 2c20 793a 2066 2879 2c20  mbda x, y: f(y, 
-0003cfd0: 7829 0a20 2020 2020 2020 2064 7320 3d20  x).        ds = 
-0003cfe0: 7365 6c66 2e5f 6361 6c63 756c 6174 655f  self._calculate_
-0003cff0: 6269 6e61 7279 5f6f 7028 672c 206f 7468  binary_op(g, oth
-0003d000: 6572 2c20 6a6f 696e 3d61 6c69 676e 5f74  er, join=align_t
-0003d010: 7970 6529 0a20 2020 2020 2020 206b 6565  ype).        kee
-0003d020: 705f 6174 7472 7320 3d20 5f67 6574 5f6b  p_attrs = _get_k
-0003d030: 6565 705f 6174 7472 7328 6465 6661 756c  eep_attrs(defaul
-0003d040: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
-0003d050: 2069 6620 6b65 6570 5f61 7474 7273 3a0a   if keep_attrs:.
-0003d060: 2020 2020 2020 2020 2020 2020 6473 2e61              ds.a
-0003d070: 7474 7273 203d 2073 656c 662e 6174 7472  ttrs = self.attr
-0003d080: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-0003d090: 2064 730a 0a20 2020 2064 6566 205f 696e   ds..    def _in
-0003d0a0: 706c 6163 655f 6269 6e61 7279 5f6f 7028  place_binary_op(
-0003d0b0: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-0003d0c0: 206f 7468 6572 2c20 6629 202d 3e20 545f   other, f) -> T_
-0003d0d0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-0003d0e0: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-0003d0f0: 652e 6461 7461 6172 7261 7920 696d 706f  e.dataarray impo
-0003d100: 7274 2044 6174 6141 7272 6179 0a20 2020  rt DataArray.   
-0003d110: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
-0003d120: 2e63 6f72 652e 6772 6f75 7062 7920 696d  .core.groupby im
-0003d130: 706f 7274 2047 726f 7570 4279 0a0a 2020  port GroupBy..  
-0003d140: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0003d150: 6e63 6528 6f74 6865 722c 2047 726f 7570  nce(other, Group
-0003d160: 4279 293a 0a20 2020 2020 2020 2020 2020  By):.           
-0003d170: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-0003d180: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0003d190: 2020 2269 6e2d 706c 6163 6520 6f70 6572    "in-place oper
-0003d1a0: 6174 696f 6e73 2062 6574 7765 656e 2061  ations between a
-0003d1b0: 2044 6174 6173 6574 2061 6e64 2022 0a20   Dataset and ". 
-0003d1c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0003d1d0: 6120 6772 6f75 7065 6420 6f62 6a65 6374  a grouped object
-0003d1e0: 2061 7265 206e 6f74 2070 6572 6d69 7474   are not permitt
-0003d1f0: 6564 220a 2020 2020 2020 2020 2020 2020  ed".            
-0003d200: 290a 2020 2020 2020 2020 2320 7765 2064  ).        # we d
-0003d210: 6f6e 2774 2061 6374 7561 6c6c 7920 6d6f  on't actually mo
-0003d220: 6469 6679 2061 7272 6179 7320 696e 2d70  dify arrays in-p
-0003d230: 6c61 6365 2077 6974 6820 696e 2d70 6c61  lace with in-pla
-0003d240: 6365 2044 6174 6173 6574 0a20 2020 2020  ce Dataset.     
-0003d250: 2020 2023 2061 7269 7468 6d65 7469 6320     # arithmetic 
-0003d260: 2d2d 2074 6869 7320 6c65 7473 2075 7320  -- this lets us 
-0003d270: 6175 746f 6d61 7469 6361 6c6c 7920 616c  automatically al
-0003d280: 6967 6e20 7468 696e 6773 0a20 2020 2020  ign things.     
-0003d290: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0003d2a0: 286f 7468 6572 2c20 2844 6174 6141 7272  (other, (DataArr
-0003d2b0: 6179 2c20 4461 7461 7365 7429 293a 0a20  ay, Dataset)):. 
-0003d2c0: 2020 2020 2020 2020 2020 206f 7468 6572             other
-0003d2d0: 203d 206f 7468 6572 2e72 6569 6e64 6578   = other.reindex
-0003d2e0: 5f6c 696b 6528 7365 6c66 2c20 636f 7079  _like(self, copy
-0003d2f0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-0003d300: 6720 3d20 6f70 732e 696e 706c 6163 655f  g = ops.inplace_
-0003d310: 746f 5f6e 6f6e 696e 706c 6163 655f 6f70  to_noninplace_op
-0003d320: 2866 290a 2020 2020 2020 2020 6473 203d  (f).        ds =
-0003d330: 2073 656c 662e 5f63 616c 6375 6c61 7465   self._calculate
-0003d340: 5f62 696e 6172 795f 6f70 2867 2c20 6f74  _binary_op(g, ot
-0003d350: 6865 722c 2069 6e70 6c61 6365 3d54 7275  her, inplace=Tru
-0003d360: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-0003d370: 5f72 6570 6c61 6365 5f77 6974 685f 6e65  _replace_with_ne
-0003d380: 775f 6469 6d73 280a 2020 2020 2020 2020  w_dims(.        
-0003d390: 2020 2020 6473 2e5f 7661 7269 6162 6c65      ds._variable
-0003d3a0: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
-0003d3b0: 732e 5f63 6f6f 7264 5f6e 616d 6573 2c0a  s._coord_names,.
-0003d3c0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
-0003d3d0: 733d 6473 2e5f 6174 7472 732c 0a20 2020  s=ds._attrs,.   
-0003d3e0: 2020 2020 2020 2020 2069 6e64 6578 6573           indexes
-0003d3f0: 3d64 732e 5f69 6e64 6578 6573 2c0a 2020  =ds._indexes,.  
-0003d400: 2020 2020 2020 2020 2020 696e 706c 6163            inplac
-0003d410: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-0003d420: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0003d430: 2073 656c 660a 0a20 2020 2064 6566 205f   self..    def _
-0003d440: 6361 6c63 756c 6174 655f 6269 6e61 7279  calculate_binary
-0003d450: 5f6f 7028 0a20 2020 2020 2020 2073 656c  _op(.        sel
-0003d460: 662c 2066 2c20 6f74 6865 722c 206a 6f69  f, f, other, joi
-0003d470: 6e3d 2269 6e6e 6572 222c 2069 6e70 6c61  n="inner", inpla
-0003d480: 6365 3a20 626f 6f6c 203d 2046 616c 7365  ce: bool = False
-0003d490: 0a20 2020 2029 202d 3e20 4461 7461 7365  .    ) -> Datase
-0003d4a0: 743a 0a20 2020 2020 2020 2064 6566 2061  t:.        def a
-0003d4b0: 7070 6c79 5f6f 7665 725f 626f 7468 286c  pply_over_both(l
-0003d4c0: 6873 5f64 6174 615f 7661 7273 2c20 7268  hs_data_vars, rh
-0003d4d0: 735f 6461 7461 5f76 6172 732c 206c 6873  s_data_vars, lhs
-0003d4e0: 5f76 6172 732c 2072 6873 5f76 6172 7329  _vars, rhs_vars)
-0003d4f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0003d500: 2069 6e70 6c61 6365 2061 6e64 2073 6574   inplace and set
-0003d510: 286c 6873 5f64 6174 615f 7661 7273 2920  (lhs_data_vars) 
-0003d520: 213d 2073 6574 2872 6873 5f64 6174 615f  != set(rhs_data_
-0003d530: 7661 7273 293a 0a20 2020 2020 2020 2020  vars):.         
-0003d540: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0003d550: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-0003d560: 2020 2020 2020 2020 2020 2020 2022 6461               "da
-0003d570: 7461 7365 7473 206d 7573 7420 6861 7665  tasets must have
-0003d580: 2074 6865 2073 616d 6520 6461 7461 2076   the same data v
-0003d590: 6172 6961 626c 6573 2022 0a20 2020 2020  ariables ".     
-0003d5a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0003d5b0: 2266 6f72 2069 6e2d 706c 6163 6520 6172  "for in-place ar
-0003d5c0: 6974 686d 6574 6963 206f 7065 7261 7469  ithmetic operati
-0003d5d0: 6f6e 733a 207b 6c69 7374 286c 6873 5f64  ons: {list(lhs_d
-0003d5e0: 6174 615f 7661 7273 297d 2c20 7b6c 6973  ata_vars)}, {lis
-0003d5f0: 7428 7268 735f 6461 7461 5f76 6172 7329  t(rhs_data_vars)
-0003d600: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0003d610: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0003d620: 2020 6465 7374 5f76 6172 7320 3d20 7b7d    dest_vars = {}
-0003d630: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0003d640: 7220 6b20 696e 206c 6873 5f64 6174 615f  r k in lhs_data_
-0003d650: 7661 7273 3a0a 2020 2020 2020 2020 2020  vars:.          
-0003d660: 2020 2020 2020 6966 206b 2069 6e20 7268        if k in rh
-0003d670: 735f 6461 7461 5f76 6172 733a 0a20 2020  s_data_vars:.   
-0003d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d690: 2064 6573 745f 7661 7273 5b6b 5d20 3d20   dest_vars[k] = 
-0003d6a0: 6628 6c68 735f 7661 7273 5b6b 5d2c 2072  f(lhs_vars[k], r
-0003d6b0: 6873 5f76 6172 735b 6b5d 290a 2020 2020  hs_vars[k]).    
-0003d6c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0003d6d0: 206a 6f69 6e20 696e 205b 226c 6566 7422   join in ["left"
-0003d6e0: 2c20 226f 7574 6572 225d 3a0a 2020 2020  , "outer"]:.    
-0003d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d700: 6465 7374 5f76 6172 735b 6b5d 203d 2066  dest_vars[k] = f
-0003d710: 286c 6873 5f76 6172 735b 6b5d 2c20 6e70  (lhs_vars[k], np
-0003d720: 2e6e 616e 290a 2020 2020 2020 2020 2020  .nan).          
-0003d730: 2020 666f 7220 6b20 696e 2072 6873 5f64    for k in rhs_d
-0003d740: 6174 615f 7661 7273 3a0a 2020 2020 2020  ata_vars:.      
-0003d750: 2020 2020 2020 2020 2020 6966 206b 206e            if k n
-0003d760: 6f74 2069 6e20 6465 7374 5f76 6172 7320  ot in dest_vars 
-0003d770: 616e 6420 6a6f 696e 2069 6e20 5b22 7269  and join in ["ri
-0003d780: 6768 7422 2c20 226f 7574 6572 225d 3a0a  ght", "outer"]:.
-0003d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d7a0: 2020 2020 6465 7374 5f76 6172 735b 6b5d      dest_vars[k]
-0003d7b0: 203d 2066 2872 6873 5f76 6172 735b 6b5d   = f(rhs_vars[k]
-0003d7c0: 2c20 6e70 2e6e 616e 290a 2020 2020 2020  , np.nan).      
-0003d7d0: 2020 2020 2020 7265 7475 726e 2064 6573        return des
-0003d7e0: 745f 7661 7273 0a0a 2020 2020 2020 2020  t_vars..        
-0003d7f0: 6966 2075 7469 6c73 2e69 735f 6469 6374  if utils.is_dict
-0003d800: 5f6c 696b 6528 6f74 6865 7229 2061 6e64  _like(other) and
-0003d810: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0003d820: 6f74 6865 722c 2044 6174 6173 6574 293a  other, Dataset):
-0003d830: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0003d840: 616e 2774 2075 7365 206f 7572 2073 686f  an't use our sho
-0003d850: 7274 6375 7420 6f66 2064 6f69 6e67 2074  rtcut of doing t
-0003d860: 6865 2062 696e 6172 7920 6f70 6572 6174  he binary operat
-0003d870: 696f 6e20 7769 7468 0a20 2020 2020 2020  ion with.       
-0003d880: 2020 2020 2023 2056 6172 6961 626c 6520       # Variable 
-0003d890: 6f62 6a65 6374 732c 2073 6f20 6170 706c  objects, so appl
-0003d8a0: 7920 6f76 6572 206f 7572 2064 6174 6120  y over our data 
-0003d8b0: 7661 7273 2069 6e73 7465 6164 2e0a 2020  vars instead..  
-0003d8c0: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-0003d8d0: 7461 5f76 6172 7320 3d20 6170 706c 795f  ta_vars = apply_
-0003d8e0: 6f76 6572 5f62 6f74 6828 0a20 2020 2020  over_both(.     
-0003d8f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003d900: 6461 7461 5f76 6172 732c 206f 7468 6572  data_vars, other
-0003d910: 2c20 7365 6c66 2e64 6174 615f 7661 7273  , self.data_vars
-0003d920: 2c20 6f74 6865 720a 2020 2020 2020 2020  , other.        
-0003d930: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0003d940: 2020 7265 7475 726e 2074 7970 6528 7365    return type(se
-0003d950: 6c66 2928 6e65 775f 6461 7461 5f76 6172  lf)(new_data_var
-0003d960: 7329 0a0a 2020 2020 2020 2020 6f74 6865  s)..        othe
-0003d970: 725f 636f 6f72 6473 3a20 436f 6f72 6469  r_coords: Coordi
-0003d980: 6e61 7465 7320 7c20 4e6f 6e65 203d 2067  nates | None = g
-0003d990: 6574 6174 7472 286f 7468 6572 2c20 2263  etattr(other, "c
-0003d9a0: 6f6f 7264 7322 2c20 4e6f 6e65 290a 2020  oords", None).  
-0003d9b0: 2020 2020 2020 6473 203d 2073 656c 662e        ds = self.
-0003d9c0: 636f 6f72 6473 2e6d 6572 6765 286f 7468  coords.merge(oth
-0003d9d0: 6572 5f63 6f6f 7264 7329 0a0a 2020 2020  er_coords)..    
-0003d9e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0003d9f0: 6528 6f74 6865 722c 2044 6174 6173 6574  e(other, Dataset
-0003da00: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-0003da10: 6577 5f76 6172 7320 3d20 6170 706c 795f  ew_vars = apply_
-0003da20: 6f76 6572 5f62 6f74 6828 0a20 2020 2020  over_both(.     
-0003da30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003da40: 6461 7461 5f76 6172 732c 206f 7468 6572  data_vars, other
-0003da50: 2e64 6174 615f 7661 7273 2c20 7365 6c66  .data_vars, self
-0003da60: 2e76 6172 6961 626c 6573 2c20 6f74 6865  .variables, othe
-0003da70: 722e 7661 7269 6162 6c65 730a 2020 2020  r.variables.    
-0003da80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0003da90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0003daa0: 2020 2020 6f74 6865 725f 7661 7269 6162      other_variab
-0003dab0: 6c65 203d 2067 6574 6174 7472 286f 7468  le = getattr(oth
-0003dac0: 6572 2c20 2276 6172 6961 626c 6522 2c20  er, "variable", 
-0003dad0: 6f74 6865 7229 0a20 2020 2020 2020 2020  other).         
-0003dae0: 2020 206e 6577 5f76 6172 7320 3d20 7b6b     new_vars = {k
-0003daf0: 3a20 6628 7365 6c66 2e76 6172 6961 626c  : f(self.variabl
-0003db00: 6573 5b6b 5d2c 206f 7468 6572 5f76 6172  es[k], other_var
-0003db10: 6961 626c 6529 2066 6f72 206b 2069 6e20  iable) for k in 
-0003db20: 7365 6c66 2e64 6174 615f 7661 7273 7d0a  self.data_vars}.
-0003db30: 2020 2020 2020 2020 6473 2e5f 7661 7269          ds._vari
-0003db40: 6162 6c65 732e 7570 6461 7465 286e 6577  ables.update(new
-0003db50: 5f76 6172 7329 0a20 2020 2020 2020 2064  _vars).        d
-0003db60: 732e 5f64 696d 7320 3d20 6361 6c63 756c  s._dims = calcul
-0003db70: 6174 655f 6469 6d65 6e73 696f 6e73 2864  ate_dimensions(d
-0003db80: 732e 5f76 6172 6961 626c 6573 290a 2020  s._variables).  
-0003db90: 2020 2020 2020 7265 7475 726e 2064 730a        return ds.
-0003dba0: 0a20 2020 2064 6566 205f 636f 7079 5f61  .    def _copy_a
-0003dbb0: 7474 7273 5f66 726f 6d28 7365 6c66 2c20  ttrs_from(self, 
-0003dbc0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-0003dbd0: 7365 6c66 2e61 7474 7273 203d 206f 7468  self.attrs = oth
-0003dbe0: 6572 2e61 7474 7273 0a20 2020 2020 2020  er.attrs.       
-0003dbf0: 2066 6f72 2076 2069 6e20 6f74 6865 722e   for v in other.
-0003dc00: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-0003dc10: 2020 2020 2020 2069 6620 7620 696e 2073         if v in s
-0003dc20: 656c 662e 7661 7269 6162 6c65 733a 0a20  elf.variables:. 
-0003dc30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003dc40: 656c 662e 7661 7269 6162 6c65 735b 765d  elf.variables[v]
-0003dc50: 2e61 7474 7273 203d 206f 7468 6572 2e76  .attrs = other.v
-0003dc60: 6172 6961 626c 6573 5b76 5d2e 6174 7472  ariables[v].attr
-0003dc70: 730a 0a20 2020 2064 6566 2064 6966 6628  s..    def diff(
-0003dc80: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
-0003dc90: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
-0003dca0: 2020 6469 6d3a 2048 6173 6861 626c 652c    dim: Hashable,
-0003dcb0: 0a20 2020 2020 2020 206e 3a20 696e 7420  .        n: int 
-0003dcc0: 3d20 312c 0a20 2020 2020 2020 206c 6162  = 1,.        lab
-0003dcd0: 656c 3a20 4c69 7465 7261 6c5b 2275 7070  el: Literal["upp
-0003dce0: 6572 222c 2022 6c6f 7765 7222 5d20 3d20  er", "lower"] = 
-0003dcf0: 2275 7070 6572 222c 0a20 2020 2029 202d  "upper",.    ) -
-0003dd00: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-0003dd10: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
-0003dd20: 6520 7468 6520 6e2d 7468 206f 7264 6572  e the n-th order
-0003dd30: 2064 6973 6372 6574 6520 6469 6666 6572   discrete differ
-0003dd40: 656e 6365 2061 6c6f 6e67 2067 6976 656e  ence along given
-0003dd50: 2061 7869 732e 0a0a 2020 2020 2020 2020   axis...        
-0003dd60: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0003dd70: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0003dd80: 2020 2020 2020 6469 6d20 3a20 4861 7368        dim : Hash
-0003dd90: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-0003dda0: 2044 696d 656e 7369 6f6e 206f 7665 7220   Dimension over 
-0003ddb0: 7768 6963 6820 746f 2063 616c 6375 6c61  which to calcula
-0003ddc0: 7465 2074 6865 2066 696e 6974 6520 6469  te the finite di
-0003ddd0: 6666 6572 656e 6365 2e0a 2020 2020 2020  fference..      
-0003dde0: 2020 6e20 3a20 696e 742c 2064 6566 6175    n : int, defau
-0003ddf0: 6c74 3a20 310a 2020 2020 2020 2020 2020  lt: 1.          
-0003de00: 2020 5468 6520 6e75 6d62 6572 206f 6620    The number of 
-0003de10: 7469 6d65 7320 7661 6c75 6573 2061 7265  times values are
-0003de20: 2064 6966 6665 7265 6e63 6564 2e0a 2020   differenced..  
-0003de30: 2020 2020 2020 6c61 6265 6c20 3a20 7b22        label : {"
-0003de40: 7570 7065 7222 2c20 226c 6f77 6572 227d  upper", "lower"}
-0003de50: 2c20 6465 6661 756c 743a 2022 7570 7065  , default: "uppe
-0003de60: 7222 0a20 2020 2020 2020 2020 2020 2054  r".            T
-0003de70: 6865 206e 6577 2063 6f6f 7264 696e 6174  he new coordinat
-0003de80: 6520 696e 2064 696d 656e 7369 6f6e 2060  e in dimension `
-0003de90: 6064 696d 6060 2077 696c 6c20 6861 7665  `dim`` will have
-0003dea0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-0003deb0: 2076 616c 7565 7320 6f66 2065 6974 6865   values of eithe
-0003dec0: 7220 7468 6520 6d69 6e75 656e 6427 7320  r the minuend's 
-0003ded0: 6f72 2073 7562 7472 6168 656e 6427 7320  or subtrahend's 
-0003dee0: 636f 6f72 6469 6e61 7465 0a20 2020 2020  coordinate.     
-0003def0: 2020 2020 2020 2066 6f72 2076 616c 7565         for value
-0003df00: 7320 2775 7070 6572 2720 616e 6420 276c  s 'upper' and 'l
-0003df10: 6f77 6572 272c 2072 6573 7065 6374 6976  ower', respectiv
-0003df20: 656c 792e 0a0a 2020 2020 2020 2020 5265  ely...        Re
-0003df30: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-0003df40: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6469  -----.        di
-0003df50: 6666 6572 656e 6365 203a 2044 6174 6173  fference : Datas
-0003df60: 6574 0a20 2020 2020 2020 2020 2020 2054  et.            T
-0003df70: 6865 206e 2d74 6820 6f72 6465 7220 6669  he n-th order fi
-0003df80: 6e69 7465 2064 6966 6665 7265 6e63 6520  nite difference 
-0003df90: 6f66 2074 6869 7320 6f62 6a65 6374 2e0a  of this object..
-0003dfa0: 0a20 2020 2020 2020 204e 6f74 6573 0a20  .        Notes. 
-0003dfb0: 2020 2020 2020 202d 2d2d 2d2d 0a20 2020         -----.   
-0003dfc0: 2020 2020 2060 6e60 206d 6174 6368 6573       `n` matches
-0003dfd0: 206e 756d 7079 2773 2062 6568 6176 696f   numpy's behavio
-0003dfe0: 7220 616e 6420 6973 2064 6966 6665 7265  r and is differe
-0003dff0: 6e74 2066 726f 6d20 7061 6e64 6173 2720  nt from pandas' 
-0003e000: 6669 7273 7420 6172 6775 6d65 6e74 206e  first argument n
-0003e010: 616d 6564 0a20 2020 2020 2020 2060 7065  amed.        `pe
-0003e020: 7269 6f64 7360 2e0a 0a20 2020 2020 2020  riods`...       
-0003e030: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
-0003e040: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-0003e050: 2020 203e 3e3e 2064 7320 3d20 7872 2e44     >>> ds = xr.D
-0003e060: 6174 6173 6574 287b 2266 6f6f 223a 2028  ataset({"foo": (
-0003e070: 2278 222c 205b 352c 2035 2c20 362c 2036  "x", [5, 5, 6, 6
-0003e080: 5d29 7d29 0a20 2020 2020 2020 203e 3e3e  ])}).        >>>
-0003e090: 2064 732e 6469 6666 2822 7822 290a 2020   ds.diff("x").  
-0003e0a0: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-0003e0b0: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-0003e0c0: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
-0003e0d0: 3329 0a20 2020 2020 2020 2044 696d 656e  3).        Dimen
-0003e0e0: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
-0003e0f0: 6f72 6469 6e61 7465 733a 2078 0a20 2020  ordinates: x.   
-0003e100: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
-0003e110: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-0003e120: 2066 6f6f 2020 2020 2020 2878 2920 696e   foo      (x) in
-0003e130: 7436 3420 3020 3120 300a 2020 2020 2020  t64 0 1 0.      
-0003e140: 2020 3e3e 3e20 6473 2e64 6966 6628 2278    >>> ds.diff("x
-0003e150: 222c 2032 290a 2020 2020 2020 2020 3c78  ", 2).        <x
-0003e160: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-0003e170: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-0003e180: 733a 2020 2878 3a20 3229 0a20 2020 2020  s:  (x: 2).     
-0003e190: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
-0003e1a0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
-0003e1b0: 733a 2078 0a20 2020 2020 2020 2044 6174  s: x.        Dat
-0003e1c0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-0003e1d0: 2020 2020 2020 2020 2066 6f6f 2020 2020           foo    
-0003e1e0: 2020 2878 2920 696e 7436 3420 3120 2d31    (x) int64 1 -1
-0003e1f0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-0003e200: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-0003e210: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
-0003e220: 7365 742e 6469 6666 6572 656e 7469 6174  set.differentiat
-0003e230: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-0003e240: 2020 2020 2020 6966 206e 203d 3d20 303a        if n == 0:
-0003e250: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0003e260: 7572 6e20 7365 6c66 0a20 2020 2020 2020  urn self.       
-0003e270: 2069 6620 6e20 3c20 303a 0a20 2020 2020   if n < 0:.     
-0003e280: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0003e290: 7565 4572 726f 7228 6622 6f72 6465 7220  ueError(f"order 
-0003e2a0: 606e 6020 6d75 7374 2062 6520 6e6f 6e2d  `n` must be non-
-0003e2b0: 6e65 6761 7469 7665 2062 7574 2067 6f74  negative but got
-0003e2c0: 207b 6e7d 2229 0a0a 2020 2020 2020 2020   {n}")..        
-0003e2d0: 2320 7072 6570 6172 6520 736c 6963 6573  # prepare slices
-0003e2e0: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
-0003e2f0: 7461 7274 203d 207b 6469 6d3a 2073 6c69  tart = {dim: sli
-0003e300: 6365 284e 6f6e 652c 202d 3129 7d0a 2020  ce(None, -1)}.  
-0003e310: 2020 2020 2020 736c 6963 655f 656e 6420        slice_end 
-0003e320: 3d20 7b64 696d 3a20 736c 6963 6528 312c  = {dim: slice(1,
-0003e330: 204e 6f6e 6529 7d0a 0a20 2020 2020 2020   None)}..       
-0003e340: 2023 2070 7265 7061 7265 206e 6577 2063   # prepare new c
-0003e350: 6f6f 7264 696e 6174 650a 2020 2020 2020  oordinate.      
-0003e360: 2020 6966 206c 6162 656c 203d 3d20 2275    if label == "u
-0003e370: 7070 6572 223a 0a20 2020 2020 2020 2020  pper":.         
-0003e380: 2020 2073 6c69 6365 5f6e 6577 203d 2073     slice_new = s
-0003e390: 6c69 6365 5f65 6e64 0a20 2020 2020 2020  lice_end.       
-0003e3a0: 2065 6c69 6620 6c61 6265 6c20 3d3d 2022   elif label == "
-0003e3b0: 6c6f 7765 7222 3a0a 2020 2020 2020 2020  lower":.        
-0003e3c0: 2020 2020 736c 6963 655f 6e65 7720 3d20      slice_new = 
-0003e3d0: 736c 6963 655f 7374 6172 740a 2020 2020  slice_start.    
-0003e3e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0003e3f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0003e400: 6545 7272 6f72 2822 5468 6520 276c 6162  eError("The 'lab
-0003e410: 656c 2720 6172 6775 6d65 6e74 2068 6173  el' argument has
-0003e420: 2074 6f20 6265 2065 6974 6865 7220 2775   to be either 'u
-0003e430: 7070 6572 2720 6f72 2027 6c6f 7765 7227  pper' or 'lower'
-0003e440: 2229 0a0a 2020 2020 2020 2020 696e 6465  ")..        inde
-0003e450: 7865 732c 2069 6e64 6578 5f76 6172 7320  xes, index_vars 
-0003e460: 3d20 6973 656c 5f69 6e64 6578 6573 2873  = isel_indexes(s
-0003e470: 656c 662e 7869 6e64 6578 6573 2c20 736c  elf.xindexes, sl
-0003e480: 6963 655f 6e65 7729 0a20 2020 2020 2020  ice_new).       
-0003e490: 2076 6172 6961 626c 6573 203d 207b 7d0a   variables = {}.
-0003e4a0: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
-0003e4b0: 652c 2076 6172 2069 6e20 7365 6c66 2e76  e, var in self.v
-0003e4c0: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
-0003e4d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0003e4e0: 206e 616d 6520 696e 2069 6e64 6578 5f76   name in index_v
-0003e4f0: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
-0003e500: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
-0003e510: 616d 655d 203d 2069 6e64 6578 5f76 6172  ame] = index_var
-0003e520: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
-0003e530: 2020 2020 656c 6966 2064 696d 2069 6e20      elif dim in 
-0003e540: 7661 722e 6469 6d73 3a0a 2020 2020 2020  var.dims:.      
-0003e550: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-0003e560: 6520 696e 2073 656c 662e 6461 7461 5f76  e in self.data_v
-0003e570: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
-0003e580: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0003e590: 6573 5b6e 616d 655d 203d 2076 6172 2e69  es[name] = var.i
-0003e5a0: 7365 6c28 736c 6963 655f 656e 6429 202d  sel(slice_end) -
-0003e5b0: 2076 6172 2e69 7365 6c28 736c 6963 655f   var.isel(slice_
-0003e5c0: 7374 6172 7429 0a20 2020 2020 2020 2020  start).         
-0003e5d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0003e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e5f0: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
-0003e600: 203d 2076 6172 2e69 7365 6c28 736c 6963   = var.isel(slic
-0003e610: 655f 6e65 7729 0a20 2020 2020 2020 2020  e_new).         
-0003e620: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003e630: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0003e640: 6573 5b6e 616d 655d 203d 2076 6172 0a0a  es[name] = var..
-0003e650: 2020 2020 2020 2020 6469 6666 6572 656e          differen
-0003e660: 6365 203d 2073 656c 662e 5f72 6570 6c61  ce = self._repla
-0003e670: 6365 5f77 6974 685f 6e65 775f 6469 6d73  ce_with_new_dims
-0003e680: 2876 6172 6961 626c 6573 2c20 696e 6465  (variables, inde
-0003e690: 7865 733d 696e 6465 7865 7329 0a0a 2020  xes=indexes)..  
-0003e6a0: 2020 2020 2020 6966 206e 203e 2031 3a0a        if n > 1:.
-0003e6b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003e6c0: 726e 2064 6966 6665 7265 6e63 652e 6469  rn difference.di
-0003e6d0: 6666 2864 696d 2c20 6e20 2d20 3129 0a20  ff(dim, n - 1). 
-0003e6e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0003e6f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0003e700: 6469 6666 6572 656e 6365 0a0a 2020 2020  difference..    
-0003e710: 6465 6620 7368 6966 7428 0a20 2020 2020  def shift(.     
-0003e720: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-0003e730: 6574 2c0a 2020 2020 2020 2020 7368 6966  et,.        shif
-0003e740: 7473 3a20 4d61 7070 696e 675b 416e 792c  ts: Mapping[Any,
-0003e750: 2069 6e74 5d20 7c20 4e6f 6e65 203d 204e   int] | None = N
-0003e760: 6f6e 652c 0a20 2020 2020 2020 2066 696c  one,.        fil
-0003e770: 6c5f 7661 6c75 653a 2041 6e79 203d 2078  l_value: Any = x
-0003e780: 7264 7479 7065 732e 4e41 2c0a 2020 2020  rdtypes.NA,.    
-0003e790: 2020 2020 2a2a 7368 6966 7473 5f6b 7761      **shifts_kwa
-0003e7a0: 7267 733a 2069 6e74 2c0a 2020 2020 2920  rgs: int,.    ) 
-0003e7b0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-0003e7c0: 2020 2020 2020 2222 2253 6869 6674 2074        """Shift t
-0003e7d0: 6869 7320 6461 7461 7365 7420 6279 2061  his dataset by a
-0003e7e0: 6e20 6f66 6673 6574 2061 6c6f 6e67 206f  n offset along o
-0003e7f0: 6e65 206f 7220 6d6f 7265 2064 696d 656e  ne or more dimen
-0003e800: 7369 6f6e 732e 0a0a 2020 2020 2020 2020  sions...        
-0003e810: 4f6e 6c79 2064 6174 6120 7661 7269 6162  Only data variab
-0003e820: 6c65 7320 6172 6520 6d6f 7665 643b 2063  les are moved; c
-0003e830: 6f6f 7264 696e 6174 6573 2073 7461 7920  oordinates stay 
-0003e840: 696e 2070 6c61 6365 2e20 5468 6973 2069  in place. This i
-0003e850: 730a 2020 2020 2020 2020 636f 6e73 6973  s.        consis
-0003e860: 7465 6e74 2077 6974 6820 7468 6520 6265  tent with the be
-0003e870: 6861 7669 6f72 206f 6620 6060 7368 6966  havior of ``shif
-0003e880: 7460 6020 696e 2070 616e 6461 732e 0a0a  t`` in pandas...
-0003e890: 2020 2020 2020 2020 5661 6c75 6573 2073          Values s
-0003e8a0: 6869 6674 6564 2066 726f 6d20 6265 796f  hifted from beyo
-0003e8b0: 6e64 2061 7272 6179 2062 6f75 6e64 7320  nd array bounds 
-0003e8c0: 7769 6c6c 2061 7070 6561 7220 6174 206f  will appear at o
-0003e8d0: 6e65 2065 6e64 206f 660a 2020 2020 2020  ne end of.      
-0003e8e0: 2020 6561 6368 2064 696d 656e 7369 6f6e    each dimension
-0003e8f0: 2c20 7768 6963 6820 6172 6520 6669 6c6c  , which are fill
-0003e900: 6564 2061 6363 6f72 6469 6e67 2074 6f20  ed according to 
-0003e910: 6066 696c 6c5f 7661 6c75 6560 2e20 466f  `fill_value`. Fo
-0003e920: 7220 7065 7269 6f64 6963 0a20 2020 2020  r periodic.     
-0003e930: 2020 206f 6666 7365 7473 2069 6e73 7465     offsets inste
-0003e940: 6164 2073 6565 2060 726f 6c6c 602e 0a0a  ad see `roll`...
-0003e950: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-0003e960: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-0003e970: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7368  -----.        sh
-0003e980: 6966 7473 203a 206d 6170 7069 6e67 206f  ifts : mapping o
-0003e990: 6620 6861 7368 6162 6c65 2074 6f20 696e  f hashable to in
-0003e9a0: 740a 2020 2020 2020 2020 2020 2020 496e  t.            In
-0003e9b0: 7465 6765 7220 6f66 6673 6574 2074 6f20  teger offset to 
-0003e9c0: 7368 6966 7420 616c 6f6e 6720 6561 6368  shift along each
-0003e9d0: 206f 6620 7468 6520 6769 7665 6e20 6469   of the given di
-0003e9e0: 6d65 6e73 696f 6e73 2e0a 2020 2020 2020  mensions..      
-0003e9f0: 2020 2020 2020 506f 7369 7469 7665 206f        Positive o
-0003ea00: 6666 7365 7473 2073 6869 6674 2074 6f20  ffsets shift to 
-0003ea10: 7468 6520 7269 6768 743b 206e 6567 6174  the right; negat
-0003ea20: 6976 6520 6f66 6673 6574 7320 7368 6966  ive offsets shif
-0003ea30: 7420 746f 2074 6865 0a20 2020 2020 2020  t to the.       
-0003ea40: 2020 2020 206c 6566 742e 0a20 2020 2020       left..     
-0003ea50: 2020 2066 696c 6c5f 7661 6c75 6520 3a20     fill_value : 
-0003ea60: 7363 616c 6172 206f 7220 6469 6374 2d6c  scalar or dict-l
-0003ea70: 696b 652c 206f 7074 696f 6e61 6c0a 2020  ike, optional.  
-0003ea80: 2020 2020 2020 2020 2020 5661 6c75 6520            Value 
-0003ea90: 746f 2075 7365 2066 6f72 206e 6577 6c79  to use for newly
-0003eaa0: 206d 6973 7369 6e67 2076 616c 7565 732e   missing values.
-0003eab0: 2049 6620 6120 6469 6374 2d6c 696b 652c   If a dict-like,
-0003eac0: 206d 6170 730a 2020 2020 2020 2020 2020   maps.          
-0003ead0: 2020 7661 7269 6162 6c65 206e 616d 6573    variable names
-0003eae0: 2028 696e 636c 7564 696e 6720 636f 6f72   (including coor
-0003eaf0: 6469 6e61 7465 7329 2074 6f20 6669 6c6c  dinates) to fill
-0003eb00: 2076 616c 7565 732e 0a20 2020 2020 2020   values..       
-0003eb10: 202a 2a73 6869 6674 735f 6b77 6172 6773   **shifts_kwargs
-0003eb20: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-0003eb30: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-0003eb40: 7473 2066 6f72 6d20 6f66 2060 6073 6869  ts form of ``shi
-0003eb50: 6674 7360 602e 0a20 2020 2020 2020 2020  fts``..         
-0003eb60: 2020 204f 6e65 206f 6620 7368 6966 7473     One of shifts
-0003eb70: 206f 7220 7368 6966 7473 5f6b 7761 7267   or shifts_kwarg
-0003eb80: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
-0003eb90: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
-0003eba0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-0003ebb0: 2d2d 2d2d 0a20 2020 2020 2020 2073 6869  ----.        shi
-0003ebc0: 6674 6564 203a 2044 6174 6173 6574 0a20  fted : Dataset. 
-0003ebd0: 2020 2020 2020 2020 2020 2044 6174 6173             Datas
-0003ebe0: 6574 2077 6974 6820 7468 6520 7361 6d65  et with the same
-0003ebf0: 2063 6f6f 7264 696e 6174 6573 2061 6e64   coordinates and
-0003ec00: 2061 7474 7269 6275 7465 7320 6275 7420   attributes but 
-0003ec10: 7368 6966 7465 6420 6461 7461 0a20 2020  shifted data.   
-0003ec20: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0003ec30: 6573 2e0a 0a20 2020 2020 2020 2053 6565  es...        See
-0003ec40: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-0003ec50: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2072  ------.        r
-0003ec60: 6f6c 6c0a 0a20 2020 2020 2020 2045 7861  oll..        Exa
-0003ec70: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
-0003ec80: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
-0003ec90: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
-0003eca0: 6574 287b 2266 6f6f 223a 2028 2278 222c  et({"foo": ("x",
-0003ecb0: 206c 6973 7428 2261 6263 6465 2229 297d   list("abcde"))}
-0003ecc0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
-0003ecd0: 2e73 6869 6674 2878 3d32 290a 2020 2020  .shift(x=2).    
-0003ece0: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
-0003ecf0: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
-0003ed00: 656e 7369 6f6e 733a 2020 2878 3a20 3529  ensions:  (x: 5)
-0003ed10: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
-0003ed20: 6f6e 7320 7769 7468 6f75 7420 636f 6f72  ons without coor
-0003ed30: 6469 6e61 7465 733a 2078 0a20 2020 2020  dinates: x.     
-0003ed40: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-0003ed50: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-0003ed60: 6f6f 2020 2020 2020 2878 2920 6f62 6a65  oo      (x) obje
-0003ed70: 6374 206e 616e 206e 616e 2027 6127 2027  ct nan nan 'a' '
-0003ed80: 6227 2027 6327 0a20 2020 2020 2020 2022  b' 'c'.        "
-0003ed90: 2222 0a20 2020 2020 2020 2073 6869 6674  "".        shift
-0003eda0: 7320 3d20 6569 7468 6572 5f64 6963 745f  s = either_dict_
-0003edb0: 6f72 5f6b 7761 7267 7328 7368 6966 7473  or_kwargs(shifts
-0003edc0: 2c20 7368 6966 7473 5f6b 7761 7267 732c  , shifts_kwargs,
-0003edd0: 2022 7368 6966 7422 290a 2020 2020 2020   "shift").      
-0003ede0: 2020 696e 7661 6c69 6420 3d20 5b6b 2066    invalid = [k f
-0003edf0: 6f72 206b 2069 6e20 7368 6966 7473 2069  or k in shifts i
-0003ee00: 6620 6b20 6e6f 7420 696e 2073 656c 662e  f k not in self.
-0003ee10: 6469 6d73 5d0a 2020 2020 2020 2020 6966  dims].        if
-0003ee20: 2069 6e76 616c 6964 3a0a 2020 2020 2020   invalid:.      
-0003ee30: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0003ee40: 6545 7272 6f72 2866 2264 696d 656e 7369  eError(f"dimensi
-0003ee50: 6f6e 7320 7b69 6e76 616c 6964 2172 7d20  ons {invalid!r} 
-0003ee60: 646f 206e 6f74 2065 7869 7374 2229 0a0a  do not exist")..
-0003ee70: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0003ee80: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
-0003ee90: 6f72 206e 616d 652c 2076 6172 2069 6e20  or name, var in 
-0003eea0: 7365 6c66 2e76 6172 6961 626c 6573 2e69  self.variables.i
-0003eeb0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0003eec0: 2020 2020 6966 206e 616d 6520 696e 2073      if name in s
-0003eed0: 656c 662e 6461 7461 5f76 6172 733a 0a20  elf.data_vars:. 
-0003eee0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0003eef0: 696c 6c5f 7661 6c75 655f 203d 2028 0a20  ill_value_ = (. 
-0003ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ef10: 2020 2066 696c 6c5f 7661 6c75 652e 6765     fill_value.ge
-0003ef20: 7428 6e61 6d65 2c20 7872 6474 7970 6573  t(name, xrdtypes
-0003ef30: 2e4e 4129 0a20 2020 2020 2020 2020 2020  .NA).           
-0003ef40: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0003ef50: 7374 616e 6365 2866 696c 6c5f 7661 6c75  stance(fill_valu
-0003ef60: 652c 2064 6963 7429 0a20 2020 2020 2020  e, dict).       
-0003ef70: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0003ef80: 6520 6669 6c6c 5f76 616c 7565 0a20 2020  e fill_value.   
-0003ef90: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-0003efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003efb0: 7661 725f 7368 6966 7473 203d 207b 6b3a  var_shifts = {k:
-0003efc0: 2076 2066 6f72 206b 2c20 7620 696e 2073   v for k, v in s
-0003efd0: 6869 6674 732e 6974 656d 7328 2920 6966  hifts.items() if
-0003efe0: 206b 2069 6e20 7661 722e 6469 6d73 7d0a   k in var.dims}.
-0003eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f000: 7661 7269 6162 6c65 735b 6e61 6d65 5d20  variables[name] 
-0003f010: 3d20 7661 722e 7368 6966 7428 6669 6c6c  = var.shift(fill
-0003f020: 5f76 616c 7565 3d66 696c 6c5f 7661 6c75  _value=fill_valu
-0003f030: 655f 2c20 7368 6966 7473 3d76 6172 5f73  e_, shifts=var_s
-0003f040: 6869 6674 7329 0a20 2020 2020 2020 2020  hifts).         
-0003f050: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003f060: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0003f070: 6573 5b6e 616d 655d 203d 2076 6172 0a0a  es[name] = var..
-0003f080: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0003f090: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
-0003f0a0: 6961 626c 6573 290a 0a20 2020 2064 6566  iables)..    def
-0003f0b0: 2072 6f6c 6c28 0a20 2020 2020 2020 2073   roll(.        s
-0003f0c0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-0003f0d0: 2020 2020 2020 2020 7368 6966 7473 3a20          shifts: 
-0003f0e0: 4d61 7070 696e 675b 416e 792c 2069 6e74  Mapping[Any, int
-0003f0f0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-0003f100: 0a20 2020 2020 2020 2072 6f6c 6c5f 636f  .        roll_co
-0003f110: 6f72 6473 3a20 626f 6f6c 203d 2046 616c  ords: bool = Fal
-0003f120: 7365 2c0a 2020 2020 2020 2020 2a2a 7368  se,.        **sh
-0003f130: 6966 7473 5f6b 7761 7267 733a 2069 6e74  ifts_kwargs: int
-0003f140: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
-0003f150: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
-0003f160: 2252 6f6c 6c20 7468 6973 2064 6174 6173  "Roll this datas
-0003f170: 6574 2062 7920 616e 206f 6666 7365 7420  et by an offset 
-0003f180: 616c 6f6e 6720 6f6e 6520 6f72 206d 6f72  along one or mor
-0003f190: 6520 6469 6d65 6e73 696f 6e73 2e0a 0a20  e dimensions... 
-0003f1a0: 2020 2020 2020 2055 6e6c 696b 6520 7368         Unlike sh
-0003f1b0: 6966 742c 2072 6f6c 6c20 7472 6561 7473  ift, roll treats
-0003f1c0: 2074 6865 2067 6976 656e 2064 696d 656e   the given dimen
-0003f1d0: 7369 6f6e 7320 6173 2070 6572 696f 6469  sions as periodi
-0003f1e0: 632c 2073 6f20 7769 6c6c 206e 6f74 0a20  c, so will not. 
-0003f1f0: 2020 2020 2020 2063 7265 6174 6520 616e         create an
-0003f200: 7920 6d69 7373 696e 6720 7661 6c75 6573  y missing values
-0003f210: 2074 6f20 6265 2066 696c 6c65 642e 0a0a   to be filled...
-0003f220: 2020 2020 2020 2020 416c 736f 2075 6e6c          Also unl
-0003f230: 696b 6520 7368 6966 742c 2072 6f6c 6c20  ike shift, roll 
-0003f240: 6d61 7920 726f 7461 7465 2061 6c6c 2076  may rotate all v
-0003f250: 6172 6961 626c 6573 2c20 696e 636c 7564  ariables, includ
-0003f260: 696e 6720 636f 6f72 6469 6e61 7465 730a  ing coordinates.
-0003f270: 2020 2020 2020 2020 6966 2073 7065 6369          if speci
-0003f280: 6669 6564 2e20 5468 6520 6469 7265 6374  fied. The direct
-0003f290: 696f 6e20 6f66 2072 6f74 6174 696f 6e20  ion of rotation 
-0003f2a0: 6973 2063 6f6e 7369 7374 656e 7420 7769  is consistent wi
-0003f2b0: 7468 0a20 2020 2020 2020 203a 7079 3a66  th.        :py:f
-0003f2c0: 756e 633a 606e 756d 7079 2e72 6f6c 6c60  unc:`numpy.roll`
-0003f2d0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-0003f2e0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-0003f2f0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0003f300: 2073 6869 6674 7320 3a20 6d61 7070 696e   shifts : mappin
-0003f310: 6720 6f66 2068 6173 6861 626c 6520 746f  g of hashable to
-0003f320: 2069 6e74 2c20 6f70 7469 6f6e 616c 0a20   int, optional. 
-0003f330: 2020 2020 2020 2020 2020 2041 2064 6963             A dic
-0003f340: 7420 7769 7468 206b 6579 7320 6d61 7463  t with keys matc
-0003f350: 6869 6e67 2064 696d 656e 7369 6f6e 7320  hing dimensions 
-0003f360: 616e 6420 7661 6c75 6573 2067 6976 656e  and values given
-0003f370: 0a20 2020 2020 2020 2020 2020 2062 7920  .            by 
-0003f380: 696e 7465 6765 7273 2074 6f20 726f 7461  integers to rota
-0003f390: 7465 2065 6163 6820 6f66 2074 6865 2067  te each of the g
-0003f3a0: 6976 656e 2064 696d 656e 7369 6f6e 732e  iven dimensions.
-0003f3b0: 2050 6f73 6974 6976 650a 2020 2020 2020   Positive.      
-0003f3c0: 2020 2020 2020 6f66 6673 6574 7320 726f        offsets ro
-0003f3d0: 6c6c 2074 6f20 7468 6520 7269 6768 743b  ll to the right;
-0003f3e0: 206e 6567 6174 6976 6520 6f66 6673 6574   negative offset
-0003f3f0: 7320 726f 6c6c 2074 6f20 7468 6520 6c65  s roll to the le
-0003f400: 6674 2e0a 2020 2020 2020 2020 726f 6c6c  ft..        roll
-0003f410: 5f63 6f6f 7264 7320 3a20 626f 6f6c 2c20  _coords : bool, 
-0003f420: 6465 6661 756c 743a 2046 616c 7365 0a20  default: False. 
-0003f430: 2020 2020 2020 2020 2020 2049 6e64 6963             Indic
-0003f440: 6174 6573 2077 6865 7468 6572 2074 6f20  ates whether to 
-0003f450: 726f 6c6c 2074 6865 2063 6f6f 7264 696e  roll the coordin
-0003f460: 6174 6573 2062 7920 7468 6520 6f66 6673  ates by the offs
-0003f470: 6574 2074 6f6f 2e0a 2020 2020 2020 2020  et too..        
-0003f480: 2a2a 7368 6966 7473 5f6b 7761 7267 7320  **shifts_kwargs 
-0003f490: 3a20 7b64 696d 3a20 6f66 6673 6574 2c20  : {dim: offset, 
-0003f4a0: 2e2e 2e7d 2c20 6f70 7469 6f6e 616c 0a20  ...}, optional. 
-0003f4b0: 2020 2020 2020 2020 2020 2054 6865 206b             The k
-0003f4c0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-0003f4d0: 2066 6f72 6d20 6f66 2060 6073 6869 6674   form of ``shift
-0003f4e0: 7360 602e 0a20 2020 2020 2020 2020 2020  s``..           
-0003f4f0: 204f 6e65 206f 6620 7368 6966 7473 206f   One of shifts o
-0003f500: 7220 7368 6966 7473 5f6b 7761 7267 7320  r shifts_kwargs 
-0003f510: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
-0003f520: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0003f530: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-0003f540: 2d2d 0a20 2020 2020 2020 2072 6f6c 6c65  --.        rolle
-0003f550: 6420 3a20 4461 7461 7365 740a 2020 2020  d : Dataset.    
-0003f560: 2020 2020 2020 2020 4461 7461 7365 7420          Dataset 
-0003f570: 7769 7468 2074 6865 2073 616d 6520 6174  with the same at
-0003f580: 7472 6962 7574 6573 2062 7574 2072 6f6c  tributes but rol
-0003f590: 6c65 6420 6461 7461 2061 6e64 2063 6f6f  led data and coo
-0003f5a0: 7264 696e 6174 6573 2e0a 0a20 2020 2020  rdinates...     
-0003f5b0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-0003f5c0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0003f5d0: 2020 2020 2073 6869 6674 0a0a 2020 2020       shift..    
-0003f5e0: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
-0003f5f0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-0003f600: 2020 2020 2020 3e3e 3e20 6473 203d 2078        >>> ds = x
-0003f610: 722e 4461 7461 7365 7428 7b22 666f 6f22  r.Dataset({"foo"
-0003f620: 3a20 2822 7822 2c20 6c69 7374 2822 6162  : ("x", list("ab
-0003f630: 6364 6522 2929 7d2c 2063 6f6f 7264 733d  cde"))}, coords=
-0003f640: 7b22 7822 3a20 6e70 2e61 7261 6e67 6528  {"x": np.arange(
-0003f650: 3529 7d29 0a20 2020 2020 2020 203e 3e3e  5)}).        >>>
-0003f660: 2064 732e 726f 6c6c 2878 3d32 290a 2020   ds.roll(x=2).  
-0003f670: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-0003f680: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-0003f690: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
-0003f6a0: 3529 0a20 2020 2020 2020 2043 6f6f 7264  5).        Coord
-0003f6b0: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-0003f6c0: 2020 2a20 7820 2020 2020 2020 2028 7829    * x        (x)
-0003f6d0: 2069 6e74 3634 2030 2031 2032 2033 2034   int64 0 1 2 3 4
-0003f6e0: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-0003f6f0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-0003f700: 2020 2020 2066 6f6f 2020 2020 2020 2878       foo      (x
-0003f710: 2920 3c55 3120 2764 2720 2765 2720 2761  ) <U1 'd' 'e' 'a
-0003f720: 2720 2762 2720 2763 270a 0a20 2020 2020  ' 'b' 'c'..     
-0003f730: 2020 203e 3e3e 2064 732e 726f 6c6c 2878     >>> ds.roll(x
-0003f740: 3d32 2c20 726f 6c6c 5f63 6f6f 7264 733d  =2, roll_coords=
-0003f750: 5472 7565 290a 2020 2020 2020 2020 3c78  True).        <x
-0003f760: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-0003f770: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-0003f780: 733a 2020 2878 3a20 3529 0a20 2020 2020  s:  (x: 5).     
-0003f790: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-0003f7a0: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
-0003f7b0: 2020 2020 2028 7829 2069 6e74 3634 2033       (x) int64 3
-0003f7c0: 2034 2030 2031 2032 0a20 2020 2020 2020   4 0 1 2.       
-0003f7d0: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
-0003f7e0: 0a20 2020 2020 2020 2020 2020 2066 6f6f  .            foo
-0003f7f0: 2020 2020 2020 2878 2920 3c55 3120 2764        (x) <U1 'd
-0003f800: 2720 2765 2720 2761 2720 2762 2720 2763  ' 'e' 'a' 'b' 'c
-0003f810: 270a 0a20 2020 2020 2020 2022 2222 0a20  '..        """. 
-0003f820: 2020 2020 2020 2073 6869 6674 7320 3d20         shifts = 
-0003f830: 6569 7468 6572 5f64 6963 745f 6f72 5f6b  either_dict_or_k
-0003f840: 7761 7267 7328 7368 6966 7473 2c20 7368  wargs(shifts, sh
-0003f850: 6966 7473 5f6b 7761 7267 732c 2022 726f  ifts_kwargs, "ro
-0003f860: 6c6c 2229 0a20 2020 2020 2020 2069 6e76  ll").        inv
-0003f870: 616c 6964 203d 205b 6b20 666f 7220 6b20  alid = [k for k 
-0003f880: 696e 2073 6869 6674 7320 6966 206b 206e  in shifts if k n
-0003f890: 6f74 2069 6e20 7365 6c66 2e64 696d 735d  ot in self.dims]
-0003f8a0: 0a20 2020 2020 2020 2069 6620 696e 7661  .        if inva
-0003f8b0: 6c69 643a 0a20 2020 2020 2020 2020 2020  lid:.           
-0003f8c0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0003f8d0: 7228 6622 6469 6d65 6e73 696f 6e73 207b  r(f"dimensions {
-0003f8e0: 696e 7661 6c69 6421 727d 2064 6f20 6e6f  invalid!r} do no
-0003f8f0: 7420 6578 6973 7422 290a 0a20 2020 2020  t exist")..     
-0003f900: 2020 2075 6e72 6f6c 6c65 645f 7661 7273     unrolled_vars
-0003f910: 3a20 7475 706c 655b 4861 7368 6162 6c65  : tuple[Hashable
-0003f920: 2c20 2e2e 2e5d 0a0a 2020 2020 2020 2020  , ...]..        
-0003f930: 6966 2072 6f6c 6c5f 636f 6f72 6473 3a0a  if roll_coords:.
-0003f940: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-0003f950: 7865 732c 2069 6e64 6578 5f76 6172 7320  xes, index_vars 
-0003f960: 3d20 726f 6c6c 5f69 6e64 6578 6573 2873  = roll_indexes(s
-0003f970: 656c 662e 7869 6e64 6578 6573 2c20 7368  elf.xindexes, sh
-0003f980: 6966 7473 290a 2020 2020 2020 2020 2020  ifts).          
-0003f990: 2020 756e 726f 6c6c 6564 5f76 6172 7320    unrolled_vars 
-0003f9a0: 3d20 2829 0a20 2020 2020 2020 2065 6c73  = ().        els
-0003f9b0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0003f9c0: 6e64 6578 6573 203d 2064 6963 7428 7365  ndexes = dict(se
-0003f9d0: 6c66 2e5f 696e 6465 7865 7329 0a20 2020  lf._indexes).   
-0003f9e0: 2020 2020 2020 2020 2069 6e64 6578 5f76           index_v
-0003f9f0: 6172 7320 3d20 6469 6374 2873 656c 662e  ars = dict(self.
-0003fa00: 7869 6e64 6578 6573 2e76 6172 6961 626c  xindexes.variabl
-0003fa10: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-0003fa20: 756e 726f 6c6c 6564 5f76 6172 7320 3d20  unrolled_vars = 
-0003fa30: 7475 706c 6528 7365 6c66 2e63 6f6f 7264  tuple(self.coord
-0003fa40: 7329 0a0a 2020 2020 2020 2020 7661 7269  s)..        vari
-0003fa50: 6162 6c65 7320 3d20 7b7d 0a20 2020 2020  ables = {}.     
-0003fa60: 2020 2066 6f72 206b 2c20 7661 7220 696e     for k, var in
-0003fa70: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
-0003fa80: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0003fa90: 2020 2020 2069 6620 6b20 696e 2069 6e64       if k in ind
-0003faa0: 6578 5f76 6172 733a 0a20 2020 2020 2020  ex_vars:.       
-0003fab0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-0003fac0: 6573 5b6b 5d20 3d20 696e 6465 785f 7661  es[k] = index_va
-0003fad0: 7273 5b6b 5d0a 2020 2020 2020 2020 2020  rs[k].          
-0003fae0: 2020 656c 6966 206b 206e 6f74 2069 6e20    elif k not in 
-0003faf0: 756e 726f 6c6c 6564 5f76 6172 733a 0a20  unrolled_vars:. 
-0003fb00: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0003fb10: 6172 6961 626c 6573 5b6b 5d20 3d20 7661  ariables[k] = va
-0003fb20: 722e 726f 6c6c 280a 2020 2020 2020 2020  r.roll(.        
-0003fb30: 2020 2020 2020 2020 2020 2020 7368 6966              shif
-0003fb40: 7473 3d7b 6b3a 2073 2066 6f72 206b 2c20  ts={k: s for k, 
-0003fb50: 7320 696e 2073 6869 6674 732e 6974 656d  s in shifts.item
-0003fb60: 7328 2920 6966 206b 2069 6e20 7661 722e  s() if k in var.
-0003fb70: 6469 6d73 7d0a 2020 2020 2020 2020 2020  dims}.          
-0003fb80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0003fb90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0003fba0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-0003fbb0: 6c65 735b 6b5d 203d 2076 6172 0a0a 2020  les[k] = var..  
-0003fbc0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0003fbd0: 662e 5f72 6570 6c61 6365 2876 6172 6961  f._replace(varia
-0003fbe0: 626c 6573 2c20 696e 6465 7865 733d 696e  bles, indexes=in
-0003fbf0: 6465 7865 7329 0a0a 2020 2020 6465 6620  dexes)..    def 
-0003fc00: 736f 7274 6279 280a 2020 2020 2020 2020  sortby(.        
-0003fc10: 7365 6c66 3a20 545f 4461 7461 7365 742c  self: T_Dataset,
-0003fc20: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-0003fc30: 6573 3a20 4861 7368 6162 6c65 207c 2044  es: Hashable | D
-0003fc40: 6174 6141 7272 6179 207c 206c 6973 745b  ataArray | list[
-0003fc50: 4861 7368 6162 6c65 207c 2044 6174 6141  Hashable | DataA
-0003fc60: 7272 6179 5d2c 0a20 2020 2020 2020 2061  rray],.        a
-0003fc70: 7363 656e 6469 6e67 3a20 626f 6f6c 203d  scending: bool =
-0003fc80: 2054 7275 652c 0a20 2020 2029 202d 3e20   True,.    ) -> 
-0003fc90: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
-0003fca0: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
-0003fcb0: 6f72 7420 6f62 6a65 6374 2062 7920 6c61  ort object by la
-0003fcc0: 6265 6c73 206f 7220 7661 6c75 6573 2028  bels or values (
-0003fcd0: 616c 6f6e 6720 616e 2061 7869 7329 2e0a  along an axis)..
-0003fce0: 0a20 2020 2020 2020 2053 6f72 7473 2074  .        Sorts t
-0003fcf0: 6865 2064 6174 6173 6574 2c20 6569 7468  he dataset, eith
-0003fd00: 6572 2061 6c6f 6e67 2073 7065 6369 6669  er along specifi
-0003fd10: 6564 2064 696d 656e 7369 6f6e 732c 0a20  ed dimensions,. 
-0003fd20: 2020 2020 2020 206f 7220 6163 636f 7264         or accord
-0003fd30: 696e 6720 746f 2076 616c 7565 7320 6f66  ing to values of
-0003fd40: 2031 2d44 2064 6174 6161 7272 6179 7320   1-D dataarrays 
-0003fd50: 7468 6174 2073 6861 7265 2064 696d 656e  that share dimen
-0003fd60: 7369 6f6e 0a20 2020 2020 2020 2077 6974  sion.        wit
-0003fd70: 6820 6361 6c6c 696e 6720 6f62 6a65 6374  h calling object
-0003fd80: 2e0a 0a20 2020 2020 2020 2049 6620 7468  ...        If th
-0003fd90: 6520 696e 7075 7420 7661 7269 6162 6c65  e input variable
-0003fda0: 7320 6172 6520 6461 7461 6172 7261 7973  s are dataarrays
-0003fdb0: 2c20 7468 656e 2074 6865 2064 6174 6161  , then the dataa
-0003fdc0: 7272 6179 7320 6172 6520 616c 6967 6e65  rrays are aligne
-0003fdd0: 640a 2020 2020 2020 2020 2876 6961 206c  d.        (via l
-0003fde0: 6566 742d 6a6f 696e 2920 746f 2074 6865  eft-join) to the
-0003fdf0: 2063 616c 6c69 6e67 206f 626a 6563 7420   calling object 
-0003fe00: 7072 696f 7220 746f 2073 6f72 7469 6e67  prior to sorting
-0003fe10: 2062 7920 6365 6c6c 2076 616c 7565 732e   by cell values.
-0003fe20: 0a20 2020 2020 2020 204e 614e 7320 6172  .        NaNs ar
-0003fe30: 6520 736f 7274 6564 2074 6f20 7468 6520  e sorted to the 
-0003fe40: 656e 642c 2066 6f6c 6c6f 7769 6e67 204e  end, following N
-0003fe50: 756d 7079 2063 6f6e 7665 6e74 696f 6e2e  umpy convention.
-0003fe60: 0a0a 2020 2020 2020 2020 4966 206d 756c  ..        If mul
-0003fe70: 7469 706c 6520 736f 7274 7320 616c 6f6e  tiple sorts alon
-0003fe80: 6720 7468 6520 7361 6d65 2064 696d 656e  g the same dimen
-0003fe90: 7369 6f6e 2069 730a 2020 2020 2020 2020  sion is.        
-0003fea0: 6769 7665 6e2c 206e 756d 7079 2773 206c  given, numpy's l
-0003feb0: 6578 736f 7274 2069 7320 7065 7266 6f72  exsort is perfor
-0003fec0: 6d65 6420 616c 6f6e 6720 7468 6174 2064  med along that d
-0003fed0: 696d 656e 7369 6f6e 3a0a 2020 2020 2020  imension:.      
-0003fee0: 2020 6874 7470 733a 2f2f 6e75 6d70 792e    https://numpy.
-0003fef0: 6f72 672f 646f 632f 7374 6162 6c65 2f72  org/doc/stable/r
-0003ff00: 6566 6572 656e 6365 2f67 656e 6572 6174  eference/generat
-0003ff10: 6564 2f6e 756d 7079 2e6c 6578 736f 7274  ed/numpy.lexsort
-0003ff20: 2e68 746d 6c0a 2020 2020 2020 2020 616e  .html.        an
-0003ff30: 6420 7468 6520 4649 5253 5420 6b65 7920  d the FIRST key 
-0003ff40: 696e 2074 6865 2073 6571 7565 6e63 6520  in the sequence 
-0003ff50: 6973 2075 7365 6420 6173 2074 6865 2070  is used as the p
-0003ff60: 7269 6d61 7279 2073 6f72 7420 6b65 792c  rimary sort key,
-0003ff70: 0a20 2020 2020 2020 2066 6f6c 6c6f 7765  .        followe
-0003ff80: 6420 6279 2074 6865 2032 6e64 206b 6579  d by the 2nd key
-0003ff90: 2c20 6574 632e 0a0a 2020 2020 2020 2020  , etc...        
-0003ffa0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0003ffb0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0003ffc0: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
-0003ffd0: 3a20 4861 7368 6162 6c65 2c20 4461 7461  : Hashable, Data
-0003ffe0: 4172 7261 792c 206f 7220 6c69 7374 206f  Array, or list o
-0003fff0: 6620 6861 7368 6162 6c65 206f 7220 4461  f hashable or Da
-00040000: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
-00040010: 2020 2020 3144 2044 6174 6141 7272 6179      1D DataArray
-00040020: 206f 626a 6563 7473 206f 7220 6e61 6d65   objects or name
-00040030: 2873 2920 6f66 2031 4420 7661 7269 6162  (s) of 1D variab
-00040040: 6c65 2873 2920 696e 0a20 2020 2020 2020  le(s) in.       
-00040050: 2020 2020 2063 6f6f 7264 732f 6461 7461       coords/data
-00040060: 5f76 6172 7320 7768 6f73 6520 7661 6c75  _vars whose valu
-00040070: 6573 2061 7265 2075 7365 6420 746f 2073  es are used to s
-00040080: 6f72 7420 7468 6520 6461 7461 7365 742e  ort the dataset.
-00040090: 0a20 2020 2020 2020 2061 7363 656e 6469  .        ascendi
-000400a0: 6e67 203a 2062 6f6f 6c2c 2064 6566 6175  ng : bool, defau
-000400b0: 6c74 3a20 5472 7565 0a20 2020 2020 2020  lt: True.       
-000400c0: 2020 2020 2057 6865 7468 6572 2074 6f20       Whether to 
-000400d0: 736f 7274 2062 7920 6173 6365 6e64 696e  sort by ascendin
-000400e0: 6720 6f72 2064 6573 6365 6e64 696e 6720  g or descending 
-000400f0: 6f72 6465 722e 0a0a 2020 2020 2020 2020  order...        
-00040100: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-00040110: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00040120: 736f 7274 6564 203a 2044 6174 6173 6574  sorted : Dataset
-00040130: 0a20 2020 2020 2020 2020 2020 2041 206e  .            A n
-00040140: 6577 2064 6174 6173 6574 2077 6865 7265  ew dataset where
-00040150: 2061 6c6c 2074 6865 2073 7065 6369 6669   all the specifi
-00040160: 6564 2064 696d 7320 6172 6520 736f 7274  ed dims are sort
-00040170: 6564 2062 7920 6469 6d0a 2020 2020 2020  ed by dim.      
-00040180: 2020 2020 2020 6c61 6265 6c73 2e0a 0a20        labels... 
-00040190: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-000401a0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000401b0: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-000401c0: 6179 2e73 6f72 7462 790a 2020 2020 2020  ay.sortby.      
-000401d0: 2020 6e75 6d70 792e 736f 7274 0a20 2020    numpy.sort.   
-000401e0: 2020 2020 2070 616e 6461 732e 736f 7274       pandas.sort
-000401f0: 5f76 616c 7565 730a 2020 2020 2020 2020  _values.        
-00040200: 7061 6e64 6173 2e73 6f72 745f 696e 6465  pandas.sort_inde
-00040210: 780a 0a20 2020 2020 2020 2045 7861 6d70  x..        Examp
-00040220: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
-00040230: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
-00040240: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
-00040250: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
-00040260: 2020 7b0a 2020 2020 2020 2020 2e2e 2e20    {.        ... 
-00040270: 2020 2020 2020 2020 2241 223a 2028 2822          "A": (("
-00040280: 7822 2c20 2279 2229 2c20 5b5b 312c 2032  x", "y"), [[1, 2
-00040290: 5d2c 205b 332c 2034 5d5d 292c 0a20 2020  ], [3, 4]]),.   
-000402a0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
-000402b0: 2022 4222 3a20 2828 2278 222c 2022 7922   "B": (("x", "y"
-000402c0: 292c 205b 5b35 2c20 365d 2c20 5b37 2c20  ), [[5, 6], [7, 
-000402d0: 385d 5d29 2c0a 2020 2020 2020 2020 2e2e  8]]),.        ..
-000402e0: 2e20 2020 2020 7d2c 0a20 2020 2020 2020  .     },.       
-000402f0: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
-00040300: 7b22 7822 3a20 5b22 6222 2c20 2261 225d  {"x": ["b", "a"]
-00040310: 2c20 2279 223a 205b 312c 2030 5d7d 2c0a  , "y": [1, 0]},.
-00040320: 2020 2020 2020 2020 2e2e 2e20 290a 2020          ... ).  
-00040330: 2020 2020 2020 3e3e 3e20 6473 203d 2064        >>> ds = d
-00040340: 732e 736f 7274 6279 2822 7822 290a 2020  s.sortby("x").  
-00040350: 2020 2020 2020 3e3e 3e20 6473 0a20 2020        >>> ds.   
-00040360: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-00040370: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
-00040380: 6d65 6e73 696f 6e73 3a20 2028 783a 2032  mensions:  (x: 2
-00040390: 2c20 793a 2032 290a 2020 2020 2020 2020  , y: 2).        
-000403a0: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
-000403b0: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
-000403c0: 2020 2878 2920 3c55 3120 2761 2720 2762    (x) <U1 'a' 'b
-000403d0: 270a 2020 2020 2020 2020 2020 2a20 7920  '.          * y 
-000403e0: 2020 2020 2020 2028 7929 2069 6e74 3634         (y) int64
-000403f0: 2031 2030 0a20 2020 2020 2020 2044 6174   1 0.        Dat
-00040400: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-00040410: 2020 2020 2020 2020 2041 2020 2020 2020           A      
-00040420: 2020 2878 2c20 7929 2069 6e74 3634 2033    (x, y) int64 3
-00040430: 2034 2031 2032 0a20 2020 2020 2020 2020   4 1 2.         
-00040440: 2020 2042 2020 2020 2020 2020 2878 2c20     B        (x, 
-00040450: 7929 2069 6e74 3634 2037 2038 2035 2036  y) int64 7 8 5 6
-00040460: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00040470: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
-00040480: 2e63 6f72 652e 6461 7461 6172 7261 7920  .core.dataarray 
-00040490: 696d 706f 7274 2044 6174 6141 7272 6179  import DataArray
-000404a0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-000404b0: 2069 7369 6e73 7461 6e63 6528 7661 7269   isinstance(vari
-000404c0: 6162 6c65 732c 206c 6973 7429 3a0a 2020  ables, list):.  
-000404d0: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-000404e0: 6c65 7320 3d20 5b76 6172 6961 626c 6573  les = [variables
-000404f0: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-00040500: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-00040510: 6162 6c65 7320 3d20 7661 7269 6162 6c65  ables = variable
-00040520: 730a 2020 2020 2020 2020 6172 7261 7973  s.        arrays
-00040530: 203d 205b 7620 6966 2069 7369 6e73 7461   = [v if isinsta
-00040540: 6e63 6528 762c 2044 6174 6141 7272 6179  nce(v, DataArray
-00040550: 2920 656c 7365 2073 656c 665b 765d 2066  ) else self[v] f
-00040560: 6f72 2076 2069 6e20 7661 7269 6162 6c65  or v in variable
-00040570: 735d 0a20 2020 2020 2020 2061 6c69 676e  s].        align
-00040580: 6564 5f76 6172 7320 3d20 616c 6967 6e28  ed_vars = align(
-00040590: 7365 6c66 2c20 2a61 7272 6179 732c 206a  self, *arrays, j
-000405a0: 6f69 6e3d 226c 6566 7422 2920 2023 2074  oin="left")  # t
-000405b0: 7970 653a 2069 676e 6f72 655b 7479 7065  ype: ignore[type
-000405c0: 2d76 6172 5d0a 2020 2020 2020 2020 616c  -var].        al
-000405d0: 6967 6e65 645f 7365 6c66 3a20 545f 4461  igned_self: T_Da
-000405e0: 7461 7365 7420 3d20 616c 6967 6e65 645f  taset = aligned_
-000405f0: 7661 7273 5b30 5d20 2023 2074 7970 653a  vars[0]  # type:
-00040600: 2069 676e 6f72 655b 6173 7369 676e 6d65   ignore[assignme
-00040610: 6e74 5d0a 2020 2020 2020 2020 616c 6967  nt].        alig
-00040620: 6e65 645f 6f74 6865 725f 7661 7273 3a20  ned_other_vars: 
-00040630: 7475 706c 655b 4461 7461 4172 7261 792c  tuple[DataArray,
-00040640: 202e 2e2e 5d20 3d20 616c 6967 6e65 645f   ...] = aligned_
-00040650: 7661 7273 5b31 3a5d 2020 2320 7479 7065  vars[1:]  # type
-00040660: 3a20 6967 6e6f 7265 5b61 7373 6967 6e6d  : ignore[assignm
-00040670: 656e 745d 0a20 2020 2020 2020 2076 6172  ent].        var
-00040680: 735f 6279 5f64 696d 203d 2064 6566 6175  s_by_dim = defau
-00040690: 6c74 6469 6374 286c 6973 7429 0a20 2020  ltdict(list).   
-000406a0: 2020 2020 2066 6f72 2064 6174 615f 6172       for data_ar
-000406b0: 7261 7920 696e 2061 6c69 676e 6564 5f6f  ray in aligned_o
-000406c0: 7468 6572 5f76 6172 733a 0a20 2020 2020  ther_vars:.     
-000406d0: 2020 2020 2020 2069 6620 6461 7461 5f61         if data_a
-000406e0: 7272 6179 2e6e 6469 6d20 213d 2031 3a0a  rray.ndim != 1:.
-000406f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040700: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00040710: 2822 496e 7075 7420 4461 7461 4172 7261  ("Input DataArra
-00040720: 7920 6973 206e 6f74 2031 2d44 2e22 290a  y is not 1-D.").
-00040730: 2020 2020 2020 2020 2020 2020 286b 6579              (key
-00040740: 2c29 203d 2064 6174 615f 6172 7261 792e  ,) = data_array.
-00040750: 6469 6d73 0a20 2020 2020 2020 2020 2020  dims.           
-00040760: 2076 6172 735f 6279 5f64 696d 5b6b 6579   vars_by_dim[key
-00040770: 5d2e 6170 7065 6e64 2864 6174 615f 6172  ].append(data_ar
-00040780: 7261 7929 0a0a 2020 2020 2020 2020 696e  ray)..        in
-00040790: 6469 6365 7320 3d20 7b7d 0a20 2020 2020  dices = {}.     
-000407a0: 2020 2066 6f72 206b 6579 2c20 6172 7261     for key, arra
-000407b0: 7973 2069 6e20 7661 7273 5f62 795f 6469  ys in vars_by_di
-000407c0: 6d2e 6974 656d 7328 293a 0a20 2020 2020  m.items():.     
-000407d0: 2020 2020 2020 206f 7264 6572 203d 206e         order = n
-000407e0: 702e 6c65 7873 6f72 7428 7475 706c 6528  p.lexsort(tuple(
-000407f0: 7265 7665 7273 6564 2861 7272 6179 7329  reversed(arrays)
-00040800: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
-00040810: 6e64 6963 6573 5b6b 6579 5d20 3d20 6f72  ndices[key] = or
-00040820: 6465 7220 6966 2061 7363 656e 6469 6e67  der if ascending
-00040830: 2065 6c73 6520 6f72 6465 725b 3a3a 2d31   else order[::-1
-00040840: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-00040850: 2061 6c69 676e 6564 5f73 656c 662e 6973   aligned_self.is
-00040860: 656c 2869 6e64 6963 6573 290a 0a20 2020  el(indices)..   
-00040870: 2064 6566 2071 7561 6e74 696c 6528 0a20   def quantile(. 
-00040880: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
-00040890: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
-000408a0: 713a 2041 7272 6179 4c69 6b65 2c0a 2020  q: ArrayLike,.  
-000408b0: 2020 2020 2020 6469 6d3a 2044 696d 7320        dim: Dims 
-000408c0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000408d0: 6d65 7468 6f64 3a20 5175 616e 7469 6c65  method: Quantile
-000408e0: 4d65 7468 6f64 7320 3d20 226c 696e 6561  Methods = "linea
-000408f0: 7222 2c0a 2020 2020 2020 2020 6e75 6d65  r",.        nume
-00040900: 7269 635f 6f6e 6c79 3a20 626f 6f6c 203d  ric_only: bool =
-00040910: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00040920: 6b65 6570 5f61 7474 7273 3a20 626f 6f6c  keep_attrs: bool
-00040930: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00040940: 2020 2020 2020 2020 736b 6970 6e61 3a20          skipna: 
-00040950: 626f 6f6c 207c 204e 6f6e 6520 3d20 4e6f  bool | None = No
-00040960: 6e65 2c0a 2020 2020 2020 2020 696e 7465  ne,.        inte
-00040970: 7270 6f6c 6174 696f 6e3a 2051 7561 6e74  rpolation: Quant
-00040980: 696c 654d 6574 686f 6473 207c 204e 6f6e  ileMethods | Non
-00040990: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
-000409a0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-000409b0: 2020 2020 2020 2222 2243 6f6d 7075 7465        """Compute
-000409c0: 2074 6865 2071 7468 2071 7561 6e74 696c   the qth quantil
-000409d0: 6520 6f66 2074 6865 2064 6174 6120 616c  e of the data al
-000409e0: 6f6e 6720 7468 6520 7370 6563 6966 6965  ong the specifie
-000409f0: 6420 6469 6d65 6e73 696f 6e2e 0a0a 2020  d dimension...  
-00040a00: 2020 2020 2020 5265 7475 726e 7320 7468        Returns th
-00040a10: 6520 7174 6820 7175 616e 7469 6c65 7328  e qth quantiles(
-00040a20: 7329 206f 6620 7468 6520 6172 7261 7920  s) of the array 
-00040a30: 656c 656d 656e 7473 2066 6f72 2065 6163  elements for eac
-00040a40: 6820 7661 7269 6162 6c65 0a20 2020 2020  h variable.     
-00040a50: 2020 2069 6e20 7468 6520 4461 7461 7365     in the Datase
-00040a60: 742e 0a0a 2020 2020 2020 2020 5061 7261  t...        Para
-00040a70: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00040a80: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00040a90: 2020 7120 3a20 666c 6f61 7420 6f72 2061    q : float or a
-00040aa0: 7272 6179 2d6c 696b 6520 6f66 2066 6c6f  rray-like of flo
-00040ab0: 6174 0a20 2020 2020 2020 2020 2020 2051  at.            Q
-00040ac0: 7561 6e74 696c 6520 746f 2063 6f6d 7075  uantile to compu
-00040ad0: 7465 2c20 7768 6963 6820 6d75 7374 2062  te, which must b
-00040ae0: 6520 6265 7477 6565 6e20 3020 616e 6420  e between 0 and 
-00040af0: 3120 696e 636c 7573 6976 652e 0a20 2020  1 inclusive..   
-00040b00: 2020 2020 2064 696d 203a 2073 7472 206f       dim : str o
-00040b10: 7220 4974 6572 6162 6c65 206f 6620 4861  r Iterable of Ha
-00040b20: 7368 6162 6c65 2c20 6f70 7469 6f6e 616c  shable, optional
-00040b30: 0a20 2020 2020 2020 2020 2020 2044 696d  .            Dim
-00040b40: 656e 7369 6f6e 2873 2920 6f76 6572 2077  ension(s) over w
-00040b50: 6869 6368 2074 6f20 6170 706c 7920 7175  hich to apply qu
-00040b60: 616e 7469 6c65 2e0a 2020 2020 2020 2020  antile..        
-00040b70: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
-00040b80: 6661 756c 743a 2022 6c69 6e65 6172 220a  fault: "linear".
-00040b90: 2020 2020 2020 2020 2020 2020 5468 6973              This
-00040ba0: 206f 7074 696f 6e61 6c20 7061 7261 6d65   optional parame
-00040bb0: 7465 7220 7370 6563 6966 6965 7320 7468  ter specifies th
-00040bc0: 6520 696e 7465 7270 6f6c 6174 696f 6e20  e interpolation 
-00040bd0: 6d65 7468 6f64 2074 6f20 7573 6520 7768  method to use wh
-00040be0: 656e 2074 6865 0a20 2020 2020 2020 2020  en the.         
-00040bf0: 2020 2064 6573 6972 6564 2071 7561 6e74     desired quant
-00040c00: 696c 6520 6c69 6573 2062 6574 7765 656e  ile lies between
-00040c10: 2074 776f 2064 6174 6120 706f 696e 7473   two data points
-00040c20: 2e20 5468 6520 6f70 7469 6f6e 7320 736f  . The options so
-00040c30: 7274 6564 2062 7920 7468 6569 7220 520a  rted by their R.
-00040c40: 2020 2020 2020 2020 2020 2020 7479 7065              type
-00040c50: 2061 7320 7375 6d6d 6172 697a 6564 2069   as summarized i
-00040c60: 6e20 7468 6520 4826 4620 7061 7065 7220  n the H&F paper 
-00040c70: 5b31 5d5f 2061 7265 3a0a 0a20 2020 2020  [1]_ are:..     
-00040c80: 2020 2020 2020 2020 2020 2031 2e20 2269             1. "i
-00040c90: 6e76 6572 7465 645f 6364 6622 2028 2a29  nverted_cdf" (*)
-00040ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00040cb0: 2032 2e20 2261 7665 7261 6765 645f 696e   2. "averaged_in
-00040cc0: 7665 7274 6564 5f63 6466 2220 282a 290a  verted_cdf" (*).
-00040cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040ce0: 332e 2022 636c 6f73 6573 745f 6f62 7365  3. "closest_obse
-00040cf0: 7276 6174 696f 6e22 2028 2a29 0a20 2020  rvation" (*).   
-00040d00: 2020 2020 2020 2020 2020 2020 2034 2e20               4. 
-00040d10: 2269 6e74 6572 706f 6c61 7465 645f 696e  "interpolated_in
-00040d20: 7665 7274 6564 5f63 6466 2220 282a 290a  verted_cdf" (*).
-00040d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040d40: 352e 2022 6861 7a65 6e22 2028 2a29 0a20  5. "hazen" (*). 
-00040d50: 2020 2020 2020 2020 2020 2020 2020 2036                 6
-00040d60: 2e20 2277 6569 6275 6c6c 2220 282a 290a  . "weibull" (*).
-00040d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040d80: 372e 2022 6c69 6e65 6172 2220 2028 6465  7. "linear"  (de
-00040d90: 6661 756c 7429 0a20 2020 2020 2020 2020  fault).         
-00040da0: 2020 2020 2020 2038 2e20 226d 6564 6961         8. "media
-00040db0: 6e5f 756e 6269 6173 6564 2220 282a 290a  n_unbiased" (*).
-00040dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040dd0: 392e 2022 6e6f 726d 616c 5f75 6e62 6961  9. "normal_unbia
-00040de0: 7365 6422 2028 2a29 0a0a 2020 2020 2020  sed" (*)..      
-00040df0: 2020 2020 2020 5468 6520 6669 7273 7420        The first 
-00040e00: 7468 7265 6520 6d65 7468 6f64 7320 6172  three methods ar
-00040e10: 6520 6469 7363 6f6e 7469 756f 7573 2e20  e discontiuous. 
-00040e20: 2054 6865 2066 6f6c 6c6f 7769 6e67 2064   The following d
-00040e30: 6973 636f 6e74 696e 756f 7573 0a20 2020  iscontinuous.   
-00040e40: 2020 2020 2020 2020 2076 6172 6961 7469           variati
-00040e50: 6f6e 7320 6f66 2074 6865 2064 6566 6175  ons of the defau
-00040e60: 6c74 2022 6c69 6e65 6172 2220 2837 2e29  lt "linear" (7.)
-00040e70: 206f 7074 696f 6e20 6172 6520 616c 736f   option are also
-00040e80: 2061 7661 696c 6162 6c65 3a0a 0a20 2020   available:..   
-00040e90: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00040ea0: 6c6f 7765 7222 0a20 2020 2020 2020 2020  lower".         
-00040eb0: 2020 2020 2020 202a 2022 6869 6768 6572         * "higher
-00040ec0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00040ed0: 2020 2a20 226d 6964 706f 696e 7422 0a20    * "midpoint". 
-00040ee0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00040ef0: 2022 6e65 6172 6573 7422 0a0a 2020 2020   "nearest"..    
-00040f00: 2020 2020 2020 2020 5365 6520 3a70 793a          See :py:
-00040f10: 6675 6e63 3a60 6e75 6d70 792e 7175 616e  func:`numpy.quan
-00040f20: 7469 6c65 6020 6f72 205b 315d 5f20 666f  tile` or [1]_ fo
-00040f30: 7220 6465 7461 696c 732e 2054 6865 2022  r details. The "
-00040f40: 6d65 7468 6f64 2220 6172 6775 6d65 6e74  method" argument
-00040f50: 0a20 2020 2020 2020 2020 2020 2077 6173  .            was
-00040f60: 2070 7265 7669 6f75 736c 7920 6361 6c6c   previously call
-00040f70: 6564 2022 696e 7465 7270 6f6c 6174 696f  ed "interpolatio
-00040f80: 6e22 2c20 7265 6e61 6d65 6420 696e 2061  n", renamed in a
-00040f90: 6363 6f72 6461 6e63 6520 7769 7468 206e  ccordance with n
-00040fa0: 756d 7079 0a20 2020 2020 2020 2020 2020  umpy.           
-00040fb0: 2076 6572 7369 6f6e 2031 2e32 322e 302e   version 1.22.0.
-00040fc0: 0a0a 2020 2020 2020 2020 2020 2020 282a  ..            (*
-00040fd0: 2920 5468 6573 6520 6d65 7468 6f64 7320  ) These methods 
-00040fe0: 7265 7175 6972 6520 6e75 6d70 7920 7665  require numpy ve
-00040ff0: 7273 696f 6e20 312e 3232 206f 7220 6e65  rsion 1.22 or ne
-00041000: 7765 722e 0a0a 2020 2020 2020 2020 6b65  wer...        ke
-00041010: 6570 5f61 7474 7273 203a 2062 6f6f 6c2c  ep_attrs : bool,
-00041020: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00041030: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-00041040: 6865 2064 6174 6173 6574 2773 2061 7474  he dataset's att
-00041050: 7269 6275 7465 7320 2860 6174 7472 7360  ributes (`attrs`
-00041060: 2920 7769 6c6c 2062 6520 636f 7069 6564  ) will be copied
-00041070: 2066 726f 6d0a 2020 2020 2020 2020 2020   from.          
-00041080: 2020 7468 6520 6f72 6967 696e 616c 206f    the original o
-00041090: 626a 6563 7420 746f 2074 6865 206e 6577  bject to the new
-000410a0: 206f 6e65 2e20 2049 6620 4661 6c73 6520   one.  If False 
-000410b0: 2864 6566 6175 6c74 292c 2074 6865 206e  (default), the n
-000410c0: 6577 0a20 2020 2020 2020 2020 2020 206f  ew.            o
-000410d0: 626a 6563 7420 7769 6c6c 2062 6520 7265  bject will be re
-000410e0: 7475 726e 6564 2077 6974 686f 7574 2061  turned without a
-000410f0: 7474 7269 6275 7465 732e 0a20 2020 2020  ttributes..     
-00041100: 2020 206e 756d 6572 6963 5f6f 6e6c 7920     numeric_only 
-00041110: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
-00041120: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00041130: 5472 7565 2c20 6f6e 6c79 2061 7070 6c79  True, only apply
-00041140: 2060 6066 756e 6360 6020 746f 2076 6172   ``func`` to var
-00041150: 6961 626c 6573 2077 6974 6820 6120 6e75  iables with a nu
-00041160: 6d65 7269 6320 6474 7970 652e 0a20 2020  meric dtype..   
-00041170: 2020 2020 2073 6b69 706e 6120 3a20 626f       skipna : bo
-00041180: 6f6c 2c20 6f70 7469 6f6e 616c 0a20 2020  ol, optional.   
-00041190: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-000411a0: 2c20 736b 6970 206d 6973 7369 6e67 2076  , skip missing v
-000411b0: 616c 7565 7320 2861 7320 6d61 726b 6564  alues (as marked
-000411c0: 2062 7920 4e61 4e29 2e20 4279 2064 6566   by NaN). By def
-000411d0: 6175 6c74 2c20 6f6e 6c79 0a20 2020 2020  ault, only.     
-000411e0: 2020 2020 2020 2073 6b69 7073 206d 6973         skips mis
-000411f0: 7369 6e67 2076 616c 7565 7320 666f 7220  sing values for 
-00041200: 666c 6f61 7420 6474 7970 6573 3b20 6f74  float dtypes; ot
-00041210: 6865 7220 6474 7970 6573 2065 6974 6865  her dtypes eithe
-00041220: 7220 646f 206e 6f74 0a20 2020 2020 2020  r do not.       
-00041230: 2020 2020 2068 6176 6520 6120 7365 6e74       have a sent
-00041240: 696e 656c 206d 6973 7369 6e67 2076 616c  inel missing val
-00041250: 7565 2028 696e 7429 206f 7220 736b 6970  ue (int) or skip
-00041260: 6e61 3d54 7275 6520 6861 7320 6e6f 7420  na=True has not 
-00041270: 6265 656e 0a20 2020 2020 2020 2020 2020  been.           
-00041280: 2069 6d70 6c65 6d65 6e74 6564 2028 6f62   implemented (ob
-00041290: 6a65 6374 2c20 6461 7465 7469 6d65 3634  ject, datetime64
-000412a0: 206f 7220 7469 6d65 6465 6c74 6136 3429   or timedelta64)
-000412b0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-000412c0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-000412d0: 2d2d 0a20 2020 2020 2020 2071 7561 6e74  --.        quant
-000412e0: 696c 6573 203a 2044 6174 6173 6574 0a20  iles : Dataset. 
-000412f0: 2020 2020 2020 2020 2020 2049 6620 6071             If `q
-00041300: 6020 6973 2061 2073 696e 676c 6520 7175  ` is a single qu
-00041310: 616e 7469 6c65 2c20 7468 656e 2074 6865  antile, then the
-00041320: 2072 6573 756c 7420 6973 2061 2073 6361   result is a sca
-00041330: 6c61 7220 666f 7220 6561 6368 0a20 2020  lar for each.   
-00041340: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00041350: 6520 696e 2064 6174 615f 7661 7273 2e20  e in data_vars. 
-00041360: 4966 206d 756c 7469 706c 6520 7065 7263  If multiple perc
-00041370: 656e 7469 6c65 7320 6172 6520 6769 7665  entiles are give
-00041380: 6e2c 2066 6972 7374 0a20 2020 2020 2020  n, first.       
-00041390: 2020 2020 2061 7869 7320 6f66 2074 6865       axis of the
-000413a0: 2072 6573 756c 7420 636f 7272 6573 706f   result correspo
-000413b0: 6e64 7320 746f 2074 6865 2071 7561 6e74  nds to the quant
-000413c0: 696c 6520 616e 6420 6120 7175 616e 7469  ile and a quanti
-000413d0: 6c65 0a20 2020 2020 2020 2020 2020 2064  le.            d
-000413e0: 696d 656e 7369 6f6e 2069 7320 6164 6465  imension is adde
-000413f0: 6420 746f 2074 6865 2072 6574 7572 6e20  d to the return 
-00041400: 4461 7461 7365 742e 2054 6865 206f 7468  Dataset. The oth
-00041410: 6572 2064 696d 656e 7369 6f6e 7320 6172  er dimensions ar
-00041420: 650a 2020 2020 2020 2020 2020 2020 7468  e.            th
-00041430: 6520 6469 6d65 6e73 696f 6e73 2074 6861  e dimensions tha
-00041440: 7420 7265 6d61 696e 2061 6674 6572 2074  t remain after t
-00041450: 6865 2072 6564 7563 7469 6f6e 206f 6620  he reduction of 
-00041460: 7468 6520 6172 7261 792e 0a0a 2020 2020  the array...    
-00041470: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00041480: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00041490: 2020 2020 2020 6e75 6d70 792e 6e61 6e71        numpy.nanq
-000414a0: 7561 6e74 696c 652c 206e 756d 7079 2e71  uantile, numpy.q
-000414b0: 7561 6e74 696c 652c 2070 616e 6461 732e  uantile, pandas.
-000414c0: 5365 7269 6573 2e71 7561 6e74 696c 652c  Series.quantile,
-000414d0: 2044 6174 6141 7272 6179 2e71 7561 6e74   DataArray.quant
-000414e0: 696c 650a 0a20 2020 2020 2020 2045 7861  ile..        Exa
-000414f0: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
-00041500: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
-00041510: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
-00041520: 6574 280a 2020 2020 2020 2020 2e2e 2e20  et(.        ... 
-00041530: 2020 2020 7b22 6122 3a20 2828 2278 222c      {"a": (("x",
-00041540: 2022 7922 292c 205b 5b30 2e37 2c20 342e   "y"), [[0.7, 4.
-00041550: 322c 2039 2e34 2c20 312e 355d 2c20 5b36  2, 9.4, 1.5], [6
-00041560: 2e35 2c20 372e 332c 2032 2e36 2c20 312e  .5, 7.3, 2.6, 1.
-00041570: 395d 5d29 7d2c 0a20 2020 2020 2020 202e  9]])},.        .
-00041580: 2e2e 2020 2020 2063 6f6f 7264 733d 7b22  ..     coords={"
-00041590: 7822 3a20 5b37 2c20 395d 2c20 2279 223a  x": [7, 9], "y":
-000415a0: 205b 312c 2031 2e35 2c20 322c 2032 2e35   [1, 1.5, 2, 2.5
-000415b0: 5d7d 2c0a 2020 2020 2020 2020 2e2e 2e20  ]},.        ... 
-000415c0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
-000415d0: 2e71 7561 6e74 696c 6528 3029 2020 2320  .quantile(0)  # 
-000415e0: 6f72 2064 732e 7175 616e 7469 6c65 2830  or ds.quantile(0
-000415f0: 2c20 6469 6d3d 2e2e 2e29 0a20 2020 2020  , dim=...).     
-00041600: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-00041610: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-00041620: 6e73 696f 6e73 3a20 2020 2829 0a20 2020  nsions:   ().   
-00041630: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
-00041640: 3a0a 2020 2020 2020 2020 2020 2020 7175  :.            qu
-00041650: 616e 7469 6c65 2020 666c 6f61 7436 3420  antile  float64 
-00041660: 302e 300a 2020 2020 2020 2020 4461 7461  0.0.        Data
-00041670: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-00041680: 2020 2020 2020 2020 6120 2020 2020 2020          a       
-00041690: 2020 666c 6f61 7436 3420 302e 370a 2020    float64 0.7.  
-000416a0: 2020 2020 2020 3e3e 3e20 6473 2e71 7561        >>> ds.qua
-000416b0: 6e74 696c 6528 302c 2064 696d 3d22 7822  ntile(0, dim="x"
-000416c0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-000416d0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-000416e0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-000416f0: 2028 793a 2034 290a 2020 2020 2020 2020   (y: 4).        
-00041700: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
-00041710: 2020 2020 2020 202a 2079 2020 2020 2020         * y      
-00041720: 2020 2028 7929 2066 6c6f 6174 3634 2031     (y) float64 1
-00041730: 2e30 2031 2e35 2032 2e30 2032 2e35 0a20  .0 1.5 2.0 2.5. 
-00041740: 2020 2020 2020 2020 2020 2071 7561 6e74             quant
-00041750: 696c 6520 2066 6c6f 6174 3634 2030 2e30  ile  float64 0.0
-00041760: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-00041770: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-00041780: 2020 2020 2061 2020 2020 2020 2020 2028       a         (
-00041790: 7929 2066 6c6f 6174 3634 2030 2e37 2034  y) float64 0.7 4
-000417a0: 2e32 2032 2e36 2031 2e35 0a20 2020 2020  .2 2.6 1.5.     
-000417b0: 2020 203e 3e3e 2064 732e 7175 616e 7469     >>> ds.quanti
-000417c0: 6c65 285b 302c 2030 2e35 2c20 315d 290a  le([0, 0.5, 1]).
-000417d0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-000417e0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-000417f0: 2044 696d 656e 7369 6f6e 733a 2020 2028   Dimensions:   (
-00041800: 7175 616e 7469 6c65 3a20 3329 0a20 2020  quantile: 3).   
-00041810: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
-00041820: 3a0a 2020 2020 2020 2020 2020 2a20 7175  :.          * qu
-00041830: 616e 7469 6c65 2020 2871 7561 6e74 696c  antile  (quantil
-00041840: 6529 2066 6c6f 6174 3634 2030 2e30 2030  e) float64 0.0 0
-00041850: 2e35 2031 2e30 0a20 2020 2020 2020 2044  .5 1.0.        D
-00041860: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
-00041870: 2020 2020 2020 2020 2020 2061 2020 2020             a    
-00041880: 2020 2020 2028 7175 616e 7469 6c65 2920       (quantile) 
-00041890: 666c 6f61 7436 3420 302e 3720 332e 3420  float64 0.7 3.4 
-000418a0: 392e 340a 2020 2020 2020 2020 3e3e 3e20  9.4.        >>> 
-000418b0: 6473 2e71 7561 6e74 696c 6528 5b30 2c20  ds.quantile([0, 
-000418c0: 302e 352c 2031 5d2c 2064 696d 3d22 7822  0.5, 1], dim="x"
-000418d0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-000418e0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-000418f0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-00041900: 2028 7175 616e 7469 6c65 3a20 332c 2079   (quantile: 3, y
-00041910: 3a20 3429 0a20 2020 2020 2020 2043 6f6f  : 4).        Coo
-00041920: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-00041930: 2020 2020 2a20 7920 2020 2020 2020 2020      * y         
-00041940: 2879 2920 666c 6f61 7436 3420 312e 3020  (y) float64 1.0 
-00041950: 312e 3520 322e 3020 322e 350a 2020 2020  1.5 2.0 2.5.    
-00041960: 2020 2020 2020 2a20 7175 616e 7469 6c65        * quantile
-00041970: 2020 2871 7561 6e74 696c 6529 2066 6c6f    (quantile) flo
-00041980: 6174 3634 2030 2e30 2030 2e35 2031 2e30  at64 0.0 0.5 1.0
-00041990: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
-000419a0: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
-000419b0: 2020 2020 2061 2020 2020 2020 2020 2028       a         (
-000419c0: 7175 616e 7469 6c65 2c20 7929 2066 6c6f  quantile, y) flo
-000419d0: 6174 3634 2030 2e37 2034 2e32 2032 2e36  at64 0.7 4.2 2.6
-000419e0: 2031 2e35 2033 2e36 202e 2e2e 2031 2e37   1.5 3.6 ... 1.7
-000419f0: 2036 2e35 2037 2e33 2039 2e34 2031 2e39   6.5 7.3 9.4 1.9
-00041a00: 0a0a 2020 2020 2020 2020 5265 6665 7265  ..        Refere
-00041a10: 6e63 6573 0a20 2020 2020 2020 202d 2d2d  nces.        ---
-00041a20: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00041a30: 2e2e 205b 315d 2052 2e20 4a2e 2048 796e  .. [1] R. J. Hyn
-00041a40: 646d 616e 2061 6e64 2059 2e20 4661 6e2c  dman and Y. Fan,
-00041a50: 0a20 2020 2020 2020 2020 2020 2253 616d  .           "Sam
-00041a60: 706c 6520 7175 616e 7469 6c65 7320 696e  ple quantiles in
-00041a70: 2073 7461 7469 7374 6963 616c 2070 6163   statistical pac
-00041a80: 6b61 6765 732c 220a 2020 2020 2020 2020  kages,".        
-00041a90: 2020 2054 6865 2041 6d65 7269 6361 6e20     The American 
-00041aa0: 5374 6174 6973 7469 6369 616e 2c20 3530  Statistician, 50
-00041ab0: 2834 292c 2070 702e 2033 3631 2d33 3635  (4), pp. 361-365
-00041ac0: 2c20 3139 3936 0a20 2020 2020 2020 2022  , 1996.        "
-00041ad0: 2222 0a0a 2020 2020 2020 2020 2320 696e  ""..        # in
-00041ae0: 7465 7270 6f6c 6174 696f 6e20 7265 6e61  terpolation rena
-00041af0: 6d65 6420 746f 206d 6574 686f 6420 696e  med to method in
-00041b00: 2076 6572 7369 6f6e 2030 2e32 312e 300a   version 0.21.0.
-00041b10: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-00041b20: 6865 7265 2061 6e64 2069 6e20 7661 7269  here and in vari
-00041b30: 6162 6c65 2074 6f20 6176 6f69 6420 7265  able to avoid re
-00041b40: 7065 6174 6564 2077 6172 6e69 6e67 730a  peated warnings.
-00041b50: 2020 2020 2020 2020 6966 2069 6e74 6572          if inter
-00041b60: 706f 6c61 7469 6f6e 2069 7320 6e6f 7420  polation is not 
-00041b70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00041b80: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+000376d0: 2020 2020 2020 2020 6675 6e63 3a20 4361          func: Ca
+000376e0: 6c6c 6162 6c65 2c0a 2020 2020 2020 2020  llable,.        
+000376f0: 6b65 6570 5f61 7474 7273 3a20 626f 6f6c  keep_attrs: bool
+00037700: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00037710: 2020 2020 2020 2020 6172 6773 3a20 4974          args: It
+00037720: 6572 6162 6c65 5b41 6e79 5d20 3d20 2829  erable[Any] = ()
+00037730: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
+00037740: 6773 3a20 416e 792c 0a20 2020 2029 202d  gs: Any,.    ) -
+00037750: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+00037760: 2020 2020 2022 2222 4170 706c 7920 6120       """Apply a 
+00037770: 6675 6e63 7469 6f6e 2074 6f20 6561 6368  function to each
+00037780: 2064 6174 6120 7661 7269 6162 6c65 2069   data variable i
+00037790: 6e20 7468 6973 2064 6174 6173 6574 0a0a  n this dataset..
+000377a0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000377b0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+000377c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6675  -----.        fu
+000377d0: 6e63 203a 2063 616c 6c61 626c 650a 2020  nc : callable.  
+000377e0: 2020 2020 2020 2020 2020 4675 6e63 7469            Functi
+000377f0: 6f6e 2077 6869 6368 2063 616e 2062 6520  on which can be 
+00037800: 6361 6c6c 6564 2069 6e20 7468 6520 666f  called in the fo
+00037810: 726d 2060 6675 6e63 2878 2c20 2a61 7267  rm `func(x, *arg
+00037820: 732c 202a 2a6b 7761 7267 7329 600a 2020  s, **kwargs)`.  
+00037830: 2020 2020 2020 2020 2020 746f 2074 7261            to tra
+00037840: 6e73 666f 726d 2065 6163 6820 4461 7461  nsform each Data
+00037850: 4172 7261 7920 6078 6020 696e 2074 6869  Array `x` in thi
+00037860: 7320 6461 7461 7365 7420 696e 746f 2061  s dataset into a
+00037870: 6e6f 7468 6572 0a20 2020 2020 2020 2020  nother.         
+00037880: 2020 2044 6174 6141 7272 6179 2e0a 2020     DataArray..  
+00037890: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
+000378a0: 203a 2062 6f6f 6c20 6f72 204e 6f6e 652c   : bool or None,
+000378b0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+000378c0: 2020 2020 2020 4966 2054 7275 652c 2062        If True, b
+000378d0: 6f74 6820 7468 6520 6461 7461 7365 7427  oth the dataset'
+000378e0: 7320 616e 6420 7661 7269 6162 6c65 7327  s and variables'
+000378f0: 2061 7474 7269 6275 7465 7320 2860 6174   attributes (`at
+00037900: 7472 7360 2920 7769 6c6c 2062 650a 2020  trs`) will be.  
+00037910: 2020 2020 2020 2020 2020 636f 7069 6564            copied
+00037920: 2066 726f 6d20 7468 6520 6f72 6967 696e   from the origin
+00037930: 616c 206f 626a 6563 7473 2074 6f20 7468  al objects to th
+00037940: 6520 6e65 7720 6f6e 6573 2e20 4966 2046  e new ones. If F
+00037950: 616c 7365 2c20 7468 6520 6e65 7720 6461  alse, the new da
+00037960: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
+00037970: 2020 616e 6420 7661 7269 6162 6c65 7320    and variables 
+00037980: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
+00037990: 2077 6974 686f 7574 2063 6f70 7969 6e67   without copying
+000379a0: 2074 6865 2061 7474 7269 6275 7465 732e   the attributes.
+000379b0: 0a20 2020 2020 2020 2061 7267 7320 3a20  .        args : 
+000379c0: 6974 6572 6162 6c65 2c20 6f70 7469 6f6e  iterable, option
+000379d0: 616c 0a20 2020 2020 2020 2020 2020 2050  al.            P
+000379e0: 6f73 6974 696f 6e61 6c20 6172 6775 6d65  ositional argume
+000379f0: 6e74 7320 7061 7373 6564 206f 6e20 746f  nts passed on to
+00037a00: 2060 6675 6e63 602e 0a20 2020 2020 2020   `func`..       
+00037a10: 202a 2a6b 7761 7267 7320 3a20 416e 790a   **kwargs : Any.
+00037a20: 2020 2020 2020 2020 2020 2020 4b65 7977              Keyw
+00037a30: 6f72 6420 6172 6775 6d65 6e74 7320 7061  ord arguments pa
+00037a40: 7373 6564 206f 6e20 746f 2060 6675 6e63  ssed on to `func
+00037a50: 602e 0a0a 2020 2020 2020 2020 5265 7475  `...        Retu
+00037a60: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00037a70: 2d2d 2d0a 2020 2020 2020 2020 6170 706c  ---.        appl
+00037a80: 6965 6420 3a20 4461 7461 7365 740a 2020  ied : Dataset.  
+00037a90: 2020 2020 2020 2020 2020 5265 7375 6c74            Result
+00037aa0: 696e 6720 6461 7461 7365 7420 6672 6f6d  ing dataset from
+00037ab0: 2061 7070 6c79 696e 6720 6060 6675 6e63   applying ``func
+00037ac0: 6060 2074 6f20 6561 6368 2064 6174 6120  `` to each data 
+00037ad0: 7661 7269 6162 6c65 2e0a 0a20 2020 2020  variable...     
+00037ae0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+00037af0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00037b00: 2020 2020 203e 3e3e 2064 6120 3d20 7872       >>> da = xr
+00037b10: 2e44 6174 6141 7272 6179 286e 702e 7261  .DataArray(np.ra
+00037b20: 6e64 6f6d 2e72 616e 646e 2832 2c20 3329  ndom.randn(2, 3)
+00037b30: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+00037b40: 203d 2078 722e 4461 7461 7365 7428 7b22   = xr.Dataset({"
+00037b50: 666f 6f22 3a20 6461 2c20 2262 6172 223a  foo": da, "bar":
+00037b60: 2028 2278 222c 205b 2d31 2c20 325d 297d   ("x", [-1, 2])}
+00037b70: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+00037b80: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+00037b90: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
+00037ba0: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
+00037bb0: 6469 6d5f 303a 2032 2c20 6469 6d5f 313a  dim_0: 2, dim_1:
+00037bc0: 2033 2c20 783a 2032 290a 2020 2020 2020   3, x: 2).      
+00037bd0: 2020 4469 6d65 6e73 696f 6e73 2077 6974    Dimensions wit
+00037be0: 686f 7574 2063 6f6f 7264 696e 6174 6573  hout coordinates
+00037bf0: 3a20 6469 6d5f 302c 2064 696d 5f31 2c20  : dim_0, dim_1, 
+00037c00: 780a 2020 2020 2020 2020 4461 7461 2076  x.        Data v
+00037c10: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+00037c20: 2020 2020 2020 666f 6f20 2020 2020 2028        foo      (
+00037c30: 6469 6d5f 302c 2064 696d 5f31 2920 666c  dim_0, dim_1) fl
+00037c40: 6f61 7436 3420 312e 3736 3420 302e 3430  oat64 1.764 0.40
+00037c50: 3032 2030 2e39 3738 3720 322e 3234 3120  02 0.9787 2.241 
+00037c60: 312e 3836 3820 2d30 2e39 3737 330a 2020  1.868 -0.9773.  
+00037c70: 2020 2020 2020 2020 2020 6261 7220 2020            bar   
+00037c80: 2020 2028 7829 2069 6e74 3634 202d 3120     (x) int64 -1 
+00037c90: 320a 2020 2020 2020 2020 3e3e 3e20 6473  2.        >>> ds
+00037ca0: 2e6d 6170 286e 702e 6661 6273 290a 2020  .map(np.fabs).  
+00037cb0: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+00037cc0: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+00037cd0: 696d 656e 7369 6f6e 733a 2020 2864 696d  imensions:  (dim
+00037ce0: 5f30 3a20 322c 2064 696d 5f31 3a20 332c  _0: 2, dim_1: 3,
+00037cf0: 2078 3a20 3229 0a20 2020 2020 2020 2044   x: 2).        D
+00037d00: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
+00037d10: 7420 636f 6f72 6469 6e61 7465 733a 2064  t coordinates: d
+00037d20: 696d 5f30 2c20 6469 6d5f 312c 2078 0a20  im_0, dim_1, x. 
+00037d30: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
+00037d40: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
+00037d50: 2020 2066 6f6f 2020 2020 2020 2864 696d     foo      (dim
+00037d60: 5f30 2c20 6469 6d5f 3129 2066 6c6f 6174  _0, dim_1) float
+00037d70: 3634 2031 2e37 3634 2030 2e34 3030 3220  64 1.764 0.4002 
+00037d80: 302e 3937 3837 2032 2e32 3431 2031 2e38  0.9787 2.241 1.8
+00037d90: 3638 2030 2e39 3737 330a 2020 2020 2020  68 0.9773.      
+00037da0: 2020 2020 2020 6261 7220 2020 2020 2028        bar      (
+00037db0: 7829 2066 6c6f 6174 3634 2031 2e30 2032  x) float64 1.0 2
+00037dc0: 2e30 0a20 2020 2020 2020 2022 2222 0a20  .0.        """. 
+00037dd0: 2020 2020 2020 2069 6620 6b65 6570 5f61         if keep_a
+00037de0: 7474 7273 2069 7320 4e6f 6e65 3a0a 2020  ttrs is None:.  
+00037df0: 2020 2020 2020 2020 2020 6b65 6570 5f61            keep_a
+00037e00: 7474 7273 203d 205f 6765 745f 6b65 6570  ttrs = _get_keep
+00037e10: 5f61 7474 7273 2864 6566 6175 6c74 3d46  _attrs(default=F
+00037e20: 616c 7365 290a 2020 2020 2020 2020 7661  alse).        va
+00037e30: 7269 6162 6c65 7320 3d20 7b0a 2020 2020  riables = {.    
+00037e40: 2020 2020 2020 2020 6b3a 206d 6179 6265          k: maybe
+00037e50: 5f77 7261 705f 6172 7261 7928 762c 2066  _wrap_array(v, f
+00037e60: 756e 6328 762c 202a 6172 6773 2c20 2a2a  unc(v, *args, **
+00037e70: 6b77 6172 6773 2929 0a20 2020 2020 2020  kwargs)).       
+00037e80: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+00037e90: 2073 656c 662e 6461 7461 5f76 6172 732e   self.data_vars.
+00037ea0: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
+00037eb0: 7d0a 2020 2020 2020 2020 6966 206b 6565  }.        if kee
+00037ec0: 705f 6174 7472 733a 0a20 2020 2020 2020  p_attrs:.       
+00037ed0: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+00037ee0: 2076 6172 6961 626c 6573 2e69 7465 6d73   variables.items
+00037ef0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00037f00: 2020 2020 762e 5f63 6f70 795f 6174 7472      v._copy_attr
+00037f10: 735f 6672 6f6d 2873 656c 662e 6461 7461  s_from(self.data
+00037f20: 5f76 6172 735b 6b5d 290a 2020 2020 2020  _vars[k]).      
+00037f30: 2020 6174 7472 7320 3d20 7365 6c66 2e61    attrs = self.a
+00037f40: 7474 7273 2069 6620 6b65 6570 5f61 7474  ttrs if keep_att
+00037f50: 7273 2065 6c73 6520 4e6f 6e65 0a20 2020  rs else None.   
+00037f60: 2020 2020 2072 6574 7572 6e20 7479 7065       return type
+00037f70: 2873 656c 6629 2876 6172 6961 626c 6573  (self)(variables
+00037f80: 2c20 6174 7472 733d 6174 7472 7329 0a0a  , attrs=attrs)..
+00037f90: 2020 2020 6465 6620 6170 706c 7928 0a20      def apply(. 
+00037fa0: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+00037fb0: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
+00037fc0: 6675 6e63 3a20 4361 6c6c 6162 6c65 2c0a  func: Callable,.
+00037fd0: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+00037fe0: 7273 3a20 626f 6f6c 207c 204e 6f6e 6520  rs: bool | None 
+00037ff0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00038000: 6172 6773 3a20 4974 6572 6162 6c65 5b41  args: Iterable[A
+00038010: 6e79 5d20 3d20 2829 2c0a 2020 2020 2020  ny] = (),.      
+00038020: 2020 2a2a 6b77 6172 6773 3a20 416e 792c    **kwargs: Any,
+00038030: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
+00038040: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
+00038050: 0a20 2020 2020 2020 2042 6163 6b77 6172  .        Backwar
+00038060: 6420 636f 6d70 6174 6962 6c65 2069 6d70  d compatible imp
+00038070: 6c65 6d65 6e74 6174 696f 6e20 6f66 2060  lementation of `
+00038080: 606d 6170 6060 0a0a 2020 2020 2020 2020  `map``..        
+00038090: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+000380a0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+000380b0: 2020 4461 7461 7365 742e 6d61 700a 2020    Dataset.map.  
+000380c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000380d0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+000380e0: 0a20 2020 2020 2020 2020 2020 2022 4461  .            "Da
+000380f0: 7461 7365 742e 6170 706c 7920 6d61 7920  taset.apply may 
+00038100: 6265 2064 6570 7265 6361 7465 6420 696e  be deprecated in
+00038110: 2074 6865 2066 7574 7572 652e 2055 7369   the future. Usi
+00038120: 6e67 2044 6174 6173 6574 2e6d 6170 2069  ng Dataset.map i
+00038130: 7320 656e 636f 7572 6167 6564 222c 0a20  s encouraged",. 
+00038140: 2020 2020 2020 2020 2020 2050 656e 6469             Pendi
+00038150: 6e67 4465 7072 6563 6174 696f 6e57 6172  ngDeprecationWar
+00038160: 6e69 6e67 2c0a 2020 2020 2020 2020 2020  ning,.          
+00038170: 2020 7374 6163 6b6c 6576 656c 3d32 2c0a    stacklevel=2,.
+00038180: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00038190: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+000381a0: 7028 6675 6e63 2c20 6b65 6570 5f61 7474  p(func, keep_att
+000381b0: 7273 2c20 6172 6773 2c20 2a2a 6b77 6172  rs, args, **kwar
+000381c0: 6773 290a 0a20 2020 2064 6566 2061 7373  gs)..    def ass
+000381d0: 6967 6e28 0a20 2020 2020 2020 2073 656c  ign(.        sel
+000381e0: 663a 2054 5f44 6174 6173 6574 2c0a 2020  f: T_Dataset,.  
+000381f0: 2020 2020 2020 7661 7269 6162 6c65 733a        variables:
+00038200: 204d 6170 7069 6e67 5b41 6e79 2c20 416e   Mapping[Any, An
+00038210: 795d 207c 204e 6f6e 6520 3d20 4e6f 6e65  y] | None = None
+00038220: 2c0a 2020 2020 2020 2020 2a2a 7661 7269  ,.        **vari
+00038230: 6162 6c65 735f 6b77 6172 6773 3a20 416e  ables_kwargs: An
+00038240: 792c 0a20 2020 2029 202d 3e20 545f 4461  y,.    ) -> T_Da
+00038250: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+00038260: 2222 4173 7369 676e 206e 6577 2064 6174  ""Assign new dat
+00038270: 6120 7661 7269 6162 6c65 7320 746f 2061  a variables to a
+00038280: 2044 6174 6173 6574 2c20 7265 7475 726e   Dataset, return
+00038290: 696e 6720 6120 6e65 7720 6f62 6a65 6374  ing a new object
+000382a0: 0a20 2020 2020 2020 2077 6974 6820 616c  .        with al
+000382b0: 6c20 7468 6520 6f72 6967 696e 616c 2076  l the original v
+000382c0: 6172 6961 626c 6573 2069 6e20 6164 6469  ariables in addi
+000382d0: 7469 6f6e 2074 6f20 7468 6520 6e65 7720  tion to the new 
+000382e0: 6f6e 6573 2e0a 0a20 2020 2020 2020 2050  ones...        P
+000382f0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00038300: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00038310: 2020 2020 2076 6172 6961 626c 6573 203a       variables :
+00038320: 206d 6170 7069 6e67 206f 6620 6861 7368   mapping of hash
+00038330: 6162 6c65 2074 6f20 416e 790a 2020 2020  able to Any.    
+00038340: 2020 2020 2020 2020 4d61 7070 696e 6720          Mapping 
+00038350: 6672 6f6d 2076 6172 6961 626c 6573 206e  from variables n
+00038360: 616d 6573 2074 6f20 7468 6520 6e65 7720  ames to the new 
+00038370: 7661 6c75 6573 2e20 4966 2074 6865 206e  values. If the n
+00038380: 6577 2076 616c 7565 730a 2020 2020 2020  ew values.      
+00038390: 2020 2020 2020 6172 6520 6361 6c6c 6162        are callab
+000383a0: 6c65 2c20 7468 6579 2061 7265 2063 6f6d  le, they are com
+000383b0: 7075 7465 6420 6f6e 2074 6865 2044 6174  puted on the Dat
+000383c0: 6173 6574 2061 6e64 2061 7373 6967 6e65  aset and assigne
+000383d0: 6420 746f 206e 6577 0a20 2020 2020 2020  d to new.       
+000383e0: 2020 2020 2064 6174 6120 7661 7269 6162       data variab
+000383f0: 6c65 732e 2049 6620 7468 6520 7661 6c75  les. If the valu
+00038400: 6573 2061 7265 206e 6f74 2063 616c 6c61  es are not calla
+00038410: 626c 652c 2028 652e 672e 2061 2044 6174  ble, (e.g. a Dat
+00038420: 6141 7272 6179 2c0a 2020 2020 2020 2020  aArray,.        
+00038430: 2020 2020 7363 616c 6172 2c20 6f72 2061      scalar, or a
+00038440: 7272 6179 292c 2074 6865 7920 6172 6520  rray), they are 
+00038450: 7369 6d70 6c79 2061 7373 6967 6e65 642e  simply assigned.
+00038460: 0a20 2020 2020 2020 202a 2a76 6172 6961  .        **varia
+00038470: 626c 6573 5f6b 7761 7267 730a 2020 2020  bles_kwargs.    
+00038480: 2020 2020 2020 2020 5468 6520 6b65 7977          The keyw
+00038490: 6f72 6420 6172 6775 6d65 6e74 7320 666f  ord arguments fo
+000384a0: 726d 206f 6620 6060 7661 7269 6162 6c65  rm of ``variable
+000384b0: 7360 602e 0a20 2020 2020 2020 2020 2020  s``..           
+000384c0: 204f 6e65 206f 6620 7661 7269 6162 6c65   One of variable
+000384d0: 7320 6f72 2076 6172 6961 626c 6573 5f6b  s or variables_k
+000384e0: 7761 7267 7320 6d75 7374 2062 6520 7072  wargs must be pr
+000384f0: 6f76 6964 6564 2e0a 0a20 2020 2020 2020  ovided...       
+00038500: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+00038510: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+00038520: 2064 7320 3a20 4461 7461 7365 740a 2020   ds : Dataset.  
+00038530: 2020 2020 2020 2020 2020 4120 6e65 7720            A new 
+00038540: 4461 7461 7365 7420 7769 7468 2074 6865  Dataset with the
+00038550: 206e 6577 2076 6172 6961 626c 6573 2069   new variables i
+00038560: 6e20 6164 6469 7469 6f6e 2074 6f20 616c  n addition to al
+00038570: 6c20 7468 650a 2020 2020 2020 2020 2020  l the.          
+00038580: 2020 6578 6973 7469 6e67 2076 6172 6961    existing varia
+00038590: 626c 6573 2e0a 0a20 2020 2020 2020 204e  bles...        N
+000385a0: 6f74 6573 0a20 2020 2020 2020 202d 2d2d  otes.        ---
+000385b0: 2d2d 0a20 2020 2020 2020 2053 696e 6365  --.        Since
+000385c0: 2060 606b 7761 7267 7360 6020 6973 2061   ``kwargs`` is a
+000385d0: 2064 6963 7469 6f6e 6172 792c 2074 6865   dictionary, the
+000385e0: 206f 7264 6572 206f 6620 796f 7572 2061   order of your a
+000385f0: 7267 756d 656e 7473 206d 6179 206e 6f74  rguments may not
+00038600: 0a20 2020 2020 2020 2062 6520 7072 6573  .        be pres
+00038610: 6572 7665 642c 2061 6e64 2073 6f20 7468  erved, and so th
+00038620: 6520 6f72 6465 7220 6f66 2074 6865 206e  e order of the n
+00038630: 6577 2076 6172 6961 626c 6573 2069 7320  ew variables is 
+00038640: 6e6f 7420 7765 6c6c 0a20 2020 2020 2020  not well.       
+00038650: 2064 6566 696e 6564 2e20 4173 7369 676e   defined. Assign
+00038660: 696e 6720 6d75 6c74 6970 6c65 2076 6172  ing multiple var
+00038670: 6961 626c 6573 2077 6974 6869 6e20 7468  iables within th
+00038680: 6520 7361 6d65 2060 6061 7373 6967 6e60  e same ``assign`
+00038690: 6020 6973 0a20 2020 2020 2020 2070 6f73  ` is.        pos
+000386a0: 7369 626c 652c 2062 7574 2079 6f75 2063  sible, but you c
+000386b0: 616e 6e6f 7420 7265 6665 7265 6e63 6520  annot reference 
+000386c0: 6f74 6865 7220 7661 7269 6162 6c65 7320  other variables 
+000386d0: 6372 6561 7465 6420 7769 7468 696e 2074  created within t
+000386e0: 6865 0a20 2020 2020 2020 2073 616d 6520  he.        same 
+000386f0: 6060 6173 7369 676e 6060 2063 616c 6c2e  ``assign`` call.
+00038700: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+00038710: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+00038720: 2d2d 2d0a 2020 2020 2020 2020 7061 6e64  ---.        pand
+00038730: 6173 2e44 6174 6146 7261 6d65 2e61 7373  as.DataFrame.ass
+00038740: 6967 6e0a 0a20 2020 2020 2020 2045 7861  ign..        Exa
+00038750: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
+00038760: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
+00038770: 3e3e 2078 203d 2078 722e 4461 7461 7365  >> x = xr.Datase
+00038780: 7428 0a20 2020 2020 2020 202e 2e2e 2020  t(.        ...  
+00038790: 2020 207b 0a20 2020 2020 2020 202e 2e2e     {.        ...
+000387a0: 2020 2020 2020 2020 2022 7465 6d70 6572           "temper
+000387b0: 6174 7572 655f 6322 3a20 280a 2020 2020  ature_c": (.    
+000387c0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+000387d0: 2020 2020 2822 6c61 7422 2c20 226c 6f6e      ("lat", "lon
+000387e0: 2229 2c0a 2020 2020 2020 2020 2e2e 2e20  "),.        ... 
+000387f0: 2020 2020 2020 2020 2020 2020 3230 202a              20 *
+00038800: 206e 702e 7261 6e64 6f6d 2e72 616e 6428   np.random.rand(
+00038810: 3429 2e72 6573 6861 7065 2832 2c20 3229  4).reshape(2, 2)
+00038820: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+00038830: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00038840: 202e 2e2e 2020 2020 2020 2020 2022 7072   ...         "pr
+00038850: 6563 6970 6974 6174 696f 6e22 3a20 2828  ecipitation": ((
+00038860: 226c 6174 222c 2022 6c6f 6e22 292c 206e  "lat", "lon"), n
+00038870: 702e 7261 6e64 6f6d 2e72 616e 6428 3429  p.random.rand(4)
+00038880: 2e72 6573 6861 7065 2832 2c20 3229 292c  .reshape(2, 2)),
+00038890: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+000388a0: 207d 2c0a 2020 2020 2020 2020 2e2e 2e20   },.        ... 
+000388b0: 2020 2020 636f 6f72 6473 3d7b 226c 6174      coords={"lat
+000388c0: 223a 205b 3130 2c20 3230 5d2c 2022 6c6f  ": [10, 20], "lo
+000388d0: 6e22 3a20 5b31 3530 2c20 3136 305d 7d2c  n": [150, 160]},
+000388e0: 0a20 2020 2020 2020 202e 2e2e 2029 0a20  .        ... ). 
+000388f0: 2020 2020 2020 203e 3e3e 2078 0a20 2020         >>> x.   
+00038900: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+00038910: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+00038920: 6d65 6e73 696f 6e73 3a20 2020 2020 2020  mensions:       
+00038930: 2028 6c61 743a 2032 2c20 6c6f 6e3a 2032   (lat: 2, lon: 2
+00038940: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+00038950: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+00038960: 202a 206c 6174 2020 2020 2020 2020 2020   * lat          
+00038970: 2020 286c 6174 2920 696e 7436 3420 3130    (lat) int64 10
+00038980: 2032 300a 2020 2020 2020 2020 2020 2a20   20.          * 
+00038990: 6c6f 6e20 2020 2020 2020 2020 2020 2028  lon            (
+000389a0: 6c6f 6e29 2069 6e74 3634 2031 3530 2031  lon) int64 150 1
+000389b0: 3630 0a20 2020 2020 2020 2044 6174 6120  60.        Data 
+000389c0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+000389d0: 2020 2020 2020 2074 656d 7065 7261 7475         temperatu
+000389e0: 7265 5f63 2020 286c 6174 2c20 6c6f 6e29  re_c  (lat, lon)
+000389f0: 2066 6c6f 6174 3634 2031 302e 3938 2031   float64 10.98 1
+00038a00: 342e 3320 3132 2e30 3620 3130 2e39 0a20  4.3 12.06 10.9. 
+00038a10: 2020 2020 2020 2020 2020 2070 7265 6369             preci
+00038a20: 7069 7461 7469 6f6e 2020 286c 6174 2c20  pitation  (lat, 
+00038a30: 6c6f 6e29 2066 6c6f 6174 3634 2030 2e34  lon) float64 0.4
+00038a40: 3233 3720 302e 3634 3539 2030 2e34 3337  237 0.6459 0.437
+00038a50: 3620 302e 3839 3138 0a0a 2020 2020 2020  6 0.8918..      
+00038a60: 2020 5768 6572 6520 7468 6520 7661 6c75    Where the valu
+00038a70: 6520 6973 2061 2063 616c 6c61 626c 652c  e is a callable,
+00038a80: 2065 7661 6c75 6174 6564 206f 6e20 6461   evaluated on da
+00038a90: 7461 7365 743a 0a0a 2020 2020 2020 2020  taset:..        
+00038aa0: 3e3e 3e20 782e 6173 7369 676e 2874 656d  >>> x.assign(tem
+00038ab0: 7065 7261 7475 7265 5f66 3d6c 616d 6264  perature_f=lambd
+00038ac0: 6120 783a 2078 2e74 656d 7065 7261 7475  a x: x.temperatu
+00038ad0: 7265 5f63 202a 2039 202f 2035 202b 2033  re_c * 9 / 5 + 3
+00038ae0: 3229 0a20 2020 2020 2020 203c 7861 7272  2).        <xarr
+00038af0: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
+00038b00: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
+00038b10: 2020 2020 2020 2028 6c61 743a 2032 2c20         (lat: 2, 
+00038b20: 6c6f 6e3a 2032 290a 2020 2020 2020 2020  lon: 2).        
+00038b30: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
+00038b40: 2020 2020 2020 202a 206c 6174 2020 2020         * lat    
+00038b50: 2020 2020 2020 2020 286c 6174 2920 696e          (lat) in
+00038b60: 7436 3420 3130 2032 300a 2020 2020 2020  t64 10 20.      
+00038b70: 2020 2020 2a20 6c6f 6e20 2020 2020 2020      * lon       
+00038b80: 2020 2020 2028 6c6f 6e29 2069 6e74 3634       (lon) int64
+00038b90: 2031 3530 2031 3630 0a20 2020 2020 2020   150 160.       
+00038ba0: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
+00038bb0: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
+00038bc0: 7065 7261 7475 7265 5f63 2020 286c 6174  perature_c  (lat
+00038bd0: 2c20 6c6f 6e29 2066 6c6f 6174 3634 2031  , lon) float64 1
+00038be0: 302e 3938 2031 342e 3320 3132 2e30 3620  0.98 14.3 12.06 
+00038bf0: 3130 2e39 0a20 2020 2020 2020 2020 2020  10.9.           
+00038c00: 2070 7265 6369 7069 7461 7469 6f6e 2020   precipitation  
+00038c10: 286c 6174 2c20 6c6f 6e29 2066 6c6f 6174  (lat, lon) float
+00038c20: 3634 2030 2e34 3233 3720 302e 3634 3539  64 0.4237 0.6459
+00038c30: 2030 2e34 3337 3620 302e 3839 3138 0a20   0.4376 0.8918. 
+00038c40: 2020 2020 2020 2020 2020 2074 656d 7065             tempe
+00038c50: 7261 7475 7265 5f66 2020 286c 6174 2c20  rature_f  (lat, 
+00038c60: 6c6f 6e29 2066 6c6f 6174 3634 2035 312e  lon) float64 51.
+00038c70: 3736 2035 372e 3735 2035 332e 3720 3531  76 57.75 53.7 51
+00038c80: 2e36 320a 0a20 2020 2020 2020 2041 6c74  .62..        Alt
+00038c90: 6572 6e61 7469 7665 6c79 2c20 7468 6520  ernatively, the 
+00038ca0: 7361 6d65 2062 6568 6176 696f 7220 6361  same behavior ca
+00038cb0: 6e20 6265 2061 6368 6965 7665 6420 6279  n be achieved by
+00038cc0: 2064 6972 6563 746c 7920 7265 6665 7265   directly refere
+00038cd0: 6e63 696e 6720 616e 2065 7869 7374 696e  ncing an existin
+00038ce0: 6720 6461 7461 6172 7261 793a 0a0a 2020  g dataarray:..  
+00038cf0: 2020 2020 2020 3e3e 3e20 782e 6173 7369        >>> x.assi
+00038d00: 676e 2874 656d 7065 7261 7475 7265 5f66  gn(temperature_f
+00038d10: 3d78 5b22 7465 6d70 6572 6174 7572 655f  =x["temperature_
+00038d20: 6322 5d20 2a20 3920 2f20 3520 2b20 3332  c"] * 9 / 5 + 32
+00038d30: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
+00038d40: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+00038d50: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+00038d60: 2020 2020 2020 286c 6174 3a20 322c 206c        (lat: 2, l
+00038d70: 6f6e 3a20 3229 0a20 2020 2020 2020 2043  on: 2).        C
+00038d80: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+00038d90: 2020 2020 2020 2a20 6c61 7420 2020 2020        * lat     
+00038da0: 2020 2020 2020 2028 6c61 7429 2069 6e74         (lat) int
+00038db0: 3634 2031 3020 3230 0a20 2020 2020 2020  64 10 20.       
+00038dc0: 2020 202a 206c 6f6e 2020 2020 2020 2020     * lon        
+00038dd0: 2020 2020 286c 6f6e 2920 696e 7436 3420      (lon) int64 
+00038de0: 3135 3020 3136 300a 2020 2020 2020 2020  150 160.        
+00038df0: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
+00038e00: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+00038e10: 6572 6174 7572 655f 6320 2028 6c61 742c  erature_c  (lat,
+00038e20: 206c 6f6e 2920 666c 6f61 7436 3420 3130   lon) float64 10
+00038e30: 2e39 3820 3134 2e33 2031 322e 3036 2031  .98 14.3 12.06 1
+00038e40: 302e 390a 2020 2020 2020 2020 2020 2020  0.9.            
+00038e50: 7072 6563 6970 6974 6174 696f 6e20 2028  precipitation  (
+00038e60: 6c61 742c 206c 6f6e 2920 666c 6f61 7436  lat, lon) float6
+00038e70: 3420 302e 3432 3337 2030 2e36 3435 3920  4 0.4237 0.6459 
+00038e80: 302e 3433 3736 2030 2e38 3931 380a 2020  0.4376 0.8918.  
+00038e90: 2020 2020 2020 2020 2020 7465 6d70 6572            temper
+00038ea0: 6174 7572 655f 6620 2028 6c61 742c 206c  ature_f  (lat, l
+00038eb0: 6f6e 2920 666c 6f61 7436 3420 3531 2e37  on) float64 51.7
+00038ec0: 3620 3537 2e37 3520 3533 2e37 2035 312e  6 57.75 53.7 51.
+00038ed0: 3632 0a0a 2020 2020 2020 2020 2222 220a  62..        """.
+00038ee0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00038ef0: 7320 3d20 6569 7468 6572 5f64 6963 745f  s = either_dict_
+00038f00: 6f72 5f6b 7761 7267 7328 7661 7269 6162  or_kwargs(variab
+00038f10: 6c65 732c 2076 6172 6961 626c 6573 5f6b  les, variables_k
+00038f20: 7761 7267 732c 2022 6173 7369 676e 2229  wargs, "assign")
+00038f30: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00038f40: 7365 6c66 2e63 6f70 7928 290a 2020 2020  self.copy().    
+00038f50: 2020 2020 2320 646f 2061 6c6c 2063 616c      # do all cal
+00038f60: 6375 6c61 7469 6f6e 7320 6669 7273 742e  culations first.
+00038f70: 2e2e 0a20 2020 2020 2020 2072 6573 756c  ...        resul
+00038f80: 7473 3a20 436f 6572 6369 626c 654d 6170  ts: CoercibleMap
+00038f90: 7069 6e67 203d 2064 6174 612e 5f63 616c  ping = data._cal
+00038fa0: 635f 6173 7369 676e 5f72 6573 756c 7473  c_assign_results
+00038fb0: 2876 6172 6961 626c 6573 290a 2020 2020  (variables).    
+00038fc0: 2020 2020 6461 7461 2e63 6f6f 7264 732e      data.coords.
+00038fd0: 5f6d 6179 6265 5f64 726f 705f 6d75 6c74  _maybe_drop_mult
+00038fe0: 6969 6e64 6578 5f63 6f6f 7264 7328 7365  iindex_coords(se
+00038ff0: 7428 7265 7375 6c74 732e 6b65 7973 2829  t(results.keys()
+00039000: 2929 0a20 2020 2020 2020 2023 202e 2e2e  )).        # ...
+00039010: 2061 6e64 2074 6865 6e20 6173 7369 676e   and then assign
+00039020: 0a20 2020 2020 2020 2064 6174 612e 7570  .        data.up
+00039030: 6461 7465 2872 6573 756c 7473 290a 2020  date(results).  
+00039040: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
+00039050: 610a 0a20 2020 2064 6566 2074 6f5f 6172  a..    def to_ar
+00039060: 7261 7928 0a20 2020 2020 2020 2073 656c  ray(.        sel
+00039070: 662c 2064 696d 3a20 4861 7368 6162 6c65  f, dim: Hashable
+00039080: 203d 2022 7661 7269 6162 6c65 222c 206e   = "variable", n
+00039090: 616d 653a 2048 6173 6861 626c 6520 7c20  ame: Hashable | 
+000390a0: 4e6f 6e65 203d 204e 6f6e 650a 2020 2020  None = None.    
+000390b0: 2920 2d3e 2044 6174 6141 7272 6179 3a0a  ) -> DataArray:.
+000390c0: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
+000390d0: 7274 2074 6869 7320 6461 7461 7365 7420  rt this dataset 
+000390e0: 696e 746f 2061 6e20 7861 7272 6179 2e44  into an xarray.D
+000390f0: 6174 6141 7272 6179 0a0a 2020 2020 2020  ataArray..      
+00039100: 2020 5468 6520 6461 7461 2076 6172 6961    The data varia
+00039110: 626c 6573 206f 6620 7468 6973 2064 6174  bles of this dat
+00039120: 6173 6574 2077 696c 6c20 6265 2062 726f  aset will be bro
+00039130: 6164 6361 7374 2061 6761 696e 7374 2065  adcast against e
+00039140: 6163 6820 6f74 6865 720a 2020 2020 2020  ach other.      
+00039150: 2020 616e 6420 7374 6163 6b65 6420 616c    and stacked al
+00039160: 6f6e 6720 7468 6520 6669 7273 7420 6178  ong the first ax
+00039170: 6973 206f 6620 7468 6520 6e65 7720 6172  is of the new ar
+00039180: 7261 792e 2041 6c6c 2063 6f6f 7264 696e  ray. All coordin
+00039190: 6174 6573 206f 660a 2020 2020 2020 2020  ates of.        
+000391a0: 7468 6973 2064 6174 6173 6574 2077 696c  this dataset wil
+000391b0: 6c20 7265 6d61 696e 2063 6f6f 7264 696e  l remain coordin
+000391c0: 6174 6573 2e0a 0a20 2020 2020 2020 2050  ates...        P
+000391d0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+000391e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+000391f0: 2020 2020 2064 696d 203a 2048 6173 6861       dim : Hasha
+00039200: 626c 652c 2064 6566 6175 6c74 3a20 2276  ble, default: "v
+00039210: 6172 6961 626c 6522 0a20 2020 2020 2020  ariable".       
+00039220: 2020 2020 204e 616d 6520 6f66 2074 6865       Name of the
+00039230: 206e 6577 2064 696d 656e 7369 6f6e 2e0a   new dimension..
+00039240: 2020 2020 2020 2020 6e61 6d65 203a 2048          name : H
+00039250: 6173 6861 626c 6520 6f72 204e 6f6e 652c  ashable or None,
+00039260: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00039270: 2020 2020 2020 4e61 6d65 206f 6620 7468        Name of th
+00039280: 6520 6e65 7720 6461 7461 2061 7272 6179  e new data array
+00039290: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+000392a0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+000392b0: 2d2d 0a20 2020 2020 2020 2061 7272 6179  --.        array
+000392c0: 203a 2078 6172 7261 792e 4461 7461 4172   : xarray.DataAr
+000392d0: 7261 790a 2020 2020 2020 2020 2222 220a  ray.        """.
+000392e0: 2020 2020 2020 2020 6672 6f6d 2078 6172          from xar
+000392f0: 7261 792e 636f 7265 2e64 6174 6161 7272  ray.core.dataarr
+00039300: 6179 2069 6d70 6f72 7420 4461 7461 4172  ay import DataAr
+00039310: 7261 790a 0a20 2020 2020 2020 2064 6174  ray..        dat
+00039320: 615f 7661 7273 203d 205b 7365 6c66 2e76  a_vars = [self.v
+00039330: 6172 6961 626c 6573 5b6b 5d20 666f 7220  ariables[k] for 
+00039340: 6b20 696e 2073 656c 662e 6461 7461 5f76  k in self.data_v
+00039350: 6172 735d 0a20 2020 2020 2020 2062 726f  ars].        bro
+00039360: 6164 6361 7374 5f76 6172 7320 3d20 6272  adcast_vars = br
+00039370: 6f61 6463 6173 745f 7661 7269 6162 6c65  oadcast_variable
+00039380: 7328 2a64 6174 615f 7661 7273 290a 2020  s(*data_vars).  
+00039390: 2020 2020 2020 6461 7461 203d 2064 7563        data = duc
+000393a0: 6b5f 6172 7261 795f 6f70 732e 7374 6163  k_array_ops.stac
+000393b0: 6b28 5b62 2e64 6174 6120 666f 7220 6220  k([b.data for b 
+000393c0: 696e 2062 726f 6164 6361 7374 5f76 6172  in broadcast_var
+000393d0: 735d 2c20 6178 6973 3d30 290a 0a20 2020  s], axis=0)..   
+000393e0: 2020 2020 2064 696d 7320 3d20 2864 696d       dims = (dim
+000393f0: 2c29 202b 2062 726f 6164 6361 7374 5f76  ,) + broadcast_v
+00039400: 6172 735b 305d 2e64 696d 730a 2020 2020  ars[0].dims.    
+00039410: 2020 2020 7661 7269 6162 6c65 203d 2056      variable = V
+00039420: 6172 6961 626c 6528 6469 6d73 2c20 6461  ariable(dims, da
+00039430: 7461 2c20 7365 6c66 2e61 7474 7273 2c20  ta, self.attrs, 
+00039440: 6661 7374 7061 7468 3d54 7275 6529 0a0a  fastpath=True)..
+00039450: 2020 2020 2020 2020 636f 6f72 6473 203d          coords =
+00039460: 207b 6b3a 2076 2e76 6172 6961 626c 6520   {k: v.variable 
+00039470: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+00039480: 2e63 6f6f 7264 732e 6974 656d 7328 297d  .coords.items()}
+00039490: 0a20 2020 2020 2020 2069 6e64 6578 6573  .        indexes
+000394a0: 203d 2066 696c 7465 725f 696e 6465 7865   = filter_indexe
+000394b0: 735f 6672 6f6d 5f63 6f6f 7264 7328 7365  s_from_coords(se
+000394c0: 6c66 2e5f 696e 6465 7865 732c 2073 6574  lf._indexes, set
+000394d0: 2863 6f6f 7264 7329 290a 2020 2020 2020  (coords)).      
+000394e0: 2020 6e65 775f 6469 6d5f 696e 6465 7820    new_dim_index 
+000394f0: 3d20 5061 6e64 6173 496e 6465 7828 6c69  = PandasIndex(li
+00039500: 7374 2873 656c 662e 6461 7461 5f76 6172  st(self.data_var
+00039510: 7329 2c20 6469 6d29 0a20 2020 2020 2020  s), dim).       
+00039520: 2069 6e64 6578 6573 5b64 696d 5d20 3d20   indexes[dim] = 
+00039530: 6e65 775f 6469 6d5f 696e 6465 780a 2020  new_dim_index.  
+00039540: 2020 2020 2020 636f 6f72 6473 2e75 7064        coords.upd
+00039550: 6174 6528 6e65 775f 6469 6d5f 696e 6465  ate(new_dim_inde
+00039560: 782e 6372 6561 7465 5f76 6172 6961 626c  x.create_variabl
+00039570: 6573 2829 290a 0a20 2020 2020 2020 2072  es())..        r
+00039580: 6574 7572 6e20 4461 7461 4172 7261 792e  eturn DataArray.
+00039590: 5f63 6f6e 7374 7275 6374 5f64 6972 6563  _construct_direc
+000395a0: 7428 7661 7269 6162 6c65 2c20 636f 6f72  t(variable, coor
+000395b0: 6473 2c20 6e61 6d65 2c20 696e 6465 7865  ds, name, indexe
+000395c0: 7329 0a0a 2020 2020 6465 6620 5f6e 6f72  s)..    def _nor
+000395d0: 6d61 6c69 7a65 5f64 696d 5f6f 7264 6572  malize_dim_order
+000395e0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+000395f0: 6469 6d5f 6f72 6465 723a 2053 6571 7565  dim_order: Seque
+00039600: 6e63 655b 4861 7368 6162 6c65 5d20 7c20  nce[Hashable] | 
+00039610: 4e6f 6e65 203d 204e 6f6e 650a 2020 2020  None = None.    
+00039620: 2920 2d3e 2064 6963 745b 4861 7368 6162  ) -> dict[Hashab
+00039630: 6c65 2c20 696e 745d 3a0a 2020 2020 2020  le, int]:.      
+00039640: 2020 2222 220a 2020 2020 2020 2020 4368    """.        Ch
+00039650: 6563 6b20 7468 6520 7661 6c69 6469 7479  eck the validity
+00039660: 206f 6620 7468 6520 7072 6f76 6964 6564   of the provided
+00039670: 2064 696d 656e 7369 6f6e 7320 6966 2061   dimensions if a
+00039680: 6e79 2061 6e64 2072 6574 7572 6e20 7468  ny and return th
+00039690: 6520 6d61 7070 696e 670a 2020 2020 2020  e mapping.      
+000396a0: 2020 6265 7477 6565 6e20 6469 6d65 6e73    between dimens
+000396b0: 696f 6e20 6e61 6d65 2061 6e64 2074 6865  ion name and the
+000396c0: 6972 2073 697a 652e 0a0a 2020 2020 2020  ir size...      
+000396d0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+000396e0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+000396f0: 2020 2020 2020 2020 6469 6d5f 6f72 6465          dim_orde
+00039700: 723a 2053 6571 7565 6e63 6520 6f66 2048  r: Sequence of H
+00039710: 6173 6861 626c 6520 6f72 204e 6f6e 652c  ashable or None,
+00039720: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00039730: 2020 2020 2020 4469 6d65 6e73 696f 6e20        Dimension 
+00039740: 6f72 6465 7220 746f 2076 616c 6964 6174  order to validat
+00039750: 6520 2864 6566 6175 6c74 2074 6f20 7468  e (default to th
+00039760: 6520 616c 7068 6162 6574 6963 616c 206f  e alphabetical o
+00039770: 7264 6572 2069 6620 4e6f 6e65 292e 0a0a  rder if None)...
+00039780: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00039790: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+000397a0: 2020 2020 2020 2020 7265 7375 6c74 203a          result :
+000397b0: 2064 6963 745b 4861 7368 6162 6c65 2c20   dict[Hashable, 
+000397c0: 696e 745d 0a20 2020 2020 2020 2020 2020  int].           
+000397d0: 2056 616c 6964 6174 6564 2064 696d 656e   Validated dimen
+000397e0: 7369 6f6e 7320 6d61 7070 696e 672e 0a0a  sions mapping...
+000397f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00039800: 2020 2020 6966 2064 696d 5f6f 7264 6572      if dim_order
+00039810: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00039820: 2020 2020 2020 6469 6d5f 6f72 6465 7220        dim_order 
+00039830: 3d20 6c69 7374 2873 656c 662e 6469 6d73  = list(self.dims
+00039840: 290a 2020 2020 2020 2020 656c 6966 2073  ).        elif s
+00039850: 6574 2864 696d 5f6f 7264 6572 2920 213d  et(dim_order) !=
+00039860: 2073 6574 2873 656c 662e 6469 6d73 293a   set(self.dims):
+00039870: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00039880: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00039890: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000398a0: 6469 6d5f 6f72 6465 7220 7b7d 2064 6f65  dim_order {} doe
+000398b0: 7320 6e6f 7420 6d61 7463 6820 7468 6520  s not match the 
+000398c0: 7365 7420 6f66 2064 696d 656e 7369 6f6e  set of dimension
+000398d0: 7320 6f66 2074 6869 7320 220a 2020 2020  s of this ".    
+000398e0: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
+000398f0: 6173 6574 3a20 7b7d 222e 666f 726d 6174  aset: {}".format
+00039900: 2864 696d 5f6f 7264 6572 2c20 6c69 7374  (dim_order, list
+00039910: 2873 656c 662e 6469 6d73 2929 0a20 2020  (self.dims)).   
+00039920: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00039930: 2020 2020 6f72 6465 7265 645f 6469 6d73      ordered_dims
+00039940: 203d 207b 6b3a 2073 656c 662e 6469 6d73   = {k: self.dims
+00039950: 5b6b 5d20 666f 7220 6b20 696e 2064 696d  [k] for k in dim
+00039960: 5f6f 7264 6572 7d0a 0a20 2020 2020 2020  _order}..       
+00039970: 2072 6574 7572 6e20 6f72 6465 7265 645f   return ordered_
+00039980: 6469 6d73 0a0a 2020 2020 6465 6620 746f  dims..    def to
+00039990: 5f70 616e 6461 7328 7365 6c66 2920 2d3e  _pandas(self) ->
+000399a0: 2070 642e 5365 7269 6573 207c 2070 642e   pd.Series | pd.
+000399b0: 4461 7461 4672 616d 653a 0a20 2020 2020  DataFrame:.     
+000399c0: 2020 2022 2222 436f 6e76 6572 7420 7468     """Convert th
+000399d0: 6973 2064 6174 6173 6574 2069 6e74 6f20  is dataset into 
+000399e0: 6120 7061 6e64 6173 206f 626a 6563 7420  a pandas object 
+000399f0: 7769 7468 6f75 7420 6368 616e 6769 6e67  without changing
+00039a00: 2074 6865 206e 756d 6265 7220 6f66 2064   the number of d
+00039a10: 696d 656e 7369 6f6e 732e 0a0a 2020 2020  imensions...    
+00039a20: 2020 2020 5468 6520 7479 7065 206f 6620      The type of 
+00039a30: 7468 6520 7265 7475 726e 6564 206f 626a  the returned obj
+00039a40: 6563 7420 6465 7065 6e64 7320 6f6e 2074  ect depends on t
+00039a50: 6865 206e 756d 6265 7220 6f66 2044 6174  he number of Dat
+00039a60: 6173 6574 0a20 2020 2020 2020 2064 696d  aset.        dim
+00039a70: 656e 7369 6f6e 733a 0a0a 2020 2020 2020  ensions:..      
+00039a80: 2020 2a20 3044 202d 3e20 6070 616e 6461    * 0D -> `panda
+00039a90: 732e 5365 7269 6573 600a 2020 2020 2020  s.Series`.      
+00039aa0: 2020 2a20 3144 202d 3e20 6070 616e 6461    * 1D -> `panda
+00039ab0: 732e 4461 7461 4672 616d 6560 0a0a 2020  s.DataFrame`..  
+00039ac0: 2020 2020 2020 4f6e 6c79 2077 6f72 6b73        Only works
+00039ad0: 2066 6f72 2044 6174 6173 6574 7320 7769   for Datasets wi
+00039ae0: 7468 2031 206f 7220 6665 7765 7220 6469  th 1 or fewer di
+00039af0: 6d65 6e73 696f 6e73 2e0a 2020 2020 2020  mensions..      
+00039b00: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00039b10: 206c 656e 2873 656c 662e 6469 6d73 2920   len(self.dims) 
+00039b20: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00039b30: 2020 7265 7475 726e 2070 642e 5365 7269    return pd.Seri
+00039b40: 6573 287b 6b3a 2076 2e69 7465 6d28 2920  es({k: v.item() 
+00039b50: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
+00039b60: 2e69 7465 6d73 2829 7d29 0a20 2020 2020  .items()}).     
+00039b70: 2020 2069 6620 6c65 6e28 7365 6c66 2e64     if len(self.d
+00039b80: 696d 7329 203d 3d20 313a 0a20 2020 2020  ims) == 1:.     
+00039b90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00039ba0: 6c66 2e74 6f5f 6461 7461 6672 616d 6528  lf.to_dataframe(
+00039bb0: 290a 2020 2020 2020 2020 7261 6973 6520  ).        raise 
+00039bc0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00039bd0: 2020 2020 2020 2020 2263 616e 6e6f 7420          "cannot 
+00039be0: 636f 6e76 6572 7420 4461 7461 7365 7473  convert Datasets
+00039bf0: 2077 6974 6820 2573 2064 696d 656e 7369   with %s dimensi
+00039c00: 6f6e 7320 696e 746f 2022 0a20 2020 2020  ons into ".     
+00039c10: 2020 2020 2020 2022 7061 6e64 6173 206f         "pandas o
+00039c20: 626a 6563 7473 2077 6974 686f 7574 2063  bjects without c
+00039c30: 6861 6e67 696e 6720 7468 6520 6e75 6d62  hanging the numb
+00039c40: 6572 206f 6620 6469 6d65 6e73 696f 6e73  er of dimensions
+00039c50: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+00039c60: 2250 6c65 6173 6520 7573 6520 4461 7461  "Please use Data
+00039c70: 7365 742e 746f 5f64 6174 6166 7261 6d65  set.to_dataframe
+00039c80: 2829 2069 6e73 7465 6164 2e22 2025 206c  () instead." % l
+00039c90: 656e 2873 656c 662e 6469 6d73 290a 2020  en(self.dims).  
+00039ca0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00039cb0: 205f 746f 5f64 6174 6166 7261 6d65 2873   _to_dataframe(s
+00039cc0: 656c 662c 206f 7264 6572 6564 5f64 696d  elf, ordered_dim
+00039cd0: 733a 204d 6170 7069 6e67 5b41 6e79 2c20  s: Mapping[Any, 
+00039ce0: 696e 745d 293a 0a20 2020 2020 2020 2063  int]):.        c
+00039cf0: 6f6c 756d 6e73 203d 205b 6b20 666f 7220  olumns = [k for 
+00039d00: 6b20 696e 2073 656c 662e 7661 7269 6162  k in self.variab
+00039d10: 6c65 7320 6966 206b 206e 6f74 2069 6e20  les if k not in 
+00039d20: 7365 6c66 2e64 696d 735d 0a20 2020 2020  self.dims].     
+00039d30: 2020 2064 6174 6120 3d20 5b0a 2020 2020     data = [.    
+00039d40: 2020 2020 2020 2020 7365 6c66 2e5f 7661          self._va
+00039d50: 7269 6162 6c65 735b 6b5d 2e73 6574 5f64  riables[k].set_d
+00039d60: 696d 7328 6f72 6465 7265 645f 6469 6d73  ims(ordered_dims
+00039d70: 292e 7661 6c75 6573 2e72 6573 6861 7065  ).values.reshape
+00039d80: 282d 3129 0a20 2020 2020 2020 2020 2020  (-1).           
+00039d90: 2066 6f72 206b 2069 6e20 636f 6c75 6d6e   for k in column
+00039da0: 730a 2020 2020 2020 2020 5d0a 2020 2020  s.        ].    
+00039db0: 2020 2020 696e 6465 7820 3d20 7365 6c66      index = self
+00039dc0: 2e63 6f6f 7264 732e 746f 5f69 6e64 6578  .coords.to_index
+00039dd0: 285b 2a6f 7264 6572 6564 5f64 696d 735d  ([*ordered_dims]
+00039de0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00039df0: 2070 642e 4461 7461 4672 616d 6528 6469   pd.DataFrame(di
+00039e00: 6374 287a 6970 2863 6f6c 756d 6e73 2c20  ct(zip(columns, 
+00039e10: 6461 7461 2929 2c20 696e 6465 783d 696e  data)), index=in
+00039e20: 6465 7829 0a0a 2020 2020 6465 6620 746f  dex)..    def to
+00039e30: 5f64 6174 6166 7261 6d65 2873 656c 662c  _dataframe(self,
+00039e40: 2064 696d 5f6f 7264 6572 3a20 5365 7175   dim_order: Sequ
+00039e50: 656e 6365 5b48 6173 6861 626c 655d 207c  ence[Hashable] |
+00039e60: 204e 6f6e 6520 3d20 4e6f 6e65 2920 2d3e   None = None) ->
+00039e70: 2070 642e 4461 7461 4672 616d 653a 0a20   pd.DataFrame:. 
+00039e80: 2020 2020 2020 2022 2222 436f 6e76 6572         """Conver
+00039e90: 7420 7468 6973 2064 6174 6173 6574 2069  t this dataset i
+00039ea0: 6e74 6f20 6120 7061 6e64 6173 2e44 6174  nto a pandas.Dat
+00039eb0: 6146 7261 6d65 2e0a 0a20 2020 2020 2020  aFrame...       
+00039ec0: 204e 6f6e 2d69 6e64 6578 2076 6172 6961   Non-index varia
+00039ed0: 626c 6573 2069 6e20 7468 6973 2064 6174  bles in this dat
+00039ee0: 6173 6574 2066 6f72 6d20 7468 6520 636f  aset form the co
+00039ef0: 6c75 6d6e 7320 6f66 2074 6865 0a20 2020  lumns of the.   
+00039f00: 2020 2020 2044 6174 6146 7261 6d65 2e20       DataFrame. 
+00039f10: 5468 6520 4461 7461 4672 616d 6520 6973  The DataFrame is
+00039f20: 2069 6e64 6578 6564 2062 7920 7468 6520   indexed by the 
+00039f30: 4361 7274 6573 6961 6e20 7072 6f64 7563  Cartesian produc
+00039f40: 7420 6f66 0a20 2020 2020 2020 2074 6869  t of.        thi
+00039f50: 7320 6461 7461 7365 7427 7320 696e 6469  s dataset's indi
+00039f60: 6365 732e 0a0a 2020 2020 2020 2020 5061  ces...        Pa
+00039f70: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00039f80: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00039f90: 2020 2020 6469 6d5f 6f72 6465 723a 2053      dim_order: S
+00039fa0: 6571 7565 6e63 6520 6f66 2048 6173 6861  equence of Hasha
+00039fb0: 626c 6520 6f72 204e 6f6e 652c 206f 7074  ble or None, opt
+00039fc0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+00039fd0: 2020 4869 6572 6172 6368 6963 616c 2064    Hierarchical d
+00039fe0: 696d 656e 7369 6f6e 206f 7264 6572 2066  imension order f
+00039ff0: 6f72 2074 6865 2072 6573 756c 7469 6e67  or the resulting
+0003a000: 2064 6174 6166 7261 6d65 2e20 416c 6c0a   dataframe. All.
+0003a010: 2020 2020 2020 2020 2020 2020 6172 7261              arra
+0003a020: 7973 2061 7265 2074 7261 6e73 706f 7365  ys are transpose
+0003a030: 6420 746f 2074 6869 7320 6f72 6465 7220  d to this order 
+0003a040: 616e 6420 7468 656e 2077 7269 7474 656e  and then written
+0003a050: 206f 7574 2061 7320 666c 6174 0a20 2020   out as flat.   
+0003a060: 2020 2020 2020 2020 2076 6563 746f 7273           vectors
+0003a070: 2069 6e20 636f 6e74 6967 756f 7573 206f   in contiguous o
+0003a080: 7264 6572 2c20 736f 2074 6865 206c 6173  rder, so the las
+0003a090: 7420 6469 6d65 6e73 696f 6e20 696e 2074  t dimension in t
+0003a0a0: 6869 7320 6c69 7374 0a20 2020 2020 2020  his list.       
+0003a0b0: 2020 2020 2077 696c 6c20 6265 2063 6f6e       will be con
+0003a0c0: 7469 6775 6f75 7320 696e 2074 6865 2072  tiguous in the r
+0003a0d0: 6573 756c 7469 6e67 2044 6174 6146 7261  esulting DataFra
+0003a0e0: 6d65 2e20 5468 6973 2068 6173 2061 206d  me. This has a m
+0003a0f0: 616a 6f72 0a20 2020 2020 2020 2020 2020  ajor.           
+0003a100: 2069 6e66 6c75 656e 6365 206f 6e20 7768   influence on wh
+0003a110: 6963 6820 6f70 6572 6174 696f 6e73 2061  ich operations a
+0003a120: 7265 2065 6666 6963 6965 6e74 206f 6e20  re efficient on 
+0003a130: 7468 6520 7265 7375 6c74 696e 670a 2020  the resulting.  
+0003a140: 2020 2020 2020 2020 2020 6461 7461 6672            datafr
+0003a150: 616d 652e 0a0a 2020 2020 2020 2020 2020  ame...          
+0003a160: 2020 4966 2070 726f 7669 6465 642c 206d    If provided, m
+0003a170: 7573 7420 696e 636c 7564 6520 616c 6c20  ust include all 
+0003a180: 6469 6d65 6e73 696f 6e73 206f 6620 7468  dimensions of th
+0003a190: 6973 2064 6174 6173 6574 2e20 4279 0a20  is dataset. By. 
+0003a1a0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+0003a1b0: 6c74 2c20 6469 6d65 6e73 696f 6e73 2061  lt, dimensions a
+0003a1c0: 7265 2073 6f72 7465 6420 616c 7068 6162  re sorted alphab
+0003a1d0: 6574 6963 616c 6c79 2e0a 0a20 2020 2020  etically...     
+0003a1e0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+0003a1f0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+0003a200: 2020 2072 6573 756c 7420 3a20 4461 7461     result : Data
+0003a210: 4672 616d 650a 2020 2020 2020 2020 2020  Frame.          
+0003a220: 2020 4461 7461 7365 7420 6173 2061 2070    Dataset as a p
+0003a230: 616e 6461 7320 4461 7461 4672 616d 652e  andas DataFrame.
+0003a240: 0a0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0003a250: 2020 2020 2020 206f 7264 6572 6564 5f64         ordered_d
+0003a260: 696d 7320 3d20 7365 6c66 2e5f 6e6f 726d  ims = self._norm
+0003a270: 616c 697a 655f 6469 6d5f 6f72 6465 7228  alize_dim_order(
+0003a280: 6469 6d5f 6f72 6465 723d 6469 6d5f 6f72  dim_order=dim_or
+0003a290: 6465 7229 0a0a 2020 2020 2020 2020 7265  der)..        re
+0003a2a0: 7475 726e 2073 656c 662e 5f74 6f5f 6461  turn self._to_da
+0003a2b0: 7461 6672 616d 6528 6f72 6465 7265 645f  taframe(ordered_
+0003a2c0: 6469 6d73 3d6f 7264 6572 6564 5f64 696d  dims=ordered_dim
+0003a2d0: 7329 0a0a 2020 2020 6465 6620 5f73 6574  s)..    def _set
+0003a2e0: 5f73 7061 7273 655f 6461 7461 5f66 726f  _sparse_data_fro
+0003a2f0: 6d5f 6461 7461 6672 616d 6528 0a20 2020  m_dataframe(.   
+0003a300: 2020 2020 2073 656c 662c 2069 6478 3a20       self, idx: 
+0003a310: 7064 2e49 6e64 6578 2c20 6172 7261 7973  pd.Index, arrays
+0003a320: 3a20 6c69 7374 5b74 7570 6c65 5b48 6173  : list[tuple[Has
+0003a330: 6861 626c 652c 206e 702e 6e64 6172 7261  hable, np.ndarra
+0003a340: 795d 5d2c 2064 696d 733a 2074 7570 6c65  y]], dims: tuple
+0003a350: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+0003a360: 2020 2020 2020 2020 6672 6f6d 2073 7061          from spa
+0003a370: 7273 6520 696d 706f 7274 2043 4f4f 0a0a  rse import COO..
+0003a380: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003a390: 7461 6e63 6528 6964 782c 2070 642e 4d75  tance(idx, pd.Mu
+0003a3a0: 6c74 6949 6e64 6578 293a 0a20 2020 2020  ltiIndex):.     
+0003a3b0: 2020 2020 2020 2063 6f6f 7264 7320 3d20         coords = 
+0003a3c0: 6e70 2e73 7461 636b 285b 6e70 2e61 7361  np.stack([np.asa
+0003a3d0: 7272 6179 2863 6f64 6529 2066 6f72 2063  rray(code) for c
+0003a3e0: 6f64 6520 696e 2069 6478 2e63 6f64 6573  ode in idx.codes
+0003a3f0: 5d2c 2061 7869 733d 3029 0a20 2020 2020  ], axis=0).     
+0003a400: 2020 2020 2020 2069 735f 736f 7274 6564         is_sorted
+0003a410: 203d 2069 6478 2e69 735f 6d6f 6e6f 746f   = idx.is_monoto
+0003a420: 6e69 635f 696e 6372 6561 7369 6e67 0a20  nic_increasing. 
+0003a430: 2020 2020 2020 2020 2020 2073 6861 7065             shape
+0003a440: 203d 2074 7570 6c65 286c 6576 2e73 697a   = tuple(lev.siz
+0003a450: 6520 666f 7220 6c65 7620 696e 2069 6478  e for lev in idx
+0003a460: 2e6c 6576 656c 7329 0a20 2020 2020 2020  .levels).       
+0003a470: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0003a480: 2020 2063 6f6f 7264 7320 3d20 6e70 2e61     coords = np.a
+0003a490: 7261 6e67 6528 6964 782e 7369 7a65 292e  range(idx.size).
+0003a4a0: 7265 7368 6170 6528 312c 202d 3129 0a20  reshape(1, -1). 
+0003a4b0: 2020 2020 2020 2020 2020 2069 735f 736f             is_so
+0003a4c0: 7274 6564 203d 2054 7275 650a 2020 2020  rted = True.    
+0003a4d0: 2020 2020 2020 2020 7368 6170 6520 3d20          shape = 
+0003a4e0: 2869 6478 2e73 697a 652c 290a 0a20 2020  (idx.size,)..   
+0003a4f0: 2020 2020 2066 6f72 206e 616d 652c 2076       for name, v
+0003a500: 616c 7565 7320 696e 2061 7272 6179 733a  alues in arrays:
+0003a510: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+0003a520: 6e20 7669 7274 7561 6c6c 7920 616c 6c20  n virtually all 
+0003a530: 7265 616c 2075 7365 2063 6173 6573 2c20  real use cases, 
+0003a540: 7468 6520 7370 6172 7365 2061 7272 6179  the sparse array
+0003a550: 2077 696c 6c20 6e6f 7720 6861 7665 0a20   will now have. 
+0003a560: 2020 2020 2020 2020 2020 2023 206d 6973             # mis
+0003a570: 7369 6e67 2076 616c 7565 7320 616e 6420  sing values and 
+0003a580: 6e65 6564 7320 6120 6669 6c6c 5f76 616c  needs a fill_val
+0003a590: 7565 2e20 466f 7220 636f 6e73 6973 7465  ue. For consiste
+0003a5a0: 6e63 792c 2064 6f6e 2774 0a20 2020 2020  ncy, don't.     
+0003a5b0: 2020 2020 2020 2023 2073 7065 6369 616c         # special
+0003a5c0: 2063 6173 6520 7468 6520 7261 7265 2065   case the rare e
+0003a5d0: 7863 6570 7469 6f6e 7320 2865 2e67 2e2c  xceptions (e.g.,
+0003a5e0: 2064 7479 7065 3d69 6e74 2077 6974 686f   dtype=int witho
+0003a5f0: 7574 2061 0a20 2020 2020 2020 2020 2020  ut a.           
+0003a600: 2023 204d 756c 7469 496e 6465 7829 2e0a   # MultiIndex)..
+0003a610: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
+0003a620: 652c 2066 696c 6c5f 7661 6c75 6520 3d20  e, fill_value = 
+0003a630: 7872 6474 7970 6573 2e6d 6179 6265 5f70  xrdtypes.maybe_p
+0003a640: 726f 6d6f 7465 2876 616c 7565 732e 6474  romote(values.dt
+0003a650: 7970 6529 0a20 2020 2020 2020 2020 2020  ype).           
+0003a660: 2076 616c 7565 7320 3d20 6e70 2e61 7361   values = np.asa
+0003a670: 7272 6179 2876 616c 7565 732c 2064 7479  rray(values, dty
+0003a680: 7065 3d64 7479 7065 290a 0a20 2020 2020  pe=dtype)..     
+0003a690: 2020 2020 2020 2064 6174 6120 3d20 434f         data = CO
+0003a6a0: 4f28 0a20 2020 2020 2020 2020 2020 2020  O(.             
+0003a6b0: 2020 2063 6f6f 7264 732c 0a20 2020 2020     coords,.     
+0003a6c0: 2020 2020 2020 2020 2020 2076 616c 7565             value
+0003a6d0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0003a6e0: 2020 2073 6861 7065 2c0a 2020 2020 2020     shape,.      
+0003a6f0: 2020 2020 2020 2020 2020 6861 735f 6475            has_du
+0003a700: 706c 6963 6174 6573 3d46 616c 7365 2c0a  plicates=False,.
+0003a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a720: 736f 7274 6564 3d69 735f 736f 7274 6564  sorted=is_sorted
+0003a730: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0003a740: 2020 6669 6c6c 5f76 616c 7565 3d66 696c    fill_value=fil
+0003a750: 6c5f 7661 6c75 652c 0a20 2020 2020 2020  l_value,.       
+0003a760: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0003a770: 2020 2073 656c 665b 6e61 6d65 5d20 3d20     self[name] = 
+0003a780: 2864 696d 732c 2064 6174 6129 0a0a 2020  (dims, data)..  
+0003a790: 2020 6465 6620 5f73 6574 5f6e 756d 7079    def _set_numpy
+0003a7a0: 5f64 6174 615f 6672 6f6d 5f64 6174 6166  _data_from_dataf
+0003a7b0: 7261 6d65 280a 2020 2020 2020 2020 7365  rame(.        se
+0003a7c0: 6c66 2c20 6964 783a 2070 642e 496e 6465  lf, idx: pd.Inde
+0003a7d0: 782c 2061 7272 6179 733a 206c 6973 745b  x, arrays: list[
+0003a7e0: 7475 706c 655b 4861 7368 6162 6c65 2c20  tuple[Hashable, 
+0003a7f0: 6e70 2e6e 6461 7272 6179 5d5d 2c20 6469  np.ndarray]], di
+0003a800: 6d73 3a20 7475 706c 650a 2020 2020 2920  ms: tuple.    ) 
+0003a810: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0003a820: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+0003a830: 6365 2869 6478 2c20 7064 2e4d 756c 7469  ce(idx, pd.Multi
+0003a840: 496e 6465 7829 3a0a 2020 2020 2020 2020  Index):.        
+0003a850: 2020 2020 666f 7220 6e61 6d65 2c20 7661      for name, va
+0003a860: 6c75 6573 2069 6e20 6172 7261 7973 3a0a  lues in arrays:.
+0003a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a880: 7365 6c66 5b6e 616d 655d 203d 2028 6469  self[name] = (di
+0003a890: 6d73 2c20 7661 6c75 6573 290a 2020 2020  ms, values).    
+0003a8a0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+0003a8b0: 2020 2020 2020 2020 2320 4e42 3a20 7369          # NB: si
+0003a8c0: 6d69 6c61 722c 206d 6f72 6520 6765 6e65  milar, more gene
+0003a8d0: 7261 6c20 6c6f 6769 632c 206e 6f77 2065  ral logic, now e
+0003a8e0: 7869 7374 7320 696e 0a20 2020 2020 2020  xists in.       
+0003a8f0: 2023 2076 6172 6961 626c 652e 756e 7374   # variable.unst
+0003a900: 6163 6b5f 6f6e 6365 3b20 7765 2063 6f75  ack_once; we cou
+0003a910: 6c64 2063 6f6e 7369 6465 7220 636f 6d62  ld consider comb
+0003a920: 696e 696e 6720 7468 656d 2061 7420 736f  ining them at so
+0003a930: 6d65 0a20 2020 2020 2020 2023 2070 6f69  me.        # poi
+0003a940: 6e74 2e0a 0a20 2020 2020 2020 2073 6861  nt...        sha
+0003a950: 7065 203d 2074 7570 6c65 286c 6576 2e73  pe = tuple(lev.s
+0003a960: 697a 6520 666f 7220 6c65 7620 696e 2069  ize for lev in i
+0003a970: 6478 2e6c 6576 656c 7329 0a20 2020 2020  dx.levels).     
+0003a980: 2020 2069 6e64 6578 6572 203d 2074 7570     indexer = tup
+0003a990: 6c65 2869 6478 2e63 6f64 6573 290a 0a20  le(idx.codes).. 
+0003a9a0: 2020 2020 2020 2023 2057 6520 616c 7265         # We alre
+0003a9b0: 6164 7920 7665 7269 6669 6564 2074 6861  ady verified tha
+0003a9c0: 7420 7468 6520 4d75 6c74 6949 6e64 6578  t the MultiIndex
+0003a9d0: 2068 6173 2061 6c6c 2075 6e69 7175 6520   has all unique 
+0003a9e0: 7661 6c75 6573 2c20 736f 0a20 2020 2020  values, so.     
+0003a9f0: 2020 2023 2074 6865 7265 2061 7265 206d     # there are m
+0003aa00: 6973 7369 6e67 2076 616c 7565 7320 6966  issing values if
+0003aa10: 2061 6e64 206f 6e6c 7920 6966 2074 6865   and only if the
+0003aa20: 2073 697a 6520 6f66 206f 7574 7075 7420   size of output 
+0003aa30: 6172 7261 7973 2069 730a 2020 2020 2020  arrays is.      
+0003aa40: 2020 2320 6c61 7267 6572 2074 6861 7420    # larger that 
+0003aa50: 7468 6520 696e 6465 782e 0a20 2020 2020  the index..     
+0003aa60: 2020 206d 6973 7369 6e67 5f76 616c 7565     missing_value
+0003aa70: 7320 3d20 6d61 7468 2e70 726f 6428 7368  s = math.prod(sh
+0003aa80: 6170 6529 203e 2069 6478 2e73 6861 7065  ape) > idx.shape
+0003aa90: 5b30 5d0a 0a20 2020 2020 2020 2066 6f72  [0]..        for
+0003aaa0: 206e 616d 652c 2076 616c 7565 7320 696e   name, values in
+0003aab0: 2061 7272 6179 733a 0a20 2020 2020 2020   arrays:.       
+0003aac0: 2020 2020 2023 204e 756d 5079 2069 6e64       # NumPy ind
+0003aad0: 6578 696e 6720 6973 206d 7563 6820 6661  exing is much fa
+0003aae0: 7374 6572 2074 6861 6e20 7573 696e 6720  ster than using 
+0003aaf0: 4461 7461 4672 616d 652e 7265 696e 6465  DataFrame.reinde
+0003ab00: 7828 2920 746f 0a20 2020 2020 2020 2020  x() to.         
+0003ab10: 2020 2023 2066 696c 6c20 696e 206d 6973     # fill in mis
+0003ab20: 7369 6e67 2076 616c 7565 733a 0a20 2020  sing values:.   
+0003ab30: 2020 2020 2020 2020 2023 2068 7474 7073           # https
+0003ab40: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
+0003ab50: 2e63 6f6d 2f61 2f33 3530 3439 3839 392f  .com/a/35049899/
+0003ab60: 3830 3937 3035 0a20 2020 2020 2020 2020  809705.         
+0003ab70: 2020 2069 6620 6d69 7373 696e 675f 7661     if missing_va
+0003ab80: 6c75 6573 3a0a 2020 2020 2020 2020 2020  lues:.          
+0003ab90: 2020 2020 2020 6474 7970 652c 2066 696c        dtype, fil
+0003aba0: 6c5f 7661 6c75 6520 3d20 7872 6474 7970  l_value = xrdtyp
+0003abb0: 6573 2e6d 6179 6265 5f70 726f 6d6f 7465  es.maybe_promote
+0003abc0: 2876 616c 7565 732e 6474 7970 6529 0a20  (values.dtype). 
+0003abd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0003abe0: 6174 6120 3d20 6e70 2e66 756c 6c28 7368  ata = np.full(sh
+0003abf0: 6170 652c 2066 696c 6c5f 7661 6c75 652c  ape, fill_value,
+0003ac00: 2064 7479 7065 290a 2020 2020 2020 2020   dtype).        
+0003ac10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003ac20: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
+0003ac30: 6865 7265 2061 7265 206e 6f20 6d69 7373  here are no miss
+0003ac40: 696e 6720 7661 6c75 6573 2c20 6b65 6570  ing values, keep
+0003ac50: 2074 6865 2065 7869 7374 696e 6720 6474   the existing dt
+0003ac60: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+0003ac70: 2020 2020 2320 696e 7374 6561 6420 6f66      # instead of
+0003ac80: 2070 726f 6d6f 7469 6e67 2074 6f20 7375   promoting to su
+0003ac90: 7070 6f72 7420 4e41 2c20 652e 672e 2c20  pport NA, e.g., 
+0003aca0: 6b65 6570 2069 6e74 6567 6572 0a20 2020  keep integer.   
+0003acb0: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0003acc0: 6f6c 756d 6e73 2061 7320 696e 7465 6765  olumns as intege
+0003acd0: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
+0003ace0: 2020 2020 2320 544f 444f 3a20 636f 6e73      # TODO: cons
+0003acf0: 6964 6572 2072 656d 6f76 696e 6720 7468  ider removing th
+0003ad00: 6973 2073 7065 6369 616c 2063 6173 652c  is special case,
+0003ad10: 2077 6869 6368 2064 6f65 736e 2774 0a20   which doesn't. 
+0003ad20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0003ad30: 2065 7869 7374 2066 6f72 2073 7061 7273   exist for spars
+0003ad40: 653d 5472 7565 2e0a 2020 2020 2020 2020  e=True..        
+0003ad50: 2020 2020 2020 2020 6461 7461 203d 206e          data = n
+0003ad60: 702e 7a65 726f 7328 7368 6170 652c 2076  p.zeros(shape, v
+0003ad70: 616c 7565 732e 6474 7970 6529 0a20 2020  alues.dtype).   
+0003ad80: 2020 2020 2020 2020 2064 6174 615b 696e           data[in
+0003ad90: 6465 7865 725d 203d 2076 616c 7565 730a  dexer] = values.
+0003ada0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003adb0: 5b6e 616d 655d 203d 2028 6469 6d73 2c20  [name] = (dims, 
+0003adc0: 6461 7461 290a 0a20 2020 2040 636c 6173  data)..    @clas
+0003add0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+0003ade0: 6672 6f6d 5f64 6174 6166 7261 6d65 280a  from_dataframe(.
+0003adf0: 2020 2020 2020 2020 636c 733a 2074 7970          cls: typ
+0003ae00: 655b 545f 4461 7461 7365 745d 2c20 6461  e[T_Dataset], da
+0003ae10: 7461 6672 616d 653a 2070 642e 4461 7461  taframe: pd.Data
+0003ae20: 4672 616d 652c 2073 7061 7273 653a 2062  Frame, sparse: b
+0003ae30: 6f6f 6c20 3d20 4661 6c73 650a 2020 2020  ool = False.    
+0003ae40: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0003ae50: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
+0003ae60: 7274 2061 2070 616e 6461 732e 4461 7461  rt a pandas.Data
+0003ae70: 4672 616d 6520 696e 746f 2061 6e20 7861  Frame into an xa
+0003ae80: 7272 6179 2e44 6174 6173 6574 0a0a 2020  rray.Dataset..  
+0003ae90: 2020 2020 2020 4561 6368 2063 6f6c 756d        Each colum
+0003aea0: 6e20 7769 6c6c 2062 6520 636f 6e76 6572  n will be conver
+0003aeb0: 7465 6420 696e 746f 2061 6e20 696e 6465  ted into an inde
+0003aec0: 7065 6e64 656e 7420 7661 7269 6162 6c65  pendent variable
+0003aed0: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
+0003aee0: 4461 7461 7365 742e 2049 6620 7468 6520  Dataset. If the 
+0003aef0: 6461 7461 6672 616d 6527 7320 696e 6465  dataframe's inde
+0003af00: 7820 6973 2061 204d 756c 7469 496e 6465  x is a MultiInde
+0003af10: 782c 2069 7420 7769 6c6c 2062 6520 6578  x, it will be ex
+0003af20: 7061 6e64 6564 0a20 2020 2020 2020 2069  panded.        i
+0003af30: 6e74 6f20 6120 7465 6e73 6f72 2070 726f  nto a tensor pro
+0003af40: 6475 6374 206f 6620 6f6e 652d 6469 6d65  duct of one-dime
+0003af50: 6e73 696f 6e61 6c20 696e 6469 6365 7320  nsional indices 
+0003af60: 2866 696c 6c69 6e67 2069 6e20 6d69 7373  (filling in miss
+0003af70: 696e 670a 2020 2020 2020 2020 7661 6c75  ing.        valu
+0003af80: 6573 2077 6974 6820 4e61 4e29 2e20 5468  es with NaN). Th
+0003af90: 6973 206d 6574 686f 6420 7769 6c6c 2070  is method will p
+0003afa0: 726f 6475 6365 2061 2044 6174 6173 6574  roduce a Dataset
+0003afb0: 2076 6572 7920 7369 6d69 6c61 7220 746f   very similar to
+0003afc0: 0a20 2020 2020 2020 2074 6861 7420 6f6e  .        that on
+0003afd0: 2077 6869 6368 2074 6865 2027 746f 5f64   which the 'to_d
+0003afe0: 6174 6166 7261 6d65 2720 6d65 7468 6f64  ataframe' method
+0003aff0: 2077 6173 2063 616c 6c65 642c 2065 7863   was called, exc
+0003b000: 6570 7420 7769 7468 0a20 2020 2020 2020  ept with.       
+0003b010: 2070 6f73 7369 626c 7920 7265 6475 6e64   possibly redund
+0003b020: 616e 7420 6469 6d65 6e73 696f 6e73 2028  ant dimensions (
+0003b030: 7369 6e63 6520 616c 6c20 6461 7461 7365  since all datase
+0003b040: 7420 7661 7269 6162 6c65 7320 7769 6c6c  t variables will
+0003b050: 2068 6176 650a 2020 2020 2020 2020 7468   have.        th
+0003b060: 6520 7361 6d65 2064 696d 656e 7369 6f6e  e same dimension
+0003b070: 616c 6974 7929 0a0a 2020 2020 2020 2020  ality)..        
+0003b080: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0003b090: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0003b0a0: 2020 2020 2020 6461 7461 6672 616d 6520        dataframe 
+0003b0b0: 3a20 4461 7461 4672 616d 650a 2020 2020  : DataFrame.    
+0003b0c0: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
+0003b0d0: 6520 6672 6f6d 2077 6869 6368 2074 6f20  e from which to 
+0003b0e0: 636f 7079 2064 6174 6120 616e 6420 696e  copy data and in
+0003b0f0: 6469 6365 732e 0a20 2020 2020 2020 2073  dices..        s
+0003b100: 7061 7273 6520 3a20 626f 6f6c 2c20 6465  parse : bool, de
+0003b110: 6661 756c 743a 2046 616c 7365 0a20 2020  fault: False.   
+0003b120: 2020 2020 2020 2020 2049 6620 7472 7565           If true
+0003b130: 2c20 6372 6561 7465 2061 2073 7061 7273  , create a spars
+0003b140: 6520 6172 7261 7973 2069 6e73 7465 6164  e arrays instead
+0003b150: 206f 6620 6465 6e73 6520 6e75 6d70 7920   of dense numpy 
+0003b160: 6172 7261 7973 2e20 5468 6973 0a20 2020  arrays. This.   
+0003b170: 2020 2020 2020 2020 2063 616e 2070 6f74           can pot
+0003b180: 656e 7469 616c 6c79 2073 6176 6520 6120  entially save a 
+0003b190: 6c61 7267 6520 616d 6f75 6e74 206f 6620  large amount of 
+0003b1a0: 6d65 6d6f 7279 2069 6620 7468 6520 4461  memory if the Da
+0003b1b0: 7461 4672 616d 6520 6861 730a 2020 2020  taFrame has.    
+0003b1c0: 2020 2020 2020 2020 6120 4d75 6c74 6949          a MultiI
+0003b1d0: 6e64 6578 2e20 5265 7175 6972 6573 2074  ndex. Requires t
+0003b1e0: 6865 2073 7061 7273 6520 7061 636b 6167  he sparse packag
+0003b1f0: 6520 2873 7061 7273 652e 7079 6461 7461  e (sparse.pydata
+0003b200: 2e6f 7267 292e 0a0a 2020 2020 2020 2020  .org)...        
+0003b210: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+0003b220: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0003b230: 4e65 7720 4461 7461 7365 742e 0a0a 2020  New Dataset...  
+0003b240: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
+0003b250: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+0003b260: 2020 2020 2020 2020 7861 7272 6179 2e44          xarray.D
+0003b270: 6174 6141 7272 6179 2e66 726f 6d5f 7365  ataArray.from_se
+0003b280: 7269 6573 0a20 2020 2020 2020 2070 616e  ries.        pan
+0003b290: 6461 732e 4461 7461 4672 616d 652e 746f  das.DataFrame.to
+0003b2a0: 5f78 6172 7261 790a 2020 2020 2020 2020  _xarray.        
+0003b2b0: 2222 220a 2020 2020 2020 2020 2320 544f  """.        # TO
+0003b2c0: 444f 3a20 4164 6420 616e 206f 7074 696f  DO: Add an optio
+0003b2d0: 6e20 746f 2072 656d 6f76 6520 6469 6d65  n to remove dime
+0003b2e0: 6e73 696f 6e73 2061 6c6f 6e67 2077 6869  nsions along whi
+0003b2f0: 6368 2074 6865 2076 6172 6961 626c 6573  ch the variables
+0003b300: 0a20 2020 2020 2020 2023 2061 7265 2063  .        # are c
+0003b310: 6f6e 7374 616e 742c 2074 6f20 656e 6162  onstant, to enab
+0003b320: 6c65 2063 6f6e 7369 7374 656e 7420 7365  le consistent se
+0003b330: 7269 616c 697a 6174 696f 6e20 746f 2f66  rialization to/f
+0003b340: 726f 6d20 6120 6461 7461 6672 616d 652c  rom a dataframe,
+0003b350: 0a20 2020 2020 2020 2023 2065 7665 6e20  .        # even 
+0003b360: 6966 2073 6f6d 6520 7661 7269 6162 6c65  if some variable
+0003b370: 7320 6861 7665 2064 6966 6665 7265 6e74  s have different
+0003b380: 2064 696d 656e 7369 6f6e 616c 6974 792e   dimensionality.
+0003b390: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0003b3a0: 2064 6174 6166 7261 6d65 2e63 6f6c 756d   dataframe.colum
+0003b3b0: 6e73 2e69 735f 756e 6971 7565 3a0a 2020  ns.is_unique:.  
+0003b3c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0003b3d0: 5661 6c75 6545 7272 6f72 2822 6361 6e6e  ValueError("cann
+0003b3e0: 6f74 2063 6f6e 7665 7274 2044 6174 6146  ot convert DataF
+0003b3f0: 7261 6d65 2077 6974 6820 6e6f 6e2d 756e  rame with non-un
+0003b400: 6971 7565 2063 6f6c 756d 6e73 2229 0a0a  ique columns")..
+0003b410: 2020 2020 2020 2020 6964 7820 3d20 7265          idx = re
+0003b420: 6d6f 7665 5f75 6e75 7365 645f 6c65 7665  move_unused_leve
+0003b430: 6c73 5f63 6174 6567 6f72 6965 7328 6461  ls_categories(da
+0003b440: 7461 6672 616d 652e 696e 6465 7829 0a0a  taframe.index)..
+0003b450: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003b460: 7461 6e63 6528 6964 782c 2070 642e 4d75  tance(idx, pd.Mu
+0003b470: 6c74 6949 6e64 6578 2920 616e 6420 6e6f  ltiIndex) and no
+0003b480: 7420 6964 782e 6973 5f75 6e69 7175 653a  t idx.is_unique:
+0003b490: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0003b4a0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+0003b4b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0003b4c0: 6361 6e6e 6f74 2063 6f6e 7665 7274 2061  cannot convert a
+0003b4d0: 2044 6174 6146 7261 6d65 2077 6974 6820   DataFrame with 
+0003b4e0: 6120 6e6f 6e2d 756e 6971 7565 204d 756c  a non-unique Mul
+0003b4f0: 7469 496e 6465 7820 696e 746f 2078 6172  tiIndex into xar
+0003b500: 7261 7922 0a20 2020 2020 2020 2020 2020  ray".           
+0003b510: 2029 0a0a 2020 2020 2020 2020 2320 4361   )..        # Ca
+0003b520: 7374 2074 6f20 6120 4e75 6d50 7920 6172  st to a NumPy ar
+0003b530: 7261 7920 6669 7273 742c 2069 6e20 6361  ray first, in ca
+0003b540: 7365 2074 6865 2053 6572 6965 7320 6973  se the Series is
+0003b550: 2061 2070 616e 6461 7320 4578 7465 6e73   a pandas Extens
+0003b560: 696f 6e0a 2020 2020 2020 2020 2320 6172  ion.        # ar
+0003b570: 7261 7920 2877 6869 6368 2064 6f65 736e  ray (which doesn
+0003b580: 2774 2068 6176 6520 6120 7661 6c69 6420  't have a valid 
+0003b590: 4e75 6d50 7920 6474 7970 6529 0a20 2020  NumPy dtype).   
+0003b5a0: 2020 2020 2023 2054 4f44 4f3a 2061 6c6c       # TODO: all
+0003b5b0: 6f77 2075 7365 7273 2074 6f20 636f 6e74  ow users to cont
+0003b5c0: 726f 6c20 686f 7720 7468 6973 2063 6173  rol how this cas
+0003b5d0: 7469 6e67 2068 6170 7065 6e73 2c20 652e  ting happens, e.
+0003b5e0: 672e 2c20 6279 0a20 2020 2020 2020 2023  g., by.        #
+0003b5f0: 2066 6f72 7761 7264 696e 6720 6172 6775   forwarding argu
+0003b600: 6d65 6e74 7320 746f 2070 616e 6461 732e  ments to pandas.
+0003b610: 5365 7269 6573 2e74 6f5f 6e75 6d70 793f  Series.to_numpy?
+0003b620: 0a20 2020 2020 2020 2061 7272 6179 7320  .        arrays 
+0003b630: 3d20 5b28 6b2c 206e 702e 6173 6172 7261  = [(k, np.asarra
+0003b640: 7928 7629 2920 666f 7220 6b2c 2076 2069  y(v)) for k, v i
+0003b650: 6e20 6461 7461 6672 616d 652e 6974 656d  n dataframe.item
+0003b660: 7328 295d 0a0a 2020 2020 2020 2020 696e  s()]..        in
+0003b670: 6465 7865 733a 2064 6963 745b 4861 7368  dexes: dict[Hash
+0003b680: 6162 6c65 2c20 496e 6465 785d 203d 207b  able, Index] = {
+0003b690: 7d0a 2020 2020 2020 2020 696e 6465 785f  }.        index_
+0003b6a0: 7661 7273 3a20 6469 6374 5b48 6173 6861  vars: dict[Hasha
+0003b6b0: 626c 652c 2056 6172 6961 626c 655d 203d  ble, Variable] =
+0003b6c0: 207b 7d0a 0a20 2020 2020 2020 2069 6620   {}..        if 
+0003b6d0: 6973 696e 7374 616e 6365 2869 6478 2c20  isinstance(idx, 
+0003b6e0: 7064 2e4d 756c 7469 496e 6465 7829 3a0a  pd.MultiIndex):.
+0003b6f0: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
+0003b700: 203d 2074 7570 6c65 280a 2020 2020 2020   = tuple(.      
+0003b710: 2020 2020 2020 2020 2020 6e61 6d65 2069            name i
+0003b720: 6620 6e61 6d65 2069 7320 6e6f 7420 4e6f  f name is not No
+0003b730: 6e65 2065 6c73 6520 226c 6576 656c 5f25  ne else "level_%
+0003b740: 6922 2025 206e 0a20 2020 2020 2020 2020  i" % n.         
+0003b750: 2020 2020 2020 2066 6f72 206e 2c20 6e61         for n, na
+0003b760: 6d65 2069 6e20 656e 756d 6572 6174 6528  me in enumerate(
+0003b770: 6964 782e 6e61 6d65 7329 0a20 2020 2020  idx.names).     
+0003b780: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0003b790: 2020 2020 2066 6f72 2064 696d 2c20 6c65       for dim, le
+0003b7a0: 7620 696e 207a 6970 2864 696d 732c 2069  v in zip(dims, i
+0003b7b0: 6478 2e6c 6576 656c 7329 3a0a 2020 2020  dx.levels):.    
+0003b7c0: 2020 2020 2020 2020 2020 2020 7872 5f69              xr_i
+0003b7d0: 6478 203d 2050 616e 6461 7349 6e64 6578  dx = PandasIndex
+0003b7e0: 286c 6576 2c20 6469 6d29 0a20 2020 2020  (lev, dim).     
+0003b7f0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0003b800: 6573 5b64 696d 5d20 3d20 7872 5f69 6478  es[dim] = xr_idx
+0003b810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b820: 2069 6e64 6578 5f76 6172 732e 7570 6461   index_vars.upda
+0003b830: 7465 2878 725f 6964 782e 6372 6561 7465  te(xr_idx.create
+0003b840: 5f76 6172 6961 626c 6573 2829 290a 2020  _variables()).  
+0003b850: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0003b860: 2020 2020 2020 2020 696e 6465 785f 6e61          index_na
+0003b870: 6d65 203d 2069 6478 2e6e 616d 6520 6966  me = idx.name if
+0003b880: 2069 6478 2e6e 616d 6520 6973 206e 6f74   idx.name is not
+0003b890: 204e 6f6e 6520 656c 7365 2022 696e 6465   None else "inde
+0003b8a0: 7822 0a20 2020 2020 2020 2020 2020 2064  x".            d
+0003b8b0: 696d 7320 3d20 2869 6e64 6578 5f6e 616d  ims = (index_nam
+0003b8c0: 652c 290a 2020 2020 2020 2020 2020 2020  e,).            
+0003b8d0: 7872 5f69 6478 203d 2050 616e 6461 7349  xr_idx = PandasI
+0003b8e0: 6e64 6578 2869 6478 2c20 696e 6465 785f  ndex(idx, index_
+0003b8f0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+0003b900: 2020 696e 6465 7865 735b 696e 6465 785f    indexes[index_
+0003b910: 6e61 6d65 5d20 3d20 7872 5f69 6478 0a20  name] = xr_idx. 
+0003b920: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0003b930: 5f76 6172 732e 7570 6461 7465 2878 725f  _vars.update(xr_
+0003b940: 6964 782e 6372 6561 7465 5f76 6172 6961  idx.create_varia
+0003b950: 626c 6573 2829 290a 0a20 2020 2020 2020  bles())..       
+0003b960: 206f 626a 203d 2063 6c73 2e5f 636f 6e73   obj = cls._cons
+0003b970: 7472 7563 745f 6469 7265 6374 2869 6e64  truct_direct(ind
+0003b980: 6578 5f76 6172 732c 2073 6574 2869 6e64  ex_vars, set(ind
+0003b990: 6578 5f76 6172 7329 2c20 696e 6465 7865  ex_vars), indexe
+0003b9a0: 733d 696e 6465 7865 7329 0a0a 2020 2020  s=indexes)..    
+0003b9b0: 2020 2020 6966 2073 7061 7273 653a 0a20      if sparse:. 
+0003b9c0: 2020 2020 2020 2020 2020 206f 626a 2e5f             obj._
+0003b9d0: 7365 745f 7370 6172 7365 5f64 6174 615f  set_sparse_data_
+0003b9e0: 6672 6f6d 5f64 6174 6166 7261 6d65 2869  from_dataframe(i
+0003b9f0: 6478 2c20 6172 7261 7973 2c20 6469 6d73  dx, arrays, dims
+0003ba00: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0003ba10: 2020 2020 2020 2020 2020 2020 6f62 6a2e              obj.
+0003ba20: 5f73 6574 5f6e 756d 7079 5f64 6174 615f  _set_numpy_data_
+0003ba30: 6672 6f6d 5f64 6174 6166 7261 6d65 2869  from_dataframe(i
+0003ba40: 6478 2c20 6172 7261 7973 2c20 6469 6d73  dx, arrays, dims
+0003ba50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0003ba60: 206f 626a 0a0a 2020 2020 6465 6620 746f   obj..    def to
+0003ba70: 5f64 6173 6b5f 6461 7461 6672 616d 6528  _dask_dataframe(
+0003ba80: 0a20 2020 2020 2020 2073 656c 662c 2064  .        self, d
+0003ba90: 696d 5f6f 7264 6572 3a20 5365 7175 656e  im_order: Sequen
+0003baa0: 6365 5b48 6173 6861 626c 655d 207c 204e  ce[Hashable] | N
+0003bab0: 6f6e 6520 3d20 4e6f 6e65 2c20 7365 745f  one = None, set_
+0003bac0: 696e 6465 783a 2062 6f6f 6c20 3d20 4661  index: bool = Fa
+0003bad0: 6c73 650a 2020 2020 2920 2d3e 2044 6173  lse.    ) -> Das
+0003bae0: 6b44 6174 6146 7261 6d65 3a0a 2020 2020  kDataFrame:.    
+0003baf0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0003bb00: 436f 6e76 6572 7420 7468 6973 2064 6174  Convert this dat
+0003bb10: 6173 6574 2069 6e74 6f20 6120 6461 736b  aset into a dask
+0003bb20: 2e64 6174 6166 7261 6d65 2e44 6174 6146  .dataframe.DataF
+0003bb30: 7261 6d65 2e0a 0a20 2020 2020 2020 2054  rame...        T
+0003bb40: 6865 2064 696d 656e 7369 6f6e 732c 2063  he dimensions, c
+0003bb50: 6f6f 7264 696e 6174 6573 2061 6e64 2064  oordinates and d
+0003bb60: 6174 6120 7661 7269 6162 6c65 7320 696e  ata variables in
+0003bb70: 2074 6869 7320 6461 7461 7365 7420 666f   this dataset fo
+0003bb80: 726d 0a20 2020 2020 2020 2074 6865 2063  rm.        the c
+0003bb90: 6f6c 756d 6e73 206f 6620 7468 6520 4461  olumns of the Da
+0003bba0: 7461 4672 616d 652e 0a0a 2020 2020 2020  taFrame...      
+0003bbb0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0003bbc0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0003bbd0: 2020 2020 2020 2020 6469 6d5f 6f72 6465          dim_orde
+0003bbe0: 7220 3a20 6c69 7374 2c20 6f70 7469 6f6e  r : list, option
+0003bbf0: 616c 0a20 2020 2020 2020 2020 2020 2048  al.            H
+0003bc00: 6965 7261 7263 6869 6361 6c20 6469 6d65  ierarchical dime
+0003bc10: 6e73 696f 6e20 6f72 6465 7220 666f 7220  nsion order for 
+0003bc20: 7468 6520 7265 7375 6c74 696e 6720 6461  the resulting da
+0003bc30: 7461 6672 616d 652e 2041 6c6c 0a20 2020  taframe. All.   
+0003bc40: 2020 2020 2020 2020 2061 7272 6179 7320           arrays 
+0003bc50: 6172 6520 7472 616e 7370 6f73 6564 2074  are transposed t
+0003bc60: 6f20 7468 6973 206f 7264 6572 2061 6e64  o this order and
+0003bc70: 2074 6865 6e20 7772 6974 7465 6e20 6f75   then written ou
+0003bc80: 7420 6173 2066 6c61 740a 2020 2020 2020  t as flat.      
+0003bc90: 2020 2020 2020 7665 6374 6f72 7320 696e        vectors in
+0003bca0: 2063 6f6e 7469 6775 6f75 7320 6f72 6465   contiguous orde
+0003bcb0: 722c 2073 6f20 7468 6520 6c61 7374 2064  r, so the last d
+0003bcc0: 696d 656e 7369 6f6e 2069 6e20 7468 6973  imension in this
+0003bcd0: 206c 6973 740a 2020 2020 2020 2020 2020   list.          
+0003bce0: 2020 7769 6c6c 2062 6520 636f 6e74 6967    will be contig
+0003bcf0: 756f 7573 2069 6e20 7468 6520 7265 7375  uous in the resu
+0003bd00: 6c74 696e 6720 4461 7461 4672 616d 652e  lting DataFrame.
+0003bd10: 2054 6869 7320 6861 7320 6120 6d61 6a6f   This has a majo
+0003bd20: 720a 2020 2020 2020 2020 2020 2020 696e  r.            in
+0003bd30: 666c 7565 6e63 6520 6f6e 2077 6869 6368  fluence on which
+0003bd40: 206f 7065 7261 7469 6f6e 7320 6172 6520   operations are 
+0003bd50: 6566 6669 6369 656e 7420 6f6e 2074 6865  efficient on the
+0003bd60: 2072 6573 756c 7469 6e67 2064 6173 6b0a   resulting dask.
+0003bd70: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0003bd80: 6672 616d 652e 0a0a 2020 2020 2020 2020  frame...        
+0003bd90: 2020 2020 4966 2070 726f 7669 6465 642c      If provided,
+0003bda0: 206d 7573 7420 696e 636c 7564 6520 616c   must include al
+0003bdb0: 6c20 6469 6d65 6e73 696f 6e73 206f 6620  l dimensions of 
+0003bdc0: 7468 6973 2064 6174 6173 6574 2e20 4279  this dataset. By
+0003bdd0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+0003bde0: 6175 6c74 2c20 6469 6d65 6e73 696f 6e73  ault, dimensions
+0003bdf0: 2061 7265 2073 6f72 7465 6420 616c 7068   are sorted alph
+0003be00: 6162 6574 6963 616c 6c79 2e0a 2020 2020  abetically..    
+0003be10: 2020 2020 7365 745f 696e 6465 7820 3a20      set_index : 
+0003be20: 626f 6f6c 2c20 6465 6661 756c 743a 2046  bool, default: F
+0003be30: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0003be40: 2049 6620 7365 745f 696e 6465 783d 5472   If set_index=Tr
+0003be50: 7565 2c20 7468 6520 6461 736b 2044 6174  ue, the dask Dat
+0003be60: 6146 7261 6d65 2069 7320 696e 6465 7865  aFrame is indexe
+0003be70: 6420 6279 2074 6869 7320 6461 7461 7365  d by this datase
+0003be80: 7427 730a 2020 2020 2020 2020 2020 2020  t's.            
+0003be90: 636f 6f72 6469 6e61 7465 2e20 5369 6e63  coordinate. Sinc
+0003bea0: 6520 6461 736b 2044 6174 6146 7261 6d65  e dask DataFrame
+0003beb0: 7320 646f 206e 6f74 2073 7570 706f 7274  s do not support
+0003bec0: 206d 756c 7469 2d69 6e64 6578 6573 2c0a   multi-indexes,.
+0003bed0: 2020 2020 2020 2020 2020 2020 7365 745f              set_
+0003bee0: 696e 6465 7820 6f6e 6c79 2077 6f72 6b73  index only works
+0003bef0: 2069 6620 7468 6520 6461 7461 7365 7420   if the dataset 
+0003bf00: 6f6e 6c79 2063 6f6e 7461 696e 7320 6f6e  only contains on
+0003bf10: 6520 6469 6d65 6e73 696f 6e2e 0a0a 2020  e dimension...  
+0003bf20: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+0003bf30: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+0003bf40: 2020 2020 2020 6461 736b 2e64 6174 6166        dask.dataf
+0003bf50: 7261 6d65 2e44 6174 6146 7261 6d65 0a20  rame.DataFrame. 
+0003bf60: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0003bf70: 2020 2020 696d 706f 7274 2064 6173 6b2e      import dask.
+0003bf80: 6172 7261 7920 6173 2064 610a 2020 2020  array as da.    
+0003bf90: 2020 2020 696d 706f 7274 2064 6173 6b2e      import dask.
+0003bfa0: 6461 7461 6672 616d 6520 6173 2064 640a  dataframe as dd.
+0003bfb0: 0a20 2020 2020 2020 206f 7264 6572 6564  .        ordered
+0003bfc0: 5f64 696d 7320 3d20 7365 6c66 2e5f 6e6f  _dims = self._no
+0003bfd0: 726d 616c 697a 655f 6469 6d5f 6f72 6465  rmalize_dim_orde
+0003bfe0: 7228 6469 6d5f 6f72 6465 723d 6469 6d5f  r(dim_order=dim_
+0003bff0: 6f72 6465 7229 0a0a 2020 2020 2020 2020  order)..        
+0003c000: 636f 6c75 6d6e 7320 3d20 6c69 7374 286f  columns = list(o
+0003c010: 7264 6572 6564 5f64 696d 7329 0a20 2020  rdered_dims).   
+0003c020: 2020 2020 2063 6f6c 756d 6e73 2e65 7874       columns.ext
+0003c030: 656e 6428 6b20 666f 7220 6b20 696e 2073  end(k for k in s
+0003c040: 656c 662e 636f 6f72 6473 2069 6620 6b20  elf.coords if k 
+0003c050: 6e6f 7420 696e 2073 656c 662e 6469 6d73  not in self.dims
+0003c060: 290a 2020 2020 2020 2020 636f 6c75 6d6e  ).        column
+0003c070: 732e 6578 7465 6e64 2873 656c 662e 6461  s.extend(self.da
+0003c080: 7461 5f76 6172 7329 0a0a 2020 2020 2020  ta_vars)..      
+0003c090: 2020 7365 7269 6573 5f6c 6973 7420 3d20    series_list = 
+0003c0a0: 5b5d 0a20 2020 2020 2020 2066 6f72 206e  [].        for n
+0003c0b0: 616d 6520 696e 2063 6f6c 756d 6e73 3a0a  ame in columns:.
+0003c0c0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0003c0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c0e0: 2076 6172 203d 2073 656c 662e 7661 7269   var = self.vari
+0003c0f0: 6162 6c65 735b 6e61 6d65 5d0a 2020 2020  ables[name].    
+0003c100: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+0003c110: 6579 4572 726f 723a 0a20 2020 2020 2020  eyError:.       
+0003c120: 2020 2020 2020 2020 2023 2064 696d 656e           # dimen
+0003c130: 7369 6f6e 2077 6974 686f 7574 2061 206d  sion without a m
+0003c140: 6174 6368 696e 6720 636f 6f72 6469 6e61  atching coordina
+0003c150: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
+0003c160: 2020 2073 697a 6520 3d20 7365 6c66 2e64     size = self.d
+0003c170: 696d 735b 6e61 6d65 5d0a 2020 2020 2020  ims[name].      
+0003c180: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+0003c190: 2064 612e 6172 616e 6765 2873 697a 652c   da.arange(size,
+0003c1a0: 2063 6875 6e6b 733d 7369 7a65 2c20 6474   chunks=size, dt
+0003c1b0: 7970 653d 6e70 2e69 6e74 3634 290a 2020  ype=np.int64).  
+0003c1c0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0003c1d0: 7220 3d20 5661 7269 6162 6c65 2828 6e61  r = Variable((na
+0003c1e0: 6d65 2c29 2c20 6461 7461 290a 0a20 2020  me,), data)..   
+0003c1f0: 2020 2020 2020 2020 2023 2049 6e64 6578           # Index
+0003c200: 5661 7269 6162 6c65 206f 626a 6563 7473  Variable objects
+0003c210: 2068 6176 6520 6120 6475 6d6d 7920 2e63   have a dummy .c
+0003c220: 6875 6e6b 2829 206d 6574 686f 640a 2020  hunk() method.  
+0003c230: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0003c240: 6e73 7461 6e63 6528 7661 722c 2049 6e64  nstance(var, Ind
+0003c250: 6578 5661 7269 6162 6c65 293a 0a20 2020  exVariable):.   
+0003c260: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0003c270: 203d 2076 6172 2e74 6f5f 6261 7365 5f76   = var.to_base_v
+0003c280: 6172 6961 626c 6528 290a 0a20 2020 2020  ariable()..     
+0003c290: 2020 2020 2020 2023 204d 616b 6520 7375         # Make su
+0003c2a0: 7265 2076 6172 2069 7320 6120 6461 736b  re var is a dask
+0003c2b0: 2061 7272 6179 2c20 6f74 6865 7277 6973   array, otherwis
+0003c2c0: 6520 7468 6520 6172 7261 7920 6361 6e20  e the array can 
+0003c2d0: 6265 636f 6d65 2074 6f6f 206c 6172 6765  become too large
+0003c2e0: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
+0003c2f0: 6865 6e20 6974 2069 7320 6272 6f61 6463  hen it is broadc
+0003c300: 6173 7465 6420 746f 2073 6576 6572 616c  asted to several
+0003c310: 2064 696d 656e 7369 6f6e 733a 0a20 2020   dimensions:.   
+0003c320: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0003c330: 6973 5f64 7563 6b5f 6461 736b 5f61 7272  is_duck_dask_arr
+0003c340: 6179 2876 6172 2e5f 6461 7461 293a 0a20  ay(var._data):. 
+0003c350: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0003c360: 6172 203d 2076 6172 2e63 6875 6e6b 2829  ar = var.chunk()
+0003c370: 0a0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+0003c380: 736b 5f61 7272 6179 203d 2076 6172 2e73  sk_array = var.s
+0003c390: 6574 5f64 696d 7328 6f72 6465 7265 645f  et_dims(ordered_
+0003c3a0: 6469 6d73 292e 6368 756e 6b28 7365 6c66  dims).chunk(self
+0003c3b0: 2e63 6875 6e6b 7329 2e64 6174 610a 2020  .chunks).data.  
+0003c3c0: 2020 2020 2020 2020 2020 7365 7269 6573            series
+0003c3d0: 203d 2064 642e 6672 6f6d 5f61 7272 6179   = dd.from_array
+0003c3e0: 2864 6173 6b5f 6172 7261 792e 7265 7368  (dask_array.resh
+0003c3f0: 6170 6528 2d31 292c 2063 6f6c 756d 6e73  ape(-1), columns
+0003c400: 3d5b 6e61 6d65 5d29 0a20 2020 2020 2020  =[name]).       
+0003c410: 2020 2020 2073 6572 6965 735f 6c69 7374       series_list
+0003c420: 2e61 7070 656e 6428 7365 7269 6573 290a  .append(series).
+0003c430: 0a20 2020 2020 2020 2064 6620 3d20 6464  .        df = dd
+0003c440: 2e63 6f6e 6361 7428 7365 7269 6573 5f6c  .concat(series_l
+0003c450: 6973 742c 2061 7869 733d 3129 0a0a 2020  ist, axis=1)..  
+0003c460: 2020 2020 2020 6966 2073 6574 5f69 6e64        if set_ind
+0003c470: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
+0003c480: 6469 6d5f 6f72 6465 7220 3d20 5b2a 6f72  dim_order = [*or
+0003c490: 6465 7265 645f 6469 6d73 5d0a 0a20 2020  dered_dims]..   
+0003c4a0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0003c4b0: 6469 6d5f 6f72 6465 7229 203d 3d20 313a  dim_order) == 1:
+0003c4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c4d0: 2028 6469 6d2c 2920 3d20 6469 6d5f 6f72   (dim,) = dim_or
+0003c4e0: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+0003c4f0: 2020 2020 6466 203d 2064 662e 7365 745f      df = df.set_
+0003c500: 696e 6465 7828 6469 6d29 0a20 2020 2020  index(dim).     
+0003c510: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003c520: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+0003c530: 7269 6767 6572 7320 616e 2065 7272 6f72  riggers an error
+0003c540: 2061 626f 7574 206d 756c 7469 2d69 6e64   about multi-ind
+0003c550: 6578 6573 2c20 6576 656e 2069 6620 6f6e  exes, even if on
+0003c560: 6c79 206f 6e65 0a20 2020 2020 2020 2020  ly one.         
+0003c570: 2020 2020 2020 2023 2064 696d 656e 7369         # dimensi
+0003c580: 6f6e 2069 7320 7061 7373 6564 0a20 2020  on is passed.   
+0003c590: 2020 2020 2020 2020 2020 2020 2064 6620               df 
+0003c5a0: 3d20 6466 2e73 6574 5f69 6e64 6578 2864  = df.set_index(d
+0003c5b0: 696d 5f6f 7264 6572 290a 0a20 2020 2020  im_order)..     
+0003c5c0: 2020 2072 6574 7572 6e20 6466 0a0a 2020     return df..  
+0003c5d0: 2020 6465 6620 746f 5f64 6963 7428 0a20    def to_dict(. 
+0003c5e0: 2020 2020 2020 2073 656c 662c 2064 6174         self, dat
+0003c5f0: 613a 2062 6f6f 6c20 7c20 4c69 7465 7261  a: bool | Litera
+0003c600: 6c5b 226c 6973 7422 2c20 2261 7272 6179  l["list", "array
+0003c610: 225d 203d 2022 6c69 7374 222c 2065 6e63  "] = "list", enc
+0003c620: 6f64 696e 673a 2062 6f6f 6c20 3d20 4661  oding: bool = Fa
+0003c630: 6c73 650a 2020 2020 2920 2d3e 2064 6963  lse.    ) -> dic
+0003c640: 745b 7374 722c 2041 6e79 5d3a 0a20 2020  t[str, Any]:.   
+0003c650: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0003c660: 2043 6f6e 7665 7274 2074 6869 7320 6461   Convert this da
+0003c670: 7461 7365 7420 746f 2061 2064 6963 7469  taset to a dicti
+0003c680: 6f6e 6172 7920 666f 6c6c 6f77 696e 6720  onary following 
+0003c690: 7861 7272 6179 206e 616d 696e 670a 2020  xarray naming.  
+0003c6a0: 2020 2020 2020 636f 6e76 656e 7469 6f6e        convention
+0003c6b0: 732e 0a0a 2020 2020 2020 2020 436f 6e76  s...        Conv
+0003c6c0: 6572 7473 2061 6c6c 2076 6172 6961 626c  erts all variabl
+0003c6d0: 6573 2061 6e64 2061 7474 7269 6275 7465  es and attribute
+0003c6e0: 7320 746f 206e 6174 6976 6520 5079 7468  s to native Pyth
+0003c6f0: 6f6e 206f 626a 6563 7473 0a20 2020 2020  on objects.     
+0003c700: 2020 2055 7365 6675 6c20 666f 7220 636f     Useful for co
+0003c710: 6e76 6572 7469 6e67 2074 6f20 6a73 6f6e  nverting to json
+0003c720: 2e20 546f 2061 766f 6964 2064 6174 6574  . To avoid datet
+0003c730: 696d 6520 696e 636f 6d70 6174 6962 696c  ime incompatibil
+0003c740: 6974 790a 2020 2020 2020 2020 7573 6520  ity.        use 
+0003c750: 6465 636f 6465 5f74 696d 6573 3d46 616c  decode_times=Fal
+0003c760: 7365 206b 7761 7267 2069 6e20 7861 7272  se kwarg in xarr
+0003c770: 7261 792e 6f70 656e 5f64 6174 6173 6574  ray.open_dataset
+0003c780: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0003c790: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0003c7a0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0003c7b0: 2064 6174 6120 3a20 626f 6f6c 206f 7220   data : bool or 
+0003c7c0: 7b22 6c69 7374 222c 2022 6172 7261 7922  {"list", "array"
+0003c7d0: 7d2c 2064 6566 6175 6c74 3a20 226c 6973  }, default: "lis
+0003c7e0: 7422 0a20 2020 2020 2020 2020 2020 2057  t".            W
+0003c7f0: 6865 7468 6572 2074 6f20 696e 636c 7564  hether to includ
+0003c800: 6520 7468 6520 6163 7475 616c 2064 6174  e the actual dat
+0003c810: 6120 696e 2074 6865 2064 6963 7469 6f6e  a in the diction
+0003c820: 6172 792e 2057 6865 6e20 7365 7420 746f  ary. When set to
+0003c830: 0a20 2020 2020 2020 2020 2020 2046 616c  .            Fal
+0003c840: 7365 2c20 7265 7475 726e 7320 6a75 7374  se, returns just
+0003c850: 2074 6865 2073 6368 656d 612e 2049 6620   the schema. If 
+0003c860: 7365 7420 746f 2022 6172 7261 7922 2c20  set to "array", 
+0003c870: 7265 7475 726e 7320 6461 7461 2061 730a  returns data as.
+0003c880: 2020 2020 2020 2020 2020 2020 756e 6465              unde
+0003c890: 726c 7969 6e67 2061 7272 6179 2074 7970  rlying array typ
+0003c8a0: 652e 2049 6620 7365 7420 746f 2022 6c69  e. If set to "li
+0003c8b0: 7374 2220 286f 7220 5472 7565 2066 6f72  st" (or True for
+0003c8c0: 2062 6163 6b77 6172 6473 0a20 2020 2020   backwards.     
+0003c8d0: 2020 2020 2020 2063 6f6d 7061 7469 6269         compatibi
+0003c8e0: 6c69 7479 292c 2072 6574 7572 6e73 2064  lity), returns d
+0003c8f0: 6174 6120 696e 206c 6973 7473 206f 6620  ata in lists of 
+0003c900: 5079 7468 6f6e 2064 6174 6120 7479 7065  Python data type
+0003c910: 732e 204e 6f74 650a 2020 2020 2020 2020  s. Note.        
+0003c920: 2020 2020 7468 6174 2066 6f72 206f 6274      that for obt
+0003c930: 6169 6e69 6e67 2074 6865 2022 6c69 7374  aining the "list
+0003c940: 2220 6f75 7470 7574 2065 6666 6963 6965  " output efficie
+0003c950: 6e74 6c79 2c20 7573 650a 2020 2020 2020  ntly, use.      
+0003c960: 2020 2020 2020 6064 732e 636f 6d70 7574        `ds.comput
+0003c970: 6528 292e 746f 5f64 6963 7428 6461 7461  e().to_dict(data
+0003c980: 3d22 6c69 7374 2229 602e 0a0a 2020 2020  ="list")`...    
+0003c990: 2020 2020 656e 636f 6469 6e67 203a 2062      encoding : b
+0003c9a0: 6f6f 6c2c 2064 6566 6175 6c74 3a20 4661  ool, default: Fa
+0003c9b0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0003c9c0: 5768 6574 6865 7220 746f 2069 6e63 6c75  Whether to inclu
+0003c9d0: 6465 2074 6865 2044 6174 6173 6574 2773  de the Dataset's
+0003c9e0: 2065 6e63 6f64 696e 6720 696e 2074 6865   encoding in the
+0003c9f0: 2064 6963 7469 6f6e 6172 792e 0a0a 2020   dictionary...  
+0003ca00: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+0003ca10: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+0003ca20: 2020 2020 2020 6420 3a20 6469 6374 0a20        d : dict. 
+0003ca30: 2020 2020 2020 2020 2020 2044 6963 7420             Dict 
+0003ca40: 7769 7468 206b 6579 733a 2022 636f 6f72  with keys: "coor
+0003ca50: 6473 222c 2022 6174 7472 7322 2c20 2264  ds", "attrs", "d
+0003ca60: 696d 7322 2c20 2264 6174 615f 7661 7273  ims", "data_vars
+0003ca70: 2220 616e 6420 6f70 7469 6f6e 616c 6c79  " and optionally
+0003ca80: 0a20 2020 2020 2020 2020 2020 2022 656e  .            "en
+0003ca90: 636f 6469 6e67 222e 0a0a 2020 2020 2020  coding"...      
+0003caa0: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+0003cab0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0003cac0: 2020 2020 4461 7461 7365 742e 6672 6f6d      Dataset.from
+0003cad0: 5f64 6963 740a 2020 2020 2020 2020 4461  _dict.        Da
+0003cae0: 7461 4172 7261 792e 746f 5f64 6963 740a  taArray.to_dict.
+0003caf0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0003cb00: 2020 2020 643a 2064 6963 7420 3d20 7b0a      d: dict = {.
+0003cb10: 2020 2020 2020 2020 2020 2020 2263 6f6f              "coo
+0003cb20: 7264 7322 3a20 7b7d 2c0a 2020 2020 2020  rds": {},.      
+0003cb30: 2020 2020 2020 2261 7474 7273 223a 2064        "attrs": d
+0003cb40: 6563 6f64 655f 6e75 6d70 795f 6469 6374  ecode_numpy_dict
+0003cb50: 5f76 616c 7565 7328 7365 6c66 2e61 7474  _values(self.att
+0003cb60: 7273 292c 0a20 2020 2020 2020 2020 2020  rs),.           
+0003cb70: 2022 6469 6d73 223a 2064 6963 7428 7365   "dims": dict(se
+0003cb80: 6c66 2e64 696d 7329 2c0a 2020 2020 2020  lf.dims),.      
+0003cb90: 2020 2020 2020 2264 6174 615f 7661 7273        "data_vars
+0003cba0: 223a 207b 7d2c 0a20 2020 2020 2020 207d  ": {},.        }
+0003cbb0: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
+0003cbc0: 6e20 7365 6c66 2e63 6f6f 7264 733a 0a20  n self.coords:. 
+0003cbd0: 2020 2020 2020 2020 2020 2064 5b22 636f             d["co
+0003cbe0: 6f72 6473 225d 2e75 7064 6174 6528 0a20  ords"].update(. 
+0003cbf0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+0003cc00: 6b3a 2073 656c 665b 6b5d 2e76 6172 6961  k: self[k].varia
+0003cc10: 626c 652e 746f 5f64 6963 7428 6461 7461  ble.to_dict(data
+0003cc20: 3d64 6174 612c 2065 6e63 6f64 696e 673d  =data, encoding=
+0003cc30: 656e 636f 6469 6e67 297d 0a20 2020 2020  encoding)}.     
+0003cc40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0003cc50: 2066 6f72 206b 2069 6e20 7365 6c66 2e64   for k in self.d
+0003cc60: 6174 615f 7661 7273 3a0a 2020 2020 2020  ata_vars:.      
+0003cc70: 2020 2020 2020 645b 2264 6174 615f 7661        d["data_va
+0003cc80: 7273 225d 2e75 7064 6174 6528 0a20 2020  rs"].update(.   
+0003cc90: 2020 2020 2020 2020 2020 2020 207b 6b3a               {k:
+0003cca0: 2073 656c 665b 6b5d 2e76 6172 6961 626c   self[k].variabl
+0003ccb0: 652e 746f 5f64 6963 7428 6461 7461 3d64  e.to_dict(data=d
+0003ccc0: 6174 612c 2065 6e63 6f64 696e 673d 656e  ata, encoding=en
+0003ccd0: 636f 6469 6e67 297d 0a20 2020 2020 2020  coding)}.       
+0003cce0: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
+0003ccf0: 6620 656e 636f 6469 6e67 3a0a 2020 2020  f encoding:.    
+0003cd00: 2020 2020 2020 2020 645b 2265 6e63 6f64          d["encod
+0003cd10: 696e 6722 5d20 3d20 6469 6374 2873 656c  ing"] = dict(sel
+0003cd20: 662e 656e 636f 6469 6e67 290a 2020 2020  f.encoding).    
+0003cd30: 2020 2020 7265 7475 726e 2064 0a0a 2020      return d..  
+0003cd40: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0003cd50: 2020 2064 6566 2066 726f 6d5f 6469 6374     def from_dict
+0003cd60: 2863 6c73 3a20 7479 7065 5b54 5f44 6174  (cls: type[T_Dat
+0003cd70: 6173 6574 5d2c 2064 3a20 4d61 7070 696e  aset], d: Mappin
+0003cd80: 675b 416e 792c 2041 6e79 5d29 202d 3e20  g[Any, Any]) -> 
+0003cd90: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+0003cda0: 2020 2022 2222 436f 6e76 6572 7420 6120     """Convert a 
+0003cdb0: 6469 6374 696f 6e61 7279 2069 6e74 6f20  dictionary into 
+0003cdc0: 616e 2078 6172 7261 792e 4461 7461 7365  an xarray.Datase
+0003cdd0: 742e 0a0a 2020 2020 2020 2020 5061 7261  t...        Para
+0003cde0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+0003cdf0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+0003ce00: 2020 6420 3a20 6469 6374 2d6c 696b 650a    d : dict-like.
+0003ce10: 2020 2020 2020 2020 2020 2020 4d61 7070              Mapp
+0003ce20: 696e 6720 7769 7468 2061 206d 696e 696d  ing with a minim
+0003ce30: 756d 2073 7472 7563 7475 7265 206f 660a  um structure of.
+0003ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ce50: 6060 7b22 7661 725f 3022 3a20 7b22 6469  ``{"var_0": {"di
+0003ce60: 6d73 223a 205b 2e2e 5d2c 2022 6461 7461  ms": [..], "data
+0003ce70: 223a 205b 2e2e 5d7d 2c20 5c0a 2020 2020  ": [..]}, \.    
+0003ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ce90: 2020 2020 2020 2020 2e2e 2e7d 6060 0a0a          ...}``..
+0003cea0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+0003ceb0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+0003cec0: 2020 2020 2020 2020 6f62 6a20 3a20 4461          obj : Da
+0003ced0: 7461 7365 740a 0a20 2020 2020 2020 2053  taset..        S
+0003cee0: 6565 2061 6c73 6f0a 2020 2020 2020 2020  ee also.        
+0003cef0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0003cf00: 2044 6174 6173 6574 2e74 6f5f 6469 6374   Dataset.to_dict
+0003cf10: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
+0003cf20: 6179 2e66 726f 6d5f 6469 6374 0a0a 2020  ay.from_dict..  
+0003cf30: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
+0003cf40: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+0003cf50: 2020 2020 2020 2020 3e3e 3e20 6420 3d20          >>> d = 
+0003cf60: 7b0a 2020 2020 2020 2020 2e2e 2e20 2020  {.        ...   
+0003cf70: 2020 2274 223a 207b 2264 696d 7322 3a20    "t": {"dims": 
+0003cf80: 2822 7422 292c 2022 6461 7461 223a 205b  ("t"), "data": [
+0003cf90: 302c 2031 2c20 325d 7d2c 0a20 2020 2020  0, 1, 2]},.     
+0003cfa0: 2020 202e 2e2e 2020 2020 2022 6122 3a20     ...     "a": 
+0003cfb0: 7b22 6469 6d73 223a 2028 2274 2229 2c20  {"dims": ("t"), 
+0003cfc0: 2264 6174 6122 3a20 5b22 6122 2c20 2262  "data": ["a", "b
+0003cfd0: 222c 2022 6322 5d7d 2c0a 2020 2020 2020  ", "c"]},.      
+0003cfe0: 2020 2e2e 2e20 2020 2020 2262 223a 207b    ...     "b": {
+0003cff0: 2264 696d 7322 3a20 2822 7422 292c 2022  "dims": ("t"), "
+0003d000: 6461 7461 223a 205b 3130 2c20 3230 2c20  data": [10, 20, 
+0003d010: 3330 5d7d 2c0a 2020 2020 2020 2020 2e2e  30]},.        ..
+0003d020: 2e20 7d0a 2020 2020 2020 2020 3e3e 3e20  . }.        >>> 
+0003d030: 6473 203d 2078 722e 4461 7461 7365 742e  ds = xr.Dataset.
+0003d040: 6672 6f6d 5f64 6963 7428 6429 0a20 2020  from_dict(d).   
+0003d050: 2020 2020 203e 3e3e 2064 730a 2020 2020       >>> ds.    
+0003d060: 2020 2020 3c78 6172 7261 792e 4461 7461      <xarray.Data
+0003d070: 7365 743e 0a20 2020 2020 2020 2044 696d  set>.        Dim
+0003d080: 656e 7369 6f6e 733a 2020 2874 3a20 3329  ensions:  (t: 3)
+0003d090: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
+0003d0a0: 6174 6573 3a0a 2020 2020 2020 2020 2020  ates:.          
+0003d0b0: 2a20 7420 2020 2020 2020 2028 7429 2069  * t        (t) i
+0003d0c0: 6e74 3634 2030 2031 2032 0a20 2020 2020  nt64 0 1 2.     
+0003d0d0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+0003d0e0: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
+0003d0f0: 2020 2020 2020 2020 2874 2920 3c55 3120          (t) <U1 
+0003d100: 2761 2720 2762 2720 2763 270a 2020 2020  'a' 'b' 'c'.    
+0003d110: 2020 2020 2020 2020 6220 2020 2020 2020          b       
+0003d120: 2028 7429 2069 6e74 3634 2031 3020 3230   (t) int64 10 20
+0003d130: 2033 300a 0a20 2020 2020 2020 203e 3e3e   30..        >>>
+0003d140: 2064 203d 207b 0a20 2020 2020 2020 202e   d = {.        .
+0003d150: 2e2e 2020 2020 2022 636f 6f72 6473 223a  ..     "coords":
+0003d160: 207b 0a20 2020 2020 2020 202e 2e2e 2020   {.        ...  
+0003d170: 2020 2020 2020 2022 7422 3a20 7b22 6469         "t": {"di
+0003d180: 6d73 223a 2022 7422 2c20 2264 6174 6122  ms": "t", "data"
+0003d190: 3a20 5b30 2c20 312c 2032 5d2c 2022 6174  : [0, 1, 2], "at
+0003d1a0: 7472 7322 3a20 7b22 756e 6974 7322 3a20  trs": {"units": 
+0003d1b0: 2273 227d 7d0a 2020 2020 2020 2020 2e2e  "s"}}.        ..
+0003d1c0: 2e20 2020 2020 7d2c 0a20 2020 2020 2020  .     },.       
+0003d1d0: 202e 2e2e 2020 2020 2022 6174 7472 7322   ...     "attrs"
+0003d1e0: 3a20 7b22 7469 746c 6522 3a20 2261 6972  : {"title": "air
+0003d1f0: 2074 656d 7065 7261 7475 7265 227d 2c0a   temperature"},.
+0003d200: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0003d210: 2264 696d 7322 3a20 2274 222c 0a20 2020  "dims": "t",.   
+0003d220: 2020 2020 202e 2e2e 2020 2020 2022 6461       ...     "da
+0003d230: 7461 5f76 6172 7322 3a20 7b0a 2020 2020  ta_vars": {.    
+0003d240: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+0003d250: 2261 223a 207b 2264 696d 7322 3a20 2274  "a": {"dims": "t
+0003d260: 222c 2022 6461 7461 223a 205b 3130 2c20  ", "data": [10, 
+0003d270: 3230 2c20 3330 5d7d 2c0a 2020 2020 2020  20, 30]},.      
+0003d280: 2020 2e2e 2e20 2020 2020 2020 2020 2262    ...         "b
+0003d290: 223a 207b 2264 696d 7322 3a20 2274 222c  ": {"dims": "t",
+0003d2a0: 2022 6461 7461 223a 205b 2261 222c 2022   "data": ["a", "
+0003d2b0: 6222 2c20 2263 225d 7d2c 0a20 2020 2020  b", "c"]},.     
+0003d2c0: 2020 202e 2e2e 2020 2020 207d 2c0a 2020     ...     },.  
+0003d2d0: 2020 2020 2020 2e2e 2e20 7d0a 2020 2020        ... }.    
+0003d2e0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
+0003d2f0: 4461 7461 7365 742e 6672 6f6d 5f64 6963  Dataset.from_dic
+0003d300: 7428 6429 0a20 2020 2020 2020 203e 3e3e  t(d).        >>>
+0003d310: 2064 730a 2020 2020 2020 2020 3c78 6172   ds.        <xar
+0003d320: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+0003d330: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+0003d340: 2020 2874 3a20 3329 0a20 2020 2020 2020    (t: 3).       
+0003d350: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+0003d360: 2020 2020 2020 2020 2a20 7420 2020 2020          * t     
+0003d370: 2020 2028 7429 2069 6e74 3634 2030 2031     (t) int64 0 1
+0003d380: 2032 0a20 2020 2020 2020 2044 6174 6120   2.        Data 
+0003d390: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+0003d3a0: 2020 2020 2020 2061 2020 2020 2020 2020         a        
+0003d3b0: 2874 2920 696e 7436 3420 3130 2032 3020  (t) int64 10 20 
+0003d3c0: 3330 0a20 2020 2020 2020 2020 2020 2062  30.            b
+0003d3d0: 2020 2020 2020 2020 2874 2920 3c55 3120          (t) <U1 
+0003d3e0: 2761 2720 2762 2720 2763 270a 2020 2020  'a' 'b' 'c'.    
+0003d3f0: 2020 2020 4174 7472 6962 7574 6573 3a0a      Attributes:.
+0003d400: 2020 2020 2020 2020 2020 2020 7469 746c              titl
+0003d410: 653a 2020 2020 6169 7220 7465 6d70 6572  e:    air temper
+0003d420: 6174 7572 650a 0a20 2020 2020 2020 2022  ature..        "
+0003d430: 2222 0a0a 2020 2020 2020 2020 7661 7269  ""..        vari
+0003d440: 6162 6c65 733a 2049 7465 7261 626c 655b  ables: Iterable[
+0003d450: 7475 706c 655b 4861 7368 6162 6c65 2c20  tuple[Hashable, 
+0003d460: 416e 795d 5d0a 2020 2020 2020 2020 6966  Any]].        if
+0003d470: 206e 6f74 207b 2263 6f6f 7264 7322 2c20   not {"coords", 
+0003d480: 2264 6174 615f 7661 7273 227d 2e69 7373  "data_vars"}.iss
+0003d490: 7562 7365 7428 7365 7428 6429 293a 0a20  ubset(set(d)):. 
+0003d4a0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0003d4b0: 626c 6573 203d 2064 2e69 7465 6d73 2829  bles = d.items()
+0003d4c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0003d4d0: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+0003d4e0: 7420 6974 6572 746f 6f6c 730a 0a20 2020  t itertools..   
+0003d4f0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0003d500: 6573 203d 2069 7465 7274 6f6f 6c73 2e63  es = itertools.c
+0003d510: 6861 696e 280a 2020 2020 2020 2020 2020  hain(.          
+0003d520: 2020 2020 2020 642e 6765 7428 2263 6f6f        d.get("coo
+0003d530: 7264 7322 2c20 7b7d 292e 6974 656d 7328  rds", {}).items(
+0003d540: 292c 2064 2e67 6574 2822 6461 7461 5f76  ), d.get("data_v
+0003d550: 6172 7322 2c20 7b7d 292e 6974 656d 7328  ars", {}).items(
+0003d560: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0003d570: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0003d580: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0003d590: 655f 6469 6374 203d 207b 0a20 2020 2020  e_dict = {.     
+0003d5a0: 2020 2020 2020 2020 2020 206b 3a20 2876             k: (v
+0003d5b0: 5b22 6469 6d73 225d 2c20 765b 2264 6174  ["dims"], v["dat
+0003d5c0: 6122 5d2c 2076 2e67 6574 2822 6174 7472  a"], v.get("attr
+0003d5d0: 7322 292c 2076 2e67 6574 2822 656e 636f  s"), v.get("enco
+0003d5e0: 6469 6e67 2229 290a 2020 2020 2020 2020  ding")).        
+0003d5f0: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+0003d600: 2069 6e20 7661 7269 6162 6c65 730a 2020   in variables.  
+0003d610: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+0003d620: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+0003d630: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0003d640: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0003d650: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0003d660: 2020 2020 2020 2020 2263 616e 6e6f 7420          "cannot 
+0003d670: 636f 6e76 6572 7420 6469 6374 2077 6974  convert dict wit
+0003d680: 686f 7574 2074 6865 206b 6579 2022 0a20  hout the key ". 
+0003d690: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0003d6a0: 277b 6469 6d73 5f64 6174 617d 2722 2e66  '{dims_data}'".f
+0003d6b0: 6f72 6d61 7428 6469 6d73 5f64 6174 613d  ormat(dims_data=
+0003d6c0: 7374 7228 652e 6172 6773 5b30 5d29 290a  str(e.args[0])).
+0003d6d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0003d6e0: 2020 2020 2020 6f62 6a20 3d20 636c 7328        obj = cls(
+0003d6f0: 7661 7269 6162 6c65 5f64 6963 7429 0a0a  variable_dict)..
+0003d700: 2020 2020 2020 2020 2320 7768 6174 2069          # what i
+0003d710: 6620 636f 6f72 6473 2061 7265 6e27 7420  f coords aren't 
+0003d720: 6469 6d73 3f0a 2020 2020 2020 2020 636f  dims?.        co
+0003d730: 6f72 6473 203d 2073 6574 2864 2e67 6574  ords = set(d.get
+0003d740: 2822 636f 6f72 6473 222c 207b 7d29 2920  ("coords", {})) 
+0003d750: 2d20 7365 7428 642e 6765 7428 2264 696d  - set(d.get("dim
+0003d760: 7322 2c20 7b7d 2929 0a20 2020 2020 2020  s", {})).       
+0003d770: 206f 626a 203d 206f 626a 2e73 6574 5f63   obj = obj.set_c
+0003d780: 6f6f 7264 7328 636f 6f72 6473 290a 0a20  oords(coords).. 
+0003d790: 2020 2020 2020 206f 626a 2e61 7474 7273         obj.attrs
+0003d7a0: 2e75 7064 6174 6528 642e 6765 7428 2261  .update(d.get("a
+0003d7b0: 7474 7273 222c 207b 7d29 290a 2020 2020  ttrs", {})).    
+0003d7c0: 2020 2020 6f62 6a2e 656e 636f 6469 6e67      obj.encoding
+0003d7d0: 2e75 7064 6174 6528 642e 6765 7428 2265  .update(d.get("e
+0003d7e0: 6e63 6f64 696e 6722 2c20 7b7d 2929 0a0a  ncoding", {}))..
+0003d7f0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0003d800: 626a 0a0a 2020 2020 6465 6620 5f75 6e61  bj..    def _una
+0003d810: 7279 5f6f 7028 7365 6c66 3a20 545f 4461  ry_op(self: T_Da
+0003d820: 7461 7365 742c 2066 2c20 2a61 7267 732c  taset, f, *args,
+0003d830: 202a 2a6b 7761 7267 7329 202d 3e20 545f   **kwargs) -> T_
+0003d840: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
+0003d850: 2076 6172 6961 626c 6573 203d 207b 7d0a   variables = {}.
+0003d860: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+0003d870: 7273 203d 206b 7761 7267 732e 706f 7028  rs = kwargs.pop(
+0003d880: 226b 6565 705f 6174 7472 7322 2c20 4e6f  "keep_attrs", No
+0003d890: 6e65 290a 2020 2020 2020 2020 6966 206b  ne).        if k
+0003d8a0: 6565 705f 6174 7472 7320 6973 204e 6f6e  eep_attrs is Non
+0003d8b0: 653a 0a20 2020 2020 2020 2020 2020 206b  e:.            k
+0003d8c0: 6565 705f 6174 7472 7320 3d20 5f67 6574  eep_attrs = _get
+0003d8d0: 5f6b 6565 705f 6174 7472 7328 6465 6661  _keep_attrs(defa
+0003d8e0: 756c 743d 5472 7565 290a 2020 2020 2020  ult=True).      
+0003d8f0: 2020 666f 7220 6b2c 2076 2069 6e20 7365    for k, v in se
+0003d900: 6c66 2e5f 7661 7269 6162 6c65 732e 6974  lf._variables.it
+0003d910: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0003d920: 2020 2069 6620 6b20 696e 2073 656c 662e     if k in self.
+0003d930: 5f63 6f6f 7264 5f6e 616d 6573 3a0a 2020  _coord_names:.  
+0003d940: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0003d950: 7269 6162 6c65 735b 6b5d 203d 2076 0a20  riables[k] = v. 
+0003d960: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0003d970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d980: 2076 6172 6961 626c 6573 5b6b 5d20 3d20   variables[k] = 
+0003d990: 6628 762c 202a 6172 6773 2c20 2a2a 6b77  f(v, *args, **kw
+0003d9a0: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
+0003d9b0: 2020 2020 2020 6966 206b 6565 705f 6174        if keep_at
+0003d9c0: 7472 733a 0a20 2020 2020 2020 2020 2020  trs:.           
+0003d9d0: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0003d9e0: 6573 5b6b 5d2e 6174 7472 7320 3d20 762e  es[k].attrs = v.
+0003d9f0: 5f61 7474 7273 0a20 2020 2020 2020 2061  _attrs.        a
+0003da00: 7474 7273 203d 2073 656c 662e 5f61 7474  ttrs = self._att
+0003da10: 7273 2069 6620 6b65 6570 5f61 7474 7273  rs if keep_attrs
+0003da20: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
+0003da30: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0003da40: 7265 706c 6163 655f 7769 7468 5f6e 6577  replace_with_new
+0003da50: 5f64 696d 7328 7661 7269 6162 6c65 732c  _dims(variables,
+0003da60: 2061 7474 7273 3d61 7474 7273 290a 0a20   attrs=attrs).. 
+0003da70: 2020 2064 6566 205f 6269 6e61 7279 5f6f     def _binary_o
+0003da80: 7028 7365 6c66 2c20 6f74 6865 722c 2066  p(self, other, f
+0003da90: 2c20 7265 666c 6578 6976 653d 4661 6c73  , reflexive=Fals
+0003daa0: 652c 206a 6f69 6e3d 4e6f 6e65 2920 2d3e  e, join=None) ->
+0003dab0: 2044 6174 6173 6574 3a0a 2020 2020 2020   Dataset:.      
+0003dac0: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
+0003dad0: 7265 2e64 6174 6161 7272 6179 2069 6d70  re.dataarray imp
+0003dae0: 6f72 7420 4461 7461 4172 7261 790a 2020  ort DataArray.  
+0003daf0: 2020 2020 2020 6672 6f6d 2078 6172 7261        from xarra
+0003db00: 792e 636f 7265 2e67 726f 7570 6279 2069  y.core.groupby i
+0003db10: 6d70 6f72 7420 4772 6f75 7042 790a 0a20  mport GroupBy.. 
+0003db20: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0003db30: 616e 6365 286f 7468 6572 2c20 4772 6f75  ance(other, Grou
+0003db40: 7042 7929 3a0a 2020 2020 2020 2020 2020  pBy):.          
+0003db50: 2020 7265 7475 726e 204e 6f74 496d 706c    return NotImpl
+0003db60: 656d 656e 7465 640a 2020 2020 2020 2020  emented.        
+0003db70: 616c 6967 6e5f 7479 7065 203d 204f 5054  align_type = OPT
+0003db80: 494f 4e53 5b22 6172 6974 686d 6574 6963  IONS["arithmetic
+0003db90: 5f6a 6f69 6e22 5d20 6966 206a 6f69 6e20  _join"] if join 
+0003dba0: 6973 204e 6f6e 6520 656c 7365 206a 6f69  is None else joi
+0003dbb0: 6e0a 2020 2020 2020 2020 6966 2069 7369  n.        if isi
+0003dbc0: 6e73 7461 6e63 6528 6f74 6865 722c 2028  nstance(other, (
+0003dbd0: 4461 7461 4172 7261 792c 2044 6174 6173  DataArray, Datas
+0003dbe0: 6574 2929 3a0a 2020 2020 2020 2020 2020  et)):.          
+0003dbf0: 2020 7365 6c66 2c20 6f74 6865 7220 3d20    self, other = 
+0003dc00: 616c 6967 6e28 7365 6c66 2c20 6f74 6865  align(self, othe
+0003dc10: 722c 206a 6f69 6e3d 616c 6967 6e5f 7479  r, join=align_ty
+0003dc20: 7065 2c20 636f 7079 3d46 616c 7365 2920  pe, copy=False) 
+0003dc30: 2023 2074 7970 653a 2069 676e 6f72 655b   # type: ignore[
+0003dc40: 6173 7369 676e 6d65 6e74 5d0a 2020 2020  assignment].    
+0003dc50: 2020 2020 6720 3d20 6620 6966 206e 6f74      g = f if not
+0003dc60: 2072 6566 6c65 7869 7665 2065 6c73 6520   reflexive else 
+0003dc70: 6c61 6d62 6461 2078 2c20 793a 2066 2879  lambda x, y: f(y
+0003dc80: 2c20 7829 0a20 2020 2020 2020 2064 7320  , x).        ds 
+0003dc90: 3d20 7365 6c66 2e5f 6361 6c63 756c 6174  = self._calculat
+0003dca0: 655f 6269 6e61 7279 5f6f 7028 672c 206f  e_binary_op(g, o
+0003dcb0: 7468 6572 2c20 6a6f 696e 3d61 6c69 676e  ther, join=align
+0003dcc0: 5f74 7970 6529 0a20 2020 2020 2020 206b  _type).        k
+0003dcd0: 6565 705f 6174 7472 7320 3d20 5f67 6574  eep_attrs = _get
+0003dce0: 5f6b 6565 705f 6174 7472 7328 6465 6661  _keep_attrs(defa
+0003dcf0: 756c 743d 4661 6c73 6529 0a20 2020 2020  ult=False).     
+0003dd00: 2020 2069 6620 6b65 6570 5f61 7474 7273     if keep_attrs
+0003dd10: 3a0a 2020 2020 2020 2020 2020 2020 6473  :.            ds
+0003dd20: 2e61 7474 7273 203d 2073 656c 662e 6174  .attrs = self.at
+0003dd30: 7472 730a 2020 2020 2020 2020 7265 7475  trs.        retu
+0003dd40: 726e 2064 730a 0a20 2020 2064 6566 205f  rn ds..    def _
+0003dd50: 696e 706c 6163 655f 6269 6e61 7279 5f6f  inplace_binary_o
+0003dd60: 7028 7365 6c66 3a20 545f 4461 7461 7365  p(self: T_Datase
+0003dd70: 742c 206f 7468 6572 2c20 6629 202d 3e20  t, other, f) -> 
+0003dd80: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+0003dd90: 2020 2066 726f 6d20 7861 7272 6179 2e63     from xarray.c
+0003dda0: 6f72 652e 6461 7461 6172 7261 7920 696d  ore.dataarray im
+0003ddb0: 706f 7274 2044 6174 6141 7272 6179 0a20  port DataArray. 
+0003ddc0: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
+0003ddd0: 6179 2e63 6f72 652e 6772 6f75 7062 7920  ay.core.groupby 
+0003dde0: 696d 706f 7274 2047 726f 7570 4279 0a0a  import GroupBy..
+0003ddf0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003de00: 7461 6e63 6528 6f74 6865 722c 2047 726f  tance(other, Gro
+0003de10: 7570 4279 293a 0a20 2020 2020 2020 2020  upBy):.         
+0003de20: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+0003de30: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0003de40: 2020 2020 2269 6e2d 706c 6163 6520 6f70      "in-place op
+0003de50: 6572 6174 696f 6e73 2062 6574 7765 656e  erations between
+0003de60: 2061 2044 6174 6173 6574 2061 6e64 2022   a Dataset and "
+0003de70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003de80: 2022 6120 6772 6f75 7065 6420 6f62 6a65   "a grouped obje
+0003de90: 6374 2061 7265 206e 6f74 2070 6572 6d69  ct are not permi
+0003dea0: 7474 6564 220a 2020 2020 2020 2020 2020  tted".          
+0003deb0: 2020 290a 2020 2020 2020 2020 2320 7765    ).        # we
+0003dec0: 2064 6f6e 2774 2061 6374 7561 6c6c 7920   don't actually 
+0003ded0: 6d6f 6469 6679 2061 7272 6179 7320 696e  modify arrays in
+0003dee0: 2d70 6c61 6365 2077 6974 6820 696e 2d70  -place with in-p
+0003def0: 6c61 6365 2044 6174 6173 6574 0a20 2020  lace Dataset.   
+0003df00: 2020 2020 2023 2061 7269 7468 6d65 7469       # arithmeti
+0003df10: 6320 2d2d 2074 6869 7320 6c65 7473 2075  c -- this lets u
+0003df20: 7320 6175 746f 6d61 7469 6361 6c6c 7920  s automatically 
+0003df30: 616c 6967 6e20 7468 696e 6773 0a20 2020  align things.   
+0003df40: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0003df50: 6365 286f 7468 6572 2c20 2844 6174 6141  ce(other, (DataA
+0003df60: 7272 6179 2c20 4461 7461 7365 7429 293a  rray, Dataset)):
+0003df70: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+0003df80: 6572 203d 206f 7468 6572 2e72 6569 6e64  er = other.reind
+0003df90: 6578 5f6c 696b 6528 7365 6c66 2c20 636f  ex_like(self, co
+0003dfa0: 7079 3d46 616c 7365 290a 2020 2020 2020  py=False).      
+0003dfb0: 2020 6720 3d20 6f70 732e 696e 706c 6163    g = ops.inplac
+0003dfc0: 655f 746f 5f6e 6f6e 696e 706c 6163 655f  e_to_noninplace_
+0003dfd0: 6f70 2866 290a 2020 2020 2020 2020 6473  op(f).        ds
+0003dfe0: 203d 2073 656c 662e 5f63 616c 6375 6c61   = self._calcula
+0003dff0: 7465 5f62 696e 6172 795f 6f70 2867 2c20  te_binary_op(g, 
+0003e000: 6f74 6865 722c 2069 6e70 6c61 6365 3d54  other, inplace=T
+0003e010: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
+0003e020: 662e 5f72 6570 6c61 6365 5f77 6974 685f  f._replace_with_
+0003e030: 6e65 775f 6469 6d73 280a 2020 2020 2020  new_dims(.      
+0003e040: 2020 2020 2020 6473 2e5f 7661 7269 6162        ds._variab
+0003e050: 6c65 732c 0a20 2020 2020 2020 2020 2020  les,.           
+0003e060: 2064 732e 5f63 6f6f 7264 5f6e 616d 6573   ds._coord_names
+0003e070: 2c0a 2020 2020 2020 2020 2020 2020 6174  ,.            at
+0003e080: 7472 733d 6473 2e5f 6174 7472 732c 0a20  trs=ds._attrs,. 
+0003e090: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0003e0a0: 6573 3d64 732e 5f69 6e64 6578 6573 2c0a  es=ds._indexes,.
+0003e0b0: 2020 2020 2020 2020 2020 2020 696e 706c              inpl
+0003e0c0: 6163 653d 5472 7565 2c0a 2020 2020 2020  ace=True,.      
+0003e0d0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+0003e0e0: 726e 2073 656c 660a 0a20 2020 2064 6566  rn self..    def
+0003e0f0: 205f 6361 6c63 756c 6174 655f 6269 6e61   _calculate_bina
+0003e100: 7279 5f6f 7028 0a20 2020 2020 2020 2073  ry_op(.        s
+0003e110: 656c 662c 2066 2c20 6f74 6865 722c 206a  elf, f, other, j
+0003e120: 6f69 6e3d 2269 6e6e 6572 222c 2069 6e70  oin="inner", inp
+0003e130: 6c61 6365 3a20 626f 6f6c 203d 2046 616c  lace: bool = Fal
+0003e140: 7365 0a20 2020 2029 202d 3e20 4461 7461  se.    ) -> Data
+0003e150: 7365 743a 0a20 2020 2020 2020 2064 6566  set:.        def
+0003e160: 2061 7070 6c79 5f6f 7665 725f 626f 7468   apply_over_both
+0003e170: 286c 6873 5f64 6174 615f 7661 7273 2c20  (lhs_data_vars, 
+0003e180: 7268 735f 6461 7461 5f76 6172 732c 206c  rhs_data_vars, l
+0003e190: 6873 5f76 6172 732c 2072 6873 5f76 6172  hs_vars, rhs_var
+0003e1a0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0003e1b0: 6966 2069 6e70 6c61 6365 2061 6e64 2073  if inplace and s
+0003e1c0: 6574 286c 6873 5f64 6174 615f 7661 7273  et(lhs_data_vars
+0003e1d0: 2920 213d 2073 6574 2872 6873 5f64 6174  ) != set(rhs_dat
+0003e1e0: 615f 7661 7273 293a 0a20 2020 2020 2020  a_vars):.       
+0003e1f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0003e200: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+0003e210: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0003e220: 6461 7461 7365 7473 206d 7573 7420 6861  datasets must ha
+0003e230: 7665 2074 6865 2073 616d 6520 6461 7461  ve the same data
+0003e240: 2076 6172 6961 626c 6573 2022 0a20 2020   variables ".   
+0003e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e260: 2066 2266 6f72 2069 6e2d 706c 6163 6520   f"for in-place 
+0003e270: 6172 6974 686d 6574 6963 206f 7065 7261  arithmetic opera
+0003e280: 7469 6f6e 733a 207b 6c69 7374 286c 6873  tions: {list(lhs
+0003e290: 5f64 6174 615f 7661 7273 297d 2c20 7b6c  _data_vars)}, {l
+0003e2a0: 6973 7428 7268 735f 6461 7461 5f76 6172  ist(rhs_data_var
+0003e2b0: 7329 7d22 0a20 2020 2020 2020 2020 2020  s)}".           
+0003e2c0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0003e2d0: 2020 2020 6465 7374 5f76 6172 7320 3d20      dest_vars = 
+0003e2e0: 7b7d 0a0a 2020 2020 2020 2020 2020 2020  {}..            
+0003e2f0: 666f 7220 6b20 696e 206c 6873 5f64 6174  for k in lhs_dat
+0003e300: 615f 7661 7273 3a0a 2020 2020 2020 2020  a_vars:.        
+0003e310: 2020 2020 2020 2020 6966 206b 2069 6e20          if k in 
+0003e320: 7268 735f 6461 7461 5f76 6172 733a 0a20  rhs_data_vars:. 
+0003e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e340: 2020 2064 6573 745f 7661 7273 5b6b 5d20     dest_vars[k] 
+0003e350: 3d20 6628 6c68 735f 7661 7273 5b6b 5d2c  = f(lhs_vars[k],
+0003e360: 2072 6873 5f76 6172 735b 6b5d 290a 2020   rhs_vars[k]).  
+0003e370: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0003e380: 6966 206a 6f69 6e20 696e 205b 226c 6566  if join in ["lef
+0003e390: 7422 2c20 226f 7574 6572 225d 3a0a 2020  t", "outer"]:.  
+0003e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e3b0: 2020 6465 7374 5f76 6172 735b 6b5d 203d    dest_vars[k] =
+0003e3c0: 2066 286c 6873 5f76 6172 735b 6b5d 2c20   f(lhs_vars[k], 
+0003e3d0: 6e70 2e6e 616e 290a 2020 2020 2020 2020  np.nan).        
+0003e3e0: 2020 2020 666f 7220 6b20 696e 2072 6873      for k in rhs
+0003e3f0: 5f64 6174 615f 7661 7273 3a0a 2020 2020  _data_vars:.    
+0003e400: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+0003e410: 206e 6f74 2069 6e20 6465 7374 5f76 6172   not in dest_var
+0003e420: 7320 616e 6420 6a6f 696e 2069 6e20 5b22  s and join in ["
+0003e430: 7269 6768 7422 2c20 226f 7574 6572 225d  right", "outer"]
+0003e440: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003e450: 2020 2020 2020 6465 7374 5f76 6172 735b        dest_vars[
+0003e460: 6b5d 203d 2066 2872 6873 5f76 6172 735b  k] = f(rhs_vars[
+0003e470: 6b5d 2c20 6e70 2e6e 616e 290a 2020 2020  k], np.nan).    
+0003e480: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+0003e490: 6573 745f 7661 7273 0a0a 2020 2020 2020  est_vars..      
+0003e4a0: 2020 6966 2075 7469 6c73 2e69 735f 6469    if utils.is_di
+0003e4b0: 6374 5f6c 696b 6528 6f74 6865 7229 2061  ct_like(other) a
+0003e4c0: 6e64 206e 6f74 2069 7369 6e73 7461 6e63  nd not isinstanc
+0003e4d0: 6528 6f74 6865 722c 2044 6174 6173 6574  e(other, Dataset
+0003e4e0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+0003e4f0: 2063 616e 2774 2075 7365 206f 7572 2073   can't use our s
+0003e500: 686f 7274 6375 7420 6f66 2064 6f69 6e67  hortcut of doing
+0003e510: 2074 6865 2062 696e 6172 7920 6f70 6572   the binary oper
+0003e520: 6174 696f 6e20 7769 7468 0a20 2020 2020  ation with.     
+0003e530: 2020 2020 2020 2023 2056 6172 6961 626c         # Variabl
+0003e540: 6520 6f62 6a65 6374 732c 2073 6f20 6170  e objects, so ap
+0003e550: 706c 7920 6f76 6572 206f 7572 2064 6174  ply over our dat
+0003e560: 6120 7661 7273 2069 6e73 7465 6164 2e0a  a vars instead..
+0003e570: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0003e580: 6461 7461 5f76 6172 7320 3d20 6170 706c  data_vars = appl
+0003e590: 795f 6f76 6572 5f62 6f74 6828 0a20 2020  y_over_both(.   
+0003e5a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003e5b0: 662e 6461 7461 5f76 6172 732c 206f 7468  f.data_vars, oth
+0003e5c0: 6572 2c20 7365 6c66 2e64 6174 615f 7661  er, self.data_va
+0003e5d0: 7273 2c20 6f74 6865 720a 2020 2020 2020  rs, other.      
+0003e5e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0003e5f0: 2020 2020 7265 7475 726e 2074 7970 6528      return type(
+0003e600: 7365 6c66 2928 6e65 775f 6461 7461 5f76  self)(new_data_v
+0003e610: 6172 7329 0a0a 2020 2020 2020 2020 6f74  ars)..        ot
+0003e620: 6865 725f 636f 6f72 6473 3a20 436f 6f72  her_coords: Coor
+0003e630: 6469 6e61 7465 7320 7c20 4e6f 6e65 203d  dinates | None =
+0003e640: 2067 6574 6174 7472 286f 7468 6572 2c20   getattr(other, 
+0003e650: 2263 6f6f 7264 7322 2c20 4e6f 6e65 290a  "coords", None).
+0003e660: 2020 2020 2020 2020 6473 203d 2073 656c          ds = sel
+0003e670: 662e 636f 6f72 6473 2e6d 6572 6765 286f  f.coords.merge(o
+0003e680: 7468 6572 5f63 6f6f 7264 7329 0a0a 2020  ther_coords)..  
+0003e690: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0003e6a0: 6e63 6528 6f74 6865 722c 2044 6174 6173  nce(other, Datas
+0003e6b0: 6574 293a 0a20 2020 2020 2020 2020 2020  et):.           
+0003e6c0: 206e 6577 5f76 6172 7320 3d20 6170 706c   new_vars = appl
+0003e6d0: 795f 6f76 6572 5f62 6f74 6828 0a20 2020  y_over_both(.   
+0003e6e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003e6f0: 662e 6461 7461 5f76 6172 732c 206f 7468  f.data_vars, oth
+0003e700: 6572 2e64 6174 615f 7661 7273 2c20 7365  er.data_vars, se
+0003e710: 6c66 2e76 6172 6961 626c 6573 2c20 6f74  lf.variables, ot
+0003e720: 6865 722e 7661 7269 6162 6c65 730a 2020  her.variables.  
+0003e730: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0003e740: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003e750: 2020 2020 2020 6f74 6865 725f 7661 7269        other_vari
+0003e760: 6162 6c65 203d 2067 6574 6174 7472 286f  able = getattr(o
+0003e770: 7468 6572 2c20 2276 6172 6961 626c 6522  ther, "variable"
+0003e780: 2c20 6f74 6865 7229 0a20 2020 2020 2020  , other).       
+0003e790: 2020 2020 206e 6577 5f76 6172 7320 3d20       new_vars = 
+0003e7a0: 7b6b 3a20 6628 7365 6c66 2e76 6172 6961  {k: f(self.varia
+0003e7b0: 626c 6573 5b6b 5d2c 206f 7468 6572 5f76  bles[k], other_v
+0003e7c0: 6172 6961 626c 6529 2066 6f72 206b 2069  ariable) for k i
+0003e7d0: 6e20 7365 6c66 2e64 6174 615f 7661 7273  n self.data_vars
+0003e7e0: 7d0a 2020 2020 2020 2020 6473 2e5f 7661  }.        ds._va
+0003e7f0: 7269 6162 6c65 732e 7570 6461 7465 286e  riables.update(n
+0003e800: 6577 5f76 6172 7329 0a20 2020 2020 2020  ew_vars).       
+0003e810: 2064 732e 5f64 696d 7320 3d20 6361 6c63   ds._dims = calc
+0003e820: 756c 6174 655f 6469 6d65 6e73 696f 6e73  ulate_dimensions
+0003e830: 2864 732e 5f76 6172 6961 626c 6573 290a  (ds._variables).
+0003e840: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+0003e850: 730a 0a20 2020 2064 6566 205f 636f 7079  s..    def _copy
+0003e860: 5f61 7474 7273 5f66 726f 6d28 7365 6c66  _attrs_from(self
+0003e870: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+0003e880: 2020 7365 6c66 2e61 7474 7273 203d 206f    self.attrs = o
+0003e890: 7468 6572 2e61 7474 7273 0a20 2020 2020  ther.attrs.     
+0003e8a0: 2020 2066 6f72 2076 2069 6e20 6f74 6865     for v in othe
+0003e8b0: 722e 7661 7269 6162 6c65 733a 0a20 2020  r.variables:.   
+0003e8c0: 2020 2020 2020 2020 2069 6620 7620 696e           if v in
+0003e8d0: 2073 656c 662e 7661 7269 6162 6c65 733a   self.variables:
+0003e8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e8f0: 2073 656c 662e 7661 7269 6162 6c65 735b   self.variables[
+0003e900: 765d 2e61 7474 7273 203d 206f 7468 6572  v].attrs = other
+0003e910: 2e76 6172 6961 626c 6573 5b76 5d2e 6174  .variables[v].at
+0003e920: 7472 730a 0a20 2020 2064 6566 2064 6966  trs..    def dif
+0003e930: 6628 0a20 2020 2020 2020 2073 656c 663a  f(.        self:
+0003e940: 2054 5f44 6174 6173 6574 2c0a 2020 2020   T_Dataset,.    
+0003e950: 2020 2020 6469 6d3a 2048 6173 6861 626c      dim: Hashabl
+0003e960: 652c 0a20 2020 2020 2020 206e 3a20 696e  e,.        n: in
+0003e970: 7420 3d20 312c 0a20 2020 2020 2020 206c  t = 1,.        l
+0003e980: 6162 656c 3a20 4c69 7465 7261 6c5b 2275  abel: Literal["u
+0003e990: 7070 6572 222c 2022 6c6f 7765 7222 5d20  pper", "lower"] 
+0003e9a0: 3d20 2275 7070 6572 222c 0a20 2020 2029  = "upper",.    )
+0003e9b0: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+0003e9c0: 2020 2020 2020 2022 2222 4361 6c63 756c         """Calcul
+0003e9d0: 6174 6520 7468 6520 6e2d 7468 206f 7264  ate the n-th ord
+0003e9e0: 6572 2064 6973 6372 6574 6520 6469 6666  er discrete diff
+0003e9f0: 6572 656e 6365 2061 6c6f 6e67 2067 6976  erence along giv
+0003ea00: 656e 2061 7869 732e 0a0a 2020 2020 2020  en axis...      
+0003ea10: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0003ea20: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0003ea30: 2020 2020 2020 2020 6469 6d20 3a20 4861          dim : Ha
+0003ea40: 7368 6162 6c65 0a20 2020 2020 2020 2020  shable.         
+0003ea50: 2020 2044 696d 656e 7369 6f6e 206f 7665     Dimension ove
+0003ea60: 7220 7768 6963 6820 746f 2063 616c 6375  r which to calcu
+0003ea70: 6c61 7465 2074 6865 2066 696e 6974 6520  late the finite 
+0003ea80: 6469 6666 6572 656e 6365 2e0a 2020 2020  difference..    
+0003ea90: 2020 2020 6e20 3a20 696e 742c 2064 6566      n : int, def
+0003eaa0: 6175 6c74 3a20 310a 2020 2020 2020 2020  ault: 1.        
+0003eab0: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
+0003eac0: 6620 7469 6d65 7320 7661 6c75 6573 2061  f times values a
+0003ead0: 7265 2064 6966 6665 7265 6e63 6564 2e0a  re differenced..
+0003eae0: 2020 2020 2020 2020 6c61 6265 6c20 3a20          label : 
+0003eaf0: 7b22 7570 7065 7222 2c20 226c 6f77 6572  {"upper", "lower
+0003eb00: 227d 2c20 6465 6661 756c 743a 2022 7570  "}, default: "up
+0003eb10: 7065 7222 0a20 2020 2020 2020 2020 2020  per".           
+0003eb20: 2054 6865 206e 6577 2063 6f6f 7264 696e   The new coordin
+0003eb30: 6174 6520 696e 2064 696d 656e 7369 6f6e  ate in dimension
+0003eb40: 2060 6064 696d 6060 2077 696c 6c20 6861   ``dim`` will ha
+0003eb50: 7665 2074 6865 0a20 2020 2020 2020 2020  ve the.         
+0003eb60: 2020 2076 616c 7565 7320 6f66 2065 6974     values of eit
+0003eb70: 6865 7220 7468 6520 6d69 6e75 656e 6427  her the minuend'
+0003eb80: 7320 6f72 2073 7562 7472 6168 656e 6427  s or subtrahend'
+0003eb90: 7320 636f 6f72 6469 6e61 7465 0a20 2020  s coordinate.   
+0003eba0: 2020 2020 2020 2020 2066 6f72 2076 616c           for val
+0003ebb0: 7565 7320 2775 7070 6572 2720 616e 6420  ues 'upper' and 
+0003ebc0: 276c 6f77 6572 272c 2072 6573 7065 6374  'lower', respect
+0003ebd0: 6976 656c 792e 0a0a 2020 2020 2020 2020  ively...        
+0003ebe0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+0003ebf0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0003ec00: 6469 6666 6572 656e 6365 203a 2044 6174  difference : Dat
+0003ec10: 6173 6574 0a20 2020 2020 2020 2020 2020  aset.           
+0003ec20: 2054 6865 206e 2d74 6820 6f72 6465 7220   The n-th order 
+0003ec30: 6669 6e69 7465 2064 6966 6665 7265 6e63  finite differenc
+0003ec40: 6520 6f66 2074 6869 7320 6f62 6a65 6374  e of this object
+0003ec50: 2e0a 0a20 2020 2020 2020 204e 6f74 6573  ...        Notes
+0003ec60: 0a20 2020 2020 2020 202d 2d2d 2d2d 0a20  .        -----. 
+0003ec70: 2020 2020 2020 2060 6e60 206d 6174 6368         `n` match
+0003ec80: 6573 206e 756d 7079 2773 2062 6568 6176  es numpy's behav
+0003ec90: 696f 7220 616e 6420 6973 2064 6966 6665  ior and is diffe
+0003eca0: 7265 6e74 2066 726f 6d20 7061 6e64 6173  rent from pandas
+0003ecb0: 2720 6669 7273 7420 6172 6775 6d65 6e74  ' first argument
+0003ecc0: 206e 616d 6564 0a20 2020 2020 2020 2060   named.        `
+0003ecd0: 7065 7269 6f64 7360 2e0a 0a20 2020 2020  periods`...     
+0003ece0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+0003ecf0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0003ed00: 2020 2020 203e 3e3e 2064 7320 3d20 7872       >>> ds = xr
+0003ed10: 2e44 6174 6173 6574 287b 2266 6f6f 223a  .Dataset({"foo":
+0003ed20: 2028 2278 222c 205b 352c 2035 2c20 362c   ("x", [5, 5, 6,
+0003ed30: 2036 5d29 7d29 0a20 2020 2020 2020 203e   6])}).        >
+0003ed40: 3e3e 2064 732e 6469 6666 2822 7822 290a  >> ds.diff("x").
+0003ed50: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+0003ed60: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+0003ed70: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
+0003ed80: 3a20 3329 0a20 2020 2020 2020 2044 696d  : 3).        Dim
+0003ed90: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
+0003eda0: 636f 6f72 6469 6e61 7465 733a 2078 0a20  coordinates: x. 
+0003edb0: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
+0003edc0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
+0003edd0: 2020 2066 6f6f 2020 2020 2020 2878 2920     foo      (x) 
+0003ede0: 696e 7436 3420 3020 3120 300a 2020 2020  int64 0 1 0.    
+0003edf0: 2020 2020 3e3e 3e20 6473 2e64 6966 6628      >>> ds.diff(
+0003ee00: 2278 222c 2032 290a 2020 2020 2020 2020  "x", 2).        
+0003ee10: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
+0003ee20: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+0003ee30: 6f6e 733a 2020 2878 3a20 3229 0a20 2020  ons:  (x: 2).   
+0003ee40: 2020 2020 2044 696d 656e 7369 6f6e 7320       Dimensions 
+0003ee50: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
+0003ee60: 7465 733a 2078 0a20 2020 2020 2020 2044  tes: x.        D
+0003ee70: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+0003ee80: 2020 2020 2020 2020 2020 2066 6f6f 2020             foo  
+0003ee90: 2020 2020 2878 2920 696e 7436 3420 3120      (x) int64 1 
+0003eea0: 2d31 0a0a 2020 2020 2020 2020 5365 6520  -1..        See 
+0003eeb0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+0003eec0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
+0003eed0: 7461 7365 742e 6469 6666 6572 656e 7469  taset.differenti
+0003eee0: 6174 650a 2020 2020 2020 2020 2222 220a  ate.        """.
+0003eef0: 2020 2020 2020 2020 6966 206e 203d 3d20          if n == 
+0003ef00: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+0003ef10: 6574 7572 6e20 7365 6c66 0a20 2020 2020  eturn self.     
+0003ef20: 2020 2069 6620 6e20 3c20 303a 0a20 2020     if n < 0:.   
+0003ef30: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0003ef40: 616c 7565 4572 726f 7228 6622 6f72 6465  alueError(f"orde
+0003ef50: 7220 606e 6020 6d75 7374 2062 6520 6e6f  r `n` must be no
+0003ef60: 6e2d 6e65 6761 7469 7665 2062 7574 2067  n-negative but g
+0003ef70: 6f74 207b 6e7d 2229 0a0a 2020 2020 2020  ot {n}")..      
+0003ef80: 2020 2320 7072 6570 6172 6520 736c 6963    # prepare slic
+0003ef90: 6573 0a20 2020 2020 2020 2073 6c69 6365  es.        slice
+0003efa0: 5f73 7461 7274 203d 207b 6469 6d3a 2073  _start = {dim: s
+0003efb0: 6c69 6365 284e 6f6e 652c 202d 3129 7d0a  lice(None, -1)}.
+0003efc0: 2020 2020 2020 2020 736c 6963 655f 656e          slice_en
+0003efd0: 6420 3d20 7b64 696d 3a20 736c 6963 6528  d = {dim: slice(
+0003efe0: 312c 204e 6f6e 6529 7d0a 0a20 2020 2020  1, None)}..     
+0003eff0: 2020 2023 2070 7265 7061 7265 206e 6577     # prepare new
+0003f000: 2063 6f6f 7264 696e 6174 650a 2020 2020   coordinate.    
+0003f010: 2020 2020 6966 206c 6162 656c 203d 3d20      if label == 
+0003f020: 2275 7070 6572 223a 0a20 2020 2020 2020  "upper":.       
+0003f030: 2020 2020 2073 6c69 6365 5f6e 6577 203d       slice_new =
+0003f040: 2073 6c69 6365 5f65 6e64 0a20 2020 2020   slice_end.     
+0003f050: 2020 2065 6c69 6620 6c61 6265 6c20 3d3d     elif label ==
+0003f060: 2022 6c6f 7765 7222 3a0a 2020 2020 2020   "lower":.      
+0003f070: 2020 2020 2020 736c 6963 655f 6e65 7720        slice_new 
+0003f080: 3d20 736c 6963 655f 7374 6172 740a 2020  = slice_start.  
+0003f090: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0003f0a0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0003f0b0: 6c75 6545 7272 6f72 2822 5468 6520 276c  lueError("The 'l
+0003f0c0: 6162 656c 2720 6172 6775 6d65 6e74 2068  abel' argument h
+0003f0d0: 6173 2074 6f20 6265 2065 6974 6865 7220  as to be either 
+0003f0e0: 2775 7070 6572 2720 6f72 2027 6c6f 7765  'upper' or 'lowe
+0003f0f0: 7227 2229 0a0a 2020 2020 2020 2020 696e  r'")..        in
+0003f100: 6465 7865 732c 2069 6e64 6578 5f76 6172  dexes, index_var
+0003f110: 7320 3d20 6973 656c 5f69 6e64 6578 6573  s = isel_indexes
+0003f120: 2873 656c 662e 7869 6e64 6578 6573 2c20  (self.xindexes, 
+0003f130: 736c 6963 655f 6e65 7729 0a20 2020 2020  slice_new).     
+0003f140: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
+0003f150: 7d0a 0a20 2020 2020 2020 2066 6f72 206e  }..        for n
+0003f160: 616d 652c 2076 6172 2069 6e20 7365 6c66  ame, var in self
+0003f170: 2e76 6172 6961 626c 6573 2e69 7465 6d73  .variables.items
+0003f180: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0003f190: 6966 206e 616d 6520 696e 2069 6e64 6578  if name in index
+0003f1a0: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
+0003f1b0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+0003f1c0: 5b6e 616d 655d 203d 2069 6e64 6578 5f76  [name] = index_v
+0003f1d0: 6172 735b 6e61 6d65 5d0a 2020 2020 2020  ars[name].      
+0003f1e0: 2020 2020 2020 656c 6966 2064 696d 2069        elif dim i
+0003f1f0: 6e20 7661 722e 6469 6d73 3a0a 2020 2020  n var.dims:.    
+0003f200: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0003f210: 616d 6520 696e 2073 656c 662e 6461 7461  ame in self.data
+0003f220: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
+0003f230: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0003f240: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
+0003f250: 2e69 7365 6c28 736c 6963 655f 656e 6429  .isel(slice_end)
+0003f260: 202d 2076 6172 2e69 7365 6c28 736c 6963   - var.isel(slic
+0003f270: 655f 7374 6172 7429 0a20 2020 2020 2020  e_start).       
+0003f280: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0003f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f2a0: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
+0003f2b0: 655d 203d 2076 6172 2e69 7365 6c28 736c  e] = var.isel(sl
+0003f2c0: 6963 655f 6e65 7729 0a20 2020 2020 2020  ice_new).       
+0003f2d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0003f2e0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0003f2f0: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
+0003f300: 0a0a 2020 2020 2020 2020 6469 6666 6572  ..        differ
+0003f310: 656e 6365 203d 2073 656c 662e 5f72 6570  ence = self._rep
+0003f320: 6c61 6365 5f77 6974 685f 6e65 775f 6469  lace_with_new_di
+0003f330: 6d73 2876 6172 6961 626c 6573 2c20 696e  ms(variables, in
+0003f340: 6465 7865 733d 696e 6465 7865 7329 0a0a  dexes=indexes)..
+0003f350: 2020 2020 2020 2020 6966 206e 203e 2031          if n > 1
+0003f360: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0003f370: 7475 726e 2064 6966 6665 7265 6e63 652e  turn difference.
+0003f380: 6469 6666 2864 696d 2c20 6e20 2d20 3129  diff(dim, n - 1)
+0003f390: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0003f3a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0003f3b0: 6e20 6469 6666 6572 656e 6365 0a0a 2020  n difference..  
+0003f3c0: 2020 6465 6620 7368 6966 7428 0a20 2020    def shift(.   
+0003f3d0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+0003f3e0: 6173 6574 2c0a 2020 2020 2020 2020 7368  aset,.        sh
+0003f3f0: 6966 7473 3a20 4d61 7070 696e 675b 416e  ifts: Mapping[An
+0003f400: 792c 2069 6e74 5d20 7c20 4e6f 6e65 203d  y, int] | None =
+0003f410: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
+0003f420: 696c 6c5f 7661 6c75 653a 2041 6e79 203d  ill_value: Any =
+0003f430: 2078 7264 7479 7065 732e 4e41 2c0a 2020   xrdtypes.NA,.  
+0003f440: 2020 2020 2020 2a2a 7368 6966 7473 5f6b        **shifts_k
+0003f450: 7761 7267 733a 2069 6e74 2c0a 2020 2020  wargs: int,.    
+0003f460: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0003f470: 2020 2020 2020 2020 2222 2253 6869 6674          """Shift
+0003f480: 2074 6869 7320 6461 7461 7365 7420 6279   this dataset by
+0003f490: 2061 6e20 6f66 6673 6574 2061 6c6f 6e67   an offset along
+0003f4a0: 206f 6e65 206f 7220 6d6f 7265 2064 696d   one or more dim
+0003f4b0: 656e 7369 6f6e 732e 0a0a 2020 2020 2020  ensions...      
+0003f4c0: 2020 4f6e 6c79 2064 6174 6120 7661 7269    Only data vari
+0003f4d0: 6162 6c65 7320 6172 6520 6d6f 7665 643b  ables are moved;
+0003f4e0: 2063 6f6f 7264 696e 6174 6573 2073 7461   coordinates sta
+0003f4f0: 7920 696e 2070 6c61 6365 2e20 5468 6973  y in place. This
+0003f500: 2069 730a 2020 2020 2020 2020 636f 6e73   is.        cons
+0003f510: 6973 7465 6e74 2077 6974 6820 7468 6520  istent with the 
+0003f520: 6265 6861 7669 6f72 206f 6620 6060 7368  behavior of ``sh
+0003f530: 6966 7460 6020 696e 2070 616e 6461 732e  ift`` in pandas.
+0003f540: 0a0a 2020 2020 2020 2020 5661 6c75 6573  ..        Values
+0003f550: 2073 6869 6674 6564 2066 726f 6d20 6265   shifted from be
+0003f560: 796f 6e64 2061 7272 6179 2062 6f75 6e64  yond array bound
+0003f570: 7320 7769 6c6c 2061 7070 6561 7220 6174  s will appear at
+0003f580: 206f 6e65 2065 6e64 206f 660a 2020 2020   one end of.    
+0003f590: 2020 2020 6561 6368 2064 696d 656e 7369      each dimensi
+0003f5a0: 6f6e 2c20 7768 6963 6820 6172 6520 6669  on, which are fi
+0003f5b0: 6c6c 6564 2061 6363 6f72 6469 6e67 2074  lled according t
+0003f5c0: 6f20 6066 696c 6c5f 7661 6c75 6560 2e20  o `fill_value`. 
+0003f5d0: 466f 7220 7065 7269 6f64 6963 0a20 2020  For periodic.   
+0003f5e0: 2020 2020 206f 6666 7365 7473 2069 6e73       offsets ins
+0003f5f0: 7465 6164 2073 6565 2060 726f 6c6c 602e  tead see `roll`.
+0003f600: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+0003f610: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+0003f620: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0003f630: 7368 6966 7473 203a 206d 6170 7069 6e67  shifts : mapping
+0003f640: 206f 6620 6861 7368 6162 6c65 2074 6f20   of hashable to 
+0003f650: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+0003f660: 496e 7465 6765 7220 6f66 6673 6574 2074  Integer offset t
+0003f670: 6f20 7368 6966 7420 616c 6f6e 6720 6561  o shift along ea
+0003f680: 6368 206f 6620 7468 6520 6769 7665 6e20  ch of the given 
+0003f690: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
+0003f6a0: 2020 2020 2020 2020 506f 7369 7469 7665          Positive
+0003f6b0: 206f 6666 7365 7473 2073 6869 6674 2074   offsets shift t
+0003f6c0: 6f20 7468 6520 7269 6768 743b 206e 6567  o the right; neg
+0003f6d0: 6174 6976 6520 6f66 6673 6574 7320 7368  ative offsets sh
+0003f6e0: 6966 7420 746f 2074 6865 0a20 2020 2020  ift to the.     
+0003f6f0: 2020 2020 2020 206c 6566 742e 0a20 2020         left..   
+0003f700: 2020 2020 2066 696c 6c5f 7661 6c75 6520       fill_value 
+0003f710: 3a20 7363 616c 6172 206f 7220 6469 6374  : scalar or dict
+0003f720: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
+0003f730: 2020 2020 2020 2020 2020 2020 5661 6c75              Valu
+0003f740: 6520 746f 2075 7365 2066 6f72 206e 6577  e to use for new
+0003f750: 6c79 206d 6973 7369 6e67 2076 616c 7565  ly missing value
+0003f760: 732e 2049 6620 6120 6469 6374 2d6c 696b  s. If a dict-lik
+0003f770: 652c 206d 6170 730a 2020 2020 2020 2020  e, maps.        
+0003f780: 2020 2020 7661 7269 6162 6c65 206e 616d      variable nam
+0003f790: 6573 2028 696e 636c 7564 696e 6720 636f  es (including co
+0003f7a0: 6f72 6469 6e61 7465 7329 2074 6f20 6669  ordinates) to fi
+0003f7b0: 6c6c 2076 616c 7565 732e 0a20 2020 2020  ll values..     
+0003f7c0: 2020 202a 2a73 6869 6674 735f 6b77 6172     **shifts_kwar
+0003f7d0: 6773 0a20 2020 2020 2020 2020 2020 2054  gs.            T
+0003f7e0: 6865 206b 6579 776f 7264 2061 7267 756d  he keyword argum
+0003f7f0: 656e 7473 2066 6f72 6d20 6f66 2060 6073  ents form of ``s
+0003f800: 6869 6674 7360 602e 0a20 2020 2020 2020  hifts``..       
+0003f810: 2020 2020 204f 6e65 206f 6620 7368 6966       One of shif
+0003f820: 7473 206f 7220 7368 6966 7473 5f6b 7761  ts or shifts_kwa
+0003f830: 7267 7320 6d75 7374 2062 6520 7072 6f76  rgs must be prov
+0003f840: 6964 6564 2e0a 0a20 2020 2020 2020 2052  ided...        R
+0003f850: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+0003f860: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2073  ------.        s
+0003f870: 6869 6674 6564 203a 2044 6174 6173 6574  hifted : Dataset
+0003f880: 0a20 2020 2020 2020 2020 2020 2044 6174  .            Dat
+0003f890: 6173 6574 2077 6974 6820 7468 6520 7361  aset with the sa
+0003f8a0: 6d65 2063 6f6f 7264 696e 6174 6573 2061  me coordinates a
+0003f8b0: 6e64 2061 7474 7269 6275 7465 7320 6275  nd attributes bu
+0003f8c0: 7420 7368 6966 7465 6420 6461 7461 0a20  t shifted data. 
+0003f8d0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0003f8e0: 626c 6573 2e0a 0a20 2020 2020 2020 2053  bles...        S
+0003f8f0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+0003f900: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0003f910: 2072 6f6c 6c0a 0a20 2020 2020 2020 2045   roll..        E
+0003f920: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
+0003f930: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0003f940: 203e 3e3e 2064 7320 3d20 7872 2e44 6174   >>> ds = xr.Dat
+0003f950: 6173 6574 287b 2266 6f6f 223a 2028 2278  aset({"foo": ("x
+0003f960: 222c 206c 6973 7428 2261 6263 6465 2229  ", list("abcde")
+0003f970: 297d 290a 2020 2020 2020 2020 3e3e 3e20  )}).        >>> 
+0003f980: 6473 2e73 6869 6674 2878 3d32 290a 2020  ds.shift(x=2).  
+0003f990: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
+0003f9a0: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
+0003f9b0: 696d 656e 7369 6f6e 733a 2020 2878 3a20  imensions:  (x: 
+0003f9c0: 3529 0a20 2020 2020 2020 2044 696d 656e  5).        Dimen
+0003f9d0: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
+0003f9e0: 6f72 6469 6e61 7465 733a 2078 0a20 2020  ordinates: x.   
+0003f9f0: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+0003fa00: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+0003fa10: 2066 6f6f 2020 2020 2020 2878 2920 6f62   foo      (x) ob
+0003fa20: 6a65 6374 206e 616e 206e 616e 2027 6127  ject nan nan 'a'
+0003fa30: 2027 6227 2027 6327 0a20 2020 2020 2020   'b' 'c'.       
+0003fa40: 2022 2222 0a20 2020 2020 2020 2073 6869   """.        shi
+0003fa50: 6674 7320 3d20 6569 7468 6572 5f64 6963  fts = either_dic
+0003fa60: 745f 6f72 5f6b 7761 7267 7328 7368 6966  t_or_kwargs(shif
+0003fa70: 7473 2c20 7368 6966 7473 5f6b 7761 7267  ts, shifts_kwarg
+0003fa80: 732c 2022 7368 6966 7422 290a 2020 2020  s, "shift").    
+0003fa90: 2020 2020 696e 7661 6c69 6420 3d20 5b6b      invalid = [k
+0003faa0: 2066 6f72 206b 2069 6e20 7368 6966 7473   for k in shifts
+0003fab0: 2069 6620 6b20 6e6f 7420 696e 2073 656c   if k not in sel
+0003fac0: 662e 6469 6d73 5d0a 2020 2020 2020 2020  f.dims].        
+0003fad0: 6966 2069 6e76 616c 6964 3a0a 2020 2020  if invalid:.    
+0003fae0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0003faf0: 6c75 6545 7272 6f72 2866 2264 696d 656e  lueError(f"dimen
+0003fb00: 7369 6f6e 7320 7b69 6e76 616c 6964 2172  sions {invalid!r
+0003fb10: 7d20 646f 206e 6f74 2065 7869 7374 2229  } do not exist")
+0003fb20: 0a0a 2020 2020 2020 2020 7661 7269 6162  ..        variab
+0003fb30: 6c65 7320 3d20 7b7d 0a20 2020 2020 2020  les = {}.       
+0003fb40: 2066 6f72 206e 616d 652c 2076 6172 2069   for name, var i
+0003fb50: 6e20 7365 6c66 2e76 6172 6961 626c 6573  n self.variables
+0003fb60: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+0003fb70: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
+0003fb80: 2073 656c 662e 6461 7461 5f76 6172 733a   self.data_vars:
+0003fb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003fba0: 2066 696c 6c5f 7661 6c75 655f 203d 2028   fill_value_ = (
+0003fbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003fbc0: 2020 2020 2066 696c 6c5f 7661 6c75 652e       fill_value.
+0003fbd0: 6765 7428 6e61 6d65 2c20 7872 6474 7970  get(name, xrdtyp
+0003fbe0: 6573 2e4e 4129 0a20 2020 2020 2020 2020  es.NA).         
+0003fbf0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0003fc00: 696e 7374 616e 6365 2866 696c 6c5f 7661  instance(fill_va
+0003fc10: 6c75 652c 2064 6963 7429 0a20 2020 2020  lue, dict).     
+0003fc20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0003fc30: 6c73 6520 6669 6c6c 5f76 616c 7565 0a20  lse fill_value. 
+0003fc40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0003fc50: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003fc60: 2020 7661 725f 7368 6966 7473 203d 207b    var_shifts = {
+0003fc70: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+0003fc80: 2073 6869 6674 732e 6974 656d 7328 2920   shifts.items() 
+0003fc90: 6966 206b 2069 6e20 7661 722e 6469 6d73  if k in var.dims
+0003fca0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0003fcb0: 2020 7661 7269 6162 6c65 735b 6e61 6d65    variables[name
+0003fcc0: 5d20 3d20 7661 722e 7368 6966 7428 6669  ] = var.shift(fi
+0003fcd0: 6c6c 5f76 616c 7565 3d66 696c 6c5f 7661  ll_value=fill_va
+0003fce0: 6c75 655f 2c20 7368 6966 7473 3d76 6172  lue_, shifts=var
+0003fcf0: 5f73 6869 6674 7329 0a20 2020 2020 2020  _shifts).       
+0003fd00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0003fd10: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0003fd20: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
+0003fd30: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0003fd40: 2073 656c 662e 5f72 6570 6c61 6365 2876   self._replace(v
+0003fd50: 6172 6961 626c 6573 290a 0a20 2020 2064  ariables)..    d
+0003fd60: 6566 2072 6f6c 6c28 0a20 2020 2020 2020  ef roll(.       
+0003fd70: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
+0003fd80: 2c0a 2020 2020 2020 2020 7368 6966 7473  ,.        shifts
+0003fd90: 3a20 4d61 7070 696e 675b 416e 792c 2069  : Mapping[Any, i
+0003fda0: 6e74 5d20 7c20 4e6f 6e65 203d 204e 6f6e  nt] | None = Non
+0003fdb0: 652c 0a20 2020 2020 2020 2072 6f6c 6c5f  e,.        roll_
+0003fdc0: 636f 6f72 6473 3a20 626f 6f6c 203d 2046  coords: bool = F
+0003fdd0: 616c 7365 2c0a 2020 2020 2020 2020 2a2a  alse,.        **
+0003fde0: 7368 6966 7473 5f6b 7761 7267 733a 2069  shifts_kwargs: i
+0003fdf0: 6e74 2c0a 2020 2020 2920 2d3e 2054 5f44  nt,.    ) -> T_D
+0003fe00: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+0003fe10: 2222 2252 6f6c 6c20 7468 6973 2064 6174  """Roll this dat
+0003fe20: 6173 6574 2062 7920 616e 206f 6666 7365  aset by an offse
+0003fe30: 7420 616c 6f6e 6720 6f6e 6520 6f72 206d  t along one or m
+0003fe40: 6f72 6520 6469 6d65 6e73 696f 6e73 2e0a  ore dimensions..
+0003fe50: 0a20 2020 2020 2020 2055 6e6c 696b 6520  .        Unlike 
+0003fe60: 7368 6966 742c 2072 6f6c 6c20 7472 6561  shift, roll trea
+0003fe70: 7473 2074 6865 2067 6976 656e 2064 696d  ts the given dim
+0003fe80: 656e 7369 6f6e 7320 6173 2070 6572 696f  ensions as perio
+0003fe90: 6469 632c 2073 6f20 7769 6c6c 206e 6f74  dic, so will not
+0003fea0: 0a20 2020 2020 2020 2063 7265 6174 6520  .        create 
+0003feb0: 616e 7920 6d69 7373 696e 6720 7661 6c75  any missing valu
+0003fec0: 6573 2074 6f20 6265 2066 696c 6c65 642e  es to be filled.
+0003fed0: 0a0a 2020 2020 2020 2020 416c 736f 2075  ..        Also u
+0003fee0: 6e6c 696b 6520 7368 6966 742c 2072 6f6c  nlike shift, rol
+0003fef0: 6c20 6d61 7920 726f 7461 7465 2061 6c6c  l may rotate all
+0003ff00: 2076 6172 6961 626c 6573 2c20 696e 636c   variables, incl
+0003ff10: 7564 696e 6720 636f 6f72 6469 6e61 7465  uding coordinate
+0003ff20: 730a 2020 2020 2020 2020 6966 2073 7065  s.        if spe
+0003ff30: 6369 6669 6564 2e20 5468 6520 6469 7265  cified. The dire
+0003ff40: 6374 696f 6e20 6f66 2072 6f74 6174 696f  ction of rotatio
+0003ff50: 6e20 6973 2063 6f6e 7369 7374 656e 7420  n is consistent 
+0003ff60: 7769 7468 0a20 2020 2020 2020 203a 7079  with.        :py
+0003ff70: 3a66 756e 633a 606e 756d 7079 2e72 6f6c  :func:`numpy.rol
+0003ff80: 6c60 2e0a 0a20 2020 2020 2020 2050 6172  l`...        Par
+0003ff90: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+0003ffa0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+0003ffb0: 2020 2073 6869 6674 7320 3a20 6d61 7070     shifts : mapp
+0003ffc0: 696e 6720 6f66 2068 6173 6861 626c 6520  ing of hashable 
+0003ffd0: 746f 2069 6e74 2c20 6f70 7469 6f6e 616c  to int, optional
+0003ffe0: 0a20 2020 2020 2020 2020 2020 2041 2064  .            A d
+0003fff0: 6963 7420 7769 7468 206b 6579 7320 6d61  ict with keys ma
+00040000: 7463 6869 6e67 2064 696d 656e 7369 6f6e  tching dimension
+00040010: 7320 616e 6420 7661 6c75 6573 2067 6976  s and values giv
+00040020: 656e 0a20 2020 2020 2020 2020 2020 2062  en.            b
+00040030: 7920 696e 7465 6765 7273 2074 6f20 726f  y integers to ro
+00040040: 7461 7465 2065 6163 6820 6f66 2074 6865  tate each of the
+00040050: 2067 6976 656e 2064 696d 656e 7369 6f6e   given dimension
+00040060: 732e 2050 6f73 6974 6976 650a 2020 2020  s. Positive.    
+00040070: 2020 2020 2020 2020 6f66 6673 6574 7320          offsets 
+00040080: 726f 6c6c 2074 6f20 7468 6520 7269 6768  roll to the righ
+00040090: 743b 206e 6567 6174 6976 6520 6f66 6673  t; negative offs
+000400a0: 6574 7320 726f 6c6c 2074 6f20 7468 6520  ets roll to the 
+000400b0: 6c65 6674 2e0a 2020 2020 2020 2020 726f  left..        ro
+000400c0: 6c6c 5f63 6f6f 7264 7320 3a20 626f 6f6c  ll_coords : bool
+000400d0: 2c20 6465 6661 756c 743a 2046 616c 7365  , default: False
+000400e0: 0a20 2020 2020 2020 2020 2020 2049 6e64  .            Ind
+000400f0: 6963 6174 6573 2077 6865 7468 6572 2074  icates whether t
+00040100: 6f20 726f 6c6c 2074 6865 2063 6f6f 7264  o roll the coord
+00040110: 696e 6174 6573 2062 7920 7468 6520 6f66  inates by the of
+00040120: 6673 6574 2074 6f6f 2e0a 2020 2020 2020  fset too..      
+00040130: 2020 2a2a 7368 6966 7473 5f6b 7761 7267    **shifts_kwarg
+00040140: 7320 3a20 7b64 696d 3a20 6f66 6673 6574  s : {dim: offset
+00040150: 2c20 2e2e 2e7d 2c20 6f70 7469 6f6e 616c  , ...}, optional
+00040160: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00040170: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00040180: 7473 2066 6f72 6d20 6f66 2060 6073 6869  ts form of ``shi
+00040190: 6674 7360 602e 0a20 2020 2020 2020 2020  fts``..         
+000401a0: 2020 204f 6e65 206f 6620 7368 6966 7473     One of shifts
+000401b0: 206f 7220 7368 6966 7473 5f6b 7761 7267   or shifts_kwarg
+000401c0: 7320 6d75 7374 2062 6520 7072 6f76 6964  s must be provid
+000401d0: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
+000401e0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+000401f0: 2d2d 2d2d 0a20 2020 2020 2020 2072 6f6c  ----.        rol
+00040200: 6c65 6420 3a20 4461 7461 7365 740a 2020  led : Dataset.  
+00040210: 2020 2020 2020 2020 2020 4461 7461 7365            Datase
+00040220: 7420 7769 7468 2074 6865 2073 616d 6520  t with the same 
+00040230: 6174 7472 6962 7574 6573 2062 7574 2072  attributes but r
+00040240: 6f6c 6c65 6420 6461 7461 2061 6e64 2063  olled data and c
+00040250: 6f6f 7264 696e 6174 6573 2e0a 0a20 2020  oordinates...   
+00040260: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00040270: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00040280: 2020 2020 2020 2073 6869 6674 0a0a 2020         shift..  
+00040290: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
+000402a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+000402b0: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+000402c0: 2078 722e 4461 7461 7365 7428 7b22 666f   xr.Dataset({"fo
+000402d0: 6f22 3a20 2822 7822 2c20 6c69 7374 2822  o": ("x", list("
+000402e0: 6162 6364 6522 2929 7d2c 2063 6f6f 7264  abcde"))}, coord
+000402f0: 733d 7b22 7822 3a20 6e70 2e61 7261 6e67  s={"x": np.arang
+00040300: 6528 3529 7d29 0a20 2020 2020 2020 203e  e(5)}).        >
+00040310: 3e3e 2064 732e 726f 6c6c 2878 3d32 290a  >> ds.roll(x=2).
+00040320: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+00040330: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+00040340: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
+00040350: 3a20 3529 0a20 2020 2020 2020 2043 6f6f  : 5).        Coo
+00040360: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+00040370: 2020 2020 2a20 7820 2020 2020 2020 2028      * x        (
+00040380: 7829 2069 6e74 3634 2030 2031 2032 2033  x) int64 0 1 2 3
+00040390: 2034 0a20 2020 2020 2020 2044 6174 6120   4.        Data 
+000403a0: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+000403b0: 2020 2020 2020 2066 6f6f 2020 2020 2020         foo      
+000403c0: 2878 2920 3c55 3120 2764 2720 2765 2720  (x) <U1 'd' 'e' 
+000403d0: 2761 2720 2762 2720 2763 270a 0a20 2020  'a' 'b' 'c'..   
+000403e0: 2020 2020 203e 3e3e 2064 732e 726f 6c6c       >>> ds.roll
+000403f0: 2878 3d32 2c20 726f 6c6c 5f63 6f6f 7264  (x=2, roll_coord
+00040400: 733d 5472 7565 290a 2020 2020 2020 2020  s=True).        
+00040410: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
+00040420: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00040430: 6f6e 733a 2020 2878 3a20 3529 0a20 2020  ons:  (x: 5).   
+00040440: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+00040450: 3a0a 2020 2020 2020 2020 2020 2a20 7820  :.          * x 
+00040460: 2020 2020 2020 2028 7829 2069 6e74 3634         (x) int64
+00040470: 2033 2034 2030 2031 2032 0a20 2020 2020   3 4 0 1 2.     
+00040480: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
+00040490: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+000404a0: 6f6f 2020 2020 2020 2878 2920 3c55 3120  oo      (x) <U1 
+000404b0: 2764 2720 2765 2720 2761 2720 2762 2720  'd' 'e' 'a' 'b' 
+000404c0: 2763 270a 0a20 2020 2020 2020 2022 2222  'c'..        """
+000404d0: 0a20 2020 2020 2020 2073 6869 6674 7320  .        shifts 
+000404e0: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
+000404f0: 5f6b 7761 7267 7328 7368 6966 7473 2c20  _kwargs(shifts, 
+00040500: 7368 6966 7473 5f6b 7761 7267 732c 2022  shifts_kwargs, "
+00040510: 726f 6c6c 2229 0a20 2020 2020 2020 2069  roll").        i
+00040520: 6e76 616c 6964 203d 205b 6b20 666f 7220  nvalid = [k for 
+00040530: 6b20 696e 2073 6869 6674 7320 6966 206b  k in shifts if k
+00040540: 206e 6f74 2069 6e20 7365 6c66 2e64 696d   not in self.dim
+00040550: 735d 0a20 2020 2020 2020 2069 6620 696e  s].        if in
+00040560: 7661 6c69 643a 0a20 2020 2020 2020 2020  valid:.         
+00040570: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00040580: 726f 7228 6622 6469 6d65 6e73 696f 6e73  ror(f"dimensions
+00040590: 207b 696e 7661 6c69 6421 727d 2064 6f20   {invalid!r} do 
+000405a0: 6e6f 7420 6578 6973 7422 290a 0a20 2020  not exist")..   
+000405b0: 2020 2020 2075 6e72 6f6c 6c65 645f 7661       unrolled_va
+000405c0: 7273 3a20 7475 706c 655b 4861 7368 6162  rs: tuple[Hashab
+000405d0: 6c65 2c20 2e2e 2e5d 0a0a 2020 2020 2020  le, ...]..      
+000405e0: 2020 6966 2072 6f6c 6c5f 636f 6f72 6473    if roll_coords
+000405f0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+00040600: 6465 7865 732c 2069 6e64 6578 5f76 6172  dexes, index_var
+00040610: 7320 3d20 726f 6c6c 5f69 6e64 6578 6573  s = roll_indexes
+00040620: 2873 656c 662e 7869 6e64 6578 6573 2c20  (self.xindexes, 
+00040630: 7368 6966 7473 290a 2020 2020 2020 2020  shifts).        
+00040640: 2020 2020 756e 726f 6c6c 6564 5f76 6172      unrolled_var
+00040650: 7320 3d20 2829 0a20 2020 2020 2020 2065  s = ().        e
+00040660: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00040670: 2069 6e64 6578 6573 203d 2064 6963 7428   indexes = dict(
+00040680: 7365 6c66 2e5f 696e 6465 7865 7329 0a20  self._indexes). 
+00040690: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+000406a0: 5f76 6172 7320 3d20 6469 6374 2873 656c  _vars = dict(sel
+000406b0: 662e 7869 6e64 6578 6573 2e76 6172 6961  f.xindexes.varia
+000406c0: 626c 6573 290a 2020 2020 2020 2020 2020  bles).          
+000406d0: 2020 756e 726f 6c6c 6564 5f76 6172 7320    unrolled_vars 
+000406e0: 3d20 7475 706c 6528 7365 6c66 2e63 6f6f  = tuple(self.coo
+000406f0: 7264 7329 0a0a 2020 2020 2020 2020 7661  rds)..        va
+00040700: 7269 6162 6c65 7320 3d20 7b7d 0a20 2020  riables = {}.   
+00040710: 2020 2020 2066 6f72 206b 2c20 7661 7220       for k, var 
+00040720: 696e 2073 656c 662e 7661 7269 6162 6c65  in self.variable
+00040730: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+00040740: 2020 2020 2020 2069 6620 6b20 696e 2069         if k in i
+00040750: 6e64 6578 5f76 6172 733a 0a20 2020 2020  ndex_vars:.     
+00040760: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+00040770: 626c 6573 5b6b 5d20 3d20 696e 6465 785f  bles[k] = index_
+00040780: 7661 7273 5b6b 5d0a 2020 2020 2020 2020  vars[k].        
+00040790: 2020 2020 656c 6966 206b 206e 6f74 2069      elif k not i
+000407a0: 6e20 756e 726f 6c6c 6564 5f76 6172 733a  n unrolled_vars:
+000407b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000407c0: 2076 6172 6961 626c 6573 5b6b 5d20 3d20   variables[k] = 
+000407d0: 7661 722e 726f 6c6c 280a 2020 2020 2020  var.roll(.      
+000407e0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+000407f0: 6966 7473 3d7b 6b3a 2073 2066 6f72 206b  ifts={k: s for k
+00040800: 2c20 7320 696e 2073 6869 6674 732e 6974  , s in shifts.it
+00040810: 656d 7328 2920 6966 206b 2069 6e20 7661  ems() if k in va
+00040820: 722e 6469 6d73 7d0a 2020 2020 2020 2020  r.dims}.        
+00040830: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00040840: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00040850: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+00040860: 6162 6c65 735b 6b5d 203d 2076 6172 0a0a  ables[k] = var..
+00040870: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00040880: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
+00040890: 6961 626c 6573 2c20 696e 6465 7865 733d  iables, indexes=
+000408a0: 696e 6465 7865 7329 0a0a 2020 2020 6465  indexes)..    de
+000408b0: 6620 736f 7274 6279 280a 2020 2020 2020  f sortby(.      
+000408c0: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
+000408d0: 742c 0a20 2020 2020 2020 2076 6172 6961  t,.        varia
+000408e0: 626c 6573 3a20 4861 7368 6162 6c65 207c  bles: Hashable |
+000408f0: 2044 6174 6141 7272 6179 207c 206c 6973   DataArray | lis
+00040900: 745b 4861 7368 6162 6c65 207c 2044 6174  t[Hashable | Dat
+00040910: 6141 7272 6179 5d2c 0a20 2020 2020 2020  aArray],.       
+00040920: 2061 7363 656e 6469 6e67 3a20 626f 6f6c   ascending: bool
+00040930: 203d 2054 7275 652c 0a20 2020 2029 202d   = True,.    ) -
+00040940: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+00040950: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00040960: 2053 6f72 7420 6f62 6a65 6374 2062 7920   Sort object by 
+00040970: 6c61 6265 6c73 206f 7220 7661 6c75 6573  labels or values
+00040980: 2028 616c 6f6e 6720 616e 2061 7869 7329   (along an axis)
+00040990: 2e0a 0a20 2020 2020 2020 2053 6f72 7473  ...        Sorts
+000409a0: 2074 6865 2064 6174 6173 6574 2c20 6569   the dataset, ei
+000409b0: 7468 6572 2061 6c6f 6e67 2073 7065 6369  ther along speci
+000409c0: 6669 6564 2064 696d 656e 7369 6f6e 732c  fied dimensions,
+000409d0: 0a20 2020 2020 2020 206f 7220 6163 636f  .        or acco
+000409e0: 7264 696e 6720 746f 2076 616c 7565 7320  rding to values 
+000409f0: 6f66 2031 2d44 2064 6174 6161 7272 6179  of 1-D dataarray
+00040a00: 7320 7468 6174 2073 6861 7265 2064 696d  s that share dim
+00040a10: 656e 7369 6f6e 0a20 2020 2020 2020 2077  ension.        w
+00040a20: 6974 6820 6361 6c6c 696e 6720 6f62 6a65  ith calling obje
+00040a30: 6374 2e0a 0a20 2020 2020 2020 2049 6620  ct...        If 
+00040a40: 7468 6520 696e 7075 7420 7661 7269 6162  the input variab
+00040a50: 6c65 7320 6172 6520 6461 7461 6172 7261  les are dataarra
+00040a60: 7973 2c20 7468 656e 2074 6865 2064 6174  ys, then the dat
+00040a70: 6161 7272 6179 7320 6172 6520 616c 6967  aarrays are alig
+00040a80: 6e65 640a 2020 2020 2020 2020 2876 6961  ned.        (via
+00040a90: 206c 6566 742d 6a6f 696e 2920 746f 2074   left-join) to t
+00040aa0: 6865 2063 616c 6c69 6e67 206f 626a 6563  he calling objec
+00040ab0: 7420 7072 696f 7220 746f 2073 6f72 7469  t prior to sorti
+00040ac0: 6e67 2062 7920 6365 6c6c 2076 616c 7565  ng by cell value
+00040ad0: 732e 0a20 2020 2020 2020 204e 614e 7320  s..        NaNs 
+00040ae0: 6172 6520 736f 7274 6564 2074 6f20 7468  are sorted to th
+00040af0: 6520 656e 642c 2066 6f6c 6c6f 7769 6e67  e end, following
+00040b00: 204e 756d 7079 2063 6f6e 7665 6e74 696f   Numpy conventio
+00040b10: 6e2e 0a0a 2020 2020 2020 2020 4966 206d  n...        If m
+00040b20: 756c 7469 706c 6520 736f 7274 7320 616c  ultiple sorts al
+00040b30: 6f6e 6720 7468 6520 7361 6d65 2064 696d  ong the same dim
+00040b40: 656e 7369 6f6e 2069 730a 2020 2020 2020  ension is.      
+00040b50: 2020 6769 7665 6e2c 206e 756d 7079 2773    given, numpy's
+00040b60: 206c 6578 736f 7274 2069 7320 7065 7266   lexsort is perf
+00040b70: 6f72 6d65 6420 616c 6f6e 6720 7468 6174  ormed along that
+00040b80: 2064 696d 656e 7369 6f6e 3a0a 2020 2020   dimension:.    
+00040b90: 2020 2020 6874 7470 733a 2f2f 6e75 6d70      https://nump
+00040ba0: 792e 6f72 672f 646f 632f 7374 6162 6c65  y.org/doc/stable
+00040bb0: 2f72 6566 6572 656e 6365 2f67 656e 6572  /reference/gener
+00040bc0: 6174 6564 2f6e 756d 7079 2e6c 6578 736f  ated/numpy.lexso
+00040bd0: 7274 2e68 746d 6c0a 2020 2020 2020 2020  rt.html.        
+00040be0: 616e 6420 7468 6520 4649 5253 5420 6b65  and the FIRST ke
+00040bf0: 7920 696e 2074 6865 2073 6571 7565 6e63  y in the sequenc
+00040c00: 6520 6973 2075 7365 6420 6173 2074 6865  e is used as the
+00040c10: 2070 7269 6d61 7279 2073 6f72 7420 6b65   primary sort ke
+00040c20: 792c 0a20 2020 2020 2020 2066 6f6c 6c6f  y,.        follo
+00040c30: 7765 6420 6279 2074 6865 2032 6e64 206b  wed by the 2nd k
+00040c40: 6579 2c20 6574 632e 0a0a 2020 2020 2020  ey, etc...      
+00040c50: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00040c60: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00040c70: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00040c80: 7320 3a20 4861 7368 6162 6c65 2c20 4461  s : Hashable, Da
+00040c90: 7461 4172 7261 792c 206f 7220 6c69 7374  taArray, or list
+00040ca0: 206f 6620 6861 7368 6162 6c65 206f 7220   of hashable or 
+00040cb0: 4461 7461 4172 7261 790a 2020 2020 2020  DataArray.      
+00040cc0: 2020 2020 2020 3144 2044 6174 6141 7272        1D DataArr
+00040cd0: 6179 206f 626a 6563 7473 206f 7220 6e61  ay objects or na
+00040ce0: 6d65 2873 2920 6f66 2031 4420 7661 7269  me(s) of 1D vari
+00040cf0: 6162 6c65 2873 2920 696e 0a20 2020 2020  able(s) in.     
+00040d00: 2020 2020 2020 2063 6f6f 7264 732f 6461         coords/da
+00040d10: 7461 5f76 6172 7320 7768 6f73 6520 7661  ta_vars whose va
+00040d20: 6c75 6573 2061 7265 2075 7365 6420 746f  lues are used to
+00040d30: 2073 6f72 7420 7468 6520 6461 7461 7365   sort the datase
+00040d40: 742e 0a20 2020 2020 2020 2061 7363 656e  t..        ascen
+00040d50: 6469 6e67 203a 2062 6f6f 6c2c 2064 6566  ding : bool, def
+00040d60: 6175 6c74 3a20 5472 7565 0a20 2020 2020  ault: True.     
+00040d70: 2020 2020 2020 2057 6865 7468 6572 2074         Whether t
+00040d80: 6f20 736f 7274 2062 7920 6173 6365 6e64  o sort by ascend
+00040d90: 696e 6720 6f72 2064 6573 6365 6e64 696e  ing or descendin
+00040da0: 6720 6f72 6465 722e 0a0a 2020 2020 2020  g order...      
+00040db0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00040dc0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00040dd0: 2020 736f 7274 6564 203a 2044 6174 6173    sorted : Datas
+00040de0: 6574 0a20 2020 2020 2020 2020 2020 2041  et.            A
+00040df0: 206e 6577 2064 6174 6173 6574 2077 6865   new dataset whe
+00040e00: 7265 2061 6c6c 2074 6865 2073 7065 6369  re all the speci
+00040e10: 6669 6564 2064 696d 7320 6172 6520 736f  fied dims are so
+00040e20: 7274 6564 2062 7920 6469 6d0a 2020 2020  rted by dim.    
+00040e30: 2020 2020 2020 2020 6c61 6265 6c73 2e0a          labels..
+00040e40: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00040e50: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00040e60: 2d2d 0a20 2020 2020 2020 2044 6174 6141  --.        DataA
+00040e70: 7272 6179 2e73 6f72 7462 790a 2020 2020  rray.sortby.    
+00040e80: 2020 2020 6e75 6d70 792e 736f 7274 0a20      numpy.sort. 
+00040e90: 2020 2020 2020 2070 616e 6461 732e 736f         pandas.so
+00040ea0: 7274 5f76 616c 7565 730a 2020 2020 2020  rt_values.      
+00040eb0: 2020 7061 6e64 6173 2e73 6f72 745f 696e    pandas.sort_in
+00040ec0: 6465 780a 0a20 2020 2020 2020 2045 7861  dex..        Exa
+00040ed0: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
+00040ee0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
+00040ef0: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
+00040f00: 6574 280a 2020 2020 2020 2020 2e2e 2e20  et(.        ... 
+00040f10: 2020 2020 7b0a 2020 2020 2020 2020 2e2e      {.        ..
+00040f20: 2e20 2020 2020 2020 2020 2241 223a 2028  .         "A": (
+00040f30: 2822 7822 2c20 2279 2229 2c20 5b5b 312c  ("x", "y"), [[1,
+00040f40: 2032 5d2c 205b 332c 2034 5d5d 292c 0a20   2], [3, 4]]),. 
+00040f50: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+00040f60: 2020 2022 4222 3a20 2828 2278 222c 2022     "B": (("x", "
+00040f70: 7922 292c 205b 5b35 2c20 365d 2c20 5b37  y"), [[5, 6], [7
+00040f80: 2c20 385d 5d29 2c0a 2020 2020 2020 2020  , 8]]),.        
+00040f90: 2e2e 2e20 2020 2020 7d2c 0a20 2020 2020  ...     },.     
+00040fa0: 2020 202e 2e2e 2020 2020 2063 6f6f 7264     ...     coord
+00040fb0: 733d 7b22 7822 3a20 5b22 6222 2c20 2261  s={"x": ["b", "a
+00040fc0: 225d 2c20 2279 223a 205b 312c 2030 5d7d  "], "y": [1, 0]}
+00040fd0: 2c0a 2020 2020 2020 2020 2e2e 2e20 290a  ,.        ... ).
+00040fe0: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+00040ff0: 2064 732e 736f 7274 6279 2822 7822 290a   ds.sortby("x").
+00041000: 2020 2020 2020 2020 3e3e 3e20 6473 0a20          >>> ds. 
+00041010: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+00041020: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+00041030: 4469 6d65 6e73 696f 6e73 3a20 2028 783a  Dimensions:  (x:
+00041040: 2032 2c20 793a 2032 290a 2020 2020 2020   2, y: 2).      
+00041050: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+00041060: 2020 2020 2020 2020 202a 2078 2020 2020           * x    
+00041070: 2020 2020 2878 2920 3c55 3120 2761 2720      (x) <U1 'a' 
+00041080: 2762 270a 2020 2020 2020 2020 2020 2a20  'b'.          * 
+00041090: 7920 2020 2020 2020 2028 7929 2069 6e74  y        (y) int
+000410a0: 3634 2031 2030 0a20 2020 2020 2020 2044  64 1 0.        D
+000410b0: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+000410c0: 2020 2020 2020 2020 2020 2041 2020 2020             A    
+000410d0: 2020 2020 2878 2c20 7929 2069 6e74 3634      (x, y) int64
+000410e0: 2033 2034 2031 2032 0a20 2020 2020 2020   3 4 1 2.       
+000410f0: 2020 2020 2042 2020 2020 2020 2020 2878       B        (x
+00041100: 2c20 7929 2069 6e74 3634 2037 2038 2035  , y) int64 7 8 5
+00041110: 2036 0a20 2020 2020 2020 2022 2222 0a20   6.        """. 
+00041120: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
+00041130: 6179 2e63 6f72 652e 6461 7461 6172 7261  ay.core.dataarra
+00041140: 7920 696d 706f 7274 2044 6174 6141 7272  y import DataArr
+00041150: 6179 0a0a 2020 2020 2020 2020 6966 206e  ay..        if n
+00041160: 6f74 2069 7369 6e73 7461 6e63 6528 7661  ot isinstance(va
+00041170: 7269 6162 6c65 732c 206c 6973 7429 3a0a  riables, list):.
+00041180: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+00041190: 6162 6c65 7320 3d20 5b76 6172 6961 626c  ables = [variabl
+000411a0: 6573 5d0a 2020 2020 2020 2020 656c 7365  es].        else
+000411b0: 3a0a 2020 2020 2020 2020 2020 2020 7661  :.            va
+000411c0: 7269 6162 6c65 7320 3d20 7661 7269 6162  riables = variab
+000411d0: 6c65 730a 2020 2020 2020 2020 6172 7261  les.        arra
+000411e0: 7973 203d 205b 7620 6966 2069 7369 6e73  ys = [v if isins
+000411f0: 7461 6e63 6528 762c 2044 6174 6141 7272  tance(v, DataArr
+00041200: 6179 2920 656c 7365 2073 656c 665b 765d  ay) else self[v]
+00041210: 2066 6f72 2076 2069 6e20 7661 7269 6162   for v in variab
+00041220: 6c65 735d 0a20 2020 2020 2020 2061 6c69  les].        ali
+00041230: 676e 6564 5f76 6172 7320 3d20 616c 6967  gned_vars = alig
+00041240: 6e28 7365 6c66 2c20 2a61 7272 6179 732c  n(self, *arrays,
+00041250: 206a 6f69 6e3d 226c 6566 7422 2920 2023   join="left")  #
+00041260: 2074 7970 653a 2069 676e 6f72 655b 7479   type: ignore[ty
+00041270: 7065 2d76 6172 5d0a 2020 2020 2020 2020  pe-var].        
+00041280: 616c 6967 6e65 645f 7365 6c66 3a20 545f  aligned_self: T_
+00041290: 4461 7461 7365 7420 3d20 616c 6967 6e65  Dataset = aligne
+000412a0: 645f 7661 7273 5b30 5d20 2023 2074 7970  d_vars[0]  # typ
+000412b0: 653a 2069 676e 6f72 655b 6173 7369 676e  e: ignore[assign
+000412c0: 6d65 6e74 5d0a 2020 2020 2020 2020 616c  ment].        al
+000412d0: 6967 6e65 645f 6f74 6865 725f 7661 7273  igned_other_vars
+000412e0: 3a20 7475 706c 655b 4461 7461 4172 7261  : tuple[DataArra
+000412f0: 792c 202e 2e2e 5d20 3d20 616c 6967 6e65  y, ...] = aligne
+00041300: 645f 7661 7273 5b31 3a5d 2020 2320 7479  d_vars[1:]  # ty
+00041310: 7065 3a20 6967 6e6f 7265 5b61 7373 6967  pe: ignore[assig
+00041320: 6e6d 656e 745d 0a20 2020 2020 2020 2076  nment].        v
+00041330: 6172 735f 6279 5f64 696d 203d 2064 6566  ars_by_dim = def
+00041340: 6175 6c74 6469 6374 286c 6973 7429 0a20  aultdict(list). 
+00041350: 2020 2020 2020 2066 6f72 2064 6174 615f         for data_
+00041360: 6172 7261 7920 696e 2061 6c69 676e 6564  array in aligned
+00041370: 5f6f 7468 6572 5f76 6172 733a 0a20 2020  _other_vars:.   
+00041380: 2020 2020 2020 2020 2069 6620 6461 7461           if data
+00041390: 5f61 7272 6179 2e6e 6469 6d20 213d 2031  _array.ndim != 1
+000413a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000413b0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+000413c0: 6f72 2822 496e 7075 7420 4461 7461 4172  or("Input DataAr
+000413d0: 7261 7920 6973 206e 6f74 2031 2d44 2e22  ray is not 1-D."
+000413e0: 290a 2020 2020 2020 2020 2020 2020 286b  ).            (k
+000413f0: 6579 2c29 203d 2064 6174 615f 6172 7261  ey,) = data_arra
+00041400: 792e 6469 6d73 0a20 2020 2020 2020 2020  y.dims.         
+00041410: 2020 2076 6172 735f 6279 5f64 696d 5b6b     vars_by_dim[k
+00041420: 6579 5d2e 6170 7065 6e64 2864 6174 615f  ey].append(data_
+00041430: 6172 7261 7929 0a0a 2020 2020 2020 2020  array)..        
+00041440: 696e 6469 6365 7320 3d20 7b7d 0a20 2020  indices = {}.   
+00041450: 2020 2020 2066 6f72 206b 6579 2c20 6172       for key, ar
+00041460: 7261 7973 2069 6e20 7661 7273 5f62 795f  rays in vars_by_
+00041470: 6469 6d2e 6974 656d 7328 293a 0a20 2020  dim.items():.   
+00041480: 2020 2020 2020 2020 206f 7264 6572 203d           order =
+00041490: 206e 702e 6c65 7873 6f72 7428 7475 706c   np.lexsort(tupl
+000414a0: 6528 7265 7665 7273 6564 2861 7272 6179  e(reversed(array
+000414b0: 7329 2929 0a20 2020 2020 2020 2020 2020  s))).           
+000414c0: 2069 6e64 6963 6573 5b6b 6579 5d20 3d20   indices[key] = 
+000414d0: 6f72 6465 7220 6966 2061 7363 656e 6469  order if ascendi
+000414e0: 6e67 2065 6c73 6520 6f72 6465 725b 3a3a  ng else order[::
+000414f0: 2d31 5d0a 2020 2020 2020 2020 7265 7475  -1].        retu
+00041500: 726e 2061 6c69 676e 6564 5f73 656c 662e  rn aligned_self.
+00041510: 6973 656c 2869 6e64 6963 6573 290a 0a20  isel(indices).. 
+00041520: 2020 2064 6566 2071 7561 6e74 696c 6528     def quantile(
+00041530: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
+00041540: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
+00041550: 2020 713a 2041 7272 6179 4c69 6b65 2c0a    q: ArrayLike,.
+00041560: 2020 2020 2020 2020 6469 6d3a 2044 696d          dim: Dim
+00041570: 7320 3d20 4e6f 6e65 2c0a 2020 2020 2020  s = None,.      
+00041580: 2020 6d65 7468 6f64 3a20 5175 616e 7469    method: Quanti
+00041590: 6c65 4d65 7468 6f64 7320 3d20 226c 696e  leMethods = "lin
+000415a0: 6561 7222 2c0a 2020 2020 2020 2020 6e75  ear",.        nu
+000415b0: 6d65 7269 635f 6f6e 6c79 3a20 626f 6f6c  meric_only: bool
+000415c0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+000415d0: 2020 6b65 6570 5f61 7474 7273 3a20 626f    keep_attrs: bo
+000415e0: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
+000415f0: 2c0a 2020 2020 2020 2020 736b 6970 6e61  ,.        skipna
+00041600: 3a20 626f 6f6c 207c 204e 6f6e 6520 3d20  : bool | None = 
+00041610: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
+00041620: 7465 7270 6f6c 6174 696f 6e3a 2051 7561  terpolation: Qua
+00041630: 6e74 696c 654d 6574 686f 6473 207c 204e  ntileMethods | N
+00041640: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00041650: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+00041660: 2020 2020 2020 2020 2222 2243 6f6d 7075          """Compu
+00041670: 7465 2074 6865 2071 7468 2071 7561 6e74  te the qth quant
+00041680: 696c 6520 6f66 2074 6865 2064 6174 6120  ile of the data 
+00041690: 616c 6f6e 6720 7468 6520 7370 6563 6966  along the specif
+000416a0: 6965 6420 6469 6d65 6e73 696f 6e2e 0a0a  ied dimension...
+000416b0: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+000416c0: 7468 6520 7174 6820 7175 616e 7469 6c65  the qth quantile
+000416d0: 7328 7329 206f 6620 7468 6520 6172 7261  s(s) of the arra
+000416e0: 7920 656c 656d 656e 7473 2066 6f72 2065  y elements for e
+000416f0: 6163 6820 7661 7269 6162 6c65 0a20 2020  ach variable.   
+00041700: 2020 2020 2069 6e20 7468 6520 4461 7461       in the Data
+00041710: 7365 742e 0a0a 2020 2020 2020 2020 5061  set...        Pa
+00041720: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00041730: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00041740: 2020 2020 7120 3a20 666c 6f61 7420 6f72      q : float or
+00041750: 2061 7272 6179 2d6c 696b 6520 6f66 2066   array-like of f
+00041760: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00041770: 2051 7561 6e74 696c 6520 746f 2063 6f6d   Quantile to com
+00041780: 7075 7465 2c20 7768 6963 6820 6d75 7374  pute, which must
+00041790: 2062 6520 6265 7477 6565 6e20 3020 616e   be between 0 an
+000417a0: 6420 3120 696e 636c 7573 6976 652e 0a20  d 1 inclusive.. 
+000417b0: 2020 2020 2020 2064 696d 203a 2073 7472         dim : str
+000417c0: 206f 7220 4974 6572 6162 6c65 206f 6620   or Iterable of 
+000417d0: 4861 7368 6162 6c65 2c20 6f70 7469 6f6e  Hashable, option
+000417e0: 616c 0a20 2020 2020 2020 2020 2020 2044  al.            D
+000417f0: 696d 656e 7369 6f6e 2873 2920 6f76 6572  imension(s) over
+00041800: 2077 6869 6368 2074 6f20 6170 706c 7920   which to apply 
+00041810: 7175 616e 7469 6c65 2e0a 2020 2020 2020  quantile..      
+00041820: 2020 6d65 7468 6f64 203a 2073 7472 2c20    method : str, 
+00041830: 6465 6661 756c 743a 2022 6c69 6e65 6172  default: "linear
+00041840: 220a 2020 2020 2020 2020 2020 2020 5468  ".            Th
+00041850: 6973 206f 7074 696f 6e61 6c20 7061 7261  is optional para
+00041860: 6d65 7465 7220 7370 6563 6966 6965 7320  meter specifies 
+00041870: 7468 6520 696e 7465 7270 6f6c 6174 696f  the interpolatio
+00041880: 6e20 6d65 7468 6f64 2074 6f20 7573 6520  n method to use 
+00041890: 7768 656e 2074 6865 0a20 2020 2020 2020  when the.       
+000418a0: 2020 2020 2064 6573 6972 6564 2071 7561       desired qua
+000418b0: 6e74 696c 6520 6c69 6573 2062 6574 7765  ntile lies betwe
+000418c0: 656e 2074 776f 2064 6174 6120 706f 696e  en two data poin
+000418d0: 7473 2e20 5468 6520 6f70 7469 6f6e 7320  ts. The options 
+000418e0: 736f 7274 6564 2062 7920 7468 6569 7220  sorted by their 
+000418f0: 520a 2020 2020 2020 2020 2020 2020 7479  R.            ty
+00041900: 7065 2061 7320 7375 6d6d 6172 697a 6564  pe as summarized
+00041910: 2069 6e20 7468 6520 4826 4620 7061 7065   in the H&F pape
+00041920: 7220 5b31 5d5f 2061 7265 3a0a 0a20 2020  r [1]_ are:..   
+00041930: 2020 2020 2020 2020 2020 2020 2031 2e20               1. 
+00041940: 2269 6e76 6572 7465 645f 6364 6622 2028  "inverted_cdf" (
+00041950: 2a29 0a20 2020 2020 2020 2020 2020 2020  *).             
+00041960: 2020 2032 2e20 2261 7665 7261 6765 645f     2. "averaged_
+00041970: 696e 7665 7274 6564 5f63 6466 2220 282a  inverted_cdf" (*
+00041980: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00041990: 2020 332e 2022 636c 6f73 6573 745f 6f62    3. "closest_ob
+000419a0: 7365 7276 6174 696f 6e22 2028 2a29 0a20  servation" (*). 
+000419b0: 2020 2020 2020 2020 2020 2020 2020 2034                 4
+000419c0: 2e20 2269 6e74 6572 706f 6c61 7465 645f  . "interpolated_
+000419d0: 696e 7665 7274 6564 5f63 6466 2220 282a  inverted_cdf" (*
+000419e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000419f0: 2020 352e 2022 6861 7a65 6e22 2028 2a29    5. "hazen" (*)
+00041a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041a10: 2036 2e20 2277 6569 6275 6c6c 2220 282a   6. "weibull" (*
+00041a20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00041a30: 2020 372e 2022 6c69 6e65 6172 2220 2028    7. "linear"  (
+00041a40: 6465 6661 756c 7429 0a20 2020 2020 2020  default).       
+00041a50: 2020 2020 2020 2020 2038 2e20 226d 6564           8. "med
+00041a60: 6961 6e5f 756e 6269 6173 6564 2220 282a  ian_unbiased" (*
+00041a70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00041a80: 2020 392e 2022 6e6f 726d 616c 5f75 6e62    9. "normal_unb
+00041a90: 6961 7365 6422 2028 2a29 0a0a 2020 2020  iased" (*)..    
+00041aa0: 2020 2020 2020 2020 5468 6520 6669 7273          The firs
+00041ab0: 7420 7468 7265 6520 6d65 7468 6f64 7320  t three methods 
+00041ac0: 6172 6520 6469 7363 6f6e 7469 756f 7573  are discontiuous
+00041ad0: 2e20 2054 6865 2066 6f6c 6c6f 7769 6e67  .  The following
+00041ae0: 2064 6973 636f 6e74 696e 756f 7573 0a20   discontinuous. 
+00041af0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+00041b00: 7469 6f6e 7320 6f66 2074 6865 2064 6566  tions of the def
+00041b10: 6175 6c74 2022 6c69 6e65 6172 2220 2837  ault "linear" (7
+00041b20: 2e29 206f 7074 696f 6e20 6172 6520 616c  .) option are al
+00041b30: 736f 2061 7661 696c 6162 6c65 3a0a 0a20  so available:.. 
+00041b40: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00041b50: 2022 6c6f 7765 7222 0a20 2020 2020 2020   "lower".       
+00041b60: 2020 2020 2020 2020 202a 2022 6869 6768           * "high
+00041b70: 6572 220a 2020 2020 2020 2020 2020 2020  er".            
+00041b80: 2020 2020 2a20 226d 6964 706f 696e 7422      * "midpoint"
 00041b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041ba0: 2022 5468 6520 6069 6e74 6572 706f 6c61   "The `interpola
-00041bb0: 7469 6f6e 6020 6172 6775 6d65 6e74 2074  tion` argument t
-00041bc0: 6f20 7175 616e 7469 6c65 2077 6173 2072  o quantile was r
-00041bd0: 656e 616d 6564 2074 6f20 606d 6574 686f  enamed to `metho
-00041be0: 6460 2e22 2c0a 2020 2020 2020 2020 2020  d`.",.          
-00041bf0: 2020 2020 2020 4675 7475 7265 5761 726e        FutureWarn
-00041c00: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
-00041c10: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00041c20: 6966 206d 6574 686f 6420 213d 2022 6c69  if method != "li
-00041c30: 6e65 6172 223a 0a20 2020 2020 2020 2020  near":.         
-00041c40: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00041c50: 6545 7272 6f72 2822 4361 6e6e 6f74 2070  eError("Cannot p
-00041c60: 6173 7320 696e 7465 7270 6f6c 6174 696f  ass interpolatio
-00041c70: 6e20 616e 6420 6d65 7468 6f64 206b 6579  n and method key
-00041c80: 776f 7264 7321 2229 0a0a 2020 2020 2020  words!")..      
-00041c90: 2020 2020 2020 6d65 7468 6f64 203d 2069        method = i
-00041ca0: 6e74 6572 706f 6c61 7469 6f6e 0a0a 2020  nterpolation..  
-00041cb0: 2020 2020 2020 6469 6d73 3a20 7365 745b        dims: set[
-00041cc0: 4861 7368 6162 6c65 5d0a 2020 2020 2020  Hashable].      
-00041cd0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00041ce0: 6469 6d2c 2073 7472 293a 0a20 2020 2020  dim, str):.     
-00041cf0: 2020 2020 2020 2064 696d 7320 3d20 7b64         dims = {d
-00041d00: 696d 7d0a 2020 2020 2020 2020 656c 6966  im}.        elif
-00041d10: 2064 696d 2069 7320 4e6f 6e65 206f 7220   dim is None or 
-00041d20: 6469 6d20 6973 202e 2e2e 3a0a 2020 2020  dim is ...:.    
-00041d30: 2020 2020 2020 2020 6469 6d73 203d 2073          dims = s
-00041d40: 6574 2873 656c 662e 6469 6d73 290a 2020  et(self.dims).  
-00041d50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00041d60: 2020 2020 2020 2020 6469 6d73 203d 2073          dims = s
-00041d70: 6574 2864 696d 290a 0a20 2020 2020 2020  et(dim)..       
-00041d80: 205f 6173 7365 7274 5f65 6d70 7479 280a   _assert_empty(.
-00041d90: 2020 2020 2020 2020 2020 2020 7475 706c              tupl
-00041da0: 6528 6420 666f 7220 6420 696e 2064 696d  e(d for d in dim
-00041db0: 7320 6966 2064 206e 6f74 2069 6e20 7365  s if d not in se
-00041dc0: 6c66 2e64 696d 7329 2c0a 2020 2020 2020  lf.dims),.      
-00041dd0: 2020 2020 2020 2244 6174 6173 6574 2064        "Dataset d
-00041de0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
-00041df0: 7468 6520 6469 6d65 6e73 696f 6e73 3a20  the dimensions: 
-00041e00: 2573 222c 0a20 2020 2020 2020 2029 0a0a  %s",.        )..
-00041e10: 2020 2020 2020 2020 7120 3d20 6e70 2e61          q = np.a
-00041e20: 7361 7272 6179 2871 2c20 6474 7970 653d  sarray(q, dtype=
-00041e30: 6e70 2e66 6c6f 6174 3634 290a 0a20 2020  np.float64)..   
-00041e40: 2020 2020 2076 6172 6961 626c 6573 203d       variables =
-00041e50: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-00041e60: 6e61 6d65 2c20 7661 7220 696e 2073 656c  name, var in sel
-00041e70: 662e 7661 7269 6162 6c65 732e 6974 656d  f.variables.item
-00041e80: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00041e90: 2072 6564 7563 655f 6469 6d73 203d 205b   reduce_dims = [
-00041ea0: 6420 666f 7220 6420 696e 2076 6172 2e64  d for d in var.d
-00041eb0: 696d 7320 6966 2064 2069 6e20 6469 6d73  ims if d in dims
-00041ec0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00041ed0: 2072 6564 7563 655f 6469 6d73 206f 7220   reduce_dims or 
-00041ee0: 6e6f 7420 7661 722e 6469 6d73 3a0a 2020  not var.dims:.  
-00041ef0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00041f00: 206e 616d 6520 6e6f 7420 696e 2073 656c   name not in sel
-00041f10: 662e 636f 6f72 6473 3a0a 2020 2020 2020  f.coords:.      
-00041f20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00041f30: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00041f40: 2020 2020 2020 2020 2020 206e 6f74 206e             not n
-00041f50: 756d 6572 6963 5f6f 6e6c 790a 2020 2020  umeric_only.    
-00041f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041f70: 2020 2020 6f72 206e 702e 6973 7375 6264      or np.issubd
-00041f80: 7479 7065 2876 6172 2e64 7479 7065 2c20  type(var.dtype, 
-00041f90: 6e70 2e6e 756d 6265 7229 0a20 2020 2020  np.number).     
-00041fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041fb0: 2020 206f 7220 7661 722e 6474 7970 6520     or var.dtype 
-00041fc0: 3d3d 206e 702e 626f 6f6c 5f0a 2020 2020  == np.bool_.    
-00041fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041fe0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00041ba0: 202a 2022 6e65 6172 6573 7422 0a0a 2020   * "nearest"..  
+00041bb0: 2020 2020 2020 2020 2020 5365 6520 3a70            See :p
+00041bc0: 793a 6675 6e63 3a60 6e75 6d70 792e 7175  y:func:`numpy.qu
+00041bd0: 616e 7469 6c65 6020 6f72 205b 315d 5f20  antile` or [1]_ 
+00041be0: 666f 7220 6465 7461 696c 732e 2054 6865  for details. The
+00041bf0: 2022 6d65 7468 6f64 2220 6172 6775 6d65   "method" argume
+00041c00: 6e74 0a20 2020 2020 2020 2020 2020 2077  nt.            w
+00041c10: 6173 2070 7265 7669 6f75 736c 7920 6361  as previously ca
+00041c20: 6c6c 6564 2022 696e 7465 7270 6f6c 6174  lled "interpolat
+00041c30: 696f 6e22 2c20 7265 6e61 6d65 6420 696e  ion", renamed in
+00041c40: 2061 6363 6f72 6461 6e63 6520 7769 7468   accordance with
+00041c50: 206e 756d 7079 0a20 2020 2020 2020 2020   numpy.         
+00041c60: 2020 2076 6572 7369 6f6e 2031 2e32 322e     version 1.22.
+00041c70: 302e 0a0a 2020 2020 2020 2020 2020 2020  0...            
+00041c80: 282a 2920 5468 6573 6520 6d65 7468 6f64  (*) These method
+00041c90: 7320 7265 7175 6972 6520 6e75 6d70 7920  s require numpy 
+00041ca0: 7665 7273 696f 6e20 312e 3232 206f 7220  version 1.22 or 
+00041cb0: 6e65 7765 722e 0a0a 2020 2020 2020 2020  newer...        
+00041cc0: 6b65 6570 5f61 7474 7273 203a 2062 6f6f  keep_attrs : boo
+00041cd0: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
+00041ce0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00041cf0: 2074 6865 2064 6174 6173 6574 2773 2061   the dataset's a
+00041d00: 7474 7269 6275 7465 7320 2860 6174 7472  ttributes (`attr
+00041d10: 7360 2920 7769 6c6c 2062 6520 636f 7069  s`) will be copi
+00041d20: 6564 2066 726f 6d0a 2020 2020 2020 2020  ed from.        
+00041d30: 2020 2020 7468 6520 6f72 6967 696e 616c      the original
+00041d40: 206f 626a 6563 7420 746f 2074 6865 206e   object to the n
+00041d50: 6577 206f 6e65 2e20 2049 6620 4661 6c73  ew one.  If Fals
+00041d60: 6520 2864 6566 6175 6c74 292c 2074 6865  e (default), the
+00041d70: 206e 6577 0a20 2020 2020 2020 2020 2020   new.           
+00041d80: 206f 626a 6563 7420 7769 6c6c 2062 6520   object will be 
+00041d90: 7265 7475 726e 6564 2077 6974 686f 7574  returned without
+00041da0: 2061 7474 7269 6275 7465 732e 0a20 2020   attributes..   
+00041db0: 2020 2020 206e 756d 6572 6963 5f6f 6e6c       numeric_onl
+00041dc0: 7920 3a20 626f 6f6c 2c20 6f70 7469 6f6e  y : bool, option
+00041dd0: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
+00041de0: 6620 5472 7565 2c20 6f6e 6c79 2061 7070  f True, only app
+00041df0: 6c79 2060 6066 756e 6360 6020 746f 2076  ly ``func`` to v
+00041e00: 6172 6961 626c 6573 2077 6974 6820 6120  ariables with a 
+00041e10: 6e75 6d65 7269 6320 6474 7970 652e 0a20  numeric dtype.. 
+00041e20: 2020 2020 2020 2073 6b69 706e 6120 3a20         skipna : 
+00041e30: 626f 6f6c 2c20 6f70 7469 6f6e 616c 0a20  bool, optional. 
+00041e40: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00041e50: 7565 2c20 736b 6970 206d 6973 7369 6e67  ue, skip missing
+00041e60: 2076 616c 7565 7320 2861 7320 6d61 726b   values (as mark
+00041e70: 6564 2062 7920 4e61 4e29 2e20 4279 2064  ed by NaN). By d
+00041e80: 6566 6175 6c74 2c20 6f6e 6c79 0a20 2020  efault, only.   
+00041e90: 2020 2020 2020 2020 2073 6b69 7073 206d           skips m
+00041ea0: 6973 7369 6e67 2076 616c 7565 7320 666f  issing values fo
+00041eb0: 7220 666c 6f61 7420 6474 7970 6573 3b20  r float dtypes; 
+00041ec0: 6f74 6865 7220 6474 7970 6573 2065 6974  other dtypes eit
+00041ed0: 6865 7220 646f 206e 6f74 0a20 2020 2020  her do not.     
+00041ee0: 2020 2020 2020 2068 6176 6520 6120 7365         have a se
+00041ef0: 6e74 696e 656c 206d 6973 7369 6e67 2076  ntinel missing v
+00041f00: 616c 7565 2028 696e 7429 206f 7220 736b  alue (int) or sk
+00041f10: 6970 6e61 3d54 7275 6520 6861 7320 6e6f  ipna=True has no
+00041f20: 7420 6265 656e 0a20 2020 2020 2020 2020  t been.         
+00041f30: 2020 2069 6d70 6c65 6d65 6e74 6564 2028     implemented (
+00041f40: 6f62 6a65 6374 2c20 6461 7465 7469 6d65  object, datetime
+00041f50: 3634 206f 7220 7469 6d65 6465 6c74 6136  64 or timedelta6
+00041f60: 3429 2e0a 0a20 2020 2020 2020 2052 6574  4)...        Ret
+00041f70: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00041f80: 2d2d 2d2d 0a20 2020 2020 2020 2071 7561  ----.        qua
+00041f90: 6e74 696c 6573 203a 2044 6174 6173 6574  ntiles : Dataset
+00041fa0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00041fb0: 6071 6020 6973 2061 2073 696e 676c 6520  `q` is a single 
+00041fc0: 7175 616e 7469 6c65 2c20 7468 656e 2074  quantile, then t
+00041fd0: 6865 2072 6573 756c 7420 6973 2061 2073  he result is a s
+00041fe0: 6361 6c61 7220 666f 7220 6561 6368 0a20  calar for each. 
 00041ff0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-00042000: 626c 6573 5b6e 616d 655d 203d 2076 6172  bles[name] = var
-00042010: 2e71 7561 6e74 696c 6528 0a20 2020 2020  .quantile(.     
-00042020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042030: 2020 2020 2020 2071 2c0a 2020 2020 2020         q,.      
-00042040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042050: 2020 2020 2020 6469 6d3d 7265 6475 6365        dim=reduce
-00042060: 5f64 696d 732c 0a20 2020 2020 2020 2020  _dims,.         
-00042070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042080: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-00042090: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000420a0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-000420b0: 6570 5f61 7474 7273 3d6b 6565 705f 6174  ep_attrs=keep_at
-000420c0: 7472 732c 0a20 2020 2020 2020 2020 2020  trs,.           
-000420d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000420e0: 2073 6b69 706e 613d 736b 6970 6e61 2c0a   skipna=skipna,.
-000420f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042100: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00042110: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00042120: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00042130: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
-00042140: 6172 0a0a 2020 2020 2020 2020 2320 636f  ar..        # co
-00042150: 6e73 7472 7563 7420 7468 6520 6e65 7720  nstruct the new 
-00042160: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
-00042170: 636f 6f72 645f 6e61 6d65 7320 3d20 7b6b  coord_names = {k
-00042180: 2066 6f72 206b 2069 6e20 7365 6c66 2e63   for k in self.c
-00042190: 6f6f 7264 7320 6966 206b 2069 6e20 7661  oords if k in va
-000421a0: 7269 6162 6c65 737d 0a20 2020 2020 2020  riables}.       
-000421b0: 2069 6e64 6578 6573 203d 207b 6b3a 2076   indexes = {k: v
-000421c0: 2066 6f72 206b 2c20 7620 696e 2073 656c   for k, v in sel
-000421d0: 662e 5f69 6e64 6578 6573 2e69 7465 6d73  f._indexes.items
-000421e0: 2829 2069 6620 6b20 696e 2076 6172 6961  () if k in varia
-000421f0: 626c 6573 7d0a 2020 2020 2020 2020 6966  bles}.        if
-00042200: 206b 6565 705f 6174 7472 7320 6973 204e   keep_attrs is N
-00042210: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00042220: 206b 6565 705f 6174 7472 7320 3d20 5f67   keep_attrs = _g
-00042230: 6574 5f6b 6565 705f 6174 7472 7328 6465  et_keep_attrs(de
-00042240: 6661 756c 743d 4661 6c73 6529 0a20 2020  fault=False).   
-00042250: 2020 2020 2061 7474 7273 203d 2073 656c       attrs = sel
-00042260: 662e 6174 7472 7320 6966 206b 6565 705f  f.attrs if keep_
-00042270: 6174 7472 7320 656c 7365 204e 6f6e 650a  attrs else None.
-00042280: 2020 2020 2020 2020 6e65 7720 3d20 7365          new = se
-00042290: 6c66 2e5f 7265 706c 6163 655f 7769 7468  lf._replace_with
-000422a0: 5f6e 6577 5f64 696d 7328 0a20 2020 2020  _new_dims(.     
-000422b0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-000422c0: 2c20 636f 6f72 645f 6e61 6d65 733d 636f  , coord_names=co
-000422d0: 6f72 645f 6e61 6d65 732c 2061 7474 7273  ord_names, attrs
-000422e0: 3d61 7474 7273 2c20 696e 6465 7865 733d  =attrs, indexes=
-000422f0: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
-00042300: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00042310: 206e 6577 2e61 7373 6967 6e5f 636f 6f72   new.assign_coor
-00042320: 6473 2871 7561 6e74 696c 653d 7129 0a0a  ds(quantile=q)..
-00042330: 2020 2020 6465 6620 7261 6e6b 280a 2020      def rank(.  
-00042340: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
-00042350: 7461 7365 742c 0a20 2020 2020 2020 2064  taset,.        d
-00042360: 696d 3a20 4861 7368 6162 6c65 2c0a 2020  im: Hashable,.  
-00042370: 2020 2020 2020 7063 743a 2062 6f6f 6c20        pct: bool 
-00042380: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-00042390: 206b 6565 705f 6174 7472 733a 2062 6f6f   keep_attrs: boo
-000423a0: 6c20 7c20 4e6f 6e65 203d 204e 6f6e 652c  l | None = None,
-000423b0: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
-000423c0: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-000423d0: 5261 6e6b 7320 7468 6520 6461 7461 2e0a  Ranks the data..
-000423e0: 0a20 2020 2020 2020 2045 7175 616c 2076  .        Equal v
-000423f0: 616c 7565 7320 6172 6520 6173 7369 676e  alues are assign
-00042400: 6564 2061 2072 616e 6b20 7468 6174 2069  ed a rank that i
-00042410: 7320 7468 6520 6176 6572 6167 6520 6f66  s the average of
-00042420: 2074 6865 2072 616e 6b73 2074 6861 740a   the ranks that.
-00042430: 2020 2020 2020 2020 776f 756c 6420 6861          would ha
-00042440: 7665 2062 6565 6e20 6f74 6865 7277 6973  ve been otherwis
-00042450: 6520 6173 7369 676e 6564 2074 6f20 616c  e assigned to al
-00042460: 6c20 6f66 2074 6865 2076 616c 7565 7320  l of the values 
-00042470: 7769 7468 696e 0a20 2020 2020 2020 2074  within.        t
-00042480: 6861 7420 7365 742e 0a20 2020 2020 2020  hat set..       
-00042490: 2052 616e 6b73 2062 6567 696e 2061 7420   Ranks begin at 
-000424a0: 312c 206e 6f74 2030 2e20 4966 2070 6374  1, not 0. If pct
-000424b0: 2069 7320 5472 7565 2c20 636f 6d70 7574   is True, comput
-000424c0: 6573 2070 6572 6365 6e74 6167 6520 7261  es percentage ra
-000424d0: 6e6b 732e 0a0a 2020 2020 2020 2020 4e61  nks...        Na
-000424e0: 4e73 2069 6e20 7468 6520 696e 7075 7420  Ns in the input 
-000424f0: 6172 7261 7920 6172 6520 7265 7475 726e  array are return
-00042500: 6564 2061 7320 4e61 4e73 2e0a 0a20 2020  ed as NaNs...   
-00042510: 2020 2020 2054 6865 2060 626f 7474 6c65       The `bottle
-00042520: 6e65 636b 6020 6c69 6272 6172 7920 6973  neck` library is
-00042530: 2072 6571 7569 7265 642e 0a0a 2020 2020   required...    
-00042540: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00042550: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00042560: 2d0a 2020 2020 2020 2020 6469 6d20 3a20  -.        dim : 
-00042570: 4861 7368 6162 6c65 0a20 2020 2020 2020  Hashable.       
-00042580: 2020 2020 2044 696d 656e 7369 6f6e 206f       Dimension o
-00042590: 7665 7220 7768 6963 6820 746f 2063 6f6d  ver which to com
-000425a0: 7075 7465 2072 616e 6b2e 0a20 2020 2020  pute rank..     
-000425b0: 2020 2070 6374 203a 2062 6f6f 6c2c 2064     pct : bool, d
-000425c0: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
-000425d0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-000425e0: 652c 2063 6f6d 7075 7465 2070 6572 6365  e, compute perce
-000425f0: 6e74 6167 6520 7261 6e6b 732c 206f 7468  ntage ranks, oth
-00042600: 6572 7769 7365 2063 6f6d 7075 7465 2069  erwise compute i
-00042610: 6e74 6567 6572 2072 616e 6b73 2e0a 2020  nteger ranks..  
-00042620: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
-00042630: 203a 2062 6f6f 6c20 6f72 204e 6f6e 652c   : bool or None,
-00042640: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00042650: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-00042660: 6865 2064 6174 6173 6574 2773 2061 7474  he dataset's att
-00042670: 7269 6275 7465 7320 2860 6174 7472 7360  ributes (`attrs`
-00042680: 2920 7769 6c6c 2062 6520 636f 7069 6564  ) will be copied
-00042690: 2066 726f 6d0a 2020 2020 2020 2020 2020   from.          
-000426a0: 2020 7468 6520 6f72 6967 696e 616c 206f    the original o
-000426b0: 626a 6563 7420 746f 2074 6865 206e 6577  bject to the new
-000426c0: 206f 6e65 2e20 2049 6620 4661 6c73 652c   one.  If False,
-000426d0: 2074 6865 206e 6577 0a20 2020 2020 2020   the new.       
-000426e0: 2020 2020 206f 626a 6563 7420 7769 6c6c       object will
-000426f0: 2062 6520 7265 7475 726e 6564 2077 6974   be returned wit
-00042700: 686f 7574 2061 7474 7269 6275 7465 732e  hout attributes.
-00042710: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00042720: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00042730: 2d0a 2020 2020 2020 2020 7261 6e6b 6564  -.        ranked
-00042740: 203a 2044 6174 6173 6574 0a20 2020 2020   : Dataset.     
-00042750: 2020 2020 2020 2056 6172 6961 626c 6573         Variables
-00042760: 2074 6861 7420 646f 206e 6f74 2064 6570   that do not dep
-00042770: 656e 6420 6f6e 2060 6469 6d60 2061 7265  end on `dim` are
-00042780: 2064 726f 7070 6564 2e0a 2020 2020 2020   dropped..      
-00042790: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-000427a0: 206e 6f74 204f 5054 494f 4e53 5b22 7573   not OPTIONS["us
-000427b0: 655f 626f 7474 6c65 6e65 636b 225d 3a0a  e_bottleneck"]:.
-000427c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000427d0: 6520 5275 6e74 696d 6545 7272 6f72 280a  e RuntimeError(.
-000427e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000427f0: 2272 616e 6b20 7265 7175 6972 6573 2062  "rank requires b
-00042800: 6f74 746c 656e 6563 6b20 746f 2062 6520  ottleneck to be 
-00042810: 656e 6162 6c65 642e 220a 2020 2020 2020  enabled.".      
-00042820: 2020 2020 2020 2020 2020 2220 4361 6c6c            " Call
-00042830: 2060 7872 2e73 6574 5f6f 7074 696f 6e73   `xr.set_options
-00042840: 2875 7365 5f62 6f74 746c 656e 6563 6b3d  (use_bottleneck=
-00042850: 5472 7565 2960 2074 6f20 656e 6162 6c65  True)` to enable
-00042860: 2069 742e 220a 2020 2020 2020 2020 2020   it.".          
-00042870: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-00042880: 6469 6d20 6e6f 7420 696e 2073 656c 662e  dim not in self.
-00042890: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-000428a0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000428b0: 6f72 2866 2244 6174 6173 6574 2064 6f65  or(f"Dataset doe
-000428c0: 7320 6e6f 7420 636f 6e74 6169 6e20 7468  s not contain th
-000428d0: 6520 6469 6d65 6e73 696f 6e3a 207b 6469  e dimension: {di
-000428e0: 6d7d 2229 0a0a 2020 2020 2020 2020 7661  m}")..        va
-000428f0: 7269 6162 6c65 7320 3d20 7b7d 0a20 2020  riables = {}.   
-00042900: 2020 2020 2066 6f72 206e 616d 652c 2076       for name, v
-00042910: 6172 2069 6e20 7365 6c66 2e76 6172 6961  ar in self.varia
-00042920: 626c 6573 2e69 7465 6d73 2829 3a0a 2020  bles.items():.  
-00042930: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-00042940: 6520 696e 2073 656c 662e 6461 7461 5f76  e in self.data_v
-00042950: 6172 733a 0a20 2020 2020 2020 2020 2020  ars:.           
-00042960: 2020 2020 2069 6620 6469 6d20 696e 2076       if dim in v
-00042970: 6172 2e64 696d 733a 0a20 2020 2020 2020  ar.dims:.       
-00042980: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00042990: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
-000429a0: 6172 2e72 616e 6b28 6469 6d2c 2070 6374  ar.rank(dim, pct
-000429b0: 3d70 6374 290a 2020 2020 2020 2020 2020  =pct).          
-000429c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000429d0: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-000429e0: 735b 6e61 6d65 5d20 3d20 7661 720a 0a20  s[name] = var.. 
-000429f0: 2020 2020 2020 2063 6f6f 7264 5f6e 616d         coord_nam
-00042a00: 6573 203d 2073 6574 2873 656c 662e 636f  es = set(self.co
-00042a10: 6f72 6473 290a 2020 2020 2020 2020 6966  ords).        if
-00042a20: 206b 6565 705f 6174 7472 7320 6973 204e   keep_attrs is N
-00042a30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00042a40: 206b 6565 705f 6174 7472 7320 3d20 5f67   keep_attrs = _g
-00042a50: 6574 5f6b 6565 705f 6174 7472 7328 6465  et_keep_attrs(de
-00042a60: 6661 756c 743d 4661 6c73 6529 0a20 2020  fault=False).   
-00042a70: 2020 2020 2061 7474 7273 203d 2073 656c       attrs = sel
-00042a80: 662e 6174 7472 7320 6966 206b 6565 705f  f.attrs if keep_
-00042a90: 6174 7472 7320 656c 7365 204e 6f6e 650a  attrs else None.
-00042aa0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00042ab0: 656c 662e 5f72 6570 6c61 6365 2876 6172  elf._replace(var
-00042ac0: 6961 626c 6573 2c20 636f 6f72 645f 6e61  iables, coord_na
-00042ad0: 6d65 732c 2061 7474 7273 3d61 7474 7273  mes, attrs=attrs
-00042ae0: 290a 0a20 2020 2064 6566 2064 6966 6665  )..    def diffe
-00042af0: 7265 6e74 6961 7465 280a 2020 2020 2020  rentiate(.      
-00042b00: 2020 7365 6c66 3a20 545f 4461 7461 7365    self: T_Datase
-00042b10: 742c 0a20 2020 2020 2020 2063 6f6f 7264  t,.        coord
-00042b20: 3a20 4861 7368 6162 6c65 2c0a 2020 2020  : Hashable,.    
-00042b30: 2020 2020 6564 6765 5f6f 7264 6572 3a20      edge_order: 
-00042b40: 4c69 7465 7261 6c5b 312c 2032 5d20 3d20  Literal[1, 2] = 
-00042b50: 312c 0a20 2020 2020 2020 2064 6174 6574  1,.        datet
-00042b60: 696d 655f 756e 6974 3a20 4461 7465 7469  ime_unit: Dateti
-00042b70: 6d65 556e 6974 4f70 7469 6f6e 7320 7c20  meUnitOptions | 
-00042b80: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-00042b90: 2029 202d 3e20 545f 4461 7461 7365 743a   ) -> T_Dataset:
-00042ba0: 0a20 2020 2020 2020 2022 2222 2044 6966  .        """ Dif
-00042bb0: 6665 7265 6e74 6961 7465 2077 6974 6820  ferentiate with 
-00042bc0: 7468 6520 7365 636f 6e64 206f 7264 6572  the second order
-00042bd0: 2061 6363 7572 6174 6520 6365 6e74 7261   accurate centra
-00042be0: 6c0a 2020 2020 2020 2020 6469 6666 6572  l.        differ
-00042bf0: 656e 6365 732e 0a0a 2020 2020 2020 2020  ences...        
-00042c00: 2e2e 206e 6f74 653a 3a0a 2020 2020 2020  .. note::.      
-00042c10: 2020 2020 2020 5468 6973 2066 6561 7475        This featu
-00042c20: 7265 2069 7320 6c69 6d69 7465 6420 746f  re is limited to
-00042c30: 2073 696d 706c 6520 6361 7274 6573 6961   simple cartesia
-00042c40: 6e20 6765 6f6d 6574 7279 2c20 692e 652e  n geometry, i.e.
-00042c50: 2063 6f6f 7264 0a20 2020 2020 2020 2020   coord.         
-00042c60: 2020 206d 7573 7420 6265 206f 6e65 2064     must be one d
-00042c70: 696d 656e 7369 6f6e 616c 2e0a 0a20 2020  imensional...   
-00042c80: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00042c90: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00042ca0: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
-00042cb0: 203a 2048 6173 6861 626c 650a 2020 2020   : Hashable.    
-00042cc0: 2020 2020 2020 2020 5468 6520 636f 6f72          The coor
-00042cd0: 6469 6e61 7465 2074 6f20 6265 2075 7365  dinate to be use
-00042ce0: 6420 746f 2063 6f6d 7075 7465 2074 6865  d to compute the
-00042cf0: 2067 7261 6469 656e 742e 0a20 2020 2020   gradient..     
-00042d00: 2020 2065 6467 655f 6f72 6465 7220 3a20     edge_order : 
-00042d10: 7b31 2c20 327d 2c20 6465 6661 756c 743a  {1, 2}, default:
-00042d20: 2031 0a20 2020 2020 2020 2020 2020 204e   1.            N
-00042d30: 2d74 6820 6f72 6465 7220 6163 6375 7261  -th order accura
-00042d40: 7465 2064 6966 6665 7265 6e63 6573 2061  te differences a
-00042d50: 7420 7468 6520 626f 756e 6461 7269 6573  t the boundaries
-00042d60: 2e0a 2020 2020 2020 2020 6461 7465 7469  ..        dateti
-00042d70: 6d65 5f75 6e69 7420 3a20 4e6f 6e65 206f  me_unit : None o
-00042d80: 7220 7b22 5922 2c20 224d 222c 2022 5722  r {"Y", "M", "W"
-00042d90: 2c20 2244 222c 2022 6822 2c20 226d 222c  , "D", "h", "m",
-00042da0: 2022 7322 2c20 226d 7322 2c20 5c0a 2020   "s", "ms", \.  
-00042db0: 2020 2020 2020 2020 2020 2275 7322 2c20            "us", 
-00042dc0: 226e 7322 2c20 2270 7322 2c20 2266 7322  "ns", "ps", "fs"
-00042dd0: 2c20 2261 7322 2c20 4e6f 6e65 7d2c 2064  , "as", None}, d
-00042de0: 6566 6175 6c74 3a20 4e6f 6e65 0a20 2020  efault: None.   
-00042df0: 2020 2020 2020 2020 2055 6e69 7420 746f           Unit to
-00042e00: 2063 6f6d 7075 7465 2067 7261 6469 656e   compute gradien
-00042e10: 742e 204f 6e6c 7920 7661 6c69 6420 666f  t. Only valid fo
-00042e20: 7220 6461 7465 7469 6d65 2063 6f6f 7264  r datetime coord
-00042e30: 696e 6174 652e 0a0a 2020 2020 2020 2020  inate...        
-00042e40: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-00042e50: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00042e60: 6469 6666 6572 656e 7469 6174 6564 3a20  differentiated: 
-00042e70: 4461 7461 7365 740a 0a20 2020 2020 2020  Dataset..       
-00042e80: 2053 6565 2061 6c73 6f0a 2020 2020 2020   See also.      
-00042e90: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00042ea0: 2020 206e 756d 7079 2e67 7261 6469 656e     numpy.gradien
-00042eb0: 743a 2063 6f72 7265 7370 6f6e 6469 6e67  t: corresponding
-00042ec0: 206e 756d 7079 2066 756e 6374 696f 6e0a   numpy function.
-00042ed0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00042ee0: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
-00042ef0: 636f 7265 2e76 6172 6961 626c 6520 696d  core.variable im
-00042f00: 706f 7274 2056 6172 6961 626c 650a 0a20  port Variable.. 
-00042f10: 2020 2020 2020 2069 6620 636f 6f72 6420         if coord 
-00042f20: 6e6f 7420 696e 2073 656c 662e 7661 7269  not in self.vari
-00042f30: 6162 6c65 7320 616e 6420 636f 6f72 6420  ables and coord 
-00042f40: 6e6f 7420 696e 2073 656c 662e 6469 6d73  not in self.dims
-00042f50: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00042f60: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00042f70: 2243 6f6f 7264 696e 6174 6520 7b63 6f6f  "Coordinate {coo
-00042f80: 7264 7d20 646f 6573 206e 6f74 2065 7869  rd} does not exi
-00042f90: 7374 2e22 290a 0a20 2020 2020 2020 2063  st.")..        c
-00042fa0: 6f6f 7264 5f76 6172 203d 2073 656c 665b  oord_var = self[
-00042fb0: 636f 6f72 645d 2e76 6172 6961 626c 650a  coord].variable.
-00042fc0: 2020 2020 2020 2020 6966 2063 6f6f 7264          if coord
-00042fd0: 5f76 6172 2e6e 6469 6d20 213d 2031 3a0a  _var.ndim != 1:.
-00042fe0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00042ff0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-00043000: 2020 2020 2020 2020 2020 2020 2020 2243                "C
-00043010: 6f6f 7264 696e 6174 6520 7b7d 206d 7573  oordinate {} mus
-00043020: 7420 6265 2031 2064 696d 656e 7369 6f6e  t be 1 dimension
-00043030: 616c 2062 7574 2069 7320 7b7d 220a 2020  al but is {}".  
-00043040: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00043050: 6469 6d65 6e73 696f 6e61 6c22 2e66 6f72  dimensional".for
-00043060: 6d61 7428 636f 6f72 642c 2063 6f6f 7264  mat(coord, coord
-00043070: 5f76 6172 2e6e 6469 6d29 0a20 2020 2020  _var.ndim).     
-00043080: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00043090: 2020 6469 6d20 3d20 636f 6f72 645f 7661    dim = coord_va
-000430a0: 722e 6469 6d73 5b30 5d0a 2020 2020 2020  r.dims[0].      
-000430b0: 2020 6966 205f 636f 6e74 6169 6e73 5f64    if _contains_d
-000430c0: 6174 6574 696d 655f 6c69 6b65 5f6f 626a  atetime_like_obj
-000430d0: 6563 7473 2863 6f6f 7264 5f76 6172 293a  ects(coord_var):
-000430e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000430f0: 636f 6f72 645f 7661 722e 6474 7970 652e  coord_var.dtype.
-00043100: 6b69 6e64 2069 6e20 226d 4d22 2061 6e64  kind in "mM" and
-00043110: 2064 6174 6574 696d 655f 756e 6974 2069   datetime_unit i
-00043120: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00043130: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
-00043140: 5f75 6e69 7420 3d20 6361 7374 280a 2020  _unit = cast(.  
-00043150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043160: 2020 2244 6174 6574 696d 6555 6e69 744f    "DatetimeUnitO
-00043170: 7074 696f 6e73 222c 206e 702e 6461 7465  ptions", np.date
-00043180: 7469 6d65 5f64 6174 6128 636f 6f72 645f  time_data(coord_
-00043190: 7661 722e 6474 7970 6529 5b30 5d0a 2020  var.dtype)[0].  
-000431a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-000431b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000431c0: 2064 6174 6574 696d 655f 756e 6974 2069   datetime_unit i
-000431d0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000431e0: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
-000431f0: 5f75 6e69 7420 3d20 2273 2220 2023 2044  _unit = "s"  # D
-00043200: 6566 6175 6c74 2074 6f20 7365 636f 6e64  efault to second
-00043210: 7320 666f 7220 6366 7469 6d65 206f 626a  s for cftime obj
-00043220: 6563 7473 0a20 2020 2020 2020 2020 2020  ects.           
-00043230: 2063 6f6f 7264 5f76 6172 203d 2063 6f6f   coord_var = coo
-00043240: 7264 5f76 6172 2e5f 746f 5f6e 756d 6572  rd_var._to_numer
-00043250: 6963 2864 6174 6574 696d 655f 756e 6974  ic(datetime_unit
-00043260: 3d64 6174 6574 696d 655f 756e 6974 290a  =datetime_unit).
-00043270: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-00043280: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
-00043290: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-000432a0: 2e76 6172 6961 626c 6573 2e69 7465 6d73  .variables.items
-000432b0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000432c0: 6966 206b 2069 6e20 7365 6c66 2e64 6174  if k in self.dat
-000432d0: 615f 7661 7273 2061 6e64 2064 696d 2069  a_vars and dim i
-000432e0: 6e20 762e 6469 6d73 2061 6e64 206b 206e  n v.dims and k n
-000432f0: 6f74 2069 6e20 7365 6c66 2e63 6f6f 7264  ot in self.coord
-00043300: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00043310: 2020 2069 6620 5f63 6f6e 7461 696e 735f     if _contains_
-00043320: 6461 7465 7469 6d65 5f6c 696b 655f 6f62  datetime_like_ob
-00043330: 6a65 6374 7328 7629 3a0a 2020 2020 2020  jects(v):.      
-00043340: 2020 2020 2020 2020 2020 2020 2020 7620                v 
-00043350: 3d20 762e 5f74 6f5f 6e75 6d65 7269 6328  = v._to_numeric(
-00043360: 6461 7465 7469 6d65 5f75 6e69 743d 6461  datetime_unit=da
-00043370: 7465 7469 6d65 5f75 6e69 7429 0a20 2020  tetime_unit).   
-00043380: 2020 2020 2020 2020 2020 2020 2067 7261               gra
-00043390: 6420 3d20 6475 636b 5f61 7272 6179 5f6f  d = duck_array_o
-000433a0: 7073 2e67 7261 6469 656e 7428 0a20 2020  ps.gradient(.   
-000433b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000433c0: 2076 2e64 6174 612c 0a20 2020 2020 2020   v.data,.       
-000433d0: 2020 2020 2020 2020 2020 2020 2063 6f6f               coo
-000433e0: 7264 5f76 6172 2e64 6174 612c 0a20 2020  rd_var.data,.   
-000433f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043400: 2065 6467 655f 6f72 6465 723d 6564 6765   edge_order=edge
-00043410: 5f6f 7264 6572 2c0a 2020 2020 2020 2020  _order,.        
-00043420: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-00043430: 3d76 2e67 6574 5f61 7869 735f 6e75 6d28  =v.get_axis_num(
-00043440: 6469 6d29 2c0a 2020 2020 2020 2020 2020  dim),.          
-00043450: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00043460: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-00043470: 735b 6b5d 203d 2056 6172 6961 626c 6528  s[k] = Variable(
-00043480: 762e 6469 6d73 2c20 6772 6164 290a 2020  v.dims, grad).  
-00043490: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000434a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000434b0: 7661 7269 6162 6c65 735b 6b5d 203d 2076  variables[k] = v
-000434c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000434d0: 7365 6c66 2e5f 7265 706c 6163 6528 7661  self._replace(va
-000434e0: 7269 6162 6c65 7329 0a0a 2020 2020 6465  riables)..    de
-000434f0: 6620 696e 7465 6772 6174 6528 0a20 2020  f integrate(.   
-00043500: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-00043510: 6173 6574 2c0a 2020 2020 2020 2020 636f  aset,.        co
-00043520: 6f72 643a 2048 6173 6861 626c 6520 7c20  ord: Hashable | 
-00043530: 5365 7175 656e 6365 5b48 6173 6861 626c  Sequence[Hashabl
-00043540: 655d 2c0a 2020 2020 2020 2020 6461 7465  e],.        date
-00043550: 7469 6d65 5f75 6e69 743a 2044 6174 6574  time_unit: Datet
-00043560: 696d 6555 6e69 744f 7074 696f 6e73 203d  imeUnitOptions =
-00043570: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-00043580: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
-00043590: 2020 2022 2222 496e 7465 6772 6174 6520     """Integrate 
-000435a0: 616c 6f6e 6720 7468 6520 6769 7665 6e20  along the given 
-000435b0: 636f 6f72 6469 6e61 7465 2075 7369 6e67  coordinate using
-000435c0: 2074 6865 2074 7261 7065 7a6f 6964 616c   the trapezoidal
-000435d0: 2072 756c 652e 0a0a 2020 2020 2020 2020   rule...        
-000435e0: 2e2e 206e 6f74 653a 3a0a 2020 2020 2020  .. note::.      
-000435f0: 2020 2020 2020 5468 6973 2066 6561 7475        This featu
-00043600: 7265 2069 7320 6c69 6d69 7465 6420 746f  re is limited to
-00043610: 2073 696d 706c 6520 6361 7274 6573 6961   simple cartesia
-00043620: 6e20 6765 6f6d 6574 7279 2c20 692e 652e  n geometry, i.e.
-00043630: 2063 6f6f 7264 0a20 2020 2020 2020 2020   coord.         
-00043640: 2020 206d 7573 7420 6265 206f 6e65 2064     must be one d
-00043650: 696d 656e 7369 6f6e 616c 2e0a 0a20 2020  imensional...   
-00043660: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00043670: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00043680: 2d2d 0a20 2020 2020 2020 2063 6f6f 7264  --.        coord
-00043690: 203a 2068 6173 6861 626c 652c 206f 7220   : hashable, or 
-000436a0: 7365 7175 656e 6365 206f 6620 6861 7368  sequence of hash
-000436b0: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-000436c0: 2043 6f6f 7264 696e 6174 6528 7329 2075   Coordinate(s) u
-000436d0: 7365 6420 666f 7220 7468 6520 696e 7465  sed for the inte
-000436e0: 6772 6174 696f 6e2e 0a20 2020 2020 2020  gration..       
-000436f0: 2064 6174 6574 696d 655f 756e 6974 203a   datetime_unit :
-00043700: 207b 2759 272c 2027 4d27 2c20 2757 272c   {'Y', 'M', 'W',
-00043710: 2027 4427 2c20 2768 272c 2027 6d27 2c20   'D', 'h', 'm', 
-00043720: 2773 272c 2027 6d73 272c 2027 7573 272c  's', 'ms', 'us',
-00043730: 2027 6e73 272c 205c 0a20 2020 2020 2020   'ns', \.       
-00043740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043750: 2027 7073 272c 2027 6673 272c 2027 6173   'ps', 'fs', 'as
-00043760: 272c 204e 6f6e 657d 2c20 6f70 7469 6f6e  ', None}, option
-00043770: 616c 0a20 2020 2020 2020 2020 2020 2053  al.            S
-00043780: 7065 6369 6679 2074 6865 2075 6e69 7420  pecify the unit 
-00043790: 6966 2064 6174 6574 696d 6520 636f 6f72  if datetime coor
-000437a0: 6469 6e61 7465 2069 7320 7573 6564 2e0a  dinate is used..
-000437b0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-000437c0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000437d0: 0a20 2020 2020 2020 2069 6e74 6567 7261  .        integra
-000437e0: 7465 6420 3a20 4461 7461 7365 740a 0a20  ted : Dataset.. 
-000437f0: 2020 2020 2020 2053 6565 2061 6c73 6f0a         See also.
-00043800: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00043810: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-00043820: 6179 2e69 6e74 6567 7261 7465 0a20 2020  ay.integrate.   
-00043830: 2020 2020 206e 756d 7079 2e74 7261 707a       numpy.trapz
-00043840: 203a 2063 6f72 7265 7370 6f6e 6469 6e67   : corresponding
-00043850: 206e 756d 7079 2066 756e 6374 696f 6e0a   numpy function.
-00043860: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-00043870: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00043880: 2d2d 0a20 2020 2020 2020 203e 3e3e 2064  --.        >>> d
-00043890: 7320 3d20 7872 2e44 6174 6173 6574 280a  s = xr.Dataset(.
-000438a0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-000438b0: 6461 7461 5f76 6172 733d 7b22 6122 3a20  data_vars={"a": 
-000438c0: 2822 7822 2c20 5b35 2c20 352c 2036 2c20  ("x", [5, 5, 6, 
-000438d0: 365d 292c 2022 6222 3a20 2822 7822 2c20  6]), "b": ("x", 
-000438e0: 5b31 2c20 322c 2031 2c20 305d 297d 2c0a  [1, 2, 1, 0])},.
-000438f0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00043900: 636f 6f72 6473 3d7b 2278 223a 205b 302c  coords={"x": [0,
-00043910: 2031 2c20 322c 2033 5d2c 2022 7922 3a20   1, 2, 3], "y": 
-00043920: 2822 7822 2c20 5b31 2c20 372c 2033 2c20  ("x", [1, 7, 3, 
-00043930: 355d 297d 2c0a 2020 2020 2020 2020 2e2e  5])},.        ..
-00043940: 2e20 290a 2020 2020 2020 2020 3e3e 3e20  . ).        >>> 
-00043950: 6473 0a20 2020 2020 2020 203c 7861 7272  ds.        <xarr
-00043960: 6179 2e44 6174 6173 6574 3e0a 2020 2020  ay.Dataset>.    
-00043970: 2020 2020 4469 6d65 6e73 696f 6e73 3a20      Dimensions: 
-00043980: 2028 783a 2034 290a 2020 2020 2020 2020   (x: 4).        
-00043990: 436f 6f72 6469 6e61 7465 733a 0a20 2020  Coordinates:.   
-000439a0: 2020 2020 2020 202a 2078 2020 2020 2020         * x      
-000439b0: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
-000439c0: 3220 330a 2020 2020 2020 2020 2020 2020  2 3.            
-000439d0: 7920 2020 2020 2020 2028 7829 2069 6e74  y        (x) int
-000439e0: 3634 2031 2037 2033 2035 0a20 2020 2020  64 1 7 3 5.     
-000439f0: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-00043a00: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
-00043a10: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
-00043a20: 3420 3520 3520 3620 360a 2020 2020 2020  4 5 5 6 6.      
-00043a30: 2020 2020 2020 6220 2020 2020 2020 2028        b        (
-00043a40: 7829 2069 6e74 3634 2031 2032 2031 2030  x) int64 1 2 1 0
-00043a50: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-00043a60: 696e 7465 6772 6174 6528 2278 2229 0a20  integrate("x"). 
-00043a70: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
-00043a80: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
-00043a90: 4469 6d65 6e73 696f 6e73 3a20 2028 290a  Dimensions:  ().
-00043aa0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-00043ab0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-00043ac0: 2020 2020 6120 2020 2020 2020 2066 6c6f      a        flo
-00043ad0: 6174 3634 2031 362e 350a 2020 2020 2020  at64 16.5.      
-00043ae0: 2020 2020 2020 6220 2020 2020 2020 2066        b        f
-00043af0: 6c6f 6174 3634 2033 2e35 0a20 2020 2020  loat64 3.5.     
-00043b00: 2020 203e 3e3e 2064 732e 696e 7465 6772     >>> ds.integr
-00043b10: 6174 6528 2279 2229 0a20 2020 2020 2020  ate("y").       
-00043b20: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-00043b30: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-00043b40: 696f 6e73 3a20 2028 290a 2020 2020 2020  ions:  ().      
-00043b50: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
-00043b60: 3a0a 2020 2020 2020 2020 2020 2020 6120  :.            a 
-00043b70: 2020 2020 2020 2066 6c6f 6174 3634 2032         float64 2
-00043b80: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
-00043b90: 6220 2020 2020 2020 2066 6c6f 6174 3634  b        float64
-00043ba0: 2034 2e30 0a20 2020 2020 2020 2022 2222   4.0.        """
-00043bb0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00043bc0: 6973 696e 7374 616e 6365 2863 6f6f 7264  isinstance(coord
-00043bd0: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-00043be0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00043bf0: 6f72 6420 3d20 2863 6f6f 7264 2c29 0a20  ord = (coord,). 
-00043c00: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00043c10: 7365 6c66 0a20 2020 2020 2020 2066 6f72  self.        for
-00043c20: 2063 2069 6e20 636f 6f72 643a 0a20 2020   c in coord:.   
-00043c30: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00043c40: 3d20 7265 7375 6c74 2e5f 696e 7465 6772  = result._integr
-00043c50: 6174 655f 6f6e 6528 632c 2064 6174 6574  ate_one(c, datet
-00043c60: 696d 655f 756e 6974 3d64 6174 6574 696d  ime_unit=datetim
-00043c70: 655f 756e 6974 290a 2020 2020 2020 2020  e_unit).        
-00043c80: 7265 7475 726e 2072 6573 756c 740a 0a20  return result.. 
-00043c90: 2020 2064 6566 205f 696e 7465 6772 6174     def _integrat
-00043ca0: 655f 6f6e 6528 7365 6c66 2c20 636f 6f72  e_one(self, coor
-00043cb0: 642c 2064 6174 6574 696d 655f 756e 6974  d, datetime_unit
-00043cc0: 3d4e 6f6e 652c 2063 756d 756c 6174 6976  =None, cumulativ
-00043cd0: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
-00043ce0: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00043cf0: 7265 2e76 6172 6961 626c 6520 696d 706f  re.variable impo
-00043d00: 7274 2056 6172 6961 626c 650a 0a20 2020  rt Variable..   
-00043d10: 2020 2020 2069 6620 636f 6f72 6420 6e6f       if coord no
-00043d20: 7420 696e 2073 656c 662e 7661 7269 6162  t in self.variab
-00043d30: 6c65 7320 616e 6420 636f 6f72 6420 6e6f  les and coord no
-00043d40: 7420 696e 2073 656c 662e 6469 6d73 3a0a  t in self.dims:.
-00043d50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00043d60: 6520 5661 6c75 6545 7272 6f72 2866 2243  e ValueError(f"C
-00043d70: 6f6f 7264 696e 6174 6520 7b63 6f6f 7264  oordinate {coord
-00043d80: 7d20 646f 6573 206e 6f74 2065 7869 7374  } does not exist
-00043d90: 2e22 290a 0a20 2020 2020 2020 2063 6f6f  .")..        coo
-00043da0: 7264 5f76 6172 203d 2073 656c 665b 636f  rd_var = self[co
-00043db0: 6f72 645d 2e76 6172 6961 626c 650a 2020  ord].variable.  
-00043dc0: 2020 2020 2020 6966 2063 6f6f 7264 5f76        if coord_v
-00043dd0: 6172 2e6e 6469 6d20 213d 2031 3a0a 2020  ar.ndim != 1:.  
-00043de0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00043df0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00043e00: 2020 2020 2020 2020 2020 2020 2243 6f6f              "Coo
-00043e10: 7264 696e 6174 6520 7b7d 206d 7573 7420  rdinate {} must 
-00043e20: 6265 2031 2064 696d 656e 7369 6f6e 616c  be 1 dimensional
-00043e30: 2062 7574 2069 7320 7b7d 220a 2020 2020   but is {}".    
-00043e40: 2020 2020 2020 2020 2020 2020 2220 6469              " di
-00043e50: 6d65 6e73 696f 6e61 6c22 2e66 6f72 6d61  mensional".forma
-00043e60: 7428 636f 6f72 642c 2063 6f6f 7264 5f76  t(coord, coord_v
-00043e70: 6172 2e6e 6469 6d29 0a20 2020 2020 2020  ar.ndim).       
-00043e80: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00043e90: 6469 6d20 3d20 636f 6f72 645f 7661 722e  dim = coord_var.
-00043ea0: 6469 6d73 5b30 5d0a 2020 2020 2020 2020  dims[0].        
-00043eb0: 6966 205f 636f 6e74 6169 6e73 5f64 6174  if _contains_dat
-00043ec0: 6574 696d 655f 6c69 6b65 5f6f 626a 6563  etime_like_objec
-00043ed0: 7473 2863 6f6f 7264 5f76 6172 293a 0a20  ts(coord_var):. 
-00043ee0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-00043ef0: 6f72 645f 7661 722e 6474 7970 652e 6b69  ord_var.dtype.ki
-00043f00: 6e64 2069 6e20 226d 4d22 2061 6e64 2064  nd in "mM" and d
-00043f10: 6174 6574 696d 655f 756e 6974 2069 7320  atetime_unit is 
-00043f20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00043f30: 2020 2020 2020 6461 7465 7469 6d65 5f75        datetime_u
-00043f40: 6e69 742c 205f 203d 206e 702e 6461 7465  nit, _ = np.date
-00043f50: 7469 6d65 5f64 6174 6128 636f 6f72 645f  time_data(coord_
-00043f60: 7661 722e 6474 7970 6529 0a20 2020 2020  var.dtype).     
-00043f70: 2020 2020 2020 2065 6c69 6620 6461 7465         elif date
-00043f80: 7469 6d65 5f75 6e69 7420 6973 204e 6f6e  time_unit is Non
-00043f90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00043fa0: 2020 2064 6174 6574 696d 655f 756e 6974     datetime_unit
-00043fb0: 203d 2022 7322 2020 2320 4465 6661 756c   = "s"  # Defaul
-00043fc0: 7420 746f 2073 6563 6f6e 6473 2066 6f72  t to seconds for
-00043fd0: 2063 6674 696d 6520 6f62 6a65 6374 730a   cftime objects.
-00043fe0: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
-00043ff0: 645f 7661 7220 3d20 636f 6f72 645f 7661  d_var = coord_va
-00044000: 722e 5f72 6570 6c61 6365 280a 2020 2020  r._replace(.    
-00044010: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00044020: 3d64 6174 6574 696d 655f 746f 5f6e 756d  =datetime_to_num
-00044030: 6572 6963 2863 6f6f 7264 5f76 6172 2e64  eric(coord_var.d
-00044040: 6174 612c 2064 6174 6574 696d 655f 756e  ata, datetime_un
-00044050: 6974 3d64 6174 6574 696d 655f 756e 6974  it=datetime_unit
-00044060: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-00044070: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
-00044080: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
-00044090: 636f 6f72 645f 6e61 6d65 7320 3d20 7365  coord_names = se
-000440a0: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
-000440b0: 6b2c 2076 2069 6e20 7365 6c66 2e76 6172  k, v in self.var
-000440c0: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
-000440d0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-000440e0: 2069 6e20 7365 6c66 2e63 6f6f 7264 733a   in self.coords:
-000440f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044100: 2069 6620 6469 6d20 6e6f 7420 696e 2076   if dim not in v
-00044110: 2e64 696d 7320 6f72 2063 756d 756c 6174  .dims or cumulat
-00044120: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
-00044130: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
-00044140: 6573 5b6b 5d20 3d20 760a 2020 2020 2020  es[k] = v.      
-00044150: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00044160: 6f72 645f 6e61 6d65 732e 6164 6428 6b29  ord_names.add(k)
-00044170: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00044180: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00044190: 2020 2069 6620 6b20 696e 2073 656c 662e     if k in self.
-000441a0: 6461 7461 5f76 6172 7320 616e 6420 6469  data_vars and di
-000441b0: 6d20 696e 2076 2e64 696d 733a 0a20 2020  m in v.dims:.   
-000441c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000441d0: 2069 6620 5f63 6f6e 7461 696e 735f 6461   if _contains_da
-000441e0: 7465 7469 6d65 5f6c 696b 655f 6f62 6a65  tetime_like_obje
-000441f0: 6374 7328 7629 3a0a 2020 2020 2020 2020  cts(v):.        
-00044200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044210: 7620 3d20 6461 7465 7469 6d65 5f74 6f5f  v = datetime_to_
-00044220: 6e75 6d65 7269 6328 762c 2064 6174 6574  numeric(v, datet
-00044230: 696d 655f 756e 6974 3d64 6174 6574 696d  ime_unit=datetim
-00044240: 655f 756e 6974 290a 2020 2020 2020 2020  e_unit).        
-00044250: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00044260: 756d 756c 6174 6976 653a 0a20 2020 2020  umulative:.     
-00044270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044280: 2020 2069 6e74 6567 203d 2064 7563 6b5f     integ = duck_
-00044290: 6172 7261 795f 6f70 732e 6375 6d75 6c61  array_ops.cumula
-000442a0: 7469 7665 5f74 7261 7065 7a6f 6964 280a  tive_trapezoid(.
-000442b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000442c0: 2020 2020 2020 2020 2020 2020 762e 6461              v.da
-000442d0: 7461 2c20 636f 6f72 645f 7661 722e 6461  ta, coord_var.da
-000442e0: 7461 2c20 6178 6973 3d76 2e67 6574 5f61  ta, axis=v.get_a
-000442f0: 7869 735f 6e75 6d28 6469 6d29 0a20 2020  xis_num(dim).   
-00044300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044310: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00044320: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00044330: 5f64 696d 7320 3d20 762e 6469 6d73 0a20  _dims = v.dims. 
-00044340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044350: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00044360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044370: 2069 6e74 6567 203d 2064 7563 6b5f 6172   integ = duck_ar
-00044380: 7261 795f 6f70 732e 7472 6170 7a28 0a20  ray_ops.trapz(. 
-00044390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000443a0: 2020 2020 2020 2020 2020 2076 2e64 6174             v.dat
-000443b0: 612c 2063 6f6f 7264 5f76 6172 2e64 6174  a, coord_var.dat
-000443c0: 612c 2061 7869 733d 762e 6765 745f 6178  a, axis=v.get_ax
-000443d0: 6973 5f6e 756d 2864 696d 290a 2020 2020  is_num(dim).    
-000443e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000443f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00044400: 2020 2020 2020 2020 2020 2020 2020 765f                v_
-00044410: 6469 6d73 203d 206c 6973 7428 762e 6469  dims = list(v.di
-00044420: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-00044430: 2020 2020 2020 2020 2020 2020 765f 6469              v_di
-00044440: 6d73 2e72 656d 6f76 6528 6469 6d29 0a20  ms.remove(dim). 
-00044450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044460: 2020 2076 6172 6961 626c 6573 5b6b 5d20     variables[k] 
-00044470: 3d20 5661 7269 6162 6c65 2876 5f64 696d  = Variable(v_dim
-00044480: 732c 2069 6e74 6567 290a 2020 2020 2020  s, integ).      
-00044490: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000444a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000444b0: 2020 2020 7661 7269 6162 6c65 735b 6b5d      variables[k]
-000444c0: 203d 2076 0a20 2020 2020 2020 2069 6e64   = v.        ind
-000444d0: 6578 6573 203d 207b 6b3a 2076 2066 6f72  exes = {k: v for
-000444e0: 206b 2c20 7620 696e 2073 656c 662e 5f69   k, v in self._i
-000444f0: 6e64 6578 6573 2e69 7465 6d73 2829 2069  ndexes.items() i
-00044500: 6620 6b20 696e 2076 6172 6961 626c 6573  f k in variables
-00044510: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
-00044520: 2073 656c 662e 5f72 6570 6c61 6365 5f77   self._replace_w
-00044530: 6974 685f 6e65 775f 6469 6d73 280a 2020  ith_new_dims(.  
-00044540: 2020 2020 2020 2020 2020 7661 7269 6162            variab
-00044550: 6c65 732c 2063 6f6f 7264 5f6e 616d 6573  les, coord_names
-00044560: 3d63 6f6f 7264 5f6e 616d 6573 2c20 696e  =coord_names, in
-00044570: 6465 7865 733d 696e 6465 7865 730a 2020  dexes=indexes.  
-00044580: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-00044590: 2063 756d 756c 6174 6976 655f 696e 7465   cumulative_inte
-000445a0: 6772 6174 6528 0a20 2020 2020 2020 2073  grate(.        s
-000445b0: 656c 663a 2054 5f44 6174 6173 6574 2c0a  elf: T_Dataset,.
-000445c0: 2020 2020 2020 2020 636f 6f72 643a 2048          coord: H
-000445d0: 6173 6861 626c 6520 7c20 5365 7175 656e  ashable | Sequen
-000445e0: 6365 5b48 6173 6861 626c 655d 2c0a 2020  ce[Hashable],.  
-000445f0: 2020 2020 2020 6461 7465 7469 6d65 5f75        datetime_u
-00044600: 6e69 743a 2044 6174 6574 696d 6555 6e69  nit: DatetimeUni
-00044610: 744f 7074 696f 6e73 203d 204e 6f6e 652c  tOptions = None,
-00044620: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
-00044630: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
-00044640: 496e 7465 6772 6174 6520 616c 6f6e 6720  Integrate along 
-00044650: 7468 6520 6769 7665 6e20 636f 6f72 6469  the given coordi
-00044660: 6e61 7465 2075 7369 6e67 2074 6865 2074  nate using the t
-00044670: 7261 7065 7a6f 6964 616c 2072 756c 652e  rapezoidal rule.
-00044680: 0a0a 2020 2020 2020 2020 2e2e 206e 6f74  ..        .. not
-00044690: 653a 3a0a 2020 2020 2020 2020 2020 2020  e::.            
-000446a0: 5468 6973 2066 6561 7475 7265 2069 7320  This feature is 
-000446b0: 6c69 6d69 7465 6420 746f 2073 696d 706c  limited to simpl
-000446c0: 6520 6361 7274 6573 6961 6e20 6765 6f6d  e cartesian geom
-000446d0: 6574 7279 2c20 692e 652e 2063 6f6f 7264  etry, i.e. coord
-000446e0: 0a20 2020 2020 2020 2020 2020 206d 7573  .            mus
-000446f0: 7420 6265 206f 6e65 2064 696d 656e 7369  t be one dimensi
-00044700: 6f6e 616c 2e0a 0a20 2020 2020 2020 2020  onal...         
-00044710: 2020 2054 6865 2066 6972 7374 2065 6e74     The first ent
-00044720: 7279 206f 6620 7468 6520 6375 6d75 6c61  ry of the cumula
-00044730: 7469 7665 2069 6e74 6567 7261 6c20 6f66  tive integral of
-00044740: 2065 6163 6820 7661 7269 6162 6c65 2069   each variable i
-00044750: 7320 616c 7761 7973 2030 2c20 696e 0a20  s always 0, in. 
-00044760: 2020 2020 2020 2020 2020 206f 7264 6572             order
-00044770: 2074 6f20 6b65 6570 2074 6865 206c 656e   to keep the len
-00044780: 6774 6820 6f66 2074 6865 2064 696d 656e  gth of the dimen
-00044790: 7369 6f6e 2075 6e63 6861 6e67 6564 2062  sion unchanged b
-000447a0: 6574 7765 656e 2069 6e70 7574 2061 6e64  etween input and
-000447b0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-000447c0: 7075 742e 0a0a 2020 2020 2020 2020 5061  put...        Pa
-000447d0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-000447e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-000447f0: 2020 2020 636f 6f72 6420 3a20 6861 7368      coord : hash
-00044800: 6162 6c65 2c20 6f72 2073 6571 7565 6e63  able, or sequenc
-00044810: 6520 6f66 2068 6173 6861 626c 650a 2020  e of hashable.  
-00044820: 2020 2020 2020 2020 2020 436f 6f72 6469            Coordi
-00044830: 6e61 7465 2873 2920 7573 6564 2066 6f72  nate(s) used for
-00044840: 2074 6865 2069 6e74 6567 7261 7469 6f6e   the integration
-00044850: 2e0a 2020 2020 2020 2020 6461 7465 7469  ..        dateti
-00044860: 6d65 5f75 6e69 7420 3a20 7b27 5927 2c20  me_unit : {'Y', 
-00044870: 274d 272c 2027 5727 2c20 2744 272c 2027  'M', 'W', 'D', '
-00044880: 6827 2c20 276d 272c 2027 7327 2c20 276d  h', 'm', 's', 'm
-00044890: 7327 2c20 2775 7327 2c20 276e 7327 2c20  s', 'us', 'ns', 
-000448a0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-000448b0: 2020 2020 2020 2020 2020 2770 7327 2c20            'ps', 
-000448c0: 2766 7327 2c20 2761 7327 2c20 4e6f 6e65  'fs', 'as', None
-000448d0: 7d2c 206f 7074 696f 6e61 6c0a 2020 2020  }, optional.    
-000448e0: 2020 2020 2020 2020 5370 6563 6966 7920          Specify 
-000448f0: 7468 6520 756e 6974 2069 6620 6461 7465  the unit if date
-00044900: 7469 6d65 2063 6f6f 7264 696e 6174 6520  time coordinate 
-00044910: 6973 2075 7365 642e 0a0a 2020 2020 2020  is used...      
-00044920: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00044930: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00044940: 2020 696e 7465 6772 6174 6564 203a 2044    integrated : D
-00044950: 6174 6173 6574 0a0a 2020 2020 2020 2020  ataset..        
-00044960: 5365 6520 616c 736f 0a20 2020 2020 2020  See also.       
-00044970: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00044980: 2020 4461 7461 4172 7261 792e 6375 6d75    DataArray.cumu
-00044990: 6c61 7469 7665 5f69 6e74 6567 7261 7465  lative_integrate
-000449a0: 0a20 2020 2020 2020 2073 6369 7079 2e69  .        scipy.i
-000449b0: 6e74 6567 7261 7465 2e63 756d 756c 6174  ntegrate.cumulat
-000449c0: 6976 655f 7472 6170 657a 6f69 6420 3a20  ive_trapezoid : 
-000449d0: 636f 7272 6573 706f 6e64 696e 6720 7363  corresponding sc
-000449e0: 6970 7920 6675 6e63 7469 6f6e 0a0a 2020  ipy function..  
-000449f0: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
-00044a00: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-00044a10: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
-00044a20: 2078 722e 4461 7461 7365 7428 0a20 2020   xr.Dataset(.   
-00044a30: 2020 2020 202e 2e2e 2020 2020 2064 6174       ...     dat
-00044a40: 615f 7661 7273 3d7b 2261 223a 2028 2278  a_vars={"a": ("x
-00044a50: 222c 205b 352c 2035 2c20 362c 2036 5d29  ", [5, 5, 6, 6])
-00044a60: 2c20 2262 223a 2028 2278 222c 205b 312c  , "b": ("x", [1,
-00044a70: 2032 2c20 312c 2030 5d29 7d2c 0a20 2020   2, 1, 0])},.   
-00044a80: 2020 2020 202e 2e2e 2020 2020 2063 6f6f       ...     coo
-00044a90: 7264 733d 7b22 7822 3a20 5b30 2c20 312c  rds={"x": [0, 1,
-00044aa0: 2032 2c20 335d 2c20 2279 223a 2028 2278   2, 3], "y": ("x
-00044ab0: 222c 205b 312c 2037 2c20 332c 2035 5d29  ", [1, 7, 3, 5])
-00044ac0: 7d2c 0a20 2020 2020 2020 202e 2e2e 2029  },.        ... )
-00044ad0: 0a20 2020 2020 2020 203e 3e3e 2064 730a  .        >>> ds.
-00044ae0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-00044af0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-00044b00: 2044 696d 656e 7369 6f6e 733a 2020 2878   Dimensions:  (x
-00044b10: 3a20 3429 0a20 2020 2020 2020 2043 6f6f  : 4).        Coo
-00044b20: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
-00044b30: 2020 2020 2a20 7820 2020 2020 2020 2028      * x        (
-00044b40: 7829 2069 6e74 3634 2030 2031 2032 2033  x) int64 0 1 2 3
-00044b50: 0a20 2020 2020 2020 2020 2020 2079 2020  .            y  
-00044b60: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-00044b70: 3120 3720 3320 350a 2020 2020 2020 2020  1 7 3 5.        
-00044b80: 4461 7461 2076 6172 6961 626c 6573 3a0a  Data variables:.
-00044b90: 2020 2020 2020 2020 2020 2020 6120 2020              a   
-00044ba0: 2020 2020 2028 7829 2069 6e74 3634 2035       (x) int64 5
-00044bb0: 2035 2036 2036 0a20 2020 2020 2020 2020   5 6 6.         
-00044bc0: 2020 2062 2020 2020 2020 2020 2878 2920     b        (x) 
-00044bd0: 696e 7436 3420 3120 3220 3120 300a 2020  int64 1 2 1 0.  
-00044be0: 2020 2020 2020 3e3e 3e20 6473 2e63 756d        >>> ds.cum
-00044bf0: 756c 6174 6976 655f 696e 7465 6772 6174  ulative_integrat
-00044c00: 6528 2278 2229 0a20 2020 2020 2020 203c  e("x").        <
-00044c10: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
-00044c20: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00044c30: 6e73 3a20 2028 783a 2034 290a 2020 2020  ns:  (x: 4).    
-00044c40: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
-00044c50: 0a20 2020 2020 2020 2020 202a 2078 2020  .          * x  
-00044c60: 2020 2020 2020 2878 2920 696e 7436 3420        (x) int64 
-00044c70: 3020 3120 3220 330a 2020 2020 2020 2020  0 1 2 3.        
-00044c80: 2020 2020 7920 2020 2020 2020 2028 7829      y        (x)
-00044c90: 2069 6e74 3634 2031 2037 2033 2035 0a20   int64 1 7 3 5. 
-00044ca0: 2020 2020 2020 2044 6174 6120 7661 7269         Data vari
-00044cb0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-00044cc0: 2020 2061 2020 2020 2020 2020 2878 2920     a        (x) 
-00044cd0: 666c 6f61 7436 3420 302e 3020 352e 3020  float64 0.0 5.0 
-00044ce0: 3130 2e35 2031 362e 350a 2020 2020 2020  10.5 16.5.      
-00044cf0: 2020 2020 2020 6220 2020 2020 2020 2028        b        (
-00044d00: 7829 2066 6c6f 6174 3634 2030 2e30 2031  x) float64 0.0 1
-00044d10: 2e35 2033 2e30 2033 2e35 0a20 2020 2020  .5 3.0 3.5.     
-00044d20: 2020 203e 3e3e 2064 732e 6375 6d75 6c61     >>> ds.cumula
-00044d30: 7469 7665 5f69 6e74 6567 7261 7465 2822  tive_integrate("
-00044d40: 7922 290a 2020 2020 2020 2020 3c78 6172  y").        <xar
-00044d50: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
-00044d60: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
-00044d70: 2020 2878 3a20 3429 0a20 2020 2020 2020    (x: 4).       
-00044d80: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-00044d90: 2020 2020 2020 2020 2a20 7820 2020 2020          * x     
-00044da0: 2020 2028 7829 2069 6e74 3634 2030 2031     (x) int64 0 1
-00044db0: 2032 2033 0a20 2020 2020 2020 2020 2020   2 3.           
-00044dc0: 2079 2020 2020 2020 2020 2878 2920 696e   y        (x) in
-00044dd0: 7436 3420 3120 3720 3320 350a 2020 2020  t64 1 7 3 5.    
-00044de0: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-00044df0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00044e00: 6120 2020 2020 2020 2028 7829 2066 6c6f  a        (x) flo
-00044e10: 6174 3634 2030 2e30 2033 302e 3020 382e  at64 0.0 30.0 8.
-00044e20: 3020 3230 2e30 0a20 2020 2020 2020 2020  0 20.0.         
-00044e30: 2020 2062 2020 2020 2020 2020 2878 2920     b        (x) 
-00044e40: 666c 6f61 7436 3420 302e 3020 392e 3020  float64 0.0 9.0 
-00044e50: 332e 3020 342e 300a 2020 2020 2020 2020  3.0 4.0.        
-00044e60: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-00044e70: 6f74 2069 7369 6e73 7461 6e63 6528 636f  ot isinstance(co
-00044e80: 6f72 642c 2028 6c69 7374 2c20 7475 706c  ord, (list, tupl
-00044e90: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
-00044ea0: 2063 6f6f 7264 203d 2028 636f 6f72 642c   coord = (coord,
-00044eb0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-00044ec0: 203d 2073 656c 660a 2020 2020 2020 2020   = self.        
-00044ed0: 666f 7220 6320 696e 2063 6f6f 7264 3a0a  for c in coord:.
-00044ee0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00044ef0: 6c74 203d 2072 6573 756c 742e 5f69 6e74  lt = result._int
-00044f00: 6567 7261 7465 5f6f 6e65 280a 2020 2020  egrate_one(.    
-00044f10: 2020 2020 2020 2020 2020 2020 632c 2064              c, d
-00044f20: 6174 6574 696d 655f 756e 6974 3d64 6174  atetime_unit=dat
-00044f30: 6574 696d 655f 756e 6974 2c20 6375 6d75  etime_unit, cumu
-00044f40: 6c61 7469 7665 3d54 7275 650a 2020 2020  lative=True.    
-00044f50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00044f60: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
-00044f70: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00044f80: 2020 2064 6566 2072 6561 6c28 7365 6c66     def real(self
-00044f90: 3a20 545f 4461 7461 7365 7429 202d 3e20  : T_Dataset) -> 
-00044fa0: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
-00044fb0: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-00044fc0: 6865 2072 6561 6c20 7061 7274 206f 6620  he real part of 
-00044fd0: 6561 6368 2064 6174 6120 7661 7269 6162  each data variab
-00044fe0: 6c65 2e0a 0a20 2020 2020 2020 2053 6565  le...        See
-00044ff0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00045000: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206e  ------.        n
-00045010: 756d 7079 2e6e 6461 7272 6179 2e72 6561  umpy.ndarray.rea
-00045020: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
-00045030: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00045040: 662e 6d61 7028 6c61 6d62 6461 2078 3a20  f.map(lambda x: 
-00045050: 782e 7265 616c 2c20 6b65 6570 5f61 7474  x.real, keep_att
-00045060: 7273 3d54 7275 6529 0a0a 2020 2020 4070  rs=True)..    @p
-00045070: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00045080: 696d 6167 2873 656c 663a 2054 5f44 6174  imag(self: T_Dat
-00045090: 6173 6574 2920 2d3e 2054 5f44 6174 6173  aset) -> T_Datas
-000450a0: 6574 3a0a 2020 2020 2020 2020 2222 220a  et:.        """.
-000450b0: 2020 2020 2020 2020 5468 6520 696d 6167          The imag
-000450c0: 696e 6172 7920 7061 7274 206f 6620 6561  inary part of ea
-000450d0: 6368 2064 6174 6120 7661 7269 6162 6c65  ch data variable
-000450e0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-000450f0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-00045100: 2d2d 2d2d 0a20 2020 2020 2020 206e 756d  ----.        num
-00045110: 7079 2e6e 6461 7272 6179 2e69 6d61 670a  py.ndarray.imag.
-00045120: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00045130: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00045140: 6d61 7028 6c61 6d62 6461 2078 3a20 782e  map(lambda x: x.
-00045150: 696d 6167 2c20 6b65 6570 5f61 7474 7273  imag, keep_attrs
-00045160: 3d54 7275 6529 0a0a 2020 2020 706c 6f74  =True)..    plot
-00045170: 203d 2075 7469 6c73 2e55 6e63 6163 6865   = utils.Uncache
-00045180: 6441 6363 6573 736f 7228 4461 7461 7365  dAccessor(Datase
-00045190: 7450 6c6f 7441 6363 6573 736f 7229 0a0a  tPlotAccessor)..
-000451a0: 2020 2020 6465 6620 6669 6c74 6572 5f62      def filter_b
-000451b0: 795f 6174 7472 7328 7365 6c66 3a20 545f  y_attrs(self: T_
-000451c0: 4461 7461 7365 742c 202a 2a6b 7761 7267  Dataset, **kwarg
-000451d0: 7329 202d 3e20 545f 4461 7461 7365 743a  s) -> T_Dataset:
-000451e0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-000451f0: 726e 7320 6120 6060 4461 7461 7365 7460  rns a ``Dataset`
-00045200: 6020 7769 7468 2076 6172 6961 626c 6573  ` with variables
-00045210: 2074 6861 7420 6d61 7463 6820 7370 6563   that match spec
-00045220: 6966 6963 2063 6f6e 6469 7469 6f6e 732e  ific conditions.
-00045230: 0a0a 2020 2020 2020 2020 4361 6e20 7061  ..        Can pa
-00045240: 7373 2069 6e20 6060 6b65 793d 7661 6c75  ss in ``key=valu
-00045250: 6560 6020 6f72 2060 606b 6579 3d63 616c  e`` or ``key=cal
-00045260: 6c61 626c 6560 602e 2020 4120 4461 7461  lable``.  A Data
-00045270: 7365 7420 6973 2072 6574 7572 6e65 640a  set is returned.
-00045280: 2020 2020 2020 2020 636f 6e74 6169 6e69          containi
-00045290: 6e67 206f 6e6c 7920 7468 6520 7661 7269  ng only the vari
-000452a0: 6162 6c65 7320 666f 7220 7768 6963 6820  ables for which 
-000452b0: 616c 6c20 7468 6520 6669 6c74 6572 2074  all the filter t
-000452c0: 6573 7473 2070 6173 732e 0a20 2020 2020  ests pass..     
-000452d0: 2020 2054 6865 7365 2074 6573 7473 2061     These tests a
-000452e0: 7265 2065 6974 6865 7220 6060 6b65 793d  re either ``key=
-000452f0: 7661 6c75 6560 6020 666f 7220 7768 6963  value`` for whic
-00045300: 6820 7468 6520 6174 7472 6962 7574 6520  h the attribute 
-00045310: 6060 6b65 7960 600a 2020 2020 2020 2020  ``key``.        
-00045320: 6861 7320 7468 6520 6578 6163 7420 7661  has the exact va
-00045330: 6c75 6520 6060 7661 6c75 6560 6020 6f72  lue ``value`` or
-00045340: 2074 6865 2063 616c 6c61 626c 6520 7061   the callable pa
-00045350: 7373 6564 2069 6e74 6f0a 2020 2020 2020  ssed into.      
-00045360: 2020 6060 6b65 793d 6361 6c6c 6162 6c65    ``key=callable
-00045370: 6060 2072 6574 7572 6e73 2054 7275 652e  `` returns True.
-00045380: 2054 6865 2063 616c 6c61 626c 6520 7769   The callable wi
-00045390: 6c6c 2062 6520 7061 7373 6564 2061 2073  ll be passed a s
-000453a0: 696e 676c 650a 2020 2020 2020 2020 7661  ingle.        va
-000453b0: 6c75 652c 2065 6974 6865 7220 7468 6520  lue, either the 
-000453c0: 7661 6c75 6520 6f66 2074 6865 2061 7474  value of the att
-000453d0: 7269 6275 7465 2060 606b 6579 6060 206f  ribute ``key`` o
-000453e0: 7220 6060 4e6f 6e65 6060 2069 6620 7468  r ``None`` if th
-000453f0: 650a 2020 2020 2020 2020 4461 7461 4172  e.        DataAr
-00045400: 7261 7920 646f 6573 206e 6f74 2068 6176  ray does not hav
-00045410: 6520 616e 2061 7474 7269 6275 7465 2077  e an attribute w
-00045420: 6974 6820 7468 6520 6e61 6d65 2060 606b  ith the name ``k
-00045430: 6579 6060 2e0a 0a20 2020 2020 2020 2050  ey``...        P
-00045440: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00045450: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00045460: 2020 2020 202a 2a6b 7761 7267 730a 2020       **kwargs.  
-00045470: 2020 2020 2020 2020 2020 6b65 7920 3a20            key : 
-00045480: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-00045490: 2020 2020 4174 7472 6962 7574 6520 6e61      Attribute na
-000454a0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
-000454b0: 7661 6c75 6520 3a20 6361 6c6c 6162 6c65  value : callable
-000454c0: 206f 7220 6f62 6a0a 2020 2020 2020 2020   or obj.        
-000454d0: 2020 2020 2020 2020 4966 2076 616c 7565          If value
-000454e0: 2069 7320 6120 6361 6c6c 6162 6c65 2c20   is a callable, 
-000454f0: 6974 2073 686f 756c 6420 7265 7475 726e  it should return
-00045500: 2061 2062 6f6f 6c65 616e 2069 6e20 7468   a boolean in th
-00045510: 6520 666f 726d 0a20 2020 2020 2020 2020  e form.         
-00045520: 2020 2020 2020 206f 6620 626f 6f6c 203d         of bool =
-00045530: 2066 756e 6328 6174 7472 2920 7768 6572   func(attr) wher
-00045540: 6520 6174 7472 2069 7320 6461 2e61 7474  e attr is da.att
-00045550: 7273 5b6b 6579 5d2e 0a20 2020 2020 2020  rs[key]..       
-00045560: 2020 2020 2020 2020 204f 7468 6572 7769           Otherwi
-00045570: 7365 2c20 7661 6c75 6520 7769 6c6c 2062  se, value will b
-00045580: 6520 636f 6d70 6172 6564 2074 6f20 7468  e compared to th
-00045590: 6520 6561 6368 0a20 2020 2020 2020 2020  e each.         
-000455a0: 2020 2020 2020 2044 6174 6141 7272 6179         DataArray
-000455b0: 2773 2061 7474 7273 5b6b 6579 5d2e 0a0a  's attrs[key]...
-000455c0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-000455d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-000455e0: 2020 2020 2020 2020 6e65 7720 3a20 4461          new : Da
-000455f0: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
-00045600: 2020 4e65 7720 6461 7461 7365 7420 7769    New dataset wi
-00045610: 7468 2076 6172 6961 626c 6573 2066 696c  th variables fil
-00045620: 7465 7265 6420 6279 2061 7474 7269 6275  tered by attribu
-00045630: 7465 2e0a 0a20 2020 2020 2020 2045 7861  te...        Exa
-00045640: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
-00045650: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
-00045660: 3e3e 2074 656d 7020 3d20 3135 202b 2038  >> temp = 15 + 8
-00045670: 202a 206e 702e 7261 6e64 6f6d 2e72 616e   * np.random.ran
-00045680: 646e 2832 2c20 322c 2033 290a 2020 2020  dn(2, 2, 3).    
-00045690: 2020 2020 3e3e 3e20 7072 6563 6970 203d      >>> precip =
-000456a0: 2031 3020 2a20 6e70 2e72 616e 646f 6d2e   10 * np.random.
-000456b0: 7261 6e64 2832 2c20 322c 2033 290a 2020  rand(2, 2, 3).  
-000456c0: 2020 2020 2020 3e3e 3e20 6c6f 6e20 3d20        >>> lon = 
-000456d0: 5b5b 2d39 392e 3833 2c20 2d39 392e 3332  [[-99.83, -99.32
-000456e0: 5d2c 205b 2d39 392e 3739 2c20 2d39 392e  ], [-99.79, -99.
-000456f0: 3233 5d5d 0a20 2020 2020 2020 203e 3e3e  23]].        >>>
-00045700: 206c 6174 203d 205b 5b34 322e 3235 2c20   lat = [[42.25, 
-00045710: 3432 2e32 315d 2c20 5b34 322e 3633 2c20  42.21], [42.63, 
-00045720: 3432 2e35 395d 5d0a 2020 2020 2020 2020  42.59]].        
-00045730: 3e3e 3e20 6469 6d73 203d 205b 2278 222c  >>> dims = ["x",
-00045740: 2022 7922 2c20 2274 696d 6522 5d0a 2020   "y", "time"].  
-00045750: 2020 2020 2020 3e3e 3e20 7465 6d70 5f61        >>> temp_a
-00045760: 7474 7220 3d20 6469 6374 2873 7461 6e64  ttr = dict(stand
-00045770: 6172 645f 6e61 6d65 3d22 6169 725f 706f  ard_name="air_po
-00045780: 7465 6e74 6961 6c5f 7465 6d70 6572 6174  tential_temperat
-00045790: 7572 6522 290a 2020 2020 2020 2020 3e3e  ure").        >>
-000457a0: 3e20 7072 6563 6970 5f61 7474 7220 3d20  > precip_attr = 
-000457b0: 6469 6374 2873 7461 6e64 6172 645f 6e61  dict(standard_na
-000457c0: 6d65 3d22 636f 6e76 6563 7469 7665 5f70  me="convective_p
-000457d0: 7265 6369 7069 7461 7469 6f6e 5f66 6c75  recipitation_flu
-000457e0: 7822 290a 0a20 2020 2020 2020 203e 3e3e  x")..        >>>
-000457f0: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
-00045800: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
-00045810: 2020 6469 6374 280a 2020 2020 2020 2020    dict(.        
-00045820: 2e2e 2e20 2020 2020 2020 2020 7465 6d70  ...         temp
-00045830: 6572 6174 7572 653d 2864 696d 732c 2074  erature=(dims, t
-00045840: 656d 702c 2074 656d 705f 6174 7472 292c  emp, temp_attr),
-00045850: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-00045860: 2020 2020 2070 7265 6369 7069 7461 7469       precipitati
-00045870: 6f6e 3d28 6469 6d73 2c20 7072 6563 6970  on=(dims, precip
-00045880: 2c20 7072 6563 6970 5f61 7474 7229 2c0a  , precip_attr),.
-00045890: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-000458a0: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
-000458b0: 2020 2063 6f6f 7264 733d 6469 6374 280a     coords=dict(.
-000458c0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-000458d0: 2020 2020 6c6f 6e3d 285b 2278 222c 2022      lon=(["x", "
-000458e0: 7922 5d2c 206c 6f6e 292c 0a20 2020 2020  y"], lon),.     
-000458f0: 2020 202e 2e2e 2020 2020 2020 2020 206c     ...         l
-00045900: 6174 3d28 5b22 7822 2c20 2279 225d 2c20  at=(["x", "y"], 
-00045910: 6c61 7429 2c0a 2020 2020 2020 2020 2e2e  lat),.        ..
-00045920: 2e20 2020 2020 2020 2020 7469 6d65 3d70  .         time=p
-00045930: 642e 6461 7465 5f72 616e 6765 2822 3230  d.date_range("20
-00045940: 3134 2d30 392d 3036 222c 2070 6572 696f  14-09-06", perio
-00045950: 6473 3d33 292c 0a20 2020 2020 2020 202e  ds=3),.        .
-00045960: 2e2e 2020 2020 2020 2020 2072 6566 6572  ..         refer
-00045970: 656e 6365 5f74 696d 653d 7064 2e54 696d  ence_time=pd.Tim
-00045980: 6573 7461 6d70 2822 3230 3134 2d30 392d  estamp("2014-09-
-00045990: 3035 2229 2c0a 2020 2020 2020 2020 2e2e  05"),.        ..
-000459a0: 2e20 2020 2020 292c 0a20 2020 2020 2020  .     ),.       
-000459b0: 202e 2e2e 2029 0a0a 2020 2020 2020 2020   ... )..        
-000459c0: 4765 7420 7661 7269 6162 6c65 7320 6d61  Get variables ma
-000459d0: 7463 6869 6e67 2061 2073 7065 6369 6669  tching a specifi
-000459e0: 6320 7374 616e 6461 7264 5f6e 616d 653a  c standard_name:
-000459f0: 0a0a 2020 2020 2020 2020 3e3e 3e20 6473  ..        >>> ds
-00045a00: 2e66 696c 7465 725f 6279 5f61 7474 7273  .filter_by_attrs
-00045a10: 2873 7461 6e64 6172 645f 6e61 6d65 3d22  (standard_name="
-00045a20: 636f 6e76 6563 7469 7665 5f70 7265 6369  convective_preci
-00045a30: 7069 7461 7469 6f6e 5f66 6c75 7822 290a  pitation_flux").
-00045a40: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
-00045a50: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
-00045a60: 2044 696d 656e 7369 6f6e 733a 2020 2020   Dimensions:    
-00045a70: 2020 2020 2028 783a 2032 2c20 793a 2032       (x: 2, y: 2
-00045a80: 2c20 7469 6d65 3a20 3329 0a20 2020 2020  , time: 3).     
-00045a90: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
-00045aa0: 2020 2020 2020 2020 2020 2020 6c6f 6e20              lon 
-00045ab0: 2020 2020 2020 2020 2020 2020 2878 2c20              (x, 
-00045ac0: 7929 2066 6c6f 6174 3634 202d 3939 2e38  y) float64 -99.8
-00045ad0: 3320 2d39 392e 3332 202d 3939 2e37 3920  3 -99.32 -99.79 
-00045ae0: 2d39 392e 3233 0a20 2020 2020 2020 2020  -99.23.         
-00045af0: 2020 206c 6174 2020 2020 2020 2020 2020     lat          
-00045b00: 2020 2028 782c 2079 2920 666c 6f61 7436     (x, y) float6
-00045b10: 3420 3432 2e32 3520 3432 2e32 3120 3432  4 42.25 42.21 42
-00045b20: 2e36 3320 3432 2e35 390a 2020 2020 2020  .63 42.59.      
-00045b30: 2020 2020 2a20 7469 6d65 2020 2020 2020      * time      
-00045b40: 2020 2020 2020 2874 696d 6529 2064 6174        (time) dat
-00045b50: 6574 696d 6536 345b 6e73 5d20 3230 3134  etime64[ns] 2014
-00045b60: 2d30 392d 3036 2032 3031 342d 3039 2d30  -09-06 2014-09-0
-00045b70: 3720 3230 3134 2d30 392d 3038 0a20 2020  7 2014-09-08.   
-00045b80: 2020 2020 2020 2020 2072 6566 6572 656e           referen
-00045b90: 6365 5f74 696d 6520 2064 6174 6574 696d  ce_time  datetim
-00045ba0: 6536 345b 6e73 5d20 3230 3134 2d30 392d  e64[ns] 2014-09-
-00045bb0: 3035 0a20 2020 2020 2020 2044 696d 656e  05.        Dimen
-00045bc0: 7369 6f6e 7320 7769 7468 6f75 7420 636f  sions without co
-00045bd0: 6f72 6469 6e61 7465 733a 2078 2c20 790a  ordinates: x, y.
-00045be0: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
-00045bf0: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
-00045c00: 2020 2020 7072 6563 6970 6974 6174 696f      precipitatio
-00045c10: 6e20 2020 2878 2c20 792c 2074 696d 6529  n   (x, y, time)
-00045c20: 2066 6c6f 6174 3634 2035 2e36 3820 392e   float64 5.68 9.
-00045c30: 3235 3620 302e 3731 3034 202e 2e2e 2037  256 0.7104 ... 7
-00045c40: 2e39 3932 2034 2e36 3135 2037 2e38 3035  .992 4.615 7.805
-00045c50: 0a0a 2020 2020 2020 2020 4765 7420 616c  ..        Get al
-00045c60: 6c20 7661 7269 6162 6c65 7320 7468 6174  l variables that
-00045c70: 2068 6176 6520 6120 7374 616e 6461 7264   have a standard
-00045c80: 5f6e 616d 6520 6174 7472 6962 7574 653a  _name attribute:
-00045c90: 0a0a 2020 2020 2020 2020 3e3e 3e20 7374  ..        >>> st
-00045ca0: 616e 6461 7264 5f6e 616d 6520 3d20 6c61  andard_name = la
-00045cb0: 6d62 6461 2076 3a20 7620 6973 206e 6f74  mbda v: v is not
-00045cc0: 204e 6f6e 650a 2020 2020 2020 2020 3e3e   None.        >>
-00045cd0: 3e20 6473 2e66 696c 7465 725f 6279 5f61  > ds.filter_by_a
-00045ce0: 7474 7273 2873 7461 6e64 6172 645f 6e61  ttrs(standard_na
-00045cf0: 6d65 3d73 7461 6e64 6172 645f 6e61 6d65  me=standard_name
-00045d00: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-00045d10: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-00045d20: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-00045d30: 2020 2020 2020 2028 783a 2032 2c20 793a         (x: 2, y:
-00045d40: 2032 2c20 7469 6d65 3a20 3329 0a20 2020   2, time: 3).   
-00045d50: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
-00045d60: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-00045d70: 6e20 2020 2020 2020 2020 2020 2020 2878  n             (x
-00045d80: 2c20 7929 2066 6c6f 6174 3634 202d 3939  , y) float64 -99
-00045d90: 2e38 3320 2d39 392e 3332 202d 3939 2e37  .83 -99.32 -99.7
-00045da0: 3920 2d39 392e 3233 0a20 2020 2020 2020  9 -99.23.       
-00045db0: 2020 2020 206c 6174 2020 2020 2020 2020       lat        
-00045dc0: 2020 2020 2028 782c 2079 2920 666c 6f61       (x, y) floa
-00045dd0: 7436 3420 3432 2e32 3520 3432 2e32 3120  t64 42.25 42.21 
-00045de0: 3432 2e36 3320 3432 2e35 390a 2020 2020  42.63 42.59.    
-00045df0: 2020 2020 2020 2a20 7469 6d65 2020 2020        * time    
-00045e00: 2020 2020 2020 2020 2874 696d 6529 2064          (time) d
-00045e10: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
-00045e20: 3134 2d30 392d 3036 2032 3031 342d 3039  14-09-06 2014-09
-00045e30: 2d30 3720 3230 3134 2d30 392d 3038 0a20  -07 2014-09-08. 
-00045e40: 2020 2020 2020 2020 2020 2072 6566 6572             refer
-00045e50: 656e 6365 5f74 696d 6520 2064 6174 6574  ence_time  datet
-00045e60: 696d 6536 345b 6e73 5d20 3230 3134 2d30  ime64[ns] 2014-0
-00045e70: 392d 3035 0a20 2020 2020 2020 2044 696d  9-05.        Dim
-00045e80: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
-00045e90: 636f 6f72 6469 6e61 7465 733a 2078 2c20  coordinates: x, 
-00045ea0: 790a 2020 2020 2020 2020 4461 7461 2076  y.        Data v
-00045eb0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
-00045ec0: 2020 2020 2020 7465 6d70 6572 6174 7572        temperatur
-00045ed0: 6520 2020 2020 2878 2c20 792c 2074 696d  e     (x, y, tim
-00045ee0: 6529 2066 6c6f 6174 3634 2032 392e 3131  e) float64 29.11
-00045ef0: 2031 382e 3220 3232 2e38 3320 2e2e 2e20   18.2 22.83 ... 
-00045f00: 3138 2e32 3820 3136 2e31 3520 3236 2e36  18.28 16.15 26.6
-00045f10: 330a 2020 2020 2020 2020 2020 2020 7072  3.            pr
-00045f20: 6563 6970 6974 6174 696f 6e20 2020 2878  ecipitation   (x
-00045f30: 2c20 792c 2074 696d 6529 2066 6c6f 6174  , y, time) float
-00045f40: 3634 2035 2e36 3820 392e 3235 3620 302e  64 5.68 9.256 0.
-00045f50: 3731 3034 202e 2e2e 2037 2e39 3932 2034  7104 ... 7.992 4
-00045f60: 2e36 3135 2037 2e38 3035 0a0a 2020 2020  .615 7.805..    
-00045f70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00045f80: 7365 6c65 6374 696f 6e20 3d20 5b5d 0a20  selection = []. 
-00045f90: 2020 2020 2020 2066 6f72 2076 6172 5f6e         for var_n
-00045fa0: 616d 652c 2076 6172 6961 626c 6520 696e  ame, variable in
-00045fb0: 2073 656c 662e 7661 7269 6162 6c65 732e   self.variables.
-00045fc0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00045fd0: 2020 2020 2068 6173 5f76 616c 7565 5f66       has_value_f
-00045fe0: 6c61 6720 3d20 4661 6c73 650a 2020 2020  lag = False.    
-00045ff0: 2020 2020 2020 2020 666f 7220 6174 7472          for attr
-00046000: 5f6e 616d 652c 2070 6174 7465 726e 2069  _name, pattern i
-00046010: 6e20 6b77 6172 6773 2e69 7465 6d73 2829  n kwargs.items()
-00046020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00046030: 2020 6174 7472 5f76 616c 7565 203d 2076    attr_value = v
-00046040: 6172 6961 626c 652e 6174 7472 732e 6765  ariable.attrs.ge
-00046050: 7428 6174 7472 5f6e 616d 6529 0a20 2020  t(attr_name).   
-00046060: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00046070: 2863 616c 6c61 626c 6528 7061 7474 6572  (callable(patter
-00046080: 6e29 2061 6e64 2070 6174 7465 726e 2861  n) and pattern(a
-00046090: 7474 725f 7661 6c75 6529 2920 6f72 2061  ttr_value)) or a
-000460a0: 7474 725f 7661 6c75 6520 3d3d 2070 6174  ttr_value == pat
-000460b0: 7465 726e 3a0a 2020 2020 2020 2020 2020  tern:.          
-000460c0: 2020 2020 2020 2020 2020 6861 735f 7661            has_va
-000460d0: 6c75 655f 666c 6167 203d 2054 7275 650a  lue_flag = True.
-000460e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000460f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00046100: 2020 2020 2020 2020 2020 6861 735f 7661            has_va
-00046110: 6c75 655f 666c 6167 203d 2046 616c 7365  lue_flag = False
-00046120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046130: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-00046140: 2020 2020 2020 2069 6620 6861 735f 7661         if has_va
-00046150: 6c75 655f 666c 6167 2069 7320 5472 7565  lue_flag is True
-00046160: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00046170: 2020 7365 6c65 6374 696f 6e2e 6170 7065    selection.appe
-00046180: 6e64 2876 6172 5f6e 616d 6529 0a20 2020  nd(var_name).   
-00046190: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000461a0: 5b73 656c 6563 7469 6f6e 5d0a 0a20 2020  [selection]..   
-000461b0: 2064 6566 2075 6e69 6679 5f63 6875 6e6b   def unify_chunk
-000461c0: 7328 7365 6c66 3a20 545f 4461 7461 7365  s(self: T_Datase
-000461d0: 7429 202d 3e20 545f 4461 7461 7365 743a  t) -> T_Dataset:
-000461e0: 0a20 2020 2020 2020 2022 2222 556e 6966  .        """Unif
-000461f0: 7920 6368 756e 6b20 7369 7a65 2061 6c6f  y chunk size alo
-00046200: 6e67 2061 6c6c 2063 6875 6e6b 6564 2064  ng all chunked d
-00046210: 696d 656e 7369 6f6e 7320 6f66 2074 6869  imensions of thi
-00046220: 7320 4461 7461 7365 742e 0a0a 2020 2020  s Dataset...    
-00046230: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00046240: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00046250: 2020 2020 4461 7461 7365 7420 7769 7468      Dataset with
-00046260: 2063 6f6e 7369 7374 656e 7420 6368 756e   consistent chun
-00046270: 6b20 7369 7a65 7320 666f 7220 616c 6c20  k sizes for all 
-00046280: 6461 736b 2d61 7272 6179 2076 6172 6961  dask-array varia
-00046290: 626c 6573 0a0a 2020 2020 2020 2020 5365  bles..        Se
-000462a0: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-000462b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000462c0: 6461 736b 2e61 7272 6179 2e63 6f72 652e  dask.array.core.
-000462d0: 756e 6966 795f 6368 756e 6b73 0a20 2020  unify_chunks.   
-000462e0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000462f0: 2020 7265 7475 726e 2075 6e69 6679 5f63    return unify_c
-00046300: 6875 6e6b 7328 7365 6c66 295b 305d 0a0a  hunks(self)[0]..
-00046310: 2020 2020 6465 6620 6d61 705f 626c 6f63      def map_bloc
-00046320: 6b73 280a 2020 2020 2020 2020 7365 6c66  ks(.        self
-00046330: 2c0a 2020 2020 2020 2020 6675 6e63 3a20  ,.        func: 
-00046340: 4361 6c6c 6162 6c65 5b2e 2e2e 2c20 545f  Callable[..., T_
-00046350: 5861 7272 6179 5d2c 0a20 2020 2020 2020  Xarray],.       
-00046360: 2061 7267 733a 2053 6571 7565 6e63 655b   args: Sequence[
-00046370: 416e 795d 203d 2028 292c 0a20 2020 2020  Any] = (),.     
-00046380: 2020 206b 7761 7267 733a 204d 6170 7069     kwargs: Mappi
-00046390: 6e67 5b73 7472 2c20 416e 795d 207c 204e  ng[str, Any] | N
-000463a0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-000463b0: 2020 2020 7465 6d70 6c61 7465 3a20 4461      template: Da
-000463c0: 7461 4172 7261 7920 7c20 4461 7461 7365  taArray | Datase
-000463d0: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
-000463e0: 0a20 2020 2029 202d 3e20 545f 5861 7272  .    ) -> T_Xarr
-000463f0: 6179 3a0a 2020 2020 2020 2020 2222 220a  ay:.        """.
-00046400: 2020 2020 2020 2020 4170 706c 7920 6120          Apply a 
-00046410: 6675 6e63 7469 6f6e 2074 6f20 6561 6368  function to each
-00046420: 2062 6c6f 636b 206f 6620 7468 6973 2044   block of this D
-00046430: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
-00046440: 202e 2e20 7761 726e 696e 673a 3a0a 2020   .. warning::.  
-00046450: 2020 2020 2020 2020 2020 5468 6973 206d            This m
-00046460: 6574 686f 6420 6973 2065 7870 6572 696d  ethod is experim
-00046470: 656e 7461 6c20 616e 6420 6974 7320 7369  ental and its si
-00046480: 676e 6174 7572 6520 6d61 7920 6368 616e  gnature may chan
-00046490: 6765 2e0a 0a20 2020 2020 2020 2050 6172  ge...        Par
-000464a0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-000464b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-000464c0: 2020 2066 756e 6320 3a20 6361 6c6c 6162     func : callab
-000464d0: 6c65 0a20 2020 2020 2020 2020 2020 2055  le.            U
-000464e0: 7365 722d 7072 6f76 6964 6564 2066 756e  ser-provided fun
-000464f0: 6374 696f 6e20 7468 6174 2061 6363 6570  ction that accep
-00046500: 7473 2061 2044 6174 6173 6574 2061 7320  ts a Dataset as 
-00046510: 6974 7320 6669 7273 740a 2020 2020 2020  its first.      
-00046520: 2020 2020 2020 7061 7261 6d65 7465 722e        parameter.
-00046530: 2054 6865 2066 756e 6374 696f 6e20 7769   The function wi
-00046540: 6c6c 2072 6563 6569 7665 2061 2073 7562  ll receive a sub
-00046550: 7365 7420 6f72 2027 626c 6f63 6b27 206f  set or 'block' o
-00046560: 6620 7468 6973 2044 6174 6173 6574 2028  f this Dataset (
-00046570: 7365 6520 6265 6c6f 7729 2c0a 2020 2020  see below),.    
-00046580: 2020 2020 2020 2020 636f 7272 6573 706f          correspo
-00046590: 6e64 696e 6720 746f 206f 6e65 2063 6875  nding to one chu
-000465a0: 6e6b 2061 6c6f 6e67 2065 6163 6820 6368  nk along each ch
-000465b0: 756e 6b65 6420 6469 6d65 6e73 696f 6e2e  unked dimension.
-000465c0: 2060 6066 756e 6360 6020 7769 6c6c 2062   ``func`` will b
-000465d0: 650a 2020 2020 2020 2020 2020 2020 6578  e.            ex
-000465e0: 6563 7574 6564 2061 7320 6060 6675 6e63  ecuted as ``func
-000465f0: 2873 7562 7365 745f 6461 7461 7365 742c  (subset_dataset,
-00046600: 202a 7375 6273 6574 5f61 7267 732c 202a   *subset_args, *
-00046610: 2a6b 7761 7267 7329 6060 2e0a 0a20 2020  *kwargs)``...   
-00046620: 2020 2020 2020 2020 2054 6869 7320 6675           This fu
-00046630: 6e63 7469 6f6e 206d 7573 7420 7265 7475  nction must retu
-00046640: 726e 2065 6974 6865 7220 6120 7369 6e67  rn either a sing
-00046650: 6c65 2044 6174 6141 7272 6179 206f 7220  le DataArray or 
-00046660: 6120 7369 6e67 6c65 2044 6174 6173 6574  a single Dataset
-00046670: 2e0a 0a20 2020 2020 2020 2020 2020 2054  ...            T
-00046680: 6869 7320 6675 6e63 7469 6f6e 2063 616e  his function can
-00046690: 6e6f 7420 6164 6420 6120 6e65 7720 6368  not add a new ch
-000466a0: 756e 6b65 6420 6469 6d65 6e73 696f 6e2e  unked dimension.
-000466b0: 0a20 2020 2020 2020 2061 7267 7320 3a20  .        args : 
-000466c0: 7365 7175 656e 6365 0a20 2020 2020 2020  sequence.       
-000466d0: 2020 2020 2050 6173 7365 6420 746f 2066       Passed to f
-000466e0: 756e 6320 6166 7465 7220 756e 7061 636b  unc after unpack
-000466f0: 696e 6720 616e 6420 7375 6273 6574 7469  ing and subsetti
-00046700: 6e67 2061 6e79 2078 6172 7261 7920 6f62  ng any xarray ob
-00046710: 6a65 6374 7320 6279 2062 6c6f 636b 732e  jects by blocks.
-00046720: 0a20 2020 2020 2020 2020 2020 2078 6172  .            xar
-00046730: 7261 7920 6f62 6a65 6374 7320 696e 2061  ray objects in a
-00046740: 7267 7320 6d75 7374 2062 6520 616c 6967  rgs must be alig
-00046750: 6e65 6420 7769 7468 206f 626a 2c20 6f74  ned with obj, ot
-00046760: 6865 7277 6973 6520 616e 2065 7272 6f72  herwise an error
-00046770: 2069 7320 7261 6973 6564 2e0a 2020 2020   is raised..    
-00046780: 2020 2020 6b77 6172 6773 203a 204d 6170      kwargs : Map
-00046790: 7069 6e67 206f 7220 4e6f 6e65 0a20 2020  ping or None.   
-000467a0: 2020 2020 2020 2020 2050 6173 7365 6420           Passed 
-000467b0: 7665 7262 6174 696d 2074 6f20 6675 6e63  verbatim to func
-000467c0: 2061 6674 6572 2075 6e70 6163 6b69 6e67   after unpacking
-000467d0: 2e20 7861 7272 6179 206f 626a 6563 7473  . xarray objects
-000467e0: 2c20 6966 2061 6e79 2c20 7769 6c6c 206e  , if any, will n
-000467f0: 6f74 2062 650a 2020 2020 2020 2020 2020  ot be.          
-00046800: 2020 7375 6273 6574 2074 6f20 626c 6f63    subset to bloc
-00046810: 6b73 2e20 5061 7373 696e 6720 6461 736b  ks. Passing dask
-00046820: 2063 6f6c 6c65 6374 696f 6e73 2069 6e20   collections in 
-00046830: 6b77 6172 6773 2069 7320 6e6f 7420 616c  kwargs is not al
-00046840: 6c6f 7765 642e 0a20 2020 2020 2020 2074  lowed..        t
-00046850: 656d 706c 6174 6520 3a20 4461 7461 4172  emplate : DataAr
-00046860: 7261 792c 2044 6174 6173 6574 206f 7220  ray, Dataset or 
-00046870: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0a20  None, optional. 
-00046880: 2020 2020 2020 2020 2020 2078 6172 7261             xarra
-00046890: 7920 6f62 6a65 6374 2072 6570 7265 7365  y object represe
-000468a0: 6e74 696e 6720 7468 6520 6669 6e61 6c20  nting the final 
-000468b0: 7265 7375 6c74 2061 6674 6572 2063 6f6d  result after com
-000468c0: 7075 7465 2069 7320 6361 6c6c 6564 2e20  pute is called. 
-000468d0: 4966 206e 6f74 2070 726f 7669 6465 642c  If not provided,
-000468e0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-000468f0: 2066 756e 6374 696f 6e20 7769 6c6c 2062   function will b
-00046900: 6520 6669 7273 7420 7275 6e20 6f6e 206d  e first run on m
-00046910: 6f63 6b65 642d 7570 2064 6174 612c 2074  ocked-up data, t
-00046920: 6861 7420 6c6f 6f6b 7320 6c69 6b65 2074  hat looks like t
-00046930: 6869 7320 6f62 6a65 6374 2062 7574 0a20  his object but. 
-00046940: 2020 2020 2020 2020 2020 2068 6173 2073             has s
-00046950: 697a 6573 2030 2c20 746f 2064 6574 6572  izes 0, to deter
-00046960: 6d69 6e65 2070 726f 7065 7274 6965 7320  mine properties 
-00046970: 6f66 2074 6865 2072 6574 7572 6e65 6420  of the returned 
-00046980: 6f62 6a65 6374 2073 7563 6820 6173 2064  object such as d
-00046990: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-000469a0: 2020 7661 7269 6162 6c65 206e 616d 6573    variable names
-000469b0: 2c20 6174 7472 6962 7574 6573 2c20 6e65  , attributes, ne
-000469c0: 7720 6469 6d65 6e73 696f 6e73 2061 6e64  w dimensions and
-000469d0: 206e 6577 2069 6e64 6578 6573 2028 6966   new indexes (if
-000469e0: 2061 6e79 292e 0a20 2020 2020 2020 2020   any)..         
-000469f0: 2020 2060 6074 656d 706c 6174 6560 6020     ``template`` 
-00046a00: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
-00046a10: 2069 6620 7468 6520 6675 6e63 7469 6f6e   if the function
-00046a20: 2063 6861 6e67 6573 2074 6865 2073 697a   changes the siz
-00046a30: 6520 6f66 2065 7869 7374 696e 6720 6469  e of existing di
-00046a40: 6d65 6e73 696f 6e73 2e0a 2020 2020 2020  mensions..      
-00046a50: 2020 2020 2020 5768 656e 2070 726f 7669        When provi
-00046a60: 6465 642c 2060 6061 7474 7273 6060 206f  ded, ``attrs`` o
-00046a70: 6e20 7661 7269 6162 6c65 7320 696e 2060  n variables in `
-00046a80: 7465 6d70 6c61 7465 6020 6172 6520 636f  template` are co
-00046a90: 7069 6564 206f 7665 7220 746f 2074 6865  pied over to the
-00046aa0: 2072 6573 756c 742e 2041 6e79 0a20 2020   result. Any.   
-00046ab0: 2020 2020 2020 2020 2060 6061 7474 7273           ``attrs
-00046ac0: 6060 2073 6574 2062 7920 6060 6675 6e63  `` set by ``func
-00046ad0: 6060 2077 696c 6c20 6265 2069 676e 6f72  `` will be ignor
-00046ae0: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
-00046af0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00046b00: 2d2d 2d2d 0a20 2020 2020 2020 2041 2073  ----.        A s
-00046b10: 696e 676c 6520 4461 7461 4172 7261 7920  ingle DataArray 
-00046b20: 6f72 2044 6174 6173 6574 2077 6974 6820  or Dataset with 
-00046b30: 6461 736b 2062 6163 6b65 6e64 2c20 7265  dask backend, re
-00046b40: 6173 7365 6d62 6c65 6420 6672 6f6d 2074  assembled from t
-00046b50: 6865 206f 7574 7075 7473 206f 6620 7468  he outputs of th
-00046b60: 650a 2020 2020 2020 2020 6675 6e63 7469  e.        functi
-00046b70: 6f6e 2e0a 0a20 2020 2020 2020 204e 6f74  on...        Not
-00046b80: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-00046b90: 0a20 2020 2020 2020 2054 6869 7320 6675  .        This fu
-00046ba0: 6e63 7469 6f6e 2069 7320 6465 7369 676e  nction is design
-00046bb0: 6564 2066 6f72 2077 6865 6e20 6060 6675  ed for when ``fu
-00046bc0: 6e63 6060 206e 6565 6473 2074 6f20 6d61  nc`` needs to ma
-00046bd0: 6e69 7075 6c61 7465 2061 2077 686f 6c65  nipulate a whole
-00046be0: 2078 6172 7261 7920 6f62 6a65 6374 0a20   xarray object. 
-00046bf0: 2020 2020 2020 2073 7562 7365 7420 746f         subset to
-00046c00: 2065 6163 6820 626c 6f63 6b2e 2045 6163   each block. Eac
-00046c10: 6820 626c 6f63 6b20 6973 206c 6f61 6465  h block is loade
-00046c20: 6420 696e 746f 206d 656d 6f72 792e 2049  d into memory. I
-00046c30: 6e20 7468 6520 6d6f 7265 2063 6f6d 6d6f  n the more commo
-00046c40: 6e20 6361 7365 2077 6865 7265 0a20 2020  n case where.   
-00046c50: 2020 2020 2060 6066 756e 6360 6020 6361       ``func`` ca
-00046c60: 6e20 776f 726b 206f 6e20 6e75 6d70 7920  n work on numpy 
-00046c70: 6172 7261 7973 2c20 6974 2069 7320 7265  arrays, it is re
-00046c80: 636f 6d6d 656e 6465 6420 746f 2075 7365  commended to use
-00046c90: 2060 6061 7070 6c79 5f75 6675 6e63 6060   ``apply_ufunc``
-00046ca0: 2e0a 0a20 2020 2020 2020 2049 6620 6e6f  ...        If no
-00046cb0: 6e65 206f 6620 7468 6520 7661 7269 6162  ne of the variab
-00046cc0: 6c65 7320 696e 2074 6869 7320 6f62 6a65  les in this obje
-00046cd0: 6374 2069 7320 6261 636b 6564 2062 7920  ct is backed by 
-00046ce0: 6461 736b 2061 7272 6179 732c 2063 616c  dask arrays, cal
-00046cf0: 6c69 6e67 2074 6869 7320 6675 6e63 7469  ling this functi
-00046d00: 6f6e 2069 730a 2020 2020 2020 2020 6571  on is.        eq
-00046d10: 7569 7661 6c65 6e74 2074 6f20 6361 6c6c  uivalent to call
-00046d20: 696e 6720 6060 6675 6e63 286f 626a 2c20  ing ``func(obj, 
-00046d30: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-00046d40: 6060 2e0a 0a20 2020 2020 2020 2053 6565  ``...        See
-00046d50: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00046d60: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00046d70: 6173 6b2e 6172 7261 792e 6d61 705f 626c  ask.array.map_bl
-00046d80: 6f63 6b73 2c20 7861 7272 6179 2e61 7070  ocks, xarray.app
-00046d90: 6c79 5f75 6675 6e63 2c20 7861 7272 6179  ly_ufunc, xarray
-00046da0: 2e44 6174 6173 6574 2e6d 6170 5f62 6c6f  .Dataset.map_blo
-00046db0: 636b 730a 2020 2020 2020 2020 7861 7272  cks.        xarr
-00046dc0: 6179 2e44 6174 6141 7272 6179 2e6d 6170  ay.DataArray.map
-00046dd0: 5f62 6c6f 636b 730a 0a20 2020 2020 2020  _blocks..       
-00046de0: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
-00046df0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00046e00: 2020 2043 616c 6375 6c61 7465 2061 6e20     Calculate an 
-00046e10: 616e 6f6d 616c 7920 6672 6f6d 2063 6c69  anomaly from cli
-00046e20: 6d61 746f 6c6f 6779 2075 7369 6e67 2060  matology using `
-00046e30: 602e 6772 6f75 7062 7928 2960 602e 2055  `.groupby()``. U
-00046e40: 7369 6e67 0a20 2020 2020 2020 2060 6078  sing.        ``x
-00046e50: 722e 6d61 705f 626c 6f63 6b73 2829 6060  r.map_blocks()``
-00046e60: 2061 6c6c 6f77 7320 666f 7220 7061 7261   allows for para
-00046e70: 6c6c 656c 206f 7065 7261 7469 6f6e 7320  llel operations 
-00046e80: 7769 7468 206b 6e6f 776c 6564 6765 206f  with knowledge o
-00046e90: 6620 6060 7861 7272 6179 6060 2c0a 2020  f ``xarray``,.  
-00046ea0: 2020 2020 2020 6974 7320 696e 6469 6365        its indice
-00046eb0: 732c 2061 6e64 2069 7473 206d 6574 686f  s, and its metho
-00046ec0: 6473 206c 696b 6520 6060 2e67 726f 7570  ds like ``.group
-00046ed0: 6279 2829 6060 2e0a 0a20 2020 2020 2020  by()``...       
-00046ee0: 203e 3e3e 2064 6566 2063 616c 6375 6c61   >>> def calcula
-00046ef0: 7465 5f61 6e6f 6d61 6c79 2864 612c 2067  te_anomaly(da, g
-00046f00: 726f 7570 6279 5f74 7970 653d 2274 696d  roupby_type="tim
-00046f10: 652e 6d6f 6e74 6822 293a 0a20 2020 2020  e.month"):.     
-00046f20: 2020 202e 2e2e 2020 2020 2067 6220 3d20     ...     gb = 
-00046f30: 6461 2e67 726f 7570 6279 2867 726f 7570  da.groupby(group
-00046f40: 6279 5f74 7970 6529 0a20 2020 2020 2020  by_type).       
-00046f50: 202e 2e2e 2020 2020 2063 6c69 6d20 3d20   ...     clim = 
-00046f60: 6762 2e6d 6561 6e28 6469 6d3d 2274 696d  gb.mean(dim="tim
-00046f70: 6522 290a 2020 2020 2020 2020 2e2e 2e20  e").        ... 
-00046f80: 2020 2020 7265 7475 726e 2067 6220 2d20      return gb - 
-00046f90: 636c 696d 0a20 2020 2020 2020 202e 2e2e  clim.        ...
-00046fa0: 0a20 2020 2020 2020 203e 3e3e 2074 696d  .        >>> tim
-00046fb0: 6520 3d20 7872 2e63 6674 696d 655f 7261  e = xr.cftime_ra
-00046fc0: 6e67 6528 2231 3939 302d 3031 222c 2022  nge("1990-01", "
-00046fd0: 3139 3932 2d30 3122 2c20 6672 6571 3d22  1992-01", freq="
-00046fe0: 4d22 290a 2020 2020 2020 2020 3e3e 3e20  M").        >>> 
-00046ff0: 6d6f 6e74 6820 3d20 7872 2e44 6174 6141  month = xr.DataA
-00047000: 7272 6179 2874 696d 652e 6d6f 6e74 682c  rray(time.month,
-00047010: 2063 6f6f 7264 733d 7b22 7469 6d65 223a   coords={"time":
-00047020: 2074 696d 657d 2c20 6469 6d73 3d5b 2274   time}, dims=["t
-00047030: 696d 6522 5d29 0a20 2020 2020 2020 203e  ime"]).        >
-00047040: 3e3e 206e 702e 7261 6e64 6f6d 2e73 6565  >> np.random.see
-00047050: 6428 3132 3329 0a20 2020 2020 2020 203e  d(123).        >
-00047060: 3e3e 2061 7272 6179 203d 2078 722e 4461  >> array = xr.Da
-00047070: 7461 4172 7261 7928 0a20 2020 2020 2020  taArray(.       
-00047080: 202e 2e2e 2020 2020 206e 702e 7261 6e64   ...     np.rand
-00047090: 6f6d 2e72 616e 6428 6c65 6e28 7469 6d65  om.rand(len(time
-000470a0: 2929 2c0a 2020 2020 2020 2020 2e2e 2e20  )),.        ... 
-000470b0: 2020 2020 6469 6d73 3d5b 2274 696d 6522      dims=["time"
-000470c0: 5d2c 0a20 2020 2020 2020 202e 2e2e 2020  ],.        ...  
-000470d0: 2020 2063 6f6f 7264 733d 7b22 7469 6d65     coords={"time
-000470e0: 223a 2074 696d 652c 2022 6d6f 6e74 6822  ": time, "month"
-000470f0: 3a20 6d6f 6e74 687d 2c0a 2020 2020 2020  : month},.      
-00047100: 2020 2e2e 2e20 292e 6368 756e 6b28 290a    ... ).chunk().
-00047110: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
-00047120: 2078 722e 4461 7461 7365 7428 7b22 6122   xr.Dataset({"a"
-00047130: 3a20 6172 7261 797d 290a 2020 2020 2020  : array}).      
-00047140: 2020 3e3e 3e20 6473 2e6d 6170 5f62 6c6f    >>> ds.map_blo
-00047150: 636b 7328 6361 6c63 756c 6174 655f 616e  cks(calculate_an
-00047160: 6f6d 616c 792c 2074 656d 706c 6174 653d  omaly, template=
-00047170: 6473 292e 636f 6d70 7574 6528 290a 2020  ds).compute().  
-00047180: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-00047190: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-000471a0: 696d 656e 7369 6f6e 733a 2020 2874 696d  imensions:  (tim
-000471b0: 653a 2032 3429 0a20 2020 2020 2020 2043  e: 24).        C
-000471c0: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-000471d0: 2020 2020 2020 2a20 7469 6d65 2020 2020        * time    
-000471e0: 2028 7469 6d65 2920 6f62 6a65 6374 2031   (time) object 1
-000471f0: 3939 302d 3031 2d33 3120 3030 3a30 303a  990-01-31 00:00:
-00047200: 3030 202e 2e2e 2031 3939 312d 3132 2d33  00 ... 1991-12-3
-00047210: 3120 3030 3a30 303a 3030 0a20 2020 2020  1 00:00:00.     
-00047220: 2020 2020 2020 206d 6f6e 7468 2020 2020         month    
-00047230: 2874 696d 6529 2069 6e74 3634 2031 2032  (time) int64 1 2
-00047240: 2033 2034 2035 2036 2037 2038 2039 2031   3 4 5 6 7 8 9 1
-00047250: 3020 3131 2031 3220 3120 3220 3320 3420  0 11 12 1 2 3 4 
-00047260: 3520 3620 3720 3820 3920 3130 2031 3120  5 6 7 8 9 10 11 
-00047270: 3132 0a20 2020 2020 2020 2044 6174 6120  12.        Data 
-00047280: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-00047290: 2020 2020 2020 2061 2020 2020 2020 2020         a        
-000472a0: 2874 696d 6529 2066 6c6f 6174 3634 2030  (time) float64 0
-000472b0: 2e31 3238 3920 302e 3131 3332 202d 302e  .1289 0.1132 -0.
-000472c0: 3038 3536 202e 2e2e 2030 2e32 3238 3720  0856 ... 0.2287 
-000472d0: 302e 3139 3036 202d 302e 3035 3930 310a  0.1906 -0.05901.
-000472e0: 0a20 2020 2020 2020 204e 6f74 6520 7468  .        Note th
-000472f0: 6174 206f 6e65 206d 7573 7420 6578 706c  at one must expl
-00047300: 6963 6974 6c79 2075 7365 2060 6061 7267  icitly use ``arg
-00047310: 733d 5b5d 6060 2061 6e64 2060 606b 7761  s=[]`` and ``kwa
-00047320: 7267 733d 7b7d 6060 2074 6f20 7061 7373  rgs={}`` to pass
-00047330: 2061 7267 756d 656e 7473 0a20 2020 2020   arguments.     
-00047340: 2020 2074 6f20 7468 6520 6675 6e63 7469     to the functi
-00047350: 6f6e 2062 6569 6e67 2061 7070 6c69 6564  on being applied
-00047360: 2069 6e20 6060 7872 2e6d 6170 5f62 6c6f   in ``xr.map_blo
-00047370: 636b 7328 2960 603a 0a0a 2020 2020 2020  cks()``:..      
-00047380: 2020 3e3e 3e20 6473 2e6d 6170 5f62 6c6f    >>> ds.map_blo
-00047390: 636b 7328 0a20 2020 2020 2020 202e 2e2e  cks(.        ...
-000473a0: 2020 2020 2063 616c 6375 6c61 7465 5f61       calculate_a
-000473b0: 6e6f 6d61 6c79 2c0a 2020 2020 2020 2020  nomaly,.        
-000473c0: 2e2e 2e20 2020 2020 6b77 6172 6773 3d7b  ...     kwargs={
-000473d0: 2267 726f 7570 6279 5f74 7970 6522 3a20  "groupby_type": 
-000473e0: 2274 696d 652e 7965 6172 227d 2c0a 2020  "time.year"},.  
-000473f0: 2020 2020 2020 2e2e 2e20 2020 2020 7465        ...     te
-00047400: 6d70 6c61 7465 3d64 732c 0a20 2020 2020  mplate=ds,.     
-00047410: 2020 202e 2e2e 2029 0a20 2020 2020 2020     ... ).       
-00047420: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
-00047430: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
-00047440: 696f 6e73 3a20 2028 7469 6d65 3a20 3234  ions:  (time: 24
-00047450: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
-00047460: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
-00047470: 202a 2074 696d 6520 2020 2020 2874 696d   * time     (tim
-00047480: 6529 206f 626a 6563 7420 3139 3930 2d30  e) object 1990-0
-00047490: 312d 3331 2030 303a 3030 3a30 3020 2e2e  1-31 00:00:00 ..
-000474a0: 2e20 3139 3931 2d31 322d 3331 2030 303a  . 1991-12-31 00:
-000474b0: 3030 3a30 300a 2020 2020 2020 2020 2020  00:00.          
-000474c0: 2020 6d6f 6e74 6820 2020 2028 7469 6d65    month    (time
-000474d0: 2920 696e 7436 3420 6461 736b 2e61 7272  ) int64 dask.arr
-000474e0: 6179 3c63 6875 6e6b 7369 7a65 3d28 3234  ay<chunksize=(24
-000474f0: 2c29 2c20 6d65 7461 3d6e 702e 6e64 6172  ,), meta=np.ndar
-00047500: 7261 793e 0a20 2020 2020 2020 2044 6174  ray>.        Dat
-00047510: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-00047520: 2020 2020 2020 2020 2061 2020 2020 2020           a      
-00047530: 2020 2874 696d 6529 2066 6c6f 6174 3634    (time) float64
-00047540: 2064 6173 6b2e 6172 7261 793c 6368 756e   dask.array<chun
-00047550: 6b73 697a 653d 2832 342c 292c 206d 6574  ksize=(24,), met
-00047560: 613d 6e70 2e6e 6461 7272 6179 3e0a 2020  a=np.ndarray>.  
-00047570: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00047580: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
-00047590: 7265 2e70 6172 616c 6c65 6c20 696d 706f  re.parallel impo
-000475a0: 7274 206d 6170 5f62 6c6f 636b 730a 0a20  rt map_blocks.. 
-000475b0: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
-000475c0: 705f 626c 6f63 6b73 2866 756e 632c 2073  p_blocks(func, s
-000475d0: 656c 662c 2061 7267 732c 206b 7761 7267  elf, args, kwarg
-000475e0: 732c 2074 656d 706c 6174 6529 0a0a 2020  s, template)..  
-000475f0: 2020 6465 6620 706f 6c79 6669 7428 0a20    def polyfit(. 
-00047600: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
-00047610: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
-00047620: 6469 6d3a 2048 6173 6861 626c 652c 0a20  dim: Hashable,. 
-00047630: 2020 2020 2020 2064 6567 3a20 696e 742c         deg: int,
-00047640: 0a20 2020 2020 2020 2073 6b69 706e 613a  .        skipna:
-00047650: 2062 6f6f 6c20 7c20 4e6f 6e65 203d 204e   bool | None = N
-00047660: 6f6e 652c 0a20 2020 2020 2020 2072 636f  one,.        rco
-00047670: 6e64 3a20 666c 6f61 7420 7c20 4e6f 6e65  nd: float | None
-00047680: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00047690: 2077 3a20 4861 7368 6162 6c65 207c 2041   w: Hashable | A
-000476a0: 6e79 203d 204e 6f6e 652c 0a20 2020 2020  ny = None,.     
-000476b0: 2020 2066 756c 6c3a 2062 6f6f 6c20 3d20     full: bool = 
-000476c0: 4661 6c73 652c 0a20 2020 2020 2020 2063  False,.        c
-000476d0: 6f76 3a20 626f 6f6c 207c 204c 6974 6572  ov: bool | Liter
-000476e0: 616c 5b22 756e 7363 616c 6564 225d 203d  al["unscaled"] =
-000476f0: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
-00047700: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00047710: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00047720: 4c65 6173 7420 7371 7561 7265 7320 706f  Least squares po
-00047730: 6c79 6e6f 6d69 616c 2066 6974 2e0a 0a20  lynomial fit... 
-00047740: 2020 2020 2020 2054 6869 7320 7265 706c         This repl
-00047750: 6963 6174 6573 2074 6865 2062 6568 6176  icates the behav
-00047760: 696f 7572 206f 6620 606e 756d 7079 2e70  iour of `numpy.p
-00047770: 6f6c 7966 6974 6020 6275 7420 6469 6666  olyfit` but diff
-00047780: 6572 7320 6279 2073 6b69 7070 696e 670a  ers by skipping.
-00047790: 2020 2020 2020 2020 696e 7661 6c69 6420          invalid 
-000477a0: 7661 6c75 6573 2077 6865 6e20 6073 6b69  values when `ski
-000477b0: 706e 6120 3d20 5472 7565 602e 0a0a 2020  pna = True`...  
-000477c0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-000477d0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000477e0: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
-000477f0: 3a20 6861 7368 6162 6c65 0a20 2020 2020  : hashable.     
-00047800: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-00047810: 6520 616c 6f6e 6720 7768 6963 6820 746f  e along which to
-00047820: 2066 6974 2074 6865 2070 6f6c 796e 6f6d   fit the polynom
-00047830: 6961 6c73 2e0a 2020 2020 2020 2020 6465  ials..        de
-00047840: 6720 3a20 696e 740a 2020 2020 2020 2020  g : int.        
-00047850: 2020 2020 4465 6772 6565 206f 6620 7468      Degree of th
-00047860: 6520 6669 7474 696e 6720 706f 6c79 6e6f  e fitting polyno
-00047870: 6d69 616c 2e0a 2020 2020 2020 2020 736b  mial..        sk
-00047880: 6970 6e61 203a 2062 6f6f 6c20 6f72 204e  ipna : bool or N
-00047890: 6f6e 652c 206f 7074 696f 6e61 6c0a 2020  one, optional.  
-000478a0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-000478b0: 652c 2072 656d 6f76 6573 2061 6c6c 2069  e, removes all i
-000478c0: 6e76 616c 6964 2076 616c 7565 7320 6265  nvalid values be
-000478d0: 666f 7265 2066 6974 7469 6e67 2065 6163  fore fitting eac
-000478e0: 6820 3144 2073 6c69 6365 7320 6f66 2074  h 1D slices of t
-000478f0: 6865 2061 7272 6179 2e0a 2020 2020 2020  he array..      
-00047900: 2020 2020 2020 4465 6661 756c 7420 6973        Default is
-00047910: 2054 7275 6520 6966 2064 6174 6120 6973   True if data is
-00047920: 2073 746f 7265 6420 696e 2061 2064 6173   stored in a das
-00047930: 6b2e 6172 7261 7920 6f72 2069 6620 7468  k.array or if th
-00047940: 6572 6520 6973 2061 6e79 0a20 2020 2020  ere is any.     
-00047950: 2020 2020 2020 2069 6e76 616c 6964 2076         invalid v
-00047960: 616c 7565 732c 2046 616c 7365 206f 7468  alues, False oth
-00047970: 6572 7769 7365 2e0a 2020 2020 2020 2020  erwise..        
-00047980: 7263 6f6e 6420 3a20 666c 6f61 7420 6f72  rcond : float or
-00047990: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
-000479a0: 2020 2020 2020 2020 2020 2020 5265 6c61              Rela
-000479b0: 7469 7665 2063 6f6e 6469 7469 6f6e 206e  tive condition n
-000479c0: 756d 6265 7220 746f 2074 6865 2066 6974  umber to the fit
-000479d0: 2e0a 2020 2020 2020 2020 7720 3a20 6861  ..        w : ha
-000479e0: 7368 6162 6c65 206f 7220 416e 792c 206f  shable or Any, o
-000479f0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00047a00: 2020 2020 5765 6967 6874 7320 746f 2061      Weights to a
-00047a10: 7070 6c79 2074 6f20 7468 6520 792d 636f  pply to the y-co
-00047a20: 6f72 6469 6e61 7465 206f 6620 7468 6520  ordinate of the 
-00047a30: 7361 6d70 6c65 2070 6f69 6e74 732e 0a20  sample points.. 
-00047a40: 2020 2020 2020 2020 2020 2043 616e 2062             Can b
-00047a50: 6520 616e 2061 7272 6179 2d6c 696b 6520  e an array-like 
-00047a60: 6f62 6a65 6374 206f 7220 7468 6520 6e61  object or the na
-00047a70: 6d65 206f 6620 6120 636f 6f72 6469 6e61  me of a coordina
-00047a80: 7465 2069 6e20 7468 6520 6461 7461 7365  te in the datase
-00047a90: 742e 0a20 2020 2020 2020 2066 756c 6c20  t..        full 
-00047aa0: 3a20 626f 6f6c 2c20 6465 6661 756c 743a  : bool, default:
-00047ab0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00047ac0: 2020 2057 6865 7468 6572 2074 6f20 7265     Whether to re
-00047ad0: 7475 726e 2074 6865 2072 6573 6964 7561  turn the residua
-00047ae0: 6c73 2c20 6d61 7472 6978 2072 616e 6b20  ls, matrix rank 
-00047af0: 616e 6420 7369 6e67 756c 6172 2076 616c  and singular val
-00047b00: 7565 7320 696e 2061 6464 6974 696f 6e0a  ues in addition.
-00047b10: 2020 2020 2020 2020 2020 2020 746f 2074              to t
-00047b20: 6865 2063 6f65 6666 6963 6965 6e74 732e  he coefficients.
-00047b30: 0a20 2020 2020 2020 2063 6f76 203a 2062  .        cov : b
-00047b40: 6f6f 6c20 6f72 2022 756e 7363 616c 6564  ool or "unscaled
-00047b50: 222c 2064 6566 6175 6c74 3a20 4661 6c73  ", default: Fals
-00047b60: 650a 2020 2020 2020 2020 2020 2020 5768  e.            Wh
-00047b70: 6574 6865 7220 746f 2072 6574 7572 6e20  ether to return 
-00047b80: 746f 2074 6865 2063 6f76 6172 6961 6e63  to the covarianc
-00047b90: 6520 6d61 7472 6978 2069 6e20 6164 6469  e matrix in addi
-00047ba0: 7469 6f6e 2074 6f20 7468 6520 636f 6566  tion to the coef
-00047bb0: 6669 6369 656e 7473 2e0a 2020 2020 2020  ficients..      
-00047bc0: 2020 2020 2020 5468 6520 6d61 7472 6978        The matrix
-00047bd0: 2069 7320 6e6f 7420 7363 616c 6564 2069   is not scaled i
-00047be0: 6620 6063 6f76 3d27 756e 7363 616c 6564  f `cov='unscaled
-00047bf0: 2760 2e0a 0a20 2020 2020 2020 2052 6574  '`...        Ret
-00047c00: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00047c10: 2d2d 2d2d 0a20 2020 2020 2020 2070 6f6c  ----.        pol
-00047c20: 7966 6974 5f72 6573 756c 7473 203a 2044  yfit_results : D
-00047c30: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
-00047c40: 2020 2041 2073 696e 676c 6520 6461 7461     A single data
-00047c50: 7365 7420 7768 6963 6820 636f 6e74 6169  set which contai
-00047c60: 6e73 2028 666f 7220 6561 6368 2022 7661  ns (for each "va
-00047c70: 7222 2069 6e20 7468 6520 696e 7075 7420  r" in the input 
-00047c80: 6461 7461 7365 7429 3a0a 0a20 2020 2020  dataset):..     
-00047c90: 2020 2020 2020 205b 7661 725d 5f70 6f6c         [var]_pol
-00047ca0: 7966 6974 5f63 6f65 6666 6963 6965 6e74  yfit_coefficient
-00047cb0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00047cc0: 2020 5468 6520 636f 6566 6669 6369 656e    The coefficien
-00047cd0: 7473 206f 6620 7468 6520 6265 7374 2066  ts of the best f
-00047ce0: 6974 2066 6f72 2065 6163 6820 7661 7269  it for each vari
-00047cf0: 6162 6c65 2069 6e20 7468 6973 2064 6174  able in this dat
-00047d00: 6173 6574 2e0a 2020 2020 2020 2020 2020  aset..          
-00047d10: 2020 5b76 6172 5d5f 706f 6c79 6669 745f    [var]_polyfit_
-00047d20: 7265 7369 6475 616c 730a 2020 2020 2020  residuals.      
-00047d30: 2020 2020 2020 2020 2020 5468 6520 7265            The re
-00047d40: 7369 6475 616c 7320 6f66 2074 6865 206c  siduals of the l
-00047d50: 6561 7374 2d73 7175 6172 6520 636f 6d70  east-square comp
-00047d60: 7574 6174 696f 6e20 666f 7220 6561 6368  utation for each
-00047d70: 2076 6172 6961 626c 6520 286f 6e6c 7920   variable (only 
-00047d80: 696e 636c 7564 6564 2069 6620 6066 756c  included if `ful
-00047d90: 6c3d 5472 7565 6029 0a20 2020 2020 2020  l=True`).       
-00047da0: 2020 2020 2020 2020 2057 6865 6e20 7468           When th
-00047db0: 6520 6d61 7472 6978 2072 616e 6b20 6973  e matrix rank is
-00047dc0: 2064 6566 6963 6965 6e74 2c20 6e70 2e6e   deficient, np.n
-00047dd0: 616e 2069 7320 7265 7475 726e 6564 2e0a  an is returned..
-00047de0: 2020 2020 2020 2020 2020 2020 5b64 696d              [dim
-00047df0: 5d5f 6d61 7472 6978 5f72 616e 6b0a 2020  ]_matrix_rank.  
-00047e00: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-00047e10: 6520 6566 6665 6374 6976 6520 7261 6e6b  e effective rank
-00047e20: 206f 6620 7468 6520 7363 616c 6564 2056   of the scaled V
-00047e30: 616e 6465 726d 6f6e 6465 2063 6f65 6666  andermonde coeff
-00047e40: 6963 6965 6e74 206d 6174 7269 7820 286f  icient matrix (o
-00047e50: 6e6c 7920 696e 636c 7564 6564 2069 6620  nly included if 
-00047e60: 6066 756c 6c3d 5472 7565 6029 0a20 2020  `full=True`).   
-00047e70: 2020 2020 2020 2020 2020 2020 2054 6865               The
-00047e80: 2072 616e 6b20 6973 2063 6f6d 7075 7465   rank is compute
-00047e90: 6420 6967 6e6f 7269 6e67 2074 6865 204e  d ignoring the N
-00047ea0: 614e 2076 616c 7565 7320 7468 6174 206d  aN values that m
-00047eb0: 6967 6874 2062 6520 736b 6970 7065 642e  ight be skipped.
-00047ec0: 0a20 2020 2020 2020 2020 2020 205b 6469  .            [di
-00047ed0: 6d5d 5f73 696e 6775 6c61 725f 7661 6c75  m]_singular_valu
-00047ee0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00047ef0: 2020 2054 6865 2073 696e 6775 6c61 7220     The singular 
-00047f00: 7661 6c75 6573 206f 6620 7468 6520 7363  values of the sc
-00047f10: 616c 6564 2056 616e 6465 726d 6f6e 6465  aled Vandermonde
-00047f20: 2063 6f65 6666 6963 6965 6e74 206d 6174   coefficient mat
-00047f30: 7269 7820 286f 6e6c 7920 696e 636c 7564  rix (only includ
-00047f40: 6564 2069 6620 6066 756c 6c3d 5472 7565  ed if `full=True
-00047f50: 6029 0a20 2020 2020 2020 2020 2020 205b  `).            [
-00047f60: 7661 725d 5f70 6f6c 7966 6974 5f63 6f76  var]_polyfit_cov
-00047f70: 6172 6961 6e63 650a 2020 2020 2020 2020  ariance.        
-00047f80: 2020 2020 2020 2020 5468 6520 636f 7661          The cova
-00047f90: 7269 616e 6365 206d 6174 7269 7820 6f66  riance matrix of
-00047fa0: 2074 6865 2070 6f6c 796e 6f6d 6961 6c20   the polynomial 
-00047fb0: 636f 6566 6669 6369 656e 7420 6573 7469  coefficient esti
-00047fc0: 6d61 7465 7320 286f 6e6c 7920 696e 636c  mates (only incl
-00047fd0: 7564 6564 2069 6620 6066 756c 6c3d 4661  uded if `full=Fa
-00047fe0: 6c73 6560 2061 6e64 2060 636f 763d 5472  lse` and `cov=Tr
-00047ff0: 7565 6029 0a0a 2020 2020 2020 2020 5761  ue`)..        Wa
-00048000: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00048010: 2d0a 2020 2020 2020 2020 5261 6e6b 5761  -.        RankWa
-00048020: 726e 696e 670a 2020 2020 2020 2020 2020  rning.          
-00048030: 2020 5468 6520 7261 6e6b 206f 6620 7468    The rank of th
-00048040: 6520 636f 6566 6669 6369 656e 7420 6d61  e coefficient ma
-00048050: 7472 6978 2069 6e20 7468 6520 6c65 6173  trix in the leas
-00048060: 742d 7371 7561 7265 7320 6669 7420 6973  t-squares fit is
-00048070: 2064 6566 6963 6965 6e74 2e0a 2020 2020   deficient..    
-00048080: 2020 2020 2020 2020 5468 6520 7761 726e          The warn
-00048090: 696e 6720 6973 206e 6f74 2072 6169 7365  ing is not raise
-000480a0: 6420 7769 7468 2069 6e2d 6d65 6d6f 7279  d with in-memory
-000480b0: 2028 6e6f 7420 6461 736b 2920 6461 7461   (not dask) data
-000480c0: 2061 6e64 2060 6675 6c6c 3d54 7275 6560   and `full=True`
-000480d0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-000480e0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-000480f0: 2d2d 2d2d 0a20 2020 2020 2020 206e 756d  ----.        num
-00048100: 7079 2e70 6f6c 7966 6974 0a20 2020 2020  py.polyfit.     
-00048110: 2020 206e 756d 7079 2e70 6f6c 7976 616c     numpy.polyval
-00048120: 0a20 2020 2020 2020 2078 6172 7261 792e  .        xarray.
-00048130: 706f 6c79 7661 6c0a 2020 2020 2020 2020  polyval.        
-00048140: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-00048150: 2078 6172 7261 792e 636f 7265 2e64 6174   xarray.core.dat
-00048160: 6161 7272 6179 2069 6d70 6f72 7420 4461  aarray import Da
-00048170: 7461 4172 7261 790a 0a20 2020 2020 2020  taArray..       
-00048180: 2076 6172 6961 626c 6573 203d 207b 7d0a   variables = {}.
-00048190: 2020 2020 2020 2020 736b 6970 6e61 5f64          skipna_d
-000481a0: 6120 3d20 736b 6970 6e61 0a0a 2020 2020  a = skipna..    
-000481b0: 2020 2020 7820 3d20 6765 745f 636c 6561      x = get_clea
-000481c0: 6e5f 696e 7465 7270 5f69 6e64 6578 2873  n_interp_index(s
-000481d0: 656c 662c 2064 696d 2c20 7374 7269 6374  elf, dim, strict
-000481e0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-000481f0: 786e 616d 6520 3d20 6622 7b73 656c 665b  xname = f"{self[
-00048200: 6469 6d5d 2e6e 616d 657d 5f22 0a20 2020  dim].name}_".   
-00048210: 2020 2020 206f 7264 6572 203d 2069 6e74       order = int
-00048220: 2864 6567 2920 2b20 310a 2020 2020 2020  (deg) + 1.      
-00048230: 2020 6c68 7320 3d20 6e70 2e76 616e 6465    lhs = np.vande
-00048240: 7228 782c 206f 7264 6572 290a 0a20 2020  r(x, order)..   
-00048250: 2020 2020 2069 6620 7263 6f6e 6420 6973       if rcond is
-00048260: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00048270: 2020 2072 636f 6e64 203d 2028 0a20 2020     rcond = (.   
-00048280: 2020 2020 2020 2020 2020 2020 2078 2e73               x.s
-00048290: 6861 7065 5b30 5d20 2a20 6e70 2e63 6f72  hape[0] * np.cor
-000482a0: 652e 6669 6e66 6f28 782e 6474 7970 6529  e.finfo(x.dtype)
-000482b0: 2e65 7073 2020 2320 7479 7065 3a20 6967  .eps  # type: ig
-000482c0: 6e6f 7265 5b61 7474 722d 6465 6669 6e65  nore[attr-define
-000482d0: 645d 0a20 2020 2020 2020 2020 2020 2029  d].            )
-000482e0: 0a0a 2020 2020 2020 2020 2320 5765 6967  ..        # Weig
-000482f0: 6874 733a 0a20 2020 2020 2020 2069 6620  hts:.        if 
-00048300: 7720 6973 206e 6f74 204e 6f6e 653a 0a20  w is not None:. 
-00048310: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00048320: 696e 7374 616e 6365 2877 2c20 4861 7368  instance(w, Hash
-00048330: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
-00048340: 2020 2020 2020 2077 203d 2073 656c 662e         w = self.
-00048350: 636f 6f72 6473 5b77 5d0a 2020 2020 2020  coords[w].      
-00048360: 2020 2020 2020 7720 3d20 6e70 2e61 7361        w = np.asa
-00048370: 7272 6179 2877 290a 2020 2020 2020 2020  rray(w).        
-00048380: 2020 2020 6966 2077 2e6e 6469 6d20 213d      if w.ndim !=
-00048390: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-000483a0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-000483b0: 726f 7228 2245 7870 6563 7465 6420 6120  ror("Expected a 
-000483c0: 312d 6420 6172 7261 7920 666f 7220 7765  1-d array for we
-000483d0: 6967 6874 732e 2229 0a20 2020 2020 2020  ights.").       
-000483e0: 2020 2020 2069 6620 772e 7368 6170 655b       if w.shape[
-000483f0: 305d 2021 3d20 6c68 732e 7368 6170 655b  0] != lhs.shape[
-00048400: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
-00048410: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-00048420: 726f 7228 6622 4578 7065 6374 6564 2077  ror(f"Expected w
-00048430: 2061 6e64 207b 6469 6d7d 2074 6f20 6861   and {dim} to ha
-00048440: 7665 2074 6865 2073 616d 6520 6c65 6e67  ve the same leng
-00048450: 7468 2229 0a20 2020 2020 2020 2020 2020  th").           
-00048460: 206c 6873 202a 3d20 775b 3a2c 206e 702e   lhs *= w[:, np.
-00048470: 6e65 7761 7869 735d 0a0a 2020 2020 2020  newaxis]..      
-00048480: 2020 2320 5363 616c 696e 670a 2020 2020    # Scaling.    
-00048490: 2020 2020 7363 616c 6520 3d20 6e70 2e73      scale = np.s
-000484a0: 7172 7428 286c 6873 202a 206c 6873 292e  qrt((lhs * lhs).
-000484b0: 7375 6d28 6178 6973 3d30 2929 0a20 2020  sum(axis=0)).   
-000484c0: 2020 2020 206c 6873 202f 3d20 7363 616c       lhs /= scal
-000484d0: 650a 0a20 2020 2020 2020 2064 6567 7265  e..        degre
-000484e0: 655f 6469 6d20 3d20 7574 696c 732e 6765  e_dim = utils.ge
-000484f0: 745f 7465 6d70 5f64 696d 6e61 6d65 2873  t_temp_dimname(s
-00048500: 656c 662e 6469 6d73 2c20 2264 6567 7265  elf.dims, "degre
-00048510: 6522 290a 0a20 2020 2020 2020 2072 616e  e")..        ran
-00048520: 6b20 3d20 6e70 2e6c 696e 616c 672e 6d61  k = np.linalg.ma
-00048530: 7472 6978 5f72 616e 6b28 6c68 7329 0a0a  trix_rank(lhs)..
-00048540: 2020 2020 2020 2020 6966 2066 756c 6c3a          if full:
-00048550: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
-00048560: 6b20 3d20 4461 7461 4172 7261 7928 7261  k = DataArray(ra
-00048570: 6e6b 2c20 6e61 6d65 3d78 6e61 6d65 202b  nk, name=xname +
-00048580: 2022 6d61 7472 6978 5f72 616e 6b22 290a   "matrix_rank").
-00048590: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-000485a0: 6162 6c65 735b 7261 6e6b 2e6e 616d 655d  ables[rank.name]
-000485b0: 203d 2072 616e 6b0a 2020 2020 2020 2020   = rank.        
-000485c0: 2020 2020 5f73 696e 6720 3d20 6e70 2e6c      _sing = np.l
-000485d0: 696e 616c 672e 7376 6428 6c68 732c 2063  inalg.svd(lhs, c
-000485e0: 6f6d 7075 7465 5f75 763d 4661 6c73 6529  ompute_uv=False)
-000485f0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-00048600: 6720 3d20 4461 7461 4172 7261 7928 0a20  g = DataArray(. 
-00048610: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00048620: 7369 6e67 2c0a 2020 2020 2020 2020 2020  sing,.          
-00048630: 2020 2020 2020 6469 6d73 3d28 6465 6772        dims=(degr
-00048640: 6565 5f64 696d 2c29 2c0a 2020 2020 2020  ee_dim,),.      
-00048650: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
-00048660: 3d7b 6465 6772 6565 5f64 696d 3a20 6e70  ={degree_dim: np
-00048670: 2e61 7261 6e67 6528 7261 6e6b 202d 2031  .arange(rank - 1
-00048680: 2c20 2d31 2c20 2d31 297d 2c0a 2020 2020  , -1, -1)},.    
-00048690: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-000486a0: 3d78 6e61 6d65 202b 2022 7369 6e67 756c  =xname + "singul
-000486b0: 6172 5f76 616c 7565 7322 2c0a 2020 2020  ar_values",.    
-000486c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000486d0: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
-000486e0: 7369 6e67 2e6e 616d 655d 203d 2073 696e  sing.name] = sin
-000486f0: 670a 0a20 2020 2020 2020 2066 6f72 206e  g..        for n
-00048700: 616d 652c 2064 6120 696e 2073 656c 662e  ame, da in self.
-00048710: 6461 7461 5f76 6172 732e 6974 656d 7328  data_vars.items(
-00048720: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00048730: 6620 6469 6d20 6e6f 7420 696e 2064 612e  f dim not in da.
-00048740: 6469 6d73 3a0a 2020 2020 2020 2020 2020  dims:.          
-00048750: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-00048760: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00048770: 735f 6475 636b 5f64 6173 6b5f 6172 7261  s_duck_dask_arra
-00048780: 7928 6461 2e64 6174 6129 2061 6e64 2028  y(da.data) and (
-00048790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000487a0: 2072 616e 6b20 213d 206f 7264 6572 206f   rank != order o
-000487b0: 7220 6675 6c6c 206f 7220 736b 6970 6e61  r full or skipna
-000487c0: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
-000487d0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-000487e0: 2020 2020 2020 2020 2320 4375 7272 656e          # Curren
-000487f0: 7420 616c 676f 7269 7468 6d20 7769 7468  t algorithm with
-00048800: 2064 6173 6b20 616e 6420 736b 6970 6e61   dask and skipna
-00048810: 3d46 616c 7365 206e 6569 7468 6572 2073  =False neither s
-00048820: 7570 706f 7274 730a 2020 2020 2020 2020  upports.        
-00048830: 2020 2020 2020 2020 2320 6465 6669 6369          # defici
-00048840: 656e 7420 7261 6e6b 7320 6e6f 7220 646f  ent ranks nor do
-00048850: 6573 2069 7420 6f75 7470 7574 2074 6865  es it output the
-00048860: 2022 6675 6c6c 2220 696e 666f 2028 6973   "full" info (is
-00048870: 7375 6520 6461 736b 2f64 6173 6b23 3635  sue dask/dask#65
-00048880: 3136 290a 2020 2020 2020 2020 2020 2020  16).            
-00048890: 2020 2020 736b 6970 6e61 5f64 6120 3d20      skipna_da = 
-000488a0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000488b0: 2065 6c69 6620 736b 6970 6e61 2069 7320   elif skipna is 
-000488c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000488d0: 2020 2020 2020 736b 6970 6e61 5f64 6120        skipna_da 
-000488e0: 3d20 626f 6f6c 286e 702e 616e 7928 6461  = bool(np.any(da
-000488f0: 2e69 736e 756c 6c28 2929 290a 0a20 2020  .isnull()))..   
-00048900: 2020 2020 2020 2020 2064 696d 735f 746f           dims_to
-00048910: 5f73 7461 636b 203d 205b 6469 6d6e 616d  _stack = [dimnam
-00048920: 6520 666f 7220 6469 6d6e 616d 6520 696e  e for dimname in
-00048930: 2064 612e 6469 6d73 2069 6620 6469 6d6e   da.dims if dimn
-00048940: 616d 6520 213d 2064 696d 5d0a 2020 2020  ame != dim].    
-00048950: 2020 2020 2020 2020 7374 6163 6b65 645f          stacked_
-00048960: 636f 6f72 6473 3a20 6469 6374 5b48 6173  coords: dict[Has
-00048970: 6861 626c 652c 2044 6174 6141 7272 6179  hable, DataArray
-00048980: 5d20 3d20 7b7d 0a20 2020 2020 2020 2020  ] = {}.         
-00048990: 2020 2069 6620 6469 6d73 5f74 6f5f 7374     if dims_to_st
-000489a0: 6163 6b3a 0a20 2020 2020 2020 2020 2020  ack:.           
-000489b0: 2020 2020 2073 7461 636b 6564 5f64 696d       stacked_dim
-000489c0: 203d 2075 7469 6c73 2e67 6574 5f74 656d   = utils.get_tem
-000489d0: 705f 6469 6d6e 616d 6528 6469 6d73 5f74  p_dimname(dims_t
-000489e0: 6f5f 7374 6163 6b2c 2022 7374 6163 6b65  o_stack, "stacke
-000489f0: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
-00048a00: 2020 2020 7268 7320 3d20 6461 2e74 7261      rhs = da.tra
-00048a10: 6e73 706f 7365 2864 696d 2c20 2a64 696d  nspose(dim, *dim
-00048a20: 735f 746f 5f73 7461 636b 292e 7374 6163  s_to_stack).stac
-00048a30: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
-00048a40: 2020 2020 2020 207b 7374 6163 6b65 645f         {stacked_
-00048a50: 6469 6d3a 2064 696d 735f 746f 5f73 7461  dim: dims_to_sta
-00048a60: 636b 7d0a 2020 2020 2020 2020 2020 2020  ck}.            
-00048a70: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00048a80: 2020 2020 2020 7374 6163 6b65 645f 636f        stacked_co
-00048a90: 6f72 6473 203d 207b 7374 6163 6b65 645f  ords = {stacked_
-00048aa0: 6469 6d3a 2072 6873 5b73 7461 636b 6564  dim: rhs[stacked
-00048ab0: 5f64 696d 5d7d 0a20 2020 2020 2020 2020  _dim]}.         
-00048ac0: 2020 2020 2020 2073 6361 6c65 5f64 6120         scale_da 
-00048ad0: 3d20 7363 616c 655b 3a2c 206e 702e 6e65  = scale[:, np.ne
-00048ae0: 7761 7869 735d 0a20 2020 2020 2020 2020  waxis].         
-00048af0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00048b00: 2020 2020 2020 2020 2072 6873 203d 2064           rhs = d
-00048b10: 610a 2020 2020 2020 2020 2020 2020 2020  a.              
-00048b20: 2020 7363 616c 655f 6461 203d 2073 6361    scale_da = sca
-00048b30: 6c65 0a0a 2020 2020 2020 2020 2020 2020  le..            
-00048b40: 6966 2077 2069 7320 6e6f 7420 4e6f 6e65  if w is not None
-00048b50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00048b60: 2020 7268 7320 2a3d 2077 5b3a 2c20 6e70    rhs *= w[:, np
-00048b70: 2e6e 6577 6178 6973 5d0a 0a20 2020 2020  .newaxis]..     
-00048b80: 2020 2020 2020 2077 6974 6820 7761 726e         with warn
-00048b90: 696e 6773 2e63 6174 6368 5f77 6172 6e69  ings.catch_warni
-00048ba0: 6e67 7328 293a 0a20 2020 2020 2020 2020  ngs():.         
-00048bb0: 2020 2020 2020 2069 6620 6675 6c6c 3a20         if full: 
-00048bc0: 2023 2043 6f70 7920 6e70 2e70 6f6c 7966   # Copy np.polyf
-00048bd0: 6974 2062 6568 6176 696f 720a 2020 2020  it behavior.    
-00048be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048bf0: 7761 726e 696e 6773 2e73 696d 706c 6566  warnings.simplef
-00048c00: 696c 7465 7228 2269 676e 6f72 6522 2c20  ilter("ignore", 
-00048c10: 6e70 2e52 616e 6b57 6172 6e69 6e67 290a  np.RankWarning).
-00048c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c30: 656c 7365 3a20 2023 2052 6169 7365 206f  else:  # Raise o
-00048c40: 6e6c 7920 6f6e 6365 2070 6572 2076 6172  nly once per var
-00048c50: 6961 626c 650a 2020 2020 2020 2020 2020  iable.          
-00048c60: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00048c70: 6773 2e73 696d 706c 6566 696c 7465 7228  gs.simplefilter(
-00048c80: 226f 6e63 6522 2c20 6e70 2e52 616e 6b57  "once", np.RankW
-00048c90: 6172 6e69 6e67 290a 0a20 2020 2020 2020  arning)..       
-00048ca0: 2020 2020 2020 2020 2063 6f65 6666 732c           coeffs,
-00048cb0: 2072 6573 6964 7561 6c73 203d 2064 7563   residuals = duc
-00048cc0: 6b5f 6172 7261 795f 6f70 732e 6c65 6173  k_array_ops.leas
-00048cd0: 745f 7371 7561 7265 7328 0a20 2020 2020  t_squares(.     
-00048ce0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00048cf0: 6873 2c20 7268 732e 6461 7461 2c20 7263  hs, rhs.data, rc
-00048d00: 6f6e 643d 7263 6f6e 642c 2073 6b69 706e  ond=rcond, skipn
-00048d10: 613d 736b 6970 6e61 5f64 610a 2020 2020  a=skipna_da.    
-00048d20: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00048d30: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00048d40: 696e 7374 616e 6365 286e 616d 652c 2073  instance(name, s
-00048d50: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-00048d60: 2020 2020 206e 616d 6520 3d20 6622 7b6e       name = f"{n
-00048d70: 616d 657d 5f22 0a20 2020 2020 2020 2020  ame}_".         
-00048d80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00048d90: 2020 2020 2020 2020 2023 2054 6875 7320           # Thus 
-00048da0: 6120 5265 7072 4f62 6a65 6374 203d 3e20  a ReprObject => 
-00048db0: 706f 6c79 6669 7420 7761 7320 6361 6c6c  polyfit was call
-00048dc0: 6564 206f 6e20 6120 4461 7461 4172 7261  ed on a DataArra
-00048dd0: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-00048de0: 2020 6e61 6d65 203d 2022 220a 0a20 2020    name = ""..   
-00048df0: 2020 2020 2020 2020 2063 6f65 6666 7320           coeffs 
-00048e00: 3d20 4461 7461 4172 7261 7928 0a20 2020  = DataArray(.   
-00048e10: 2020 2020 2020 2020 2020 2020 2063 6f65               coe
-00048e20: 6666 7320 2f20 7363 616c 655f 6461 2c0a  ffs / scale_da,.
-00048e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e40: 6469 6d73 3d5b 6465 6772 6565 5f64 696d  dims=[degree_dim
-00048e50: 5d20 2b20 6c69 7374 2873 7461 636b 6564  ] + list(stacked
-00048e60: 5f63 6f6f 7264 732e 6b65 7973 2829 292c  _coords.keys()),
-00048e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048e80: 2063 6f6f 7264 733d 7b64 6567 7265 655f   coords={degree_
-00048e90: 6469 6d3a 206e 702e 6172 616e 6765 286f  dim: np.arange(o
-00048ea0: 7264 6572 295b 3a3a 2d31 5d2c 202a 2a73  rder)[::-1], **s
-00048eb0: 7461 636b 6564 5f63 6f6f 7264 737d 2c0a  tacked_coords},.
-00048ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ed0: 6e61 6d65 3d6e 616d 6520 2b20 2270 6f6c  name=name + "pol
-00048ee0: 7966 6974 5f63 6f65 6666 6963 6965 6e74  yfit_coefficient
-00048ef0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
-00048f00: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00048f10: 2064 696d 735f 746f 5f73 7461 636b 3a0a   dims_to_stack:.
-00048f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048f30: 636f 6566 6673 203d 2063 6f65 6666 732e  coeffs = coeffs.
-00048f40: 756e 7374 6163 6b28 7374 6163 6b65 645f  unstack(stacked_
-00048f50: 6469 6d29 0a20 2020 2020 2020 2020 2020  dim).           
-00048f60: 2076 6172 6961 626c 6573 5b63 6f65 6666   variables[coeff
-00048f70: 732e 6e61 6d65 5d20 3d20 636f 6566 6673  s.name] = coeffs
-00048f80: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00048f90: 2066 756c 6c20 6f72 2028 636f 7620 6973   full or (cov is
-00048fa0: 2054 7275 6529 3a0a 2020 2020 2020 2020   True):.        
-00048fb0: 2020 2020 2020 2020 7265 7369 6475 616c          residual
-00048fc0: 7320 3d20 4461 7461 4172 7261 7928 0a20  s = DataArray(. 
-00048fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048fe0: 2020 2072 6573 6964 7561 6c73 2069 6620     residuals if 
-00048ff0: 6469 6d73 5f74 6f5f 7374 6163 6b20 656c  dims_to_stack el
-00049000: 7365 2072 6573 6964 7561 6c73 2e73 7175  se residuals.squ
-00049010: 6565 7a65 2829 2c0a 2020 2020 2020 2020  eeze(),.        
-00049020: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
-00049030: 3d6c 6973 7428 7374 6163 6b65 645f 636f  =list(stacked_co
-00049040: 6f72 6473 2e6b 6579 7328 2929 2c0a 2020  ords.keys()),.  
-00049050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049060: 2020 636f 6f72 6473 3d73 7461 636b 6564    coords=stacked
-00049070: 5f63 6f6f 7264 732c 0a20 2020 2020 2020  _coords,.       
-00049080: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00049090: 653d 6e61 6d65 202b 2022 706f 6c79 6669  e=name + "polyfi
-000490a0: 745f 7265 7369 6475 616c 7322 2c0a 2020  t_residuals",.  
-000490b0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-000490c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000490d0: 6966 2064 696d 735f 746f 5f73 7461 636b  if dims_to_stack
-000490e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000490f0: 2020 2020 2020 7265 7369 6475 616c 7320        residuals 
-00049100: 3d20 7265 7369 6475 616c 732e 756e 7374  = residuals.unst
-00049110: 6163 6b28 7374 6163 6b65 645f 6469 6d29  ack(stacked_dim)
-00049120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049130: 2076 6172 6961 626c 6573 5b72 6573 6964   variables[resid
-00049140: 7561 6c73 2e6e 616d 655d 203d 2072 6573  uals.name] = res
-00049150: 6964 7561 6c73 0a0a 2020 2020 2020 2020  iduals..        
-00049160: 2020 2020 6966 2063 6f76 3a0a 2020 2020      if cov:.    
-00049170: 2020 2020 2020 2020 2020 2020 5662 6173              Vbas
-00049180: 6520 3d20 6e70 2e6c 696e 616c 672e 696e  e = np.linalg.in
-00049190: 7628 6e70 2e64 6f74 286c 6873 2e54 2c20  v(np.dot(lhs.T, 
-000491a0: 6c68 7329 290a 2020 2020 2020 2020 2020  lhs)).          
-000491b0: 2020 2020 2020 5662 6173 6520 2f3d 206e        Vbase /= n
-000491c0: 702e 6f75 7465 7228 7363 616c 652c 2073  p.outer(scale, s
-000491d0: 6361 6c65 290a 2020 2020 2020 2020 2020  cale).          
-000491e0: 2020 2020 2020 6966 2063 6f76 203d 3d20        if cov == 
-000491f0: 2275 6e73 6361 6c65 6422 3a0a 2020 2020  "unscaled":.    
-00049200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049210: 6661 6320 3d20 310a 2020 2020 2020 2020  fac = 1.        
-00049220: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00049230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049240: 2020 6966 2078 2e73 6861 7065 5b30 5d20    if x.shape[0] 
-00049250: 3c3d 206f 7264 6572 3a0a 2020 2020 2020  <= order:.      
-00049260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049270: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00049280: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00049290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000492a0: 2254 6865 206e 756d 6265 7220 6f66 2064  "The number of d
-000492b0: 6174 6120 706f 696e 7473 206d 7573 7420  ata points must 
-000492c0: 6578 6365 6564 206f 7264 6572 2074 6f20  exceed order to 
-000492d0: 7363 616c 6520 7468 6520 636f 7661 7269  scale the covari
-000492e0: 616e 6365 206d 6174 7269 782e 220a 2020  ance matrix.".  
-000492f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049300: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00049310: 2020 2020 2020 2020 2020 2020 6661 6320              fac 
-00049320: 3d20 7265 7369 6475 616c 7320 2f20 2878  = residuals / (x
-00049330: 2e73 6861 7065 5b30 5d20 2d20 6f72 6465  .shape[0] - orde
-00049340: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-00049350: 2020 2063 6f76 6172 6961 6e63 6520 3d20     covariance = 
-00049360: 4461 7461 4172 7261 7928 5662 6173 652c  DataArray(Vbase,
-00049370: 2064 696d 733d 2822 636f 765f 6922 2c20   dims=("cov_i", 
-00049380: 2263 6f76 5f6a 2229 2920 2a20 6661 630a  "cov_j")) * fac.
-00049390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000493a0: 7661 7269 6162 6c65 735b 6e61 6d65 202b  variables[name +
-000493b0: 2022 706f 6c79 6669 745f 636f 7661 7269   "polyfit_covari
-000493c0: 616e 6365 225d 203d 2063 6f76 6172 6961  ance"] = covaria
-000493d0: 6e63 650a 0a20 2020 2020 2020 2072 6574  nce..        ret
-000493e0: 7572 6e20 7479 7065 2873 656c 6629 2864  urn type(self)(d
-000493f0: 6174 615f 7661 7273 3d76 6172 6961 626c  ata_vars=variabl
-00049400: 6573 2c20 6174 7472 733d 7365 6c66 2e61  es, attrs=self.a
-00049410: 7474 7273 2e63 6f70 7928 2929 0a0a 2020  ttrs.copy())..  
-00049420: 2020 6465 6620 7061 6428 0a20 2020 2020    def pad(.     
-00049430: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
-00049440: 6574 2c0a 2020 2020 2020 2020 7061 645f  et,.        pad_
-00049450: 7769 6474 683a 204d 6170 7069 6e67 5b41  width: Mapping[A
-00049460: 6e79 2c20 696e 7420 7c20 7475 706c 655b  ny, int | tuple[
-00049470: 696e 742c 2069 6e74 5d5d 207c 204e 6f6e  int, int]] | Non
-00049480: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00049490: 2020 6d6f 6465 3a20 5061 644d 6f64 654f    mode: PadModeO
-000494a0: 7074 696f 6e73 203d 2022 636f 6e73 7461  ptions = "consta
-000494b0: 6e74 222c 0a20 2020 2020 2020 2073 7461  nt",.        sta
-000494c0: 745f 6c65 6e67 7468 3a20 696e 740a 2020  t_length: int.  
-000494d0: 2020 2020 2020 7c20 7475 706c 655b 696e        | tuple[in
-000494e0: 742c 2069 6e74 5d0a 2020 2020 2020 2020  t, int].        
-000494f0: 7c20 4d61 7070 696e 675b 416e 792c 2074  | Mapping[Any, t
-00049500: 7570 6c65 5b69 6e74 2c20 696e 745d 5d0a  uple[int, int]].
-00049510: 2020 2020 2020 2020 7c20 4e6f 6e65 203d          | None =
-00049520: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-00049530: 6f6e 7374 616e 745f 7661 6c75 6573 3a20  onstant_values: 
-00049540: 280a 2020 2020 2020 2020 2020 2020 666c  (.            fl
-00049550: 6f61 7420 7c20 7475 706c 655b 666c 6f61  oat | tuple[floa
-00049560: 742c 2066 6c6f 6174 5d20 7c20 4d61 7070  t, float] | Mapp
-00049570: 696e 675b 416e 792c 2074 7570 6c65 5b66  ing[Any, tuple[f
-00049580: 6c6f 6174 2c20 666c 6f61 745d 5d20 7c20  loat, float]] | 
-00049590: 4e6f 6e65 0a20 2020 2020 2020 2029 203d  None.        ) =
-000495a0: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
-000495b0: 6e64 5f76 616c 7565 733a 2069 6e74 207c  nd_values: int |
-000495c0: 2074 7570 6c65 5b69 6e74 2c20 696e 745d   tuple[int, int]
-000495d0: 207c 204d 6170 7069 6e67 5b41 6e79 2c20   | Mapping[Any, 
-000495e0: 7475 706c 655b 696e 742c 2069 6e74 5d5d  tuple[int, int]]
-000495f0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00049600: 2020 2020 2020 2020 7265 666c 6563 745f          reflect_
-00049610: 7479 7065 3a20 5061 6452 6566 6c65 6374  type: PadReflect
-00049620: 4f70 7469 6f6e 7320 3d20 4e6f 6e65 2c0a  Options = None,.
-00049630: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
-00049640: 7273 3a20 626f 6f6c 207c 204e 6f6e 6520  rs: bool | None 
-00049650: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00049660: 2a2a 7061 645f 7769 6474 685f 6b77 6172  **pad_width_kwar
-00049670: 6773 3a20 416e 792c 0a20 2020 2029 202d  gs: Any,.    ) -
-00049680: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
-00049690: 2020 2020 2022 2222 5061 6420 7468 6973       """Pad this
-000496a0: 2064 6174 6173 6574 2061 6c6f 6e67 206f   dataset along o
-000496b0: 6e65 206f 7220 6d6f 7265 2064 696d 656e  ne or more dimen
-000496c0: 7369 6f6e 732e 0a0a 2020 2020 2020 2020  sions...        
-000496d0: 2e2e 2077 6172 6e69 6e67 3a3a 0a20 2020  .. warning::.   
-000496e0: 2020 2020 2020 2020 2054 6869 7320 6675           This fu
-000496f0: 6e63 7469 6f6e 2069 7320 6578 7065 7269  nction is experi
-00049700: 6d65 6e74 616c 2061 6e64 2069 7473 2062  mental and its b
-00049710: 6568 6176 696f 7572 2069 7320 6c69 6b65  ehaviour is like
-00049720: 6c79 2074 6f20 6368 616e 6765 0a20 2020  ly to change.   
-00049730: 2020 2020 2020 2020 2065 7370 6563 6961           especia
-00049740: 6c6c 7920 7265 6761 7264 696e 6720 7061  lly regarding pa
-00049750: 6464 696e 6720 6f66 2064 696d 656e 7369  dding of dimensi
-00049760: 6f6e 2063 6f6f 7264 696e 6174 6573 2028  on coordinates (
-00049770: 6f72 2049 6e64 6578 5661 7269 6162 6c65  or IndexVariable
-00049780: 7329 2e0a 0a20 2020 2020 2020 2057 6865  s)...        Whe
-00049790: 6e20 7573 696e 6720 6f6e 6520 6f66 2074  n using one of t
-000497a0: 6865 206d 6f64 6573 2028 2265 6467 6522  he modes ("edge"
-000497b0: 2c20 2272 6566 6c65 6374 222c 2022 7379  , "reflect", "sy
-000497c0: 6d6d 6574 7269 6322 2c20 2277 7261 7022  mmetric", "wrap"
-000497d0: 292c 0a20 2020 2020 2020 2063 6f6f 7264  ),.        coord
-000497e0: 696e 6174 6573 2077 696c 6c20 6265 2070  inates will be p
-000497f0: 6164 6465 6420 7769 7468 2074 6865 2073  added with the s
-00049800: 616d 6520 6d6f 6465 2c20 6f74 6865 7277  ame mode, otherw
-00049810: 6973 6520 636f 6f72 6469 6e61 7465 730a  ise coordinates.
-00049820: 2020 2020 2020 2020 6172 6520 7061 6464          are padd
-00049830: 6564 2075 7369 6e67 2074 6865 2022 636f  ed using the "co
-00049840: 6e73 7461 6e74 2220 6d6f 6465 2077 6974  nstant" mode wit
-00049850: 6820 6669 6c6c 5f76 616c 7565 2064 7479  h fill_value dty
-00049860: 7065 732e 4e41 2e0a 0a20 2020 2020 2020  pes.NA...       
-00049870: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00049880: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00049890: 2020 2020 2020 2070 6164 5f77 6964 7468         pad_width
-000498a0: 203a 206d 6170 7069 6e67 206f 6620 6861   : mapping of ha
-000498b0: 7368 6162 6c65 2074 6f20 7475 706c 6520  shable to tuple 
-000498c0: 6f66 2069 6e74 0a20 2020 2020 2020 2020  of int.         
-000498d0: 2020 204d 6170 7069 6e67 2077 6974 6820     Mapping with 
-000498e0: 7468 6520 666f 726d 206f 6620 7b64 696d  the form of {dim
-000498f0: 3a20 2870 6164 5f62 6566 6f72 652c 2070  : (pad_before, p
-00049900: 6164 5f61 6674 6572 297d 0a20 2020 2020  ad_after)}.     
-00049910: 2020 2020 2020 2064 6573 6372 6962 696e         describin
-00049920: 6720 7468 6520 6e75 6d62 6572 206f 6620  g the number of 
-00049930: 7661 6c75 6573 2070 6164 6465 6420 616c  values padded al
-00049940: 6f6e 6720 6561 6368 2064 696d 656e 7369  ong each dimensi
-00049950: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-00049960: 7b64 696d 3a20 7061 647d 2069 7320 6120  {dim: pad} is a 
-00049970: 7368 6f72 7463 7574 2066 6f72 2070 6164  shortcut for pad
-00049980: 5f62 6566 6f72 6520 3d20 7061 645f 6166  _before = pad_af
-00049990: 7465 7220 3d20 7061 640a 2020 2020 2020  ter = pad.      
-000499a0: 2020 6d6f 6465 203a 207b 2263 6f6e 7374    mode : {"const
-000499b0: 616e 7422 2c20 2265 6467 6522 2c20 226c  ant", "edge", "l
-000499c0: 696e 6561 725f 7261 6d70 222c 2022 6d61  inear_ramp", "ma
-000499d0: 7869 6d75 6d22 2c20 226d 6561 6e22 2c20  ximum", "mean", 
-000499e0: 226d 6564 6961 6e22 2c20 5c0a 2020 2020  "median", \.    
-000499f0: 2020 2020 2020 2020 226d 696e 696d 756d          "minimum
-00049a00: 222c 2022 7265 666c 6563 7422 2c20 2273  ", "reflect", "s
-00049a10: 796d 6d65 7472 6963 222c 2022 7772 6170  ymmetric", "wrap
-00049a20: 227d 2c20 6465 6661 756c 743a 2022 636f  "}, default: "co
-00049a30: 6e73 7461 6e74 220a 2020 2020 2020 2020  nstant".        
-00049a40: 2020 2020 486f 7720 746f 2070 6164 2074      How to pad t
-00049a50: 6865 2044 6174 6141 7272 6179 2028 7461  he DataArray (ta
-00049a60: 6b65 6e20 6672 6f6d 206e 756d 7079 2064  ken from numpy d
-00049a70: 6f63 7329 3a0a 0a20 2020 2020 2020 2020  ocs):..         
-00049a80: 2020 202d 2022 636f 6e73 7461 6e74 223a     - "constant":
-00049a90: 2050 6164 7320 7769 7468 2061 2063 6f6e   Pads with a con
-00049aa0: 7374 616e 7420 7661 6c75 652e 0a20 2020  stant value..   
-00049ab0: 2020 2020 2020 2020 202d 2022 6564 6765           - "edge
-00049ac0: 223a 2050 6164 7320 7769 7468 2074 6865  ": Pads with the
-00049ad0: 2065 6467 6520 7661 6c75 6573 206f 6620   edge values of 
-00049ae0: 6172 7261 792e 0a20 2020 2020 2020 2020  array..         
-00049af0: 2020 202d 2022 6c69 6e65 6172 5f72 616d     - "linear_ram
-00049b00: 7022 3a20 5061 6473 2077 6974 6820 7468  p": Pads with th
-00049b10: 6520 6c69 6e65 6172 2072 616d 7020 6265  e linear ramp be
-00049b20: 7477 6565 6e20 656e 645f 7661 6c75 6520  tween end_value 
-00049b30: 616e 6420 7468 650a 2020 2020 2020 2020  and the.        
-00049b40: 2020 2020 2020 6172 7261 7920 6564 6765        array edge
-00049b50: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
-00049b60: 2020 2020 2d20 226d 6178 696d 756d 223a      - "maximum":
-00049b70: 2050 6164 7320 7769 7468 2074 6865 206d   Pads with the m
-00049b80: 6178 696d 756d 2076 616c 7565 206f 6620  aximum value of 
-00049b90: 616c 6c20 6f72 2070 6172 7420 6f66 2074  all or part of t
-00049ba0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-00049bb0: 2076 6563 746f 7220 616c 6f6e 6720 6561   vector along ea
-00049bc0: 6368 2061 7869 732e 0a20 2020 2020 2020  ch axis..       
-00049bd0: 2020 2020 202d 2022 6d65 616e 223a 2050       - "mean": P
-00049be0: 6164 7320 7769 7468 2074 6865 206d 6561  ads with the mea
-00049bf0: 6e20 7661 6c75 6520 6f66 2061 6c6c 206f  n value of all o
-00049c00: 7220 7061 7274 206f 6620 7468 650a 2020  r part of the.  
-00049c10: 2020 2020 2020 2020 2020 2020 7665 6374              vect
-00049c20: 6f72 2061 6c6f 6e67 2065 6163 6820 6178  or along each ax
-00049c30: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
-00049c40: 2d20 226d 6564 6961 6e22 3a20 5061 6473  - "median": Pads
-00049c50: 2077 6974 6820 7468 6520 6d65 6469 616e   with the median
-00049c60: 2076 616c 7565 206f 6620 616c 6c20 6f72   value of all or
-00049c70: 2070 6172 7420 6f66 2074 6865 0a20 2020   part of the.   
-00049c80: 2020 2020 2020 2020 2020 2076 6563 746f             vecto
-00049c90: 7220 616c 6f6e 6720 6561 6368 2061 7869  r along each axi
-00049ca0: 732e 0a20 2020 2020 2020 2020 2020 202d  s..            -
-00049cb0: 2022 6d69 6e69 6d75 6d22 3a20 5061 6473   "minimum": Pads
-00049cc0: 2077 6974 6820 7468 6520 6d69 6e69 6d75   with the minimu
-00049cd0: 6d20 7661 6c75 6520 6f66 2061 6c6c 206f  m value of all o
-00049ce0: 7220 7061 7274 206f 6620 7468 650a 2020  r part of the.  
-00049cf0: 2020 2020 2020 2020 2020 2020 7665 6374              vect
-00049d00: 6f72 2061 6c6f 6e67 2065 6163 6820 6178  or along each ax
-00049d10: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
-00049d20: 2d20 2272 6566 6c65 6374 223a 2050 6164  - "reflect": Pad
-00049d30: 7320 7769 7468 2074 6865 2072 6566 6c65  s with the refle
-00049d40: 6374 696f 6e20 6f66 2074 6865 2076 6563  ction of the vec
-00049d50: 746f 7220 6d69 7272 6f72 6564 206f 6e0a  tor mirrored on.
-00049d60: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00049d70: 6520 6669 7273 7420 616e 6420 6c61 7374  e first and last
-00049d80: 2076 616c 7565 7320 6f66 2074 6865 2076   values of the v
-00049d90: 6563 746f 7220 616c 6f6e 6720 6561 6368  ector along each
-00049da0: 2061 7869 732e 0a20 2020 2020 2020 2020   axis..         
-00049db0: 2020 202d 2022 7379 6d6d 6574 7269 6322     - "symmetric"
-00049dc0: 3a20 5061 6473 2077 6974 6820 7468 6520  : Pads with the 
-00049dd0: 7265 666c 6563 7469 6f6e 206f 6620 7468  reflection of th
-00049de0: 6520 7665 6374 6f72 206d 6972 726f 7265  e vector mirrore
-00049df0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00049e00: 616c 6f6e 6720 7468 6520 6564 6765 206f  along the edge o
-00049e10: 6620 7468 6520 6172 7261 792e 0a20 2020  f the array..   
-00049e20: 2020 2020 2020 2020 202d 2022 7772 6170           - "wrap
-00049e30: 223a 2050 6164 7320 7769 7468 2074 6865  ": Pads with the
-00049e40: 2077 7261 7020 6f66 2074 6865 2076 6563   wrap of the vec
-00049e50: 746f 7220 616c 6f6e 6720 7468 6520 6178  tor along the ax
-00049e60: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
-00049e70: 2020 5468 6520 6669 7273 7420 7661 6c75    The first valu
-00049e80: 6573 2061 7265 2075 7365 6420 746f 2070  es are used to p
-00049e90: 6164 2074 6865 2065 6e64 2061 6e64 2074  ad the end and t
-00049ea0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-00049eb0: 2065 6e64 2076 616c 7565 7320 6172 6520   end values are 
-00049ec0: 7573 6564 2074 6f20 7061 6420 7468 6520  used to pad the 
-00049ed0: 6265 6769 6e6e 696e 672e 0a0a 2020 2020  beginning...    
-00049ee0: 2020 2020 7374 6174 5f6c 656e 6774 6820      stat_length 
-00049ef0: 3a20 696e 742c 2074 7570 6c65 206f 7220  : int, tuple or 
-00049f00: 6d61 7070 696e 6720 6f66 2068 6173 6861  mapping of hasha
-00049f10: 626c 6520 746f 2074 7570 6c65 2c20 6465  ble to tuple, de
-00049f20: 6661 756c 743a 204e 6f6e 650a 2020 2020  fault: None.    
-00049f30: 2020 2020 2020 2020 5573 6564 2069 6e20          Used in 
-00049f40: 276d 6178 696d 756d 272c 2027 6d65 616e  'maximum', 'mean
-00049f50: 272c 2027 6d65 6469 616e 272c 2061 6e64  ', 'median', and
-00049f60: 2027 6d69 6e69 6d75 6d27 2e20 204e 756d   'minimum'.  Num
-00049f70: 6265 7220 6f66 0a20 2020 2020 2020 2020  ber of.         
-00049f80: 2020 2076 616c 7565 7320 6174 2065 6467     values at edg
-00049f90: 6520 6f66 2065 6163 6820 6178 6973 2075  e of each axis u
-00049fa0: 7365 6420 746f 2063 616c 6375 6c61 7465  sed to calculate
-00049fb0: 2074 6865 2073 7461 7469 7374 6963 2076   the statistic v
-00049fc0: 616c 7565 2e0a 2020 2020 2020 2020 2020  alue..          
-00049fd0: 2020 7b64 696d 5f31 3a20 2862 6566 6f72    {dim_1: (befor
-00049fe0: 655f 312c 2061 6674 6572 5f31 292c 202e  e_1, after_1), .
-00049ff0: 2e2e 2064 696d 5f4e 3a20 2862 6566 6f72  .. dim_N: (befor
-0004a000: 655f 4e2c 2061 6674 6572 5f4e 297d 2075  e_N, after_N)} u
-0004a010: 6e69 7175 650a 2020 2020 2020 2020 2020  nique.          
-0004a020: 2020 7374 6174 6973 7469 6320 6c65 6e67    statistic leng
-0004a030: 7468 7320 616c 6f6e 6720 6561 6368 2064  ths along each d
-0004a040: 696d 656e 7369 6f6e 2e0a 2020 2020 2020  imension..      
-0004a050: 2020 2020 2020 2828 6265 666f 7265 2c20        ((before, 
-0004a060: 6166 7465 7229 2c29 2079 6965 6c64 7320  after),) yields 
-0004a070: 7361 6d65 2062 6566 6f72 6520 616e 6420  same before and 
-0004a080: 6166 7465 7220 7374 6174 6973 7469 6320  after statistic 
-0004a090: 6c65 6e67 7468 730a 2020 2020 2020 2020  lengths.        
-0004a0a0: 2020 2020 666f 7220 6561 6368 2064 696d      for each dim
-0004a0b0: 656e 7369 6f6e 2e0a 2020 2020 2020 2020  ension..        
-0004a0c0: 2020 2020 2873 7461 745f 6c65 6e67 7468      (stat_length
-0004a0d0: 2c29 206f 7220 696e 7420 6973 2061 2073  ,) or int is a s
-0004a0e0: 686f 7274 6375 7420 666f 7220 6265 666f  hortcut for befo
-0004a0f0: 7265 203d 2061 6674 6572 203d 2073 7461  re = after = sta
-0004a100: 7469 7374 6963 0a20 2020 2020 2020 2020  tistic.         
-0004a110: 2020 206c 656e 6774 6820 666f 7220 616c     length for al
-0004a120: 6c20 6178 6573 2e0a 2020 2020 2020 2020  l axes..        
-0004a130: 2020 2020 4465 6661 756c 7420 6973 2060      Default is `
-0004a140: 604e 6f6e 6560 602c 2074 6f20 7573 6520  `None``, to use 
-0004a150: 7468 6520 656e 7469 7265 2061 7869 732e  the entire axis.
-0004a160: 0a20 2020 2020 2020 2063 6f6e 7374 616e  .        constan
-0004a170: 745f 7661 6c75 6573 203a 2073 6361 6c61  t_values : scala
-0004a180: 722c 2074 7570 6c65 206f 7220 6d61 7070  r, tuple or mapp
-0004a190: 696e 6720 6f66 2068 6173 6861 626c 6520  ing of hashable 
-0004a1a0: 746f 2074 7570 6c65 2c20 6465 6661 756c  to tuple, defaul
-0004a1b0: 743a 2030 0a20 2020 2020 2020 2020 2020  t: 0.           
-0004a1c0: 2055 7365 6420 696e 2027 636f 6e73 7461   Used in 'consta
-0004a1d0: 6e74 272e 2020 5468 6520 7661 6c75 6573  nt'.  The values
-0004a1e0: 2074 6f20 7365 7420 7468 6520 7061 6464   to set the padd
-0004a1f0: 6564 2076 616c 7565 7320 666f 7220 6561  ed values for ea
-0004a200: 6368 0a20 2020 2020 2020 2020 2020 2061  ch.            a
-0004a210: 7869 732e 0a20 2020 2020 2020 2020 2020  xis..           
-0004a220: 2060 607b 6469 6d5f 313a 2028 6265 666f   ``{dim_1: (befo
-0004a230: 7265 5f31 2c20 6166 7465 725f 3129 2c20  re_1, after_1), 
-0004a240: 2e2e 2e20 6469 6d5f 4e3a 2028 6265 666f  ... dim_N: (befo
-0004a250: 7265 5f4e 2c20 6166 7465 725f 4e29 7d60  re_N, after_N)}`
-0004a260: 6020 756e 6971 7565 0a20 2020 2020 2020  ` unique.       
-0004a270: 2020 2020 2070 6164 2063 6f6e 7374 616e       pad constan
-0004a280: 7473 2061 6c6f 6e67 2065 6163 6820 6469  ts along each di
-0004a290: 6d65 6e73 696f 6e2e 0a20 2020 2020 2020  mension..       
-0004a2a0: 2020 2020 2060 6028 2862 6566 6f72 652c       ``((before,
-0004a2b0: 2061 6674 6572 292c 2960 6020 7969 656c   after),)`` yiel
-0004a2c0: 6473 2073 616d 6520 6265 666f 7265 2061  ds same before a
-0004a2d0: 6e64 2061 6674 6572 2063 6f6e 7374 616e  nd after constan
-0004a2e0: 7473 2066 6f72 2065 6163 680a 2020 2020  ts for each.    
-0004a2f0: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
-0004a300: 6e2e 0a20 2020 2020 2020 2020 2020 2060  n..            `
-0004a310: 6028 636f 6e73 7461 6e74 2c29 6060 206f  `(constant,)`` o
-0004a320: 7220 6060 636f 6e73 7461 6e74 6060 2069  r ``constant`` i
-0004a330: 7320 6120 7368 6f72 7463 7574 2066 6f72  s a shortcut for
-0004a340: 2060 6062 6566 6f72 6520 3d20 6166 7465   ``before = afte
-0004a350: 7220 3d20 636f 6e73 7461 6e74 6060 2066  r = constant`` f
-0004a360: 6f72 0a20 2020 2020 2020 2020 2020 2061  or.            a
-0004a370: 6c6c 2064 696d 656e 7369 6f6e 732e 0a20  ll dimensions.. 
-0004a380: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
-0004a390: 6c74 2069 7320 302e 0a20 2020 2020 2020  lt is 0..       
-0004a3a0: 2065 6e64 5f76 616c 7565 7320 3a20 7363   end_values : sc
-0004a3b0: 616c 6172 2c20 7475 706c 6520 6f72 206d  alar, tuple or m
-0004a3c0: 6170 7069 6e67 206f 6620 6861 7368 6162  apping of hashab
-0004a3d0: 6c65 2074 6f20 7475 706c 652c 2064 6566  le to tuple, def
-0004a3e0: 6175 6c74 3a20 300a 2020 2020 2020 2020  ault: 0.        
-0004a3f0: 2020 2020 5573 6564 2069 6e20 276c 696e      Used in 'lin
-0004a400: 6561 725f 7261 6d70 272e 2020 5468 6520  ear_ramp'.  The 
-0004a410: 7661 6c75 6573 2075 7365 6420 666f 7220  values used for 
-0004a420: 7468 6520 656e 6469 6e67 2076 616c 7565  the ending value
-0004a430: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-0004a440: 2020 2020 6c69 6e65 6172 5f72 616d 7020      linear_ramp 
-0004a450: 616e 6420 7468 6174 2077 696c 6c20 666f  and that will fo
-0004a460: 726d 2074 6865 2065 6467 6520 6f66 2074  rm the edge of t
-0004a470: 6865 2070 6164 6465 6420 6172 7261 792e  he padded array.
-0004a480: 0a20 2020 2020 2020 2020 2020 2060 607b  .            ``{
-0004a490: 6469 6d5f 313a 2028 6265 666f 7265 5f31  dim_1: (before_1
-0004a4a0: 2c20 6166 7465 725f 3129 2c20 2e2e 2e20  , after_1), ... 
-0004a4b0: 6469 6d5f 4e3a 2028 6265 666f 7265 5f4e  dim_N: (before_N
-0004a4c0: 2c20 6166 7465 725f 4e29 7d60 6020 756e  , after_N)}`` un
-0004a4d0: 6971 7565 0a20 2020 2020 2020 2020 2020  ique.           
-0004a4e0: 2065 6e64 2076 616c 7565 7320 616c 6f6e   end values alon
-0004a4f0: 6720 6561 6368 2064 696d 656e 7369 6f6e  g each dimension
-0004a500: 2e0a 2020 2020 2020 2020 2020 2020 6060  ..            ``
-0004a510: 2828 6265 666f 7265 2c20 6166 7465 7229  ((before, after)
-0004a520: 2c29 6060 2079 6965 6c64 7320 7361 6d65  ,)`` yields same
-0004a530: 2062 6566 6f72 6520 616e 6420 6166 7465   before and afte
-0004a540: 7220 656e 6420 7661 6c75 6573 2066 6f72  r end values for
-0004a550: 2065 6163 680a 2020 2020 2020 2020 2020   each.          
-0004a560: 2020 6178 6973 2e0a 2020 2020 2020 2020    axis..        
-0004a570: 2020 2020 6060 2863 6f6e 7374 616e 742c      ``(constant,
-0004a580: 2960 6020 6f72 2060 6063 6f6e 7374 616e  )`` or ``constan
-0004a590: 7460 6020 6973 2061 2073 686f 7274 6375  t`` is a shortcu
-0004a5a0: 7420 666f 7220 6060 6265 666f 7265 203d  t for ``before =
-0004a5b0: 2061 6674 6572 203d 2063 6f6e 7374 616e   after = constan
-0004a5c0: 7460 6020 666f 720a 2020 2020 2020 2020  t`` for.        
-0004a5d0: 2020 2020 616c 6c20 6178 6573 2e0a 2020      all axes..  
-0004a5e0: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
-0004a5f0: 7420 6973 2030 2e0a 2020 2020 2020 2020  t is 0..        
-0004a600: 7265 666c 6563 745f 7479 7065 203a 207b  reflect_type : {
-0004a610: 2265 7665 6e22 2c20 226f 6464 222c 204e  "even", "odd", N
-0004a620: 6f6e 657d 2c20 6f70 7469 6f6e 616c 0a20  one}, optional. 
-0004a630: 2020 2020 2020 2020 2020 2055 7365 6420             Used 
-0004a640: 696e 2022 7265 666c 6563 7422 2c20 616e  in "reflect", an
-0004a650: 6420 2273 796d 6d65 7472 6963 222e 2020  d "symmetric".  
-0004a660: 5468 6520 2265 7665 6e22 2073 7479 6c65  The "even" style
-0004a670: 2069 7320 7468 650a 2020 2020 2020 2020   is the.        
-0004a680: 2020 2020 6465 6661 756c 7420 7769 7468      default with
-0004a690: 2061 6e20 756e 616c 7465 7265 6420 7265   an unaltered re
-0004a6a0: 666c 6563 7469 6f6e 2061 726f 756e 6420  flection around 
-0004a6b0: 7468 6520 6564 6765 2076 616c 7565 2e20  the edge value. 
-0004a6c0: 2046 6f72 0a20 2020 2020 2020 2020 2020   For.           
-0004a6d0: 2074 6865 2022 6f64 6422 2073 7479 6c65   the "odd" style
-0004a6e0: 2c20 7468 6520 6578 7465 6e64 6564 2070  , the extended p
-0004a6f0: 6172 7420 6f66 2074 6865 2061 7272 6179  art of the array
-0004a700: 2069 7320 6372 6561 7465 6420 6279 0a20   is created by. 
-0004a710: 2020 2020 2020 2020 2020 2073 7562 7472             subtr
-0004a720: 6163 7469 6e67 2074 6865 2072 6566 6c65  acting the refle
-0004a730: 6374 6564 2076 616c 7565 7320 6672 6f6d  cted values from
-0004a740: 2074 776f 2074 696d 6573 2074 6865 2065   two times the e
-0004a750: 6467 6520 7661 6c75 652e 0a20 2020 2020  dge value..     
-0004a760: 2020 206b 6565 705f 6174 7472 7320 3a20     keep_attrs : 
-0004a770: 626f 6f6c 206f 7220 4e6f 6e65 2c20 6f70  bool or None, op
-0004a780: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-0004a790: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-0004a7a0: 6174 7472 6962 7574 6573 2028 6060 6174  attributes (``at
-0004a7b0: 7472 7360 6029 2077 696c 6c20 6265 2063  trs``) will be c
-0004a7c0: 6f70 6965 6420 6672 6f6d 2074 6865 0a20  opied from the. 
-0004a7d0: 2020 2020 2020 2020 2020 206f 7269 6769             origi
-0004a7e0: 6e61 6c20 6f62 6a65 6374 2074 6f20 7468  nal object to th
-0004a7f0: 6520 6e65 7720 6f6e 652e 2049 6620 4661  e new one. If Fa
-0004a800: 6c73 652c 2074 6865 206e 6577 206f 626a  lse, the new obj
-0004a810: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
-0004a820: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
-0004a830: 2077 6974 686f 7574 2061 7474 7269 6275   without attribu
-0004a840: 7465 732e 0a20 2020 2020 2020 202a 2a70  tes..        **p
-0004a850: 6164 5f77 6964 7468 5f6b 7761 7267 730a  ad_width_kwargs.
-0004a860: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-0004a870: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-0004a880: 7320 666f 726d 206f 6620 6060 7061 645f  s form of ``pad_
-0004a890: 7769 6474 6860 602e 0a20 2020 2020 2020  width``..       
-0004a8a0: 2020 2020 204f 6e65 206f 6620 6060 7061       One of ``pa
-0004a8b0: 645f 7769 6474 6860 6020 6f72 2060 6070  d_width`` or ``p
-0004a8c0: 6164 5f77 6964 7468 5f6b 7761 7267 7360  ad_width_kwargs`
-0004a8d0: 6020 6d75 7374 2062 6520 7072 6f76 6964  ` must be provid
-0004a8e0: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
-0004a8f0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-0004a900: 2d2d 2d2d 0a20 2020 2020 2020 2070 6164  ----.        pad
-0004a910: 6465 6420 3a20 4461 7461 7365 740a 2020  ded : Dataset.  
-0004a920: 2020 2020 2020 2020 2020 4461 7461 7365            Datase
-0004a930: 7420 7769 7468 2074 6865 2070 6164 6465  t with the padde
-0004a940: 6420 636f 6f72 6469 6e61 7465 7320 616e  d coordinates an
-0004a950: 6420 6461 7461 2e0a 0a20 2020 2020 2020  d data...       
-0004a960: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-0004a970: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-0004a980: 2020 2044 6174 6173 6574 2e73 6869 6674     Dataset.shift
-0004a990: 2c20 4461 7461 7365 742e 726f 6c6c 2c20  , Dataset.roll, 
-0004a9a0: 4461 7461 7365 742e 6266 696c 6c2c 2044  Dataset.bfill, D
-0004a9b0: 6174 6173 6574 2e66 6669 6c6c 2c20 6e75  ataset.ffill, nu
-0004a9c0: 6d70 792e 7061 642c 2064 6173 6b2e 6172  mpy.pad, dask.ar
-0004a9d0: 7261 792e 7061 640a 0a20 2020 2020 2020  ray.pad..       
-0004a9e0: 204e 6f74 6573 0a20 2020 2020 2020 202d   Notes.        -
-0004a9f0: 2d2d 2d2d 0a20 2020 2020 2020 2042 7920  ----.        By 
-0004aa00: 6465 6661 756c 7420 7768 656e 2060 606d  default when ``m
-0004aa10: 6f64 653d 2263 6f6e 7374 616e 7422 6060  ode="constant"``
-0004aa20: 2061 6e64 2060 6063 6f6e 7374 616e 745f   and ``constant_
-0004aa30: 7661 6c75 6573 3d4e 6f6e 6560 602c 2069  values=None``, i
-0004aa40: 6e74 6567 6572 2074 7970 6573 2077 696c  nteger types wil
-0004aa50: 6c20 6265 0a20 2020 2020 2020 2070 726f  l be.        pro
-0004aa60: 6d6f 7465 6420 746f 2060 6066 6c6f 6174  moted to ``float
-0004aa70: 6060 2061 6e64 2070 6164 6465 6420 7769  `` and padded wi
-0004aa80: 7468 2060 606e 702e 6e61 6e60 602e 2054  th ``np.nan``. T
-0004aa90: 6f20 6176 6f69 6420 7479 7065 2070 726f  o avoid type pro
-0004aaa0: 6d6f 7469 6f6e 0a20 2020 2020 2020 2073  motion.        s
-0004aab0: 7065 6369 6679 2060 6063 6f6e 7374 616e  pecify ``constan
-0004aac0: 745f 7661 6c75 6573 3d6e 702e 6e61 6e60  t_values=np.nan`
-0004aad0: 600a 0a20 2020 2020 2020 2050 6164 6469  `..        Paddi
-0004aae0: 6e67 2063 6f6f 7264 696e 6174 6573 2077  ng coordinates w
-0004aaf0: 696c 6c20 6472 6f70 2074 6865 6972 2063  ill drop their c
-0004ab00: 6f72 7265 7370 6f6e 6469 6e67 2069 6e64  orresponding ind
-0004ab10: 6578 2028 6966 2061 6e79 2920 616e 6420  ex (if any) and 
-0004ab20: 7769 6c6c 2072 6573 6574 2064 6566 6175  will reset defau
-0004ab30: 6c74 0a20 2020 2020 2020 2069 6e64 6578  lt.        index
-0004ab40: 6573 2066 6f72 2064 696d 656e 7369 6f6e  es for dimension
-0004ab50: 2063 6f6f 7264 696e 6174 6573 2e0a 0a20   coordinates... 
-0004ab60: 2020 2020 2020 2045 7861 6d70 6c65 730a         Examples.
-0004ab70: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0004ab80: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-0004ab90: 3d20 7872 2e44 6174 6173 6574 287b 2266  = xr.Dataset({"f
-0004aba0: 6f6f 223a 2028 2278 222c 2072 616e 6765  oo": ("x", range
-0004abb0: 2835 2929 7d29 0a20 2020 2020 2020 203e  (5))}).        >
-0004abc0: 3e3e 2064 732e 7061 6428 783d 2831 2c20  >> ds.pad(x=(1, 
-0004abd0: 3229 290a 2020 2020 2020 2020 3c78 6172  2)).        <xar
-0004abe0: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
-0004abf0: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
-0004ac00: 2020 2878 3a20 3829 0a20 2020 2020 2020    (x: 8).       
-0004ac10: 2044 696d 656e 7369 6f6e 7320 7769 7468   Dimensions with
-0004ac20: 6f75 7420 636f 6f72 6469 6e61 7465 733a  out coordinates:
-0004ac30: 2078 0a20 2020 2020 2020 2044 6174 6120   x.        Data 
-0004ac40: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
-0004ac50: 2020 2020 2020 2066 6f6f 2020 2020 2020         foo      
-0004ac60: 2878 2920 666c 6f61 7436 3420 6e61 6e20  (x) float64 nan 
-0004ac70: 302e 3020 312e 3020 322e 3020 332e 3020  0.0 1.0 2.0 3.0 
-0004ac80: 342e 3020 6e61 6e20 6e61 6e0a 2020 2020  4.0 nan nan.    
-0004ac90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0004aca0: 7061 645f 7769 6474 6820 3d20 6569 7468  pad_width = eith
-0004acb0: 6572 5f64 6963 745f 6f72 5f6b 7761 7267  er_dict_or_kwarg
-0004acc0: 7328 7061 645f 7769 6474 682c 2070 6164  s(pad_width, pad
-0004acd0: 5f77 6964 7468 5f6b 7761 7267 732c 2022  _width_kwargs, "
-0004ace0: 7061 6422 290a 0a20 2020 2020 2020 2069  pad")..        i
-0004acf0: 6620 6d6f 6465 2069 6e20 2822 6564 6765  f mode in ("edge
-0004ad00: 222c 2022 7265 666c 6563 7422 2c20 2273  ", "reflect", "s
-0004ad10: 796d 6d65 7472 6963 222c 2022 7772 6170  ymmetric", "wrap
-0004ad20: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-0004ad30: 636f 6f72 645f 7061 645f 6d6f 6465 203d  coord_pad_mode =
-0004ad40: 206d 6f64 650a 2020 2020 2020 2020 2020   mode.          
-0004ad50: 2020 636f 6f72 645f 7061 645f 6f70 7469    coord_pad_opti
-0004ad60: 6f6e 7320 3d20 7b0a 2020 2020 2020 2020  ons = {.        
-0004ad70: 2020 2020 2020 2020 2273 7461 745f 6c65          "stat_le
-0004ad80: 6e67 7468 223a 2073 7461 745f 6c65 6e67  ngth": stat_leng
-0004ad90: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-0004ada0: 2020 2020 2263 6f6e 7374 616e 745f 7661      "constant_va
-0004adb0: 6c75 6573 223a 2063 6f6e 7374 616e 745f  lues": constant_
-0004adc0: 7661 6c75 6573 2c0a 2020 2020 2020 2020  values,.        
-0004add0: 2020 2020 2020 2020 2265 6e64 5f76 616c          "end_val
-0004ade0: 7565 7322 3a20 656e 645f 7661 6c75 6573  ues": end_values
-0004adf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0004ae00: 2020 2272 6566 6c65 6374 5f74 7970 6522    "reflect_type"
-0004ae10: 3a20 7265 666c 6563 745f 7479 7065 2c0a  : reflect_type,.
-0004ae20: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-0004ae30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0004ae40: 2020 2020 2020 2020 636f 6f72 645f 7061          coord_pa
-0004ae50: 645f 6d6f 6465 203d 2022 636f 6e73 7461  d_mode = "consta
-0004ae60: 6e74 220a 2020 2020 2020 2020 2020 2020  nt".            
-0004ae70: 636f 6f72 645f 7061 645f 6f70 7469 6f6e  coord_pad_option
-0004ae80: 7320 3d20 7b7d 0a0a 2020 2020 2020 2020  s = {}..        
-0004ae90: 6966 206b 6565 705f 6174 7472 7320 6973  if keep_attrs is
-0004aea0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0004aeb0: 2020 206b 6565 705f 6174 7472 7320 3d20     keep_attrs = 
-0004aec0: 5f67 6574 5f6b 6565 705f 6174 7472 7328  _get_keep_attrs(
-0004aed0: 6465 6661 756c 743d 5472 7565 290a 0a20  default=True).. 
-0004aee0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0004aef0: 203d 207b 7d0a 0a20 2020 2020 2020 2023   = {}..        #
-0004af00: 206b 6565 7020 696e 6465 7865 7320 7468   keep indexes th
-0004af10: 6174 2077 6f6e 2774 2062 6520 6166 6665  at won't be affe
-0004af20: 6374 6564 2062 7920 7061 6420 616e 6420  cted by pad and 
-0004af30: 6472 6f70 2061 6c6c 206f 7468 6572 2069  drop all other i
-0004af40: 6e64 6578 6573 0a20 2020 2020 2020 2078  ndexes.        x
-0004af50: 696e 6465 7865 7320 3d20 7365 6c66 2e78  indexes = self.x
-0004af60: 696e 6465 7865 730a 2020 2020 2020 2020  indexes.        
-0004af70: 7061 645f 6469 6d73 203d 2073 6574 2870  pad_dims = set(p
-0004af80: 6164 5f77 6964 7468 290a 2020 2020 2020  ad_width).      
-0004af90: 2020 696e 6465 7865 7320 3d20 7b7d 0a20    indexes = {}. 
-0004afa0: 2020 2020 2020 2066 6f72 206b 2c20 6964         for k, id
-0004afb0: 7820 696e 2078 696e 6465 7865 732e 6974  x in xindexes.it
-0004afc0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-0004afd0: 2020 2069 6620 6e6f 7420 7061 645f 6469     if not pad_di
-0004afe0: 6d73 2e69 6e74 6572 7365 6374 696f 6e28  ms.intersection(
-0004aff0: 7869 6e64 6578 6573 2e67 6574 5f61 6c6c  xindexes.get_all
-0004b000: 5f64 696d 7328 6b29 293a 0a20 2020 2020  _dims(k)):.     
-0004b010: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-0004b020: 6573 5b6b 5d20 3d20 6964 780a 0a20 2020  es[k] = idx..   
-0004b030: 2020 2020 2066 6f72 206e 616d 652c 2076       for name, v
-0004b040: 6172 2069 6e20 7365 6c66 2e76 6172 6961  ar in self.varia
-0004b050: 626c 6573 2e69 7465 6d73 2829 3a0a 2020  bles.items():.  
-0004b060: 2020 2020 2020 2020 2020 7661 725f 7061            var_pa
-0004b070: 645f 7769 6474 6820 3d20 7b6b 3a20 7620  d_width = {k: v 
-0004b080: 666f 7220 6b2c 2076 2069 6e20 7061 645f  for k, v in pad_
-0004b090: 7769 6474 682e 6974 656d 7328 2920 6966  width.items() if
-0004b0a0: 206b 2069 6e20 7661 722e 6469 6d73 7d0a   k in var.dims}.
-0004b0b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0004b0c0: 6f74 2076 6172 5f70 6164 5f77 6964 7468  ot var_pad_width
-0004b0d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004b0e0: 2020 7661 7269 6162 6c65 735b 6e61 6d65    variables[name
-0004b0f0: 5d20 3d20 7661 720a 2020 2020 2020 2020  ] = var.        
-0004b100: 2020 2020 656c 6966 206e 616d 6520 696e      elif name in
-0004b110: 2073 656c 662e 6461 7461 5f76 6172 733a   self.data_vars:
-0004b120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b130: 2076 6172 6961 626c 6573 5b6e 616d 655d   variables[name]
-0004b140: 203d 2076 6172 2e70 6164 280a 2020 2020   = var.pad(.    
-0004b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b160: 7061 645f 7769 6474 683d 7661 725f 7061  pad_width=var_pa
-0004b170: 645f 7769 6474 682c 0a20 2020 2020 2020  d_width,.       
-0004b180: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0004b190: 653d 6d6f 6465 2c0a 2020 2020 2020 2020  e=mode,.        
-0004b1a0: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-0004b1b0: 5f6c 656e 6774 683d 7374 6174 5f6c 656e  _length=stat_len
-0004b1c0: 6774 682c 0a20 2020 2020 2020 2020 2020  gth,.           
-0004b1d0: 2020 2020 2020 2020 2063 6f6e 7374 616e           constan
-0004b1e0: 745f 7661 6c75 6573 3d63 6f6e 7374 616e  t_values=constan
-0004b1f0: 745f 7661 6c75 6573 2c0a 2020 2020 2020  t_values,.      
-0004b200: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0004b210: 645f 7661 6c75 6573 3d65 6e64 5f76 616c  d_values=end_val
-0004b220: 7565 732c 0a20 2020 2020 2020 2020 2020  ues,.           
-0004b230: 2020 2020 2020 2020 2072 6566 6c65 6374           reflect
-0004b240: 5f74 7970 653d 7265 666c 6563 745f 7479  _type=reflect_ty
-0004b250: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
-0004b260: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
-0004b270: 7273 3d6b 6565 705f 6174 7472 732c 0a20  rs=keep_attrs,. 
-0004b280: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0004b290: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0004b2a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0004b2b0: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
-0004b2c0: 655d 203d 2076 6172 2e70 6164 280a 2020  e] = var.pad(.  
-0004b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b2e0: 2020 7061 645f 7769 6474 683d 7661 725f    pad_width=var_
-0004b2f0: 7061 645f 7769 6474 682c 0a20 2020 2020  pad_width,.     
-0004b300: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0004b310: 6f64 653d 636f 6f72 645f 7061 645f 6d6f  ode=coord_pad_mo
-0004b320: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
-0004b330: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
-0004b340: 7273 3d6b 6565 705f 6174 7472 732c 0a20  rs=keep_attrs,. 
-0004b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b360: 2020 202a 2a63 6f6f 7264 5f70 6164 5f6f     **coord_pad_o
-0004b370: 7074 696f 6e73 2c20 2023 2074 7970 653a  ptions,  # type:
-0004b380: 2069 676e 6f72 655b 6172 672d 7479 7065   ignore[arg-type
-0004b390: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0004b3a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0004b3b0: 2020 2020 2320 7265 7365 7420 6465 6661      # reset defa
-0004b3c0: 756c 7420 696e 6465 7820 6f66 2064 696d  ult index of dim
-0004b3d0: 656e 7369 6f6e 2063 6f6f 7264 696e 6174  ension coordinat
-0004b3e0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-0004b3f0: 2020 2069 6620 286e 616d 652c 2920 3d3d     if (name,) ==
-0004b400: 2076 6172 2e64 696d 733a 0a20 2020 2020   var.dims:.     
-0004b410: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0004b420: 696d 5f76 6172 203d 207b 6e61 6d65 3a20  im_var = {name: 
-0004b430: 7661 7269 6162 6c65 735b 6e61 6d65 5d7d  variables[name]}
-0004b440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b450: 2020 2020 2069 6e64 6578 203d 2050 616e       index = Pan
-0004b460: 6461 7349 6e64 6578 2e66 726f 6d5f 7661  dasIndex.from_va
-0004b470: 7269 6162 6c65 7328 6469 6d5f 7661 722c  riables(dim_var,
-0004b480: 206f 7074 696f 6e73 3d7b 7d29 0a20 2020   options={}).   
-0004b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4a0: 2069 6e64 6578 5f76 6172 7320 3d20 696e   index_vars = in
-0004b4b0: 6465 782e 6372 6561 7465 5f76 6172 6961  dex.create_varia
-0004b4c0: 626c 6573 2864 696d 5f76 6172 290a 2020  bles(dim_var).  
-0004b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4e0: 2020 696e 6465 7865 735b 6e61 6d65 5d20    indexes[name] 
-0004b4f0: 3d20 696e 6465 780a 2020 2020 2020 2020  = index.        
-0004b500: 2020 2020 2020 2020 2020 2020 7661 7269              vari
-0004b510: 6162 6c65 735b 6e61 6d65 5d20 3d20 696e  ables[name] = in
-0004b520: 6465 785f 7661 7273 5b6e 616d 655d 0a0a  dex_vars[name]..
-0004b530: 2020 2020 2020 2020 6174 7472 7320 3d20          attrs = 
-0004b540: 7365 6c66 2e5f 6174 7472 7320 6966 206b  self._attrs if k
-0004b550: 6565 705f 6174 7472 7320 656c 7365 204e  eep_attrs else N
-0004b560: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
-0004b570: 726e 2073 656c 662e 5f72 6570 6c61 6365  rn self._replace
-0004b580: 5f77 6974 685f 6e65 775f 6469 6d73 2876  _with_new_dims(v
-0004b590: 6172 6961 626c 6573 2c20 696e 6465 7865  ariables, indexe
-0004b5a0: 733d 696e 6465 7865 732c 2061 7474 7273  s=indexes, attrs
-0004b5b0: 3d61 7474 7273 290a 0a20 2020 2064 6566  =attrs)..    def
-0004b5c0: 2069 6478 6d69 6e28 0a20 2020 2020 2020   idxmin(.       
-0004b5d0: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
-0004b5e0: 2c0a 2020 2020 2020 2020 6469 6d3a 2048  ,.        dim: H
-0004b5f0: 6173 6861 626c 6520 7c20 4e6f 6e65 203d  ashable | None =
-0004b600: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
-0004b610: 6b69 706e 613a 2062 6f6f 6c20 7c20 4e6f  kipna: bool | No
-0004b620: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-0004b630: 2020 2066 696c 6c5f 7661 6c75 653a 2041     fill_value: A
-0004b640: 6e79 203d 2078 7264 7479 7065 732e 4e41  ny = xrdtypes.NA
-0004b650: 2c0a 2020 2020 2020 2020 6b65 6570 5f61  ,.        keep_a
-0004b660: 7474 7273 3a20 626f 6f6c 207c 204e 6f6e  ttrs: bool | Non
-0004b670: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
-0004b680: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-0004b690: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-0004b6a0: 7468 6520 636f 6f72 6469 6e61 7465 206c  the coordinate l
-0004b6b0: 6162 656c 206f 6620 7468 6520 6d69 6e69  abel of the mini
-0004b6c0: 6d75 6d20 7661 6c75 6520 616c 6f6e 6720  mum value along 
-0004b6d0: 6120 6469 6d65 6e73 696f 6e2e 0a0a 2020  a dimension...  
-0004b6e0: 2020 2020 2020 5265 7475 726e 7320 6120        Returns a 
-0004b6f0: 6e65 7720 6044 6174 6173 6574 6020 6e61  new `Dataset` na
-0004b700: 6d65 6420 6166 7465 7220 7468 6520 6469  med after the di
-0004b710: 6d65 6e73 696f 6e20 7769 7468 2074 6865  mension with the
-0004b720: 2076 616c 7565 7320 6f66 0a20 2020 2020   values of.     
-0004b730: 2020 2074 6865 2063 6f6f 7264 696e 6174     the coordinat
-0004b740: 6520 6c61 6265 6c73 2061 6c6f 6e67 2074  e labels along t
-0004b750: 6861 7420 6469 6d65 6e73 696f 6e20 636f  hat dimension co
-0004b760: 7272 6573 706f 6e64 696e 6720 746f 206d  rresponding to m
-0004b770: 696e 696d 756d 0a20 2020 2020 2020 2076  inimum.        v
-0004b780: 616c 7565 7320 616c 6f6e 6720 7468 6174  alues along that
-0004b790: 2064 696d 656e 7369 6f6e 2e0a 0a20 2020   dimension...   
-0004b7a0: 2020 2020 2049 6e20 636f 6d70 6172 6973       In comparis
-0004b7b0: 6f6e 2074 6f20 3a70 793a 6d65 7468 3a60  on to :py:meth:`
-0004b7c0: 7e44 6174 6173 6574 2e61 7267 6d69 6e60  ~Dataset.argmin`
-0004b7d0: 2c20 7468 6973 2072 6574 7572 6e73 2074  , this returns t
-0004b7e0: 6865 0a20 2020 2020 2020 2063 6f6f 7264  he.        coord
-0004b7f0: 696e 6174 6520 6c61 6265 6c20 7768 696c  inate label whil
-0004b800: 6520 3a70 793a 6d65 7468 3a60 7e44 6174  e :py:meth:`~Dat
-0004b810: 6173 6574 2e61 7267 6d69 6e60 2072 6574  aset.argmin` ret
-0004b820: 7572 6e73 2074 6865 2069 6e64 6578 2e0a  urns the index..
-0004b830: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0004b840: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0004b850: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-0004b860: 696d 203a 2048 6173 6861 626c 652c 206f  im : Hashable, o
-0004b870: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0004b880: 2020 2020 4469 6d65 6e73 696f 6e20 6f76      Dimension ov
-0004b890: 6572 2077 6869 6368 2074 6f20 6170 706c  er which to appl
-0004b8a0: 7920 6069 6478 6d69 6e60 2e20 2054 6869  y `idxmin`.  Thi
-0004b8b0: 7320 6973 206f 7074 696f 6e61 6c20 666f  s is optional fo
-0004b8c0: 7220 3144 0a20 2020 2020 2020 2020 2020  r 1D.           
-0004b8d0: 2076 6172 6961 626c 6573 2c20 6275 7420   variables, but 
-0004b8e0: 7265 7175 6972 6564 2066 6f72 2076 6172  required for var
-0004b8f0: 6961 626c 6573 2077 6974 6820 3220 6f72  iables with 2 or
-0004b900: 206d 6f72 6520 6469 6d65 6e73 696f 6e73   more dimensions
-0004b910: 2e0a 2020 2020 2020 2020 736b 6970 6e61  ..        skipna
-0004b920: 203a 2062 6f6f 6c20 6f72 204e 6f6e 652c   : bool or None,
-0004b930: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0004b940: 2020 2020 2020 4966 2054 7275 652c 2073        If True, s
-0004b950: 6b69 7020 6d69 7373 696e 6720 7661 6c75  kip missing valu
-0004b960: 6573 2028 6173 206d 6172 6b65 6420 6279  es (as marked by
-0004b970: 204e 614e 292e 2042 7920 6465 6661 756c   NaN). By defaul
-0004b980: 742c 206f 6e6c 790a 2020 2020 2020 2020  t, only.        
-0004b990: 2020 2020 736b 6970 7320 6d69 7373 696e      skips missin
-0004b9a0: 6720 7661 6c75 6573 2066 6f72 2060 6066  g values for ``f
-0004b9b0: 6c6f 6174 6060 2c20 6060 636f 6d70 6c65  loat``, ``comple
-0004b9c0: 7860 602c 2061 6e64 2060 606f 626a 6563  x``, and ``objec
-0004b9d0: 7460 600a 2020 2020 2020 2020 2020 2020  t``.            
-0004b9e0: 6474 7970 6573 3b20 6f74 6865 7220 6474  dtypes; other dt
-0004b9f0: 7970 6573 2065 6974 6865 7220 646f 206e  ypes either do n
-0004ba00: 6f74 2068 6176 6520 6120 7365 6e74 696e  ot have a sentin
-0004ba10: 656c 206d 6973 7369 6e67 2076 616c 7565  el missing value
-0004ba20: 0a20 2020 2020 2020 2020 2020 2028 6060  .            (``
-0004ba30: 696e 7460 6029 206f 7220 6060 736b 6970  int``) or ``skip
-0004ba40: 6e61 3d54 7275 6560 6020 6861 7320 6e6f  na=True`` has no
-0004ba50: 7420 6265 656e 2069 6d70 6c65 6d65 6e74  t been implement
-0004ba60: 6564 0a20 2020 2020 2020 2020 2020 2028  ed.            (
-0004ba70: 6060 6461 7465 7469 6d65 3634 6060 206f  ``datetime64`` o
-0004ba80: 7220 6060 7469 6d65 6465 6c74 6136 3460  r ``timedelta64`
-0004ba90: 6029 2e0a 2020 2020 2020 2020 6669 6c6c  `)..        fill
-0004baa0: 5f76 616c 7565 203a 2041 6e79 2c20 6465  _value : Any, de
-0004bab0: 6661 756c 743a 204e 614e 0a20 2020 2020  fault: NaN.     
-0004bac0: 2020 2020 2020 2056 616c 7565 2074 6f20         Value to 
-0004bad0: 6265 2066 696c 6c65 6420 696e 2063 6173  be filled in cas
-0004bae0: 6520 616c 6c20 6f66 2074 6865 2076 616c  e all of the val
-0004baf0: 7565 7320 616c 6f6e 6720 6120 6469 6d65  ues along a dime
-0004bb00: 6e73 696f 6e20 6172 650a 2020 2020 2020  nsion are.      
-0004bb10: 2020 2020 2020 6e75 6c6c 2e20 2042 7920        null.  By 
-0004bb20: 6465 6661 756c 7420 7468 6973 2069 7320  default this is 
-0004bb30: 4e61 4e2e 2020 5468 6520 6669 6c6c 2076  NaN.  The fill v
-0004bb40: 616c 7565 2061 6e64 2072 6573 756c 7420  alue and result 
-0004bb50: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
-0004bb60: 6175 746f 6d61 7469 6361 6c6c 7920 636f  automatically co
-0004bb70: 6e76 6572 7465 6420 746f 2061 2063 6f6d  nverted to a com
-0004bb80: 7061 7469 626c 6520 6474 7970 6520 6966  patible dtype if
-0004bb90: 2070 6f73 7369 626c 652e 0a20 2020 2020   possible..     
-0004bba0: 2020 2020 2020 2049 676e 6f72 6564 2069         Ignored i
-0004bbb0: 6620 6060 736b 6970 6e61 6060 2069 7320  f ``skipna`` is 
-0004bbc0: 4661 6c73 652e 0a20 2020 2020 2020 206b  False..        k
-0004bbd0: 6565 705f 6174 7472 7320 3a20 626f 6f6c  eep_attrs : bool
-0004bbe0: 206f 7220 4e6f 6e65 2c20 6f70 7469 6f6e   or None, option
-0004bbf0: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
-0004bc00: 6620 5472 7565 2c20 7468 6520 6174 7472  f True, the attr
-0004bc10: 6962 7574 6573 2028 6060 6174 7472 7360  ibutes (``attrs`
-0004bc20: 6029 2077 696c 6c20 6265 2063 6f70 6965  `) will be copie
-0004bc30: 6420 6672 6f6d 2074 6865 0a20 2020 2020  d from the.     
-0004bc40: 2020 2020 2020 206f 7269 6769 6e61 6c20         original 
-0004bc50: 6f62 6a65 6374 2074 6f20 7468 6520 6e65  object to the ne
-0004bc60: 7720 6f6e 652e 2049 6620 4661 6c73 652c  w one. If False,
-0004bc70: 2074 6865 206e 6577 206f 626a 6563 740a   the new object.
-0004bc80: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
-0004bc90: 2062 6520 7265 7475 726e 6564 2077 6974   be returned wit
-0004bca0: 686f 7574 2061 7474 7269 6275 7465 732e  hout attributes.
-0004bcb0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0004bcc0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0004bcd0: 2d0a 2020 2020 2020 2020 7265 6475 6365  -.        reduce
-0004bce0: 6420 3a20 4461 7461 7365 740a 2020 2020  d : Dataset.    
-0004bcf0: 2020 2020 2020 2020 4e65 7720 6044 6174          New `Dat
-0004bd00: 6173 6574 6020 6f62 6a65 6374 2077 6974  aset` object wit
-0004bd10: 6820 6069 6478 6d69 6e60 2061 7070 6c69  h `idxmin` appli
-0004bd20: 6564 2074 6f20 6974 7320 6461 7461 2061  ed to its data a
-0004bd30: 6e64 2074 6865 0a20 2020 2020 2020 2020  nd the.         
-0004bd40: 2020 2069 6e64 6963 6174 6564 2064 696d     indicated dim
-0004bd50: 656e 7369 6f6e 2072 656d 6f76 6564 2e0a  ension removed..
-0004bd60: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
-0004bd70: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
-0004bd80: 2d2d 0a20 2020 2020 2020 2044 6174 6141  --.        DataA
-0004bd90: 7272 6179 2e69 6478 6d69 6e2c 2044 6174  rray.idxmin, Dat
-0004bda0: 6173 6574 2e69 6478 6d61 782c 2044 6174  aset.idxmax, Dat
-0004bdb0: 6173 6574 2e6d 696e 2c20 4461 7461 7365  aset.min, Datase
-0004bdc0: 742e 6172 676d 696e 0a0a 2020 2020 2020  t.argmin..      
-0004bdd0: 2020 4578 616d 706c 6573 0a20 2020 2020    Examples.     
-0004bde0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-0004bdf0: 2020 2020 3e3e 3e20 6172 7261 7931 203d      >>> array1 =
-0004be00: 2078 722e 4461 7461 4172 7261 7928 0a20   xr.DataArray(. 
-0004be10: 2020 2020 2020 202e 2e2e 2020 2020 205b         ...     [
-0004be20: 302c 2032 2c20 312c 2030 2c20 2d32 5d2c  0, 2, 1, 0, -2],
-0004be30: 2064 696d 733d 2278 222c 2063 6f6f 7264   dims="x", coord
-0004be40: 733d 7b22 7822 3a20 5b22 6122 2c20 2262  s={"x": ["a", "b
-0004be50: 222c 2022 6322 2c20 2264 222c 2022 6522  ", "c", "d", "e"
-0004be60: 5d7d 0a20 2020 2020 2020 202e 2e2e 2029  ]}.        ... )
-0004be70: 0a20 2020 2020 2020 203e 3e3e 2061 7272  .        >>> arr
-0004be80: 6179 3220 3d20 7872 2e44 6174 6141 7272  ay2 = xr.DataArr
-0004be90: 6179 280a 2020 2020 2020 2020 2e2e 2e20  ay(.        ... 
-0004bea0: 2020 2020 5b0a 2020 2020 2020 2020 2e2e      [.        ..
-0004beb0: 2e20 2020 2020 2020 2020 5b32 2e30 2c20  .         [2.0, 
-0004bec0: 312e 302c 2032 2e30 2c20 302e 302c 202d  1.0, 2.0, 0.0, -
-0004bed0: 322e 305d 2c0a 2020 2020 2020 2020 2e2e  2.0],.        ..
-0004bee0: 2e20 2020 2020 2020 2020 5b2d 342e 302c  .         [-4.0,
-0004bef0: 206e 702e 4e61 4e2c 2032 2e30 2c20 6e70   np.NaN, 2.0, np
-0004bf00: 2e4e 614e 2c20 2d32 2e30 5d2c 0a20 2020  .NaN, -2.0],.   
-0004bf10: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
-0004bf20: 205b 6e70 2e4e 614e 2c20 6e70 2e4e 614e   [np.NaN, np.NaN
-0004bf30: 2c20 312e 302c 206e 702e 4e61 4e2c 206e  , 1.0, np.NaN, n
-0004bf40: 702e 4e61 4e5d 2c0a 2020 2020 2020 2020  p.NaN],.        
-0004bf50: 2e2e 2e20 2020 2020 5d2c 0a20 2020 2020  ...     ],.     
-0004bf60: 2020 202e 2e2e 2020 2020 2064 696d 733d     ...     dims=
-0004bf70: 5b22 7922 2c20 2278 225d 2c0a 2020 2020  ["y", "x"],.    
-0004bf80: 2020 2020 2e2e 2e20 2020 2020 636f 6f72      ...     coor
-0004bf90: 6473 3d7b 2279 223a 205b 2d31 2c20 302c  ds={"y": [-1, 0,
-0004bfa0: 2031 5d2c 2022 7822 3a20 5b22 6122 2c20   1], "x": ["a", 
-0004bfb0: 2262 222c 2022 6322 2c20 2264 222c 2022  "b", "c", "d", "
-0004bfc0: 6522 5d7d 2c0a 2020 2020 2020 2020 2e2e  e"]},.        ..
-0004bfd0: 2e20 290a 2020 2020 2020 2020 3e3e 3e20  . ).        >>> 
-0004bfe0: 6473 203d 2078 722e 4461 7461 7365 7428  ds = xr.Dataset(
-0004bff0: 7b22 696e 7422 3a20 6172 7261 7931 2c20  {"int": array1, 
-0004c000: 2266 6c6f 6174 223a 2061 7272 6179 327d  "float": array2}
-0004c010: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
-0004c020: 2e6d 696e 2864 696d 3d22 7822 290a 2020  .min(dim="x").  
-0004c030: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-0004c040: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-0004c050: 696d 656e 7369 6f6e 733a 2020 2879 3a20  imensions:  (y: 
-0004c060: 3329 0a20 2020 2020 2020 2043 6f6f 7264  3).        Coord
-0004c070: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-0004c080: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
-0004c090: 2069 6e74 3634 202d 3120 3020 310a 2020   int64 -1 0 1.  
-0004c0a0: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
-0004c0b0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-0004c0c0: 2020 696e 7420 2020 2020 2069 6e74 3634    int      int64
-0004c0d0: 202d 320a 2020 2020 2020 2020 2020 2020   -2.            
-0004c0e0: 666c 6f61 7420 2020 2028 7929 2066 6c6f  float    (y) flo
-0004c0f0: 6174 3634 202d 322e 3020 2d34 2e30 2031  at64 -2.0 -4.0 1
-0004c100: 2e30 0a20 2020 2020 2020 203e 3e3e 2064  .0.        >>> d
-0004c110: 732e 6172 676d 696e 2864 696d 3d22 7822  s.argmin(dim="x"
-0004c120: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
-0004c130: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
-0004c140: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
-0004c150: 2879 3a20 3329 0a20 2020 2020 2020 2043  (y: 3).        C
-0004c160: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
-0004c170: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
-0004c180: 2028 7929 2069 6e74 3634 202d 3120 3020   (y) int64 -1 0 
-0004c190: 310a 2020 2020 2020 2020 4461 7461 2076  1.        Data v
-0004c1a0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
-0004c1b0: 2020 2020 2020 696e 7420 2020 2020 2069        int      i
-0004c1c0: 6e74 3634 2034 0a20 2020 2020 2020 2020  nt64 4.         
-0004c1d0: 2020 2066 6c6f 6174 2020 2020 2879 2920     float    (y) 
-0004c1e0: 696e 7436 3420 3420 3020 320a 2020 2020  int64 4 0 2.    
-0004c1f0: 2020 2020 3e3e 3e20 6473 2e69 6478 6d69      >>> ds.idxmi
-0004c200: 6e28 6469 6d3d 2278 2229 0a20 2020 2020  n(dim="x").     
-0004c210: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
-0004c220: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
-0004c230: 6e73 696f 6e73 3a20 2028 793a 2033 290a  nsions:  (y: 3).
-0004c240: 2020 2020 2020 2020 436f 6f72 6469 6e61          Coordina
-0004c250: 7465 733a 0a20 2020 2020 2020 2020 202a  tes:.          *
-0004c260: 2079 2020 2020 2020 2020 2879 2920 696e   y        (y) in
-0004c270: 7436 3420 2d31 2030 2031 0a20 2020 2020  t64 -1 0 1.     
-0004c280: 2020 2044 6174 6120 7661 7269 6162 6c65     Data variable
-0004c290: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-0004c2a0: 6e74 2020 2020 2020 3c55 3120 2765 270a  nt      <U1 'e'.
-0004c2b0: 2020 2020 2020 2020 2020 2020 666c 6f61              floa
-0004c2c0: 7420 2020 2028 7929 206f 626a 6563 7420  t    (y) object 
-0004c2d0: 2765 2720 2761 2720 2763 270a 2020 2020  'e' 'a' 'c'.    
-0004c2e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0004c2f0: 7265 7475 726e 2073 656c 662e 6d61 7028  return self.map(
-0004c300: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-0004c310: 686f 6463 616c 6c65 7228 0a20 2020 2020  hodcaller(.     
-0004c320: 2020 2020 2020 2020 2020 2022 6964 786d             "idxm
-0004c330: 696e 222c 0a20 2020 2020 2020 2020 2020  in",.           
-0004c340: 2020 2020 2064 696d 3d64 696d 2c0a 2020       dim=dim,.  
-0004c350: 2020 2020 2020 2020 2020 2020 2020 736b                sk
-0004c360: 6970 6e61 3d73 6b69 706e 612c 0a20 2020  ipna=skipna,.   
-0004c370: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0004c380: 6c5f 7661 6c75 653d 6669 6c6c 5f76 616c  l_value=fill_val
-0004c390: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0004c3a0: 2020 2020 6b65 6570 5f61 7474 7273 3d6b      keep_attrs=k
-0004c3b0: 6565 705f 6174 7472 732c 0a20 2020 2020  eep_attrs,.     
-0004c3c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0004c3d0: 2029 0a0a 2020 2020 6465 6620 6964 786d   )..    def idxm
-0004c3e0: 6178 280a 2020 2020 2020 2020 7365 6c66  ax(.        self
-0004c3f0: 3a20 545f 4461 7461 7365 742c 0a20 2020  : T_Dataset,.   
-0004c400: 2020 2020 2064 696d 3a20 4861 7368 6162       dim: Hashab
-0004c410: 6c65 207c 204e 6f6e 6520 3d20 4e6f 6e65  le | None = None
-0004c420: 2c0a 2020 2020 2020 2020 736b 6970 6e61  ,.        skipna
-0004c430: 3a20 626f 6f6c 207c 204e 6f6e 6520 3d20  : bool | None = 
-0004c440: 4e6f 6e65 2c0a 2020 2020 2020 2020 6669  None,.        fi
-0004c450: 6c6c 5f76 616c 7565 3a20 416e 7920 3d20  ll_value: Any = 
-0004c460: 7872 6474 7970 6573 2e4e 412c 0a20 2020  xrdtypes.NA,.   
-0004c470: 2020 2020 206b 6565 705f 6174 7472 733a       keep_attrs:
-0004c480: 2062 6f6f 6c20 7c20 4e6f 6e65 203d 204e   bool | None = N
-0004c490: 6f6e 652c 0a20 2020 2029 202d 3e20 545f  one,.    ) -> T_
-0004c4a0: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-0004c4b0: 2022 2222 5265 7475 726e 2074 6865 2063   """Return the c
-0004c4c0: 6f6f 7264 696e 6174 6520 6c61 6265 6c20  oordinate label 
-0004c4d0: 6f66 2074 6865 206d 6178 696d 756d 2076  of the maximum v
-0004c4e0: 616c 7565 2061 6c6f 6e67 2061 2064 696d  alue along a dim
-0004c4f0: 656e 7369 6f6e 2e0a 0a20 2020 2020 2020  ension...       
-0004c500: 2052 6574 7572 6e73 2061 206e 6577 2060   Returns a new `
-0004c510: 4461 7461 7365 7460 206e 616d 6564 2061  Dataset` named a
-0004c520: 6674 6572 2074 6865 2064 696d 656e 7369  fter the dimensi
-0004c530: 6f6e 2077 6974 6820 7468 6520 7661 6c75  on with the valu
-0004c540: 6573 206f 660a 2020 2020 2020 2020 7468  es of.        th
-0004c550: 6520 636f 6f72 6469 6e61 7465 206c 6162  e coordinate lab
-0004c560: 656c 7320 616c 6f6e 6720 7468 6174 2064  els along that d
-0004c570: 696d 656e 7369 6f6e 2063 6f72 7265 7370  imension corresp
-0004c580: 6f6e 6469 6e67 2074 6f20 6d61 7869 6d75  onding to maximu
-0004c590: 6d0a 2020 2020 2020 2020 7661 6c75 6573  m.        values
-0004c5a0: 2061 6c6f 6e67 2074 6861 7420 6469 6d65   along that dime
-0004c5b0: 6e73 696f 6e2e 0a0a 2020 2020 2020 2020  nsion...        
-0004c5c0: 496e 2063 6f6d 7061 7269 736f 6e20 746f  In comparison to
-0004c5d0: 203a 7079 3a6d 6574 683a 607e 4461 7461   :py:meth:`~Data
-0004c5e0: 7365 742e 6172 676d 6178 602c 2074 6869  set.argmax`, thi
-0004c5f0: 7320 7265 7475 726e 7320 7468 650a 2020  s returns the.  
-0004c600: 2020 2020 2020 636f 6f72 6469 6e61 7465        coordinate
-0004c610: 206c 6162 656c 2077 6869 6c65 203a 7079   label while :py
-0004c620: 3a6d 6574 683a 607e 4461 7461 7365 742e  :meth:`~Dataset.
-0004c630: 6172 676d 6178 6020 7265 7475 726e 7320  argmax` returns 
-0004c640: 7468 6520 696e 6465 782e 0a0a 2020 2020  the index...    
-0004c650: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0004c660: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0004c670: 2d0a 2020 2020 2020 2020 6469 6d20 3a20  -.        dim : 
-0004c680: 7374 722c 206f 7074 696f 6e61 6c0a 2020  str, optional.  
-0004c690: 2020 2020 2020 2020 2020 4469 6d65 6e73            Dimens
-0004c6a0: 696f 6e20 6f76 6572 2077 6869 6368 2074  ion over which t
-0004c6b0: 6f20 6170 706c 7920 6069 6478 6d61 7860  o apply `idxmax`
-0004c6c0: 2e20 2054 6869 7320 6973 206f 7074 696f  .  This is optio
-0004c6d0: 6e61 6c20 666f 7220 3144 0a20 2020 2020  nal for 1D.     
-0004c6e0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
-0004c6f0: 2c20 6275 7420 7265 7175 6972 6564 2066  , but required f
-0004c700: 6f72 2076 6172 6961 626c 6573 2077 6974  or variables wit
-0004c710: 6820 3220 6f72 206d 6f72 6520 6469 6d65  h 2 or more dime
-0004c720: 6e73 696f 6e73 2e0a 2020 2020 2020 2020  nsions..        
-0004c730: 736b 6970 6e61 203a 2062 6f6f 6c20 6f72  skipna : bool or
-0004c740: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
-0004c750: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-0004c760: 7275 652c 2073 6b69 7020 6d69 7373 696e  rue, skip missin
-0004c770: 6720 7661 6c75 6573 2028 6173 206d 6172  g values (as mar
-0004c780: 6b65 6420 6279 204e 614e 292e 2042 7920  ked by NaN). By 
-0004c790: 6465 6661 756c 742c 206f 6e6c 790a 2020  default, only.  
-0004c7a0: 2020 2020 2020 2020 2020 736b 6970 7320            skips 
-0004c7b0: 6d69 7373 696e 6720 7661 6c75 6573 2066  missing values f
-0004c7c0: 6f72 2060 6066 6c6f 6174 6060 2c20 6060  or ``float``, ``
-0004c7d0: 636f 6d70 6c65 7860 602c 2061 6e64 2060  complex``, and `
-0004c7e0: 606f 626a 6563 7460 600a 2020 2020 2020  `object``.      
-0004c7f0: 2020 2020 2020 6474 7970 6573 3b20 6f74        dtypes; ot
-0004c800: 6865 7220 6474 7970 6573 2065 6974 6865  her dtypes eithe
-0004c810: 7220 646f 206e 6f74 2068 6176 6520 6120  r do not have a 
-0004c820: 7365 6e74 696e 656c 206d 6973 7369 6e67  sentinel missing
-0004c830: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
-0004c840: 2020 2028 6060 696e 7460 6029 206f 7220     (``int``) or 
-0004c850: 6060 736b 6970 6e61 3d54 7275 6560 6020  ``skipna=True`` 
-0004c860: 6861 7320 6e6f 7420 6265 656e 2069 6d70  has not been imp
-0004c870: 6c65 6d65 6e74 6564 0a20 2020 2020 2020  lemented.       
-0004c880: 2020 2020 2028 6060 6461 7465 7469 6d65       (``datetime
-0004c890: 3634 6060 206f 7220 6060 7469 6d65 6465  64`` or ``timede
-0004c8a0: 6c74 6136 3460 6029 2e0a 2020 2020 2020  lta64``)..      
-0004c8b0: 2020 6669 6c6c 5f76 616c 7565 203a 2041    fill_value : A
-0004c8c0: 6e79 2c20 6465 6661 756c 743a 204e 614e  ny, default: NaN
-0004c8d0: 0a20 2020 2020 2020 2020 2020 2056 616c  .            Val
-0004c8e0: 7565 2074 6f20 6265 2066 696c 6c65 6420  ue to be filled 
-0004c8f0: 696e 2063 6173 6520 616c 6c20 6f66 2074  in case all of t
-0004c900: 6865 2076 616c 7565 7320 616c 6f6e 6720  he values along 
-0004c910: 6120 6469 6d65 6e73 696f 6e20 6172 650a  a dimension are.
-0004c920: 2020 2020 2020 2020 2020 2020 6e75 6c6c              null
-0004c930: 2e20 2042 7920 6465 6661 756c 7420 7468  .  By default th
-0004c940: 6973 2069 7320 4e61 4e2e 2020 5468 6520  is is NaN.  The 
-0004c950: 6669 6c6c 2076 616c 7565 2061 6e64 2072  fill value and r
-0004c960: 6573 756c 7420 6172 650a 2020 2020 2020  esult are.      
-0004c970: 2020 2020 2020 6175 746f 6d61 7469 6361        automatica
-0004c980: 6c6c 7920 636f 6e76 6572 7465 6420 746f  lly converted to
-0004c990: 2061 2063 6f6d 7061 7469 626c 6520 6474   a compatible dt
-0004c9a0: 7970 6520 6966 2070 6f73 7369 626c 652e  ype if possible.
-0004c9b0: 0a20 2020 2020 2020 2020 2020 2049 676e  .            Ign
-0004c9c0: 6f72 6564 2069 6620 6060 736b 6970 6e61  ored if ``skipna
-0004c9d0: 6060 2069 7320 4661 6c73 652e 0a20 2020  `` is False..   
-0004c9e0: 2020 2020 206b 6565 705f 6174 7472 7320       keep_attrs 
-0004c9f0: 3a20 626f 6f6c 206f 7220 4e6f 6e65 2c20  : bool or None, 
-0004ca00: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0004ca10: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-0004ca20: 6520 6174 7472 6962 7574 6573 2028 6060  e attributes (``
-0004ca30: 6174 7472 7360 6029 2077 696c 6c20 6265  attrs``) will be
-0004ca40: 2063 6f70 6965 6420 6672 6f6d 2074 6865   copied from the
-0004ca50: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-0004ca60: 6769 6e61 6c20 6f62 6a65 6374 2074 6f20  ginal object to 
-0004ca70: 7468 6520 6e65 7720 6f6e 652e 2049 6620  the new one. If 
-0004ca80: 4661 6c73 652c 2074 6865 206e 6577 206f  False, the new o
-0004ca90: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
-0004caa0: 2020 7769 6c6c 2062 6520 7265 7475 726e    will be return
-0004cab0: 6564 2077 6974 686f 7574 2061 7474 7269  ed without attri
-0004cac0: 6275 7465 732e 0a0a 2020 2020 2020 2020  butes...        
-0004cad0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-0004cae0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0004caf0: 7265 6475 6365 6420 3a20 4461 7461 7365  reduced : Datase
-0004cb00: 740a 2020 2020 2020 2020 2020 2020 4e65  t.            Ne
-0004cb10: 7720 6044 6174 6173 6574 6020 6f62 6a65  w `Dataset` obje
-0004cb20: 6374 2077 6974 6820 6069 6478 6d61 7860  ct with `idxmax`
-0004cb30: 2061 7070 6c69 6564 2074 6f20 6974 7320   applied to its 
-0004cb40: 6461 7461 2061 6e64 2074 6865 0a20 2020  data and the.   
-0004cb50: 2020 2020 2020 2020 2069 6e64 6963 6174           indicat
-0004cb60: 6564 2064 696d 656e 7369 6f6e 2072 656d  ed dimension rem
-0004cb70: 6f76 6564 2e0a 0a20 2020 2020 2020 2053  oved...        S
-0004cb80: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-0004cb90: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0004cba0: 2044 6174 6141 7272 6179 2e69 6478 6d61   DataArray.idxma
-0004cbb0: 782c 2044 6174 6173 6574 2e69 6478 6d69  x, Dataset.idxmi
-0004cbc0: 6e2c 2044 6174 6173 6574 2e6d 6178 2c20  n, Dataset.max, 
-0004cbd0: 4461 7461 7365 742e 6172 676d 6178 0a0a  Dataset.argmax..
-0004cbe0: 2020 2020 2020 2020 4578 616d 706c 6573          Examples
-0004cbf0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0004cc00: 2d0a 2020 2020 2020 2020 3e3e 3e20 6172  -.        >>> ar
-0004cc10: 7261 7931 203d 2078 722e 4461 7461 4172  ray1 = xr.DataAr
-0004cc20: 7261 7928 0a20 2020 2020 2020 202e 2e2e  ray(.        ...
-0004cc30: 2020 2020 205b 302c 2032 2c20 312c 2030       [0, 2, 1, 0
-0004cc40: 2c20 2d32 5d2c 2064 696d 733d 2278 222c  , -2], dims="x",
-0004cc50: 2063 6f6f 7264 733d 7b22 7822 3a20 5b22   coords={"x": ["
-0004cc60: 6122 2c20 2262 222c 2022 6322 2c20 2264  a", "b", "c", "d
-0004cc70: 222c 2022 6522 5d7d 0a20 2020 2020 2020  ", "e"]}.       
-0004cc80: 202e 2e2e 2029 0a20 2020 2020 2020 203e   ... ).        >
-0004cc90: 3e3e 2061 7272 6179 3220 3d20 7872 2e44  >> array2 = xr.D
-0004cca0: 6174 6141 7272 6179 280a 2020 2020 2020  ataArray(.      
-0004ccb0: 2020 2e2e 2e20 2020 2020 5b0a 2020 2020    ...     [.    
-0004ccc0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0004ccd0: 5b32 2e30 2c20 312e 302c 2032 2e30 2c20  [2.0, 1.0, 2.0, 
-0004cce0: 302e 302c 202d 322e 305d 2c0a 2020 2020  0.0, -2.0],.    
-0004ccf0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-0004cd00: 5b2d 342e 302c 206e 702e 4e61 4e2c 2032  [-4.0, np.NaN, 2
-0004cd10: 2e30 2c20 6e70 2e4e 614e 2c20 2d32 2e30  .0, np.NaN, -2.0
-0004cd20: 5d2c 0a20 2020 2020 2020 202e 2e2e 2020  ],.        ...  
-0004cd30: 2020 2020 2020 205b 6e70 2e4e 614e 2c20         [np.NaN, 
-0004cd40: 6e70 2e4e 614e 2c20 312e 302c 206e 702e  np.NaN, 1.0, np.
-0004cd50: 4e61 4e2c 206e 702e 4e61 4e5d 2c0a 2020  NaN, np.NaN],.  
-0004cd60: 2020 2020 2020 2e2e 2e20 2020 2020 5d2c        ...     ],
-0004cd70: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-0004cd80: 2064 696d 733d 5b22 7922 2c20 2278 225d   dims=["y", "x"]
-0004cd90: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-0004cda0: 2020 636f 6f72 6473 3d7b 2279 223a 205b    coords={"y": [
-0004cdb0: 2d31 2c20 302c 2031 5d2c 2022 7822 3a20  -1, 0, 1], "x": 
-0004cdc0: 5b22 6122 2c20 2262 222c 2022 6322 2c20  ["a", "b", "c", 
-0004cdd0: 2264 222c 2022 6522 5d7d 2c0a 2020 2020  "d", "e"]},.    
-0004cde0: 2020 2020 2e2e 2e20 290a 2020 2020 2020      ... ).      
-0004cdf0: 2020 3e3e 3e20 6473 203d 2078 722e 4461    >>> ds = xr.Da
-0004ce00: 7461 7365 7428 7b22 696e 7422 3a20 6172  taset({"int": ar
-0004ce10: 7261 7931 2c20 2266 6c6f 6174 223a 2061  ray1, "float": a
-0004ce20: 7272 6179 327d 290a 2020 2020 2020 2020  rray2}).        
-0004ce30: 3e3e 3e20 6473 2e6d 6178 2864 696d 3d22  >>> ds.max(dim="
-0004ce40: 7822 290a 2020 2020 2020 2020 3c78 6172  x").        <xar
-0004ce50: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
-0004ce60: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
-0004ce70: 2020 2879 3a20 3329 0a20 2020 2020 2020    (y: 3).       
-0004ce80: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
-0004ce90: 2020 2020 2020 2020 2a20 7920 2020 2020          * y     
-0004cea0: 2020 2028 7929 2069 6e74 3634 202d 3120     (y) int64 -1 
-0004ceb0: 3020 310a 2020 2020 2020 2020 4461 7461  0 1.        Data
-0004cec0: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
-0004ced0: 2020 2020 2020 2020 696e 7420 2020 2020          int     
-0004cee0: 2069 6e74 3634 2032 0a20 2020 2020 2020   int64 2.       
-0004cef0: 2020 2020 2066 6c6f 6174 2020 2020 2879       float    (y
-0004cf00: 2920 666c 6f61 7436 3420 322e 3020 322e  ) float64 2.0 2.
-0004cf10: 3020 312e 300a 2020 2020 2020 2020 3e3e  0 1.0.        >>
-0004cf20: 3e20 6473 2e61 7267 6d61 7828 6469 6d3d  > ds.argmax(dim=
-0004cf30: 2278 2229 0a20 2020 2020 2020 203c 7861  "x").        <xa
-0004cf40: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
-0004cf50: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
-0004cf60: 3a20 2028 793a 2033 290a 2020 2020 2020  :  (y: 3).      
-0004cf70: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
-0004cf80: 2020 2020 2020 2020 202a 2079 2020 2020           * y    
-0004cf90: 2020 2020 2879 2920 696e 7436 3420 2d31      (y) int64 -1
-0004cfa0: 2030 2031 0a20 2020 2020 2020 2044 6174   0 1.        Dat
-0004cfb0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-0004cfc0: 2020 2020 2020 2020 2069 6e74 2020 2020           int    
-0004cfd0: 2020 696e 7436 3420 310a 2020 2020 2020    int64 1.      
-0004cfe0: 2020 2020 2020 666c 6f61 7420 2020 2028        float    (
-0004cff0: 7929 2069 6e74 3634 2030 2032 2032 0a20  y) int64 0 2 2. 
-0004d000: 2020 2020 2020 203e 3e3e 2064 732e 6964         >>> ds.id
-0004d010: 786d 6178 2864 696d 3d22 7822 290a 2020  xmax(dim="x").  
-0004d020: 2020 2020 2020 3c78 6172 7261 792e 4461        <xarray.Da
-0004d030: 7461 7365 743e 0a20 2020 2020 2020 2044  taset>.        D
-0004d040: 696d 656e 7369 6f6e 733a 2020 2879 3a20  imensions:  (y: 
-0004d050: 3329 0a20 2020 2020 2020 2043 6f6f 7264  3).        Coord
-0004d060: 696e 6174 6573 3a0a 2020 2020 2020 2020  inates:.        
-0004d070: 2020 2a20 7920 2020 2020 2020 2028 7929    * y        (y)
-0004d080: 2069 6e74 3634 202d 3120 3020 310a 2020   int64 -1 0 1.  
-0004d090: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
-0004d0a0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-0004d0b0: 2020 696e 7420 2020 2020 203c 5531 2027    int      <U1 '
-0004d0c0: 6227 0a20 2020 2020 2020 2020 2020 2066  b'.            f
-0004d0d0: 6c6f 6174 2020 2020 2879 2920 6f62 6a65  loat    (y) obje
-0004d0e0: 6374 2027 6127 2027 6327 2027 6327 0a20  ct 'a' 'c' 'c'. 
-0004d0f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0004d100: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-0004d110: 6170 280a 2020 2020 2020 2020 2020 2020  ap(.            
-0004d120: 6d65 7468 6f64 6361 6c6c 6572 280a 2020  methodcaller(.  
-0004d130: 2020 2020 2020 2020 2020 2020 2020 2269                "i
-0004d140: 6478 6d61 7822 2c0a 2020 2020 2020 2020  dxmax",.        
-0004d150: 2020 2020 2020 2020 6469 6d3d 6469 6d2c          dim=dim,
-0004d160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d170: 2073 6b69 706e 613d 736b 6970 6e61 2c0a   skipna=skipna,.
-0004d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d190: 6669 6c6c 5f76 616c 7565 3d66 696c 6c5f  fill_value=fill_
-0004d1a0: 7661 6c75 652c 0a20 2020 2020 2020 2020  value,.         
-0004d1b0: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
-0004d1c0: 733d 6b65 6570 5f61 7474 7273 2c0a 2020  s=keep_attrs,.  
-0004d1d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0004d1e0: 2020 2020 290a 0a20 2020 2064 6566 2061      )..    def a
-0004d1f0: 7267 6d69 6e28 7365 6c66 3a20 545f 4461  rgmin(self: T_Da
-0004d200: 7461 7365 742c 2064 696d 3a20 4861 7368  taset, dim: Hash
-0004d210: 6162 6c65 207c 204e 6f6e 6520 3d20 4e6f  able | None = No
-0004d220: 6e65 2c20 2a2a 6b77 6172 6773 2920 2d3e  ne, **kwargs) ->
-0004d230: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-0004d240: 2020 2020 2222 2249 6e64 6963 6573 206f      """Indices o
-0004d250: 6620 7468 6520 6d69 6e69 6d61 206f 6620  f the minima of 
-0004d260: 7468 6520 6d65 6d62 6572 2076 6172 6961  the member varia
-0004d270: 626c 6573 2e0a 0a20 2020 2020 2020 2049  bles...        I
-0004d280: 6620 7468 6572 6520 6172 6520 6d75 6c74  f there are mult
-0004d290: 6970 6c65 206d 696e 696d 612c 2074 6865  iple minima, the
-0004d2a0: 2069 6e64 6963 6573 206f 6620 7468 6520   indices of the 
-0004d2b0: 6669 7273 7420 6f6e 6520 666f 756e 6420  first one found 
-0004d2c0: 7769 6c6c 2062 650a 2020 2020 2020 2020  will be.        
-0004d2d0: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
-0004d2e0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0004d2f0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0004d300: 0a20 2020 2020 2020 2064 696d 203a 2048  .        dim : H
-0004d310: 6173 6861 626c 652c 206f 7074 696f 6e61  ashable, optiona
-0004d320: 6c0a 2020 2020 2020 2020 2020 2020 5468  l.            Th
-0004d330: 6520 6469 6d65 6e73 696f 6e20 6f76 6572  e dimension over
-0004d340: 2077 6869 6368 2074 6f20 6669 6e64 2074   which to find t
-0004d350: 6865 206d 696e 696d 756d 2e20 4279 2064  he minimum. By d
-0004d360: 6566 6175 6c74 2c20 6669 6e64 7320 6d69  efault, finds mi
-0004d370: 6e69 6d75 6d20 6f76 6572 0a20 2020 2020  nimum over.     
-0004d380: 2020 2020 2020 2061 6c6c 2064 696d 656e         all dimen
-0004d390: 7369 6f6e 7320 2d20 666f 7220 6e6f 7720  sions - for now 
-0004d3a0: 7265 7475 726e 696e 6720 616e 2069 6e74  returning an int
-0004d3b0: 2066 6f72 2062 6163 6b77 6172 6420 636f   for backward co
-0004d3c0: 6d70 6174 6962 696c 6974 792c 2062 7574  mpatibility, but
-0004d3d0: 0a20 2020 2020 2020 2020 2020 2074 6869  .            thi
-0004d3e0: 7320 6973 2064 6570 7265 6361 7465 642c  s is deprecated,
-0004d3f0: 2069 6e20 6675 7475 7265 2077 696c 6c20   in future will 
-0004d400: 6265 2061 6e20 6572 726f 722c 2073 696e  be an error, sin
-0004d410: 6365 2044 6174 6141 7272 6179 2e61 7267  ce DataArray.arg
-0004d420: 6d69 6e20 7769 6c6c 0a20 2020 2020 2020  min will.       
-0004d430: 2020 2020 2072 6574 7572 6e20 6120 6469       return a di
-0004d440: 6374 2077 6974 6820 696e 6469 6365 7320  ct with indices 
-0004d450: 666f 7220 616c 6c20 6469 6d65 6e73 696f  for all dimensio
-0004d460: 6e73 2c20 7768 6963 6820 646f 6573 206e  ns, which does n
-0004d470: 6f74 206d 616b 6520 7365 6e73 6520 666f  ot make sense fo
-0004d480: 720a 2020 2020 2020 2020 2020 2020 6120  r.            a 
-0004d490: 4461 7461 7365 742e 0a20 2020 2020 2020  Dataset..       
-0004d4a0: 206b 6565 705f 6174 7472 7320 3a20 626f   keep_attrs : bo
-0004d4b0: 6f6c 2c20 6f70 7469 6f6e 616c 0a20 2020  ol, optional.   
-0004d4c0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-0004d4d0: 2c20 7468 6520 6174 7472 6962 7574 6573  , the attributes
-0004d4e0: 2028 6061 7474 7273 6029 2077 696c 6c20   (`attrs`) will 
-0004d4f0: 6265 2063 6f70 6965 6420 6672 6f6d 2074  be copied from t
-0004d500: 6865 206f 7269 6769 6e61 6c0a 2020 2020  he original.    
-0004d510: 2020 2020 2020 2020 6f62 6a65 6374 2074          object t
-0004d520: 6f20 7468 6520 6e65 7720 6f6e 652e 2020  o the new one.  
-0004d530: 4966 2046 616c 7365 2028 6465 6661 756c  If False (defaul
-0004d540: 7429 2c20 7468 6520 6e65 7720 6f62 6a65  t), the new obje
-0004d550: 6374 2077 696c 6c20 6265 0a20 2020 2020  ct will be.     
-0004d560: 2020 2020 2020 2072 6574 7572 6e65 6420         returned 
-0004d570: 7769 7468 6f75 7420 6174 7472 6962 7574  without attribut
-0004d580: 6573 2e0a 2020 2020 2020 2020 736b 6970  es..        skip
-0004d590: 6e61 203a 2062 6f6f 6c2c 206f 7074 696f  na : bool, optio
-0004d5a0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0004d5b0: 4966 2054 7275 652c 2073 6b69 7020 6d69  If True, skip mi
-0004d5c0: 7373 696e 6720 7661 6c75 6573 2028 6173  ssing values (as
-0004d5d0: 206d 6172 6b65 6420 6279 204e 614e 292e   marked by NaN).
-0004d5e0: 2042 7920 6465 6661 756c 742c 206f 6e6c   By default, onl
-0004d5f0: 790a 2020 2020 2020 2020 2020 2020 736b  y.            sk
-0004d600: 6970 7320 6d69 7373 696e 6720 7661 6c75  ips missing valu
-0004d610: 6573 2066 6f72 2066 6c6f 6174 2064 7479  es for float dty
-0004d620: 7065 733b 206f 7468 6572 2064 7479 7065  pes; other dtype
-0004d630: 7320 6569 7468 6572 2064 6f20 6e6f 740a  s either do not.
-0004d640: 2020 2020 2020 2020 2020 2020 6861 7665              have
-0004d650: 2061 2073 656e 7469 6e65 6c20 6d69 7373   a sentinel miss
-0004d660: 696e 6720 7661 6c75 6520 2869 6e74 2920  ing value (int) 
-0004d670: 6f72 2073 6b69 706e 613d 5472 7565 2068  or skipna=True h
-0004d680: 6173 206e 6f74 2062 6565 6e0a 2020 2020  as not been.    
-0004d690: 2020 2020 2020 2020 696d 706c 656d 656e          implemen
-0004d6a0: 7465 6420 286f 626a 6563 742c 2064 6174  ted (object, dat
-0004d6b0: 6574 696d 6536 3420 6f72 2074 696d 6564  etime64 or timed
-0004d6c0: 656c 7461 3634 292e 0a0a 2020 2020 2020  elta64)...      
-0004d6d0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0004d6e0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-0004d6f0: 2020 7265 7375 6c74 203a 2044 6174 6173    result : Datas
-0004d700: 6574 0a0a 2020 2020 2020 2020 5365 6520  et..        See 
-0004d710: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-0004d720: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
-0004d730: 7461 4172 7261 792e 6172 676d 696e 0a20  taArray.argmin. 
-0004d740: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0004d750: 2020 2069 6620 6469 6d20 6973 204e 6f6e     if dim is Non
-0004d760: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
-0004d770: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-0004d780: 2020 2020 2020 2020 2020 2020 2020 224f                "O
-0004d790: 6e63 6520 7468 6520 6265 6861 7669 6f75  nce the behaviou
-0004d7a0: 7220 6f66 2044 6174 6141 7272 6179 2e61  r of DataArray.a
-0004d7b0: 7267 6d69 6e28 2920 616e 6420 5661 7269  rgmin() and Vari
-0004d7c0: 6162 6c65 2e61 7267 6d69 6e28 2920 7769  able.argmin() wi
-0004d7d0: 7468 6f75 7420 220a 2020 2020 2020 2020  thout ".        
-0004d7e0: 2020 2020 2020 2020 2264 696d 2063 6861          "dim cha
-0004d7f0: 6e67 6573 2074 6f20 7265 7475 726e 2061  nges to return a
-0004d800: 2064 6963 7420 6f66 2069 6e64 6963 6573   dict of indices
-0004d810: 206f 6620 6561 6368 2064 696d 656e 7369   of each dimensi
-0004d820: 6f6e 2c20 666f 7220 220a 2020 2020 2020  on, for ".      
-0004d830: 2020 2020 2020 2020 2020 2263 6f6e 7369            "consi
-0004d840: 7374 656e 6379 2069 7420 7769 6c6c 2062  stency it will b
-0004d850: 6520 616e 2065 7272 6f72 2074 6f20 6361  e an error to ca
-0004d860: 6c6c 2044 6174 6173 6574 2e61 7267 6d69  ll Dataset.argmi
-0004d870: 6e28 2920 7769 7468 206e 6f20 6172 6775  n() with no argu
-0004d880: 6d65 6e74 2c22 0a20 2020 2020 2020 2020  ment,".         
-0004d890: 2020 2020 2020 2022 7369 6e63 6520 7765         "since we
-0004d8a0: 2064 6f6e 2774 2072 6574 7572 6e20 6120   don't return a 
-0004d8b0: 6469 6374 206f 6620 4461 7461 7365 7473  dict of Datasets
-0004d8c0: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
-0004d8d0: 2020 2020 4465 7072 6563 6174 696f 6e57      DeprecationW
-0004d8e0: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
-0004d8f0: 2020 2020 2020 2020 7374 6163 6b6c 6576          stacklev
-0004d900: 656c 3d32 2c0a 2020 2020 2020 2020 2020  el=2,.          
-0004d910: 2020 290a 2020 2020 2020 2020 6966 2028    ).        if (
-0004d920: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-0004d930: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
-0004d940: 2020 2020 206f 7220 286e 6f74 2069 7369       or (not isi
-0004d950: 6e73 7461 6e63 6528 6469 6d2c 2053 6571  nstance(dim, Seq
-0004d960: 7565 6e63 6529 2061 6e64 2064 696d 2069  uence) and dim i
-0004d970: 7320 6e6f 7420 2e2e 2e29 0a20 2020 2020  s not ...).     
-0004d980: 2020 2020 2020 206f 7220 6973 696e 7374         or isinst
-0004d990: 616e 6365 2864 696d 2c20 7374 7229 0a20  ance(dim, str). 
-0004d9a0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0004d9b0: 2020 2020 2020 2320 5265 7475 726e 2069        # Return i
-0004d9c0: 6e74 2069 6e64 6578 2069 6620 7369 6e67  nt index if sing
-0004d9d0: 6c65 2064 696d 656e 7369 6f6e 2069 7320  le dimension is 
-0004d9e0: 7061 7373 6564 2c20 616e 6420 6973 206e  passed, and is n
-0004d9f0: 6f74 2070 6172 7420 6f66 2061 0a20 2020  ot part of a.   
-0004da00: 2020 2020 2020 2020 2023 2073 6571 7565           # seque
-0004da10: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
-0004da20: 6172 676d 696e 5f66 756e 6320 3d20 6765  argmin_func = ge
-0004da30: 7461 7474 7228 6475 636b 5f61 7272 6179  tattr(duck_array
-0004da40: 5f6f 7073 2c20 2261 7267 6d69 6e22 290a  _ops, "argmin").
-0004da50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0004da60: 726e 2073 656c 662e 7265 6475 6365 280a  rn self.reduce(.
-0004da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004da80: 6172 676d 696e 5f66 756e 632c 2064 696d  argmin_func, dim
-0004da90: 3d4e 6f6e 6520 6966 2064 696d 2069 7320  =None if dim is 
-0004daa0: 4e6f 6e65 2065 6c73 6520 5b64 696d 5d2c  None else [dim],
-0004dab0: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
-0004dac0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0004dad0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0004dae0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0004daf0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0004db00: 2020 2020 2257 6865 6e20 6469 6d20 6973      "When dim is
-0004db10: 2061 2073 6571 7565 6e63 6520 6f72 202e   a sequence or .
-0004db20: 2e2e 2c20 4461 7461 4172 7261 792e 6172  .., DataArray.ar
-0004db30: 676d 696e 2829 2072 6574 7572 6e73 2061  gmin() returns a
-0004db40: 2064 6963 742e 2022 0a20 2020 2020 2020   dict. ".       
-0004db50: 2020 2020 2020 2020 2022 6469 6374 7320           "dicts 
-0004db60: 6361 6e6e 6f74 2062 6520 636f 6e74 6169  cannot be contai
-0004db70: 6e65 6420 696e 2061 2044 6174 6173 6574  ned in a Dataset
-0004db80: 2c20 736f 2063 616e 6e6f 7420 6361 6c6c  , so cannot call
-0004db90: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0004dba0: 2020 2022 4461 7461 7365 742e 6172 676d     "Dataset.argm
-0004dbb0: 696e 2829 2077 6974 6820 6120 7365 7175  in() with a sequ
-0004dbc0: 656e 6365 206f 7220 2e2e 2e20 666f 7220  ence or ... for 
-0004dbd0: 6469 6d22 0a20 2020 2020 2020 2020 2020  dim".           
-0004dbe0: 2029 0a0a 2020 2020 6465 6620 6172 676d   )..    def argm
-0004dbf0: 6178 2873 656c 663a 2054 5f44 6174 6173  ax(self: T_Datas
-0004dc00: 6574 2c20 6469 6d3a 2048 6173 6861 626c  et, dim: Hashabl
-0004dc10: 6520 7c20 4e6f 6e65 203d 204e 6f6e 652c  e | None = None,
-0004dc20: 202a 2a6b 7761 7267 7329 202d 3e20 545f   **kwargs) -> T_
-0004dc30: 4461 7461 7365 743a 0a20 2020 2020 2020  Dataset:.       
-0004dc40: 2022 2222 496e 6469 6365 7320 6f66 2074   """Indices of t
-0004dc50: 6865 206d 6178 696d 6120 6f66 2074 6865  he maxima of the
-0004dc60: 206d 656d 6265 7220 7661 7269 6162 6c65   member variable
-0004dc70: 732e 0a0a 2020 2020 2020 2020 4966 2074  s...        If t
-0004dc80: 6865 7265 2061 7265 206d 756c 7469 706c  here are multipl
-0004dc90: 6520 6d61 7869 6d61 2c20 7468 6520 696e  e maxima, the in
-0004dca0: 6469 6365 7320 6f66 2074 6865 2066 6972  dices of the fir
-0004dcb0: 7374 206f 6e65 2066 6f75 6e64 2077 696c  st one found wil
-0004dcc0: 6c20 6265 0a20 2020 2020 2020 2072 6574  l be.        ret
-0004dcd0: 7572 6e65 642e 0a0a 2020 2020 2020 2020  urned...        
-0004dce0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0004dcf0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0004dd00: 2020 2020 2020 6469 6d20 3a20 7374 722c        dim : str,
-0004dd10: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0004dd20: 2020 2020 2020 5468 6520 6469 6d65 6e73        The dimens
-0004dd30: 696f 6e20 6f76 6572 2077 6869 6368 2074  ion over which t
-0004dd40: 6f20 6669 6e64 2074 6865 206d 6178 696d  o find the maxim
-0004dd50: 756d 2e20 4279 2064 6566 6175 6c74 2c20  um. By default, 
-0004dd60: 6669 6e64 7320 6d61 7869 6d75 6d20 6f76  finds maximum ov
-0004dd70: 6572 0a20 2020 2020 2020 2020 2020 2061  er.            a
-0004dd80: 6c6c 2064 696d 656e 7369 6f6e 7320 2d20  ll dimensions - 
-0004dd90: 666f 7220 6e6f 7720 7265 7475 726e 696e  for now returnin
-0004dda0: 6720 616e 2069 6e74 2066 6f72 2062 6163  g an int for bac
-0004ddb0: 6b77 6172 6420 636f 6d70 6174 6962 696c  kward compatibil
-0004ddc0: 6974 792c 2062 7574 0a20 2020 2020 2020  ity, but.       
-0004ddd0: 2020 2020 2074 6869 7320 6973 2064 6570       this is dep
-0004dde0: 7265 6361 7465 642c 2069 6e20 6675 7475  recated, in futu
-0004ddf0: 7265 2077 696c 6c20 6265 2061 6e20 6572  re will be an er
-0004de00: 726f 722c 2073 696e 6365 2044 6174 6141  ror, since DataA
-0004de10: 7272 6179 2e61 7267 6d61 7820 7769 6c6c  rray.argmax will
-0004de20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0004de30: 7572 6e20 6120 6469 6374 2077 6974 6820  urn a dict with 
-0004de40: 696e 6469 6365 7320 666f 7220 616c 6c20  indices for all 
-0004de50: 6469 6d65 6e73 696f 6e73 2c20 7768 6963  dimensions, whic
-0004de60: 6820 646f 6573 206e 6f74 206d 616b 6520  h does not make 
-0004de70: 7365 6e73 6520 666f 720a 2020 2020 2020  sense for.      
-0004de80: 2020 2020 2020 6120 4461 7461 7365 742e        a Dataset.
-0004de90: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
-0004dea0: 7472 7320 3a20 626f 6f6c 2c20 6f70 7469  trs : bool, opti
-0004deb0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-0004dec0: 2049 6620 5472 7565 2c20 7468 6520 6174   If True, the at
-0004ded0: 7472 6962 7574 6573 2028 6061 7474 7273  tributes (`attrs
-0004dee0: 6029 2077 696c 6c20 6265 2063 6f70 6965  `) will be copie
-0004def0: 6420 6672 6f6d 2074 6865 206f 7269 6769  d from the origi
-0004df00: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0004df10: 6f62 6a65 6374 2074 6f20 7468 6520 6e65  object to the ne
-0004df20: 7720 6f6e 652e 2020 4966 2046 616c 7365  w one.  If False
-0004df30: 2028 6465 6661 756c 7429 2c20 7468 6520   (default), the 
-0004df40: 6e65 7720 6f62 6a65 6374 2077 696c 6c20  new object will 
-0004df50: 6265 0a20 2020 2020 2020 2020 2020 2072  be.            r
-0004df60: 6574 7572 6e65 6420 7769 7468 6f75 7420  eturned without 
-0004df70: 6174 7472 6962 7574 6573 2e0a 2020 2020  attributes..    
-0004df80: 2020 2020 736b 6970 6e61 203a 2062 6f6f      skipna : boo
-0004df90: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
-0004dfa0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-0004dfb0: 2073 6b69 7020 6d69 7373 696e 6720 7661   skip missing va
-0004dfc0: 6c75 6573 2028 6173 206d 6172 6b65 6420  lues (as marked 
-0004dfd0: 6279 204e 614e 292e 2042 7920 6465 6661  by NaN). By defa
-0004dfe0: 756c 742c 206f 6e6c 790a 2020 2020 2020  ult, only.      
-0004dff0: 2020 2020 2020 736b 6970 7320 6d69 7373        skips miss
-0004e000: 696e 6720 7661 6c75 6573 2066 6f72 2066  ing values for f
-0004e010: 6c6f 6174 2064 7479 7065 733b 206f 7468  loat dtypes; oth
-0004e020: 6572 2064 7479 7065 7320 6569 7468 6572  er dtypes either
-0004e030: 2064 6f20 6e6f 740a 2020 2020 2020 2020   do not.        
-0004e040: 2020 2020 6861 7665 2061 2073 656e 7469      have a senti
-0004e050: 6e65 6c20 6d69 7373 696e 6720 7661 6c75  nel missing valu
-0004e060: 6520 2869 6e74 2920 6f72 2073 6b69 706e  e (int) or skipn
-0004e070: 613d 5472 7565 2068 6173 206e 6f74 2062  a=True has not b
-0004e080: 6565 6e0a 2020 2020 2020 2020 2020 2020  een.            
-0004e090: 696d 706c 656d 656e 7465 6420 286f 626a  implemented (obj
-0004e0a0: 6563 742c 2064 6174 6574 696d 6536 3420  ect, datetime64 
-0004e0b0: 6f72 2074 696d 6564 656c 7461 3634 292e  or timedelta64).
-0004e0c0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0004e0d0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0004e0e0: 2d0a 2020 2020 2020 2020 7265 7375 6c74  -.        result
-0004e0f0: 203a 2044 6174 6173 6574 0a0a 2020 2020   : Dataset..    
-0004e100: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-0004e110: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-0004e120: 2020 2020 2020 4461 7461 4172 7261 792e        DataArray.
-0004e130: 6172 676d 6178 0a0a 2020 2020 2020 2020  argmax..        
-0004e140: 2222 220a 2020 2020 2020 2020 6966 2064  """.        if d
-0004e150: 696d 2069 7320 4e6f 6e65 3a0a 2020 2020  im is None:.    
-0004e160: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-0004e170: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
-0004e180: 2020 2020 2020 2022 4f6e 6365 2074 6865         "Once the
-0004e190: 2062 6568 6176 696f 7572 206f 6620 4461   behaviour of Da
-0004e1a0: 7461 4172 7261 792e 6172 676d 696e 2829  taArray.argmin()
-0004e1b0: 2061 6e64 2056 6172 6961 626c 652e 6172   and Variable.ar
-0004e1c0: 676d 696e 2829 2077 6974 686f 7574 2022  gmin() without "
-0004e1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e1e0: 2022 6469 6d20 6368 616e 6765 7320 746f   "dim changes to
-0004e1f0: 2072 6574 7572 6e20 6120 6469 6374 206f   return a dict o
-0004e200: 6620 696e 6469 6365 7320 6f66 2065 6163  f indices of eac
-0004e210: 6820 6469 6d65 6e73 696f 6e2c 2066 6f72  h dimension, for
-0004e220: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0004e230: 2020 2022 636f 6e73 6973 7465 6e63 7920     "consistency 
-0004e240: 6974 2077 696c 6c20 6265 2061 6e20 6572  it will be an er
-0004e250: 726f 7220 746f 2063 616c 6c20 4461 7461  ror to call Data
-0004e260: 7365 742e 6172 676d 696e 2829 2077 6974  set.argmin() wit
-0004e270: 6820 6e6f 2061 7267 756d 656e 742c 220a  h no argument,".
-0004e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e290: 2273 696e 6365 2077 6520 646f 6e27 7420  "since we don't 
-0004e2a0: 7265 7475 726e 2061 2064 6963 7420 6f66  return a dict of
-0004e2b0: 2044 6174 6173 6574 732e 222c 0a20 2020   Datasets.",.   
-0004e2c0: 2020 2020 2020 2020 2020 2020 2044 6570               Dep
-0004e2d0: 7265 6361 7469 6f6e 5761 726e 696e 672c  recationWarning,
-0004e2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e2f0: 2073 7461 636b 6c65 7665 6c3d 322c 0a20   stacklevel=2,. 
-0004e300: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0004e310: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-0004e320: 2020 2020 2020 6469 6d20 6973 204e 6f6e        dim is Non
-0004e330: 650a 2020 2020 2020 2020 2020 2020 6f72  e.            or
-0004e340: 2028 6e6f 7420 6973 696e 7374 616e 6365   (not isinstance
-0004e350: 2864 696d 2c20 5365 7175 656e 6365 2920  (dim, Sequence) 
-0004e360: 616e 6420 6469 6d20 6973 206e 6f74 202e  and dim is not .
-0004e370: 2e2e 290a 2020 2020 2020 2020 2020 2020  ..).            
-0004e380: 6f72 2069 7369 6e73 7461 6e63 6528 6469  or isinstance(di
-0004e390: 6d2c 2073 7472 290a 2020 2020 2020 2020  m, str).        
-0004e3a0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-0004e3b0: 2052 6574 7572 6e20 696e 7420 696e 6465   Return int inde
-0004e3c0: 7820 6966 2073 696e 676c 6520 6469 6d65  x if single dime
-0004e3d0: 6e73 696f 6e20 6973 2070 6173 7365 642c  nsion is passed,
-0004e3e0: 2061 6e64 2069 7320 6e6f 7420 7061 7274   and is not part
-0004e3f0: 206f 6620 610a 2020 2020 2020 2020 2020   of a.          
-0004e400: 2020 2320 7365 7175 656e 6365 0a20 2020    # sequence.   
-0004e410: 2020 2020 2020 2020 2061 7267 6d61 785f           argmax_
-0004e420: 6675 6e63 203d 2067 6574 6174 7472 2864  func = getattr(d
-0004e430: 7563 6b5f 6172 7261 795f 6f70 732c 2022  uck_array_ops, "
-0004e440: 6172 676d 6178 2229 0a20 2020 2020 2020  argmax").       
-0004e450: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0004e460: 2e72 6564 7563 6528 0a20 2020 2020 2020  .reduce(.       
-0004e470: 2020 2020 2020 2020 2061 7267 6d61 785f           argmax_
-0004e480: 6675 6e63 2c20 6469 6d3d 4e6f 6e65 2069  func, dim=None i
-0004e490: 6620 6469 6d20 6973 204e 6f6e 6520 656c  f dim is None el
-0004e4a0: 7365 205b 6469 6d5d 2c20 2a2a 6b77 6172  se [dim], **kwar
-0004e4b0: 6773 0a20 2020 2020 2020 2020 2020 2029  gs.            )
-0004e4c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0004e4d0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0004e4e0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0004e4f0: 2020 2020 2020 2020 2020 2020 2022 5768               "Wh
-0004e500: 656e 2064 696d 2069 7320 6120 7365 7175  en dim is a sequ
-0004e510: 656e 6365 206f 7220 2e2e 2e2c 2044 6174  ence or ..., Dat
-0004e520: 6141 7272 6179 2e61 7267 6d69 6e28 2920  aArray.argmin() 
-0004e530: 7265 7475 726e 7320 6120 6469 6374 2e20  returns a dict. 
-0004e540: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0004e550: 2020 2264 6963 7473 2063 616e 6e6f 7420    "dicts cannot 
-0004e560: 6265 2063 6f6e 7461 696e 6564 2069 6e20  be contained in 
-0004e570: 6120 4461 7461 7365 742c 2073 6f20 6361  a Dataset, so ca
-0004e580: 6e6e 6f74 2063 616c 6c20 220a 2020 2020  nnot call ".    
-0004e590: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
-0004e5a0: 6173 6574 2e61 7267 6d69 6e28 2920 7769  aset.argmin() wi
-0004e5b0: 7468 2061 2073 6571 7565 6e63 6520 6f72  th a sequence or
-0004e5c0: 202e 2e2e 2066 6f72 2064 696d 220a 2020   ... for dim".  
-0004e5d0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0004e5e0: 2064 6566 2071 7565 7279 280a 2020 2020   def query(.    
-0004e5f0: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
-0004e600: 7365 742c 0a20 2020 2020 2020 2071 7565  set,.        que
-0004e610: 7269 6573 3a20 4d61 7070 696e 675b 416e  ries: Mapping[An
-0004e620: 792c 2041 6e79 5d20 7c20 4e6f 6e65 203d  y, Any] | None =
-0004e630: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
-0004e640: 6172 7365 723a 2051 7565 7279 5061 7273  arser: QueryPars
-0004e650: 6572 4f70 7469 6f6e 7320 3d20 2270 616e  erOptions = "pan
-0004e660: 6461 7322 2c0a 2020 2020 2020 2020 656e  das",.        en
-0004e670: 6769 6e65 3a20 5175 6572 7945 6e67 696e  gine: QueryEngin
-0004e680: 654f 7074 696f 6e73 203d 204e 6f6e 652c  eOptions = None,
-0004e690: 0a20 2020 2020 2020 206d 6973 7369 6e67  .        missing
-0004e6a0: 5f64 696d 733a 2045 7272 6f72 4f70 7469  _dims: ErrorOpti
-0004e6b0: 6f6e 7357 6974 6857 6172 6e20 3d20 2272  onsWithWarn = "r
-0004e6c0: 6169 7365 222c 0a20 2020 2020 2020 202a  aise",.        *
-0004e6d0: 2a71 7565 7269 6573 5f6b 7761 7267 733a  *queries_kwargs:
-0004e6e0: 2041 6e79 2c0a 2020 2020 2920 2d3e 2054   Any,.    ) -> T
-0004e6f0: 5f44 6174 6173 6574 3a0a 2020 2020 2020  _Dataset:.      
-0004e700: 2020 2222 2252 6574 7572 6e20 6120 6e65    """Return a ne
-0004e710: 7720 6461 7461 7365 7420 7769 7468 2065  w dataset with e
-0004e720: 6163 6820 6172 7261 7920 696e 6465 7865  ach array indexe
-0004e730: 6420 616c 6f6e 6720 7468 6520 7370 6563  d along the spec
-0004e740: 6966 6965 640a 2020 2020 2020 2020 6469  ified.        di
-0004e750: 6d65 6e73 696f 6e28 7329 2c20 7768 6572  mension(s), wher
-0004e760: 6520 7468 6520 696e 6465 7865 7273 2061  e the indexers a
-0004e770: 7265 2067 6976 656e 2061 7320 7374 7269  re given as stri
-0004e780: 6e67 7320 636f 6e74 6169 6e69 6e67 0a20  ngs containing. 
-0004e790: 2020 2020 2020 2050 7974 686f 6e20 6578         Python ex
-0004e7a0: 7072 6573 7369 6f6e 7320 746f 2062 6520  pressions to be 
-0004e7b0: 6576 616c 7561 7465 6420 6167 6169 6e73  evaluated agains
-0004e7c0: 7420 7468 6520 6461 7461 2076 6172 6961  t the data varia
-0004e7d0: 626c 6573 2069 6e20 7468 650a 2020 2020  bles in the.    
-0004e7e0: 2020 2020 6461 7461 7365 742e 0a0a 2020      dataset...  
-0004e7f0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0004e800: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0004e810: 2d2d 2d0a 2020 2020 2020 2020 7175 6572  ---.        quer
-0004e820: 6965 7320 3a20 6469 6374 2d6c 696b 652c  ies : dict-like,
-0004e830: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0004e840: 2020 2020 2020 4120 6469 6374 2d6c 696b        A dict-lik
-0004e850: 6520 7769 7468 206b 6579 7320 6d61 7463  e with keys matc
-0004e860: 6869 6e67 2064 696d 656e 7369 6f6e 7320  hing dimensions 
-0004e870: 616e 6420 7661 6c75 6573 2067 6976 656e  and values given
-0004e880: 2062 7920 7374 7269 6e67 730a 2020 2020   by strings.    
-0004e890: 2020 2020 2020 2020 636f 6e74 6169 6e69          containi
-0004e8a0: 6e67 2050 7974 686f 6e20 6578 7072 6573  ng Python expres
-0004e8b0: 7369 6f6e 7320 746f 2062 6520 6576 616c  sions to be eval
-0004e8c0: 7561 7465 6420 6167 6169 6e73 7420 7468  uated against th
-0004e8d0: 6520 6461 7461 2076 6172 6961 626c 6573  e data variables
-0004e8e0: 0a20 2020 2020 2020 2020 2020 2069 6e20  .            in 
-0004e8f0: 7468 6520 6461 7461 7365 742e 2054 6865  the dataset. The
-0004e900: 2065 7870 7265 7373 696f 6e73 2077 696c   expressions wil
-0004e910: 6c20 6265 2065 7661 6c75 6174 6564 2075  l be evaluated u
-0004e920: 7369 6e67 2074 6865 2070 616e 6461 730a  sing the pandas.
-0004e930: 2020 2020 2020 2020 2020 2020 6576 616c              eval
-0004e940: 2829 2066 756e 6374 696f 6e2c 2061 6e64  () function, and
-0004e950: 2063 616e 2063 6f6e 7461 696e 2061 6e79   can contain any
-0004e960: 2076 616c 6964 2050 7974 686f 6e20 6578   valid Python ex
-0004e970: 7072 6573 7369 6f6e 7320 6275 7420 6361  pressions but ca
-0004e980: 6e6e 6f74 0a20 2020 2020 2020 2020 2020  nnot.           
-0004e990: 2063 6f6e 7461 696e 2061 6e79 2050 7974   contain any Pyt
-0004e9a0: 686f 6e20 7374 6174 656d 656e 7473 2e0a  hon statements..
-0004e9b0: 2020 2020 2020 2020 7061 7273 6572 203a          parser :
-0004e9c0: 207b 2270 616e 6461 7322 2c20 2270 7974   {"pandas", "pyt
-0004e9d0: 686f 6e22 7d2c 2064 6566 6175 6c74 3a20  hon"}, default: 
-0004e9e0: 2270 616e 6461 7322 0a20 2020 2020 2020  "pandas".       
-0004e9f0: 2020 2020 2054 6865 2070 6172 7365 7220       The parser 
-0004ea00: 746f 2075 7365 2074 6f20 636f 6e73 7472  to use to constr
-0004ea10: 7563 7420 7468 6520 7379 6e74 6178 2074  uct the syntax t
-0004ea20: 7265 6520 6672 6f6d 2074 6865 2065 7870  ree from the exp
-0004ea30: 7265 7373 696f 6e2e 0a20 2020 2020 2020  ression..       
-0004ea40: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
-0004ea50: 206f 6620 2770 616e 6461 7327 2070 6172   of 'pandas' par
-0004ea60: 7365 7320 636f 6465 2073 6c69 6768 746c  ses code slightl
-0004ea70: 7920 6469 6666 6572 656e 7420 7468 616e  y different than
-0004ea80: 2073 7461 6e64 6172 640a 2020 2020 2020   standard.      
-0004ea90: 2020 2020 2020 5079 7468 6f6e 2e20 416c        Python. Al
-0004eaa0: 7465 726e 6174 6976 656c 792c 2079 6f75  ternatively, you
-0004eab0: 2063 616e 2070 6172 7365 2061 6e20 6578   can parse an ex
-0004eac0: 7072 6573 7369 6f6e 2075 7369 6e67 2074  pression using t
-0004ead0: 6865 2027 7079 7468 6f6e 270a 2020 2020  he 'python'.    
-0004eae0: 2020 2020 2020 2020 7061 7273 6572 2074          parser t
-0004eaf0: 6f20 7265 7461 696e 2073 7472 6963 7420  o retain strict 
-0004eb00: 5079 7468 6f6e 2073 656d 616e 7469 6373  Python semantics
-0004eb10: 2e0a 2020 2020 2020 2020 656e 6769 6e65  ..        engine
-0004eb20: 203a 207b 2270 7974 686f 6e22 2c20 226e   : {"python", "n
-0004eb30: 756d 6578 7072 222c 204e 6f6e 657d 2c20  umexpr", None}, 
-0004eb40: 6465 6661 756c 743a 204e 6f6e 650a 2020  default: None.  
-0004eb50: 2020 2020 2020 2020 2020 5468 6520 656e            The en
-0004eb60: 6769 6e65 2075 7365 6420 746f 2065 7661  gine used to eva
-0004eb70: 6c75 6174 6520 7468 6520 6578 7072 6573  luate the expres
-0004eb80: 7369 6f6e 2e20 5375 7070 6f72 7465 6420  sion. Supported 
-0004eb90: 656e 6769 6e65 7320 6172 653a 0a0a 2020  engines are:..  
-0004eba0: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
-0004ebb0: 3a20 7472 6965 7320 746f 2075 7365 206e  : tries to use n
-0004ebc0: 756d 6578 7072 2c20 6661 6c6c 7320 6261  umexpr, falls ba
-0004ebd0: 636b 2074 6f20 7079 7468 6f6e 0a20 2020  ck to python.   
-0004ebe0: 2020 2020 2020 2020 202d 2022 6e75 6d65           - "nume
-0004ebf0: 7870 7222 3a20 6576 616c 7561 7465 7320  xpr": evaluates 
-0004ec00: 6578 7072 6573 7369 6f6e 7320 7573 696e  expressions usin
-0004ec10: 6720 6e75 6d65 7870 720a 2020 2020 2020  g numexpr.      
-0004ec20: 2020 2020 2020 2d20 2270 7974 686f 6e22        - "python"
-0004ec30: 3a20 7065 7266 6f72 6d73 206f 7065 7261  : performs opera
-0004ec40: 7469 6f6e 7320 6173 2069 6620 796f 7520  tions as if you 
-0004ec50: 6861 6420 6576 616c e280 9964 2069 6e20  had eval...d in 
-0004ec60: 746f 7020 6c65 7665 6c20 7079 7468 6f6e  top level python
-0004ec70: 0a0a 2020 2020 2020 2020 6d69 7373 696e  ..        missin
-0004ec80: 675f 6469 6d73 203a 207b 2272 6169 7365  g_dims : {"raise
-0004ec90: 222c 2022 7761 726e 222c 2022 6967 6e6f  ", "warn", "igno
-0004eca0: 7265 227d 2c20 6465 6661 756c 743a 2022  re"}, default: "
-0004ecb0: 7261 6973 6522 0a20 2020 2020 2020 2020  raise".         
-0004ecc0: 2020 2057 6861 7420 746f 2064 6f20 6966     What to do if
-0004ecd0: 2064 696d 656e 7369 6f6e 7320 7468 6174   dimensions that
-0004ece0: 2073 686f 756c 6420 6265 2073 656c 6563   should be selec
-0004ecf0: 7465 6420 6672 6f6d 2061 7265 206e 6f74  ted from are not
-0004ed00: 2070 7265 7365 6e74 2069 6e20 7468 650a   present in the.
-0004ed10: 2020 2020 2020 2020 2020 2020 4461 7461              Data
-0004ed20: 7365 743a 0a0a 2020 2020 2020 2020 2020  set:..          
-0004ed30: 2020 2d20 2272 6169 7365 223a 2072 6169    - "raise": rai
-0004ed40: 7365 2061 6e20 6578 6365 7074 696f 6e0a  se an exception.
-0004ed50: 2020 2020 2020 2020 2020 2020 2d20 2277              - "w
-0004ed60: 6172 6e22 3a20 7261 6973 6520 6120 7761  arn": raise a wa
-0004ed70: 726e 696e 672c 2061 6e64 2069 676e 6f72  rning, and ignor
-0004ed80: 6520 7468 6520 6d69 7373 696e 6720 6469  e the missing di
-0004ed90: 6d65 6e73 696f 6e73 0a20 2020 2020 2020  mensions.       
-0004eda0: 2020 2020 202d 2022 6967 6e6f 7265 223a       - "ignore":
-0004edb0: 2069 676e 6f72 6520 7468 6520 6d69 7373   ignore the miss
-0004edc0: 696e 6720 6469 6d65 6e73 696f 6e73 0a0a  ing dimensions..
-0004edd0: 2020 2020 2020 2020 2a2a 7175 6572 6965          **querie
-0004ede0: 735f 6b77 6172 6773 203a 207b 6469 6d3a  s_kwargs : {dim:
-0004edf0: 2071 7565 7279 2c20 2e2e 2e7d 2c20 6f70   query, ...}, op
-0004ee00: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-0004ee10: 2020 2054 6865 206b 6579 776f 7264 2061     The keyword a
-0004ee20: 7267 756d 656e 7473 2066 6f72 6d20 6f66  rguments form of
-0004ee30: 2060 6071 7565 7269 6573 6060 2e0a 2020   ``queries``..  
-0004ee40: 2020 2020 2020 2020 2020 4f6e 6520 6f66            One of
-0004ee50: 2071 7565 7269 6573 206f 7220 7175 6572   queries or quer
-0004ee60: 6965 735f 6b77 6172 6773 206d 7573 7420  ies_kwargs must 
-0004ee70: 6265 2070 726f 7669 6465 642e 0a0a 2020  be provided...  
-0004ee80: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0004ee90: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-0004eea0: 2020 2020 2020 6f62 6a20 3a20 4461 7461        obj : Data
-0004eeb0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-0004eec0: 4120 6e65 7720 4461 7461 7365 7420 7769  A new Dataset wi
-0004eed0: 7468 2074 6865 2073 616d 6520 636f 6e74  th the same cont
-0004eee0: 656e 7473 2061 7320 7468 6973 2064 6174  ents as this dat
-0004eef0: 6173 6574 2c20 6578 6365 7074 2065 6163  aset, except eac
-0004ef00: 680a 2020 2020 2020 2020 2020 2020 6172  h.            ar
-0004ef10: 7261 7920 616e 6420 6469 6d65 6e73 696f  ray and dimensio
-0004ef20: 6e20 6973 2069 6e64 6578 6564 2062 7920  n is indexed by 
-0004ef30: 7468 6520 7265 7375 6c74 7320 6f66 2074  the results of t
-0004ef40: 6865 2061 7070 726f 7072 6961 7465 0a20  he appropriate. 
-0004ef50: 2020 2020 2020 2020 2020 2071 7565 7269             queri
-0004ef60: 6573 2e0a 0a20 2020 2020 2020 2053 6565  es...        See
-0004ef70: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-0004ef80: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
-0004ef90: 6174 6173 6574 2e69 7365 6c0a 2020 2020  ataset.isel.    
-0004efa0: 2020 2020 7061 6e64 6173 2e65 7661 6c0a      pandas.eval.
-0004efb0: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-0004efc0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0004efd0: 2d2d 0a20 2020 2020 2020 203e 3e3e 2061  --.        >>> a
-0004efe0: 203d 206e 702e 6172 616e 6765 2830 2c20   = np.arange(0, 
-0004eff0: 352c 2031 290a 2020 2020 2020 2020 3e3e  5, 1).        >>
-0004f000: 3e20 6220 3d20 6e70 2e6c 696e 7370 6163  > b = np.linspac
-0004f010: 6528 302c 2031 2c20 3529 0a20 2020 2020  e(0, 1, 5).     
-0004f020: 2020 203e 3e3e 2064 7320 3d20 7872 2e44     >>> ds = xr.D
-0004f030: 6174 6173 6574 287b 2261 223a 2028 2278  ataset({"a": ("x
-0004f040: 222c 2061 292c 2022 6222 3a20 2822 7822  ", a), "b": ("x"
-0004f050: 2c20 6229 7d29 0a20 2020 2020 2020 203e  , b)}).        >
-0004f060: 3e3e 2064 730a 2020 2020 2020 2020 3c78  >> ds.        <x
-0004f070: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
-0004f080: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
-0004f090: 733a 2020 2878 3a20 3529 0a20 2020 2020  s:  (x: 5).     
-0004f0a0: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
-0004f0b0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
-0004f0c0: 733a 2078 0a20 2020 2020 2020 2044 6174  s: x.        Dat
-0004f0d0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
-0004f0e0: 2020 2020 2020 2020 2061 2020 2020 2020           a      
-0004f0f0: 2020 2878 2920 696e 7436 3420 3020 3120    (x) int64 0 1 
-0004f100: 3220 3320 340a 2020 2020 2020 2020 2020  2 3 4.          
-0004f110: 2020 6220 2020 2020 2020 2028 7829 2066    b        (x) f
-0004f120: 6c6f 6174 3634 2030 2e30 2030 2e32 3520  loat64 0.0 0.25 
-0004f130: 302e 3520 302e 3735 2031 2e30 0a20 2020  0.5 0.75 1.0.   
-0004f140: 2020 2020 203e 3e3e 2064 732e 7175 6572       >>> ds.quer
-0004f150: 7928 783d 2261 203e 2032 2229 0a20 2020  y(x="a > 2").   
-0004f160: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
-0004f170: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
-0004f180: 6d65 6e73 696f 6e73 3a20 2028 783a 2032  mensions:  (x: 2
-0004f190: 290a 2020 2020 2020 2020 4469 6d65 6e73  ).        Dimens
-0004f1a0: 696f 6e73 2077 6974 686f 7574 2063 6f6f  ions without coo
-0004f1b0: 7264 696e 6174 6573 3a20 780a 2020 2020  rdinates: x.    
-0004f1c0: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
-0004f1d0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0004f1e0: 6120 2020 2020 2020 2028 7829 2069 6e74  a        (x) int
-0004f1f0: 3634 2033 2034 0a20 2020 2020 2020 2020  64 3 4.         
-0004f200: 2020 2062 2020 2020 2020 2020 2878 2920     b        (x) 
-0004f210: 666c 6f61 7436 3420 302e 3735 2031 2e30  float64 0.75 1.0
-0004f220: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0004f230: 2020 2020 2020 2320 616c 6c6f 7720 7175        # allow qu
-0004f240: 6572 6965 7320 746f 2062 6520 6769 7665  eries to be give
-0004f250: 6e20 6569 7468 6572 2061 7320 6120 6469  n either as a di
-0004f260: 6374 206f 7220 6173 206b 7761 7267 730a  ct or as kwargs.
-0004f270: 2020 2020 2020 2020 7175 6572 6965 7320          queries 
-0004f280: 3d20 6569 7468 6572 5f64 6963 745f 6f72  = either_dict_or
-0004f290: 5f6b 7761 7267 7328 7175 6572 6965 732c  _kwargs(queries,
-0004f2a0: 2071 7565 7269 6573 5f6b 7761 7267 732c   queries_kwargs,
-0004f2b0: 2022 7175 6572 7922 290a 0a20 2020 2020   "query")..     
-0004f2c0: 2020 2023 2063 6865 636b 2071 7565 7269     # check queri
-0004f2d0: 6573 0a20 2020 2020 2020 2066 6f72 2064  es.        for d
-0004f2e0: 696d 2c20 6578 7072 2069 6e20 7175 6572  im, expr in quer
-0004f2f0: 6965 732e 6974 656d 7328 293a 0a20 2020  ies.items():.   
-0004f300: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0004f310: 6973 696e 7374 616e 6365 2865 7870 722c  isinstance(expr,
-0004f320: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-0004f330: 2020 2020 2020 206d 7367 203d 2066 2265         msg = f"e
-0004f340: 7870 7220 666f 7220 6469 6d20 7b64 696d  xpr for dim {dim
-0004f350: 7d20 6d75 7374 2062 6520 6120 7374 7269  } must be a stri
-0004f360: 6e67 2074 6f20 6265 2065 7661 6c75 6174  ng to be evaluat
-0004f370: 6564 2c20 7b74 7970 6528 6578 7072 297d  ed, {type(expr)}
-0004f380: 2067 6976 656e 220a 2020 2020 2020 2020   given".        
-0004f390: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0004f3a0: 6c75 6545 7272 6f72 286d 7367 290a 0a20  lueError(msg).. 
-0004f3b0: 2020 2020 2020 2023 2065 7661 6c75 6174         # evaluat
-0004f3c0: 6520 7468 6520 7175 6572 6965 7320 746f  e the queries to
-0004f3d0: 2063 7265 6174 6520 7468 6520 696e 6465   create the inde
-0004f3e0: 7865 7273 0a20 2020 2020 2020 2069 6e64  xers.        ind
-0004f3f0: 6578 6572 7320 3d20 7b0a 2020 2020 2020  exers = {.      
-0004f400: 2020 2020 2020 6469 6d3a 2070 642e 6576        dim: pd.ev
-0004f410: 616c 2865 7870 722c 2072 6573 6f6c 7665  al(expr, resolve
-0004f420: 7273 3d5b 7365 6c66 5d2c 2070 6172 7365  rs=[self], parse
-0004f430: 723d 7061 7273 6572 2c20 656e 6769 6e65  r=parser, engine
-0004f440: 3d65 6e67 696e 6529 0a20 2020 2020 2020  =engine).       
-0004f450: 2020 2020 2066 6f72 2064 696d 2c20 6578       for dim, ex
-0004f460: 7072 2069 6e20 7175 6572 6965 732e 6974  pr in queries.it
-0004f470: 656d 7328 290a 2020 2020 2020 2020 7d0a  ems().        }.
-0004f480: 0a20 2020 2020 2020 2023 2061 7070 6c79  .        # apply
-0004f490: 2074 6865 2073 656c 6563 7469 6f6e 0a20   the selection. 
-0004f4a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0004f4b0: 6c66 2e69 7365 6c28 696e 6465 7865 7273  lf.isel(indexers
-0004f4c0: 2c20 6d69 7373 696e 675f 6469 6d73 3d6d  , missing_dims=m
-0004f4d0: 6973 7369 6e67 5f64 696d 7329 0a0a 2020  issing_dims)..  
-0004f4e0: 2020 6465 6620 6375 7276 6566 6974 280a    def curvefit(.
-0004f4f0: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
-0004f500: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
-0004f510: 2063 6f6f 7264 733a 2073 7472 207c 2044   coords: str | D
-0004f520: 6174 6141 7272 6179 207c 2049 7465 7261  ataArray | Itera
-0004f530: 626c 655b 7374 7220 7c20 4461 7461 4172  ble[str | DataAr
-0004f540: 7261 795d 2c0a 2020 2020 2020 2020 6675  ray],.        fu
-0004f550: 6e63 3a20 4361 6c6c 6162 6c65 5b2e 2e2e  nc: Callable[...
-0004f560: 2c20 416e 795d 2c0a 2020 2020 2020 2020  , Any],.        
-0004f570: 7265 6475 6365 5f64 696d 733a 2044 696d  reduce_dims: Dim
-0004f580: 7320 3d20 4e6f 6e65 2c0a 2020 2020 2020  s = None,.      
-0004f590: 2020 736b 6970 6e61 3a20 626f 6f6c 203d    skipna: bool =
-0004f5a0: 2054 7275 652c 0a20 2020 2020 2020 2070   True,.        p
-0004f5b0: 303a 2064 6963 745b 7374 722c 2041 6e79  0: dict[str, Any
-0004f5c0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-0004f5d0: 0a20 2020 2020 2020 2062 6f75 6e64 733a  .        bounds:
-0004f5e0: 2064 6963 745b 7374 722c 2041 6e79 5d20   dict[str, Any] 
-0004f5f0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-0004f600: 2020 2020 2020 2070 6172 616d 5f6e 616d         param_nam
-0004f610: 6573 3a20 5365 7175 656e 6365 5b73 7472  es: Sequence[str
-0004f620: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-0004f630: 0a20 2020 2020 2020 206b 7761 7267 733a  .        kwargs:
-0004f640: 2064 6963 745b 7374 722c 2041 6e79 5d20   dict[str, Any] 
-0004f650: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
-0004f660: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
-0004f670: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-0004f680: 2020 2020 2020 2043 7572 7665 2066 6974         Curve fit
-0004f690: 7469 6e67 206f 7074 696d 697a 6174 696f  ting optimizatio
-0004f6a0: 6e20 666f 7220 6172 6269 7472 6172 7920  n for arbitrary 
-0004f6b0: 6675 6e63 7469 6f6e 732e 0a0a 2020 2020  functions...    
-0004f6c0: 2020 2020 5772 6170 7320 6073 6369 7079      Wraps `scipy
-0004f6d0: 2e6f 7074 696d 697a 652e 6375 7276 655f  .optimize.curve_
-0004f6e0: 6669 7460 2077 6974 6820 6061 7070 6c79  fit` with `apply
-0004f6f0: 5f75 6675 6e63 602e 0a0a 2020 2020 2020  _ufunc`...      
-0004f700: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0004f710: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-0004f720: 2020 2020 2020 2020 636f 6f72 6473 203a          coords :
-0004f730: 2068 6173 6861 626c 652c 2044 6174 6141   hashable, DataA
-0004f740: 7272 6179 2c20 6f72 2073 6571 7565 6e63  rray, or sequenc
-0004f750: 6520 6f66 2068 6173 6861 626c 6520 6f72  e of hashable or
-0004f760: 2044 6174 6141 7272 6179 0a20 2020 2020   DataArray.     
-0004f770: 2020 2020 2020 2049 6e64 6570 656e 6465         Independe
-0004f780: 6e74 2063 6f6f 7264 696e 6174 6528 7329  nt coordinate(s)
-0004f790: 206f 7665 7220 7768 6963 6820 746f 2070   over which to p
-0004f7a0: 6572 666f 726d 2074 6865 2063 7572 7665  erform the curve
-0004f7b0: 2066 6974 7469 6e67 2e20 4d75 7374 2073   fitting. Must s
-0004f7c0: 6861 7265 0a20 2020 2020 2020 2020 2020  hare.           
-0004f7d0: 2061 7420 6c65 6173 7420 6f6e 6520 6469   at least one di
-0004f7e0: 6d65 6e73 696f 6e20 7769 7468 2074 6865  mension with the
-0004f7f0: 2063 616c 6c69 6e67 206f 626a 6563 742e   calling object.
-0004f800: 2057 6865 6e20 6669 7474 696e 6720 6d75   When fitting mu
-0004f810: 6c74 692d 6469 6d65 6e73 696f 6e61 6c0a  lti-dimensional.
-0004f820: 2020 2020 2020 2020 2020 2020 6675 6e63              func
-0004f830: 7469 6f6e 732c 2073 7570 706c 7920 6063  tions, supply `c
-0004f840: 6f6f 7264 7360 2061 7320 6120 7365 7175  oords` as a sequ
-0004f850: 656e 6365 2069 6e20 7468 6520 7361 6d65  ence in the same
-0004f860: 206f 7264 6572 2061 7320 6172 6775 6d65   order as argume
-0004f870: 6e74 7320 696e 0a20 2020 2020 2020 2020  nts in.         
-0004f880: 2020 2060 6675 6e63 602e 2054 6f20 6669     `func`. To fi
-0004f890: 7420 616c 6f6e 6720 6578 6973 7469 6e67  t along existing
-0004f8a0: 2064 696d 656e 7369 6f6e 7320 6f66 2074   dimensions of t
-0004f8b0: 6865 2063 616c 6c69 6e67 206f 626a 6563  he calling objec
-0004f8c0: 742c 2060 636f 6f72 6473 6020 6361 6e0a  t, `coords` can.
-0004f8d0: 2020 2020 2020 2020 2020 2020 616c 736f              also
-0004f8e0: 2062 6520 7370 6563 6966 6965 6420 6173   be specified as
-0004f8f0: 2061 2073 7472 206f 7220 7365 7175 656e   a str or sequen
-0004f900: 6365 206f 6620 7374 7273 2e0a 2020 2020  ce of strs..    
-0004f910: 2020 2020 6675 6e63 203a 2063 616c 6c61      func : calla
-0004f920: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
-0004f930: 5573 6572 2073 7065 6369 6669 6564 2066  User specified f
-0004f940: 756e 6374 696f 6e20 696e 2074 6865 2066  unction in the f
-0004f950: 6f72 6d20 6066 2878 2c20 2a70 6172 616d  orm `f(x, *param
-0004f960: 7329 6020 7768 6963 6820 7265 7475 726e  s)` which return
-0004f970: 7320 6120 6e75 6d70 790a 2020 2020 2020  s a numpy.      
-0004f980: 2020 2020 2020 6172 7261 7920 6f66 206c        array of l
-0004f990: 656e 6774 6820 606c 656e 2878 2960 2e20  ength `len(x)`. 
-0004f9a0: 6070 6172 616d 7360 2061 7265 2074 6865  `params` are the
-0004f9b0: 2066 6974 7461 626c 6520 7061 7261 6d65   fittable parame
-0004f9c0: 7465 7273 2077 6869 6368 2061 7265 206f  ters which are o
-0004f9d0: 7074 696d 697a 6564 0a20 2020 2020 2020  ptimized.       
-0004f9e0: 2020 2020 2062 7920 7363 6970 7920 6375       by scipy cu
-0004f9f0: 7276 655f 6669 742e 2060 7860 2063 616e  rve_fit. `x` can
-0004fa00: 2061 6c73 6f20 6265 2073 7065 6369 6669   also be specifi
-0004fa10: 6564 2061 7320 6120 7365 7175 656e 6365  ed as a sequence
-0004fa20: 2063 6f6e 7461 696e 696e 6720 6d75 6c74   containing mult
-0004fa30: 6970 6c65 0a20 2020 2020 2020 2020 2020  iple.           
-0004fa40: 2063 6f6f 7264 696e 6174 6573 2c20 652e   coordinates, e.
-0004fa50: 672e 2060 6628 2878 302c 2078 3129 2c20  g. `f((x0, x1), 
-0004fa60: 2a70 6172 616d 7329 602e 0a20 2020 2020  *params)`..     
-0004fa70: 2020 2072 6564 7563 655f 6469 6d73 203a     reduce_dims :
-0004fa80: 2073 7472 2c20 4974 6572 6162 6c65 206f   str, Iterable o
-0004fa90: 6620 4861 7368 6162 6c65 206f 7220 4e6f  f Hashable or No
-0004faa0: 6e65 2c20 6f70 7469 6f6e 616c 0a20 2020  ne, optional.   
-0004fab0: 2020 2020 2020 2020 2041 6464 6974 696f           Additio
-0004fac0: 6e61 6c20 6469 6d65 6e73 696f 6e28 7329  nal dimension(s)
-0004fad0: 206f 7665 7220 7768 6963 6820 746f 2061   over which to a
-0004fae0: 6767 7265 6761 7465 2077 6869 6c65 2066  ggregate while f
-0004faf0: 6974 7469 6e67 2e20 466f 7220 6578 616d  itting. For exam
-0004fb00: 706c 652c 0a20 2020 2020 2020 2020 2020  ple,.           
-0004fb10: 2063 616c 6c69 6e67 2060 6473 2e63 7572   calling `ds.cur
-0004fb20: 7665 6669 7428 636f 6f72 6473 3d27 7469  vefit(coords='ti
-0004fb30: 6d65 272c 2072 6564 7563 655f 6469 6d73  me', reduce_dims
-0004fb40: 3d5b 276c 6174 272c 2027 6c6f 6e27 5d2c  =['lat', 'lon'],
-0004fb50: 202e 2e2e 2960 2077 696c 6c0a 2020 2020   ...)` will.    
-0004fb60: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
-0004fb70: 6520 616c 6c20 6c61 7420 616e 6420 6c6f  e all lat and lo
-0004fb80: 6e20 706f 696e 7473 2061 6e64 2066 6974  n points and fit
-0004fb90: 2074 6865 2073 7065 6369 6669 6564 2066   the specified f
-0004fba0: 756e 6374 696f 6e20 616c 6f6e 6720 7468  unction along th
-0004fbb0: 650a 2020 2020 2020 2020 2020 2020 7469  e.            ti
-0004fbc0: 6d65 2064 696d 656e 7369 6f6e 2e0a 2020  me dimension..  
-0004fbd0: 2020 2020 2020 736b 6970 6e61 203a 2062        skipna : b
-0004fbe0: 6f6f 6c2c 2064 6566 6175 6c74 3a20 5472  ool, default: Tr
-0004fbf0: 7565 0a20 2020 2020 2020 2020 2020 2057  ue.            W
-0004fc00: 6865 7468 6572 2074 6f20 736b 6970 206d  hether to skip m
-0004fc10: 6973 7369 6e67 2076 616c 7565 7320 7768  issing values wh
-0004fc20: 656e 2066 6974 7469 6e67 2e20 4465 6661  en fitting. Defa
-0004fc30: 756c 7420 6973 2054 7275 652e 0a20 2020  ult is True..   
-0004fc40: 2020 2020 2070 3020 3a20 6469 6374 2d6c       p0 : dict-l
-0004fc50: 696b 652c 206f 7074 696f 6e61 6c0a 2020  ike, optional.  
-0004fc60: 2020 2020 2020 2020 2020 4f70 7469 6f6e            Option
-0004fc70: 616c 2064 6963 7469 6f6e 6172 7920 6f66  al dictionary of
-0004fc80: 2070 6172 616d 6574 6572 206e 616d 6573   parameter names
-0004fc90: 2074 6f20 696e 6974 6961 6c20 6775 6573   to initial gues
-0004fca0: 7365 7320 7061 7373 6564 2074 6f20 7468  ses passed to th
-0004fcb0: 650a 2020 2020 2020 2020 2020 2020 6063  e.            `c
-0004fcc0: 7572 7665 5f66 6974 6020 6070 3060 2061  urve_fit` `p0` a
-0004fcd0: 7267 2e20 4966 206e 6f6e 6520 6f72 206f  rg. If none or o
-0004fce0: 6e6c 7920 736f 6d65 2070 6172 616d 6574  nly some paramet
-0004fcf0: 6572 7320 6172 6520 7061 7373 6564 2c20  ers are passed, 
-0004fd00: 7468 6520 7265 7374 2077 696c 6c0a 2020  the rest will.  
-0004fd10: 2020 2020 2020 2020 2020 6265 2061 7373            be ass
-0004fd20: 6967 6e65 6420 696e 6974 6961 6c20 7661  igned initial va
-0004fd30: 6c75 6573 2066 6f6c 6c6f 7769 6e67 2074  lues following t
-0004fd40: 6865 2064 6566 6175 6c74 2073 6369 7079  he default scipy
-0004fd50: 2062 6568 6176 696f 722e 0a20 2020 2020   behavior..     
-0004fd60: 2020 2062 6f75 6e64 7320 3a20 6469 6374     bounds : dict
-0004fd70: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
-0004fd80: 2020 2020 2020 2020 2020 2020 4f70 7469              Opti
-0004fd90: 6f6e 616c 2064 6963 7469 6f6e 6172 7920  onal dictionary 
-0004fda0: 6f66 2070 6172 616d 6574 6572 206e 616d  of parameter nam
-0004fdb0: 6573 2074 6f20 626f 756e 6469 6e67 2076  es to bounding v
-0004fdc0: 616c 7565 7320 7061 7373 6564 2074 6f20  alues passed to 
-0004fdd0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-0004fde0: 6063 7572 7665 5f66 6974 6020 6062 6f75  `curve_fit` `bou
-0004fdf0: 6e64 7360 2061 7267 2e20 4966 206e 6f6e  nds` arg. If non
-0004fe00: 6520 6f72 206f 6e6c 7920 736f 6d65 2070  e or only some p
-0004fe10: 6172 616d 6574 6572 7320 6172 6520 7061  arameters are pa
-0004fe20: 7373 6564 2c20 7468 6520 7265 7374 0a20  ssed, the rest. 
-0004fe30: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
-0004fe40: 6265 2075 6e62 6f75 6e64 6564 2066 6f6c  be unbounded fol
-0004fe50: 6c6f 7769 6e67 2074 6865 2064 6566 6175  lowing the defau
-0004fe60: 6c74 2073 6369 7079 2062 6568 6176 696f  lt scipy behavio
-0004fe70: 722e 0a20 2020 2020 2020 2070 6172 616d  r..        param
-0004fe80: 5f6e 616d 6573 203a 2073 6571 7565 6e63  _names : sequenc
-0004fe90: 6520 6f66 2068 6173 6861 626c 652c 206f  e of hashable, o
-0004fea0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0004feb0: 2020 2020 5365 7175 656e 6365 206f 6620      Sequence of 
-0004fec0: 6e61 6d65 7320 666f 7220 7468 6520 6669  names for the fi
-0004fed0: 7474 6162 6c65 2070 6172 616d 6574 6572  ttable parameter
-0004fee0: 7320 6f66 2060 6675 6e63 602e 2049 6620  s of `func`. If 
-0004fef0: 6e6f 7420 7375 7070 6c69 6564 2c0a 2020  not supplied,.  
-0004ff00: 2020 2020 2020 2020 2020 7468 6973 2077            this w
-0004ff10: 696c 6c20 6265 2061 7574 6f6d 6174 6963  ill be automatic
-0004ff20: 616c 6c79 2064 6574 6572 6d69 6e65 6420  ally determined 
-0004ff30: 6279 2061 7267 756d 656e 7473 206f 6620  by arguments of 
-0004ff40: 6066 756e 6360 2e20 6070 6172 616d 5f6e  `func`. `param_n
-0004ff50: 616d 6573 600a 2020 2020 2020 2020 2020  ames`.          
-0004ff60: 2020 7368 6f75 6c64 2062 6520 6d61 6e75    should be manu
-0004ff70: 616c 6c79 2073 7570 706c 6965 6420 7768  ally supplied wh
-0004ff80: 656e 2066 6974 7469 6e67 2061 2066 756e  en fitting a fun
-0004ff90: 6374 696f 6e20 7468 6174 2074 616b 6573  ction that takes
-0004ffa0: 2061 2076 6172 6961 626c 650a 2020 2020   a variable.    
-0004ffb0: 2020 2020 2020 2020 6e75 6d62 6572 206f          number o
-0004ffc0: 6620 7061 7261 6d65 7465 7273 2e0a 2020  f parameters..  
-0004ffd0: 2020 2020 2020 2a2a 6b77 6172 6773 203a        **kwargs :
-0004ffe0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0004fff0: 2020 2020 2020 4164 6469 7469 6f6e 616c        Additional
-00050000: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00050010: 7473 2074 6f20 7061 7373 6564 2074 6f20  ts to passed to 
-00050020: 7363 6970 7920 6375 7276 655f 6669 742e  scipy curve_fit.
-00050030: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00050040: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00050050: 2d0a 2020 2020 2020 2020 6375 7276 6566  -.        curvef
-00050060: 6974 5f72 6573 756c 7473 203a 2044 6174  it_results : Dat
-00050070: 6173 6574 0a20 2020 2020 2020 2020 2020  aset.           
-00050080: 2041 2073 696e 676c 6520 6461 7461 7365   A single datase
-00050090: 7420 7768 6963 6820 636f 6e74 6169 6e73  t which contains
-000500a0: 3a0a 0a20 2020 2020 2020 2020 2020 205b  :..            [
-000500b0: 7661 725d 5f63 7572 7665 6669 745f 636f  var]_curvefit_co
-000500c0: 6566 6669 6369 656e 7473 0a20 2020 2020  efficients.     
-000500d0: 2020 2020 2020 2020 2020 2054 6865 2063             The c
-000500e0: 6f65 6666 6963 6965 6e74 7320 6f66 2074  oefficients of t
-000500f0: 6865 2062 6573 7420 6669 742e 0a20 2020  he best fit..   
-00050100: 2020 2020 2020 2020 205b 7661 725d 5f63           [var]_c
-00050110: 7572 7665 6669 745f 636f 7661 7269 616e  urvefit_covarian
-00050120: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
-00050130: 2020 2054 6865 2063 6f76 6172 6961 6e63     The covarianc
-00050140: 6520 6d61 7472 6978 206f 6620 7468 6520  e matrix of the 
-00050150: 636f 6566 6669 6369 656e 7420 6573 7469  coefficient esti
-00050160: 6d61 7465 732e 0a0a 2020 2020 2020 2020  mates...        
-00050170: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00050180: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00050190: 2020 4461 7461 7365 742e 706f 6c79 6669    Dataset.polyfi
-000501a0: 740a 2020 2020 2020 2020 7363 6970 792e  t.        scipy.
-000501b0: 6f70 7469 6d69 7a65 2e63 7572 7665 5f66  optimize.curve_f
-000501c0: 6974 0a20 2020 2020 2020 2022 2222 0a20  it.        """. 
-000501d0: 2020 2020 2020 2066 726f 6d20 7363 6970         from scip
-000501e0: 792e 6f70 7469 6d69 7a65 2069 6d70 6f72  y.optimize impor
-000501f0: 7420 6375 7276 655f 6669 740a 0a20 2020  t curve_fit..   
-00050200: 2020 2020 2066 726f 6d20 7861 7272 6179       from xarray
-00050210: 2e63 6f72 652e 616c 6967 6e6d 656e 7420  .core.alignment 
-00050220: 696d 706f 7274 2062 726f 6164 6361 7374  import broadcast
-00050230: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
-00050240: 7272 6179 2e63 6f72 652e 636f 6d70 7574  rray.core.comput
-00050250: 6174 696f 6e20 696d 706f 7274 2061 7070  ation import app
-00050260: 6c79 5f75 6675 6e63 0a20 2020 2020 2020  ly_ufunc.       
-00050270: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-00050280: 652e 6461 7461 6172 7261 7920 696d 706f  e.dataarray impo
-00050290: 7274 205f 5448 4953 5f41 5252 4159 2c20  rt _THIS_ARRAY, 
-000502a0: 4461 7461 4172 7261 790a 0a20 2020 2020  DataArray..     
-000502b0: 2020 2069 6620 7030 2069 7320 4e6f 6e65     if p0 is None
-000502c0: 3a0a 2020 2020 2020 2020 2020 2020 7030  :.            p0
-000502d0: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
-000502e0: 2062 6f75 6e64 7320 6973 204e 6f6e 653a   bounds is None:
-000502f0: 0a20 2020 2020 2020 2020 2020 2062 6f75  .            bou
-00050300: 6e64 7320 3d20 7b7d 0a20 2020 2020 2020  nds = {}.       
-00050310: 2069 6620 6b77 6172 6773 2069 7320 4e6f   if kwargs is No
-00050320: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00050330: 6b77 6172 6773 203d 207b 7d0a 0a20 2020  kwargs = {}..   
-00050340: 2020 2020 2072 6564 7563 655f 6469 6d73       reduce_dims
-00050350: 5f3a 206c 6973 745b 4861 7368 6162 6c65  _: list[Hashable
-00050360: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
-00050370: 2072 6564 7563 655f 6469 6d73 3a0a 2020   reduce_dims:.  
-00050380: 2020 2020 2020 2020 2020 7265 6475 6365            reduce
-00050390: 5f64 696d 735f 203d 205b 5d0a 2020 2020  _dims_ = [].    
-000503a0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-000503b0: 6e63 6528 7265 6475 6365 5f64 696d 732c  nce(reduce_dims,
-000503c0: 2073 7472 2920 6f72 206e 6f74 2069 7369   str) or not isi
-000503d0: 6e73 7461 6e63 6528 7265 6475 6365 5f64  nstance(reduce_d
-000503e0: 696d 732c 2049 7465 7261 626c 6529 3a0a  ims, Iterable):.
-000503f0: 2020 2020 2020 2020 2020 2020 7265 6475              redu
-00050400: 6365 5f64 696d 735f 203d 205b 7265 6475  ce_dims_ = [redu
-00050410: 6365 5f64 696d 735d 0a20 2020 2020 2020  ce_dims].       
-00050420: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00050430: 2020 2072 6564 7563 655f 6469 6d73 5f20     reduce_dims_ 
-00050440: 3d20 6c69 7374 2872 6564 7563 655f 6469  = list(reduce_di
-00050450: 6d73 290a 0a20 2020 2020 2020 2069 6620  ms)..        if 
-00050460: 280a 2020 2020 2020 2020 2020 2020 6973  (.            is
-00050470: 696e 7374 616e 6365 2863 6f6f 7264 732c  instance(coords,
-00050480: 2073 7472 290a 2020 2020 2020 2020 2020   str).          
-00050490: 2020 6f72 2069 7369 6e73 7461 6e63 6528    or isinstance(
-000504a0: 636f 6f72 6473 2c20 4461 7461 4172 7261  coords, DataArra
-000504b0: 7929 0a20 2020 2020 2020 2020 2020 206f  y).            o
-000504c0: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
-000504d0: 2863 6f6f 7264 732c 2049 7465 7261 626c  (coords, Iterabl
-000504e0: 6529 0a20 2020 2020 2020 2029 3a0a 2020  e).        ):.  
-000504f0: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
-00050500: 203d 205b 636f 6f72 6473 5d0a 2020 2020   = [coords].    
-00050510: 2020 2020 636f 6f72 6473 5f3a 2053 6571      coords_: Seq
-00050520: 7565 6e63 655b 4461 7461 4172 7261 795d  uence[DataArray]
-00050530: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00050540: 2073 656c 665b 636f 6f72 645d 2069 6620   self[coord] if 
-00050550: 6973 696e 7374 616e 6365 2863 6f6f 7264  isinstance(coord
-00050560: 2c20 7374 7229 2065 6c73 6520 636f 6f72  , str) else coor
-00050570: 6420 666f 7220 636f 6f72 6420 696e 2063  d for coord in c
-00050580: 6f6f 7264 730a 2020 2020 2020 2020 5d0a  oords.        ].
-00050590: 0a20 2020 2020 2020 2023 2044 6574 6572  .        # Deter
-000505a0: 6d69 6e65 2077 6865 7468 6572 2061 6e79  mine whether any
-000505b0: 2063 6f6f 7264 7320 6172 6520 6469 6d73   coords are dims
-000505c0: 206f 6e20 7365 6c66 0a20 2020 2020 2020   on self.       
-000505d0: 2066 6f72 2063 6f6f 7264 2069 6e20 636f   for coord in co
-000505e0: 6f72 6473 5f3a 0a20 2020 2020 2020 2020  ords_:.         
-000505f0: 2020 2072 6564 7563 655f 6469 6d73 5f20     reduce_dims_ 
-00050600: 2b3d 205b 6320 666f 7220 6320 696e 2073  += [c for c in s
-00050610: 656c 662e 6469 6d73 2069 6620 636f 6f72  elf.dims if coor
-00050620: 642e 6571 7561 6c73 2873 656c 665b 635d  d.equals(self[c]
-00050630: 295d 0a20 2020 2020 2020 2072 6564 7563  )].        reduc
-00050640: 655f 6469 6d73 5f20 3d20 6c69 7374 2873  e_dims_ = list(s
-00050650: 6574 2872 6564 7563 655f 6469 6d73 5f29  et(reduce_dims_)
-00050660: 290a 2020 2020 2020 2020 7072 6573 6572  ).        preser
-00050670: 7665 645f 6469 6d73 203d 206c 6973 7428  ved_dims = list(
-00050680: 7365 7428 7365 6c66 2e64 696d 7329 202d  set(self.dims) -
-00050690: 2073 6574 2872 6564 7563 655f 6469 6d73   set(reduce_dims
-000506a0: 5f29 290a 2020 2020 2020 2020 6966 206e  _)).        if n
-000506b0: 6f74 2072 6564 7563 655f 6469 6d73 5f3a  ot reduce_dims_:
-000506c0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000506d0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-000506e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000506f0: 4e6f 2061 7267 756d 656e 7473 2074 6f20  No arguments to 
-00050700: 6063 6f6f 7264 7360 2077 6572 6520 6964  `coords` were id
-00050710: 656e 7469 6669 6564 2061 7320 6120 6469  entified as a di
-00050720: 6d65 6e73 696f 6e20 6f6e 2074 6865 2063  mension on the c
-00050730: 616c 6c69 6e67 2022 0a20 2020 2020 2020  alling ".       
-00050740: 2020 2020 2020 2020 2022 6f62 6a65 6374           "object
-00050750: 2c20 616e 6420 6e6f 2064 696d 7320 7765  , and no dims we
-00050760: 7265 2073 7570 706c 6965 6420 746f 2060  re supplied to `
-00050770: 7265 6475 6365 5f64 696d 7360 2e20 5468  reduce_dims`. Th
-00050780: 6973 2077 6f75 6c64 2072 6573 756c 7420  is would result 
-00050790: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000507a0: 2020 2269 6e20 6669 7474 696e 6720 6f6e    "in fitting on
-000507b0: 2073 6361 6c61 7220 6461 7461 2e22 0a20   scalar data.". 
-000507c0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000507d0: 2020 2020 2020 2320 4272 6f61 6463 6173        # Broadcas
-000507e0: 7420 616c 6c20 636f 6f72 6473 2077 6974  t all coords wit
-000507f0: 6820 6561 6368 206f 7468 6572 0a20 2020  h each other.   
-00050800: 2020 2020 2063 6f6f 7264 735f 203d 2062       coords_ = b
-00050810: 726f 6164 6361 7374 282a 636f 6f72 6473  roadcast(*coords
-00050820: 5f29 0a20 2020 2020 2020 2063 6f6f 7264  _).        coord
-00050830: 735f 203d 205b 0a20 2020 2020 2020 2020  s_ = [.         
-00050840: 2020 2063 6f6f 7264 2e62 726f 6164 6361     coord.broadca
-00050850: 7374 5f6c 696b 6528 7365 6c66 2c20 6578  st_like(self, ex
-00050860: 636c 7564 653d 7072 6573 6572 7665 645f  clude=preserved_
-00050870: 6469 6d73 2920 666f 7220 636f 6f72 6420  dims) for coord 
-00050880: 696e 2063 6f6f 7264 735f 0a20 2020 2020  in coords_.     
-00050890: 2020 205d 0a0a 2020 2020 2020 2020 7061     ]..        pa
-000508a0: 7261 6d73 2c20 6675 6e63 5f61 7267 7320  rams, func_args 
-000508b0: 3d20 5f67 6574 5f66 756e 635f 6172 6773  = _get_func_args
-000508c0: 2866 756e 632c 2070 6172 616d 5f6e 616d  (func, param_nam
-000508d0: 6573 290a 2020 2020 2020 2020 7061 7261  es).        para
-000508e0: 6d5f 6465 6661 756c 7473 2c20 626f 756e  m_defaults, boun
-000508f0: 6473 5f64 6566 6175 6c74 7320 3d20 5f69  ds_defaults = _i
-00050900: 6e69 7469 616c 697a 655f 6375 7276 6566  nitialize_curvef
-00050910: 6974 5f70 6172 616d 7328 0a20 2020 2020  it_params(.     
-00050920: 2020 2020 2020 2070 6172 616d 732c 2070         params, p
-00050930: 302c 2062 6f75 6e64 732c 2066 756e 635f  0, bounds, func_
-00050940: 6172 6773 0a20 2020 2020 2020 2029 0a20  args.        ). 
-00050950: 2020 2020 2020 206e 5f70 6172 616d 7320         n_params 
-00050960: 3d20 6c65 6e28 7061 7261 6d73 290a 2020  = len(params).  
-00050970: 2020 2020 2020 6b77 6172 6773 2e73 6574        kwargs.set
-00050980: 6465 6661 756c 7428 2270 3022 2c20 5b70  default("p0", [p
-00050990: 6172 616d 5f64 6566 6175 6c74 735b 705d  aram_defaults[p]
-000509a0: 2066 6f72 2070 2069 6e20 7061 7261 6d73   for p in params
-000509b0: 5d29 0a20 2020 2020 2020 206b 7761 7267  ]).        kwarg
-000509c0: 732e 7365 7464 6566 6175 6c74 280a 2020  s.setdefault(.  
-000509d0: 2020 2020 2020 2020 2020 2262 6f75 6e64            "bound
-000509e0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
-000509f0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00050a00: 2020 5b62 6f75 6e64 735f 6465 6661 756c    [bounds_defaul
-00050a10: 7473 5b70 5d5b 305d 2066 6f72 2070 2069  ts[p][0] for p i
-00050a20: 6e20 7061 7261 6d73 5d2c 0a20 2020 2020  n params],.     
-00050a30: 2020 2020 2020 2020 2020 205b 626f 756e             [boun
-00050a40: 6473 5f64 6566 6175 6c74 735b 705d 5b31  ds_defaults[p][1
-00050a50: 5d20 666f 7220 7020 696e 2070 6172 616d  ] for p in param
-00050a60: 735d 2c0a 2020 2020 2020 2020 2020 2020  s],.            
-00050a70: 5d2c 0a20 2020 2020 2020 2029 0a0a 2020  ],.        )..  
-00050a80: 2020 2020 2020 6465 6620 5f77 7261 7070        def _wrapp
-00050a90: 6572 2859 2c20 2a63 6f6f 7264 735f 2c20  er(Y, *coords_, 
-00050aa0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-00050ab0: 2020 2020 2020 2023 2057 7261 7020 6375         # Wrap cu
-00050ac0: 7276 655f 6669 7420 7769 7468 2072 6176  rve_fit with rav
-00050ad0: 656c 6564 2063 6f6f 7264 696e 6174 6573  eled coordinates
-00050ae0: 2061 6e64 2070 6f69 6e74 7769 7365 204e   and pointwise N
-00050af0: 614e 2068 616e 646c 696e 670a 2020 2020  aN handling.    
-00050b00: 2020 2020 2020 2020 7820 3d20 6e70 2e76          x = np.v
-00050b10: 7374 6163 6b28 5b63 2e72 6176 656c 2829  stack([c.ravel()
-00050b20: 2066 6f72 2063 2069 6e20 636f 6f72 6473   for c in coords
-00050b30: 5f5d 290a 2020 2020 2020 2020 2020 2020  _]).            
-00050b40: 7920 3d20 592e 7261 7665 6c28 290a 2020  y = Y.ravel().  
-00050b50: 2020 2020 2020 2020 2020 6966 2073 6b69            if ski
-00050b60: 706e 613a 0a20 2020 2020 2020 2020 2020  pna:.           
-00050b70: 2020 2020 206d 6173 6b20 3d20 6e70 2e61       mask = np.a
-00050b80: 6c6c 285b 6e70 2e61 6e79 287e 6e70 2e69  ll([np.any(~np.i
-00050b90: 736e 616e 2878 292c 2061 7869 733d 3029  snan(x), axis=0)
-00050ba0: 2c20 7e6e 702e 6973 6e61 6e28 7929 5d2c  , ~np.isnan(y)],
-00050bb0: 2061 7869 733d 3029 0a20 2020 2020 2020   axis=0).       
-00050bc0: 2020 2020 2020 2020 2078 203d 2078 5b3a           x = x[:
-00050bd0: 2c20 6d61 736b 5d0a 2020 2020 2020 2020  , mask].        
-00050be0: 2020 2020 2020 2020 7920 3d20 795b 6d61          y = y[ma
-00050bf0: 736b 5d0a 2020 2020 2020 2020 2020 2020  sk].            
-00050c00: 2020 2020 6966 206e 6f74 206c 656e 2879      if not len(y
-00050c10: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00050c20: 2020 2020 2020 2070 6f70 7420 3d20 6e70         popt = np
-00050c30: 2e66 756c 6c28 5b6e 5f70 6172 616d 735d  .full([n_params]
-00050c40: 2c20 6e70 2e6e 616e 290a 2020 2020 2020  , np.nan).      
-00050c50: 2020 2020 2020 2020 2020 2020 2020 7063                pc
-00050c60: 6f76 203d 206e 702e 6675 6c6c 285b 6e5f  ov = np.full([n_
-00050c70: 7061 7261 6d73 2c20 6e5f 7061 7261 6d73  params, n_params
-00050c80: 5d2c 206e 702e 6e61 6e29 0a20 2020 2020  ], np.nan).     
-00050c90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00050ca0: 6574 7572 6e20 706f 7074 2c20 7063 6f76  eturn popt, pcov
-00050cb0: 0a20 2020 2020 2020 2020 2020 2078 203d  .            x =
-00050cc0: 206e 702e 7371 7565 657a 6528 7829 0a20   np.squeeze(x). 
-00050cd0: 2020 2020 2020 2020 2020 2070 6f70 742c             popt,
-00050ce0: 2070 636f 7620 3d20 6375 7276 655f 6669   pcov = curve_fi
-00050cf0: 7428 6675 6e63 2c20 782c 2079 2c20 2a2a  t(func, x, y, **
-00050d00: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-00050d10: 2020 2020 7265 7475 726e 2070 6f70 742c      return popt,
-00050d20: 2070 636f 760a 0a20 2020 2020 2020 2072   pcov..        r
-00050d30: 6573 756c 7420 3d20 7479 7065 2873 656c  esult = type(sel
-00050d40: 6629 2829 0a20 2020 2020 2020 2066 6f72  f)().        for
-00050d50: 206e 616d 652c 2064 6120 696e 2073 656c   name, da in sel
-00050d60: 662e 6461 7461 5f76 6172 732e 6974 656d  f.data_vars.item
-00050d70: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00050d80: 2069 6620 6e61 6d65 2069 7320 5f54 4849   if name is _THI
-00050d90: 535f 4152 5241 593a 0a20 2020 2020 2020  S_ARRAY:.       
-00050da0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-00050db0: 2222 0a20 2020 2020 2020 2020 2020 2065  "".            e
-00050dc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00050dd0: 2020 2020 206e 616d 6520 3d20 6622 7b73       name = f"{s
-00050de0: 7472 286e 616d 6529 7d5f 220a 0a20 2020  tr(name)}_"..   
-00050df0: 2020 2020 2020 2020 2070 6f70 742c 2070           popt, p
-00050e00: 636f 7620 3d20 6170 706c 795f 7566 756e  cov = apply_ufun
-00050e10: 6328 0a20 2020 2020 2020 2020 2020 2020  c(.             
-00050e20: 2020 205f 7772 6170 7065 722c 0a20 2020     _wrapper,.   
-00050e30: 2020 2020 2020 2020 2020 2020 2064 612c               da,
-00050e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050e50: 202a 636f 6f72 6473 5f2c 0a20 2020 2020   *coords_,.     
-00050e60: 2020 2020 2020 2020 2020 2076 6563 746f             vecto
-00050e70: 7269 7a65 3d54 7275 652c 0a20 2020 2020  rize=True,.     
-00050e80: 2020 2020 2020 2020 2020 2064 6173 6b3d             dask=
-00050e90: 2270 6172 616c 6c65 6c69 7a65 6422 2c0a  "parallelized",.
-00050ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050eb0: 696e 7075 745f 636f 7265 5f64 696d 733d  input_core_dims=
-00050ec0: 5b72 6564 7563 655f 6469 6d73 5f20 666f  [reduce_dims_ fo
-00050ed0: 7220 6420 696e 2072 616e 6765 286c 656e  r d in range(len
-00050ee0: 2863 6f6f 7264 735f 2920 2b20 3129 5d2c  (coords_) + 1)],
-00050ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050f00: 206f 7574 7075 745f 636f 7265 5f64 696d   output_core_dim
-00050f10: 733d 5b5b 2270 6172 616d 225d 2c20 5b22  s=[["param"], ["
-00050f20: 636f 765f 6922 2c20 2263 6f76 5f6a 225d  cov_i", "cov_j"]
-00050f30: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00050f40: 2020 2064 6173 6b5f 6775 6675 6e63 5f6b     dask_gufunc_k
-00050f50: 7761 7267 733d 7b0a 2020 2020 2020 2020  wargs={.        
-00050f60: 2020 2020 2020 2020 2020 2020 226f 7574              "out
-00050f70: 7075 745f 7369 7a65 7322 3a20 7b0a 2020  put_sizes": {.  
-00050f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050f90: 2020 2020 2020 2270 6172 616d 223a 206e        "param": n
-00050fa0: 5f70 6172 616d 732c 0a20 2020 2020 2020  _params,.       
-00050fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050fc0: 2022 636f 765f 6922 3a20 6e5f 7061 7261   "cov_i": n_para
-00050fd0: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
-00050fe0: 2020 2020 2020 2020 2020 2020 2263 6f76              "cov
-00050ff0: 5f6a 223a 206e 5f70 6172 616d 732c 0a20  _j": n_params,. 
-00051000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051010: 2020 207d 2c0a 2020 2020 2020 2020 2020     },.          
-00051020: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
-00051030: 2020 2020 2020 2020 206f 7574 7075 745f           output_
-00051040: 6474 7970 6573 3d28 6e70 2e66 6c6f 6174  dtypes=(np.float
-00051050: 3634 2c20 6e70 2e66 6c6f 6174 3634 292c  64, np.float64),
-00051060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051070: 2065 7863 6c75 6465 5f64 696d 733d 7365   exclude_dims=se
-00051080: 7428 7265 6475 6365 5f64 696d 735f 292c  t(reduce_dims_),
-00051090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000510a0: 206b 7761 7267 733d 6b77 6172 6773 2c0a   kwargs=kwargs,.
-000510b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000510c0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-000510d0: 5b6e 616d 6520 2b20 2263 7572 7665 6669  [name + "curvefi
-000510e0: 745f 636f 6566 6669 6369 656e 7473 225d  t_coefficients"]
-000510f0: 203d 2070 6f70 740a 2020 2020 2020 2020   = popt.        
-00051100: 2020 2020 7265 7375 6c74 5b6e 616d 6520      result[name 
-00051110: 2b20 2263 7572 7665 6669 745f 636f 7661  + "curvefit_cova
-00051120: 7269 616e 6365 225d 203d 2070 636f 760a  riance"] = pcov.
-00051130: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00051140: 3d20 7265 7375 6c74 2e61 7373 6967 6e5f  = result.assign_
-00051150: 636f 6f72 6473 280a 2020 2020 2020 2020  coords(.        
-00051160: 2020 2020 7b22 7061 7261 6d22 3a20 7061      {"param": pa
-00051170: 7261 6d73 2c20 2263 6f76 5f69 223a 2070  rams, "cov_i": p
-00051180: 6172 616d 732c 2022 636f 765f 6a22 3a20  arams, "cov_j": 
-00051190: 7061 7261 6d73 7d0a 2020 2020 2020 2020  params}.        
-000511a0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-000511b0: 2e61 7474 7273 203d 2073 656c 662e 6174  .attrs = self.at
-000511c0: 7472 732e 636f 7079 2829 0a0a 2020 2020  trs.copy()..    
-000511d0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-000511e0: 740a 0a20 2020 2064 6566 2064 726f 705f  t..    def drop_
-000511f0: 6475 706c 6963 6174 6573 280a 2020 2020  duplicates(.    
-00051200: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
-00051210: 7365 742c 0a20 2020 2020 2020 2064 696d  set,.        dim
-00051220: 3a20 4861 7368 6162 6c65 207c 2049 7465  : Hashable | Ite
-00051230: 7261 626c 655b 4861 7368 6162 6c65 5d2c  rable[Hashable],
-00051240: 0a20 2020 2020 2020 206b 6565 703a 204c  .        keep: L
-00051250: 6974 6572 616c 5b22 6669 7273 7422 2c20  iteral["first", 
-00051260: 226c 6173 7422 2c20 4661 6c73 655d 203d  "last", False] =
-00051270: 2022 6669 7273 7422 2c0a 2020 2020 2920   "first",.    ) 
-00051280: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
-00051290: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-000512a0: 2061 206e 6577 2044 6174 6173 6574 2077   a new Dataset w
-000512b0: 6974 6820 6475 706c 6963 6174 6520 6469  ith duplicate di
-000512c0: 6d65 6e73 696f 6e20 7661 6c75 6573 2072  mension values r
-000512d0: 656d 6f76 6564 2e0a 0a20 2020 2020 2020  emoved...       
-000512e0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000512f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00051300: 2020 2020 2020 2064 696d 203a 2064 696d         dim : dim
-00051310: 656e 7369 6f6e 206c 6162 656c 206f 7220  ension label or 
-00051320: 6c61 6265 6c73 0a20 2020 2020 2020 2020  labels.         
-00051330: 2020 2050 6173 7320 602e 2e2e 6020 746f     Pass `...` to
-00051340: 2064 726f 7020 6475 706c 6963 6174 6573   drop duplicates
-00051350: 2061 6c6f 6e67 2061 6c6c 2064 696d 656e   along all dimen
-00051360: 7369 6f6e 732e 0a20 2020 2020 2020 206b  sions..        k
-00051370: 6565 7020 3a20 7b22 6669 7273 7422 2c20  eep : {"first", 
-00051380: 226c 6173 7422 2c20 4661 6c73 657d 2c20  "last", False}, 
-00051390: 6465 6661 756c 743a 2022 6669 7273 7422  default: "first"
-000513a0: 0a20 2020 2020 2020 2020 2020 2044 6574  .            Det
-000513b0: 6572 6d69 6e65 7320 7768 6963 6820 6475  ermines which du
-000513c0: 706c 6963 6174 6573 2028 6966 2061 6e79  plicates (if any
-000513d0: 2920 746f 206b 6565 702e 0a20 2020 2020  ) to keep..     
-000513e0: 2020 2020 2020 202d 2060 6022 6669 7273         - ``"firs
-000513f0: 7422 6060 203a 2044 726f 7020 6475 706c  t"`` : Drop dupl
-00051400: 6963 6174 6573 2065 7863 6570 7420 666f  icates except fo
-00051410: 7220 7468 6520 6669 7273 7420 6f63 6375  r the first occu
-00051420: 7272 656e 6365 2e0a 2020 2020 2020 2020  rrence..        
-00051430: 2020 2020 2d20 6060 226c 6173 7422 6060      - ``"last"``
-00051440: 203a 2044 726f 7020 6475 706c 6963 6174   : Drop duplicat
-00051450: 6573 2065 7863 6570 7420 666f 7220 7468  es except for th
-00051460: 6520 6c61 7374 206f 6363 7572 7265 6e63  e last occurrenc
-00051470: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
-00051480: 2046 616c 7365 203a 2044 726f 7020 616c   False : Drop al
-00051490: 6c20 6475 706c 6963 6174 6573 2e0a 0a20  l duplicates... 
-000514a0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-000514b0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-000514c0: 2020 2020 2020 2044 6174 6173 6574 0a0a         Dataset..
-000514d0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-000514e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-000514f0: 2d0a 2020 2020 2020 2020 4461 7461 4172  -.        DataAr
-00051500: 7261 792e 6472 6f70 5f64 7570 6c69 6361  ray.drop_duplica
-00051510: 7465 730a 2020 2020 2020 2020 2222 220a  tes.        """.
-00051520: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00051530: 7461 6e63 6528 6469 6d2c 2073 7472 293a  tance(dim, str):
-00051540: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-00051550: 733a 2049 7465 7261 626c 6520 3d20 2864  s: Iterable = (d
-00051560: 696d 2c29 0a20 2020 2020 2020 2065 6c69  im,).        eli
-00051570: 6620 6469 6d20 6973 202e 2e2e 3a0a 2020  f dim is ...:.  
-00051580: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
-00051590: 2073 656c 662e 6469 6d73 0a20 2020 2020   self.dims.     
-000515a0: 2020 2065 6c69 6620 6e6f 7420 6973 696e     elif not isin
-000515b0: 7374 616e 6365 2864 696d 2c20 4974 6572  stance(dim, Iter
-000515c0: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
-000515d0: 2020 2064 696d 7320 3d20 5b64 696d 5d0a     dims = [dim].
-000515e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000515f0: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
-00051600: 2064 696d 0a0a 2020 2020 2020 2020 6d69   dim..        mi
-00051610: 7373 696e 675f 6469 6d73 203d 2073 6574  ssing_dims = set
-00051620: 2864 696d 7329 202d 2073 6574 2873 656c  (dims) - set(sel
-00051630: 662e 6469 6d73 290a 2020 2020 2020 2020  f.dims).        
-00051640: 6966 206d 6973 7369 6e67 5f64 696d 733a  if missing_dims:
-00051650: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00051660: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-00051670: 277b 6d69 7373 696e 675f 6469 6d73 7d27  '{missing_dims}'
-00051680: 206e 6f74 2066 6f75 6e64 2069 6e20 6469   not found in di
-00051690: 6d65 6e73 696f 6e73 2229 0a0a 2020 2020  mensions")..    
-000516a0: 2020 2020 696e 6465 7865 7320 3d20 7b64      indexes = {d
-000516b0: 696d 3a20 7e73 656c 662e 6765 745f 696e  im: ~self.get_in
-000516c0: 6465 7828 6469 6d29 2e64 7570 6c69 6361  dex(dim).duplica
-000516d0: 7465 6428 6b65 6570 3d6b 6565 7029 2066  ted(keep=keep) f
-000516e0: 6f72 2064 696d 2069 6e20 6469 6d73 7d0a  or dim in dims}.
-000516f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00051700: 656c 662e 6973 656c 2869 6e64 6578 6573  elf.isel(indexes
-00051710: 290a 0a20 2020 2064 6566 2063 6f6e 7665  )..    def conve
-00051720: 7274 5f63 616c 656e 6461 7228 0a20 2020  rt_calendar(.   
-00051730: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-00051740: 6173 6574 2c0a 2020 2020 2020 2020 6361  aset,.        ca
-00051750: 6c65 6e64 6172 3a20 4346 4361 6c65 6e64  lendar: CFCalend
-00051760: 6172 2c0a 2020 2020 2020 2020 6469 6d3a  ar,.        dim:
-00051770: 2048 6173 6861 626c 6520 3d20 2274 696d   Hashable = "tim
-00051780: 6522 2c0a 2020 2020 2020 2020 616c 6967  e",.        alig
-00051790: 6e5f 6f6e 3a20 4c69 7465 7261 6c5b 2264  n_on: Literal["d
-000517a0: 6174 6522 2c20 2279 6561 7222 2c20 4e6f  ate", "year", No
-000517b0: 6e65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ne] = None,.    
-000517c0: 2020 2020 6d69 7373 696e 673a 2041 6e79      missing: Any
-000517d0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000517e0: 2020 2020 2020 2020 7573 655f 6366 7469          use_cfti
-000517f0: 6d65 3a20 626f 6f6c 207c 204e 6f6e 6520  me: bool | None 
-00051800: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
-00051810: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
-00051820: 2020 2020 2222 2243 6f6e 7665 7274 2074      """Convert t
-00051830: 6865 2044 6174 6173 6574 2074 6f20 616e  he Dataset to an
-00051840: 6f74 6865 7220 6361 6c65 6e64 6172 2e0a  other calendar..
-00051850: 0a20 2020 2020 2020 204f 6e6c 7920 636f  .        Only co
-00051860: 6e76 6572 7473 2074 6865 2069 6e64 6976  nverts the indiv
-00051870: 6964 7561 6c20 7469 6d65 7374 616d 7073  idual timestamps
-00051880: 2c20 646f 6573 206e 6f74 206d 6f64 6966  , does not modif
-00051890: 7920 616e 7920 6461 7461 2065 7863 6570  y any data excep
-000518a0: 740a 2020 2020 2020 2020 696e 2064 726f  t.        in dro
-000518b0: 7070 696e 6720 696e 7661 6c69 642f 7375  pping invalid/su
-000518c0: 7270 6c75 7320 6461 7465 7320 6f72 2069  rplus dates or i
-000518d0: 6e73 6572 7469 6e67 206d 6973 7369 6e67  nserting missing
-000518e0: 2064 6174 6573 2e0a 0a20 2020 2020 2020   dates...       
-000518f0: 2049 6620 7468 6520 736f 7572 6365 2061   If the source a
-00051900: 6e64 2074 6172 6765 7420 6361 6c65 6e64  nd target calend
-00051910: 6172 7320 6172 6520 6569 7468 6572 206e  ars are either n
-00051920: 6f5f 6c65 6170 2c20 616c 6c5f 6c65 6170  o_leap, all_leap
-00051930: 206f 7220 610a 2020 2020 2020 2020 7374   or a.        st
-00051940: 616e 6461 7264 2074 7970 652c 206f 6e6c  andard type, onl
-00051950: 7920 7468 6520 7479 7065 206f 6620 7468  y the type of th
-00051960: 6520 7469 6d65 2061 7272 6179 2069 7320  e time array is 
-00051970: 6d6f 6469 6669 6564 2e0a 2020 2020 2020  modified..      
-00051980: 2020 5768 656e 2063 6f6e 7665 7274 696e    When convertin
-00051990: 6720 746f 2061 206c 6561 7020 7965 6172  g to a leap year
-000519a0: 2066 726f 6d20 6120 6e6f 6e2d 6c65 6170   from a non-leap
-000519b0: 2079 6561 722c 2074 6865 2032 3974 6820   year, the 29th 
-000519c0: 6f66 2046 6562 7275 6172 790a 2020 2020  of February.    
-000519d0: 2020 2020 6973 2072 656d 6f76 6564 2066      is removed f
-000519e0: 726f 6d20 7468 6520 6172 7261 792e 2049  rom the array. I
-000519f0: 6e20 7468 6520 6f74 6865 7220 6469 7265  n the other dire
-00051a00: 6374 696f 6e20 7468 6520 3239 7468 206f  ction the 29th o
-00051a10: 6620 4665 6272 7561 7279 0a20 2020 2020  f February.     
-00051a20: 2020 2077 696c 6c20 6265 206d 6973 7369     will be missi
-00051a30: 6e67 2069 6e20 7468 6520 6f75 7470 7574  ng in the output
-00051a40: 2c20 756e 6c65 7373 2060 6d69 7373 696e  , unless `missin
-00051a50: 6760 2069 7320 7370 6563 6966 6965 642c  g` is specified,
-00051a60: 0a20 2020 2020 2020 2069 6e20 7768 6963  .        in whic
-00051a70: 6820 6361 7365 2074 6861 7420 7661 6c75  h case that valu
-00051a80: 6520 6973 2069 6e73 6572 7465 642e 0a0a  e is inserted...
-00051a90: 2020 2020 2020 2020 466f 7220 636f 6e76          For conv
-00051aa0: 6572 7369 6f6e 7320 696e 766f 6c76 696e  ersions involvin
-00051ab0: 6720 6033 3630 5f64 6179 6020 6361 6c65  g `360_day` cale
-00051ac0: 6e64 6172 732c 2073 6565 204e 6f74 6573  ndars, see Notes
-00051ad0: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-00051ae0: 6d65 7468 6f64 2069 7320 7361 6665 2074  method is safe t
-00051af0: 6f20 7573 6520 7769 7468 2073 7562 2d64  o use with sub-d
-00051b00: 6169 6c79 2064 6174 6120 6173 2069 7420  aily data as it 
-00051b10: 646f 6573 6e27 7420 746f 7563 6820 7468  doesn't touch th
-00051b20: 650a 2020 2020 2020 2020 7469 6d65 2070  e.        time p
-00051b30: 6172 7420 6f66 2074 6865 2074 696d 6573  art of the times
-00051b40: 7461 6d70 732e 0a0a 2020 2020 2020 2020  tamps...        
-00051b50: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00051b60: 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020     ---------.   
-00051b70: 2020 2020 2063 616c 656e 6461 7220 3a20       calendar : 
-00051b80: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-00051b90: 5468 6520 7461 7267 6574 2063 616c 656e  The target calen
-00051ba0: 6461 7220 6e61 6d65 2e0a 2020 2020 2020  dar name..      
-00051bb0: 2020 6469 6d20 3a20 4861 7368 6162 6c65    dim : Hashable
-00051bc0: 2c20 6465 6661 756c 743a 2022 7469 6d65  , default: "time
-00051bd0: 220a 2020 2020 2020 2020 2020 2020 4e61  ".            Na
-00051be0: 6d65 206f 6620 7468 6520 7469 6d65 2063  me of the time c
-00051bf0: 6f6f 7264 696e 6174 652e 0a20 2020 2020  oordinate..     
-00051c00: 2020 2061 6c69 676e 5f6f 6e20 3a20 7b4e     align_on : {N
-00051c10: 6f6e 652c 2027 6461 7465 272c 2027 7965  one, 'date', 'ye
-00051c20: 6172 277d 2c20 6f70 7469 6f6e 616c 0a20  ar'}, optional. 
-00051c30: 2020 2020 2020 2020 2020 204d 7573 7420             Must 
-00051c40: 6265 2073 7065 6369 6669 6564 2077 6865  be specified whe
-00051c50: 6e20 6569 7468 6572 2073 6f75 7263 6520  n either source 
-00051c60: 6f72 2074 6172 6765 7420 6973 2061 2060  or target is a `
-00051c70: 3336 305f 6461 7960 2063 616c 656e 6461  360_day` calenda
-00051c80: 722c 0a20 2020 2020 2020 2020 2020 2069  r,.            i
-00051c90: 676e 6f72 6564 206f 7468 6572 7769 7365  gnored otherwise
-00051ca0: 2e20 5365 6520 4e6f 7465 732e 0a20 2020  . See Notes..   
-00051cb0: 2020 2020 206d 6973 7369 6e67 203a 2041       missing : A
-00051cc0: 6e79 206f 7220 4e6f 6e65 2c20 6f70 7469  ny or None, opti
-00051cd0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00051ce0: 2042 7920 6465 6661 756c 742c 2069 2e65   By default, i.e
-00051cf0: 2e20 6966 2074 6865 2076 616c 7565 2069  . if the value i
-00051d00: 7320 4e6f 6e65 2c20 7468 6973 206d 6574  s None, this met
-00051d10: 686f 6420 7769 6c6c 2073 696d 706c 7920  hod will simply 
-00051d20: 6174 7465 6d70 740a 2020 2020 2020 2020  attempt.        
-00051d30: 2020 2020 746f 2063 6f6e 7665 7274 2074      to convert t
-00051d40: 6865 2064 6174 6573 2069 6e20 7468 6520  he dates in the 
-00051d50: 736f 7572 6365 2063 616c 656e 6461 7220  source calendar 
-00051d60: 746f 2074 6865 2073 616d 6520 6461 7465  to the same date
-00051d70: 7320 696e 2074 6865 0a20 2020 2020 2020  s in the.       
-00051d80: 2020 2020 2074 6172 6765 7420 6361 6c65       target cale
-00051d90: 6e64 6172 2c20 616e 6420 6472 6f70 2061  ndar, and drop a
-00051da0: 6e79 206f 6620 7468 6f73 6520 7468 6174  ny of those that
-00051db0: 2061 7265 206e 6f74 2070 6f73 7369 626c   are not possibl
-00051dc0: 6520 746f 0a20 2020 2020 2020 2020 2020  e to.           
-00051dd0: 2072 6570 7265 7365 6e74 2e20 2049 6620   represent.  If 
-00051de0: 6120 7661 6c75 6520 6973 2070 726f 7669  a value is provi
-00051df0: 6465 642c 2061 206e 6577 2074 696d 6520  ded, a new time 
-00051e00: 636f 6f72 6469 6e61 7465 2077 696c 6c20  coordinate will 
-00051e10: 6265 0a20 2020 2020 2020 2020 2020 2063  be.            c
-00051e20: 7265 6174 6564 2069 6e20 7468 6520 7461  reated in the ta
-00051e30: 7267 6574 2063 616c 656e 6461 7220 7769  rget calendar wi
-00051e40: 7468 2074 6865 2073 616d 6520 6672 6571  th the same freq
-00051e50: 7565 6e63 7920 6173 2074 6865 206f 7269  uency as the ori
-00051e60: 6769 6e61 6c0a 2020 2020 2020 2020 2020  ginal.          
-00051e70: 2020 7469 6d65 2063 6f6f 7264 696e 6174    time coordinat
-00051e80: 653b 2066 6f72 2061 6e79 2064 6174 6573  e; for any dates
-00051e90: 2074 6861 7420 6172 6520 6e6f 7420 7072   that are not pr
-00051ea0: 6573 656e 7420 696e 2074 6865 2073 6f75  esent in the sou
-00051eb0: 7263 652c 2074 6865 0a20 2020 2020 2020  rce, the.       
-00051ec0: 2020 2020 2064 6174 6120 7769 6c6c 2062       data will b
-00051ed0: 6520 6669 6c6c 6564 2077 6974 6820 7468  e filled with th
-00051ee0: 6973 2076 616c 7565 2e20 204e 6f74 6520  is value.  Note 
-00051ef0: 7468 6174 2075 7369 6e67 2074 6869 7320  that using this 
-00051f00: 6d6f 6465 2072 6571 7569 7265 730a 2020  mode requires.  
-00051f10: 2020 2020 2020 2020 2020 7468 6174 2074            that t
-00051f20: 6865 2073 6f75 7263 6520 6461 7461 2068  he source data h
-00051f30: 6176 6520 616e 2069 6e66 6572 6162 6c65  ave an inferable
-00051f40: 2066 7265 7175 656e 6379 3b20 666f 7220   frequency; for 
-00051f50: 6d6f 7265 2069 6e66 6f72 6d61 7469 6f6e  more information
-00051f60: 0a20 2020 2020 2020 2020 2020 2073 6565  .            see
-00051f70: 203a 7079 3a66 756e 633a 6078 6172 7261   :py:func:`xarra
-00051f80: 792e 696e 6665 725f 6672 6571 602e 2020  y.infer_freq`.  
-00051f90: 466f 7220 6365 7274 6169 6e20 6672 6571  For certain freq
-00051fa0: 7565 6e63 792c 2073 6f75 7263 652c 2061  uency, source, a
-00051fb0: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
-00051fc0: 6172 6765 7420 6361 6c65 6e64 6172 2063  arget calendar c
-00051fd0: 6f6d 6269 6e61 7469 6f6e 732c 2074 6869  ombinations, thi
-00051fe0: 7320 636f 756c 6420 7265 7375 6c74 2069  s could result i
-00051ff0: 6e20 6d61 6e79 206d 6973 7369 6e67 2076  n many missing v
-00052000: 616c 7565 732c 2073 6565 206e 6f74 6573  alues, see notes
-00052010: 2e0a 2020 2020 2020 2020 7573 655f 6366  ..        use_cf
-00052020: 7469 6d65 203a 2062 6f6f 6c20 6f72 204e  time : bool or N
-00052030: 6f6e 652c 206f 7074 696f 6e61 6c0a 2020  one, optional.  
-00052040: 2020 2020 2020 2020 2020 5768 6574 6865            Whethe
-00052050: 7220 746f 2075 7365 2063 6674 696d 6520  r to use cftime 
-00052060: 6f62 6a65 6374 7320 696e 2074 6865 206f  objects in the o
-00052070: 7574 7075 742c 206f 6e6c 7920 7573 6564  utput, only used
-00052080: 2069 6620 6063 616c 656e 6461 7260 0a20   if `calendar`. 
-00052090: 2020 2020 2020 2020 2020 2069 7320 6f6e             is on
-000520a0: 6520 6f66 207b 2270 726f 6c65 7074 6963  e of {"proleptic
-000520b0: 5f67 7265 676f 7269 616e 222c 2022 6772  _gregorian", "gr
-000520c0: 6567 6f72 6961 6e22 206f 7220 2273 7461  egorian" or "sta
-000520d0: 6e64 6172 6422 7d2e 0a20 2020 2020 2020  ndard"}..       
-000520e0: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-000520f0: 6520 6e65 7720 7469 6d65 2061 7869 7320  e new time axis 
-00052100: 7573 6573 2063 6674 696d 6520 6f62 6a65  uses cftime obje
-00052110: 6374 732e 0a20 2020 2020 2020 2020 2020  cts..           
-00052120: 2049 6620 4e6f 6e65 2028 6465 6661 756c   If None (defaul
-00052130: 7429 2c20 6974 2075 7365 7320 3a70 793a  t), it uses :py:
-00052140: 636c 6173 733a 606e 756d 7079 2e64 6174  class:`numpy.dat
-00052150: 6574 696d 6536 3460 2076 616c 7565 7320  etime64` values 
-00052160: 6966 2074 6865 0a20 2020 2020 2020 2020  if the.         
-00052170: 2020 2064 6174 6520 7261 6e67 6520 7065     date range pe
-00052180: 726d 6974 7320 6974 2c20 616e 6420 3a70  rmits it, and :p
-00052190: 793a 636c 6173 733a 6063 6674 696d 652e  y:class:`cftime.
-000521a0: 6461 7465 7469 6d65 6020 6f62 6a65 6374  datetime` object
-000521b0: 7320 6966 206e 6f74 2e0a 2020 2020 2020  s if not..      
-000521c0: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
-000521d0: 6974 2075 7365 7320 3a70 793a 636c 6173  it uses :py:clas
-000521e0: 733a 606e 756d 7079 2e64 6174 6574 696d  s:`numpy.datetim
-000521f0: 6536 3460 2020 6f72 2066 6169 6c73 2e0a  e64`  or fails..
-00052200: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00052210: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00052220: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-00052230: 0a20 2020 2020 2020 2020 2020 2043 6f70  .            Cop
-00052240: 7920 6f66 2074 6865 2064 6174 6161 7272  y of the dataarr
-00052250: 6179 2077 6974 6820 7468 6520 7469 6d65  ay with the time
-00052260: 2063 6f6f 7264 696e 6174 6520 636f 6e76   coordinate conv
-00052270: 6572 7465 6420 746f 2074 6865 0a20 2020  erted to the.   
-00052280: 2020 2020 2020 2020 2074 6172 6765 7420           target 
-00052290: 6361 6c65 6e64 6172 2e20 4966 2027 6d69  calendar. If 'mi
-000522a0: 7373 696e 6727 2077 6173 204e 6f6e 6520  ssing' was None 
-000522b0: 2864 6566 6175 6c74 292c 2069 6e76 616c  (default), inval
-000522c0: 6964 2064 6174 6573 2069 6e0a 2020 2020  id dates in.    
-000522d0: 2020 2020 2020 2020 7468 6520 6e65 7720          the new 
-000522e0: 6361 6c65 6e64 6172 2061 7265 2064 726f  calendar are dro
-000522f0: 7070 6564 2c20 6275 7420 6d69 7373 696e  pped, but missin
-00052300: 6720 6461 7465 7320 6172 6520 6e6f 7420  g dates are not 
-00052310: 696e 7365 7274 6564 2e0a 2020 2020 2020  inserted..      
-00052320: 2020 2020 2020 4966 2060 6d69 7373 696e        If `missin
-00052330: 6760 2077 6173 2067 6976 656e 2c20 7468  g` was given, th
-00052340: 6520 6e65 7720 6461 7461 2069 7320 7265  e new data is re
-00052350: 696e 6465 7865 6420 746f 2068 6176 6520  indexed to have 
-00052360: 6120 7469 6d65 2061 7869 730a 2020 2020  a time axis.    
-00052370: 2020 2020 2020 2020 7769 7468 2074 6865          with the
-00052380: 2073 616d 6520 6672 6571 7565 6e63 7920   same frequency 
-00052390: 6173 2074 6865 2073 6f75 7263 652c 2062  as the source, b
-000523a0: 7574 2069 6e20 7468 6520 6e65 7720 6361  ut in the new ca
-000523b0: 6c65 6e64 6172 3b20 616e 790a 2020 2020  lendar; any.    
-000523c0: 2020 2020 2020 2020 6d69 7373 696e 6720          missing 
-000523d0: 6461 7461 706f 696e 7473 2061 7265 2066  datapoints are f
-000523e0: 696c 6c65 6420 7769 7468 2060 6d69 7373  illed with `miss
-000523f0: 696e 6760 2e0a 0a20 2020 2020 2020 204e  ing`...        N
-00052400: 6f74 6573 0a20 2020 2020 2020 202d 2d2d  otes.        ---
-00052410: 2d2d 0a20 2020 2020 2020 2050 6173 7369  --.        Passi
-00052420: 6e67 2061 2076 616c 7565 2074 6f20 606d  ng a value to `m
-00052430: 6973 7369 6e67 6020 6973 206f 6e6c 7920  issing` is only 
-00052440: 7573 6162 6c65 2069 6620 7468 6520 736f  usable if the so
-00052450: 7572 6365 2773 2074 696d 6520 636f 6f72  urce's time coor
-00052460: 6469 6e61 7465 2061 7320 616e 0a20 2020  dinate as an.   
-00052470: 2020 2020 2069 6e66 6572 6162 6c65 2066       inferable f
-00052480: 7265 7175 656e 6369 6573 2028 7365 6520  requencies (see 
-00052490: 3a70 793a 6675 6e63 3a60 7e78 6172 7261  :py:func:`~xarra
-000524a0: 792e 696e 6665 725f 6672 6571 6029 2061  y.infer_freq`) a
-000524b0: 6e64 2069 7320 6f6e 6c79 2061 7070 726f  nd is only appro
-000524c0: 7072 6961 7465 0a20 2020 2020 2020 2069  priate.        i
-000524d0: 6620 7468 6520 7461 7267 6574 2063 6f6f  f the target coo
-000524e0: 7264 696e 6174 652c 2067 656e 6572 6174  rdinate, generat
-000524f0: 6564 2066 726f 6d20 7468 6973 2066 7265  ed from this fre
-00052500: 7175 656e 6379 2c20 6861 7320 6461 7465  quency, has date
-00052510: 7320 6571 7569 7661 6c65 6e74 2074 6f20  s equivalent to 
-00052520: 7468 650a 2020 2020 2020 2020 736f 7572  the.        sour
-00052530: 6365 2e20 4974 2069 7320 7573 7561 6c6c  ce. It is usuall
-00052540: 7920 2a2a 6e6f 742a 2a20 6170 7072 6f70  y **not** approp
-00052550: 7269 6174 6520 746f 2075 7365 2074 6869  riate to use thi
-00052560: 7320 6d6f 6465 2077 6974 683a 0a0a 2020  s mode with:..  
-00052570: 2020 2020 2020 2d20 5065 7269 6f64 2d65        - Period-e
-00052580: 6e64 2066 7265 7175 656e 6369 6573 203a  nd frequencies :
-00052590: 2027 4127 2c20 2759 272c 2027 5127 206f   'A', 'Y', 'Q' o
-000525a0: 7220 274d 272c 2069 6e20 6f70 706f 7369  r 'M', in opposi
-000525b0: 7469 6f6e 2074 6f20 2741 5327 2027 5953  tion to 'AS' 'YS
-000525c0: 272c 2027 5153 2720 616e 6420 274d 5327  ', 'QS' and 'MS'
-000525d0: 0a20 2020 2020 2020 202d 2053 7562 2d6d  .        - Sub-m
-000525e0: 6f6e 7468 6c79 2066 7265 7175 656e 6369  onthly frequenci
-000525f0: 6573 2074 6861 7420 646f 206e 6f74 2064  es that do not d
-00052600: 6976 6964 6520 6120 6461 7920 6576 656e  ivide a day even
-00052610: 6c79 203a 2027 5727 2c20 276e 4427 2077  ly : 'W', 'nD' w
-00052620: 6865 7265 2060 4e20 213d 2031 600a 2020  here `N != 1`.  
-00052630: 2020 2020 2020 2020 2020 6f72 2027 6d48            or 'mH
-00052640: 2720 7768 6572 6520 3234 2025 206d 2021  ' where 24 % m !
-00052650: 3d20 3029 2e0a 0a20 2020 2020 2020 2049  = 0)...        I
-00052660: 6620 6f6e 6520 6f66 2074 6865 2073 6f75  f one of the sou
-00052670: 7263 6520 6f72 2074 6172 6765 7420 6361  rce or target ca
-00052680: 6c65 6e64 6172 7320 6973 2060 2233 3630  lendars is `"360
-00052690: 5f64 6179 2260 2c20 6061 6c69 676e 5f6f  _day"`, `align_o
-000526a0: 6e60 206d 7573 740a 2020 2020 2020 2020  n` must.        
-000526b0: 6265 2073 7065 6369 6669 6564 2061 6e64  be specified and
-000526c0: 2074 776f 206f 7074 696f 6e73 2061 7265   two options are
-000526d0: 206f 6666 6572 6564 2e0a 0a20 2020 2020   offered...     
-000526e0: 2020 202d 2022 7965 6172 220a 2020 2020     - "year".    
-000526f0: 2020 2020 2020 2020 5468 6520 6461 7465          The date
-00052700: 7320 6172 6520 7472 616e 736c 6174 6564  s are translated
-00052710: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
-00052720: 6569 7220 7265 6c61 7469 7665 2070 6f73  eir relative pos
-00052730: 6974 696f 6e20 696e 2074 6865 2079 6561  ition in the yea
-00052740: 722c 0a20 2020 2020 2020 2020 2020 2069  r,.            i
-00052750: 676e 6f72 696e 6720 7468 6569 7220 6f72  gnoring their or
-00052760: 6967 696e 616c 206d 6f6e 7468 2061 6e64  iginal month and
-00052770: 2064 6179 2069 6e66 6f72 6d61 7469 6f6e   day information
-00052780: 2c20 6d65 616e 696e 6720 7468 6174 2074  , meaning that t
-00052790: 6865 0a20 2020 2020 2020 2020 2020 206d  he.            m
-000527a0: 6973 7369 6e67 2f73 7572 706c 7573 2064  issing/surplus d
-000527b0: 6179 7320 6172 6520 6164 6465 642f 7265  ays are added/re
-000527c0: 6d6f 7665 6420 6174 2072 6567 756c 6172  moved at regular
-000527d0: 2069 6e74 6572 7661 6c73 2e0a 0a20 2020   intervals...   
-000527e0: 2020 2020 2020 2020 2046 726f 6d20 6120           From a 
-000527f0: 6033 3630 5f64 6179 6020 746f 2061 2073  `360_day` to a s
-00052800: 7461 6e64 6172 6420 6361 6c65 6e64 6172  tandard calendar
-00052810: 2c20 7468 6520 6f75 7470 7574 2077 696c  , the output wil
-00052820: 6c20 6265 206d 6973 7369 6e67 2074 6865  l be missing the
-00052830: 0a20 2020 2020 2020 2020 2020 2066 6f6c  .            fol
-00052840: 6c6f 7769 6e67 2064 6174 6573 2028 6461  lowing dates (da
-00052850: 7920 6f66 2079 6561 7220 696e 2070 6172  y of year in par
-00052860: 656e 7468 6573 6573 293a 0a0a 2020 2020  entheses):..    
-00052870: 2020 2020 2020 2020 546f 2061 206c 6561          To a lea
-00052880: 7020 7965 6172 3a0a 2020 2020 2020 2020  p year:.        
-00052890: 2020 2020 2020 2020 4a61 6e75 6172 7920          January 
-000528a0: 3331 7374 2028 3331 292c 204d 6172 6368  31st (31), March
-000528b0: 2033 3173 7420 2839 3129 2c20 4a75 6e65   31st (91), June
-000528c0: 2031 7374 2028 3135 3329 2c20 4a75 6c79   1st (153), July
-000528d0: 2033 3173 7420 2832 3133 292c 0a20 2020   31st (213),.   
-000528e0: 2020 2020 2020 2020 2020 2020 2053 6570               Sep
-000528f0: 7465 6d62 6572 2033 3173 7420 2832 3735  tember 31st (275
-00052900: 2920 616e 6420 4e6f 7665 6d62 6572 2033  ) and November 3
-00052910: 3074 6820 2833 3335 292e 0a20 2020 2020  0th (335)..     
-00052920: 2020 2020 2020 2054 6f20 6120 6e6f 6e2d         To a non-
-00052930: 6c65 6170 2079 6561 723a 0a20 2020 2020  leap year:.     
-00052940: 2020 2020 2020 2020 2020 2046 6562 7275             Febru
-00052950: 6172 7920 3674 6820 2833 3629 2c20 4170  ary 6th (36), Ap
-00052960: 7269 6c20 3139 7468 2028 3130 3929 2c20  ril 19th (109), 
-00052970: 4a75 6c79 2032 6e64 2028 3138 3329 2c0a  July 2nd (183),.
-00052980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052990: 5365 7074 656d 6265 7220 3132 7468 2028  September 12th (
-000529a0: 3235 3529 2c20 4e6f 7665 6d62 6572 2032  255), November 2
-000529b0: 3574 6820 2833 3239 292e 0a0a 2020 2020  5th (329)...    
-000529c0: 2020 2020 2020 2020 4672 6f6d 2061 2073          From a s
-000529d0: 7461 6e64 6172 6420 6361 6c65 6e64 6172  tandard calendar
-000529e0: 2074 6f20 6120 6022 3336 305f 6461 7922   to a `"360_day"
-000529f0: 602c 2074 6865 2066 6f6c 6c6f 7769 6e67  `, the following
-00052a00: 2064 6174 6573 2069 6e20 7468 650a 2020   dates in the.  
-00052a10: 2020 2020 2020 2020 2020 736f 7572 6365            source
-00052a20: 2061 7272 6179 2077 696c 6c20 6265 2064   array will be d
-00052a30: 726f 7070 6564 3a0a 0a20 2020 2020 2020  ropped:..       
-00052a40: 2020 2020 2046 726f 6d20 6120 6c65 6170       From a leap
-00052a50: 2079 6561 723a 0a20 2020 2020 2020 2020   year:.         
-00052a60: 2020 2020 2020 204a 616e 7561 7279 2033         January 3
-00052a70: 3173 7420 2833 3129 2c20 4170 7269 6c20  1st (31), April 
-00052a80: 3173 7420 2839 3229 2c20 4a75 6e65 2031  1st (92), June 1
-00052a90: 7374 2028 3135 3329 2c20 4175 6775 7374  st (153), August
-00052aa0: 2031 7374 2028 3231 3429 2c0a 2020 2020   1st (214),.    
-00052ab0: 2020 2020 2020 2020 2020 2020 5365 7074              Sept
-00052ac0: 656d 6265 7220 3331 7374 2028 3237 3529  ember 31st (275)
-00052ad0: 2c20 4465 6365 6d62 6572 2031 7374 2028  , December 1st (
-00052ae0: 3333 3629 0a20 2020 2020 2020 2020 2020  336).           
-00052af0: 2046 726f 6d20 6120 6e6f 6e2d 6c65 6170   From a non-leap
-00052b00: 2079 6561 723a 0a20 2020 2020 2020 2020   year:.         
-00052b10: 2020 2020 2020 2046 6562 7275 6172 7920         February 
-00052b20: 3674 6820 2833 3729 2c20 4170 7269 6c20  6th (37), April 
-00052b30: 3230 7468 2028 3131 3029 2c20 4a75 6c79  20th (110), July
-00052b40: 2032 6e64 2028 3138 3329 2c0a 2020 2020   2nd (183),.    
-00052b50: 2020 2020 2020 2020 2020 2020 5365 7074              Sept
-00052b60: 656d 6265 7220 3133 7468 2028 3235 3629  ember 13th (256)
-00052b70: 2c20 4e6f 7665 6d62 6572 2032 3574 6820  , November 25th 
-00052b80: 2833 3239 290a 0a20 2020 2020 2020 2020  (329)..         
-00052b90: 2020 2054 6869 7320 6f70 7469 6f6e 2069     This option i
-00052ba0: 7320 6265 7374 2075 7365 6420 6f6e 2064  s best used on d
-00052bb0: 6169 6c79 2061 6e64 2073 7562 6461 696c  aily and subdail
-00052bc0: 7920 6461 7461 2e0a 0a20 2020 2020 2020  y data...       
-00052bd0: 202d 2022 6461 7465 220a 2020 2020 2020   - "date".      
-00052be0: 2020 2020 2020 5468 6520 6d6f 6e74 682f        The month/
-00052bf0: 6461 7920 696e 666f 726d 6174 696f 6e20  day information 
-00052c00: 6973 2063 6f6e 7365 7276 6564 2061 6e64  is conserved and
-00052c10: 2069 6e76 616c 6964 2064 6174 6573 2061   invalid dates a
-00052c20: 7265 2064 726f 7070 6564 0a20 2020 2020  re dropped.     
-00052c30: 2020 2020 2020 2066 726f 6d20 7468 6520         from the 
-00052c40: 6f75 7470 7574 2e20 5468 6973 206d 6561  output. This mea
-00052c50: 6e73 2074 6861 7420 7768 656e 2063 6f6e  ns that when con
-00052c60: 7665 7274 696e 6720 6672 6f6d 2061 2060  verting from a `
-00052c70: 2233 3630 5f64 6179 2260 2074 6f20 610a  "360_day"` to a.
-00052c80: 2020 2020 2020 2020 2020 2020 7374 616e              stan
-00052c90: 6461 7264 2063 616c 656e 6461 722c 2061  dard calendar, a
-00052ca0: 6c6c 2033 3173 7420 284a 616e 2c20 4d61  ll 31st (Jan, Ma
-00052cb0: 7263 682c 204d 6179 2c20 4a75 6c79 2c20  rch, May, July, 
-00052cc0: 4175 6775 7374 2c20 4f63 746f 6265 7220  August, October 
-00052cd0: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
-00052ce0: 4465 6365 6d62 6572 2920 7769 6c6c 2062  December) will b
-00052cf0: 6520 6d69 7373 696e 6720 6173 2074 6865  e missing as the
-00052d00: 7265 2069 7320 6e6f 2065 7175 6976 616c  re is no equival
-00052d10: 656e 7420 6461 7465 7320 696e 2074 6865  ent dates in the
-00052d20: 0a20 2020 2020 2020 2020 2020 2060 2233  .            `"3
-00052d30: 3630 5f64 6179 2260 2063 616c 656e 6461  60_day"` calenda
-00052d40: 7220 616e 6420 7468 6520 3239 7468 2028  r and the 29th (
-00052d50: 6f6e 206e 6f6e 2d6c 6561 7020 7965 6172  on non-leap year
-00052d60: 7329 2061 6e64 2033 3074 6820 6f66 2046  s) and 30th of F
-00052d70: 6562 7275 6172 790a 2020 2020 2020 2020  ebruary.        
-00052d80: 2020 2020 7769 6c6c 2062 6520 6472 6f70      will be drop
-00052d90: 7065 6420 6173 2074 6865 7265 2061 7265  ped as there are
-00052da0: 206e 6f20 6571 7569 7661 6c65 6e74 2064   no equivalent d
-00052db0: 6174 6573 2069 6e20 6120 7374 616e 6461  ates in a standa
-00052dc0: 7264 2063 616c 656e 6461 722e 0a0a 2020  rd calendar...  
-00052dd0: 2020 2020 2020 2020 2020 5468 6973 206f            This o
-00052de0: 7074 696f 6e20 6973 2062 6573 7420 7573  ption is best us
-00052df0: 6564 2077 6974 6820 6461 7461 206f 6e20  ed with data on 
-00052e00: 6120 6672 6571 7565 6e63 7920 636f 6172  a frequency coar
-00052e10: 7365 7220 7468 616e 2064 6169 6c79 2e0a  ser than daily..
-00052e20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00052e30: 2020 2020 7265 7475 726e 2063 6f6e 7665      return conve
-00052e40: 7274 5f63 616c 656e 6461 7228 0a20 2020  rt_calendar(.   
-00052e50: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
-00052e60: 2020 2020 2020 2020 2020 2063 616c 656e             calen
-00052e70: 6461 722c 0a20 2020 2020 2020 2020 2020  dar,.           
-00052e80: 2064 696d 3d64 696d 2c0a 2020 2020 2020   dim=dim,.      
-00052e90: 2020 2020 2020 616c 6967 6e5f 6f6e 3d61        align_on=a
-00052ea0: 6c69 676e 5f6f 6e2c 0a20 2020 2020 2020  lign_on,.       
-00052eb0: 2020 2020 206d 6973 7369 6e67 3d6d 6973       missing=mis
-00052ec0: 7369 6e67 2c0a 2020 2020 2020 2020 2020  sing,.          
-00052ed0: 2020 7573 655f 6366 7469 6d65 3d75 7365    use_cftime=use
-00052ee0: 5f63 6674 696d 652c 0a20 2020 2020 2020  _cftime,.       
-00052ef0: 2029 0a0a 2020 2020 6465 6620 696e 7465   )..    def inte
-00052f00: 7270 5f63 616c 656e 6461 7228 0a20 2020  rp_calendar(.   
-00052f10: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
-00052f20: 6173 6574 2c0a 2020 2020 2020 2020 7461  aset,.        ta
-00052f30: 7267 6574 3a20 7064 2e44 6174 6574 696d  rget: pd.Datetim
-00052f40: 6549 6e64 6578 207c 2043 4654 696d 6549  eIndex | CFTimeI
-00052f50: 6e64 6578 207c 2044 6174 6141 7272 6179  ndex | DataArray
-00052f60: 2c0a 2020 2020 2020 2020 6469 6d3a 2048  ,.        dim: H
-00052f70: 6173 6861 626c 6520 3d20 2274 696d 6522  ashable = "time"
-00052f80: 2c0a 2020 2020 2920 2d3e 2054 5f44 6174  ,.    ) -> T_Dat
-00052f90: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
-00052fa0: 2249 6e74 6572 706f 6c61 7465 7320 7468  "Interpolates th
-00052fb0: 6520 4461 7461 7365 7420 746f 2061 6e6f  e Dataset to ano
-00052fc0: 7468 6572 2063 616c 656e 6461 7220 6261  ther calendar ba
-00052fd0: 7365 6420 6f6e 2064 6563 696d 616c 2079  sed on decimal y
-00052fe0: 6561 7220 6d65 6173 7572 652e 0a0a 2020  ear measure...  
-00052ff0: 2020 2020 2020 4561 6368 2074 696d 6573        Each times
-00053000: 7461 6d70 2069 6e20 6073 6f75 7263 6560  tamp in `source`
-00053010: 2061 6e64 2060 7461 7267 6574 6020 6172   and `target` ar
-00053020: 6520 6669 7273 7420 636f 6e76 6572 7465  e first converte
-00053030: 6420 746f 2074 6865 6972 2064 6563 696d  d to their decim
-00053040: 616c 0a20 2020 2020 2020 2079 6561 7220  al.        year 
-00053050: 6571 7569 7661 6c65 6e74 2074 6865 6e20  equivalent then 
-00053060: 6073 6f75 7263 6560 2069 7320 696e 7465  `source` is inte
-00053070: 7270 6f6c 6174 6564 206f 6e20 7468 6520  rpolated on the 
-00053080: 7461 7267 6574 2063 6f6f 7264 696e 6174  target coordinat
-00053090: 652e 0a20 2020 2020 2020 2054 6865 2064  e..        The d
-000530a0: 6563 696d 616c 2079 6561 7220 6f66 2061  ecimal year of a
-000530b0: 2074 696d 6573 7461 6d70 2069 7320 6974   timestamp is it
-000530c0: 7320 7965 6172 2070 6c75 7320 6974 7320  s year plus its 
-000530d0: 7375 622d 7965 6172 2063 6f6d 706f 6e65  sub-year compone
-000530e0: 6e74 0a20 2020 2020 2020 2063 6f6e 7665  nt.        conve
-000530f0: 7274 6564 2074 6f20 7468 6520 6672 6163  rted to the frac
-00053100: 7469 6f6e 206f 6620 6974 7320 7965 6172  tion of its year
-00053110: 2e20 466f 7220 6578 616d 706c 6520 2232  . For example "2
-00053120: 3030 302d 3033 2d30 3120 3132 3a30 3022  000-03-01 12:00"
-00053130: 2069 730a 2020 2020 2020 2020 3230 3030   is.        2000
-00053140: 2e31 3635 3320 696e 2061 2073 7461 6e64  .1653 in a stand
-00053150: 6172 6420 6361 6c65 6e64 6172 206f 7220  ard calendar or 
-00053160: 3230 3030 2e31 3633 3031 2069 6e20 6120  2000.16301 in a 
-00053170: 6022 6e6f 6c65 6170 2260 2063 616c 656e  `"noleap"` calen
-00053180: 6461 722e 0a0a 2020 2020 2020 2020 5468  dar...        Th
-00053190: 6973 206d 6574 686f 6420 7368 6f75 6c64  is method should
-000531a0: 206f 6e6c 7920 6265 2075 7365 6420 7768   only be used wh
-000531b0: 656e 2074 6865 2074 696d 6520 2848 483a  en the time (HH:
-000531c0: 4d4d 3a53 5329 2069 6e66 6f72 6d61 7469  MM:SS) informati
-000531d0: 6f6e 206f 660a 2020 2020 2020 2020 7469  on of.        ti
-000531e0: 6d65 2063 6f6f 7264 696e 6174 6520 6973  me coordinate is
-000531f0: 206e 6f74 2069 6d70 6f72 7461 6e74 2e0a   not important..
-00053200: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00053210: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00053220: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2074  ------.        t
-00053230: 6172 6765 743a 2044 6174 6141 7272 6179  arget: DataArray
-00053240: 206f 7220 4461 7465 7469 6d65 496e 6465   or DatetimeInde
-00053250: 7820 6f72 2043 4654 696d 6549 6e64 6578  x or CFTimeIndex
-00053260: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00053270: 2074 6172 6765 7420 7469 6d65 2063 6f6f   target time coo
-00053280: 7264 696e 6174 6520 6f66 2061 2076 616c  rdinate of a val
-00053290: 6964 2064 7479 7065 0a20 2020 2020 2020  id dtype.       
-000532a0: 2020 2020 2028 6e70 2e64 6174 6574 696d       (np.datetim
-000532b0: 6536 3420 6f72 2063 6674 696d 6520 6f62  e64 or cftime ob
-000532c0: 6a65 6374 7329 0a20 2020 2020 2020 2064  jects).        d
-000532d0: 696d 203a 2048 6173 6861 626c 652c 2064  im : Hashable, d
-000532e0: 6566 6175 6c74 3a20 2274 696d 6522 0a20  efault: "time". 
-000532f0: 2020 2020 2020 2020 2020 2054 6865 2074             The t
-00053300: 696d 6520 636f 6f72 6469 6e61 7465 206e  ime coordinate n
-00053310: 616d 652e 0a0a 2020 2020 2020 2020 5265  ame...        Re
-00053320: 7475 726e 0a20 2020 2020 2020 202d 2d2d  turn.        ---
-00053330: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
-00053340: 4172 7261 790a 2020 2020 2020 2020 2020  Array.          
-00053350: 2020 5468 6520 736f 7572 6365 2069 6e74    The source int
-00053360: 6572 706f 6c61 7465 6420 6f6e 2074 6865  erpolated on the
-00053370: 2064 6563 696d 616c 2079 6561 7273 206f   decimal years o
-00053380: 6620 7461 7267 6574 2c0a 2020 2020 2020  f target,.      
-00053390: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-000533a0: 7475 726e 2069 6e74 6572 705f 6361 6c65  turn interp_cale
-000533b0: 6e64 6172 2873 656c 662c 2074 6172 6765  ndar(self, targe
-000533c0: 742c 2064 696d 3d64 696d 290a 0a20 2020  t, dim=dim)..   
-000533d0: 2064 6566 2067 726f 7570 6279 280a 2020   def groupby(.  
-000533e0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-000533f0: 2020 2020 6772 6f75 703a 2048 6173 6861      group: Hasha
-00053400: 626c 6520 7c20 4461 7461 4172 7261 7920  ble | DataArray 
-00053410: 7c20 496e 6465 7856 6172 6961 626c 652c  | IndexVariable,
-00053420: 0a20 2020 2020 2020 2073 7175 6565 7a65  .        squeeze
-00053430: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-00053440: 2020 2020 2020 2072 6573 746f 7265 5f63         restore_c
-00053450: 6f6f 7264 5f64 696d 733a 2062 6f6f 6c20  oord_dims: bool 
-00053460: 3d20 4661 6c73 652c 0a20 2020 2029 202d  = False,.    ) -
-00053470: 3e20 4461 7461 7365 7447 726f 7570 4279  > DatasetGroupBy
-00053480: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00053490: 7572 6e73 2061 2044 6174 6173 6574 4772  urns a DatasetGr
-000534a0: 6f75 7042 7920 6f62 6a65 6374 2066 6f72  oupBy object for
-000534b0: 2070 6572 666f 726d 696e 6720 6772 6f75   performing grou
-000534c0: 7065 6420 6f70 6572 6174 696f 6e73 2e0a  ped operations..
-000534d0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-000534e0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-000534f0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2067  ------.        g
-00053500: 726f 7570 203a 2048 6173 6861 626c 652c  roup : Hashable,
-00053510: 2044 6174 6141 7272 6179 206f 7220 496e   DataArray or In
-00053520: 6465 7856 6172 6961 626c 650a 2020 2020  dexVariable.    
-00053530: 2020 2020 2020 2020 4172 7261 7920 7768          Array wh
-00053540: 6f73 6520 756e 6971 7565 2076 616c 7565  ose unique value
-00053550: 7320 7368 6f75 6c64 2062 6520 7573 6564  s should be used
-00053560: 2074 6f20 6772 6f75 7020 7468 6973 2061   to group this a
-00053570: 7272 6179 2e20 4966 2061 0a20 2020 2020  rray. If a.     
-00053580: 2020 2020 2020 2073 7472 696e 672c 206d         string, m
-00053590: 7573 7420 6265 2074 6865 206e 616d 6520  ust be the name 
-000535a0: 6f66 2061 2076 6172 6961 626c 6520 636f  of a variable co
-000535b0: 6e74 6169 6e65 6420 696e 2074 6869 7320  ntained in this 
-000535c0: 6461 7461 7365 742e 0a20 2020 2020 2020  dataset..       
-000535d0: 2073 7175 6565 7a65 203a 2062 6f6f 6c2c   squeeze : bool,
-000535e0: 2064 6566 6175 6c74 3a20 5472 7565 0a20   default: True. 
-000535f0: 2020 2020 2020 2020 2020 2049 6620 2267             If "g
-00053600: 726f 7570 2220 6973 2061 2064 696d 656e  roup" is a dimen
-00053610: 7369 6f6e 206f 6620 616e 7920 6172 7261  sion of any arra
-00053620: 7973 2069 6e20 7468 6973 2064 6174 6173  ys in this datas
-00053630: 6574 2c20 6073 7175 6565 7a65 600a 2020  et, `squeeze`.  
-00053640: 2020 2020 2020 2020 2020 636f 6e74 726f            contro
-00053650: 6c73 2077 6865 7468 6572 2074 6865 2073  ls whether the s
-00053660: 7562 6172 7261 7973 2068 6176 6520 6120  ubarrays have a 
-00053670: 6469 6d65 6e73 696f 6e20 6f66 206c 656e  dimension of len
-00053680: 6774 6820 3120 616c 6f6e 670a 2020 2020  gth 1 along.    
-00053690: 2020 2020 2020 2020 7468 6174 2064 696d          that dim
-000536a0: 656e 7369 6f6e 206f 7220 6966 2074 6865  ension or if the
-000536b0: 2064 696d 656e 7369 6f6e 2069 7320 7371   dimension is sq
-000536c0: 7565 657a 6564 206f 7574 2e0a 2020 2020  ueezed out..    
-000536d0: 2020 2020 7265 7374 6f72 655f 636f 6f72      restore_coor
-000536e0: 645f 6469 6d73 203a 2062 6f6f 6c2c 2064  d_dims : bool, d
-000536f0: 6566 6175 6c74 3a20 4661 6c73 650a 2020  efault: False.  
-00053700: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00053710: 652c 2061 6c73 6f20 7265 7374 6f72 6520  e, also restore 
-00053720: 7468 6520 6469 6d65 6e73 696f 6e20 6f72  the dimension or
-00053730: 6465 7220 6f66 206d 756c 7469 2d64 696d  der of multi-dim
-00053740: 656e 7369 6f6e 616c 0a20 2020 2020 2020  ensional.       
-00053750: 2020 2020 2063 6f6f 7264 696e 6174 6573       coordinates
-00053760: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00053770: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00053780: 2d2d 0a20 2020 2020 2020 2067 726f 7570  --.        group
-00053790: 6564 203a 2044 6174 6173 6574 4772 6f75  ed : DatasetGrou
-000537a0: 7042 790a 2020 2020 2020 2020 2020 2020  pBy.            
-000537b0: 4120 6044 6174 6173 6574 4772 6f75 7042  A `DatasetGroupB
-000537c0: 7960 206f 626a 6563 7420 7061 7474 6572  y` object patter
-000537d0: 6e65 6420 6166 7465 7220 6070 616e 6461  ned after `panda
-000537e0: 732e 4772 6f75 7042 7960 2074 6861 7420  s.GroupBy` that 
-000537f0: 6361 6e20 6265 0a20 2020 2020 2020 2020  can be.         
-00053800: 2020 2069 7465 7261 7465 6420 6f76 6572     iterated over
-00053810: 2069 6e20 7468 6520 666f 726d 206f 6620   in the form of 
-00053820: 6028 756e 6971 7565 5f76 616c 7565 2c20  `(unique_value, 
-00053830: 6772 6f75 7065 645f 6172 7261 7929 6020  grouped_array)` 
-00053840: 7061 6972 732e 0a0a 2020 2020 2020 2020  pairs...        
-00053850: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00053860: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00053870: 2020 3a72 6566 3a60 6772 6f75 7062 7960    :ref:`groupby`
-00053880: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
-00053890: 7273 2067 7569 6465 2065 7870 6c61 6e61  rs guide explana
-000538a0: 7469 6f6e 206f 6620 686f 7720 746f 2067  tion of how to g
-000538b0: 726f 7570 2061 6e64 2062 696e 2064 6174  roup and bin dat
-000538c0: 612e 0a20 2020 2020 2020 2044 6174 6173  a..        Datas
-000538d0: 6574 2e67 726f 7570 6279 5f62 696e 730a  et.groupby_bins.
-000538e0: 2020 2020 2020 2020 4461 7461 4172 7261          DataArra
-000538f0: 792e 6772 6f75 7062 790a 2020 2020 2020  y.groupby.      
-00053900: 2020 636f 7265 2e67 726f 7570 6279 2e44    core.groupby.D
-00053910: 6174 6173 6574 4772 6f75 7042 790a 2020  atasetGroupBy.  
-00053920: 2020 2020 2020 7061 6e64 6173 2e44 6174        pandas.Dat
-00053930: 6146 7261 6d65 2e67 726f 7570 6279 0a20  aFrame.groupby. 
-00053940: 2020 2020 2020 2044 6174 6173 6574 2e72         Dataset.r
-00053950: 6573 616d 706c 650a 2020 2020 2020 2020  esample.        
-00053960: 4461 7461 4172 7261 792e 7265 7361 6d70  DataArray.resamp
-00053970: 6c65 0a20 2020 2020 2020 2022 2222 0a20  le.        """. 
-00053980: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
-00053990: 6179 2e63 6f72 652e 6772 6f75 7062 7920  ay.core.groupby 
-000539a0: 696d 706f 7274 2044 6174 6173 6574 4772  import DatasetGr
-000539b0: 6f75 7042 790a 0a20 2020 2020 2020 2023  oupBy..        #
-000539c0: 2057 6869 6c65 2077 6520 646f 6e27 7420   While we don't 
-000539d0: 6765 6e65 7261 6c6c 7920 6368 6563 6b20  generally check 
-000539e0: 7468 6520 7479 7065 206f 6620 6576 6572  the type of ever
-000539f0: 7920 6172 672c 2070 6173 7369 6e67 0a20  y arg, passing. 
-00053a00: 2020 2020 2020 2023 206d 756c 7469 706c         # multipl
-00053a10: 6520 6469 6d65 6e73 696f 6e73 2061 7320  e dimensions as 
-00053a20: 6d75 6c74 6970 6c65 2061 7267 756d 656e  multiple argumen
-00053a30: 7473 2069 7320 636f 6d6d 6f6e 2065 6e6f  ts is common eno
-00053a40: 7567 682c 2061 6e64 2074 6865 0a20 2020  ugh, and the.   
-00053a50: 2020 2020 2023 2063 6f6e 7365 7175 656e       # consequen
-00053a60: 6365 7320 6869 6464 656e 2065 6e6f 7567  ces hidden enoug
-00053a70: 6820 2873 7472 696e 6773 2065 7661 6c75  h (strings evalu
-00053a80: 6174 6520 6173 2074 7275 6529 2074 6f20  ate as true) to 
-00053a90: 7761 7272 616e 740a 2020 2020 2020 2020  warrant.        
-00053aa0: 2320 6368 6563 6b69 6e67 2068 6572 652e  # checking here.
-00053ab0: 0a20 2020 2020 2020 2023 2041 2066 7574  .        # A fut
-00053ac0: 7572 6520 7665 7273 696f 6e20 636f 756c  ure version coul
-00053ad0: 6420 6d61 6b65 2073 7175 6565 7a65 206b  d make squeeze k
-00053ae0: 7761 7267 206f 6e6c 792c 2062 7574 2077  warg only, but w
-00053af0: 6f75 6c64 2066 6163 650a 2020 2020 2020  ould face.      
-00053b00: 2020 2320 6261 636b 7761 7264 2d63 6f6d    # backward-com
-00053b10: 7061 7420 6973 7375 6573 2e0a 2020 2020  pat issues..    
-00053b20: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00053b30: 7461 6e63 6528 7371 7565 657a 652c 2062  tance(squeeze, b
-00053b40: 6f6f 6c29 3a0a 2020 2020 2020 2020 2020  ool):.          
-00053b50: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-00053b60: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00053b70: 2020 2066 2260 7371 7565 657a 6560 206d     f"`squeeze` m
-00053b80: 7573 7420 6265 2054 7275 6520 6f72 2046  ust be True or F
-00053b90: 616c 7365 2c20 6275 7420 7b73 7175 6565  alse, but {squee
-00053ba0: 7a65 7d20 7761 7320 7375 7070 6c69 6564  ze} was supplied
-00053bb0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00053bc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00053bd0: 4461 7461 7365 7447 726f 7570 4279 280a  DatasetGroupBy(.
-00053be0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00053bf0: 2c20 6772 6f75 702c 2073 7175 6565 7a65  , group, squeeze
-00053c00: 3d73 7175 6565 7a65 2c20 7265 7374 6f72  =squeeze, restor
-00053c10: 655f 636f 6f72 645f 6469 6d73 3d72 6573  e_coord_dims=res
-00053c20: 746f 7265 5f63 6f6f 7264 5f64 696d 730a  tore_coord_dims.
-00053c30: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00053c40: 6566 2067 726f 7570 6279 5f62 696e 7328  ef groupby_bins(
-00053c50: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00053c60: 2020 2020 2020 2067 726f 7570 3a20 4861         group: Ha
-00053c70: 7368 6162 6c65 207c 2044 6174 6141 7272  shable | DataArr
-00053c80: 6179 207c 2049 6e64 6578 5661 7269 6162  ay | IndexVariab
-00053c90: 6c65 2c0a 2020 2020 2020 2020 6269 6e73  le,.        bins
-00053ca0: 3a20 4172 7261 794c 696b 652c 0a20 2020  : ArrayLike,.   
-00053cb0: 2020 2020 2072 6967 6874 3a20 626f 6f6c       right: bool
-00053cc0: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-00053cd0: 206c 6162 656c 733a 2041 7272 6179 4c69   labels: ArrayLi
-00053ce0: 6b65 207c 204e 6f6e 6520 3d20 4e6f 6e65  ke | None = None
-00053cf0: 2c0a 2020 2020 2020 2020 7072 6563 6973  ,.        precis
-00053d00: 696f 6e3a 2069 6e74 203d 2033 2c0a 2020  ion: int = 3,.  
-00053d10: 2020 2020 2020 696e 636c 7564 655f 6c6f        include_lo
-00053d20: 7765 7374 3a20 626f 6f6c 203d 2046 616c  west: bool = Fal
-00053d30: 7365 2c0a 2020 2020 2020 2020 7371 7565  se,.        sque
-00053d40: 657a 653a 2062 6f6f 6c20 3d20 5472 7565  eze: bool = True
-00053d50: 2c0a 2020 2020 2020 2020 7265 7374 6f72  ,.        restor
-00053d60: 655f 636f 6f72 645f 6469 6d73 3a20 626f  e_coord_dims: bo
-00053d70: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00053d80: 2920 2d3e 2044 6174 6173 6574 4772 6f75  ) -> DatasetGrou
-00053d90: 7042 793a 0a20 2020 2020 2020 2022 2222  pBy:.        """
-00053da0: 5265 7475 726e 7320 6120 4461 7461 7365  Returns a Datase
-00053db0: 7447 726f 7570 4279 206f 626a 6563 7420  tGroupBy object 
-00053dc0: 666f 7220 7065 7266 6f72 6d69 6e67 2067  for performing g
-00053dd0: 726f 7570 6564 206f 7065 7261 7469 6f6e  rouped operation
-00053de0: 732e 0a0a 2020 2020 2020 2020 5261 7468  s...        Rath
-00053df0: 6572 2074 6861 6e20 7573 696e 6720 616c  er than using al
-00053e00: 6c20 756e 6971 7565 2076 616c 7565 7320  l unique values 
-00053e10: 6f66 2060 6772 6f75 7060 2c20 7468 6520  of `group`, the 
-00053e20: 7661 6c75 6573 2061 7265 2064 6973 6372  values are discr
-00053e30: 6574 697a 6564 0a20 2020 2020 2020 2066  etized.        f
-00053e40: 6972 7374 2062 7920 6170 706c 7969 6e67  irst by applying
-00053e50: 2060 7061 6e64 6173 2e63 7574 6020 5b31   `pandas.cut` [1
-00053e60: 5d5f 2074 6f20 6067 726f 7570 602e 0a0a  ]_ to `group`...
-00053e70: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00053e80: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00053e90: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6772  -----.        gr
-00053ea0: 6f75 7020 3a20 4861 7368 6162 6c65 2c20  oup : Hashable, 
-00053eb0: 4461 7461 4172 7261 7920 6f72 2049 6e64  DataArray or Ind
-00053ec0: 6578 5661 7269 6162 6c65 0a20 2020 2020  exVariable.     
-00053ed0: 2020 2020 2020 2041 7272 6179 2077 686f         Array who
-00053ee0: 7365 2062 696e 6e65 6420 7661 6c75 6573  se binned values
-00053ef0: 2073 686f 756c 6420 6265 2075 7365 6420   should be used 
-00053f00: 746f 2067 726f 7570 2074 6869 7320 6172  to group this ar
-00053f10: 7261 792e 2049 6620 610a 2020 2020 2020  ray. If a.      
-00053f20: 2020 2020 2020 7374 7269 6e67 2c20 6d75        string, mu
-00053f30: 7374 2062 6520 7468 6520 6e61 6d65 206f  st be the name o
-00053f40: 6620 6120 7661 7269 6162 6c65 2063 6f6e  f a variable con
-00053f50: 7461 696e 6564 2069 6e20 7468 6973 2064  tained in this d
-00053f60: 6174 6173 6574 2e0a 2020 2020 2020 2020  ataset..        
-00053f70: 6269 6e73 203a 2069 6e74 206f 7220 6172  bins : int or ar
-00053f80: 7261 792d 6c69 6b65 0a20 2020 2020 2020  ray-like.       
-00053f90: 2020 2020 2049 6620 6269 6e73 2069 7320       If bins is 
-00053fa0: 616e 2069 6e74 2c20 6974 2064 6566 696e  an int, it defin
-00053fb0: 6573 2074 6865 206e 756d 6265 7220 6f66  es the number of
-00053fc0: 2065 7175 616c 2d77 6964 7468 2062 696e   equal-width bin
-00053fd0: 7320 696e 2074 6865 0a20 2020 2020 2020  s in the.       
-00053fe0: 2020 2020 2072 616e 6765 206f 6620 782e       range of x.
-00053ff0: 2048 6f77 6576 6572 2c20 696e 2074 6869   However, in thi
-00054000: 7320 6361 7365 2c20 7468 6520 7261 6e67  s case, the rang
-00054010: 6520 6f66 2078 2069 7320 6578 7465 6e64  e of x is extend
-00054020: 6564 2062 7920 2e31 250a 2020 2020 2020  ed by .1%.      
-00054030: 2020 2020 2020 6f6e 2065 6163 6820 7369        on each si
-00054040: 6465 2074 6f20 696e 636c 7564 6520 7468  de to include th
-00054050: 6520 6d69 6e20 6f72 206d 6178 2076 616c  e min or max val
-00054060: 7565 7320 6f66 2078 2e20 4966 2062 696e  ues of x. If bin
-00054070: 7320 6973 2061 0a20 2020 2020 2020 2020  s is a.         
-00054080: 2020 2073 6571 7565 6e63 6520 6974 2064     sequence it d
-00054090: 6566 696e 6573 2074 6865 2062 696e 2065  efines the bin e
-000540a0: 6467 6573 2061 6c6c 6f77 696e 6720 666f  dges allowing fo
-000540b0: 7220 6e6f 6e2d 756e 6966 6f72 6d20 6269  r non-uniform bi
-000540c0: 6e0a 2020 2020 2020 2020 2020 2020 7769  n.            wi
-000540d0: 6474 682e 204e 6f20 6578 7465 6e73 696f  dth. No extensio
-000540e0: 6e20 6f66 2074 6865 2072 616e 6765 206f  n of the range o
-000540f0: 6620 7820 6973 2064 6f6e 6520 696e 2074  f x is done in t
-00054100: 6869 7320 6361 7365 2e0a 2020 2020 2020  his case..      
-00054110: 2020 7269 6768 7420 3a20 626f 6f6c 2c20    right : bool, 
-00054120: 6465 6661 756c 743a 2054 7275 650a 2020  default: True.  
-00054130: 2020 2020 2020 2020 2020 496e 6469 6361            Indica
-00054140: 7465 7320 7768 6574 6865 7220 7468 6520  tes whether the 
-00054150: 6269 6e73 2069 6e63 6c75 6465 2074 6865  bins include the
-00054160: 2072 6967 6874 6d6f 7374 2065 6467 6520   rightmost edge 
-00054170: 6f72 206e 6f74 2e20 4966 0a20 2020 2020  or not. If.     
-00054180: 2020 2020 2020 2072 6967 6874 203d 3d20         right == 
-00054190: 5472 7565 2028 7468 6520 6465 6661 756c  True (the defaul
-000541a0: 7429 2c20 7468 656e 2074 6865 2062 696e  t), then the bin
-000541b0: 7320 5b31 2c32 2c33 2c34 5d20 696e 6469  s [1,2,3,4] indi
-000541c0: 6361 7465 0a20 2020 2020 2020 2020 2020  cate.           
-000541d0: 2028 312c 325d 2c20 2832 2c33 5d2c 2028   (1,2], (2,3], (
-000541e0: 332c 345d 2e0a 2020 2020 2020 2020 6c61  3,4]..        la
-000541f0: 6265 6c73 203a 2061 7272 6179 2d6c 696b  bels : array-lik
-00054200: 6520 6f72 2062 6f6f 6c2c 2064 6566 6175  e or bool, defau
-00054210: 6c74 3a20 4e6f 6e65 0a20 2020 2020 2020  lt: None.       
-00054220: 2020 2020 2055 7365 6420 6173 206c 6162       Used as lab
-00054230: 656c 7320 666f 7220 7468 6520 7265 7375  els for the resu
-00054240: 6c74 696e 6720 6269 6e73 2e20 4d75 7374  lting bins. Must
-00054250: 2062 6520 6f66 2074 6865 2073 616d 6520   be of the same 
-00054260: 6c65 6e67 7468 2061 730a 2020 2020 2020  length as.      
-00054270: 2020 2020 2020 7468 6520 7265 7375 6c74        the result
-00054280: 696e 6720 6269 6e73 2e20 4966 2046 616c  ing bins. If Fal
-00054290: 7365 2c20 7374 7269 6e67 2062 696e 206c  se, string bin l
-000542a0: 6162 656c 7320 6172 6520 6173 7369 676e  abels are assign
-000542b0: 6564 2062 790a 2020 2020 2020 2020 2020  ed by.          
-000542c0: 2020 6070 616e 6461 732e 6375 7460 2e0a    `pandas.cut`..
-000542d0: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-000542e0: 6e20 3a20 696e 742c 2064 6566 6175 6c74  n : int, default
-000542f0: 3a20 330a 2020 2020 2020 2020 2020 2020  : 3.            
-00054300: 5468 6520 7072 6563 6973 696f 6e20 6174  The precision at
-00054310: 2077 6869 6368 2074 6f20 7374 6f72 6520   which to store 
-00054320: 616e 6420 6469 7370 6c61 7920 7468 6520  and display the 
-00054330: 6269 6e73 206c 6162 656c 732e 0a20 2020  bins labels..   
-00054340: 2020 2020 2069 6e63 6c75 6465 5f6c 6f77       include_low
-00054350: 6573 7420 3a20 626f 6f6c 2c20 6465 6661  est : bool, defa
-00054360: 756c 743a 2046 616c 7365 0a20 2020 2020  ult: False.     
-00054370: 2020 2020 2020 2057 6865 7468 6572 2074         Whether t
-00054380: 6865 2066 6972 7374 2069 6e74 6572 7661  he first interva
-00054390: 6c20 7368 6f75 6c64 2062 6520 6c65 6674  l should be left
-000543a0: 2d69 6e63 6c75 7369 7665 206f 7220 6e6f  -inclusive or no
-000543b0: 742e 0a20 2020 2020 2020 2073 7175 6565  t..        squee
-000543c0: 7a65 203a 2062 6f6f 6c2c 2064 6566 6175  ze : bool, defau
-000543d0: 6c74 3a20 5472 7565 0a20 2020 2020 2020  lt: True.       
-000543e0: 2020 2020 2049 6620 2267 726f 7570 2220       If "group" 
-000543f0: 6973 2061 2064 696d 656e 7369 6f6e 206f  is a dimension o
-00054400: 6620 616e 7920 6172 7261 7973 2069 6e20  f any arrays in 
-00054410: 7468 6973 2064 6174 6173 6574 2c20 6073  this dataset, `s
-00054420: 7175 6565 7a65 600a 2020 2020 2020 2020  queeze`.        
-00054430: 2020 2020 636f 6e74 726f 6c73 2077 6865      controls whe
-00054440: 7468 6572 2074 6865 2073 7562 6172 7261  ther the subarra
-00054450: 7973 2068 6176 6520 6120 6469 6d65 6e73  ys have a dimens
-00054460: 696f 6e20 6f66 206c 656e 6774 6820 3120  ion of length 1 
-00054470: 616c 6f6e 670a 2020 2020 2020 2020 2020  along.          
-00054480: 2020 7468 6174 2064 696d 656e 7369 6f6e    that dimension
-00054490: 206f 7220 6966 2074 6865 2064 696d 656e   or if the dimen
-000544a0: 7369 6f6e 2069 7320 7371 7565 657a 6564  sion is squeezed
-000544b0: 206f 7574 2e0a 2020 2020 2020 2020 7265   out..        re
-000544c0: 7374 6f72 655f 636f 6f72 645f 6469 6d73  store_coord_dims
-000544d0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-000544e0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
-000544f0: 2020 2020 4966 2054 7275 652c 2061 6c73      If True, als
-00054500: 6f20 7265 7374 6f72 6520 7468 6520 6469  o restore the di
-00054510: 6d65 6e73 696f 6e20 6f72 6465 7220 6f66  mension order of
-00054520: 206d 756c 7469 2d64 696d 656e 7369 6f6e   multi-dimension
-00054530: 616c 0a20 2020 2020 2020 2020 2020 2063  al.            c
-00054540: 6f6f 7264 696e 6174 6573 2e0a 0a20 2020  oordinates...   
-00054550: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00054560: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00054570: 2020 2020 2067 726f 7570 6564 203a 2044       grouped : D
-00054580: 6174 6173 6574 4772 6f75 7042 790a 2020  atasetGroupBy.  
-00054590: 2020 2020 2020 2020 2020 4120 6044 6174            A `Dat
-000545a0: 6173 6574 4772 6f75 7042 7960 206f 626a  asetGroupBy` obj
-000545b0: 6563 7420 7061 7474 6572 6e65 6420 6166  ect patterned af
-000545c0: 7465 7220 6070 616e 6461 732e 4772 6f75  ter `pandas.Grou
-000545d0: 7042 7960 2074 6861 7420 6361 6e20 6265  pBy` that can be
-000545e0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-000545f0: 7261 7465 6420 6f76 6572 2069 6e20 7468  rated over in th
-00054600: 6520 666f 726d 206f 6620 6028 756e 6971  e form of `(uniq
-00054610: 7565 5f76 616c 7565 2c20 6772 6f75 7065  ue_value, groupe
-00054620: 645f 6172 7261 7929 6020 7061 6972 732e  d_array)` pairs.
-00054630: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-00054640: 206e 616d 6520 6f66 2074 6865 2067 726f   name of the gro
-00054650: 7570 2068 6173 2074 6865 2061 6464 6564  up has the added
-00054660: 2073 7566 6669 7820 605f 6269 6e73 6020   suffix `_bins` 
-00054670: 696e 206f 7264 6572 2074 6f0a 2020 2020  in order to.    
-00054680: 2020 2020 2020 2020 6469 7374 696e 6775          distingu
-00054690: 6973 6820 6974 2066 726f 6d20 7468 6520  ish it from the 
-000546a0: 6f72 6967 696e 616c 2076 6172 6961 626c  original variabl
-000546b0: 652e 0a0a 2020 2020 2020 2020 5365 6520  e...        See 
-000546c0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-000546d0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 3a72  -----.        :r
-000546e0: 6566 3a60 6772 6f75 7062 7960 0a20 2020  ef:`groupby`.   
-000546f0: 2020 2020 2020 2020 2055 7365 7273 2067           Users g
-00054700: 7569 6465 2065 7870 6c61 6e61 7469 6f6e  uide explanation
-00054710: 206f 6620 686f 7720 746f 2067 726f 7570   of how to group
-00054720: 2061 6e64 2062 696e 2064 6174 612e 0a20   and bin data.. 
-00054730: 2020 2020 2020 2044 6174 6173 6574 2e67         Dataset.g
-00054740: 726f 7570 6279 0a20 2020 2020 2020 2044  roupby.        D
-00054750: 6174 6141 7272 6179 2e67 726f 7570 6279  ataArray.groupby
-00054760: 5f62 696e 730a 2020 2020 2020 2020 636f  _bins.        co
-00054770: 7265 2e67 726f 7570 6279 2e44 6174 6173  re.groupby.Datas
-00054780: 6574 4772 6f75 7042 790a 2020 2020 2020  etGroupBy.      
-00054790: 2020 7061 6e64 6173 2e44 6174 6146 7261    pandas.DataFra
-000547a0: 6d65 2e67 726f 7570 6279 0a0a 2020 2020  me.groupby..    
-000547b0: 2020 2020 5265 6665 7265 6e63 6573 0a20      References. 
-000547c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-000547d0: 2d0a 2020 2020 2020 2020 2e2e 205b 315d  -.        .. [1]
-000547e0: 2068 7474 703a 2f2f 7061 6e64 6173 2e70   http://pandas.p
-000547f0: 7964 6174 612e 6f72 672f 7061 6e64 6173  ydata.org/pandas
-00054800: 2d64 6f63 732f 7374 6162 6c65 2f67 656e  -docs/stable/gen
-00054810: 6572 6174 6564 2f70 616e 6461 732e 6375  erated/pandas.cu
-00054820: 742e 6874 6d6c 0a20 2020 2020 2020 2022  t.html.        "
-00054830: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00054840: 7861 7272 6179 2e63 6f72 652e 6772 6f75  xarray.core.grou
-00054850: 7062 7920 696d 706f 7274 2044 6174 6173  pby import Datas
-00054860: 6574 4772 6f75 7042 790a 0a20 2020 2020  etGroupBy..     
-00054870: 2020 2072 6574 7572 6e20 4461 7461 7365     return Datase
-00054880: 7447 726f 7570 4279 280a 2020 2020 2020  tGroupBy(.      
-00054890: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-000548a0: 2020 2020 2020 2020 6772 6f75 702c 0a20          group,. 
-000548b0: 2020 2020 2020 2020 2020 2073 7175 6565             squee
-000548c0: 7a65 3d73 7175 6565 7a65 2c0a 2020 2020  ze=squeeze,.    
-000548d0: 2020 2020 2020 2020 6269 6e73 3d62 696e          bins=bin
-000548e0: 732c 0a20 2020 2020 2020 2020 2020 2072  s,.            r
-000548f0: 6573 746f 7265 5f63 6f6f 7264 5f64 696d  estore_coord_dim
-00054900: 733d 7265 7374 6f72 655f 636f 6f72 645f  s=restore_coord_
-00054910: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
-00054920: 2020 6375 745f 6b77 6172 6773 3d7b 0a20    cut_kwargs={. 
-00054930: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00054940: 7269 6768 7422 3a20 7269 6768 742c 0a20  right": right,. 
-00054950: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00054960: 6c61 6265 6c73 223a 206c 6162 656c 732c  labels": labels,
-00054970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00054980: 2022 7072 6563 6973 696f 6e22 3a20 7072   "precision": pr
-00054990: 6563 6973 696f 6e2c 0a20 2020 2020 2020  ecision,.       
-000549a0: 2020 2020 2020 2020 2022 696e 636c 7564           "includ
-000549b0: 655f 6c6f 7765 7374 223a 2069 6e63 6c75  e_lowest": inclu
-000549c0: 6465 5f6c 6f77 6573 742c 0a20 2020 2020  de_lowest,.     
-000549d0: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
-000549e0: 2020 290a 0a20 2020 2064 6566 2077 6569    )..    def wei
-000549f0: 6768 7465 6428 7365 6c66 2c20 7765 6967  ghted(self, weig
-00054a00: 6874 733a 2044 6174 6141 7272 6179 2920  hts: DataArray) 
-00054a10: 2d3e 2044 6174 6173 6574 5765 6967 6874  -> DatasetWeight
-00054a20: 6564 3a0a 2020 2020 2020 2020 2222 220a  ed:.        """.
-00054a30: 2020 2020 2020 2020 5765 6967 6874 6564          Weighted
-00054a40: 2044 6174 6173 6574 206f 7065 7261 7469   Dataset operati
-00054a50: 6f6e 732e 0a0a 2020 2020 2020 2020 5061  ons...        Pa
-00054a60: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00054a70: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00054a80: 2020 2020 7765 6967 6874 7320 3a20 4461      weights : Da
-00054a90: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
-00054aa0: 2020 2020 416e 2061 7272 6179 206f 6620      An array of 
-00054ab0: 7765 6967 6874 7320 6173 736f 6369 6174  weights associat
-00054ac0: 6564 2077 6974 6820 7468 6520 7661 6c75  ed with the valu
-00054ad0: 6573 2069 6e20 7468 6973 2044 6174 6173  es in this Datas
-00054ae0: 6574 2e0a 2020 2020 2020 2020 2020 2020  et..            
-00054af0: 4561 6368 2076 616c 7565 2069 6e20 7468  Each value in th
-00054b00: 6520 6461 7461 2063 6f6e 7472 6962 7574  e data contribut
-00054b10: 6573 2074 6f20 7468 6520 7265 6475 6374  es to the reduct
-00054b20: 696f 6e20 6f70 6572 6174 696f 6e0a 2020  ion operation.  
-00054b30: 2020 2020 2020 2020 2020 6163 636f 7264            accord
-00054b40: 696e 6720 746f 2069 7473 2061 7373 6f63  ing to its assoc
-00054b50: 6961 7465 6420 7765 6967 6874 2e0a 0a20  iated weight... 
-00054b60: 2020 2020 2020 204e 6f74 6573 0a20 2020         Notes.   
-00054b70: 2020 2020 202d 2d2d 2d2d 0a20 2020 2020       -----.     
-00054b80: 2020 2060 6077 6569 6768 7473 6060 206d     ``weights`` m
-00054b90: 7573 7420 6265 2061 2044 6174 6141 7272  ust be a DataArr
-00054ba0: 6179 2061 6e64 2063 616e 6e6f 7420 636f  ay and cannot co
-00054bb0: 6e74 6169 6e20 6d69 7373 696e 6720 7661  ntain missing va
-00054bc0: 6c75 6573 2e0a 2020 2020 2020 2020 4d69  lues..        Mi
-00054bd0: 7373 696e 6720 7661 6c75 6573 2063 616e  ssing values can
-00054be0: 2062 6520 7265 706c 6163 6564 2062 7920   be replaced by 
-00054bf0: 6060 7765 6967 6874 732e 6669 6c6c 6e61  ``weights.fillna
-00054c00: 2830 2960 602e 0a0a 2020 2020 2020 2020  (0)``...        
-00054c10: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-00054c20: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00054c30: 636f 7265 2e77 6569 6768 7465 642e 4461  core.weighted.Da
-00054c40: 7461 7365 7457 6569 6768 7465 640a 0a20  tasetWeighted.. 
-00054c50: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00054c60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00054c70: 0a20 2020 2020 2020 2044 6174 6141 7272  .        DataArr
-00054c80: 6179 2e77 6569 6768 7465 640a 2020 2020  ay.weighted.    
-00054c90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00054ca0: 6672 6f6d 2078 6172 7261 792e 636f 7265  from xarray.core
-00054cb0: 2e77 6569 6768 7465 6420 696d 706f 7274  .weighted import
-00054cc0: 2044 6174 6173 6574 5765 6967 6874 6564   DatasetWeighted
-00054cd0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00054ce0: 2044 6174 6173 6574 5765 6967 6874 6564   DatasetWeighted
-00054cf0: 2873 656c 662c 2077 6569 6768 7473 290a  (self, weights).
-00054d00: 0a20 2020 2064 6566 2072 6f6c 6c69 6e67  .    def rolling
-00054d10: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00054d20: 2020 2020 2020 2020 6469 6d3a 204d 6170          dim: Map
-00054d30: 7069 6e67 5b41 6e79 2c20 696e 745d 207c  ping[Any, int] |
-00054d40: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-00054d50: 2020 2020 2020 6d69 6e5f 7065 7269 6f64        min_period
-00054d60: 733a 2069 6e74 207c 204e 6f6e 6520 3d20  s: int | None = 
-00054d70: 4e6f 6e65 2c0a 2020 2020 2020 2020 6365  None,.        ce
-00054d80: 6e74 6572 3a20 626f 6f6c 207c 204d 6170  nter: bool | Map
-00054d90: 7069 6e67 5b41 6e79 2c20 626f 6f6c 5d20  ping[Any, bool] 
-00054da0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-00054db0: 202a 2a77 696e 646f 775f 6b77 6172 6773   **window_kwargs
-00054dc0: 3a20 696e 742c 0a20 2020 2029 202d 3e20  : int,.    ) -> 
-00054dd0: 4461 7461 7365 7452 6f6c 6c69 6e67 3a0a  DatasetRolling:.
-00054de0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00054df0: 2020 2020 526f 6c6c 696e 6720 7769 6e64      Rolling wind
-00054e00: 6f77 206f 626a 6563 7420 666f 7220 4461  ow object for Da
-00054e10: 7461 7365 7473 2e0a 0a20 2020 2020 2020  tasets...       
-00054e20: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00054e30: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00054e40: 2020 2020 2020 2064 696d 203a 2064 6963         dim : dic
-00054e50: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
-00054e60: 2020 2020 2020 2020 4d61 7070 696e 6720          Mapping 
-00054e70: 6672 6f6d 2074 6865 2064 696d 656e 7369  from the dimensi
-00054e80: 6f6e 206e 616d 6520 746f 2063 7265 6174  on name to creat
-00054e90: 6520 7468 6520 726f 6c6c 696e 6720 6974  e the rolling it
-00054ea0: 6572 6174 6f72 0a20 2020 2020 2020 2020  erator.         
-00054eb0: 2020 2061 6c6f 6e67 2028 652e 672e 2060     along (e.g. `
-00054ec0: 7469 6d65 6029 2074 6f20 6974 7320 6d6f  time`) to its mo
-00054ed0: 7669 6e67 2077 696e 646f 7720 7369 7a65  ving window size
-00054ee0: 2e0a 2020 2020 2020 2020 6d69 6e5f 7065  ..        min_pe
-00054ef0: 7269 6f64 7320 3a20 696e 7420 6f72 204e  riods : int or N
-00054f00: 6f6e 652c 2064 6566 6175 6c74 3a20 4e6f  one, default: No
-00054f10: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
-00054f20: 696e 696d 756d 206e 756d 6265 7220 6f66  inimum number of
-00054f30: 206f 6273 6572 7661 7469 6f6e 7320 696e   observations in
-00054f40: 2077 696e 646f 7720 7265 7175 6972 6564   window required
-00054f50: 2074 6f20 6861 7665 2061 2076 616c 7565   to have a value
-00054f60: 0a20 2020 2020 2020 2020 2020 2028 6f74  .            (ot
-00054f70: 6865 7277 6973 6520 7265 7375 6c74 2069  herwise result i
-00054f80: 7320 4e41 292e 2054 6865 2064 6566 6175  s NA). The defau
-00054f90: 6c74 2c20 4e6f 6e65 2c20 6973 2065 7175  lt, None, is equ
-00054fa0: 6976 616c 656e 7420 746f 0a20 2020 2020  ivalent to.     
-00054fb0: 2020 2020 2020 2073 6574 7469 6e67 206d         setting m
-00054fc0: 696e 5f70 6572 696f 6473 2065 7175 616c  in_periods equal
-00054fd0: 2074 6f20 7468 6520 7369 7a65 206f 6620   to the size of 
-00054fe0: 7468 6520 7769 6e64 6f77 2e0a 2020 2020  the window..    
-00054ff0: 2020 2020 6365 6e74 6572 203a 2062 6f6f      center : boo
-00055000: 6c20 6f72 204d 6170 7069 6e67 2074 6f20  l or Mapping to 
-00055010: 696e 742c 2064 6566 6175 6c74 3a20 4661  int, default: Fa
-00055020: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00055030: 5365 7420 7468 6520 6c61 6265 6c73 2061  Set the labels a
-00055040: 7420 7468 6520 6365 6e74 6572 206f 6620  t the center of 
-00055050: 7468 6520 7769 6e64 6f77 2e0a 2020 2020  the window..    
-00055060: 2020 2020 2a2a 7769 6e64 6f77 5f6b 7761      **window_kwa
-00055070: 7267 7320 3a20 6f70 7469 6f6e 616c 0a20  rgs : optional. 
-00055080: 2020 2020 2020 2020 2020 2054 6865 206b             The k
-00055090: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-000550a0: 2066 6f72 6d20 6f66 2060 6064 696d 6060   form of ``dim``
-000550b0: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
-000550c0: 6520 6f66 2064 696d 206f 7220 7769 6e64  e of dim or wind
-000550d0: 6f77 5f6b 7761 7267 7320 6d75 7374 2062  ow_kwargs must b
-000550e0: 6520 7072 6f76 6964 6564 2e0a 0a20 2020  e provided...   
-000550f0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00055100: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00055110: 2020 2020 2063 6f72 652e 726f 6c6c 696e       core.rollin
-00055120: 672e 4461 7461 7365 7452 6f6c 6c69 6e67  g.DatasetRolling
-00055130: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-00055140: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-00055150: 2d2d 2d0a 2020 2020 2020 2020 636f 7265  ---.        core
-00055160: 2e72 6f6c 6c69 6e67 2e44 6174 6173 6574  .rolling.Dataset
-00055170: 526f 6c6c 696e 670a 2020 2020 2020 2020  Rolling.        
-00055180: 4461 7461 4172 7261 792e 726f 6c6c 696e  DataArray.rollin
-00055190: 670a 2020 2020 2020 2020 2222 220a 2020  g.        """.  
-000551a0: 2020 2020 2020 6672 6f6d 2078 6172 7261        from xarra
-000551b0: 792e 636f 7265 2e72 6f6c 6c69 6e67 2069  y.core.rolling i
-000551c0: 6d70 6f72 7420 4461 7461 7365 7452 6f6c  mport DatasetRol
-000551d0: 6c69 6e67 0a0a 2020 2020 2020 2020 6469  ling..        di
-000551e0: 6d20 3d20 6569 7468 6572 5f64 6963 745f  m = either_dict_
-000551f0: 6f72 5f6b 7761 7267 7328 6469 6d2c 2077  or_kwargs(dim, w
-00055200: 696e 646f 775f 6b77 6172 6773 2c20 2272  indow_kwargs, "r
-00055210: 6f6c 6c69 6e67 2229 0a20 2020 2020 2020  olling").       
-00055220: 2072 6574 7572 6e20 4461 7461 7365 7452   return DatasetR
-00055230: 6f6c 6c69 6e67 2873 656c 662c 2064 696d  olling(self, dim
-00055240: 2c20 6d69 6e5f 7065 7269 6f64 733d 6d69  , min_periods=mi
-00055250: 6e5f 7065 7269 6f64 732c 2063 656e 7465  n_periods, cente
-00055260: 723d 6365 6e74 6572 290a 0a20 2020 2064  r=center)..    d
-00055270: 6566 2063 6f61 7273 656e 280a 2020 2020  ef coarsen(.    
-00055280: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00055290: 2020 6469 6d3a 204d 6170 7069 6e67 5b41    dim: Mapping[A
-000552a0: 6e79 2c20 696e 745d 207c 204e 6f6e 6520  ny, int] | None 
-000552b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000552c0: 626f 756e 6461 7279 3a20 436f 6172 7365  boundary: Coarse
-000552d0: 6e42 6f75 6e64 6172 794f 7074 696f 6e73  nBoundaryOptions
-000552e0: 203d 2022 6578 6163 7422 2c0a 2020 2020   = "exact",.    
-000552f0: 2020 2020 7369 6465 3a20 5369 6465 4f70      side: SideOp
-00055300: 7469 6f6e 7320 7c20 4d61 7070 696e 675b  tions | Mapping[
-00055310: 416e 792c 2053 6964 654f 7074 696f 6e73  Any, SideOptions
-00055320: 5d20 3d20 226c 6566 7422 2c0a 2020 2020  ] = "left",.    
-00055330: 2020 2020 636f 6f72 645f 6675 6e63 3a20      coord_func: 
-00055340: 7374 7220 7c20 4361 6c6c 6162 6c65 207c  str | Callable |
-00055350: 204d 6170 7069 6e67 5b41 6e79 2c20 7374   Mapping[Any, st
-00055360: 7220 7c20 4361 6c6c 6162 6c65 5d20 3d20  r | Callable] = 
-00055370: 226d 6561 6e22 2c0a 2020 2020 2020 2020  "mean",.        
-00055380: 2a2a 7769 6e64 6f77 5f6b 7761 7267 733a  **window_kwargs:
-00055390: 2069 6e74 2c0a 2020 2020 2920 2d3e 2044   int,.    ) -> D
-000553a0: 6174 6173 6574 436f 6172 7365 6e3a 0a20  atasetCoarsen:. 
-000553b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000553c0: 2020 2043 6f61 7273 656e 206f 626a 6563     Coarsen objec
-000553d0: 7420 666f 7220 4461 7461 7365 7473 2e0a  t for Datasets..
-000553e0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-000553f0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00055400: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00055410: 696d 203a 206d 6170 7069 6e67 206f 6620  im : mapping of 
-00055420: 6861 7368 6162 6c65 2074 6f20 696e 742c  hashable to int,
-00055430: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00055440: 2020 2020 2020 4d61 7070 696e 6720 6672        Mapping fr
-00055450: 6f6d 2074 6865 2064 696d 656e 7369 6f6e  om the dimension
-00055460: 206e 616d 6520 746f 2074 6865 2077 696e   name to the win
-00055470: 646f 7720 7369 7a65 2e0a 2020 2020 2020  dow size..      
-00055480: 2020 626f 756e 6461 7279 203a 207b 2265    boundary : {"e
-00055490: 7861 6374 222c 2022 7472 696d 222c 2022  xact", "trim", "
-000554a0: 7061 6422 7d2c 2064 6566 6175 6c74 3a20  pad"}, default: 
-000554b0: 2265 7861 6374 220a 2020 2020 2020 2020  "exact".        
-000554c0: 2020 2020 4966 2027 6578 6163 7427 2c20      If 'exact', 
-000554d0: 6120 5661 6c75 6545 7272 6f72 2077 696c  a ValueError wil
-000554e0: 6c20 6265 2072 6169 7365 6420 6966 2064  l be raised if d
-000554f0: 696d 656e 7369 6f6e 2073 697a 6520 6973  imension size is
-00055500: 206e 6f74 2061 0a20 2020 2020 2020 2020   not a.         
-00055510: 2020 206d 756c 7469 706c 6520 6f66 2074     multiple of t
-00055520: 6865 2077 696e 646f 7720 7369 7a65 2e20  he window size. 
-00055530: 4966 2027 7472 696d 272c 2074 6865 2065  If 'trim', the e
-00055540: 7863 6573 7320 656e 7472 6965 7320 6172  xcess entries ar
-00055550: 650a 2020 2020 2020 2020 2020 2020 6472  e.            dr
-00055560: 6f70 7065 642e 2049 6620 2770 6164 272c  opped. If 'pad',
-00055570: 204e 4120 7769 6c6c 2062 6520 7061 6464   NA will be padd
-00055580: 6564 2e0a 2020 2020 2020 2020 7369 6465  ed..        side
-00055590: 203a 207b 226c 6566 7422 2c20 2272 6967   : {"left", "rig
-000555a0: 6874 227d 206f 7220 6d61 7070 696e 6720  ht"} or mapping 
-000555b0: 6f66 2073 7472 2074 6f20 7b22 6c65 6674  of str to {"left
-000555c0: 222c 2022 7269 6768 7422 7d2c 2064 6566  ", "right"}, def
-000555d0: 6175 6c74 3a20 226c 6566 7422 0a20 2020  ault: "left".   
-000555e0: 2020 2020 2063 6f6f 7264 5f66 756e 6320       coord_func 
-000555f0: 3a20 7374 7220 6f72 206d 6170 7069 6e67  : str or mapping
-00055600: 206f 6620 6861 7368 6162 6c65 2074 6f20   of hashable to 
-00055610: 7374 722c 2064 6566 6175 6c74 3a20 226d  str, default: "m
-00055620: 6561 6e22 0a20 2020 2020 2020 2020 2020  ean".           
-00055630: 2066 756e 6374 696f 6e20 286e 616d 6529   function (name)
-00055640: 2074 6861 7420 6973 2061 7070 6c69 6564   that is applied
-00055650: 2074 6f20 7468 6520 636f 6f72 6469 6e61   to the coordina
-00055660: 7465 732c 0a20 2020 2020 2020 2020 2020  tes,.           
-00055670: 206f 7220 6120 6d61 7070 696e 6720 6672   or a mapping fr
-00055680: 6f6d 2063 6f6f 7264 696e 6174 6520 6e61  om coordinate na
-00055690: 6d65 2074 6f20 6675 6e63 7469 6f6e 2028  me to function (
-000556a0: 6e61 6d65 292e 0a0a 2020 2020 2020 2020  name)...        
-000556b0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-000556c0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000556d0: 636f 7265 2e72 6f6c 6c69 6e67 2e44 6174  core.rolling.Dat
-000556e0: 6173 6574 436f 6172 7365 6e0a 0a20 2020  asetCoarsen..   
-000556f0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
-00055700: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-00055710: 2020 2020 2020 2063 6f72 652e 726f 6c6c         core.roll
-00055720: 696e 672e 4461 7461 7365 7443 6f61 7273  ing.DatasetCoars
-00055730: 656e 0a20 2020 2020 2020 2044 6174 6141  en.        DataA
-00055740: 7272 6179 2e63 6f61 7273 656e 0a20 2020  rray.coarsen.   
-00055750: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00055760: 2066 726f 6d20 7861 7272 6179 2e63 6f72   from xarray.cor
-00055770: 652e 726f 6c6c 696e 6720 696d 706f 7274  e.rolling import
-00055780: 2044 6174 6173 6574 436f 6172 7365 6e0a   DatasetCoarsen.
-00055790: 0a20 2020 2020 2020 2064 696d 203d 2065  .        dim = e
-000557a0: 6974 6865 725f 6469 6374 5f6f 725f 6b77  ither_dict_or_kw
-000557b0: 6172 6773 2864 696d 2c20 7769 6e64 6f77  args(dim, window
-000557c0: 5f6b 7761 7267 732c 2022 636f 6172 7365  _kwargs, "coarse
-000557d0: 6e22 290a 2020 2020 2020 2020 7265 7475  n").        retu
-000557e0: 726e 2044 6174 6173 6574 436f 6172 7365  rn DatasetCoarse
-000557f0: 6e28 0a20 2020 2020 2020 2020 2020 2073  n(.            s
-00055800: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00055810: 2064 696d 2c0a 2020 2020 2020 2020 2020   dim,.          
-00055820: 2020 626f 756e 6461 7279 3d62 6f75 6e64    boundary=bound
-00055830: 6172 792c 0a20 2020 2020 2020 2020 2020  ary,.           
-00055840: 2073 6964 653d 7369 6465 2c0a 2020 2020   side=side,.    
-00055850: 2020 2020 2020 2020 636f 6f72 645f 6675          coord_fu
-00055860: 6e63 3d63 6f6f 7264 5f66 756e 632c 0a20  nc=coord_func,. 
-00055870: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00055880: 6620 7265 7361 6d70 6c65 280a 2020 2020  f resample(.    
-00055890: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-000558a0: 2020 696e 6465 7865 723a 204d 6170 7069    indexer: Mappi
-000558b0: 6e67 5b41 6e79 2c20 7374 725d 207c 204e  ng[Any, str] | N
-000558c0: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-000558d0: 2020 2020 736b 6970 6e61 3a20 626f 6f6c      skipna: bool
-000558e0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000558f0: 2020 2020 2020 2020 636c 6f73 6564 3a20          closed: 
-00055900: 5369 6465 4f70 7469 6f6e 7320 7c20 4e6f  SideOptions | No
-00055910: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
-00055920: 2020 206c 6162 656c 3a20 5369 6465 4f70     label: SideOp
-00055930: 7469 6f6e 7320 7c20 4e6f 6e65 203d 204e  tions | None = N
-00055940: 6f6e 652c 0a20 2020 2020 2020 2062 6173  one,.        bas
-00055950: 653a 2069 6e74 207c 204e 6f6e 6520 3d20  e: int | None = 
-00055960: 4e6f 6e65 2c0a 2020 2020 2020 2020 6f66  None,.        of
-00055970: 6673 6574 3a20 7064 2e54 696d 6564 656c  fset: pd.Timedel
-00055980: 7461 207c 2064 6174 6574 696d 652e 7469  ta | datetime.ti
-00055990: 6d65 6465 6c74 6120 7c20 7374 7220 7c20  medelta | str | 
-000559a0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
-000559b0: 2020 2020 206f 7269 6769 6e3a 2073 7472       origin: str
-000559c0: 207c 2044 6174 6574 696d 654c 696b 6520   | DatetimeLike 
-000559d0: 3d20 2273 7461 7274 5f64 6179 222c 0a20  = "start_day",. 
-000559e0: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
-000559f0: 733a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  s: bool | None =
-00055a00: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
-00055a10: 6f66 6673 6574 3a20 6461 7465 7469 6d65  offset: datetime
-00055a20: 2e74 696d 6564 656c 7461 207c 2073 7472  .timedelta | str
-00055a30: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00055a40: 2020 2020 2020 2020 7265 7374 6f72 655f          restore_
-00055a50: 636f 6f72 645f 6469 6d73 3a20 626f 6f6c  coord_dims: bool
-00055a60: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-00055a70: 2020 2020 2020 2020 2a2a 696e 6465 7865          **indexe
-00055a80: 725f 6b77 6172 6773 3a20 7374 722c 0a20  r_kwargs: str,. 
-00055a90: 2020 2029 202d 3e20 4461 7461 7365 7452     ) -> DatasetR
-00055aa0: 6573 616d 706c 653a 0a20 2020 2020 2020  esample:.       
-00055ab0: 2022 2222 5265 7475 726e 7320 6120 5265   """Returns a Re
-00055ac0: 7361 6d70 6c65 206f 626a 6563 7420 666f  sample object fo
-00055ad0: 7220 7065 7266 6f72 6d69 6e67 2072 6573  r performing res
-00055ae0: 616d 706c 696e 6720 6f70 6572 6174 696f  ampling operatio
-00055af0: 6e73 2e0a 0a20 2020 2020 2020 2048 616e  ns...        Han
-00055b00: 646c 6573 2062 6f74 6820 646f 776e 7361  dles both downsa
-00055b10: 6d70 6c69 6e67 2061 6e64 2075 7073 616d  mpling and upsam
-00055b20: 706c 696e 672e 2054 6865 2072 6573 616d  pling. The resam
-00055b30: 706c 6564 0a20 2020 2020 2020 2064 696d  pled.        dim
-00055b40: 656e 7369 6f6e 206d 7573 7420 6265 2061  ension must be a
-00055b50: 2064 6174 6574 696d 652d 6c69 6b65 2063   datetime-like c
-00055b60: 6f6f 7264 696e 6174 652e 2049 6620 616e  oordinate. If an
-00055b70: 7920 696e 7465 7276 616c 730a 2020 2020  y intervals.    
-00055b80: 2020 2020 636f 6e74 6169 6e20 6e6f 2076      contain no v
-00055b90: 616c 7565 7320 6672 6f6d 2074 6865 206f  alues from the o
-00055ba0: 7269 6769 6e61 6c20 6f62 6a65 6374 2c20  riginal object, 
-00055bb0: 7468 6579 2077 696c 6c20 6265 2067 6976  they will be giv
-00055bc0: 656e 0a20 2020 2020 2020 2074 6865 2076  en.        the v
-00055bd0: 616c 7565 2060 604e 614e 6060 2e0a 0a20  alue ``NaN``... 
-00055be0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00055bf0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00055c00: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e64  ----.        ind
-00055c10: 6578 6572 203a 204d 6170 7069 6e67 206f  exer : Mapping o
-00055c20: 6620 4861 7368 6162 6c65 2074 6f20 7374  f Hashable to st
-00055c30: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
-00055c40: 2020 2020 2020 2020 4d61 7070 696e 6720          Mapping 
-00055c50: 6672 6f6d 2074 6865 2064 696d 656e 7369  from the dimensi
-00055c60: 6f6e 206e 616d 6520 746f 2072 6573 616d  on name to resam
-00055c70: 706c 6520 6672 6571 7565 6e63 7920 5b31  ple frequency [1
-00055c80: 5d5f 2e20 5468 650a 2020 2020 2020 2020  ]_. The.        
-00055c90: 2020 2020 6469 6d65 6e73 696f 6e20 6d75      dimension mu
-00055ca0: 7374 2062 6520 6461 7465 7469 6d65 2d6c  st be datetime-l
-00055cb0: 696b 652e 0a20 2020 2020 2020 2073 6b69  ike..        ski
-00055cc0: 706e 6120 3a20 626f 6f6c 2c20 6f70 7469  pna : bool, opti
-00055cd0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00055ce0: 2057 6865 7468 6572 2074 6f20 736b 6970   Whether to skip
-00055cf0: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
-00055d00: 7768 656e 2061 6767 7265 6761 7469 6e67  when aggregating
-00055d10: 2069 6e20 646f 776e 7361 6d70 6c69 6e67   in downsampling
-00055d20: 2e0a 2020 2020 2020 2020 636c 6f73 6564  ..        closed
-00055d30: 203a 207b 226c 6566 7422 2c20 2272 6967   : {"left", "rig
-00055d40: 6874 227d 2c20 6f70 7469 6f6e 616c 0a20  ht"}, optional. 
-00055d50: 2020 2020 2020 2020 2020 2053 6964 6520             Side 
-00055d60: 6f66 2065 6163 6820 696e 7465 7276 616c  of each interval
-00055d70: 2074 6f20 7472 6561 7420 6173 2063 6c6f   to treat as clo
-00055d80: 7365 642e 0a20 2020 2020 2020 206c 6162  sed..        lab
-00055d90: 656c 203a 207b 226c 6566 7422 2c20 2272  el : {"left", "r
-00055da0: 6967 6874 227d 2c20 6f70 7469 6f6e 616c  ight"}, optional
-00055db0: 0a20 2020 2020 2020 2020 2020 2053 6964  .            Sid
-00055dc0: 6520 6f66 2065 6163 6820 696e 7465 7276  e of each interv
-00055dd0: 616c 2074 6f20 7573 6520 666f 7220 6c61  al to use for la
-00055de0: 6265 6c69 6e67 2e0a 2020 2020 2020 2020  beling..        
-00055df0: 6261 7365 203a 2069 6e74 2c20 6f70 7469  base : int, opti
-00055e00: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-00055e10: 2046 6f72 2066 7265 7175 656e 6369 6573   For frequencies
-00055e20: 2074 6861 7420 6576 656e 6c79 2073 7562   that evenly sub
-00055e30: 6469 7669 6465 2031 2064 6179 2c20 7468  divide 1 day, th
-00055e40: 6520 226f 7269 6769 6e22 206f 6620 7468  e "origin" of th
-00055e50: 650a 2020 2020 2020 2020 2020 2020 6167  e.            ag
-00055e60: 6772 6567 6174 6564 2069 6e74 6572 7661  gregated interva
-00055e70: 6c73 2e20 466f 7220 6578 616d 706c 652c  ls. For example,
-00055e80: 2066 6f72 2022 3234 4822 2066 7265 7175   for "24H" frequ
-00055e90: 656e 6379 2c20 6261 7365 2063 6f75 6c64  ency, base could
-00055ea0: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
-00055eb0: 6765 2066 726f 6d20 3020 7468 726f 7567  ge from 0 throug
-00055ec0: 6820 3233 2e0a 2020 2020 2020 2020 6f72  h 23..        or
-00055ed0: 6967 696e 203a 207b 2765 706f 6368 272c  igin : {'epoch',
-00055ee0: 2027 7374 6172 7427 2c20 2773 7461 7274   'start', 'start
-00055ef0: 5f64 6179 272c 2027 656e 6427 2c20 2765  _day', 'end', 'e
-00055f00: 6e64 5f64 6179 277d 2c20 7064 2e54 696d  nd_day'}, pd.Tim
-00055f10: 6573 7461 6d70 2c20 6461 7465 7469 6d65  estamp, datetime
-00055f20: 2e64 6174 6574 696d 652c 206e 702e 6461  .datetime, np.da
-00055f30: 7465 7469 6d65 3634 2c20 6f72 2063 6674  tetime64, or cft
-00055f40: 696d 652e 6461 7465 7469 6d65 2c20 6465  ime.datetime, de
-00055f50: 6661 756c 7420 2773 7461 7274 5f64 6179  fault 'start_day
-00055f60: 270a 2020 2020 2020 2020 2020 2020 5468  '.            Th
-00055f70: 6520 6461 7465 7469 6d65 206f 6e20 7768  e datetime on wh
-00055f80: 6963 6820 746f 2061 646a 7573 7420 7468  ich to adjust th
-00055f90: 6520 6772 6f75 7069 6e67 2e20 5468 6520  e grouping. The 
-00055fa0: 7469 6d65 7a6f 6e65 206f 6620 6f72 6967  timezone of orig
-00055fb0: 696e 0a20 2020 2020 2020 2020 2020 206d  in.            m
-00055fc0: 7573 7420 6d61 7463 6820 7468 6520 7469  ust match the ti
-00055fd0: 6d65 7a6f 6e65 206f 6620 7468 6520 696e  mezone of the in
-00055fe0: 6465 782e 0a0a 2020 2020 2020 2020 2020  dex...          
-00055ff0: 2020 4966 2061 2064 6174 6574 696d 6520    If a datetime 
-00056000: 6973 206e 6f74 2075 7365 642c 2074 6865  is not used, the
-00056010: 7365 2076 616c 7565 7320 6172 6520 616c  se values are al
-00056020: 736f 2073 7570 706f 7274 6564 3a0a 2020  so supported:.  
-00056030: 2020 2020 2020 2020 2020 2d20 2765 706f            - 'epo
-00056040: 6368 273a 2060 6f72 6967 696e 6020 6973  ch': `origin` is
-00056050: 2031 3937 302d 3031 2d30 310a 2020 2020   1970-01-01.    
-00056060: 2020 2020 2020 2020 2d20 2773 7461 7274          - 'start
-00056070: 273a 2060 6f72 6967 696e 6020 6973 2074  ': `origin` is t
-00056080: 6865 2066 6972 7374 2076 616c 7565 206f  he first value o
-00056090: 6620 7468 6520 7469 6d65 7365 7269 6573  f the timeseries
-000560a0: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
-000560b0: 7374 6172 745f 6461 7927 3a20 606f 7269  start_day': `ori
-000560c0: 6769 6e60 2069 7320 7468 6520 6669 7273  gin` is the firs
-000560d0: 7420 6461 7920 6174 206d 6964 6e69 6768  t day at midnigh
-000560e0: 7420 6f66 2074 6865 2074 696d 6573 6572  t of the timeser
-000560f0: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
-00056100: 2d20 2765 6e64 273a 2060 6f72 6967 696e  - 'end': `origin
-00056110: 6020 6973 2074 6865 206c 6173 7420 7661  ` is the last va
-00056120: 6c75 6520 6f66 2074 6865 2074 696d 6573  lue of the times
-00056130: 6572 6965 730a 2020 2020 2020 2020 2020  eries.          
-00056140: 2020 2d20 2765 6e64 5f64 6179 273a 2060    - 'end_day': `
-00056150: 6f72 6967 696e 6020 6973 2074 6865 2063  origin` is the c
-00056160: 6569 6c69 6e67 206d 6964 6e69 6768 7420  eiling midnight 
-00056170: 6f66 2074 6865 206c 6173 7420 6461 790a  of the last day.
-00056180: 2020 2020 2020 2020 6f66 6673 6574 203a          offset :
-00056190: 2070 642e 5469 6d65 6465 6c74 612c 2064   pd.Timedelta, d
-000561a0: 6174 6574 696d 652e 7469 6d65 6465 6c74  atetime.timedelt
-000561b0: 612c 206f 7220 7374 722c 2064 6566 6175  a, or str, defau
-000561c0: 6c74 2069 7320 4e6f 6e65 0a20 2020 2020  lt is None.     
-000561d0: 2020 2020 2020 2041 6e20 6f66 6673 6574         An offset
-000561e0: 2074 696d 6564 656c 7461 2061 6464 6564   timedelta added
-000561f0: 2074 6f20 7468 6520 6f72 6967 696e 2e0a   to the origin..
-00056200: 2020 2020 2020 2020 6c6f 6666 7365 7420          loffset 
-00056210: 3a20 7469 6d65 6465 6c74 6120 6f72 2073  : timedelta or s
-00056220: 7472 2c20 6f70 7469 6f6e 616c 0a20 2020  tr, optional.   
-00056230: 2020 2020 2020 2020 204f 6666 7365 7420           Offset 
-00056240: 7573 6564 2074 6f20 6164 6a75 7374 2074  used to adjust t
-00056250: 6865 2072 6573 616d 706c 6564 2074 696d  he resampled tim
-00056260: 6520 6c61 6265 6c73 2e20 536f 6d65 2070  e labels. Some p
-00056270: 616e 6461 7320 6461 7465 0a20 2020 2020  andas date.     
-00056280: 2020 2020 2020 206f 6666 7365 7420 7374         offset st
-00056290: 7269 6e67 7320 6172 6520 7375 7070 6f72  rings are suppor
-000562a0: 7465 642e 0a20 2020 2020 2020 2072 6573  ted..        res
-000562b0: 746f 7265 5f63 6f6f 7264 5f64 696d 7320  tore_coord_dims 
-000562c0: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
-000562d0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-000562e0: 5472 7565 2c20 616c 736f 2072 6573 746f  True, also resto
-000562f0: 7265 2074 6865 2064 696d 656e 7369 6f6e  re the dimension
-00056300: 206f 7264 6572 206f 6620 6d75 6c74 692d   order of multi-
-00056310: 6469 6d65 6e73 696f 6e61 6c0a 2020 2020  dimensional.    
-00056320: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
-00056330: 7465 732e 0a20 2020 2020 2020 202a 2a69  tes..        **i
-00056340: 6e64 6578 6572 5f6b 7761 7267 7320 3a20  ndexer_kwargs : 
-00056350: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-00056360: 5468 6520 6b65 7977 6f72 6420 6172 6775  The keyword argu
-00056370: 6d65 6e74 7320 666f 726d 206f 6620 6060  ments form of ``
-00056380: 696e 6465 7865 7260 602e 0a20 2020 2020  indexer``..     
-00056390: 2020 2020 2020 204f 6e65 206f 6620 696e         One of in
-000563a0: 6465 7865 7220 6f72 2069 6e64 6578 6572  dexer or indexer
-000563b0: 5f6b 7761 7267 7320 6d75 7374 2062 6520  _kwargs must be 
-000563c0: 7072 6f76 6964 6564 2e0a 0a20 2020 2020  provided...     
-000563d0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-000563e0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-000563f0: 2020 2072 6573 616d 706c 6564 203a 2063     resampled : c
-00056400: 6f72 652e 7265 7361 6d70 6c65 2e44 6174  ore.resample.Dat
-00056410: 6141 7272 6179 5265 7361 6d70 6c65 0a20  aArrayResample. 
-00056420: 2020 2020 2020 2020 2020 2054 6869 7320             This 
-00056430: 6f62 6a65 6374 2072 6573 616d 706c 6564  object resampled
-00056440: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-00056450: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-00056460: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
-00056470: 6141 7272 6179 2e72 6573 616d 706c 650a  aArray.resample.
-00056480: 2020 2020 2020 2020 7061 6e64 6173 2e53          pandas.S
-00056490: 6572 6965 732e 7265 7361 6d70 6c65 0a20  eries.resample. 
-000564a0: 2020 2020 2020 2070 616e 6461 732e 4461         pandas.Da
-000564b0: 7461 4672 616d 652e 7265 7361 6d70 6c65  taFrame.resample
-000564c0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-000564d0: 2e67 726f 7570 6279 0a20 2020 2020 2020  .groupby.       
-000564e0: 2044 6174 6141 7272 6179 2e67 726f 7570   DataArray.group
-000564f0: 6279 0a0a 2020 2020 2020 2020 5265 6665  by..        Refe
-00056500: 7265 6e63 6573 0a20 2020 2020 2020 202d  rences.        -
-00056510: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00056520: 2020 2e2e 205b 315d 2068 7474 703a 2f2f    .. [1] http://
-00056530: 7061 6e64 6173 2e70 7964 6174 612e 6f72  pandas.pydata.or
-00056540: 672f 7061 6e64 6173 2d64 6f63 732f 7374  g/pandas-docs/st
-00056550: 6162 6c65 2f74 696d 6573 6572 6965 732e  able/timeseries.
-00056560: 6874 6d6c 236f 6666 7365 742d 616c 6961  html#offset-alia
-00056570: 7365 730a 2020 2020 2020 2020 2222 220a  ses.        """.
-00056580: 2020 2020 2020 2020 6672 6f6d 2078 6172          from xar
-00056590: 7261 792e 636f 7265 2e72 6573 616d 706c  ray.core.resampl
-000565a0: 6520 696d 706f 7274 2044 6174 6173 6574  e import Dataset
-000565b0: 5265 7361 6d70 6c65 0a0a 2020 2020 2020  Resample..      
-000565c0: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
-000565d0: 6573 616d 706c 6528 0a20 2020 2020 2020  esample(.       
-000565e0: 2020 2020 2072 6573 616d 706c 655f 636c       resample_cl
-000565f0: 733d 4461 7461 7365 7452 6573 616d 706c  s=DatasetResampl
-00056600: 652c 0a20 2020 2020 2020 2020 2020 2069  e,.            i
-00056610: 6e64 6578 6572 3d69 6e64 6578 6572 2c0a  ndexer=indexer,.
-00056620: 2020 2020 2020 2020 2020 2020 736b 6970              skip
-00056630: 6e61 3d73 6b69 706e 612c 0a20 2020 2020  na=skipna,.     
-00056640: 2020 2020 2020 2063 6c6f 7365 643d 636c         closed=cl
-00056650: 6f73 6564 2c0a 2020 2020 2020 2020 2020  osed,.          
-00056660: 2020 6c61 6265 6c3d 6c61 6265 6c2c 0a20    label=label,. 
-00056670: 2020 2020 2020 2020 2020 2062 6173 653d             base=
-00056680: 6261 7365 2c0a 2020 2020 2020 2020 2020  base,.          
-00056690: 2020 6f66 6673 6574 3d6f 6666 7365 742c    offset=offset,
-000566a0: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-000566b0: 6769 6e3d 6f72 6967 696e 2c0a 2020 2020  gin=origin,.    
-000566c0: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
-000566d0: 7273 3d6b 6565 705f 6174 7472 732c 0a20  rs=keep_attrs,. 
-000566e0: 2020 2020 2020 2020 2020 206c 6f66 6673             loffs
-000566f0: 6574 3d6c 6f66 6673 6574 2c0a 2020 2020  et=loffset,.    
-00056700: 2020 2020 2020 2020 7265 7374 6f72 655f          restore_
-00056710: 636f 6f72 645f 6469 6d73 3d72 6573 746f  coord_dims=resto
-00056720: 7265 5f63 6f6f 7264 5f64 696d 732c 0a20  re_coord_dims,. 
-00056730: 2020 2020 2020 2020 2020 202a 2a69 6e64             **ind
-00056740: 6578 6572 5f6b 7761 7267 732c 0a20 2020  exer_kwargs,.   
-00056750: 2020 2020 2029 0a                             ).
+00042000: 626c 6520 696e 2064 6174 615f 7661 7273  ble in data_vars
+00042010: 2e20 4966 206d 756c 7469 706c 6520 7065  . If multiple pe
+00042020: 7263 656e 7469 6c65 7320 6172 6520 6769  rcentiles are gi
+00042030: 7665 6e2c 2066 6972 7374 0a20 2020 2020  ven, first.     
+00042040: 2020 2020 2020 2061 7869 7320 6f66 2074         axis of t
+00042050: 6865 2072 6573 756c 7420 636f 7272 6573  he result corres
+00042060: 706f 6e64 7320 746f 2074 6865 2071 7561  ponds to the qua
+00042070: 6e74 696c 6520 616e 6420 6120 7175 616e  ntile and a quan
+00042080: 7469 6c65 0a20 2020 2020 2020 2020 2020  tile.           
+00042090: 2064 696d 656e 7369 6f6e 2069 7320 6164   dimension is ad
+000420a0: 6465 6420 746f 2074 6865 2072 6574 7572  ded to the retur
+000420b0: 6e20 4461 7461 7365 742e 2054 6865 206f  n Dataset. The o
+000420c0: 7468 6572 2064 696d 656e 7369 6f6e 7320  ther dimensions 
+000420d0: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+000420e0: 7468 6520 6469 6d65 6e73 696f 6e73 2074  the dimensions t
+000420f0: 6861 7420 7265 6d61 696e 2061 6674 6572  hat remain after
+00042100: 2074 6865 2072 6564 7563 7469 6f6e 206f   the reduction o
+00042110: 6620 7468 6520 6172 7261 792e 0a0a 2020  f the array...  
+00042120: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
+00042130: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+00042140: 2020 2020 2020 2020 6e75 6d70 792e 6e61          numpy.na
+00042150: 6e71 7561 6e74 696c 652c 206e 756d 7079  nquantile, numpy
+00042160: 2e71 7561 6e74 696c 652c 2070 616e 6461  .quantile, panda
+00042170: 732e 5365 7269 6573 2e71 7561 6e74 696c  s.Series.quantil
+00042180: 652c 2044 6174 6141 7272 6179 2e71 7561  e, DataArray.qua
+00042190: 6e74 696c 650a 0a20 2020 2020 2020 2045  ntile..        E
+000421a0: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
+000421b0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000421c0: 203e 3e3e 2064 7320 3d20 7872 2e44 6174   >>> ds = xr.Dat
+000421d0: 6173 6574 280a 2020 2020 2020 2020 2e2e  aset(.        ..
+000421e0: 2e20 2020 2020 7b22 6122 3a20 2828 2278  .     {"a": (("x
+000421f0: 222c 2022 7922 292c 205b 5b30 2e37 2c20  ", "y"), [[0.7, 
+00042200: 342e 322c 2039 2e34 2c20 312e 355d 2c20  4.2, 9.4, 1.5], 
+00042210: 5b36 2e35 2c20 372e 332c 2032 2e36 2c20  [6.5, 7.3, 2.6, 
+00042220: 312e 395d 5d29 7d2c 0a20 2020 2020 2020  1.9]])},.       
+00042230: 202e 2e2e 2020 2020 2063 6f6f 7264 733d   ...     coords=
+00042240: 7b22 7822 3a20 5b37 2c20 395d 2c20 2279  {"x": [7, 9], "y
+00042250: 223a 205b 312c 2031 2e35 2c20 322c 2032  ": [1, 1.5, 2, 2
+00042260: 2e35 5d7d 2c0a 2020 2020 2020 2020 2e2e  .5]},.        ..
+00042270: 2e20 290a 2020 2020 2020 2020 3e3e 3e20  . ).        >>> 
+00042280: 6473 2e71 7561 6e74 696c 6528 3029 2020  ds.quantile(0)  
+00042290: 2320 6f72 2064 732e 7175 616e 7469 6c65  # or ds.quantile
+000422a0: 2830 2c20 6469 6d3d 2e2e 2e29 0a20 2020  (0, dim=...).   
+000422b0: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+000422c0: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+000422d0: 6d65 6e73 696f 6e73 3a20 2020 2829 0a20  mensions:   (). 
+000422e0: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
+000422f0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00042300: 7175 616e 7469 6c65 2020 666c 6f61 7436  quantile  float6
+00042310: 3420 302e 300a 2020 2020 2020 2020 4461  4 0.0.        Da
+00042320: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+00042330: 2020 2020 2020 2020 2020 6120 2020 2020            a     
+00042340: 2020 2020 666c 6f61 7436 3420 302e 370a      float64 0.7.
+00042350: 2020 2020 2020 2020 3e3e 3e20 6473 2e71          >>> ds.q
+00042360: 7561 6e74 696c 6528 302c 2064 696d 3d22  uantile(0, dim="
+00042370: 7822 290a 2020 2020 2020 2020 3c78 6172  x").        <xar
+00042380: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+00042390: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+000423a0: 2020 2028 793a 2034 290a 2020 2020 2020     (y: 4).      
+000423b0: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+000423c0: 2020 2020 2020 2020 202a 2079 2020 2020           * y    
+000423d0: 2020 2020 2028 7929 2066 6c6f 6174 3634       (y) float64
+000423e0: 2031 2e30 2031 2e35 2032 2e30 2032 2e35   1.0 1.5 2.0 2.5
+000423f0: 0a20 2020 2020 2020 2020 2020 2071 7561  .            qua
+00042400: 6e74 696c 6520 2066 6c6f 6174 3634 2030  ntile  float64 0
+00042410: 2e30 0a20 2020 2020 2020 2044 6174 6120  .0.        Data 
+00042420: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+00042430: 2020 2020 2020 2061 2020 2020 2020 2020         a        
+00042440: 2028 7929 2066 6c6f 6174 3634 2030 2e37   (y) float64 0.7
+00042450: 2034 2e32 2032 2e36 2031 2e35 0a20 2020   4.2 2.6 1.5.   
+00042460: 2020 2020 203e 3e3e 2064 732e 7175 616e       >>> ds.quan
+00042470: 7469 6c65 285b 302c 2030 2e35 2c20 315d  tile([0, 0.5, 1]
+00042480: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
+00042490: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+000424a0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+000424b0: 2028 7175 616e 7469 6c65 3a20 3329 0a20   (quantile: 3). 
+000424c0: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
+000424d0: 6573 3a0a 2020 2020 2020 2020 2020 2a20  es:.          * 
+000424e0: 7175 616e 7469 6c65 2020 2871 7561 6e74  quantile  (quant
+000424f0: 696c 6529 2066 6c6f 6174 3634 2030 2e30  ile) float64 0.0
+00042500: 2030 2e35 2031 2e30 0a20 2020 2020 2020   0.5 1.0.       
+00042510: 2044 6174 6120 7661 7269 6162 6c65 733a   Data variables:
+00042520: 0a20 2020 2020 2020 2020 2020 2061 2020  .            a  
+00042530: 2020 2020 2020 2028 7175 616e 7469 6c65         (quantile
+00042540: 2920 666c 6f61 7436 3420 302e 3720 332e  ) float64 0.7 3.
+00042550: 3420 392e 340a 2020 2020 2020 2020 3e3e  4 9.4.        >>
+00042560: 3e20 6473 2e71 7561 6e74 696c 6528 5b30  > ds.quantile([0
+00042570: 2c20 302e 352c 2031 5d2c 2064 696d 3d22  , 0.5, 1], dim="
+00042580: 7822 290a 2020 2020 2020 2020 3c78 6172  x").        <xar
+00042590: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+000425a0: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+000425b0: 2020 2028 7175 616e 7469 6c65 3a20 332c     (quantile: 3,
+000425c0: 2079 3a20 3429 0a20 2020 2020 2020 2043   y: 4).        C
+000425d0: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+000425e0: 2020 2020 2020 2a20 7920 2020 2020 2020        * y       
+000425f0: 2020 2879 2920 666c 6f61 7436 3420 312e    (y) float64 1.
+00042600: 3020 312e 3520 322e 3020 322e 350a 2020  0 1.5 2.0 2.5.  
+00042610: 2020 2020 2020 2020 2a20 7175 616e 7469          * quanti
+00042620: 6c65 2020 2871 7561 6e74 696c 6529 2066  le  (quantile) f
+00042630: 6c6f 6174 3634 2030 2e30 2030 2e35 2031  loat64 0.0 0.5 1
+00042640: 2e30 0a20 2020 2020 2020 2044 6174 6120  .0.        Data 
+00042650: 7661 7269 6162 6c65 733a 0a20 2020 2020  variables:.     
+00042660: 2020 2020 2020 2061 2020 2020 2020 2020         a        
+00042670: 2028 7175 616e 7469 6c65 2c20 7929 2066   (quantile, y) f
+00042680: 6c6f 6174 3634 2030 2e37 2034 2e32 2032  loat64 0.7 4.2 2
+00042690: 2e36 2031 2e35 2033 2e36 202e 2e2e 2031  .6 1.5 3.6 ... 1
+000426a0: 2e37 2036 2e35 2037 2e33 2039 2e34 2031  .7 6.5 7.3 9.4 1
+000426b0: 2e39 0a0a 2020 2020 2020 2020 5265 6665  .9..        Refe
+000426c0: 7265 6e63 6573 0a20 2020 2020 2020 202d  rences.        -
+000426d0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+000426e0: 2020 2e2e 205b 315d 2052 2e20 4a2e 2048    .. [1] R. J. H
+000426f0: 796e 646d 616e 2061 6e64 2059 2e20 4661  yndman and Y. Fa
+00042700: 6e2c 0a20 2020 2020 2020 2020 2020 2253  n,.           "S
+00042710: 616d 706c 6520 7175 616e 7469 6c65 7320  ample quantiles 
+00042720: 696e 2073 7461 7469 7374 6963 616c 2070  in statistical p
+00042730: 6163 6b61 6765 732c 220a 2020 2020 2020  ackages,".      
+00042740: 2020 2020 2054 6865 2041 6d65 7269 6361       The America
+00042750: 6e20 5374 6174 6973 7469 6369 616e 2c20  n Statistician, 
+00042760: 3530 2834 292c 2070 702e 2033 3631 2d33  50(4), pp. 361-3
+00042770: 3635 2c20 3139 3936 0a20 2020 2020 2020  65, 1996.       
+00042780: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
+00042790: 696e 7465 7270 6f6c 6174 696f 6e20 7265  interpolation re
+000427a0: 6e61 6d65 6420 746f 206d 6574 686f 6420  named to method 
+000427b0: 696e 2076 6572 7369 6f6e 2030 2e32 312e  in version 0.21.
+000427c0: 300a 2020 2020 2020 2020 2320 6368 6563  0.        # chec
+000427d0: 6b20 6865 7265 2061 6e64 2069 6e20 7661  k here and in va
+000427e0: 7269 6162 6c65 2074 6f20 6176 6f69 6420  riable to avoid 
+000427f0: 7265 7065 6174 6564 2077 6172 6e69 6e67  repeated warning
+00042800: 730a 2020 2020 2020 2020 6966 2069 6e74  s.        if int
+00042810: 6572 706f 6c61 7469 6f6e 2069 7320 6e6f  erpolation is no
+00042820: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00042830: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+00042840: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00042850: 2020 2022 5468 6520 6069 6e74 6572 706f     "The `interpo
+00042860: 6c61 7469 6f6e 6020 6172 6775 6d65 6e74  lation` argument
+00042870: 2074 6f20 7175 616e 7469 6c65 2077 6173   to quantile was
+00042880: 2072 656e 616d 6564 2074 6f20 606d 6574   renamed to `met
+00042890: 686f 6460 2e22 2c0a 2020 2020 2020 2020  hod`.",.        
+000428a0: 2020 2020 2020 2020 4675 7475 7265 5761          FutureWa
+000428b0: 726e 696e 672c 0a20 2020 2020 2020 2020  rning,.         
+000428c0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+000428d0: 2020 6966 206d 6574 686f 6420 213d 2022    if method != "
+000428e0: 6c69 6e65 6172 223a 0a20 2020 2020 2020  linear":.       
+000428f0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00042900: 7970 6545 7272 6f72 2822 4361 6e6e 6f74  ypeError("Cannot
+00042910: 2070 6173 7320 696e 7465 7270 6f6c 6174   pass interpolat
+00042920: 696f 6e20 616e 6420 6d65 7468 6f64 206b  ion and method k
+00042930: 6579 776f 7264 7321 2229 0a0a 2020 2020  eywords!")..    
+00042940: 2020 2020 2020 2020 6d65 7468 6f64 203d          method =
+00042950: 2069 6e74 6572 706f 6c61 7469 6f6e 0a0a   interpolation..
+00042960: 2020 2020 2020 2020 6469 6d73 3a20 7365          dims: se
+00042970: 745b 4861 7368 6162 6c65 5d0a 2020 2020  t[Hashable].    
+00042980: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00042990: 6528 6469 6d2c 2073 7472 293a 0a20 2020  e(dim, str):.   
+000429a0: 2020 2020 2020 2020 2064 696d 7320 3d20           dims = 
+000429b0: 7b64 696d 7d0a 2020 2020 2020 2020 656c  {dim}.        el
+000429c0: 6966 2064 696d 2069 7320 4e6f 6e65 206f  if dim is None o
+000429d0: 7220 6469 6d20 6973 202e 2e2e 3a0a 2020  r dim is ...:.  
+000429e0: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
+000429f0: 2073 6574 2873 656c 662e 6469 6d73 290a   set(self.dims).
+00042a00: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00042a10: 2020 2020 2020 2020 2020 6469 6d73 203d            dims =
+00042a20: 2073 6574 2864 696d 290a 0a20 2020 2020   set(dim)..     
+00042a30: 2020 205f 6173 7365 7274 5f65 6d70 7479     _assert_empty
+00042a40: 280a 2020 2020 2020 2020 2020 2020 7475  (.            tu
+00042a50: 706c 6528 6420 666f 7220 6420 696e 2064  ple(d for d in d
+00042a60: 696d 7320 6966 2064 206e 6f74 2069 6e20  ims if d not in 
+00042a70: 7365 6c66 2e64 696d 7329 2c0a 2020 2020  self.dims),.    
+00042a80: 2020 2020 2020 2020 2244 6174 6173 6574          "Dataset
+00042a90: 2064 6f65 7320 6e6f 7420 636f 6e74 6169   does not contai
+00042aa0: 6e20 7468 6520 6469 6d65 6e73 696f 6e73  n the dimensions
+00042ab0: 3a20 2573 222c 0a20 2020 2020 2020 2029  : %s",.        )
+00042ac0: 0a0a 2020 2020 2020 2020 7120 3d20 6e70  ..        q = np
+00042ad0: 2e61 7361 7272 6179 2871 2c20 6474 7970  .asarray(q, dtyp
+00042ae0: 653d 6e70 2e66 6c6f 6174 3634 290a 0a20  e=np.float64).. 
+00042af0: 2020 2020 2020 2076 6172 6961 626c 6573         variables
+00042b00: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
+00042b10: 7220 6e61 6d65 2c20 7661 7220 696e 2073  r name, var in s
+00042b20: 656c 662e 7661 7269 6162 6c65 732e 6974  elf.variables.it
+00042b30: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00042b40: 2020 2072 6564 7563 655f 6469 6d73 203d     reduce_dims =
+00042b50: 205b 6420 666f 7220 6420 696e 2076 6172   [d for d in var
+00042b60: 2e64 696d 7320 6966 2064 2069 6e20 6469  .dims if d in di
+00042b70: 6d73 5d0a 2020 2020 2020 2020 2020 2020  ms].            
+00042b80: 6966 2072 6564 7563 655f 6469 6d73 206f  if reduce_dims o
+00042b90: 7220 6e6f 7420 7661 722e 6469 6d73 3a0a  r not var.dims:.
+00042ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042bb0: 6966 206e 616d 6520 6e6f 7420 696e 2073  if name not in s
+00042bc0: 656c 662e 636f 6f72 6473 3a0a 2020 2020  elf.coords:.    
+00042bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042be0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00042bf0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+00042c00: 206e 756d 6572 6963 5f6f 6e6c 790a 2020   numeric_only.  
+00042c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c20: 2020 2020 2020 6f72 206e 702e 6973 7375        or np.issu
+00042c30: 6264 7479 7065 2876 6172 2e64 7479 7065  bdtype(var.dtype
+00042c40: 2c20 6e70 2e6e 756d 6265 7229 0a20 2020  , np.number).   
+00042c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c60: 2020 2020 206f 7220 7661 722e 6474 7970       or var.dtyp
+00042c70: 6520 3d3d 206e 702e 626f 6f6c 5f0a 2020  e == np.bool_.  
+00042c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c90: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00042ca0: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00042cb0: 6961 626c 6573 5b6e 616d 655d 203d 2076  iables[name] = v
+00042cc0: 6172 2e71 7561 6e74 696c 6528 0a20 2020  ar.quantile(.   
+00042cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042ce0: 2020 2020 2020 2020 2071 2c0a 2020 2020           q,.    
+00042cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042d00: 2020 2020 2020 2020 6469 6d3d 7265 6475          dim=redu
+00042d10: 6365 5f64 696d 732c 0a20 2020 2020 2020  ce_dims,.       
+00042d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042d30: 2020 2020 206d 6574 686f 643d 6d65 7468       method=meth
+00042d40: 6f64 2c0a 2020 2020 2020 2020 2020 2020  od,.            
+00042d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042d60: 6b65 6570 5f61 7474 7273 3d6b 6565 705f  keep_attrs=keep_
+00042d70: 6174 7472 732c 0a20 2020 2020 2020 2020  attrs,.         
+00042d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042d90: 2020 2073 6b69 706e 613d 736b 6970 6e61     skipna=skipna
+00042da0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00042db0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00042dc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00042dd0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00042de0: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
+00042df0: 2076 6172 0a0a 2020 2020 2020 2020 2320   var..        # 
+00042e00: 636f 6e73 7472 7563 7420 7468 6520 6e65  construct the ne
+00042e10: 7720 6461 7461 7365 740a 2020 2020 2020  w dataset.      
+00042e20: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
+00042e30: 7b6b 2066 6f72 206b 2069 6e20 7365 6c66  {k for k in self
+00042e40: 2e63 6f6f 7264 7320 6966 206b 2069 6e20  .coords if k in 
+00042e50: 7661 7269 6162 6c65 737d 0a20 2020 2020  variables}.     
+00042e60: 2020 2069 6e64 6578 6573 203d 207b 6b3a     indexes = {k:
+00042e70: 2076 2066 6f72 206b 2c20 7620 696e 2073   v for k, v in s
+00042e80: 656c 662e 5f69 6e64 6578 6573 2e69 7465  elf._indexes.ite
+00042e90: 6d73 2829 2069 6620 6b20 696e 2076 6172  ms() if k in var
+00042ea0: 6961 626c 6573 7d0a 2020 2020 2020 2020  iables}.        
+00042eb0: 6966 206b 6565 705f 6174 7472 7320 6973  if keep_attrs is
+00042ec0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00042ed0: 2020 206b 6565 705f 6174 7472 7320 3d20     keep_attrs = 
+00042ee0: 5f67 6574 5f6b 6565 705f 6174 7472 7328  _get_keep_attrs(
+00042ef0: 6465 6661 756c 743d 4661 6c73 6529 0a20  default=False). 
+00042f00: 2020 2020 2020 2061 7474 7273 203d 2073         attrs = s
+00042f10: 656c 662e 6174 7472 7320 6966 206b 6565  elf.attrs if kee
+00042f20: 705f 6174 7472 7320 656c 7365 204e 6f6e  p_attrs else Non
+00042f30: 650a 2020 2020 2020 2020 6e65 7720 3d20  e.        new = 
+00042f40: 7365 6c66 2e5f 7265 706c 6163 655f 7769  self._replace_wi
+00042f50: 7468 5f6e 6577 5f64 696d 7328 0a20 2020  th_new_dims(.   
+00042f60: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+00042f70: 6573 2c20 636f 6f72 645f 6e61 6d65 733d  es, coord_names=
+00042f80: 636f 6f72 645f 6e61 6d65 732c 2061 7474  coord_names, att
+00042f90: 7273 3d61 7474 7273 2c20 696e 6465 7865  rs=attrs, indexe
+00042fa0: 733d 696e 6465 7865 730a 2020 2020 2020  s=indexes.      
+00042fb0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+00042fc0: 726e 206e 6577 2e61 7373 6967 6e5f 636f  rn new.assign_co
+00042fd0: 6f72 6473 2871 7561 6e74 696c 653d 7129  ords(quantile=q)
+00042fe0: 0a0a 2020 2020 6465 6620 7261 6e6b 280a  ..    def rank(.
+00042ff0: 2020 2020 2020 2020 7365 6c66 3a20 545f          self: T_
+00043000: 4461 7461 7365 742c 0a20 2020 2020 2020  Dataset,.       
+00043010: 2064 696d 3a20 4861 7368 6162 6c65 2c0a   dim: Hashable,.
+00043020: 2020 2020 2020 2020 7063 743a 2062 6f6f          pct: boo
+00043030: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+00043040: 2020 206b 6565 705f 6174 7472 733a 2062     keep_attrs: b
+00043050: 6f6f 6c20 7c20 4e6f 6e65 203d 204e 6f6e  ool | None = Non
+00043060: 652c 0a20 2020 2029 202d 3e20 545f 4461  e,.    ) -> T_Da
+00043070: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+00043080: 2222 5261 6e6b 7320 7468 6520 6461 7461  ""Ranks the data
+00043090: 2e0a 0a20 2020 2020 2020 2045 7175 616c  ...        Equal
+000430a0: 2076 616c 7565 7320 6172 6520 6173 7369   values are assi
+000430b0: 676e 6564 2061 2072 616e 6b20 7468 6174  gned a rank that
+000430c0: 2069 7320 7468 6520 6176 6572 6167 6520   is the average 
+000430d0: 6f66 2074 6865 2072 616e 6b73 2074 6861  of the ranks tha
+000430e0: 740a 2020 2020 2020 2020 776f 756c 6420  t.        would 
+000430f0: 6861 7665 2062 6565 6e20 6f74 6865 7277  have been otherw
+00043100: 6973 6520 6173 7369 676e 6564 2074 6f20  ise assigned to 
+00043110: 616c 6c20 6f66 2074 6865 2076 616c 7565  all of the value
+00043120: 7320 7769 7468 696e 0a20 2020 2020 2020  s within.       
+00043130: 2074 6861 7420 7365 742e 0a20 2020 2020   that set..     
+00043140: 2020 2052 616e 6b73 2062 6567 696e 2061     Ranks begin a
+00043150: 7420 312c 206e 6f74 2030 2e20 4966 2070  t 1, not 0. If p
+00043160: 6374 2069 7320 5472 7565 2c20 636f 6d70  ct is True, comp
+00043170: 7574 6573 2070 6572 6365 6e74 6167 6520  utes percentage 
+00043180: 7261 6e6b 732e 0a0a 2020 2020 2020 2020  ranks...        
+00043190: 4e61 4e73 2069 6e20 7468 6520 696e 7075  NaNs in the inpu
+000431a0: 7420 6172 7261 7920 6172 6520 7265 7475  t array are retu
+000431b0: 726e 6564 2061 7320 4e61 4e73 2e0a 0a20  rned as NaNs... 
+000431c0: 2020 2020 2020 2054 6865 2060 626f 7474         The `bott
+000431d0: 6c65 6e65 636b 6020 6c69 6272 6172 7920  leneck` library 
+000431e0: 6973 2072 6571 7569 7265 642e 0a0a 2020  is required...  
+000431f0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00043200: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00043210: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
+00043220: 3a20 4861 7368 6162 6c65 0a20 2020 2020  : Hashable.     
+00043230: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+00043240: 206f 7665 7220 7768 6963 6820 746f 2063   over which to c
+00043250: 6f6d 7075 7465 2072 616e 6b2e 0a20 2020  ompute rank..   
+00043260: 2020 2020 2070 6374 203a 2062 6f6f 6c2c       pct : bool,
+00043270: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
+00043280: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00043290: 7275 652c 2063 6f6d 7075 7465 2070 6572  rue, compute per
+000432a0: 6365 6e74 6167 6520 7261 6e6b 732c 206f  centage ranks, o
+000432b0: 7468 6572 7769 7365 2063 6f6d 7075 7465  therwise compute
+000432c0: 2069 6e74 6567 6572 2072 616e 6b73 2e0a   integer ranks..
+000432d0: 2020 2020 2020 2020 6b65 6570 5f61 7474          keep_att
+000432e0: 7273 203a 2062 6f6f 6c20 6f72 204e 6f6e  rs : bool or Non
+000432f0: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+00043300: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00043310: 2074 6865 2064 6174 6173 6574 2773 2061   the dataset's a
+00043320: 7474 7269 6275 7465 7320 2860 6174 7472  ttributes (`attr
+00043330: 7360 2920 7769 6c6c 2062 6520 636f 7069  s`) will be copi
+00043340: 6564 2066 726f 6d0a 2020 2020 2020 2020  ed from.        
+00043350: 2020 2020 7468 6520 6f72 6967 696e 616c      the original
+00043360: 206f 626a 6563 7420 746f 2074 6865 206e   object to the n
+00043370: 6577 206f 6e65 2e20 2049 6620 4661 6c73  ew one.  If Fals
+00043380: 652c 2074 6865 206e 6577 0a20 2020 2020  e, the new.     
+00043390: 2020 2020 2020 206f 626a 6563 7420 7769         object wi
+000433a0: 6c6c 2062 6520 7265 7475 726e 6564 2077  ll be returned w
+000433b0: 6974 686f 7574 2061 7474 7269 6275 7465  ithout attribute
+000433c0: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
+000433d0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+000433e0: 2d2d 2d0a 2020 2020 2020 2020 7261 6e6b  ---.        rank
+000433f0: 6564 203a 2044 6174 6173 6574 0a20 2020  ed : Dataset.   
+00043400: 2020 2020 2020 2020 2056 6172 6961 626c           Variabl
+00043410: 6573 2074 6861 7420 646f 206e 6f74 2064  es that do not d
+00043420: 6570 656e 6420 6f6e 2060 6469 6d60 2061  epend on `dim` a
+00043430: 7265 2064 726f 7070 6564 2e0a 2020 2020  re dropped..    
+00043440: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00043450: 6966 206e 6f74 204f 5054 494f 4e53 5b22  if not OPTIONS["
+00043460: 7573 655f 626f 7474 6c65 6e65 636b 225d  use_bottleneck"]
+00043470: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00043480: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
+00043490: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000434a0: 2020 2272 616e 6b20 7265 7175 6972 6573    "rank requires
+000434b0: 2062 6f74 746c 656e 6563 6b20 746f 2062   bottleneck to b
+000434c0: 6520 656e 6162 6c65 642e 220a 2020 2020  e enabled.".    
+000434d0: 2020 2020 2020 2020 2020 2020 2220 4361              " Ca
+000434e0: 6c6c 2060 7872 2e73 6574 5f6f 7074 696f  ll `xr.set_optio
+000434f0: 6e73 2875 7365 5f62 6f74 746c 656e 6563  ns(use_bottlenec
+00043500: 6b3d 5472 7565 2960 2074 6f20 656e 6162  k=True)` to enab
+00043510: 6c65 2069 742e 220a 2020 2020 2020 2020  le it.".        
+00043520: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
+00043530: 6620 6469 6d20 6e6f 7420 696e 2073 656c  f dim not in sel
+00043540: 662e 6469 6d73 3a0a 2020 2020 2020 2020  f.dims:.        
+00043550: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00043560: 7272 6f72 2866 2244 6174 6173 6574 2064  rror(f"Dataset d
+00043570: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
+00043580: 7468 6520 6469 6d65 6e73 696f 6e3a 207b  the dimension: {
+00043590: 6469 6d7d 2229 0a0a 2020 2020 2020 2020  dim}")..        
+000435a0: 7661 7269 6162 6c65 7320 3d20 7b7d 0a20  variables = {}. 
+000435b0: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
+000435c0: 2076 6172 2069 6e20 7365 6c66 2e76 6172   var in self.var
+000435d0: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
+000435e0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000435f0: 616d 6520 696e 2073 656c 662e 6461 7461  ame in self.data
+00043600: 5f76 6172 733a 0a20 2020 2020 2020 2020  _vars:.         
+00043610: 2020 2020 2020 2069 6620 6469 6d20 696e         if dim in
+00043620: 2076 6172 2e64 696d 733a 0a20 2020 2020   var.dims:.     
+00043630: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00043640: 6172 6961 626c 6573 5b6e 616d 655d 203d  ariables[name] =
+00043650: 2076 6172 2e72 616e 6b28 6469 6d2c 2070   var.rank(dim, p
+00043660: 6374 3d70 6374 290a 2020 2020 2020 2020  ct=pct).        
+00043670: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00043680: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+00043690: 6c65 735b 6e61 6d65 5d20 3d20 7661 720a  les[name] = var.
+000436a0: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
+000436b0: 616d 6573 203d 2073 6574 2873 656c 662e  ames = set(self.
+000436c0: 636f 6f72 6473 290a 2020 2020 2020 2020  coords).        
+000436d0: 6966 206b 6565 705f 6174 7472 7320 6973  if keep_attrs is
+000436e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000436f0: 2020 206b 6565 705f 6174 7472 7320 3d20     keep_attrs = 
+00043700: 5f67 6574 5f6b 6565 705f 6174 7472 7328  _get_keep_attrs(
+00043710: 6465 6661 756c 743d 4661 6c73 6529 0a20  default=False). 
+00043720: 2020 2020 2020 2061 7474 7273 203d 2073         attrs = s
+00043730: 656c 662e 6174 7472 7320 6966 206b 6565  elf.attrs if kee
+00043740: 705f 6174 7472 7320 656c 7365 204e 6f6e  p_attrs else Non
+00043750: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00043760: 2073 656c 662e 5f72 6570 6c61 6365 2876   self._replace(v
+00043770: 6172 6961 626c 6573 2c20 636f 6f72 645f  ariables, coord_
+00043780: 6e61 6d65 732c 2061 7474 7273 3d61 7474  names, attrs=att
+00043790: 7273 290a 0a20 2020 2064 6566 2064 6966  rs)..    def dif
+000437a0: 6665 7265 6e74 6961 7465 280a 2020 2020  ferentiate(.    
+000437b0: 2020 2020 7365 6c66 3a20 545f 4461 7461      self: T_Data
+000437c0: 7365 742c 0a20 2020 2020 2020 2063 6f6f  set,.        coo
+000437d0: 7264 3a20 4861 7368 6162 6c65 2c0a 2020  rd: Hashable,.  
+000437e0: 2020 2020 2020 6564 6765 5f6f 7264 6572        edge_order
+000437f0: 3a20 4c69 7465 7261 6c5b 312c 2032 5d20  : Literal[1, 2] 
+00043800: 3d20 312c 0a20 2020 2020 2020 2064 6174  = 1,.        dat
+00043810: 6574 696d 655f 756e 6974 3a20 4461 7465  etime_unit: Date
+00043820: 7469 6d65 556e 6974 4f70 7469 6f6e 7320  timeUnitOptions 
+00043830: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00043840: 2020 2029 202d 3e20 545f 4461 7461 7365     ) -> T_Datase
+00043850: 743a 0a20 2020 2020 2020 2022 2222 2044  t:.        """ D
+00043860: 6966 6665 7265 6e74 6961 7465 2077 6974  ifferentiate wit
+00043870: 6820 7468 6520 7365 636f 6e64 206f 7264  h the second ord
+00043880: 6572 2061 6363 7572 6174 6520 6365 6e74  er accurate cent
+00043890: 7261 6c0a 2020 2020 2020 2020 6469 6666  ral.        diff
+000438a0: 6572 656e 6365 732e 0a0a 2020 2020 2020  erences...      
+000438b0: 2020 2e2e 206e 6f74 653a 3a0a 2020 2020    .. note::.    
+000438c0: 2020 2020 2020 2020 5468 6973 2066 6561          This fea
+000438d0: 7475 7265 2069 7320 6c69 6d69 7465 6420  ture is limited 
+000438e0: 746f 2073 696d 706c 6520 6361 7274 6573  to simple cartes
+000438f0: 6961 6e20 6765 6f6d 6574 7279 2c20 692e  ian geometry, i.
+00043900: 652e 2063 6f6f 7264 0a20 2020 2020 2020  e. coord.       
+00043910: 2020 2020 206d 7573 7420 6265 206f 6e65       must be one
+00043920: 2064 696d 656e 7369 6f6e 616c 2e0a 0a20   dimensional... 
+00043930: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00043940: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00043950: 2d2d 2d2d 0a20 2020 2020 2020 2063 6f6f  ----.        coo
+00043960: 7264 203a 2048 6173 6861 626c 650a 2020  rd : Hashable.  
+00043970: 2020 2020 2020 2020 2020 5468 6520 636f            The co
+00043980: 6f72 6469 6e61 7465 2074 6f20 6265 2075  ordinate to be u
+00043990: 7365 6420 746f 2063 6f6d 7075 7465 2074  sed to compute t
+000439a0: 6865 2067 7261 6469 656e 742e 0a20 2020  he gradient..   
+000439b0: 2020 2020 2065 6467 655f 6f72 6465 7220       edge_order 
+000439c0: 3a20 7b31 2c20 327d 2c20 6465 6661 756c  : {1, 2}, defaul
+000439d0: 743a 2031 0a20 2020 2020 2020 2020 2020  t: 1.           
+000439e0: 204e 2d74 6820 6f72 6465 7220 6163 6375   N-th order accu
+000439f0: 7261 7465 2064 6966 6665 7265 6e63 6573  rate differences
+00043a00: 2061 7420 7468 6520 626f 756e 6461 7269   at the boundari
+00043a10: 6573 2e0a 2020 2020 2020 2020 6461 7465  es..        date
+00043a20: 7469 6d65 5f75 6e69 7420 3a20 4e6f 6e65  time_unit : None
+00043a30: 206f 7220 7b22 5922 2c20 224d 222c 2022   or {"Y", "M", "
+00043a40: 5722 2c20 2244 222c 2022 6822 2c20 226d  W", "D", "h", "m
+00043a50: 222c 2022 7322 2c20 226d 7322 2c20 5c0a  ", "s", "ms", \.
+00043a60: 2020 2020 2020 2020 2020 2020 2275 7322              "us"
+00043a70: 2c20 226e 7322 2c20 2270 7322 2c20 2266  , "ns", "ps", "f
+00043a80: 7322 2c20 2261 7322 2c20 4e6f 6e65 7d2c  s", "as", None},
+00043a90: 2064 6566 6175 6c74 3a20 4e6f 6e65 0a20   default: None. 
+00043aa0: 2020 2020 2020 2020 2020 2055 6e69 7420             Unit 
+00043ab0: 746f 2063 6f6d 7075 7465 2067 7261 6469  to compute gradi
+00043ac0: 656e 742e 204f 6e6c 7920 7661 6c69 6420  ent. Only valid 
+00043ad0: 666f 7220 6461 7465 7469 6d65 2063 6f6f  for datetime coo
+00043ae0: 7264 696e 6174 652e 0a0a 2020 2020 2020  rdinate...      
+00043af0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00043b00: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00043b10: 2020 6469 6666 6572 656e 7469 6174 6564    differentiated
+00043b20: 3a20 4461 7461 7365 740a 0a20 2020 2020  : Dataset..     
+00043b30: 2020 2053 6565 2061 6c73 6f0a 2020 2020     See also.    
+00043b40: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00043b50: 2020 2020 206e 756d 7079 2e67 7261 6469       numpy.gradi
+00043b60: 656e 743a 2063 6f72 7265 7370 6f6e 6469  ent: correspondi
+00043b70: 6e67 206e 756d 7079 2066 756e 6374 696f  ng numpy functio
+00043b80: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+00043b90: 2020 2020 2020 6672 6f6d 2078 6172 7261        from xarra
+00043ba0: 792e 636f 7265 2e76 6172 6961 626c 6520  y.core.variable 
+00043bb0: 696d 706f 7274 2056 6172 6961 626c 650a  import Variable.
+00043bc0: 0a20 2020 2020 2020 2069 6620 636f 6f72  .        if coor
+00043bd0: 6420 6e6f 7420 696e 2073 656c 662e 7661  d not in self.va
+00043be0: 7269 6162 6c65 7320 616e 6420 636f 6f72  riables and coor
+00043bf0: 6420 6e6f 7420 696e 2073 656c 662e 6469  d not in self.di
+00043c00: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00043c10: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00043c20: 2866 2243 6f6f 7264 696e 6174 6520 7b63  (f"Coordinate {c
+00043c30: 6f6f 7264 7d20 646f 6573 206e 6f74 2065  oord} does not e
+00043c40: 7869 7374 2e22 290a 0a20 2020 2020 2020  xist.")..       
+00043c50: 2063 6f6f 7264 5f76 6172 203d 2073 656c   coord_var = sel
+00043c60: 665b 636f 6f72 645d 2e76 6172 6961 626c  f[coord].variabl
+00043c70: 650a 2020 2020 2020 2020 6966 2063 6f6f  e.        if coo
+00043c80: 7264 5f76 6172 2e6e 6469 6d20 213d 2031  rd_var.ndim != 1
+00043c90: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00043ca0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00043cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043cc0: 2243 6f6f 7264 696e 6174 6520 7b7d 206d  "Coordinate {} m
+00043cd0: 7573 7420 6265 2031 2064 696d 656e 7369  ust be 1 dimensi
+00043ce0: 6f6e 616c 2062 7574 2069 7320 7b7d 220a  onal but is {}".
+00043cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043d00: 2220 6469 6d65 6e73 696f 6e61 6c22 2e66  " dimensional".f
+00043d10: 6f72 6d61 7428 636f 6f72 642c 2063 6f6f  ormat(coord, coo
+00043d20: 7264 5f76 6172 2e6e 6469 6d29 0a20 2020  rd_var.ndim).   
+00043d30: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00043d40: 2020 2020 6469 6d20 3d20 636f 6f72 645f      dim = coord_
+00043d50: 7661 722e 6469 6d73 5b30 5d0a 2020 2020  var.dims[0].    
+00043d60: 2020 2020 6966 205f 636f 6e74 6169 6e73      if _contains
+00043d70: 5f64 6174 6574 696d 655f 6c69 6b65 5f6f  _datetime_like_o
+00043d80: 626a 6563 7473 2863 6f6f 7264 5f76 6172  bjects(coord_var
+00043d90: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00043da0: 6620 636f 6f72 645f 7661 722e 6474 7970  f coord_var.dtyp
+00043db0: 652e 6b69 6e64 2069 6e20 226d 4d22 2061  e.kind in "mM" a
+00043dc0: 6e64 2064 6174 6574 696d 655f 756e 6974  nd datetime_unit
+00043dd0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00043de0: 2020 2020 2020 2020 2020 6461 7465 7469            dateti
+00043df0: 6d65 5f75 6e69 7420 3d20 6361 7374 280a  me_unit = cast(.
+00043e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043e10: 2020 2020 2244 6174 6574 696d 6555 6e69      "DatetimeUni
+00043e20: 744f 7074 696f 6e73 222c 206e 702e 6461  tOptions", np.da
+00043e30: 7465 7469 6d65 5f64 6174 6128 636f 6f72  tetime_data(coor
+00043e40: 645f 7661 722e 6474 7970 6529 5b30 5d0a  d_var.dtype)[0].
+00043e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043e60: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00043e70: 6966 2064 6174 6574 696d 655f 756e 6974  if datetime_unit
+00043e80: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00043e90: 2020 2020 2020 2020 2020 6461 7465 7469            dateti
+00043ea0: 6d65 5f75 6e69 7420 3d20 2273 2220 2023  me_unit = "s"  #
+00043eb0: 2044 6566 6175 6c74 2074 6f20 7365 636f   Default to seco
+00043ec0: 6e64 7320 666f 7220 6366 7469 6d65 206f  nds for cftime o
+00043ed0: 626a 6563 7473 0a20 2020 2020 2020 2020  bjects.         
+00043ee0: 2020 2063 6f6f 7264 5f76 6172 203d 2063     coord_var = c
+00043ef0: 6f6f 7264 5f76 6172 2e5f 746f 5f6e 756d  oord_var._to_num
+00043f00: 6572 6963 2864 6174 6574 696d 655f 756e  eric(datetime_un
+00043f10: 6974 3d64 6174 6574 696d 655f 756e 6974  it=datetime_unit
+00043f20: 290a 0a20 2020 2020 2020 2076 6172 6961  )..        varia
+00043f30: 626c 6573 203d 207b 7d0a 2020 2020 2020  bles = {}.      
+00043f40: 2020 666f 7220 6b2c 2076 2069 6e20 7365    for k, v in se
+00043f50: 6c66 2e76 6172 6961 626c 6573 2e69 7465  lf.variables.ite
+00043f60: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00043f70: 2020 6966 206b 2069 6e20 7365 6c66 2e64    if k in self.d
+00043f80: 6174 615f 7661 7273 2061 6e64 2064 696d  ata_vars and dim
+00043f90: 2069 6e20 762e 6469 6d73 2061 6e64 206b   in v.dims and k
+00043fa0: 206e 6f74 2069 6e20 7365 6c66 2e63 6f6f   not in self.coo
+00043fb0: 7264 733a 0a20 2020 2020 2020 2020 2020  rds:.           
+00043fc0: 2020 2020 2069 6620 5f63 6f6e 7461 696e       if _contain
+00043fd0: 735f 6461 7465 7469 6d65 5f6c 696b 655f  s_datetime_like_
+00043fe0: 6f62 6a65 6374 7328 7629 3a0a 2020 2020  objects(v):.    
+00043ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044000: 7620 3d20 762e 5f74 6f5f 6e75 6d65 7269  v = v._to_numeri
+00044010: 6328 6461 7465 7469 6d65 5f75 6e69 743d  c(datetime_unit=
+00044020: 6461 7465 7469 6d65 5f75 6e69 7429 0a20  datetime_unit). 
+00044030: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00044040: 7261 6420 3d20 6475 636b 5f61 7272 6179  rad = duck_array
+00044050: 5f6f 7073 2e67 7261 6469 656e 7428 0a20  _ops.gradient(. 
+00044060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044070: 2020 2076 2e64 6174 612c 0a20 2020 2020     v.data,.     
+00044080: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00044090: 6f6f 7264 5f76 6172 2e64 6174 612c 0a20  oord_var.data,. 
+000440a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000440b0: 2020 2065 6467 655f 6f72 6465 723d 6564     edge_order=ed
+000440c0: 6765 5f6f 7264 6572 2c0a 2020 2020 2020  ge_order,.      
+000440d0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+000440e0: 6973 3d76 2e67 6574 5f61 7869 735f 6e75  is=v.get_axis_nu
+000440f0: 6d28 6469 6d29 2c0a 2020 2020 2020 2020  m(dim),.        
+00044100: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00044110: 2020 2020 2020 2020 2020 7661 7269 6162            variab
+00044120: 6c65 735b 6b5d 203d 2056 6172 6961 626c  les[k] = Variabl
+00044130: 6528 762e 6469 6d73 2c20 6772 6164 290a  e(v.dims, grad).
+00044140: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00044150: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00044160: 2020 7661 7269 6162 6c65 735b 6b5d 203d    variables[k] =
+00044170: 2076 0a20 2020 2020 2020 2072 6574 7572   v.        retur
+00044180: 6e20 7365 6c66 2e5f 7265 706c 6163 6528  n self._replace(
+00044190: 7661 7269 6162 6c65 7329 0a0a 2020 2020  variables)..    
+000441a0: 6465 6620 696e 7465 6772 6174 6528 0a20  def integrate(. 
+000441b0: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+000441c0: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
+000441d0: 636f 6f72 643a 2048 6173 6861 626c 6520  coord: Hashable 
+000441e0: 7c20 5365 7175 656e 6365 5b48 6173 6861  | Sequence[Hasha
+000441f0: 626c 655d 2c0a 2020 2020 2020 2020 6461  ble],.        da
+00044200: 7465 7469 6d65 5f75 6e69 743a 2044 6174  tetime_unit: Dat
+00044210: 6574 696d 6555 6e69 744f 7074 696f 6e73  etimeUnitOptions
+00044220: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+00044230: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+00044240: 2020 2020 2022 2222 496e 7465 6772 6174       """Integrat
+00044250: 6520 616c 6f6e 6720 7468 6520 6769 7665  e along the give
+00044260: 6e20 636f 6f72 6469 6e61 7465 2075 7369  n coordinate usi
+00044270: 6e67 2074 6865 2074 7261 7065 7a6f 6964  ng the trapezoid
+00044280: 616c 2072 756c 652e 0a0a 2020 2020 2020  al rule...      
+00044290: 2020 2e2e 206e 6f74 653a 3a0a 2020 2020    .. note::.    
+000442a0: 2020 2020 2020 2020 5468 6973 2066 6561          This fea
+000442b0: 7475 7265 2069 7320 6c69 6d69 7465 6420  ture is limited 
+000442c0: 746f 2073 696d 706c 6520 6361 7274 6573  to simple cartes
+000442d0: 6961 6e20 6765 6f6d 6574 7279 2c20 692e  ian geometry, i.
+000442e0: 652e 2063 6f6f 7264 0a20 2020 2020 2020  e. coord.       
+000442f0: 2020 2020 206d 7573 7420 6265 206f 6e65       must be one
+00044300: 2064 696d 656e 7369 6f6e 616c 2e0a 0a20   dimensional... 
+00044310: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00044320: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00044330: 2d2d 2d2d 0a20 2020 2020 2020 2063 6f6f  ----.        coo
+00044340: 7264 203a 2068 6173 6861 626c 652c 206f  rd : hashable, o
+00044350: 7220 7365 7175 656e 6365 206f 6620 6861  r sequence of ha
+00044360: 7368 6162 6c65 0a20 2020 2020 2020 2020  shable.         
+00044370: 2020 2043 6f6f 7264 696e 6174 6528 7329     Coordinate(s)
+00044380: 2075 7365 6420 666f 7220 7468 6520 696e   used for the in
+00044390: 7465 6772 6174 696f 6e2e 0a20 2020 2020  tegration..     
+000443a0: 2020 2064 6174 6574 696d 655f 756e 6974     datetime_unit
+000443b0: 203a 207b 2759 272c 2027 4d27 2c20 2757   : {'Y', 'M', 'W
+000443c0: 272c 2027 4427 2c20 2768 272c 2027 6d27  ', 'D', 'h', 'm'
+000443d0: 2c20 2773 272c 2027 6d73 272c 2027 7573  , 's', 'ms', 'us
+000443e0: 272c 2027 6e73 272c 205c 0a20 2020 2020  ', 'ns', \.     
+000443f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044400: 2020 2027 7073 272c 2027 6673 272c 2027     'ps', 'fs', '
+00044410: 6173 272c 204e 6f6e 657d 2c20 6f70 7469  as', None}, opti
+00044420: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+00044430: 2053 7065 6369 6679 2074 6865 2075 6e69   Specify the uni
+00044440: 7420 6966 2064 6174 6574 696d 6520 636f  t if datetime co
+00044450: 6f72 6469 6e61 7465 2069 7320 7573 6564  ordinate is used
+00044460: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00044470: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00044480: 2d2d 0a20 2020 2020 2020 2069 6e74 6567  --.        integ
+00044490: 7261 7465 6420 3a20 4461 7461 7365 740a  rated : Dataset.
+000444a0: 0a20 2020 2020 2020 2053 6565 2061 6c73  .        See als
+000444b0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+000444c0: 2d2d 0a20 2020 2020 2020 2044 6174 6141  --.        DataA
+000444d0: 7272 6179 2e69 6e74 6567 7261 7465 0a20  rray.integrate. 
+000444e0: 2020 2020 2020 206e 756d 7079 2e74 7261         numpy.tra
+000444f0: 707a 203a 2063 6f72 7265 7370 6f6e 6469  pz : correspondi
+00044500: 6e67 206e 756d 7079 2066 756e 6374 696f  ng numpy functio
+00044510: 6e0a 0a20 2020 2020 2020 2045 7861 6d70  n..        Examp
+00044520: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
+00044530: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
+00044540: 2064 7320 3d20 7872 2e44 6174 6173 6574   ds = xr.Dataset
+00044550: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
+00044560: 2020 6461 7461 5f76 6172 733d 7b22 6122    data_vars={"a"
+00044570: 3a20 2822 7822 2c20 5b35 2c20 352c 2036  : ("x", [5, 5, 6
+00044580: 2c20 365d 292c 2022 6222 3a20 2822 7822  , 6]), "b": ("x"
+00044590: 2c20 5b31 2c20 322c 2031 2c20 305d 297d  , [1, 2, 1, 0])}
+000445a0: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+000445b0: 2020 636f 6f72 6473 3d7b 2278 223a 205b    coords={"x": [
+000445c0: 302c 2031 2c20 322c 2033 5d2c 2022 7922  0, 1, 2, 3], "y"
+000445d0: 3a20 2822 7822 2c20 5b31 2c20 372c 2033  : ("x", [1, 7, 3
+000445e0: 2c20 355d 297d 2c0a 2020 2020 2020 2020  , 5])},.        
+000445f0: 2e2e 2e20 290a 2020 2020 2020 2020 3e3e  ... ).        >>
+00044600: 3e20 6473 0a20 2020 2020 2020 203c 7861  > ds.        <xa
+00044610: 7272 6179 2e44 6174 6173 6574 3e0a 2020  rray.Dataset>.  
+00044620: 2020 2020 2020 4469 6d65 6e73 696f 6e73        Dimensions
+00044630: 3a20 2028 783a 2034 290a 2020 2020 2020  :  (x: 4).      
+00044640: 2020 436f 6f72 6469 6e61 7465 733a 0a20    Coordinates:. 
+00044650: 2020 2020 2020 2020 202a 2078 2020 2020           * x    
+00044660: 2020 2020 2878 2920 696e 7436 3420 3020      (x) int64 0 
+00044670: 3120 3220 330a 2020 2020 2020 2020 2020  1 2 3.          
+00044680: 2020 7920 2020 2020 2020 2028 7829 2069    y        (x) i
+00044690: 6e74 3634 2031 2037 2033 2035 0a20 2020  nt64 1 7 3 5.   
+000446a0: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+000446b0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+000446c0: 2061 2020 2020 2020 2020 2878 2920 696e   a        (x) in
+000446d0: 7436 3420 3520 3520 3620 360a 2020 2020  t64 5 5 6 6.    
+000446e0: 2020 2020 2020 2020 6220 2020 2020 2020          b       
+000446f0: 2028 7829 2069 6e74 3634 2031 2032 2031   (x) int64 1 2 1
+00044700: 2030 0a20 2020 2020 2020 203e 3e3e 2064   0.        >>> d
+00044710: 732e 696e 7465 6772 6174 6528 2278 2229  s.integrate("x")
+00044720: 0a20 2020 2020 2020 203c 7861 7272 6179  .        <xarray
+00044730: 2e44 6174 6173 6574 3e0a 2020 2020 2020  .Dataset>.      
+00044740: 2020 4469 6d65 6e73 696f 6e73 3a20 2028    Dimensions:  (
+00044750: 290a 2020 2020 2020 2020 4461 7461 2076  ).        Data v
+00044760: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+00044770: 2020 2020 2020 6120 2020 2020 2020 2066        a        f
+00044780: 6c6f 6174 3634 2031 362e 350a 2020 2020  loat64 16.5.    
+00044790: 2020 2020 2020 2020 6220 2020 2020 2020          b       
+000447a0: 2066 6c6f 6174 3634 2033 2e35 0a20 2020   float64 3.5.   
+000447b0: 2020 2020 203e 3e3e 2064 732e 696e 7465       >>> ds.inte
+000447c0: 6772 6174 6528 2279 2229 0a20 2020 2020  grate("y").     
+000447d0: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+000447e0: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+000447f0: 6e73 696f 6e73 3a20 2028 290a 2020 2020  nsions:  ().    
+00044800: 2020 2020 4461 7461 2076 6172 6961 626c      Data variabl
+00044810: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00044820: 6120 2020 2020 2020 2066 6c6f 6174 3634  a        float64
+00044830: 2032 302e 300a 2020 2020 2020 2020 2020   20.0.          
+00044840: 2020 6220 2020 2020 2020 2066 6c6f 6174    b        float
+00044850: 3634 2034 2e30 0a20 2020 2020 2020 2022  64 4.0.        "
+00044860: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00044870: 7420 6973 696e 7374 616e 6365 2863 6f6f  t isinstance(coo
+00044880: 7264 2c20 286c 6973 742c 2074 7570 6c65  rd, (list, tuple
+00044890: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000448a0: 636f 6f72 6420 3d20 2863 6f6f 7264 2c29  coord = (coord,)
+000448b0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+000448c0: 3d20 7365 6c66 0a20 2020 2020 2020 2066  = self.        f
+000448d0: 6f72 2063 2069 6e20 636f 6f72 643a 0a20  or c in coord:. 
+000448e0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+000448f0: 7420 3d20 7265 7375 6c74 2e5f 696e 7465  t = result._inte
+00044900: 6772 6174 655f 6f6e 6528 632c 2064 6174  grate_one(c, dat
+00044910: 6574 696d 655f 756e 6974 3d64 6174 6574  etime_unit=datet
+00044920: 696d 655f 756e 6974 290a 2020 2020 2020  ime_unit).      
+00044930: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
+00044940: 0a20 2020 2064 6566 205f 696e 7465 6772  .    def _integr
+00044950: 6174 655f 6f6e 6528 7365 6c66 2c20 636f  ate_one(self, co
+00044960: 6f72 642c 2064 6174 6574 696d 655f 756e  ord, datetime_un
+00044970: 6974 3d4e 6f6e 652c 2063 756d 756c 6174  it=None, cumulat
+00044980: 6976 653d 4661 6c73 6529 3a0a 2020 2020  ive=False):.    
+00044990: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
+000449a0: 636f 7265 2e76 6172 6961 626c 6520 696d  core.variable im
+000449b0: 706f 7274 2056 6172 6961 626c 650a 0a20  port Variable.. 
+000449c0: 2020 2020 2020 2069 6620 636f 6f72 6420         if coord 
+000449d0: 6e6f 7420 696e 2073 656c 662e 7661 7269  not in self.vari
+000449e0: 6162 6c65 7320 616e 6420 636f 6f72 6420  ables and coord 
+000449f0: 6e6f 7420 696e 2073 656c 662e 6469 6d73  not in self.dims
+00044a00: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00044a10: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00044a20: 2243 6f6f 7264 696e 6174 6520 7b63 6f6f  "Coordinate {coo
+00044a30: 7264 7d20 646f 6573 206e 6f74 2065 7869  rd} does not exi
+00044a40: 7374 2e22 290a 0a20 2020 2020 2020 2063  st.")..        c
+00044a50: 6f6f 7264 5f76 6172 203d 2073 656c 665b  oord_var = self[
+00044a60: 636f 6f72 645d 2e76 6172 6961 626c 650a  coord].variable.
+00044a70: 2020 2020 2020 2020 6966 2063 6f6f 7264          if coord
+00044a80: 5f76 6172 2e6e 6469 6d20 213d 2031 3a0a  _var.ndim != 1:.
+00044a90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00044aa0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00044ab0: 2020 2020 2020 2020 2020 2020 2020 2243                "C
+00044ac0: 6f6f 7264 696e 6174 6520 7b7d 206d 7573  oordinate {} mus
+00044ad0: 7420 6265 2031 2064 696d 656e 7369 6f6e  t be 1 dimension
+00044ae0: 616c 2062 7574 2069 7320 7b7d 220a 2020  al but is {}".  
+00044af0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00044b00: 6469 6d65 6e73 696f 6e61 6c22 2e66 6f72  dimensional".for
+00044b10: 6d61 7428 636f 6f72 642c 2063 6f6f 7264  mat(coord, coord
+00044b20: 5f76 6172 2e6e 6469 6d29 0a20 2020 2020  _var.ndim).     
+00044b30: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00044b40: 2020 6469 6d20 3d20 636f 6f72 645f 7661    dim = coord_va
+00044b50: 722e 6469 6d73 5b30 5d0a 2020 2020 2020  r.dims[0].      
+00044b60: 2020 6966 205f 636f 6e74 6169 6e73 5f64    if _contains_d
+00044b70: 6174 6574 696d 655f 6c69 6b65 5f6f 626a  atetime_like_obj
+00044b80: 6563 7473 2863 6f6f 7264 5f76 6172 293a  ects(coord_var):
+00044b90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00044ba0: 636f 6f72 645f 7661 722e 6474 7970 652e  coord_var.dtype.
+00044bb0: 6b69 6e64 2069 6e20 226d 4d22 2061 6e64  kind in "mM" and
+00044bc0: 2064 6174 6574 696d 655f 756e 6974 2069   datetime_unit i
+00044bd0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00044be0: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
+00044bf0: 5f75 6e69 742c 205f 203d 206e 702e 6461  _unit, _ = np.da
+00044c00: 7465 7469 6d65 5f64 6174 6128 636f 6f72  tetime_data(coor
+00044c10: 645f 7661 722e 6474 7970 6529 0a20 2020  d_var.dtype).   
+00044c20: 2020 2020 2020 2020 2065 6c69 6620 6461           elif da
+00044c30: 7465 7469 6d65 5f75 6e69 7420 6973 204e  tetime_unit is N
+00044c40: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00044c50: 2020 2020 2064 6174 6574 696d 655f 756e       datetime_un
+00044c60: 6974 203d 2022 7322 2020 2320 4465 6661  it = "s"  # Defa
+00044c70: 756c 7420 746f 2073 6563 6f6e 6473 2066  ult to seconds f
+00044c80: 6f72 2063 6674 696d 6520 6f62 6a65 6374  or cftime object
+00044c90: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
+00044ca0: 6f72 645f 7661 7220 3d20 636f 6f72 645f  ord_var = coord_
+00044cb0: 7661 722e 5f72 6570 6c61 6365 280a 2020  var._replace(.  
+00044cc0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00044cd0: 7461 3d64 6174 6574 696d 655f 746f 5f6e  ta=datetime_to_n
+00044ce0: 756d 6572 6963 2863 6f6f 7264 5f76 6172  umeric(coord_var
+00044cf0: 2e64 6174 612c 2064 6174 6574 696d 655f  .data, datetime_
+00044d00: 756e 6974 3d64 6174 6574 696d 655f 756e  unit=datetime_un
+00044d10: 6974 290a 2020 2020 2020 2020 2020 2020  it).            
+00044d20: 290a 0a20 2020 2020 2020 2076 6172 6961  )..        varia
+00044d30: 626c 6573 203d 207b 7d0a 2020 2020 2020  bles = {}.      
+00044d40: 2020 636f 6f72 645f 6e61 6d65 7320 3d20    coord_names = 
+00044d50: 7365 7428 290a 2020 2020 2020 2020 666f  set().        fo
+00044d60: 7220 6b2c 2076 2069 6e20 7365 6c66 2e76  r k, v in self.v
+00044d70: 6172 6961 626c 6573 2e69 7465 6d73 2829  ariables.items()
+00044d80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00044d90: 206b 2069 6e20 7365 6c66 2e63 6f6f 7264   k in self.coord
+00044da0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00044db0: 2020 2069 6620 6469 6d20 6e6f 7420 696e     if dim not in
+00044dc0: 2076 2e64 696d 7320 6f72 2063 756d 756c   v.dims or cumul
+00044dd0: 6174 6976 653a 0a20 2020 2020 2020 2020  ative:.         
+00044de0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+00044df0: 626c 6573 5b6b 5d20 3d20 760a 2020 2020  bles[k] = v.    
+00044e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044e10: 636f 6f72 645f 6e61 6d65 732e 6164 6428  coord_names.add(
+00044e20: 6b29 0a20 2020 2020 2020 2020 2020 2065  k).            e
+00044e30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00044e40: 2020 2020 2069 6620 6b20 696e 2073 656c       if k in sel
+00044e50: 662e 6461 7461 5f76 6172 7320 616e 6420  f.data_vars and 
+00044e60: 6469 6d20 696e 2076 2e64 696d 733a 0a20  dim in v.dims:. 
+00044e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044e80: 2020 2069 6620 5f63 6f6e 7461 696e 735f     if _contains_
+00044e90: 6461 7465 7469 6d65 5f6c 696b 655f 6f62  datetime_like_ob
+00044ea0: 6a65 6374 7328 7629 3a0a 2020 2020 2020  jects(v):.      
+00044eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044ec0: 2020 7620 3d20 6461 7465 7469 6d65 5f74    v = datetime_t
+00044ed0: 6f5f 6e75 6d65 7269 6328 762c 2064 6174  o_numeric(v, dat
+00044ee0: 6574 696d 655f 756e 6974 3d64 6174 6574  etime_unit=datet
+00044ef0: 696d 655f 756e 6974 290a 2020 2020 2020  ime_unit).      
+00044f00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00044f10: 2063 756d 756c 6174 6976 653a 0a20 2020   cumulative:.   
+00044f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044f30: 2020 2020 2069 6e74 6567 203d 2064 7563       integ = duc
+00044f40: 6b5f 6172 7261 795f 6f70 732e 6375 6d75  k_array_ops.cumu
+00044f50: 6c61 7469 7665 5f74 7261 7065 7a6f 6964  lative_trapezoid
+00044f60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00044f70: 2020 2020 2020 2020 2020 2020 2020 762e                v.
+00044f80: 6461 7461 2c20 636f 6f72 645f 7661 722e  data, coord_var.
+00044f90: 6461 7461 2c20 6178 6973 3d76 2e67 6574  data, axis=v.get
+00044fa0: 5f61 7869 735f 6e75 6d28 6469 6d29 0a20  _axis_num(dim). 
+00044fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044fc0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00044fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044fe0: 2076 5f64 696d 7320 3d20 762e 6469 6d73   v_dims = v.dims
+00044ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045000: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00045010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045020: 2020 2069 6e74 6567 203d 2064 7563 6b5f     integ = duck_
+00045030: 6172 7261 795f 6f70 732e 7472 6170 7a28  array_ops.trapz(
+00045040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045050: 2020 2020 2020 2020 2020 2020 2076 2e64               v.d
+00045060: 6174 612c 2063 6f6f 7264 5f76 6172 2e64  ata, coord_var.d
+00045070: 6174 612c 2061 7869 733d 762e 6765 745f  ata, axis=v.get_
+00045080: 6178 6973 5f6e 756d 2864 696d 290a 2020  axis_num(dim).  
+00045090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000450a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000450b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000450c0: 765f 6469 6d73 203d 206c 6973 7428 762e  v_dims = list(v.
+000450d0: 6469 6d73 290a 2020 2020 2020 2020 2020  dims).          
+000450e0: 2020 2020 2020 2020 2020 2020 2020 765f                v_
+000450f0: 6469 6d73 2e72 656d 6f76 6528 6469 6d29  dims.remove(dim)
+00045100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045110: 2020 2020 2076 6172 6961 626c 6573 5b6b       variables[k
+00045120: 5d20 3d20 5661 7269 6162 6c65 2876 5f64  ] = Variable(v_d
+00045130: 696d 732c 2069 6e74 6567 290a 2020 2020  ims, integ).    
+00045140: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00045150: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00045160: 2020 2020 2020 7661 7269 6162 6c65 735b        variables[
+00045170: 6b5d 203d 2076 0a20 2020 2020 2020 2069  k] = v.        i
+00045180: 6e64 6578 6573 203d 207b 6b3a 2076 2066  ndexes = {k: v f
+00045190: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
+000451a0: 5f69 6e64 6578 6573 2e69 7465 6d73 2829  _indexes.items()
+000451b0: 2069 6620 6b20 696e 2076 6172 6961 626c   if k in variabl
+000451c0: 6573 7d0a 2020 2020 2020 2020 7265 7475  es}.        retu
+000451d0: 726e 2073 656c 662e 5f72 6570 6c61 6365  rn self._replace
+000451e0: 5f77 6974 685f 6e65 775f 6469 6d73 280a  _with_new_dims(.
+000451f0: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+00045200: 6162 6c65 732c 2063 6f6f 7264 5f6e 616d  ables, coord_nam
+00045210: 6573 3d63 6f6f 7264 5f6e 616d 6573 2c20  es=coord_names, 
+00045220: 696e 6465 7865 733d 696e 6465 7865 730a  indexes=indexes.
+00045230: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00045240: 6566 2063 756d 756c 6174 6976 655f 696e  ef cumulative_in
+00045250: 7465 6772 6174 6528 0a20 2020 2020 2020  tegrate(.       
+00045260: 2073 656c 663a 2054 5f44 6174 6173 6574   self: T_Dataset
+00045270: 2c0a 2020 2020 2020 2020 636f 6f72 643a  ,.        coord:
+00045280: 2048 6173 6861 626c 6520 7c20 5365 7175   Hashable | Sequ
+00045290: 656e 6365 5b48 6173 6861 626c 655d 2c0a  ence[Hashable],.
+000452a0: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
+000452b0: 5f75 6e69 743a 2044 6174 6574 696d 6555  _unit: DatetimeU
+000452c0: 6e69 744f 7074 696f 6e73 203d 204e 6f6e  nitOptions = Non
+000452d0: 652c 0a20 2020 2029 202d 3e20 545f 4461  e,.    ) -> T_Da
+000452e0: 7461 7365 743a 0a20 2020 2020 2020 2022  taset:.        "
+000452f0: 2222 496e 7465 6772 6174 6520 616c 6f6e  ""Integrate alon
+00045300: 6720 7468 6520 6769 7665 6e20 636f 6f72  g the given coor
+00045310: 6469 6e61 7465 2075 7369 6e67 2074 6865  dinate using the
+00045320: 2074 7261 7065 7a6f 6964 616c 2072 756c   trapezoidal rul
+00045330: 652e 0a0a 2020 2020 2020 2020 2e2e 206e  e...        .. n
+00045340: 6f74 653a 3a0a 2020 2020 2020 2020 2020  ote::.          
+00045350: 2020 5468 6973 2066 6561 7475 7265 2069    This feature i
+00045360: 7320 6c69 6d69 7465 6420 746f 2073 696d  s limited to sim
+00045370: 706c 6520 6361 7274 6573 6961 6e20 6765  ple cartesian ge
+00045380: 6f6d 6574 7279 2c20 692e 652e 2063 6f6f  ometry, i.e. coo
+00045390: 7264 0a20 2020 2020 2020 2020 2020 206d  rd.            m
+000453a0: 7573 7420 6265 206f 6e65 2064 696d 656e  ust be one dimen
+000453b0: 7369 6f6e 616c 2e0a 0a20 2020 2020 2020  sional...       
+000453c0: 2020 2020 2054 6865 2066 6972 7374 2065       The first e
+000453d0: 6e74 7279 206f 6620 7468 6520 6375 6d75  ntry of the cumu
+000453e0: 6c61 7469 7665 2069 6e74 6567 7261 6c20  lative integral 
+000453f0: 6f66 2065 6163 6820 7661 7269 6162 6c65  of each variable
+00045400: 2069 7320 616c 7761 7973 2030 2c20 696e   is always 0, in
+00045410: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+00045420: 6572 2074 6f20 6b65 6570 2074 6865 206c  er to keep the l
+00045430: 656e 6774 6820 6f66 2074 6865 2064 696d  ength of the dim
+00045440: 656e 7369 6f6e 2075 6e63 6861 6e67 6564  ension unchanged
+00045450: 2062 6574 7765 656e 2069 6e70 7574 2061   between input a
+00045460: 6e64 0a20 2020 2020 2020 2020 2020 206f  nd.            o
+00045470: 7574 7075 742e 0a0a 2020 2020 2020 2020  utput...        
+00045480: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00045490: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+000454a0: 2020 2020 2020 636f 6f72 6420 3a20 6861        coord : ha
+000454b0: 7368 6162 6c65 2c20 6f72 2073 6571 7565  shable, or seque
+000454c0: 6e63 6520 6f66 2068 6173 6861 626c 650a  nce of hashable.
+000454d0: 2020 2020 2020 2020 2020 2020 436f 6f72              Coor
+000454e0: 6469 6e61 7465 2873 2920 7573 6564 2066  dinate(s) used f
+000454f0: 6f72 2074 6865 2069 6e74 6567 7261 7469  or the integrati
+00045500: 6f6e 2e0a 2020 2020 2020 2020 6461 7465  on..        date
+00045510: 7469 6d65 5f75 6e69 7420 3a20 7b27 5927  time_unit : {'Y'
+00045520: 2c20 274d 272c 2027 5727 2c20 2744 272c  , 'M', 'W', 'D',
+00045530: 2027 6827 2c20 276d 272c 2027 7327 2c20   'h', 'm', 's', 
+00045540: 276d 7327 2c20 2775 7327 2c20 276e 7327  'ms', 'us', 'ns'
+00045550: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+00045560: 2020 2020 2020 2020 2020 2020 2770 7327              'ps'
+00045570: 2c20 2766 7327 2c20 2761 7327 2c20 4e6f  , 'fs', 'as', No
+00045580: 6e65 7d2c 206f 7074 696f 6e61 6c0a 2020  ne}, optional.  
+00045590: 2020 2020 2020 2020 2020 5370 6563 6966            Specif
+000455a0: 7920 7468 6520 756e 6974 2069 6620 6461  y the unit if da
+000455b0: 7465 7469 6d65 2063 6f6f 7264 696e 6174  tetime coordinat
+000455c0: 6520 6973 2075 7365 642e 0a0a 2020 2020  e is used...    
+000455d0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+000455e0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+000455f0: 2020 2020 696e 7465 6772 6174 6564 203a      integrated :
+00045600: 2044 6174 6173 6574 0a0a 2020 2020 2020   Dataset..      
+00045610: 2020 5365 6520 616c 736f 0a20 2020 2020    See also.     
+00045620: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00045630: 2020 2020 4461 7461 4172 7261 792e 6375      DataArray.cu
+00045640: 6d75 6c61 7469 7665 5f69 6e74 6567 7261  mulative_integra
+00045650: 7465 0a20 2020 2020 2020 2073 6369 7079  te.        scipy
+00045660: 2e69 6e74 6567 7261 7465 2e63 756d 756c  .integrate.cumul
+00045670: 6174 6976 655f 7472 6170 657a 6f69 6420  ative_trapezoid 
+00045680: 3a20 636f 7272 6573 706f 6e64 696e 6720  : corresponding 
+00045690: 7363 6970 7920 6675 6e63 7469 6f6e 0a0a  scipy function..
+000456a0: 2020 2020 2020 2020 4578 616d 706c 6573          Examples
+000456b0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000456c0: 2d0a 2020 2020 2020 2020 3e3e 3e20 6473  -.        >>> ds
+000456d0: 203d 2078 722e 4461 7461 7365 7428 0a20   = xr.Dataset(. 
+000456e0: 2020 2020 2020 202e 2e2e 2020 2020 2064         ...     d
+000456f0: 6174 615f 7661 7273 3d7b 2261 223a 2028  ata_vars={"a": (
+00045700: 2278 222c 205b 352c 2035 2c20 362c 2036  "x", [5, 5, 6, 6
+00045710: 5d29 2c20 2262 223a 2028 2278 222c 205b  ]), "b": ("x", [
+00045720: 312c 2032 2c20 312c 2030 5d29 7d2c 0a20  1, 2, 1, 0])},. 
+00045730: 2020 2020 2020 202e 2e2e 2020 2020 2063         ...     c
+00045740: 6f6f 7264 733d 7b22 7822 3a20 5b30 2c20  oords={"x": [0, 
+00045750: 312c 2032 2c20 335d 2c20 2279 223a 2028  1, 2, 3], "y": (
+00045760: 2278 222c 205b 312c 2037 2c20 332c 2035  "x", [1, 7, 3, 5
+00045770: 5d29 7d2c 0a20 2020 2020 2020 202e 2e2e  ])},.        ...
+00045780: 2029 0a20 2020 2020 2020 203e 3e3e 2064   ).        >>> d
+00045790: 730a 2020 2020 2020 2020 3c78 6172 7261  s.        <xarra
+000457a0: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+000457b0: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+000457c0: 2878 3a20 3429 0a20 2020 2020 2020 2043  (x: 4).        C
+000457d0: 6f6f 7264 696e 6174 6573 3a0a 2020 2020  oordinates:.    
+000457e0: 2020 2020 2020 2a20 7820 2020 2020 2020        * x       
+000457f0: 2028 7829 2069 6e74 3634 2030 2031 2032   (x) int64 0 1 2
+00045800: 2033 0a20 2020 2020 2020 2020 2020 2079   3.            y
+00045810: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
+00045820: 3420 3120 3720 3320 350a 2020 2020 2020  4 1 7 3 5.      
+00045830: 2020 4461 7461 2076 6172 6961 626c 6573    Data variables
+00045840: 3a0a 2020 2020 2020 2020 2020 2020 6120  :.            a 
+00045850: 2020 2020 2020 2028 7829 2069 6e74 3634         (x) int64
+00045860: 2035 2035 2036 2036 0a20 2020 2020 2020   5 5 6 6.       
+00045870: 2020 2020 2062 2020 2020 2020 2020 2878       b        (x
+00045880: 2920 696e 7436 3420 3120 3220 3120 300a  ) int64 1 2 1 0.
+00045890: 2020 2020 2020 2020 3e3e 3e20 6473 2e63          >>> ds.c
+000458a0: 756d 756c 6174 6976 655f 696e 7465 6772  umulative_integr
+000458b0: 6174 6528 2278 2229 0a20 2020 2020 2020  ate("x").       
+000458c0: 203c 7861 7272 6179 2e44 6174 6173 6574   <xarray.Dataset
+000458d0: 3e0a 2020 2020 2020 2020 4469 6d65 6e73  >.        Dimens
+000458e0: 696f 6e73 3a20 2028 783a 2034 290a 2020  ions:  (x: 4).  
+000458f0: 2020 2020 2020 436f 6f72 6469 6e61 7465        Coordinate
+00045900: 733a 0a20 2020 2020 2020 2020 202a 2078  s:.          * x
+00045910: 2020 2020 2020 2020 2878 2920 696e 7436          (x) int6
+00045920: 3420 3020 3120 3220 330a 2020 2020 2020  4 0 1 2 3.      
+00045930: 2020 2020 2020 7920 2020 2020 2020 2028        y        (
+00045940: 7829 2069 6e74 3634 2031 2037 2033 2035  x) int64 1 7 3 5
+00045950: 0a20 2020 2020 2020 2044 6174 6120 7661  .        Data va
+00045960: 7269 6162 6c65 733a 0a20 2020 2020 2020  riables:.       
+00045970: 2020 2020 2061 2020 2020 2020 2020 2878       a        (x
+00045980: 2920 666c 6f61 7436 3420 302e 3020 352e  ) float64 0.0 5.
+00045990: 3020 3130 2e35 2031 362e 350a 2020 2020  0 10.5 16.5.    
+000459a0: 2020 2020 2020 2020 6220 2020 2020 2020          b       
+000459b0: 2028 7829 2066 6c6f 6174 3634 2030 2e30   (x) float64 0.0
+000459c0: 2031 2e35 2033 2e30 2033 2e35 0a20 2020   1.5 3.0 3.5.   
+000459d0: 2020 2020 203e 3e3e 2064 732e 6375 6d75       >>> ds.cumu
+000459e0: 6c61 7469 7665 5f69 6e74 6567 7261 7465  lative_integrate
+000459f0: 2822 7922 290a 2020 2020 2020 2020 3c78  ("y").        <x
+00045a00: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+00045a10: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+00045a20: 733a 2020 2878 3a20 3429 0a20 2020 2020  s:  (x: 4).     
+00045a30: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+00045a40: 2020 2020 2020 2020 2020 2a20 7820 2020            * x   
+00045a50: 2020 2020 2028 7829 2069 6e74 3634 2030       (x) int64 0
+00045a60: 2031 2032 2033 0a20 2020 2020 2020 2020   1 2 3.         
+00045a70: 2020 2079 2020 2020 2020 2020 2878 2920     y        (x) 
+00045a80: 696e 7436 3420 3120 3720 3320 350a 2020  int64 1 7 3 5.  
+00045a90: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+00045aa0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+00045ab0: 2020 6120 2020 2020 2020 2028 7829 2066    a        (x) f
+00045ac0: 6c6f 6174 3634 2030 2e30 2033 302e 3020  loat64 0.0 30.0 
+00045ad0: 382e 3020 3230 2e30 0a20 2020 2020 2020  8.0 20.0.       
+00045ae0: 2020 2020 2062 2020 2020 2020 2020 2878       b        (x
+00045af0: 2920 666c 6f61 7436 3420 302e 3020 392e  ) float64 0.0 9.
+00045b00: 3020 332e 3020 342e 300a 2020 2020 2020  0 3.0 4.0.      
+00045b10: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00045b20: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00045b30: 636f 6f72 642c 2028 6c69 7374 2c20 7475  coord, (list, tu
+00045b40: 706c 6529 293a 0a20 2020 2020 2020 2020  ple)):.         
+00045b50: 2020 2063 6f6f 7264 203d 2028 636f 6f72     coord = (coor
+00045b60: 642c 290a 2020 2020 2020 2020 7265 7375  d,).        resu
+00045b70: 6c74 203d 2073 656c 660a 2020 2020 2020  lt = self.      
+00045b80: 2020 666f 7220 6320 696e 2063 6f6f 7264    for c in coord
+00045b90: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00045ba0: 7375 6c74 203d 2072 6573 756c 742e 5f69  sult = result._i
+00045bb0: 6e74 6567 7261 7465 5f6f 6e65 280a 2020  ntegrate_one(.  
+00045bc0: 2020 2020 2020 2020 2020 2020 2020 632c                c,
+00045bd0: 2064 6174 6574 696d 655f 756e 6974 3d64   datetime_unit=d
+00045be0: 6174 6574 696d 655f 756e 6974 2c20 6375  atetime_unit, cu
+00045bf0: 6d75 6c61 7469 7665 3d54 7275 650a 2020  mulative=True.  
+00045c00: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00045c10: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+00045c20: 740a 0a20 2020 2040 7072 6f70 6572 7479  t..    @property
+00045c30: 0a20 2020 2064 6566 2072 6561 6c28 7365  .    def real(se
+00045c40: 6c66 3a20 545f 4461 7461 7365 7429 202d  lf: T_Dataset) -
+00045c50: 3e20 545f 4461 7461 7365 743a 0a20 2020  > T_Dataset:.   
+00045c60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00045c70: 2054 6865 2072 6561 6c20 7061 7274 206f   The real part o
+00045c80: 6620 6561 6368 2064 6174 6120 7661 7269  f each data vari
+00045c90: 6162 6c65 2e0a 0a20 2020 2020 2020 2053  able...        S
+00045ca0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00045cb0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00045cc0: 206e 756d 7079 2e6e 6461 7272 6179 2e72   numpy.ndarray.r
+00045cd0: 6561 6c0a 2020 2020 2020 2020 2222 220a  eal.        """.
+00045ce0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00045cf0: 656c 662e 6d61 7028 6c61 6d62 6461 2078  elf.map(lambda x
+00045d00: 3a20 782e 7265 616c 2c20 6b65 6570 5f61  : x.real, keep_a
+00045d10: 7474 7273 3d54 7275 6529 0a0a 2020 2020  ttrs=True)..    
+00045d20: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00045d30: 6620 696d 6167 2873 656c 663a 2054 5f44  f imag(self: T_D
+00045d40: 6174 6173 6574 2920 2d3e 2054 5f44 6174  ataset) -> T_Dat
+00045d50: 6173 6574 3a0a 2020 2020 2020 2020 2222  aset:.        ""
+00045d60: 220a 2020 2020 2020 2020 5468 6520 696d  ".        The im
+00045d70: 6167 696e 6172 7920 7061 7274 206f 6620  aginary part of 
+00045d80: 6561 6368 2064 6174 6120 7661 7269 6162  each data variab
+00045d90: 6c65 2e0a 0a20 2020 2020 2020 2053 6565  le...        See
+00045da0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00045db0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206e  ------.        n
+00045dc0: 756d 7079 2e6e 6461 7272 6179 2e69 6d61  umpy.ndarray.ima
+00045dd0: 670a 2020 2020 2020 2020 2222 220a 2020  g.        """.  
+00045de0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00045df0: 662e 6d61 7028 6c61 6d62 6461 2078 3a20  f.map(lambda x: 
+00045e00: 782e 696d 6167 2c20 6b65 6570 5f61 7474  x.imag, keep_att
+00045e10: 7273 3d54 7275 6529 0a0a 2020 2020 706c  rs=True)..    pl
+00045e20: 6f74 203d 2075 7469 6c73 2e55 6e63 6163  ot = utils.Uncac
+00045e30: 6865 6441 6363 6573 736f 7228 4461 7461  hedAccessor(Data
+00045e40: 7365 7450 6c6f 7441 6363 6573 736f 7229  setPlotAccessor)
+00045e50: 0a0a 2020 2020 6465 6620 6669 6c74 6572  ..    def filter
+00045e60: 5f62 795f 6174 7472 7328 7365 6c66 3a20  _by_attrs(self: 
+00045e70: 545f 4461 7461 7365 742c 202a 2a6b 7761  T_Dataset, **kwa
+00045e80: 7267 7329 202d 3e20 545f 4461 7461 7365  rgs) -> T_Datase
+00045e90: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
+00045ea0: 7475 726e 7320 6120 6060 4461 7461 7365  turns a ``Datase
+00045eb0: 7460 6020 7769 7468 2076 6172 6961 626c  t`` with variabl
+00045ec0: 6573 2074 6861 7420 6d61 7463 6820 7370  es that match sp
+00045ed0: 6563 6966 6963 2063 6f6e 6469 7469 6f6e  ecific condition
+00045ee0: 732e 0a0a 2020 2020 2020 2020 4361 6e20  s...        Can 
+00045ef0: 7061 7373 2069 6e20 6060 6b65 793d 7661  pass in ``key=va
+00045f00: 6c75 6560 6020 6f72 2060 606b 6579 3d63  lue`` or ``key=c
+00045f10: 616c 6c61 626c 6560 602e 2020 4120 4461  allable``.  A Da
+00045f20: 7461 7365 7420 6973 2072 6574 7572 6e65  taset is returne
+00045f30: 640a 2020 2020 2020 2020 636f 6e74 6169  d.        contai
+00045f40: 6e69 6e67 206f 6e6c 7920 7468 6520 7661  ning only the va
+00045f50: 7269 6162 6c65 7320 666f 7220 7768 6963  riables for whic
+00045f60: 6820 616c 6c20 7468 6520 6669 6c74 6572  h all the filter
+00045f70: 2074 6573 7473 2070 6173 732e 0a20 2020   tests pass..   
+00045f80: 2020 2020 2054 6865 7365 2074 6573 7473       These tests
+00045f90: 2061 7265 2065 6974 6865 7220 6060 6b65   are either ``ke
+00045fa0: 793d 7661 6c75 6560 6020 666f 7220 7768  y=value`` for wh
+00045fb0: 6963 6820 7468 6520 6174 7472 6962 7574  ich the attribut
+00045fc0: 6520 6060 6b65 7960 600a 2020 2020 2020  e ``key``.      
+00045fd0: 2020 6861 7320 7468 6520 6578 6163 7420    has the exact 
+00045fe0: 7661 6c75 6520 6060 7661 6c75 6560 6020  value ``value`` 
+00045ff0: 6f72 2074 6865 2063 616c 6c61 626c 6520  or the callable 
+00046000: 7061 7373 6564 2069 6e74 6f0a 2020 2020  passed into.    
+00046010: 2020 2020 6060 6b65 793d 6361 6c6c 6162      ``key=callab
+00046020: 6c65 6060 2072 6574 7572 6e73 2054 7275  le`` returns Tru
+00046030: 652e 2054 6865 2063 616c 6c61 626c 6520  e. The callable 
+00046040: 7769 6c6c 2062 6520 7061 7373 6564 2061  will be passed a
+00046050: 2073 696e 676c 650a 2020 2020 2020 2020   single.        
+00046060: 7661 6c75 652c 2065 6974 6865 7220 7468  value, either th
+00046070: 6520 7661 6c75 6520 6f66 2074 6865 2061  e value of the a
+00046080: 7474 7269 6275 7465 2060 606b 6579 6060  ttribute ``key``
+00046090: 206f 7220 6060 4e6f 6e65 6060 2069 6620   or ``None`` if 
+000460a0: 7468 650a 2020 2020 2020 2020 4461 7461  the.        Data
+000460b0: 4172 7261 7920 646f 6573 206e 6f74 2068  Array does not h
+000460c0: 6176 6520 616e 2061 7474 7269 6275 7465  ave an attribute
+000460d0: 2077 6974 6820 7468 6520 6e61 6d65 2060   with the name `
+000460e0: 606b 6579 6060 2e0a 0a20 2020 2020 2020  `key``...       
+000460f0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00046100: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00046110: 2020 2020 2020 202a 2a6b 7761 7267 730a         **kwargs.
+00046120: 2020 2020 2020 2020 2020 2020 6b65 7920              key 
+00046130: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+00046140: 2020 2020 2020 4174 7472 6962 7574 6520        Attribute 
+00046150: 6e61 6d65 2e0a 2020 2020 2020 2020 2020  name..          
+00046160: 2020 7661 6c75 6520 3a20 6361 6c6c 6162    value : callab
+00046170: 6c65 206f 7220 6f62 6a0a 2020 2020 2020  le or obj.      
+00046180: 2020 2020 2020 2020 2020 4966 2076 616c            If val
+00046190: 7565 2069 7320 6120 6361 6c6c 6162 6c65  ue is a callable
+000461a0: 2c20 6974 2073 686f 756c 6420 7265 7475  , it should retu
+000461b0: 726e 2061 2062 6f6f 6c65 616e 2069 6e20  rn a boolean in 
+000461c0: 7468 6520 666f 726d 0a20 2020 2020 2020  the form.       
+000461d0: 2020 2020 2020 2020 206f 6620 626f 6f6c           of bool
+000461e0: 203d 2066 756e 6328 6174 7472 2920 7768   = func(attr) wh
+000461f0: 6572 6520 6174 7472 2069 7320 6461 2e61  ere attr is da.a
+00046200: 7474 7273 5b6b 6579 5d2e 0a20 2020 2020  ttrs[key]..     
+00046210: 2020 2020 2020 2020 2020 204f 7468 6572             Other
+00046220: 7769 7365 2c20 7661 6c75 6520 7769 6c6c  wise, value will
+00046230: 2062 6520 636f 6d70 6172 6564 2074 6f20   be compared to 
+00046240: 7468 6520 6561 6368 0a20 2020 2020 2020  the each.       
+00046250: 2020 2020 2020 2020 2044 6174 6141 7272           DataArr
+00046260: 6179 2773 2061 7474 7273 5b6b 6579 5d2e  ay's attrs[key].
+00046270: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00046280: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00046290: 2d0a 2020 2020 2020 2020 6e65 7720 3a20  -.        new : 
+000462a0: 4461 7461 7365 740a 2020 2020 2020 2020  Dataset.        
+000462b0: 2020 2020 4e65 7720 6461 7461 7365 7420      New dataset 
+000462c0: 7769 7468 2076 6172 6961 626c 6573 2066  with variables f
+000462d0: 696c 7465 7265 6420 6279 2061 7474 7269  iltered by attri
+000462e0: 6275 7465 2e0a 0a20 2020 2020 2020 2045  bute...        E
+000462f0: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
+00046300: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00046310: 203e 3e3e 2074 656d 7020 3d20 3135 202b   >>> temp = 15 +
+00046320: 2038 202a 206e 702e 7261 6e64 6f6d 2e72   8 * np.random.r
+00046330: 616e 646e 2832 2c20 322c 2033 290a 2020  andn(2, 2, 3).  
+00046340: 2020 2020 2020 3e3e 3e20 7072 6563 6970        >>> precip
+00046350: 203d 2031 3020 2a20 6e70 2e72 616e 646f   = 10 * np.rando
+00046360: 6d2e 7261 6e64 2832 2c20 322c 2033 290a  m.rand(2, 2, 3).
+00046370: 2020 2020 2020 2020 3e3e 3e20 6c6f 6e20          >>> lon 
+00046380: 3d20 5b5b 2d39 392e 3833 2c20 2d39 392e  = [[-99.83, -99.
+00046390: 3332 5d2c 205b 2d39 392e 3739 2c20 2d39  32], [-99.79, -9
+000463a0: 392e 3233 5d5d 0a20 2020 2020 2020 203e  9.23]].        >
+000463b0: 3e3e 206c 6174 203d 205b 5b34 322e 3235  >> lat = [[42.25
+000463c0: 2c20 3432 2e32 315d 2c20 5b34 322e 3633  , 42.21], [42.63
+000463d0: 2c20 3432 2e35 395d 5d0a 2020 2020 2020  , 42.59]].      
+000463e0: 2020 3e3e 3e20 6469 6d73 203d 205b 2278    >>> dims = ["x
+000463f0: 222c 2022 7922 2c20 2274 696d 6522 5d0a  ", "y", "time"].
+00046400: 2020 2020 2020 2020 3e3e 3e20 7465 6d70          >>> temp
+00046410: 5f61 7474 7220 3d20 6469 6374 2873 7461  _attr = dict(sta
+00046420: 6e64 6172 645f 6e61 6d65 3d22 6169 725f  ndard_name="air_
+00046430: 706f 7465 6e74 6961 6c5f 7465 6d70 6572  potential_temper
+00046440: 6174 7572 6522 290a 2020 2020 2020 2020  ature").        
+00046450: 3e3e 3e20 7072 6563 6970 5f61 7474 7220  >>> precip_attr 
+00046460: 3d20 6469 6374 2873 7461 6e64 6172 645f  = dict(standard_
+00046470: 6e61 6d65 3d22 636f 6e76 6563 7469 7665  name="convective
+00046480: 5f70 7265 6369 7069 7461 7469 6f6e 5f66  _precipitation_f
+00046490: 6c75 7822 290a 0a20 2020 2020 2020 203e  lux")..        >
+000464a0: 3e3e 2064 7320 3d20 7872 2e44 6174 6173  >> ds = xr.Datas
+000464b0: 6574 280a 2020 2020 2020 2020 2e2e 2e20  et(.        ... 
+000464c0: 2020 2020 6469 6374 280a 2020 2020 2020      dict(.      
+000464d0: 2020 2e2e 2e20 2020 2020 2020 2020 7465    ...         te
+000464e0: 6d70 6572 6174 7572 653d 2864 696d 732c  mperature=(dims,
+000464f0: 2074 656d 702c 2074 656d 705f 6174 7472   temp, temp_attr
+00046500: 292c 0a20 2020 2020 2020 202e 2e2e 2020  ),.        ...  
+00046510: 2020 2020 2020 2070 7265 6369 7069 7461         precipita
+00046520: 7469 6f6e 3d28 6469 6d73 2c20 7072 6563  tion=(dims, prec
+00046530: 6970 2c20 7072 6563 6970 5f61 7474 7229  ip, precip_attr)
+00046540: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
+00046550: 2020 292c 0a20 2020 2020 2020 202e 2e2e    ),.        ...
+00046560: 2020 2020 2063 6f6f 7264 733d 6469 6374       coords=dict
+00046570: 280a 2020 2020 2020 2020 2e2e 2e20 2020  (.        ...   
+00046580: 2020 2020 2020 6c6f 6e3d 285b 2278 222c        lon=(["x",
+00046590: 2022 7922 5d2c 206c 6f6e 292c 0a20 2020   "y"], lon),.   
+000465a0: 2020 2020 202e 2e2e 2020 2020 2020 2020       ...        
+000465b0: 206c 6174 3d28 5b22 7822 2c20 2279 225d   lat=(["x", "y"]
+000465c0: 2c20 6c61 7429 2c0a 2020 2020 2020 2020  , lat),.        
+000465d0: 2e2e 2e20 2020 2020 2020 2020 7469 6d65  ...         time
+000465e0: 3d70 642e 6461 7465 5f72 616e 6765 2822  =pd.date_range("
+000465f0: 3230 3134 2d30 392d 3036 222c 2070 6572  2014-09-06", per
+00046600: 696f 6473 3d33 292c 0a20 2020 2020 2020  iods=3),.       
+00046610: 202e 2e2e 2020 2020 2020 2020 2072 6566   ...         ref
+00046620: 6572 656e 6365 5f74 696d 653d 7064 2e54  erence_time=pd.T
+00046630: 696d 6573 7461 6d70 2822 3230 3134 2d30  imestamp("2014-0
+00046640: 392d 3035 2229 2c0a 2020 2020 2020 2020  9-05"),.        
+00046650: 2e2e 2e20 2020 2020 292c 0a20 2020 2020  ...     ),.     
+00046660: 2020 202e 2e2e 2029 0a0a 2020 2020 2020     ... )..      
+00046670: 2020 4765 7420 7661 7269 6162 6c65 7320    Get variables 
+00046680: 6d61 7463 6869 6e67 2061 2073 7065 6369  matching a speci
+00046690: 6669 6320 7374 616e 6461 7264 5f6e 616d  fic standard_nam
+000466a0: 653a 0a0a 2020 2020 2020 2020 3e3e 3e20  e:..        >>> 
+000466b0: 6473 2e66 696c 7465 725f 6279 5f61 7474  ds.filter_by_att
+000466c0: 7273 2873 7461 6e64 6172 645f 6e61 6d65  rs(standard_name
+000466d0: 3d22 636f 6e76 6563 7469 7665 5f70 7265  ="convective_pre
+000466e0: 6369 7069 7461 7469 6f6e 5f66 6c75 7822  cipitation_flux"
+000466f0: 290a 2020 2020 2020 2020 3c78 6172 7261  ).        <xarra
+00046700: 792e 4461 7461 7365 743e 0a20 2020 2020  y.Dataset>.     
+00046710: 2020 2044 696d 656e 7369 6f6e 733a 2020     Dimensions:  
+00046720: 2020 2020 2020 2028 783a 2032 2c20 793a         (x: 2, y:
+00046730: 2032 2c20 7469 6d65 3a20 3329 0a20 2020   2, time: 3).   
+00046740: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+00046750: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00046760: 6e20 2020 2020 2020 2020 2020 2020 2878  n             (x
+00046770: 2c20 7929 2066 6c6f 6174 3634 202d 3939  , y) float64 -99
+00046780: 2e38 3320 2d39 392e 3332 202d 3939 2e37  .83 -99.32 -99.7
+00046790: 3920 2d39 392e 3233 0a20 2020 2020 2020  9 -99.23.       
+000467a0: 2020 2020 206c 6174 2020 2020 2020 2020       lat        
+000467b0: 2020 2020 2028 782c 2079 2920 666c 6f61       (x, y) floa
+000467c0: 7436 3420 3432 2e32 3520 3432 2e32 3120  t64 42.25 42.21 
+000467d0: 3432 2e36 3320 3432 2e35 390a 2020 2020  42.63 42.59.    
+000467e0: 2020 2020 2020 2a20 7469 6d65 2020 2020        * time    
+000467f0: 2020 2020 2020 2020 2874 696d 6529 2064          (time) d
+00046800: 6174 6574 696d 6536 345b 6e73 5d20 3230  atetime64[ns] 20
+00046810: 3134 2d30 392d 3036 2032 3031 342d 3039  14-09-06 2014-09
+00046820: 2d30 3720 3230 3134 2d30 392d 3038 0a20  -07 2014-09-08. 
+00046830: 2020 2020 2020 2020 2020 2072 6566 6572             refer
+00046840: 656e 6365 5f74 696d 6520 2064 6174 6574  ence_time  datet
+00046850: 696d 6536 345b 6e73 5d20 3230 3134 2d30  ime64[ns] 2014-0
+00046860: 392d 3035 0a20 2020 2020 2020 2044 696d  9-05.        Dim
+00046870: 656e 7369 6f6e 7320 7769 7468 6f75 7420  ensions without 
+00046880: 636f 6f72 6469 6e61 7465 733a 2078 2c20  coordinates: x, 
+00046890: 790a 2020 2020 2020 2020 4461 7461 2076  y.        Data v
+000468a0: 6172 6961 626c 6573 3a0a 2020 2020 2020  ariables:.      
+000468b0: 2020 2020 2020 7072 6563 6970 6974 6174        precipitat
+000468c0: 696f 6e20 2020 2878 2c20 792c 2074 696d  ion   (x, y, tim
+000468d0: 6529 2066 6c6f 6174 3634 2035 2e36 3820  e) float64 5.68 
+000468e0: 392e 3235 3620 302e 3731 3034 202e 2e2e  9.256 0.7104 ...
+000468f0: 2037 2e39 3932 2034 2e36 3135 2037 2e38   7.992 4.615 7.8
+00046900: 3035 0a0a 2020 2020 2020 2020 4765 7420  05..        Get 
+00046910: 616c 6c20 7661 7269 6162 6c65 7320 7468  all variables th
+00046920: 6174 2068 6176 6520 6120 7374 616e 6461  at have a standa
+00046930: 7264 5f6e 616d 6520 6174 7472 6962 7574  rd_name attribut
+00046940: 653a 0a0a 2020 2020 2020 2020 3e3e 3e20  e:..        >>> 
+00046950: 7374 616e 6461 7264 5f6e 616d 6520 3d20  standard_name = 
+00046960: 6c61 6d62 6461 2076 3a20 7620 6973 206e  lambda v: v is n
+00046970: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+00046980: 3e3e 3e20 6473 2e66 696c 7465 725f 6279  >>> ds.filter_by
+00046990: 5f61 7474 7273 2873 7461 6e64 6172 645f  _attrs(standard_
+000469a0: 6e61 6d65 3d73 7461 6e64 6172 645f 6e61  name=standard_na
+000469b0: 6d65 290a 2020 2020 2020 2020 3c78 6172  me).        <xar
+000469c0: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+000469d0: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+000469e0: 2020 2020 2020 2020 2028 783a 2032 2c20           (x: 2, 
+000469f0: 793a 2032 2c20 7469 6d65 3a20 3329 0a20  y: 2, time: 3). 
+00046a00: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
+00046a10: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00046a20: 6c6f 6e20 2020 2020 2020 2020 2020 2020  lon             
+00046a30: 2878 2c20 7929 2066 6c6f 6174 3634 202d  (x, y) float64 -
+00046a40: 3939 2e38 3320 2d39 392e 3332 202d 3939  99.83 -99.32 -99
+00046a50: 2e37 3920 2d39 392e 3233 0a20 2020 2020  .79 -99.23.     
+00046a60: 2020 2020 2020 206c 6174 2020 2020 2020         lat      
+00046a70: 2020 2020 2020 2028 782c 2079 2920 666c         (x, y) fl
+00046a80: 6f61 7436 3420 3432 2e32 3520 3432 2e32  oat64 42.25 42.2
+00046a90: 3120 3432 2e36 3320 3432 2e35 390a 2020  1 42.63 42.59.  
+00046aa0: 2020 2020 2020 2020 2a20 7469 6d65 2020          * time  
+00046ab0: 2020 2020 2020 2020 2020 2874 696d 6529            (time)
+00046ac0: 2064 6174 6574 696d 6536 345b 6e73 5d20   datetime64[ns] 
+00046ad0: 3230 3134 2d30 392d 3036 2032 3031 342d  2014-09-06 2014-
+00046ae0: 3039 2d30 3720 3230 3134 2d30 392d 3038  09-07 2014-09-08
+00046af0: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
+00046b00: 6572 656e 6365 5f74 696d 6520 2064 6174  erence_time  dat
+00046b10: 6574 696d 6536 345b 6e73 5d20 3230 3134  etime64[ns] 2014
+00046b20: 2d30 392d 3035 0a20 2020 2020 2020 2044  -09-05.        D
+00046b30: 696d 656e 7369 6f6e 7320 7769 7468 6f75  imensions withou
+00046b40: 7420 636f 6f72 6469 6e61 7465 733a 2078  t coordinates: x
+00046b50: 2c20 790a 2020 2020 2020 2020 4461 7461  , y.        Data
+00046b60: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+00046b70: 2020 2020 2020 2020 7465 6d70 6572 6174          temperat
+00046b80: 7572 6520 2020 2020 2878 2c20 792c 2074  ure     (x, y, t
+00046b90: 696d 6529 2066 6c6f 6174 3634 2032 392e  ime) float64 29.
+00046ba0: 3131 2031 382e 3220 3232 2e38 3320 2e2e  11 18.2 22.83 ..
+00046bb0: 2e20 3138 2e32 3820 3136 2e31 3520 3236  . 18.28 16.15 26
+00046bc0: 2e36 330a 2020 2020 2020 2020 2020 2020  .63.            
+00046bd0: 7072 6563 6970 6974 6174 696f 6e20 2020  precipitation   
+00046be0: 2878 2c20 792c 2074 696d 6529 2066 6c6f  (x, y, time) flo
+00046bf0: 6174 3634 2035 2e36 3820 392e 3235 3620  at64 5.68 9.256 
+00046c00: 302e 3731 3034 202e 2e2e 2037 2e39 3932  0.7104 ... 7.992
+00046c10: 2034 2e36 3135 2037 2e38 3035 0a0a 2020   4.615 7.805..  
+00046c20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00046c30: 2020 7365 6c65 6374 696f 6e20 3d20 5b5d    selection = []
+00046c40: 0a20 2020 2020 2020 2066 6f72 2076 6172  .        for var
+00046c50: 5f6e 616d 652c 2076 6172 6961 626c 6520  _name, variable 
+00046c60: 696e 2073 656c 662e 7661 7269 6162 6c65  in self.variable
+00046c70: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+00046c80: 2020 2020 2020 2068 6173 5f76 616c 7565         has_value
+00046c90: 5f66 6c61 6720 3d20 4661 6c73 650a 2020  _flag = False.  
+00046ca0: 2020 2020 2020 2020 2020 666f 7220 6174            for at
+00046cb0: 7472 5f6e 616d 652c 2070 6174 7465 726e  tr_name, pattern
+00046cc0: 2069 6e20 6b77 6172 6773 2e69 7465 6d73   in kwargs.items
+00046cd0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00046ce0: 2020 2020 6174 7472 5f76 616c 7565 203d      attr_value =
+00046cf0: 2076 6172 6961 626c 652e 6174 7472 732e   variable.attrs.
+00046d00: 6765 7428 6174 7472 5f6e 616d 6529 0a20  get(attr_name). 
+00046d10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00046d20: 6620 2863 616c 6c61 626c 6528 7061 7474  f (callable(patt
+00046d30: 6572 6e29 2061 6e64 2070 6174 7465 726e  ern) and pattern
+00046d40: 2861 7474 725f 7661 6c75 6529 2920 6f72  (attr_value)) or
+00046d50: 2061 7474 725f 7661 6c75 6520 3d3d 2070   attr_value == p
+00046d60: 6174 7465 726e 3a0a 2020 2020 2020 2020  attern:.        
+00046d70: 2020 2020 2020 2020 2020 2020 6861 735f              has_
+00046d80: 7661 6c75 655f 666c 6167 203d 2054 7275  value_flag = Tru
+00046d90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00046da0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00046db0: 2020 2020 2020 2020 2020 2020 6861 735f              has_
+00046dc0: 7661 6c75 655f 666c 6167 203d 2046 616c  value_flag = Fal
+00046dd0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+00046de0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00046df0: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
+00046e00: 7661 6c75 655f 666c 6167 2069 7320 5472  value_flag is Tr
+00046e10: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+00046e20: 2020 2020 7365 6c65 6374 696f 6e2e 6170      selection.ap
+00046e30: 7065 6e64 2876 6172 5f6e 616d 6529 0a20  pend(var_name). 
+00046e40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00046e50: 6c66 5b73 656c 6563 7469 6f6e 5d0a 0a20  lf[selection].. 
+00046e60: 2020 2064 6566 2075 6e69 6679 5f63 6875     def unify_chu
+00046e70: 6e6b 7328 7365 6c66 3a20 545f 4461 7461  nks(self: T_Data
+00046e80: 7365 7429 202d 3e20 545f 4461 7461 7365  set) -> T_Datase
+00046e90: 743a 0a20 2020 2020 2020 2022 2222 556e  t:.        """Un
+00046ea0: 6966 7920 6368 756e 6b20 7369 7a65 2061  ify chunk size a
+00046eb0: 6c6f 6e67 2061 6c6c 2063 6875 6e6b 6564  long all chunked
+00046ec0: 2064 696d 656e 7369 6f6e 7320 6f66 2074   dimensions of t
+00046ed0: 6869 7320 4461 7461 7365 742e 0a0a 2020  his Dataset...  
+00046ee0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00046ef0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+00046f00: 2020 2020 2020 4461 7461 7365 7420 7769        Dataset wi
+00046f10: 7468 2063 6f6e 7369 7374 656e 7420 6368  th consistent ch
+00046f20: 756e 6b20 7369 7a65 7320 666f 7220 616c  unk sizes for al
+00046f30: 6c20 6461 736b 2d61 7272 6179 2076 6172  l dask-array var
+00046f40: 6961 626c 6573 0a0a 2020 2020 2020 2020  iables..        
+00046f50: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00046f60: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00046f70: 2020 6461 736b 2e61 7272 6179 2e63 6f72    dask.array.cor
+00046f80: 652e 756e 6966 795f 6368 756e 6b73 0a20  e.unify_chunks. 
+00046f90: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00046fa0: 2020 2020 7265 7475 726e 2075 6e69 6679      return unify
+00046fb0: 5f63 6875 6e6b 7328 7365 6c66 295b 305d  _chunks(self)[0]
+00046fc0: 0a0a 2020 2020 6465 6620 6d61 705f 626c  ..    def map_bl
+00046fd0: 6f63 6b73 280a 2020 2020 2020 2020 7365  ocks(.        se
+00046fe0: 6c66 2c0a 2020 2020 2020 2020 6675 6e63  lf,.        func
+00046ff0: 3a20 4361 6c6c 6162 6c65 5b2e 2e2e 2c20  : Callable[..., 
+00047000: 545f 5861 7272 6179 5d2c 0a20 2020 2020  T_Xarray],.     
+00047010: 2020 2061 7267 733a 2053 6571 7565 6e63     args: Sequenc
+00047020: 655b 416e 795d 203d 2028 292c 0a20 2020  e[Any] = (),.   
+00047030: 2020 2020 206b 7761 7267 733a 204d 6170       kwargs: Map
+00047040: 7069 6e67 5b73 7472 2c20 416e 795d 207c  ping[str, Any] |
+00047050: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+00047060: 2020 2020 2020 7465 6d70 6c61 7465 3a20        template: 
+00047070: 4461 7461 4172 7261 7920 7c20 4461 7461  DataArray | Data
+00047080: 7365 7420 7c20 4e6f 6e65 203d 204e 6f6e  set | None = Non
+00047090: 652c 0a20 2020 2029 202d 3e20 545f 5861  e,.    ) -> T_Xa
+000470a0: 7272 6179 3a0a 2020 2020 2020 2020 2222  rray:.        ""
+000470b0: 220a 2020 2020 2020 2020 4170 706c 7920  ".        Apply 
+000470c0: 6120 6675 6e63 7469 6f6e 2074 6f20 6561  a function to ea
+000470d0: 6368 2062 6c6f 636b 206f 6620 7468 6973  ch block of this
+000470e0: 2044 6174 6173 6574 2e0a 0a20 2020 2020   Dataset...     
+000470f0: 2020 202e 2e20 7761 726e 696e 673a 3a0a     .. warning::.
+00047100: 2020 2020 2020 2020 2020 2020 5468 6973              This
+00047110: 206d 6574 686f 6420 6973 2065 7870 6572   method is exper
+00047120: 696d 656e 7461 6c20 616e 6420 6974 7320  imental and its 
+00047130: 7369 676e 6174 7572 6520 6d61 7920 6368  signature may ch
+00047140: 616e 6765 2e0a 0a20 2020 2020 2020 2050  ange...        P
+00047150: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00047160: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00047170: 2020 2020 2066 756e 6320 3a20 6361 6c6c       func : call
+00047180: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
+00047190: 2055 7365 722d 7072 6f76 6964 6564 2066   User-provided f
+000471a0: 756e 6374 696f 6e20 7468 6174 2061 6363  unction that acc
+000471b0: 6570 7473 2061 2044 6174 6173 6574 2061  epts a Dataset a
+000471c0: 7320 6974 7320 6669 7273 740a 2020 2020  s its first.    
+000471d0: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
+000471e0: 722e 2054 6865 2066 756e 6374 696f 6e20  r. The function 
+000471f0: 7769 6c6c 2072 6563 6569 7665 2061 2073  will receive a s
+00047200: 7562 7365 7420 6f72 2027 626c 6f63 6b27  ubset or 'block'
+00047210: 206f 6620 7468 6973 2044 6174 6173 6574   of this Dataset
+00047220: 2028 7365 6520 6265 6c6f 7729 2c0a 2020   (see below),.  
+00047230: 2020 2020 2020 2020 2020 636f 7272 6573            corres
+00047240: 706f 6e64 696e 6720 746f 206f 6e65 2063  ponding to one c
+00047250: 6875 6e6b 2061 6c6f 6e67 2065 6163 6820  hunk along each 
+00047260: 6368 756e 6b65 6420 6469 6d65 6e73 696f  chunked dimensio
+00047270: 6e2e 2060 6066 756e 6360 6020 7769 6c6c  n. ``func`` will
+00047280: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
+00047290: 6578 6563 7574 6564 2061 7320 6060 6675  executed as ``fu
+000472a0: 6e63 2873 7562 7365 745f 6461 7461 7365  nc(subset_datase
+000472b0: 742c 202a 7375 6273 6574 5f61 7267 732c  t, *subset_args,
+000472c0: 202a 2a6b 7761 7267 7329 6060 2e0a 0a20   **kwargs)``... 
+000472d0: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+000472e0: 6675 6e63 7469 6f6e 206d 7573 7420 7265  function must re
+000472f0: 7475 726e 2065 6974 6865 7220 6120 7369  turn either a si
+00047300: 6e67 6c65 2044 6174 6141 7272 6179 206f  ngle DataArray o
+00047310: 7220 6120 7369 6e67 6c65 2044 6174 6173  r a single Datas
+00047320: 6574 2e0a 0a20 2020 2020 2020 2020 2020  et...           
+00047330: 2054 6869 7320 6675 6e63 7469 6f6e 2063   This function c
+00047340: 616e 6e6f 7420 6164 6420 6120 6e65 7720  annot add a new 
+00047350: 6368 756e 6b65 6420 6469 6d65 6e73 696f  chunked dimensio
+00047360: 6e2e 0a20 2020 2020 2020 2061 7267 7320  n..        args 
+00047370: 3a20 7365 7175 656e 6365 0a20 2020 2020  : sequence.     
+00047380: 2020 2020 2020 2050 6173 7365 6420 746f         Passed to
+00047390: 2066 756e 6320 6166 7465 7220 756e 7061   func after unpa
+000473a0: 636b 696e 6720 616e 6420 7375 6273 6574  cking and subset
+000473b0: 7469 6e67 2061 6e79 2078 6172 7261 7920  ting any xarray 
+000473c0: 6f62 6a65 6374 7320 6279 2062 6c6f 636b  objects by block
+000473d0: 732e 0a20 2020 2020 2020 2020 2020 2078  s..            x
+000473e0: 6172 7261 7920 6f62 6a65 6374 7320 696e  array objects in
+000473f0: 2061 7267 7320 6d75 7374 2062 6520 616c   args must be al
+00047400: 6967 6e65 6420 7769 7468 206f 626a 2c20  igned with obj, 
+00047410: 6f74 6865 7277 6973 6520 616e 2065 7272  otherwise an err
+00047420: 6f72 2069 7320 7261 6973 6564 2e0a 2020  or is raised..  
+00047430: 2020 2020 2020 6b77 6172 6773 203a 204d        kwargs : M
+00047440: 6170 7069 6e67 206f 7220 4e6f 6e65 0a20  apping or None. 
+00047450: 2020 2020 2020 2020 2020 2050 6173 7365             Passe
+00047460: 6420 7665 7262 6174 696d 2074 6f20 6675  d verbatim to fu
+00047470: 6e63 2061 6674 6572 2075 6e70 6163 6b69  nc after unpacki
+00047480: 6e67 2e20 7861 7272 6179 206f 626a 6563  ng. xarray objec
+00047490: 7473 2c20 6966 2061 6e79 2c20 7769 6c6c  ts, if any, will
+000474a0: 206e 6f74 2062 650a 2020 2020 2020 2020   not be.        
+000474b0: 2020 2020 7375 6273 6574 2074 6f20 626c      subset to bl
+000474c0: 6f63 6b73 2e20 5061 7373 696e 6720 6461  ocks. Passing da
+000474d0: 736b 2063 6f6c 6c65 6374 696f 6e73 2069  sk collections i
+000474e0: 6e20 6b77 6172 6773 2069 7320 6e6f 7420  n kwargs is not 
+000474f0: 616c 6c6f 7765 642e 0a20 2020 2020 2020  allowed..       
+00047500: 2074 656d 706c 6174 6520 3a20 4461 7461   template : Data
+00047510: 4172 7261 792c 2044 6174 6173 6574 206f  Array, Dataset o
+00047520: 7220 4e6f 6e65 2c20 6f70 7469 6f6e 616c  r None, optional
+00047530: 0a20 2020 2020 2020 2020 2020 2078 6172  .            xar
+00047540: 7261 7920 6f62 6a65 6374 2072 6570 7265  ray object repre
+00047550: 7365 6e74 696e 6720 7468 6520 6669 6e61  senting the fina
+00047560: 6c20 7265 7375 6c74 2061 6674 6572 2063  l result after c
+00047570: 6f6d 7075 7465 2069 7320 6361 6c6c 6564  ompute is called
+00047580: 2e20 4966 206e 6f74 2070 726f 7669 6465  . If not provide
+00047590: 642c 0a20 2020 2020 2020 2020 2020 2074  d,.            t
+000475a0: 6865 2066 756e 6374 696f 6e20 7769 6c6c  he function will
+000475b0: 2062 6520 6669 7273 7420 7275 6e20 6f6e   be first run on
+000475c0: 206d 6f63 6b65 642d 7570 2064 6174 612c   mocked-up data,
+000475d0: 2074 6861 7420 6c6f 6f6b 7320 6c69 6b65   that looks like
+000475e0: 2074 6869 7320 6f62 6a65 6374 2062 7574   this object but
+000475f0: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
+00047600: 2073 697a 6573 2030 2c20 746f 2064 6574   sizes 0, to det
+00047610: 6572 6d69 6e65 2070 726f 7065 7274 6965  ermine propertie
+00047620: 7320 6f66 2074 6865 2072 6574 7572 6e65  s of the returne
+00047630: 6420 6f62 6a65 6374 2073 7563 6820 6173  d object such as
+00047640: 2064 7479 7065 2c0a 2020 2020 2020 2020   dtype,.        
+00047650: 2020 2020 7661 7269 6162 6c65 206e 616d      variable nam
+00047660: 6573 2c20 6174 7472 6962 7574 6573 2c20  es, attributes, 
+00047670: 6e65 7720 6469 6d65 6e73 696f 6e73 2061  new dimensions a
+00047680: 6e64 206e 6577 2069 6e64 6578 6573 2028  nd new indexes (
+00047690: 6966 2061 6e79 292e 0a20 2020 2020 2020  if any)..       
+000476a0: 2020 2020 2060 6074 656d 706c 6174 6560       ``template`
+000476b0: 6020 6d75 7374 2062 6520 7072 6f76 6964  ` must be provid
+000476c0: 6564 2069 6620 7468 6520 6675 6e63 7469  ed if the functi
+000476d0: 6f6e 2063 6861 6e67 6573 2074 6865 2073  on changes the s
+000476e0: 697a 6520 6f66 2065 7869 7374 696e 6720  ize of existing 
+000476f0: 6469 6d65 6e73 696f 6e73 2e0a 2020 2020  dimensions..    
+00047700: 2020 2020 2020 2020 5768 656e 2070 726f          When pro
+00047710: 7669 6465 642c 2060 6061 7474 7273 6060  vided, ``attrs``
+00047720: 206f 6e20 7661 7269 6162 6c65 7320 696e   on variables in
+00047730: 2060 7465 6d70 6c61 7465 6020 6172 6520   `template` are 
+00047740: 636f 7069 6564 206f 7665 7220 746f 2074  copied over to t
+00047750: 6865 2072 6573 756c 742e 2041 6e79 0a20  he result. Any. 
+00047760: 2020 2020 2020 2020 2020 2060 6061 7474             ``att
+00047770: 7273 6060 2073 6574 2062 7920 6060 6675  rs`` set by ``fu
+00047780: 6e63 6060 2077 696c 6c20 6265 2069 676e  nc`` will be ign
+00047790: 6f72 6564 2e0a 0a20 2020 2020 2020 2052  ored...        R
+000477a0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+000477b0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2041  ------.        A
+000477c0: 2073 696e 676c 6520 4461 7461 4172 7261   single DataArra
+000477d0: 7920 6f72 2044 6174 6173 6574 2077 6974  y or Dataset wit
+000477e0: 6820 6461 736b 2062 6163 6b65 6e64 2c20  h dask backend, 
+000477f0: 7265 6173 7365 6d62 6c65 6420 6672 6f6d  reassembled from
+00047800: 2074 6865 206f 7574 7075 7473 206f 6620   the outputs of 
+00047810: 7468 650a 2020 2020 2020 2020 6675 6e63  the.        func
+00047820: 7469 6f6e 2e0a 0a20 2020 2020 2020 204e  tion...        N
+00047830: 6f74 6573 0a20 2020 2020 2020 202d 2d2d  otes.        ---
+00047840: 2d2d 0a20 2020 2020 2020 2054 6869 7320  --.        This 
+00047850: 6675 6e63 7469 6f6e 2069 7320 6465 7369  function is desi
+00047860: 676e 6564 2066 6f72 2077 6865 6e20 6060  gned for when ``
+00047870: 6675 6e63 6060 206e 6565 6473 2074 6f20  func`` needs to 
+00047880: 6d61 6e69 7075 6c61 7465 2061 2077 686f  manipulate a who
+00047890: 6c65 2078 6172 7261 7920 6f62 6a65 6374  le xarray object
+000478a0: 0a20 2020 2020 2020 2073 7562 7365 7420  .        subset 
+000478b0: 746f 2065 6163 6820 626c 6f63 6b2e 2045  to each block. E
+000478c0: 6163 6820 626c 6f63 6b20 6973 206c 6f61  ach block is loa
+000478d0: 6465 6420 696e 746f 206d 656d 6f72 792e  ded into memory.
+000478e0: 2049 6e20 7468 6520 6d6f 7265 2063 6f6d   In the more com
+000478f0: 6d6f 6e20 6361 7365 2077 6865 7265 0a20  mon case where. 
+00047900: 2020 2020 2020 2060 6066 756e 6360 6020         ``func`` 
+00047910: 6361 6e20 776f 726b 206f 6e20 6e75 6d70  can work on nump
+00047920: 7920 6172 7261 7973 2c20 6974 2069 7320  y arrays, it is 
+00047930: 7265 636f 6d6d 656e 6465 6420 746f 2075  recommended to u
+00047940: 7365 2060 6061 7070 6c79 5f75 6675 6e63  se ``apply_ufunc
+00047950: 6060 2e0a 0a20 2020 2020 2020 2049 6620  ``...        If 
+00047960: 6e6f 6e65 206f 6620 7468 6520 7661 7269  none of the vari
+00047970: 6162 6c65 7320 696e 2074 6869 7320 6f62  ables in this ob
+00047980: 6a65 6374 2069 7320 6261 636b 6564 2062  ject is backed b
+00047990: 7920 6461 736b 2061 7272 6179 732c 2063  y dask arrays, c
+000479a0: 616c 6c69 6e67 2074 6869 7320 6675 6e63  alling this func
+000479b0: 7469 6f6e 2069 730a 2020 2020 2020 2020  tion is.        
+000479c0: 6571 7569 7661 6c65 6e74 2074 6f20 6361  equivalent to ca
+000479d0: 6c6c 696e 6720 6060 6675 6e63 286f 626a  lling ``func(obj
+000479e0: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+000479f0: 7329 6060 2e0a 0a20 2020 2020 2020 2053  s)``...        S
+00047a00: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00047a10: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00047a20: 2064 6173 6b2e 6172 7261 792e 6d61 705f   dask.array.map_
+00047a30: 626c 6f63 6b73 2c20 7861 7272 6179 2e61  blocks, xarray.a
+00047a40: 7070 6c79 5f75 6675 6e63 2c20 7861 7272  pply_ufunc, xarr
+00047a50: 6179 2e44 6174 6173 6574 2e6d 6170 5f62  ay.Dataset.map_b
+00047a60: 6c6f 636b 730a 2020 2020 2020 2020 7861  locks.        xa
+00047a70: 7272 6179 2e44 6174 6141 7272 6179 2e6d  rray.DataArray.m
+00047a80: 6170 5f62 6c6f 636b 730a 0a20 2020 2020  ap_blocks..     
+00047a90: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+00047aa0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00047ab0: 2020 2020 2043 616c 6375 6c61 7465 2061       Calculate a
+00047ac0: 6e20 616e 6f6d 616c 7920 6672 6f6d 2063  n anomaly from c
+00047ad0: 6c69 6d61 746f 6c6f 6779 2075 7369 6e67  limatology using
+00047ae0: 2060 602e 6772 6f75 7062 7928 2960 602e   ``.groupby()``.
+00047af0: 2055 7369 6e67 0a20 2020 2020 2020 2060   Using.        `
+00047b00: 6078 722e 6d61 705f 626c 6f63 6b73 2829  `xr.map_blocks()
+00047b10: 6060 2061 6c6c 6f77 7320 666f 7220 7061  `` allows for pa
+00047b20: 7261 6c6c 656c 206f 7065 7261 7469 6f6e  rallel operation
+00047b30: 7320 7769 7468 206b 6e6f 776c 6564 6765  s with knowledge
+00047b40: 206f 6620 6060 7861 7272 6179 6060 2c0a   of ``xarray``,.
+00047b50: 2020 2020 2020 2020 6974 7320 696e 6469          its indi
+00047b60: 6365 732c 2061 6e64 2069 7473 206d 6574  ces, and its met
+00047b70: 686f 6473 206c 696b 6520 6060 2e67 726f  hods like ``.gro
+00047b80: 7570 6279 2829 6060 2e0a 0a20 2020 2020  upby()``...     
+00047b90: 2020 203e 3e3e 2064 6566 2063 616c 6375     >>> def calcu
+00047ba0: 6c61 7465 5f61 6e6f 6d61 6c79 2864 612c  late_anomaly(da,
+00047bb0: 2067 726f 7570 6279 5f74 7970 653d 2274   groupby_type="t
+00047bc0: 696d 652e 6d6f 6e74 6822 293a 0a20 2020  ime.month"):.   
+00047bd0: 2020 2020 202e 2e2e 2020 2020 2067 6220       ...     gb 
+00047be0: 3d20 6461 2e67 726f 7570 6279 2867 726f  = da.groupby(gro
+00047bf0: 7570 6279 5f74 7970 6529 0a20 2020 2020  upby_type).     
+00047c00: 2020 202e 2e2e 2020 2020 2063 6c69 6d20     ...     clim 
+00047c10: 3d20 6762 2e6d 6561 6e28 6469 6d3d 2274  = gb.mean(dim="t
+00047c20: 696d 6522 290a 2020 2020 2020 2020 2e2e  ime").        ..
+00047c30: 2e20 2020 2020 7265 7475 726e 2067 6220  .     return gb 
+00047c40: 2d20 636c 696d 0a20 2020 2020 2020 202e  - clim.        .
+00047c50: 2e2e 0a20 2020 2020 2020 203e 3e3e 2074  ...        >>> t
+00047c60: 696d 6520 3d20 7872 2e63 6674 696d 655f  ime = xr.cftime_
+00047c70: 7261 6e67 6528 2231 3939 302d 3031 222c  range("1990-01",
+00047c80: 2022 3139 3932 2d30 3122 2c20 6672 6571   "1992-01", freq
+00047c90: 3d22 4d22 290a 2020 2020 2020 2020 3e3e  ="M").        >>
+00047ca0: 3e20 6d6f 6e74 6820 3d20 7872 2e44 6174  > month = xr.Dat
+00047cb0: 6141 7272 6179 2874 696d 652e 6d6f 6e74  aArray(time.mont
+00047cc0: 682c 2063 6f6f 7264 733d 7b22 7469 6d65  h, coords={"time
+00047cd0: 223a 2074 696d 657d 2c20 6469 6d73 3d5b  ": time}, dims=[
+00047ce0: 2274 696d 6522 5d29 0a20 2020 2020 2020  "time"]).       
+00047cf0: 203e 3e3e 206e 702e 7261 6e64 6f6d 2e73   >>> np.random.s
+00047d00: 6565 6428 3132 3329 0a20 2020 2020 2020  eed(123).       
+00047d10: 203e 3e3e 2061 7272 6179 203d 2078 722e   >>> array = xr.
+00047d20: 4461 7461 4172 7261 7928 0a20 2020 2020  DataArray(.     
+00047d30: 2020 202e 2e2e 2020 2020 206e 702e 7261     ...     np.ra
+00047d40: 6e64 6f6d 2e72 616e 6428 6c65 6e28 7469  ndom.rand(len(ti
+00047d50: 6d65 2929 2c0a 2020 2020 2020 2020 2e2e  me)),.        ..
+00047d60: 2e20 2020 2020 6469 6d73 3d5b 2274 696d  .     dims=["tim
+00047d70: 6522 5d2c 0a20 2020 2020 2020 202e 2e2e  e"],.        ...
+00047d80: 2020 2020 2063 6f6f 7264 733d 7b22 7469       coords={"ti
+00047d90: 6d65 223a 2074 696d 652c 2022 6d6f 6e74  me": time, "mont
+00047da0: 6822 3a20 6d6f 6e74 687d 2c0a 2020 2020  h": month},.    
+00047db0: 2020 2020 2e2e 2e20 292e 6368 756e 6b28      ... ).chunk(
+00047dc0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+00047dd0: 203d 2078 722e 4461 7461 7365 7428 7b22   = xr.Dataset({"
+00047de0: 6122 3a20 6172 7261 797d 290a 2020 2020  a": array}).    
+00047df0: 2020 2020 3e3e 3e20 6473 2e6d 6170 5f62      >>> ds.map_b
+00047e00: 6c6f 636b 7328 6361 6c63 756c 6174 655f  locks(calculate_
+00047e10: 616e 6f6d 616c 792c 2074 656d 706c 6174  anomaly, templat
+00047e20: 653d 6473 292e 636f 6d70 7574 6528 290a  e=ds).compute().
+00047e30: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+00047e40: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+00047e50: 2044 696d 656e 7369 6f6e 733a 2020 2874   Dimensions:  (t
+00047e60: 696d 653a 2032 3429 0a20 2020 2020 2020  ime: 24).       
+00047e70: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+00047e80: 2020 2020 2020 2020 2a20 7469 6d65 2020          * time  
+00047e90: 2020 2028 7469 6d65 2920 6f62 6a65 6374     (time) object
+00047ea0: 2031 3939 302d 3031 2d33 3120 3030 3a30   1990-01-31 00:0
+00047eb0: 303a 3030 202e 2e2e 2031 3939 312d 3132  0:00 ... 1991-12
+00047ec0: 2d33 3120 3030 3a30 303a 3030 0a20 2020  -31 00:00:00.   
+00047ed0: 2020 2020 2020 2020 206d 6f6e 7468 2020           month  
+00047ee0: 2020 2874 696d 6529 2069 6e74 3634 2031    (time) int64 1
+00047ef0: 2032 2033 2034 2035 2036 2037 2038 2039   2 3 4 5 6 7 8 9
+00047f00: 2031 3020 3131 2031 3220 3120 3220 3320   10 11 12 1 2 3 
+00047f10: 3420 3520 3620 3720 3820 3920 3130 2031  4 5 6 7 8 9 10 1
+00047f20: 3120 3132 0a20 2020 2020 2020 2044 6174  1 12.        Dat
+00047f30: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+00047f40: 2020 2020 2020 2020 2061 2020 2020 2020           a      
+00047f50: 2020 2874 696d 6529 2066 6c6f 6174 3634    (time) float64
+00047f60: 2030 2e31 3238 3920 302e 3131 3332 202d   0.1289 0.1132 -
+00047f70: 302e 3038 3536 202e 2e2e 2030 2e32 3238  0.0856 ... 0.228
+00047f80: 3720 302e 3139 3036 202d 302e 3035 3930  7 0.1906 -0.0590
+00047f90: 310a 0a20 2020 2020 2020 204e 6f74 6520  1..        Note 
+00047fa0: 7468 6174 206f 6e65 206d 7573 7420 6578  that one must ex
+00047fb0: 706c 6963 6974 6c79 2075 7365 2060 6061  plicitly use ``a
+00047fc0: 7267 733d 5b5d 6060 2061 6e64 2060 606b  rgs=[]`` and ``k
+00047fd0: 7761 7267 733d 7b7d 6060 2074 6f20 7061  wargs={}`` to pa
+00047fe0: 7373 2061 7267 756d 656e 7473 0a20 2020  ss arguments.   
+00047ff0: 2020 2020 2074 6f20 7468 6520 6675 6e63       to the func
+00048000: 7469 6f6e 2062 6569 6e67 2061 7070 6c69  tion being appli
+00048010: 6564 2069 6e20 6060 7872 2e6d 6170 5f62  ed in ``xr.map_b
+00048020: 6c6f 636b 7328 2960 603a 0a0a 2020 2020  locks()``:..    
+00048030: 2020 2020 3e3e 3e20 6473 2e6d 6170 5f62      >>> ds.map_b
+00048040: 6c6f 636b 7328 0a20 2020 2020 2020 202e  locks(.        .
+00048050: 2e2e 2020 2020 2063 616c 6375 6c61 7465  ..     calculate
+00048060: 5f61 6e6f 6d61 6c79 2c0a 2020 2020 2020  _anomaly,.      
+00048070: 2020 2e2e 2e20 2020 2020 6b77 6172 6773    ...     kwargs
+00048080: 3d7b 2267 726f 7570 6279 5f74 7970 6522  ={"groupby_type"
+00048090: 3a20 2274 696d 652e 7965 6172 227d 2c0a  : "time.year"},.
+000480a0: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+000480b0: 7465 6d70 6c61 7465 3d64 732c 0a20 2020  template=ds,.   
+000480c0: 2020 2020 202e 2e2e 2029 0a20 2020 2020       ... ).     
+000480d0: 2020 203c 7861 7272 6179 2e44 6174 6173     <xarray.Datas
+000480e0: 6574 3e0a 2020 2020 2020 2020 4469 6d65  et>.        Dime
+000480f0: 6e73 696f 6e73 3a20 2028 7469 6d65 3a20  nsions:  (time: 
+00048100: 3234 290a 2020 2020 2020 2020 436f 6f72  24).        Coor
+00048110: 6469 6e61 7465 733a 0a20 2020 2020 2020  dinates:.       
+00048120: 2020 202a 2074 696d 6520 2020 2020 2874     * time     (t
+00048130: 696d 6529 206f 626a 6563 7420 3139 3930  ime) object 1990
+00048140: 2d30 312d 3331 2030 303a 3030 3a30 3020  -01-31 00:00:00 
+00048150: 2e2e 2e20 3139 3931 2d31 322d 3331 2030  ... 1991-12-31 0
+00048160: 303a 3030 3a30 300a 2020 2020 2020 2020  0:00:00.        
+00048170: 2020 2020 6d6f 6e74 6820 2020 2028 7469      month    (ti
+00048180: 6d65 2920 696e 7436 3420 6461 736b 2e61  me) int64 dask.a
+00048190: 7272 6179 3c63 6875 6e6b 7369 7a65 3d28  rray<chunksize=(
+000481a0: 3234 2c29 2c20 6d65 7461 3d6e 702e 6e64  24,), meta=np.nd
+000481b0: 6172 7261 793e 0a20 2020 2020 2020 2044  array>.        D
+000481c0: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+000481d0: 2020 2020 2020 2020 2020 2061 2020 2020             a    
+000481e0: 2020 2020 2874 696d 6529 2066 6c6f 6174      (time) float
+000481f0: 3634 2064 6173 6b2e 6172 7261 793c 6368  64 dask.array<ch
+00048200: 756e 6b73 697a 653d 2832 342c 292c 206d  unksize=(24,), m
+00048210: 6574 613d 6e70 2e6e 6461 7272 6179 3e0a  eta=np.ndarray>.
+00048220: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00048230: 2020 2020 6672 6f6d 2078 6172 7261 792e      from xarray.
+00048240: 636f 7265 2e70 6172 616c 6c65 6c20 696d  core.parallel im
+00048250: 706f 7274 206d 6170 5f62 6c6f 636b 730a  port map_blocks.
+00048260: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00048270: 6d61 705f 626c 6f63 6b73 2866 756e 632c  map_blocks(func,
+00048280: 2073 656c 662c 2061 7267 732c 206b 7761   self, args, kwa
+00048290: 7267 732c 2074 656d 706c 6174 6529 0a0a  rgs, template)..
+000482a0: 2020 2020 6465 6620 706f 6c79 6669 7428      def polyfit(
+000482b0: 0a20 2020 2020 2020 2073 656c 663a 2054  .        self: T
+000482c0: 5f44 6174 6173 6574 2c0a 2020 2020 2020  _Dataset,.      
+000482d0: 2020 6469 6d3a 2048 6173 6861 626c 652c    dim: Hashable,
+000482e0: 0a20 2020 2020 2020 2064 6567 3a20 696e  .        deg: in
+000482f0: 742c 0a20 2020 2020 2020 2073 6b69 706e  t,.        skipn
+00048300: 613a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  a: bool | None =
+00048310: 204e 6f6e 652c 0a20 2020 2020 2020 2072   None,.        r
+00048320: 636f 6e64 3a20 666c 6f61 7420 7c20 4e6f  cond: float | No
+00048330: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+00048340: 2020 2077 3a20 4861 7368 6162 6c65 207c     w: Hashable |
+00048350: 2041 6e79 203d 204e 6f6e 652c 0a20 2020   Any = None,.   
+00048360: 2020 2020 2066 756c 6c3a 2062 6f6f 6c20       full: bool 
+00048370: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00048380: 2063 6f76 3a20 626f 6f6c 207c 204c 6974   cov: bool | Lit
+00048390: 6572 616c 5b22 756e 7363 616c 6564 225d  eral["unscaled"]
+000483a0: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
+000483b0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+000483c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000483d0: 2020 4c65 6173 7420 7371 7561 7265 7320    Least squares 
+000483e0: 706f 6c79 6e6f 6d69 616c 2066 6974 2e0a  polynomial fit..
+000483f0: 0a20 2020 2020 2020 2054 6869 7320 7265  .        This re
+00048400: 706c 6963 6174 6573 2074 6865 2062 6568  plicates the beh
+00048410: 6176 696f 7572 206f 6620 606e 756d 7079  aviour of `numpy
+00048420: 2e70 6f6c 7966 6974 6020 6275 7420 6469  .polyfit` but di
+00048430: 6666 6572 7320 6279 2073 6b69 7070 696e  ffers by skippin
+00048440: 670a 2020 2020 2020 2020 696e 7661 6c69  g.        invali
+00048450: 6420 7661 6c75 6573 2077 6865 6e20 6073  d values when `s
+00048460: 6b69 706e 6120 3d20 5472 7565 602e 0a0a  kipna = True`...
+00048470: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00048480: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00048490: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6469  -----.        di
+000484a0: 6d20 3a20 6861 7368 6162 6c65 0a20 2020  m : hashable.   
+000484b0: 2020 2020 2020 2020 2043 6f6f 7264 696e           Coordin
+000484c0: 6174 6520 616c 6f6e 6720 7768 6963 6820  ate along which 
+000484d0: 746f 2066 6974 2074 6865 2070 6f6c 796e  to fit the polyn
+000484e0: 6f6d 6961 6c73 2e0a 2020 2020 2020 2020  omials..        
+000484f0: 6465 6720 3a20 696e 740a 2020 2020 2020  deg : int.      
+00048500: 2020 2020 2020 4465 6772 6565 206f 6620        Degree of 
+00048510: 7468 6520 6669 7474 696e 6720 706f 6c79  the fitting poly
+00048520: 6e6f 6d69 616c 2e0a 2020 2020 2020 2020  nomial..        
+00048530: 736b 6970 6e61 203a 2062 6f6f 6c20 6f72  skipna : bool or
+00048540: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
+00048550: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00048560: 7275 652c 2072 656d 6f76 6573 2061 6c6c  rue, removes all
+00048570: 2069 6e76 616c 6964 2076 616c 7565 7320   invalid values 
+00048580: 6265 666f 7265 2066 6974 7469 6e67 2065  before fitting e
+00048590: 6163 6820 3144 2073 6c69 6365 7320 6f66  ach 1D slices of
+000485a0: 2074 6865 2061 7272 6179 2e0a 2020 2020   the array..    
+000485b0: 2020 2020 2020 2020 4465 6661 756c 7420          Default 
+000485c0: 6973 2054 7275 6520 6966 2064 6174 6120  is True if data 
+000485d0: 6973 2073 746f 7265 6420 696e 2061 2064  is stored in a d
+000485e0: 6173 6b2e 6172 7261 7920 6f72 2069 6620  ask.array or if 
+000485f0: 7468 6572 6520 6973 2061 6e79 0a20 2020  there is any.   
+00048600: 2020 2020 2020 2020 2069 6e76 616c 6964           invalid
+00048610: 2076 616c 7565 732c 2046 616c 7365 206f   values, False o
+00048620: 7468 6572 7769 7365 2e0a 2020 2020 2020  therwise..      
+00048630: 2020 7263 6f6e 6420 3a20 666c 6f61 7420    rcond : float 
+00048640: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
+00048650: 6c0a 2020 2020 2020 2020 2020 2020 5265  l.            Re
+00048660: 6c61 7469 7665 2063 6f6e 6469 7469 6f6e  lative condition
+00048670: 206e 756d 6265 7220 746f 2074 6865 2066   number to the f
+00048680: 6974 2e0a 2020 2020 2020 2020 7720 3a20  it..        w : 
+00048690: 6861 7368 6162 6c65 206f 7220 416e 792c  hashable or Any,
+000486a0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+000486b0: 2020 2020 2020 5765 6967 6874 7320 746f        Weights to
+000486c0: 2061 7070 6c79 2074 6f20 7468 6520 792d   apply to the y-
+000486d0: 636f 6f72 6469 6e61 7465 206f 6620 7468  coordinate of th
+000486e0: 6520 7361 6d70 6c65 2070 6f69 6e74 732e  e sample points.
+000486f0: 0a20 2020 2020 2020 2020 2020 2043 616e  .            Can
+00048700: 2062 6520 616e 2061 7272 6179 2d6c 696b   be an array-lik
+00048710: 6520 6f62 6a65 6374 206f 7220 7468 6520  e object or the 
+00048720: 6e61 6d65 206f 6620 6120 636f 6f72 6469  name of a coordi
+00048730: 6e61 7465 2069 6e20 7468 6520 6461 7461  nate in the data
+00048740: 7365 742e 0a20 2020 2020 2020 2066 756c  set..        ful
+00048750: 6c20 3a20 626f 6f6c 2c20 6465 6661 756c  l : bool, defaul
+00048760: 743a 2046 616c 7365 0a20 2020 2020 2020  t: False.       
+00048770: 2020 2020 2057 6865 7468 6572 2074 6f20       Whether to 
+00048780: 7265 7475 726e 2074 6865 2072 6573 6964  return the resid
+00048790: 7561 6c73 2c20 6d61 7472 6978 2072 616e  uals, matrix ran
+000487a0: 6b20 616e 6420 7369 6e67 756c 6172 2076  k and singular v
+000487b0: 616c 7565 7320 696e 2061 6464 6974 696f  alues in additio
+000487c0: 6e0a 2020 2020 2020 2020 2020 2020 746f  n.            to
+000487d0: 2074 6865 2063 6f65 6666 6963 6965 6e74   the coefficient
+000487e0: 732e 0a20 2020 2020 2020 2063 6f76 203a  s..        cov :
+000487f0: 2062 6f6f 6c20 6f72 2022 756e 7363 616c   bool or "unscal
+00048800: 6564 222c 2064 6566 6175 6c74 3a20 4661  ed", default: Fa
+00048810: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00048820: 5768 6574 6865 7220 746f 2072 6574 7572  Whether to retur
+00048830: 6e20 746f 2074 6865 2063 6f76 6172 6961  n to the covaria
+00048840: 6e63 6520 6d61 7472 6978 2069 6e20 6164  nce matrix in ad
+00048850: 6469 7469 6f6e 2074 6f20 7468 6520 636f  dition to the co
+00048860: 6566 6669 6369 656e 7473 2e0a 2020 2020  efficients..    
+00048870: 2020 2020 2020 2020 5468 6520 6d61 7472          The matr
+00048880: 6978 2069 7320 6e6f 7420 7363 616c 6564  ix is not scaled
+00048890: 2069 6620 6063 6f76 3d27 756e 7363 616c   if `cov='unscal
+000488a0: 6564 2760 2e0a 0a20 2020 2020 2020 2052  ed'`...        R
+000488b0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+000488c0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
+000488d0: 6f6c 7966 6974 5f72 6573 756c 7473 203a  olyfit_results :
+000488e0: 2044 6174 6173 6574 0a20 2020 2020 2020   Dataset.       
+000488f0: 2020 2020 2041 2073 696e 676c 6520 6461       A single da
+00048900: 7461 7365 7420 7768 6963 6820 636f 6e74  taset which cont
+00048910: 6169 6e73 2028 666f 7220 6561 6368 2022  ains (for each "
+00048920: 7661 7222 2069 6e20 7468 6520 696e 7075  var" in the inpu
+00048930: 7420 6461 7461 7365 7429 3a0a 0a20 2020  t dataset):..   
+00048940: 2020 2020 2020 2020 205b 7661 725d 5f70           [var]_p
+00048950: 6f6c 7966 6974 5f63 6f65 6666 6963 6965  olyfit_coefficie
+00048960: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
+00048970: 2020 2020 5468 6520 636f 6566 6669 6369      The coeffici
+00048980: 656e 7473 206f 6620 7468 6520 6265 7374  ents of the best
+00048990: 2066 6974 2066 6f72 2065 6163 6820 7661   fit for each va
+000489a0: 7269 6162 6c65 2069 6e20 7468 6973 2064  riable in this d
+000489b0: 6174 6173 6574 2e0a 2020 2020 2020 2020  ataset..        
+000489c0: 2020 2020 5b76 6172 5d5f 706f 6c79 6669      [var]_polyfi
+000489d0: 745f 7265 7369 6475 616c 730a 2020 2020  t_residuals.    
+000489e0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+000489f0: 7265 7369 6475 616c 7320 6f66 2074 6865  residuals of the
+00048a00: 206c 6561 7374 2d73 7175 6172 6520 636f   least-square co
+00048a10: 6d70 7574 6174 696f 6e20 666f 7220 6561  mputation for ea
+00048a20: 6368 2076 6172 6961 626c 6520 286f 6e6c  ch variable (onl
+00048a30: 7920 696e 636c 7564 6564 2069 6620 6066  y included if `f
+00048a40: 756c 6c3d 5472 7565 6029 0a20 2020 2020  ull=True`).     
+00048a50: 2020 2020 2020 2020 2020 2057 6865 6e20             When 
+00048a60: 7468 6520 6d61 7472 6978 2072 616e 6b20  the matrix rank 
+00048a70: 6973 2064 6566 6963 6965 6e74 2c20 6e70  is deficient, np
+00048a80: 2e6e 616e 2069 7320 7265 7475 726e 6564  .nan is returned
+00048a90: 2e0a 2020 2020 2020 2020 2020 2020 5b64  ..            [d
+00048aa0: 696d 5d5f 6d61 7472 6978 5f72 616e 6b0a  im]_matrix_rank.
+00048ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ac0: 5468 6520 6566 6665 6374 6976 6520 7261  The effective ra
+00048ad0: 6e6b 206f 6620 7468 6520 7363 616c 6564  nk of the scaled
+00048ae0: 2056 616e 6465 726d 6f6e 6465 2063 6f65   Vandermonde coe
+00048af0: 6666 6963 6965 6e74 206d 6174 7269 7820  fficient matrix 
+00048b00: 286f 6e6c 7920 696e 636c 7564 6564 2069  (only included i
+00048b10: 6620 6066 756c 6c3d 5472 7565 6029 0a20  f `full=True`). 
+00048b20: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+00048b30: 6865 2072 616e 6b20 6973 2063 6f6d 7075  he rank is compu
+00048b40: 7465 6420 6967 6e6f 7269 6e67 2074 6865  ted ignoring the
+00048b50: 204e 614e 2076 616c 7565 7320 7468 6174   NaN values that
+00048b60: 206d 6967 6874 2062 6520 736b 6970 7065   might be skippe
+00048b70: 642e 0a20 2020 2020 2020 2020 2020 205b  d..            [
+00048b80: 6469 6d5d 5f73 696e 6775 6c61 725f 7661  dim]_singular_va
+00048b90: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
+00048ba0: 2020 2020 2054 6865 2073 696e 6775 6c61       The singula
+00048bb0: 7220 7661 6c75 6573 206f 6620 7468 6520  r values of the 
+00048bc0: 7363 616c 6564 2056 616e 6465 726d 6f6e  scaled Vandermon
+00048bd0: 6465 2063 6f65 6666 6963 6965 6e74 206d  de coefficient m
+00048be0: 6174 7269 7820 286f 6e6c 7920 696e 636c  atrix (only incl
+00048bf0: 7564 6564 2069 6620 6066 756c 6c3d 5472  uded if `full=Tr
+00048c00: 7565 6029 0a20 2020 2020 2020 2020 2020  ue`).           
+00048c10: 205b 7661 725d 5f70 6f6c 7966 6974 5f63   [var]_polyfit_c
+00048c20: 6f76 6172 6961 6e63 650a 2020 2020 2020  ovariance.      
+00048c30: 2020 2020 2020 2020 2020 5468 6520 636f            The co
+00048c40: 7661 7269 616e 6365 206d 6174 7269 7820  variance matrix 
+00048c50: 6f66 2074 6865 2070 6f6c 796e 6f6d 6961  of the polynomia
+00048c60: 6c20 636f 6566 6669 6369 656e 7420 6573  l coefficient es
+00048c70: 7469 6d61 7465 7320 286f 6e6c 7920 696e  timates (only in
+00048c80: 636c 7564 6564 2069 6620 6066 756c 6c3d  cluded if `full=
+00048c90: 4661 6c73 6560 2061 6e64 2060 636f 763d  False` and `cov=
+00048ca0: 5472 7565 6029 0a0a 2020 2020 2020 2020  True`)..        
+00048cb0: 5761 726e 730a 2020 2020 2020 2020 2d2d  Warns.        --
+00048cc0: 2d2d 2d0a 2020 2020 2020 2020 5261 6e6b  ---.        Rank
+00048cd0: 5761 726e 696e 670a 2020 2020 2020 2020  Warning.        
+00048ce0: 2020 2020 5468 6520 7261 6e6b 206f 6620      The rank of 
+00048cf0: 7468 6520 636f 6566 6669 6369 656e 7420  the coefficient 
+00048d00: 6d61 7472 6978 2069 6e20 7468 6520 6c65  matrix in the le
+00048d10: 6173 742d 7371 7561 7265 7320 6669 7420  ast-squares fit 
+00048d20: 6973 2064 6566 6963 6965 6e74 2e0a 2020  is deficient..  
+00048d30: 2020 2020 2020 2020 2020 5468 6520 7761            The wa
+00048d40: 726e 696e 6720 6973 206e 6f74 2072 6169  rning is not rai
+00048d50: 7365 6420 7769 7468 2069 6e2d 6d65 6d6f  sed with in-memo
+00048d60: 7279 2028 6e6f 7420 6461 736b 2920 6461  ry (not dask) da
+00048d70: 7461 2061 6e64 2060 6675 6c6c 3d54 7275  ta and `full=Tru
+00048d80: 6560 2e0a 0a20 2020 2020 2020 2053 6565  e`...        See
+00048d90: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00048da0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206e  ------.        n
+00048db0: 756d 7079 2e70 6f6c 7966 6974 0a20 2020  umpy.polyfit.   
+00048dc0: 2020 2020 206e 756d 7079 2e70 6f6c 7976       numpy.polyv
+00048dd0: 616c 0a20 2020 2020 2020 2078 6172 7261  al.        xarra
+00048de0: 792e 706f 6c79 7661 6c0a 2020 2020 2020  y.polyval.      
+00048df0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00048e00: 6f6d 2078 6172 7261 792e 636f 7265 2e64  om xarray.core.d
+00048e10: 6174 6161 7272 6179 2069 6d70 6f72 7420  ataarray import 
+00048e20: 4461 7461 4172 7261 790a 0a20 2020 2020  DataArray..     
+00048e30: 2020 2076 6172 6961 626c 6573 203d 207b     variables = {
+00048e40: 7d0a 2020 2020 2020 2020 736b 6970 6e61  }.        skipna
+00048e50: 5f64 6120 3d20 736b 6970 6e61 0a0a 2020  _da = skipna..  
+00048e60: 2020 2020 2020 7820 3d20 6765 745f 636c        x = get_cl
+00048e70: 6561 6e5f 696e 7465 7270 5f69 6e64 6578  ean_interp_index
+00048e80: 2873 656c 662c 2064 696d 2c20 7374 7269  (self, dim, stri
+00048e90: 6374 3d46 616c 7365 290a 2020 2020 2020  ct=False).      
+00048ea0: 2020 786e 616d 6520 3d20 6622 7b73 656c    xname = f"{sel
+00048eb0: 665b 6469 6d5d 2e6e 616d 657d 5f22 0a20  f[dim].name}_". 
+00048ec0: 2020 2020 2020 206f 7264 6572 203d 2069         order = i
+00048ed0: 6e74 2864 6567 2920 2b20 310a 2020 2020  nt(deg) + 1.    
+00048ee0: 2020 2020 6c68 7320 3d20 6e70 2e76 616e      lhs = np.van
+00048ef0: 6465 7228 782c 206f 7264 6572 290a 0a20  der(x, order).. 
+00048f00: 2020 2020 2020 2069 6620 7263 6f6e 6420         if rcond 
+00048f10: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00048f20: 2020 2020 2072 636f 6e64 203d 2028 0a20       rcond = (. 
+00048f30: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00048f40: 2e73 6861 7065 5b30 5d20 2a20 6e70 2e63  .shape[0] * np.c
+00048f50: 6f72 652e 6669 6e66 6f28 782e 6474 7970  ore.finfo(x.dtyp
+00048f60: 6529 2e65 7073 2020 2320 7479 7065 3a20  e).eps  # type: 
+00048f70: 6967 6e6f 7265 5b61 7474 722d 6465 6669  ignore[attr-defi
+00048f80: 6e65 645d 0a20 2020 2020 2020 2020 2020  ned].           
+00048f90: 2029 0a0a 2020 2020 2020 2020 2320 5765   )..        # We
+00048fa0: 6967 6874 733a 0a20 2020 2020 2020 2069  ights:.        i
+00048fb0: 6620 7720 6973 206e 6f74 204e 6f6e 653a  f w is not None:
+00048fc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00048fd0: 6973 696e 7374 616e 6365 2877 2c20 4861  isinstance(w, Ha
+00048fe0: 7368 6162 6c65 293a 0a20 2020 2020 2020  shable):.       
+00048ff0: 2020 2020 2020 2020 2077 203d 2073 656c           w = sel
+00049000: 662e 636f 6f72 6473 5b77 5d0a 2020 2020  f.coords[w].    
+00049010: 2020 2020 2020 2020 7720 3d20 6e70 2e61          w = np.a
+00049020: 7361 7272 6179 2877 290a 2020 2020 2020  sarray(w).      
+00049030: 2020 2020 2020 6966 2077 2e6e 6469 6d20        if w.ndim 
+00049040: 213d 2031 3a0a 2020 2020 2020 2020 2020  != 1:.          
+00049050: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+00049060: 4572 726f 7228 2245 7870 6563 7465 6420  Error("Expected 
+00049070: 6120 312d 6420 6172 7261 7920 666f 7220  a 1-d array for 
+00049080: 7765 6967 6874 732e 2229 0a20 2020 2020  weights.").     
+00049090: 2020 2020 2020 2069 6620 772e 7368 6170         if w.shap
+000490a0: 655b 305d 2021 3d20 6c68 732e 7368 6170  e[0] != lhs.shap
+000490b0: 655b 305d 3a0a 2020 2020 2020 2020 2020  e[0]:.          
+000490c0: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+000490d0: 4572 726f 7228 6622 4578 7065 6374 6564  Error(f"Expected
+000490e0: 2077 2061 6e64 207b 6469 6d7d 2074 6f20   w and {dim} to 
+000490f0: 6861 7665 2074 6865 2073 616d 6520 6c65  have the same le
+00049100: 6e67 7468 2229 0a20 2020 2020 2020 2020  ngth").         
+00049110: 2020 206c 6873 202a 3d20 775b 3a2c 206e     lhs *= w[:, n
+00049120: 702e 6e65 7761 7869 735d 0a0a 2020 2020  p.newaxis]..    
+00049130: 2020 2020 2320 5363 616c 696e 670a 2020      # Scaling.  
+00049140: 2020 2020 2020 7363 616c 6520 3d20 6e70        scale = np
+00049150: 2e73 7172 7428 286c 6873 202a 206c 6873  .sqrt((lhs * lhs
+00049160: 292e 7375 6d28 6178 6973 3d30 2929 0a20  ).sum(axis=0)). 
+00049170: 2020 2020 2020 206c 6873 202f 3d20 7363         lhs /= sc
+00049180: 616c 650a 0a20 2020 2020 2020 2064 6567  ale..        deg
+00049190: 7265 655f 6469 6d20 3d20 7574 696c 732e  ree_dim = utils.
+000491a0: 6765 745f 7465 6d70 5f64 696d 6e61 6d65  get_temp_dimname
+000491b0: 2873 656c 662e 6469 6d73 2c20 2264 6567  (self.dims, "deg
+000491c0: 7265 6522 290a 0a20 2020 2020 2020 2072  ree")..        r
+000491d0: 616e 6b20 3d20 6e70 2e6c 696e 616c 672e  ank = np.linalg.
+000491e0: 6d61 7472 6978 5f72 616e 6b28 6c68 7329  matrix_rank(lhs)
+000491f0: 0a0a 2020 2020 2020 2020 6966 2066 756c  ..        if ful
+00049200: 6c3a 0a20 2020 2020 2020 2020 2020 2072  l:.            r
+00049210: 616e 6b20 3d20 4461 7461 4172 7261 7928  ank = DataArray(
+00049220: 7261 6e6b 2c20 6e61 6d65 3d78 6e61 6d65  rank, name=xname
+00049230: 202b 2022 6d61 7472 6978 5f72 616e 6b22   + "matrix_rank"
+00049240: 290a 2020 2020 2020 2020 2020 2020 7661  ).            va
+00049250: 7269 6162 6c65 735b 7261 6e6b 2e6e 616d  riables[rank.nam
+00049260: 655d 203d 2072 616e 6b0a 2020 2020 2020  e] = rank.      
+00049270: 2020 2020 2020 5f73 696e 6720 3d20 6e70        _sing = np
+00049280: 2e6c 696e 616c 672e 7376 6428 6c68 732c  .linalg.svd(lhs,
+00049290: 2063 6f6d 7075 7465 5f75 763d 4661 6c73   compute_uv=Fals
+000492a0: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+000492b0: 696e 6720 3d20 4461 7461 4172 7261 7928  ing = DataArray(
+000492c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000492d0: 205f 7369 6e67 2c0a 2020 2020 2020 2020   _sing,.        
+000492e0: 2020 2020 2020 2020 6469 6d73 3d28 6465          dims=(de
+000492f0: 6772 6565 5f64 696d 2c29 2c0a 2020 2020  gree_dim,),.    
+00049300: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
+00049310: 6473 3d7b 6465 6772 6565 5f64 696d 3a20  ds={degree_dim: 
+00049320: 6e70 2e61 7261 6e67 6528 7261 6e6b 202d  np.arange(rank -
+00049330: 2031 2c20 2d31 2c20 2d31 297d 2c0a 2020   1, -1, -1)},.  
+00049340: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+00049350: 6d65 3d78 6e61 6d65 202b 2022 7369 6e67  me=xname + "sing
+00049360: 756c 6172 5f76 616c 7565 7322 2c0a 2020  ular_values",.  
+00049370: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00049380: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
+00049390: 735b 7369 6e67 2e6e 616d 655d 203d 2073  s[sing.name] = s
+000493a0: 696e 670a 0a20 2020 2020 2020 2066 6f72  ing..        for
+000493b0: 206e 616d 652c 2064 6120 696e 2073 656c   name, da in sel
+000493c0: 662e 6461 7461 5f76 6172 732e 6974 656d  f.data_vars.item
+000493d0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000493e0: 2069 6620 6469 6d20 6e6f 7420 696e 2064   if dim not in d
+000493f0: 612e 6469 6d73 3a0a 2020 2020 2020 2020  a.dims:.        
+00049400: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00049410: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00049420: 2069 735f 6475 636b 5f64 6173 6b5f 6172   is_duck_dask_ar
+00049430: 7261 7928 6461 2e64 6174 6129 2061 6e64  ray(da.data) and
+00049440: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00049450: 2020 2072 616e 6b20 213d 206f 7264 6572     rank != order
+00049460: 206f 7220 6675 6c6c 206f 7220 736b 6970   or full or skip
+00049470: 6e61 2069 7320 4e6f 6e65 0a20 2020 2020  na is None.     
+00049480: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00049490: 2020 2020 2020 2020 2020 2320 4375 7272            # Curr
+000494a0: 656e 7420 616c 676f 7269 7468 6d20 7769  ent algorithm wi
+000494b0: 7468 2064 6173 6b20 616e 6420 736b 6970  th dask and skip
+000494c0: 6e61 3d46 616c 7365 206e 6569 7468 6572  na=False neither
+000494d0: 2073 7570 706f 7274 730a 2020 2020 2020   supports.      
+000494e0: 2020 2020 2020 2020 2020 2320 6465 6669            # defi
+000494f0: 6369 656e 7420 7261 6e6b 7320 6e6f 7220  cient ranks nor 
+00049500: 646f 6573 2069 7420 6f75 7470 7574 2074  does it output t
+00049510: 6865 2022 6675 6c6c 2220 696e 666f 2028  he "full" info (
+00049520: 6973 7375 6520 6461 736b 2f64 6173 6b23  issue dask/dask#
+00049530: 3635 3136 290a 2020 2020 2020 2020 2020  6516).          
+00049540: 2020 2020 2020 736b 6970 6e61 5f64 6120        skipna_da 
+00049550: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00049560: 2020 2065 6c69 6620 736b 6970 6e61 2069     elif skipna i
+00049570: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00049580: 2020 2020 2020 2020 736b 6970 6e61 5f64          skipna_d
+00049590: 6120 3d20 626f 6f6c 286e 702e 616e 7928  a = bool(np.any(
+000495a0: 6461 2e69 736e 756c 6c28 2929 290a 0a20  da.isnull())).. 
+000495b0: 2020 2020 2020 2020 2020 2064 696d 735f             dims_
+000495c0: 746f 5f73 7461 636b 203d 205b 6469 6d6e  to_stack = [dimn
+000495d0: 616d 6520 666f 7220 6469 6d6e 616d 6520  ame for dimname 
+000495e0: 696e 2064 612e 6469 6d73 2069 6620 6469  in da.dims if di
+000495f0: 6d6e 616d 6520 213d 2064 696d 5d0a 2020  mname != dim].  
+00049600: 2020 2020 2020 2020 2020 7374 6163 6b65            stacke
+00049610: 645f 636f 6f72 6473 3a20 6469 6374 5b48  d_coords: dict[H
+00049620: 6173 6861 626c 652c 2044 6174 6141 7272  ashable, DataArr
+00049630: 6179 5d20 3d20 7b7d 0a20 2020 2020 2020  ay] = {}.       
+00049640: 2020 2020 2069 6620 6469 6d73 5f74 6f5f       if dims_to_
+00049650: 7374 6163 6b3a 0a20 2020 2020 2020 2020  stack:.         
+00049660: 2020 2020 2020 2073 7461 636b 6564 5f64         stacked_d
+00049670: 696d 203d 2075 7469 6c73 2e67 6574 5f74  im = utils.get_t
+00049680: 656d 705f 6469 6d6e 616d 6528 6469 6d73  emp_dimname(dims
+00049690: 5f74 6f5f 7374 6163 6b2c 2022 7374 6163  _to_stack, "stac
+000496a0: 6b65 6422 290a 2020 2020 2020 2020 2020  ked").          
+000496b0: 2020 2020 2020 7268 7320 3d20 6461 2e74        rhs = da.t
+000496c0: 7261 6e73 706f 7365 2864 696d 2c20 2a64  ranspose(dim, *d
+000496d0: 696d 735f 746f 5f73 7461 636b 292e 7374  ims_to_stack).st
+000496e0: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
+000496f0: 2020 2020 2020 2020 207b 7374 6163 6b65           {stacke
+00049700: 645f 6469 6d3a 2064 696d 735f 746f 5f73  d_dim: dims_to_s
+00049710: 7461 636b 7d0a 2020 2020 2020 2020 2020  tack}.          
+00049720: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00049730: 2020 2020 2020 2020 7374 6163 6b65 645f          stacked_
+00049740: 636f 6f72 6473 203d 207b 7374 6163 6b65  coords = {stacke
+00049750: 645f 6469 6d3a 2072 6873 5b73 7461 636b  d_dim: rhs[stack
+00049760: 6564 5f64 696d 5d7d 0a20 2020 2020 2020  ed_dim]}.       
+00049770: 2020 2020 2020 2020 2073 6361 6c65 5f64           scale_d
+00049780: 6120 3d20 7363 616c 655b 3a2c 206e 702e  a = scale[:, np.
+00049790: 6e65 7761 7869 735d 0a20 2020 2020 2020  newaxis].       
+000497a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000497b0: 2020 2020 2020 2020 2020 2072 6873 203d             rhs =
+000497c0: 2064 610a 2020 2020 2020 2020 2020 2020   da.            
+000497d0: 2020 2020 7363 616c 655f 6461 203d 2073      scale_da = s
+000497e0: 6361 6c65 0a0a 2020 2020 2020 2020 2020  cale..          
+000497f0: 2020 6966 2077 2069 7320 6e6f 7420 4e6f    if w is not No
+00049800: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00049810: 2020 2020 7268 7320 2a3d 2077 5b3a 2c20      rhs *= w[:, 
+00049820: 6e70 2e6e 6577 6178 6973 5d0a 0a20 2020  np.newaxis]..   
+00049830: 2020 2020 2020 2020 2077 6974 6820 7761           with wa
+00049840: 726e 696e 6773 2e63 6174 6368 5f77 6172  rnings.catch_war
+00049850: 6e69 6e67 7328 293a 0a20 2020 2020 2020  nings():.       
+00049860: 2020 2020 2020 2020 2069 6620 6675 6c6c           if full
+00049870: 3a20 2023 2043 6f70 7920 6e70 2e70 6f6c  :  # Copy np.pol
+00049880: 7966 6974 2062 6568 6176 696f 720a 2020  yfit behavior.  
+00049890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000498a0: 2020 7761 726e 696e 6773 2e73 696d 706c    warnings.simpl
+000498b0: 6566 696c 7465 7228 2269 676e 6f72 6522  efilter("ignore"
+000498c0: 2c20 6e70 2e52 616e 6b57 6172 6e69 6e67  , np.RankWarning
+000498d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000498e0: 2020 656c 7365 3a20 2023 2052 6169 7365    else:  # Raise
+000498f0: 206f 6e6c 7920 6f6e 6365 2070 6572 2076   only once per v
+00049900: 6172 6961 626c 650a 2020 2020 2020 2020  ariable.        
+00049910: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00049920: 696e 6773 2e73 696d 706c 6566 696c 7465  ings.simplefilte
+00049930: 7228 226f 6e63 6522 2c20 6e70 2e52 616e  r("once", np.Ran
+00049940: 6b57 6172 6e69 6e67 290a 0a20 2020 2020  kWarning)..     
+00049950: 2020 2020 2020 2020 2020 2063 6f65 6666             coeff
+00049960: 732c 2072 6573 6964 7561 6c73 203d 2064  s, residuals = d
+00049970: 7563 6b5f 6172 7261 795f 6f70 732e 6c65  uck_array_ops.le
+00049980: 6173 745f 7371 7561 7265 7328 0a20 2020  ast_squares(.   
+00049990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000499a0: 206c 6873 2c20 7268 732e 6461 7461 2c20   lhs, rhs.data, 
+000499b0: 7263 6f6e 643d 7263 6f6e 642c 2073 6b69  rcond=rcond, ski
+000499c0: 706e 613d 736b 6970 6e61 5f64 610a 2020  pna=skipna_da.  
+000499d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000499e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000499f0: 6973 696e 7374 616e 6365 286e 616d 652c  isinstance(name,
+00049a00: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+00049a10: 2020 2020 2020 206e 616d 6520 3d20 6622         name = f"
+00049a20: 7b6e 616d 657d 5f22 0a20 2020 2020 2020  {name}_".       
+00049a30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00049a40: 2020 2020 2020 2020 2020 2023 2054 6875             # Thu
+00049a50: 7320 6120 5265 7072 4f62 6a65 6374 203d  s a ReprObject =
+00049a60: 3e20 706f 6c79 6669 7420 7761 7320 6361  > polyfit was ca
+00049a70: 6c6c 6564 206f 6e20 6120 4461 7461 4172  lled on a DataAr
+00049a80: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
+00049a90: 2020 2020 6e61 6d65 203d 2022 220a 0a20      name = "".. 
+00049aa0: 2020 2020 2020 2020 2020 2063 6f65 6666             coeff
+00049ab0: 7320 3d20 4461 7461 4172 7261 7928 0a20  s = DataArray(. 
+00049ac0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00049ad0: 6f65 6666 7320 2f20 7363 616c 655f 6461  oeffs / scale_da
+00049ae0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00049af0: 2020 6469 6d73 3d5b 6465 6772 6565 5f64    dims=[degree_d
+00049b00: 696d 5d20 2b20 6c69 7374 2873 7461 636b  im] + list(stack
+00049b10: 6564 5f63 6f6f 7264 732e 6b65 7973 2829  ed_coords.keys()
+00049b20: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00049b30: 2020 2063 6f6f 7264 733d 7b64 6567 7265     coords={degre
+00049b40: 655f 6469 6d3a 206e 702e 6172 616e 6765  e_dim: np.arange
+00049b50: 286f 7264 6572 295b 3a3a 2d31 5d2c 202a  (order)[::-1], *
+00049b60: 2a73 7461 636b 6564 5f63 6f6f 7264 737d  *stacked_coords}
+00049b70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00049b80: 2020 6e61 6d65 3d6e 616d 6520 2b20 2270    name=name + "p
+00049b90: 6f6c 7966 6974 5f63 6f65 6666 6963 6965  olyfit_coefficie
+00049ba0: 6e74 7322 2c0a 2020 2020 2020 2020 2020  nts",.          
+00049bb0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00049bc0: 6966 2064 696d 735f 746f 5f73 7461 636b  if dims_to_stack
+00049bd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00049be0: 2020 636f 6566 6673 203d 2063 6f65 6666    coeffs = coeff
+00049bf0: 732e 756e 7374 6163 6b28 7374 6163 6b65  s.unstack(stacke
+00049c00: 645f 6469 6d29 0a20 2020 2020 2020 2020  d_dim).         
+00049c10: 2020 2076 6172 6961 626c 6573 5b63 6f65     variables[coe
+00049c20: 6666 732e 6e61 6d65 5d20 3d20 636f 6566  ffs.name] = coef
+00049c30: 6673 0a0a 2020 2020 2020 2020 2020 2020  fs..            
+00049c40: 6966 2066 756c 6c20 6f72 2028 636f 7620  if full or (cov 
+00049c50: 6973 2054 7275 6529 3a0a 2020 2020 2020  is True):.      
+00049c60: 2020 2020 2020 2020 2020 7265 7369 6475            residu
+00049c70: 616c 7320 3d20 4461 7461 4172 7261 7928  als = DataArray(
+00049c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049c90: 2020 2020 2072 6573 6964 7561 6c73 2069       residuals i
+00049ca0: 6620 6469 6d73 5f74 6f5f 7374 6163 6b20  f dims_to_stack 
+00049cb0: 656c 7365 2072 6573 6964 7561 6c73 2e73  else residuals.s
+00049cc0: 7175 6565 7a65 2829 2c0a 2020 2020 2020  queeze(),.      
+00049cd0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00049ce0: 6d73 3d6c 6973 7428 7374 6163 6b65 645f  ms=list(stacked_
+00049cf0: 636f 6f72 6473 2e6b 6579 7328 2929 2c0a  coords.keys()),.
+00049d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049d10: 2020 2020 636f 6f72 6473 3d73 7461 636b      coords=stack
+00049d20: 6564 5f63 6f6f 7264 732c 0a20 2020 2020  ed_coords,.     
+00049d30: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00049d40: 616d 653d 6e61 6d65 202b 2022 706f 6c79  ame=name + "poly
+00049d50: 6669 745f 7265 7369 6475 616c 7322 2c0a  fit_residuals",.
+00049d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049d70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00049d80: 2020 6966 2064 696d 735f 746f 5f73 7461    if dims_to_sta
+00049d90: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
+00049da0: 2020 2020 2020 2020 7265 7369 6475 616c          residual
+00049db0: 7320 3d20 7265 7369 6475 616c 732e 756e  s = residuals.un
+00049dc0: 7374 6163 6b28 7374 6163 6b65 645f 6469  stack(stacked_di
+00049dd0: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
+00049de0: 2020 2076 6172 6961 626c 6573 5b72 6573     variables[res
+00049df0: 6964 7561 6c73 2e6e 616d 655d 203d 2072  iduals.name] = r
+00049e00: 6573 6964 7561 6c73 0a0a 2020 2020 2020  esiduals..      
+00049e10: 2020 2020 2020 6966 2063 6f76 3a0a 2020        if cov:.  
+00049e20: 2020 2020 2020 2020 2020 2020 2020 5662                Vb
+00049e30: 6173 6520 3d20 6e70 2e6c 696e 616c 672e  ase = np.linalg.
+00049e40: 696e 7628 6e70 2e64 6f74 286c 6873 2e54  inv(np.dot(lhs.T
+00049e50: 2c20 6c68 7329 290a 2020 2020 2020 2020  , lhs)).        
+00049e60: 2020 2020 2020 2020 5662 6173 6520 2f3d          Vbase /=
+00049e70: 206e 702e 6f75 7465 7228 7363 616c 652c   np.outer(scale,
+00049e80: 2073 6361 6c65 290a 2020 2020 2020 2020   scale).        
+00049e90: 2020 2020 2020 2020 6966 2063 6f76 203d          if cov =
+00049ea0: 3d20 2275 6e73 6361 6c65 6422 3a0a 2020  = "unscaled":.  
+00049eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ec0: 2020 6661 6320 3d20 310a 2020 2020 2020    fac = 1.      
+00049ed0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00049ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ef0: 2020 2020 6966 2078 2e73 6861 7065 5b30      if x.shape[0
+00049f00: 5d20 3c3d 206f 7264 6572 3a0a 2020 2020  ] <= order:.    
+00049f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049f20: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00049f30: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00049f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049f50: 2020 2254 6865 206e 756d 6265 7220 6f66    "The number of
+00049f60: 2064 6174 6120 706f 696e 7473 206d 7573   data points mus
+00049f70: 7420 6578 6365 6564 206f 7264 6572 2074  t exceed order t
+00049f80: 6f20 7363 616c 6520 7468 6520 636f 7661  o scale the cova
+00049f90: 7269 616e 6365 206d 6174 7269 782e 220a  riance matrix.".
+00049fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049fb0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00049fc0: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+00049fd0: 6320 3d20 7265 7369 6475 616c 7320 2f20  c = residuals / 
+00049fe0: 2878 2e73 6861 7065 5b30 5d20 2d20 6f72  (x.shape[0] - or
+00049ff0: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0004a000: 2020 2020 2063 6f76 6172 6961 6e63 6520       covariance 
+0004a010: 3d20 4461 7461 4172 7261 7928 5662 6173  = DataArray(Vbas
+0004a020: 652c 2064 696d 733d 2822 636f 765f 6922  e, dims=("cov_i"
+0004a030: 2c20 2263 6f76 5f6a 2229 2920 2a20 6661  , "cov_j")) * fa
+0004a040: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+0004a050: 2020 7661 7269 6162 6c65 735b 6e61 6d65    variables[name
+0004a060: 202b 2022 706f 6c79 6669 745f 636f 7661   + "polyfit_cova
+0004a070: 7269 616e 6365 225d 203d 2063 6f76 6172  riance"] = covar
+0004a080: 6961 6e63 650a 0a20 2020 2020 2020 2072  iance..        r
+0004a090: 6574 7572 6e20 7479 7065 2873 656c 6629  eturn type(self)
+0004a0a0: 2864 6174 615f 7661 7273 3d76 6172 6961  (data_vars=varia
+0004a0b0: 626c 6573 2c20 6174 7472 733d 7365 6c66  bles, attrs=self
+0004a0c0: 2e61 7474 7273 2e63 6f70 7928 2929 0a0a  .attrs.copy())..
+0004a0d0: 2020 2020 6465 6620 7061 6428 0a20 2020      def pad(.   
+0004a0e0: 2020 2020 2073 656c 663a 2054 5f44 6174       self: T_Dat
+0004a0f0: 6173 6574 2c0a 2020 2020 2020 2020 7061  aset,.        pa
+0004a100: 645f 7769 6474 683a 204d 6170 7069 6e67  d_width: Mapping
+0004a110: 5b41 6e79 2c20 696e 7420 7c20 7475 706c  [Any, int | tupl
+0004a120: 655b 696e 742c 2069 6e74 5d5d 207c 204e  e[int, int]] | N
+0004a130: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+0004a140: 2020 2020 6d6f 6465 3a20 5061 644d 6f64      mode: PadMod
+0004a150: 654f 7074 696f 6e73 203d 2022 636f 6e73  eOptions = "cons
+0004a160: 7461 6e74 222c 0a20 2020 2020 2020 2073  tant",.        s
+0004a170: 7461 745f 6c65 6e67 7468 3a20 696e 740a  tat_length: int.
+0004a180: 2020 2020 2020 2020 7c20 7475 706c 655b          | tuple[
+0004a190: 696e 742c 2069 6e74 5d0a 2020 2020 2020  int, int].      
+0004a1a0: 2020 7c20 4d61 7070 696e 675b 416e 792c    | Mapping[Any,
+0004a1b0: 2074 7570 6c65 5b69 6e74 2c20 696e 745d   tuple[int, int]
+0004a1c0: 5d0a 2020 2020 2020 2020 7c20 4e6f 6e65  ].        | None
+0004a1d0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0004a1e0: 2063 6f6e 7374 616e 745f 7661 6c75 6573   constant_values
+0004a1f0: 3a20 280a 2020 2020 2020 2020 2020 2020  : (.            
+0004a200: 666c 6f61 7420 7c20 7475 706c 655b 666c  float | tuple[fl
+0004a210: 6f61 742c 2066 6c6f 6174 5d20 7c20 4d61  oat, float] | Ma
+0004a220: 7070 696e 675b 416e 792c 2074 7570 6c65  pping[Any, tuple
+0004a230: 5b66 6c6f 6174 2c20 666c 6f61 745d 5d20  [float, float]] 
+0004a240: 7c20 4e6f 6e65 0a20 2020 2020 2020 2029  | None.        )
+0004a250: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0004a260: 2065 6e64 5f76 616c 7565 733a 2069 6e74   end_values: int
+0004a270: 207c 2074 7570 6c65 5b69 6e74 2c20 696e   | tuple[int, in
+0004a280: 745d 207c 204d 6170 7069 6e67 5b41 6e79  t] | Mapping[Any
+0004a290: 2c20 7475 706c 655b 696e 742c 2069 6e74  , tuple[int, int
+0004a2a0: 5d5d 207c 204e 6f6e 6520 3d20 4e6f 6e65  ]] | None = None
+0004a2b0: 2c0a 2020 2020 2020 2020 7265 666c 6563  ,.        reflec
+0004a2c0: 745f 7479 7065 3a20 5061 6452 6566 6c65  t_type: PadRefle
+0004a2d0: 6374 4f70 7469 6f6e 7320 3d20 4e6f 6e65  ctOptions = None
+0004a2e0: 2c0a 2020 2020 2020 2020 6b65 6570 5f61  ,.        keep_a
+0004a2f0: 7474 7273 3a20 626f 6f6c 207c 204e 6f6e  ttrs: bool | Non
+0004a300: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0004a310: 2020 2a2a 7061 645f 7769 6474 685f 6b77    **pad_width_kw
+0004a320: 6172 6773 3a20 416e 792c 0a20 2020 2029  args: Any,.    )
+0004a330: 202d 3e20 545f 4461 7461 7365 743a 0a20   -> T_Dataset:. 
+0004a340: 2020 2020 2020 2022 2222 5061 6420 7468         """Pad th
+0004a350: 6973 2064 6174 6173 6574 2061 6c6f 6e67  is dataset along
+0004a360: 206f 6e65 206f 7220 6d6f 7265 2064 696d   one or more dim
+0004a370: 656e 7369 6f6e 732e 0a0a 2020 2020 2020  ensions...      
+0004a380: 2020 2e2e 2077 6172 6e69 6e67 3a3a 0a20    .. warning::. 
+0004a390: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+0004a3a0: 6675 6e63 7469 6f6e 2069 7320 6578 7065  function is expe
+0004a3b0: 7269 6d65 6e74 616c 2061 6e64 2069 7473  rimental and its
+0004a3c0: 2062 6568 6176 696f 7572 2069 7320 6c69   behaviour is li
+0004a3d0: 6b65 6c79 2074 6f20 6368 616e 6765 0a20  kely to change. 
+0004a3e0: 2020 2020 2020 2020 2020 2065 7370 6563             espec
+0004a3f0: 6961 6c6c 7920 7265 6761 7264 696e 6720  ially regarding 
+0004a400: 7061 6464 696e 6720 6f66 2064 696d 656e  padding of dimen
+0004a410: 7369 6f6e 2063 6f6f 7264 696e 6174 6573  sion coordinates
+0004a420: 2028 6f72 2049 6e64 6578 5661 7269 6162   (or IndexVariab
+0004a430: 6c65 7329 2e0a 0a20 2020 2020 2020 2057  les)...        W
+0004a440: 6865 6e20 7573 696e 6720 6f6e 6520 6f66  hen using one of
+0004a450: 2074 6865 206d 6f64 6573 2028 2265 6467   the modes ("edg
+0004a460: 6522 2c20 2272 6566 6c65 6374 222c 2022  e", "reflect", "
+0004a470: 7379 6d6d 6574 7269 6322 2c20 2277 7261  symmetric", "wra
+0004a480: 7022 292c 0a20 2020 2020 2020 2063 6f6f  p"),.        coo
+0004a490: 7264 696e 6174 6573 2077 696c 6c20 6265  rdinates will be
+0004a4a0: 2070 6164 6465 6420 7769 7468 2074 6865   padded with the
+0004a4b0: 2073 616d 6520 6d6f 6465 2c20 6f74 6865   same mode, othe
+0004a4c0: 7277 6973 6520 636f 6f72 6469 6e61 7465  rwise coordinate
+0004a4d0: 730a 2020 2020 2020 2020 6172 6520 7061  s.        are pa
+0004a4e0: 6464 6564 2075 7369 6e67 2074 6865 2022  dded using the "
+0004a4f0: 636f 6e73 7461 6e74 2220 6d6f 6465 2077  constant" mode w
+0004a500: 6974 6820 6669 6c6c 5f76 616c 7565 2064  ith fill_value d
+0004a510: 7479 7065 732e 4e41 2e0a 0a20 2020 2020  types.NA...     
+0004a520: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+0004a530: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0004a540: 0a20 2020 2020 2020 2070 6164 5f77 6964  .        pad_wid
+0004a550: 7468 203a 206d 6170 7069 6e67 206f 6620  th : mapping of 
+0004a560: 6861 7368 6162 6c65 2074 6f20 7475 706c  hashable to tupl
+0004a570: 6520 6f66 2069 6e74 0a20 2020 2020 2020  e of int.       
+0004a580: 2020 2020 204d 6170 7069 6e67 2077 6974       Mapping wit
+0004a590: 6820 7468 6520 666f 726d 206f 6620 7b64  h the form of {d
+0004a5a0: 696d 3a20 2870 6164 5f62 6566 6f72 652c  im: (pad_before,
+0004a5b0: 2070 6164 5f61 6674 6572 297d 0a20 2020   pad_after)}.   
+0004a5c0: 2020 2020 2020 2020 2064 6573 6372 6962           describ
+0004a5d0: 696e 6720 7468 6520 6e75 6d62 6572 206f  ing the number o
+0004a5e0: 6620 7661 6c75 6573 2070 6164 6465 6420  f values padded 
+0004a5f0: 616c 6f6e 6720 6561 6368 2064 696d 656e  along each dimen
+0004a600: 7369 6f6e 2e0a 2020 2020 2020 2020 2020  sion..          
+0004a610: 2020 7b64 696d 3a20 7061 647d 2069 7320    {dim: pad} is 
+0004a620: 6120 7368 6f72 7463 7574 2066 6f72 2070  a shortcut for p
+0004a630: 6164 5f62 6566 6f72 6520 3d20 7061 645f  ad_before = pad_
+0004a640: 6166 7465 7220 3d20 7061 640a 2020 2020  after = pad.    
+0004a650: 2020 2020 6d6f 6465 203a 207b 2263 6f6e      mode : {"con
+0004a660: 7374 616e 7422 2c20 2265 6467 6522 2c20  stant", "edge", 
+0004a670: 226c 696e 6561 725f 7261 6d70 222c 2022  "linear_ramp", "
+0004a680: 6d61 7869 6d75 6d22 2c20 226d 6561 6e22  maximum", "mean"
+0004a690: 2c20 226d 6564 6961 6e22 2c20 5c0a 2020  , "median", \.  
+0004a6a0: 2020 2020 2020 2020 2020 226d 696e 696d            "minim
+0004a6b0: 756d 222c 2022 7265 666c 6563 7422 2c20  um", "reflect", 
+0004a6c0: 2273 796d 6d65 7472 6963 222c 2022 7772  "symmetric", "wr
+0004a6d0: 6170 227d 2c20 6465 6661 756c 743a 2022  ap"}, default: "
+0004a6e0: 636f 6e73 7461 6e74 220a 2020 2020 2020  constant".      
+0004a6f0: 2020 2020 2020 486f 7720 746f 2070 6164        How to pad
+0004a700: 2074 6865 2044 6174 6141 7272 6179 2028   the DataArray (
+0004a710: 7461 6b65 6e20 6672 6f6d 206e 756d 7079  taken from numpy
+0004a720: 2064 6f63 7329 3a0a 0a20 2020 2020 2020   docs):..       
+0004a730: 2020 2020 202d 2022 636f 6e73 7461 6e74       - "constant
+0004a740: 223a 2050 6164 7320 7769 7468 2061 2063  ": Pads with a c
+0004a750: 6f6e 7374 616e 7420 7661 6c75 652e 0a20  onstant value.. 
+0004a760: 2020 2020 2020 2020 2020 202d 2022 6564             - "ed
+0004a770: 6765 223a 2050 6164 7320 7769 7468 2074  ge": Pads with t
+0004a780: 6865 2065 6467 6520 7661 6c75 6573 206f  he edge values o
+0004a790: 6620 6172 7261 792e 0a20 2020 2020 2020  f array..       
+0004a7a0: 2020 2020 202d 2022 6c69 6e65 6172 5f72       - "linear_r
+0004a7b0: 616d 7022 3a20 5061 6473 2077 6974 6820  amp": Pads with 
+0004a7c0: 7468 6520 6c69 6e65 6172 2072 616d 7020  the linear ramp 
+0004a7d0: 6265 7477 6565 6e20 656e 645f 7661 6c75  between end_valu
+0004a7e0: 6520 616e 6420 7468 650a 2020 2020 2020  e and the.      
+0004a7f0: 2020 2020 2020 2020 6172 7261 7920 6564          array ed
+0004a800: 6765 2076 616c 7565 2e0a 2020 2020 2020  ge value..      
+0004a810: 2020 2020 2020 2d20 226d 6178 696d 756d        - "maximum
+0004a820: 223a 2050 6164 7320 7769 7468 2074 6865  ": Pads with the
+0004a830: 206d 6178 696d 756d 2076 616c 7565 206f   maximum value o
+0004a840: 6620 616c 6c20 6f72 2070 6172 7420 6f66  f all or part of
+0004a850: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0004a860: 2020 2076 6563 746f 7220 616c 6f6e 6720     vector along 
+0004a870: 6561 6368 2061 7869 732e 0a20 2020 2020  each axis..     
+0004a880: 2020 2020 2020 202d 2022 6d65 616e 223a         - "mean":
+0004a890: 2050 6164 7320 7769 7468 2074 6865 206d   Pads with the m
+0004a8a0: 6561 6e20 7661 6c75 6520 6f66 2061 6c6c  ean value of all
+0004a8b0: 206f 7220 7061 7274 206f 6620 7468 650a   or part of the.
+0004a8c0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+0004a8d0: 6374 6f72 2061 6c6f 6e67 2065 6163 6820  ctor along each 
+0004a8e0: 6178 6973 2e0a 2020 2020 2020 2020 2020  axis..          
+0004a8f0: 2020 2d20 226d 6564 6961 6e22 3a20 5061    - "median": Pa
+0004a900: 6473 2077 6974 6820 7468 6520 6d65 6469  ds with the medi
+0004a910: 616e 2076 616c 7565 206f 6620 616c 6c20  an value of all 
+0004a920: 6f72 2070 6172 7420 6f66 2074 6865 0a20  or part of the. 
+0004a930: 2020 2020 2020 2020 2020 2020 2076 6563               vec
+0004a940: 746f 7220 616c 6f6e 6720 6561 6368 2061  tor along each a
+0004a950: 7869 732e 0a20 2020 2020 2020 2020 2020  xis..           
+0004a960: 202d 2022 6d69 6e69 6d75 6d22 3a20 5061   - "minimum": Pa
+0004a970: 6473 2077 6974 6820 7468 6520 6d69 6e69  ds with the mini
+0004a980: 6d75 6d20 7661 6c75 6520 6f66 2061 6c6c  mum value of all
+0004a990: 206f 7220 7061 7274 206f 6620 7468 650a   or part of the.
+0004a9a0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+0004a9b0: 6374 6f72 2061 6c6f 6e67 2065 6163 6820  ctor along each 
+0004a9c0: 6178 6973 2e0a 2020 2020 2020 2020 2020  axis..          
+0004a9d0: 2020 2d20 2272 6566 6c65 6374 223a 2050    - "reflect": P
+0004a9e0: 6164 7320 7769 7468 2074 6865 2072 6566  ads with the ref
+0004a9f0: 6c65 6374 696f 6e20 6f66 2074 6865 2076  lection of the v
+0004aa00: 6563 746f 7220 6d69 7272 6f72 6564 206f  ector mirrored o
+0004aa10: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0004aa20: 7468 6520 6669 7273 7420 616e 6420 6c61  the first and la
+0004aa30: 7374 2076 616c 7565 7320 6f66 2074 6865  st values of the
+0004aa40: 2076 6563 746f 7220 616c 6f6e 6720 6561   vector along ea
+0004aa50: 6368 2061 7869 732e 0a20 2020 2020 2020  ch axis..       
+0004aa60: 2020 2020 202d 2022 7379 6d6d 6574 7269       - "symmetri
+0004aa70: 6322 3a20 5061 6473 2077 6974 6820 7468  c": Pads with th
+0004aa80: 6520 7265 666c 6563 7469 6f6e 206f 6620  e reflection of 
+0004aa90: 7468 6520 7665 6374 6f72 206d 6972 726f  the vector mirro
+0004aaa0: 7265 640a 2020 2020 2020 2020 2020 2020  red.            
+0004aab0: 2020 616c 6f6e 6720 7468 6520 6564 6765    along the edge
+0004aac0: 206f 6620 7468 6520 6172 7261 792e 0a20   of the array.. 
+0004aad0: 2020 2020 2020 2020 2020 202d 2022 7772             - "wr
+0004aae0: 6170 223a 2050 6164 7320 7769 7468 2074  ap": Pads with t
+0004aaf0: 6865 2077 7261 7020 6f66 2074 6865 2076  he wrap of the v
+0004ab00: 6563 746f 7220 616c 6f6e 6720 7468 6520  ector along the 
+0004ab10: 6178 6973 2e0a 2020 2020 2020 2020 2020  axis..          
+0004ab20: 2020 2020 5468 6520 6669 7273 7420 7661      The first va
+0004ab30: 6c75 6573 2061 7265 2075 7365 6420 746f  lues are used to
+0004ab40: 2070 6164 2074 6865 2065 6e64 2061 6e64   pad the end and
+0004ab50: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0004ab60: 2020 2065 6e64 2076 616c 7565 7320 6172     end values ar
+0004ab70: 6520 7573 6564 2074 6f20 7061 6420 7468  e used to pad th
+0004ab80: 6520 6265 6769 6e6e 696e 672e 0a0a 2020  e beginning...  
+0004ab90: 2020 2020 2020 7374 6174 5f6c 656e 6774        stat_lengt
+0004aba0: 6820 3a20 696e 742c 2074 7570 6c65 206f  h : int, tuple o
+0004abb0: 7220 6d61 7070 696e 6720 6f66 2068 6173  r mapping of has
+0004abc0: 6861 626c 6520 746f 2074 7570 6c65 2c20  hable to tuple, 
+0004abd0: 6465 6661 756c 743a 204e 6f6e 650a 2020  default: None.  
+0004abe0: 2020 2020 2020 2020 2020 5573 6564 2069            Used i
+0004abf0: 6e20 276d 6178 696d 756d 272c 2027 6d65  n 'maximum', 'me
+0004ac00: 616e 272c 2027 6d65 6469 616e 272c 2061  an', 'median', a
+0004ac10: 6e64 2027 6d69 6e69 6d75 6d27 2e20 204e  nd 'minimum'.  N
+0004ac20: 756d 6265 7220 6f66 0a20 2020 2020 2020  umber of.       
+0004ac30: 2020 2020 2076 616c 7565 7320 6174 2065       values at e
+0004ac40: 6467 6520 6f66 2065 6163 6820 6178 6973  dge of each axis
+0004ac50: 2075 7365 6420 746f 2063 616c 6375 6c61   used to calcula
+0004ac60: 7465 2074 6865 2073 7461 7469 7374 6963  te the statistic
+0004ac70: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
+0004ac80: 2020 2020 7b64 696d 5f31 3a20 2862 6566      {dim_1: (bef
+0004ac90: 6f72 655f 312c 2061 6674 6572 5f31 292c  ore_1, after_1),
+0004aca0: 202e 2e2e 2064 696d 5f4e 3a20 2862 6566   ... dim_N: (bef
+0004acb0: 6f72 655f 4e2c 2061 6674 6572 5f4e 297d  ore_N, after_N)}
+0004acc0: 2075 6e69 7175 650a 2020 2020 2020 2020   unique.        
+0004acd0: 2020 2020 7374 6174 6973 7469 6320 6c65      statistic le
+0004ace0: 6e67 7468 7320 616c 6f6e 6720 6561 6368  ngths along each
+0004acf0: 2064 696d 656e 7369 6f6e 2e0a 2020 2020   dimension..    
+0004ad00: 2020 2020 2020 2020 2828 6265 666f 7265          ((before
+0004ad10: 2c20 6166 7465 7229 2c29 2079 6965 6c64  , after),) yield
+0004ad20: 7320 7361 6d65 2062 6566 6f72 6520 616e  s same before an
+0004ad30: 6420 6166 7465 7220 7374 6174 6973 7469  d after statisti
+0004ad40: 6320 6c65 6e67 7468 730a 2020 2020 2020  c lengths.      
+0004ad50: 2020 2020 2020 666f 7220 6561 6368 2064        for each d
+0004ad60: 696d 656e 7369 6f6e 2e0a 2020 2020 2020  imension..      
+0004ad70: 2020 2020 2020 2873 7461 745f 6c65 6e67        (stat_leng
+0004ad80: 7468 2c29 206f 7220 696e 7420 6973 2061  th,) or int is a
+0004ad90: 2073 686f 7274 6375 7420 666f 7220 6265   shortcut for be
+0004ada0: 666f 7265 203d 2061 6674 6572 203d 2073  fore = after = s
+0004adb0: 7461 7469 7374 6963 0a20 2020 2020 2020  tatistic.       
+0004adc0: 2020 2020 206c 656e 6774 6820 666f 7220       length for 
+0004add0: 616c 6c20 6178 6573 2e0a 2020 2020 2020  all axes..      
+0004ade0: 2020 2020 2020 4465 6661 756c 7420 6973        Default is
+0004adf0: 2060 604e 6f6e 6560 602c 2074 6f20 7573   ``None``, to us
+0004ae00: 6520 7468 6520 656e 7469 7265 2061 7869  e the entire axi
+0004ae10: 732e 0a20 2020 2020 2020 2063 6f6e 7374  s..        const
+0004ae20: 616e 745f 7661 6c75 6573 203a 2073 6361  ant_values : sca
+0004ae30: 6c61 722c 2074 7570 6c65 206f 7220 6d61  lar, tuple or ma
+0004ae40: 7070 696e 6720 6f66 2068 6173 6861 626c  pping of hashabl
+0004ae50: 6520 746f 2074 7570 6c65 2c20 6465 6661  e to tuple, defa
+0004ae60: 756c 743a 2030 0a20 2020 2020 2020 2020  ult: 0.         
+0004ae70: 2020 2055 7365 6420 696e 2027 636f 6e73     Used in 'cons
+0004ae80: 7461 6e74 272e 2020 5468 6520 7661 6c75  tant'.  The valu
+0004ae90: 6573 2074 6f20 7365 7420 7468 6520 7061  es to set the pa
+0004aea0: 6464 6564 2076 616c 7565 7320 666f 7220  dded values for 
+0004aeb0: 6561 6368 0a20 2020 2020 2020 2020 2020  each.           
+0004aec0: 2061 7869 732e 0a20 2020 2020 2020 2020   axis..         
+0004aed0: 2020 2060 607b 6469 6d5f 313a 2028 6265     ``{dim_1: (be
+0004aee0: 666f 7265 5f31 2c20 6166 7465 725f 3129  fore_1, after_1)
+0004aef0: 2c20 2e2e 2e20 6469 6d5f 4e3a 2028 6265  , ... dim_N: (be
+0004af00: 666f 7265 5f4e 2c20 6166 7465 725f 4e29  fore_N, after_N)
+0004af10: 7d60 6020 756e 6971 7565 0a20 2020 2020  }`` unique.     
+0004af20: 2020 2020 2020 2070 6164 2063 6f6e 7374         pad const
+0004af30: 616e 7473 2061 6c6f 6e67 2065 6163 6820  ants along each 
+0004af40: 6469 6d65 6e73 696f 6e2e 0a20 2020 2020  dimension..     
+0004af50: 2020 2020 2020 2060 6028 2862 6566 6f72         ``((befor
+0004af60: 652c 2061 6674 6572 292c 2960 6020 7969  e, after),)`` yi
+0004af70: 656c 6473 2073 616d 6520 6265 666f 7265  elds same before
+0004af80: 2061 6e64 2061 6674 6572 2063 6f6e 7374   and after const
+0004af90: 616e 7473 2066 6f72 2065 6163 680a 2020  ants for each.  
+0004afa0: 2020 2020 2020 2020 2020 6469 6d65 6e73            dimens
+0004afb0: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+0004afc0: 2060 6028 636f 6e73 7461 6e74 2c29 6060   ``(constant,)``
+0004afd0: 206f 7220 6060 636f 6e73 7461 6e74 6060   or ``constant``
+0004afe0: 2069 7320 6120 7368 6f72 7463 7574 2066   is a shortcut f
+0004aff0: 6f72 2060 6062 6566 6f72 6520 3d20 6166  or ``before = af
+0004b000: 7465 7220 3d20 636f 6e73 7461 6e74 6060  ter = constant``
+0004b010: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
+0004b020: 2061 6c6c 2064 696d 656e 7369 6f6e 732e   all dimensions.
+0004b030: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
+0004b040: 6175 6c74 2069 7320 302e 0a20 2020 2020  ault is 0..     
+0004b050: 2020 2065 6e64 5f76 616c 7565 7320 3a20     end_values : 
+0004b060: 7363 616c 6172 2c20 7475 706c 6520 6f72  scalar, tuple or
+0004b070: 206d 6170 7069 6e67 206f 6620 6861 7368   mapping of hash
+0004b080: 6162 6c65 2074 6f20 7475 706c 652c 2064  able to tuple, d
+0004b090: 6566 6175 6c74 3a20 300a 2020 2020 2020  efault: 0.      
+0004b0a0: 2020 2020 2020 5573 6564 2069 6e20 276c        Used in 'l
+0004b0b0: 696e 6561 725f 7261 6d70 272e 2020 5468  inear_ramp'.  Th
+0004b0c0: 6520 7661 6c75 6573 2075 7365 6420 666f  e values used fo
+0004b0d0: 7220 7468 6520 656e 6469 6e67 2076 616c  r the ending val
+0004b0e0: 7565 206f 6620 7468 650a 2020 2020 2020  ue of the.      
+0004b0f0: 2020 2020 2020 6c69 6e65 6172 5f72 616d        linear_ram
+0004b100: 7020 616e 6420 7468 6174 2077 696c 6c20  p and that will 
+0004b110: 666f 726d 2074 6865 2065 6467 6520 6f66  form the edge of
+0004b120: 2074 6865 2070 6164 6465 6420 6172 7261   the padded arra
+0004b130: 792e 0a20 2020 2020 2020 2020 2020 2060  y..            `
+0004b140: 607b 6469 6d5f 313a 2028 6265 666f 7265  `{dim_1: (before
+0004b150: 5f31 2c20 6166 7465 725f 3129 2c20 2e2e  _1, after_1), ..
+0004b160: 2e20 6469 6d5f 4e3a 2028 6265 666f 7265  . dim_N: (before
+0004b170: 5f4e 2c20 6166 7465 725f 4e29 7d60 6020  _N, after_N)}`` 
+0004b180: 756e 6971 7565 0a20 2020 2020 2020 2020  unique.         
+0004b190: 2020 2065 6e64 2076 616c 7565 7320 616c     end values al
+0004b1a0: 6f6e 6720 6561 6368 2064 696d 656e 7369  ong each dimensi
+0004b1b0: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
+0004b1c0: 6060 2828 6265 666f 7265 2c20 6166 7465  ``((before, afte
+0004b1d0: 7229 2c29 6060 2079 6965 6c64 7320 7361  r),)`` yields sa
+0004b1e0: 6d65 2062 6566 6f72 6520 616e 6420 6166  me before and af
+0004b1f0: 7465 7220 656e 6420 7661 6c75 6573 2066  ter end values f
+0004b200: 6f72 2065 6163 680a 2020 2020 2020 2020  or each.        
+0004b210: 2020 2020 6178 6973 2e0a 2020 2020 2020      axis..      
+0004b220: 2020 2020 2020 6060 2863 6f6e 7374 616e        ``(constan
+0004b230: 742c 2960 6020 6f72 2060 6063 6f6e 7374  t,)`` or ``const
+0004b240: 616e 7460 6020 6973 2061 2073 686f 7274  ant`` is a short
+0004b250: 6375 7420 666f 7220 6060 6265 666f 7265  cut for ``before
+0004b260: 203d 2061 6674 6572 203d 2063 6f6e 7374   = after = const
+0004b270: 616e 7460 6020 666f 720a 2020 2020 2020  ant`` for.      
+0004b280: 2020 2020 2020 616c 6c20 6178 6573 2e0a        all axes..
+0004b290: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+0004b2a0: 756c 7420 6973 2030 2e0a 2020 2020 2020  ult is 0..      
+0004b2b0: 2020 7265 666c 6563 745f 7479 7065 203a    reflect_type :
+0004b2c0: 207b 2265 7665 6e22 2c20 226f 6464 222c   {"even", "odd",
+0004b2d0: 204e 6f6e 657d 2c20 6f70 7469 6f6e 616c   None}, optional
+0004b2e0: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
+0004b2f0: 6420 696e 2022 7265 666c 6563 7422 2c20  d in "reflect", 
+0004b300: 616e 6420 2273 796d 6d65 7472 6963 222e  and "symmetric".
+0004b310: 2020 5468 6520 2265 7665 6e22 2073 7479    The "even" sty
+0004b320: 6c65 2069 7320 7468 650a 2020 2020 2020  le is the.      
+0004b330: 2020 2020 2020 6465 6661 756c 7420 7769        default wi
+0004b340: 7468 2061 6e20 756e 616c 7465 7265 6420  th an unaltered 
+0004b350: 7265 666c 6563 7469 6f6e 2061 726f 756e  reflection aroun
+0004b360: 6420 7468 6520 6564 6765 2076 616c 7565  d the edge value
+0004b370: 2e20 2046 6f72 0a20 2020 2020 2020 2020  .  For.         
+0004b380: 2020 2074 6865 2022 6f64 6422 2073 7479     the "odd" sty
+0004b390: 6c65 2c20 7468 6520 6578 7465 6e64 6564  le, the extended
+0004b3a0: 2070 6172 7420 6f66 2074 6865 2061 7272   part of the arr
+0004b3b0: 6179 2069 7320 6372 6561 7465 6420 6279  ay is created by
+0004b3c0: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
+0004b3d0: 7472 6163 7469 6e67 2074 6865 2072 6566  tracting the ref
+0004b3e0: 6c65 6374 6564 2076 616c 7565 7320 6672  lected values fr
+0004b3f0: 6f6d 2074 776f 2074 696d 6573 2074 6865  om two times the
+0004b400: 2065 6467 6520 7661 6c75 652e 0a20 2020   edge value..   
+0004b410: 2020 2020 206b 6565 705f 6174 7472 7320       keep_attrs 
+0004b420: 3a20 626f 6f6c 206f 7220 4e6f 6e65 2c20  : bool or None, 
+0004b430: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0004b440: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+0004b450: 6520 6174 7472 6962 7574 6573 2028 6060  e attributes (``
+0004b460: 6174 7472 7360 6029 2077 696c 6c20 6265  attrs``) will be
+0004b470: 2063 6f70 6965 6420 6672 6f6d 2074 6865   copied from the
+0004b480: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+0004b490: 6769 6e61 6c20 6f62 6a65 6374 2074 6f20  ginal object to 
+0004b4a0: 7468 6520 6e65 7720 6f6e 652e 2049 6620  the new one. If 
+0004b4b0: 4661 6c73 652c 2074 6865 206e 6577 206f  False, the new o
+0004b4c0: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
+0004b4d0: 2020 7769 6c6c 2062 6520 7265 7475 726e    will be return
+0004b4e0: 6564 2077 6974 686f 7574 2061 7474 7269  ed without attri
+0004b4f0: 6275 7465 732e 0a20 2020 2020 2020 202a  butes..        *
+0004b500: 2a70 6164 5f77 6964 7468 5f6b 7761 7267  *pad_width_kwarg
+0004b510: 730a 2020 2020 2020 2020 2020 2020 5468  s.            Th
+0004b520: 6520 6b65 7977 6f72 6420 6172 6775 6d65  e keyword argume
+0004b530: 6e74 7320 666f 726d 206f 6620 6060 7061  nts form of ``pa
+0004b540: 645f 7769 6474 6860 602e 0a20 2020 2020  d_width``..     
+0004b550: 2020 2020 2020 204f 6e65 206f 6620 6060         One of ``
+0004b560: 7061 645f 7769 6474 6860 6020 6f72 2060  pad_width`` or `
+0004b570: 6070 6164 5f77 6964 7468 5f6b 7761 7267  `pad_width_kwarg
+0004b580: 7360 6020 6d75 7374 2062 6520 7072 6f76  s`` must be prov
+0004b590: 6964 6564 2e0a 0a20 2020 2020 2020 2052  ided...        R
+0004b5a0: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+0004b5b0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
+0004b5c0: 6164 6465 6420 3a20 4461 7461 7365 740a  added : Dataset.
+0004b5d0: 2020 2020 2020 2020 2020 2020 4461 7461              Data
+0004b5e0: 7365 7420 7769 7468 2074 6865 2070 6164  set with the pad
+0004b5f0: 6465 6420 636f 6f72 6469 6e61 7465 7320  ded coordinates 
+0004b600: 616e 6420 6461 7461 2e0a 0a20 2020 2020  and data...     
+0004b610: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+0004b620: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0004b630: 2020 2020 2044 6174 6173 6574 2e73 6869       Dataset.shi
+0004b640: 6674 2c20 4461 7461 7365 742e 726f 6c6c  ft, Dataset.roll
+0004b650: 2c20 4461 7461 7365 742e 6266 696c 6c2c  , Dataset.bfill,
+0004b660: 2044 6174 6173 6574 2e66 6669 6c6c 2c20   Dataset.ffill, 
+0004b670: 6e75 6d70 792e 7061 642c 2064 6173 6b2e  numpy.pad, dask.
+0004b680: 6172 7261 792e 7061 640a 0a20 2020 2020  array.pad..     
+0004b690: 2020 204e 6f74 6573 0a20 2020 2020 2020     Notes.       
+0004b6a0: 202d 2d2d 2d2d 0a20 2020 2020 2020 2042   -----.        B
+0004b6b0: 7920 6465 6661 756c 7420 7768 656e 2060  y default when `
+0004b6c0: 606d 6f64 653d 2263 6f6e 7374 616e 7422  `mode="constant"
+0004b6d0: 6060 2061 6e64 2060 6063 6f6e 7374 616e  `` and ``constan
+0004b6e0: 745f 7661 6c75 6573 3d4e 6f6e 6560 602c  t_values=None``,
+0004b6f0: 2069 6e74 6567 6572 2074 7970 6573 2077   integer types w
+0004b700: 696c 6c20 6265 0a20 2020 2020 2020 2070  ill be.        p
+0004b710: 726f 6d6f 7465 6420 746f 2060 6066 6c6f  romoted to ``flo
+0004b720: 6174 6060 2061 6e64 2070 6164 6465 6420  at`` and padded 
+0004b730: 7769 7468 2060 606e 702e 6e61 6e60 602e  with ``np.nan``.
+0004b740: 2054 6f20 6176 6f69 6420 7479 7065 2070   To avoid type p
+0004b750: 726f 6d6f 7469 6f6e 0a20 2020 2020 2020  romotion.       
+0004b760: 2073 7065 6369 6679 2060 6063 6f6e 7374   specify ``const
+0004b770: 616e 745f 7661 6c75 6573 3d6e 702e 6e61  ant_values=np.na
+0004b780: 6e60 600a 0a20 2020 2020 2020 2050 6164  n``..        Pad
+0004b790: 6469 6e67 2063 6f6f 7264 696e 6174 6573  ding coordinates
+0004b7a0: 2077 696c 6c20 6472 6f70 2074 6865 6972   will drop their
+0004b7b0: 2063 6f72 7265 7370 6f6e 6469 6e67 2069   corresponding i
+0004b7c0: 6e64 6578 2028 6966 2061 6e79 2920 616e  ndex (if any) an
+0004b7d0: 6420 7769 6c6c 2072 6573 6574 2064 6566  d will reset def
+0004b7e0: 6175 6c74 0a20 2020 2020 2020 2069 6e64  ault.        ind
+0004b7f0: 6578 6573 2066 6f72 2064 696d 656e 7369  exes for dimensi
+0004b800: 6f6e 2063 6f6f 7264 696e 6174 6573 2e0a  on coordinates..
+0004b810: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
+0004b820: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0004b830: 2d2d 0a20 2020 2020 2020 203e 3e3e 2064  --.        >>> d
+0004b840: 7320 3d20 7872 2e44 6174 6173 6574 287b  s = xr.Dataset({
+0004b850: 2266 6f6f 223a 2028 2278 222c 2072 616e  "foo": ("x", ran
+0004b860: 6765 2835 2929 7d29 0a20 2020 2020 2020  ge(5))}).       
+0004b870: 203e 3e3e 2064 732e 7061 6428 783d 2831   >>> ds.pad(x=(1
+0004b880: 2c20 3229 290a 2020 2020 2020 2020 3c78  , 2)).        <x
+0004b890: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+0004b8a0: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+0004b8b0: 733a 2020 2878 3a20 3829 0a20 2020 2020  s:  (x: 8).     
+0004b8c0: 2020 2044 696d 656e 7369 6f6e 7320 7769     Dimensions wi
+0004b8d0: 7468 6f75 7420 636f 6f72 6469 6e61 7465  thout coordinate
+0004b8e0: 733a 2078 0a20 2020 2020 2020 2044 6174  s: x.        Dat
+0004b8f0: 6120 7661 7269 6162 6c65 733a 0a20 2020  a variables:.   
+0004b900: 2020 2020 2020 2020 2066 6f6f 2020 2020           foo    
+0004b910: 2020 2878 2920 666c 6f61 7436 3420 6e61    (x) float64 na
+0004b920: 6e20 302e 3020 312e 3020 322e 3020 332e  n 0.0 1.0 2.0 3.
+0004b930: 3020 342e 3020 6e61 6e20 6e61 6e0a 2020  0 4.0 nan nan.  
+0004b940: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0004b950: 2020 7061 645f 7769 6474 6820 3d20 6569    pad_width = ei
+0004b960: 7468 6572 5f64 6963 745f 6f72 5f6b 7761  ther_dict_or_kwa
+0004b970: 7267 7328 7061 645f 7769 6474 682c 2070  rgs(pad_width, p
+0004b980: 6164 5f77 6964 7468 5f6b 7761 7267 732c  ad_width_kwargs,
+0004b990: 2022 7061 6422 290a 0a20 2020 2020 2020   "pad")..       
+0004b9a0: 2069 6620 6d6f 6465 2069 6e20 2822 6564   if mode in ("ed
+0004b9b0: 6765 222c 2022 7265 666c 6563 7422 2c20  ge", "reflect", 
+0004b9c0: 2273 796d 6d65 7472 6963 222c 2022 7772  "symmetric", "wr
+0004b9d0: 6170 2229 3a0a 2020 2020 2020 2020 2020  ap"):.          
+0004b9e0: 2020 636f 6f72 645f 7061 645f 6d6f 6465    coord_pad_mode
+0004b9f0: 203d 206d 6f64 650a 2020 2020 2020 2020   = mode.        
+0004ba00: 2020 2020 636f 6f72 645f 7061 645f 6f70      coord_pad_op
+0004ba10: 7469 6f6e 7320 3d20 7b0a 2020 2020 2020  tions = {.      
+0004ba20: 2020 2020 2020 2020 2020 2273 7461 745f            "stat_
+0004ba30: 6c65 6e67 7468 223a 2073 7461 745f 6c65  length": stat_le
+0004ba40: 6e67 7468 2c0a 2020 2020 2020 2020 2020  ngth,.          
+0004ba50: 2020 2020 2020 2263 6f6e 7374 616e 745f        "constant_
+0004ba60: 7661 6c75 6573 223a 2063 6f6e 7374 616e  values": constan
+0004ba70: 745f 7661 6c75 6573 2c0a 2020 2020 2020  t_values,.      
+0004ba80: 2020 2020 2020 2020 2020 2265 6e64 5f76            "end_v
+0004ba90: 616c 7565 7322 3a20 656e 645f 7661 6c75  alues": end_valu
+0004baa0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0004bab0: 2020 2020 2272 6566 6c65 6374 5f74 7970      "reflect_typ
+0004bac0: 6522 3a20 7265 666c 6563 745f 7479 7065  e": reflect_type
+0004bad0: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
+0004bae0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004baf0: 2020 2020 2020 2020 2020 636f 6f72 645f            coord_
+0004bb00: 7061 645f 6d6f 6465 203d 2022 636f 6e73  pad_mode = "cons
+0004bb10: 7461 6e74 220a 2020 2020 2020 2020 2020  tant".          
+0004bb20: 2020 636f 6f72 645f 7061 645f 6f70 7469    coord_pad_opti
+0004bb30: 6f6e 7320 3d20 7b7d 0a0a 2020 2020 2020  ons = {}..      
+0004bb40: 2020 6966 206b 6565 705f 6174 7472 7320    if keep_attrs 
+0004bb50: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0004bb60: 2020 2020 206b 6565 705f 6174 7472 7320       keep_attrs 
+0004bb70: 3d20 5f67 6574 5f6b 6565 705f 6174 7472  = _get_keep_attr
+0004bb80: 7328 6465 6661 756c 743d 5472 7565 290a  s(default=True).
+0004bb90: 0a20 2020 2020 2020 2076 6172 6961 626c  .        variabl
+0004bba0: 6573 203d 207b 7d0a 0a20 2020 2020 2020  es = {}..       
+0004bbb0: 2023 206b 6565 7020 696e 6465 7865 7320   # keep indexes 
+0004bbc0: 7468 6174 2077 6f6e 2774 2062 6520 6166  that won't be af
+0004bbd0: 6665 6374 6564 2062 7920 7061 6420 616e  fected by pad an
+0004bbe0: 6420 6472 6f70 2061 6c6c 206f 7468 6572  d drop all other
+0004bbf0: 2069 6e64 6578 6573 0a20 2020 2020 2020   indexes.       
+0004bc00: 2078 696e 6465 7865 7320 3d20 7365 6c66   xindexes = self
+0004bc10: 2e78 696e 6465 7865 730a 2020 2020 2020  .xindexes.      
+0004bc20: 2020 7061 645f 6469 6d73 203d 2073 6574    pad_dims = set
+0004bc30: 2870 6164 5f77 6964 7468 290a 2020 2020  (pad_width).    
+0004bc40: 2020 2020 696e 6465 7865 7320 3d20 7b7d      indexes = {}
+0004bc50: 0a20 2020 2020 2020 2066 6f72 206b 2c20  .        for k, 
+0004bc60: 6964 7820 696e 2078 696e 6465 7865 732e  idx in xindexes.
+0004bc70: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0004bc80: 2020 2020 2069 6620 6e6f 7420 7061 645f       if not pad_
+0004bc90: 6469 6d73 2e69 6e74 6572 7365 6374 696f  dims.intersectio
+0004bca0: 6e28 7869 6e64 6578 6573 2e67 6574 5f61  n(xindexes.get_a
+0004bcb0: 6c6c 5f64 696d 7328 6b29 293a 0a20 2020  ll_dims(k)):.   
+0004bcc0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+0004bcd0: 6578 6573 5b6b 5d20 3d20 6964 780a 0a20  exes[k] = idx.. 
+0004bce0: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
+0004bcf0: 2076 6172 2069 6e20 7365 6c66 2e76 6172   var in self.var
+0004bd00: 6961 626c 6573 2e69 7465 6d73 2829 3a0a  iables.items():.
+0004bd10: 2020 2020 2020 2020 2020 2020 7661 725f              var_
+0004bd20: 7061 645f 7769 6474 6820 3d20 7b6b 3a20  pad_width = {k: 
+0004bd30: 7620 666f 7220 6b2c 2076 2069 6e20 7061  v for k, v in pa
+0004bd40: 645f 7769 6474 682e 6974 656d 7328 2920  d_width.items() 
+0004bd50: 6966 206b 2069 6e20 7661 722e 6469 6d73  if k in var.dims
+0004bd60: 7d0a 2020 2020 2020 2020 2020 2020 6966  }.            if
+0004bd70: 206e 6f74 2076 6172 5f70 6164 5f77 6964   not var_pad_wid
+0004bd80: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
+0004bd90: 2020 2020 7661 7269 6162 6c65 735b 6e61      variables[na
+0004bda0: 6d65 5d20 3d20 7661 720a 2020 2020 2020  me] = var.      
+0004bdb0: 2020 2020 2020 656c 6966 206e 616d 6520        elif name 
+0004bdc0: 696e 2073 656c 662e 6461 7461 5f76 6172  in self.data_var
+0004bdd0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0004bde0: 2020 2076 6172 6961 626c 6573 5b6e 616d     variables[nam
+0004bdf0: 655d 203d 2076 6172 2e70 6164 280a 2020  e] = var.pad(.  
+0004be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be10: 2020 7061 645f 7769 6474 683d 7661 725f    pad_width=var_
+0004be20: 7061 645f 7769 6474 682c 0a20 2020 2020  pad_width,.     
+0004be30: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0004be40: 6f64 653d 6d6f 6465 2c0a 2020 2020 2020  ode=mode,.      
+0004be50: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0004be60: 6174 5f6c 656e 6774 683d 7374 6174 5f6c  at_length=stat_l
+0004be70: 656e 6774 682c 0a20 2020 2020 2020 2020  ength,.         
+0004be80: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
+0004be90: 616e 745f 7661 6c75 6573 3d63 6f6e 7374  ant_values=const
+0004bea0: 616e 745f 7661 6c75 6573 2c0a 2020 2020  ant_values,.    
+0004beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bec0: 656e 645f 7661 6c75 6573 3d65 6e64 5f76  end_values=end_v
+0004bed0: 616c 7565 732c 0a20 2020 2020 2020 2020  alues,.         
+0004bee0: 2020 2020 2020 2020 2020 2072 6566 6c65             refle
+0004bef0: 6374 5f74 7970 653d 7265 666c 6563 745f  ct_type=reflect_
+0004bf00: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+0004bf10: 2020 2020 2020 2020 2020 6b65 6570 5f61            keep_a
+0004bf20: 7474 7273 3d6b 6565 705f 6174 7472 732c  ttrs=keep_attrs,
+0004bf30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004bf40: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
+0004bf50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0004bf60: 2020 2020 2076 6172 6961 626c 6573 5b6e       variables[n
+0004bf70: 616d 655d 203d 2076 6172 2e70 6164 280a  ame] = var.pad(.
+0004bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bf90: 2020 2020 7061 645f 7769 6474 683d 7661      pad_width=va
+0004bfa0: 725f 7061 645f 7769 6474 682c 0a20 2020  r_pad_width,.   
+0004bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bfc0: 206d 6f64 653d 636f 6f72 645f 7061 645f   mode=coord_pad_
+0004bfd0: 6d6f 6465 2c0a 2020 2020 2020 2020 2020  mode,.          
+0004bfe0: 2020 2020 2020 2020 2020 6b65 6570 5f61            keep_a
+0004bff0: 7474 7273 3d6b 6565 705f 6174 7472 732c  ttrs=keep_attrs,
+0004c000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c010: 2020 2020 202a 2a63 6f6f 7264 5f70 6164       **coord_pad
+0004c020: 5f6f 7074 696f 6e73 2c20 2023 2074 7970  _options,  # typ
+0004c030: 653a 2069 676e 6f72 655b 6172 672d 7479  e: ignore[arg-ty
+0004c040: 7065 5d0a 2020 2020 2020 2020 2020 2020  pe].            
+0004c050: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0004c060: 2020 2020 2020 2320 7265 7365 7420 6465        # reset de
+0004c070: 6661 756c 7420 696e 6465 7820 6f66 2064  fault index of d
+0004c080: 696d 656e 7369 6f6e 2063 6f6f 7264 696e  imension coordin
+0004c090: 6174 6573 0a20 2020 2020 2020 2020 2020  ates.           
+0004c0a0: 2020 2020 2069 6620 286e 616d 652c 2920       if (name,) 
+0004c0b0: 3d3d 2076 6172 2e64 696d 733a 0a20 2020  == var.dims:.   
+0004c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c0d0: 2064 696d 5f76 6172 203d 207b 6e61 6d65   dim_var = {name
+0004c0e0: 3a20 7661 7269 6162 6c65 735b 6e61 6d65  : variables[name
+0004c0f0: 5d7d 0a20 2020 2020 2020 2020 2020 2020  ]}.             
+0004c100: 2020 2020 2020 2069 6e64 6578 203d 2050         index = P
+0004c110: 616e 6461 7349 6e64 6578 2e66 726f 6d5f  andasIndex.from_
+0004c120: 7661 7269 6162 6c65 7328 6469 6d5f 7661  variables(dim_va
+0004c130: 722c 206f 7074 696f 6e73 3d7b 7d29 0a20  r, options={}). 
+0004c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c150: 2020 2069 6e64 6578 5f76 6172 7320 3d20     index_vars = 
+0004c160: 696e 6465 782e 6372 6561 7465 5f76 6172  index.create_var
+0004c170: 6961 626c 6573 2864 696d 5f76 6172 290a  iables(dim_var).
+0004c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c190: 2020 2020 696e 6465 7865 735b 6e61 6d65      indexes[name
+0004c1a0: 5d20 3d20 696e 6465 780a 2020 2020 2020  ] = index.      
+0004c1b0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0004c1c0: 7269 6162 6c65 735b 6e61 6d65 5d20 3d20  riables[name] = 
+0004c1d0: 696e 6465 785f 7661 7273 5b6e 616d 655d  index_vars[name]
+0004c1e0: 0a0a 2020 2020 2020 2020 6174 7472 7320  ..        attrs 
+0004c1f0: 3d20 7365 6c66 2e5f 6174 7472 7320 6966  = self._attrs if
+0004c200: 206b 6565 705f 6174 7472 7320 656c 7365   keep_attrs else
+0004c210: 204e 6f6e 650a 2020 2020 2020 2020 7265   None.        re
+0004c220: 7475 726e 2073 656c 662e 5f72 6570 6c61  turn self._repla
+0004c230: 6365 5f77 6974 685f 6e65 775f 6469 6d73  ce_with_new_dims
+0004c240: 2876 6172 6961 626c 6573 2c20 696e 6465  (variables, inde
+0004c250: 7865 733d 696e 6465 7865 732c 2061 7474  xes=indexes, att
+0004c260: 7273 3d61 7474 7273 290a 0a20 2020 2064  rs=attrs)..    d
+0004c270: 6566 2069 6478 6d69 6e28 0a20 2020 2020  ef idxmin(.     
+0004c280: 2020 2073 656c 663a 2054 5f44 6174 6173     self: T_Datas
+0004c290: 6574 2c0a 2020 2020 2020 2020 6469 6d3a  et,.        dim:
+0004c2a0: 2048 6173 6861 626c 6520 7c20 4e6f 6e65   Hashable | None
+0004c2b0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0004c2c0: 2073 6b69 706e 613a 2062 6f6f 6c20 7c20   skipna: bool | 
+0004c2d0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+0004c2e0: 2020 2020 2066 696c 6c5f 7661 6c75 653a       fill_value:
+0004c2f0: 2041 6e79 203d 2078 7264 7479 7065 732e   Any = xrdtypes.
+0004c300: 4e41 2c0a 2020 2020 2020 2020 6b65 6570  NA,.        keep
+0004c310: 5f61 7474 7273 3a20 626f 6f6c 207c 204e  _attrs: bool | N
+0004c320: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+0004c330: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+0004c340: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+0004c350: 6e20 7468 6520 636f 6f72 6469 6e61 7465  n the coordinate
+0004c360: 206c 6162 656c 206f 6620 7468 6520 6d69   label of the mi
+0004c370: 6e69 6d75 6d20 7661 6c75 6520 616c 6f6e  nimum value alon
+0004c380: 6720 6120 6469 6d65 6e73 696f 6e2e 0a0a  g a dimension...
+0004c390: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+0004c3a0: 6120 6e65 7720 6044 6174 6173 6574 6020  a new `Dataset` 
+0004c3b0: 6e61 6d65 6420 6166 7465 7220 7468 6520  named after the 
+0004c3c0: 6469 6d65 6e73 696f 6e20 7769 7468 2074  dimension with t
+0004c3d0: 6865 2076 616c 7565 7320 6f66 0a20 2020  he values of.   
+0004c3e0: 2020 2020 2074 6865 2063 6f6f 7264 696e       the coordin
+0004c3f0: 6174 6520 6c61 6265 6c73 2061 6c6f 6e67  ate labels along
+0004c400: 2074 6861 7420 6469 6d65 6e73 696f 6e20   that dimension 
+0004c410: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
+0004c420: 206d 696e 696d 756d 0a20 2020 2020 2020   minimum.       
+0004c430: 2076 616c 7565 7320 616c 6f6e 6720 7468   values along th
+0004c440: 6174 2064 696d 656e 7369 6f6e 2e0a 0a20  at dimension... 
+0004c450: 2020 2020 2020 2049 6e20 636f 6d70 6172         In compar
+0004c460: 6973 6f6e 2074 6f20 3a70 793a 6d65 7468  ison to :py:meth
+0004c470: 3a60 7e44 6174 6173 6574 2e61 7267 6d69  :`~Dataset.argmi
+0004c480: 6e60 2c20 7468 6973 2072 6574 7572 6e73  n`, this returns
+0004c490: 2074 6865 0a20 2020 2020 2020 2063 6f6f   the.        coo
+0004c4a0: 7264 696e 6174 6520 6c61 6265 6c20 7768  rdinate label wh
+0004c4b0: 696c 6520 3a70 793a 6d65 7468 3a60 7e44  ile :py:meth:`~D
+0004c4c0: 6174 6173 6574 2e61 7267 6d69 6e60 2072  ataset.argmin` r
+0004c4d0: 6574 7572 6e73 2074 6865 2069 6e64 6578  eturns the index
+0004c4e0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0004c4f0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0004c500: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0004c510: 2064 696d 203a 2048 6173 6861 626c 652c   dim : Hashable,
+0004c520: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0004c530: 2020 2020 2020 4469 6d65 6e73 696f 6e20        Dimension 
+0004c540: 6f76 6572 2077 6869 6368 2074 6f20 6170  over which to ap
+0004c550: 706c 7920 6069 6478 6d69 6e60 2e20 2054  ply `idxmin`.  T
+0004c560: 6869 7320 6973 206f 7074 696f 6e61 6c20  his is optional 
+0004c570: 666f 7220 3144 0a20 2020 2020 2020 2020  for 1D.         
+0004c580: 2020 2076 6172 6961 626c 6573 2c20 6275     variables, bu
+0004c590: 7420 7265 7175 6972 6564 2066 6f72 2076  t required for v
+0004c5a0: 6172 6961 626c 6573 2077 6974 6820 3220  ariables with 2 
+0004c5b0: 6f72 206d 6f72 6520 6469 6d65 6e73 696f  or more dimensio
+0004c5c0: 6e73 2e0a 2020 2020 2020 2020 736b 6970  ns..        skip
+0004c5d0: 6e61 203a 2062 6f6f 6c20 6f72 204e 6f6e  na : bool or Non
+0004c5e0: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+0004c5f0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0004c600: 2073 6b69 7020 6d69 7373 696e 6720 7661   skip missing va
+0004c610: 6c75 6573 2028 6173 206d 6172 6b65 6420  lues (as marked 
+0004c620: 6279 204e 614e 292e 2042 7920 6465 6661  by NaN). By defa
+0004c630: 756c 742c 206f 6e6c 790a 2020 2020 2020  ult, only.      
+0004c640: 2020 2020 2020 736b 6970 7320 6d69 7373        skips miss
+0004c650: 696e 6720 7661 6c75 6573 2066 6f72 2060  ing values for `
+0004c660: 6066 6c6f 6174 6060 2c20 6060 636f 6d70  `float``, ``comp
+0004c670: 6c65 7860 602c 2061 6e64 2060 606f 626a  lex``, and ``obj
+0004c680: 6563 7460 600a 2020 2020 2020 2020 2020  ect``.          
+0004c690: 2020 6474 7970 6573 3b20 6f74 6865 7220    dtypes; other 
+0004c6a0: 6474 7970 6573 2065 6974 6865 7220 646f  dtypes either do
+0004c6b0: 206e 6f74 2068 6176 6520 6120 7365 6e74   not have a sent
+0004c6c0: 696e 656c 206d 6973 7369 6e67 2076 616c  inel missing val
+0004c6d0: 7565 0a20 2020 2020 2020 2020 2020 2028  ue.            (
+0004c6e0: 6060 696e 7460 6029 206f 7220 6060 736b  ``int``) or ``sk
+0004c6f0: 6970 6e61 3d54 7275 6560 6020 6861 7320  ipna=True`` has 
+0004c700: 6e6f 7420 6265 656e 2069 6d70 6c65 6d65  not been impleme
+0004c710: 6e74 6564 0a20 2020 2020 2020 2020 2020  nted.           
+0004c720: 2028 6060 6461 7465 7469 6d65 3634 6060   (``datetime64``
+0004c730: 206f 7220 6060 7469 6d65 6465 6c74 6136   or ``timedelta6
+0004c740: 3460 6029 2e0a 2020 2020 2020 2020 6669  4``)..        fi
+0004c750: 6c6c 5f76 616c 7565 203a 2041 6e79 2c20  ll_value : Any, 
+0004c760: 6465 6661 756c 743a 204e 614e 0a20 2020  default: NaN.   
+0004c770: 2020 2020 2020 2020 2056 616c 7565 2074           Value t
+0004c780: 6f20 6265 2066 696c 6c65 6420 696e 2063  o be filled in c
+0004c790: 6173 6520 616c 6c20 6f66 2074 6865 2076  ase all of the v
+0004c7a0: 616c 7565 7320 616c 6f6e 6720 6120 6469  alues along a di
+0004c7b0: 6d65 6e73 696f 6e20 6172 650a 2020 2020  mension are.    
+0004c7c0: 2020 2020 2020 2020 6e75 6c6c 2e20 2042          null.  B
+0004c7d0: 7920 6465 6661 756c 7420 7468 6973 2069  y default this i
+0004c7e0: 7320 4e61 4e2e 2020 5468 6520 6669 6c6c  s NaN.  The fill
+0004c7f0: 2076 616c 7565 2061 6e64 2072 6573 756c   value and resul
+0004c800: 7420 6172 650a 2020 2020 2020 2020 2020  t are.          
+0004c810: 2020 6175 746f 6d61 7469 6361 6c6c 7920    automatically 
+0004c820: 636f 6e76 6572 7465 6420 746f 2061 2063  converted to a c
+0004c830: 6f6d 7061 7469 626c 6520 6474 7970 6520  ompatible dtype 
+0004c840: 6966 2070 6f73 7369 626c 652e 0a20 2020  if possible..   
+0004c850: 2020 2020 2020 2020 2049 676e 6f72 6564           Ignored
+0004c860: 2069 6620 6060 736b 6970 6e61 6060 2069   if ``skipna`` i
+0004c870: 7320 4661 6c73 652e 0a20 2020 2020 2020  s False..       
+0004c880: 206b 6565 705f 6174 7472 7320 3a20 626f   keep_attrs : bo
+0004c890: 6f6c 206f 7220 4e6f 6e65 2c20 6f70 7469  ol or None, opti
+0004c8a0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+0004c8b0: 2049 6620 5472 7565 2c20 7468 6520 6174   If True, the at
+0004c8c0: 7472 6962 7574 6573 2028 6060 6174 7472  tributes (``attr
+0004c8d0: 7360 6029 2077 696c 6c20 6265 2063 6f70  s``) will be cop
+0004c8e0: 6965 6420 6672 6f6d 2074 6865 0a20 2020  ied from the.   
+0004c8f0: 2020 2020 2020 2020 206f 7269 6769 6e61           origina
+0004c900: 6c20 6f62 6a65 6374 2074 6f20 7468 6520  l object to the 
+0004c910: 6e65 7720 6f6e 652e 2049 6620 4661 6c73  new one. If Fals
+0004c920: 652c 2074 6865 206e 6577 206f 626a 6563  e, the new objec
+0004c930: 740a 2020 2020 2020 2020 2020 2020 7769  t.            wi
+0004c940: 6c6c 2062 6520 7265 7475 726e 6564 2077  ll be returned w
+0004c950: 6974 686f 7574 2061 7474 7269 6275 7465  ithout attribute
+0004c960: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
+0004c970: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+0004c980: 2d2d 2d0a 2020 2020 2020 2020 7265 6475  ---.        redu
+0004c990: 6365 6420 3a20 4461 7461 7365 740a 2020  ced : Dataset.  
+0004c9a0: 2020 2020 2020 2020 2020 4e65 7720 6044            New `D
+0004c9b0: 6174 6173 6574 6020 6f62 6a65 6374 2077  ataset` object w
+0004c9c0: 6974 6820 6069 6478 6d69 6e60 2061 7070  ith `idxmin` app
+0004c9d0: 6c69 6564 2074 6f20 6974 7320 6461 7461  lied to its data
+0004c9e0: 2061 6e64 2074 6865 0a20 2020 2020 2020   and the.       
+0004c9f0: 2020 2020 2069 6e64 6963 6174 6564 2064       indicated d
+0004ca00: 696d 656e 7369 6f6e 2072 656d 6f76 6564  imension removed
+0004ca10: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+0004ca20: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+0004ca30: 2d2d 2d2d 0a20 2020 2020 2020 2044 6174  ----.        Dat
+0004ca40: 6141 7272 6179 2e69 6478 6d69 6e2c 2044  aArray.idxmin, D
+0004ca50: 6174 6173 6574 2e69 6478 6d61 782c 2044  ataset.idxmax, D
+0004ca60: 6174 6173 6574 2e6d 696e 2c20 4461 7461  ataset.min, Data
+0004ca70: 7365 742e 6172 676d 696e 0a0a 2020 2020  set.argmin..    
+0004ca80: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
+0004ca90: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+0004caa0: 2020 2020 2020 3e3e 3e20 6172 7261 7931        >>> array1
+0004cab0: 203d 2078 722e 4461 7461 4172 7261 7928   = xr.DataArray(
+0004cac0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+0004cad0: 205b 302c 2032 2c20 312c 2030 2c20 2d32   [0, 2, 1, 0, -2
+0004cae0: 5d2c 2064 696d 733d 2278 222c 2063 6f6f  ], dims="x", coo
+0004caf0: 7264 733d 7b22 7822 3a20 5b22 6122 2c20  rds={"x": ["a", 
+0004cb00: 2262 222c 2022 6322 2c20 2264 222c 2022  "b", "c", "d", "
+0004cb10: 6522 5d7d 0a20 2020 2020 2020 202e 2e2e  e"]}.        ...
+0004cb20: 2029 0a20 2020 2020 2020 203e 3e3e 2061   ).        >>> a
+0004cb30: 7272 6179 3220 3d20 7872 2e44 6174 6141  rray2 = xr.DataA
+0004cb40: 7272 6179 280a 2020 2020 2020 2020 2e2e  rray(.        ..
+0004cb50: 2e20 2020 2020 5b0a 2020 2020 2020 2020  .     [.        
+0004cb60: 2e2e 2e20 2020 2020 2020 2020 5b32 2e30  ...         [2.0
+0004cb70: 2c20 312e 302c 2032 2e30 2c20 302e 302c  , 1.0, 2.0, 0.0,
+0004cb80: 202d 322e 305d 2c0a 2020 2020 2020 2020   -2.0],.        
+0004cb90: 2e2e 2e20 2020 2020 2020 2020 5b2d 342e  ...         [-4.
+0004cba0: 302c 206e 702e 4e61 4e2c 2032 2e30 2c20  0, np.NaN, 2.0, 
+0004cbb0: 6e70 2e4e 614e 2c20 2d32 2e30 5d2c 0a20  np.NaN, -2.0],. 
+0004cbc0: 2020 2020 2020 202e 2e2e 2020 2020 2020         ...      
+0004cbd0: 2020 205b 6e70 2e4e 614e 2c20 6e70 2e4e     [np.NaN, np.N
+0004cbe0: 614e 2c20 312e 302c 206e 702e 4e61 4e2c  aN, 1.0, np.NaN,
+0004cbf0: 206e 702e 4e61 4e5d 2c0a 2020 2020 2020   np.NaN],.      
+0004cc00: 2020 2e2e 2e20 2020 2020 5d2c 0a20 2020    ...     ],.   
+0004cc10: 2020 2020 202e 2e2e 2020 2020 2064 696d       ...     dim
+0004cc20: 733d 5b22 7922 2c20 2278 225d 2c0a 2020  s=["y", "x"],.  
+0004cc30: 2020 2020 2020 2e2e 2e20 2020 2020 636f        ...     co
+0004cc40: 6f72 6473 3d7b 2279 223a 205b 2d31 2c20  ords={"y": [-1, 
+0004cc50: 302c 2031 5d2c 2022 7822 3a20 5b22 6122  0, 1], "x": ["a"
+0004cc60: 2c20 2262 222c 2022 6322 2c20 2264 222c  , "b", "c", "d",
+0004cc70: 2022 6522 5d7d 2c0a 2020 2020 2020 2020   "e"]},.        
+0004cc80: 2e2e 2e20 290a 2020 2020 2020 2020 3e3e  ... ).        >>
+0004cc90: 3e20 6473 203d 2078 722e 4461 7461 7365  > ds = xr.Datase
+0004cca0: 7428 7b22 696e 7422 3a20 6172 7261 7931  t({"int": array1
+0004ccb0: 2c20 2266 6c6f 6174 223a 2061 7272 6179  , "float": array
+0004ccc0: 327d 290a 2020 2020 2020 2020 3e3e 3e20  2}).        >>> 
+0004ccd0: 6473 2e6d 696e 2864 696d 3d22 7822 290a  ds.min(dim="x").
+0004cce0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+0004ccf0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+0004cd00: 2044 696d 656e 7369 6f6e 733a 2020 2879   Dimensions:  (y
+0004cd10: 3a20 3329 0a20 2020 2020 2020 2043 6f6f  : 3).        Coo
+0004cd20: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+0004cd30: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
+0004cd40: 7929 2069 6e74 3634 202d 3120 3020 310a  y) int64 -1 0 1.
+0004cd50: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+0004cd60: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+0004cd70: 2020 2020 696e 7420 2020 2020 2069 6e74      int      int
+0004cd80: 3634 202d 320a 2020 2020 2020 2020 2020  64 -2.          
+0004cd90: 2020 666c 6f61 7420 2020 2028 7929 2066    float    (y) f
+0004cda0: 6c6f 6174 3634 202d 322e 3020 2d34 2e30  loat64 -2.0 -4.0
+0004cdb0: 2031 2e30 0a20 2020 2020 2020 203e 3e3e   1.0.        >>>
+0004cdc0: 2064 732e 6172 676d 696e 2864 696d 3d22   ds.argmin(dim="
+0004cdd0: 7822 290a 2020 2020 2020 2020 3c78 6172  x").        <xar
+0004cde0: 7261 792e 4461 7461 7365 743e 0a20 2020  ray.Dataset>.   
+0004cdf0: 2020 2020 2044 696d 656e 7369 6f6e 733a       Dimensions:
+0004ce00: 2020 2879 3a20 3329 0a20 2020 2020 2020    (y: 3).       
+0004ce10: 2043 6f6f 7264 696e 6174 6573 3a0a 2020   Coordinates:.  
+0004ce20: 2020 2020 2020 2020 2a20 7920 2020 2020          * y     
+0004ce30: 2020 2028 7929 2069 6e74 3634 202d 3120     (y) int64 -1 
+0004ce40: 3020 310a 2020 2020 2020 2020 4461 7461  0 1.        Data
+0004ce50: 2076 6172 6961 626c 6573 3a0a 2020 2020   variables:.    
+0004ce60: 2020 2020 2020 2020 696e 7420 2020 2020          int     
+0004ce70: 2069 6e74 3634 2034 0a20 2020 2020 2020   int64 4.       
+0004ce80: 2020 2020 2066 6c6f 6174 2020 2020 2879       float    (y
+0004ce90: 2920 696e 7436 3420 3420 3020 320a 2020  ) int64 4 0 2.  
+0004cea0: 2020 2020 2020 3e3e 3e20 6473 2e69 6478        >>> ds.idx
+0004ceb0: 6d69 6e28 6469 6d3d 2278 2229 0a20 2020  min(dim="x").   
+0004cec0: 2020 2020 203c 7861 7272 6179 2e44 6174       <xarray.Dat
+0004ced0: 6173 6574 3e0a 2020 2020 2020 2020 4469  aset>.        Di
+0004cee0: 6d65 6e73 696f 6e73 3a20 2028 793a 2033  mensions:  (y: 3
+0004cef0: 290a 2020 2020 2020 2020 436f 6f72 6469  ).        Coordi
+0004cf00: 6e61 7465 733a 0a20 2020 2020 2020 2020  nates:.         
+0004cf10: 202a 2079 2020 2020 2020 2020 2879 2920   * y        (y) 
+0004cf20: 696e 7436 3420 2d31 2030 2031 0a20 2020  int64 -1 0 1.   
+0004cf30: 2020 2020 2044 6174 6120 7661 7269 6162       Data variab
+0004cf40: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+0004cf50: 2069 6e74 2020 2020 2020 3c55 3120 2765   int      <U1 'e
+0004cf60: 270a 2020 2020 2020 2020 2020 2020 666c  '.            fl
+0004cf70: 6f61 7420 2020 2028 7929 206f 626a 6563  oat    (y) objec
+0004cf80: 7420 2765 2720 2761 2720 2763 270a 2020  t 'e' 'a' 'c'.  
+0004cf90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0004cfa0: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+0004cfb0: 7028 0a20 2020 2020 2020 2020 2020 206d  p(.            m
+0004cfc0: 6574 686f 6463 616c 6c65 7228 0a20 2020  ethodcaller(.   
+0004cfd0: 2020 2020 2020 2020 2020 2020 2022 6964               "id
+0004cfe0: 786d 696e 222c 0a20 2020 2020 2020 2020  xmin",.         
+0004cff0: 2020 2020 2020 2064 696d 3d64 696d 2c0a         dim=dim,.
+0004d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d010: 736b 6970 6e61 3d73 6b69 706e 612c 0a20  skipna=skipna,. 
+0004d020: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004d030: 696c 6c5f 7661 6c75 653d 6669 6c6c 5f76  ill_value=fill_v
+0004d040: 616c 7565 2c0a 2020 2020 2020 2020 2020  alue,.          
+0004d050: 2020 2020 2020 6b65 6570 5f61 7474 7273        keep_attrs
+0004d060: 3d6b 6565 705f 6174 7472 732c 0a20 2020  =keep_attrs,.   
+0004d070: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0004d080: 2020 2029 0a0a 2020 2020 6465 6620 6964     )..    def id
+0004d090: 786d 6178 280a 2020 2020 2020 2020 7365  xmax(.        se
+0004d0a0: 6c66 3a20 545f 4461 7461 7365 742c 0a20  lf: T_Dataset,. 
+0004d0b0: 2020 2020 2020 2064 696d 3a20 4861 7368         dim: Hash
+0004d0c0: 6162 6c65 207c 204e 6f6e 6520 3d20 4e6f  able | None = No
+0004d0d0: 6e65 2c0a 2020 2020 2020 2020 736b 6970  ne,.        skip
+0004d0e0: 6e61 3a20 626f 6f6c 207c 204e 6f6e 6520  na: bool | None 
+0004d0f0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0004d100: 6669 6c6c 5f76 616c 7565 3a20 416e 7920  fill_value: Any 
+0004d110: 3d20 7872 6474 7970 6573 2e4e 412c 0a20  = xrdtypes.NA,. 
+0004d120: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
+0004d130: 733a 2062 6f6f 6c20 7c20 4e6f 6e65 203d  s: bool | None =
+0004d140: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+0004d150: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+0004d160: 2020 2022 2222 5265 7475 726e 2074 6865     """Return the
+0004d170: 2063 6f6f 7264 696e 6174 6520 6c61 6265   coordinate labe
+0004d180: 6c20 6f66 2074 6865 206d 6178 696d 756d  l of the maximum
+0004d190: 2076 616c 7565 2061 6c6f 6e67 2061 2064   value along a d
+0004d1a0: 696d 656e 7369 6f6e 2e0a 0a20 2020 2020  imension...     
+0004d1b0: 2020 2052 6574 7572 6e73 2061 206e 6577     Returns a new
+0004d1c0: 2060 4461 7461 7365 7460 206e 616d 6564   `Dataset` named
+0004d1d0: 2061 6674 6572 2074 6865 2064 696d 656e   after the dimen
+0004d1e0: 7369 6f6e 2077 6974 6820 7468 6520 7661  sion with the va
+0004d1f0: 6c75 6573 206f 660a 2020 2020 2020 2020  lues of.        
+0004d200: 7468 6520 636f 6f72 6469 6e61 7465 206c  the coordinate l
+0004d210: 6162 656c 7320 616c 6f6e 6720 7468 6174  abels along that
+0004d220: 2064 696d 656e 7369 6f6e 2063 6f72 7265   dimension corre
+0004d230: 7370 6f6e 6469 6e67 2074 6f20 6d61 7869  sponding to maxi
+0004d240: 6d75 6d0a 2020 2020 2020 2020 7661 6c75  mum.        valu
+0004d250: 6573 2061 6c6f 6e67 2074 6861 7420 6469  es along that di
+0004d260: 6d65 6e73 696f 6e2e 0a0a 2020 2020 2020  mension...      
+0004d270: 2020 496e 2063 6f6d 7061 7269 736f 6e20    In comparison 
+0004d280: 746f 203a 7079 3a6d 6574 683a 607e 4461  to :py:meth:`~Da
+0004d290: 7461 7365 742e 6172 676d 6178 602c 2074  taset.argmax`, t
+0004d2a0: 6869 7320 7265 7475 726e 7320 7468 650a  his returns the.
+0004d2b0: 2020 2020 2020 2020 636f 6f72 6469 6e61          coordina
+0004d2c0: 7465 206c 6162 656c 2077 6869 6c65 203a  te label while :
+0004d2d0: 7079 3a6d 6574 683a 607e 4461 7461 7365  py:meth:`~Datase
+0004d2e0: 742e 6172 676d 6178 6020 7265 7475 726e  t.argmax` return
+0004d2f0: 7320 7468 6520 696e 6465 782e 0a0a 2020  s the index...  
+0004d300: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0004d310: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0004d320: 2d2d 2d0a 2020 2020 2020 2020 6469 6d20  ---.        dim 
+0004d330: 3a20 7374 722c 206f 7074 696f 6e61 6c0a  : str, optional.
+0004d340: 2020 2020 2020 2020 2020 2020 4469 6d65              Dime
+0004d350: 6e73 696f 6e20 6f76 6572 2077 6869 6368  nsion over which
+0004d360: 2074 6f20 6170 706c 7920 6069 6478 6d61   to apply `idxma
+0004d370: 7860 2e20 2054 6869 7320 6973 206f 7074  x`.  This is opt
+0004d380: 696f 6e61 6c20 666f 7220 3144 0a20 2020  ional for 1D.   
+0004d390: 2020 2020 2020 2020 2076 6172 6961 626c           variabl
+0004d3a0: 6573 2c20 6275 7420 7265 7175 6972 6564  es, but required
+0004d3b0: 2066 6f72 2076 6172 6961 626c 6573 2077   for variables w
+0004d3c0: 6974 6820 3220 6f72 206d 6f72 6520 6469  ith 2 or more di
+0004d3d0: 6d65 6e73 696f 6e73 2e0a 2020 2020 2020  mensions..      
+0004d3e0: 2020 736b 6970 6e61 203a 2062 6f6f 6c20    skipna : bool 
+0004d3f0: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
+0004d400: 6c0a 2020 2020 2020 2020 2020 2020 4966  l.            If
+0004d410: 2054 7275 652c 2073 6b69 7020 6d69 7373   True, skip miss
+0004d420: 696e 6720 7661 6c75 6573 2028 6173 206d  ing values (as m
+0004d430: 6172 6b65 6420 6279 204e 614e 292e 2042  arked by NaN). B
+0004d440: 7920 6465 6661 756c 742c 206f 6e6c 790a  y default, only.
+0004d450: 2020 2020 2020 2020 2020 2020 736b 6970              skip
+0004d460: 7320 6d69 7373 696e 6720 7661 6c75 6573  s missing values
+0004d470: 2066 6f72 2060 6066 6c6f 6174 6060 2c20   for ``float``, 
+0004d480: 6060 636f 6d70 6c65 7860 602c 2061 6e64  ``complex``, and
+0004d490: 2060 606f 626a 6563 7460 600a 2020 2020   ``object``.    
+0004d4a0: 2020 2020 2020 2020 6474 7970 6573 3b20          dtypes; 
+0004d4b0: 6f74 6865 7220 6474 7970 6573 2065 6974  other dtypes eit
+0004d4c0: 6865 7220 646f 206e 6f74 2068 6176 6520  her do not have 
+0004d4d0: 6120 7365 6e74 696e 656c 206d 6973 7369  a sentinel missi
+0004d4e0: 6e67 2076 616c 7565 0a20 2020 2020 2020  ng value.       
+0004d4f0: 2020 2020 2028 6060 696e 7460 6029 206f       (``int``) o
+0004d500: 7220 6060 736b 6970 6e61 3d54 7275 6560  r ``skipna=True`
+0004d510: 6020 6861 7320 6e6f 7420 6265 656e 2069  ` has not been i
+0004d520: 6d70 6c65 6d65 6e74 6564 0a20 2020 2020  mplemented.     
+0004d530: 2020 2020 2020 2028 6060 6461 7465 7469         (``dateti
+0004d540: 6d65 3634 6060 206f 7220 6060 7469 6d65  me64`` or ``time
+0004d550: 6465 6c74 6136 3460 6029 2e0a 2020 2020  delta64``)..    
+0004d560: 2020 2020 6669 6c6c 5f76 616c 7565 203a      fill_value :
+0004d570: 2041 6e79 2c20 6465 6661 756c 743a 204e   Any, default: N
+0004d580: 614e 0a20 2020 2020 2020 2020 2020 2056  aN.            V
+0004d590: 616c 7565 2074 6f20 6265 2066 696c 6c65  alue to be fille
+0004d5a0: 6420 696e 2063 6173 6520 616c 6c20 6f66  d in case all of
+0004d5b0: 2074 6865 2076 616c 7565 7320 616c 6f6e   the values alon
+0004d5c0: 6720 6120 6469 6d65 6e73 696f 6e20 6172  g a dimension ar
+0004d5d0: 650a 2020 2020 2020 2020 2020 2020 6e75  e.            nu
+0004d5e0: 6c6c 2e20 2042 7920 6465 6661 756c 7420  ll.  By default 
+0004d5f0: 7468 6973 2069 7320 4e61 4e2e 2020 5468  this is NaN.  Th
+0004d600: 6520 6669 6c6c 2076 616c 7565 2061 6e64  e fill value and
+0004d610: 2072 6573 756c 7420 6172 650a 2020 2020   result are.    
+0004d620: 2020 2020 2020 2020 6175 746f 6d61 7469          automati
+0004d630: 6361 6c6c 7920 636f 6e76 6572 7465 6420  cally converted 
+0004d640: 746f 2061 2063 6f6d 7061 7469 626c 6520  to a compatible 
+0004d650: 6474 7970 6520 6966 2070 6f73 7369 626c  dtype if possibl
+0004d660: 652e 0a20 2020 2020 2020 2020 2020 2049  e..            I
+0004d670: 676e 6f72 6564 2069 6620 6060 736b 6970  gnored if ``skip
+0004d680: 6e61 6060 2069 7320 4661 6c73 652e 0a20  na`` is False.. 
+0004d690: 2020 2020 2020 206b 6565 705f 6174 7472         keep_attr
+0004d6a0: 7320 3a20 626f 6f6c 206f 7220 4e6f 6e65  s : bool or None
+0004d6b0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0004d6c0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+0004d6d0: 7468 6520 6174 7472 6962 7574 6573 2028  the attributes (
+0004d6e0: 6060 6174 7472 7360 6029 2077 696c 6c20  ``attrs``) will 
+0004d6f0: 6265 2063 6f70 6965 6420 6672 6f6d 2074  be copied from t
+0004d700: 6865 0a20 2020 2020 2020 2020 2020 206f  he.            o
+0004d710: 7269 6769 6e61 6c20 6f62 6a65 6374 2074  riginal object t
+0004d720: 6f20 7468 6520 6e65 7720 6f6e 652e 2049  o the new one. I
+0004d730: 6620 4661 6c73 652c 2074 6865 206e 6577  f False, the new
+0004d740: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
+0004d750: 2020 2020 7769 6c6c 2062 6520 7265 7475      will be retu
+0004d760: 726e 6564 2077 6974 686f 7574 2061 7474  rned without att
+0004d770: 7269 6275 7465 732e 0a0a 2020 2020 2020  ributes...      
+0004d780: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0004d790: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+0004d7a0: 2020 7265 6475 6365 6420 3a20 4461 7461    reduced : Data
+0004d7b0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+0004d7c0: 4e65 7720 6044 6174 6173 6574 6020 6f62  New `Dataset` ob
+0004d7d0: 6a65 6374 2077 6974 6820 6069 6478 6d61  ject with `idxma
+0004d7e0: 7860 2061 7070 6c69 6564 2074 6f20 6974  x` applied to it
+0004d7f0: 7320 6461 7461 2061 6e64 2074 6865 0a20  s data and the. 
+0004d800: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+0004d810: 6174 6564 2064 696d 656e 7369 6f6e 2072  ated dimension r
+0004d820: 656d 6f76 6564 2e0a 0a20 2020 2020 2020  emoved...       
+0004d830: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+0004d840: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+0004d850: 2020 2044 6174 6141 7272 6179 2e69 6478     DataArray.idx
+0004d860: 6d61 782c 2044 6174 6173 6574 2e69 6478  max, Dataset.idx
+0004d870: 6d69 6e2c 2044 6174 6173 6574 2e6d 6178  min, Dataset.max
+0004d880: 2c20 4461 7461 7365 742e 6172 676d 6178  , Dataset.argmax
+0004d890: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
+0004d8a0: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+0004d8b0: 2d2d 2d0a 2020 2020 2020 2020 3e3e 3e20  ---.        >>> 
+0004d8c0: 6172 7261 7931 203d 2078 722e 4461 7461  array1 = xr.Data
+0004d8d0: 4172 7261 7928 0a20 2020 2020 2020 202e  Array(.        .
+0004d8e0: 2e2e 2020 2020 205b 302c 2032 2c20 312c  ..     [0, 2, 1,
+0004d8f0: 2030 2c20 2d32 5d2c 2064 696d 733d 2278   0, -2], dims="x
+0004d900: 222c 2063 6f6f 7264 733d 7b22 7822 3a20  ", coords={"x": 
+0004d910: 5b22 6122 2c20 2262 222c 2022 6322 2c20  ["a", "b", "c", 
+0004d920: 2264 222c 2022 6522 5d7d 0a20 2020 2020  "d", "e"]}.     
+0004d930: 2020 202e 2e2e 2029 0a20 2020 2020 2020     ... ).       
+0004d940: 203e 3e3e 2061 7272 6179 3220 3d20 7872   >>> array2 = xr
+0004d950: 2e44 6174 6141 7272 6179 280a 2020 2020  .DataArray(.    
+0004d960: 2020 2020 2e2e 2e20 2020 2020 5b0a 2020      ...     [.  
+0004d970: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+0004d980: 2020 5b32 2e30 2c20 312e 302c 2032 2e30    [2.0, 1.0, 2.0
+0004d990: 2c20 302e 302c 202d 322e 305d 2c0a 2020  , 0.0, -2.0],.  
+0004d9a0: 2020 2020 2020 2e2e 2e20 2020 2020 2020        ...       
+0004d9b0: 2020 5b2d 342e 302c 206e 702e 4e61 4e2c    [-4.0, np.NaN,
+0004d9c0: 2032 2e30 2c20 6e70 2e4e 614e 2c20 2d32   2.0, np.NaN, -2
+0004d9d0: 2e30 5d2c 0a20 2020 2020 2020 202e 2e2e  .0],.        ...
+0004d9e0: 2020 2020 2020 2020 205b 6e70 2e4e 614e           [np.NaN
+0004d9f0: 2c20 6e70 2e4e 614e 2c20 312e 302c 206e  , np.NaN, 1.0, n
+0004da00: 702e 4e61 4e2c 206e 702e 4e61 4e5d 2c0a  p.NaN, np.NaN],.
+0004da10: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
+0004da20: 5d2c 0a20 2020 2020 2020 202e 2e2e 2020  ],.        ...  
+0004da30: 2020 2064 696d 733d 5b22 7922 2c20 2278     dims=["y", "x
+0004da40: 225d 2c0a 2020 2020 2020 2020 2e2e 2e20  "],.        ... 
+0004da50: 2020 2020 636f 6f72 6473 3d7b 2279 223a      coords={"y":
+0004da60: 205b 2d31 2c20 302c 2031 5d2c 2022 7822   [-1, 0, 1], "x"
+0004da70: 3a20 5b22 6122 2c20 2262 222c 2022 6322  : ["a", "b", "c"
+0004da80: 2c20 2264 222c 2022 6522 5d7d 2c0a 2020  , "d", "e"]},.  
+0004da90: 2020 2020 2020 2e2e 2e20 290a 2020 2020        ... ).    
+0004daa0: 2020 2020 3e3e 3e20 6473 203d 2078 722e      >>> ds = xr.
+0004dab0: 4461 7461 7365 7428 7b22 696e 7422 3a20  Dataset({"int": 
+0004dac0: 6172 7261 7931 2c20 2266 6c6f 6174 223a  array1, "float":
+0004dad0: 2061 7272 6179 327d 290a 2020 2020 2020   array2}).      
+0004dae0: 2020 3e3e 3e20 6473 2e6d 6178 2864 696d    >>> ds.max(dim
+0004daf0: 3d22 7822 290a 2020 2020 2020 2020 3c78  ="x").        <x
+0004db00: 6172 7261 792e 4461 7461 7365 743e 0a20  array.Dataset>. 
+0004db10: 2020 2020 2020 2044 696d 656e 7369 6f6e         Dimension
+0004db20: 733a 2020 2879 3a20 3329 0a20 2020 2020  s:  (y: 3).     
+0004db30: 2020 2043 6f6f 7264 696e 6174 6573 3a0a     Coordinates:.
+0004db40: 2020 2020 2020 2020 2020 2a20 7920 2020            * y   
+0004db50: 2020 2020 2028 7929 2069 6e74 3634 202d       (y) int64 -
+0004db60: 3120 3020 310a 2020 2020 2020 2020 4461  1 0 1.        Da
+0004db70: 7461 2076 6172 6961 626c 6573 3a0a 2020  ta variables:.  
+0004db80: 2020 2020 2020 2020 2020 696e 7420 2020            int   
+0004db90: 2020 2069 6e74 3634 2032 0a20 2020 2020     int64 2.     
+0004dba0: 2020 2020 2020 2066 6c6f 6174 2020 2020         float    
+0004dbb0: 2879 2920 666c 6f61 7436 3420 322e 3020  (y) float64 2.0 
+0004dbc0: 322e 3020 312e 300a 2020 2020 2020 2020  2.0 1.0.        
+0004dbd0: 3e3e 3e20 6473 2e61 7267 6d61 7828 6469  >>> ds.argmax(di
+0004dbe0: 6d3d 2278 2229 0a20 2020 2020 2020 203c  m="x").        <
+0004dbf0: 7861 7272 6179 2e44 6174 6173 6574 3e0a  xarray.Dataset>.
+0004dc00: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+0004dc10: 6e73 3a20 2028 793a 2033 290a 2020 2020  ns:  (y: 3).    
+0004dc20: 2020 2020 436f 6f72 6469 6e61 7465 733a      Coordinates:
+0004dc30: 0a20 2020 2020 2020 2020 202a 2079 2020  .          * y  
+0004dc40: 2020 2020 2020 2879 2920 696e 7436 3420        (y) int64 
+0004dc50: 2d31 2030 2031 0a20 2020 2020 2020 2044  -1 0 1.        D
+0004dc60: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+0004dc70: 2020 2020 2020 2020 2020 2069 6e74 2020             int  
+0004dc80: 2020 2020 696e 7436 3420 310a 2020 2020      int64 1.    
+0004dc90: 2020 2020 2020 2020 666c 6f61 7420 2020          float   
+0004dca0: 2028 7929 2069 6e74 3634 2030 2032 2032   (y) int64 0 2 2
+0004dcb0: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
+0004dcc0: 6964 786d 6178 2864 696d 3d22 7822 290a  idxmax(dim="x").
+0004dcd0: 2020 2020 2020 2020 3c78 6172 7261 792e          <xarray.
+0004dce0: 4461 7461 7365 743e 0a20 2020 2020 2020  Dataset>.       
+0004dcf0: 2044 696d 656e 7369 6f6e 733a 2020 2879   Dimensions:  (y
+0004dd00: 3a20 3329 0a20 2020 2020 2020 2043 6f6f  : 3).        Coo
+0004dd10: 7264 696e 6174 6573 3a0a 2020 2020 2020  rdinates:.      
+0004dd20: 2020 2020 2a20 7920 2020 2020 2020 2028      * y        (
+0004dd30: 7929 2069 6e74 3634 202d 3120 3020 310a  y) int64 -1 0 1.
+0004dd40: 2020 2020 2020 2020 4461 7461 2076 6172          Data var
+0004dd50: 6961 626c 6573 3a0a 2020 2020 2020 2020  iables:.        
+0004dd60: 2020 2020 696e 7420 2020 2020 203c 5531      int      <U1
+0004dd70: 2027 6227 0a20 2020 2020 2020 2020 2020   'b'.           
+0004dd80: 2066 6c6f 6174 2020 2020 2879 2920 6f62   float    (y) ob
+0004dd90: 6a65 6374 2027 6127 2027 6327 2027 6327  ject 'a' 'c' 'c'
+0004dda0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0004ddb0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0004ddc0: 2e6d 6170 280a 2020 2020 2020 2020 2020  .map(.          
+0004ddd0: 2020 6d65 7468 6f64 6361 6c6c 6572 280a    methodcaller(.
+0004dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ddf0: 2269 6478 6d61 7822 2c0a 2020 2020 2020  "idxmax",.      
+0004de00: 2020 2020 2020 2020 2020 6469 6d3d 6469            dim=di
+0004de10: 6d2c 0a20 2020 2020 2020 2020 2020 2020  m,.             
+0004de20: 2020 2073 6b69 706e 613d 736b 6970 6e61     skipna=skipna
+0004de30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0004de40: 2020 6669 6c6c 5f76 616c 7565 3d66 696c    fill_value=fil
+0004de50: 6c5f 7661 6c75 652c 0a20 2020 2020 2020  l_value,.       
+0004de60: 2020 2020 2020 2020 206b 6565 705f 6174           keep_at
+0004de70: 7472 733d 6b65 6570 5f61 7474 7273 2c0a  trs=keep_attrs,.
+0004de80: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0004de90: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+0004dea0: 2061 7267 6d69 6e28 7365 6c66 3a20 545f   argmin(self: T_
+0004deb0: 4461 7461 7365 742c 2064 696d 3a20 4861  Dataset, dim: Ha
+0004dec0: 7368 6162 6c65 207c 204e 6f6e 6520 3d20  shable | None = 
+0004ded0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 2920  None, **kwargs) 
+0004dee0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+0004def0: 2020 2020 2020 2222 2249 6e64 6963 6573        """Indices
+0004df00: 206f 6620 7468 6520 6d69 6e69 6d61 206f   of the minima o
+0004df10: 6620 7468 6520 6d65 6d62 6572 2076 6172  f the member var
+0004df20: 6961 626c 6573 2e0a 0a20 2020 2020 2020  iables...       
+0004df30: 2049 6620 7468 6572 6520 6172 6520 6d75   If there are mu
+0004df40: 6c74 6970 6c65 206d 696e 696d 612c 2074  ltiple minima, t
+0004df50: 6865 2069 6e64 6963 6573 206f 6620 7468  he indices of th
+0004df60: 6520 6669 7273 7420 6f6e 6520 666f 756e  e first one foun
+0004df70: 6420 7769 6c6c 2062 650a 2020 2020 2020  d will be.      
+0004df80: 2020 7265 7475 726e 6564 2e0a 0a20 2020    returned...   
+0004df90: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+0004dfa0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0004dfb0: 2d2d 0a20 2020 2020 2020 2064 696d 203a  --.        dim :
+0004dfc0: 2048 6173 6861 626c 652c 206f 7074 696f   Hashable, optio
+0004dfd0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+0004dfe0: 5468 6520 6469 6d65 6e73 696f 6e20 6f76  The dimension ov
+0004dff0: 6572 2077 6869 6368 2074 6f20 6669 6e64  er which to find
+0004e000: 2074 6865 206d 696e 696d 756d 2e20 4279   the minimum. By
+0004e010: 2064 6566 6175 6c74 2c20 6669 6e64 7320   default, finds 
+0004e020: 6d69 6e69 6d75 6d20 6f76 6572 0a20 2020  minimum over.   
+0004e030: 2020 2020 2020 2020 2061 6c6c 2064 696d           all dim
+0004e040: 656e 7369 6f6e 7320 2d20 666f 7220 6e6f  ensions - for no
+0004e050: 7720 7265 7475 726e 696e 6720 616e 2069  w returning an i
+0004e060: 6e74 2066 6f72 2062 6163 6b77 6172 6420  nt for backward 
+0004e070: 636f 6d70 6174 6962 696c 6974 792c 2062  compatibility, b
+0004e080: 7574 0a20 2020 2020 2020 2020 2020 2074  ut.            t
+0004e090: 6869 7320 6973 2064 6570 7265 6361 7465  his is deprecate
+0004e0a0: 642c 2069 6e20 6675 7475 7265 2077 696c  d, in future wil
+0004e0b0: 6c20 6265 2061 6e20 6572 726f 722c 2073  l be an error, s
+0004e0c0: 696e 6365 2044 6174 6141 7272 6179 2e61  ince DataArray.a
+0004e0d0: 7267 6d69 6e20 7769 6c6c 0a20 2020 2020  rgmin will.     
+0004e0e0: 2020 2020 2020 2072 6574 7572 6e20 6120         return a 
+0004e0f0: 6469 6374 2077 6974 6820 696e 6469 6365  dict with indice
+0004e100: 7320 666f 7220 616c 6c20 6469 6d65 6e73  s for all dimens
+0004e110: 696f 6e73 2c20 7768 6963 6820 646f 6573  ions, which does
+0004e120: 206e 6f74 206d 616b 6520 7365 6e73 6520   not make sense 
+0004e130: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+0004e140: 6120 4461 7461 7365 742e 0a20 2020 2020  a Dataset..     
+0004e150: 2020 206b 6565 705f 6174 7472 7320 3a20     keep_attrs : 
+0004e160: 626f 6f6c 2c20 6f70 7469 6f6e 616c 0a20  bool, optional. 
+0004e170: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+0004e180: 7565 2c20 7468 6520 6174 7472 6962 7574  ue, the attribut
+0004e190: 6573 2028 6061 7474 7273 6029 2077 696c  es (`attrs`) wil
+0004e1a0: 6c20 6265 2063 6f70 6965 6420 6672 6f6d  l be copied from
+0004e1b0: 2074 6865 206f 7269 6769 6e61 6c0a 2020   the original.  
+0004e1c0: 2020 2020 2020 2020 2020 6f62 6a65 6374            object
+0004e1d0: 2074 6f20 7468 6520 6e65 7720 6f6e 652e   to the new one.
+0004e1e0: 2020 4966 2046 616c 7365 2028 6465 6661    If False (defa
+0004e1f0: 756c 7429 2c20 7468 6520 6e65 7720 6f62  ult), the new ob
+0004e200: 6a65 6374 2077 696c 6c20 6265 0a20 2020  ject will be.   
+0004e210: 2020 2020 2020 2020 2072 6574 7572 6e65           returne
+0004e220: 6420 7769 7468 6f75 7420 6174 7472 6962  d without attrib
+0004e230: 7574 6573 2e0a 2020 2020 2020 2020 736b  utes..        sk
+0004e240: 6970 6e61 203a 2062 6f6f 6c2c 206f 7074  ipna : bool, opt
+0004e250: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+0004e260: 2020 4966 2054 7275 652c 2073 6b69 7020    If True, skip 
+0004e270: 6d69 7373 696e 6720 7661 6c75 6573 2028  missing values (
+0004e280: 6173 206d 6172 6b65 6420 6279 204e 614e  as marked by NaN
+0004e290: 292e 2042 7920 6465 6661 756c 742c 206f  ). By default, o
+0004e2a0: 6e6c 790a 2020 2020 2020 2020 2020 2020  nly.            
+0004e2b0: 736b 6970 7320 6d69 7373 696e 6720 7661  skips missing va
+0004e2c0: 6c75 6573 2066 6f72 2066 6c6f 6174 2064  lues for float d
+0004e2d0: 7479 7065 733b 206f 7468 6572 2064 7479  types; other dty
+0004e2e0: 7065 7320 6569 7468 6572 2064 6f20 6e6f  pes either do no
+0004e2f0: 740a 2020 2020 2020 2020 2020 2020 6861  t.            ha
+0004e300: 7665 2061 2073 656e 7469 6e65 6c20 6d69  ve a sentinel mi
+0004e310: 7373 696e 6720 7661 6c75 6520 2869 6e74  ssing value (int
+0004e320: 2920 6f72 2073 6b69 706e 613d 5472 7565  ) or skipna=True
+0004e330: 2068 6173 206e 6f74 2062 6565 6e0a 2020   has not been.  
+0004e340: 2020 2020 2020 2020 2020 696d 706c 656d            implem
+0004e350: 656e 7465 6420 286f 626a 6563 742c 2064  ented (object, d
+0004e360: 6174 6574 696d 6536 3420 6f72 2074 696d  atetime64 or tim
+0004e370: 6564 656c 7461 3634 292e 0a0a 2020 2020  edelta64)...    
+0004e380: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+0004e390: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+0004e3a0: 2020 2020 7265 7375 6c74 203a 2044 6174      result : Dat
+0004e3b0: 6173 6574 0a0a 2020 2020 2020 2020 5365  aset..        Se
+0004e3c0: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+0004e3d0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0004e3e0: 4461 7461 4172 7261 792e 6172 676d 696e  DataArray.argmin
+0004e3f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0004e400: 2020 2020 2069 6620 6469 6d20 6973 204e       if dim is N
+0004e410: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0004e420: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
+0004e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e440: 224f 6e63 6520 7468 6520 6265 6861 7669  "Once the behavi
+0004e450: 6f75 7220 6f66 2044 6174 6141 7272 6179  our of DataArray
+0004e460: 2e61 7267 6d69 6e28 2920 616e 6420 5661  .argmin() and Va
+0004e470: 7269 6162 6c65 2e61 7267 6d69 6e28 2920  riable.argmin() 
+0004e480: 7769 7468 6f75 7420 220a 2020 2020 2020  without ".      
+0004e490: 2020 2020 2020 2020 2020 2264 696d 2063            "dim c
+0004e4a0: 6861 6e67 6573 2074 6f20 7265 7475 726e  hanges to return
+0004e4b0: 2061 2064 6963 7420 6f66 2069 6e64 6963   a dict of indic
+0004e4c0: 6573 206f 6620 6561 6368 2064 696d 656e  es of each dimen
+0004e4d0: 7369 6f6e 2c20 666f 7220 220a 2020 2020  sion, for ".    
+0004e4e0: 2020 2020 2020 2020 2020 2020 2263 6f6e              "con
+0004e4f0: 7369 7374 656e 6379 2069 7420 7769 6c6c  sistency it will
+0004e500: 2062 6520 616e 2065 7272 6f72 2074 6f20   be an error to 
+0004e510: 6361 6c6c 2044 6174 6173 6574 2e61 7267  call Dataset.arg
+0004e520: 6d69 6e28 2920 7769 7468 206e 6f20 6172  min() with no ar
+0004e530: 6775 6d65 6e74 2c22 0a20 2020 2020 2020  gument,".       
+0004e540: 2020 2020 2020 2020 2022 7369 6e63 6520           "since 
+0004e550: 7765 2064 6f6e 2774 2072 6574 7572 6e20  we don't return 
+0004e560: 6120 6469 6374 206f 6620 4461 7461 7365  a dict of Datase
+0004e570: 7473 2e22 2c0a 2020 2020 2020 2020 2020  ts.",.          
+0004e580: 2020 2020 2020 4465 7072 6563 6174 696f        Deprecatio
+0004e590: 6e57 6172 6e69 6e67 2c0a 2020 2020 2020  nWarning,.      
+0004e5a0: 2020 2020 2020 2020 2020 7374 6163 6b6c            stackl
+0004e5b0: 6576 656c 3d32 2c0a 2020 2020 2020 2020  evel=2,.        
+0004e5c0: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+0004e5d0: 2028 0a20 2020 2020 2020 2020 2020 2064   (.            d
+0004e5e0: 696d 2069 7320 4e6f 6e65 0a20 2020 2020  im is None.     
+0004e5f0: 2020 2020 2020 206f 7220 286e 6f74 2069         or (not i
+0004e600: 7369 6e73 7461 6e63 6528 6469 6d2c 2053  sinstance(dim, S
+0004e610: 6571 7565 6e63 6529 2061 6e64 2064 696d  equence) and dim
+0004e620: 2069 7320 6e6f 7420 2e2e 2e29 0a20 2020   is not ...).   
+0004e630: 2020 2020 2020 2020 206f 7220 6973 696e           or isin
+0004e640: 7374 616e 6365 2864 696d 2c20 7374 7229  stance(dim, str)
+0004e650: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
+0004e660: 2020 2020 2020 2020 2320 5265 7475 726e          # Return
+0004e670: 2069 6e74 2069 6e64 6578 2069 6620 7369   int index if si
+0004e680: 6e67 6c65 2064 696d 656e 7369 6f6e 2069  ngle dimension i
+0004e690: 7320 7061 7373 6564 2c20 616e 6420 6973  s passed, and is
+0004e6a0: 206e 6f74 2070 6172 7420 6f66 2061 0a20   not part of a. 
+0004e6b0: 2020 2020 2020 2020 2020 2023 2073 6571             # seq
+0004e6c0: 7565 6e63 650a 2020 2020 2020 2020 2020  uence.          
+0004e6d0: 2020 6172 676d 696e 5f66 756e 6320 3d20    argmin_func = 
+0004e6e0: 6765 7461 7474 7228 6475 636b 5f61 7272  getattr(duck_arr
+0004e6f0: 6179 5f6f 7073 2c20 2261 7267 6d69 6e22  ay_ops, "argmin"
+0004e700: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0004e710: 7475 726e 2073 656c 662e 7265 6475 6365  turn self.reduce
+0004e720: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0004e730: 2020 6172 676d 696e 5f66 756e 632c 2064    argmin_func, d
+0004e740: 696d 3d4e 6f6e 6520 6966 2064 696d 2069  im=None if dim i
+0004e750: 7320 4e6f 6e65 2065 6c73 6520 5b64 696d  s None else [dim
+0004e760: 5d2c 202a 2a6b 7761 7267 730a 2020 2020  ], **kwargs.    
+0004e770: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0004e780: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0004e790: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0004e7a0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0004e7b0: 2020 2020 2020 2257 6865 6e20 6469 6d20        "When dim 
+0004e7c0: 6973 2061 2073 6571 7565 6e63 6520 6f72  is a sequence or
+0004e7d0: 202e 2e2e 2c20 4461 7461 4172 7261 792e   ..., DataArray.
+0004e7e0: 6172 676d 696e 2829 2072 6574 7572 6e73  argmin() returns
+0004e7f0: 2061 2064 6963 742e 2022 0a20 2020 2020   a dict. ".     
+0004e800: 2020 2020 2020 2020 2020 2022 6469 6374             "dict
+0004e810: 7320 6361 6e6e 6f74 2062 6520 636f 6e74  s cannot be cont
+0004e820: 6169 6e65 6420 696e 2061 2044 6174 6173  ained in a Datas
+0004e830: 6574 2c20 736f 2063 616e 6e6f 7420 6361  et, so cannot ca
+0004e840: 6c6c 2022 0a20 2020 2020 2020 2020 2020  ll ".           
+0004e850: 2020 2020 2022 4461 7461 7365 742e 6172       "Dataset.ar
+0004e860: 676d 696e 2829 2077 6974 6820 6120 7365  gmin() with a se
+0004e870: 7175 656e 6365 206f 7220 2e2e 2e20 666f  quence or ... fo
+0004e880: 7220 6469 6d22 0a20 2020 2020 2020 2020  r dim".         
+0004e890: 2020 2029 0a0a 2020 2020 6465 6620 6172     )..    def ar
+0004e8a0: 676d 6178 2873 656c 663a 2054 5f44 6174  gmax(self: T_Dat
+0004e8b0: 6173 6574 2c20 6469 6d3a 2048 6173 6861  aset, dim: Hasha
+0004e8c0: 626c 6520 7c20 4e6f 6e65 203d 204e 6f6e  ble | None = Non
+0004e8d0: 652c 202a 2a6b 7761 7267 7329 202d 3e20  e, **kwargs) -> 
+0004e8e0: 545f 4461 7461 7365 743a 0a20 2020 2020  T_Dataset:.     
+0004e8f0: 2020 2022 2222 496e 6469 6365 7320 6f66     """Indices of
+0004e900: 2074 6865 206d 6178 696d 6120 6f66 2074   the maxima of t
+0004e910: 6865 206d 656d 6265 7220 7661 7269 6162  he member variab
+0004e920: 6c65 732e 0a0a 2020 2020 2020 2020 4966  les...        If
+0004e930: 2074 6865 7265 2061 7265 206d 756c 7469   there are multi
+0004e940: 706c 6520 6d61 7869 6d61 2c20 7468 6520  ple maxima, the 
+0004e950: 696e 6469 6365 7320 6f66 2074 6865 2066  indices of the f
+0004e960: 6972 7374 206f 6e65 2066 6f75 6e64 2077  irst one found w
+0004e970: 696c 6c20 6265 0a20 2020 2020 2020 2072  ill be.        r
+0004e980: 6574 7572 6e65 642e 0a0a 2020 2020 2020  eturned...      
+0004e990: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0004e9a0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0004e9b0: 2020 2020 2020 2020 6469 6d20 3a20 7374          dim : st
+0004e9c0: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
+0004e9d0: 2020 2020 2020 2020 5468 6520 6469 6d65          The dime
+0004e9e0: 6e73 696f 6e20 6f76 6572 2077 6869 6368  nsion over which
+0004e9f0: 2074 6f20 6669 6e64 2074 6865 206d 6178   to find the max
+0004ea00: 696d 756d 2e20 4279 2064 6566 6175 6c74  imum. By default
+0004ea10: 2c20 6669 6e64 7320 6d61 7869 6d75 6d20  , finds maximum 
+0004ea20: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
+0004ea30: 2061 6c6c 2064 696d 656e 7369 6f6e 7320   all dimensions 
+0004ea40: 2d20 666f 7220 6e6f 7720 7265 7475 726e  - for now return
+0004ea50: 696e 6720 616e 2069 6e74 2066 6f72 2062  ing an int for b
+0004ea60: 6163 6b77 6172 6420 636f 6d70 6174 6962  ackward compatib
+0004ea70: 696c 6974 792c 2062 7574 0a20 2020 2020  ility, but.     
+0004ea80: 2020 2020 2020 2074 6869 7320 6973 2064         this is d
+0004ea90: 6570 7265 6361 7465 642c 2069 6e20 6675  eprecated, in fu
+0004eaa0: 7475 7265 2077 696c 6c20 6265 2061 6e20  ture will be an 
+0004eab0: 6572 726f 722c 2073 696e 6365 2044 6174  error, since Dat
+0004eac0: 6141 7272 6179 2e61 7267 6d61 7820 7769  aArray.argmax wi
+0004ead0: 6c6c 0a20 2020 2020 2020 2020 2020 2072  ll.            r
+0004eae0: 6574 7572 6e20 6120 6469 6374 2077 6974  eturn a dict wit
+0004eaf0: 6820 696e 6469 6365 7320 666f 7220 616c  h indices for al
+0004eb00: 6c20 6469 6d65 6e73 696f 6e73 2c20 7768  l dimensions, wh
+0004eb10: 6963 6820 646f 6573 206e 6f74 206d 616b  ich does not mak
+0004eb20: 6520 7365 6e73 6520 666f 720a 2020 2020  e sense for.    
+0004eb30: 2020 2020 2020 2020 6120 4461 7461 7365          a Datase
+0004eb40: 742e 0a20 2020 2020 2020 206b 6565 705f  t..        keep_
+0004eb50: 6174 7472 7320 3a20 626f 6f6c 2c20 6f70  attrs : bool, op
+0004eb60: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0004eb70: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
+0004eb80: 6174 7472 6962 7574 6573 2028 6061 7474  attributes (`att
+0004eb90: 7273 6029 2077 696c 6c20 6265 2063 6f70  rs`) will be cop
+0004eba0: 6965 6420 6672 6f6d 2074 6865 206f 7269  ied from the ori
+0004ebb0: 6769 6e61 6c0a 2020 2020 2020 2020 2020  ginal.          
+0004ebc0: 2020 6f62 6a65 6374 2074 6f20 7468 6520    object to the 
+0004ebd0: 6e65 7720 6f6e 652e 2020 4966 2046 616c  new one.  If Fal
+0004ebe0: 7365 2028 6465 6661 756c 7429 2c20 7468  se (default), th
+0004ebf0: 6520 6e65 7720 6f62 6a65 6374 2077 696c  e new object wil
+0004ec00: 6c20 6265 0a20 2020 2020 2020 2020 2020  l be.           
+0004ec10: 2072 6574 7572 6e65 6420 7769 7468 6f75   returned withou
+0004ec20: 7420 6174 7472 6962 7574 6573 2e0a 2020  t attributes..  
+0004ec30: 2020 2020 2020 736b 6970 6e61 203a 2062        skipna : b
+0004ec40: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
+0004ec50: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+0004ec60: 652c 2073 6b69 7020 6d69 7373 696e 6720  e, skip missing 
+0004ec70: 7661 6c75 6573 2028 6173 206d 6172 6b65  values (as marke
+0004ec80: 6420 6279 204e 614e 292e 2042 7920 6465  d by NaN). By de
+0004ec90: 6661 756c 742c 206f 6e6c 790a 2020 2020  fault, only.    
+0004eca0: 2020 2020 2020 2020 736b 6970 7320 6d69          skips mi
+0004ecb0: 7373 696e 6720 7661 6c75 6573 2066 6f72  ssing values for
+0004ecc0: 2066 6c6f 6174 2064 7479 7065 733b 206f   float dtypes; o
+0004ecd0: 7468 6572 2064 7479 7065 7320 6569 7468  ther dtypes eith
+0004ece0: 6572 2064 6f20 6e6f 740a 2020 2020 2020  er do not.      
+0004ecf0: 2020 2020 2020 6861 7665 2061 2073 656e        have a sen
+0004ed00: 7469 6e65 6c20 6d69 7373 696e 6720 7661  tinel missing va
+0004ed10: 6c75 6520 2869 6e74 2920 6f72 2073 6b69  lue (int) or ski
+0004ed20: 706e 613d 5472 7565 2068 6173 206e 6f74  pna=True has not
+0004ed30: 2062 6565 6e0a 2020 2020 2020 2020 2020   been.          
+0004ed40: 2020 696d 706c 656d 656e 7465 6420 286f    implemented (o
+0004ed50: 626a 6563 742c 2064 6174 6574 696d 6536  bject, datetime6
+0004ed60: 3420 6f72 2074 696d 6564 656c 7461 3634  4 or timedelta64
+0004ed70: 292e 0a0a 2020 2020 2020 2020 5265 7475  )...        Retu
+0004ed80: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+0004ed90: 2d2d 2d0a 2020 2020 2020 2020 7265 7375  ---.        resu
+0004eda0: 6c74 203a 2044 6174 6173 6574 0a0a 2020  lt : Dataset..  
+0004edb0: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
+0004edc0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+0004edd0: 2020 2020 2020 2020 4461 7461 4172 7261          DataArra
+0004ede0: 792e 6172 676d 6178 0a0a 2020 2020 2020  y.argmax..      
+0004edf0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0004ee00: 2064 696d 2069 7320 4e6f 6e65 3a0a 2020   dim is None:.  
+0004ee10: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+0004ee20: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
+0004ee30: 2020 2020 2020 2020 2022 4f6e 6365 2074           "Once t
+0004ee40: 6865 2062 6568 6176 696f 7572 206f 6620  he behaviour of 
+0004ee50: 4461 7461 4172 7261 792e 6172 676d 696e  DataArray.argmin
+0004ee60: 2829 2061 6e64 2056 6172 6961 626c 652e  () and Variable.
+0004ee70: 6172 676d 696e 2829 2077 6974 686f 7574  argmin() without
+0004ee80: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0004ee90: 2020 2022 6469 6d20 6368 616e 6765 7320     "dim changes 
+0004eea0: 746f 2072 6574 7572 6e20 6120 6469 6374  to return a dict
+0004eeb0: 206f 6620 696e 6469 6365 7320 6f66 2065   of indices of e
+0004eec0: 6163 6820 6469 6d65 6e73 696f 6e2c 2066  ach dimension, f
+0004eed0: 6f72 2022 0a20 2020 2020 2020 2020 2020  or ".           
+0004eee0: 2020 2020 2022 636f 6e73 6973 7465 6e63       "consistenc
+0004eef0: 7920 6974 2077 696c 6c20 6265 2061 6e20  y it will be an 
+0004ef00: 6572 726f 7220 746f 2063 616c 6c20 4461  error to call Da
+0004ef10: 7461 7365 742e 6172 676d 696e 2829 2077  taset.argmin() w
+0004ef20: 6974 6820 6e6f 2061 7267 756d 656e 742c  ith no argument,
+0004ef30: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0004ef40: 2020 2273 696e 6365 2077 6520 646f 6e27    "since we don'
+0004ef50: 7420 7265 7475 726e 2061 2064 6963 7420  t return a dict 
+0004ef60: 6f66 2044 6174 6173 6574 732e 222c 0a20  of Datasets.",. 
+0004ef70: 2020 2020 2020 2020 2020 2020 2020 2044                 D
+0004ef80: 6570 7265 6361 7469 6f6e 5761 726e 696e  eprecationWarnin
+0004ef90: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+0004efa0: 2020 2073 7461 636b 6c65 7665 6c3d 322c     stacklevel=2,
+0004efb0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0004efc0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+0004efd0: 2020 2020 2020 2020 6469 6d20 6973 204e          dim is N
+0004efe0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0004eff0: 6f72 2028 6e6f 7420 6973 696e 7374 616e  or (not isinstan
+0004f000: 6365 2864 696d 2c20 5365 7175 656e 6365  ce(dim, Sequence
+0004f010: 2920 616e 6420 6469 6d20 6973 206e 6f74  ) and dim is not
+0004f020: 202e 2e2e 290a 2020 2020 2020 2020 2020   ...).          
+0004f030: 2020 6f72 2069 7369 6e73 7461 6e63 6528    or isinstance(
+0004f040: 6469 6d2c 2073 7472 290a 2020 2020 2020  dim, str).      
+0004f050: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0004f060: 2023 2052 6574 7572 6e20 696e 7420 696e   # Return int in
+0004f070: 6465 7820 6966 2073 696e 676c 6520 6469  dex if single di
+0004f080: 6d65 6e73 696f 6e20 6973 2070 6173 7365  mension is passe
+0004f090: 642c 2061 6e64 2069 7320 6e6f 7420 7061  d, and is not pa
+0004f0a0: 7274 206f 6620 610a 2020 2020 2020 2020  rt of a.        
+0004f0b0: 2020 2020 2320 7365 7175 656e 6365 0a20      # sequence. 
+0004f0c0: 2020 2020 2020 2020 2020 2061 7267 6d61             argma
+0004f0d0: 785f 6675 6e63 203d 2067 6574 6174 7472  x_func = getattr
+0004f0e0: 2864 7563 6b5f 6172 7261 795f 6f70 732c  (duck_array_ops,
+0004f0f0: 2022 6172 676d 6178 2229 0a20 2020 2020   "argmax").     
+0004f100: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0004f110: 6c66 2e72 6564 7563 6528 0a20 2020 2020  lf.reduce(.     
+0004f120: 2020 2020 2020 2020 2020 2061 7267 6d61             argma
+0004f130: 785f 6675 6e63 2c20 6469 6d3d 4e6f 6e65  x_func, dim=None
+0004f140: 2069 6620 6469 6d20 6973 204e 6f6e 6520   if dim is None 
+0004f150: 656c 7365 205b 6469 6d5d 2c20 2a2a 6b77  else [dim], **kw
+0004f160: 6172 6773 0a20 2020 2020 2020 2020 2020  args.           
+0004f170: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+0004f180: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0004f190: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+0004f1a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004f1b0: 5768 656e 2064 696d 2069 7320 6120 7365  When dim is a se
+0004f1c0: 7175 656e 6365 206f 7220 2e2e 2e2c 2044  quence or ..., D
+0004f1d0: 6174 6141 7272 6179 2e61 7267 6d69 6e28  ataArray.argmin(
+0004f1e0: 2920 7265 7475 726e 7320 6120 6469 6374  ) returns a dict
+0004f1f0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+0004f200: 2020 2020 2264 6963 7473 2063 616e 6e6f      "dicts canno
+0004f210: 7420 6265 2063 6f6e 7461 696e 6564 2069  t be contained i
+0004f220: 6e20 6120 4461 7461 7365 742c 2073 6f20  n a Dataset, so 
+0004f230: 6361 6e6e 6f74 2063 616c 6c20 220a 2020  cannot call ".  
+0004f240: 2020 2020 2020 2020 2020 2020 2020 2244                "D
+0004f250: 6174 6173 6574 2e61 7267 6d69 6e28 2920  ataset.argmin() 
+0004f260: 7769 7468 2061 2073 6571 7565 6e63 6520  with a sequence 
+0004f270: 6f72 202e 2e2e 2066 6f72 2064 696d 220a  or ... for dim".
+0004f280: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0004f290: 2020 2064 6566 2071 7565 7279 280a 2020     def query(.  
+0004f2a0: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+0004f2b0: 7461 7365 742c 0a20 2020 2020 2020 2071  taset,.        q
+0004f2c0: 7565 7269 6573 3a20 4d61 7070 696e 675b  ueries: Mapping[
+0004f2d0: 416e 792c 2041 6e79 5d20 7c20 4e6f 6e65  Any, Any] | None
+0004f2e0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0004f2f0: 2070 6172 7365 723a 2051 7565 7279 5061   parser: QueryPa
+0004f300: 7273 6572 4f70 7469 6f6e 7320 3d20 2270  rserOptions = "p
+0004f310: 616e 6461 7322 2c0a 2020 2020 2020 2020  andas",.        
+0004f320: 656e 6769 6e65 3a20 5175 6572 7945 6e67  engine: QueryEng
+0004f330: 696e 654f 7074 696f 6e73 203d 204e 6f6e  ineOptions = Non
+0004f340: 652c 0a20 2020 2020 2020 206d 6973 7369  e,.        missi
+0004f350: 6e67 5f64 696d 733a 2045 7272 6f72 4f70  ng_dims: ErrorOp
+0004f360: 7469 6f6e 7357 6974 6857 6172 6e20 3d20  tionsWithWarn = 
+0004f370: 2272 6169 7365 222c 0a20 2020 2020 2020  "raise",.       
+0004f380: 202a 2a71 7565 7269 6573 5f6b 7761 7267   **queries_kwarg
+0004f390: 733a 2041 6e79 2c0a 2020 2020 2920 2d3e  s: Any,.    ) ->
+0004f3a0: 2054 5f44 6174 6173 6574 3a0a 2020 2020   T_Dataset:.    
+0004f3b0: 2020 2020 2222 2252 6574 7572 6e20 6120      """Return a 
+0004f3c0: 6e65 7720 6461 7461 7365 7420 7769 7468  new dataset with
+0004f3d0: 2065 6163 6820 6172 7261 7920 696e 6465   each array inde
+0004f3e0: 7865 6420 616c 6f6e 6720 7468 6520 7370  xed along the sp
+0004f3f0: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
+0004f400: 6469 6d65 6e73 696f 6e28 7329 2c20 7768  dimension(s), wh
+0004f410: 6572 6520 7468 6520 696e 6465 7865 7273  ere the indexers
+0004f420: 2061 7265 2067 6976 656e 2061 7320 7374   are given as st
+0004f430: 7269 6e67 7320 636f 6e74 6169 6e69 6e67  rings containing
+0004f440: 0a20 2020 2020 2020 2050 7974 686f 6e20  .        Python 
+0004f450: 6578 7072 6573 7369 6f6e 7320 746f 2062  expressions to b
+0004f460: 6520 6576 616c 7561 7465 6420 6167 6169  e evaluated agai
+0004f470: 6e73 7420 7468 6520 6461 7461 2076 6172  nst the data var
+0004f480: 6961 626c 6573 2069 6e20 7468 650a 2020  iables in the.  
+0004f490: 2020 2020 2020 6461 7461 7365 742e 0a0a        dataset...
+0004f4a0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+0004f4b0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+0004f4c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7175  -----.        qu
+0004f4d0: 6572 6965 7320 3a20 6469 6374 2d6c 696b  eries : dict-lik
+0004f4e0: 652c 206f 7074 696f 6e61 6c0a 2020 2020  e, optional.    
+0004f4f0: 2020 2020 2020 2020 4120 6469 6374 2d6c          A dict-l
+0004f500: 696b 6520 7769 7468 206b 6579 7320 6d61  ike with keys ma
+0004f510: 7463 6869 6e67 2064 696d 656e 7369 6f6e  tching dimension
+0004f520: 7320 616e 6420 7661 6c75 6573 2067 6976  s and values giv
+0004f530: 656e 2062 7920 7374 7269 6e67 730a 2020  en by strings.  
+0004f540: 2020 2020 2020 2020 2020 636f 6e74 6169            contai
+0004f550: 6e69 6e67 2050 7974 686f 6e20 6578 7072  ning Python expr
+0004f560: 6573 7369 6f6e 7320 746f 2062 6520 6576  essions to be ev
+0004f570: 616c 7561 7465 6420 6167 6169 6e73 7420  aluated against 
+0004f580: 7468 6520 6461 7461 2076 6172 6961 626c  the data variabl
+0004f590: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
+0004f5a0: 6e20 7468 6520 6461 7461 7365 742e 2054  n the dataset. T
+0004f5b0: 6865 2065 7870 7265 7373 696f 6e73 2077  he expressions w
+0004f5c0: 696c 6c20 6265 2065 7661 6c75 6174 6564  ill be evaluated
+0004f5d0: 2075 7369 6e67 2074 6865 2070 616e 6461   using the panda
+0004f5e0: 730a 2020 2020 2020 2020 2020 2020 6576  s.            ev
+0004f5f0: 616c 2829 2066 756e 6374 696f 6e2c 2061  al() function, a
+0004f600: 6e64 2063 616e 2063 6f6e 7461 696e 2061  nd can contain a
+0004f610: 6e79 2076 616c 6964 2050 7974 686f 6e20  ny valid Python 
+0004f620: 6578 7072 6573 7369 6f6e 7320 6275 7420  expressions but 
+0004f630: 6361 6e6e 6f74 0a20 2020 2020 2020 2020  cannot.         
+0004f640: 2020 2063 6f6e 7461 696e 2061 6e79 2050     contain any P
+0004f650: 7974 686f 6e20 7374 6174 656d 656e 7473  ython statements
+0004f660: 2e0a 2020 2020 2020 2020 7061 7273 6572  ..        parser
+0004f670: 203a 207b 2270 616e 6461 7322 2c20 2270   : {"pandas", "p
+0004f680: 7974 686f 6e22 7d2c 2064 6566 6175 6c74  ython"}, default
+0004f690: 3a20 2270 616e 6461 7322 0a20 2020 2020  : "pandas".     
+0004f6a0: 2020 2020 2020 2054 6865 2070 6172 7365         The parse
+0004f6b0: 7220 746f 2075 7365 2074 6f20 636f 6e73  r to use to cons
+0004f6c0: 7472 7563 7420 7468 6520 7379 6e74 6178  truct the syntax
+0004f6d0: 2074 7265 6520 6672 6f6d 2074 6865 2065   tree from the e
+0004f6e0: 7870 7265 7373 696f 6e2e 0a20 2020 2020  xpression..     
+0004f6f0: 2020 2020 2020 2054 6865 2064 6566 6175         The defau
+0004f700: 6c74 206f 6620 2770 616e 6461 7327 2070  lt of 'pandas' p
+0004f710: 6172 7365 7320 636f 6465 2073 6c69 6768  arses code sligh
+0004f720: 746c 7920 6469 6666 6572 656e 7420 7468  tly different th
+0004f730: 616e 2073 7461 6e64 6172 640a 2020 2020  an standard.    
+0004f740: 2020 2020 2020 2020 5079 7468 6f6e 2e20          Python. 
+0004f750: 416c 7465 726e 6174 6976 656c 792c 2079  Alternatively, y
+0004f760: 6f75 2063 616e 2070 6172 7365 2061 6e20  ou can parse an 
+0004f770: 6578 7072 6573 7369 6f6e 2075 7369 6e67  expression using
+0004f780: 2074 6865 2027 7079 7468 6f6e 270a 2020   the 'python'.  
+0004f790: 2020 2020 2020 2020 2020 7061 7273 6572            parser
+0004f7a0: 2074 6f20 7265 7461 696e 2073 7472 6963   to retain stric
+0004f7b0: 7420 5079 7468 6f6e 2073 656d 616e 7469  t Python semanti
+0004f7c0: 6373 2e0a 2020 2020 2020 2020 656e 6769  cs..        engi
+0004f7d0: 6e65 203a 207b 2270 7974 686f 6e22 2c20  ne : {"python", 
+0004f7e0: 226e 756d 6578 7072 222c 204e 6f6e 657d  "numexpr", None}
+0004f7f0: 2c20 6465 6661 756c 743a 204e 6f6e 650a  , default: None.
+0004f800: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0004f810: 656e 6769 6e65 2075 7365 6420 746f 2065  engine used to e
+0004f820: 7661 6c75 6174 6520 7468 6520 6578 7072  valuate the expr
+0004f830: 6573 7369 6f6e 2e20 5375 7070 6f72 7465  ession. Supporte
+0004f840: 6420 656e 6769 6e65 7320 6172 653a 0a0a  d engines are:..
+0004f850: 2020 2020 2020 2020 2020 2020 2d20 4e6f              - No
+0004f860: 6e65 3a20 7472 6965 7320 746f 2075 7365  ne: tries to use
+0004f870: 206e 756d 6578 7072 2c20 6661 6c6c 7320   numexpr, falls 
+0004f880: 6261 636b 2074 6f20 7079 7468 6f6e 0a20  back to python. 
+0004f890: 2020 2020 2020 2020 2020 202d 2022 6e75             - "nu
+0004f8a0: 6d65 7870 7222 3a20 6576 616c 7561 7465  mexpr": evaluate
+0004f8b0: 7320 6578 7072 6573 7369 6f6e 7320 7573  s expressions us
+0004f8c0: 696e 6720 6e75 6d65 7870 720a 2020 2020  ing numexpr.    
+0004f8d0: 2020 2020 2020 2020 2d20 2270 7974 686f          - "pytho
+0004f8e0: 6e22 3a20 7065 7266 6f72 6d73 206f 7065  n": performs ope
+0004f8f0: 7261 7469 6f6e 7320 6173 2069 6620 796f  rations as if yo
+0004f900: 7520 6861 6420 6576 616c e280 9964 2069  u had eval...d i
+0004f910: 6e20 746f 7020 6c65 7665 6c20 7079 7468  n top level pyth
+0004f920: 6f6e 0a0a 2020 2020 2020 2020 6d69 7373  on..        miss
+0004f930: 696e 675f 6469 6d73 203a 207b 2272 6169  ing_dims : {"rai
+0004f940: 7365 222c 2022 7761 726e 222c 2022 6967  se", "warn", "ig
+0004f950: 6e6f 7265 227d 2c20 6465 6661 756c 743a  nore"}, default:
+0004f960: 2022 7261 6973 6522 0a20 2020 2020 2020   "raise".       
+0004f970: 2020 2020 2057 6861 7420 746f 2064 6f20       What to do 
+0004f980: 6966 2064 696d 656e 7369 6f6e 7320 7468  if dimensions th
+0004f990: 6174 2073 686f 756c 6420 6265 2073 656c  at should be sel
+0004f9a0: 6563 7465 6420 6672 6f6d 2061 7265 206e  ected from are n
+0004f9b0: 6f74 2070 7265 7365 6e74 2069 6e20 7468  ot present in th
+0004f9c0: 650a 2020 2020 2020 2020 2020 2020 4461  e.            Da
+0004f9d0: 7461 7365 743a 0a0a 2020 2020 2020 2020  taset:..        
+0004f9e0: 2020 2020 2d20 2272 6169 7365 223a 2072      - "raise": r
+0004f9f0: 6169 7365 2061 6e20 6578 6365 7074 696f  aise an exceptio
+0004fa00: 6e0a 2020 2020 2020 2020 2020 2020 2d20  n.            - 
+0004fa10: 2277 6172 6e22 3a20 7261 6973 6520 6120  "warn": raise a 
+0004fa20: 7761 726e 696e 672c 2061 6e64 2069 676e  warning, and ign
+0004fa30: 6f72 6520 7468 6520 6d69 7373 696e 6720  ore the missing 
+0004fa40: 6469 6d65 6e73 696f 6e73 0a20 2020 2020  dimensions.     
+0004fa50: 2020 2020 2020 202d 2022 6967 6e6f 7265         - "ignore
+0004fa60: 223a 2069 676e 6f72 6520 7468 6520 6d69  ": ignore the mi
+0004fa70: 7373 696e 6720 6469 6d65 6e73 696f 6e73  ssing dimensions
+0004fa80: 0a0a 2020 2020 2020 2020 2a2a 7175 6572  ..        **quer
+0004fa90: 6965 735f 6b77 6172 6773 203a 207b 6469  ies_kwargs : {di
+0004faa0: 6d3a 2071 7565 7279 2c20 2e2e 2e7d 2c20  m: query, ...}, 
+0004fab0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0004fac0: 2020 2020 2054 6865 206b 6579 776f 7264       The keyword
+0004fad0: 2061 7267 756d 656e 7473 2066 6f72 6d20   arguments form 
+0004fae0: 6f66 2060 6071 7565 7269 6573 6060 2e0a  of ``queries``..
+0004faf0: 2020 2020 2020 2020 2020 2020 4f6e 6520              One 
+0004fb00: 6f66 2071 7565 7269 6573 206f 7220 7175  of queries or qu
+0004fb10: 6572 6965 735f 6b77 6172 6773 206d 7573  eries_kwargs mus
+0004fb20: 7420 6265 2070 726f 7669 6465 642e 0a0a  t be provided...
+0004fb30: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+0004fb40: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+0004fb50: 2020 2020 2020 2020 6f62 6a20 3a20 4461          obj : Da
+0004fb60: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
+0004fb70: 2020 4120 6e65 7720 4461 7461 7365 7420    A new Dataset 
+0004fb80: 7769 7468 2074 6865 2073 616d 6520 636f  with the same co
+0004fb90: 6e74 656e 7473 2061 7320 7468 6973 2064  ntents as this d
+0004fba0: 6174 6173 6574 2c20 6578 6365 7074 2065  ataset, except e
+0004fbb0: 6163 680a 2020 2020 2020 2020 2020 2020  ach.            
+0004fbc0: 6172 7261 7920 616e 6420 6469 6d65 6e73  array and dimens
+0004fbd0: 696f 6e20 6973 2069 6e64 6578 6564 2062  ion is indexed b
+0004fbe0: 7920 7468 6520 7265 7375 6c74 7320 6f66  y the results of
+0004fbf0: 2074 6865 2061 7070 726f 7072 6961 7465   the appropriate
+0004fc00: 0a20 2020 2020 2020 2020 2020 2071 7565  .            que
+0004fc10: 7269 6573 2e0a 0a20 2020 2020 2020 2053  ries...        S
+0004fc20: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+0004fc30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0004fc40: 2044 6174 6173 6574 2e69 7365 6c0a 2020   Dataset.isel.  
+0004fc50: 2020 2020 2020 7061 6e64 6173 2e65 7661        pandas.eva
+0004fc60: 6c0a 0a20 2020 2020 2020 2045 7861 6d70  l..        Examp
+0004fc70: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
+0004fc80: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
+0004fc90: 2061 203d 206e 702e 6172 616e 6765 2830   a = np.arange(0
+0004fca0: 2c20 352c 2031 290a 2020 2020 2020 2020  , 5, 1).        
+0004fcb0: 3e3e 3e20 6220 3d20 6e70 2e6c 696e 7370  >>> b = np.linsp
+0004fcc0: 6163 6528 302c 2031 2c20 3529 0a20 2020  ace(0, 1, 5).   
+0004fcd0: 2020 2020 203e 3e3e 2064 7320 3d20 7872       >>> ds = xr
+0004fce0: 2e44 6174 6173 6574 287b 2261 223a 2028  .Dataset({"a": (
+0004fcf0: 2278 222c 2061 292c 2022 6222 3a20 2822  "x", a), "b": ("
+0004fd00: 7822 2c20 6229 7d29 0a20 2020 2020 2020  x", b)}).       
+0004fd10: 203e 3e3e 2064 730a 2020 2020 2020 2020   >>> ds.        
+0004fd20: 3c78 6172 7261 792e 4461 7461 7365 743e  <xarray.Dataset>
+0004fd30: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+0004fd40: 6f6e 733a 2020 2878 3a20 3529 0a20 2020  ons:  (x: 5).   
+0004fd50: 2020 2020 2044 696d 656e 7369 6f6e 7320       Dimensions 
+0004fd60: 7769 7468 6f75 7420 636f 6f72 6469 6e61  without coordina
+0004fd70: 7465 733a 2078 0a20 2020 2020 2020 2044  tes: x.        D
+0004fd80: 6174 6120 7661 7269 6162 6c65 733a 0a20  ata variables:. 
+0004fd90: 2020 2020 2020 2020 2020 2061 2020 2020             a    
+0004fda0: 2020 2020 2878 2920 696e 7436 3420 3020      (x) int64 0 
+0004fdb0: 3120 3220 3320 340a 2020 2020 2020 2020  1 2 3 4.        
+0004fdc0: 2020 2020 6220 2020 2020 2020 2028 7829      b        (x)
+0004fdd0: 2066 6c6f 6174 3634 2030 2e30 2030 2e32   float64 0.0 0.2
+0004fde0: 3520 302e 3520 302e 3735 2031 2e30 0a20  5 0.5 0.75 1.0. 
+0004fdf0: 2020 2020 2020 203e 3e3e 2064 732e 7175         >>> ds.qu
+0004fe00: 6572 7928 783d 2261 203e 2032 2229 0a20  ery(x="a > 2"). 
+0004fe10: 2020 2020 2020 203c 7861 7272 6179 2e44         <xarray.D
+0004fe20: 6174 6173 6574 3e0a 2020 2020 2020 2020  ataset>.        
+0004fe30: 4469 6d65 6e73 696f 6e73 3a20 2028 783a  Dimensions:  (x:
+0004fe40: 2032 290a 2020 2020 2020 2020 4469 6d65   2).        Dime
+0004fe50: 6e73 696f 6e73 2077 6974 686f 7574 2063  nsions without c
+0004fe60: 6f6f 7264 696e 6174 6573 3a20 780a 2020  oordinates: x.  
+0004fe70: 2020 2020 2020 4461 7461 2076 6172 6961        Data varia
+0004fe80: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+0004fe90: 2020 6120 2020 2020 2020 2028 7829 2069    a        (x) i
+0004fea0: 6e74 3634 2033 2034 0a20 2020 2020 2020  nt64 3 4.       
+0004feb0: 2020 2020 2062 2020 2020 2020 2020 2878       b        (x
+0004fec0: 2920 666c 6f61 7436 3420 302e 3735 2031  ) float64 0.75 1
+0004fed0: 2e30 0a20 2020 2020 2020 2022 2222 0a0a  .0.        """..
+0004fee0: 2020 2020 2020 2020 2320 616c 6c6f 7720          # allow 
+0004fef0: 7175 6572 6965 7320 746f 2062 6520 6769  queries to be gi
+0004ff00: 7665 6e20 6569 7468 6572 2061 7320 6120  ven either as a 
+0004ff10: 6469 6374 206f 7220 6173 206b 7761 7267  dict or as kwarg
+0004ff20: 730a 2020 2020 2020 2020 7175 6572 6965  s.        querie
+0004ff30: 7320 3d20 6569 7468 6572 5f64 6963 745f  s = either_dict_
+0004ff40: 6f72 5f6b 7761 7267 7328 7175 6572 6965  or_kwargs(querie
+0004ff50: 732c 2071 7565 7269 6573 5f6b 7761 7267  s, queries_kwarg
+0004ff60: 732c 2022 7175 6572 7922 290a 0a20 2020  s, "query")..   
+0004ff70: 2020 2020 2023 2063 6865 636b 2071 7565       # check que
+0004ff80: 7269 6573 0a20 2020 2020 2020 2066 6f72  ries.        for
+0004ff90: 2064 696d 2c20 6578 7072 2069 6e20 7175   dim, expr in qu
+0004ffa0: 6572 6965 732e 6974 656d 7328 293a 0a20  eries.items():. 
+0004ffb0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0004ffc0: 7420 6973 696e 7374 616e 6365 2865 7870  t isinstance(exp
+0004ffd0: 722c 2073 7472 293a 0a20 2020 2020 2020  r, str):.       
+0004ffe0: 2020 2020 2020 2020 206d 7367 203d 2066           msg = f
+0004fff0: 2265 7870 7220 666f 7220 6469 6d20 7b64  "expr for dim {d
+00050000: 696d 7d20 6d75 7374 2062 6520 6120 7374  im} must be a st
+00050010: 7269 6e67 2074 6f20 6265 2065 7661 6c75  ring to be evalu
+00050020: 6174 6564 2c20 7b74 7970 6528 6578 7072  ated, {type(expr
+00050030: 297d 2067 6976 656e 220a 2020 2020 2020  )} given".      
+00050040: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00050050: 5661 6c75 6545 7272 6f72 286d 7367 290a  ValueError(msg).
+00050060: 0a20 2020 2020 2020 2023 2065 7661 6c75  .        # evalu
+00050070: 6174 6520 7468 6520 7175 6572 6965 7320  ate the queries 
+00050080: 746f 2063 7265 6174 6520 7468 6520 696e  to create the in
+00050090: 6465 7865 7273 0a20 2020 2020 2020 2069  dexers.        i
+000500a0: 6e64 6578 6572 7320 3d20 7b0a 2020 2020  ndexers = {.    
+000500b0: 2020 2020 2020 2020 6469 6d3a 2070 642e          dim: pd.
+000500c0: 6576 616c 2865 7870 722c 2072 6573 6f6c  eval(expr, resol
+000500d0: 7665 7273 3d5b 7365 6c66 5d2c 2070 6172  vers=[self], par
+000500e0: 7365 723d 7061 7273 6572 2c20 656e 6769  ser=parser, engi
+000500f0: 6e65 3d65 6e67 696e 6529 0a20 2020 2020  ne=engine).     
+00050100: 2020 2020 2020 2066 6f72 2064 696d 2c20         for dim, 
+00050110: 6578 7072 2069 6e20 7175 6572 6965 732e  expr in queries.
+00050120: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
+00050130: 7d0a 0a20 2020 2020 2020 2023 2061 7070  }..        # app
+00050140: 6c79 2074 6865 2073 656c 6563 7469 6f6e  ly the selection
+00050150: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00050160: 7365 6c66 2e69 7365 6c28 696e 6465 7865  self.isel(indexe
+00050170: 7273 2c20 6d69 7373 696e 675f 6469 6d73  rs, missing_dims
+00050180: 3d6d 6973 7369 6e67 5f64 696d 7329 0a0a  =missing_dims)..
+00050190: 2020 2020 6465 6620 6375 7276 6566 6974      def curvefit
+000501a0: 280a 2020 2020 2020 2020 7365 6c66 3a20  (.        self: 
+000501b0: 545f 4461 7461 7365 742c 0a20 2020 2020  T_Dataset,.     
+000501c0: 2020 2063 6f6f 7264 733a 2073 7472 207c     coords: str |
+000501d0: 2044 6174 6141 7272 6179 207c 2049 7465   DataArray | Ite
+000501e0: 7261 626c 655b 7374 7220 7c20 4461 7461  rable[str | Data
+000501f0: 4172 7261 795d 2c0a 2020 2020 2020 2020  Array],.        
+00050200: 6675 6e63 3a20 4361 6c6c 6162 6c65 5b2e  func: Callable[.
+00050210: 2e2e 2c20 416e 795d 2c0a 2020 2020 2020  .., Any],.      
+00050220: 2020 7265 6475 6365 5f64 696d 733a 2044    reduce_dims: D
+00050230: 696d 7320 3d20 4e6f 6e65 2c0a 2020 2020  ims = None,.    
+00050240: 2020 2020 736b 6970 6e61 3a20 626f 6f6c      skipna: bool
+00050250: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+00050260: 2070 303a 2064 6963 745b 7374 722c 2041   p0: dict[str, A
+00050270: 6e79 5d20 7c20 4e6f 6e65 203d 204e 6f6e  ny] | None = Non
+00050280: 652c 0a20 2020 2020 2020 2062 6f75 6e64  e,.        bound
+00050290: 733a 2064 6963 745b 7374 722c 2041 6e79  s: dict[str, Any
+000502a0: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+000502b0: 0a20 2020 2020 2020 2070 6172 616d 5f6e  .        param_n
+000502c0: 616d 6573 3a20 5365 7175 656e 6365 5b73  ames: Sequence[s
+000502d0: 7472 5d20 7c20 4e6f 6e65 203d 204e 6f6e  tr] | None = Non
+000502e0: 652c 0a20 2020 2020 2020 206b 7761 7267  e,.        kwarg
+000502f0: 733a 2064 6963 745b 7374 722c 2041 6e79  s: dict[str, Any
+00050300: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
+00050310: 0a20 2020 2029 202d 3e20 545f 4461 7461  .    ) -> T_Data
+00050320: 7365 743a 0a20 2020 2020 2020 2022 2222  set:.        """
+00050330: 0a20 2020 2020 2020 2043 7572 7665 2066  .        Curve f
+00050340: 6974 7469 6e67 206f 7074 696d 697a 6174  itting optimizat
+00050350: 696f 6e20 666f 7220 6172 6269 7472 6172  ion for arbitrar
+00050360: 7920 6675 6e63 7469 6f6e 732e 0a0a 2020  y functions...  
+00050370: 2020 2020 2020 5772 6170 7320 6073 6369        Wraps `sci
+00050380: 7079 2e6f 7074 696d 697a 652e 6375 7276  py.optimize.curv
+00050390: 655f 6669 7460 2077 6974 6820 6061 7070  e_fit` with `app
+000503a0: 6c79 5f75 6675 6e63 602e 0a0a 2020 2020  ly_ufunc`...    
+000503b0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+000503c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+000503d0: 2d0a 2020 2020 2020 2020 636f 6f72 6473  -.        coords
+000503e0: 203a 2068 6173 6861 626c 652c 2044 6174   : hashable, Dat
+000503f0: 6141 7272 6179 2c20 6f72 2073 6571 7565  aArray, or seque
+00050400: 6e63 6520 6f66 2068 6173 6861 626c 6520  nce of hashable 
+00050410: 6f72 2044 6174 6141 7272 6179 0a20 2020  or DataArray.   
+00050420: 2020 2020 2020 2020 2049 6e64 6570 656e           Indepen
+00050430: 6465 6e74 2063 6f6f 7264 696e 6174 6528  dent coordinate(
+00050440: 7329 206f 7665 7220 7768 6963 6820 746f  s) over which to
+00050450: 2070 6572 666f 726d 2074 6865 2063 7572   perform the cur
+00050460: 7665 2066 6974 7469 6e67 2e20 4d75 7374  ve fitting. Must
+00050470: 2073 6861 7265 0a20 2020 2020 2020 2020   share.         
+00050480: 2020 2061 7420 6c65 6173 7420 6f6e 6520     at least one 
+00050490: 6469 6d65 6e73 696f 6e20 7769 7468 2074  dimension with t
+000504a0: 6865 2063 616c 6c69 6e67 206f 626a 6563  he calling objec
+000504b0: 742e 2057 6865 6e20 6669 7474 696e 6720  t. When fitting 
+000504c0: 6d75 6c74 692d 6469 6d65 6e73 696f 6e61  multi-dimensiona
+000504d0: 6c0a 2020 2020 2020 2020 2020 2020 6675  l.            fu
+000504e0: 6e63 7469 6f6e 732c 2073 7570 706c 7920  nctions, supply 
+000504f0: 6063 6f6f 7264 7360 2061 7320 6120 7365  `coords` as a se
+00050500: 7175 656e 6365 2069 6e20 7468 6520 7361  quence in the sa
+00050510: 6d65 206f 7264 6572 2061 7320 6172 6775  me order as argu
+00050520: 6d65 6e74 7320 696e 0a20 2020 2020 2020  ments in.       
+00050530: 2020 2020 2060 6675 6e63 602e 2054 6f20       `func`. To 
+00050540: 6669 7420 616c 6f6e 6720 6578 6973 7469  fit along existi
+00050550: 6e67 2064 696d 656e 7369 6f6e 7320 6f66  ng dimensions of
+00050560: 2074 6865 2063 616c 6c69 6e67 206f 626a   the calling obj
+00050570: 6563 742c 2060 636f 6f72 6473 6020 6361  ect, `coords` ca
+00050580: 6e0a 2020 2020 2020 2020 2020 2020 616c  n.            al
+00050590: 736f 2062 6520 7370 6563 6966 6965 6420  so be specified 
+000505a0: 6173 2061 2073 7472 206f 7220 7365 7175  as a str or sequ
+000505b0: 656e 6365 206f 6620 7374 7273 2e0a 2020  ence of strs..  
+000505c0: 2020 2020 2020 6675 6e63 203a 2063 616c        func : cal
+000505d0: 6c61 626c 650a 2020 2020 2020 2020 2020  lable.          
+000505e0: 2020 5573 6572 2073 7065 6369 6669 6564    User specified
+000505f0: 2066 756e 6374 696f 6e20 696e 2074 6865   function in the
+00050600: 2066 6f72 6d20 6066 2878 2c20 2a70 6172   form `f(x, *par
+00050610: 616d 7329 6020 7768 6963 6820 7265 7475  ams)` which retu
+00050620: 726e 7320 6120 6e75 6d70 790a 2020 2020  rns a numpy.    
+00050630: 2020 2020 2020 2020 6172 7261 7920 6f66          array of
+00050640: 206c 656e 6774 6820 606c 656e 2878 2960   length `len(x)`
+00050650: 2e20 6070 6172 616d 7360 2061 7265 2074  . `params` are t
+00050660: 6865 2066 6974 7461 626c 6520 7061 7261  he fittable para
+00050670: 6d65 7465 7273 2077 6869 6368 2061 7265  meters which are
+00050680: 206f 7074 696d 697a 6564 0a20 2020 2020   optimized.     
+00050690: 2020 2020 2020 2062 7920 7363 6970 7920         by scipy 
+000506a0: 6375 7276 655f 6669 742e 2060 7860 2063  curve_fit. `x` c
+000506b0: 616e 2061 6c73 6f20 6265 2073 7065 6369  an also be speci
+000506c0: 6669 6564 2061 7320 6120 7365 7175 656e  fied as a sequen
+000506d0: 6365 2063 6f6e 7461 696e 696e 6720 6d75  ce containing mu
+000506e0: 6c74 6970 6c65 0a20 2020 2020 2020 2020  ltiple.         
+000506f0: 2020 2063 6f6f 7264 696e 6174 6573 2c20     coordinates, 
+00050700: 652e 672e 2060 6628 2878 302c 2078 3129  e.g. `f((x0, x1)
+00050710: 2c20 2a70 6172 616d 7329 602e 0a20 2020  , *params)`..   
+00050720: 2020 2020 2072 6564 7563 655f 6469 6d73       reduce_dims
+00050730: 203a 2073 7472 2c20 4974 6572 6162 6c65   : str, Iterable
+00050740: 206f 6620 4861 7368 6162 6c65 206f 7220   of Hashable or 
+00050750: 4e6f 6e65 2c20 6f70 7469 6f6e 616c 0a20  None, optional. 
+00050760: 2020 2020 2020 2020 2020 2041 6464 6974             Addit
+00050770: 696f 6e61 6c20 6469 6d65 6e73 696f 6e28  ional dimension(
+00050780: 7329 206f 7665 7220 7768 6963 6820 746f  s) over which to
+00050790: 2061 6767 7265 6761 7465 2077 6869 6c65   aggregate while
+000507a0: 2066 6974 7469 6e67 2e20 466f 7220 6578   fitting. For ex
+000507b0: 616d 706c 652c 0a20 2020 2020 2020 2020  ample,.         
+000507c0: 2020 2063 616c 6c69 6e67 2060 6473 2e63     calling `ds.c
+000507d0: 7572 7665 6669 7428 636f 6f72 6473 3d27  urvefit(coords='
+000507e0: 7469 6d65 272c 2072 6564 7563 655f 6469  time', reduce_di
+000507f0: 6d73 3d5b 276c 6174 272c 2027 6c6f 6e27  ms=['lat', 'lon'
+00050800: 5d2c 202e 2e2e 2960 2077 696c 6c0a 2020  ], ...)` will.  
+00050810: 2020 2020 2020 2020 2020 6167 6772 6567            aggreg
+00050820: 6174 6520 616c 6c20 6c61 7420 616e 6420  ate all lat and 
+00050830: 6c6f 6e20 706f 696e 7473 2061 6e64 2066  lon points and f
+00050840: 6974 2074 6865 2073 7065 6369 6669 6564  it the specified
+00050850: 2066 756e 6374 696f 6e20 616c 6f6e 6720   function along 
+00050860: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00050870: 7469 6d65 2064 696d 656e 7369 6f6e 2e0a  time dimension..
+00050880: 2020 2020 2020 2020 736b 6970 6e61 203a          skipna :
+00050890: 2062 6f6f 6c2c 2064 6566 6175 6c74 3a20   bool, default: 
+000508a0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000508b0: 2057 6865 7468 6572 2074 6f20 736b 6970   Whether to skip
+000508c0: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
+000508d0: 7768 656e 2066 6974 7469 6e67 2e20 4465  when fitting. De
+000508e0: 6661 756c 7420 6973 2054 7275 652e 0a20  fault is True.. 
+000508f0: 2020 2020 2020 2070 3020 3a20 6469 6374         p0 : dict
+00050900: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
+00050910: 2020 2020 2020 2020 2020 2020 4f70 7469              Opti
+00050920: 6f6e 616c 2064 6963 7469 6f6e 6172 7920  onal dictionary 
+00050930: 6f66 2070 6172 616d 6574 6572 206e 616d  of parameter nam
+00050940: 6573 2074 6f20 696e 6974 6961 6c20 6775  es to initial gu
+00050950: 6573 7365 7320 7061 7373 6564 2074 6f20  esses passed to 
+00050960: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00050970: 6063 7572 7665 5f66 6974 6020 6070 3060  `curve_fit` `p0`
+00050980: 2061 7267 2e20 4966 206e 6f6e 6520 6f72   arg. If none or
+00050990: 206f 6e6c 7920 736f 6d65 2070 6172 616d   only some param
+000509a0: 6574 6572 7320 6172 6520 7061 7373 6564  eters are passed
+000509b0: 2c20 7468 6520 7265 7374 2077 696c 6c0a  , the rest will.
+000509c0: 2020 2020 2020 2020 2020 2020 6265 2061              be a
+000509d0: 7373 6967 6e65 6420 696e 6974 6961 6c20  ssigned initial 
+000509e0: 7661 6c75 6573 2066 6f6c 6c6f 7769 6e67  values following
+000509f0: 2074 6865 2064 6566 6175 6c74 2073 6369   the default sci
+00050a00: 7079 2062 6568 6176 696f 722e 0a20 2020  py behavior..   
+00050a10: 2020 2020 2062 6f75 6e64 7320 3a20 6469       bounds : di
+00050a20: 6374 2d6c 696b 652c 206f 7074 696f 6e61  ct-like, optiona
+00050a30: 6c0a 2020 2020 2020 2020 2020 2020 4f70  l.            Op
+00050a40: 7469 6f6e 616c 2064 6963 7469 6f6e 6172  tional dictionar
+00050a50: 7920 6f66 2070 6172 616d 6574 6572 206e  y of parameter n
+00050a60: 616d 6573 2074 6f20 626f 756e 6469 6e67  ames to bounding
+00050a70: 2076 616c 7565 7320 7061 7373 6564 2074   values passed t
+00050a80: 6f20 7468 650a 2020 2020 2020 2020 2020  o the.          
+00050a90: 2020 6063 7572 7665 5f66 6974 6020 6062    `curve_fit` `b
+00050aa0: 6f75 6e64 7360 2061 7267 2e20 4966 206e  ounds` arg. If n
+00050ab0: 6f6e 6520 6f72 206f 6e6c 7920 736f 6d65  one or only some
+00050ac0: 2070 6172 616d 6574 6572 7320 6172 6520   parameters are 
+00050ad0: 7061 7373 6564 2c20 7468 6520 7265 7374  passed, the rest
+00050ae0: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+00050af0: 6c20 6265 2075 6e62 6f75 6e64 6564 2066  l be unbounded f
+00050b00: 6f6c 6c6f 7769 6e67 2074 6865 2064 6566  ollowing the def
+00050b10: 6175 6c74 2073 6369 7079 2062 6568 6176  ault scipy behav
+00050b20: 696f 722e 0a20 2020 2020 2020 2070 6172  ior..        par
+00050b30: 616d 5f6e 616d 6573 203a 2073 6571 7565  am_names : seque
+00050b40: 6e63 6520 6f66 2068 6173 6861 626c 652c  nce of hashable,
+00050b50: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00050b60: 2020 2020 2020 5365 7175 656e 6365 206f        Sequence o
+00050b70: 6620 6e61 6d65 7320 666f 7220 7468 6520  f names for the 
+00050b80: 6669 7474 6162 6c65 2070 6172 616d 6574  fittable paramet
+00050b90: 6572 7320 6f66 2060 6675 6e63 602e 2049  ers of `func`. I
+00050ba0: 6620 6e6f 7420 7375 7070 6c69 6564 2c0a  f not supplied,.
+00050bb0: 2020 2020 2020 2020 2020 2020 7468 6973              this
+00050bc0: 2077 696c 6c20 6265 2061 7574 6f6d 6174   will be automat
+00050bd0: 6963 616c 6c79 2064 6574 6572 6d69 6e65  ically determine
+00050be0: 6420 6279 2061 7267 756d 656e 7473 206f  d by arguments o
+00050bf0: 6620 6066 756e 6360 2e20 6070 6172 616d  f `func`. `param
+00050c00: 5f6e 616d 6573 600a 2020 2020 2020 2020  _names`.        
+00050c10: 2020 2020 7368 6f75 6c64 2062 6520 6d61      should be ma
+00050c20: 6e75 616c 6c79 2073 7570 706c 6965 6420  nually supplied 
+00050c30: 7768 656e 2066 6974 7469 6e67 2061 2066  when fitting a f
+00050c40: 756e 6374 696f 6e20 7468 6174 2074 616b  unction that tak
+00050c50: 6573 2061 2076 6172 6961 626c 650a 2020  es a variable.  
+00050c60: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
+00050c70: 206f 6620 7061 7261 6d65 7465 7273 2e0a   of parameters..
+00050c80: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+00050c90: 203a 206f 7074 696f 6e61 6c0a 2020 2020   : optional.    
+00050ca0: 2020 2020 2020 2020 4164 6469 7469 6f6e          Addition
+00050cb0: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
+00050cc0: 656e 7473 2074 6f20 7061 7373 6564 2074  ents to passed t
+00050cd0: 6f20 7363 6970 7920 6375 7276 655f 6669  o scipy curve_fi
+00050ce0: 742e 0a0a 2020 2020 2020 2020 5265 7475  t...        Retu
+00050cf0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00050d00: 2d2d 2d0a 2020 2020 2020 2020 6375 7276  ---.        curv
+00050d10: 6566 6974 5f72 6573 756c 7473 203a 2044  efit_results : D
+00050d20: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+00050d30: 2020 2041 2073 696e 676c 6520 6461 7461     A single data
+00050d40: 7365 7420 7768 6963 6820 636f 6e74 6169  set which contai
+00050d50: 6e73 3a0a 0a20 2020 2020 2020 2020 2020  ns:..           
+00050d60: 205b 7661 725d 5f63 7572 7665 6669 745f   [var]_curvefit_
+00050d70: 636f 6566 6669 6369 656e 7473 0a20 2020  coefficients.   
+00050d80: 2020 2020 2020 2020 2020 2020 2054 6865               The
+00050d90: 2063 6f65 6666 6963 6965 6e74 7320 6f66   coefficients of
+00050da0: 2074 6865 2062 6573 7420 6669 742e 0a20   the best fit.. 
+00050db0: 2020 2020 2020 2020 2020 205b 7661 725d             [var]
+00050dc0: 5f63 7572 7665 6669 745f 636f 7661 7269  _curvefit_covari
+00050dd0: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
+00050de0: 2020 2020 2054 6865 2063 6f76 6172 6961       The covaria
+00050df0: 6e63 6520 6d61 7472 6978 206f 6620 7468  nce matrix of th
+00050e00: 6520 636f 6566 6669 6369 656e 7420 6573  e coefficient es
+00050e10: 7469 6d61 7465 732e 0a0a 2020 2020 2020  timates...      
+00050e20: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00050e30: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00050e40: 2020 2020 4461 7461 7365 742e 706f 6c79      Dataset.poly
+00050e50: 6669 740a 2020 2020 2020 2020 7363 6970  fit.        scip
+00050e60: 792e 6f70 7469 6d69 7a65 2e63 7572 7665  y.optimize.curve
+00050e70: 5f66 6974 0a20 2020 2020 2020 2022 2222  _fit.        """
+00050e80: 0a20 2020 2020 2020 2066 726f 6d20 7363  .        from sc
+00050e90: 6970 792e 6f70 7469 6d69 7a65 2069 6d70  ipy.optimize imp
+00050ea0: 6f72 7420 6375 7276 655f 6669 740a 0a20  ort curve_fit.. 
+00050eb0: 2020 2020 2020 2066 726f 6d20 7861 7272         from xarr
+00050ec0: 6179 2e63 6f72 652e 616c 6967 6e6d 656e  ay.core.alignmen
+00050ed0: 7420 696d 706f 7274 2062 726f 6164 6361  t import broadca
+00050ee0: 7374 0a20 2020 2020 2020 2066 726f 6d20  st.        from 
+00050ef0: 7861 7272 6179 2e63 6f72 652e 636f 6d70  xarray.core.comp
+00050f00: 7574 6174 696f 6e20 696d 706f 7274 2061  utation import a
+00050f10: 7070 6c79 5f75 6675 6e63 0a20 2020 2020  pply_ufunc.     
+00050f20: 2020 2066 726f 6d20 7861 7272 6179 2e63     from xarray.c
+00050f30: 6f72 652e 6461 7461 6172 7261 7920 696d  ore.dataarray im
+00050f40: 706f 7274 205f 5448 4953 5f41 5252 4159  port _THIS_ARRAY
+00050f50: 2c20 4461 7461 4172 7261 790a 0a20 2020  , DataArray..   
+00050f60: 2020 2020 2069 6620 7030 2069 7320 4e6f       if p0 is No
+00050f70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00050f80: 7030 203d 207b 7d0a 2020 2020 2020 2020  p0 = {}.        
+00050f90: 6966 2062 6f75 6e64 7320 6973 204e 6f6e  if bounds is Non
+00050fa0: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
+00050fb0: 6f75 6e64 7320 3d20 7b7d 0a20 2020 2020  ounds = {}.     
+00050fc0: 2020 2069 6620 6b77 6172 6773 2069 7320     if kwargs is 
+00050fd0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00050fe0: 2020 6b77 6172 6773 203d 207b 7d0a 0a20    kwargs = {}.. 
+00050ff0: 2020 2020 2020 2072 6564 7563 655f 6469         reduce_di
+00051000: 6d73 5f3a 206c 6973 745b 4861 7368 6162  ms_: list[Hashab
+00051010: 6c65 5d0a 2020 2020 2020 2020 6966 206e  le].        if n
+00051020: 6f74 2072 6564 7563 655f 6469 6d73 3a0a  ot reduce_dims:.
+00051030: 2020 2020 2020 2020 2020 2020 7265 6475              redu
+00051040: 6365 5f64 696d 735f 203d 205b 5d0a 2020  ce_dims_ = [].  
+00051050: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+00051060: 7461 6e63 6528 7265 6475 6365 5f64 696d  tance(reduce_dim
+00051070: 732c 2073 7472 2920 6f72 206e 6f74 2069  s, str) or not i
+00051080: 7369 6e73 7461 6e63 6528 7265 6475 6365  sinstance(reduce
+00051090: 5f64 696d 732c 2049 7465 7261 626c 6529  _dims, Iterable)
+000510a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000510b0: 6475 6365 5f64 696d 735f 203d 205b 7265  duce_dims_ = [re
+000510c0: 6475 6365 5f64 696d 735d 0a20 2020 2020  duce_dims].     
+000510d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000510e0: 2020 2020 2072 6564 7563 655f 6469 6d73       reduce_dims
+000510f0: 5f20 3d20 6c69 7374 2872 6564 7563 655f  _ = list(reduce_
+00051100: 6469 6d73 290a 0a20 2020 2020 2020 2069  dims)..        i
+00051110: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+00051120: 6973 696e 7374 616e 6365 2863 6f6f 7264  isinstance(coord
+00051130: 732c 2073 7472 290a 2020 2020 2020 2020  s, str).        
+00051140: 2020 2020 6f72 2069 7369 6e73 7461 6e63      or isinstanc
+00051150: 6528 636f 6f72 6473 2c20 4461 7461 4172  e(coords, DataAr
+00051160: 7261 7929 0a20 2020 2020 2020 2020 2020  ray).           
+00051170: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
+00051180: 6365 2863 6f6f 7264 732c 2049 7465 7261  ce(coords, Itera
+00051190: 626c 6529 0a20 2020 2020 2020 2029 3a0a  ble).        ):.
+000511a0: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
+000511b0: 6473 203d 205b 636f 6f72 6473 5d0a 2020  ds = [coords].  
+000511c0: 2020 2020 2020 636f 6f72 6473 5f3a 2053        coords_: S
+000511d0: 6571 7565 6e63 655b 4461 7461 4172 7261  equence[DataArra
+000511e0: 795d 203d 205b 0a20 2020 2020 2020 2020  y] = [.         
+000511f0: 2020 2073 656c 665b 636f 6f72 645d 2069     self[coord] i
+00051200: 6620 6973 696e 7374 616e 6365 2863 6f6f  f isinstance(coo
+00051210: 7264 2c20 7374 7229 2065 6c73 6520 636f  rd, str) else co
+00051220: 6f72 6420 666f 7220 636f 6f72 6420 696e  ord for coord in
+00051230: 2063 6f6f 7264 730a 2020 2020 2020 2020   coords.        
+00051240: 5d0a 0a20 2020 2020 2020 2023 2044 6574  ]..        # Det
+00051250: 6572 6d69 6e65 2077 6865 7468 6572 2061  ermine whether a
+00051260: 6e79 2063 6f6f 7264 7320 6172 6520 6469  ny coords are di
+00051270: 6d73 206f 6e20 7365 6c66 0a20 2020 2020  ms on self.     
+00051280: 2020 2066 6f72 2063 6f6f 7264 2069 6e20     for coord in 
+00051290: 636f 6f72 6473 5f3a 0a20 2020 2020 2020  coords_:.       
+000512a0: 2020 2020 2072 6564 7563 655f 6469 6d73       reduce_dims
+000512b0: 5f20 2b3d 205b 6320 666f 7220 6320 696e  _ += [c for c in
+000512c0: 2073 656c 662e 6469 6d73 2069 6620 636f   self.dims if co
+000512d0: 6f72 642e 6571 7561 6c73 2873 656c 665b  ord.equals(self[
+000512e0: 635d 295d 0a20 2020 2020 2020 2072 6564  c])].        red
+000512f0: 7563 655f 6469 6d73 5f20 3d20 6c69 7374  uce_dims_ = list
+00051300: 2873 6574 2872 6564 7563 655f 6469 6d73  (set(reduce_dims
+00051310: 5f29 290a 2020 2020 2020 2020 7072 6573  _)).        pres
+00051320: 6572 7665 645f 6469 6d73 203d 206c 6973  erved_dims = lis
+00051330: 7428 7365 7428 7365 6c66 2e64 696d 7329  t(set(self.dims)
+00051340: 202d 2073 6574 2872 6564 7563 655f 6469   - set(reduce_di
+00051350: 6d73 5f29 290a 2020 2020 2020 2020 6966  ms_)).        if
+00051360: 206e 6f74 2072 6564 7563 655f 6469 6d73   not reduce_dims
+00051370: 5f3a 0a20 2020 2020 2020 2020 2020 2072  _:.            r
+00051380: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00051390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000513a0: 2022 4e6f 2061 7267 756d 656e 7473 2074   "No arguments t
+000513b0: 6f20 6063 6f6f 7264 7360 2077 6572 6520  o `coords` were 
+000513c0: 6964 656e 7469 6669 6564 2061 7320 6120  identified as a 
+000513d0: 6469 6d65 6e73 696f 6e20 6f6e 2074 6865  dimension on the
+000513e0: 2063 616c 6c69 6e67 2022 0a20 2020 2020   calling ".     
+000513f0: 2020 2020 2020 2020 2020 2022 6f62 6a65             "obje
+00051400: 6374 2c20 616e 6420 6e6f 2064 696d 7320  ct, and no dims 
+00051410: 7765 7265 2073 7570 706c 6965 6420 746f  were supplied to
+00051420: 2060 7265 6475 6365 5f64 696d 7360 2e20   `reduce_dims`. 
+00051430: 5468 6973 2077 6f75 6c64 2072 6573 756c  This would resul
+00051440: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
+00051450: 2020 2020 2269 6e20 6669 7474 696e 6720      "in fitting 
+00051460: 6f6e 2073 6361 6c61 7220 6461 7461 2e22  on scalar data."
+00051470: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00051480: 2020 2020 2020 2020 2320 4272 6f61 6463          # Broadc
+00051490: 6173 7420 616c 6c20 636f 6f72 6473 2077  ast all coords w
+000514a0: 6974 6820 6561 6368 206f 7468 6572 0a20  ith each other. 
+000514b0: 2020 2020 2020 2063 6f6f 7264 735f 203d         coords_ =
+000514c0: 2062 726f 6164 6361 7374 282a 636f 6f72   broadcast(*coor
+000514d0: 6473 5f29 0a20 2020 2020 2020 2063 6f6f  ds_).        coo
+000514e0: 7264 735f 203d 205b 0a20 2020 2020 2020  rds_ = [.       
+000514f0: 2020 2020 2063 6f6f 7264 2e62 726f 6164       coord.broad
+00051500: 6361 7374 5f6c 696b 6528 7365 6c66 2c20  cast_like(self, 
+00051510: 6578 636c 7564 653d 7072 6573 6572 7665  exclude=preserve
+00051520: 645f 6469 6d73 2920 666f 7220 636f 6f72  d_dims) for coor
+00051530: 6420 696e 2063 6f6f 7264 735f 0a20 2020  d in coords_.   
+00051540: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
+00051550: 7061 7261 6d73 2c20 6675 6e63 5f61 7267  params, func_arg
+00051560: 7320 3d20 5f67 6574 5f66 756e 635f 6172  s = _get_func_ar
+00051570: 6773 2866 756e 632c 2070 6172 616d 5f6e  gs(func, param_n
+00051580: 616d 6573 290a 2020 2020 2020 2020 7061  ames).        pa
+00051590: 7261 6d5f 6465 6661 756c 7473 2c20 626f  ram_defaults, bo
+000515a0: 756e 6473 5f64 6566 6175 6c74 7320 3d20  unds_defaults = 
+000515b0: 5f69 6e69 7469 616c 697a 655f 6375 7276  _initialize_curv
+000515c0: 6566 6974 5f70 6172 616d 7328 0a20 2020  efit_params(.   
+000515d0: 2020 2020 2020 2020 2070 6172 616d 732c           params,
+000515e0: 2070 302c 2062 6f75 6e64 732c 2066 756e   p0, bounds, fun
+000515f0: 635f 6172 6773 0a20 2020 2020 2020 2029  c_args.        )
+00051600: 0a20 2020 2020 2020 206e 5f70 6172 616d  .        n_param
+00051610: 7320 3d20 6c65 6e28 7061 7261 6d73 290a  s = len(params).
+00051620: 2020 2020 2020 2020 6b77 6172 6773 2e73          kwargs.s
+00051630: 6574 6465 6661 756c 7428 2270 3022 2c20  etdefault("p0", 
+00051640: 5b70 6172 616d 5f64 6566 6175 6c74 735b  [param_defaults[
+00051650: 705d 2066 6f72 2070 2069 6e20 7061 7261  p] for p in para
+00051660: 6d73 5d29 0a20 2020 2020 2020 206b 7761  ms]).        kwa
+00051670: 7267 732e 7365 7464 6566 6175 6c74 280a  rgs.setdefault(.
+00051680: 2020 2020 2020 2020 2020 2020 2262 6f75              "bou
+00051690: 6e64 7322 2c0a 2020 2020 2020 2020 2020  nds",.          
+000516a0: 2020 5b0a 2020 2020 2020 2020 2020 2020    [.            
+000516b0: 2020 2020 5b62 6f75 6e64 735f 6465 6661      [bounds_defa
+000516c0: 756c 7473 5b70 5d5b 305d 2066 6f72 2070  ults[p][0] for p
+000516d0: 2069 6e20 7061 7261 6d73 5d2c 0a20 2020   in params],.   
+000516e0: 2020 2020 2020 2020 2020 2020 205b 626f               [bo
+000516f0: 756e 6473 5f64 6566 6175 6c74 735b 705d  unds_defaults[p]
+00051700: 5b31 5d20 666f 7220 7020 696e 2070 6172  [1] for p in par
+00051710: 616d 735d 2c0a 2020 2020 2020 2020 2020  ams],.          
+00051720: 2020 5d2c 0a20 2020 2020 2020 2029 0a0a    ],.        )..
+00051730: 2020 2020 2020 2020 6465 6620 5f77 7261          def _wra
+00051740: 7070 6572 2859 2c20 2a63 6f6f 7264 735f  pper(Y, *coords_
+00051750: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00051760: 2020 2020 2020 2020 2023 2057 7261 7020           # Wrap 
+00051770: 6375 7276 655f 6669 7420 7769 7468 2072  curve_fit with r
+00051780: 6176 656c 6564 2063 6f6f 7264 696e 6174  aveled coordinat
+00051790: 6573 2061 6e64 2070 6f69 6e74 7769 7365  es and pointwise
+000517a0: 204e 614e 2068 616e 646c 696e 670a 2020   NaN handling.  
+000517b0: 2020 2020 2020 2020 2020 7820 3d20 6e70            x = np
+000517c0: 2e76 7374 6163 6b28 5b63 2e72 6176 656c  .vstack([c.ravel
+000517d0: 2829 2066 6f72 2063 2069 6e20 636f 6f72  () for c in coor
+000517e0: 6473 5f5d 290a 2020 2020 2020 2020 2020  ds_]).          
+000517f0: 2020 7920 3d20 592e 7261 7665 6c28 290a    y = Y.ravel().
+00051800: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00051810: 6b69 706e 613a 0a20 2020 2020 2020 2020  kipna:.         
+00051820: 2020 2020 2020 206d 6173 6b20 3d20 6e70         mask = np
+00051830: 2e61 6c6c 285b 6e70 2e61 6e79 287e 6e70  .all([np.any(~np
+00051840: 2e69 736e 616e 2878 292c 2061 7869 733d  .isnan(x), axis=
+00051850: 3029 2c20 7e6e 702e 6973 6e61 6e28 7929  0), ~np.isnan(y)
+00051860: 5d2c 2061 7869 733d 3029 0a20 2020 2020  ], axis=0).     
+00051870: 2020 2020 2020 2020 2020 2078 203d 2078             x = x
+00051880: 5b3a 2c20 6d61 736b 5d0a 2020 2020 2020  [:, mask].      
+00051890: 2020 2020 2020 2020 2020 7920 3d20 795b            y = y[
+000518a0: 6d61 736b 5d0a 2020 2020 2020 2020 2020  mask].          
+000518b0: 2020 2020 2020 6966 206e 6f74 206c 656e        if not len
+000518c0: 2879 293a 0a20 2020 2020 2020 2020 2020  (y):.           
+000518d0: 2020 2020 2020 2020 2070 6f70 7420 3d20           popt = 
+000518e0: 6e70 2e66 756c 6c28 5b6e 5f70 6172 616d  np.full([n_param
+000518f0: 735d 2c20 6e70 2e6e 616e 290a 2020 2020  s], np.nan).    
+00051900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051910: 7063 6f76 203d 206e 702e 6675 6c6c 285b  pcov = np.full([
+00051920: 6e5f 7061 7261 6d73 2c20 6e5f 7061 7261  n_params, n_para
+00051930: 6d73 5d2c 206e 702e 6e61 6e29 0a20 2020  ms], np.nan).   
+00051940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051950: 2072 6574 7572 6e20 706f 7074 2c20 7063   return popt, pc
+00051960: 6f76 0a20 2020 2020 2020 2020 2020 2078  ov.            x
+00051970: 203d 206e 702e 7371 7565 657a 6528 7829   = np.squeeze(x)
+00051980: 0a20 2020 2020 2020 2020 2020 2070 6f70  .            pop
+00051990: 742c 2070 636f 7620 3d20 6375 7276 655f  t, pcov = curve_
+000519a0: 6669 7428 6675 6e63 2c20 782c 2079 2c20  fit(func, x, y, 
+000519b0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+000519c0: 2020 2020 2020 7265 7475 726e 2070 6f70        return pop
+000519d0: 742c 2070 636f 760a 0a20 2020 2020 2020  t, pcov..       
+000519e0: 2072 6573 756c 7420 3d20 7479 7065 2873   result = type(s
+000519f0: 656c 6629 2829 0a20 2020 2020 2020 2066  elf)().        f
+00051a00: 6f72 206e 616d 652c 2064 6120 696e 2073  or name, da in s
+00051a10: 656c 662e 6461 7461 5f76 6172 732e 6974  elf.data_vars.it
+00051a20: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00051a30: 2020 2069 6620 6e61 6d65 2069 7320 5f54     if name is _T
+00051a40: 4849 535f 4152 5241 593a 0a20 2020 2020  HIS_ARRAY:.     
+00051a50: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+00051a60: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
+00051a70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00051a80: 2020 2020 2020 206e 616d 6520 3d20 6622         name = f"
+00051a90: 7b73 7472 286e 616d 6529 7d5f 220a 0a20  {str(name)}_".. 
+00051aa0: 2020 2020 2020 2020 2020 2070 6f70 742c             popt,
+00051ab0: 2070 636f 7620 3d20 6170 706c 795f 7566   pcov = apply_uf
+00051ac0: 756e 6328 0a20 2020 2020 2020 2020 2020  unc(.           
+00051ad0: 2020 2020 205f 7772 6170 7065 722c 0a20       _wrapper,. 
+00051ae0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00051af0: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+00051b00: 2020 202a 636f 6f72 6473 5f2c 0a20 2020     *coords_,.   
+00051b10: 2020 2020 2020 2020 2020 2020 2076 6563               vec
+00051b20: 746f 7269 7a65 3d54 7275 652c 0a20 2020  torize=True,.   
+00051b30: 2020 2020 2020 2020 2020 2020 2064 6173               das
+00051b40: 6b3d 2270 6172 616c 6c65 6c69 7a65 6422  k="parallelized"
+00051b50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00051b60: 2020 696e 7075 745f 636f 7265 5f64 696d    input_core_dim
+00051b70: 733d 5b72 6564 7563 655f 6469 6d73 5f20  s=[reduce_dims_ 
+00051b80: 666f 7220 6420 696e 2072 616e 6765 286c  for d in range(l
+00051b90: 656e 2863 6f6f 7264 735f 2920 2b20 3129  en(coords_) + 1)
+00051ba0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00051bb0: 2020 206f 7574 7075 745f 636f 7265 5f64     output_core_d
+00051bc0: 696d 733d 5b5b 2270 6172 616d 225d 2c20  ims=[["param"], 
+00051bd0: 5b22 636f 765f 6922 2c20 2263 6f76 5f6a  ["cov_i", "cov_j
+00051be0: 225d 5d2c 0a20 2020 2020 2020 2020 2020  "]],.           
+00051bf0: 2020 2020 2064 6173 6b5f 6775 6675 6e63       dask_gufunc
+00051c00: 5f6b 7761 7267 733d 7b0a 2020 2020 2020  _kwargs={.      
+00051c10: 2020 2020 2020 2020 2020 2020 2020 226f                "o
+00051c20: 7574 7075 745f 7369 7a65 7322 3a20 7b0a  utput_sizes": {.
+00051c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051c40: 2020 2020 2020 2020 2270 6172 616d 223a          "param":
+00051c50: 206e 5f70 6172 616d 732c 0a20 2020 2020   n_params,.     
+00051c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051c70: 2020 2022 636f 765f 6922 3a20 6e5f 7061     "cov_i": n_pa
+00051c80: 7261 6d73 2c0a 2020 2020 2020 2020 2020  rams,.          
+00051c90: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+00051ca0: 6f76 5f6a 223a 206e 5f70 6172 616d 732c  ov_j": n_params,
+00051cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051cc0: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00051cd0: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+00051ce0: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+00051cf0: 745f 6474 7970 6573 3d28 6e70 2e66 6c6f  t_dtypes=(np.flo
+00051d00: 6174 3634 2c20 6e70 2e66 6c6f 6174 3634  at64, np.float64
+00051d10: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00051d20: 2020 2065 7863 6c75 6465 5f64 696d 733d     exclude_dims=
+00051d30: 7365 7428 7265 6475 6365 5f64 696d 735f  set(reduce_dims_
+00051d40: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00051d50: 2020 206b 7761 7267 733d 6b77 6172 6773     kwargs=kwargs
+00051d60: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00051d70: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00051d80: 6c74 5b6e 616d 6520 2b20 2263 7572 7665  lt[name + "curve
+00051d90: 6669 745f 636f 6566 6669 6369 656e 7473  fit_coefficients
+00051da0: 225d 203d 2070 6f70 740a 2020 2020 2020  "] = popt.      
+00051db0: 2020 2020 2020 7265 7375 6c74 5b6e 616d        result[nam
+00051dc0: 6520 2b20 2263 7572 7665 6669 745f 636f  e + "curvefit_co
+00051dd0: 7661 7269 616e 6365 225d 203d 2070 636f  variance"] = pco
+00051de0: 760a 0a20 2020 2020 2020 2072 6573 756c  v..        resul
+00051df0: 7420 3d20 7265 7375 6c74 2e61 7373 6967  t = result.assig
+00051e00: 6e5f 636f 6f72 6473 280a 2020 2020 2020  n_coords(.      
+00051e10: 2020 2020 2020 7b22 7061 7261 6d22 3a20        {"param": 
+00051e20: 7061 7261 6d73 2c20 2263 6f76 5f69 223a  params, "cov_i":
+00051e30: 2070 6172 616d 732c 2022 636f 765f 6a22   params, "cov_j"
+00051e40: 3a20 7061 7261 6d73 7d0a 2020 2020 2020  : params}.      
+00051e50: 2020 290a 2020 2020 2020 2020 7265 7375    ).        resu
+00051e60: 6c74 2e61 7474 7273 203d 2073 656c 662e  lt.attrs = self.
+00051e70: 6174 7472 732e 636f 7079 2829 0a0a 2020  attrs.copy()..  
+00051e80: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+00051e90: 756c 740a 0a20 2020 2064 6566 2064 726f  ult..    def dro
+00051ea0: 705f 6475 706c 6963 6174 6573 280a 2020  p_duplicates(.  
+00051eb0: 2020 2020 2020 7365 6c66 3a20 545f 4461        self: T_Da
+00051ec0: 7461 7365 742c 0a20 2020 2020 2020 2064  taset,.        d
+00051ed0: 696d 3a20 4861 7368 6162 6c65 207c 2049  im: Hashable | I
+00051ee0: 7465 7261 626c 655b 4861 7368 6162 6c65  terable[Hashable
+00051ef0: 5d2c 0a20 2020 2020 2020 206b 6565 703a  ],.        keep:
+00051f00: 204c 6974 6572 616c 5b22 6669 7273 7422   Literal["first"
+00051f10: 2c20 226c 6173 7422 2c20 4661 6c73 655d  , "last", False]
+00051f20: 203d 2022 6669 7273 7422 2c0a 2020 2020   = "first",.    
+00051f30: 2920 2d3e 2054 5f44 6174 6173 6574 3a0a  ) -> T_Dataset:.
+00051f40: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00051f50: 6e73 2061 206e 6577 2044 6174 6173 6574  ns a new Dataset
+00051f60: 2077 6974 6820 6475 706c 6963 6174 6520   with duplicate 
+00051f70: 6469 6d65 6e73 696f 6e20 7661 6c75 6573  dimension values
+00051f80: 2072 656d 6f76 6564 2e0a 0a20 2020 2020   removed...     
+00051f90: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00051fa0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00051fb0: 0a20 2020 2020 2020 2064 696d 203a 2064  .        dim : d
+00051fc0: 696d 656e 7369 6f6e 206c 6162 656c 206f  imension label o
+00051fd0: 7220 6c61 6265 6c73 0a20 2020 2020 2020  r labels.       
+00051fe0: 2020 2020 2050 6173 7320 602e 2e2e 6020       Pass `...` 
+00051ff0: 746f 2064 726f 7020 6475 706c 6963 6174  to drop duplicat
+00052000: 6573 2061 6c6f 6e67 2061 6c6c 2064 696d  es along all dim
+00052010: 656e 7369 6f6e 732e 0a20 2020 2020 2020  ensions..       
+00052020: 206b 6565 7020 3a20 7b22 6669 7273 7422   keep : {"first"
+00052030: 2c20 226c 6173 7422 2c20 4661 6c73 657d  , "last", False}
+00052040: 2c20 6465 6661 756c 743a 2022 6669 7273  , default: "firs
+00052050: 7422 0a20 2020 2020 2020 2020 2020 2044  t".            D
+00052060: 6574 6572 6d69 6e65 7320 7768 6963 6820  etermines which 
+00052070: 6475 706c 6963 6174 6573 2028 6966 2061  duplicates (if a
+00052080: 6e79 2920 746f 206b 6565 702e 0a20 2020  ny) to keep..   
+00052090: 2020 2020 2020 2020 202d 2060 6022 6669           - ``"fi
+000520a0: 7273 7422 6060 203a 2044 726f 7020 6475  rst"`` : Drop du
+000520b0: 706c 6963 6174 6573 2065 7863 6570 7420  plicates except 
+000520c0: 666f 7220 7468 6520 6669 7273 7420 6f63  for the first oc
+000520d0: 6375 7272 656e 6365 2e0a 2020 2020 2020  currence..      
+000520e0: 2020 2020 2020 2d20 6060 226c 6173 7422        - ``"last"
+000520f0: 6060 203a 2044 726f 7020 6475 706c 6963  `` : Drop duplic
+00052100: 6174 6573 2065 7863 6570 7420 666f 7220  ates except for 
+00052110: 7468 6520 6c61 7374 206f 6363 7572 7265  the last occurre
+00052120: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+00052130: 202d 2046 616c 7365 203a 2044 726f 7020   - False : Drop 
+00052140: 616c 6c20 6475 706c 6963 6174 6573 2e0a  all duplicates..
+00052150: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00052160: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00052170: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+00052180: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
+00052190: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
+000521a0: 2d2d 2d0a 2020 2020 2020 2020 4461 7461  ---.        Data
+000521b0: 4172 7261 792e 6472 6f70 5f64 7570 6c69  Array.drop_dupli
+000521c0: 6361 7465 730a 2020 2020 2020 2020 2222  cates.        ""
+000521d0: 220a 2020 2020 2020 2020 6966 2069 7369  ".        if isi
+000521e0: 6e73 7461 6e63 6528 6469 6d2c 2073 7472  nstance(dim, str
+000521f0: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
+00052200: 696d 733a 2049 7465 7261 626c 6520 3d20  ims: Iterable = 
+00052210: 2864 696d 2c29 0a20 2020 2020 2020 2065  (dim,).        e
+00052220: 6c69 6620 6469 6d20 6973 202e 2e2e 3a0a  lif dim is ...:.
+00052230: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
+00052240: 203d 2073 656c 662e 6469 6d73 0a20 2020   = self.dims.   
+00052250: 2020 2020 2065 6c69 6620 6e6f 7420 6973       elif not is
+00052260: 696e 7374 616e 6365 2864 696d 2c20 4974  instance(dim, It
+00052270: 6572 6162 6c65 293a 0a20 2020 2020 2020  erable):.       
+00052280: 2020 2020 2064 696d 7320 3d20 5b64 696d       dims = [dim
+00052290: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
+000522a0: 2020 2020 2020 2020 2020 2020 6469 6d73              dims
+000522b0: 203d 2064 696d 0a0a 2020 2020 2020 2020   = dim..        
+000522c0: 6d69 7373 696e 675f 6469 6d73 203d 2073  missing_dims = s
+000522d0: 6574 2864 696d 7329 202d 2073 6574 2873  et(dims) - set(s
+000522e0: 656c 662e 6469 6d73 290a 2020 2020 2020  elf.dims).      
+000522f0: 2020 6966 206d 6973 7369 6e67 5f64 696d    if missing_dim
+00052300: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00052310: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00052320: 6622 277b 6d69 7373 696e 675f 6469 6d73  f"'{missing_dims
+00052330: 7d27 206e 6f74 2066 6f75 6e64 2069 6e20  }' not found in 
+00052340: 6469 6d65 6e73 696f 6e73 2229 0a0a 2020  dimensions")..  
+00052350: 2020 2020 2020 696e 6465 7865 7320 3d20        indexes = 
+00052360: 7b64 696d 3a20 7e73 656c 662e 6765 745f  {dim: ~self.get_
+00052370: 696e 6465 7828 6469 6d29 2e64 7570 6c69  index(dim).dupli
+00052380: 6361 7465 6428 6b65 6570 3d6b 6565 7029  cated(keep=keep)
+00052390: 2066 6f72 2064 696d 2069 6e20 6469 6d73   for dim in dims
+000523a0: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
+000523b0: 2073 656c 662e 6973 656c 2869 6e64 6578   self.isel(index
+000523c0: 6573 290a 0a20 2020 2064 6566 2063 6f6e  es)..    def con
+000523d0: 7665 7274 5f63 616c 656e 6461 7228 0a20  vert_calendar(. 
+000523e0: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+000523f0: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
+00052400: 6361 6c65 6e64 6172 3a20 4346 4361 6c65  calendar: CFCale
+00052410: 6e64 6172 2c0a 2020 2020 2020 2020 6469  ndar,.        di
+00052420: 6d3a 2048 6173 6861 626c 6520 3d20 2274  m: Hashable = "t
+00052430: 696d 6522 2c0a 2020 2020 2020 2020 616c  ime",.        al
+00052440: 6967 6e5f 6f6e 3a20 4c69 7465 7261 6c5b  ign_on: Literal[
+00052450: 2264 6174 6522 2c20 2279 6561 7222 2c20  "date", "year", 
+00052460: 4e6f 6e65 5d20 3d20 4e6f 6e65 2c0a 2020  None] = None,.  
+00052470: 2020 2020 2020 6d69 7373 696e 673a 2041        missing: A
+00052480: 6e79 207c 204e 6f6e 6520 3d20 4e6f 6e65  ny | None = None
+00052490: 2c0a 2020 2020 2020 2020 7573 655f 6366  ,.        use_cf
+000524a0: 7469 6d65 3a20 626f 6f6c 207c 204e 6f6e  time: bool | Non
+000524b0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
+000524c0: 2d3e 2054 5f44 6174 6173 6574 3a0a 2020  -> T_Dataset:.  
+000524d0: 2020 2020 2020 2222 2243 6f6e 7665 7274        """Convert
+000524e0: 2074 6865 2044 6174 6173 6574 2074 6f20   the Dataset to 
+000524f0: 616e 6f74 6865 7220 6361 6c65 6e64 6172  another calendar
+00052500: 2e0a 0a20 2020 2020 2020 204f 6e6c 7920  ...        Only 
+00052510: 636f 6e76 6572 7473 2074 6865 2069 6e64  converts the ind
+00052520: 6976 6964 7561 6c20 7469 6d65 7374 616d  ividual timestam
+00052530: 7073 2c20 646f 6573 206e 6f74 206d 6f64  ps, does not mod
+00052540: 6966 7920 616e 7920 6461 7461 2065 7863  ify any data exc
+00052550: 6570 740a 2020 2020 2020 2020 696e 2064  ept.        in d
+00052560: 726f 7070 696e 6720 696e 7661 6c69 642f  ropping invalid/
+00052570: 7375 7270 6c75 7320 6461 7465 7320 6f72  surplus dates or
+00052580: 2069 6e73 6572 7469 6e67 206d 6973 7369   inserting missi
+00052590: 6e67 2064 6174 6573 2e0a 0a20 2020 2020  ng dates...     
+000525a0: 2020 2049 6620 7468 6520 736f 7572 6365     If the source
+000525b0: 2061 6e64 2074 6172 6765 7420 6361 6c65   and target cale
+000525c0: 6e64 6172 7320 6172 6520 6569 7468 6572  ndars are either
+000525d0: 206e 6f5f 6c65 6170 2c20 616c 6c5f 6c65   no_leap, all_le
+000525e0: 6170 206f 7220 610a 2020 2020 2020 2020  ap or a.        
+000525f0: 7374 616e 6461 7264 2074 7970 652c 206f  standard type, o
+00052600: 6e6c 7920 7468 6520 7479 7065 206f 6620  nly the type of 
+00052610: 7468 6520 7469 6d65 2061 7272 6179 2069  the time array i
+00052620: 7320 6d6f 6469 6669 6564 2e0a 2020 2020  s modified..    
+00052630: 2020 2020 5768 656e 2063 6f6e 7665 7274      When convert
+00052640: 696e 6720 746f 2061 206c 6561 7020 7965  ing to a leap ye
+00052650: 6172 2066 726f 6d20 6120 6e6f 6e2d 6c65  ar from a non-le
+00052660: 6170 2079 6561 722c 2074 6865 2032 3974  ap year, the 29t
+00052670: 6820 6f66 2046 6562 7275 6172 790a 2020  h of February.  
+00052680: 2020 2020 2020 6973 2072 656d 6f76 6564        is removed
+00052690: 2066 726f 6d20 7468 6520 6172 7261 792e   from the array.
+000526a0: 2049 6e20 7468 6520 6f74 6865 7220 6469   In the other di
+000526b0: 7265 6374 696f 6e20 7468 6520 3239 7468  rection the 29th
+000526c0: 206f 6620 4665 6272 7561 7279 0a20 2020   of February.   
+000526d0: 2020 2020 2077 696c 6c20 6265 206d 6973       will be mis
+000526e0: 7369 6e67 2069 6e20 7468 6520 6f75 7470  sing in the outp
+000526f0: 7574 2c20 756e 6c65 7373 2060 6d69 7373  ut, unless `miss
+00052700: 696e 6760 2069 7320 7370 6563 6966 6965  ing` is specifie
+00052710: 642c 0a20 2020 2020 2020 2069 6e20 7768  d,.        in wh
+00052720: 6963 6820 6361 7365 2074 6861 7420 7661  ich case that va
+00052730: 6c75 6520 6973 2069 6e73 6572 7465 642e  lue is inserted.
+00052740: 0a0a 2020 2020 2020 2020 466f 7220 636f  ..        For co
+00052750: 6e76 6572 7369 6f6e 7320 696e 766f 6c76  nversions involv
+00052760: 696e 6720 6033 3630 5f64 6179 6020 6361  ing `360_day` ca
+00052770: 6c65 6e64 6172 732c 2073 6565 204e 6f74  lendars, see Not
+00052780: 6573 2e0a 0a20 2020 2020 2020 2054 6869  es...        Thi
+00052790: 7320 6d65 7468 6f64 2069 7320 7361 6665  s method is safe
+000527a0: 2074 6f20 7573 6520 7769 7468 2073 7562   to use with sub
+000527b0: 2d64 6169 6c79 2064 6174 6120 6173 2069  -daily data as i
+000527c0: 7420 646f 6573 6e27 7420 746f 7563 6820  t doesn't touch 
+000527d0: 7468 650a 2020 2020 2020 2020 7469 6d65  the.        time
+000527e0: 2070 6172 7420 6f66 2074 6865 2074 696d   part of the tim
+000527f0: 6573 7461 6d70 732e 0a0a 2020 2020 2020  estamps...      
+00052800: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00052810: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20       ---------. 
+00052820: 2020 2020 2020 2063 616c 656e 6461 7220         calendar 
+00052830: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+00052840: 2020 5468 6520 7461 7267 6574 2063 616c    The target cal
+00052850: 656e 6461 7220 6e61 6d65 2e0a 2020 2020  endar name..    
+00052860: 2020 2020 6469 6d20 3a20 4861 7368 6162      dim : Hashab
+00052870: 6c65 2c20 6465 6661 756c 743a 2022 7469  le, default: "ti
+00052880: 6d65 220a 2020 2020 2020 2020 2020 2020  me".            
+00052890: 4e61 6d65 206f 6620 7468 6520 7469 6d65  Name of the time
+000528a0: 2063 6f6f 7264 696e 6174 652e 0a20 2020   coordinate..   
+000528b0: 2020 2020 2061 6c69 676e 5f6f 6e20 3a20       align_on : 
+000528c0: 7b4e 6f6e 652c 2027 6461 7465 272c 2027  {None, 'date', '
+000528d0: 7965 6172 277d 2c20 6f70 7469 6f6e 616c  year'}, optional
+000528e0: 0a20 2020 2020 2020 2020 2020 204d 7573  .            Mus
+000528f0: 7420 6265 2073 7065 6369 6669 6564 2077  t be specified w
+00052900: 6865 6e20 6569 7468 6572 2073 6f75 7263  hen either sourc
+00052910: 6520 6f72 2074 6172 6765 7420 6973 2061  e or target is a
+00052920: 2060 3336 305f 6461 7960 2063 616c 656e   `360_day` calen
+00052930: 6461 722c 0a20 2020 2020 2020 2020 2020  dar,.           
+00052940: 2069 676e 6f72 6564 206f 7468 6572 7769   ignored otherwi
+00052950: 7365 2e20 5365 6520 4e6f 7465 732e 0a20  se. See Notes.. 
+00052960: 2020 2020 2020 206d 6973 7369 6e67 203a         missing :
+00052970: 2041 6e79 206f 7220 4e6f 6e65 2c20 6f70   Any or None, op
+00052980: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00052990: 2020 2042 7920 6465 6661 756c 742c 2069     By default, i
+000529a0: 2e65 2e20 6966 2074 6865 2076 616c 7565  .e. if the value
+000529b0: 2069 7320 4e6f 6e65 2c20 7468 6973 206d   is None, this m
+000529c0: 6574 686f 6420 7769 6c6c 2073 696d 706c  ethod will simpl
+000529d0: 7920 6174 7465 6d70 740a 2020 2020 2020  y attempt.      
+000529e0: 2020 2020 2020 746f 2063 6f6e 7665 7274        to convert
+000529f0: 2074 6865 2064 6174 6573 2069 6e20 7468   the dates in th
+00052a00: 6520 736f 7572 6365 2063 616c 656e 6461  e source calenda
+00052a10: 7220 746f 2074 6865 2073 616d 6520 6461  r to the same da
+00052a20: 7465 7320 696e 2074 6865 0a20 2020 2020  tes in the.     
+00052a30: 2020 2020 2020 2074 6172 6765 7420 6361         target ca
+00052a40: 6c65 6e64 6172 2c20 616e 6420 6472 6f70  lendar, and drop
+00052a50: 2061 6e79 206f 6620 7468 6f73 6520 7468   any of those th
+00052a60: 6174 2061 7265 206e 6f74 2070 6f73 7369  at are not possi
+00052a70: 626c 6520 746f 0a20 2020 2020 2020 2020  ble to.         
+00052a80: 2020 2072 6570 7265 7365 6e74 2e20 2049     represent.  I
+00052a90: 6620 6120 7661 6c75 6520 6973 2070 726f  f a value is pro
+00052aa0: 7669 6465 642c 2061 206e 6577 2074 696d  vided, a new tim
+00052ab0: 6520 636f 6f72 6469 6e61 7465 2077 696c  e coordinate wil
+00052ac0: 6c20 6265 0a20 2020 2020 2020 2020 2020  l be.           
+00052ad0: 2063 7265 6174 6564 2069 6e20 7468 6520   created in the 
+00052ae0: 7461 7267 6574 2063 616c 656e 6461 7220  target calendar 
+00052af0: 7769 7468 2074 6865 2073 616d 6520 6672  with the same fr
+00052b00: 6571 7565 6e63 7920 6173 2074 6865 206f  equency as the o
+00052b10: 7269 6769 6e61 6c0a 2020 2020 2020 2020  riginal.        
+00052b20: 2020 2020 7469 6d65 2063 6f6f 7264 696e      time coordin
+00052b30: 6174 653b 2066 6f72 2061 6e79 2064 6174  ate; for any dat
+00052b40: 6573 2074 6861 7420 6172 6520 6e6f 7420  es that are not 
+00052b50: 7072 6573 656e 7420 696e 2074 6865 2073  present in the s
+00052b60: 6f75 7263 652c 2074 6865 0a20 2020 2020  ource, the.     
+00052b70: 2020 2020 2020 2064 6174 6120 7769 6c6c         data will
+00052b80: 2062 6520 6669 6c6c 6564 2077 6974 6820   be filled with 
+00052b90: 7468 6973 2076 616c 7565 2e20 204e 6f74  this value.  Not
+00052ba0: 6520 7468 6174 2075 7369 6e67 2074 6869  e that using thi
+00052bb0: 7320 6d6f 6465 2072 6571 7569 7265 730a  s mode requires.
+00052bc0: 2020 2020 2020 2020 2020 2020 7468 6174              that
+00052bd0: 2074 6865 2073 6f75 7263 6520 6461 7461   the source data
+00052be0: 2068 6176 6520 616e 2069 6e66 6572 6162   have an inferab
+00052bf0: 6c65 2066 7265 7175 656e 6379 3b20 666f  le frequency; fo
+00052c00: 7220 6d6f 7265 2069 6e66 6f72 6d61 7469  r more informati
+00052c10: 6f6e 0a20 2020 2020 2020 2020 2020 2073  on.            s
+00052c20: 6565 203a 7079 3a66 756e 633a 6078 6172  ee :py:func:`xar
+00052c30: 7261 792e 696e 6665 725f 6672 6571 602e  ray.infer_freq`.
+00052c40: 2020 466f 7220 6365 7274 6169 6e20 6672    For certain fr
+00052c50: 6571 7565 6e63 792c 2073 6f75 7263 652c  equency, source,
+00052c60: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+00052c70: 2074 6172 6765 7420 6361 6c65 6e64 6172   target calendar
+00052c80: 2063 6f6d 6269 6e61 7469 6f6e 732c 2074   combinations, t
+00052c90: 6869 7320 636f 756c 6420 7265 7375 6c74  his could result
+00052ca0: 2069 6e20 6d61 6e79 206d 6973 7369 6e67   in many missing
+00052cb0: 2076 616c 7565 732c 2073 6565 206e 6f74   values, see not
+00052cc0: 6573 2e0a 2020 2020 2020 2020 7573 655f  es..        use_
+00052cd0: 6366 7469 6d65 203a 2062 6f6f 6c20 6f72  cftime : bool or
+00052ce0: 204e 6f6e 652c 206f 7074 696f 6e61 6c0a   None, optional.
+00052cf0: 2020 2020 2020 2020 2020 2020 5768 6574              Whet
+00052d00: 6865 7220 746f 2075 7365 2063 6674 696d  her to use cftim
+00052d10: 6520 6f62 6a65 6374 7320 696e 2074 6865  e objects in the
+00052d20: 206f 7574 7075 742c 206f 6e6c 7920 7573   output, only us
+00052d30: 6564 2069 6620 6063 616c 656e 6461 7260  ed if `calendar`
+00052d40: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
+00052d50: 6f6e 6520 6f66 207b 2270 726f 6c65 7074  one of {"prolept
+00052d60: 6963 5f67 7265 676f 7269 616e 222c 2022  ic_gregorian", "
+00052d70: 6772 6567 6f72 6961 6e22 206f 7220 2273  gregorian" or "s
+00052d80: 7461 6e64 6172 6422 7d2e 0a20 2020 2020  tandard"}..     
+00052d90: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00052da0: 7468 6520 6e65 7720 7469 6d65 2061 7869  the new time axi
+00052db0: 7320 7573 6573 2063 6674 696d 6520 6f62  s uses cftime ob
+00052dc0: 6a65 6374 732e 0a20 2020 2020 2020 2020  jects..         
+00052dd0: 2020 2049 6620 4e6f 6e65 2028 6465 6661     If None (defa
+00052de0: 756c 7429 2c20 6974 2075 7365 7320 3a70  ult), it uses :p
+00052df0: 793a 636c 6173 733a 606e 756d 7079 2e64  y:class:`numpy.d
+00052e00: 6174 6574 696d 6536 3460 2076 616c 7565  atetime64` value
+00052e10: 7320 6966 2074 6865 0a20 2020 2020 2020  s if the.       
+00052e20: 2020 2020 2064 6174 6520 7261 6e67 6520       date range 
+00052e30: 7065 726d 6974 7320 6974 2c20 616e 6420  permits it, and 
+00052e40: 3a70 793a 636c 6173 733a 6063 6674 696d  :py:class:`cftim
+00052e50: 652e 6461 7465 7469 6d65 6020 6f62 6a65  e.datetime` obje
+00052e60: 6374 7320 6966 206e 6f74 2e0a 2020 2020  cts if not..    
+00052e70: 2020 2020 2020 2020 4966 2046 616c 7365          If False
+00052e80: 2c20 6974 2075 7365 7320 3a70 793a 636c  , it uses :py:cl
+00052e90: 6173 733a 606e 756d 7079 2e64 6174 6574  ass:`numpy.datet
+00052ea0: 696d 6536 3460 2020 6f72 2066 6169 6c73  ime64`  or fails
+00052eb0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00052ec0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00052ed0: 2d2d 0a20 2020 2020 2020 2044 6174 6173  --.        Datas
+00052ee0: 6574 0a20 2020 2020 2020 2020 2020 2043  et.            C
+00052ef0: 6f70 7920 6f66 2074 6865 2064 6174 6161  opy of the dataa
+00052f00: 7272 6179 2077 6974 6820 7468 6520 7469  rray with the ti
+00052f10: 6d65 2063 6f6f 7264 696e 6174 6520 636f  me coordinate co
+00052f20: 6e76 6572 7465 6420 746f 2074 6865 0a20  nverted to the. 
+00052f30: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+00052f40: 7420 6361 6c65 6e64 6172 2e20 4966 2027  t calendar. If '
+00052f50: 6d69 7373 696e 6727 2077 6173 204e 6f6e  missing' was Non
+00052f60: 6520 2864 6566 6175 6c74 292c 2069 6e76  e (default), inv
+00052f70: 616c 6964 2064 6174 6573 2069 6e0a 2020  alid dates in.  
+00052f80: 2020 2020 2020 2020 2020 7468 6520 6e65            the ne
+00052f90: 7720 6361 6c65 6e64 6172 2061 7265 2064  w calendar are d
+00052fa0: 726f 7070 6564 2c20 6275 7420 6d69 7373  ropped, but miss
+00052fb0: 696e 6720 6461 7465 7320 6172 6520 6e6f  ing dates are no
+00052fc0: 7420 696e 7365 7274 6564 2e0a 2020 2020  t inserted..    
+00052fd0: 2020 2020 2020 2020 4966 2060 6d69 7373          If `miss
+00052fe0: 696e 6760 2077 6173 2067 6976 656e 2c20  ing` was given, 
+00052ff0: 7468 6520 6e65 7720 6461 7461 2069 7320  the new data is 
+00053000: 7265 696e 6465 7865 6420 746f 2068 6176  reindexed to hav
+00053010: 6520 6120 7469 6d65 2061 7869 730a 2020  e a time axis.  
+00053020: 2020 2020 2020 2020 2020 7769 7468 2074            with t
+00053030: 6865 2073 616d 6520 6672 6571 7565 6e63  he same frequenc
+00053040: 7920 6173 2074 6865 2073 6f75 7263 652c  y as the source,
+00053050: 2062 7574 2069 6e20 7468 6520 6e65 7720   but in the new 
+00053060: 6361 6c65 6e64 6172 3b20 616e 790a 2020  calendar; any.  
+00053070: 2020 2020 2020 2020 2020 6d69 7373 696e            missin
+00053080: 6720 6461 7461 706f 696e 7473 2061 7265  g datapoints are
+00053090: 2066 696c 6c65 6420 7769 7468 2060 6d69   filled with `mi
+000530a0: 7373 696e 6760 2e0a 0a20 2020 2020 2020  ssing`...       
+000530b0: 204e 6f74 6573 0a20 2020 2020 2020 202d   Notes.        -
+000530c0: 2d2d 2d2d 0a20 2020 2020 2020 2050 6173  ----.        Pas
+000530d0: 7369 6e67 2061 2076 616c 7565 2074 6f20  sing a value to 
+000530e0: 606d 6973 7369 6e67 6020 6973 206f 6e6c  `missing` is onl
+000530f0: 7920 7573 6162 6c65 2069 6620 7468 6520  y usable if the 
+00053100: 736f 7572 6365 2773 2074 696d 6520 636f  source's time co
+00053110: 6f72 6469 6e61 7465 2061 7320 616e 0a20  ordinate as an. 
+00053120: 2020 2020 2020 2069 6e66 6572 6162 6c65         inferable
+00053130: 2066 7265 7175 656e 6369 6573 2028 7365   frequencies (se
+00053140: 6520 3a70 793a 6675 6e63 3a60 7e78 6172  e :py:func:`~xar
+00053150: 7261 792e 696e 6665 725f 6672 6571 6029  ray.infer_freq`)
+00053160: 2061 6e64 2069 7320 6f6e 6c79 2061 7070   and is only app
+00053170: 726f 7072 6961 7465 0a20 2020 2020 2020  ropriate.       
+00053180: 2069 6620 7468 6520 7461 7267 6574 2063   if the target c
+00053190: 6f6f 7264 696e 6174 652c 2067 656e 6572  oordinate, gener
+000531a0: 6174 6564 2066 726f 6d20 7468 6973 2066  ated from this f
+000531b0: 7265 7175 656e 6379 2c20 6861 7320 6461  requency, has da
+000531c0: 7465 7320 6571 7569 7661 6c65 6e74 2074  tes equivalent t
+000531d0: 6f20 7468 650a 2020 2020 2020 2020 736f  o the.        so
+000531e0: 7572 6365 2e20 4974 2069 7320 7573 7561  urce. It is usua
+000531f0: 6c6c 7920 2a2a 6e6f 742a 2a20 6170 7072  lly **not** appr
+00053200: 6f70 7269 6174 6520 746f 2075 7365 2074  opriate to use t
+00053210: 6869 7320 6d6f 6465 2077 6974 683a 0a0a  his mode with:..
+00053220: 2020 2020 2020 2020 2d20 5065 7269 6f64          - Period
+00053230: 2d65 6e64 2066 7265 7175 656e 6369 6573  -end frequencies
+00053240: 203a 2027 4127 2c20 2759 272c 2027 5127   : 'A', 'Y', 'Q'
+00053250: 206f 7220 274d 272c 2069 6e20 6f70 706f   or 'M', in oppo
+00053260: 7369 7469 6f6e 2074 6f20 2741 5327 2027  sition to 'AS' '
+00053270: 5953 272c 2027 5153 2720 616e 6420 274d  YS', 'QS' and 'M
+00053280: 5327 0a20 2020 2020 2020 202d 2053 7562  S'.        - Sub
+00053290: 2d6d 6f6e 7468 6c79 2066 7265 7175 656e  -monthly frequen
+000532a0: 6369 6573 2074 6861 7420 646f 206e 6f74  cies that do not
+000532b0: 2064 6976 6964 6520 6120 6461 7920 6576   divide a day ev
+000532c0: 656e 6c79 203a 2027 5727 2c20 276e 4427  enly : 'W', 'nD'
+000532d0: 2077 6865 7265 2060 4e20 213d 2031 600a   where `N != 1`.
+000532e0: 2020 2020 2020 2020 2020 2020 6f72 2027              or '
+000532f0: 6d48 2720 7768 6572 6520 3234 2025 206d  mH' where 24 % m
+00053300: 2021 3d20 3029 2e0a 0a20 2020 2020 2020   != 0)...       
+00053310: 2049 6620 6f6e 6520 6f66 2074 6865 2073   If one of the s
+00053320: 6f75 7263 6520 6f72 2074 6172 6765 7420  ource or target 
+00053330: 6361 6c65 6e64 6172 7320 6973 2060 2233  calendars is `"3
+00053340: 3630 5f64 6179 2260 2c20 6061 6c69 676e  60_day"`, `align
+00053350: 5f6f 6e60 206d 7573 740a 2020 2020 2020  _on` must.      
+00053360: 2020 6265 2073 7065 6369 6669 6564 2061    be specified a
+00053370: 6e64 2074 776f 206f 7074 696f 6e73 2061  nd two options a
+00053380: 7265 206f 6666 6572 6564 2e0a 0a20 2020  re offered...   
+00053390: 2020 2020 202d 2022 7965 6172 220a 2020       - "year".  
+000533a0: 2020 2020 2020 2020 2020 5468 6520 6461            The da
+000533b0: 7465 7320 6172 6520 7472 616e 736c 6174  tes are translat
+000533c0: 6564 2061 6363 6f72 6469 6e67 2074 6f20  ed according to 
+000533d0: 7468 6569 7220 7265 6c61 7469 7665 2070  their relative p
+000533e0: 6f73 6974 696f 6e20 696e 2074 6865 2079  osition in the y
+000533f0: 6561 722c 0a20 2020 2020 2020 2020 2020  ear,.           
+00053400: 2069 676e 6f72 696e 6720 7468 6569 7220   ignoring their 
+00053410: 6f72 6967 696e 616c 206d 6f6e 7468 2061  original month a
+00053420: 6e64 2064 6179 2069 6e66 6f72 6d61 7469  nd day informati
+00053430: 6f6e 2c20 6d65 616e 696e 6720 7468 6174  on, meaning that
+00053440: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00053450: 206d 6973 7369 6e67 2f73 7572 706c 7573   missing/surplus
+00053460: 2064 6179 7320 6172 6520 6164 6465 642f   days are added/
+00053470: 7265 6d6f 7665 6420 6174 2072 6567 756c  removed at regul
+00053480: 6172 2069 6e74 6572 7661 6c73 2e0a 0a20  ar intervals... 
+00053490: 2020 2020 2020 2020 2020 2046 726f 6d20             From 
+000534a0: 6120 6033 3630 5f64 6179 6020 746f 2061  a `360_day` to a
+000534b0: 2073 7461 6e64 6172 6420 6361 6c65 6e64   standard calend
+000534c0: 6172 2c20 7468 6520 6f75 7470 7574 2077  ar, the output w
+000534d0: 696c 6c20 6265 206d 6973 7369 6e67 2074  ill be missing t
+000534e0: 6865 0a20 2020 2020 2020 2020 2020 2066  he.            f
+000534f0: 6f6c 6c6f 7769 6e67 2064 6174 6573 2028  ollowing dates (
+00053500: 6461 7920 6f66 2079 6561 7220 696e 2070  day of year in p
+00053510: 6172 656e 7468 6573 6573 293a 0a0a 2020  arentheses):..  
+00053520: 2020 2020 2020 2020 2020 546f 2061 206c            To a l
+00053530: 6561 7020 7965 6172 3a0a 2020 2020 2020  eap year:.      
+00053540: 2020 2020 2020 2020 2020 4a61 6e75 6172            Januar
+00053550: 7920 3331 7374 2028 3331 292c 204d 6172  y 31st (31), Mar
+00053560: 6368 2033 3173 7420 2839 3129 2c20 4a75  ch 31st (91), Ju
+00053570: 6e65 2031 7374 2028 3135 3329 2c20 4a75  ne 1st (153), Ju
+00053580: 6c79 2033 3173 7420 2832 3133 292c 0a20  ly 31st (213),. 
+00053590: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+000535a0: 6570 7465 6d62 6572 2033 3173 7420 2832  eptember 31st (2
+000535b0: 3735 2920 616e 6420 4e6f 7665 6d62 6572  75) and November
+000535c0: 2033 3074 6820 2833 3335 292e 0a20 2020   30th (335)..   
+000535d0: 2020 2020 2020 2020 2054 6f20 6120 6e6f           To a no
+000535e0: 6e2d 6c65 6170 2079 6561 723a 0a20 2020  n-leap year:.   
+000535f0: 2020 2020 2020 2020 2020 2020 2046 6562               Feb
+00053600: 7275 6172 7920 3674 6820 2833 3629 2c20  ruary 6th (36), 
+00053610: 4170 7269 6c20 3139 7468 2028 3130 3929  April 19th (109)
+00053620: 2c20 4a75 6c79 2032 6e64 2028 3138 3329  , July 2nd (183)
+00053630: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00053640: 2020 5365 7074 656d 6265 7220 3132 7468    September 12th
+00053650: 2028 3235 3529 2c20 4e6f 7665 6d62 6572   (255), November
+00053660: 2032 3574 6820 2833 3239 292e 0a0a 2020   25th (329)...  
+00053670: 2020 2020 2020 2020 2020 4672 6f6d 2061            From a
+00053680: 2073 7461 6e64 6172 6420 6361 6c65 6e64   standard calend
+00053690: 6172 2074 6f20 6120 6022 3336 305f 6461  ar to a `"360_da
+000536a0: 7922 602c 2074 6865 2066 6f6c 6c6f 7769  y"`, the followi
+000536b0: 6e67 2064 6174 6573 2069 6e20 7468 650a  ng dates in the.
+000536c0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+000536d0: 6365 2061 7272 6179 2077 696c 6c20 6265  ce array will be
+000536e0: 2064 726f 7070 6564 3a0a 0a20 2020 2020   dropped:..     
+000536f0: 2020 2020 2020 2046 726f 6d20 6120 6c65         From a le
+00053700: 6170 2079 6561 723a 0a20 2020 2020 2020  ap year:.       
+00053710: 2020 2020 2020 2020 204a 616e 7561 7279           January
+00053720: 2033 3173 7420 2833 3129 2c20 4170 7269   31st (31), Apri
+00053730: 6c20 3173 7420 2839 3229 2c20 4a75 6e65  l 1st (92), June
+00053740: 2031 7374 2028 3135 3329 2c20 4175 6775   1st (153), Augu
+00053750: 7374 2031 7374 2028 3231 3429 2c0a 2020  st 1st (214),.  
+00053760: 2020 2020 2020 2020 2020 2020 2020 5365                Se
+00053770: 7074 656d 6265 7220 3331 7374 2028 3237  ptember 31st (27
+00053780: 3529 2c20 4465 6365 6d62 6572 2031 7374  5), December 1st
+00053790: 2028 3333 3629 0a20 2020 2020 2020 2020   (336).         
+000537a0: 2020 2046 726f 6d20 6120 6e6f 6e2d 6c65     From a non-le
+000537b0: 6170 2079 6561 723a 0a20 2020 2020 2020  ap year:.       
+000537c0: 2020 2020 2020 2020 2046 6562 7275 6172           Februar
+000537d0: 7920 3674 6820 2833 3729 2c20 4170 7269  y 6th (37), Apri
+000537e0: 6c20 3230 7468 2028 3131 3029 2c20 4a75  l 20th (110), Ju
+000537f0: 6c79 2032 6e64 2028 3138 3329 2c0a 2020  ly 2nd (183),.  
+00053800: 2020 2020 2020 2020 2020 2020 2020 5365                Se
+00053810: 7074 656d 6265 7220 3133 7468 2028 3235  ptember 13th (25
+00053820: 3629 2c20 4e6f 7665 6d62 6572 2032 3574  6), November 25t
+00053830: 6820 2833 3239 290a 0a20 2020 2020 2020  h (329)..       
+00053840: 2020 2020 2054 6869 7320 6f70 7469 6f6e       This option
+00053850: 2069 7320 6265 7374 2075 7365 6420 6f6e   is best used on
+00053860: 2064 6169 6c79 2061 6e64 2073 7562 6461   daily and subda
+00053870: 696c 7920 6461 7461 2e0a 0a20 2020 2020  ily data...     
+00053880: 2020 202d 2022 6461 7465 220a 2020 2020     - "date".    
+00053890: 2020 2020 2020 2020 5468 6520 6d6f 6e74          The mont
+000538a0: 682f 6461 7920 696e 666f 726d 6174 696f  h/day informatio
+000538b0: 6e20 6973 2063 6f6e 7365 7276 6564 2061  n is conserved a
+000538c0: 6e64 2069 6e76 616c 6964 2064 6174 6573  nd invalid dates
+000538d0: 2061 7265 2064 726f 7070 6564 0a20 2020   are dropped.   
+000538e0: 2020 2020 2020 2020 2066 726f 6d20 7468           from th
+000538f0: 6520 6f75 7470 7574 2e20 5468 6973 206d  e output. This m
+00053900: 6561 6e73 2074 6861 7420 7768 656e 2063  eans that when c
+00053910: 6f6e 7665 7274 696e 6720 6672 6f6d 2061  onverting from a
+00053920: 2060 2233 3630 5f64 6179 2260 2074 6f20   `"360_day"` to 
+00053930: 610a 2020 2020 2020 2020 2020 2020 7374  a.            st
+00053940: 616e 6461 7264 2063 616c 656e 6461 722c  andard calendar,
+00053950: 2061 6c6c 2033 3173 7420 284a 616e 2c20   all 31st (Jan, 
+00053960: 4d61 7263 682c 204d 6179 2c20 4a75 6c79  March, May, July
+00053970: 2c20 4175 6775 7374 2c20 4f63 746f 6265  , August, Octobe
+00053980: 7220 616e 640a 2020 2020 2020 2020 2020  r and.          
+00053990: 2020 4465 6365 6d62 6572 2920 7769 6c6c    December) will
+000539a0: 2062 6520 6d69 7373 696e 6720 6173 2074   be missing as t
+000539b0: 6865 7265 2069 7320 6e6f 2065 7175 6976  here is no equiv
+000539c0: 616c 656e 7420 6461 7465 7320 696e 2074  alent dates in t
+000539d0: 6865 0a20 2020 2020 2020 2020 2020 2060  he.            `
+000539e0: 2233 3630 5f64 6179 2260 2063 616c 656e  "360_day"` calen
+000539f0: 6461 7220 616e 6420 7468 6520 3239 7468  dar and the 29th
+00053a00: 2028 6f6e 206e 6f6e 2d6c 6561 7020 7965   (on non-leap ye
+00053a10: 6172 7329 2061 6e64 2033 3074 6820 6f66  ars) and 30th of
+00053a20: 2046 6562 7275 6172 790a 2020 2020 2020   February.      
+00053a30: 2020 2020 2020 7769 6c6c 2062 6520 6472        will be dr
+00053a40: 6f70 7065 6420 6173 2074 6865 7265 2061  opped as there a
+00053a50: 7265 206e 6f20 6571 7569 7661 6c65 6e74  re no equivalent
+00053a60: 2064 6174 6573 2069 6e20 6120 7374 616e   dates in a stan
+00053a70: 6461 7264 2063 616c 656e 6461 722e 0a0a  dard calendar...
+00053a80: 2020 2020 2020 2020 2020 2020 5468 6973              This
+00053a90: 206f 7074 696f 6e20 6973 2062 6573 7420   option is best 
+00053aa0: 7573 6564 2077 6974 6820 6461 7461 206f  used with data o
+00053ab0: 6e20 6120 6672 6571 7565 6e63 7920 636f  n a frequency co
+00053ac0: 6172 7365 7220 7468 616e 2064 6169 6c79  arser than daily
+00053ad0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00053ae0: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
+00053af0: 7665 7274 5f63 616c 656e 6461 7228 0a20  vert_calendar(. 
+00053b00: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00053b10: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
+00053b20: 656e 6461 722c 0a20 2020 2020 2020 2020  endar,.         
+00053b30: 2020 2064 696d 3d64 696d 2c0a 2020 2020     dim=dim,.    
+00053b40: 2020 2020 2020 2020 616c 6967 6e5f 6f6e          align_on
+00053b50: 3d61 6c69 676e 5f6f 6e2c 0a20 2020 2020  =align_on,.     
+00053b60: 2020 2020 2020 206d 6973 7369 6e67 3d6d         missing=m
+00053b70: 6973 7369 6e67 2c0a 2020 2020 2020 2020  issing,.        
+00053b80: 2020 2020 7573 655f 6366 7469 6d65 3d75      use_cftime=u
+00053b90: 7365 5f63 6674 696d 652c 0a20 2020 2020  se_cftime,.     
+00053ba0: 2020 2029 0a0a 2020 2020 6465 6620 696e     )..    def in
+00053bb0: 7465 7270 5f63 616c 656e 6461 7228 0a20  terp_calendar(. 
+00053bc0: 2020 2020 2020 2073 656c 663a 2054 5f44         self: T_D
+00053bd0: 6174 6173 6574 2c0a 2020 2020 2020 2020  ataset,.        
+00053be0: 7461 7267 6574 3a20 7064 2e44 6174 6574  target: pd.Datet
+00053bf0: 696d 6549 6e64 6578 207c 2043 4654 696d  imeIndex | CFTim
+00053c00: 6549 6e64 6578 207c 2044 6174 6141 7272  eIndex | DataArr
+00053c10: 6179 2c0a 2020 2020 2020 2020 6469 6d3a  ay,.        dim:
+00053c20: 2048 6173 6861 626c 6520 3d20 2274 696d   Hashable = "tim
+00053c30: 6522 2c0a 2020 2020 2920 2d3e 2054 5f44  e",.    ) -> T_D
+00053c40: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+00053c50: 2222 2249 6e74 6572 706f 6c61 7465 7320  """Interpolates 
+00053c60: 7468 6520 4461 7461 7365 7420 746f 2061  the Dataset to a
+00053c70: 6e6f 7468 6572 2063 616c 656e 6461 7220  nother calendar 
+00053c80: 6261 7365 6420 6f6e 2064 6563 696d 616c  based on decimal
+00053c90: 2079 6561 7220 6d65 6173 7572 652e 0a0a   year measure...
+00053ca0: 2020 2020 2020 2020 4561 6368 2074 696d          Each tim
+00053cb0: 6573 7461 6d70 2069 6e20 6073 6f75 7263  estamp in `sourc
+00053cc0: 6560 2061 6e64 2060 7461 7267 6574 6020  e` and `target` 
+00053cd0: 6172 6520 6669 7273 7420 636f 6e76 6572  are first conver
+00053ce0: 7465 6420 746f 2074 6865 6972 2064 6563  ted to their dec
+00053cf0: 696d 616c 0a20 2020 2020 2020 2079 6561  imal.        yea
+00053d00: 7220 6571 7569 7661 6c65 6e74 2074 6865  r equivalent the
+00053d10: 6e20 6073 6f75 7263 6560 2069 7320 696e  n `source` is in
+00053d20: 7465 7270 6f6c 6174 6564 206f 6e20 7468  terpolated on th
+00053d30: 6520 7461 7267 6574 2063 6f6f 7264 696e  e target coordin
+00053d40: 6174 652e 0a20 2020 2020 2020 2054 6865  ate..        The
+00053d50: 2064 6563 696d 616c 2079 6561 7220 6f66   decimal year of
+00053d60: 2061 2074 696d 6573 7461 6d70 2069 7320   a timestamp is 
+00053d70: 6974 7320 7965 6172 2070 6c75 7320 6974  its year plus it
+00053d80: 7320 7375 622d 7965 6172 2063 6f6d 706f  s sub-year compo
+00053d90: 6e65 6e74 0a20 2020 2020 2020 2063 6f6e  nent.        con
+00053da0: 7665 7274 6564 2074 6f20 7468 6520 6672  verted to the fr
+00053db0: 6163 7469 6f6e 206f 6620 6974 7320 7965  action of its ye
+00053dc0: 6172 2e20 466f 7220 6578 616d 706c 6520  ar. For example 
+00053dd0: 2232 3030 302d 3033 2d30 3120 3132 3a30  "2000-03-01 12:0
+00053de0: 3022 2069 730a 2020 2020 2020 2020 3230  0" is.        20
+00053df0: 3030 2e31 3635 3320 696e 2061 2073 7461  00.1653 in a sta
+00053e00: 6e64 6172 6420 6361 6c65 6e64 6172 206f  ndard calendar o
+00053e10: 7220 3230 3030 2e31 3633 3031 2069 6e20  r 2000.16301 in 
+00053e20: 6120 6022 6e6f 6c65 6170 2260 2063 616c  a `"noleap"` cal
+00053e30: 656e 6461 722e 0a0a 2020 2020 2020 2020  endar...        
+00053e40: 5468 6973 206d 6574 686f 6420 7368 6f75  This method shou
+00053e50: 6c64 206f 6e6c 7920 6265 2075 7365 6420  ld only be used 
+00053e60: 7768 656e 2074 6865 2074 696d 6520 2848  when the time (H
+00053e70: 483a 4d4d 3a53 5329 2069 6e66 6f72 6d61  H:MM:SS) informa
+00053e80: 7469 6f6e 206f 660a 2020 2020 2020 2020  tion of.        
+00053e90: 7469 6d65 2063 6f6f 7264 696e 6174 6520  time coordinate 
+00053ea0: 6973 206e 6f74 2069 6d70 6f72 7461 6e74  is not important
+00053eb0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00053ec0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00053ed0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00053ee0: 2074 6172 6765 743a 2044 6174 6141 7272   target: DataArr
+00053ef0: 6179 206f 7220 4461 7465 7469 6d65 496e  ay or DatetimeIn
+00053f00: 6465 7820 6f72 2043 4654 696d 6549 6e64  dex or CFTimeInd
+00053f10: 6578 0a20 2020 2020 2020 2020 2020 2054  ex.            T
+00053f20: 6865 2074 6172 6765 7420 7469 6d65 2063  he target time c
+00053f30: 6f6f 7264 696e 6174 6520 6f66 2061 2076  oordinate of a v
+00053f40: 616c 6964 2064 7479 7065 0a20 2020 2020  alid dtype.     
+00053f50: 2020 2020 2020 2028 6e70 2e64 6174 6574         (np.datet
+00053f60: 696d 6536 3420 6f72 2063 6674 696d 6520  ime64 or cftime 
+00053f70: 6f62 6a65 6374 7329 0a20 2020 2020 2020  objects).       
+00053f80: 2064 696d 203a 2048 6173 6861 626c 652c   dim : Hashable,
+00053f90: 2064 6566 6175 6c74 3a20 2274 696d 6522   default: "time"
+00053fa0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00053fb0: 2074 696d 6520 636f 6f72 6469 6e61 7465   time coordinate
+00053fc0: 206e 616d 652e 0a0a 2020 2020 2020 2020   name...        
+00053fd0: 5265 7475 726e 0a20 2020 2020 2020 202d  Return.        -
+00053fe0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4461  -----.        Da
+00053ff0: 7461 4172 7261 790a 2020 2020 2020 2020  taArray.        
+00054000: 2020 2020 5468 6520 736f 7572 6365 2069      The source i
+00054010: 6e74 6572 706f 6c61 7465 6420 6f6e 2074  nterpolated on t
+00054020: 6865 2064 6563 696d 616c 2079 6561 7273  he decimal years
+00054030: 206f 6620 7461 7267 6574 2c0a 2020 2020   of target,.    
+00054040: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00054050: 7265 7475 726e 2069 6e74 6572 705f 6361  return interp_ca
+00054060: 6c65 6e64 6172 2873 656c 662c 2074 6172  lendar(self, tar
+00054070: 6765 742c 2064 696d 3d64 696d 290a 0a20  get, dim=dim).. 
+00054080: 2020 2064 6566 2067 726f 7570 6279 280a     def groupby(.
+00054090: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000540a0: 2020 2020 2020 6772 6f75 703a 2048 6173        group: Has
+000540b0: 6861 626c 6520 7c20 4461 7461 4172 7261  hable | DataArra
+000540c0: 7920 7c20 496e 6465 7856 6172 6961 626c  y | IndexVariabl
+000540d0: 652c 0a20 2020 2020 2020 2073 7175 6565  e,.        squee
+000540e0: 7a65 3a20 626f 6f6c 203d 2054 7275 652c  ze: bool = True,
+000540f0: 0a20 2020 2020 2020 2072 6573 746f 7265  .        restore
+00054100: 5f63 6f6f 7264 5f64 696d 733a 2062 6f6f  _coord_dims: boo
+00054110: 6c20 3d20 4661 6c73 652c 0a20 2020 2029  l = False,.    )
+00054120: 202d 3e20 4461 7461 7365 7447 726f 7570   -> DatasetGroup
+00054130: 4279 3a0a 2020 2020 2020 2020 2222 2252  By:.        """R
+00054140: 6574 7572 6e73 2061 2044 6174 6173 6574  eturns a Dataset
+00054150: 4772 6f75 7042 7920 6f62 6a65 6374 2066  GroupBy object f
+00054160: 6f72 2070 6572 666f 726d 696e 6720 6772  or performing gr
+00054170: 6f75 7065 6420 6f70 6572 6174 696f 6e73  ouped operations
+00054180: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00054190: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+000541a0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000541b0: 2067 726f 7570 203a 2048 6173 6861 626c   group : Hashabl
+000541c0: 652c 2044 6174 6141 7272 6179 206f 7220  e, DataArray or 
+000541d0: 496e 6465 7856 6172 6961 626c 650a 2020  IndexVariable.  
+000541e0: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
+000541f0: 7768 6f73 6520 756e 6971 7565 2076 616c  whose unique val
+00054200: 7565 7320 7368 6f75 6c64 2062 6520 7573  ues should be us
+00054210: 6564 2074 6f20 6772 6f75 7020 7468 6973  ed to group this
+00054220: 2061 7272 6179 2e20 4966 2061 0a20 2020   array. If a.   
+00054230: 2020 2020 2020 2020 2073 7472 696e 672c           string,
+00054240: 206d 7573 7420 6265 2074 6865 206e 616d   must be the nam
+00054250: 6520 6f66 2061 2076 6172 6961 626c 6520  e of a variable 
+00054260: 636f 6e74 6169 6e65 6420 696e 2074 6869  contained in thi
+00054270: 7320 6461 7461 7365 742e 0a20 2020 2020  s dataset..     
+00054280: 2020 2073 7175 6565 7a65 203a 2062 6f6f     squeeze : boo
+00054290: 6c2c 2064 6566 6175 6c74 3a20 5472 7565  l, default: True
+000542a0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+000542b0: 2267 726f 7570 2220 6973 2061 2064 696d  "group" is a dim
+000542c0: 656e 7369 6f6e 206f 6620 616e 7920 6172  ension of any ar
+000542d0: 7261 7973 2069 6e20 7468 6973 2064 6174  rays in this dat
+000542e0: 6173 6574 2c20 6073 7175 6565 7a65 600a  aset, `squeeze`.
+000542f0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00054300: 726f 6c73 2077 6865 7468 6572 2074 6865  rols whether the
+00054310: 2073 7562 6172 7261 7973 2068 6176 6520   subarrays have 
+00054320: 6120 6469 6d65 6e73 696f 6e20 6f66 206c  a dimension of l
+00054330: 656e 6774 6820 3120 616c 6f6e 670a 2020  ength 1 along.  
+00054340: 2020 2020 2020 2020 2020 7468 6174 2064            that d
+00054350: 696d 656e 7369 6f6e 206f 7220 6966 2074  imension or if t
+00054360: 6865 2064 696d 656e 7369 6f6e 2069 7320  he dimension is 
+00054370: 7371 7565 657a 6564 206f 7574 2e0a 2020  squeezed out..  
+00054380: 2020 2020 2020 7265 7374 6f72 655f 636f        restore_co
+00054390: 6f72 645f 6469 6d73 203a 2062 6f6f 6c2c  ord_dims : bool,
+000543a0: 2064 6566 6175 6c74 3a20 4661 6c73 650a   default: False.
+000543b0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+000543c0: 7275 652c 2061 6c73 6f20 7265 7374 6f72  rue, also restor
+000543d0: 6520 7468 6520 6469 6d65 6e73 696f 6e20  e the dimension 
+000543e0: 6f72 6465 7220 6f66 206d 756c 7469 2d64  order of multi-d
+000543f0: 696d 656e 7369 6f6e 616c 0a20 2020 2020  imensional.     
+00054400: 2020 2020 2020 2063 6f6f 7264 696e 6174         coordinat
+00054410: 6573 2e0a 0a20 2020 2020 2020 2052 6574  es...        Ret
+00054420: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00054430: 2d2d 2d2d 0a20 2020 2020 2020 2067 726f  ----.        gro
+00054440: 7570 6564 203a 2044 6174 6173 6574 4772  uped : DatasetGr
+00054450: 6f75 7042 790a 2020 2020 2020 2020 2020  oupBy.          
+00054460: 2020 4120 6044 6174 6173 6574 4772 6f75    A `DatasetGrou
+00054470: 7042 7960 206f 626a 6563 7420 7061 7474  pBy` object patt
+00054480: 6572 6e65 6420 6166 7465 7220 6070 616e  erned after `pan
+00054490: 6461 732e 4772 6f75 7042 7960 2074 6861  das.GroupBy` tha
+000544a0: 7420 6361 6e20 6265 0a20 2020 2020 2020  t can be.       
+000544b0: 2020 2020 2069 7465 7261 7465 6420 6f76       iterated ov
+000544c0: 6572 2069 6e20 7468 6520 666f 726d 206f  er in the form o
+000544d0: 6620 6028 756e 6971 7565 5f76 616c 7565  f `(unique_value
+000544e0: 2c20 6772 6f75 7065 645f 6172 7261 7929  , grouped_array)
+000544f0: 6020 7061 6972 732e 0a0a 2020 2020 2020  ` pairs...      
+00054500: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00054510: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00054520: 2020 2020 3a72 6566 3a60 6772 6f75 7062      :ref:`groupb
+00054530: 7960 0a20 2020 2020 2020 2020 2020 2055  y`.            U
+00054540: 7365 7273 2067 7569 6465 2065 7870 6c61  sers guide expla
+00054550: 6e61 7469 6f6e 206f 6620 686f 7720 746f  nation of how to
+00054560: 2067 726f 7570 2061 6e64 2062 696e 2064   group and bin d
+00054570: 6174 612e 0a20 2020 2020 2020 2044 6174  ata..        Dat
+00054580: 6173 6574 2e67 726f 7570 6279 5f62 696e  aset.groupby_bin
+00054590: 730a 2020 2020 2020 2020 4461 7461 4172  s.        DataAr
+000545a0: 7261 792e 6772 6f75 7062 790a 2020 2020  ray.groupby.    
+000545b0: 2020 2020 636f 7265 2e67 726f 7570 6279      core.groupby
+000545c0: 2e44 6174 6173 6574 4772 6f75 7042 790a  .DatasetGroupBy.
+000545d0: 2020 2020 2020 2020 7061 6e64 6173 2e44          pandas.D
+000545e0: 6174 6146 7261 6d65 2e67 726f 7570 6279  ataFrame.groupby
+000545f0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+00054600: 2e72 6573 616d 706c 650a 2020 2020 2020  .resample.      
+00054610: 2020 4461 7461 4172 7261 792e 7265 7361    DataArray.resa
+00054620: 6d70 6c65 0a20 2020 2020 2020 2022 2222  mple.        """
+00054630: 0a20 2020 2020 2020 2066 726f 6d20 7861  .        from xa
+00054640: 7272 6179 2e63 6f72 652e 6772 6f75 7062  rray.core.groupb
+00054650: 7920 696d 706f 7274 2028 0a20 2020 2020  y import (.     
+00054660: 2020 2020 2020 2044 6174 6173 6574 4772         DatasetGr
+00054670: 6f75 7042 792c 0a20 2020 2020 2020 2020  oupBy,.         
+00054680: 2020 2052 6573 6f6c 7665 6455 6e69 7175     ResolvedUniqu
+00054690: 6547 726f 7570 6572 2c0a 2020 2020 2020  eGrouper,.      
+000546a0: 2020 2020 2020 556e 6971 7565 4772 6f75        UniqueGrou
+000546b0: 7065 722c 0a20 2020 2020 2020 2020 2020  per,.           
+000546c0: 205f 7661 6c69 6461 7465 5f67 726f 7570   _validate_group
+000546d0: 6279 5f73 7175 6565 7a65 2c0a 2020 2020  by_squeeze,.    
+000546e0: 2020 2020 290a 0a20 2020 2020 2020 205f      )..        _
+000546f0: 7661 6c69 6461 7465 5f67 726f 7570 6279  validate_groupby
+00054700: 5f73 7175 6565 7a65 2873 7175 6565 7a65  _squeeze(squeeze
+00054710: 290a 2020 2020 2020 2020 7267 726f 7570  ).        rgroup
+00054720: 6572 203d 2052 6573 6f6c 7665 6455 6e69  er = ResolvedUni
+00054730: 7175 6547 726f 7570 6572 2855 6e69 7175  queGrouper(Uniqu
+00054740: 6547 726f 7570 6572 2829 2c20 6772 6f75  eGrouper(), grou
+00054750: 702c 2073 656c 6629 0a0a 2020 2020 2020  p, self)..      
+00054760: 2020 7265 7475 726e 2044 6174 6173 6574    return Dataset
+00054770: 4772 6f75 7042 7928 0a20 2020 2020 2020  GroupBy(.       
+00054780: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00054790: 2020 2020 2020 2028 7267 726f 7570 6572         (rgrouper
+000547a0: 2c29 2c0a 2020 2020 2020 2020 2020 2020  ,),.            
+000547b0: 7371 7565 657a 653d 7371 7565 657a 652c  squeeze=squeeze,
+000547c0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000547d0: 746f 7265 5f63 6f6f 7264 5f64 696d 733d  tore_coord_dims=
+000547e0: 7265 7374 6f72 655f 636f 6f72 645f 6469  restore_coord_di
+000547f0: 6d73 2c0a 2020 2020 2020 2020 290a 0a20  ms,.        ).. 
+00054800: 2020 2064 6566 2067 726f 7570 6279 5f62     def groupby_b
+00054810: 696e 7328 0a20 2020 2020 2020 2073 656c  ins(.        sel
+00054820: 662c 0a20 2020 2020 2020 2067 726f 7570  f,.        group
+00054830: 3a20 4861 7368 6162 6c65 207c 2044 6174  : Hashable | Dat
+00054840: 6141 7272 6179 207c 2049 6e64 6578 5661  aArray | IndexVa
+00054850: 7269 6162 6c65 2c0a 2020 2020 2020 2020  riable,.        
+00054860: 6269 6e73 3a20 4172 7261 794c 696b 652c  bins: ArrayLike,
+00054870: 0a20 2020 2020 2020 2072 6967 6874 3a20  .        right: 
+00054880: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+00054890: 2020 2020 206c 6162 656c 733a 2041 7272       labels: Arr
+000548a0: 6179 4c69 6b65 207c 204e 6f6e 6520 3d20  ayLike | None = 
+000548b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7072  None,.        pr
+000548c0: 6563 6973 696f 6e3a 2069 6e74 203d 2033  ecision: int = 3
+000548d0: 2c0a 2020 2020 2020 2020 696e 636c 7564  ,.        includ
+000548e0: 655f 6c6f 7765 7374 3a20 626f 6f6c 203d  e_lowest: bool =
+000548f0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00054900: 7371 7565 657a 653a 2062 6f6f 6c20 3d20  squeeze: bool = 
+00054910: 5472 7565 2c0a 2020 2020 2020 2020 7265  True,.        re
+00054920: 7374 6f72 655f 636f 6f72 645f 6469 6d73  store_coord_dims
+00054930: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00054940: 2020 2020 2920 2d3e 2044 6174 6173 6574      ) -> Dataset
+00054950: 4772 6f75 7042 793a 0a20 2020 2020 2020  GroupBy:.       
+00054960: 2022 2222 5265 7475 726e 7320 6120 4461   """Returns a Da
+00054970: 7461 7365 7447 726f 7570 4279 206f 626a  tasetGroupBy obj
+00054980: 6563 7420 666f 7220 7065 7266 6f72 6d69  ect for performi
+00054990: 6e67 2067 726f 7570 6564 206f 7065 7261  ng grouped opera
+000549a0: 7469 6f6e 732e 0a0a 2020 2020 2020 2020  tions...        
+000549b0: 5261 7468 6572 2074 6861 6e20 7573 696e  Rather than usin
+000549c0: 6720 616c 6c20 756e 6971 7565 2076 616c  g all unique val
+000549d0: 7565 7320 6f66 2060 6772 6f75 7060 2c20  ues of `group`, 
+000549e0: 7468 6520 7661 6c75 6573 2061 7265 2064  the values are d
+000549f0: 6973 6372 6574 697a 6564 0a20 2020 2020  iscretized.     
+00054a00: 2020 2066 6972 7374 2062 7920 6170 706c     first by appl
+00054a10: 7969 6e67 2060 7061 6e64 6173 2e63 7574  ying `pandas.cut
+00054a20: 6020 5b31 5d5f 2074 6f20 6067 726f 7570  ` [1]_ to `group
+00054a30: 602e 0a0a 2020 2020 2020 2020 5061 7261  `...        Para
+00054a40: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00054a50: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00054a60: 2020 6772 6f75 7020 3a20 4861 7368 6162    group : Hashab
+00054a70: 6c65 2c20 4461 7461 4172 7261 7920 6f72  le, DataArray or
+00054a80: 2049 6e64 6578 5661 7269 6162 6c65 0a20   IndexVariable. 
+00054a90: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+00054aa0: 2077 686f 7365 2062 696e 6e65 6420 7661   whose binned va
+00054ab0: 6c75 6573 2073 686f 756c 6420 6265 2075  lues should be u
+00054ac0: 7365 6420 746f 2067 726f 7570 2074 6869  sed to group thi
+00054ad0: 7320 6172 7261 792e 2049 6620 610a 2020  s array. If a.  
+00054ae0: 2020 2020 2020 2020 2020 7374 7269 6e67            string
+00054af0: 2c20 6d75 7374 2062 6520 7468 6520 6e61  , must be the na
+00054b00: 6d65 206f 6620 6120 7661 7269 6162 6c65  me of a variable
+00054b10: 2063 6f6e 7461 696e 6564 2069 6e20 7468   contained in th
+00054b20: 6973 2064 6174 6173 6574 2e0a 2020 2020  is dataset..    
+00054b30: 2020 2020 6269 6e73 203a 2069 6e74 206f      bins : int o
+00054b40: 7220 6172 7261 792d 6c69 6b65 0a20 2020  r array-like.   
+00054b50: 2020 2020 2020 2020 2049 6620 6269 6e73           If bins
+00054b60: 2069 7320 616e 2069 6e74 2c20 6974 2064   is an int, it d
+00054b70: 6566 696e 6573 2074 6865 206e 756d 6265  efines the numbe
+00054b80: 7220 6f66 2065 7175 616c 2d77 6964 7468  r of equal-width
+00054b90: 2062 696e 7320 696e 2074 6865 0a20 2020   bins in the.   
+00054ba0: 2020 2020 2020 2020 2072 616e 6765 206f           range o
+00054bb0: 6620 782e 2048 6f77 6576 6572 2c20 696e  f x. However, in
+00054bc0: 2074 6869 7320 6361 7365 2c20 7468 6520   this case, the 
+00054bd0: 7261 6e67 6520 6f66 2078 2069 7320 6578  range of x is ex
+00054be0: 7465 6e64 6564 2062 7920 2e31 250a 2020  tended by .1%.  
+00054bf0: 2020 2020 2020 2020 2020 6f6e 2065 6163            on eac
+00054c00: 6820 7369 6465 2074 6f20 696e 636c 7564  h side to includ
+00054c10: 6520 7468 6520 6d69 6e20 6f72 206d 6178  e the min or max
+00054c20: 2076 616c 7565 7320 6f66 2078 2e20 4966   values of x. If
+00054c30: 2062 696e 7320 6973 2061 0a20 2020 2020   bins is a.     
+00054c40: 2020 2020 2020 2073 6571 7565 6e63 6520         sequence 
+00054c50: 6974 2064 6566 696e 6573 2074 6865 2062  it defines the b
+00054c60: 696e 2065 6467 6573 2061 6c6c 6f77 696e  in edges allowin
+00054c70: 6720 666f 7220 6e6f 6e2d 756e 6966 6f72  g for non-unifor
+00054c80: 6d20 6269 6e0a 2020 2020 2020 2020 2020  m bin.          
+00054c90: 2020 7769 6474 682e 204e 6f20 6578 7465    width. No exte
+00054ca0: 6e73 696f 6e20 6f66 2074 6865 2072 616e  nsion of the ran
+00054cb0: 6765 206f 6620 7820 6973 2064 6f6e 6520  ge of x is done 
+00054cc0: 696e 2074 6869 7320 6361 7365 2e0a 2020  in this case..  
+00054cd0: 2020 2020 2020 7269 6768 7420 3a20 626f        right : bo
+00054ce0: 6f6c 2c20 6465 6661 756c 743a 2054 7275  ol, default: Tru
+00054cf0: 650a 2020 2020 2020 2020 2020 2020 496e  e.            In
+00054d00: 6469 6361 7465 7320 7768 6574 6865 7220  dicates whether 
+00054d10: 7468 6520 6269 6e73 2069 6e63 6c75 6465  the bins include
+00054d20: 2074 6865 2072 6967 6874 6d6f 7374 2065   the rightmost e
+00054d30: 6467 6520 6f72 206e 6f74 2e20 4966 0a20  dge or not. If. 
+00054d40: 2020 2020 2020 2020 2020 2072 6967 6874             right
+00054d50: 203d 3d20 5472 7565 2028 7468 6520 6465   == True (the de
+00054d60: 6661 756c 7429 2c20 7468 656e 2074 6865  fault), then the
+00054d70: 2062 696e 7320 5b31 2c32 2c33 2c34 5d20   bins [1,2,3,4] 
+00054d80: 696e 6469 6361 7465 0a20 2020 2020 2020  indicate.       
+00054d90: 2020 2020 2028 312c 325d 2c20 2832 2c33       (1,2], (2,3
+00054da0: 5d2c 2028 332c 345d 2e0a 2020 2020 2020  ], (3,4]..      
+00054db0: 2020 6c61 6265 6c73 203a 2061 7272 6179    labels : array
+00054dc0: 2d6c 696b 6520 6f72 2062 6f6f 6c2c 2064  -like or bool, d
+00054dd0: 6566 6175 6c74 3a20 4e6f 6e65 0a20 2020  efault: None.   
+00054de0: 2020 2020 2020 2020 2055 7365 6420 6173           Used as
+00054df0: 206c 6162 656c 7320 666f 7220 7468 6520   labels for the 
+00054e00: 7265 7375 6c74 696e 6720 6269 6e73 2e20  resulting bins. 
+00054e10: 4d75 7374 2062 6520 6f66 2074 6865 2073  Must be of the s
+00054e20: 616d 6520 6c65 6e67 7468 2061 730a 2020  ame length as.  
+00054e30: 2020 2020 2020 2020 2020 7468 6520 7265            the re
+00054e40: 7375 6c74 696e 6720 6269 6e73 2e20 4966  sulting bins. If
+00054e50: 2046 616c 7365 2c20 7374 7269 6e67 2062   False, string b
+00054e60: 696e 206c 6162 656c 7320 6172 6520 6173  in labels are as
+00054e70: 7369 676e 6564 2062 790a 2020 2020 2020  signed by.      
+00054e80: 2020 2020 2020 6070 616e 6461 732e 6375        `pandas.cu
+00054e90: 7460 2e0a 2020 2020 2020 2020 7072 6563  t`..        prec
+00054ea0: 6973 696f 6e20 3a20 696e 742c 2064 6566  ision : int, def
+00054eb0: 6175 6c74 3a20 330a 2020 2020 2020 2020  ault: 3.        
+00054ec0: 2020 2020 5468 6520 7072 6563 6973 696f      The precisio
+00054ed0: 6e20 6174 2077 6869 6368 2074 6f20 7374  n at which to st
+00054ee0: 6f72 6520 616e 6420 6469 7370 6c61 7920  ore and display 
+00054ef0: 7468 6520 6269 6e73 206c 6162 656c 732e  the bins labels.
+00054f00: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
+00054f10: 5f6c 6f77 6573 7420 3a20 626f 6f6c 2c20  _lowest : bool, 
+00054f20: 6465 6661 756c 743a 2046 616c 7365 0a20  default: False. 
+00054f30: 2020 2020 2020 2020 2020 2057 6865 7468             Wheth
+00054f40: 6572 2074 6865 2066 6972 7374 2069 6e74  er the first int
+00054f50: 6572 7661 6c20 7368 6f75 6c64 2062 6520  erval should be 
+00054f60: 6c65 6674 2d69 6e63 6c75 7369 7665 206f  left-inclusive o
+00054f70: 7220 6e6f 742e 0a20 2020 2020 2020 2073  r not..        s
+00054f80: 7175 6565 7a65 203a 2062 6f6f 6c2c 2064  queeze : bool, d
+00054f90: 6566 6175 6c74 3a20 5472 7565 0a20 2020  efault: True.   
+00054fa0: 2020 2020 2020 2020 2049 6620 2267 726f           If "gro
+00054fb0: 7570 2220 6973 2061 2064 696d 656e 7369  up" is a dimensi
+00054fc0: 6f6e 206f 6620 616e 7920 6172 7261 7973  on of any arrays
+00054fd0: 2069 6e20 7468 6973 2064 6174 6173 6574   in this dataset
+00054fe0: 2c20 6073 7175 6565 7a65 600a 2020 2020  , `squeeze`.    
+00054ff0: 2020 2020 2020 2020 636f 6e74 726f 6c73          controls
+00055000: 2077 6865 7468 6572 2074 6865 2073 7562   whether the sub
+00055010: 6172 7261 7973 2068 6176 6520 6120 6469  arrays have a di
+00055020: 6d65 6e73 696f 6e20 6f66 206c 656e 6774  mension of lengt
+00055030: 6820 3120 616c 6f6e 670a 2020 2020 2020  h 1 along.      
+00055040: 2020 2020 2020 7468 6174 2064 696d 656e        that dimen
+00055050: 7369 6f6e 206f 7220 6966 2074 6865 2064  sion or if the d
+00055060: 696d 656e 7369 6f6e 2069 7320 7371 7565  imension is sque
+00055070: 657a 6564 206f 7574 2e0a 2020 2020 2020  ezed out..      
+00055080: 2020 7265 7374 6f72 655f 636f 6f72 645f    restore_coord_
+00055090: 6469 6d73 203a 2062 6f6f 6c2c 2064 6566  dims : bool, def
+000550a0: 6175 6c74 3a20 4661 6c73 650a 2020 2020  ault: False.    
+000550b0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+000550c0: 2061 6c73 6f20 7265 7374 6f72 6520 7468   also restore th
+000550d0: 6520 6469 6d65 6e73 696f 6e20 6f72 6465  e dimension orde
+000550e0: 7220 6f66 206d 756c 7469 2d64 696d 656e  r of multi-dimen
+000550f0: 7369 6f6e 616c 0a20 2020 2020 2020 2020  sional.         
+00055100: 2020 2063 6f6f 7264 696e 6174 6573 2e0a     coordinates..
+00055110: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00055120: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00055130: 0a20 2020 2020 2020 2067 726f 7570 6564  .        grouped
+00055140: 203a 2044 6174 6173 6574 4772 6f75 7042   : DatasetGroupB
+00055150: 790a 2020 2020 2020 2020 2020 2020 4120  y.            A 
+00055160: 6044 6174 6173 6574 4772 6f75 7042 7960  `DatasetGroupBy`
+00055170: 206f 626a 6563 7420 7061 7474 6572 6e65   object patterne
+00055180: 6420 6166 7465 7220 6070 616e 6461 732e  d after `pandas.
+00055190: 4772 6f75 7042 7960 2074 6861 7420 6361  GroupBy` that ca
+000551a0: 6e20 6265 0a20 2020 2020 2020 2020 2020  n be.           
+000551b0: 2069 7465 7261 7465 6420 6f76 6572 2069   iterated over i
+000551c0: 6e20 7468 6520 666f 726d 206f 6620 6028  n the form of `(
+000551d0: 756e 6971 7565 5f76 616c 7565 2c20 6772  unique_value, gr
+000551e0: 6f75 7065 645f 6172 7261 7929 6020 7061  ouped_array)` pa
+000551f0: 6972 732e 0a20 2020 2020 2020 2020 2020  irs..           
+00055200: 2054 6865 206e 616d 6520 6f66 2074 6865   The name of the
+00055210: 2067 726f 7570 2068 6173 2074 6865 2061   group has the a
+00055220: 6464 6564 2073 7566 6669 7820 605f 6269  dded suffix `_bi
+00055230: 6e73 6020 696e 206f 7264 6572 2074 6f0a  ns` in order to.
+00055240: 2020 2020 2020 2020 2020 2020 6469 7374              dist
+00055250: 696e 6775 6973 6820 6974 2066 726f 6d20  inguish it from 
+00055260: 7468 6520 6f72 6967 696e 616c 2076 6172  the original var
+00055270: 6961 626c 652e 0a0a 2020 2020 2020 2020  iable...        
+00055280: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00055290: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+000552a0: 2020 3a72 6566 3a60 6772 6f75 7062 7960    :ref:`groupby`
+000552b0: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
+000552c0: 7273 2067 7569 6465 2065 7870 6c61 6e61  rs guide explana
+000552d0: 7469 6f6e 206f 6620 686f 7720 746f 2067  tion of how to g
+000552e0: 726f 7570 2061 6e64 2062 696e 2064 6174  roup and bin dat
+000552f0: 612e 0a20 2020 2020 2020 2044 6174 6173  a..        Datas
+00055300: 6574 2e67 726f 7570 6279 0a20 2020 2020  et.groupby.     
+00055310: 2020 2044 6174 6141 7272 6179 2e67 726f     DataArray.gro
+00055320: 7570 6279 5f62 696e 730a 2020 2020 2020  upby_bins.      
+00055330: 2020 636f 7265 2e67 726f 7570 6279 2e44    core.groupby.D
+00055340: 6174 6173 6574 4772 6f75 7042 790a 2020  atasetGroupBy.  
+00055350: 2020 2020 2020 7061 6e64 6173 2e44 6174        pandas.Dat
+00055360: 6146 7261 6d65 2e67 726f 7570 6279 0a0a  aFrame.groupby..
+00055370: 2020 2020 2020 2020 5265 6665 7265 6e63          Referenc
+00055380: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+00055390: 2d2d 2d2d 2d0a 2020 2020 2020 2020 2e2e  -----.        ..
+000553a0: 205b 315d 2068 7474 703a 2f2f 7061 6e64   [1] http://pand
+000553b0: 6173 2e70 7964 6174 612e 6f72 672f 7061  as.pydata.org/pa
+000553c0: 6e64 6173 2d64 6f63 732f 7374 6162 6c65  ndas-docs/stable
+000553d0: 2f67 656e 6572 6174 6564 2f70 616e 6461  /generated/panda
+000553e0: 732e 6375 742e 6874 6d6c 0a20 2020 2020  s.cut.html.     
+000553f0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00055400: 726f 6d20 7861 7272 6179 2e63 6f72 652e  rom xarray.core.
+00055410: 6772 6f75 7062 7920 696d 706f 7274 2028  groupby import (
+00055420: 0a20 2020 2020 2020 2020 2020 2042 696e  .            Bin
+00055430: 4772 6f75 7065 722c 0a20 2020 2020 2020  Grouper,.       
+00055440: 2020 2020 2044 6174 6173 6574 4772 6f75       DatasetGrou
+00055450: 7042 792c 0a20 2020 2020 2020 2020 2020  pBy,.           
+00055460: 2052 6573 6f6c 7665 6442 696e 4772 6f75   ResolvedBinGrou
+00055470: 7065 722c 0a20 2020 2020 2020 2020 2020  per,.           
+00055480: 205f 7661 6c69 6461 7465 5f67 726f 7570   _validate_group
+00055490: 6279 5f73 7175 6565 7a65 2c0a 2020 2020  by_squeeze,.    
+000554a0: 2020 2020 290a 0a20 2020 2020 2020 205f      )..        _
+000554b0: 7661 6c69 6461 7465 5f67 726f 7570 6279  validate_groupby
+000554c0: 5f73 7175 6565 7a65 2873 7175 6565 7a65  _squeeze(squeeze
+000554d0: 290a 2020 2020 2020 2020 6772 6f75 7065  ).        groupe
+000554e0: 7220 3d20 4269 6e47 726f 7570 6572 280a  r = BinGrouper(.
+000554f0: 2020 2020 2020 2020 2020 2020 6269 6e73              bins
+00055500: 3d62 696e 732c 0a20 2020 2020 2020 2020  =bins,.         
+00055510: 2020 2063 7574 5f6b 7761 7267 733d 7b0a     cut_kwargs={.
+00055520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055530: 2272 6967 6874 223a 2072 6967 6874 2c0a  "right": right,.
+00055540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055550: 226c 6162 656c 7322 3a20 6c61 6265 6c73  "labels": labels
+00055560: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00055570: 2020 2270 7265 6369 7369 6f6e 223a 2070    "precision": p
+00055580: 7265 6369 7369 6f6e 2c0a 2020 2020 2020  recision,.      
+00055590: 2020 2020 2020 2020 2020 2269 6e63 6c75            "inclu
+000555a0: 6465 5f6c 6f77 6573 7422 3a20 696e 636c  de_lowest": incl
+000555b0: 7564 655f 6c6f 7765 7374 2c0a 2020 2020  ude_lowest,.    
+000555c0: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+000555d0: 2020 2029 0a20 2020 2020 2020 2072 6772     ).        rgr
+000555e0: 6f75 7065 7220 3d20 5265 736f 6c76 6564  ouper = Resolved
+000555f0: 4269 6e47 726f 7570 6572 2867 726f 7570  BinGrouper(group
+00055600: 6572 2c20 6772 6f75 702c 2073 656c 6629  er, group, self)
+00055610: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00055620: 2044 6174 6173 6574 4772 6f75 7042 7928   DatasetGroupBy(
+00055630: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00055640: 662c 0a20 2020 2020 2020 2020 2020 2028  f,.            (
+00055650: 7267 726f 7570 6572 2c29 2c0a 2020 2020  rgrouper,),.    
+00055660: 2020 2020 2020 2020 7371 7565 657a 653d          squeeze=
+00055670: 7371 7565 657a 652c 0a20 2020 2020 2020  squeeze,.       
+00055680: 2020 2020 2072 6573 746f 7265 5f63 6f6f       restore_coo
+00055690: 7264 5f64 696d 733d 7265 7374 6f72 655f  rd_dims=restore_
+000556a0: 636f 6f72 645f 6469 6d73 2c0a 2020 2020  coord_dims,.    
+000556b0: 2020 2020 290a 0a20 2020 2064 6566 2077      )..    def w
+000556c0: 6569 6768 7465 6428 7365 6c66 2c20 7765  eighted(self, we
+000556d0: 6967 6874 733a 2044 6174 6141 7272 6179  ights: DataArray
+000556e0: 2920 2d3e 2044 6174 6173 6574 5765 6967  ) -> DatasetWeig
+000556f0: 6874 6564 3a0a 2020 2020 2020 2020 2222  hted:.        ""
+00055700: 220a 2020 2020 2020 2020 5765 6967 6874  ".        Weight
+00055710: 6564 2044 6174 6173 6574 206f 7065 7261  ed Dataset opera
+00055720: 7469 6f6e 732e 0a0a 2020 2020 2020 2020  tions...        
+00055730: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00055740: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00055750: 2020 2020 2020 7765 6967 6874 7320 3a20        weights : 
+00055760: 4461 7461 4172 7261 790a 2020 2020 2020  DataArray.      
+00055770: 2020 2020 2020 416e 2061 7272 6179 206f        An array o
+00055780: 6620 7765 6967 6874 7320 6173 736f 6369  f weights associ
+00055790: 6174 6564 2077 6974 6820 7468 6520 7661  ated with the va
+000557a0: 6c75 6573 2069 6e20 7468 6973 2044 6174  lues in this Dat
+000557b0: 6173 6574 2e0a 2020 2020 2020 2020 2020  aset..          
+000557c0: 2020 4561 6368 2076 616c 7565 2069 6e20    Each value in 
+000557d0: 7468 6520 6461 7461 2063 6f6e 7472 6962  the data contrib
+000557e0: 7574 6573 2074 6f20 7468 6520 7265 6475  utes to the redu
+000557f0: 6374 696f 6e20 6f70 6572 6174 696f 6e0a  ction operation.
+00055800: 2020 2020 2020 2020 2020 2020 6163 636f              acco
+00055810: 7264 696e 6720 746f 2069 7473 2061 7373  rding to its ass
+00055820: 6f63 6961 7465 6420 7765 6967 6874 2e0a  ociated weight..
+00055830: 0a20 2020 2020 2020 204e 6f74 6573 0a20  .        Notes. 
+00055840: 2020 2020 2020 202d 2d2d 2d2d 0a20 2020         -----.   
+00055850: 2020 2020 2060 6077 6569 6768 7473 6060       ``weights``
+00055860: 206d 7573 7420 6265 2061 2044 6174 6141   must be a DataA
+00055870: 7272 6179 2061 6e64 2063 616e 6e6f 7420  rray and cannot 
+00055880: 636f 6e74 6169 6e20 6d69 7373 696e 6720  contain missing 
+00055890: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
+000558a0: 4d69 7373 696e 6720 7661 6c75 6573 2063  Missing values c
+000558b0: 616e 2062 6520 7265 706c 6163 6564 2062  an be replaced b
+000558c0: 7920 6060 7765 6967 6874 732e 6669 6c6c  y ``weights.fill
+000558d0: 6e61 2830 2960 602e 0a0a 2020 2020 2020  na(0)``...      
+000558e0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+000558f0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00055900: 2020 636f 7265 2e77 6569 6768 7465 642e    core.weighted.
+00055910: 4461 7461 7365 7457 6569 6768 7465 640a  DatasetWeighted.
+00055920: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00055930: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00055940: 2d2d 0a20 2020 2020 2020 2044 6174 6141  --.        DataA
+00055950: 7272 6179 2e77 6569 6768 7465 640a 2020  rray.weighted.  
+00055960: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00055970: 2020 6672 6f6d 2078 6172 7261 792e 636f    from xarray.co
+00055980: 7265 2e77 6569 6768 7465 6420 696d 706f  re.weighted impo
+00055990: 7274 2044 6174 6173 6574 5765 6967 6874  rt DatasetWeight
+000559a0: 6564 0a0a 2020 2020 2020 2020 7265 7475  ed..        retu
+000559b0: 726e 2044 6174 6173 6574 5765 6967 6874  rn DatasetWeight
+000559c0: 6564 2873 656c 662c 2077 6569 6768 7473  ed(self, weights
+000559d0: 290a 0a20 2020 2064 6566 2072 6f6c 6c69  )..    def rolli
+000559e0: 6e67 280a 2020 2020 2020 2020 7365 6c66  ng(.        self
+000559f0: 2c0a 2020 2020 2020 2020 6469 6d3a 204d  ,.        dim: M
+00055a00: 6170 7069 6e67 5b41 6e79 2c20 696e 745d  apping[Any, int]
+00055a10: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00055a20: 2020 2020 2020 2020 6d69 6e5f 7065 7269          min_peri
+00055a30: 6f64 733a 2069 6e74 207c 204e 6f6e 6520  ods: int | None 
+00055a40: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00055a50: 6365 6e74 6572 3a20 626f 6f6c 207c 204d  center: bool | M
+00055a60: 6170 7069 6e67 5b41 6e79 2c20 626f 6f6c  apping[Any, bool
+00055a70: 5d20 3d20 4661 6c73 652c 0a20 2020 2020  ] = False,.     
+00055a80: 2020 202a 2a77 696e 646f 775f 6b77 6172     **window_kwar
+00055a90: 6773 3a20 696e 742c 0a20 2020 2029 202d  gs: int,.    ) -
+00055aa0: 3e20 4461 7461 7365 7452 6f6c 6c69 6e67  > DatasetRolling
+00055ab0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00055ac0: 2020 2020 2020 526f 6c6c 696e 6720 7769        Rolling wi
+00055ad0: 6e64 6f77 206f 626a 6563 7420 666f 7220  ndow object for 
+00055ae0: 4461 7461 7365 7473 2e0a 0a20 2020 2020  Datasets...     
+00055af0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00055b00: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00055b10: 0a20 2020 2020 2020 2064 696d 203a 2064  .        dim : d
+00055b20: 6963 742c 206f 7074 696f 6e61 6c0a 2020  ict, optional.  
+00055b30: 2020 2020 2020 2020 2020 4d61 7070 696e            Mappin
+00055b40: 6720 6672 6f6d 2074 6865 2064 696d 656e  g from the dimen
+00055b50: 7369 6f6e 206e 616d 6520 746f 2063 7265  sion name to cre
+00055b60: 6174 6520 7468 6520 726f 6c6c 696e 6720  ate the rolling 
+00055b70: 6974 6572 6174 6f72 0a20 2020 2020 2020  iterator.       
+00055b80: 2020 2020 2061 6c6f 6e67 2028 652e 672e       along (e.g.
+00055b90: 2060 7469 6d65 6029 2074 6f20 6974 7320   `time`) to its 
+00055ba0: 6d6f 7669 6e67 2077 696e 646f 7720 7369  moving window si
+00055bb0: 7a65 2e0a 2020 2020 2020 2020 6d69 6e5f  ze..        min_
+00055bc0: 7065 7269 6f64 7320 3a20 696e 7420 6f72  periods : int or
+00055bd0: 204e 6f6e 652c 2064 6566 6175 6c74 3a20   None, default: 
+00055be0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00055bf0: 204d 696e 696d 756d 206e 756d 6265 7220   Minimum number 
+00055c00: 6f66 206f 6273 6572 7661 7469 6f6e 7320  of observations 
+00055c10: 696e 2077 696e 646f 7720 7265 7175 6972  in window requir
+00055c20: 6564 2074 6f20 6861 7665 2061 2076 616c  ed to have a val
+00055c30: 7565 0a20 2020 2020 2020 2020 2020 2028  ue.            (
+00055c40: 6f74 6865 7277 6973 6520 7265 7375 6c74  otherwise result
+00055c50: 2069 7320 4e41 292e 2054 6865 2064 6566   is NA). The def
+00055c60: 6175 6c74 2c20 4e6f 6e65 2c20 6973 2065  ault, None, is e
+00055c70: 7175 6976 616c 656e 7420 746f 0a20 2020  quivalent to.   
+00055c80: 2020 2020 2020 2020 2073 6574 7469 6e67           setting
+00055c90: 206d 696e 5f70 6572 696f 6473 2065 7175   min_periods equ
+00055ca0: 616c 2074 6f20 7468 6520 7369 7a65 206f  al to the size o
+00055cb0: 6620 7468 6520 7769 6e64 6f77 2e0a 2020  f the window..  
+00055cc0: 2020 2020 2020 6365 6e74 6572 203a 2062        center : b
+00055cd0: 6f6f 6c20 6f72 204d 6170 7069 6e67 2074  ool or Mapping t
+00055ce0: 6f20 696e 742c 2064 6566 6175 6c74 3a20  o int, default: 
+00055cf0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00055d00: 2020 5365 7420 7468 6520 6c61 6265 6c73    Set the labels
+00055d10: 2061 7420 7468 6520 6365 6e74 6572 206f   at the center o
+00055d20: 6620 7468 6520 7769 6e64 6f77 2e0a 2020  f the window..  
+00055d30: 2020 2020 2020 2a2a 7769 6e64 6f77 5f6b        **window_k
+00055d40: 7761 7267 7320 3a20 6f70 7469 6f6e 616c  wargs : optional
+00055d50: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00055d60: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00055d70: 7473 2066 6f72 6d20 6f66 2060 6064 696d  ts form of ``dim
+00055d80: 6060 2e0a 2020 2020 2020 2020 2020 2020  ``..            
+00055d90: 4f6e 6520 6f66 2064 696d 206f 7220 7769  One of dim or wi
+00055da0: 6e64 6f77 5f6b 7761 7267 7320 6d75 7374  ndow_kwargs must
+00055db0: 2062 6520 7072 6f76 6964 6564 2e0a 0a20   be provided... 
+00055dc0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00055dd0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+00055de0: 2020 2020 2020 2063 6f72 652e 726f 6c6c         core.roll
+00055df0: 696e 672e 4461 7461 7365 7452 6f6c 6c69  ing.DatasetRolli
+00055e00: 6e67 0a0a 2020 2020 2020 2020 5365 6520  ng..        See 
+00055e10: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+00055e20: 2d2d 2d2d 2d0a 2020 2020 2020 2020 636f  -----.        co
+00055e30: 7265 2e72 6f6c 6c69 6e67 2e44 6174 6173  re.rolling.Datas
+00055e40: 6574 526f 6c6c 696e 670a 2020 2020 2020  etRolling.      
+00055e50: 2020 4461 7461 4172 7261 792e 726f 6c6c    DataArray.roll
+00055e60: 696e 670a 2020 2020 2020 2020 2222 220a  ing.        """.
+00055e70: 2020 2020 2020 2020 6672 6f6d 2078 6172          from xar
+00055e80: 7261 792e 636f 7265 2e72 6f6c 6c69 6e67  ray.core.rolling
+00055e90: 2069 6d70 6f72 7420 4461 7461 7365 7452   import DatasetR
+00055ea0: 6f6c 6c69 6e67 0a0a 2020 2020 2020 2020  olling..        
+00055eb0: 6469 6d20 3d20 6569 7468 6572 5f64 6963  dim = either_dic
+00055ec0: 745f 6f72 5f6b 7761 7267 7328 6469 6d2c  t_or_kwargs(dim,
+00055ed0: 2077 696e 646f 775f 6b77 6172 6773 2c20   window_kwargs, 
+00055ee0: 2272 6f6c 6c69 6e67 2229 0a20 2020 2020  "rolling").     
+00055ef0: 2020 2072 6574 7572 6e20 4461 7461 7365     return Datase
+00055f00: 7452 6f6c 6c69 6e67 2873 656c 662c 2064  tRolling(self, d
+00055f10: 696d 2c20 6d69 6e5f 7065 7269 6f64 733d  im, min_periods=
+00055f20: 6d69 6e5f 7065 7269 6f64 732c 2063 656e  min_periods, cen
+00055f30: 7465 723d 6365 6e74 6572 290a 0a20 2020  ter=center)..   
+00055f40: 2064 6566 2063 6f61 7273 656e 280a 2020   def coarsen(.  
+00055f50: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00055f60: 2020 2020 6469 6d3a 204d 6170 7069 6e67      dim: Mapping
+00055f70: 5b41 6e79 2c20 696e 745d 207c 204e 6f6e  [Any, int] | Non
+00055f80: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00055f90: 2020 626f 756e 6461 7279 3a20 436f 6172    boundary: Coar
+00055fa0: 7365 6e42 6f75 6e64 6172 794f 7074 696f  senBoundaryOptio
+00055fb0: 6e73 203d 2022 6578 6163 7422 2c0a 2020  ns = "exact",.  
+00055fc0: 2020 2020 2020 7369 6465 3a20 5369 6465        side: Side
+00055fd0: 4f70 7469 6f6e 7320 7c20 4d61 7070 696e  Options | Mappin
+00055fe0: 675b 416e 792c 2053 6964 654f 7074 696f  g[Any, SideOptio
+00055ff0: 6e73 5d20 3d20 226c 6566 7422 2c0a 2020  ns] = "left",.  
+00056000: 2020 2020 2020 636f 6f72 645f 6675 6e63        coord_func
+00056010: 3a20 7374 7220 7c20 4361 6c6c 6162 6c65  : str | Callable
+00056020: 207c 204d 6170 7069 6e67 5b41 6e79 2c20   | Mapping[Any, 
+00056030: 7374 7220 7c20 4361 6c6c 6162 6c65 5d20  str | Callable] 
+00056040: 3d20 226d 6561 6e22 2c0a 2020 2020 2020  = "mean",.      
+00056050: 2020 2a2a 7769 6e64 6f77 5f6b 7761 7267    **window_kwarg
+00056060: 733a 2069 6e74 2c0a 2020 2020 2920 2d3e  s: int,.    ) ->
+00056070: 2044 6174 6173 6574 436f 6172 7365 6e3a   DatasetCoarsen:
+00056080: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00056090: 2020 2020 2043 6f61 7273 656e 206f 626a       Coarsen obj
+000560a0: 6563 7420 666f 7220 4461 7461 7365 7473  ect for Datasets
+000560b0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+000560c0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+000560d0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000560e0: 2064 696d 203a 206d 6170 7069 6e67 206f   dim : mapping o
+000560f0: 6620 6861 7368 6162 6c65 2074 6f20 696e  f hashable to in
+00056100: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
+00056110: 2020 2020 2020 2020 4d61 7070 696e 6720          Mapping 
+00056120: 6672 6f6d 2074 6865 2064 696d 656e 7369  from the dimensi
+00056130: 6f6e 206e 616d 6520 746f 2074 6865 2077  on name to the w
+00056140: 696e 646f 7720 7369 7a65 2e0a 2020 2020  indow size..    
+00056150: 2020 2020 626f 756e 6461 7279 203a 207b      boundary : {
+00056160: 2265 7861 6374 222c 2022 7472 696d 222c  "exact", "trim",
+00056170: 2022 7061 6422 7d2c 2064 6566 6175 6c74   "pad"}, default
+00056180: 3a20 2265 7861 6374 220a 2020 2020 2020  : "exact".      
+00056190: 2020 2020 2020 4966 2027 6578 6163 7427        If 'exact'
+000561a0: 2c20 6120 5661 6c75 6545 7272 6f72 2077  , a ValueError w
+000561b0: 696c 6c20 6265 2072 6169 7365 6420 6966  ill be raised if
+000561c0: 2064 696d 656e 7369 6f6e 2073 697a 6520   dimension size 
+000561d0: 6973 206e 6f74 2061 0a20 2020 2020 2020  is not a.       
+000561e0: 2020 2020 206d 756c 7469 706c 6520 6f66       multiple of
+000561f0: 2074 6865 2077 696e 646f 7720 7369 7a65   the window size
+00056200: 2e20 4966 2027 7472 696d 272c 2074 6865  . If 'trim', the
+00056210: 2065 7863 6573 7320 656e 7472 6965 7320   excess entries 
+00056220: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+00056230: 6472 6f70 7065 642e 2049 6620 2770 6164  dropped. If 'pad
+00056240: 272c 204e 4120 7769 6c6c 2062 6520 7061  ', NA will be pa
+00056250: 6464 6564 2e0a 2020 2020 2020 2020 7369  dded..        si
+00056260: 6465 203a 207b 226c 6566 7422 2c20 2272  de : {"left", "r
+00056270: 6967 6874 227d 206f 7220 6d61 7070 696e  ight"} or mappin
+00056280: 6720 6f66 2073 7472 2074 6f20 7b22 6c65  g of str to {"le
+00056290: 6674 222c 2022 7269 6768 7422 7d2c 2064  ft", "right"}, d
+000562a0: 6566 6175 6c74 3a20 226c 6566 7422 0a20  efault: "left". 
+000562b0: 2020 2020 2020 2063 6f6f 7264 5f66 756e         coord_fun
+000562c0: 6320 3a20 7374 7220 6f72 206d 6170 7069  c : str or mappi
+000562d0: 6e67 206f 6620 6861 7368 6162 6c65 2074  ng of hashable t
+000562e0: 6f20 7374 722c 2064 6566 6175 6c74 3a20  o str, default: 
+000562f0: 226d 6561 6e22 0a20 2020 2020 2020 2020  "mean".         
+00056300: 2020 2066 756e 6374 696f 6e20 286e 616d     function (nam
+00056310: 6529 2074 6861 7420 6973 2061 7070 6c69  e) that is appli
+00056320: 6564 2074 6f20 7468 6520 636f 6f72 6469  ed to the coordi
+00056330: 6e61 7465 732c 0a20 2020 2020 2020 2020  nates,.         
+00056340: 2020 206f 7220 6120 6d61 7070 696e 6720     or a mapping 
+00056350: 6672 6f6d 2063 6f6f 7264 696e 6174 6520  from coordinate 
+00056360: 6e61 6d65 2074 6f20 6675 6e63 7469 6f6e  name to function
+00056370: 2028 6e61 6d65 292e 0a0a 2020 2020 2020   (name)...      
+00056380: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00056390: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+000563a0: 2020 636f 7265 2e72 6f6c 6c69 6e67 2e44    core.rolling.D
+000563b0: 6174 6173 6574 436f 6172 7365 6e0a 0a20  atasetCoarsen.. 
+000563c0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+000563d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000563e0: 0a20 2020 2020 2020 2063 6f72 652e 726f  .        core.ro
+000563f0: 6c6c 696e 672e 4461 7461 7365 7443 6f61  lling.DatasetCoa
+00056400: 7273 656e 0a20 2020 2020 2020 2044 6174  rsen.        Dat
+00056410: 6141 7272 6179 2e63 6f61 7273 656e 0a20  aArray.coarsen. 
+00056420: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00056430: 2020 2066 726f 6d20 7861 7272 6179 2e63     from xarray.c
+00056440: 6f72 652e 726f 6c6c 696e 6720 696d 706f  ore.rolling impo
+00056450: 7274 2044 6174 6173 6574 436f 6172 7365  rt DatasetCoarse
+00056460: 6e0a 0a20 2020 2020 2020 2064 696d 203d  n..        dim =
+00056470: 2065 6974 6865 725f 6469 6374 5f6f 725f   either_dict_or_
+00056480: 6b77 6172 6773 2864 696d 2c20 7769 6e64  kwargs(dim, wind
+00056490: 6f77 5f6b 7761 7267 732c 2022 636f 6172  ow_kwargs, "coar
+000564a0: 7365 6e22 290a 2020 2020 2020 2020 7265  sen").        re
+000564b0: 7475 726e 2044 6174 6173 6574 436f 6172  turn DatasetCoar
+000564c0: 7365 6e28 0a20 2020 2020 2020 2020 2020  sen(.           
+000564d0: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+000564e0: 2020 2064 696d 2c0a 2020 2020 2020 2020     dim,.        
+000564f0: 2020 2020 626f 756e 6461 7279 3d62 6f75      boundary=bou
+00056500: 6e64 6172 792c 0a20 2020 2020 2020 2020  ndary,.         
+00056510: 2020 2073 6964 653d 7369 6465 2c0a 2020     side=side,.  
+00056520: 2020 2020 2020 2020 2020 636f 6f72 645f            coord_
+00056530: 6675 6e63 3d63 6f6f 7264 5f66 756e 632c  func=coord_func,
+00056540: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00056550: 6465 6620 7265 7361 6d70 6c65 280a 2020  def resample(.  
+00056560: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00056570: 2020 2020 696e 6465 7865 723a 204d 6170      indexer: Map
+00056580: 7069 6e67 5b41 6e79 2c20 7374 725d 207c  ping[Any, str] |
+00056590: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
+000565a0: 2020 2020 2020 736b 6970 6e61 3a20 626f        skipna: bo
+000565b0: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
+000565c0: 2c0a 2020 2020 2020 2020 636c 6f73 6564  ,.        closed
+000565d0: 3a20 5369 6465 4f70 7469 6f6e 7320 7c20  : SideOptions | 
+000565e0: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+000565f0: 2020 2020 206c 6162 656c 3a20 5369 6465       label: Side
+00056600: 4f70 7469 6f6e 7320 7c20 4e6f 6e65 203d  Options | None =
+00056610: 204e 6f6e 652c 0a20 2020 2020 2020 2062   None,.        b
+00056620: 6173 653a 2069 6e74 207c 204e 6f6e 6520  ase: int | None 
+00056630: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00056640: 6f66 6673 6574 3a20 7064 2e54 696d 6564  offset: pd.Timed
+00056650: 656c 7461 207c 2064 6174 6574 696d 652e  elta | datetime.
+00056660: 7469 6d65 6465 6c74 6120 7c20 7374 7220  timedelta | str 
+00056670: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+00056680: 2020 2020 2020 206f 7269 6769 6e3a 2073         origin: s
+00056690: 7472 207c 2044 6174 6574 696d 654c 696b  tr | DatetimeLik
+000566a0: 6520 3d20 2273 7461 7274 5f64 6179 222c  e = "start_day",
+000566b0: 0a20 2020 2020 2020 206b 6565 705f 6174  .        keep_at
+000566c0: 7472 733a 2062 6f6f 6c20 7c20 4e6f 6e65  trs: bool | None
+000566d0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000566e0: 206c 6f66 6673 6574 3a20 6461 7465 7469   loffset: dateti
+000566f0: 6d65 2e74 696d 6564 656c 7461 207c 2073  me.timedelta | s
+00056700: 7472 207c 204e 6f6e 6520 3d20 4e6f 6e65  tr | None = None
+00056710: 2c0a 2020 2020 2020 2020 7265 7374 6f72  ,.        restor
+00056720: 655f 636f 6f72 645f 6469 6d73 3a20 626f  e_coord_dims: bo
+00056730: 6f6c 207c 204e 6f6e 6520 3d20 4e6f 6e65  ol | None = None
+00056740: 2c0a 2020 2020 2020 2020 2a2a 696e 6465  ,.        **inde
+00056750: 7865 725f 6b77 6172 6773 3a20 7374 722c  xer_kwargs: str,
+00056760: 0a20 2020 2029 202d 3e20 4461 7461 7365  .    ) -> Datase
+00056770: 7452 6573 616d 706c 653a 0a20 2020 2020  tResample:.     
+00056780: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
+00056790: 5265 7361 6d70 6c65 206f 626a 6563 7420  Resample object 
+000567a0: 666f 7220 7065 7266 6f72 6d69 6e67 2072  for performing r
+000567b0: 6573 616d 706c 696e 6720 6f70 6572 6174  esampling operat
+000567c0: 696f 6e73 2e0a 0a20 2020 2020 2020 2048  ions...        H
+000567d0: 616e 646c 6573 2062 6f74 6820 646f 776e  andles both down
+000567e0: 7361 6d70 6c69 6e67 2061 6e64 2075 7073  sampling and ups
+000567f0: 616d 706c 696e 672e 2054 6865 2072 6573  ampling. The res
+00056800: 616d 706c 6564 0a20 2020 2020 2020 2064  ampled.        d
+00056810: 696d 656e 7369 6f6e 206d 7573 7420 6265  imension must be
+00056820: 2061 2064 6174 6574 696d 652d 6c69 6b65   a datetime-like
+00056830: 2063 6f6f 7264 696e 6174 652e 2049 6620   coordinate. If 
+00056840: 616e 7920 696e 7465 7276 616c 730a 2020  any intervals.  
+00056850: 2020 2020 2020 636f 6e74 6169 6e20 6e6f        contain no
+00056860: 2076 616c 7565 7320 6672 6f6d 2074 6865   values from the
+00056870: 206f 7269 6769 6e61 6c20 6f62 6a65 6374   original object
+00056880: 2c20 7468 6579 2077 696c 6c20 6265 2067  , they will be g
+00056890: 6976 656e 0a20 2020 2020 2020 2074 6865  iven.        the
+000568a0: 2076 616c 7565 2060 604e 614e 6060 2e0a   value ``NaN``..
+000568b0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+000568c0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+000568d0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2069  ------.        i
+000568e0: 6e64 6578 6572 203a 204d 6170 7069 6e67  ndexer : Mapping
+000568f0: 206f 6620 4861 7368 6162 6c65 2074 6f20   of Hashable to 
+00056900: 7374 722c 206f 7074 696f 6e61 6c0a 2020  str, optional.  
+00056910: 2020 2020 2020 2020 2020 4d61 7070 696e            Mappin
+00056920: 6720 6672 6f6d 2074 6865 2064 696d 656e  g from the dimen
+00056930: 7369 6f6e 206e 616d 6520 746f 2072 6573  sion name to res
+00056940: 616d 706c 6520 6672 6571 7565 6e63 7920  ample frequency 
+00056950: 5b31 5d5f 2e20 5468 650a 2020 2020 2020  [1]_. The.      
+00056960: 2020 2020 2020 6469 6d65 6e73 696f 6e20        dimension 
+00056970: 6d75 7374 2062 6520 6461 7465 7469 6d65  must be datetime
+00056980: 2d6c 696b 652e 0a20 2020 2020 2020 2073  -like..        s
+00056990: 6b69 706e 6120 3a20 626f 6f6c 2c20 6f70  kipna : bool, op
+000569a0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+000569b0: 2020 2057 6865 7468 6572 2074 6f20 736b     Whether to sk
+000569c0: 6970 206d 6973 7369 6e67 2076 616c 7565  ip missing value
+000569d0: 7320 7768 656e 2061 6767 7265 6761 7469  s when aggregati
+000569e0: 6e67 2069 6e20 646f 776e 7361 6d70 6c69  ng in downsampli
+000569f0: 6e67 2e0a 2020 2020 2020 2020 636c 6f73  ng..        clos
+00056a00: 6564 203a 207b 226c 6566 7422 2c20 2272  ed : {"left", "r
+00056a10: 6967 6874 227d 2c20 6f70 7469 6f6e 616c  ight"}, optional
+00056a20: 0a20 2020 2020 2020 2020 2020 2053 6964  .            Sid
+00056a30: 6520 6f66 2065 6163 6820 696e 7465 7276  e of each interv
+00056a40: 616c 2074 6f20 7472 6561 7420 6173 2063  al to treat as c
+00056a50: 6c6f 7365 642e 0a20 2020 2020 2020 206c  losed..        l
+00056a60: 6162 656c 203a 207b 226c 6566 7422 2c20  abel : {"left", 
+00056a70: 2272 6967 6874 227d 2c20 6f70 7469 6f6e  "right"}, option
+00056a80: 616c 0a20 2020 2020 2020 2020 2020 2053  al.            S
+00056a90: 6964 6520 6f66 2065 6163 6820 696e 7465  ide of each inte
+00056aa0: 7276 616c 2074 6f20 7573 6520 666f 7220  rval to use for 
+00056ab0: 6c61 6265 6c69 6e67 2e0a 2020 2020 2020  labeling..      
+00056ac0: 2020 6261 7365 203a 2069 6e74 2c20 6f70    base : int, op
+00056ad0: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00056ae0: 2020 2046 6f72 2066 7265 7175 656e 6369     For frequenci
+00056af0: 6573 2074 6861 7420 6576 656e 6c79 2073  es that evenly s
+00056b00: 7562 6469 7669 6465 2031 2064 6179 2c20  ubdivide 1 day, 
+00056b10: 7468 6520 226f 7269 6769 6e22 206f 6620  the "origin" of 
+00056b20: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00056b30: 6167 6772 6567 6174 6564 2069 6e74 6572  aggregated inter
+00056b40: 7661 6c73 2e20 466f 7220 6578 616d 706c  vals. For exampl
+00056b50: 652c 2066 6f72 2022 3234 4822 2066 7265  e, for "24H" fre
+00056b60: 7175 656e 6379 2c20 6261 7365 2063 6f75  quency, base cou
+00056b70: 6c64 0a20 2020 2020 2020 2020 2020 2072  ld.            r
+00056b80: 616e 6765 2066 726f 6d20 3020 7468 726f  ange from 0 thro
+00056b90: 7567 6820 3233 2e0a 2020 2020 2020 2020  ugh 23..        
+00056ba0: 6f72 6967 696e 203a 207b 2765 706f 6368  origin : {'epoch
+00056bb0: 272c 2027 7374 6172 7427 2c20 2773 7461  ', 'start', 'sta
+00056bc0: 7274 5f64 6179 272c 2027 656e 6427 2c20  rt_day', 'end', 
+00056bd0: 2765 6e64 5f64 6179 277d 2c20 7064 2e54  'end_day'}, pd.T
+00056be0: 696d 6573 7461 6d70 2c20 6461 7465 7469  imestamp, dateti
+00056bf0: 6d65 2e64 6174 6574 696d 652c 206e 702e  me.datetime, np.
+00056c00: 6461 7465 7469 6d65 3634 2c20 6f72 2063  datetime64, or c
+00056c10: 6674 696d 652e 6461 7465 7469 6d65 2c20  ftime.datetime, 
+00056c20: 6465 6661 756c 7420 2773 7461 7274 5f64  default 'start_d
+00056c30: 6179 270a 2020 2020 2020 2020 2020 2020  ay'.            
+00056c40: 5468 6520 6461 7465 7469 6d65 206f 6e20  The datetime on 
+00056c50: 7768 6963 6820 746f 2061 646a 7573 7420  which to adjust 
+00056c60: 7468 6520 6772 6f75 7069 6e67 2e20 5468  the grouping. Th
+00056c70: 6520 7469 6d65 7a6f 6e65 206f 6620 6f72  e timezone of or
+00056c80: 6967 696e 0a20 2020 2020 2020 2020 2020  igin.           
+00056c90: 206d 7573 7420 6d61 7463 6820 7468 6520   must match the 
+00056ca0: 7469 6d65 7a6f 6e65 206f 6620 7468 6520  timezone of the 
+00056cb0: 696e 6465 782e 0a0a 2020 2020 2020 2020  index...        
+00056cc0: 2020 2020 4966 2061 2064 6174 6574 696d      If a datetim
+00056cd0: 6520 6973 206e 6f74 2075 7365 642c 2074  e is not used, t
+00056ce0: 6865 7365 2076 616c 7565 7320 6172 6520  hese values are 
+00056cf0: 616c 736f 2073 7570 706f 7274 6564 3a0a  also supported:.
+00056d00: 2020 2020 2020 2020 2020 2020 2d20 2765              - 'e
+00056d10: 706f 6368 273a 2060 6f72 6967 696e 6020  poch': `origin` 
+00056d20: 6973 2031 3937 302d 3031 2d30 310a 2020  is 1970-01-01.  
+00056d30: 2020 2020 2020 2020 2020 2d20 2773 7461            - 'sta
+00056d40: 7274 273a 2060 6f72 6967 696e 6020 6973  rt': `origin` is
+00056d50: 2074 6865 2066 6972 7374 2076 616c 7565   the first value
+00056d60: 206f 6620 7468 6520 7469 6d65 7365 7269   of the timeseri
+00056d70: 6573 0a20 2020 2020 2020 2020 2020 202d  es.            -
+00056d80: 2027 7374 6172 745f 6461 7927 3a20 606f   'start_day': `o
+00056d90: 7269 6769 6e60 2069 7320 7468 6520 6669  rigin` is the fi
+00056da0: 7273 7420 6461 7920 6174 206d 6964 6e69  rst day at midni
+00056db0: 6768 7420 6f66 2074 6865 2074 696d 6573  ght of the times
+00056dc0: 6572 6965 730a 2020 2020 2020 2020 2020  eries.          
+00056dd0: 2020 2d20 2765 6e64 273a 2060 6f72 6967    - 'end': `orig
+00056de0: 696e 6020 6973 2074 6865 206c 6173 7420  in` is the last 
+00056df0: 7661 6c75 6520 6f66 2074 6865 2074 696d  value of the tim
+00056e00: 6573 6572 6965 730a 2020 2020 2020 2020  eseries.        
+00056e10: 2020 2020 2d20 2765 6e64 5f64 6179 273a      - 'end_day':
+00056e20: 2060 6f72 6967 696e 6020 6973 2074 6865   `origin` is the
+00056e30: 2063 6569 6c69 6e67 206d 6964 6e69 6768   ceiling midnigh
+00056e40: 7420 6f66 2074 6865 206c 6173 7420 6461  t of the last da
+00056e50: 790a 2020 2020 2020 2020 6f66 6673 6574  y.        offset
+00056e60: 203a 2070 642e 5469 6d65 6465 6c74 612c   : pd.Timedelta,
+00056e70: 2064 6174 6574 696d 652e 7469 6d65 6465   datetime.timede
+00056e80: 6c74 612c 206f 7220 7374 722c 2064 6566  lta, or str, def
+00056e90: 6175 6c74 2069 7320 4e6f 6e65 0a20 2020  ault is None.   
+00056ea0: 2020 2020 2020 2020 2041 6e20 6f66 6673           An offs
+00056eb0: 6574 2074 696d 6564 656c 7461 2061 6464  et timedelta add
+00056ec0: 6564 2074 6f20 7468 6520 6f72 6967 696e  ed to the origin
+00056ed0: 2e0a 2020 2020 2020 2020 6c6f 6666 7365  ..        loffse
+00056ee0: 7420 3a20 7469 6d65 6465 6c74 6120 6f72  t : timedelta or
+00056ef0: 2073 7472 2c20 6f70 7469 6f6e 616c 0a20   str, optional. 
+00056f00: 2020 2020 2020 2020 2020 204f 6666 7365             Offse
+00056f10: 7420 7573 6564 2074 6f20 6164 6a75 7374  t used to adjust
+00056f20: 2074 6865 2072 6573 616d 706c 6564 2074   the resampled t
+00056f30: 696d 6520 6c61 6265 6c73 2e20 536f 6d65  ime labels. Some
+00056f40: 2070 616e 6461 7320 6461 7465 0a20 2020   pandas date.   
+00056f50: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
+00056f60: 7374 7269 6e67 7320 6172 6520 7375 7070  strings are supp
+00056f70: 6f72 7465 642e 0a20 2020 2020 2020 2072  orted..        r
+00056f80: 6573 746f 7265 5f63 6f6f 7264 5f64 696d  estore_coord_dim
+00056f90: 7320 3a20 626f 6f6c 2c20 6f70 7469 6f6e  s : bool, option
+00056fa0: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
+00056fb0: 6620 5472 7565 2c20 616c 736f 2072 6573  f True, also res
+00056fc0: 746f 7265 2074 6865 2064 696d 656e 7369  tore the dimensi
+00056fd0: 6f6e 206f 7264 6572 206f 6620 6d75 6c74  on order of mult
+00056fe0: 692d 6469 6d65 6e73 696f 6e61 6c0a 2020  i-dimensional.  
+00056ff0: 2020 2020 2020 2020 2020 636f 6f72 6469            coordi
+00057000: 6e61 7465 732e 0a20 2020 2020 2020 202a  nates..        *
+00057010: 2a69 6e64 6578 6572 5f6b 7761 7267 7320  *indexer_kwargs 
+00057020: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+00057030: 2020 5468 6520 6b65 7977 6f72 6420 6172    The keyword ar
+00057040: 6775 6d65 6e74 7320 666f 726d 206f 6620  guments form of 
+00057050: 6060 696e 6465 7865 7260 602e 0a20 2020  ``indexer``..   
+00057060: 2020 2020 2020 2020 204f 6e65 206f 6620           One of 
+00057070: 696e 6465 7865 7220 6f72 2069 6e64 6578  indexer or index
+00057080: 6572 5f6b 7761 7267 7320 6d75 7374 2062  er_kwargs must b
+00057090: 6520 7072 6f76 6964 6564 2e0a 0a20 2020  e provided...   
+000570a0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+000570b0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+000570c0: 2020 2020 2072 6573 616d 706c 6564 203a       resampled :
+000570d0: 2063 6f72 652e 7265 7361 6d70 6c65 2e44   core.resample.D
+000570e0: 6174 6141 7272 6179 5265 7361 6d70 6c65  ataArrayResample
+000570f0: 0a20 2020 2020 2020 2020 2020 2054 6869  .            Thi
+00057100: 7320 6f62 6a65 6374 2072 6573 616d 706c  s object resampl
+00057110: 6564 2e0a 0a20 2020 2020 2020 2053 6565  ed...        See
+00057120: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00057130: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2044  ------.        D
+00057140: 6174 6141 7272 6179 2e72 6573 616d 706c  ataArray.resampl
+00057150: 650a 2020 2020 2020 2020 7061 6e64 6173  e.        pandas
+00057160: 2e53 6572 6965 732e 7265 7361 6d70 6c65  .Series.resample
+00057170: 0a20 2020 2020 2020 2070 616e 6461 732e  .        pandas.
+00057180: 4461 7461 4672 616d 652e 7265 7361 6d70  DataFrame.resamp
+00057190: 6c65 0a20 2020 2020 2020 2044 6174 6173  le.        Datas
+000571a0: 6574 2e67 726f 7570 6279 0a20 2020 2020  et.groupby.     
+000571b0: 2020 2044 6174 6141 7272 6179 2e67 726f     DataArray.gro
+000571c0: 7570 6279 0a0a 2020 2020 2020 2020 5265  upby..        Re
+000571d0: 6665 7265 6e63 6573 0a20 2020 2020 2020  ferences.       
+000571e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+000571f0: 2020 2020 2e2e 205b 315d 2068 7474 703a      .. [1] http:
+00057200: 2f2f 7061 6e64 6173 2e70 7964 6174 612e  //pandas.pydata.
+00057210: 6f72 672f 7061 6e64 6173 2d64 6f63 732f  org/pandas-docs/
+00057220: 7374 6162 6c65 2f74 696d 6573 6572 6965  stable/timeserie
+00057230: 732e 6874 6d6c 236f 6666 7365 742d 616c  s.html#offset-al
+00057240: 6961 7365 730a 2020 2020 2020 2020 2222  iases.        ""
+00057250: 220a 2020 2020 2020 2020 6672 6f6d 2078  ".        from x
+00057260: 6172 7261 792e 636f 7265 2e72 6573 616d  array.core.resam
+00057270: 706c 6520 696d 706f 7274 2044 6174 6173  ple import Datas
+00057280: 6574 5265 7361 6d70 6c65 0a0a 2020 2020  etResample..    
+00057290: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000572a0: 5f72 6573 616d 706c 6528 0a20 2020 2020  _resample(.     
+000572b0: 2020 2020 2020 2072 6573 616d 706c 655f         resample_
+000572c0: 636c 733d 4461 7461 7365 7452 6573 616d  cls=DatasetResam
+000572d0: 706c 652c 0a20 2020 2020 2020 2020 2020  ple,.           
+000572e0: 2069 6e64 6578 6572 3d69 6e64 6578 6572   indexer=indexer
+000572f0: 2c0a 2020 2020 2020 2020 2020 2020 736b  ,.            sk
+00057300: 6970 6e61 3d73 6b69 706e 612c 0a20 2020  ipna=skipna,.   
+00057310: 2020 2020 2020 2020 2063 6c6f 7365 643d           closed=
+00057320: 636c 6f73 6564 2c0a 2020 2020 2020 2020  closed,.        
+00057330: 2020 2020 6c61 6265 6c3d 6c61 6265 6c2c      label=label,
+00057340: 0a20 2020 2020 2020 2020 2020 2062 6173  .            bas
+00057350: 653d 6261 7365 2c0a 2020 2020 2020 2020  e=base,.        
+00057360: 2020 2020 6f66 6673 6574 3d6f 6666 7365      offset=offse
+00057370: 742c 0a20 2020 2020 2020 2020 2020 206f  t,.            o
+00057380: 7269 6769 6e3d 6f72 6967 696e 2c0a 2020  rigin=origin,.  
+00057390: 2020 2020 2020 2020 2020 6b65 6570 5f61            keep_a
+000573a0: 7474 7273 3d6b 6565 705f 6174 7472 732c  ttrs=keep_attrs,
+000573b0: 0a20 2020 2020 2020 2020 2020 206c 6f66  .            lof
+000573c0: 6673 6574 3d6c 6f66 6673 6574 2c0a 2020  fset=loffset,.  
+000573d0: 2020 2020 2020 2020 2020 7265 7374 6f72            restor
+000573e0: 655f 636f 6f72 645f 6469 6d73 3d72 6573  e_coord_dims=res
+000573f0: 746f 7265 5f63 6f6f 7264 5f64 696d 732c  tore_coord_dims,
+00057400: 0a20 2020 2020 2020 2020 2020 202a 2a69  .            **i
+00057410: 6e64 6578 6572 5f6b 7761 7267 732c 0a20  ndexer_kwargs,. 
+00057420: 2020 2020 2020 2029 0a                          ).
```

### Comparing `xarray-2023.4.2/xarray/core/dtypes.py` & `xarray-2023.5.0/xarray/core/dtypes.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/duck_array_ops.py` & `xarray-2023.5.0/xarray/core/duck_array_ops.py`

 * *Files 4% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 """
 from __future__ import annotations
 
 import contextlib
 import datetime
 import inspect
 import warnings
+from functools import partial
 from importlib import import_module
 
 import numpy as np
 import pandas as pd
 from numpy import all as array_all  # noqa
 from numpy import any as array_any  # noqa
 from numpy import (  # noqa
@@ -25,18 +26,19 @@
     take,
     tensordot,
     transpose,
     unravel_index,
     zeros_like,  # noqa
 )
 from numpy import concatenate as _concatenate
+from numpy.core.multiarray import normalize_axis_index  # type: ignore[attr-defined]
 from numpy.lib.stride_tricks import sliding_window_view  # noqa
 
 from xarray.core import dask_array_ops, dtypes, nputils
-from xarray.core.nputils import nanfirst, nanlast
+from xarray.core.parallelcompat import get_chunked_array_type, is_chunked_array
 from xarray.core.pycompat import array_type, is_duck_dask_array
 from xarray.core.utils import is_duck_array, module_available
 
 dask_available = module_available("dask")
 
 
 def get_array_namespace(x):
@@ -636,29 +638,29 @@
     return _nd_cum_func(cumsum_1d, array, axis, **kwargs)
 
 
 def first(values, axis, skipna=None):
     """Return the first non-NA elements in this array along the given axis"""
     if (skipna or skipna is None) and values.dtype.kind not in "iSU":
         # only bother for dtypes that can hold NaN
-        if is_duck_dask_array(values):
-            return dask_array_ops.nanfirst(values, axis)
+        if is_chunked_array(values):
+            return chunked_nanfirst(values, axis)
         else:
-            return nanfirst(values, axis)
+            return nputils.nanfirst(values, axis)
     return take(values, 0, axis=axis)
 
 
 def last(values, axis, skipna=None):
     """Return the last non-NA elements in this array along the given axis"""
     if (skipna or skipna is None) and values.dtype.kind not in "iSU":
         # only bother for dtypes that can hold NaN
-        if is_duck_dask_array(values):
-            return dask_array_ops.nanlast(values, axis)
+        if is_chunked_array(values):
+            return chunked_nanlast(values, axis)
         else:
-            return nanlast(values, axis)
+            return nputils.nanlast(values, axis)
     return take(values, -1, axis=axis)
 
 
 def least_squares(lhs, rhs, rcond=None, skipna=False):
     """Return the coefficients and residuals of a least-squares fit."""
     if is_duck_dask_array(rhs):
         return dask_array_ops.least_squares(lhs, rhs, rcond=rcond, skipna=skipna)
@@ -669,7 +671,36 @@
 def push(array, n, axis):
     from bottleneck import push
 
     if is_duck_dask_array(array):
         return dask_array_ops.push(array, n, axis)
     else:
         return push(array, n, axis)
+
+
+def _first_last_wrapper(array, *, axis, op, keepdims):
+    return op(array, axis, keepdims=keepdims)
+
+
+def _chunked_first_or_last(darray, axis, op):
+    chunkmanager = get_chunked_array_type(darray)
+
+    # This will raise the same error message seen for numpy
+    axis = normalize_axis_index(axis, darray.ndim)
+
+    wrapped_op = partial(_first_last_wrapper, op=op)
+    return chunkmanager.reduction(
+        darray,
+        func=wrapped_op,
+        aggregate_func=wrapped_op,
+        axis=axis,
+        dtype=darray.dtype,
+        keepdims=False,  # match numpy version
+    )
+
+
+def chunked_nanfirst(darray, axis):
+    return _chunked_first_or_last(darray, axis, op=nputils.nanfirst)
+
+
+def chunked_nanlast(darray, axis):
+    return _chunked_first_or_last(darray, axis, op=nputils.nanlast)
```

### Comparing `xarray-2023.4.2/xarray/core/extensions.py` & `xarray-2023.5.0/xarray/core/extensions.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/formatting.py` & `xarray-2023.5.0/xarray/core/formatting.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/formatting_html.py` & `xarray-2023.5.0/xarray/core/formatting_html.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/groupby.py` & `xarray-2023.5.0/xarray/core/groupby.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,13 +1,22 @@
 from __future__ import annotations
 
 import datetime
 import warnings
+from abc import ABC, abstractmethod
 from collections.abc import Hashable, Iterator, Mapping, Sequence
-from typing import TYPE_CHECKING, Any, Callable, Generic, Literal, TypeVar, Union, cast
+from dataclasses import dataclass, field
+from typing import (
+    TYPE_CHECKING,
+    Any,
+    Callable,
+    Generic,
+    Literal,
+    Union,
+)
 
 import numpy as np
 import pandas as pd
 
 from xarray.core import dtypes, duck_array_ops, nputils, ops
 from xarray.core._aggregations import (
     DataArrayGroupByAggregations,
@@ -21,36 +30,39 @@
 from xarray.core.indexes import (
     create_default_index_implicit,
     filter_indexes_from_coords,
     safe_cast_to_index,
 )
 from xarray.core.options import _get_keep_attrs
 from xarray.core.pycompat import integer_types
-from xarray.core.types import Dims, QuantileMethods, T_Xarray
+from xarray.core.types import Dims, QuantileMethods, T_DataArray, T_Xarray
 from xarray.core.utils import (
     either_dict_or_kwargs,
     hashable,
     is_scalar,
     maybe_wrap_array,
     peek_at,
 )
 from xarray.core.variable import IndexVariable, Variable
 
 if TYPE_CHECKING:
     from numpy.typing import ArrayLike
 
     from xarray.core.dataarray import DataArray
     from xarray.core.dataset import Dataset
+    from xarray.core.resample_cftime import CFTimeGrouper
     from xarray.core.types import DatetimeLike, SideOptions
     from xarray.core.utils import Frozen
 
     GroupKey = Any
-
-    T_GroupIndicesListInt = list[list[int]]
-    T_GroupIndices = Union[T_GroupIndicesListInt, list[slice], np.ndarray]
+    GroupIndex = Union[int, slice, list[int]]
+    T_GroupIndices = list[GroupIndex]
+    T_FactorizeOut = tuple[
+        DataArray, T_GroupIndices, Union[IndexVariable, "_DummyGroup"], pd.Index
+    ]
 
 
 def check_reduce_dims(reduce_dims, dimensions):
     if reduce_dims is not ...:
         if is_scalar(reduce_dims):
             reduce_dims = [reduce_dims]
         if any(dim not in dimensions for dim in reduce_dims):
@@ -83,16 +95,16 @@
     inverse, values = pd.factorize(ar, sort=sort)
     if isinstance(values, pd.MultiIndex):
         values.names = ar.names
     groups = _codes_to_groups(inverse, len(values))
     return values, groups, inverse
 
 
-def _codes_to_groups(inverse: np.ndarray, N: int) -> T_GroupIndicesListInt:
-    groups: T_GroupIndicesListInt = [[] for _ in range(N)]
+def _codes_to_groups(inverse: np.ndarray, N: int) -> T_GroupIndices:
+    groups: T_GroupIndices = [[] for _ in range(N)]
     for n, g in enumerate(inverse):
         if g >= 0:
             groups[g].append(n)
     return groups
 
 
 def _dummy_copy(xarray_obj):
@@ -125,21 +137,21 @@
             attrs=xarray_obj.attrs,
         )
     else:  # pragma: no cover
         raise AssertionError
     return res
 
 
-def _is_one_or_none(obj):
+def _is_one_or_none(obj) -> bool:
     return obj == 1 or obj is None
 
 
-def _consolidate_slices(slices):
+def _consolidate_slices(slices: list[slice]) -> list[slice]:
     """Consolidate adjacent slices in a list of slices."""
-    result = []
+    result: list[slice] = []
     last_slice = slice(None)
     for slice_ in slices:
         if not isinstance(slice_, slice):
             raise ValueError(f"list element is not a slice: {slice_!r}")
         if (
             result
             and last_slice.stop == slice_.start
@@ -175,21 +187,21 @@
             return None
         positions = [np.arange(sl.start, sl.stop, sl.step) for sl in positions]
 
     newpositions = nputils.inverse_permutation(np.concatenate(positions), N)
     return newpositions[newpositions != -1]
 
 
-class _DummyGroup:
+class _DummyGroup(Generic[T_Xarray]):
     """Class for keeping track of grouped dimensions without coordinates.
 
     Should not be user visible.
     """
 
-    __slots__ = ("name", "coords", "size")
+    __slots__ = ("name", "coords", "size", "dataarray")
 
     def __init__(self, obj: T_Xarray, name: Hashable, coords) -> None:
         self.name = name
         self.coords = coords
         self.size = obj.sizes[name]
 
     @property
@@ -204,63 +216,68 @@
     def values(self) -> range:
         return range(self.size)
 
     @property
     def data(self) -> range:
         return range(self.size)
 
+    def __array__(self) -> np.ndarray:
+        return np.arange(self.size)
+
     @property
     def shape(self) -> tuple[int]:
         return (self.size,)
 
+    @property
+    def attrs(self) -> dict:
+        return {}
+
     def __getitem__(self, key):
         if isinstance(key, tuple):
             key = key[0]
         return self.values[key]
 
     def copy(self, deep: bool = True, data: Any = None):
         raise NotImplementedError
 
+    def to_dataarray(self) -> DataArray:
+        from xarray.core.dataarray import DataArray
+
+        return DataArray(
+            data=self.data, dims=(self.name,), coords=self.coords, name=self.name
+        )
+
 
-T_Group = TypeVar("T_Group", bound=Union["DataArray", "IndexVariable", _DummyGroup])
+T_Group = Union["T_DataArray", "IndexVariable", _DummyGroup]
 
 
 def _ensure_1d(
     group: T_Group, obj: T_Xarray
-) -> tuple[T_Group, T_Xarray, Hashable | None, list[Hashable]]:
+) -> tuple[T_Group, T_Xarray, Hashable | None, list[Hashable],]:
     # 1D cases: do nothing
-    from xarray.core.dataarray import DataArray
-
     if isinstance(group, (IndexVariable, _DummyGroup)) or group.ndim == 1:
         return group, obj, None, []
 
+    from xarray.core.dataarray import DataArray
+
     if isinstance(group, DataArray):
         # try to stack the dims of the group into a single dim
         orig_dims = group.dims
         stacked_dim = "stacked_" + "_".join(map(str, orig_dims))
         # these dimensions get created by the stack operation
         inserted_dims = [dim for dim in group.dims if dim not in group.coords]
-        # the copy is necessary here, otherwise read only array raises error
-        # in pandas: https://github.com/pydata/pandas/issues/12813
-        newgroup = group.stack({stacked_dim: orig_dims}).copy()
+        newgroup = group.stack({stacked_dim: orig_dims})
         newobj = obj.stack({stacked_dim: orig_dims})
-        return cast(T_Group, newgroup), newobj, stacked_dim, inserted_dims
+        return newgroup, newobj, stacked_dim, inserted_dims
 
     raise TypeError(
         f"group must be DataArray, IndexVariable or _DummyGroup, got {type(group)!r}."
     )
 
 
-def _unique_and_monotonic(group: T_Group) -> bool:
-    if isinstance(group, _DummyGroup):
-        return True
-    index = safe_cast_to_index(group)
-    return index.is_unique and index.is_monotonic_increasing
-
-
 def _apply_loffset(
     loffset: str | pd.DateOffset | datetime.timedelta | pd.Timedelta,
     result: pd.Series | pd.DataFrame,
 ):
     """
     (copied from pandas)
     if loffset is set, offset the result index
@@ -290,100 +307,344 @@
         and len(result.index) > 0
     )
 
     if needs_offset:
         result.index = result.index + loffset
 
 
-def _get_index_and_items(index, grouper):
-    first_items, codes = grouper.first_items(index)
-    full_index = first_items.index
-    if first_items.isnull().any():
-        first_items = first_items.dropna()
-    return full_index, first_items, codes
-
-
-def _factorize_grouper(
-    group, grouper
-) -> tuple[
-    DataArray | IndexVariable | _DummyGroup,
-    T_GroupIndices,
-    np.ndarray,
-    pd.Index,
-]:
-    index = safe_cast_to_index(group)
-    if not index.is_monotonic_increasing:
-        # TODO: sort instead of raising an error
-        raise ValueError("index must be monotonic for resampling")
-    full_index, first_items, codes = _get_index_and_items(index, grouper)
-    sbins = first_items.values.astype(np.int64)
-    group_indices: T_GroupIndices = [
-        slice(i, j) for i, j in zip(sbins[:-1], sbins[1:])
-    ] + [slice(sbins[-1], None)]
-    unique_coord = IndexVariable(group.name, first_items.index)
-    return unique_coord, group_indices, codes, full_index
-
-
-def _factorize_bins(
-    group, bins, cut_kwargs: Mapping | None
-) -> tuple[IndexVariable, T_GroupIndices, np.ndarray, pd.IntervalIndex, DataArray]:
-    from xarray.core.dataarray import DataArray
+@dataclass
+class ResolvedGrouper(ABC, Generic[T_Xarray]):
+    grouper: Grouper
+    group: T_Group
+    obj: T_Xarray
+
+    _group_as_index: pd.Index | None = field(default=None, init=False)
+
+    # Defined by factorize:
+    codes: DataArray = field(init=False)
+    group_indices: T_GroupIndices = field(init=False)
+    unique_coord: IndexVariable | _DummyGroup = field(init=False)
+    full_index: pd.Index = field(init=False)
+
+    # _ensure_1d:
+    group1d: T_Group = field(init=False)
+    stacked_obj: T_Xarray = field(init=False)
+    stacked_dim: Hashable | None = field(init=False)
+    inserted_dims: list[Hashable] = field(init=False)
+
+    def __post_init__(self) -> None:
+        self.group: T_Group = _resolve_group(self.obj, self.group)
+
+        (
+            self.group1d,
+            self.stacked_obj,
+            self.stacked_dim,
+            self.inserted_dims,
+        ) = _ensure_1d(group=self.group, obj=self.obj)
 
-    if cut_kwargs is None:
-        cut_kwargs = {}
+    @property
+    def name(self) -> Hashable:
+        return self.group1d.name
 
-    if duck_array_ops.isnull(bins).all():
-        raise ValueError("All bin edges are NaN.")
-    binned, bins = pd.cut(group.values, bins, **cut_kwargs, retbins=True)
-    codes = binned.codes
-    if (codes == -1).all():
-        raise ValueError(f"None of the data falls within bins with edges {bins!r}")
-    full_index = binned.categories
-    uniques = np.sort(pd.unique(codes))
-    unique_values = full_index[uniques[uniques != -1]]
-    group_indices = [g for g in _codes_to_groups(codes, len(full_index)) if g]
-
-    if len(group_indices) == 0:
-        raise ValueError(f"None of the data falls within bins with edges {bins!r}")
-
-    new_dim_name = str(group.name) + "_bins"
-    group_ = DataArray(binned, getattr(group, "coords", None), name=new_dim_name)
-    unique_coord = IndexVariable(new_dim_name, unique_values)
-    return unique_coord, group_indices, codes, full_index, group_
-
-
-def _factorize_rest(
-    group,
-) -> tuple[IndexVariable, T_GroupIndices, np.ndarray]:
-    # look through group to find the unique values
-    group_as_index = safe_cast_to_index(group)
-    sort = not isinstance(group_as_index, pd.MultiIndex)
-    unique_values, group_indices, codes = unique_value_groups(group_as_index, sort=sort)
-    if len(group_indices) == 0:
-        raise ValueError(
-            "Failed to group data. Are you grouping by a variable that is all NaN?"
+    @property
+    def size(self) -> int:
+        return len(self)
+
+    def __len__(self) -> int:
+        return len(self.full_index)  # TODO: full_index not def, abstractmethod?
+
+    @property
+    def dims(self):
+        return self.group1d.dims
+
+    @abstractmethod
+    def _factorize(self, squeeze: bool) -> T_FactorizeOut:
+        raise NotImplementedError
+
+    def factorize(self, squeeze: bool) -> None:
+        # This design makes it clear  to mypy that
+        # codes, group_indices, unique_coord, and full_index
+        # are set by the factorize  method on the derived class.
+        (
+            self.codes,
+            self.group_indices,
+            self.unique_coord,
+            self.full_index,
+        ) = self._factorize(squeeze)
+
+    @property
+    def is_unique_and_monotonic(self) -> bool:
+        if isinstance(self.group, _DummyGroup):
+            return True
+        index = self.group_as_index
+        return index.is_unique and index.is_monotonic_increasing
+
+    @property
+    def group_as_index(self) -> pd.Index:
+        if self._group_as_index is None:
+            self._group_as_index = safe_cast_to_index(self.group1d)
+        return self._group_as_index
+
+
+@dataclass
+class ResolvedUniqueGrouper(ResolvedGrouper):
+    grouper: UniqueGrouper
+
+    def _factorize(self, squeeze) -> T_FactorizeOut:
+        is_dimension = self.group.dims == (self.group.name,)
+        if is_dimension and self.is_unique_and_monotonic:
+            return self._factorize_dummy(squeeze)
+        else:
+            return self._factorize_unique()
+
+    def _factorize_unique(self) -> T_FactorizeOut:
+        # look through group to find the unique values
+        sort = not isinstance(self.group_as_index, pd.MultiIndex)
+        unique_values, group_indices, codes_ = unique_value_groups(
+            self.group_as_index, sort=sort
+        )
+        if len(group_indices) == 0:
+            raise ValueError(
+                "Failed to group data. Are you grouping by a variable that is all NaN?"
+            )
+        codes = self.group1d.copy(data=codes_)
+        group_indices = group_indices
+        unique_coord = IndexVariable(
+            self.group.name, unique_values, attrs=self.group.attrs
+        )
+        full_index = unique_coord
+
+        return codes, group_indices, unique_coord, full_index
+
+    def _factorize_dummy(self, squeeze) -> T_FactorizeOut:
+        size = self.group.size
+        # no need to factorize
+        if not squeeze:
+            # use slices to do views instead of fancy indexing
+            # equivalent to: group_indices = group_indices.reshape(-1, 1)
+            group_indices: T_GroupIndices = [slice(i, i + 1) for i in range(size)]
+        else:
+            group_indices = list(range(size))
+        size_range = np.arange(size)
+        if isinstance(self.group, _DummyGroup):
+            codes = self.group.to_dataarray().copy(data=size_range)
+        else:
+            codes = self.group.copy(data=size_range)
+        unique_coord = self.group
+        full_index = IndexVariable(self.name, unique_coord.values, self.group.attrs)
+
+        return codes, group_indices, unique_coord, full_index
+
+
+@dataclass
+class ResolvedBinGrouper(ResolvedGrouper):
+    grouper: BinGrouper
+
+    def _factorize(self, squeeze: bool) -> T_FactorizeOut:
+        from xarray.core.dataarray import DataArray
+
+        data = self.group1d.values
+        binned, bins = pd.cut(
+            data, self.grouper.bins, **self.grouper.cut_kwargs, retbins=True
+        )
+        binned_codes = binned.codes
+        if (binned_codes == -1).all():
+            raise ValueError(f"None of the data falls within bins with edges {bins!r}")
+
+        full_index = binned.categories
+        uniques = np.sort(pd.unique(binned_codes))
+        unique_values = full_index[uniques[uniques != -1]]
+        group_indices = [
+            g for g in _codes_to_groups(binned_codes, len(full_index)) if g
+        ]
+
+        if len(group_indices) == 0:
+            raise ValueError(f"None of the data falls within bins with edges {bins!r}")
+
+        new_dim_name = str(self.group.name) + "_bins"
+        self.group1d = DataArray(
+            binned, getattr(self.group1d, "coords", None), name=new_dim_name
+        )
+        unique_coord = IndexVariable(new_dim_name, unique_values, self.group.attrs)
+        codes = self.group1d.copy(data=binned_codes)
+        # TODO: support IntervalIndex in IndexVariable
+
+        return codes, group_indices, unique_coord, full_index
+
+
+@dataclass
+class ResolvedTimeResampleGrouper(ResolvedGrouper):
+    grouper: TimeResampleGrouper
+    index_grouper: CFTimeGrouper | pd.Grouper = field(init=False)
+
+    def __post_init__(self) -> None:
+        super().__post_init__()
+
+        from xarray import CFTimeIndex
+
+        group_as_index = safe_cast_to_index(self.group)
+        self._group_as_index = group_as_index
+
+        if not group_as_index.is_monotonic_increasing:
+            # TODO: sort instead of raising an error
+            raise ValueError("index must be monotonic for resampling")
+
+        grouper = self.grouper
+        if isinstance(group_as_index, CFTimeIndex):
+            from xarray.core.resample_cftime import CFTimeGrouper
+
+            index_grouper = CFTimeGrouper(
+                freq=grouper.freq,
+                closed=grouper.closed,
+                label=grouper.label,
+                origin=grouper.origin,
+                offset=grouper.offset,
+                loffset=grouper.loffset,
+            )
+        else:
+            index_grouper = pd.Grouper(
+                freq=grouper.freq,
+                closed=grouper.closed,
+                label=grouper.label,
+                origin=grouper.origin,
+                offset=grouper.offset,
+            )
+        self.index_grouper = index_grouper
+
+    def _get_index_and_items(self) -> tuple[pd.Index, pd.Series, np.ndarray]:
+        first_items, codes = self.first_items()
+        full_index = first_items.index
+        if first_items.isnull().any():
+            first_items = first_items.dropna()
+
+        full_index = full_index.rename("__resample_dim__")
+        return full_index, first_items, codes
+
+    def first_items(self) -> tuple[pd.Series, np.ndarray]:
+        from xarray import CFTimeIndex
+
+        if isinstance(self.group_as_index, CFTimeIndex):
+            return self.index_grouper.first_items(self.group_as_index)
+        else:
+            s = pd.Series(np.arange(self.group_as_index.size), self.group_as_index)
+            grouped = s.groupby(self.index_grouper)
+            first_items = grouped.first()
+            counts = grouped.count()
+            # This way we generate codes for the final output index: full_index.
+            # So for _flox_reduce we avoid one reindex and copy by avoiding
+            # _maybe_restore_empty_groups
+            codes = np.repeat(np.arange(len(first_items)), counts)
+            if self.grouper.loffset is not None:
+                _apply_loffset(self.grouper.loffset, first_items)
+            return first_items, codes
+
+    def _factorize(self, squeeze: bool) -> T_FactorizeOut:
+        full_index, first_items, codes_ = self._get_index_and_items()
+        sbins = first_items.values.astype(np.int64)
+        group_indices: T_GroupIndices = [
+            slice(i, j) for i, j in zip(sbins[:-1], sbins[1:])
+        ]
+        group_indices += [slice(sbins[-1], None)]
+
+        unique_coord = IndexVariable(
+            self.group.name, first_items.index, self.group.attrs
         )
-    unique_coord = IndexVariable(group.name, unique_values)
-    return unique_coord, group_indices, codes
+        codes = self.group.copy(data=codes_)
+
+        return codes, group_indices, unique_coord, full_index
+
+
+class Grouper(ABC):
+    pass
+
+
+@dataclass
+class UniqueGrouper(Grouper):
+    pass
+
+
+@dataclass
+class BinGrouper(Grouper):
+    bins: Any  # TODO: What is the typing?
+    cut_kwargs: Mapping = field(default_factory=dict)
+
+    def __post_init__(self) -> None:
+        if duck_array_ops.isnull(self.bins).all():
+            raise ValueError("All bin edges are NaN.")
+
+
+@dataclass
+class TimeResampleGrouper(Grouper):
+    freq: str
+    closed: SideOptions | None
+    label: SideOptions | None
+    origin: str | DatetimeLike | None
+    offset: pd.Timedelta | datetime.timedelta | str | None
+    loffset: datetime.timedelta | str | None
+
+
+def _validate_groupby_squeeze(squeeze: bool) -> None:
+    # While we don't generally check the type of every arg, passing
+    # multiple dimensions as multiple arguments is common enough, and the
+    # consequences hidden enough (strings evaluate as true) to warrant
+    # checking here.
+    # A future version could make squeeze kwarg only, but would face
+    # backward-compat issues.
+    if not isinstance(squeeze, bool):
+        raise TypeError(f"`squeeze` must be True or False, but {squeeze} was supplied")
 
 
-def _factorize_dummy(
-    group, squeeze: bool
-) -> tuple[IndexVariable, T_GroupIndices, np.ndarray]:
-    # no need to factorize
-    group_indices: T_GroupIndices
-    if not squeeze:
-        # use slices to do views instead of fancy indexing
-        # equivalent to: group_indices = group_indices.reshape(-1, 1)
-        group_indices = [slice(i, i + 1) for i in range(group.size)]
+def _resolve_group(obj: T_Xarray, group: T_Group | Hashable) -> T_Group:
+    from xarray.core.dataarray import DataArray
+
+    error_msg = (
+        "the group variable's length does not "
+        "match the length of this variable along its "
+        "dimensions"
+    )
+
+    newgroup: T_Group
+    if isinstance(group, DataArray):
+        try:
+            align(obj, group, join="exact", copy=False)
+        except ValueError:
+            raise ValueError(error_msg)
+
+        newgroup = group.copy(deep=False)
+        newgroup.name = group.name or "group"
+
+    elif isinstance(group, IndexVariable):
+        # This assumption is built in to _ensure_1d.
+        if group.ndim != 1:
+            raise ValueError(
+                "Grouping by multi-dimensional IndexVariables is not allowed."
+                "Convert to and pass a DataArray instead."
+            )
+        (group_dim,) = group.dims
+        if len(group) != obj.sizes[group_dim]:
+            raise ValueError(error_msg)
+
     else:
-        group_indices = np.arange(group.size)
-    codes = np.arange(group.size)
-    unique_coord = group
-    return unique_coord, group_indices, codes
+        if not hashable(group):
+            raise TypeError(
+                "`group` must be an xarray.DataArray or the "
+                "name of an xarray variable or dimension. "
+                f"Received {group!r} instead."
+            )
+        group = obj[group]
+        if group.name not in obj._indexes and group.name in obj.dims:
+            # DummyGroups should not appear on groupby results
+            newgroup = _DummyGroup(obj, group.name, group.coords)
+        else:
+            newgroup = group
+
+    if newgroup.size == 0:
+        raise ValueError(f"{newgroup.name} must not be empty")
+
+    return newgroup
 
 
 class GroupBy(Generic[T_Xarray]):
     """A object that implements the split-apply-combine pattern.
 
     Modeled after `pandas.GroupBy`. The `GroupBy` object can be iterated over
     (unique_value, grouped_array) pairs, but the main way to interact with a
@@ -402,139 +663,86 @@
     __slots__ = (
         "_full_index",
         "_inserted_dims",
         "_group",
         "_group_dim",
         "_group_indices",
         "_groups",
+        "groupers",
         "_obj",
         "_restore_coord_dims",
         "_stacked_dim",
         "_unique_coord",
         "_dims",
         "_sizes",
         "_squeeze",
         # Save unstacked object for flox
         "_original_obj",
         "_original_group",
         "_bins",
         "_codes",
     )
     _obj: T_Xarray
+    groupers: tuple[ResolvedGrouper]
+    _squeeze: bool
+    _restore_coord_dims: bool
+
+    _original_obj: T_Xarray
+    _original_group: T_Group
+    _group_indices: T_GroupIndices
+    _codes: DataArray
+    _group_dim: Hashable
+
+    _groups: dict[GroupKey, GroupIndex] | None
+    _dims: tuple[Hashable, ...] | Frozen[Hashable, int] | None
+    _sizes: Frozen[Hashable, int] | None
 
     def __init__(
         self,
         obj: T_Xarray,
-        group: Hashable | DataArray | IndexVariable,
+        groupers: tuple[ResolvedGrouper],
         squeeze: bool = False,
-        grouper: pd.Grouper | None = None,
-        bins: ArrayLike | None = None,
         restore_coord_dims: bool = True,
-        cut_kwargs: Mapping[Any, Any] | None = None,
     ) -> None:
         """Create a GroupBy object
 
         Parameters
         ----------
         obj : Dataset or DataArray
             Object to group.
-        group : Hashable, DataArray or Index
-            Array with the group values or name of the variable.
-        squeeze : bool, default: False
-            If "group" is a coordinate of object, `squeeze` controls whether
-            the subarrays have a dimension of length 1 along that coordinate or
-            if the dimension is squeezed out.
-        grouper : pandas.Grouper, optional
-            Used for grouping values along the `group` array.
-        bins : array-like, optional
-            If `bins` is specified, the groups will be discretized into the
-            specified bins by `pandas.cut`.
+        grouper : Grouper
+            Grouper object
         restore_coord_dims : bool, default: True
             If True, also restore the dimension order of multi-dimensional
             coordinates.
-        cut_kwargs : dict-like, optional
-            Extra keyword arguments to pass to `pandas.cut`
-
         """
-        from xarray.core.dataarray import DataArray
-
-        if grouper is not None and bins is not None:
-            raise TypeError("can't specify both `grouper` and `bins`")
+        self.groupers = groupers
 
-        if not isinstance(group, (DataArray, IndexVariable)):
-            if not hashable(group):
-                raise TypeError(
-                    "`group` must be an xarray.DataArray or the "
-                    "name of an xarray variable or dimension. "
-                    f"Received {group!r} instead."
-                )
-            group = obj[group]
-            if len(group) == 0:
-                raise ValueError(f"{group.name} must not be empty")
-
-            if group.name not in obj.coords and group.name in obj.dims:
-                # DummyGroups should not appear on groupby results
-                group = _DummyGroup(obj, group.name, group.coords)
-
-        if getattr(group, "name", None) is None:
-            group.name = "group"
-
-        self._original_obj: T_Xarray = obj
-        self._original_group = group
-        self._bins = bins
+        self._original_obj = obj
 
-        group, obj, stacked_dim, inserted_dims = _ensure_1d(group, obj)
-        (group_dim,) = group.dims
+        for grouper_ in self.groupers:
+            grouper_.factorize(squeeze)
 
-        expected_size = obj.sizes[group_dim]
-        if group.size != expected_size:
-            raise ValueError(
-                "the group variable's length does not "
-                "match the length of this variable along its "
-                "dimension"
-            )
-
-        self._codes: DataArray
-        if grouper is not None:
-            unique_coord, group_indices, codes, full_index = _factorize_grouper(
-                group, grouper
-            )
-            self._codes = group.copy(data=codes)
-        elif bins is not None:
-            unique_coord, group_indices, codes, full_index, group = _factorize_bins(
-                group, bins, cut_kwargs
-            )
-            self._codes = group.copy(data=codes)
-        elif group.dims == (group.name,) and _unique_and_monotonic(group):
-            unique_coord, group_indices, codes = _factorize_dummy(group, squeeze)
-            full_index = None
-            self._codes = obj[group.name].copy(data=codes)
-        else:
-            unique_coord, group_indices, codes = _factorize_rest(group)
-            full_index = None
-            self._codes = group.copy(data=codes)
+        (grouper,) = self.groupers
+        self._original_group = grouper.group
 
         # specification for the groupby operation
-        self._obj: T_Xarray = obj
-        self._group = group
-        self._group_dim = group_dim
-        self._group_indices = group_indices
-        self._unique_coord = unique_coord
-        self._stacked_dim = stacked_dim
-        self._inserted_dims = inserted_dims
-        self._full_index = full_index
+        self._obj = grouper.stacked_obj
         self._restore_coord_dims = restore_coord_dims
-        self._bins = bins
         self._squeeze = squeeze
-        self._codes = self._maybe_unstack(self._codes)
 
+        # These should generalize to multiple groupers
+        self._group_indices = grouper.group_indices
+        self._codes = self._maybe_unstack(grouper.codes)
+
+        (self._group_dim,) = grouper.group1d.dims
         # cached attributes
-        self._groups: dict[GroupKey, slice | int | list[int]] | None = None
-        self._dims: tuple[Hashable, ...] | Frozen[Hashable, int] | None = None
-        self._sizes: Frozen[Hashable, int] | None = None
+        self._groups = None
+        self._dims = None
+        self._sizes = None
 
     @property
     def sizes(self) -> Frozen[Hashable, int]:
         """Ordered mapping from dimension names to lengths.
 
         Immutable.
 
@@ -569,80 +777,85 @@
         keepdims: bool = False,
         shortcut: bool = True,
         **kwargs: Any,
     ) -> T_Xarray:
         raise NotImplementedError()
 
     @property
-    def groups(self) -> dict[GroupKey, slice | int | list[int]]:
+    def groups(self) -> dict[GroupKey, GroupIndex]:
         """
         Mapping from group labels to indices. The indices can be used to index the underlying object.
         """
         # provided to mimic pandas.groupby
         if self._groups is None:
-            self._groups = dict(zip(self._unique_coord.values, self._group_indices))
+            (grouper,) = self.groupers
+            self._groups = dict(zip(grouper.unique_coord.values, self._group_indices))
         return self._groups
 
     def __getitem__(self, key: GroupKey) -> T_Xarray:
         """
         Get DataArray or Dataset corresponding to a particular group label.
         """
         return self._obj.isel({self._group_dim: self.groups[key]})
 
     def __len__(self) -> int:
-        return self._unique_coord.size
+        (grouper,) = self.groupers
+        return grouper.size
 
     def __iter__(self) -> Iterator[tuple[GroupKey, T_Xarray]]:
-        return zip(self._unique_coord.values, self._iter_grouped())
+        (grouper,) = self.groupers
+        return zip(grouper.unique_coord.data, self._iter_grouped())
 
     def __repr__(self) -> str:
+        (grouper,) = self.groupers
         return "{}, grouped over {!r}\n{!r} groups with labels {}.".format(
             self.__class__.__name__,
-            self._unique_coord.name,
-            self._unique_coord.size,
-            ", ".join(format_array_flat(self._unique_coord, 30).split()),
+            grouper.name,
+            grouper.full_index.size,
+            ", ".join(format_array_flat(grouper.full_index, 30).split()),
         )
 
     def _iter_grouped(self) -> Iterator[T_Xarray]:
         """Iterate over each element in this group"""
         for indices in self._group_indices:
             yield self._obj.isel({self._group_dim: indices})
 
     def _infer_concat_args(self, applied_example):
+        (grouper,) = self.groupers
         if self._group_dim in applied_example.dims:
-            coord = self._group
+            coord = grouper.group1d
             positions = self._group_indices
         else:
-            coord = self._unique_coord
+            coord = grouper.unique_coord
             positions = None
         (dim,) = coord.dims
         if isinstance(coord, _DummyGroup):
             coord = None
         coord = getattr(coord, "variable", coord)
         return coord, dim, positions
 
     def _binary_op(self, other, f, reflexive=False):
         from xarray.core.dataarray import DataArray
         from xarray.core.dataset import Dataset
 
         g = f if not reflexive else lambda x, y: f(y, x)
 
+        (grouper,) = self.groupers
         obj = self._original_obj
-        group = self._original_group
+        group = grouper.group
         codes = self._codes
         dims = group.dims
 
         if isinstance(group, _DummyGroup):
-            group = obj[group.name]
-            coord = group
+            group = coord = group.to_dataarray()
         else:
-            coord = self._unique_coord
+            coord = grouper.unique_coord
             if not isinstance(coord, DataArray):
-                coord = DataArray(self._unique_coord)
-        name = self._group.name
+                coord = DataArray(grouper.unique_coord)
+        name = grouper.name
 
         if not isinstance(other, (Dataset, DataArray)):
             raise TypeError(
                 "GroupBy objects only support binary ops "
                 "when the other argument is a Dataset or "
                 "DataArray"
             )
@@ -663,17 +876,20 @@
                     other[var].drop_vars(var).expand_dims({name: other.sizes[name]})
                 )
 
         # need to handle NaNs in group or elements that don't belong to any bins
         mask = codes == -1
         if mask.any():
             obj = obj.where(~mask, drop=True)
+            group = group.where(~mask, drop=True)
             codes = codes.where(~mask, drop=True).astype(int)
 
-        other, _ = align(other, coord, join="outer")
+        # codes are defined for coord, so we align `other` with `coord`
+        # before indexing
+        other, _ = align(other, coord, join="right", copy=False)
         expanded = other.isel({name: codes})
 
         result = g(obj, expanded)
 
         if group.ndim > 1:
             # backcompat:
             # TODO: get rid of this when fixing GH2145
@@ -685,28 +901,35 @@
             for var in set(result):
                 for d in dims:
                     if d not in obj[var].dims:
                         result[var] = result[var].transpose(d, ...)
         return result
 
     def _maybe_restore_empty_groups(self, combined):
-        """Our index contained empty groups (e.g., from a resampling). If we
+        """Our index contained empty groups (e.g., from a resampling or binning). If we
         reduced on that dimension, we want to restore the full index.
         """
-        if self._full_index is not None and self._group.name in combined.dims:
-            indexers = {self._group.name: self._full_index}
+        (grouper,) = self.groupers
+        if (
+            isinstance(grouper, (ResolvedBinGrouper, ResolvedTimeResampleGrouper))
+            and grouper.name in combined.dims
+        ):
+            indexers = {grouper.name: grouper.full_index}
             combined = combined.reindex(**indexers)
         return combined
 
     def _maybe_unstack(self, obj):
         """This gets called if we are applying on an array with a
         multidimensional group."""
-        if self._stacked_dim is not None and self._stacked_dim in obj.dims:
-            obj = obj.unstack(self._stacked_dim)
-            for dim in self._inserted_dims:
+        (grouper,) = self.groupers
+        stacked_dim = grouper.stacked_dim
+        inserted_dims = grouper.inserted_dims
+        if stacked_dim is not None and stacked_dim in obj.dims:
+            obj = obj.unstack(stacked_dim)
+            for dim in inserted_dims:
                 if dim in obj.coords:
                     del obj.coords[dim]
             obj._indexes = filter_indexes_from_coords(obj._indexes, set(obj.coords))
         return obj
 
     def _flox_reduce(
         self,
@@ -716,15 +939,16 @@
     ):
         """Adaptor function that translates our groupby API to that of flox."""
         from flox.xarray import xarray_reduce
 
         from xarray.core.dataset import Dataset
 
         obj = self._original_obj
-        group = self._original_group
+        (grouper,) = self.groupers
+        isbin = isinstance(grouper, ResolvedBinGrouper)
 
         if keep_attrs is None:
             keep_attrs = _get_keep_attrs(default=True)
 
         # preserve current strategy (approximately) for dask groupby.
         # We want to control the default anyway to prevent surprises
         # if flox decides to change its default
@@ -736,97 +960,96 @@
                 name: var
                 for name, var in obj.data_vars.items()
                 if not (np.issubdtype(var.dtype, np.number) or (var.dtype == np.bool_))
             }
         else:
             non_numeric = {}
 
+        if "min_count" in kwargs:
+            if kwargs["func"] not in ["sum", "prod"]:
+                raise TypeError("Received an unexpected keyword argument 'min_count'")
+            elif kwargs["min_count"] is None:
+                # set explicitly to avoid unncessarily accumulating count
+                kwargs["min_count"] = 0
+
         # weird backcompat
         # reducing along a unique indexed dimension with squeeze=True
         # should raise an error
-        if (
-            dim is None or dim == self._group.name
-        ) and self._group.name in obj.xindexes:
-            index = obj.indexes[self._group.name]
+        if (dim is None or dim == grouper.name) and grouper.name in obj.xindexes:
+            index = obj.indexes[grouper.name]
             if index.is_unique and self._squeeze:
-                raise ValueError(f"cannot reduce over dimensions {self._group.name!r}")
+                raise ValueError(f"cannot reduce over dimensions {grouper.name!r}")
 
         unindexed_dims: tuple[Hashable, ...] = tuple()
-        if isinstance(group, _DummyGroup) and self._bins is None:
-            unindexed_dims = (group.name,)
+        if isinstance(grouper.group, _DummyGroup) and not isbin:
+            unindexed_dims = (grouper.name,)
 
         parsed_dim: tuple[Hashable, ...]
         if isinstance(dim, str):
             parsed_dim = (dim,)
         elif dim is None:
-            parsed_dim = group.dims
+            parsed_dim = grouper.group.dims
         elif dim is ...:
             parsed_dim = tuple(obj.dims)
         else:
             parsed_dim = tuple(dim)
 
         # Do this so we raise the same error message whether flox is present or not.
         # Better to control it here than in flox.
-        if any(d not in group.dims and d not in obj.dims for d in parsed_dim):
+        if any(d not in grouper.group.dims and d not in obj.dims for d in parsed_dim):
             raise ValueError(f"cannot reduce over dimensions {dim}.")
 
         if kwargs["func"] not in ["all", "any", "count"]:
             kwargs.setdefault("fill_value", np.nan)
-        if self._bins is not None and kwargs["func"] == "count":
+        if isbin and kwargs["func"] == "count":
             # This is an annoying hack. Xarray returns np.nan
             # when there are no observations in a bin, instead of 0.
             # We can fake that here by forcing min_count=1.
             # note min_count makes no sense in the xarray world
             # as a kwarg for count, so this should be OK
             kwargs.setdefault("fill_value", np.nan)
             kwargs.setdefault("min_count", 1)
 
-        output_index = self._get_output_index()
+        output_index = grouper.full_index
         result = xarray_reduce(
             obj.drop_vars(non_numeric.keys()),
             self._codes,
             dim=parsed_dim,
             # pass RangeIndex as a hint to flox that `by` is already factorized
             expected_groups=(pd.RangeIndex(len(output_index)),),
             isbin=False,
             keep_attrs=keep_attrs,
             **kwargs,
         )
 
         # we did end up reducing over dimension(s) that are
         # in the grouped variable
-        if set(self._codes.dims).issubset(set(parsed_dim)):
-            result[self._unique_coord.name] = output_index
+        group_dims = grouper.group.dims
+        if set(group_dims).issubset(set(parsed_dim)):
+            result[grouper.name] = output_index
             result = result.drop_vars(unindexed_dims)
 
         # broadcast and restore non-numeric data variables (backcompat)
         for name, var in non_numeric.items():
             if all(d not in var.dims for d in parsed_dim):
                 result[name] = var.variable.set_dims(
-                    (group.name,) + var.dims, (result.sizes[group.name],) + var.shape
+                    (grouper.name,) + var.dims,
+                    (result.sizes[grouper.name],) + var.shape,
                 )
 
-        if self._bins is not None:
+        if isbin:
             # Fix dimension order when binning a dimension coordinate
             # Needed as long as we do a separate code path for pint;
             # For some reason Datasets and DataArrays behave differently!
-            if isinstance(self._obj, Dataset) and self._group_dim in self._obj.dims:
-                result = result.transpose(self._group.name, ...)
+            (group_dim,) = grouper.dims
+            if isinstance(self._obj, Dataset) and group_dim in self._obj.dims:
+                result = result.transpose(grouper.name, ...)
 
         return result
 
-    def _get_output_index(self) -> pd.Index:
-        """Return pandas.Index object for the output array."""
-        if self._full_index is not None:
-            # binning and resample
-            return self._full_index.rename(self._unique_coord.name)
-        if isinstance(self._unique_coord, _DummyGroup):
-            return IndexVariable(self._group.name, self._unique_coord.values)
-        return self._unique_coord
-
     def fillna(self, value: Any) -> T_Xarray:
         """Fill missing values in this object by group.
 
         This operation follows the normal broadcasting and alignment rules that
         xarray uses for binary arithmetic, except the result is aligned to this
         object (``join='left'``) instead of aligned to the intersection of
         index coordinates (``join='inner'``).
@@ -972,15 +1195,16 @@
         References
         ----------
         .. [1] R. J. Hyndman and Y. Fan,
            "Sample quantiles in statistical packages,"
            The American Statistician, 50(4), pp. 361-365, 1996
         """
         if dim is None:
-            dim = (self._group_dim,)
+            (grouper,) = self.groupers
+            dim = grouper.group1d.dims
 
         return self.map(
             self._obj.__class__.quantile,
             shortcut=False,
             q=q,
             dim=dim,
             method=method,
@@ -1075,21 +1299,26 @@
         # nb. don't worry too much about maintaining this method -- it does
         # speed things up, but it's not very interpretable and there are much
         # faster alternatives (e.g., doing the grouped aggregation in a
         # compiled language)
         # TODO: benbovy - explicit indexes: this fast implementation doesn't
         # create an explicit index for the stacked dim coordinate
         stacked = Variable.concat(applied, dim, shortcut=True)
-        reordered = _maybe_reorder(stacked, dim, positions, N=self._group.size)
+
+        (grouper,) = self.groupers
+        reordered = _maybe_reorder(stacked, dim, positions, N=grouper.group.size)
         return self._obj._replace_maybe_drop_dims(reordered)
 
     def _restore_dim_order(self, stacked: DataArray) -> DataArray:
+        (grouper,) = self.groupers
+        group = grouper.group1d
+
         def lookup_order(dimension):
-            if dimension == self._group.name:
-                (dimension,) = self._group.dims
+            if dimension == group.name:
+                (dimension,) = group.dims
             if dimension in self._obj.dims:
                 axis = self._obj.get_axis_num(dimension)
             else:
                 axis = 1e6  # some arbitrarily high value
             return axis
 
         new_order = sorted(stacked.dims, key=lookup_order)
@@ -1166,15 +1395,16 @@
         """Recombine the applied objects like the original."""
         applied_example, applied = peek_at(applied)
         coord, dim, positions = self._infer_concat_args(applied_example)
         if shortcut:
             combined = self._concat_shortcut(applied, dim, positions)
         else:
             combined = concat(applied, dim)
-            combined = _maybe_reorder(combined, dim, positions, N=self._group.size)
+            (grouper,) = self.groupers
+            combined = _maybe_reorder(combined, dim, positions, N=grouper.group.size)
 
         if isinstance(combined, type(self._obj)):
             # only restore dimension order for arrays
             combined = self._restore_dim_order(combined)
         # assign coord and index when the applied function does not return that coord
         if coord is not None and dim not in applied_example.dims:
             index, index_vars = create_default_index_implicit(coord)
@@ -1322,15 +1552,16 @@
         return self.map(func, shortcut=shortcut, args=args, **kwargs)
 
     def _combine(self, applied):
         """Recombine the applied objects like the original."""
         applied_example, applied = peek_at(applied)
         coord, dim, positions = self._infer_concat_args(applied_example)
         combined = concat(applied, dim)
-        combined = _maybe_reorder(combined, dim, positions, N=self._group.size)
+        (grouper,) = self.groupers
+        combined = _maybe_reorder(combined, dim, positions, N=grouper.group.size)
         # assign coord when the applied function does not return that coord
         if coord is not None and dim not in applied_example.dims:
             index, index_vars = create_default_index_implicit(coord)
             indexes = {k: index for k in index_vars}
             combined = combined._overwrite_indexes(indexes, index_vars)
         combined = self._maybe_restore_empty_groups(combined)
         combined = self._maybe_unstack(combined)
@@ -1409,60 +1640,7 @@
 # https://github.com/python/mypy/issues/9031
 class DatasetGroupBy(  # type: ignore[misc]
     DatasetGroupByBase,
     DatasetGroupByAggregations,
     ImplementsDatasetReduce,
 ):
     __slots__ = ()
-
-
-class TimeResampleGrouper:
-    def __init__(
-        self,
-        freq: str,
-        closed: SideOptions | None,
-        label: SideOptions | None,
-        origin: str | DatetimeLike,
-        offset: pd.Timedelta | datetime.timedelta | str | None,
-        loffset: datetime.timedelta | str | None,
-    ):
-        self.freq = freq
-        self.closed = closed
-        self.label = label
-        self.origin = origin
-        self.offset = offset
-        self.loffset = loffset
-
-    def first_items(self, index):
-        from xarray import CFTimeIndex
-        from xarray.core.resample_cftime import CFTimeGrouper
-
-        if isinstance(index, CFTimeIndex):
-            grouper = CFTimeGrouper(
-                freq=self.freq,
-                closed=self.closed,
-                label=self.label,
-                origin=self.origin,
-                offset=self.offset,
-                loffset=self.loffset,
-            )
-            return grouper.first_items(index)
-        else:
-            s = pd.Series(np.arange(index.size), index, copy=False)
-            grouper = pd.Grouper(
-                freq=self.freq,
-                closed=self.closed,
-                label=self.label,
-                origin=self.origin,
-                offset=self.offset,
-            )
-
-            grouped = s.groupby(grouper)
-            first_items = grouped.first()
-            counts = grouped.count()
-            # This way we generate codes for the final output index: full_index.
-            # So for _flox_reduce we avoid one reindex and copy by avoiding
-            # _maybe_restore_empty_groups
-            codes = np.repeat(np.arange(len(first_items)), counts)
-            if self.loffset is not None:
-                _apply_loffset(self.loffset, first_items)
-            return first_items, codes
```

### Comparing `xarray-2023.4.2/xarray/core/indexes.py` & `xarray-2023.5.0/xarray/core/indexes.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/indexing.py` & `xarray-2023.5.0/xarray/core/indexing.py`

 * *Files 2% similar despite different names*

```diff
@@ -13,14 +13,15 @@
 
 import numpy as np
 import pandas as pd
 
 from xarray.core import duck_array_ops
 from xarray.core.nputils import NumpyVIndexAdapter
 from xarray.core.options import OPTIONS
+from xarray.core.parallelcompat import get_chunked_array_type, is_chunked_array
 from xarray.core.pycompat import (
     array_type,
     integer_types,
     is_duck_array,
     is_duck_dask_array,
 )
 from xarray.core.types import T_Xarray
@@ -1138,39 +1139,41 @@
         else:  # slice
             shape = (1,) * (n_dim + i_dim) + (-1,) + (1,) * (len(slices) - i_dim - 1)
             new_key.append(np.arange(*v.indices(size)).reshape(shape))
             i_dim += 1
     return VectorizedIndexer(tuple(new_key))
 
 
-def _dask_array_with_chunks_hint(array, chunks):
-    """Create a dask array using the chunks hint for dimensions of size > 1."""
-    import dask.array as da
+def _chunked_array_with_chunks_hint(array, chunks, chunkmanager):
+    """Create a chunked array using the chunks hint for dimensions of size > 1."""
 
     if len(chunks) < array.ndim:
         raise ValueError("not enough chunks in hint")
     new_chunks = []
     for chunk, size in zip(chunks, array.shape):
         new_chunks.append(chunk if size > 1 else (1,))
-    return da.from_array(array, new_chunks)
+    return chunkmanager.from_array(array, new_chunks)
 
 
 def _logical_any(args):
     return functools.reduce(operator.or_, args)
 
 
 def _masked_result_drop_slice(key, data=None):
     key = (k for k in key if not isinstance(k, slice))
     chunks_hint = getattr(data, "chunks", None)
 
     new_keys = []
     for k in key:
         if isinstance(k, np.ndarray):
-            if is_duck_dask_array(data):
-                new_keys.append(_dask_array_with_chunks_hint(k, chunks_hint))
+            if is_chunked_array(data):
+                chunkmanager = get_chunked_array_type(data)
+                new_keys.append(
+                    _chunked_array_with_chunks_hint(k, chunks_hint, chunkmanager)
+                )
             elif isinstance(data, array_type("sparse")):
                 import sparse
 
                 new_keys.append(sparse.COO.from_numpy(k))
             else:
                 new_keys.append(k)
         else:
```

### Comparing `xarray-2023.4.2/xarray/core/merge.py` & `xarray-2023.5.0/xarray/core/merge.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/missing.py` & `xarray-2023.5.0/xarray/core/missing.py`

 * *Files 2% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 import pandas as pd
 
 from xarray.core import utils
 from xarray.core.common import _contains_datetime_like_objects, ones_like
 from xarray.core.computation import apply_ufunc
 from xarray.core.duck_array_ops import datetime_to_numeric, push, timedelta_to_numeric
 from xarray.core.options import OPTIONS, _get_keep_attrs
-from xarray.core.pycompat import is_duck_dask_array
+from xarray.core.parallelcompat import get_chunked_array_type, is_chunked_array
 from xarray.core.types import Interp1dOptions, InterpOptions
 from xarray.core.utils import OrderedSet, is_scalar
 from xarray.core.variable import Variable, broadcast_variables
 
 if TYPE_CHECKING:
     from xarray.core.dataarray import DataArray
     from xarray.core.dataset import Dataset
@@ -635,24 +635,25 @@
         broadcast_dims = [d for d in var.dims if d not in dims]
         original_dims = broadcast_dims + dims
         new_dims = broadcast_dims + list(destination[0].dims)
         interped = interp_func(
             var.transpose(*original_dims).data, x, destination, method, kwargs
         )
 
-        result = Variable(new_dims, interped, attrs=var.attrs)
+        result = Variable(new_dims, interped, attrs=var.attrs, fastpath=True)
 
         # dimension of the output array
         out_dims: OrderedSet = OrderedSet()
         for d in var.dims:
             if d in dims:
                 out_dims.update(indexes_coords[d][1].dims)
             else:
                 out_dims.add(d)
-        result = result.transpose(*out_dims)
+        if len(out_dims) > 1:
+            result = result.transpose(*out_dims)
     return result
 
 
 def interp_func(var, x, new_x, method: InterpOptions, kwargs):
     """
     multi-dimensional interpolation for array-like. Interpolated axes should be
     located in the last position.
@@ -689,64 +690,60 @@
         return var.copy()
 
     if len(x) == 1:
         func, kwargs = _get_interpolator(method, vectorizeable_only=True, **kwargs)
     else:
         func, kwargs = _get_interpolator_nd(method, **kwargs)
 
-    if is_duck_dask_array(var):
-        import dask.array as da
+    if is_chunked_array(var):
+        chunkmanager = get_chunked_array_type(var)
 
         ndim = var.ndim
         nconst = ndim - len(x)
 
         out_ind = list(range(nconst)) + list(range(ndim, ndim + new_x[0].ndim))
 
         # blockwise args format
         x_arginds = [[_x, (nconst + index,)] for index, _x in enumerate(x)]
         x_arginds = [item for pair in x_arginds for item in pair]
         new_x_arginds = [
             [_x, [ndim + index for index in range(_x.ndim)]] for _x in new_x
         ]
         new_x_arginds = [item for pair in new_x_arginds for item in pair]
 
-        args = (
-            var,
-            range(ndim),
-            *x_arginds,
-            *new_x_arginds,
-        )
+        args = (var, range(ndim), *x_arginds, *new_x_arginds)
 
-        _, rechunked = da.unify_chunks(*args)
+        _, rechunked = chunkmanager.unify_chunks(*args)
 
         args = tuple(elem for pair in zip(rechunked, args[1::2]) for elem in pair)
 
         new_x = rechunked[1 + (len(rechunked) - 1) // 2 :]
 
+        new_x0_chunks = new_x[0].chunks
+        new_x0_shape = new_x[0].shape
+        new_x0_chunks_is_not_none = new_x0_chunks is not None
         new_axes = {
-            ndim + i: new_x[0].chunks[i]
-            if new_x[0].chunks is not None
-            else new_x[0].shape[i]
+            ndim + i: new_x0_chunks[i] if new_x0_chunks_is_not_none else new_x0_shape[i]
             for i in range(new_x[0].ndim)
         }
 
         # if useful, re-use localize for each chunk of new_x
-        localize = (method in ["linear", "nearest"]) and (new_x[0].chunks is not None)
+        localize = (method in ["linear", "nearest"]) and new_x0_chunks_is_not_none
 
         # scipy.interpolate.interp1d always forces to float.
         # Use the same check for blockwise as well:
         if not issubclass(var.dtype.type, np.inexact):
             dtype = np.float_
         else:
             dtype = var.dtype
 
         meta = var._meta
 
-        return da.blockwise(
-            _dask_aware_interpnd,
+        return chunkmanager.blockwise(
+            _chunked_aware_interpnd,
             out_ind,
             *args,
             interp_func=func,
             interp_kwargs=kwargs,
             localize=localize,
             concatenate=True,
             dtype=dtype,
@@ -781,16 +778,16 @@
     xi = np.stack([x1.values.ravel() for x1 in new_x], axis=-1)
     rslt = func(x, var, xi, **kwargs)
     # move back the interpolation axes to the last position
     rslt = rslt.transpose(range(-rslt.ndim + 1, 1))
     return rslt.reshape(rslt.shape[:-1] + new_x[0].shape)
 
 
-def _dask_aware_interpnd(var, *coords, interp_func, interp_kwargs, localize=True):
-    """Wrapper for `_interpnd` through `blockwise`
+def _chunked_aware_interpnd(var, *coords, interp_func, interp_kwargs, localize=True):
+    """Wrapper for `_interpnd` through `blockwise` for chunked arrays.
 
     The first half arrays in `coords` are original coordinates,
     the other half are destination coordinates
     """
     n_x = len(coords) // 2
     nconst = len(var.shape) - n_x
```

### Comparing `xarray-2023.4.2/xarray/core/nanops.py` & `xarray-2023.5.0/xarray/core/nanops.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 
 import warnings
 
 import numpy as np
 
 from xarray.core import dtypes, nputils, utils
 from xarray.core.duck_array_ops import (
+    astype,
     count,
     fillna,
     isnull,
     sum_where,
     where,
     where_method,
 )
@@ -18,15 +19,15 @@
 def _maybe_null_out(result, axis, mask, min_count=1):
     """
     xarray version of pandas.core.nanops._maybe_null_out
     """
     if axis is not None and getattr(result, "ndim", False):
         null_mask = (np.take(mask.shape, axis).prod() - mask.sum(axis) - min_count) < 0
         dtype, fill_value = dtypes.maybe_promote(result.dtype)
-        result = where(null_mask, fill_value, result.astype(dtype))
+        result = where(null_mask, fill_value, astype(result, dtype))
 
     elif getattr(result, "dtype", None) not in dtypes.NAT_TYPES:
         null_mask = mask.size - mask.sum()
         result = where(null_mask < min_count, np.nan, result)
 
     return result
 
@@ -136,15 +137,15 @@
     return nputils.nanmedian(a, axis=axis)
 
 
 def _nanvar_object(value, axis=None, ddof=0, keepdims=False, **kwargs):
     value_mean = _nanmean_ddof_object(
         ddof=0, value=value, axis=axis, keepdims=True, **kwargs
     )
-    squared = (value.astype(value_mean.dtype) - value_mean) ** 2
+    squared = (astype(value, value_mean.dtype) - value_mean) ** 2
     return _nanmean_ddof_object(ddof, squared, axis=axis, keepdims=keepdims, **kwargs)
 
 
 def nanvar(a, axis=None, dtype=None, out=None, ddof=0):
     if a.dtype.kind == "O":
         return _nanvar_object(a, axis=axis, dtype=dtype, ddof=ddof)
```

### Comparing `xarray-2023.4.2/xarray/core/npcompat.py` & `xarray-2023.5.0/xarray/core/npcompat.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/nputils.py` & `xarray-2023.5.0/xarray/core/nputils.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/ops.py` & `xarray-2023.5.0/xarray/core/ops.py`

 * *Files 1% similar despite different names*

```diff
@@ -29,14 +29,16 @@
     "truediv",
     "floordiv",
     "mod",
     "pow",
     "and",
     "xor",
     "or",
+    "lshift",
+    "rshift",
 ]
 
 # methods which pass on the numpy return value unchanged
 # be careful not to list methods that we would want to wrap later
 NUMPY_SAME_METHODS = ["item", "searchsorted"]
 
 # methods which remove an axis
```

### Comparing `xarray-2023.4.2/xarray/core/options.py` & `xarray-2023.5.0/xarray/core/options.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/parallel.py` & `xarray-2023.5.0/xarray/core/parallel.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/pdcompat.py` & `xarray-2023.5.0/xarray/core/pdcompat.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/pycompat.py` & `xarray-2023.5.0/xarray/core/pycompat.py`

 * *Files 12% similar despite different names*

```diff
@@ -8,15 +8,15 @@
 from packaging.version import Version
 
 from xarray.core.utils import is_duck_array, is_scalar, module_available
 
 integer_types = (int, np.integer)
 
 if TYPE_CHECKING:
-    ModType = Literal["dask", "pint", "cupy", "sparse"]
+    ModType = Literal["dask", "pint", "cupy", "sparse", "cubed"]
     DuckArrayTypes = tuple[type[Any], ...]  # TODO: improve this? maybe Generic
 
 
 class DuckArrayModule:
     """
     Solely for internal isinstance and version checks.
 
@@ -26,29 +26,31 @@
 
     module: ModuleType | None
     version: Version
     type: DuckArrayTypes
     available: bool
 
     def __init__(self, mod: ModType) -> None:
-        duck_array_module: ModuleType | None = None
+        duck_array_module: ModuleType | None
         duck_array_version: Version
         duck_array_type: DuckArrayTypes
         try:
             duck_array_module = import_module(mod)
             duck_array_version = Version(duck_array_module.__version__)
 
             if mod == "dask":
                 duck_array_type = (import_module("dask.array").Array,)
             elif mod == "pint":
                 duck_array_type = (duck_array_module.Quantity,)
             elif mod == "cupy":
                 duck_array_type = (duck_array_module.ndarray,)
             elif mod == "sparse":
                 duck_array_type = (duck_array_module.SparseArray,)
+            elif mod == "cubed":
+                duck_array_type = (duck_array_module.Array,)
             else:
                 raise NotImplementedError
 
         except ImportError:  # pragma: no cover
             duck_array_module = None
             duck_array_version = Version("0.0.0")
             duck_array_type = ()
@@ -77,9 +79,13 @@
     return False
 
 
 def is_duck_dask_array(x):
     return is_duck_array(x) and is_dask_collection(x)
 
 
+def is_chunked_array(x) -> bool:
+    return is_duck_dask_array(x) or (is_duck_array(x) and hasattr(x, "chunks"))
+
+
 def is_0d_dask_array(x):
     return is_duck_dask_array(x) and is_scalar(x)
```

### Comparing `xarray-2023.4.2/xarray/core/resample.py` & `xarray-2023.5.0/xarray/core/resample.py`

 * *Files 4% similar despite different names*

```diff
@@ -80,16 +80,17 @@
             tolerance are filled with ``NaN`` s.
 
         Returns
         -------
         padded : DataArray or Dataset
         """
         obj = self._drop_coords()
+        (grouper,) = self.groupers
         return obj.reindex(
-            {self._dim: self._full_index}, method="pad", tolerance=tolerance
+            {self._dim: grouper.full_index}, method="pad", tolerance=tolerance
         )
 
     ffill = pad
 
     def backfill(self, tolerance: float | Iterable[float] | None = None) -> T_Xarray:
         """Backward fill new values at up-sampled frequency.
 
@@ -104,16 +105,17 @@
             tolerance are filled with ``NaN`` s.
 
         Returns
         -------
         backfilled : DataArray or Dataset
         """
         obj = self._drop_coords()
+        (grouper,) = self.groupers
         return obj.reindex(
-            {self._dim: self._full_index}, method="backfill", tolerance=tolerance
+            {self._dim: grouper.full_index}, method="backfill", tolerance=tolerance
         )
 
     bfill = backfill
 
     def nearest(self, tolerance: float | Iterable[float] | None = None) -> T_Xarray:
         """Take new values from nearest original coordinate to up-sampled
         frequency coordinates.
@@ -129,16 +131,17 @@
             tolerance are filled with ``NaN`` s.
 
         Returns
         -------
         upsampled : DataArray or Dataset
         """
         obj = self._drop_coords()
+        (grouper,) = self.groupers
         return obj.reindex(
-            {self._dim: self._full_index}, method="nearest", tolerance=tolerance
+            {self._dim: grouper.full_index}, method="nearest", tolerance=tolerance
         )
 
     def interpolate(self, kind: InterpOptions = "linear") -> T_Xarray:
         """Interpolate up-sampled data using the original data as knots.
 
         Parameters
         ----------
@@ -166,16 +169,17 @@
 
         """
         return self._interpolate(kind=kind)
 
     def _interpolate(self, kind="linear") -> T_Xarray:
         """Apply scipy.interpolate.interp1d along resampling dimension."""
         obj = self._drop_coords()
+        (grouper,) = self.groupers
         return obj.interp(
-            coords={self._dim: self._full_index},
+            coords={self._dim: grouper.full_index},
             assume_sorted=True,
             method=kind,
             kwargs={"bounds_error": False},
         )
 
 
 # https://github.com/python/mypy/issues/9031
```

### Comparing `xarray-2023.4.2/xarray/core/resample_cftime.py` & `xarray-2023.5.0/xarray/core/resample_cftime.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/rolling.py` & `xarray-2023.5.0/xarray/core/rolling.py`

 * *Files 1% similar despite different names*

```diff
@@ -154,17 +154,17 @@
             )
 
         method.__name__ = name
         method.__doc__ = _ROLLING_REDUCE_DOCSTRING_TEMPLATE.format(name=name)
         return method
 
     def _mean(self, keep_attrs, **kwargs):
-        result = self.sum(keep_attrs=False, **kwargs) / self.count(
-            keep_attrs=False
-        ).astype(self.obj.dtype, copy=False)
+        result = self.sum(keep_attrs=False, **kwargs) / duck_array_ops.astype(
+            self.count(keep_attrs=False), dtype=self.obj.dtype, copy=False
+        )
         if keep_attrs:
             result.attrs = self.obj.attrs
         return result
 
     _mean.__doc__ = _ROLLING_REDUCE_DOCSTRING_TEMPLATE.format(name="mean")
 
     argmax = _reduce_method("argmax", dtypes.NINF)
```

### Comparing `xarray-2023.4.2/xarray/core/rolling_exp.py` & `xarray-2023.5.0/xarray/core/rolling_exp.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/core/types.py` & `xarray-2023.5.0/xarray/core/types.py`

 * *Files 6% similar despite different names*

```diff
@@ -29,14 +29,24 @@
     from xarray.core.variable import Variable
 
     try:
         from dask.array import Array as DaskArray
     except ImportError:
         DaskArray = np.ndarray  # type: ignore
 
+    try:
+        from cubed import Array as CubedArray
+    except ImportError:
+        CubedArray = np.ndarray
+
+    try:
+        from zarr.core import Array as ZarrArray
+    except ImportError:
+        ZarrArray = np.ndarray
+
     # TODO: Turn on when https://github.com/python/mypy/issues/11871 is fixed.
     # Can be uncommented if using pyright though.
     # import sys
 
     # try:
     #     if sys.version_info >= (3, 11):
     #         from typing import Self
@@ -101,14 +111,17 @@
 DaCompatible = Union["DataArray", "Variable", "DataArrayGroupBy", "ScalarOrArray"]
 VarCompatible = Union["Variable", "ScalarOrArray"]
 GroupByIncompatible = Union["Variable", "GroupBy"]
 
 Dims = Union[str, Iterable[Hashable], "ellipsis", None]
 OrderedDims = Union[str, Sequence[Union[Hashable, "ellipsis"]], "ellipsis", None]
 
+T_Chunks = Union[int, dict[Any, Any], Literal["auto"], None]
+T_NormalizedChunks = tuple[tuple[int, ...], ...]
+
 ErrorOptions = Literal["raise", "ignore"]
 ErrorOptionsWithWarn = Literal["raise", "warn", "ignore"]
 
 CompatOptions = Literal[
     "identical", "equals", "broadcast_equals", "no_conflicts", "override", "minimal"
 ]
 ConcatOptions = Literal["all", "minimal", "different"]
```

### Comparing `xarray-2023.4.2/xarray/core/utils.py` & `xarray-2023.5.0/xarray/core/utils.py`

 * *Files 4% similar despite different names*

```diff
@@ -1198,7 +1198,70 @@
     return n
 
 
 def emit_user_level_warning(message, category=None):
     """Emit a warning at the user level by inspecting the stack trace."""
     stacklevel = find_stack_level()
     warnings.warn(message, category=category, stacklevel=stacklevel)
+
+
+def consolidate_dask_from_array_kwargs(
+    from_array_kwargs: dict,
+    name: str | None = None,
+    lock: bool | None = None,
+    inline_array: bool | None = None,
+) -> dict:
+    """
+    Merge dask-specific kwargs with arbitrary from_array_kwargs dict.
+
+    Temporary function, to be deleted once explicitly passing dask-specific kwargs to .chunk() is deprecated.
+    """
+
+    from_array_kwargs = _resolve_doubly_passed_kwarg(
+        from_array_kwargs,
+        kwarg_name="name",
+        passed_kwarg_value=name,
+        default=None,
+        err_msg_dict_name="from_array_kwargs",
+    )
+    from_array_kwargs = _resolve_doubly_passed_kwarg(
+        from_array_kwargs,
+        kwarg_name="lock",
+        passed_kwarg_value=lock,
+        default=False,
+        err_msg_dict_name="from_array_kwargs",
+    )
+    from_array_kwargs = _resolve_doubly_passed_kwarg(
+        from_array_kwargs,
+        kwarg_name="inline_array",
+        passed_kwarg_value=inline_array,
+        default=False,
+        err_msg_dict_name="from_array_kwargs",
+    )
+
+    return from_array_kwargs
+
+
+def _resolve_doubly_passed_kwarg(
+    kwargs_dict: dict,
+    kwarg_name: str,
+    passed_kwarg_value: str | bool | None,
+    default: bool | None,
+    err_msg_dict_name: str,
+) -> dict:
+    # if in kwargs_dict but not passed explicitly then just pass kwargs_dict through unaltered
+    if kwarg_name in kwargs_dict and passed_kwarg_value is None:
+        pass
+    # if passed explicitly but not in kwargs_dict then use that
+    elif kwarg_name not in kwargs_dict and passed_kwarg_value is not None:
+        kwargs_dict[kwarg_name] = passed_kwarg_value
+    # if in neither then use default
+    elif kwarg_name not in kwargs_dict and passed_kwarg_value is None:
+        kwargs_dict[kwarg_name] = default
+    # if in both then raise
+    else:
+        raise ValueError(
+            f"argument {kwarg_name} cannot be passed both as a keyword argument and within "
+            f"the {err_msg_dict_name} dictionary"
+        )
+
+    return kwargs_dict
```

### Comparing `xarray-2023.4.2/xarray/core/variable.py` & `xarray-2023.5.0/xarray/core/variable.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,18 +22,23 @@
     BasicIndexer,
     OuterIndexer,
     PandasIndexingAdapter,
     VectorizedIndexer,
     as_indexable,
 )
 from xarray.core.options import OPTIONS, _get_keep_attrs
+from xarray.core.parallelcompat import (
+    get_chunked_array_type,
+    guess_chunkmanager,
+)
 from xarray.core.pycompat import (
     array_type,
     integer_types,
     is_0d_dask_array,
+    is_chunked_array,
     is_duck_dask_array,
 )
 from xarray.core.utils import (
     Frozen,
     NdimSizeLenMixin,
     OrderedSet,
     _default,
@@ -50,14 +55,15 @@
     indexing.ExplicitlyIndexed,
     pd.Index,
 )
 # https://github.com/python/mypy/issues/224
 BASIC_INDEXING_TYPES = integer_types + (slice,)
 
 if TYPE_CHECKING:
+    from xarray.core.parallelcompat import ChunkManagerEntrypoint
     from xarray.core.types import (
         Dims,
         ErrorOptionsWithWarn,
         PadModeOptions,
         PadReflectOptions,
         QuantileMethods,
         T_Variable,
@@ -190,18 +196,18 @@
     )
     if non_ns_datetime64 or non_ns_datetime_tz_dtype:
         utils.emit_user_level_warning(NON_NANOSECOND_WARNING.format(case="datetime"))
         if isinstance(dtype, pd.DatetimeTZDtype):
             nanosecond_precision_dtype = pd.DatetimeTZDtype("ns", dtype.tz)
         else:
             nanosecond_precision_dtype = "datetime64[ns]"
-        return data.astype(nanosecond_precision_dtype)
+        return duck_array_ops.astype(data, nanosecond_precision_dtype)
     elif dtype.kind == "m" and dtype != np.dtype("timedelta64[ns]"):
         utils.emit_user_level_warning(NON_NANOSECOND_WARNING.format(case="timedelta"))
-        return data.astype("timedelta64[ns]")
+        return duck_array_ops.astype(data, "timedelta64[ns]")
     else:
         return data
 
 
 def _possibly_convert_objects(values):
     """Convert arrays of datetime.datetime and datetime.timedelta objects into
     datetime64 and timedelta64, according to the pandas convention. For the time
@@ -270,16 +276,15 @@
     if isinstance(data, (pd.Series, pd.Index, pd.DataFrame)):
         data = data.values
 
     if isinstance(data, np.ma.MaskedArray):
         mask = np.ma.getmaskarray(data)
         if mask.any():
             dtype, fill_value = dtypes.maybe_promote(data.dtype)
-            data = np.asarray(data, dtype=dtype)
-            data[mask] = fill_value
+            data = duck_array_ops.where_method(data, ~mask, fill_value)
         else:
             data = np.asarray(data)
 
     if not isinstance(data, np.ndarray) and (
         hasattr(data, "__array_function__") or hasattr(data, "__array_namespace__")
     ):
         return data
@@ -364,27 +369,27 @@
         self._encoding = None
         if attrs is not None:
             self.attrs = attrs
         if encoding is not None:
             self.encoding = encoding
 
     @property
-    def dtype(self):
+    def dtype(self) -> np.dtype:
         """
         Data-type of the arrays elements.
 
         See Also
         --------
         ndarray.dtype
         numpy.dtype
         """
         return self._data.dtype
 
     @property
-    def shape(self):
+    def shape(self) -> tuple[int, ...]:
         """
         Tuple of array dimensions.
 
         See Also
         --------
         numpy.ndarray.shape
         """
@@ -529,16 +534,18 @@
         **kwargs : dict
             Additional keyword arguments passed on to ``dask.array.compute``.
 
         See Also
         --------
         dask.array.compute
         """
-        if is_duck_dask_array(self._data):
-            self._data = as_compatible_data(self._data.compute(**kwargs))
+        if is_chunked_array(self._data):
+            chunkmanager = get_chunked_array_type(self._data)
+            loaded_data, *_ = chunkmanager.compute(self._data, **kwargs)
+            self._data = as_compatible_data(loaded_data)
         elif isinstance(self._data, indexing.ExplicitlyIndexed):
             self._data = self._data.get_duck_array()
         elif not is_duck_array(self._data):
             self._data = np.asarray(self._data)
         return self
 
     def compute(self, **kwargs):
@@ -629,19 +636,31 @@
     def _to_index(self) -> pd.Index:
         return self.to_index_variable()._to_index()
 
     def to_index(self) -> pd.Index:
         """Convert this variable to a pandas.Index"""
         return self.to_index_variable().to_index()
 
-    def to_dict(self, data: bool = True, encoding: bool = False) -> dict:
+    def to_dict(
+        self, data: bool | str = "list", encoding: bool = False
+    ) -> dict[str, Any]:
         """Dictionary representation of variable."""
-        item = {"dims": self.dims, "attrs": decode_numpy_dict_values(self.attrs)}
-        if data:
-            item["data"] = ensure_us_time_resolution(self.values).tolist()
+        item: dict[str, Any] = {
+            "dims": self.dims,
+            "attrs": decode_numpy_dict_values(self.attrs),
+        }
+        if data is not False:
+            if data in [True, "list"]:
+                item["data"] = ensure_us_time_resolution(self.to_numpy()).tolist()
+            elif data == "array":
+                item["data"] = ensure_us_time_resolution(self.data)
+            else:
+                msg = 'data argument must be bool, "list", or "array"'
+                raise ValueError(msg)
+
         else:
             item.update({"dtype": str(self.dtype), "shape": self.shape})
 
         if encoding:
             item["encoding"] = dict(self.encoding)
 
         return item
@@ -1150,16 +1169,18 @@
             int
             | Literal["auto"]
             | tuple[int, ...]
             | tuple[tuple[int, ...], ...]
             | Mapping[Any, None | int | tuple[int, ...]]
         ) = {},
         name: str | None = None,
-        lock: bool = False,
-        inline_array: bool = False,
+        lock: bool | None = None,
+        inline_array: bool | None = None,
+        chunked_array_type: str | ChunkManagerEntrypoint | None = None,
+        from_array_kwargs=None,
         **chunks_kwargs: Any,
     ) -> Variable:
         """Coerce this array's data into a dask array with the given chunks.
 
         If this variable is a non-dask array, it will be converted to dask
         array. If it's a dask array, it will be rechunked to the given chunk
         sizes.
@@ -1172,20 +1193,29 @@
         ----------
         chunks : int, tuple or dict, optional
             Chunk sizes along each dimension, e.g., ``5``, ``(5, 5)`` or
             ``{'x': 5, 'y': 5}``.
         name : str, optional
             Used to generate the name for this array in the internal dask
             graph. Does not need not be unique.
-        lock : optional
+        lock : bool, default: False
             Passed on to :py:func:`dask.array.from_array`, if the array is not
             already as dask array.
-        inline_array: optional
+        inline_array : bool, default: False
             Passed on to :py:func:`dask.array.from_array`, if the array is not
             already as dask array.
+        chunked_array_type: str, optional
+            Which chunked array type to coerce this datasets' arrays to.
+            Defaults to 'dask' if installed, else whatever is registered via the `ChunkManagerEntrypoint` system.
+            Experimental API that should not be relied upon.
+        from_array_kwargs: dict, optional
+            Additional keyword arguments passed on to the `ChunkManagerEntrypoint.from_array` method used to create
+            chunked arrays, via whichever chunk manager is specified through the `chunked_array_type` kwarg.
+            For example, with dask as the default chunked array type, this method would pass additional kwargs
+            to :py:func:`dask.array.from_array`. Experimental API that should not be relied upon.
         **chunks_kwargs : {dim: chunks, ...}, optional
             The keyword arguments form of ``chunks``.
             One of chunks or chunks_kwargs must be provided.
 
         Returns
         -------
         chunked : xarray.Variable
@@ -1193,72 +1223,83 @@
         See Also
         --------
         Variable.chunks
         Variable.chunksizes
         xarray.unify_chunks
         dask.array.from_array
         """
-        import dask.array as da
 
         if chunks is None:
             warnings.warn(
                 "None value for 'chunks' is deprecated. "
                 "It will raise an error in the future. Use instead '{}'",
                 category=FutureWarning,
             )
             chunks = {}
 
         if isinstance(chunks, (float, str, int, tuple, list)):
+            # TODO we shouldn't assume here that other chunkmanagers can handle these types
+            # TODO should we call normalize_chunks here?
             pass  # dask.array.from_array can handle these directly
         else:
             chunks = either_dict_or_kwargs(chunks, chunks_kwargs, "chunk")
 
         if utils.is_dict_like(chunks):
             chunks = {self.get_axis_num(dim): chunk for dim, chunk in chunks.items()}
 
+        chunkmanager = guess_chunkmanager(chunked_array_type)
+
+        if from_array_kwargs is None:
+            from_array_kwargs = {}
+
+        # TODO deprecate passing these dask-specific arguments explicitly. In future just pass everything via from_array_kwargs
+        _from_array_kwargs = utils.consolidate_dask_from_array_kwargs(
+            from_array_kwargs,
+            name=name,
+            lock=lock,
+            inline_array=inline_array,
+        )
+
         data = self._data
-        if is_duck_dask_array(data):
-            data = data.rechunk(chunks)
+        if chunkmanager.is_chunked_array(data):
+            data = chunkmanager.rechunk(data, chunks)  # type: ignore[arg-type]
         else:
             if isinstance(data, indexing.ExplicitlyIndexed):
                 # Unambiguously handle array storage backends (like NetCDF4 and h5py)
                 # that can't handle general array indexing. For example, in netCDF4 you
                 # can do "outer" indexing along two dimensions independent, which works
                 # differently from how NumPy handles it.
                 # da.from_array works by using lazy indexing with a tuple of slices.
                 # Using OuterIndexer is a pragmatic choice: dask does not yet handle
                 # different indexing types in an explicit way:
                 # https://github.com/dask/dask/issues/2883
                 data = indexing.ImplicitToExplicitIndexingAdapter(
                     data, indexing.OuterIndexer
                 )
 
-                # All of our lazily loaded backend array classes should use NumPy
-                # array operations.
-                kwargs = {"meta": np.ndarray}
-            else:
-                kwargs = {}
-
             if utils.is_dict_like(chunks):
-                chunks = tuple(chunks.get(n, s) for n, s in enumerate(self.shape))
+                chunks = tuple(chunks.get(n, s) for n, s in enumerate(data.shape))
 
-            data = da.from_array(
-                data, chunks, name=name, lock=lock, inline_array=inline_array, **kwargs
+            data = chunkmanager.from_array(
+                data,
+                chunks,  # type: ignore[arg-type]
+                **_from_array_kwargs,
             )
 
         return self._replace(data=data)
 
     def to_numpy(self) -> np.ndarray:
         """Coerces wrapped data to numpy and returns a numpy.ndarray"""
         # TODO an entrypoint so array libraries can choose coercion method?
         data = self.data
 
         # TODO first attempt to call .to_numpy() once some libraries implement it
         if hasattr(data, "chunks"):
-            data = data.compute()
+            chunkmanager = get_chunked_array_type(data)
+            data, *_ = chunkmanager.compute(data)
         if isinstance(data, array_type("cupy")):
             data = data.get()
         # pint has to be imported dynamically as pint imports xarray
         if isinstance(data, array_type("pint")):
             data = data.magnitude
         if isinstance(data, array_type("sparse")):
             data = data.todense()
@@ -2887,15 +2928,23 @@
     @Variable.values.setter  # type: ignore[attr-defined]
     def values(self, values):
         raise ValueError(
             f"Cannot assign to the .values attribute of dimension coordinate a.k.a IndexVariable {self.name!r}. "
             f"Please use DataArray.assign_coords, Dataset.assign_coords or Dataset.assign as appropriate."
         )
 
-    def chunk(self, chunks={}, name=None, lock=False, inline_array=False):
+    def chunk(
+        self,
+        chunks={},
+        name=None,
+        lock=False,
+        inline_array=False,
+        chunked_array_type=None,
+        from_array_kwargs=None,
+    ):
         # Dummy - do not chunk. This method is invoked e.g. by Dataset.chunk()
         return self.copy(deep=False)
 
     def _as_sparse(self, sparse_format=_default, fill_value=_default):
         # Dummy
         return self.copy(deep=False)
```

### Comparing `xarray-2023.4.2/xarray/core/weighted.py` & `xarray-2023.5.0/xarray/core/weighted.py`

 * *Files 1% similar despite different names*

```diff
@@ -234,15 +234,18 @@
         # we need to mask data values that are nan; else the weights are wrong
         mask = da.notnull()
 
         # bool -> int, because ``xr.dot([True, True], [True, True])`` -> True
         # (and not 2); GH4074
         if self.weights.dtype == bool:
             sum_of_weights = self._reduce(
-                mask, self.weights.astype(int), dim=dim, skipna=False
+                mask,
+                duck_array_ops.astype(self.weights, dtype=int),
+                dim=dim,
+                skipna=False,
             )
         else:
             sum_of_weights = self._reduce(mask, self.weights, dim=dim, skipna=False)
 
         # 0-weights are not valid
         valid_weights = sum_of_weights != 0.0
```

### Comparing `xarray-2023.4.2/xarray/plot/__init__.py` & `xarray-2023.5.0/xarray/plot/__init__.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/plot/accessor.py` & `xarray-2023.5.0/xarray/plot/accessor.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/plot/dataarray_plot.py` & `xarray-2023.5.0/xarray/plot/dataarray_plot.py`

 * *Files 0% similar despite different names*

```diff
@@ -526,15 +526,15 @@
     # Rotate dates on xlabels
     # Do this without calling autofmt_xdate so that x-axes ticks
     # on other subplots (if any) are not deleted.
     # https://stackoverflow.com/questions/17430105/autofmt-xdate-deletes-x-axis-labels-of-all-subplots
     if np.issubdtype(xplt.dtype, np.datetime64):
         for xlabels in ax.get_xticklabels():
             xlabels.set_rotation(30)
-            xlabels.set_ha("right")
+            xlabels.set_horizontalalignment("right")
 
     _update_axes(ax, xincrease, yincrease, xscale, yscale, xticks, yticks, xlim, ylim)
 
     return primitive
 
 
 @overload
@@ -1095,15 +1095,15 @@
         if rotate_label and np.issubdtype(darray.dtype, np.datetime64):
             # Rotate dates on xlabels
             # Do this without calling autofmt_xdate so that x-axes ticks
             # on other subplots (if any) are not deleted.
             # https://stackoverflow.com/questions/17430105/autofmt-xdate-deletes-x-axis-labels-of-all-subplots
             for labels in getattr(ax, f"get_{axis}ticklabels")():
                 labels.set_rotation(30)
-                labels.set_ha("right")
+                labels.set_horizontalalignment("right")
 
 
 @overload
 def scatter(
     darray: DataArray,
     *args: Any,
     x: Hashable | None = None,
@@ -1635,15 +1635,15 @@
         # Rotate dates on xlabels
         # Do this without calling autofmt_xdate so that x-axes ticks
         # on other subplots (if any) are not deleted.
         # https://stackoverflow.com/questions/17430105/autofmt-xdate-deletes-x-axis-labels-of-all-subplots
         if np.issubdtype(xplt.dtype, np.datetime64):
             for xlabels in ax.get_xticklabels():
                 xlabels.set_rotation(30)
-                xlabels.set_ha("right")
+                xlabels.set_horizontalalignment("right")
 
         return primitive
 
     # we want to actually expose the signature of newplotfunc
     # and not the copied **kwargs from the plotfunc which
     # functools.wraps adds, so delete the wrapped attr
     del newplotfunc.__wrapped__
```

### Comparing `xarray-2023.4.2/xarray/plot/dataset_plot.py` & `xarray-2023.5.0/xarray/plot/dataset_plot.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/plot/facetgrid.py` & `xarray-2023.5.0/xarray/plot/facetgrid.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/plot/utils.py` & `xarray-2023.5.0/xarray/plot/utils.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/static/css/style.css` & `xarray-2023.5.0/xarray/static/css/style.css`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/static/html/icons-svg-inline.html` & `xarray-2023.5.0/xarray/static/html/icons-svg-inline.html`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/testing.py` & `xarray-2023.5.0/xarray/testing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/__init__.py` & `xarray-2023.5.0/xarray/tests/__init__.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/conftest.py` & `xarray-2023.5.0/xarray/tests/conftest.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/data/bears.nc` & `xarray-2023.5.0/xarray/tests/data/bears.nc`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/data/example.grib` & `xarray-2023.5.0/xarray/tests/data/example.grib`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/data/example.ict` & `xarray-2023.5.0/xarray/tests/data/example.ict`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/data/example.uamiv` & `xarray-2023.5.0/xarray/tests/data/example.uamiv`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/data/example_1.nc` & `xarray-2023.5.0/xarray/tests/data/example_1.nc`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_accessor_dt.py` & `xarray-2023.5.0/xarray/tests/test_accessor_dt.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_accessor_str.py` & `xarray-2023.5.0/xarray/tests/test_accessor_str.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_array_api.py` & `xarray-2023.5.0/xarray/tests/test_array_api.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_backends.py` & `xarray-2023.5.0/xarray/tests/test_backends.py`

 * *Files 0% similar despite different names*

```diff
@@ -2580,18 +2580,18 @@
         ds = create_test_data()
 
         # NOTE: using self.roundtrip, which uses open_dataset, will not trigger the bug.
         with self.create_zarr_target() as initial_store:
             ds.to_zarr(initial_store, mode="w", **self.version_kwargs)
             ds1 = xr.open_zarr(initial_store, **self.version_kwargs)
 
-        # Combination of where+squeeze triggers error on write.
-        ds_sel = ds1.where(ds1.coords["dim3"] == "a", drop=True).squeeze("dim3")
-        with self.create_zarr_target() as final_store:
-            ds_sel.to_zarr(final_store, mode="w", **self.version_kwargs)
+            # Combination of where+squeeze triggers error on write.
+            ds_sel = ds1.where(ds1.coords["dim3"] == "a", drop=True).squeeze("dim3")
+            with self.create_zarr_target() as final_store:
+                ds_sel.to_zarr(final_store, mode="w", **self.version_kwargs)
 
     @pytest.mark.parametrize("obj", [Dataset(), DataArray(name="foo")])
     def test_attributes(self, obj) -> None:
         obj = obj.copy()
 
         obj.attrs["good"] = {"key": "value"}
         ds = obj if isinstance(obj, Dataset) else obj.to_dataset()
```

### Comparing `xarray-2023.4.2/xarray/tests/test_backends_api.py` & `xarray-2023.5.0/xarray/tests/test_backends_api.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_backends_common.py` & `xarray-2023.5.0/xarray/tests/test_backends_common.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_backends_file_manager.py` & `xarray-2023.5.0/xarray/tests/test_backends_file_manager.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_backends_lru_cache.py` & `xarray-2023.5.0/xarray/tests/test_backends_lru_cache.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_calendar_ops.py` & `xarray-2023.5.0/xarray/tests/test_calendar_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_cftime_offsets.py` & `xarray-2023.5.0/xarray/tests/test_cftime_offsets.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_cftimeindex.py` & `xarray-2023.5.0/xarray/tests/test_cftimeindex.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_cftimeindex_resample.py` & `xarray-2023.5.0/xarray/tests/test_cftimeindex_resample.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_coarsen.py` & `xarray-2023.5.0/xarray/tests/test_coarsen.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_coding.py` & `xarray-2023.5.0/xarray/tests/test_coding.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_coding_strings.py` & `xarray-2023.5.0/xarray/tests/test_coding_strings.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_coding_times.py` & `xarray-2023.5.0/xarray/tests/test_coding_times.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_combine.py` & `xarray-2023.5.0/xarray/tests/test_combine.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_computation.py` & `xarray-2023.5.0/xarray/tests/test_computation.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_concat.py` & `xarray-2023.5.0/xarray/tests/test_concat.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_conventions.py` & `xarray-2023.5.0/xarray/tests/test_conventions.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_cupy.py` & `xarray-2023.5.0/xarray/tests/test_cupy.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_dask.py` & `xarray-2023.5.0/xarray/tests/test_dask.py`

 * *Files 0% similar despite different names*

```diff
@@ -174,14 +174,27 @@
     def test_binary_op(self):
         u = self.eager_var
         v = self.lazy_var
         self.assertLazyAndIdentical(2 * u, 2 * v)
         self.assertLazyAndIdentical(u + u, v + v)
         self.assertLazyAndIdentical(u[0] + u, v[0] + v)
 
+    def test_binary_op_bitshift(self) -> None:
+        # bit shifts only work on ints so we need to generate
+        # new eager and lazy vars
+        rng = np.random.default_rng(0)
+        values = rng.integers(low=-10000, high=10000, size=(4, 6))
+        data = da.from_array(values, chunks=(2, 2))
+        u = Variable(("x", "y"), values)
+        v = Variable(("x", "y"), data)
+        self.assertLazyAndIdentical(u << 2, v << 2)
+        self.assertLazyAndIdentical(u << 5, v << 5)
+        self.assertLazyAndIdentical(u >> 2, v >> 2)
+        self.assertLazyAndIdentical(u >> 5, v >> 5)
+
     def test_repr(self):
         expected = dedent(
             """\
             <xarray.Variable (x: 4, y: 6)>
             {!r}""".format(
                 self.lazy_var.data
             )
@@ -887,21 +900,20 @@
 
         with pytest.raises(ValueError, match=r"does not match the set of dimensions"):
             ds.to_dask_dataframe(dim_order=["x"])
 
 
 @pytest.mark.parametrize("method", ["load", "compute"])
 def test_dask_kwargs_variable(method):
-    x = Variable("y", da.from_array(np.arange(3), chunks=(2,)))
-    # args should be passed on to da.Array.compute()
-    with mock.patch.object(
-        da.Array, "compute", return_value=np.arange(3)
-    ) as mock_compute:
+    chunked_array = da.from_array(np.arange(3), chunks=(2,))
+    x = Variable("y", chunked_array)
+    # args should be passed on to dask.compute() (via DaskManager.compute())
+    with mock.patch.object(da, "compute", return_value=(np.arange(3),)) as mock_compute:
         getattr(x, method)(foo="bar")
-    mock_compute.assert_called_with(foo="bar")
+    mock_compute.assert_called_with(chunked_array, foo="bar")
 
 
 @pytest.mark.parametrize("method", ["load", "compute", "persist"])
 def test_dask_kwargs_dataarray(method):
     data = da.from_array(np.arange(3), chunks=(2,))
     x = DataArray(data)
     if method in ["load", "compute"]:
```

### Comparing `xarray-2023.4.2/xarray/tests/test_dataarray.py` & `xarray-2023.5.0/xarray/tests/test_dataarray.py`

 * *Files 0% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 
 import pickle
 import sys
 import warnings
 from collections.abc import Hashable
 from copy import deepcopy
 from textwrap import dedent
-from typing import Any, Final, cast
+from typing import Any, Final, Literal, cast
 
 import numpy as np
 import pandas as pd
 import pytest
 from packaging.version import Version
 
 import xarray as xr
@@ -3241,14 +3241,47 @@
 
         arr = DataArray(arr_np, [("MI", mindex), ("C", [])], name="foo")
 
         actual = arr.to_dataframe()
         assert len(actual) == 0
         assert_array_equal(actual.index.names, list("ABC"))
 
+    @requires_dask
+    def test_to_dask_dataframe(self) -> None:
+        arr_np = np.arange(3 * 4).reshape(3, 4)
+        arr = DataArray(arr_np, [("B", [1, 2, 3]), ("A", list("cdef"))], name="foo")
+        expected = arr.to_series()
+        actual = arr.to_dask_dataframe()["foo"]
+
+        assert_array_equal(actual.values, expected.values)
+
+        actual = arr.to_dask_dataframe(dim_order=["A", "B"])["foo"]
+        assert_array_equal(arr_np.transpose().reshape(-1), actual.values)
+
+        # regression test for coords with different dimensions
+
+        arr.coords["C"] = ("B", [-1, -2, -3])
+        expected = arr.to_series().to_frame()
+        expected["C"] = [-1] * 4 + [-2] * 4 + [-3] * 4
+        expected = expected[["C", "foo"]]
+        actual = arr.to_dask_dataframe()[["C", "foo"]]
+
+        assert_array_equal(expected.values, actual.values)
+        assert_array_equal(expected.columns.values, actual.columns.values)
+
+        with pytest.raises(ValueError, match="does not match the set of dimensions"):
+            arr.to_dask_dataframe(dim_order=["B", "A", "C"])
+
+        arr.name = None
+        with pytest.raises(
+            ValueError,
+            match="Cannot convert an unnamed DataArray",
+        ):
+            arr.to_dask_dataframe()
+
     def test_to_pandas_name_matches_coordinate(self) -> None:
         # coordinate with same name as array
         arr = DataArray([1, 2, 3], dims="x", name="x")
         series = arr.to_series()
         assert_array_equal([1, 2, 3], series.values)
         assert_array_equal([0, 1, 2], series.index.values)
         assert "x" == series.name
@@ -3341,54 +3374,78 @@
         if not hasattr(pd, "CategoricalIndex"):
             pytest.skip("requires pandas with CategoricalIndex")
 
         s = pd.Series(np.arange(5), index=pd.CategoricalIndex(list("aabbc")))
         arr = DataArray(s)
         assert "'a'" in repr(arr)  # should not error
 
+    @pytest.mark.parametrize("use_dask", [True, False])
+    @pytest.mark.parametrize("data", ["list", "array", True])
     @pytest.mark.parametrize("encoding", [True, False])
-    def test_to_and_from_dict(self, encoding) -> None:
+    def test_to_and_from_dict(
+        self, encoding: bool, data: bool | Literal["list", "array"], use_dask: bool
+    ) -> None:
+        if use_dask and not has_dask:
+            pytest.skip("requires dask")
+        encoding_data = {"bar": "spam"}
         array = DataArray(
             np.random.randn(2, 3), {"x": ["a", "b"]}, ["x", "y"], name="foo"
         )
-        array.encoding = {"bar": "spam"}
-        expected = {
+        array.encoding = encoding_data
+
+        return_data = array.to_numpy()
+        coords_data = np.array(["a", "b"])
+        if data == "list" or data is True:
+            return_data = return_data.tolist()
+            coords_data = coords_data.tolist()
+
+        expected: dict[str, Any] = {
             "name": "foo",
             "dims": ("x", "y"),
-            "data": array.values.tolist(),
+            "data": return_data,
             "attrs": {},
-            "coords": {"x": {"dims": ("x",), "data": ["a", "b"], "attrs": {}}},
+            "coords": {"x": {"dims": ("x",), "data": coords_data, "attrs": {}}},
         }
         if encoding:
-            expected["encoding"] = {"bar": "spam"}
-        actual = array.to_dict(encoding=encoding)
+            expected["encoding"] = encoding_data
+
+        if has_dask:
+            da = array.chunk()
+        else:
+            da = array
+
+        if data == "array" or data is False:
+            with raise_if_dask_computes():
+                actual = da.to_dict(encoding=encoding, data=data)
+        else:
+            actual = da.to_dict(encoding=encoding, data=data)
 
         # check that they are identical
-        assert expected == actual
+        np.testing.assert_equal(expected, actual)
 
         # check roundtrip
-        assert_identical(array, DataArray.from_dict(actual))
+        assert_identical(da, DataArray.from_dict(actual))
 
         # a more bare bones representation still roundtrips
         d = {
             "name": "foo",
             "dims": ("x", "y"),
-            "data": array.values.tolist(),
+            "data": da.values.tolist(),
             "coords": {"x": {"dims": "x", "data": ["a", "b"]}},
         }
-        assert_identical(array, DataArray.from_dict(d))
+        assert_identical(da, DataArray.from_dict(d))
 
         # and the most bare bones representation still roundtrips
-        d = {"name": "foo", "dims": ("x", "y"), "data": array.values}
-        assert_identical(array.drop_vars("x"), DataArray.from_dict(d))
+        d = {"name": "foo", "dims": ("x", "y"), "data": da.values}
+        assert_identical(da.drop_vars("x"), DataArray.from_dict(d))
 
         # missing a dims in the coords
         d = {
             "dims": ("x", "y"),
-            "data": array.values,
+            "data": da.values,
             "coords": {"x": {"data": ["a", "b"]}},
         }
         with pytest.raises(
             ValueError,
             match=r"cannot convert dict when coords are missing the key 'dims'",
         ):
             DataArray.from_dict(d)
@@ -3403,15 +3460,15 @@
         # check the data=False option
         expected_no_data = expected.copy()
         del expected_no_data["data"]
         del expected_no_data["coords"]["x"]["data"]
         endiantype = "<U1" if sys.byteorder == "little" else ">U1"
         expected_no_data["coords"]["x"].update({"dtype": endiantype, "shape": (2,)})
         expected_no_data.update({"dtype": "float64", "shape": (2, 3)})
-        actual_no_data = array.to_dict(data=False, encoding=encoding)
+        actual_no_data = da.to_dict(data=False, encoding=encoding)
         assert expected_no_data == actual_no_data
 
     def test_to_and_from_dict_with_time_dim(self) -> None:
         x = np.random.randn(10, 3)
         t = pd.date_range("20130101", periods=10)
         lat = [77.7, 83.2, 76]
         da = DataArray(x, {"t": t, "lat": lat}, dims=["t", "lat"])
@@ -3922,14 +3979,19 @@
 
         actual = (self.dv * 10).xindexes["x"]
         assert expected is actual
 
         actual = (self.dv > 10).xindexes["x"]
         assert expected is actual
 
+        # use mda for bitshift test as it's type int
+        actual = (self.mda << 2).xindexes["x"]
+        expected = self.mda.xindexes["x"]
+        assert expected is actual
+
     def test_binary_op_join_setting(self) -> None:
         dim = "x"
         align_type: Final = "outer"
         coords_l, coords_r = [0, 1, 2], [1, 2, 3]
         missing_3 = xr.DataArray(coords_l, [(dim, coords_l)])
         missing_0 = xr.DataArray(coords_r, [(dim, coords_r)])
         with xr.set_options(arithmetic_join=align_type):
```

### Comparing `xarray-2023.4.2/xarray/tests/test_dataset.py` & `xarray-2023.5.0/xarray/tests/test_dataset.py`

 * *Files 0% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 import re
 import sys
 import warnings
 from collections.abc import Hashable
 from copy import copy, deepcopy
 from io import StringIO
 from textwrap import dedent
-from typing import Any
+from typing import Any, Literal
 
 import numpy as np
 import pandas as pd
 import pytest
 from pandas.core.indexes.datetimes import DatetimeIndex
 
 import xarray as xr
@@ -4592,15 +4592,19 @@
         df.index = pd.MultiIndex.from_product([["a"], range(3)], names=["one", "two"])
         roundtripped = Dataset.from_dataframe(df).to_dataframe()
         # we can't do perfectly, but we should be at least as faithful as
         # np.asarray
         expected = df.apply(np.asarray)
         assert roundtripped.equals(expected)
 
-    def test_to_and_from_dict(self) -> None:
+    @pytest.mark.parametrize("encoding", [True, False])
+    @pytest.mark.parametrize("data", [True, "list", "array"])
+    def test_to_and_from_dict(
+        self, encoding: bool, data: bool | Literal["list", "array"]
+    ) -> None:
         # <xarray.Dataset>
         # Dimensions:  (t: 10)
         # Coordinates:
         #   * t        (t) <U1 'a' 'b' 'c' 'd' 'e' 'f' 'g' 'h' 'i' 'j'
         # Data variables:
         #     a        (t) float64 0.6916 -1.056 -1.163 0.9792 -0.7865 ...
         #     b        (t) float64 1.32 0.1954 1.91 1.39 0.519 -0.2772 ...
@@ -4613,40 +4617,55 @@
             "attrs": {},
             "dims": {"t": 10},
             "data_vars": {
                 "a": {"dims": ("t",), "data": x.tolist(), "attrs": {}},
                 "b": {"dims": ("t",), "data": y.tolist(), "attrs": {}},
             },
         }
+        if encoding:
+            ds.t.encoding.update({"foo": "bar"})
+            expected["encoding"] = {}
+            expected["coords"]["t"]["encoding"] = ds.t.encoding
+            for vvs in ["a", "b"]:
+                expected["data_vars"][vvs]["encoding"] = {}
 
-        actual = ds.to_dict()
+        actual = ds.to_dict(data=data, encoding=encoding)
 
         # check that they are identical
-        assert expected == actual
+        np.testing.assert_equal(expected, actual)
 
         # check roundtrip
-        assert_identical(ds, Dataset.from_dict(actual))
+        ds_rt = Dataset.from_dict(actual)
+        assert_identical(ds, ds_rt)
+        if encoding:
+            assert set(ds_rt.variables) == set(ds.variables)
+            for vv in ds.variables:
+                np.testing.assert_equal(ds_rt[vv].encoding, ds[vv].encoding)
 
         # check the data=False option
         expected_no_data = expected.copy()
         del expected_no_data["coords"]["t"]["data"]
         del expected_no_data["data_vars"]["a"]["data"]
         del expected_no_data["data_vars"]["b"]["data"]
         endiantype = "<U1" if sys.byteorder == "little" else ">U1"
         expected_no_data["coords"]["t"].update({"dtype": endiantype, "shape": (10,)})
         expected_no_data["data_vars"]["a"].update({"dtype": "float64", "shape": (10,)})
         expected_no_data["data_vars"]["b"].update({"dtype": "float64", "shape": (10,)})
-        actual_no_data = ds.to_dict(data=False)
+        actual_no_data = ds.to_dict(data=False, encoding=encoding)
         assert expected_no_data == actual_no_data
 
         # verify coords are included roundtrip
         expected_ds = ds.set_coords("b")
-        actual2 = Dataset.from_dict(expected_ds.to_dict())
+        actual2 = Dataset.from_dict(expected_ds.to_dict(data=data, encoding=encoding))
 
         assert_identical(expected_ds, actual2)
+        if encoding:
+            assert set(expected_ds.variables) == set(actual2.variables)
+            for vv in ds.variables:
+                np.testing.assert_equal(expected_ds[vv].encoding, actual2[vv].encoding)
 
         # test some incomplete dicts:
         # this one has no attrs field, the dims are strings, and x, y are
         # np.arrays
 
         d = {
             "coords": {"t": {"dims": "t", "data": t}},
@@ -4686,15 +4705,18 @@
                 "t": ("t", t),
                 "lat": ("lat", lat),
             }
         )
         roundtripped = Dataset.from_dict(ds.to_dict())
         assert_identical(ds, roundtripped)
 
-    def test_to_and_from_dict_with_nan_nat(self) -> None:
+    @pytest.mark.parametrize("data", [True, "list", "array"])
+    def test_to_and_from_dict_with_nan_nat(
+        self, data: bool | Literal["list", "array"]
+    ) -> None:
         x = np.random.randn(10, 3)
         y = np.random.randn(10, 3)
         y[2] = np.nan
         t = pd.Series(pd.date_range("20130101", periods=10))
         t[2] = np.nan
 
         lat = [77.7, 83.2, 76]
@@ -4702,15 +4724,15 @@
             {
                 "a": (["t", "lat"], x),
                 "b": (["t", "lat"], y),
                 "t": ("t", t),
                 "lat": ("lat", lat),
             }
         )
-        roundtripped = Dataset.from_dict(ds.to_dict())
+        roundtripped = Dataset.from_dict(ds.to_dict(data=data))
         assert_identical(ds, roundtripped)
 
     def test_to_dict_with_numpy_attrs(self) -> None:
         # this doesn't need to roundtrip
         x = np.random.randn(10)
         y = np.random.randn(10)
         t = list("abcdefghij")
```

### Comparing `xarray-2023.4.2/xarray/tests/test_deprecation_helpers.py` & `xarray-2023.5.0/xarray/tests/test_deprecation_helpers.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_distributed.py` & `xarray-2023.5.0/xarray/tests/test_distributed.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_dtypes.py` & `xarray-2023.5.0/xarray/tests/test_dtypes.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_duck_array_ops.py` & `xarray-2023.5.0/xarray/tests/test_duck_array_ops.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_extensions.py` & `xarray-2023.5.0/xarray/tests/test_extensions.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_formatting.py` & `xarray-2023.5.0/xarray/tests/test_formatting.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_formatting_html.py` & `xarray-2023.5.0/xarray/tests/test_formatting_html.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_groupby.py` & `xarray-2023.5.0/xarray/tests/test_groupby.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 from __future__ import annotations
 
 import datetime
+import operator
 import warnings
 
 import numpy as np
 import pandas as pd
 import pytest
 
 import xarray as xr
@@ -13,14 +14,15 @@
 from xarray.tests import (
     assert_allclose,
     assert_array_equal,
     assert_equal,
     assert_identical,
     create_test_data,
     has_cftime,
+    has_flox,
     has_pandas_version_two,
     requires_dask,
     requires_flox,
     requires_scipy,
 )
 
 
@@ -47,16 +49,17 @@
     assert _consolidate_slices([slice(3), slice(3, 5)]) == [slice(5)]
     assert _consolidate_slices([slice(2, 3), slice(3, 6)]) == [slice(2, 6)]
     assert _consolidate_slices([slice(2, 3, 1), slice(3, 6, 1)]) == [slice(2, 6, 1)]
 
     slices = [slice(2, 3), slice(5, 6)]
     assert _consolidate_slices(slices) == slices
 
+    # ignore type because we're checking for an error anyway
     with pytest.raises(ValueError):
-        _consolidate_slices([slice(3), 4])
+        _consolidate_slices([slice(3), 4])  # type: ignore[list-item]
 
 
 def test_groupby_dims_property(dataset) -> None:
     assert dataset.groupby("x").dims == dataset.isel(x=1).dims
     assert dataset.groupby("y").dims == dataset.isel(y=1).dims
 
     stacked = dataset.stack({"xy": ("x", "y")})
@@ -534,15 +537,15 @@
     expected2 = (
         stacked.variable.where(stacked.id.notnull())
         .rename({"xy": "id"})
         .to_dataset()
         .reset_index("id", drop=True)
         .assign(id=stacked.id.values)
         .dropna("id")
-        .transpose(*actual2.dims)
+        .transpose(*actual2.variable.dims)
     )
     assert_identical(actual2, expected2)
 
     # reduction operation along a different dimension
     actual3 = grouped.mean("time")
     expected3 = ds.mean("time").where(ds.id.notnull())
     assert_identical(actual3, expected3)
@@ -804,14 +807,64 @@
             "time": pd.date_range("2000-01-01", periods=100),
         }
     )
     with pytest.raises(ValueError, match=r"incompat.* grouped binary"):
         ds + ds.groupby("time.month")
 
 
+def test_groupby_math_bitshift() -> None:
+    # create new dataset of int's only
+    ds = Dataset(
+        {
+            "x": ("index", np.ones(4, dtype=int)),
+            "y": ("index", np.ones(4, dtype=int) * -1),
+            "level": ("index", [1, 1, 2, 2]),
+            "index": [0, 1, 2, 3],
+        }
+    )
+    shift = DataArray([1, 2, 1], [("level", [1, 2, 8])])
+
+    left_expected = Dataset(
+        {
+            "x": ("index", [2, 2, 4, 4]),
+            "y": ("index", [-2, -2, -4, -4]),
+            "level": ("index", [2, 2, 8, 8]),
+            "index": [0, 1, 2, 3],
+        }
+    )
+
+    left_manual = []
+    for lev, group in ds.groupby("level"):
+        shifter = shift.sel(level=lev)
+        left_manual.append(group << shifter)
+    left_actual = xr.concat(left_manual, dim="index").reset_coords(names="level")
+    assert_equal(left_expected, left_actual)
+
+    left_actual = (ds.groupby("level") << shift).reset_coords(names="level")
+    assert_equal(left_expected, left_actual)
+
+    right_expected = Dataset(
+        {
+            "x": ("index", [0, 0, 2, 2]),
+            "y": ("index", [-1, -1, -2, -2]),
+            "level": ("index", [0, 0, 4, 4]),
+            "index": [0, 1, 2, 3],
+        }
+    )
+    right_manual = []
+    for lev, group in left_expected.groupby("level"):
+        shifter = shift.sel(level=lev)
+        right_manual.append(group >> shifter)
+    right_actual = xr.concat(right_manual, dim="index").reset_coords(names="level")
+    assert_equal(right_expected, right_actual)
+
+    right_actual = (left_expected.groupby("level") >> shift).reset_coords(names="level")
+    assert_equal(right_expected, right_actual)
+
+
 @pytest.mark.parametrize("use_flox", [True, False])
 def test_groupby_bins_cut_kwargs(use_flox: bool) -> None:
     da = xr.DataArray(np.arange(12).reshape(6, 2), dims=("x", "y"))
     x_bins = (0, 2, 4, 6)
 
     with xr.set_options(use_flox=use_flox):
         actual = da.groupby_bins(
@@ -1270,16 +1323,23 @@
             range(4), {"b": ("x", [0, 0, 1, 1]), "x": [0, 1, 2, 3]}, dims="x"
         )
         other = DataArray([10], coords={"b": [0]}, dims="b")
         actual = array.groupby("b") + other
         expected = DataArray([10, 11, np.nan, np.nan], array.coords)
         assert_identical(expected, actual)
 
+        # regression test for #7797
+        other = array.groupby("b").sum()
+        actual = array.sel(x=[0, 1]).groupby("b") - other
+        expected = DataArray([-1, 0], {"b": ("x", [0, 0]), "x": [0, 1]}, dims="x")
+        assert_identical(expected, actual)
+
         other = DataArray([10], coords={"c": 123, "b": [0]}, dims="b")
         actual = array.groupby("b") + other
+        expected = DataArray([10, 11, np.nan, np.nan], array.coords)
         expected.coords["c"] = (["x"], [123] * 2 + [np.nan] * 2)
         assert_identical(expected, actual)
 
         other = Dataset({"a": ("b", [10])}, {"b": [0]})
         actual = array.groupby("b") + other
         expected = Dataset({"a": ("x", [10, 11, np.nan, np.nan])}, array.coords)
         assert_identical(expected, actual)
@@ -1740,15 +1800,15 @@
         actual = array.resample(time="3H").pad()
         expected = DataArray(array.to_series().resample("3H").ffill())
         assert_identical(expected, actual)
 
         # Nearest
         rs = array.resample(time="3H")
         actual = rs.nearest()
-        new_times = rs._full_index
+        new_times = rs.groupers[0].full_index
         expected = DataArray(array.reindex(time=new_times, method="nearest"))
         assert_identical(expected, actual)
 
     def test_upsample_nd(self):
         # Same as before, but now we try on multi-dimensional DataArrays.
         xs = np.arange(6)
         ys = np.arange(3)
@@ -2257,7 +2317,58 @@
     # TODO: Remove drop_vars when GH6528 is fixed
     # when Dataset.cumsum propagates indexes, and the group variable?
     assert_identical(expected.drop_vars(["time"]), actual)
 
     actual = getattr(ds.foo.resample(time="3M"), method)(dim="time")
     expected.coords["time"] = ds.time
     assert_identical(expected.drop_vars(["time"]).foo, actual)
+
+
+def test_groupby_binary_op_regression() -> None:
+    # regression test for #7797
+    # monthly timeseries that should return "zero anomalies" everywhere
+    time = xr.date_range("2023-01-01", "2023-12-31", freq="MS")
+    data = np.linspace(-1, 1, 12)
+    x = xr.DataArray(data, coords={"time": time})
+    clim = xr.DataArray(data, coords={"month": np.arange(1, 13, 1)})
+
+    # seems to give the correct result if we use the full x, but not with a slice
+    x_slice = x.sel(time=["2023-04-01"])
+
+    # two typical ways of computing anomalies
+    anom_gb = x_slice.groupby("time.month") - clim
+
+    assert_identical(xr.zeros_like(anom_gb), anom_gb)
+
+
+@requires_flox
+@pytest.mark.parametrize("func", ["sum", "prod"])
+@pytest.mark.parametrize("skipna", [True, False])
+@pytest.mark.parametrize("min_count", [None, 1])
+def test_min_count_vs_flox(func: str, min_count: int | None, skipna: bool) -> None:
+    da = DataArray(
+        data=np.array([np.nan, 1, 1, np.nan, 1, 1]),
+        dims="x",
+        coords={"labels": ("x", np.array([1, 2, 3, 1, 2, 3]))},
+    )
+
+    gb = da.groupby("labels")
+    method = operator.methodcaller(func, min_count=min_count, skipna=skipna)
+    with xr.set_options(use_flox=True):
+        actual = method(gb)
+    with xr.set_options(use_flox=False):
+        expected = method(gb)
+    assert_identical(actual, expected)
+
+
+@pytest.mark.parametrize("use_flox", [True, False])
+def test_min_count_error(use_flox: bool) -> None:
+    if use_flox and not has_flox:
+        pytest.skip()
+    da = DataArray(
+        data=np.array([np.nan, 1, 1, np.nan, 1, 1]),
+        dims="x",
+        coords={"labels": ("x", np.array([1, 2, 3, 1, 2, 3]))},
+    )
+    with xr.set_options(use_flox=use_flox):
+        with pytest.raises(TypeError):
+            da.groupby("labels").mean(min_count=1)
```

### Comparing `xarray-2023.4.2/xarray/tests/test_indexes.py` & `xarray-2023.5.0/xarray/tests/test_indexes.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_indexing.py` & `xarray-2023.5.0/xarray/tests/test_indexing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_interp.py` & `xarray-2023.5.0/xarray/tests/test_interp.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_merge.py` & `xarray-2023.5.0/xarray/tests/test_merge.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_missing.py` & `xarray-2023.5.0/xarray/tests/test_missing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_nputils.py` & `xarray-2023.5.0/xarray/tests/test_nputils.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_options.py` & `xarray-2023.5.0/xarray/tests/test_options.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_plot.py` & `xarray-2023.5.0/xarray/tests/test_plot.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_plugins.py` & `xarray-2023.5.0/xarray/tests/test_plugins.py`

 * *Files 0% similar despite different names*

```diff
@@ -232,14 +232,15 @@
         "flox",
         # "dask",  # TODO: backends.locks is not lazy yet :(
         "dask.array",
         "dask.distributed",
         "sparse",
         "cupy",
         "pint",
+        "cubed",
     ]
     # ensure that none of the above modules has been imported before
     modules_backup = {}
     for pkg in list(sys.modules.keys()):
         for mod in blacklisted + ["xarray"]:
             if pkg.startswith(mod):
                 modules_backup[pkg] = sys.modules[pkg]
```

### Comparing `xarray-2023.4.2/xarray/tests/test_rolling.py` & `xarray-2023.5.0/xarray/tests/test_rolling.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_sparse.py` & `xarray-2023.5.0/xarray/tests/test_sparse.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_testing.py` & `xarray-2023.5.0/xarray/tests/test_testing.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_tutorial.py` & `xarray-2023.5.0/xarray/tests/test_tutorial.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_ufuncs.py` & `xarray-2023.5.0/xarray/tests/test_ufuncs.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_units.py` & `xarray-2023.5.0/xarray/tests/test_units.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_utils.py` & `xarray-2023.5.0/xarray/tests/test_utils.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tests/test_variable.py` & `xarray-2023.5.0/xarray/tests/test_variable.py`

 * *Files 2% similar despite different names*

```diff
@@ -340,52 +340,60 @@
 
     def test_pandas_period_index(self):
         v = self.cls(["x"], pd.period_range(start="2000", periods=20, freq="B"))
         v = v.load()  # for dask-based Variable
         assert v[0] == pd.Period("2000", freq="B")
         assert "Period('2000-01-03', 'B')" in repr(v)
 
-    def test_1d_math(self):
-        x = 1.0 * np.arange(5)
-        y = np.ones(5)
+    @pytest.mark.parametrize("dtype", [float, int])
+    def test_1d_math(self, dtype: np.typing.DTypeLike) -> None:
+        x = np.arange(5, dtype=dtype)
+        y = np.ones(5, dtype=dtype)
 
         # should we need `.to_base_variable()`?
         # probably a break that `+v` changes type?
         v = self.cls(["x"], x)
         base_v = v.to_base_variable()
         # unary ops
         assert_identical(base_v, +v)
         assert_identical(base_v, abs(v))
         assert_array_equal((-v).values, -x)
         # binary ops with numbers
         assert_identical(base_v, v + 0)
         assert_identical(base_v, 0 + v)
         assert_identical(base_v, v * 1)
+        if dtype is int:
+            assert_identical(base_v, v << 0)
+            assert_array_equal(v << 3, x << 3)
+            assert_array_equal(v >> 2, x >> 2)
         # binary ops with numpy arrays
         assert_array_equal((v * x).values, x**2)
-        assert_array_equal((x * v).values, x**2)
+        assert_array_equal((x * v).values, x**2)  # type: ignore[attr-defined] # TODO: Fix mypy thinking numpy takes priority, GH7780
         assert_array_equal(v - y, v - 1)
         assert_array_equal(y - v, 1 - v)
+        if dtype is int:
+            assert_array_equal(v << x, x << x)
+            assert_array_equal(v >> x, x >> x)
         # verify attributes are dropped
         v2 = self.cls(["x"], x, {"units": "meters"})
         with set_options(keep_attrs=False):
             assert_identical(base_v, +v2)
         # binary ops with all variables
         assert_array_equal(v + v, 2 * v)
         w = self.cls(["x"], y, {"foo": "bar"})
         assert_identical(v + w, self.cls(["x"], x + y).to_base_variable())
         assert_array_equal((v * w).values, x * y)
 
         # something complicated
         assert_array_equal((v**2 * w - 1 + x).values, x**2 * y - 1 + x)
         # make sure dtype is preserved (for Index objects)
-        assert float == (+v).dtype
-        assert float == (+v).values.dtype
-        assert float == (0 + v).dtype
-        assert float == (0 + v).values.dtype
+        assert dtype == (+v).dtype
+        assert dtype == (+v).values.dtype
+        assert dtype == (0 + v).dtype
+        assert dtype == (0 + v).values.dtype
         # check types of returned data
         assert isinstance(+v, Variable)
         assert not isinstance(+v, IndexVariable)
         assert isinstance(0 + v, Variable)
         assert not isinstance(0 + v, IndexVariable)
 
     def test_1d_reduce(self):
@@ -2548,14 +2556,27 @@
         original = np.ma.MaskedArray(np.arange(5), mask=4 * [False] + [True])
         expected = np.arange(5.0)
         expected[-1] = np.nan
         actual = as_compatible_data(original)
         assert_array_equal(expected, actual)
         assert np.dtype(float) == actual.dtype
 
+        original = np.ma.MaskedArray([1.0, 2.0], mask=[True, False])
+        original.flags.writeable = False
+        expected = [np.nan, 2.0]
+        actual = as_compatible_data(original)
+        assert_array_equal(expected, actual)
+        assert np.dtype(float) == actual.dtype
+
+        # GH2377
+        actual = Variable(dims=tuple(), data=np.ma.masked)
+        expected = Variable(dims=tuple(), data=np.nan)
+        assert_array_equal(expected, actual)
+        assert actual.dtype == expected.dtype
+
     @pytest.mark.filterwarnings("ignore:Converting non-nanosecond")
     def test_datetime(self):
         expected = np.datetime64("2000-01-01")
         actual = as_compatible_data(expected)
         assert expected == actual
         assert np.ndarray == type(actual)
         assert np.dtype("datetime64[ns]") == actual.dtype
```

### Comparing `xarray-2023.4.2/xarray/tests/test_weighted.py` & `xarray-2023.5.0/xarray/tests/test_weighted.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/tutorial.py` & `xarray-2023.5.0/xarray/tutorial.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/util/deprecation_helpers.py` & `xarray-2023.5.0/xarray/util/deprecation_helpers.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/util/generate_aggregations.py` & `xarray-2023.5.0/xarray/util/generate_aggregations.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray/util/generate_ops.py` & `xarray-2023.5.0/xarray/util/generate_ops.py`

 * *Files 6% similar despite different names*

```diff
@@ -26,14 +26,16 @@
     ("__pow__", "operator.pow"),
     ("__truediv__", "operator.truediv"),
     ("__floordiv__", "operator.floordiv"),
     ("__mod__", "operator.mod"),
     ("__and__", "operator.and_"),
     ("__xor__", "operator.xor"),
     ("__or__", "operator.or_"),
+    ("__lshift__", "operator.lshift"),
+    ("__rshift__", "operator.rshift"),
 )
 BINOPS_REFLEXIVE = (
     ("__radd__", "operator.add"),
     ("__rsub__", "operator.sub"),
     ("__rmul__", "operator.mul"),
     ("__rpow__", "operator.pow"),
     ("__rtruediv__", "operator.truediv"),
@@ -50,14 +52,16 @@
     ("__ipow__", "operator.ipow"),
     ("__itruediv__", "operator.itruediv"),
     ("__ifloordiv__", "operator.ifloordiv"),
     ("__imod__", "operator.imod"),
     ("__iand__", "operator.iand"),
     ("__ixor__", "operator.ixor"),
     ("__ior__", "operator.ior"),
+    ("__ilshift__", "operator.ilshift"),
+    ("__irshift__", "operator.irshift"),
 )
 UNARY_OPS = (
     ("__neg__", "operator.neg"),
     ("__pos__", "operator.pos"),
     ("__abs__", "operator.abs"),
     ("__invert__", "operator.invert"),
 )
```

### Comparing `xarray-2023.4.2/xarray/util/print_versions.py` & `xarray-2023.5.0/xarray/util/print_versions.py`

 * *Files identical despite different names*

### Comparing `xarray-2023.4.2/xarray.egg-info/PKG-INFO` & `xarray-2023.5.0/xarray.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: xarray
-Version: 2023.4.2
+Version: 2023.5.0
 Summary: N-D labeled arrays and datasets in Python
 Home-page: https://github.com/pydata/xarray
 Author: xarray Developers
 Author-email: xarray@googlegroups.com
 License: Apache-2.0
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: License :: OSI Approved :: Apache Software License
```

### Comparing `xarray-2023.4.2/xarray.egg-info/SOURCES.txt` & `xarray-2023.5.0/xarray.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -39,14 +39,15 @@
 .github/workflows/publish-test-results.yaml
 .github/workflows/pypi-release.yaml
 .github/workflows/testpypi-release.yaml
 .github/workflows/upstream-dev-ci.yaml
 asv_bench/asv.conf.json
 asv_bench/benchmarks/README_CI.md
 asv_bench/benchmarks/__init__.py
+asv_bench/benchmarks/accessors.py
 asv_bench/benchmarks/alignment.py
 asv_bench/benchmarks/combine.py
 asv_bench/benchmarks/dataarray_missing.py
 asv_bench/benchmarks/dataset_io.py
 asv_bench/benchmarks/groupby.py
 asv_bench/benchmarks/import.py
 asv_bench/benchmarks/indexing.py
@@ -179,14 +180,15 @@
 xarray/convert.py
 xarray/py.typed
 xarray/testing.py
 xarray/tutorial.py
 xarray.egg-info/PKG-INFO
 xarray.egg-info/SOURCES.txt
 xarray.egg-info/dependency_links.txt
+xarray.egg-info/entry_points.txt
 xarray.egg-info/not-zip-safe
 xarray.egg-info/requires.txt
 xarray.egg-info/top_level.txt
 xarray/backends/__init__.py
 xarray/backends/api.py
 xarray/backends/common.py
 xarray/backends/file_manager.py
@@ -221,14 +223,15 @@
 xarray/core/arithmetic.py
 xarray/core/combine.py
 xarray/core/common.py
 xarray/core/computation.py
 xarray/core/concat.py
 xarray/core/coordinates.py
 xarray/core/dask_array_ops.py
+xarray/core/daskmanager.py
 xarray/core/dataarray.py
 xarray/core/dataset.py
 xarray/core/dtypes.py
 xarray/core/duck_array_ops.py
 xarray/core/extensions.py
 xarray/core/formatting.py
 xarray/core/formatting_html.py
@@ -239,14 +242,15 @@
 xarray/core/missing.py
 xarray/core/nanops.py
 xarray/core/npcompat.py
 xarray/core/nputils.py
 xarray/core/ops.py
 xarray/core/options.py
 xarray/core/parallel.py
+xarray/core/parallelcompat.py
 xarray/core/pdcompat.py
 xarray/core/pycompat.py
 xarray/core/resample.py
 xarray/core/resample_cftime.py
 xarray/core/rolling.py
 xarray/core/rolling_exp.py
 xarray/core/types.py
@@ -303,14 +307,15 @@
 xarray/tests/test_indexes.py
 xarray/tests/test_indexing.py
 xarray/tests/test_interp.py
 xarray/tests/test_merge.py
 xarray/tests/test_missing.py
 xarray/tests/test_nputils.py
 xarray/tests/test_options.py
+xarray/tests/test_parallelcompat.py
 xarray/tests/test_plot.py
 xarray/tests/test_plugins.py
 xarray/tests/test_print_versions.py
 xarray/tests/test_rolling.py
 xarray/tests/test_sparse.py
 xarray/tests/test_testing.py
 xarray/tests/test_tutorial.py
```

### Comparing `xarray-2023.4.2/xarray.egg-info/requires.txt` & `xarray-2023.5.0/xarray.egg-info/requires.txt`

 * *Files identical despite different names*

